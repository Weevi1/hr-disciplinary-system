const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dashboard-router-CsxAXVhx.js","assets/business-owner-dashboard-Dq6MrEKt.js","assets/pdf-vendor-CbrIsI36.js","assets/react-vendor-BMk1H4su.js","assets/firebase-vendor-BIBOIkWK.js","assets/ui-vendor-Bx41JZPX.js","assets/hr-dashboard-Dso9aBo_.js","assets/hod-dashboard-CL_RWHxj.js"])))=>i.map(i=>d[i]);
import{a as e}from"./pdf-vendor-CbrIsI36.js";import{j as a,L as s,a as t}from"./business-owner-dashboard-Dq6MrEKt.js";import{r}from"./react-vendor-BMk1H4su.js";import{u as l,Z as n}from"./dashboard-router-CsxAXVhx.js";import{aV as i,L as d,j as o,k as c,aW as m,aI as u,a8 as x,ah as g,n as p,S as h,I as y,T as b,v as j,ai as N,aX as f,s as v,aY as w,aZ as D,c as S,X as k,ao as C,at as R,a_ as A,F as P,ak as L}from"./ui-vendor-Bx41JZPX.js";import{P as T}from"./warning-components-rhTj25mI.js";import"./firebase-vendor-BIBOIkWK.js";import"./hr-dashboard-Dso9aBo_.js";import"./hod-dashboard-CL_RWHxj.js";const E=(e,a,s,t,r,l)=>{e.roundRect?(e.beginPath(),e.roundRect(a,s,t,r,l),e.fill()):(e.beginPath(),e.moveTo(a+l,s),e.lineTo(a+t-l,s),e.quadraticCurveTo(a+t,s,a+t,s+l),e.lineTo(a+t,s+r-l),e.quadraticCurveTo(a+t,s+r,a+t-l,s+r),e.lineTo(a+l,s+r),e.quadraticCurveTo(a,s+r,a,s+r-l),e.lineTo(a,s+l),e.quadraticCurveTo(a,s,a+l,s),e.closePath(),e.fill())},O=({audioElement:e,isPlaying:s,barCount:t=32,height:l=40,primaryColor:n="#3b82f6",backgroundColor:i="#e5e7eb",className:d=""})=>{const o=r.useRef(null),c=r.useRef(null),m=r.useRef(null),u=r.useRef(null),x=r.useRef(null),g=r.useRef(null),[p,h]=r.useState(!1),y=r.useCallback(()=>{const e=o.current,a=e?.getContext("2d");if(!a||!e)return;a.clearRect(0,0,e.width,e.height);const s=e.width/t*.7,r=e.width/t*.3;for(let l=0;l<t;l++){const t=l*(s+r),n=4,d=(e.height-n)/2;a.fillStyle=i,E(a,t,d,s,n,2)}},[t,i]),b=r.useCallback(()=>{if(!m.current||!o.current)return;const e=o.current,a=e.getContext("2d");if(!a)return;const r=m.current.frequencyBinCount,l=new Uint8Array(r);m.current.getByteFrequencyData(l),a.clearRect(0,0,e.width,e.height);const i=e.width/t*.7,d=e.width/t*.3;for(let s=0;s<t;s++){const o=Math.floor(s/t*r),c=Math.max(4,l[o]/255*e.height),m=s*(i+d),u=(e.height-c)/2;a.fillStyle=n,E(a,m,u,i,c,2)}s&&(x.current=requestAnimationFrame(b))},[s,t,n]);return r.useEffect(()=>{if(e&&g.current!==e){try{if(!c.current){const e=window.AudioContext||window.webkitAudioContext;if(!e)return void console.warn("Web Audio API not supported");c.current=new e}const a=c.current;m.current=a.createAnalyser(),m.current.fftSize=256,m.current.smoothingTimeConstant=.8,u.current=a.createMediaElementSource(e),u.current.connect(m.current),m.current.connect(a.destination),g.current=e,h(!0)}catch(a){console.warn("Could not connect audio to analyser:",a),g.current=e}return()=>{x.current&&(cancelAnimationFrame(x.current),x.current=null)}}},[e]),r.useEffect(()=>{m.current?(s&&"suspended"===c.current?.state&&c.current.resume(),s?b():(x.current&&cancelAnimationFrame(x.current),y())):y()},[s,b,y]),r.useEffect(()=>{y()},[y]),r.useEffect(()=>{const e=o.current;if(!e)return;const a=new ResizeObserver(()=>{const a=e.getBoundingClientRect();e.width=a.width*window.devicePixelRatio,e.height=l*window.devicePixelRatio;const t=e.getContext("2d");t&&t.scale(window.devicePixelRatio,window.devicePixelRatio),s||y()});return a.observe(e),()=>a.disconnect()},[l,s,y]),a.jsx("canvas",{ref:o,className:`w-full ${d}`,style:{height:`${l}px`},"aria-hidden":"true"})},I=e=>e?e.deleted?{status:"deleted",message:"This audio recording has been permanently deleted.",canPlay:!1}:e.autoDeleteDate&&new Date>new Date(e.autoDeleteDate)?{status:"expired",message:"This audio recording has expired and is no longer available.",canPlay:!1}:"processing"===e.processingStatus?{status:"processing",message:"Audio is still being processed. Please try again in a moment.",canPlay:!1}:"failed"===e.processingStatus?{status:"failed",message:"Audio processing failed. The recording may be corrupted.",canPlay:!1}:e.storageUrl||e.url?{status:"available",message:"Audio recording is ready to play.",canPlay:!0}:{status:"unavailable",message:"Audio URL is not available. The recording may not have been uploaded properly.",canPlay:!1}:{status:"not-available",message:"Audio recording not available.",canPlay:!1},U=({audioRecording:e,warningId:t,showDownload:l=!0,showMetadata:n=!0,showTranscript:f=!1,compact:v=!1,autoPlay:w=!1,className:D=""})=>{if(!e)return a.jsx("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 ${D}`,children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:a.jsx(i,{className:"w-5 h-5 text-gray-400"})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-gray-600",children:"No audio recording available"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Audio recording not found or not provided"})]})]})});const S=r.useRef(null),k=r.useRef(null),[C,R]=r.useState({isLoading:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,error:null,buffered:0}),A=I(e),P=(e=>I(e).canPlay)(e),L=(e=>"deleted"===I(e).status)(e),T=(e=>"expired"===I(e).status)(e),E=e?.storageUrl||e?.url;r.useEffect(()=>{const e=S.current;if(!e||!P||!E)return void R(e=>({...e,isLoading:!1,error:P?"No audio URL available":A.message}));e.src=E;const a=()=>{R(e=>({...e,isLoading:!0,error:null}))},t=()=>{R(a=>({...a,duration:e.duration||0,isLoading:!1}))},r=()=>{R(a=>({...a,currentTime:e.currentTime||0}))},l=()=>{R(e=>({...e,isPlaying:!0}))},n=()=>{R(e=>({...e,isPlaying:!1}))},i=()=>{R(e=>({...e,isPlaying:!1,currentTime:0})),e&&(e.currentTime=0)},d=e=>{s.error("Audio loading error:",e),R(e=>({...e,isLoading:!1,isPlaying:!1,error:"Failed to load audio recording. The file may be corrupted or unavailable."}))},o=()=>{if(e.buffered.length>0){const a=e.buffered.end(e.buffered.length-1),s=e.duration||0;R(e=>({...e,buffered:s?a/s*100:0}))}};return e.addEventListener("loadstart",a),e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",r),e.addEventListener("play",l),e.addEventListener("pause",n),e.addEventListener("ended",i),e.addEventListener("error",d),e.addEventListener("progress",o),e.load(),()=>{e.removeEventListener("loadstart",a),e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",r),e.removeEventListener("play",l),e.removeEventListener("pause",n),e.removeEventListener("ended",i),e.removeEventListener("error",d),e.removeEventListener("progress",o)}},[P,E,A.message]),r.useEffect(()=>{w&&S.current&&!C.isLoading&&!C.error&&P&&S.current.play().catch(e=>s.warn("Audio autoplay failed",e))},[w,C.isLoading,C.error,P]);const U=r.useCallback(async()=>{const e=S.current;if(e&&P)try{C.isPlaying?e.pause():await e.play()}catch(a){s.error("Playback error:",a),R(e=>({...e,error:"Playback failed. Please try again."}))}},[C.isPlaying,P]),M=r.useCallback(e=>{const a=S.current;a&&P&&(a.currentTime=e)},[P]),F=r.useCallback(e=>{const a=S.current;a&&(a.volume=e,R(a=>({...a,volume:e,isMuted:0===e})))},[]),$=r.useCallback(()=>{const e=S.current;if(e){const a=!C.isMuted;e.muted=a,R(e=>({...e,isMuted:a}))}},[C.isMuted]),B=e=>{if(!e||isNaN(e)||!isFinite(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`};return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${D}`,children:[P&&E&&a.jsx("audio",{ref:S,preload:"metadata"}),L?a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[a.jsx(j,{className:"w-5 h-5 text-red-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-red-800 font-medium",children:"Audio Recording Deleted"}),a.jsx("p",{className:"text-red-600 text-sm",children:A.message})]})]}):T?a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[a.jsx(b,{className:"w-5 h-5 text-yellow-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-yellow-800 font-medium",children:"Audio Recording Expired"}),a.jsx("p",{className:"text-yellow-600 text-sm",children:A.message})]})]}):"processing"===A.status?a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[a.jsx(d,{className:"w-5 h-5 text-blue-600 animate-spin"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-blue-800 font-medium",children:"Processing Audio"}),a.jsx("p",{className:"text-blue-600 text-sm",children:A.message})]})]}):"failed"===A.status||"unavailable"===A.status?a.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[a.jsx(N,{className:"w-5 h-5 text-red-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-red-800 font-medium",children:"Audio Unavailable"}),a.jsx("p",{className:"text-red-600 text-sm",children:A.message})]})]}):null,P&&!C.error&&a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:U,disabled:C.isLoading,className:"flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",title:C.isPlaying?"Pause":"Play",children:C.isLoading?a.jsx(d,{className:"w-5 h-5 animate-spin"}):C.isPlaying?a.jsx(o,{className:"w-5 h-5"}):a.jsx(c,{className:"w-5 h-5 ml-1"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"relative",children:[a.jsx(O,{audioElement:S.current,isPlaying:C.isPlaying,barCount:32,height:32,primaryColor:"#3b82f6",backgroundColor:"#e5e7eb"}),a.jsx("div",{ref:k,className:"absolute inset-0 cursor-pointer",onClick:e=>{if(k.current&&C.duration){const a=k.current.getBoundingClientRect(),s=(e.clientX-a.left)/a.width;M(s*C.duration)}},children:a.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-blue-600 transition-all",style:{left:C.duration?C.currentTime/C.duration*100+"%":"0%"}})})]}),a.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[a.jsx("span",{children:B(C.currentTime)}),a.jsx("span",{children:B(C.duration>0?C.duration:e.duration||0)})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:$,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:C.isMuted?"Unmute":"Mute",children:C.isMuted?a.jsx(m,{className:"w-4 h-4"}):a.jsx(u,{className:"w-4 h-4"})}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:C.isMuted?0:C.volume,onChange:e=>F(parseFloat(e.target.value)),className:"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Volume"})]}),l&&E&&a.jsx("button",{onClick:()=>{const a=document.createElement("a");a.href=E,a.download=`warning-audio-${e.recordingId||"recording"}.webm`,a.click()},className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Download Audio",children:a.jsx(x,{className:"w-4 h-4"})})]})}),n&&!v&&P&&!C.error&&a.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[a.jsx(g,{className:"w-3 h-3"}),"Recorded By"]}),a.jsx("p",{className:"font-medium",children:e.recordedByName||"Manager"})]}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[a.jsx(p,{className:"w-3 h-3"}),"Recorded"]}),a.jsx("p",{className:"font-medium",children:e.timestamp?new Date(e.timestamp).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):e.recordedAt?new Date(e.recordedAt).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):e.startTime?new Date(e.startTime).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):e.createdAt?new Date(e.createdAt).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"}):"Not available"})]})]}),e.consentGiven&&a.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-green-700 bg-green-50 px-3 py-2 rounded-lg",children:[a.jsx(h,{className:"w-3 h-3"}),a.jsx("span",{children:"Recording consent was obtained from all participants"})]}),e.autoDeleteDate&&a.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-lg",children:[a.jsx(y,{className:"w-3 h-3"}),a.jsxs("span",{children:["This recording will be automatically deleted on"," ",new Date(e.autoDeleteDate).toLocaleDateString()]})]})]}),C.error&&a.jsx("div",{className:"border-t border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[a.jsx(b,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:C.error})]})})]})},M=({signature:e,title:t,subtitle:l,isOpen:n,onClose:i,allowDownload:d=!0})=>{const o=r.useCallback(()=>{try{const a=atob(e.split(",")[1]),s=new Array(a.length);for(let e=0;e<a.length;e++)s[e]=a.charCodeAt(e);const r=new Uint8Array(s),l=new Blob([r],{type:"image/png"}),n=URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.download=`${t.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}catch(a){s.error("Signature download failed:",a)}},[e,t]),c=r.useCallback(async()=>{try{await navigator.clipboard.writeText(e)}catch(a){s.error("Failed to copy signature:",a)}},[e]);return n?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),l&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l})]}),a.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:a.jsx("img",{src:e,alt:t,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),a.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:c,className:"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[a.jsx(C,{className:"w-4 h-4"}),"Copy Data"]}),d&&a.jsxs("button",{onClick:o,className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[a.jsx(x,{className:"w-4 h-4"}),"Download"]})]})]})]})}):null},F=({signatures:e,warningId:s,showTimestamps:t=!0,compact:l=!1,showVerification:n=!0,allowDownload:i=!0,className:d=""})=>{const[o,c]=r.useState(null),m=e=>{if(!e)return!1;try{return e.startsWith("data:image/")&&e.includes("base64,")}catch{return!1}},u=m(e.manager),j=m(e.employee),N=u&&j,k=r.useCallback((e,a,s)=>{c({signature:e,title:a,subtitle:s})},[]),C=r.useCallback(()=>{c(null)},[]),R=e=>{if(!e)return"Not signed";try{return new Date(e).toLocaleString()}catch{return"Invalid timestamp"}},A=N?{status:"complete",message:"Document fully signed",color:"text-green-600 bg-green-50 border-green-200",icon:v}:u||j?{status:"partial",message:"Signatures pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:S}:{status:"missing",message:"No signatures collected",color:"text-gray-600 bg-gray-50 border-gray-200",icon:b},P=A.icon;return l?a.jsxs("div",{className:`inline-flex items-center gap-2 ${d}`,children:[a.jsx(P,{className:"w-4 h-4 text-gray-500"}),a.jsx("span",{className:"text-sm text-gray-600",children:N?"✓ Signed":"⏳ Pending"}),N&&a.jsx("button",{onClick:()=>k(e.manager,"Digital Signatures","Manager and Employee"),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View"})]}):a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${d}`,children:[a.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-4 py-3 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:a.jsx(f,{className:"w-4 h-4 text-white"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Digital Signatures"}),a.jsx("p",{className:"text-xs text-gray-600",children:"Electronic authorization and acknowledgment"})]})]}),n&&a.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${A.color}`,children:[a.jsx(P,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:A.message})]})]})}),a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(g,{className:"w-4 h-4 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Manager"}),u&&a.jsx(v,{className:"w-4 h-4 text-green-500"})]}),u&&a.jsx("button",{onClick:()=>k(e.manager,"Manager Signature",e.managerName||"Warning Issuer"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:a.jsx(w,{className:"w-4 h-4 text-gray-500"})})]}),u?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:a.jsx("img",{src:e.manager,alt:"Manager Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),a.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-3 h-3"}),a.jsx("span",{children:e.managerName||"Manager"})]}),t&&e.managerTimestamp&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(p,{className:"w-3 h-3"}),a.jsx("span",{children:R(e.managerTimestamp)})]})]})]}):a.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[a.jsx(g,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting manager signature"})]})]}),a.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-4 h-4 text-gray-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Employee"}),j&&a.jsx(v,{className:"w-4 h-4 text-green-500"})]}),j&&a.jsx("button",{onClick:()=>k(e.employee,"Employee Signature",e.employeeName||"Warning Recipient"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:a.jsx(w,{className:"w-4 h-4 text-gray-500"})})]}),j?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:a.jsx("img",{src:e.employee,alt:"Employee Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),a.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-3 h-3"}),a.jsx("span",{children:e.employeeName||"Employee"})]}),t&&e.employeeTimestamp&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(p,{className:"w-3 h-3"}),a.jsx("span",{children:R(e.employeeTimestamp)})]})]})]}):a.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[a.jsx(D,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting employee acknowledgment"})]})]})]})}),N&&a.jsx("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(h,{className:"w-5 h-5 text-green-600"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-green-800",children:"Document Digitally Signed & Verified"}),a.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["These digital signatures are legally binding and comply with electronic signature regulations.",s&&` Document ID: ${s}`]})]}),i&&a.jsx("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download signatures",children:a.jsx(x,{className:"w-4 h-4"})})]})}),!N&&(u||j)&&a.jsx("div",{className:"bg-yellow-50 border-t border-yellow-200 px-4 py-3",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(y,{className:"w-5 h-5 text-yellow-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Signature Collection In Progress"}),a.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Document requires signatures from both manager and employee to be legally complete."})]})]})}),o&&a.jsx(M,{signature:o.signature,title:o.title,subtitle:o.subtitle,isOpen:!0,onClose:C,allowDownload:i})]})},$=(e,a="Not specified")=>null==e?a:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":a,B=(e,a="Not set")=>{if(!e)return a;try{let s;return s=void 0!==e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:new Date(e),isNaN(s.getTime())?a:s.toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return a}},W=(e,a)=>{const s=B(e,"");return s&&"Not set"!==s?a?`${s} at ${a}`:s:"Not specified"},q=e=>{if(!e)return(new Date).toISOString().split("T")[0];try{let a;if(void 0!==e.seconds)a=new Date(1e3*e.seconds);else if(e instanceof Date)a=e;else{if("string"!=typeof e)return(new Date).toISOString().split("T")[0];a=new Date(e)}return isNaN(a.getTime())?(new Date).toISOString().split("T")[0]:a.toISOString().split("T")[0]}catch{return(new Date).toISOString().split("T")[0]}},V=(e,a)=>{const s={verbal:{primary:"bg-blue-600",secondary:"bg-blue-50",accent:"text-blue-600",background:"bg-blue-50",text:"text-blue-800",border:"border-blue-200"},written:{primary:"bg-yellow-600",secondary:"bg-yellow-50",accent:"text-yellow-600",background:"bg-yellow-50",text:"text-yellow-800",border:"border-amber-200"},final:{primary:"bg-red-600",secondary:"bg-red-50",accent:"text-red-600",background:"bg-red-50",text:"text-red-800",border:"border-red-200"},dismissal:{primary:"bg-red-700",secondary:"bg-red-50",accent:"text-red-700",background:"bg-red-50",text:"text-red-900",border:"border-red-300"}};return s[e]||s.verbal},z=({warning:i,isOpen:d,onClose:o,canTakeAction:c=!1,userRole:m="viewer",className:u="",onApprove:p,onReject:y,onAppealOutcome:b,canManageAppeals:j=!1})=>{const[N,v]=r.useState("overview"),[w,D]=r.useState(new Set(["summary"])),[C,E]=r.useState({type:null,loading:!1}),[O,I]=r.useState(!1),[M,z]=r.useState(""),[G,_]=r.useState(!1),[Z,H]=r.useState(!1),[X,Y]=r.useState(!1),[J,K]=r.useState(!1),[Q,ee]=r.useState(!1),[ae,se]=r.useState(null),[te,re]=r.useState(!1),[le,ne]=r.useState(null),[ie,de]=r.useState(""),[oe,ce]=r.useState(!1),me=r.useRef(null),ue=r.useRef(null);l(d);const{organization:xe}=t(),ge=r.useMemo(()=>i?{id:i.id||"",employeeName:$(i.employeeName),employeeNumber:$(i.employeeNumber),department:$(i.department),position:$(i.position),category:$(i.category),level:i.level||"verbal",status:i.status||"issued",incidentDate:B(i.incidentDate),incidentTime:$(i.incidentTime),incidentDateTime:W(i.incidentDate,i.incidentTime),incidentLocation:$(i.incidentLocation),description:$(i.description),issueDate:B(i.issueDate),expiryDate:B(i.expiryDate),issuedByName:$(i.issuedByName),deliveryMethod:$(i.deliveryMethod),additionalNotes:$(i.additionalNotes),hasAudio:Boolean(i.audioRecording?.url),audioRecording:i.audioRecording||null,hasPDF:Boolean(i.pdfGenerated||i.pdfFilename),hasSignatures:Boolean(i.signatures&&Object.keys(i.signatures).length>0),signatures:i.signatures||{manager:null,employee:null},validityPeriod:i.validityPeriod||6,escalationReason:$(i.escalationReason),acknowledgedAt:i.acknowledgedAt?B(i.acknowledgedAt):null,acknowledgedBy:$(i.acknowledgedBy),appealSubmitted:Boolean(i.appealSubmitted),appealDate:i.appealDate?B(i.appealDate):null,appealDetails:i.appealDetails||null,appealOutcome:i.appealOutcome||null,appealDecisionDate:i.appealDecisionDate?B(i.appealDecisionDate):null,appealReasoning:$(i.appealReasoning,""),hrNotes:$(i.hrNotes,""),followUpRequired:Boolean(i.followUpRequired),followUpDate:i.followUpDate?B(i.followUpDate):null,createdAt:B(i.createdAt),updatedAt:B(i.updatedAt)}:null,[i]),pe=r.useMemo(()=>ge?V(ge.level,ge.status):V("verbal"),[ge]),he=r.useCallback(()=>{_(!0),setTimeout(()=>{o(),_(!1),v("overview"),D(new Set(["summary"])),E({type:null,loading:!1}),I(!1),z(""),Y(!1),K(!1),ee(!1),se(null)},300)},[o]);r.useCallback(e=>{D(a=>{const s=new Set(a);return s.has(e)?s.delete(e):s.add(e),s})},[]),r.useCallback(async()=>{if(p&&ge?.id){E({type:"approve",loading:!0});try{await p(ge.id),setTimeout(he,1e3)}catch(e){s.error("Failed to approve warning:",e),E({type:null,loading:!1})}}},[p,ge?.id,he]),r.useCallback(async()=>{if(y&&ge?.id){E({type:"reject",loading:!0});try{await y(ge.id,M),setTimeout(he,1e3)}catch(e){s.error("Failed to reject warning:",e),E({type:null,loading:!1})}}},[y,ge?.id,M,he]),r.useCallback(()=>{I(!0)},[]);const ye=r.useCallback(()=>{ge?.hasAudio&&ee(!0)},[ge?.hasAudio]),be=r.useCallback(()=>{Y(!0)},[]),je=r.useCallback(async()=>{if(ge)try{const{PDFGenerationService:a}=await e(async()=>{const{PDFGenerationService:e}=await import("./dashboard-router-CsxAXVhx.js").then(e=>e.d);return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7])),t=await a.generateAppealReportPDF({warningId:i.id||"N/A",employee:{firstName:ge.employeeName.split(" ")[0]||"Unknown",lastName:ge.employeeName.split(" ").slice(1).join(" ")||"Employee",employeeNumber:ge.employeeNumber,department:ge.department,position:ge.position},category:ge.category,warningLevel:ge.level,issueDate:i.issueDate?.seconds?new Date(1e3*i.issueDate.seconds):new Date,organization:{name:xe?.name||"Organization",branding:xe?.branding},appealDetails:ge.appealDetails?{grounds:ge.appealDetails.grounds,details:ge.appealDetails.details,requestedOutcome:ge.appealDetails.requestedOutcome,submittedAt:ge.appealDetails.submittedAt?new Date(ge.appealDetails.submittedAt):void 0,submittedBy:ge.appealDetails.submittedBy}:void 0,appealOutcome:ge.appealOutcome,appealDecisionDate:i.appealDecisionDate?.seconds?new Date(1e3*i.appealDecisionDate.seconds):void 0,appealReasoning:ge.appealReasoning,hrNotes:ge.hrNotes,followUpRequired:ge.followUpRequired,followUpDate:i.followUpDate?.seconds?new Date(1e3*i.followUpDate.seconds):void 0}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download=`Appeal_Report_${i.id||"Unknown"}_${(new Date).toISOString().split("T")[0]}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r),s.success("✅ Appeal report downloaded")}catch(a){s.error("❌ Failed to generate appeal report:",a),console.error("Full error details:",a),console.error("Warning data:",ge),console.error("Organization:",xe),alert(`Failed to generate appeal report: ${a instanceof Error?a.message:"Unknown error"}`)}},[ge,i,xe]),Ne=r.useCallback(()=>{ge?.hasSignatures&&K(!0)},[ge?.hasSignatures]),fe=r.useCallback(e=>{if(!ge?.signatures)return;const a=ge.signatures[e];a&&(se({signature:a,title:`${e.charAt(0).toUpperCase()+e.slice(1)} Signature`,subtitle:`Warning ID: ${ge.id} • ${ge.employeeName}`}),K(!0))},[ge]);return d&&ge?a.jsxs(a.Fragment,{children:[a.jsx("div",{ref:ue,className:`\n          fixed inset-0 flex items-center justify-center p-4\n          bg-black/60 backdrop-blur-xl\n          transition-all duration-500 ease-out\n          ${G?"opacity-0":"opacity-100"}\n          ${u}\n        `,style:{zIndex:n.modal},onClick:e=>e.target===ue.current&&he(),children:a.jsxs("div",{ref:me,className:`\n            relative w-full max-w-4xl max-h-[90vh] \n            bg-white rounded-lg shadow-xl border border-gray-200\n            overflow-hidden\n            transition-all duration-300 ease-out\n            ${G?"scale-95 opacity-0":"scale-100 opacity-100"}\n          `,children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`\n                w-10 h-10 rounded-lg ${pe.primary}\n                flex items-center justify-center\n              `,children:a.jsx(h,{className:"w-5 h-5 text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),a.jsxs("p",{className:"text-sm text-gray-600",children:[ge.employeeName," • ",ge.category]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium rounded-full "+("verbal"===ge.level?"bg-blue-100 text-blue-800":"written"===ge.level?"bg-yellow-100 text-yellow-800":"final"===ge.level?"bg-red-100 text-red-800":"dismissal"===ge.level?"bg-red-200 text-red-900":"bg-gray-100 text-gray-800"),children:"verbal"===ge.level?"Verbal Warning":"written"===ge.level?"Written Warning":"final"===ge.level?"Final Warning":"dismissal"===ge.level?"Dismissal":"Warning"}),a.jsx("button",{onClick:he,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]})]}),a.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[a.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Incident Summary"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description:"}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ge.description})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),a.jsx("span",{className:"ml-2 text-gray-600",children:ge.incidentDate})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Location:"}),a.jsx("span",{className:"ml-2 text-gray-600",children:ge.incidentLocation})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[a.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[a.jsx(g,{className:"w-4 h-4 text-gray-600"}),"Employee Details"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Name:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.employeeName})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"ID:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.employeeNumber})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Position:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.position})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Department:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.department})]})]})]}),a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[a.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[a.jsx(S,{className:"w-4 h-4 text-gray-600"}),"Warning Timeline"]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.issueDate})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.expiryDate})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Issued By:"}),a.jsx("span",{className:"font-medium text-gray-900",children:ge.issuedByName})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-gray-600",children:"Status:"}),a.jsx("span",{className:"font-medium "+("delivered"===ge.deliveryStatus?"text-green-600":"text-orange-600"),children:"delivered"===ge.deliveryStatus?"Delivered":"Pending Delivery"})]})]})]})]}),(ge.appealSubmitted||ge.appealOutcome)&&a.jsxs("div",{className:"mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[a.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[a.jsx(R,{className:"w-4 h-4 text-purple-600"}),"Appeal History"]}),ge.appealSubmitted&&ge.appealDetails&&a.jsxs("div",{className:"mb-4 p-3 bg-white rounded-lg border border-purple-100",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-900 uppercase",children:"Employee Appeal"}),a.jsx("span",{className:"text-xs text-gray-600",children:ge.appealDate})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[ge.appealDetails.grounds&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Grounds:"}),a.jsx("p",{className:"text-gray-600 mt-1",children:ge.appealDetails.grounds})]}),ge.appealDetails.details&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Additional Details:"}),a.jsx("p",{className:"text-gray-600 mt-1",children:ge.appealDetails.details})]}),ge.appealDetails.requestedOutcome&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Requested Outcome:"}),a.jsx("p",{className:"text-gray-600 mt-1",children:ge.appealDetails.requestedOutcome})]}),ge.appealDetails.submittedBy&&a.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Submitted by: ",ge.appealDetails.submittedBy]})]})]}),ge.appealOutcome&&a.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-100",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("span",{className:"text-xs font-semibold text-purple-900 uppercase",children:"HR Decision"}),a.jsx("span",{className:"text-xs text-gray-600",children:ge.appealDecisionDate||"Pending"})]}),a.jsxs("div",{className:"space-y-2 text-sm",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"font-medium text-gray-700",children:"Outcome:"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("overturned"===ge.appealOutcome?"bg-green-100 text-green-800":"upheld"===ge.appealOutcome?"bg-red-100 text-red-800":"modified"===ge.appealOutcome?"bg-blue-100 text-blue-800":"reduced"===ge.appealOutcome?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"overturned"===ge.appealOutcome?"Warning Overturned":"upheld"===ge.appealOutcome?"Appeal Upheld - Warning Stands":"modified"===ge.appealOutcome?"Warning Modified":"reduced"===ge.appealOutcome?"Warning Reduced":ge.appealOutcome})]}),ge.appealReasoning&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"HR Reasoning:"}),a.jsx("p",{className:"text-gray-600 mt-1",children:ge.appealReasoning})]}),ge.hrNotes&&a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-gray-700",children:"HR Notes:"}),a.jsx("p",{className:"text-gray-600 mt-1",children:ge.hrNotes})]}),ge.followUpRequired&&a.jsx("div",{className:"mt-2 p-2 bg-yellow-50 rounded border border-yellow-200",children:a.jsxs("span",{className:"text-xs font-medium text-yellow-800",children:["⚠️ Follow-up required",ge.followUpDate?` by ${ge.followUpDate}`:""]})})]})]})]}),a.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center gap-3",children:[ge.hasAudio&&a.jsxs("button",{onClick:ye,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",children:[a.jsx(A,{className:"w-4 h-4"}),"Audio Recording"]}),a.jsxs("button",{onClick:be,className:"flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium",children:[a.jsx(P,{className:"w-4 h-4"}),ge.appealSubmitted||ge.appealOutcome?"View PDF (with Appeal)":"View PDF"]}),ge.hasSignatures&&a.jsxs("button",{onClick:Ne,className:"flex items-center gap-2 px-3 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm",children:[a.jsx(f,{className:"w-4 h-4"}),"Signatures"]}),(ge.appealSubmitted||ge.appealOutcome)&&a.jsxs("button",{onClick:je,className:"flex items-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[a.jsx(R,{className:"w-4 h-4"}),"Print Appeal Report"]})]})})]})})]})}),Q&&ge?.hasAudio&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{zIndex:n.modalNested1},children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),a.jsx("button",{onClick:()=>ee(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-6",children:a.jsx(U,{audioData:ge.audioRecording,compact:!1})})]})}),J&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{zIndex:n.modalNested1},children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),a.jsx("button",{onClick:()=>K(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-6",children:ge?.hasSignatures?a.jsxs("div",{className:"space-y-4",children:[ge.signatures?.manager&&a.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Manager Signature"}),a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:a.jsx("img",{src:ge.signatures.manager,alt:"Manager Signature",className:"max-w-full h-20 mx-auto"})})]}),ge.signatures?.employee&&a.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[a.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Employee Signature"}),a.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:a.jsx("img",{src:ge.signatures.employee,alt:"Employee Signature",className:"max-w-full h-20 mx-auto"})})]})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),a.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),X&&a.jsx(T,{isOpen:X,onClose:()=>Y(!1),warningData:{selectedEmployee:{id:i.employeeId||"",firstName:i.employeeName||"Unknown",lastName:i.employeeLastName||"Employee",employeeId:i.employeeNumber||"",employeeNumber:i.employeeNumber||"",department:i.employeeDepartment||i.department||"",position:i.employeePosition||i.position||"",email:i.employeeEmail||""},selectedCategory:{id:i.categoryId||"",name:i.categoryName||i.category||"General",severity:"medium",description:i.categoryName||i.category||"General"},formData:{incidentDate:q(i.incidentDate),incidentTime:i.incidentTime||"12:00",incidentLocation:i.incidentLocation||"",incidentDescription:i.incidentDescription||i.description||"",additionalNotes:i.additionalNotes||"",validityPeriod:i.validityPeriod||6,issueDate:q(i.issueDate),status:i.status,pdfGeneratorVersion:i.pdfGeneratorVersion,pdfTemplateVersion:i.pdfTemplateVersion,pdfSettings:i.pdfSettings},signatures:i.signatures||{manager:null,employee:null},lraRecommendation:i.disciplineRecommendation||{category:i.categoryName||i.category||"General",recommendedLevel:i.level||"Counselling Session",suggestedLevel:i.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],activeWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:i.organizationId||""},onPDFGenerated:(e,a)=>{i.categoryName,i.category,i.signatures}}),Q&&ge?.hasAudio&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:n.modalNested1},children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",ge.id," • ",ge.employeeName]})]}),a.jsx("button",{onClick:()=>ee(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("div",{className:"p-6",children:a.jsx(U,{audioRecording:ge.audioRecording,warningId:ge.id,showDownload:!0,showMetadata:!0,className:"w-full"})})]})}),J&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:n.modalNested1},children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",ge.id," • ",ge.employeeName]})]}),a.jsx("button",{onClick:()=>K(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("div",{className:"p-6",children:ge?.hasSignatures?a.jsxs(a.Fragment,{children:[a.jsx(F,{signatures:ge.signatures,warningId:ge.id,showTimestamps:!0,showVerification:!0,allowDownload:!0,className:"w-full mb-4"}),a.jsxs("div",{className:"flex gap-3",children:[ge.signatures.manager&&a.jsxs("button",{onClick:()=>fe("manager"),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[a.jsx(L,{className:"w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"View Manager Signature"})]}),ge.signatures.employee&&a.jsxs("button",{onClick:()=>fe("employee"),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[a.jsx(L,{className:"w-4 h-4 text-green-600"}),a.jsx("span",{className:"text-sm text-green-700 font-medium",children:"View Employee Signature"})]})]})]}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),a.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),ae&&a.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:n.modalNested2},children:a.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:ae.title}),ae.subtitle&&a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ae.subtitle})]}),a.jsx("button",{onClick:()=>se(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(k,{className:"w-5 h-5 text-gray-500"})})]}),a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:a.jsx("img",{src:ae.signature,alt:ae.title,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),a.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[a.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),a.jsxs("button",{onClick:()=>{const e=document.createElement("a");e.href=ae.signature,e.download=`${ae.title.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[a.jsx(x,{className:"w-4 h-4"}),"Download PNG"]})]})]})})]}):null};export{z as WarningDetailsModal,z as default};
