import{u as Q,d as G,L as x,j as e,n as Z,o as ee,A as se,l as ae}from"./dashboard-components-CEqYUp5t.js";import{u as te,r}from"./react-vendor-DrdoFN08.js";import{as as re,$ as ne,aQ as le,X as oe,c as E,C as ie,F as k,a6 as ce,i as de,h as me,D as xe,ap as pe}from"./ui-vendor-D5iFg9Jt.js";import"./firebase-vendor-Cz3N8Xg7.js";import"./pdf-vendor-Bp5yZ91a.js";import"./warning-components-BmrOpsKb.js";const _=[{id:"full-day",label:"Full Day Absence",icon:"🏠",payrollImpact:!0,description:"Employee absent for entire work day"},{id:"half-day",label:"Half Day Absence",icon:"⏰",payrollImpact:!0,description:"Employee absent for half of work day"},{id:"late-arrival",label:"Late Arrival",icon:"🕐",payrollImpact:!1,description:"Employee arrived late to work"},{id:"early-departure",label:"Early Departure",icon:"🚪",payrollImpact:!1,description:"Employee left work early"},{id:"sick-leave",label:"Sick Leave",icon:"🤒",payrollImpact:!0,description:"Employee absent due to illness"},{id:"personal-leave",label:"Personal Leave",icon:"👤",payrollImpact:!0,description:"Employee absent for personal reasons"}],je=()=>{const f=te(),{user:n}=Q(),{organization:u}=G(),[l,A]=r.useState(null),[p,C]=r.useState(new Date().toISOString().split("T")[0]),[h,R]=r.useState(""),[d,F]=r.useState(""),[D,L]=r.useState(!1),[P,v]=r.useState(null),[$,q]=r.useState(!1),[J,I]=r.useState(!0),[y,z]=r.useState([]),[T,w]=r.useState("idle"),[O,M]=r.useState(null),g=r.useRef(),[c,V]=r.useState({}),[b,j]=r.useState(new Set),m=r.useMemo(()=>`absence_report_draft_${n?.id}_${u?.id}`,[n?.id,u?.id]),B=r.useCallback(()=>{if(!m)return;const s={selectedEmployeeId:l?.id||"",absenceDate:p,absenceType:h,reason:d,timestamp:Date.now()};try{localStorage.setItem(m,JSON.stringify(s)),w("saved"),M(new Date),x.debug("💾 Auto-saved absence report draft",s)}catch(a){w("error"),x.error("Failed to auto-save absence report draft:",a)}},[m,l?.id,p,h,d]),H=r.useCallback(()=>{if(m)try{const s=localStorage.getItem(m);if(!s)return;const a=JSON.parse(s);if(Date.now()-a.timestamp>1440*60*1e3){localStorage.removeItem(m);return}return x.debug("📋 Restored absence report draft",a),a.absenceDate&&C(a.absenceDate),a.absenceType&&R(a.absenceType),a.reason&&F(a.reason),a}catch(s){x.error("Failed to restore absence report draft:",s),localStorage.removeItem(m)}},[m]),W=r.useCallback(()=>{m&&(localStorage.removeItem(m),w("idle"),M(null))},[m]),N=r.useCallback((s,a)=>{const i={};switch(s){case"selectedEmployee":a||(i.selectedEmployee="Please select an employee");break;case"absenceDate":a||(i.absenceDate="Please select an absence date");break;case"absenceType":a||(i.absenceType="Please select an absence type");break;case"reason":a&&a.length>80&&(i.reason="Reason must be 80 characters or less");break}return V(S=>({...S,[s]:i[s]||""})),!i[s]},[]);r.useEffect(()=>{u?.id&&n?.id?(async()=>{x.debug("📋 Loading employees for absence reporting. Manager:",n.id,"Role:",n.role?.id,"Org:",u.id);try{I(!0),v(null);const a=await se.employees.getByManager(n?.id||"",u.id);x.success(3871);const i=a.map(t=>({id:t.id,firstName:t.profile?.firstName||t.firstName||"Unknown",lastName:t.profile?.lastName||t.lastName||"Employee",position:t.profile?.position||t.employment?.position||"Unknown Position",department:t.profile?.department||t.employment?.department||"Unknown",email:t.profile?.email||t.contact?.email||t.email||"",phone:t.profile?.phone||t.contact?.phone||t.phone||"",deliveryPreference:t.deliveryPreference||"email",...t}));x.debug("👥 Employee details for absence reporting:",i.map(t=>`${t.firstName} ${t.lastName}`)),z(i);const S=H();if(S?.selectedEmployeeId){const t=i.find(K=>K.id===S.selectedEmployeeId);t&&(A(t),x.debug("📋 Restored selected employee from draft:",t.firstName,t.lastName))}}catch(a){x.error("❌ Error loading managed employees for absence reporting:",a),v("Failed to load your team members. Please try again."),z([])}finally{I(!1)}})():(x.debug("⏳ Waiting for user or organization to load...",{userId:n?.id,orgId:u?.id}),I(!1))},[n?.id,u?.id,H]),r.useEffect(()=>((l||p||h||d)&&(w("saving"),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{B()},1e3)),()=>{g.current&&clearTimeout(g.current)}),[l,p,h,d,B]),r.useEffect(()=>()=>{g.current&&clearTimeout(g.current)},[]);const U=()=>l&&p&&h,o=_.find(s=>s.id===h),X=async()=>{if(!(!n||!l||!n.organizationId||!o))try{L(!0),v(null);const s={organizationId:n.organizationId,managerId:n.id,managerName:`${n.firstName} ${n.lastName}`,employeeId:l.id,employeeName:`${l.profile.firstName} ${l.profile.lastName}`,absenceDate:p,absenceType:h,reportedDate:new Date().toISOString(),payrollImpact:o.payrollImpact,hrReviewed:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};l.profile.employeeNumber&&(s.employeeNumber=l.profile.employeeNumber),d.trim()&&(s.reason=d.trim()),await ae.createDocument(u.id,"reports",s),W(),q(!0),setTimeout(()=>{f("/dashboard")},3e3)}catch(s){x.error("Failed to submit absence report:",s),v("Failed to submit absence report. Please try again.")}finally{L(!1)}},Y=80-d.length;return J?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Your Team..."}),e.jsx("p",{className:"text-gray-600",children:"Finding employees you can report absences for..."})]})}):n?.organizationId?y.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"👥"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Team Members Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:n.role?.id==="hod-manager"?"You don't have any direct reports assigned to report absences for. Contact HR to assign team members.":"There are no employees you can report absences for based on your role permissions."}),e.jsxs("div",{className:"space-y-3",children:[(n.role?.id==="hr-manager"||n.role?.id==="business-owner")&&e.jsx("button",{onClick:()=>f("/employees"),className:"w-full bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors",children:"Manage Employees"}),e.jsx("button",{onClick:()=>f("/dashboard"),className:"w-full bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors",children:"Return to Dashboard"})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 p-2 sm:p-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-700 rounded-xl sm:rounded-2xl p-4 sm:p-6 text-white shadow-xl mb-4 sm:mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx(re,{className:"w-6 h-6 sm:w-8 sm:h-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Report Absence"}),e.jsx("p",{className:"text-orange-100 text-sm sm:text-base",children:"Log employee absence for HR notification"}),(l||p||h||d)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-orange-100 mt-2",children:[T==="saving"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-orange-200 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Saving draft..."})]}),T==="saved"&&O&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-3 h-3"}),e.jsxs("span",{children:["Draft saved at ",O.toLocaleTimeString()]})]}),T==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-3 h-3"}),e.jsx("span",{children:"Save failed - check connection"})]})]})]})]}),e.jsx("button",{onClick:()=>f("/dashboard"),className:"p-3 sm:p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors min-h-[44px] min-w-[44px] flex items-center justify-center",children:e.jsx(oe,{className:"w-5 h-5 sm:w-6 sm:h-6"})})]})}),P&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg sm:rounded-xl p-3 sm:p-4 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 font-medium text-sm sm:text-base",children:"Error"})]}),e.jsx("p",{className:"text-red-600 mt-1 text-sm sm:text-base",children:P})]}),$&&e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-8 text-center",children:[e.jsx(ie,{className:"w-12 h-12 sm:w-16 sm:h-16 text-green-500 mx-auto mb-3 sm:mb-4"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-2",children:"Absence Reported Successfully!"}),e.jsx("p",{className:"text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base",children:"HR has been notified of this absence for payroll processing."}),e.jsx("div",{className:"bg-green-50 rounded-lg sm:rounded-xl p-4 sm:p-6 mb-4 sm:mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Employee:"}),e.jsxs("span",{className:"text-green-600",children:[l?.profile.firstName," ",l?.profile.lastName]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Date:"}),e.jsx("span",{className:"text-green-600",children:new Date(p).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Type:"}),e.jsxs("span",{className:"text-green-600",children:[o?.icon," ",o?.label]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Payroll Impact:"}),e.jsx("span",{className:o?.payrollImpact?"text-red-600":"text-green-600",children:o?.payrollImpact?"💰 Yes - Affects Pay":"✅ No Impact"})]}),d&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Reason:"}),e.jsxs("span",{className:"text-green-600",children:['"',d,'"']})]})]})}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"Redirecting to dashboard in 3 seconds..."})]}),!$&&e.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6",children:[e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 sm:w-5 sm:h-5 text-orange-600"}),"Absence Information"]}),e.jsxs("p",{className:"text-gray-600 text-xs sm:text-sm",children:["✅ Found ",y.length," team member",y.length!==1?"s":""," you can report absences for."]})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx(Z,{icon:ce,title:"Select Employee",subtitle:"Choose the team member to report absence for"}),e.jsxs("select",{value:l?.id||"",onChange:s=>{const a=y.find(i=>i.id===s.target.value);A(a||null),j(i=>new Set(i).add("selectedEmployee")),N("selectedEmployee",a)},className:`w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm ${b.has("selectedEmployee")&&c.selectedEmployee?"border-red-300 bg-red-50":"border-gray-300"}`,style:{backgroundColor:b.has("selectedEmployee")&&c.selectedEmployee?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:b.has("selectedEmployee")&&c.selectedEmployee?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"},required:!0,children:[e.jsx("option",{value:"",children:"Choose an employee..."}),y.map(s=>e.jsxs("option",{value:s.id,children:[s.profile.firstName," ",s.profile.lastName,s.profile.employeeNumber&&` (${s.profile.employeeNumber})`]},s.id))]}),b.has("selectedEmployee")&&c.selectedEmployee&&e.jsxs("div",{className:"flex items-center gap-1 text-xs mt-1",style:{color:"var(--color-error)"},children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),c.selectedEmployee]})]}),e.jsx(ee,{type:"date",label:"Absence Date",value:p,onChange:s=>{C(s),j(a=>new Set(a).add("absenceDate")),N("absenceDate",s)},icon:de,required:!0,error:b.has("absenceDate")&&c.absenceDate?c.absenceDate:void 0}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(me,{className:"w-4 h-4 inline mr-1"}),"Type of Absence ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:h,onChange:s=>{R(s.target.value),j(a=>new Set(a).add("absenceType")),N("absenceType",s.target.value)},onBlur:()=>{j(s=>new Set(s).add("absenceType")),N("absenceType",h)},className:`w-full px-3 sm:px-4 py-3 text-sm sm:text-base border rounded-lg focus:ring-2 transition-colors min-h-[44px] ${b.has("absenceType")&&c.absenceType?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-orange-500 focus:ring-orange-500"}`,children:[e.jsx("option",{value:"",children:"Select type of absence..."}),_.map(s=>e.jsxs("option",{value:s.id,children:[s.icon," ",s.label,s.payrollImpact?" (Affects Pay)":""]},s.id))]}),o&&e.jsxs("div",{className:"mt-3 p-3 sm:p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base sm:text-lg",children:o.icon}),e.jsx("span",{className:"font-medium text-orange-900 text-sm sm:text-base",children:o.label})]}),o.payrollImpact&&e.jsxs("span",{className:"flex items-center text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full",children:[e.jsx(xe,{className:"w-3 h-3 mr-1 flex-shrink-0"}),"Affects Pay"]})]}),e.jsx("p",{className:"text-xs sm:text-sm text-orange-700",children:o.description}),o.payrollImpact&&e.jsxs("p",{className:"text-xs text-red-600 mt-2 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3 flex-shrink-0"}),"This absence type will affect the employee's payroll calculation"]})]}),b.has("absenceType")&&c.absenceType&&e.jsxs("p",{className:"text-red-600 text-xs sm:text-sm mt-1 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3 flex-shrink-0"}),c.absenceType]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(k,{className:"w-4 h-4 inline mr-1"}),"Reason (Optional)"]}),e.jsx("textarea",{value:d,onChange:s=>{const a=s.target.value.slice(0,80);F(a),j(i=>new Set(i).add("reason")),N("reason",a)},placeholder:"Brief explanation if needed...",rows:3,maxLength:80,className:`w-full px-3 sm:px-4 py-3 text-sm sm:text-base border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-colors resize-none min-h-[80px] ${b.has("reason")&&c.reason?"border-red-300 bg-red-50":"border-gray-300"}`}),e.jsxs("div",{className:"flex justify-between items-center text-xs mt-1",children:[b.has("reason")&&c.reason&&e.jsxs("p",{className:"text-red-600 flex items-center gap-1",children:[e.jsx(E,{className:"w-3 h-3 flex-shrink-0"}),c.reason]}),e.jsxs("div",{className:`text-xs sm:text-sm ml-auto ${Y<10?"text-red-500":"text-gray-500"}`,children:[Y," chars left"]})]})]}),e.jsx("button",{onClick:X,disabled:!U()||D,className:`w-full px-4 sm:px-6 py-4 rounded-lg font-medium transition-colors flex items-center justify-center space-x-2 min-h-[48px] text-sm sm:text-base ${U()&&!D?"bg-orange-600 text-white hover:bg-orange-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Submitting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Report Absence"})]})}),l&&o&&e.jsxs("div",{className:"mt-4 sm:mt-6 p-3 sm:p-4 bg-gray-50 rounded-lg sm:rounded-xl",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(k,{className:"w-4 h-4"}),"Report Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 text-xs sm:text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Employee:"}),e.jsxs("p",{className:"text-gray-600",children:[l.profile.firstName," ",l.profile.lastName]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),e.jsx("p",{className:"text-gray-600",children:new Date(p).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Type:"}),e.jsxs("p",{className:"text-gray-600",children:[o.icon," ",o.label]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Impact:"}),e.jsx("p",{className:o.payrollImpact?"text-red-600":"text-green-600",children:o.payrollImpact?"Affects Pay":"No Impact"})]})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Organization Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You don't seem to be associated with an organization."}),e.jsx("button",{onClick:()=>f("/dashboard"),className:"bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors",children:"Return to Dashboard"})]})})};export{je as ReportAbsence};
