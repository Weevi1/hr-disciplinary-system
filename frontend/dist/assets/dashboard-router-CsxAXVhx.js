const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/business-owner-dashboard-Dq6MrEKt.js","assets/pdf-vendor-CbrIsI36.js","assets/react-vendor-BMk1H4su.js","assets/firebase-vendor-BIBOIkWK.js","assets/ui-vendor-Bx41JZPX.js","assets/hr-dashboard-Dso9aBo_.js","assets/hod-dashboard-CL_RWHxj.js"])))=>i.map(i=>d[i]);
import{L as e,O as t,j as s,h as r,d as a,S as n,i,k as o,u as l,U as c,A as d,D as m,l as u,m as h,s as g,f as p,e as x,a as f,g as y,F as v,C as b}from"./business-owner-dashboard-Dq6MrEKt.js";import{r as j,g as w,c as N,b as C,R as S,d as D,u as k}from"./react-vendor-BMk1H4su.js";import{D as E,u as A}from"./hr-dashboard-Dso9aBo_.js";import{a as _}from"./pdf-vendor-CbrIsI36.js";import{p as R,n as F,j as P,l as z,q as I,w as T,m as O,A as L,u as M,t as B,c as W,D as H,k as U,E as $,G,H as V,I as q,J as Y}from"./firebase-vendor-BIBOIkWK.js";import{i as K,X,o as J,p as Z,q as Q,r as ee,U as te,D as se,d as re,s as ae,t as ne,u as ie,R as oe,k as le,T as ce,v as de,c as me,n as ue,w as he,x as ge,S as pe,L as xe,a as fe,I as ye,l as ve,y as be,z as je,E as we,G as Ne,C as Ce,J as Se,K as De,O as ke,Q as Ee,g as Ae,F as _e,V as Re,B as Fe,h as Pe,W as ze,Y as Ie,Z as Te,_ as Oe,$ as Le,A as Me,a0 as Be,a1 as We,a2 as He,P as Ue,a3 as $e,a4 as Ge,a5 as Ve,a6 as qe,a7 as Ye,a8 as Ke,a9 as Xe,aa as Je,ab as Ze,ac as Qe,ad as et,ae as tt,af as st,ag as rt,m as at,ah as nt,ai as it,aj as ot}from"./ui-vendor-Bx41JZPX.js";import{Q as lt}from"./hod-dashboard-CL_RWHxj.js";const ct=e=>{j.useEffect(()=>{if(!e)return;const t=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",document.body.classList.add("modal-open"),()=>{document.body.style.overflow=t,document.body.classList.remove("modal-open")}},[e])};function dt(e={}){const{preventBodyScroll:t=!0,onOpen:s,onClose:r,initialOpen:a=!1}=e,[n,i]=j.useState(a),[o,l]=j.useState(null);ct(t&&n);const c=j.useCallback(e=>{i(!0),void 0!==e&&l(e),s?.(e)},[s]),d=j.useCallback(()=>{i(!1),l(null),r?.()},[r]),m=j.useCallback(()=>{n?d():c()},[n,c,d]);return{isOpen:n,data:o,open:c,close:d,toggle:m,setData:l}}const mt=e=>e.isLegacyDevice?{employeeListLimit:10,warningHistoryLimit:5,imageMaxSize:500,audioMaxDuration:30,enableAnimations:!1,enableTransitions:!1}:{employeeListLimit:50,warningHistoryLimit:20,imageMaxSize:2048,audioMaxDuration:180,enableAnimations:!0,enableTransitions:!0},ut=()=>{const t=(()=>{const e=navigator.userAgent,t=/Android [234]\./.test(e),s=/OS [67]_/.test(e),r=t||s||/Android [234]/.test(e)||/iPhone OS [1-7]_/.test(e),a="mediaDevices"in navigator&&"MediaRecorder"in window,n=CSS?.supports?.("display","grid")&&CSS?.supports?.("color","var(--test)"),i=navigator.hardwareConcurrency>2&&navigator.deviceMemory>1,o="MediaRecorder"in window;let l="unknown",c="unknown";return/Chrome\//.test(e)?(l="Chrome",c=e.match(/Chrome\/(\d+)/)?.[1]||"unknown"):/Safari\//.test(e)&&!/Chrome/.test(e)?(l="Safari",c=e.match(/Version\/(\d+)/)?.[1]||"unknown"):/Android.*Browser/.test(e)&&(l="Android Browser",c=e.match(/Android (\d+\.\d+)/)?.[1]||"unknown"),{isLegacyDevice:r,hasModernAudio:a,hasModernCSS:n,hasGoodPerformance:i,supportsMediaRecorder:o,browserInfo:{name:l,version:c,isAndroid4x:t,isIOS6to7:s}}})();return(e=>{const t=document.body;e.isLegacyDevice&&t.classList.add("legacy-device"),e.browserInfo.isAndroid4x&&t.classList.add("android-4x"),e.browserInfo.isIOS6to7&&t.classList.add("ios-6-7"),e.hasModernAudio||t.classList.add("no-modern-audio"),e.hasModernCSS||t.classList.add("no-modern-css")})(t),(()=>{const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),document.documentElement.classList.add("js-viewport-fixed")};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)})})(),(t=>{if(!t.isLegacyDevice)return;setInterval(()=>{if("memory"in performance){const t=performance.memory.usedJSHeapSize/1048576;t>50&&(e.warn("High memory usage detected on legacy device:",t.toFixed(2),"MB"),window.gc&&window.gc())}},3e4)})(t),t.isLegacyDevice&&(t.browserInfo,t.hasModernAudio,t.hasModernCSS,mt(t)),t};let ht;"undefined"!=typeof window&&(ht=ut());const gt=({isOpen:e,onClose:r,title:a,subtitle:n,showBackButton:i=!1,onBack:o,hideHeader:l=!1,currentStep:c,totalSteps:d,stepTitles:m,showStepProgress:u=!1,size:h="lg",className:g="",primaryAction:p,secondaryAction:x,customFooter:f,children:y})=>{j.useContext(t);if(j.useEffect(()=>(e?(document.body.style.overflow="hidden",document.body.classList.add("modal-open")):(document.body.style.overflow="",document.body.classList.remove("modal-open")),()=>{document.body.style.overflow="",document.body.classList.remove("modal-open")}),[e]),!e)return null;const v={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl",full:"w-full h-full max-w-none"},b=()=>u&&d&&c?s.jsxs("div",{className:"modal-header__center",children:[s.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:s.jsx("div",{className:"mobile-step-indicator",children:s.jsx("div",{className:"mobile-step-dots",children:Array.from({length:d},(e,t)=>{const r=t+1,a=r===c,n=r<c;return s.jsx("div",{className:"mobile-step-dot "+(a?"mobile-step-dot--active":n?"mobile-step-dot--completed":"mobile-step-dot--inactive"),children:n?"✓":r},t)})})})}),s.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Array.from({length:d},(e,t)=>{const r=t+1,a=r===c,n=r<c;return s.jsx("div",{className:"step-container",children:s.jsx("div",{className:"modal-header__step "+(a?"modal-header__step--active":n?"modal-header__step--completed":"modal-header__step--inactive"),children:n?"✓":r})},t)})})]}):null,w="full"!==h;return s.jsx("div",{className:w?"":"modal-system",style:w?{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem",background:"rgba(0, 0, 0, 0.5)",zIndex:9999,overflow:"hidden"}:{},children:s.jsxs("div",{className:w?`${v[h]} ${g}`:`modal-container ${v[h]} ${g}`,style:w?{width:"100%",minHeight:"auto",maxHeight:"90vh",overflow:"hidden",borderRadius:"12px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",background:"white",display:"flex",flexDirection:"column",position:"relative"}:{},onClick:e=>e.stopPropagation(),children:[!l&&s.jsxs("div",{className:"modal-header",children:[s.jsxs("div",{className:"modal-header__left",children:[i&&o&&s.jsx("button",{onClick:o,className:"modal-header__close-button",children:s.jsx(K,{className:"w-4 h-4"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"modal-header__title",children:a}),n&&s.jsx("p",{className:"modal-header__subtitle",children:n})]})]}),s.jsx("button",{onClick:r,className:"modal-header__close-button",children:s.jsx(X,{className:"w-5 h-5"})})]}),s.jsx(b,{}),u&&m&&c&&m[c-1]&&s.jsx("div",{className:"sm:hidden text-center",children:s.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:m[c-1]})}),s.jsx("div",{className:"modal-content",children:s.jsx("div",{className:"modal-content__scrollable",children:y})}),(p||x||f)&&s.jsx("div",{className:"modal-footer",children:s.jsx("div",{className:"modal-footer__nav",children:f||s.jsxs(s.Fragment,{children:[x&&s.jsx("button",{onClick:x.onClick,className:"modal-footer__button modal-footer__button--secondary",children:x.label}),p&&s.jsx("button",{onClick:p.onClick,disabled:p.disabled,className:"modal-footer__button modal-footer__button--primary "+(p.loading?"modal-footer__button--loading":""),children:p.label})]})})})]})})};const pt=new class{async calculateCommission(t){try{const s=await r.getOrganization(t.organizationId);if(!s?.resellerId)throw new Error("No reseller assigned to organization");if(!(await r.getReseller(s.resellerId)))throw new Error("Reseller not found");const n=t.grossAmount-t.stripeFees,i=Math.round(.5*n),o=Math.round(.3*n),l=Math.round(.2*n),c={id:`${t.organizationId}-${t.periodStart}`,resellerId:s.resellerId,organizationId:t.organizationId,subscriptionId:t.subscriptionId,periodStart:t.periodStart,periodEnd:t.periodEnd,clientRevenue:t.grossAmount,stripeFees:t.stripeFees,netRevenue:n,commissionAmount:i,ownerAmount:o,companyAmount:l,status:"calculated",createdAt:R(),updatedAt:R()};return await F(P(a,"commissions",c.id),c),e.success("Commission calculated and saved:",c),c}catch(s){throw e.error("Failed to calculate commission:",s),s}}async processMonthlyPayouts(){try{const t=new Date;t.setDate(t.getDate()-30);const s=z(a,"commissions"),n=I(s,T("status","==","calculated"),T("createdAt","<",t.toISOString())),i=(await O(n)).docs.map(e=>({id:e.id,...e.data()}));i.length;const o=this.groupCommissionsByResellerMonth(i),l=[];for(const[c,d]of Object.entries(o)){const[t,s]=c.split("|"),n=await r.getReseller(t);if(!n)continue;const i=d.reduce((e,t)=>e+t.commissionAmount,0),o=d.reduce((e,t)=>e+t.netRevenue,0),m={resellerId:t,resellerName:`${n.firstName} ${n.lastName}`,month:s,province:n.province,totalClients:d.length,totalRevenue:o,totalCommission:i,commissions:d,payoutStatus:"pending",payoutDate:R()};await F(P(a,"commissionReports",`${t}-${s}`),m);const u=L(a);for(const e of d)u.update(P(a,"commissions",e.id),{status:"pending",updatedAt:R()});await u.commit(),l.push(m),e.success(`Generated commission report for ${n.firstName} ${n.lastName}: R${(i/100).toFixed(2)}`)}return l}catch(t){throw e.error("Failed to process monthly payouts:",t),t}}async markCommissionsPaid(t,s,r){try{const n=`${t}-${s}`;await M(P(a,"commissionReports",n),{payoutStatus:"paid",payoutReference:r,updatedAt:R()});const i=z(a,"commissions"),o=I(i,T("resellerId","==",t),T("status","==","pending")),l=await O(o),c=L(a);l.docs.forEach(e=>{c.update(e.ref,{status:"paid",payoutReference:r,updatedAt:R()})}),await c.commit(),e.success("Commissions marked as paid",{resellerId:t,month:s,payoutReference:r})}catch(n){throw e.error("Failed to mark commissions as paid:",n),n}}async getResellerMetrics(t){try{if(!(await r.getReseller(t)))throw new Error("Reseller not found");const s=await r.getResellerClients(t),n=s.filter(e=>!1!==e.isActive),i=z(a,"commissions"),o=I(i,T("resellerId","==",t)),l=(await O(o)).docs.map(e=>e.data()),c=l.reduce((e,t)=>e+t.commissionAmount,0),d=(l.reduce((e,t)=>e+t.netRevenue,0),(new Date).toISOString().slice(0,7)),m=l.filter(e=>e.periodStart.startsWith(d)),u=m.reduce((e,t)=>e+t.netRevenue,0),h=m.reduce((e,t)=>e+t.commissionAmount,0),g=n.length>0?u/n.length:0;let p="None";if(s.length>0){const e=s.map(e=>({name:e.name,revenue:e.monthlySubscription||0})).sort((e,t)=>t.revenue-e.revenue)[0];e.revenue>0&&(p=e.name)}const x=new Date;x.setMonth(x.getMonth()-1);const f=x.toISOString().slice(0,7),y=l.filter(e=>e.periodStart.startsWith(f)).reduce((e,t)=>e+t.netRevenue,0),v=y>0?(u-y)/y*100:0,b=75,j={totalClients:s.length,activeClients:n.length,monthlyRecurringRevenue:u,totalCommissionsEarned:c,monthlyCommissions:h,averageClientValue:g,monthlyGrowth:v,conversionRate:b,topPerformingClient:p};return e.success("Reseller metrics calculated:",j),j}catch(s){return e.error("Failed to get reseller metrics:",s),{totalClients:0,activeClients:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0,monthlyCommissions:0,averageClientValue:0,monthlyGrowth:0,conversionRate:0,topPerformingClient:"None"}}}async getProvincialMetrics(){try{const t=await r.getAllResellers(),s={};for(const e of t){const t=e.province;s[t]||(s[t]={resellers:0,clients:0,monthlyRevenue:0,commissionsOwed:0}),s[t].resellers+=1,s[t].clients+=e.clientIds.length,s[t].monthlyRevenue+=e.monthlyRecurringRevenue;const r=z(a,"commissions"),n=I(r,T("resellerId","==",e.id),T("status","in",["pending","calculated"])),i=(await O(n)).docs.reduce((e,t)=>e+(t.data().commissionAmount||0),0);s[t].commissionsOwed+=i}return e.success("Provincial metrics calculated:",s),s}catch(t){throw e.error("Failed to get provincial metrics:",t),t}}groupCommissionsByResellerMonth(e){const t={};for(const s of e){const e=s.periodStart.slice(0,7),r=`${s.resellerId}|${e}`;t[r]||(t[r]=[]),t[r].push(s)}return t}async getRecentCommissions(t,s=5){try{const i=z(a,"commissions"),o=I(i,T("resellerId","==",t),B("createdAt","desc")),l=(await O(o)).docs.map(e=>e.data()),c=[];for(let t=0;t<Math.min(l.length,s);t++){const s=l[t];let a="Unknown Client";try{const e=await r.getOrganization(s.organizationId);e&&(a=e.name)}catch(n){e.warn(`Could not get organization name for ${s.organizationId}`)}c.push({id:s.id,clientName:a,periodStart:s.periodStart,periodEnd:s.periodEnd,commissionAmount:s.commissionAmount,baseAmount:s.netRevenue,commissionRate:.5})}return e.success(`Retrieved ${c.length} recent commissions for reseller`),c}catch(n){return e.error("Failed to get recent commissions:",n),[]}}async getPerformanceTrend(t,s){try{const r="3m"===s?3:"6m"===s?6:12,n=z(a,"commissions"),i=I(n,T("resellerId","==",t),B("periodStart","desc")),o=(await O(i)).docs.map(e=>e.data()),l={};o.forEach(e=>{const t=e.periodStart.slice(0,7);l[t]||(l[t]={revenue:0,commissions:0}),l[t].revenue+=e.netRevenue,l[t].commissions+=e.commissionAmount});const c=[],d=new Date;for(let e=0;e<r;e++){const t=new Date(d.getFullYear(),d.getMonth()-e,1),s=t.toISOString().slice(0,7),r=t.toLocaleDateString("en-US",{month:"short",year:"numeric"});c.unshift({month:r,revenue:l[s]?.revenue||0,commissions:l[s]?.commissions||0})}return e.success(`Retrieved ${c.length} months of performance data for reseller`),c}catch(r){return e.error("Failed to get performance trend:",r),[]}}async generateCommissionStatement(t){try{e.warn("Commission statement generation not yet implemented - feature requested"),await new Promise(e=>setTimeout(e,1e3))}catch(s){throw e.error("Failed to generate commission statement:",s),s}}async getClientMetrics(t,s){try{let e=s;if(!e&&(e=await r.getOrganization(t),!e))throw new Error("Organization not found");let i=0;try{i=(await n.loadEmployees(t)).documents.length}catch(a){i=0}let o=0;try{const e=(await n.loadWarnings(t)).documents,s=new Date;s.setDate(1),o=e.filter(e=>new Date(e.issueDate)>=s).length}catch(a){o=0}return{monthlyRevenue:e.monthlySubscription||0,employeeCount:i,lastActivity:e.lastActivity||e.updatedAt||(new Date).toISOString(),subscriptionStatus:!1===e.isActive?"inactive":"active",warningsThisMonth:o}}catch(i){return e.error("Failed to get client metrics:",i),{monthlyRevenue:0,employeeCount:0,lastActivity:(new Date).toISOString(),subscriptionStatus:"inactive",warningsThisMonth:0}}}formatCurrency(e){return`R${(e/100).toFixed(2)}`}};var xt={exports:{}};var ft={exports:{}};const yt=w(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var vt;function bt(){return vt||(vt=1,ft.exports=function(){var e=e||function(e,t){var s;if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==N&&N.crypto&&(s=N.crypto),!s)try{s=yt}catch(p){}var r=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(p){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(p){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var s;return e.prototype=t,s=new e,e.prototype=null,s}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=i.WordArray=o.extend({init:function(e,s){e=this.words=e||[],this.sigBytes=s!=t?s:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,s=e.words,r=this.sigBytes,a=e.sigBytes;if(this.clamp(),r%4)for(var n=0;n<a;n++){var i=s[n>>>2]>>>24-n%4*8&255;t[r+n>>>2]|=i<<24-(r+n)%4*8}else for(var o=0;o<a;o+=4)t[r+o>>>2]=s[o>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,s=this.sigBytes;t[s>>>2]&=4294967295<<32-s%4*8,t.length=e.ceil(s/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],s=0;s<e;s+=4)t.push(r());return new l.init(t,e)}}),c=n.enc={},d=c.Hex={stringify:function(e){for(var t=e.words,s=e.sigBytes,r=[],a=0;a<s;a++){var n=t[a>>>2]>>>24-a%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,s=[],r=0;r<t;r+=2)s[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(s,t/2)}},m=c.Latin1={stringify:function(e){for(var t=e.words,s=e.sigBytes,r=[],a=0;a<s;a++){var n=t[a>>>2]>>>24-a%4*8&255;r.push(String.fromCharCode(n))}return r.join("")},parse:function(e){for(var t=e.length,s=[],r=0;r<t;r++)s[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(s,t)}},u=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(m.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return m.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var s,r=this._data,a=r.words,n=r.sigBytes,i=this.blockSize,o=n/(4*i),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*i,d=e.min(4*c,n);if(c){for(var m=0;m<c;m+=i)this._doProcessBlock(a,m);s=a.splice(0,c),r.sigBytes-=d}return new l.init(s,d)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,s){return new e.init(s).finalize(t)}},_createHmacHelper:function(e){return function(t,s){return new g.HMAC.init(e,s).finalize(t)}}});var g=n.algo={};return n}(Math);return e}()),ft.exports}var jt,wt={exports:{}};function Nt(){return jt||(jt=1,wt.exports=function(e){return r=(s=e).lib,a=r.Base,n=r.WordArray,(i=s.x64={}).Word=a.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=a.extend({init:function(e,s){e=this.words=e||[],this.sigBytes=s!=t?s:8*e.length},toX32:function(){for(var e=this.words,t=e.length,s=[],r=0;r<t;r++){var a=e[r];s.push(a.high),s.push(a.low)}return n.create(s,this.sigBytes)},clone:function(){for(var e=a.clone.call(this),t=e.words=this.words.slice(0),s=t.length,r=0;r<s;r++)t[r]=t[r].clone();return e}}),e;var t,s,r,a,n,i}(bt())),wt.exports}var Ct,St={exports:{}};function Dt(){return Ct||(Ct=1,St.exports=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,s=t.init,r=t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,r=[],a=0;a<t;a++)r[a>>>2]|=e[a]<<24-a%4*8;s.call(this,r,t)}else s.apply(this,arguments)};r.prototype=t}}(),e.lib.WordArray}(bt())),St.exports}var kt,Et={exports:{}};function At(){return kt||(kt=1,Et.exports=function(e){return function(){var t=e,s=t.lib.WordArray,r=t.enc;function a(e){return e<<8&4278255360|e>>>8&16711935}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,s=e.sigBytes,r=[],a=0;a<s;a+=2){var n=t[a>>>2]>>>16-a%4*8&65535;r.push(String.fromCharCode(n))}return r.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a++)r[a>>>1]|=e.charCodeAt(a)<<16-a%2*16;return s.create(r,2*t)}},r.Utf16LE={stringify:function(e){for(var t=e.words,s=e.sigBytes,r=[],n=0;n<s;n+=2){var i=a(t[n>>>2]>>>16-n%4*8&65535);r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>1]|=a(e.charCodeAt(n)<<16-n%2*16);return s.create(r,2*t)}}}(),e.enc.Utf16}(bt())),Et.exports}var _t,Rt={exports:{}};function Ft(){return _t||(_t=1,Rt.exports=function(e){return function(){var t=e,s=t.lib.WordArray;function r(e,t,r){for(var a=[],n=0,i=0;i<t;i++)if(i%4){var o=r[e.charCodeAt(i-1)]<<i%4*2|r[e.charCodeAt(i)]>>>6-i%4*2;a[n>>>2]|=o<<24-n%4*8,n++}return s.create(a,n)}t.enc.Base64={stringify:function(e){var t=e.words,s=e.sigBytes,r=this._map;e.clamp();for(var a=[],n=0;n<s;n+=3)for(var i=(t[n>>>2]>>>24-n%4*8&255)<<16|(t[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|t[n+2>>>2]>>>24-(n+2)%4*8&255,o=0;o<4&&n+.75*o<s;o++)a.push(r.charAt(i>>>6*(3-o)&63));var l=r.charAt(64);if(l)for(;a.length%4;)a.push(l);return a.join("")},parse:function(e){var t=e.length,s=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var n=0;n<s.length;n++)a[s.charCodeAt(n)]=n}var i=s.charAt(64);if(i){var o=e.indexOf(i);-1!==o&&(t=o)}return r(e,t,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(bt())),Rt.exports}var Pt,zt={exports:{}};function It(){return Pt||(Pt=1,zt.exports=function(e){return function(){var t=e,s=t.lib.WordArray;function r(e,t,r){for(var a=[],n=0,i=0;i<t;i++)if(i%4){var o=r[e.charCodeAt(i-1)]<<i%4*2|r[e.charCodeAt(i)]>>>6-i%4*2;a[n>>>2]|=o<<24-n%4*8,n++}return s.create(a,n)}t.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var s=e.words,r=e.sigBytes,a=t?this._safe_map:this._map;e.clamp();for(var n=[],i=0;i<r;i+=3)for(var o=(s[i>>>2]>>>24-i%4*8&255)<<16|(s[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|s[i+2>>>2]>>>24-(i+2)%4*8&255,l=0;l<4&&i+.75*l<r;l++)n.push(a.charAt(o>>>6*(3-l)&63));var c=a.charAt(64);if(c)for(;n.length%4;)n.push(c);return n.join("")},parse:function(e,t){void 0===t&&(t=!0);var s=e.length,a=t?this._safe_map:this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<a.length;i++)n[a.charCodeAt(i)]=i}var o=a.charAt(64);if(o){var l=e.indexOf(o);-1!==l&&(s=l)}return r(e,s,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),e.enc.Base64url}(bt())),zt.exports}var Tt,Ot={exports:{}};function Lt(){return Tt||(Tt=1,Ot.exports=function(e){return function(t){var s=e,r=s.lib,a=r.WordArray,n=r.Hasher,i=s.algo,o=[];!function(){for(var e=0;e<64;e++)o[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=i.MD5=n.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var r=t+s,a=e[r];e[r]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var n=this._hash.words,i=e[t+0],l=e[t+1],h=e[t+2],g=e[t+3],p=e[t+4],x=e[t+5],f=e[t+6],y=e[t+7],v=e[t+8],b=e[t+9],j=e[t+10],w=e[t+11],N=e[t+12],C=e[t+13],S=e[t+14],D=e[t+15],k=n[0],E=n[1],A=n[2],_=n[3];k=c(k,E,A,_,i,7,o[0]),_=c(_,k,E,A,l,12,o[1]),A=c(A,_,k,E,h,17,o[2]),E=c(E,A,_,k,g,22,o[3]),k=c(k,E,A,_,p,7,o[4]),_=c(_,k,E,A,x,12,o[5]),A=c(A,_,k,E,f,17,o[6]),E=c(E,A,_,k,y,22,o[7]),k=c(k,E,A,_,v,7,o[8]),_=c(_,k,E,A,b,12,o[9]),A=c(A,_,k,E,j,17,o[10]),E=c(E,A,_,k,w,22,o[11]),k=c(k,E,A,_,N,7,o[12]),_=c(_,k,E,A,C,12,o[13]),A=c(A,_,k,E,S,17,o[14]),k=d(k,E=c(E,A,_,k,D,22,o[15]),A,_,l,5,o[16]),_=d(_,k,E,A,f,9,o[17]),A=d(A,_,k,E,w,14,o[18]),E=d(E,A,_,k,i,20,o[19]),k=d(k,E,A,_,x,5,o[20]),_=d(_,k,E,A,j,9,o[21]),A=d(A,_,k,E,D,14,o[22]),E=d(E,A,_,k,p,20,o[23]),k=d(k,E,A,_,b,5,o[24]),_=d(_,k,E,A,S,9,o[25]),A=d(A,_,k,E,g,14,o[26]),E=d(E,A,_,k,v,20,o[27]),k=d(k,E,A,_,C,5,o[28]),_=d(_,k,E,A,h,9,o[29]),A=d(A,_,k,E,y,14,o[30]),k=m(k,E=d(E,A,_,k,N,20,o[31]),A,_,x,4,o[32]),_=m(_,k,E,A,v,11,o[33]),A=m(A,_,k,E,w,16,o[34]),E=m(E,A,_,k,S,23,o[35]),k=m(k,E,A,_,l,4,o[36]),_=m(_,k,E,A,p,11,o[37]),A=m(A,_,k,E,y,16,o[38]),E=m(E,A,_,k,j,23,o[39]),k=m(k,E,A,_,C,4,o[40]),_=m(_,k,E,A,i,11,o[41]),A=m(A,_,k,E,g,16,o[42]),E=m(E,A,_,k,f,23,o[43]),k=m(k,E,A,_,b,4,o[44]),_=m(_,k,E,A,N,11,o[45]),A=m(A,_,k,E,D,16,o[46]),k=u(k,E=m(E,A,_,k,h,23,o[47]),A,_,i,6,o[48]),_=u(_,k,E,A,y,10,o[49]),A=u(A,_,k,E,S,15,o[50]),E=u(E,A,_,k,x,21,o[51]),k=u(k,E,A,_,N,6,o[52]),_=u(_,k,E,A,g,10,o[53]),A=u(A,_,k,E,j,15,o[54]),E=u(E,A,_,k,l,21,o[55]),k=u(k,E,A,_,v,6,o[56]),_=u(_,k,E,A,D,10,o[57]),A=u(A,_,k,E,f,15,o[58]),E=u(E,A,_,k,C,21,o[59]),k=u(k,E,A,_,p,6,o[60]),_=u(_,k,E,A,w,10,o[61]),A=u(A,_,k,E,h,15,o[62]),E=u(E,A,_,k,b,21,o[63]),n[0]=n[0]+k|0,n[1]=n[1]+E|0,n[2]=n[2]+A|0,n[3]=n[3]+_|0},_doFinalize:function(){var e=this._data,s=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;s[a>>>5]|=128<<24-a%32;var n=t.floor(r/4294967296),i=r;s[15+(a+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),s[14+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(s.length+1),this._process();for(var o=this._hash,l=o.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return o},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,s,r,a,n,i){var o=e+(t&s|~t&r)+a+i;return(o<<n|o>>>32-n)+t}function d(e,t,s,r,a,n,i){var o=e+(t&r|s&~r)+a+i;return(o<<n|o>>>32-n)+t}function m(e,t,s,r,a,n,i){var o=e+(t^s^r)+a+i;return(o<<n|o>>>32-n)+t}function u(e,t,s,r,a,n,i){var o=e+(s^(t|~r))+a+i;return(o<<n|o>>>32-n)+t}s.MD5=n._createHelper(l),s.HmacMD5=n._createHmacHelper(l)}(Math),e.MD5}(bt())),Ot.exports}var Mt,Bt={exports:{}};function Wt(){return Mt||(Mt=1,Bt.exports=function(e){return s=(t=e).lib,r=s.WordArray,a=s.Hasher,n=t.algo,i=[],o=n.SHA1=a.extend({_doReset:function(){this._hash=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=this._hash.words,r=s[0],a=s[1],n=s[2],o=s[3],l=s[4],c=0;c<80;c++){if(c<16)i[c]=0|e[t+c];else{var d=i[c-3]^i[c-8]^i[c-14]^i[c-16];i[c]=d<<1|d>>>31}var m=(r<<5|r>>>27)+l+i[c];m+=c<20?1518500249+(a&n|~a&o):c<40?1859775393+(a^n^o):c<60?(a&n|a&o|n&o)-1894007588:(a^n^o)-899497514,l=o,o=n,n=a<<30|a>>>2,a=r,r=m}s[0]=s[0]+r|0,s[1]=s[1]+a|0,s[2]=s[2]+n|0,s[3]=s[3]+o|0,s[4]=s[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(s/4294967296),t[15+(r+64>>>9<<4)]=s,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=a._createHelper(o),t.HmacSHA1=a._createHmacHelper(o),e.SHA1;var t,s,r,a,n,i,o}(bt())),Bt.exports}var Ht,Ut={exports:{}};function $t(){return Ht||(Ht=1,Ut.exports=function(e){return function(t){var s=e,r=s.lib,a=r.WordArray,n=r.Hasher,i=s.algo,o=[],l=[];!function(){function e(e){for(var s=t.sqrt(e),r=2;r<=s;r++)if(!(e%r))return!1;return!0}function s(e){return 4294967296*(e-(0|e))|0}for(var r=2,a=0;a<64;)e(r)&&(a<8&&(o[a]=s(t.pow(r,.5))),l[a]=s(t.pow(r,1/3)),a++),r++}();var c=[],d=i.SHA256=n.extend({_doReset:function(){this._hash=new a.init(o.slice(0))},_doProcessBlock:function(e,t){for(var s=this._hash.words,r=s[0],a=s[1],n=s[2],i=s[3],o=s[4],d=s[5],m=s[6],u=s[7],h=0;h<64;h++){if(h<16)c[h]=0|e[t+h];else{var g=c[h-15],p=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,x=c[h-2],f=(x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10;c[h]=p+c[h-7]+f+c[h-16]}var y=r&a^r&n^a&n,v=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=u+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&d^~o&m)+l[h]+c[h];u=m,m=d,d=o,o=i+b|0,i=n,n=a,a=r,r=b+(v+y)|0}s[0]=s[0]+r|0,s[1]=s[1]+a|0,s[2]=s[2]+n|0,s[3]=s[3]+i|0,s[4]=s[4]+o|0,s[5]=s[5]+d|0,s[6]=s[6]+m|0,s[7]=s[7]+u|0},_doFinalize:function(){var e=this._data,s=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;return s[a>>>5]|=128<<24-a%32,s[14+(a+64>>>9<<4)]=t.floor(r/4294967296),s[15+(a+64>>>9<<4)]=r,e.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});s.SHA256=n._createHelper(d),s.HmacSHA256=n._createHmacHelper(d)}(Math),e.SHA256}(bt())),Ut.exports}var Gt,Vt={exports:{}};var qt,Yt={exports:{}};function Kt(){return qt||(qt=1,Yt.exports=function(e){return function(){var t=e,s=t.lib.Hasher,r=t.x64,a=r.Word,n=r.WordArray,i=t.algo;function o(){return a.create.apply(a,arguments)}var l=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=o()}();var d=i.SHA512=s.extend({_doReset:function(){this._hash=new n.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var s=this._hash.words,r=s[0],a=s[1],n=s[2],i=s[3],o=s[4],d=s[5],m=s[6],u=s[7],h=r.high,g=r.low,p=a.high,x=a.low,f=n.high,y=n.low,v=i.high,b=i.low,j=o.high,w=o.low,N=d.high,C=d.low,S=m.high,D=m.low,k=u.high,E=u.low,A=h,_=g,R=p,F=x,P=f,z=y,I=v,T=b,O=j,L=w,M=N,B=C,W=S,H=D,U=k,$=E,G=0;G<80;G++){var V,q,Y=c[G];if(G<16)q=Y.high=0|e[t+2*G],V=Y.low=0|e[t+2*G+1];else{var K=c[G-15],X=K.high,J=K.low,Z=(X>>>1|J<<31)^(X>>>8|J<<24)^X>>>7,Q=(J>>>1|X<<31)^(J>>>8|X<<24)^(J>>>7|X<<25),ee=c[G-2],te=ee.high,se=ee.low,re=(te>>>19|se<<13)^(te<<3|se>>>29)^te>>>6,ae=(se>>>19|te<<13)^(se<<3|te>>>29)^(se>>>6|te<<26),ne=c[G-7],ie=ne.high,oe=ne.low,le=c[G-16],ce=le.high,de=le.low;q=(q=(q=Z+ie+((V=Q+oe)>>>0<Q>>>0?1:0))+re+((V+=ae)>>>0<ae>>>0?1:0))+ce+((V+=de)>>>0<de>>>0?1:0),Y.high=q,Y.low=V}var me,ue=O&M^~O&W,he=L&B^~L&H,ge=A&R^A&P^R&P,pe=_&F^_&z^F&z,xe=(A>>>28|_<<4)^(A<<30|_>>>2)^(A<<25|_>>>7),fe=(_>>>28|A<<4)^(_<<30|A>>>2)^(_<<25|A>>>7),ye=(O>>>14|L<<18)^(O>>>18|L<<14)^(O<<23|L>>>9),ve=(L>>>14|O<<18)^(L>>>18|O<<14)^(L<<23|O>>>9),be=l[G],je=be.high,we=be.low,Ne=U+ye+((me=$+ve)>>>0<$>>>0?1:0),Ce=fe+pe;U=W,$=H,W=M,H=B,M=O,B=L,O=I+(Ne=(Ne=(Ne=Ne+ue+((me+=he)>>>0<he>>>0?1:0))+je+((me+=we)>>>0<we>>>0?1:0))+q+((me+=V)>>>0<V>>>0?1:0))+((L=T+me|0)>>>0<T>>>0?1:0)|0,I=P,T=z,P=R,z=F,R=A,F=_,A=Ne+(xe+ge+(Ce>>>0<fe>>>0?1:0))+((_=me+Ce|0)>>>0<me>>>0?1:0)|0}g=r.low=g+_,r.high=h+A+(g>>>0<_>>>0?1:0),x=a.low=x+F,a.high=p+R+(x>>>0<F>>>0?1:0),y=n.low=y+z,n.high=f+P+(y>>>0<z>>>0?1:0),b=i.low=b+T,i.high=v+I+(b>>>0<T>>>0?1:0),w=o.low=w+L,o.high=j+O+(w>>>0<L>>>0?1:0),C=d.low=C+B,d.high=N+M+(C>>>0<B>>>0?1:0),D=m.low=D+H,m.high=S+W+(D>>>0<H>>>0?1:0),E=u.low=E+$,u.high=k+U+(E>>>0<$>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(s/4294967296),t[31+(r+128>>>10<<5)]=s,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});t.SHA512=s._createHelper(d),t.HmacSHA512=s._createHmacHelper(d)}(),e.SHA512}(bt(),Nt())),Yt.exports}var Xt,Jt={exports:{}};var Zt,Qt={exports:{}};function es(){return Zt||(Zt=1,Qt.exports=function(e){return function(t){var s=e,r=s.lib,a=r.WordArray,n=r.Hasher,i=s.x64.Word,o=s.algo,l=[],c=[],d=[];!function(){for(var e=1,t=0,s=0;s<24;s++){l[e+5*t]=(s+1)*(s+2)/2%64;var r=(2*e+3*t)%5;e=t%5,t=r}for(e=0;e<5;e++)for(t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var a=1,n=0;n<24;n++){for(var o=0,m=0,u=0;u<7;u++){if(1&a){var h=(1<<u)-1;h<32?m^=1<<h:o^=1<<h-32}128&a?a=a<<1^113:a<<=1}d[n]=i.create(o,m)}}();var m=[];!function(){for(var e=0;e<25;e++)m[e]=i.create()}();var u=o.SHA3=n.extend({cfg:n.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new i.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var s=this._state,r=this.blockSize/2,a=0;a<r;a++){var n=e[t+2*a],i=e[t+2*a+1];n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),(E=s[a]).high^=i,E.low^=n}for(var o=0;o<24;o++){for(var u=0;u<5;u++){for(var h=0,g=0,p=0;p<5;p++)h^=(E=s[u+5*p]).high,g^=E.low;var x=m[u];x.high=h,x.low=g}for(u=0;u<5;u++){var f=m[(u+4)%5],y=m[(u+1)%5],v=y.high,b=y.low;for(h=f.high^(v<<1|b>>>31),g=f.low^(b<<1|v>>>31),p=0;p<5;p++)(E=s[u+5*p]).high^=h,E.low^=g}for(var j=1;j<25;j++){var w=(E=s[j]).high,N=E.low,C=l[j];C<32?(h=w<<C|N>>>32-C,g=N<<C|w>>>32-C):(h=N<<C-32|w>>>64-C,g=w<<C-32|N>>>64-C);var S=m[c[j]];S.high=h,S.low=g}var D=m[0],k=s[0];for(D.high=k.high,D.low=k.low,u=0;u<5;u++)for(p=0;p<5;p++){var E=s[j=u+5*p],A=m[j],_=m[(u+1)%5+5*p],R=m[(u+2)%5+5*p];E.high=A.high^~_.high&R.high,E.low=A.low^~_.low&R.low}E=s[0];var F=d[o];E.high^=F.high,E.low^=F.low}},_doFinalize:function(){var e=this._data,s=e.words;this._nDataBytes;var r=8*e.sigBytes,n=32*this.blockSize;s[r>>>5]|=1<<24-r%32,s[(t.ceil((r+1)/n)*n>>>5)-1]|=128,e.sigBytes=4*s.length,this._process();for(var i=this._state,o=this.cfg.outputLength/8,l=o/8,c=[],d=0;d<l;d++){var m=i[d],u=m.high,h=m.low;u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),c.push(h),c.push(u)}return new a.init(c,o)},clone:function(){for(var e=n.clone.call(this),t=e._state=this._state.slice(0),s=0;s<25;s++)t[s]=t[s].clone();return e}});s.SHA3=n._createHelper(u),s.HmacSHA3=n._createHmacHelper(u)}(Math),e.SHA3}(bt(),Nt())),Qt.exports}var ts,ss={exports:{}};var rs,as={exports:{}};function ns(){return rs||(rs=1,as.exports=function(e){var t,s,r;s=(t=e).lib.Base,r=t.enc.Utf8,t.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var s=e.blockSize,a=4*s;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),i=this._iKey=t.clone(),o=n.words,l=i.words,c=0;c<s;c++)o[c]^=1549556828,l[c]^=909522486;n.sigBytes=i.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,s=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(s))}})}(bt())),as.exports}var is,os={exports:{}};var ls,cs={exports:{}};function ds(){return ls||(ls=1,cs.exports=function(e){return s=(t=e).lib,r=s.Base,a=s.WordArray,n=t.algo,i=n.MD5,o=n.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s,r=this.cfg,n=r.hasher.create(),i=a.create(),o=i.words,l=r.keySize,c=r.iterations;o.length<l;){s&&n.update(s),s=n.update(e).finalize(t),n.reset();for(var d=1;d<c;d++)s=n.finalize(s),n.reset();i.concat(s)}return i.sigBytes=4*l,i}}),t.EvpKDF=function(e,t,s){return o.create(s).compute(e,t)},e.EvpKDF;var t,s,r,a,n,i,o}(bt(),Wt(),ns())),cs.exports}var ms,us={exports:{}};function hs(){return ms||(ms=1,us.exports=function(e){e.lib.Cipher||function(t){var s=e,r=s.lib,a=r.Base,n=r.WordArray,i=r.BufferedBlockAlgorithm,o=s.enc;o.Utf8;var l=o.Base64,c=s.algo.EvpKDF,d=r.Cipher=i.extend({cfg:a.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,s){this.cfg=this.cfg.extend(s),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?v:f}return function(t){return{encrypt:function(s,r,a){return e(r).encrypt(t,s,r,a)},decrypt:function(s,r,a){return e(r).decrypt(t,s,r,a)}}}}()});r.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var m=s.mode={},u=r.BlockCipherMode=a.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=m.CBC=function(){var e=u.extend();function s(e,s,r){var a,n=this._iv;n?(a=n,this._iv=t):a=this._prevBlock;for(var i=0;i<r;i++)e[s+i]^=a[i]}return e.Encryptor=e.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize;s.call(this,e,t,a),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+a)}}),e.Decryptor=e.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,n=e.slice(t,t+a);r.decryptBlock(e,t),s.call(this,e,t,a),this._prevBlock=n}}),e}(),g=(s.pad={}).Pkcs7={pad:function(e,t){for(var s=4*t,r=s-e.sigBytes%s,a=r<<24|r<<16|r<<8|r,i=[],o=0;o<r;o+=4)i.push(a);var l=n.create(i,r);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};r.BlockCipher=d.extend({cfg:d.cfg.extend({mode:h,padding:g}),reset:function(){var e;d.reset.call(this);var t=this.cfg,s=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,s&&s.words):(this._mode=e.call(r,this,s&&s.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var p=r.CipherParams=a.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),x=(s.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,s=e.salt;return(s?n.create([1398893684,1701076831]).concat(s).concat(t):t).toString(l)},parse:function(e){var t,s=l.parse(e),r=s.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=n.create(r.slice(2,4)),r.splice(0,4),s.sigBytes-=16),p.create({ciphertext:s,salt:t})}},f=r.SerializableCipher=a.extend({cfg:a.extend({format:x}),encrypt:function(e,t,s,r){r=this.cfg.extend(r);var a=e.createEncryptor(s,r),n=a.finalize(t),i=a.cfg;return p.create({ciphertext:n,key:s,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,s,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(s,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(s.kdf={}).OpenSSL={execute:function(e,t,s,r,a){if(r||(r=n.random(8)),a)i=c.create({keySize:t+s,hasher:a}).compute(e,r);else var i=c.create({keySize:t+s}).compute(e,r);var o=n.create(i.words.slice(t),4*s);return i.sigBytes=4*t,p.create({key:i,iv:o,salt:r})}},v=r.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:y}),encrypt:function(e,t,s,r){var a=(r=this.cfg.extend(r)).kdf.execute(s,e.keySize,e.ivSize,r.salt,r.hasher);r.iv=a.iv;var n=f.encrypt.call(this,e,t,a.key,r);return n.mixIn(a),n},decrypt:function(e,t,s,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var a=r.kdf.execute(s,e.keySize,e.ivSize,t.salt,r.hasher);return r.iv=a.iv,f.decrypt.call(this,e,t,a.key,r)}})}()}(bt(),ds())),us.exports}var gs,ps={exports:{}};function xs(){return gs||(gs=1,ps.exports=function(e){return e.mode.CFB=function(){var t=e.lib.BlockCipherMode.extend();function s(e,t,s,r){var a,n=this._iv;n?(a=n.slice(0),this._iv=void 0):a=this._prevBlock,r.encryptBlock(a,0);for(var i=0;i<s;i++)e[t+i]^=a[i]}return t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize;s.call(this,e,t,a,r),this._prevBlock=e.slice(t,t+a)}}),t.Decryptor=t.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,n=e.slice(t,t+a);s.call(this,e,t,a,r),this._prevBlock=n}}),t}(),e.mode.CFB}(bt(),hs())),ps.exports}var fs,ys={exports:{}};function vs(){return fs||(fs=1,ys.exports=function(e){return e.mode.CTR=(t=e.lib.BlockCipherMode.extend(),s=t.Encryptor=t.extend({processBlock:function(e,t){var s=this._cipher,r=s.blockSize,a=this._iv,n=this._counter;a&&(n=this._counter=a.slice(0),this._iv=void 0);var i=n.slice(0);s.encryptBlock(i,0),n[r-1]=n[r-1]+1|0;for(var o=0;o<r;o++)e[t+o]^=i[o]}}),t.Decryptor=s,t),e.mode.CTR;var t,s}(bt(),hs())),ys.exports}var bs,js={exports:{}};function ws(){return bs||(bs=1,js.exports=function(e){
/** @preserve
			 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
			 * derived from CryptoJS.mode.CTR
			 * Jan Hruby jhruby.web@gmail.com
			 */
return e.mode.CTRGladman=function(){var t=e.lib.BlockCipherMode.extend();function s(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,s=e>>8&255,r=255&e;255===t?(t=0,255===s?(s=0,255===r?r=0:++r):++s):++t,e=0,e+=t<<16,e+=s<<8,e+=r}return e}function r(e){return 0===(e[0]=s(e[0]))&&(e[1]=s(e[1])),e}var a=t.Encryptor=t.extend({processBlock:function(e,t){var s=this._cipher,a=s.blockSize,n=this._iv,i=this._counter;n&&(i=this._counter=n.slice(0),this._iv=void 0),r(i);var o=i.slice(0);s.encryptBlock(o,0);for(var l=0;l<a;l++)e[t+l]^=o[l]}});return t.Decryptor=a,t}(),e.mode.CTRGladman}(bt(),hs())),js.exports}var Ns,Cs={exports:{}};function Ss(){return Ns||(Ns=1,Cs.exports=function(e){return e.mode.OFB=(t=e.lib.BlockCipherMode.extend(),s=t.Encryptor=t.extend({processBlock:function(e,t){var s=this._cipher,r=s.blockSize,a=this._iv,n=this._keystream;a&&(n=this._keystream=a.slice(0),this._iv=void 0),s.encryptBlock(n,0);for(var i=0;i<r;i++)e[t+i]^=n[i]}}),t.Decryptor=s,t),e.mode.OFB;var t,s}(bt(),hs())),Cs.exports}var Ds,ks={exports:{}};var Es,As={exports:{}};var _s,Rs={exports:{}};var Fs,Ps={exports:{}};var zs,Is={exports:{}};var Ts,Os={exports:{}};var Ls,Ms={exports:{}};var Bs,Ws={exports:{}};var Hs,Us={exports:{}};function $s(){return Hs||(Hs=1,Us.exports=function(e){return function(){var t=e,s=t.lib,r=s.WordArray,a=s.BlockCipher,n=t.algo,i=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],c=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],m=n.DES=a.extend({_doReset:function(){for(var e=this._key.words,t=[],s=0;s<56;s++){var r=i[s]-1;t[s]=e[r>>>5]>>>31-r%32&1}for(var a=this._subKeys=[],n=0;n<16;n++){var c=a[n]=[],d=l[n];for(s=0;s<24;s++)c[s/6|0]|=t[(o[s]-1+d)%28]<<31-s%6,c[4+(s/6|0)]|=t[28+(o[s+24]-1+d)%28]<<31-s%6;for(c[0]=c[0]<<1|c[0]>>>31,s=1;s<7;s++)c[s]=c[s]>>>4*(s-1)+3;c[7]=c[7]<<5|c[7]>>>27}var m=this._invSubKeys=[];for(s=0;s<16;s++)m[s]=a[15-s]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,s){this._lBlock=e[t],this._rBlock=e[t+1],u.call(this,4,252645135),u.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),u.call(this,1,1431655765);for(var r=0;r<16;r++){for(var a=s[r],n=this._lBlock,i=this._rBlock,o=0,l=0;l<8;l++)o|=c[l][((i^a[l])&d[l])>>>0];this._lBlock=i,this._rBlock=n^o}var m=this._lBlock;this._lBlock=this._rBlock,this._rBlock=m,u.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),u.call(this,16,65535),u.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function u(e,t){var s=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=s,this._lBlock^=s<<e}function h(e,t){var s=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=s,this._rBlock^=s<<e}t.DES=a._createHelper(m);var g=n.TripleDES=a.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),s=e.length<4?e.slice(0,2):e.slice(2,4),a=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=m.createEncryptor(r.create(t)),this._des2=m.createEncryptor(r.create(s)),this._des3=m.createEncryptor(r.create(a))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=a._createHelper(g)}(),e.TripleDES}(bt(),Ft(),Lt(),ds(),hs())),Us.exports}var Gs,Vs={exports:{}};var qs,Ys={exports:{}};var Ks,Xs={exports:{}};var Js,Zs={exports:{}};function Qs(){return Js||(Js=1,Zs.exports=function(e){return function(){var t=e,s=t.lib.BlockCipher,r=t.algo;const a=16,n=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],i=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function l(e,t){let s=t>>24&255,r=t>>16&255,a=t>>8&255,n=255&t,i=e.sbox[0][s]+e.sbox[1][r];return i^=e.sbox[2][a],i+=e.sbox[3][n],i}function c(e,t,s){let r,n=t,i=s;for(let o=0;o<a;++o)n^=e.pbox[o],i=l(e,n)^i,r=n,n=i,i=r;return r=n,n=i,i=r,i^=e.pbox[a],n^=e.pbox[a+1],{left:n,right:i}}function d(e,t,s){let r,n=t,i=s;for(let o=a+1;o>1;--o)n^=e.pbox[o],i=l(e,n)^i,r=n,n=i,i=r;return r=n,n=i,i=r,i^=e.pbox[1],n^=e.pbox[0],{left:n,right:i}}function m(e,t,s){for(let a=0;a<4;a++){e.sbox[a]=[];for(let t=0;t<256;t++)e.sbox[a][t]=i[a][t]}let r=0;for(let i=0;i<a+2;i++)e.pbox[i]=n[i]^t[r],r++,r>=s&&(r=0);let o=0,l=0,d=0;for(let n=0;n<a+2;n+=2)d=c(e,o,l),o=d.left,l=d.right,e.pbox[n]=o,e.pbox[n+1]=l;for(let a=0;a<4;a++)for(let t=0;t<256;t+=2)d=c(e,o,l),o=d.left,l=d.right,e.sbox[a][t]=o,e.sbox[a][t+1]=l;return!0}var u=r.Blowfish=s.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,s=e.sigBytes/4;m(o,t,s)}},encryptBlock:function(e,t){var s=c(o,e[t],e[t+1]);e[t]=s.left,e[t+1]=s.right},decryptBlock:function(e,t){var s=d(o,e[t],e[t+1]);e[t]=s.left,e[t+1]=s.right},blockSize:2,keySize:4,ivSize:2});t.Blowfish=s._createHelper(u)}(),e.Blowfish}(bt(),Ft(),Lt(),ds(),hs())),Zs.exports}var er;var tr=(er||(er=1,xt.exports=function(e){return e}(bt(),Nt(),Dt(),At(),Ft(),It(),Lt(),Wt(),$t(),Gt||(Gt=1,Vt.exports=function(e){return s=(t=e).lib.WordArray,r=t.algo,a=r.SHA256,n=r.SHA224=a.extend({_doReset:function(){this._hash=new s.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),t.SHA224=a._createHelper(n),t.HmacSHA224=a._createHmacHelper(n),e.SHA224;var t,s,r,a,n}(bt(),$t())),Kt(),Xt||(Xt=1,Jt.exports=function(e){return s=(t=e).x64,r=s.Word,a=s.WordArray,n=t.algo,i=n.SHA512,o=n.SHA384=i.extend({_doReset:function(){this._hash=new a.init([new r.init(3418070365,3238371032),new r.init(1654270250,914150663),new r.init(2438529370,812702999),new r.init(355462360,4144912697),new r.init(1731405415,4290775857),new r.init(2394180231,1750603025),new r.init(3675008525,1694076839),new r.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=16,e}}),t.SHA384=i._createHelper(o),t.HmacSHA384=i._createHmacHelper(o),e.SHA384;var t,s,r,a,n,i,o}(bt(),Nt(),Kt())),es(),ts||(ts=1,ss.exports=function(e){
/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/
return function(){var t=e,s=t.lib,r=s.WordArray,a=s.Hasher,n=t.algo,i=r.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=r.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=r.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=r.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=r.create([0,1518500249,1859775393,2400959708,2840853838]),m=r.create([1352829926,1548603684,1836072691,2053994217,0]),u=n.RIPEMD160=a.extend({_doReset:function(){this._hash=r.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var s=0;s<16;s++){var r=t+s,a=e[r];e[r]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var n,u,v,b,j,w,N,C,S,D,k,E=this._hash.words,A=d.words,_=m.words,R=i.words,F=o.words,P=l.words,z=c.words;for(w=n=E[0],N=u=E[1],C=v=E[2],S=b=E[3],D=j=E[4],s=0;s<80;s+=1)k=n+e[t+R[s]]|0,k+=s<16?h(u,v,b)+A[0]:s<32?g(u,v,b)+A[1]:s<48?p(u,v,b)+A[2]:s<64?x(u,v,b)+A[3]:f(u,v,b)+A[4],k=(k=y(k|=0,P[s]))+j|0,n=j,j=b,b=y(v,10),v=u,u=k,k=w+e[t+F[s]]|0,k+=s<16?f(N,C,S)+_[0]:s<32?x(N,C,S)+_[1]:s<48?p(N,C,S)+_[2]:s<64?g(N,C,S)+_[3]:h(N,C,S)+_[4],k=(k=y(k|=0,z[s]))+D|0,w=D,D=S,S=y(C,10),C=N,N=k;k=E[1]+v+S|0,E[1]=E[2]+b+D|0,E[2]=E[3]+j+w|0,E[3]=E[4]+n+N|0,E[4]=E[0]+u+C|0,E[0]=k},_doFinalize:function(){var e=this._data,t=e.words,s=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(t.length+1),this._process();for(var a=this._hash,n=a.words,i=0;i<5;i++){var o=n[i];n[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return a},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,s){return e^t^s}function g(e,t,s){return e&t|~e&s}function p(e,t,s){return(e|~t)^s}function x(e,t,s){return e&s|t&~s}function f(e,t,s){return e^(t|~s)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=a._createHelper(u),t.HmacRIPEMD160=a._createHmacHelper(u)}(),e.RIPEMD160}(bt())),ns(),is||(is=1,os.exports=function(e){return r=(s=(t=e).lib).Base,a=s.WordArray,i=(n=t.algo).SHA256,o=n.HMAC,l=n.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:i,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var s=this.cfg,r=o.create(s.hasher,e),n=a.create(),i=a.create([1]),l=n.words,c=i.words,d=s.keySize,m=s.iterations;l.length<d;){var u=r.update(t).finalize(i);r.reset();for(var h=u.words,g=h.length,p=u,x=1;x<m;x++){p=r.finalize(p),r.reset();for(var f=p.words,y=0;y<g;y++)h[y]^=f[y]}n.concat(u),c[0]++}return n.sigBytes=4*d,n}}),t.PBKDF2=function(e,t,s){return l.create(s).compute(e,t)},e.PBKDF2;var t,s,r,a,n,i,o,l}(bt(),$t(),ns())),ds(),hs(),xs(),vs(),ws(),Ss(),Ds||(Ds=1,ks.exports=function(e){return e.mode.ECB=((t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t),e.mode.ECB;var t}(bt(),hs())),Es||(Es=1,As.exports=function(e){return e.pad.AnsiX923={pad:function(e,t){var s=e.sigBytes,r=4*t,a=r-s%r,n=s+a-1;e.clamp(),e.words[n>>>2]|=a<<24-n%4*8,e.sigBytes+=a},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923}(bt(),hs())),_s||(_s=1,Rs.exports=function(e){return e.pad.Iso10126={pad:function(t,s){var r=4*s,a=r-t.sigBytes%r;t.concat(e.lib.WordArray.random(a-1)).concat(e.lib.WordArray.create([a<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126}(bt(),hs())),Fs||(Fs=1,Ps.exports=function(e){return e.pad.Iso97971={pad:function(t,s){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,s)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971}(bt(),hs())),zs||(zs=1,Is.exports=function(e){return e.pad.ZeroPadding={pad:function(e,t){var s=4*t;e.clamp(),e.sigBytes+=s-(e.sigBytes%s||s)},unpad:function(e){var t=e.words,s=e.sigBytes-1;for(s=e.sigBytes-1;s>=0;s--)if(t[s>>>2]>>>24-s%4*8&255){e.sigBytes=s+1;break}}},e.pad.ZeroPadding}(bt(),hs())),Ts||(Ts=1,Os.exports=function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding}(bt(),hs())),Ls||(Ls=1,Ms.exports=function(e){return s=(t=e).lib.CipherParams,r=t.enc.Hex,t.format.Hex={stringify:function(e){return e.ciphertext.toString(r)},parse:function(e){var t=r.parse(e);return s.create({ciphertext:t})}},e.format.Hex;var t,s,r}(bt(),hs())),Bs||(Bs=1,Ws.exports=function(e){return function(){var t=e,s=t.lib.BlockCipher,r=t.algo,a=[],n=[],i=[],o=[],l=[],c=[],d=[],m=[],u=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var s=0,r=0;for(t=0;t<256;t++){var g=r^r<<1^r<<2^r<<3^r<<4;g=g>>>8^255&g^99,a[s]=g,n[g]=s;var p=e[s],x=e[p],f=e[x],y=257*e[g]^16843008*g;i[s]=y<<24|y>>>8,o[s]=y<<16|y>>>16,l[s]=y<<8|y>>>24,c[s]=y,y=16843009*f^65537*x^257*p^16843008*s,d[g]=y<<24|y>>>8,m[g]=y<<16|y>>>16,u[g]=y<<8|y>>>24,h[g]=y,s?(s=p^e[e[e[f^p]]],r^=e[e[r]]):s=r=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],p=r.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,s=e.sigBytes/4,r=4*((this._nRounds=s+6)+1),n=this._keySchedule=[],i=0;i<r;i++)i<s?n[i]=t[i]:(c=n[i-1],i%s?s>6&&i%s==4&&(c=a[c>>>24]<<24|a[c>>>16&255]<<16|a[c>>>8&255]<<8|a[255&c]):(c=a[(c=c<<8|c>>>24)>>>24]<<24|a[c>>>16&255]<<16|a[c>>>8&255]<<8|a[255&c],c^=g[i/s|0]<<24),n[i]=n[i-s]^c);for(var o=this._invKeySchedule=[],l=0;l<r;l++){if(i=r-l,l%4)var c=n[i];else c=n[i-4];o[l]=l<4||i<=4?c:d[a[c>>>24]]^m[a[c>>>16&255]]^u[a[c>>>8&255]]^h[a[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,o,l,c,a)},decryptBlock:function(e,t){var s=e[t+1];e[t+1]=e[t+3],e[t+3]=s,this._doCryptBlock(e,t,this._invKeySchedule,d,m,u,h,n),s=e[t+1],e[t+1]=e[t+3],e[t+3]=s},_doCryptBlock:function(e,t,s,r,a,n,i,o){for(var l=this._nRounds,c=e[t]^s[0],d=e[t+1]^s[1],m=e[t+2]^s[2],u=e[t+3]^s[3],h=4,g=1;g<l;g++){var p=r[c>>>24]^a[d>>>16&255]^n[m>>>8&255]^i[255&u]^s[h++],x=r[d>>>24]^a[m>>>16&255]^n[u>>>8&255]^i[255&c]^s[h++],f=r[m>>>24]^a[u>>>16&255]^n[c>>>8&255]^i[255&d]^s[h++],y=r[u>>>24]^a[c>>>16&255]^n[d>>>8&255]^i[255&m]^s[h++];c=p,d=x,m=f,u=y}p=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[m>>>8&255]<<8|o[255&u])^s[h++],x=(o[d>>>24]<<24|o[m>>>16&255]<<16|o[u>>>8&255]<<8|o[255&c])^s[h++],f=(o[m>>>24]<<24|o[u>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^s[h++],y=(o[u>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&m])^s[h++],e[t]=p,e[t+1]=x,e[t+2]=f,e[t+3]=y},keySize:8});t.AES=s._createHelper(p)}(),e.AES}(bt(),Ft(),Lt(),ds(),hs())),$s(),Gs||(Gs=1,Vs.exports=function(e){return function(){var t=e,s=t.lib.StreamCipher,r=t.algo,a=r.RC4=s.extend({_doReset:function(){for(var e=this._key,t=e.words,s=e.sigBytes,r=this._S=[],a=0;a<256;a++)r[a]=a;a=0;for(var n=0;a<256;a++){var i=a%s,o=t[i>>>2]>>>24-i%4*8&255;n=(n+r[a]+o)%256;var l=r[a];r[a]=r[n],r[n]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=n.call(this)},keySize:8,ivSize:0});function n(){for(var e=this._S,t=this._i,s=this._j,r=0,a=0;a<4;a++){s=(s+e[t=(t+1)%256])%256;var n=e[t];e[t]=e[s],e[s]=n,r|=e[(e[t]+e[s])%256]<<24-8*a}return this._i=t,this._j=s,r}t.RC4=s._createHelper(a);var i=r.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)n.call(this)}});t.RC4Drop=s._createHelper(i)}(),e.RC4}(bt(),Ft(),Lt(),ds(),hs())),qs||(qs=1,Ys.exports=function(e){return function(){var t=e,s=t.lib.StreamCipher,r=t.algo,a=[],n=[],i=[],o=r.Rabbit=s.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,s=0;s<4;s++)e[s]=16711935&(e[s]<<8|e[s]>>>24)|4278255360&(e[s]<<24|e[s]>>>8);var r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,s=0;s<4;s++)l.call(this);for(s=0;s<8;s++)a[s]^=r[s+4&7];if(t){var n=t.words,i=n[0],o=n[1],c=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),m=c>>>16|4294901760&d,u=d<<16|65535&c;for(a[0]^=c,a[1]^=m,a[2]^=d,a[3]^=u,a[4]^=c,a[5]^=m,a[6]^=d,a[7]^=u,s=0;s<4;s++)l.call(this)}},_doProcessBlock:function(e,t){var s=this._X;l.call(this),a[0]=s[0]^s[5]>>>16^s[3]<<16,a[1]=s[2]^s[7]>>>16^s[5]<<16,a[2]=s[4]^s[1]>>>16^s[7]<<16,a[3]=s[6]^s[3]>>>16^s[1]<<16;for(var r=0;r<4;r++)a[r]=16711935&(a[r]<<8|a[r]>>>24)|4278255360&(a[r]<<24|a[r]>>>8),e[t+r]^=a[r]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,s=0;s<8;s++)n[s]=t[s];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<n[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<n[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<n[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<n[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<n[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<n[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<n[6]>>>0?1:0)|0,this._b=t[7]>>>0<n[7]>>>0?1:0,s=0;s<8;s++){var r=e[s]+t[s],a=65535&r,o=r>>>16,l=((a*a>>>17)+a*o>>>15)+o*o,c=((4294901760&r)*r|0)+((65535&r)*r|0);i[s]=l^c}e[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,e[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,e[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,e[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,e[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,e[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,e[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,e[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}t.Rabbit=s._createHelper(o)}(),e.Rabbit}(bt(),Ft(),Lt(),ds(),hs())),Ks||(Ks=1,Xs.exports=function(e){return function(){var t=e,s=t.lib.StreamCipher,r=t.algo,a=[],n=[],i=[],o=r.RabbitLegacy=s.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,s=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var a=0;a<4;a++)l.call(this);for(a=0;a<8;a++)r[a]^=s[a+4&7];if(t){var n=t.words,i=n[0],o=n[1],c=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),m=c>>>16|4294901760&d,u=d<<16|65535&c;for(r[0]^=c,r[1]^=m,r[2]^=d,r[3]^=u,r[4]^=c,r[5]^=m,r[6]^=d,r[7]^=u,a=0;a<4;a++)l.call(this)}},_doProcessBlock:function(e,t){var s=this._X;l.call(this),a[0]=s[0]^s[5]>>>16^s[3]<<16,a[1]=s[2]^s[7]>>>16^s[5]<<16,a[2]=s[4]^s[1]>>>16^s[7]<<16,a[3]=s[6]^s[3]>>>16^s[1]<<16;for(var r=0;r<4;r++)a[r]=16711935&(a[r]<<8|a[r]>>>24)|4278255360&(a[r]<<24|a[r]>>>8),e[t+r]^=a[r]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,s=0;s<8;s++)n[s]=t[s];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<n[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<n[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<n[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<n[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<n[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<n[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<n[6]>>>0?1:0)|0,this._b=t[7]>>>0<n[7]>>>0?1:0,s=0;s<8;s++){var r=e[s]+t[s],a=65535&r,o=r>>>16,l=((a*a>>>17)+a*o>>>15)+o*o,c=((4294901760&r)*r|0)+((65535&r)*r|0);i[s]=l^c}e[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,e[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,e[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,e[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,e[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,e[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,e[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,e[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}t.RabbitLegacy=s._createHelper(o)}(),e.RabbitLegacy}(bt(),Ft(),Lt(),ds(),hs())),Qs())),xt.exports);const sr=C(tr);class rr{static{this.ALGORITHM="AES"}static{this.ENCRYPTION_KEY="your-super-secret-key-here-32-chars"}static encrypt(e){if(!e)throw new Error("Cannot encrypt empty string");const t=sr.lib.WordArray.random(16);return{encrypted:sr.AES.encrypt(e,this.ENCRYPTION_KEY,{iv:t,mode:sr.mode.CBC,padding:sr.pad.Pkcs7}).toString(),iv:t.toString(),algorithm:this.ALGORITHM}}static decrypt(e){if(!e||!e.encrypted)throw new Error("Invalid encrypted field");try{const t=sr.AES.decrypt(e.encrypted,this.ENCRYPTION_KEY,{iv:sr.enc.Hex.parse(e.iv),mode:sr.mode.CBC,padding:sr.pad.Pkcs7}).toString(sr.enc.Utf8);if(!t)throw new Error("Decryption failed - invalid key or corrupted data");return t}catch(t){throw new Error("Failed to decrypt data: "+t.message)}}static maskAccountNumber(e){if(!e||e.length<4)return"****";const t=e.slice(-4);return"*".repeat(Math.max(0,e.length-4))+t}static maskBranchCode(e){if(!e||e.length<2)return"***";const t=e.slice(-2);return"*".repeat(Math.max(0,e.length-2))+t}static isEncrypted(e){return"object"==typeof e&&null!==e&&"string"==typeof e.encrypted&&"string"==typeof e.iv&&"AES"===e.algorithm}static encryptBankingDetails(e){return{accountHolder:e.accountHolder,bank:e.bank,accountNumber:e.accountNumber?this.encrypt(e.accountNumber):"",branchCode:e.branchCode?this.encrypt(e.branchCode):""}}static decryptBankingDetails(e){return{accountHolder:e.accountHolder||"",bank:e.bank||"",accountNumber:e.accountNumber&&this.isEncrypted(e.accountNumber)?this.decrypt(e.accountNumber):e.accountNumber||"",branchCode:e.branchCode&&this.isEncrypted(e.branchCode)?this.decrypt(e.branchCode):e.branchCode||""}}static getMaskedBankingDetails(e){const t=this.decryptBankingDetails(e);return{accountHolder:t.accountHolder,bank:t.bank,accountNumber:this.maskAccountNumber(t.accountNumber),branchCode:this.maskBranchCode(t.branchCode)}}}rr.encrypt,rr.decrypt,rr.maskAccountNumber,rr.maskBranchCode;class ar{static async logAccess(t){const s=i.currentUser;if(s)try{const e=`${t.action}_${t.dataType}_${Date.now()}`,r={id:e,userId:s.uid,userEmail:s.email||"unknown",userAgent:navigator.userAgent,timestamp:R(),...t};try{const e=await fetch("https://api.ipify.org?format=json"),t=await e.json();r.ipAddress=t.ip}catch{r.ipAddress="unknown"}await F(P(a,"piiAccessLogs",e),r),t.action,t.dataType,s.email}catch(r){}else e.warn("Attempted to log PII access without authenticated user")}static async logBankingAccess(e,t,s){await this.logAccess({action:t,dataType:"banking",resellerId:e,fieldAccessed:"bankDetails",reason:s||"Business operations"})}static async logPersonalInfoAccess(e,t,s,r){await this.logAccess({action:t,dataType:"personal",targetUserId:e,fieldAccessed:s,reason:r||"User management"})}static async logSessionAccess(e,t,s){await this.logAccess({action:t,dataType:"session",targetUserId:e,fieldAccessed:"sessionData",reason:s||"Session management"})}static async logDataExport(e,t="Data export requested"){await this.logAccess({action:"export",dataType:e,reason:t})}}ar.logBankingAccess,ar.logPersonalInfoAccess,ar.logSessionAccess,ar.logDataExport;const nr={starter:{id:"starter",name:"Starter",price:29900,currency:"ZAR",employeeLimit:10,features:["Up to 10 employees","Basic warning management","PDF document generation","Email notifications","Basic reporting"]},professional:{id:"professional",name:"Professional",price:49900,currency:"ZAR",employeeLimit:50,features:["Up to 50 employees","Advanced warning workflows","Custom warning categories","WhatsApp notifications","Advanced reporting","Counselling management"]},enterprise:{id:"enterprise",name:"Enterprise",price:79900,currency:"ZAR",employeeLimit:200,features:["Up to 200 employees","Full HR disciplinary suite","Custom document templates","API access","Priority support","Advanced analytics"]},"enterprise-plus":{id:"enterprise-plus",name:"Enterprise Plus",price:129900,currency:"ZAR",employeeLimit:999999,features:["Unlimited employees","White-label branding","Multi-location support","Dedicated account manager","Custom integrations","On-site training"]}},ir={"western-cape":{name:"Western Cape"},gauteng:{name:"Gauteng"},"kwazulu-natal":{name:"KwaZulu-Natal"},"eastern-cape":{name:"Eastern Cape"},"free-state":{name:"Free State"},limpopo:{name:"Limpopo"},mpumalanga:{name:"Mpumalanga"},"northern-cape":{name:"Northern Cape"},"north-west":{name:"North West"}},or=()=>{const[t,a]=j.useState([]),[n,i]=j.useState(!0),[l,c]=j.useState(!1),[d,m]=j.useState(null),[u,h]=j.useState("all"),[g,p]=j.useState({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}});j.useEffect(()=>{x()},[]);const x=async()=>{try{i(!0);const t=await r.getAllResellers(),s=await Promise.all(t.map(async e=>{const t=await pt.getResellerMetrics(e.id);return{...e,metrics:t}}));a(s),e.success(`Loaded ${s.length} resellers`)}catch(t){e.error("Failed to load resellers:",t)}finally{i(!1)}},f=()=>{c(!1),m(null),p({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}})},y=()=>"all"===u?t:t.filter(e=>e.province===u),v=e=>`R${(e/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`;return n?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading reseller network..."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reseller Network"}),s.jsx("p",{className:"text-gray-600",children:"Manage your provincial sales network"})]}),s.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[s.jsx(J,{className:"w-4 h-4"}),"Add Reseller"]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Province:"}),s.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[s.jsx("option",{value:"all",children:"All Provinces"}),Object.entries(ir).map(([e,t])=>s.jsx("option",{value:e,children:t.name},e))]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries((()=>{const e={};for(const s of t){const t=s.province;e[t]||(e[t]={resellers:0,clients:0,revenue:0}),e[t].resellers++,e[t].clients+=s.metrics.totalClients,e[t].revenue+=s.metrics.monthlyRecurringRevenue}return e})()).sort(([,e],[,t])=>t.revenue-e.revenue).slice(0,5).map(([e,t])=>s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(Z,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"font-medium text-sm",children:ir[e]?.name})]}),s.jsxs("div",{className:"space-y-1 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Resellers:"}),s.jsx("span",{className:"font-semibold",children:t.resellers})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Clients:"}),s.jsx("span",{className:"font-semibold",children:t.clients})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Revenue:"}),s.jsx("span",{className:"font-semibold",children:v(t.revenue)})]})]})]},e))}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:s.jsxs("h3",{className:"text-lg font-semibold",children:["Resellers (",y().length,")"]})}),s.jsxs("div",{className:"overflow-x-auto",children:[s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reseller"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Province"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clients"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monthly Revenue"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission Rate"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:y().map(t=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-gray-900",children:[t.firstName," ",t.lastName]}),s.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Q,{className:"w-3 h-3"}),t.email]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ee,{className:"w-3 h-3"}),t.phone]})]})]})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Z,{className:"w-4 h-4 text-gray-400"}),s.jsx("span",{className:"text-sm font-medium",children:ir[t.province]?.name})]}),t.territory.length>0&&s.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.territory.join(", ")})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(te,{className:"w-4 h-4 text-blue-500"}),s.jsx("span",{className:"font-semibold",children:t.metrics.totalClients})]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Avg: ",v(t.metrics.averageClientValue)]})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(se,{className:"w-4 h-4 text-green-500"}),s.jsx("span",{className:"font-semibold",children:v(t.metrics.monthlyRecurringRevenue)})]}),s.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[s.jsx(re,{className:"w-3 h-3"}),"+",t.metrics.monthlyGrowth,"%"]})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsxs("span",{className:"text-sm font-semibold",children:[(100*t.commissionRate).toFixed(0),"%"]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Earned: ",v(t.metrics.totalCommissions)]})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("button",{onClick:()=>(async t=>{try{await r.updateReseller(t.id,{isActive:!t.isActive,updatedAt:o.getServerTimestamp()}),e.success("Reseller "+(t.isActive?"deactivated":"activated")),await x()}catch(s){e.error("Failed to toggle reseller status:",s)}})(t),className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium "+(t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.isActive?s.jsxs(s.Fragment,{children:[s.jsx(ae,{className:"w-3 h-3"}),"Active"]}):s.jsxs(s.Fragment,{children:[s.jsx(ne,{className:"w-3 h-3"}),"Inactive"]})})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:s.jsx("button",{onClick:()=>(async t=>{try{try{await ar.logBankingAccess(t.id,"view","Editing reseller details")}catch(s){}const e=rr.decryptBankingDetails(t.bankDetails);t.firstName,t.lastName,t.commissionRate,t.commissionRate,m(t),p({firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,province:t.province,territory:t.territory,commissionRate:t.commissionRate,bankDetails:e}),c(!0)}catch(r){e.error("Failed to decrypt banking details:",r),alert("Error loading banking details. Please contact support.")}})(t),className:"text-blue-600 hover:text-blue-800 mr-3",children:s.jsx(ie,{className:"w-4 h-4"})})})]},t.id))})]}),0===y().length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(J,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-600",children:"No resellers found"}),s.jsx("p",{className:"text-sm text-gray-500",children:"all"!==u?`No resellers in ${ir[u]?.name}`:"Add your first reseller to start building your network"})]})]})]}),l&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-auto",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-lg font-semibold",children:d?"Edit Reseller":"Add New Reseller"}),s.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-600",children:s.jsx(X,{className:"w-5 h-5"})})]}),!d&&s.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("p",{className:"text-sm text-blue-700",children:[s.jsx("strong",{children:"ℹ️ Account Creation:"})," A user account will be created with email login and password ",s.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"temp123"}),". The reseller should change this on first login."]})})]}),s.jsxs("form",{onSubmit:d?async t=>{if(t.preventDefault(),d)try{d.id;try{await ar.logBankingAccess(d.id,"edit","Updating reseller banking details")}catch(s){}const t=rr.encryptBankingDetails(g.bankDetails);await r.updateReseller(d.id,{firstName:g.firstName,lastName:g.lastName,email:g.email,phone:g.phone,province:g.province,territory:g.territory,commissionRate:g.commissionRate,bankDetails:t,updatedAt:o.getServerTimestamp()}),e.success("Reseller updated successfully"),m(null),await x()}catch(a){e.error("Failed to update reseller:",a)}}:async t=>{t.preventDefault();try{try{await ar.logBankingAccess("new-reseller","edit","Creating new reseller account")}catch(s){}const t=rr.encryptBankingDetails(g.bankDetails),n={firstName:g.firstName,lastName:g.lastName,email:g.email,phone:g.phone,province:g.province,territory:g.territory,commissionRate:g.commissionRate,isActive:!0,bankDetails:t,clientIds:[],totalClientsAcquired:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0},i=await r.createReseller(n);try{const{httpsCallable:t}=await _(async()=>{const{httpsCallable:e}=await import("./firebase-vendor-BIBOIkWK.js").then(e=>e.Z);return{httpsCallable:e}},[]),{functions:s}=await _(async()=>{const{functions:e}=await import("./business-owner-dashboard-Dq6MrEKt.js").then(e=>e.B);return{functions:e}},__vite__mapDeps([0,1,2,3,4])),r=t(s,"createResellerUser");await r({email:g.email,password:"temp123",displayName:`${g.firstName} ${g.lastName}`,resellerId:i,firstName:g.firstName,lastName:g.lastName}),e.success("Reseller user account created via Cloud Function")}catch(a){e.warn("Cloud Function not available, using fallback method:",a),e.error("Cannot create user account automatically due to CORS restriction"),alert(`\nRESELLER CREATED SUCCESSFULLY!\n\nHowever, the user account creation failed due to browser security restrictions.\n\nPlease create the Firebase Auth account manually:\n1. Go to Firebase Console > Authentication > Users  \n2. Add user: ${g.email}\n3. Password: temp123\n4. Display name: ${g.firstName} ${g.lastName}\n\nOr the reseller can register at the login page with their email and the password 'temp123'.\n\nThe reseller profile has been saved successfully with ID: ${i}\n        `.trim()),e.warn("Manual user account creation required for:",g.email)}e.success("Reseller and user account created successfully:",{resellerId:i,email:g.email}),p({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}}),c(!1),setTimeout(async()=>{try{await x()}catch(t){e.warn("Could not reload resellers automatically, refresh page manually")}},2e3)}catch(n){e.error("Failed to add reseller:",n)}},className:"p-6 space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),s.jsx("input",{type:"text",value:g.firstName,onChange:e=>p(t=>({...t,firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),s.jsx("input",{type:"text",value:g.lastName,onChange:e=>p(t=>({...t,lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),s.jsx("input",{type:"email",value:g.email,onChange:e=>p(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),s.jsx("input",{type:"tel",value:g.phone,onChange:e=>p(t=>({...t,phone:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),s.jsx("select",{value:g.province,onChange:e=>p(t=>({...t,province:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(ir).map(([e,t])=>s.jsx("option",{value:e,children:t.name},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commission Rate"}),s.jsxs("select",{value:g.commissionRate.toFixed(2),onChange:e=>p(t=>({...t,commissionRate:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"0.50",children:"50% (Standard)"}),s.jsx("option",{value:"0.45",children:"45%"}),s.jsx("option",{value:"0.40",children:"40%"}),s.jsx("option",{value:"0.35",children:"35%"})]})]})]}),s.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"text-md font-semibold",children:"Banking Details"}),s.jsx("span",{className:"text-xs text-gray-500 italic",children:"(Optional - can be added later)"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Holder"}),s.jsx("input",{type:"text",value:g.bankDetails.accountHolder,onChange:e=>p(t=>({...t,bankDetails:{...t.bankDetails,accountHolder:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank"}),s.jsxs("select",{value:g.bankDetails.bank,onChange:e=>p(t=>({...t,bankDetails:{...t.bankDetails,bank:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"Select bank"}),s.jsx("option",{value:"ABSA",children:"ABSA"}),s.jsx("option",{value:"Standard Bank",children:"Standard Bank"}),s.jsx("option",{value:"FirstNational Bank",children:"FirstNational Bank"}),s.jsx("option",{value:"Nedbank",children:"Nedbank"}),s.jsx("option",{value:"Capitec",children:"Capitec"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number"}),s.jsx("input",{type:"text",value:g.bankDetails.accountNumber,onChange:e=>p(t=>({...t,bankDetails:{...t.bankDetails,accountNumber:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Code"}),s.jsx("input",{type:"text",value:g.bankDetails.branchCode,onChange:e=>p(t=>({...t,bankDetails:{...t.bankDetails,branchCode:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-gray-200",children:[s.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),s.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:d?"Update Reseller":"Add Reseller"})]})]})]})})]})},lr=Object.freeze(Object.defineProperty({__proto__:null,ResellerManagement:or},Symbol.toStringTag,{value:"Module"}));class cr{static async getAuthToken(){const e=i.currentUser;if(!e)throw new Error("User not authenticated");return await e.getIdToken(!0)}static async makeAuthenticatedRequest(t,s={}){try{const e=await this.getAuthToken(),r=await fetch(`https://us-central1-hr-disciplinary-system.cloudfunctions.net/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({data:s}),credentials:"include"});if(!r.ok){const e=await r.json();throw new Error(e.error?.message||`HTTP ${r.status}: ${r.statusText}`)}return(await r.json()).data}catch(r){throw e.error(`❌ Request to ${t} failed:`,r),r}}static async triggerManualCleanup(){try{const t=await this.makeAuthenticatedRequest("manualAudioCleanup");return e.success(2143),t}catch(t){if(e.error("❌ Manual cleanup failed:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Audio cleanup is restricted to super-users only");throw new Error(`Manual cleanup failed: ${t.message}`)}}static async getCleanupStats(){try{const t=await this.makeAuthenticatedRequest("getCleanupStats");return e.success(3047),t}catch(t){if(e.error("❌ Failed to fetch cleanup stats:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Cleanup statistics are restricted to super-users only");throw new Error(`Failed to fetch stats: ${t.message}`)}}static async getGlobalAudioStats(){try{const t=await this.makeAuthenticatedRequest("getGlobalAudioStats");return e.success(4130),t}catch(t){if(e.error("❌ Failed to fetch global audio stats:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Global audio statistics are restricted to super-users only");throw new Error(`Failed to fetch global stats: ${t.message}`)}}static async previewCleanup(){try{const t=await this.makeAuthenticatedRequest("previewAudioCleanup");return e.success(5312),t}catch(t){if(e.error("❌ Failed to preview cleanup:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Cleanup preview is restricted to super-users only");throw new Error(`Failed to preview cleanup: ${t.message}`)}}static async requestAudioDeletion(t){try{return t.warningId,t.reason,e.success(6517),!0}catch(s){throw e.error("❌ Audio deletion request failed:",s),new Error(`Deletion request failed: ${s.message}`)}}static formatCleanupSummary(e){if(!e.length)return{totalDeletions:0,averageProcessingTime:0,successRate:0,lastCleanupDate:null,recentErrors:[],totalOrganizationsProcessed:0,scheduledRuns:0,manualRuns:0};const t=e.reduce((e,t)=>e+t.result.successfulDeletions,0),s=e.reduce((e,t)=>e+t.result.processingTime,0)/e.length,r=e.reduce((e,t)=>e+t.result.successfulDeletions+t.result.failedDeletions,0),a=r>0?t/r*100:100,n=e[0]?.timestamp?new Date(e[0].timestamp).toLocaleDateString():null,i=e.flatMap(e=>e.result.errors).slice(0,5),o=e.reduce((e,t)=>e+t.result.organizationsProcessed.length,0),l=e.filter(e=>"scheduled"===e.result.triggerMethod).length,c=e.filter(e=>"manual"===e.result.triggerMethod).length;return{totalDeletions:t,averageProcessingTime:Math.round(s),successRate:Math.round(100*a)/100,lastCleanupDate:n,recentErrors:i,totalOrganizationsProcessed:o,scheduledRuns:l,manualRuns:c}}static async isCleanupHealthy(){try{const s=await this.getCleanupStats(),r=[],a=s.lastCleanup?new Date(s.lastCleanup):null,n=a?Math.floor((Date.now()-a.getTime())/864e5):999;if(n>2&&r.push(`Cleanup hasn't run for ${n} days`),s.recentAudits.length>0){const e=s.recentAudits[0],t=e.result.failedDeletions/(e.result.successfulDeletions+e.result.failedDeletions);t>.1&&r.push(`High error rate: ${Math.round(100*t)}% failures`)}try{const e=await this.previewCleanup();e.preview.totalExpired>50&&r.push(`${e.preview.totalExpired} expired audio files awaiting cleanup`)}catch(t){e.warn("Could not check for expired files:",t)}return{healthy:0===r.length,issues:r,lastCleanup:a,daysSinceLastCleanup:n,requiresAttention:r.length>0}}catch(t){return t.message.includes("Access denied")?{healthy:!1,issues:["Access denied: Super-user privileges required"],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}:{healthy:!1,issues:[`Failed to check cleanup health: ${t.message}`],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}}}static getCleanupScheduleInfo(){const e=new Date,t=new Date(e);return t.setUTCHours(2,0,0,0),e.getUTCHours()>=2&&t.setUTCDate(t.getUTCDate()+1),{frequency:"Daily",nextRun:t.toLocaleString(),timezone:"UTC",description:"Automatically deletes expired audio recordings across all organizations",scope:"Global (All Organizations)"}}static async verifySuperUserAccess(){try{return await this.getCleanupStats(),!0}catch(e){return!e.message.includes("Access denied")}}static async withRetry(e,t=2,s=1e3){let r;for(let n=0;n<=t;n++)try{return await e()}catch(a){if(r=a,a.message.includes("Access denied")||a.message.includes("UNAUTHENTICATED")||a.message.includes("PERMISSION_DENIED"))throw a;if(n===t)break;await new Promise(e=>setTimeout(e,s)),s*=1.5}throw r}static async getFullDashboardData(){try{const[e,t,s,r]=await Promise.allSettled([this.withRetry(()=>this.getCleanupStats()),this.withRetry(()=>this.getGlobalAudioStats()),this.withRetry(()=>this.previewCleanup()),this.withRetry(()=>this.isCleanupHealthy())]),a=this.getCleanupScheduleInfo();return{stats:"fulfilled"===e.status?e.value:{error:e.reason?.message},globalStats:"fulfilled"===t.status?t.value:{error:t.reason?.message},preview:"fulfilled"===s.status?s.value:{error:s.reason?.message},health:"fulfilled"===r.status?r.value:{error:r.reason?.message},schedule:a}}catch(t){throw e.error("❌ Failed to load dashboard data:",t),t}}}const dr=()=>{const[t,r]=j.useState(null),[a,n]=j.useState(null),[i,o]=j.useState(!0),[l,c]=j.useState(!1),[d,m]=j.useState(null);j.useEffect(()=>{u()},[]);const u=async()=>{try{o(!0),m(null);const[e,t]=await Promise.all([cr.getCleanupStats(),cr.isCleanupHealthy()]);r(e),n(t)}catch(t){m(t.message),e.error("Failed to load cleanup dashboard:",t)}finally{o(!1)}};if(i)return s.jsxs("div",{className:"flex items-center justify-center p-8",children:[s.jsx(oe,{className:"w-6 h-6 animate-spin text-blue-600"}),s.jsx("span",{className:"ml-2 text-gray-600",children:"Loading cleanup data..."})]});const h=t?cr.formatCleanupSummary(t.recentAudits):null,g=cr.getCleanupScheduleInfo();return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Audio Cleanup Management"}),s.jsx("p",{className:"text-gray-600",children:"Monitor and manage automated audio file deletion"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:u,disabled:i,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[s.jsx(oe,{className:"w-4 h-4 "+(i?"animate-spin":"")}),"Refresh"]}),s.jsxs("button",{onClick:async()=>{try{c(!0),m(null);const e=await cr.triggerManualCleanup();await u(),alert(`✅ Manual cleanup completed!\n\nDeleted: ${e.result.successfulDeletions} files\nScanned: ${e.result.totalScanned} warnings`)}catch(t){m(t.message),e.error("Manual cleanup failed:",t)}finally{c(!1)}},disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:[s.jsx(le,{className:"w-4 h-4 "+(l?"animate-spin":"")}),l?"Running...":"Run Manual Cleanup"]})]})]}),d&&s.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[s.jsx(ce,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-red-700",children:d})]}),a&&s.jsxs("div",{className:"p-4 rounded-lg border "+(a.healthy?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.healthy?s.jsx(ae,{className:"w-5 h-5 text-green-600"}):s.jsx(ce,{className:"w-5 h-5 text-yellow-600"}),s.jsxs("h3",{className:"font-semibold "+(a.healthy?"text-green-900":"text-yellow-900"),children:["Cleanup System ",a.healthy?"Healthy":"Needs Attention"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Last Cleanup:"}),s.jsx("p",{className:"font-medium",children:a.lastCleanup?a.lastCleanup.toLocaleString():"Never"})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Days Since Last Run:"}),s.jsx("p",{className:"font-medium",children:a.daysSinceLastCleanup})]})]}),a.issues.length>0&&s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"text-sm font-medium text-yellow-900 mb-1",children:"Issues:"}),s.jsx("ul",{className:"text-sm text-yellow-800 space-y-1",children:a.issues.map((e,t)=>s.jsxs("li",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"w-1 h-1 bg-yellow-600 rounded-full"}),e]},t))})]})]}),h&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(de,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Deletions"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.totalDeletions.toLocaleString()})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(ae,{className:"w-6 h-6 text-green-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Success Rate"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.successRate,"%"]})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:s.jsx(me,{className:"w-6 h-6 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Avg Processing"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.averageProcessingTime,"ms"]})]})]})}),s.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:s.jsx(ue,{className:"w-6 h-6 text-orange-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Last Cleanup"}),s.jsx("p",{className:"text-lg font-bold text-gray-900",children:h.lastCleanupDate||"Never"})]})]})})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(he,{className:"w-5 h-5"}),"Cleanup Schedule"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Frequency:"}),s.jsx("p",{className:"font-medium",children:g.frequency})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Next Run:"}),s.jsx("p",{className:"font-medium",children:g.nextRun})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-gray-600",children:"Timezone:"}),s.jsx("p",{className:"font-medium",children:g.timezone})]})]}),s.jsx("p",{className:"text-gray-600 mt-3 text-sm",children:g.description})]}),t&&t.recentAudits.length>0&&s.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[s.jsx("div",{className:"p-6 border-b border-gray-200",children:s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[s.jsx(ge,{className:"w-5 h-5"}),"Recent Cleanup Logs"]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Date"}),s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Scanned"}),s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Expired"}),s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Deleted"}),s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Failed"}),s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Processing"}),s.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Orgs"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:t.recentAudits.slice(0,10).map(e=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4",children:new Date(e.timestamp).toLocaleDateString()}),s.jsx("td",{className:"px-6 py-4",children:e.result.totalScanned}),s.jsx("td",{className:"px-6 py-4",children:e.result.totalExpired}),s.jsx("td",{className:"px-6 py-4 text-green-600 font-medium",children:e.result.successfulDeletions}),s.jsx("td",{className:"px-6 py-4 text-red-600 font-medium",children:e.result.failedDeletions}),s.jsxs("td",{className:"px-6 py-4",children:[e.result.processingTime,"ms"]}),s.jsx("td",{className:"px-6 py-4",children:e.result.organizationsProcessed.length})]},e.id))})]})})]}),h&&h.recentErrors.length>0&&s.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[s.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[s.jsx(ce,{className:"w-5 h-5 text-red-600"}),"Recent Errors"]}),s.jsx("div",{className:"space-y-2",children:h.recentErrors.map((e,t)=>s.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-700",children:e})},t))})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(pe,{className:"w-6 h-6 text-blue-600 mt-1"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Compliance & Data Protection"}),s.jsx("p",{className:"text-blue-800 text-sm mb-3",children:"Audio recordings are automatically deleted when warnings expire to ensure compliance with data protection regulations. All deletion activities are logged for audit purposes."}),s.jsxs("ul",{className:"text-blue-700 text-sm space-y-1",children:[s.jsx("li",{children:"• Audio files are deleted from Firebase Storage"}),s.jsx("li",{children:"• Warning documents remain with deletion metadata"}),s.jsx("li",{children:"• All deletion activities are audited and logged"}),s.jsx("li",{children:"• Manual cleanup can be triggered by administrators"})]})]})]})})]})},mr=({message:e="Loading...",size:t="md"})=>s.jsxs("div",{className:`flex items-center justify-center ${{sm:"py-4",md:"py-6",lg:"py-8"}[t]}`,children:[s.jsx(xe,{className:`${{sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"}[t]} animate-spin text-blue-600`}),s.jsx("span",{className:"ml-2 text-sm text-gray-600",children:e})]}),ur=({onClose:r,inline:i=!1,organizationId:o,organizationName:u,allowEdit:h=!1})=>{const{user:g}=l(),p=S.useContext(t),x=p?.organization||null,f=p?.organizationId,y=o||f,[v,b]=j.useState([]),[w,N]=j.useState(!0),[C,D]=j.useState(null),[k,E]=j.useState(null),[A,_]=j.useState(null),[R,F]=j.useState(!1),[z,I]=j.useState(!1),[T,O]=j.useState(!1),[L,B]=j.useState(null),[W,H]=j.useState(null),[U,$]=j.useState({name:"",description:"",level:"verbal",color:"#10b981",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]}),[G,V]=j.useState(!0),[q,Y]=j.useState(!1),K="super-user"===g?.role?.id,J=h&&(K||"reseller"===g?.role?.id),Z="executive-management"===g?.role?.id||K,Q=async()=>{if(!y)return D("Organization ID not found"),void N(!1);try{N(!0),D(null);const e=await d.organizations.getCategories(y);b(e)}catch(t){e.error("[OrganizationCategoriesViewer] Error loading categories:",t),D(t instanceof Error?t.message:"Failed to load categories")}finally{N(!1)}};j.useEffect(()=>{Q()},[y]),j.useEffect(()=>{x&&V(x.customization?.enableAudioRecording??!0)},[x]);const ee=e=>{switch(e){case"minor":case"low":return"#10b981";case"serious":case"medium":return"#f59e0b";case"gross_misconduct":case"high":return"#ef4444";default:return"#6b7280"}},te=e=>{switch(e){case"minor":case"low":return s.jsx(pe,{className:"h-4 w-4"});case"serious":case"medium":return s.jsx(ce,{className:"h-4 w-4"});case"gross_misconduct":case"high":return s.jsx(X,{className:"h-4 w-4"});default:return s.jsx(_e,{className:"h-4 w-4"})}},se=s.jsxs(s.Fragment,{children:[!i&&s.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"bg-violet-600 text-white p-2 rounded-lg",children:s.jsx(fe,{className:"h-6 w-6"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Warning Categories"}),s.jsxs("p",{className:"text-gray-600",children:[u||x?.name," • ",v.length," categories configured"]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:Q,disabled:w,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",title:"Refresh categories",children:s.jsx(oe,{className:"h-4 w-4 "+(w?"animate-spin":"")})}),s.jsx("button",{onClick:r,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",title:"Close",children:s.jsx(X,{className:"h-4 w-4"})})]})]})}),i&&s.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-3",children:s.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Warning Categories"}),s.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(fe,{className:"w-3 h-3"}),v.length," total"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(ae,{className:"w-3 h-3"}),v.filter(e=>!1!==e.isActive).length," active"]})]})]}),s.jsxs("button",{onClick:Q,disabled:w,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-md transition-colors disabled:opacity-50",title:"Refresh categories",children:[s.jsx(oe,{className:"w-3.5 h-3.5 "+(w?"animate-spin":"")}),"Refresh"]})]})}),s.jsx("div",{className:"flex-1 overflow-auto",children:w?s.jsx(mr,{message:"Loading categories..."}):C?s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(ce,{className:"w-3.5 h-3.5 text-red-600"}),s.jsx("span",{className:"text-sm font-medium text-red-800",children:"Error Loading Categories"})]}),s.jsx("p",{className:"text-xs text-red-600 mb-2",children:C}),s.jsx("button",{onClick:Q,className:"px-3 py-1.5 text-xs font-medium bg-red-600 text-white rounded-md hover:bg-red-700",children:"Try Again"})]}):0===v.length?s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[s.jsx(fe,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),s.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No Categories Found"}),s.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"No warning categories have been configured for this organization yet."}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center gap-2 text-blue-800 text-xs",children:[s.jsx(ye,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"Categories can only be configured by SuperUser administrators for security and compliance."})]})})]}):s.jsxs("div",{className:"space-y-3",children:[Z&&s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:s.jsx(ve,{className:"w-5 h-5 text-red-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Audio Recording"}),s.jsx("p",{className:"text-xs text-gray-600",children:"Record warning discussions for legal compliance"})]})]}),s.jsx("button",{role:"switch","aria-checked":G,"aria-label":"Toggle audio recording",disabled:q,onClick:async()=>{if(!y||!Z)return;const t=!G;V(t),Y(!0);try{const s=P(a,"organizations",y);await M(s,{"customization.enableAudioRecording":t,updatedAt:new Date}),e.success("Audio recording "+(t?"enabled":"disabled"))}catch(s){V(!t),e.error("Failed to update audio settings:",s)}finally{Y(!1)}},className:`\n                        relative inline-flex h-6 w-11 items-center rounded-full\n                        transition-colors duration-150 ease-in-out\n                        focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2\n                        ${q?"opacity-50 cursor-wait":"cursor-pointer"}\n                        ${G?"bg-green-600":"bg-gray-300"}\n                      `,children:s.jsx("span",{className:`\n                          inline-block h-5 w-5 transform rounded-full bg-white shadow-md\n                          transition-transform duration-150 ease-in-out\n                          ${G?"translate-x-5":"translate-x-0.5"}\n                        `})})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-2 ml-12",children:G?"Warning discussions will be recorded for quality and dispute resolution.":"Audio recording is disabled. Existing recordings remain accessible."})]}),!J&&s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(be,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-xs font-semibold text-blue-900 mb-0.5",children:"Read-Only View"}),s.jsx("p",{className:"text-xs text-blue-800",children:"Category modifications are restricted to SuperUser administrators to ensure compliance and data integrity."})]})]})}),J&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(je,{className:"w-3.5 h-3.5 text-green-600 flex-shrink-0"}),s.jsxs("div",{children:[s.jsxs("h4",{className:"text-xs font-semibold text-green-900 mb-0.5",children:[K?"SuperUser":"Reseller"," Edit Mode"]}),s.jsx("p",{className:"text-xs text-green-800",children:"You can edit, activate/deactivate, and delete categories for this organization."})]})]})}),J&&!z&&s.jsxs("button",{onClick:()=>I(!0),className:"w-full flex items-center justify-center gap-2 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[s.jsx(we,{className:"w-4 h-4"}),s.jsx("span",{className:"font-medium",children:"Create New Category"})]}),J&&z&&s.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Create New Category"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>O(!0),className:"flex items-center gap-1.5 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded text-sm font-medium text-gray-700 transition-colors",children:[s.jsx(pe,{className:"w-3.5 h-3.5"}),"Use Template"]}),s.jsx("button",{onClick:()=>I(!1),className:"p-1.5 hover:bg-gray-100 rounded",children:s.jsx(X,{className:"w-5 h-5 text-gray-600"})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),s.jsx("input",{type:"text",value:U.name||"",onChange:e=>$({...U,name:e.target.value}),placeholder:"e.g., Attendance Issues",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),s.jsxs("select",{value:U.level||"verbal",onChange:e=>$({...U,level:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"counselling",children:"Counselling"}),s.jsx("option",{value:"verbal",children:"Verbal Warning"}),s.jsx("option",{value:"first_written",children:"Written Warning"}),s.jsx("option",{value:"second_written",children:"Second Written Warning"}),s.jsx("option",{value:"final_written",children:"Final Written Warning"}),s.jsx("option",{value:"suspension",children:"Suspension"}),s.jsx("option",{value:"dismissal",children:"Ending of Service"})]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:U.description||"",onChange:e=>$({...U,description:e.target.value}),placeholder:"Brief description of this category...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),s.jsx("input",{type:"color",value:U.color||"#10b981",onChange:e=>$({...U,color:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-center",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:!1!==U.isActive,onChange:e=>$({...U,isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),s.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(e=>s.jsx("button",{type:"button",onClick:()=>$({...U,icon:e}),className:"w-10 h-10 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 "+(U.icon===e?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"),children:e},e))}),U.icon&&s.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",s.jsx("span",{className:"text-xl",children:U.icon})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Escalation Path"}),s.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Current escalation sequence (drag to reorder):"}),U.escalationPath&&U.escalationPath.length>0?s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:U.escalationPath.map((e,t)=>s.jsxs(S.Fragment,{children:[s.jsxs("div",{className:"relative",onDragOver:e=>{e.preventDefault(),H(t)},onDragLeave:()=>{H(null)},children:[null!==L&&W===t&&L!==t&&s.jsx("div",{className:"absolute -left-1 top-0 bottom-0 w-1 bg-blue-500 rounded-full z-10"}),s.jsxs("div",{draggable:!0,onDragStart:()=>{B(t),H(null)},onDragEnd:()=>{B(null),H(null)},onDrop:e=>{if(e.preventDefault(),null!==L&&L!==t){const e=[...U.escalationPath],s=e[L];e.splice(L,1),e.splice(t,0,s),$({...U,escalationPath:e})}B(null),H(null)},className:"flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium select-none transition-all duration-150 "+(L===t?"opacity-40 scale-95 cursor-grabbing shadow-lg":W===t&&null!==L?"bg-blue-200 scale-105 shadow-md":"cursor-grab hover:bg-blue-200 hover:shadow-sm"),children:[s.jsx(Ne,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}),s.jsx("span",{className:"capitalize",children:e.replace("_"," ")}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation();const s=U.escalationPath.filter((e,s)=>s!==t);$({...U,escalationPath:s})},className:"ml-1 text-blue-600 hover:text-blue-800 hover:bg-blue-200 rounded p-0.5 transition-colors",children:s.jsx(X,{className:"w-3 h-3"})})]})]}),t<U.escalationPath.length-1&&s.jsx(Ce,{className:"w-4 h-4 text-gray-400 flex-shrink-0"})]},t))}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:"No escalation path defined"})]}),s.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Add warning level:"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{value:"counselling",label:"Counselling"},{value:"verbal",label:"Verbal"},{value:"first_written",label:"Written"},{value:"second_written",label:"Second Written"},{value:"final_written",label:"Final Written"},{value:"suspension",label:"Suspension"},{value:"dismissal",label:"Ending of Service"}].map(e=>s.jsx("button",{type:"button",onClick:()=>{const t=U.escalationPath||[];t.includes(e.value)||$({...U,escalationPath:[...t,e.value]})},disabled:U.escalationPath?.includes(e.value),className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors "+(U.escalationPath?.includes(e.value)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:e.label},e.value))})]})]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{onClick:async()=>{if(y&&J)if(U.name?.trim())try{F(!0);const t={name:U.name,description:U.description||"",severity:U.level||"minor",level:U.level||"verbal",color:U.color||"#10b981",icon:U.icon||"📋",isActive:!1!==U.isActive,isDefault:!1,escalationPath:U.escalationPath||["verbal","first_written","final_written"]};await n.createWarningCategory(t,y),await Q(),I(!1),$({name:"",description:"",level:"verbal",color:"#10b981",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]}),e.success("Category created successfully")}catch(t){e.error("Failed to create category:",t)}finally{F(!1)}else alert("Category name is required")},disabled:R||!U.name?.trim(),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:R?"Creating...":"Create Category"}),s.jsx("button",{onClick:()=>I(!1),disabled:R,className:"px-4 py-2.5 bg-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors",children:"Cancel"})]})]}),J&&A&&s.jsxs("div",{className:"bg-white border-2 border-yellow-400 rounded-lg p-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Edit Category"}),s.jsx("button",{onClick:()=>_(null),className:"p-1.5 hover:bg-gray-100 rounded",children:s.jsx(X,{className:"w-5 h-5 text-gray-600"})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),s.jsx("input",{type:"text",value:A.name||"",onChange:e=>_({...A,name:e.target.value}),placeholder:"e.g., Attendance Issues",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),s.jsxs("select",{value:A.level||"verbal",onChange:e=>_({...A,level:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"counselling",children:"Counselling"}),s.jsx("option",{value:"verbal",children:"Verbal Warning"}),s.jsx("option",{value:"first_written",children:"Written Warning"}),s.jsx("option",{value:"second_written",children:"Second Written Warning"}),s.jsx("option",{value:"final_written",children:"Final Written Warning"}),s.jsx("option",{value:"suspension",children:"Suspension"}),s.jsx("option",{value:"dismissal",children:"Ending of Service"})]})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:A.description||"",onChange:e=>_({...A,description:e.target.value}),placeholder:"Brief description of this category...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),s.jsx("input",{type:"color",value:A.color||"#10b981",onChange:e=>_({...A,color:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-center",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:!1!==A.isActive,onChange:e=>_({...A,isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),s.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(e=>s.jsx("button",{type:"button",onClick:()=>_({...A,icon:e}),className:"w-10 h-10 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 "+(A.icon===e?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"),children:e},e))}),A.icon&&s.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",s.jsx("span",{className:"text-xl",children:A.icon})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Escalation Path"}),s.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Current escalation sequence (drag to reorder):"}),A.escalationPath&&A.escalationPath.length>0?s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:A.escalationPath.map((e,t)=>s.jsxs(S.Fragment,{children:[s.jsxs("div",{className:"relative",onDragOver:e=>{e.preventDefault(),H(t)},onDragLeave:()=>{H(null)},children:[null!==L&&W===t&&L!==t&&s.jsx("div",{className:"absolute -left-1 top-0 bottom-0 w-1 bg-blue-500 rounded-full z-10"}),s.jsxs("div",{draggable:!0,onDragStart:()=>{B(t),H(null)},onDragEnd:()=>{B(null),H(null)},onDrop:e=>{if(e.preventDefault(),null!==L&&L!==t){const e=[...A.escalationPath],s=e[L];e.splice(L,1),e.splice(t,0,s),_({...A,escalationPath:e})}B(null),H(null)},className:"flex items-center gap-2 px-3 py-1.5 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium select-none transition-all duration-150 "+(L===t?"opacity-40 scale-95 cursor-grabbing shadow-lg":W===t&&null!==L?"bg-blue-200 scale-105 shadow-md":"cursor-grab hover:bg-blue-200 hover:shadow-sm"),children:[s.jsx(Ne,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}),s.jsx("span",{className:"capitalize",children:e.replace("_"," ")}),s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation();const s=A.escalationPath.filter((e,s)=>s!==t);_({...A,escalationPath:s})},className:"ml-1 text-blue-600 hover:text-blue-800 hover:bg-blue-200 rounded p-0.5 transition-colors",children:s.jsx(X,{className:"w-3 h-3"})})]})]}),t<A.escalationPath.length-1&&s.jsx(Ce,{className:"w-4 h-4 text-gray-400 flex-shrink-0"})]},t))}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:"No escalation path defined"})]}),s.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"Add warning level:"}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{value:"counselling",label:"Counselling"},{value:"verbal",label:"Verbal"},{value:"first_written",label:"Written"},{value:"second_written",label:"Second Written"},{value:"final_written",label:"Final Written"},{value:"suspension",label:"Suspension"},{value:"dismissal",label:"Ending of Service"}].map(e=>s.jsx("button",{type:"button",onClick:()=>{const t=A.escalationPath||[];t.includes(e.value)||_({...A,escalationPath:[...t,e.value]})},disabled:A.escalationPath?.includes(e.value),className:"px-3 py-1.5 text-xs font-medium rounded-md transition-colors "+(A.escalationPath?.includes(e.value)?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"),children:e.label},e.value))})]})]}),s.jsxs("div",{className:"flex gap-3 pt-2",children:[s.jsx("button",{onClick:()=>(async t=>{if(y&&J)try{F(!0);const s={name:t.name,description:t.description,level:t.level,color:t.color,icon:t.icon,isActive:t.isActive,escalationPath:t.escalationPath,updatedAt:new Date};void 0!==t.severity&&null!==t.severity&&(s.severity=t.severity),await m.updateDocument(y,"categories",t.id,s),n.invalidateCache(`categories:${y}`),await Q(),_(null),e.success("Category updated successfully")}catch(s){e.error("Failed to update category:",s)}finally{F(!1)}})(A),disabled:R||!A.name?.trim(),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:R?"Saving...":"Save Changes"}),s.jsx("button",{onClick:()=>_(null),disabled:R,className:"px-4 py-2.5 bg-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors",children:"Cancel"})]})]}),s.jsx("div",{className:"space-y-1.5",children:v.map(t=>{const r=k===t.id;return s.jsx("div",{className:"border border-gray-200 rounded-lg bg-white",children:s.jsxs("div",{className:"p-2.5",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300 flex-shrink-0",style:{backgroundColor:t.color||ee(t.severity)}}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[s.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:t.name}),s.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded text-white text-xs font-medium",style:{backgroundColor:ee(t.severity)},children:[s.jsx("span",{className:"scale-75",children:te(t.severity)}),t.severity?.replace("_"," ")||"Unknown"]}),!1!==t.isActive&&s.jsxs("div",{className:"flex items-center gap-0.5 px-1.5 py-0.5 bg-green-100 text-green-800 rounded text-xs font-medium",children:[s.jsx(ae,{className:"w-2.5 h-2.5"}),"Active"]})]}),t.description&&s.jsx("p",{className:"text-xs text-gray-600 mb-1.5 line-clamp-2",children:t.description}),s.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Se,{className:"w-3 h-3"}),t.escalationPath?.length||0," steps"]}),t.createdAt&&s.jsx("span",{children:new Date(t.createdAt).toLocaleDateString("en-ZA")})]})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[J&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>_(t),disabled:R,className:"p-1.5 text-blue-500 hover:text-blue-700 rounded hover:bg-blue-50 flex-shrink-0",title:"Edit category",children:s.jsx(je,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>(async t=>{if(y&&J)try{F(!0);const s=!1===t.isActive;await m.updateDocument(y,"categories",t.id,{isActive:s,updatedAt:new Date}),n.invalidateCache(`categories:${y}`),await Q(),e.success("Category "+(!1!==t.isActive?"deactivated":"activated"))}catch(s){e.error("Failed to toggle category:",s)}finally{F(!1)}})(t),disabled:R,className:"p-1.5 rounded hover:bg-gray-50 flex-shrink-0 "+(!1!==t.isActive?"text-green-600 hover:text-green-700":"text-gray-400 hover:text-gray-600"),title:!1!==t.isActive?"Deactivate category":"Activate category",children:!1!==t.isActive?s.jsx(De,{className:"w-3.5 h-3.5"}):s.jsx(ke,{className:"w-3.5 h-3.5"})}),s.jsx("button",{onClick:()=>(async t=>{if(y&&J&&confirm("Are you sure you want to delete this category?"))try{F(!0),await n.deleteDocument(y,"categories",t),await Q(),e.success("Category deleted successfully")}catch(s){e.error("Failed to delete category:",s)}finally{F(!1)}})(t.id),disabled:R,className:"p-1.5 text-red-500 hover:text-red-700 rounded hover:bg-red-50 flex-shrink-0",title:"Delete category",children:s.jsx(de,{className:"w-3.5 h-3.5"})})]}),s.jsx("button",{onClick:()=>E(r?null:t.id),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded hover:bg-gray-50 flex-shrink-0",title:r?"Collapse details":"Expand details",children:r?s.jsx(Ee,{className:"w-3.5 h-3.5"}):s.jsx(Ae,{className:"w-3.5 h-3.5"})})]})]}),r&&s.jsx("div",{className:"mt-3 pt-2.5 border-t border-gray-200",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsxs("h5",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[s.jsx(Se,{className:"w-3 h-3"}),"Escalation Path"]}),t.escalationPath&&t.escalationPath.length>0?s.jsx("div",{className:"space-y-1",children:t.escalationPath.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-gray-50 rounded text-xs",children:[s.jsx("span",{className:"w-4 h-4 bg-blue-500 text-white text-[10px] rounded-full flex items-center justify-center font-semibold flex-shrink-0",children:t+1}),s.jsx("span",{className:"font-medium capitalize",children:e.replace("_"," ")})]},t))}):s.jsx("p",{className:"text-gray-500 text-xs",children:"No escalation path defined"})]}),s.jsxs("div",{children:[s.jsxs("h5",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[s.jsx(_e,{className:"w-3 h-3"}),"Details"]}),s.jsxs("div",{className:"space-y-1.5 text-xs",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-700",children:"Category ID:"}),s.jsx("span",{className:"text-gray-600 ml-1 font-mono text-[10px]",children:t.id})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-700",children:"Severity:"}),s.jsx("span",{className:"text-gray-600 ml-1 capitalize",children:t.severity?.replace("_"," ")||"Not specified"})]}),t.examples&&t.examples.length>0&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-700",children:"Examples:"}),s.jsxs("div",{className:"mt-1.5 flex flex-wrap gap-1",children:[t.examples.slice(0,3).map((e,t)=>s.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-[10px] rounded",children:e},t)),t.examples.length>3&&s.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded",children:["+",t.examples.length-3," more"]})]})]})]})]})]})})]})},t.id)})}),s.jsx("div",{className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 flex-wrap gap-2",children:[s.jsxs("span",{children:["Total: ",s.jsx("strong",{children:v.length})," configured"]}),s.jsxs("span",{children:["Active: ",s.jsx("strong",{children:v.filter(e=>!1!==e.isActive).length})]}),J?s.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[s.jsx(je,{className:"w-2.5 h-2.5"}),"Edit mode"]}):s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(be,{className:"w-2.5 h-2.5"}),"Read-only"]})]})})]})}),T&&s.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"1rem"},children:s.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",maxWidth:"48rem",width:"100%",maxHeight:"90vh",display:"flex",flexDirection:"column",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"},children:[s.jsxs("div",{style:{padding:"1.5rem",borderBottom:"1px solid #e5e7eb",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[s.jsx("div",{style:{padding:"0.5rem",backgroundColor:"#dbeafe",borderRadius:"0.5rem"},children:s.jsx(pe,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:600,color:"#111827"},children:"Select Category Template"}),s.jsx("p",{style:{fontSize:"0.875rem",color:"#6b7280",marginTop:"0.125rem"},children:"Choose from 8 universal SA labor law compliant categories"})]})]}),s.jsx("button",{onClick:()=>O(!1),style:{padding:"0.5rem",borderRadius:"0.5rem",border:"none",backgroundColor:"transparent",cursor:"pointer",color:"#6b7280"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f3f4f6"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:s.jsx(X,{className:"w-5 h-5"})})]}),s.jsx("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem"},children:s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:c.map(e=>{const t=ee(e.severity),r=te(e.severity);return s.jsx("div",{onClick:()=>{$({name:e.name,description:e.description,level:e.escalationPath?.[0]||"verbal",color:t,icon:e.icon||"📋",isActive:!0,isDefault:!1,escalationPath:e.escalationPath||["verbal","first_written","final_written"]}),O(!1)},style:{padding:"1rem",border:"2px solid #e5e7eb",borderRadius:"0.75rem",cursor:"pointer",transition:"all 0.2s",backgroundColor:"white"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.backgroundColor="#eff6ff",e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.1)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="#e5e7eb",e.currentTarget.style.backgroundColor="white",e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:s.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"1rem"},children:[s.jsx("div",{style:{fontSize:"2rem",flexShrink:0},children:e.icon}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem",flexWrap:"wrap"},children:[s.jsx("h4",{style:{fontSize:"0.875rem",fontWeight:600,color:"#111827",margin:0},children:e.name}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"9999px",backgroundColor:t,color:"white",fontSize:"0.75rem",fontWeight:500},children:[s.jsx("span",{style:{transform:"scale(0.8)"},children:r}),e.severity?.replace("_"," ")]})]}),s.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginBottom:"0.75rem",lineHeight:"1.4"},children:e.description}),e.escalationPath&&e.escalationPath.length>0&&s.jsxs("div",{style:{marginBottom:"0.75rem"},children:[s.jsxs("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#374151",marginBottom:"0.375rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[s.jsx(Se,{className:"w-3 h-3"}),"Escalation Path:"]}),s.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.25rem"},children:e.escalationPath.map((t,r)=>s.jsxs(S.Fragment,{children:[s.jsx("span",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#f3f4f6",color:"#374151",fontSize:"0.625rem",fontWeight:500,borderRadius:"0.25rem",textTransform:"capitalize"},children:t.replace("_"," ")}),r<e.escalationPath.length-1&&s.jsx(Ce,{className:"w-3 h-3 text-gray-400"})]},r))})]}),e.commonExamples&&e.commonExamples.length>0&&s.jsxs("div",{children:[s.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,color:"#374151",marginBottom:"0.375rem"},children:"Common Examples:"}),s.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.375rem"},children:[e.commonExamples.slice(0,3).map((e,t)=>s.jsx("span",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",fontSize:"0.625rem",borderRadius:"0.25rem"},children:e},t)),e.commonExamples.length>3&&s.jsxs("span",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#f3f4f6",color:"#6b7280",fontSize:"0.625rem",borderRadius:"0.25rem"},children:["+",e.commonExamples.length-3," more"]})]})]})]}),s.jsx("div",{style:{flexShrink:0,color:"#9ca3af"},children:s.jsx(Ce,{className:"w-5 h-5"})})]})},e.id)})})}),s.jsx("div",{style:{padding:"1rem 1.5rem",borderTop:"1px solid #e5e7eb",backgroundColor:"#f9fafb"},children:s.jsx("button",{onClick:()=>O(!1),style:{width:"100%",padding:"0.625rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"0.875rem",fontWeight:500,cursor:"pointer",transition:"background-color 0.2s"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#4b5563"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#6b7280"},children:"Cancel"})})]})})]});return i?s.jsx("div",{className:"space-y-4",children:se}):s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:"bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:se})})},hr=Object.freeze(Object.defineProperty({__proto__:null,OrganizationCategoriesViewer:ur},Symbol.toStringTag,{value:"Module"}));var gr,pr="https://js.stripe.com",xr="".concat(pr,"/").concat("basil","/stripe.js"),fr=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,yr=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,vr=function(e){return fr.test(e)||yr.test(e)},br=function(e){var t=document.createElement("script");t.src="".concat(xr).concat("");var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(t),t},jr=null,wr=null,Nr=null,Cr=function(e){return null!==jr?jr:(jr=new Promise(function(t,s){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(pr,'"]')),t=0;t<e.length;t++){var s=e[t];if(vr(s.src))return s}return null}();if(r&&e);else if(r){if(r&&null!==Nr&&null!==wr){var a;r.removeEventListener("load",Nr),r.removeEventListener("error",wr),null===(a=r.parentNode)||void 0===a||a.removeChild(r),r=br()}}else r=br();Nr=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,s),wr=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(s),r.addEventListener("load",Nr),r.addEventListener("error",wr)}catch(n){return void s(n)}else t(null)})).catch(function(e){return jr=null,Promise.reject(e)})};Promise.resolve().then(function(){return gr||(gr=Cr(null).catch(function(e){return gr=null,Promise.reject(e)}))}).catch(function(e){console.warn(e)});const Sr=Promise.resolve(null);const Dr=new class{constructor(){this.stripe=Sr,this.functions=W(),this.isDevelopment=true}async createSubscription(t){try{if(this.isDevelopment)return e.warn("Development mode: Returning mock Stripe session"),{sessionId:`cs_dev_${Date.now()}`,url:`${window.location.origin}/mock-checkout?plan=${t.planTier}&org=${t.organizationId}`};const s=H(this.functions,"createCheckoutSession"),r=(await s({organizationId:t.organizationId,planTier:t.planTier,customerEmail:t.customerEmail,customerName:t.customerName,resellerId:t.resellerId,successUrl:t.successUrl,cancelUrl:t.cancelUrl})).data;return e.success("Stripe checkout session created:",r),r}catch(s){throw e.error("Failed to create Stripe subscription:",s),s}}async updateSubscriptionTier(t,s,r){try{const a=H(this.functions,"updateSubscription"),n=(await a({subscriptionId:t,newTier:s,employeeCount:r})).data;return e.success("Subscription updated:",n),n}catch(a){throw e.error("Failed to update subscription:",a),a}}async cancelSubscription(t,s){try{const r=H(this.functions,"cancelSubscription"),a=(await r({subscriptionId:t,reason:s})).data;return e.success("Subscription canceled:",a),a}catch(r){throw e.error("Failed to cancel subscription:",r),r}}getRecommendedTier(e){return e<=10?"starter":e<=50?"professional":e<=200?"enterprise":"enterprise-plus"}needsUpgrade(e,t){const s=SUBSCRIPTION_PLANS[e],r=this.getRecommendedTier(t);return{needsUpgrade:e!==r,recommendedTier:e!==r?r:void 0,exceedsLimit:t>s.employeeLimit}}calculateProratedUpgrade(e,t,s){const r=SUBSCRIPTION_PLANS[e],a=(SUBSCRIPTION_PLANS[t].price-r.price)/30;return Math.round(a*s)}async createCustomerPortalSession(t,s){try{if(this.isDevelopment)return e.warn("Development mode: Returning mock customer portal URL"),{url:`${window.location.origin}/mock-portal?customer=${t}&return=${encodeURIComponent(s)}`};const r=H(this.functions,"createPortalSession"),a=(await r({customerId:t,returnUrl:s})).data;return e.success("Customer portal session created:",a),a}catch(r){throw e.error("Failed to create customer portal session:",r),r}}formatPrice(e){return`R${(e/100).toFixed(2)}`}getStatusDisplay(e){switch(e){case"active":return{text:"Active",color:"green"};case"past_due":return{text:"Payment Due",color:"yellow"};case"unpaid":return{text:"Payment Failed",color:"red"};case"canceled":return{text:"Canceled",color:"gray"};default:return{text:"Unknown",color:"gray"}}}validateSubscriptionLimits(e,t){const s=SUBSCRIPTION_PLANS[e.plan];if(t<=s.employeeLimit)return{isValid:!0};const r=t-s.employeeLimit;return{isValid:!1,message:`Your organization has ${t} employees but your ${s.name} plan only supports ${s.employeeLimit}. You are ${r} employees over the limit.`,suggestedAction:"upgrade"}}};class kr{static replacePlaceholders(e,t){if(!e)return"";let s=e;const r=e.matchAll(/\{\{([^}]+)\}\}/g);for(const a of r){const e=a[1].trim(),r=this.getValueFromPath(e,t);s=s.replace(a[0],r||`[${e}]`)}return s}static getValueFromPath(e,t){const s=e.split(".");try{if("employee"===s[0])switch(s[1]){case"firstName":return t.employee?.firstName||"";case"lastName":return t.employee?.lastName||"";case"employeeNumber":return t.employee?.employeeNumber||"";case"email":return t.employee?.email||"";case"phoneNumber":case"phone":return t.employee?.phone||"";case"department":return t.employee?.department||"";case"position":return t.employee?.position||"";default:return""}if("warning"===s[0])switch(s[1]){case"level":return this.formatWarningLevel(t.warningLevel);case"issueDate":return this.formatDate(t.issuedDate);case"incidentDate":return this.formatDate(t.incidentDate);case"category":return t.category||"";case"description":return t.description||"";case"nextLevel":return this.getNextEscalationLevel(t.warningLevel);default:return""}if("organization"===s[0])switch(s[1]){case"name":return t.organization?.name||"";case"industry":return this.formatIndustry(t.organization);default:return""}if("manager"===s[0])switch(s[1]){case"name":return t.issuedByName||"Management";case"position":return"Manager";default:return""}return""}catch(r){return console.warn(`Failed to resolve placeholder: ${e}`,r),""}}static formatWarningLevel(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Ending of Service"}[e]||e}static getNextEscalationLevel(e){return{counselling:"Verbal Warning",verbal:"Written Warning",first_written:"Second Written Warning",second_written:"Final Written Warning",final_written:"Suspension or Ending of Service",suspension:"Ending of Service",dismissal:"Termination of Employment"}[e]||"Further Disciplinary Action"}static formatDate(e){if(!e)return"";try{const t="string"==typeof e?new Date(e):e,s=t.getDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()];return`${s} ${r} ${t.getFullYear()}`}catch(t){return console.warn("Failed to format date:",e,t),""}}static formatIndustry(e){if(!e)return"";const t=e.branding?.industry||e.industry;return{manufacturing:"Manufacturing",retail:"Retail",healthcare:"Healthcare",security:"Security Services",mining:"Mining"}[t]||t||""}static replacePlaceholdersInArray(e,t){return e.map(e=>this.replacePlaceholders(e,t))}static hasUnresolvedPlaceholders(e){return/\{\{[^}]+\}\}/.test(e)}static extractPlaceholders(e){return Array.from(e.matchAll(/\{\{([^}]+)\}\}/g)).map(e=>e[1].trim())}}function Er(e){const t=e.replace("data:image/svg+xml;base64,",""),s=decodeURIComponent(escape(atob(t))),r=s.match(/width="(\d+)"/),a=s.match(/height="(\d+)"/);if(!r||!a)return console.error("Failed to parse SVG dimensions for watermark"),e;const n=`\n  <g transform="translate(${parseInt(r[1])/2}, ${parseInt(a[1])/2}) rotate(-30)">\n    <text x="0" y="0" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="rgba(239, 68, 68, 0.3)" text-anchor="middle" dominant-baseline="middle">WITNESS</text>\n  </g>`,i=s.replace("</svg>",`${n}\n</svg>`);return`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(i)))}`}const Ar="1.2.0";class _r{async convertSignatureToPNG(t){if(!t)return t;if(!function(e){return e.startsWith("data:image/svg+xml")||e.startsWith("<svg")}(t))return t;try{return await async function(e,t=400,s=200){return new Promise((r,a)=>{const n=new Image;n.onload=()=>{const e=document.createElement("canvas");e.width=t,e.height=s;const i=e.getContext("2d");if(!i)return void a(new Error("Failed to get canvas context"));i.fillStyle="#ffffff",i.fillRect(0,0,t,s),i.drawImage(n,0,0,t,s);const o=e.toDataURL("image/png");r(o)},n.onerror=()=>{a(new Error("Failed to load SVG for conversion"))},n.src=e})}(t,400,200)}catch(s){return e.error("Failed to convert SVG signature to PNG for PDF:",s),t}}static async generateWarningPDF(t,s,r){const a=s||Ar;switch(t.warningId,a){case"1.0.0":return this.generateWarningPDF_v1_0_0(t);case"1.1.0":return this.generateWarningPDF_v1_1_0(t,r);case"1.2.0":return this.generateWarningPDF_v1_2_0(t,r);default:return e.warn(`⚠️ Unsupported PDF generator version: ${a}, falling back to current`),this.generateWarningPDF_v1_2_0(t,r)}}static async generateWarningPDF_v1_0_0(t){try{const s=ht||{isLegacyDevice:!1};mt(s);if(s.isLegacyDevice)return e.warn("🚨 Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(t);if(t.signatures){const e=new _r;t.signatures.manager&&(t.signatures.manager=await e.convertSignatureToPNG(t.signatures.manager)),t.signatures.employee&&(t.signatures.employee=await e.convertSignatureToPNG(t.signatures.employee)),t.signatures.witness&&(t.signatures.witness=await e.convertSignatureToPNG(t.signatures.witness))}Date.now();const{default:r}=await _(async()=>{const{default:e}=await import("./pdf-vendor-CbrIsI36.js").then(e=>e.j);return{default:e}},[]),a=new r({orientation:"portrait",unit:"mm",format:"a4",compress:!0});a.setFont("helvetica","normal");let n=15;const i=a.internal.pageSize.width,o=a.internal.pageSize.height,l=20,c=40;n=this.addOrganizationHeader(a,t.organization,n,i,l),n=this.addDocumentTitle(a,t,n,i,l,o,c),n=this.addEmployeeSection(a,t.employee,n,i,l,o,c),n=this.addWarningDetailsSection(a,t,n,i,l,o,c),n=this.addIncidentDetailsSection(a,t,n,i,l,o,c),t.disciplineRecommendation&&(n=this.addPreviousDisciplinaryActionSection_v1_0_0(a,t.disciplineRecommendation,n,i,l,o,c),n=this.addConsequencesSection(a,t,n,i,l,o,c)),t.legalCompliance&&(n=this.addLegalComplianceSection(a,t.legalCompliance,n,i,l,o,c)),t.additionalNotes&&(n=this.addAdditionalNotesSection(a,t.additionalNotes,n,i,l,o,c)),n=this.addEmployeeRightsSection(a,t,n,i,l,o,c),n=this.addSignaturesSection(a,t.signatures,t.employee,n,i,l,o,c,t.issuedDate,t.issuedByName),t.deliveryChoice&&(n=this.addDeliverySection(a,t.deliveryChoice,n,i,l,o,c)),(t.appealDetails||t.appealOutcome)&&(n=this.addAppealHistorySection(a,t,n,i,l,o,c)),this.addDocumentFooter(a,t,i),this.addSecurityWatermark(a,i),"overturned"===t.status&&this.addOverturnedWatermark(a,i);const d=a.output("blob");Date.now();return t.warningId,(d.size/1024).toFixed(1),d}catch(s){throw e.error("❌ v1.0.0 PDF generation failed:",s),new Error(`PDF generation failed: ${s instanceof Error?s.message:"Unknown error"}`)}}static async generateWarningPDF_v1_1_0(t,s){try{const r=ht||{isLegacyDevice:!1};mt(r);if(r.isLegacyDevice)return e.warn("🚨 Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(t);if(t.signatures){const e=new _r;t.signatures.manager&&(t.signatures.manager=await e.convertSignatureToPNG(t.signatures.manager)),t.signatures.employee&&(t.signatures.employee=await e.convertSignatureToPNG(t.signatures.employee)),t.signatures.witness&&(t.signatures.witness=await e.convertSignatureToPNG(t.signatures.witness))}const a={styling:{headerBackground:"#3B82F6",sectionHeaderColor:"#333333",bodyTextColor:"#000000",borderColor:"#C8C8C8",fontSize:11,fontFamily:"helvetica",lineHeight:1.4,pageSize:"A4",margins:{top:20,bottom:20,left:20,right:20}},content:{showWatermark:!0,watermarkText:"CONFIDENTIAL",watermarkOpacity:.1,footerText:"Confidential & Privileged",showPageNumbers:!0}},n=s?{styling:{...a.styling,...s.styling||{}},content:{...a.content,...s.content||{}}}:a;s&&(t.organization,n.styling.headerBackground,n.styling.fontSize,n.content.watermarkText),t.employee,t.organization,!t.description&&t.incidentLocation,t.employee&&(t.employee.firstName,t.employee.lastName),t.organization,t.warningLevel,t.category;Date.now();const{default:i}=await _(async()=>{const{default:e}=await import("./pdf-vendor-CbrIsI36.js").then(e=>e.j);return{default:e}},[]),o=new i({orientation:"portrait",unit:"mm",format:n.styling.pageSize.toLowerCase(),compress:!0});e.success(3579),o.setFont(n.styling.fontFamily,"normal");let l=n.styling.margins.top;const c=o.internal.pageSize.width,d=o.internal.pageSize.height,m=n.styling.margins.left,u=n.styling.margins.bottom+20;l=this.addOrganizationHeader(o,t.organization,l,c,m),e.success(4172),l=this.addDocumentTitle(o,t,l,c,m,d,u),e.success(4459),l=this.addEmployeeSection(o,t.employee,l,c,m,d,u),e.success(4759),l=this.addWarningDetailsSection(o,t,l,c,m,d,u),e.success(5060),l=this.addIncidentDetailsSection(o,t,l,c,m,d,u),e.success(5387),t.employeeStatement&&(l=this.addEmployeeStatementSection(o,t.employeeStatement,l,c,m,d,u),e.success("✅ Employee statement section added")),t.expectedBehaviorStandards&&(l=this.addExpectedBehaviorSection(o,t.expectedBehaviorStandards,l,c,m,d,u),e.success("✅ Expected behavior section added")),t.factsLeadingToDecision&&(l=this.addFactsLeadingToDecisionSection(o,t.factsLeadingToDecision,l,c,m,d,u),e.success("✅ Facts leading to decision section added")),t.disciplineRecommendation&&(l=this.addPreviousDisciplinaryActionSection(o,t.disciplineRecommendation,l,c,m,d,u),e.success("✅ Previous disciplinary action section added"),l=this.addConsequencesSection(o,t,l,c,m,d,u),e.success("✅ Consequences section added")),t.legalCompliance&&(l=this.addLegalComplianceSection(o,t.legalCompliance,l,c,m,d,u),e.success(6262)),t.additionalNotes&&(l=this.addAdditionalNotesSection(o,t.additionalNotes,l,c,m,d,u),e.success(6716)),t.improvementCommitments&&t.improvementCommitments.length>0&&(l=this.addImprovementCommitmentsSection(o,t.improvementCommitments,l,c,m,d,u),e.success("✅ Improvement commitments section added")),t.reviewDate&&(l=this.addReviewDateSection(o,t.reviewDate,l,c,m,d,u,t.warningLevel),e.success("✅ Review date and auto-satisfaction clause section added")),t.interventionDetails&&(l=this.addInterventionDetailsSection(o,t.interventionDetails,l,c,m,d,u),e.success("✅ Intervention details section added")),l=this.addEmployeeRightsSection(o,t,l,c,m,d,u),e.success("✅ Employee rights section added"),l=this.addSignaturesSection(o,t.signatures,t.employee,l,c,m,d,u,t.issuedDate,t.issuedByName),e.success(7166),t.deliveryChoice&&(l=this.addDeliverySection(o,t.deliveryChoice,l,c,m,d,u),e.success(7512)),(t.appealDetails||t.appealOutcome)&&(l=this.addAppealHistorySection(o,t,l,c,m,d,u),e.success("✅ Appeal history section added")),this.addDocumentFooter(o,t,c),e.success(7804),this.addSecurityWatermark(o,c),e.success(7997),"overturned"===t.status&&(this.addOverturnedWatermark(o,c),e.success("✅ OVERTURNED watermark added to all pages"));const h=o.output("blob");Date.now();return t.warningId,t.employee.firstName,t.employee.lastName,(h.size/1024).toFixed(1),h}catch(r){throw e.error("❌ PDF generation failed:",r),new Error(`PDF generation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}static replacePlaceholders(e,t){let s=e;return t.validityPeriod&&(s=s.replace(/\{\{validityPeriod\}\}/g,t.validityPeriod.toString())),t.employee&&(s=s.replace(/\{\{employee\.firstName\}\}/g,t.employee.firstName||""),s=s.replace(/\{\{employee\.lastName\}\}/g,t.employee.lastName||"")),t.issuedDate&&(s=s.replace(/\{\{issuedDate\}\}/g,this.formatDate(t.issuedDate))),s}static async generateWarningPDF_v1_2_0(t,s){try{if((ht||{isLegacyDevice:!1}).isLegacyDevice)return e.warn("🚨 Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(t);if(t.signatures){const e=new _r;t.signatures.manager&&(t.signatures.manager=await e.convertSignatureToPNG(t.signatures.manager)),t.signatures.employee&&(t.signatures.employee=await e.convertSignatureToPNG(t.signatures.employee)),t.signatures.witness&&(t.signatures.witness=await e.convertSignatureToPNG(t.signatures.witness))}const r={styling:{headerBackground:"#3B82F6",sectionHeaderColor:"#333333",bodyTextColor:"#000000",borderColor:"#C8C8C8",fontSize:11,fontFamily:"helvetica",lineHeight:1.4,pageSize:"A4",margins:{top:20,bottom:20,left:20,right:20}},content:{showWatermark:!0,watermarkText:"CONFIDENTIAL",watermarkOpacity:.1,footerText:"Confidential & Privileged",showPageNumbers:!0},sections:void 0};console.log("🎨 PDF TEMPLATE DEBUG - customSettings received:",{hasCustomSettings:!!s,customSettingsKeys:s?Object.keys(s):"none",hasSections:!!s?.sections,sectionsCount:s?.sections?.length||0,sectionIds:s?.sections?.map(e=>e.id)||[],generatorVersion:s?.generatorVersion||"not set"});const a=s?{styling:{...r.styling,...s.styling||{}},content:{...r.content,...s.content||{}},sections:s.sections||r.sections}:r;console.log("🎨 PDF TEMPLATE DEBUG - final settings:",{usedCustomSettings:!!s,finalSectionCount:a.sections?.length||0,finalSectionIds:a.sections?.map(e=>e.id)||[],headerColor:a.styling.headerBackground,organization:t.organization?.name}),a.sections,t.organization;const n=Date.now(),{default:i}=await _(async()=>{const{default:e}=await import("./pdf-vendor-CbrIsI36.js").then(e=>e.j);return{default:e}},[]),o=new i({orientation:"portrait",unit:"mm",format:a.styling.pageSize.toLowerCase(),compress:!0});o.setFont(a.styling.fontFamily,"normal");let l=a.styling.margins.top;const c=o.internal.pageSize.width,d=o.internal.pageSize.height,m=a.styling.margins.left,u=a.styling.margins.bottom+20;if(l=this.addOrganizationHeader(o,t.organization,l,c,m),l=this.addDocumentTitle(o,t,l,c,m,d,u),l=this.addEmployeeSection(o,t.employee,l,c,m,d,u),l=this.addWarningDetailsSection(o,t,l,c,m,d,u),l=this.addIncidentDetailsSection(o,t,l,c,m,d,u),a.sections&&a.sections.length>0){a.sections.length;const s=[...a.sections].sort((e,t)=>(e.order||0)-(t.order||0));for(const r of s)if(r.enabled){if("signatures"!==r.id)if("standard"===r.type)switch(r.name,r.id){case"previous-disciplinary-actions":t.disciplineRecommendation&&(l=this.addPreviousDisciplinaryActionSection(o,t.disciplineRecommendation,l,c,m,d,u,r));break;case"consequences-section":l=this.addConsequencesSection(o,t,l,c,m,d,u,r);break;case"employee-rights-lra":l=this.addEmployeeRightsSection(o,t,l,c,m,d,u,r);break;case"appeal-history":(t.appealDetails||t.appealOutcome)&&(l=this.addAppealHistorySection(o,t,l,c,m,d,u));break;case"employee-statement":t.employeeStatement&&(l=this.addEmployeeStatementSection(o,t.employeeStatement,l,c,m,d,u));break;case"expected-behavior-standards":t.expectedBehaviorStandards&&(l=this.addExpectedBehaviorSection(o,t.expectedBehaviorStandards,l,c,m,d,u));break;case"facts-leading-to-decision":t.factsLeadingToDecision&&(l=this.addFactsLeadingToDecisionSection(o,t.factsLeadingToDecision,l,c,m,d,u));break;case"improvement-commitments":t.improvementCommitments&&t.improvementCommitments.length>0&&(l=this.addImprovementCommitmentsSection(o,t.improvementCommitments,l,c,m,d,u));break;case"review-date":t.reviewDate&&(l=this.addReviewDateSection(o,t.reviewDate,l,c,m,d,u));break;default:e.warn(`Unknown standard section: ${r.id}, using dynamic renderer`),l=this.renderDynamicSection(o,r,t,l,c,m,d,u,a)}else r.name,l=this.renderDynamicSection(o,r,t,l,c,m,d,u,a)}else r.name;e.success("✅ All sections rendered successfully")}else e.warn("⚠️ No sections configured, using fallback rendering"),t.disciplineRecommendation&&(l=this.addPreviousDisciplinaryActionSection(o,t.disciplineRecommendation,l,c,m,d,u),l=this.addConsequencesSection(o,t,l,c,m,d,u)),t.legalCompliance&&(l=this.addLegalComplianceSection(o,t.legalCompliance,l,c,m,d,u)),t.additionalNotes&&(l=this.addAdditionalNotesSection(o,t.additionalNotes,l,c,m,d,u)),l=this.addEmployeeRightsSection(o,t,l,c,m,d,u);l=this.addSignaturesSection(o,t.signatures,t.employee,l,c,m,d,u,t.issuedDate,t.issuedByName),t.appealDetails&&await this.addAppealReportSection(o,t,l,c,m,d,u),this.addDocumentFooter(o,t,c),a.content.showWatermark&&this.addSecurityWatermark(o,c),"overturned"===t.status&&this.addOverturnedWatermark(o,c);const h=o.output("blob"),g=Date.now();return e.success("✅ v1.2.0 PDF generated successfully:",{warningId:t.warningId,employee:`${t.employee.firstName} ${t.employee.lastName}`,sectionsRendered:a.sections?.filter(e=>e.enabled).length||0,size:`${(h.size/1024).toFixed(1)} KB`,time:g-n+"ms"}),h}catch(r){throw e.error("❌ v1.2.0 PDF generation failed:",r),new Error(`PDF generation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}static addOrganizationHeader(t,s,r,a,n){const i=this.parseColor(s.branding?.colors?.primary)||{r:59,g:130,b:246};t.setFillColor(i.r,i.g,i.b),t.rect(0,0,a,35,"F");let o=0;if(s.branding?.logo)try{const e=20;o=30,t.addImage(s.branding.logo,"PNG",n,7,o,e)}catch(d){e.warn("Failed to add organization logo to PDF:",d),o=0}t.setTextColor(255,255,255),t.setFontSize(20),t.setFont("helvetica","bold");const l=s.branding?.companyName||s.name||"Organization Name";t.text(l,n+o+(o>0?10:0),15),t.setFontSize(10),t.setFont("helvetica","normal");const c=[];return s.address&&c.push(s.address),s.phone&&c.push(`Tel: ${s.phone}`),s.email&&c.push(`Email: ${s.email}`),c.length>0&&t.text(c.join(" | "),n,25),s.registrationNumber&&t.text(`Registration: ${s.registrationNumber}`,n,30),45}static addDocumentTitle(e,t,s,r,a,n,i){s=this.checkPageOverflow(e,s,30,n,i),e.setTextColor(0,0,0),e.setFontSize(18),e.setFont("helvetica","bold");const o=this.getWarningLevelTitle(t.warningLevel),l=(r-e.getTextWidth(o))/2;if(e.text(o,l,s),s+=6,t.validityPeriod&&t.expiryDate){e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const a=this.formatDate(t.expiryDate),n=`Valid for ${t.validityPeriod} months | Expires: ${a}`,i=(r-e.getTextWidth(n))/2;e.text(n,i,s),s+=5,e.setTextColor(0,0,0)}if("Employee"===t.employee?.firstName||"Category Not Selected"===t.category||!t.description?.trim()){e.setFontSize(12),e.setTextColor(200,50,50);const t="[DRAFT - INCOMPLETE DATA]",a=(r-e.getTextWidth(t))/2;e.text(t,a,s+1),s+=6}e.setTextColor(0,0,0),e.setLineWidth(.5),e.line(a,s+2,r-a,s+2),e.setFontSize(10),e.setFont("helvetica","normal");const c=`Document ID: ${t.warningId} | Issue Date: ${this.formatDate(t.issuedDate)}`,d=(r-e.getTextWidth(c))/2;if(e.text(c,d,s+8),s+=10,t.organization?.settings?.codeOfConductReference){e.setFontSize(9),e.setFont("helvetica","italic"),e.setTextColor(80,80,80);const a=`Issued in terms of: ${t.organization.settings.codeOfConductReference}`,n=(r-e.getTextWidth(a))/2;e.text(a,n,s+5),s+=5,e.setTextColor(0,0,0)}return s+10}static addEmployeeSection(e,t,s,r,a,n,i){s=this.checkPageOverflow(e,s,40,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("EMPLOYEE INFORMATION",a,s);const o="Employee"===t.firstName||"Not Selected"===t.lastName;o?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(a,s+2,r-2*a,25),o&&(e.setFillColor(255,245,245),e.rect(a+1,s+3,r-2*a-2,23,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),o?e.setTextColor(150,0,0):e.setTextColor(0,0,0);const l=[`Name: ${t.firstName} ${t.lastName}`,`Employee ID: ${t.employeeNumber}`,`Position: ${t.position}`,`Department: ${t.department}`];t.email&&""!==t.email&&l.push(`Email: ${t.email}`),o&&l.push("⚠️ Complete employee selection in wizard for full details");let c=s+8;return l.forEach(t=>{e.text(t,a+3,c),c+=4}),s+35}static addWarningDetailsSection(e,t,s,r,a,n,i){s=this.checkPageOverflow(e,s,25,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("WARNING DETAILS",a,s);const o="Category Not Selected"===t.category;e.setFontSize(10),e.setFont("helvetica","normal"),o?e.setTextColor(150,0,0):e.setTextColor(0,0,0);let l=s+8;e.text(`Warning Level: ${this.getWarningLevelDisplay(t.warningLevel)}`,a,l),l+=5;const c=t.category&&"Unknown"!==t.category&&"Category Not Selected"!==t.category?t.category:"General Misconduct";return e.text(`Category: ${c}`,a,l),l+=5,t.validityPeriod&&(e.text(`Validity Period: ${t.validityPeriod} months`,a,l),l+=5),l+5}static addIncidentDetailsSection(e,t,s,r,a,n,i){const o=this.calculateIncidentSectionHeight(e,t,r,a);s=this.checkPageOverflow(e,s,o,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("INCIDENT DETAILS",a,s);const l=t.description&&""!==t.description.trim(),c=t.incidentLocation&&""!==t.incidentLocation.trim(),d=!l&&!c,m=this.calculateIncidentSectionHeight(e,t,r,a);d?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(a,s+2,r-2*a,m),d&&(e.setFillColor(255,245,245),e.rect(a+1,s+3,r-2*a-2,m-2,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let u=s+10;e.setFont("helvetica","bold"),e.text("Date & Time:",a+3,u),e.setFont("helvetica","normal"),e.text(`${this.formatDate(t.incidentDate)} at ${t.incidentTime}`,a+30,u),u+=6,e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Location:",a+3,u),e.setFont("helvetica","normal");const h=c?t.incidentLocation:"Not specified";e.text(h,a+25,u),u+=6,e.setFont("helvetica","bold"),e.text("Description:",a+3,u),u+=5,e.setFont("helvetica","normal");const g=l?t.description:"Details to be completed";return this.wrapText(e,g,r-2*a-6).forEach(t=>{e.text(t,a+3,u),u+=4}),s+m+10}static addPreviousDisciplinaryActionSection(t,s,r,a,n,i,o,l){if(!s)return e.warn("⚠️ No recommendation data provided to addPreviousDisciplinaryActionSection"),r;const c=s.activeWarnings||s.previousWarnings||[];t.setFontSize(10),t.setFont("helvetica","normal");let d=8;const m=a-2*n-10;c&&c.length>0?c.forEach((e,s)=>{const r=`${s+1}) Date: ${this.formatDate(e.issuedDate||e.issueDate||new Date)} | Incident: ${e.description||e.incidentDescription||"No description available"} | Level: ${this.getWarningLevelDisplay(e.level||e.warningLevel||"verbal")}`,a=t.splitTextToSize(r,m);d+=5*a.length+2}):d+=5,d+=4;const u=d,h=28+u;r=this.checkPageOverflow(t,r,h,i,o);const g=l?.content?.heading||"PREVIOUS DISCIPLINARY ACTION (Still Valid on File)";t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text(g,n,r),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0),t.setDrawColor(200,200,200),t.setFillColor(248,248,248),t.setLineWidth(.3),t.rect(n,r+4,a-2*n,u,"FD");let p=r+12;return c&&c.length>0?c.forEach((e,s)=>{const r=`${s+1}) Date: ${this.formatDate(e.issuedDate||e.issueDate||new Date)} | Incident: ${e.description||e.incidentDescription||"No description available"} | Level: ${this.getWarningLevelDisplay(e.level||e.warningLevel||"verbal")}`;t.splitTextToSize(r,m).forEach(e=>{t.text(e,n+5,p),p+=5}),p+=2}):t.text("No previous disciplinary action on file",n+5,p),r+u+12}static addPreviousDisciplinaryActionSection_v1_0_0(e,t,s,r,a,n,i){if(!t)return s;const o=t.activeWarnings?.length||0,l=o>0?6*o+20:20,c=28+l;s=this.checkPageOverflow(e,s,c,n,i),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("PREVIOUS DISCIPLINARY ACTION (Still Valid on File)",a,s),e.setDrawColor(200,200,200),e.setFillColor(248,248,248),e.setLineWidth(.3),e.rect(a,s+4,r-2*a,l,"FD"),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let d=s+12;return t.activeWarnings&&t.activeWarnings.length>0?t.activeWarnings.forEach((t,s)=>{const r=`${s+1}) Date: ${this.formatDate(t.issuedDate||t.issueDate||new Date)} | Offense: ${t.category||t.categoryName||"General Misconduct"} | Level: ${this.getWarningLevelDisplay(t.level||t.warningLevel||"verbal")}`;e.text(r,a+5,d),d+=6}):e.text("No previous disciplinary action on file",a+5,d),s+l+12}static addConsequencesSection(t,s,r,a,n,i,o,l){if(!l?.content)return e.warn("⚠️ No section config provided for Consequences section, skipping"),r;if(!(l.content.body||l.content.bulletPoints&&l.content.bulletPoints.length>0))return e.warn("⚠️ Consequences section config has no body or bulletPoints, skipping"),r;const c=l.content.heading||"WARNING: CONSEQUENCES IF EMPLOYEE\nDOES NOT CHANGE BEHAVIOUR";t.setFontSize(10),t.setFont("helvetica","normal");let d=0;if(l.content.body){const e=this.replacePlaceholders(l.content.body,s),r=this.wrapText(t,e,a-2*n-15);d+=r.length}l.content.bulletPoints&&l.content.bulletPoints.length>0&&l.content.bulletPoints.forEach(e=>{const r=this.replacePlaceholders(e,s),i=this.wrapText(t,r,a-2*n-15);d+=i.length});const m=8+5*d+8,u=5*c.split("\n").length,h=u+m+15;r=this.checkPageOverflow(t,r,h,i,o),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51);c.split("\n").forEach((e,s)=>{t.text(e,n,r+5*s)}),t.setFillColor(254,226,226),t.setDrawColor(239,68,68),t.setLineWidth(.5),t.rect(n,r+u+3,a-2*n,m,"FD"),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(127,29,29);let g=r+u+11;if(l.content.body){const e=this.replacePlaceholders(l.content.body,s);this.wrapText(t,e,a-2*n-15).forEach(e=>{""===e.trim()?g+=3:(t.text(e,n+5,g),g+=5)})}return l.content.bulletPoints&&l.content.bulletPoints.length>0&&l.content.bulletPoints.forEach(e=>{const r=this.replacePlaceholders(e,s);this.wrapText(t,r,a-2*n-15).forEach(e=>{""===e.trim()?g+=3:(t.text(e,n+5,g),g+=5)})}),r+u+m+15}static addLegalComplianceSection(e,t,s,r,a,n,i){if(!t)return s;s=this.checkPageOverflow(e,s,30,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("LEGAL COMPLIANCE",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let o=s+8;return e.text(`Framework: ${t.framework}`,a,o),o+=5,e.text("Compliance Status: "+(t.isCompliant?"COMPLIANT":"NON-COMPLIANT"),a,o),o+=5,t.requirements.length>0&&(e.text("Legal Requirements:",a,o),o+=4,t.requirements.forEach(t=>{e.text(`• ${t}`,a+3,o),o+=4})),o+5}static addAdditionalNotesSection(e,t,s,r,a,n,i){const o=this.wrapText(e,t,r-2*a),l=15+4*o.length;s=this.checkPageOverflow(e,s,l,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("ADDITIONAL NOTES",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=s+8;return o.forEach(t=>{e.text(t,a,c),c+=4}),c+5}static addEmployeeStatementSection(e,t,s,r,a,n,i){const o=this.wrapText(e,t,r-2*a-6),l=20+5*o.length;s=this.checkPageOverflow(e,s,l,n,i),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(100,100,100),e.text("EMPLOYEE'S VERSION OF EVENTS",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=s+8;return o.forEach(t=>{""===t.trim()?c+=3:(e.text(t,a,c),c+=5)}),c+8}static addExpectedBehaviorSection(e,t,s,r,a,n,i){const o=this.wrapText(e,t,r-2*a-6),l=20+5*o.length;s=this.checkPageOverflow(e,s,l,n,i),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(100,100,100),e.text("REQUIRED/EXPECTED BEHAVIOR & STANDARDS",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=s+8;return o.forEach(t=>{""===t.trim()?c+=3:(e.text(t,a,c),c+=5)}),c+8}static addFactsLeadingToDecisionSection(e,t,s,r,a,n,i){const o=this.wrapText(e,t,r-2*a-6),l=20+5*o.length;s=this.checkPageOverflow(e,s,l,n,i),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(100,100,100),e.text("FACTS & REASONING FOR DISCIPLINARY ACTION",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=s+8;return o.forEach(t=>{""===t.trim()?c+=3:(e.text(t,a,c),c+=5)}),c+8}static addImprovementCommitmentsSection(e,t,s,r,a,n,i){let o=0;t.forEach(t=>{const s=this.wrapText(e,t.commitment,r-2*a-12);o+=s.length+1});const l=20+4*o;s=this.checkPageOverflow(e,s,l,n,i),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(100,100,100),e.text("ACTION STEPS & IMPROVEMENT COMMITMENTS",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=s+8;return t.forEach((t,s)=>{e.setFont("helvetica","bold"),e.text(`${s+1}.`,a,c),e.setFont("helvetica","normal");const n=this.wrapText(e,t.commitment,r-2*a-12);n.forEach((t,s)=>{e.text(t,a+6,c+4*s)}),c+=4*n.length,e.setFont("helvetica","italic"),e.setTextColor(80,80,80),e.text(`Timeline: ${t.timeline}`,a+6,c),e.setTextColor(0,0,0),c+=6}),c+8}static addReviewDateSection(e,t,s,r,a,n,i,o){s=this.checkPageOverflow(e,s,60,n,i),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(100,100,100),e.text("REVIEW DATE AND AUTO-SATISFACTION CLAUSE",a,s);const l=this.formatDate(t);e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0);const c=e.getTextWidth(l);let d;if(e.setFillColor(220,252,231),e.rect(a,s+3,c+4,6,"F"),e.text(l,a+2,s+8),e.setFontSize(9),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Automatic Satisfaction Clause:",a,s+18),e.setFont("helvetica","normal"),e.setTextColor(60,60,60),"suspension"===o||"dismissal"===o)return s+18;d="final_written"===o?"If the required improvements are not demonstrated by the review date and no follow-up disciplinary action is taken within 7 days thereafter, this matter will be considered resolved. However, if performance or conduct issues persist, additional corrective action or further disciplinary measures may be initiated.":"If no follow-up action is required by management within 7 days of this review date, the employee's performance and conduct will be deemed satisfactory, and this matter will be considered resolved. If performance or conduct issues persist, additional corrective action or disciplinary measures may be initiated at that time.";const m=r-2*a,u=this.wrapText(e,d,m);let h=s+24;return u.forEach(t=>{e.text(t,a,h),h+=4}),h+8}static addInterventionDetailsSection(e,t,s,r,a,n,i){const o=this.wrapText(e,t,r-2*a-6),l=20+4*o.length;s=this.checkPageOverflow(e,s,l,n,i),e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(100,100,100),e.text("TRAINING/COACHING PROVIDED",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=s+8;return o.forEach(t=>{e.text(t,a,c),c+=4}),c+8}static addEmployeeRightsSection(t,s,r,a,n,i,o,l){if(!l?.content?.subsections||0===l.content.subsections.length)return e.warn("⚠️ No subsections in Employee Rights config, skipping"),r;r=this.checkPageOverflow(t,r,110,i,o);const c=l.content.heading||"EMPLOYEE RIGHTS AND NEXT STEPS";t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text(c,n,r);const d=a-2*n,m=n+8,u=r+4;let h=r+14;const g=h;l.content.subsections.forEach((e,r)=>{if(h+=0,h+=7,Array.isArray(e.content))e.content.forEach(e=>{const r=this.replacePlaceholders(e,s),a=this.wrapText(t,r,d-20);h+=5*a.length,h+=2.5});else{const r=this.replacePlaceholders(e.content,s),a=this.wrapText(t,r,d-20);h+=5*a.length}r<l.content.subsections.length-1&&(h+=3.5)}),h+=8;const p=h-u;return t.setFillColor(239,246,255),t.setDrawColor(59,130,246),t.setLineWidth(.5),t.rect(n,u,d,p,"FD"),h=g,l.content.subsections.forEach((e,r)=>{if(t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(37,99,235),t.text(e.title,m,h),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0),h+=7,Array.isArray(e.content))e.content.forEach(e=>{const r=this.replacePlaceholders(e,s);this.wrapText(t,r,d-20).forEach(e=>{t.text(e,m,h),h+=5}),h+=2.5});else{const r=this.replacePlaceholders(e.content,s);this.wrapText(t,r,d-20).forEach(e=>{t.text(e,m,h),h+=5})}r<l.content.subsections.length-1&&(h+=3.5)}),h+=8,h+5}static addSignaturesSection(t,s,r,a,n,i,o,l,c,d){a=this.checkPageOverflow(t,a,65,o,l),a+=8,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("SIGNATURES",i,a),a+=7;const m=(n-3*i)/2,u=45;if(t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(80,80,80),t.text("Manager Signature:",i,a),t.setDrawColor(150,150,150),t.setLineWidth(.3),t.setTextColor(0,0,0),t.rect(i,a+3,m,u),s?.manager)try{const e=m-16,r=35,n=t.getImageProperties(s.manager),o=n.width,l=o/n.height;let h=e,g=e/l;g>r&&(g=r,h=r*l);const p=(m-h)/2,x=5;t.addImage(s.manager,"PNG",i+p,a+3+x,h,g),t.setFontSize(7),t.setFont("helvetica","normal");const f=d||"_____________________";t.text(`Manager Name: ${f}`,i+2,a+u+7),t.text(`Date: ${this.formatDate(c||new Date)}`,i+2,a+u+11)}catch(g){e.warn("Failed to embed manager signature image:",g),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("✓ Digitally Signed",i+5,a+25);const s=d||"_____________________";t.text(`Manager Name: ${s}`,i+2,a+u+7),t.text(`Date: ${this.formatDate(c||new Date)}`,i+2,a+u+11)}else{t.setFontSize(8),t.setFont("helvetica","normal"),t.text("_____________________",i+5,a+30);const e=d||"_____________________";t.text(`Manager Name: ${e}`,i+2,a+u+7),t.text("Date: ___________",i+2,a+u+11)}const h=i+m+10;if(t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(80,80,80),t.text("Employee Signature:",h,a),t.setDrawColor(150,150,150),t.setLineWidth(.3),t.setTextColor(0,0,0),t.rect(h,a+3,m,u),s?.employee)try{const e=m-16,n=35,i=t.getImageProperties(s.employee),o=i.width,l=o/i.height;let d=e,g=e/l;g>n&&(g=n,d=n*l);const p=(m-d)/2,x=5;t.addImage(s.employee,"PNG",h+p,a+3+x,d,g),t.setFontSize(7),t.setFont("helvetica","normal"),t.text(`${r.firstName} ${r.lastName}`,h+2,a+u+7),t.text(`Date: ${this.formatDate(c||new Date)}`,h+2,a+u+11)}catch(g){e.warn("Failed to embed employee signature image:",g),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("✓ Digitally Signed",h+5,a+25),t.text(`${r.firstName} ${r.lastName}`,h+2,a+u+7),t.text(`Date: ${this.formatDate(c||new Date)}`,h+2,a+u+11)}else t.setFontSize(8),t.setFont("helvetica","normal"),t.text("_____________________",h+5,a+30),t.text(`${r.firstName} ${r.lastName}`,h+2,a+u+7),t.text("Date: ___________",h+2,a+u+11);if(s?.witness){a+=63,t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(80,80,80),t.text("Witness Signature:",i,a),t.setDrawColor(150,150,150),t.setLineWidth(.3),t.setTextColor(0,0,0),t.rect(i,a+3,m,u);try{const e=m-16,r=35,n=t.getImageProperties(s.witness),o=n.width,l=o/n.height;let d=e,h=e/l;h>r&&(h=r,d=r*l);const g=(m-d)/2,p=5;t.addImage(s.witness,"PNG",i+g,a+3+p,d,h),t.setFontSize(7),t.setFont("helvetica","normal");const x=s.witnessName||"_____________________";t.text(`Witness Name: ${x}`,i+2,a+u+7),t.text(`Date: ${this.formatDate(c||new Date)}`,i+2,a+u+11)}catch(g){e.warn("Failed to embed witness signature image:",g),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("✓ Digitally Signed (Witness)",i+5,a+25);const r=s.witnessName||"_____________________";t.text(`Witness Name: ${r}`,i+2,a+u+7),t.text(`Date: ${this.formatDate(c||new Date)}`,i+2,a+u+11)}return a+u+12}return a+u+12}static addDeliverySection(e,t,s,r,a,n,i){if(!t)return s;s=this.checkPageOverflow(e,s,20,n,i),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("DELIVERY INFORMATION",a,s),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let o=s+6;return e.text(`Delivery Method: ${t.method.toUpperCase()}`,a,o),o+=4,e.text(`Delivery Date: ${this.formatDate(t.timestamp)}`,a,o),o+=4,e.text(`Authorized by: ${t.chosenBy}`,a,o),o+8}static addAppealHistorySection(e,t,s,r,a,n,i){s=this.checkPageOverflow(e,s,40,n,i),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(102,45,145),e.text("APPEAL HISTORY",a,s);let o=s+6;if(t.appealDetails){if(e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Employee Appeal Submission",a,o),o+=5,e.setFont("helvetica","normal"),e.setFontSize(9),t.appealDetails.submittedAt&&(e.text(`Submitted: ${this.formatDate(t.appealDetails.submittedAt)}`,a,o),o+=4),t.appealDetails.submittedBy&&(e.text(`Submitted by: ${t.appealDetails.submittedBy}`,a,o),o+=4),t.appealDetails.grounds){e.setFont("helvetica","bold"),e.text("Grounds for Appeal:",a,o),o+=4,e.setFont("helvetica","normal");const s=e.splitTextToSize(t.appealDetails.grounds,r-2*a-5);e.text(s,a+5,o),o+=4*s.length+2}if(t.appealDetails.details){e.setFont("helvetica","bold"),e.text("Additional Details:",a,o),o+=4,e.setFont("helvetica","normal");const s=e.splitTextToSize(t.appealDetails.details,r-2*a-5);e.text(s,a+5,o),o+=4*s.length+2}if(t.appealDetails.requestedOutcome){e.setFont("helvetica","bold"),e.text("Requested Outcome:",a,o),o+=4,e.setFont("helvetica","normal");const s=e.splitTextToSize(t.appealDetails.requestedOutcome,r-2*a-5);e.text(s,a+5,o),o+=4*s.length+4}}if(t.appealOutcome){o=this.checkPageOverflow(e,o,30,n,i),e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("HR Decision",a,o),o+=5,e.setFont("helvetica","normal"),e.setFontSize(9),t.appealDecisionDate&&(e.text(`Decision Date: ${this.formatDate(t.appealDecisionDate)}`,a,o),o+=4),e.setFont("helvetica","bold"),e.text("Outcome: ",a,o);const s="overturned"===t.appealOutcome?"WARNING OVERTURNED":"upheld"===t.appealOutcome?"APPEAL DENIED - WARNING STANDS":"modified"===t.appealOutcome?"WARNING MODIFIED":"reduced"===t.appealOutcome?"WARNING REDUCED":t.appealOutcome.toUpperCase();if("overturned"===t.appealOutcome?e.setTextColor(34,139,34):"upheld"===t.appealOutcome?e.setTextColor(178,34,34):e.setTextColor(255,140,0),e.text(s,a+20,o),e.setTextColor(0,0,0),o+=5,t.appealReasoning){e.setFont("helvetica","bold"),e.text("HR Reasoning:",a,o),o+=4,e.setFont("helvetica","normal");const s=e.splitTextToSize(t.appealReasoning,r-2*a-5);e.text(s,a+5,o),o+=4*s.length+2}if(t.hrNotes){e.setFont("helvetica","bold"),e.text("HR Notes:",a,o),o+=4,e.setFont("helvetica","normal");const s=e.splitTextToSize(t.hrNotes,r-2*a-5);e.text(s,a+5,o),o+=4*s.length+2}if(t.followUpRequired){e.setDrawColor(255,193,7),e.setFillColor(255,248,220),e.roundedRect(a,o,r-2*a,10,2,2,"FD"),e.setFont("helvetica","bold"),e.setTextColor(139,69,19);const s=t.followUpDate?`⚠ Follow-up Required by ${this.formatDate(t.followUpDate)}`:"⚠ Follow-up Required";e.text(s,a+2,o+6),e.setTextColor(0,0,0),o+=12}}return o+8}static addDocumentFooter(e,t,s){const r=e.internal.pageSize.height,a=e.getNumberOfPages();for(let n=1;n<=a;n++){e.setPage(n),e.setDrawColor(180,180,180),e.setLineWidth(.3),e.line(20,r-25,s-20,r-25),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(120,120,120);const t="This document has been generated electronically and constitutes an official warning as per LRA Section 188.",i=(s-e.getTextWidth(t))/2;e.text(t,i,r-20);const o="CONFIDENTIAL DOCUMENT - For authorized personnel only",l=(s-e.getTextWidth(o))/2;e.text(o,l,r-15);const c=`Page ${n} of ${a}`,d=(s-e.getTextWidth(c))/2;e.text(c,d,r-10)}}static addSecurityWatermark(e,t){const s=e.internal.pageSize.height,r=e.getNumberOfPages();for(let a=1;a<=r;a++){e.setPage(a),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.1})),e.setTextColor(150,150,150),e.setFontSize(40),e.setFont("helvetica","bold");const r=t/2,n=s/2;e.text("OFFICIAL WARNING",r,n,{angle:45,align:"center"}),e.restoreGraphicsState()}}static addOverturnedWatermark(e,t){const s=e.internal.pageSize.height,r=e.getNumberOfPages();for(let a=1;a<=r;a++){e.setPage(a),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.35})),e.setTextColor(255,0,0),e.setFontSize(60),e.setFont("helvetica","bold");const r=t/2,n=s/2;e.text("OVERTURNED",r,n,{angle:45,align:"center"}),e.restoreGraphicsState()}}static async generateAppealReportPDF(t){try{const{default:s}=await _(async()=>{const{default:e}=await import("./pdf-vendor-CbrIsI36.js").then(e=>e.j);return{default:e}},[]),r=new s({orientation:"portrait",unit:"mm",format:"a4"}),a=r.internal.pageSize.width,n=r.internal.pageSize.height,i=20;let o=20;if(r.setFillColor(37,99,235),r.rect(0,0,a,40,"F"),r.setTextColor(255,255,255),r.setFontSize(22),r.setFont("helvetica","bold"),r.text("APPEAL DECISION REPORT",a/2,18,{align:"center"}),r.setFontSize(11),r.setFont("helvetica","normal"),r.text(t.organization.name,a/2,28,{align:"center"}),o=50,r.setDrawColor(200,200,200),r.setFillColor(248,248,248),r.roundedRect(i,o,a-2*i,35,3,3,"FD"),r.setTextColor(0,0,0),r.setFontSize(10),r.setFont("helvetica","bold"),r.text("Warning Reference",i+5,o+7),r.setFont("helvetica","normal"),r.setFontSize(9),r.text(`Warning ID: ${t.warningId}`,i+5,o+13),r.text(`Employee: ${t.employee.firstName} ${t.employee.lastName} (${t.employee.employeeNumber})`,i+5,o+18),r.text(`Department: ${t.employee.department}`,i+5,o+23),r.text(`Warning Level: ${t.warningLevel}`,i+5,o+28),r.text(`Original Issue Date: ${this.formatDate(t.issueDate)}`,a-i-60,o+13),r.text(`Category: ${t.category}`,a-i-60,o+18),o+=43,t.appealDetails){if(r.setFontSize(14),r.setFont("helvetica","bold"),r.setTextColor(102,45,145),r.text("1. APPEAL SUBMISSION",i,o),o+=8,r.setFillColor(245,243,255),r.setDrawColor(167,139,250),r.roundedRect(i,o,a-2*i,12,2,2,"FD"),r.setTextColor(0,0,0),r.setFontSize(9),r.setFont("helvetica","bold"),r.text(`Submitted: ${t.appealDetails.submittedAt?this.formatDate(t.appealDetails.submittedAt):"N/A"}`,i+5,o+5),r.text(`By: ${t.appealDetails.submittedBy||"Employee"}`,i+5,o+9),o+=15,t.appealDetails.grounds){r.setFont("helvetica","bold"),r.setFontSize(10),r.text("Grounds for Appeal:",i,o),o+=5,r.setFont("helvetica","normal"),r.setFontSize(9);const e=r.splitTextToSize(t.appealDetails.grounds,a-2*i-10);r.text(e,i+5,o),o+=4*e.length+5}if(t.appealDetails.details){r.setFont("helvetica","bold"),r.setFontSize(10),r.text("Additional Details:",i,o),o+=5,r.setFont("helvetica","normal"),r.setFontSize(9);const e=r.splitTextToSize(t.appealDetails.details,a-2*i-10);r.text(e,i+5,o),o+=4*e.length+5}if(t.appealDetails.requestedOutcome){r.setFont("helvetica","bold"),r.setFontSize(10),r.text("Requested Outcome:",i,o),o+=5,r.setFont("helvetica","normal"),r.setFontSize(9);const e=r.splitTextToSize(t.appealDetails.requestedOutcome,a-2*i-10);r.text(e,i+5,o),o+=4*e.length+8}}if(t.appealOutcome){o>n-100&&(r.addPage(),o=20),r.setFontSize(14),r.setFont("helvetica","bold"),r.setTextColor(102,45,145),r.text("2. HR DECISION",i,o),o+=8,r.setFillColor(245,243,255),r.setDrawColor(167,139,250),r.roundedRect(i,o,a-2*i,8,2,2,"FD"),r.setTextColor(0,0,0),r.setFontSize(9),r.setFont("helvetica","bold"),r.text(`Decision Date: ${t.appealDecisionDate?this.formatDate(t.appealDecisionDate):"Pending"}`,i+5,o+5),o+=12;const e="overturned"===t.appealOutcome?"APPEAL APPROVED - WARNING OVERTURNED":"upheld"===t.appealOutcome?"APPEAL DENIED - WARNING STANDS":"modified"===t.appealOutcome?"APPEAL PARTIALLY APPROVED - WARNING MODIFIED":"reduced"===t.appealOutcome?"APPEAL PARTIALLY APPROVED - WARNING REDUCED":t.appealOutcome.toUpperCase();if("overturned"===t.appealOutcome?r.setFillColor(34,197,94):"upheld"===t.appealOutcome?r.setFillColor(239,68,68):r.setFillColor(251,146,60),r.roundedRect(i,o,a-2*i,15,3,3,"F"),r.setTextColor(255,255,255),r.setFontSize(12),r.setFont("helvetica","bold"),r.text(e,a/2,o+10,{align:"center"}),o+=20,t.appealReasoning){r.setTextColor(0,0,0),r.setFont("helvetica","bold"),r.setFontSize(10),r.text("HR Reasoning:",i,o),o+=5,r.setFont("helvetica","normal"),r.setFontSize(9);const e=r.splitTextToSize(t.appealReasoning,a-2*i-10);r.text(e,i+5,o),o+=4*e.length+5}if(t.hrNotes){r.setFont("helvetica","bold"),r.setFontSize(10),r.text("HR Notes:",i,o),o+=5,r.setFont("helvetica","normal"),r.setFontSize(9);const e=r.splitTextToSize(t.hrNotes,a-2*i-10);r.text(e,i+5,o),o+=4*e.length+5}if(t.followUpRequired){r.setDrawColor(251,191,36),r.setFillColor(254,252,232),r.roundedRect(i,o,a-2*i,12,2,2,"FD"),r.setTextColor(146,64,14),r.setFontSize(10),r.setFont("helvetica","bold");const e=t.followUpDate?`⚠ FOLLOW-UP REQUIRED BY: ${this.formatDate(t.followUpDate)}`:"⚠ FOLLOW-UP REQUIRED";r.text(e,i+5,o+7),o+=15}}o<n-80?o=n-75:(r.addPage(),o=20),r.setFontSize(10),r.setFont("helvetica","bold"),r.setTextColor(0,0,0),r.text("HR Authorization:",i,o),o+=10,r.setDrawColor(0,0,0),r.line(i,o,i+70,o),r.setFontSize(8),r.setFont("helvetica","normal"),r.text("HR Manager Signature",i,o+5),r.line(a-i-70,o,a-i,o),r.text("Date",a-i-35,o+5);const l=r.getNumberOfPages(),c=n-25;for(let e=1;e<=l;e++){r.setPage(e),r.setDrawColor(180,180,180),r.setLineWidth(.3),r.line(i,c,a-i,c),r.setFontSize(8),r.setFont("helvetica","normal"),r.setTextColor(120,120,120);const t="Official Appeal Decision Report - Confidential HR Document";r.text(t,a/2,c+5,{align:"center"}),r.text(`Page ${e} of ${l}`,a/2,c+10,{align:"center"})}return e.success("✅ Appeal Report PDF generated"),r.output("blob")}catch(s){throw e.error("❌ Failed to generate appeal report:",s),console.error("Appeal report generation error details:",s),console.error("Stack trace:",s instanceof Error?s.stack:"No stack trace"),s instanceof Error?s:new Error("Failed to generate appeal report PDF")}}static checkPageOverflow(e,t,s,r,a){return t+s>r-a?(e.addPage(),20):t}static addPageHeader(e,t,s){const r=e.internal.pageSize.width;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const a=`${t.organization.name} - Warning Document (Continued)`;e.text(a,20,10);const n=`Page ${s}`;e.text(n,r-40,10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(20,12,r-20,12)}static renderDynamicSection(e,t,s,r,a,n,i,o,l){if(!t.enabled)return r;const c=30+7*(t.content.bulletPoints?.length||0);r=this.checkPageOverflow(e,r,c,i,o);const d=t.styling?.headingFontSize||l.styling.fontSize+1||12,m=t.styling?.headingColor||l.styling.sectionHeaderColor||"#333333";e.setFontSize(d),e.setFont("helvetica","bold");const u=this.hexToRGB(m);e.setTextColor(u.r,u.g,u.b);const h=kr.replacePlaceholders(t.content.heading,s);e.text(h,n,r);let g=r+(t.styling?.spacingBefore||8);if(t.content.body){const r=t.styling?.bodyFontSize||l.styling.fontSize||11,c=t.styling?.bodyColor||l.styling.bodyTextColor||"#000000";e.setFontSize(r),e.setFont("helvetica","normal");const d=this.hexToRGB(c);e.setTextColor(d.r,d.g,d.b);const m=kr.replacePlaceholders(t.content.body,s),u=a-2*n-(t.styling?.indent||0);this.wrapText(e,m,u).forEach(s=>{g=this.checkPageOverflow(e,g,6,i,o),e.text(s,n+(t.styling?.indent||0),g),g+=5}),g+=3}if(t.content.bulletPoints&&t.content.bulletPoints.length>0){const r=t.styling?.bodyFontSize||l.styling.fontSize||11;e.setFontSize(r),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);kr.replacePlaceholdersInArray(t.content.bulletPoints,s).forEach(s=>{g=this.checkPageOverflow(e,g,10,i,o);const r=`• ${s}`,l=a-2*n-(t.styling?.indent||0)-5;this.wrapText(e,r,l).forEach((s,r)=>{g=this.checkPageOverflow(e,g,5,i,o);const a=0===r?0:5;e.text(s,n+(t.styling?.indent||0)+a,g),g+=5}),g+=1}),g+=2}return t.content.tableData&&(g=this.renderTableSection(e,t.content.tableData,s,g,a,n,i,o,t.styling)),g+=t.styling?.spacingAfter||5,g}static renderTableSection(e,t,s,r,a,n,i,o,l){let c=r;const d=(a-2*n)/t.headers.length;return e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),t.headers.forEach((t,s)=>{const r=n+s*d;e.text(t,r,c)}),c+=6,e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(n,c,a-n,c),c+=4,e.setFont("helvetica","normal"),t.rows.forEach(t=>{c=this.checkPageOverflow(e,c,8,i,o),t.forEach((t,r)=>{const a=n+r*d,i=kr.replacePlaceholders(t,s);e.text(i,a,c)}),c+=6}),c+3}static hexToRGB(e){e=e.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}static getWarningLevelDisplay(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Ending of Service"}[e]||e.replace("_"," ").toUpperCase()}static getWarningLevelTitle(e){return{counselling:"COUNSELLING SESSION RECORD",verbal:"VERBAL WARNING NOTICE",first_written:"WRITTEN WARNING",second_written:"SECOND WRITTEN WARNING",final_written:"FINAL WRITTEN WARNING",suspension:"SUSPENSION NOTICE",dismissal:"ENDING OF SERVICE NOTICE"}[e]||"WARNING NOTICE"}static formatDate(e){let t;return t=e?void 0!==e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:"string"==typeof e||"number"==typeof e?new Date(e):new Date:new Date,t.toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})}static wrapText(e,t,s){const r=[];return t.split("\n").forEach(t=>{const a=t.trim();if(!a)return void r.push("");const n=a.split(" ");let i="";n.forEach(t=>{const a=i+(i?" ":"")+t;e.getTextWidth(a)<=s?i=a:(i&&r.push(i),i=t)}),i&&r.push(i)}),r}static calculateIncidentSectionHeight(e,t,s,r){let a=25;const n=t.description&&""!==t.description.trim()?t.description:"[Incident description not provided - complete in wizard]";a+=4*this.wrapText(e,n,s-2*r-6).length;const i=t.description&&""!==t.description.trim(),o=t.incidentLocation&&""!==t.incidentLocation.trim();return!i&&!o&&(a+=10),Math.max(a,45)}static parseColor(e){if(!e)return null;if(e.startsWith("#")){const t=e.substring(1);if(6===t.length)return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}return null}static async generateSimplifiedPDF(t){try{const{default:e}=await _(async()=>{const{default:e}=await import("./pdf-vendor-CbrIsI36.js").then(e=>e.j);return{default:e}},[]),s=new e({orientation:"portrait",unit:"mm",format:"a4",compress:!0});let r=20;const a=15,n=6;s.setFont("helvetica","normal"),s.setFontSize(16),s.text("DISCIPLINARY WARNING",a,r),r+=2*n,s.setFontSize(12),t.organization?.name&&(s.text(`Organization: ${t.organization.name}`,a,r),r+=n),r+=n,s.setFontSize(11),s.text("EMPLOYEE DETAILS:",a,r),r+=n,s.setFontSize(10);[`Name: ${t.employee.firstName} ${t.employee.lastName}`,`Employee ID: ${t.employee.employeeNumber}`,`Department: ${t.employee.department}`,`Position: ${t.employee.position}`].forEach(e=>{s.text(e,a+5,r),r+=n}),r+=n,s.setFontSize(11),s.text("WARNING DETAILS:",a,r),r+=n,s.setFontSize(10);[`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,`Location: ${t.incidentLocation||"Not specified"}`].forEach(e=>{s.text(e,a+5,r),r+=n}),r+=n,s.setFontSize(11),s.text("INCIDENT DESCRIPTION:",a,r),r+=n,s.setFontSize(10);const i=170;s.splitTextToSize(t.description,i).forEach(e=>{r>270&&(s.addPage(),r=20),s.text(e,a+5,r),r+=n}),r+=2*n,r>240&&(s.addPage(),r=20),s.setFontSize(11),s.text("SIGNATURES:",a,r),r+=2*n,s.setFontSize(10),s.text("Manager: ________________________",a,r),r+=n,s.text(`Date: ${t.issuedDate.toLocaleDateString()}`,a,r),r+=3*n,s.text("Employee: _______________________ ",a,r),r+=n,s.text("Date: _______________",a,r);const o=s.internal.pageSize.height;s.setFontSize(8),s.text("Generated by HR System - Simplified for mobile device",a,o-10);const l=s.output("blob");return window.gc&&setTimeout(()=>window.gc(),100),l}catch(s){return e.error("❌ Simplified PDF generation failed:",s),this.generatePlainTextPDF(t)}}static async generatePlainTextPDF(t){try{const{default:e}=await _(async()=>{const{default:e}=await import("./pdf-vendor-CbrIsI36.js").then(e=>e.j);return{default:e}},[]),s=new e;s.setFontSize(12);let r=20;const a=10;return["DISCIPLINARY WARNING","",`Employee: ${t.employee.firstName} ${t.employee.lastName}`,`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,"","Description:",t.description,"","This is a simplified version generated for older devices."].forEach(e=>{r>280&&(s.addPage(),r=20),s.text(e,20,r),r+=a}),s.output("blob")}catch(s){throw e.error("❌ Even plain text PDF failed:",s),new Error("PDF generation not supported on this device")}}}const Rr=Object.freeze(Object.defineProperty({__proto__:null,PDFGenerationService:_r,PDF_GENERATOR_VERSION:Ar},Symbol.toStringTag,{value:"Module"}));class Fr{static incrementVersion(t,s="minor"){const r=t.split(".").map(Number);let[a,n,i]=r;if(3!==r.length||r.some(isNaN))return e.warn(`⚠️ Invalid version format: ${t}, defaulting to 1.0.0`),"1.0.1";switch(s){case"patch":i+=1;break;case"minor":n+=1,i=0;break;case"major":a+=1,n=0,i=0}return`${a}.${n}.${i}`}static async saveTemplate(t,s,r){try{const n=P(a,"organizations",t),i=await U(n);let o=s.generatorVersion;const l=i.exists()?i.data()?.pdfSettings:null;if(l){const e=l.generatorVersion||"1.0.0",t=JSON.stringify(s.content)!==JSON.stringify(l.content)||JSON.stringify(s.sections)!==JSON.stringify(l.sections),r=JSON.stringify(s.styling)!==JSON.stringify(l.styling);o=t?this.incrementVersion(e,"minor"):r?this.incrementVersion(e,"patch"):e}const c={...s,generatorVersion:o,lastUpdated:new Date,updatedBy:r};c.versionHistory||(c.versionHistory=[]),c.versionHistory.push({version:o,activatedAt:new Date,activatedBy:r,previousVersion:l?.generatorVersion,reason:"Template updated via SuperAdmin dashboard"}),await M(n,{pdfSettings:c,updatedAt:new Date}),e.success("✅ PDF template saved successfully:",{organizationId:t,version:o,versionHistoryLength:c.versionHistory.length})}catch(n){throw e.error("❌ Failed to save PDF template:",n),new Error(`Failed to save PDF template: ${n instanceof Error?n.message:"Unknown error"}`)}}static getDefaultSettings(e="system"){return{generatorVersion:Ar,lastUpdated:new Date,updatedBy:e,styling:{headerBackground:"#3B82F6",sectionHeaderColor:"#333333",bodyTextColor:"#000000",borderColor:"#C8C8C8",useBrandColors:!0,fontSize:11,fontFamily:"Helvetica",lineHeight:1.4,pageSize:"A4",margins:{top:20,bottom:20,left:20,right:20}},content:{showLogo:!0,logoPosition:"top-left",logoMaxHeight:20,enabledSections:["employee-info","incident","previous-warnings","consequences","rights","signatures"],showWatermark:!0,watermarkText:"CONFIDENTIAL",watermarkOpacity:.1,footerText:"Confidential & Privileged",showPageNumbers:!0,legalTextVersion:"south-africa-lra"},features:{enablePreviousWarnings:!0,enableConsequences:!0,enableEmployeeRights:!0,enableAppealSection:!0,enableSignatures:!0},sections:[{id:"employee-statement",type:"standard",name:"Employee Statement (Section B)",enabled:!0,order:-5,content:{heading:"EMPLOYEE'S VERSION OF EVENTS",body:""},description:"Employee's side of the story - what happened from their perspective (Section B)",isLocked:!1,requiredFields:["employeeStatement"],createdAt:new Date,createdBy:e},{id:"facts-leading-to-decision",type:"standard",name:"Facts Leading to Decision (Section E)",enabled:!0,order:-4,content:{heading:"FACTS AND REASONING FOR DISCIPLINARY ACTION",body:""},description:"Manager's reasoning - why this disciplinary action was taken (Section E)",isLocked:!1,requiredFields:["factsLeadingToDecision"],createdAt:new Date,createdBy:e},{id:"expected-behavior-standards",type:"standard",name:"Expected Behavior & Standards (Section C)",enabled:!0,order:-3,content:{heading:"REQUIRED/EXPECTED BEHAVIOR & PERFORMANCE STANDARDS",body:""},description:"Clear expectations - what behavior/performance is required going forward (Section C)",isLocked:!1,requiredFields:["expectedBehaviorStandards"],createdAt:new Date,createdBy:e},{id:"improvement-commitments",type:"standard",name:"Improvement Commitments & Action Steps (Section F)",enabled:!0,order:-2,content:{heading:"ACTION STEPS & IMPROVEMENT COMMITMENTS",body:"The employee has committed to the following actions to improve their conduct/performance:"},description:"Specific actions the employee will take to improve (Section F)",isLocked:!1,requiredFields:["improvementCommitments"],createdAt:new Date,createdBy:e},{id:"review-date",type:"standard",name:"Follow-Up Review",enabled:!0,order:-1,content:{heading:"FOLLOW-UP REVIEW",body:"A follow-up review meeting has been scheduled to assess your progress. If you demonstrate satisfactory improvement and no further issues arise within 7 days after this review date, this warning will be considered resolved."},description:"Follow-up review date with automatic resolution clause (7-day grace period)",isLocked:!1,requiredFields:["reviewDate"],createdAt:new Date,createdBy:e},{id:"previous-disciplinary-actions",type:"standard",name:"Previous Disciplinary Actions",enabled:!0,order:0,content:{heading:"PREVIOUS DISCIPLINARY ACTION (Still Valid on File)",body:"The following disciplinary actions are still active and valid on file:"},description:"Displays employee's previous warnings for progressive discipline tracking (gray box with numbered list)",isLocked:!1,requiredFields:[],createdAt:new Date,createdBy:e},{id:"consequences-section",type:"standard",name:"Consequences Section",enabled:!0,order:1,content:{heading:"WARNING: CONSEQUENCES OF CONTINUED MISCONDUCT",body:"Further misconduct will result in additional discipline, including formal hearings, up to ending of service. All unexpired warnings accumulate.",bulletPoints:[]},description:"Warning box about consequences (matches script read aloud)",isLocked:!1,requiredFields:["issuedDate"],createdAt:new Date,createdBy:e},{id:"employee-rights-lra",type:"standard",name:"Employee Rights and Next Steps",enabled:!0,order:2,content:{heading:"YOUR RIGHTS UNDER THE LABOUR RELATIONS ACT",subsections:[{title:"Your Rights:",content:["• You may appeal to HR in writing within 48 hours.","• You may have a fellow employee or shop steward represent you.","• Further misconduct during the validity period may result in additional discipline, up to ending of service."]},{title:"Signature Acknowledgment:",content:"Your signature confirms you understand this warning and your rights - not that you agree with it. If you refuse to sign, a witness will confirm the warning was explained. The warning is valid either way."}]},description:"LRA rights (matches script read aloud)",isLocked:!0,requiredFields:["validityPeriod"],createdAt:new Date,createdBy:e},{id:"appeal-history",type:"standard",name:"Appeal History Section",enabled:!1,order:3,content:{heading:"Appeal Information",body:"If you wish to appeal this warning, you must submit your appeal in writing to {{organization.name}} within 7 days of receiving this document.",bulletPoints:["Appeals must be submitted in writing","Appeals must be received within 7 calendar days","State clear grounds for your appeal","Appeal will be reviewed by management not involved in original decision","Decision on appeal is final"]},description:"Detailed appeal procedures (optional - not in script)",isLocked:!1,requiredFields:["organization.name"],createdAt:new Date,createdBy:e},{id:"signatures",type:"standard",name:"Signature Section",enabled:!0,order:4,content:{heading:"Acknowledgment of Receipt",body:"By signing below, you acknowledge receipt of this warning and confirm that you have been given an opportunity to respond.",bulletPoints:[]},description:"Signature blocks for manager and employee acknowledgment",isLocked:!1,requiredFields:[],createdAt:new Date,createdBy:e}],versionHistory:[{version:Ar,activatedAt:new Date,activatedBy:e,reason:"Initial template creation"}],autoUpgrade:!0,betaFeatures:!1}}static async initializeForNewOrganization(t,s){try{const r=this.getDefaultSettings(s),n=P(a,"organizations",t);await M(n,{pdfSettings:r}),e.success("✅ PDF template initialized for new organization:",t)}catch(r){throw e.error("❌ Failed to initialize PDF template:",r),new Error(`Failed to initialize PDF template: ${r instanceof Error?r.message:"Unknown error"}`)}}static async migrateExistingOrganizations(t){try{const r={total:0,migrated:0,skipped:0,errors:0},n=z(a,"organizations"),i=await O(n);r.total=i.size,r.total;const o=L(a);let l=0;const c=500;for(const d of i.docs){const n=d.data();if(n.pdfSettings)r.skipped++,n.name;else try{const e=this.getDefaultSettings(t),s=P(a,"organizations",d.id);o.update(s,{pdfSettings:e,updatedAt:new Date}),l++,r.migrated++,l>=c&&(await o.commit(),l=0)}catch(s){r.errors++,e.error(`❌ Failed to migrate ${n.name}:`,s)}}return l>0&&await o.commit(),e.success("🎉 PDF template migration complete:",r),r}catch(s){throw e.error("❌ PDF template migration failed:",s),new Error(`Migration failed: ${s instanceof Error?s.message:"Unknown error"}`)}}static async cloneTemplate(t,s,r){try{const n=P(a,"organizations",t),i=await U(n);if(!i.exists())throw new Error(`Source organization ${t} not found`);const o=i.data();if(!o.pdfSettings)throw new Error("Source organization has no PDF settings to clone");const l={...o.pdfSettings,lastUpdated:new Date,updatedBy:r,versionHistory:[...o.pdfSettings.versionHistory||[],{version:o.pdfSettings.generatorVersion,activatedAt:new Date,activatedBy:r,reason:`Template cloned from organization ${t}`}]},c=P(a,"organizations",s);await M(c,{pdfSettings:l,updatedAt:new Date}),e.success("✅ PDF template cloned successfully:",{from:t,to:s})}catch(n){throw e.error("❌ Failed to clone PDF template:",n),new Error(`Failed to clone template: ${n instanceof Error?n.message:"Unknown error"}`)}}static async resetToDefaults(t,s){try{const r=this.getDefaultSettings(s),n=P(a,"organizations",t),i=await U(n);if(i.exists()){const e=i.data();e.pdfSettings?.versionHistory&&(r.versionHistory=[...e.pdfSettings.versionHistory,{version:Ar,activatedAt:new Date,activatedBy:s,reason:"Template reset to system defaults"}])}await M(n,{pdfSettings:r,updatedAt:new Date}),e.success("✅ PDF template reset to defaults:",t)}catch(r){throw e.error("❌ Failed to reset PDF template:",r),new Error(`Failed to reset template: ${r instanceof Error?r.message:"Unknown error"}`)}}}class Pr{static async createOrganization(t){let s=L(a);const r=t.id;try{t.name,t.adminUser.firstName,t.adminUser.lastName;const n=P(a,"organizations",r),l=Fr.getDefaultSettings(i.currentUser?.uid||"system");l.generatorVersion;const c={id:r,name:t.name,industry:t.industry||"",province:t.province||"",city:t.city||"",contactEmail:t.contactEmail,contactPhone:t.contactPhone||"",employeeCount:t.employeeCount||0,subscriptionTier:t.subscriptionTier,subscriptionStatus:t.subscriptionStatus,resellerId:t.resellerId||null,branding:t.branding||{logoUrl:"",primaryColor:"#2563eb"},pdfSettings:l,createdAt:o.getServerTimestamp(),updatedAt:o.getServerTimestamp(),isActive:"active"===t.subscriptionStatus,databaseVersion:"2.0",shardingEnabled:!0,dataStructure:"sharded"};s.set(n,c),await this.initializeShardedCollections(r,s),await s.commit(),e.success(`✅ [SHARDED ORG] Organization ${r} created with sharded structure`),e.success(`✅ [SHARDED ORG] PDF template v${l.generatorVersion} initialized for ${r}`),await this.createDefaultCategories(r,t.customCategories||[]);return{organizationId:r,adminUserId:await this.createAdminUser(r,t.adminUser),success:!0}}catch(n){e.error("❌ [SHARDED ORG] Failed to create organization:",n);try{await this.cleanupFailedOrganization(r)}catch(l){e.error("Failed to cleanup failed organization:",l)}return{organizationId:r,adminUserId:"",success:!1,error:n instanceof Error?n.message:"Unknown error"}}}static async initializeShardedCollections(e,t){const s=["employees","warnings","categories","users","meetings","reports"];for(const n of s){const s=P(a,`organizations/${e}/${n}`,"_metadata");t.set(s,{collectionName:n,organizationId:e,createdAt:o.getServerTimestamp(),totalDocuments:0,lastUpdated:o.getServerTimestamp()})}const r=P(a,`organizations/${e}/settings`,"main");t.set(r,{organizationId:e,defaultWarningLevel:"verbal",requireWitnessSignature:!0,autoEscalation:!0,notificationSettings:{emailNotifications:!0,smsNotifications:!1,deliveryConfirmation:!0},customFields:[],createdAt:o.getServerTimestamp()})}static async createDefaultCategories(t,s=[]){if(s.some(e=>!0===e.isDefault))return s.length,await Promise.all(s.map(e=>n.createWarningCategory(e,t))),void e.success(`✅ [SHARDED ORG] Created ${s.length} categories for ${t}`);c.length;const r=c.map(e=>({id:e.id,name:e.name,description:e.description,severity:e.severity,escalationPath:e.escalationPath,color:"minor"===e.severity?"#16a34a":"serious"===e.severity?"#ea580c":"#dc2626",isActive:!0,isDefault:!0,lraSection:e.lraSection,schedule8Reference:e.schedule8Reference,commonExamples:e.commonExamples,defaultValidityPeriod:e.defaultValidityPeriod,requiresImmediateAction:e.requiresImmediateAction||!1})),a=[...r],i=s.filter(e=>!e.isDefault);i.forEach((e,t)=>{"string"==typeof e?a.push({id:`custom-${t+1}`,name:e,description:`Custom category: ${e}`,severity:"minor",escalationPath:["counselling","verbal","first_written","final_written"],color:"#6366f1",isActive:!0,isDefault:!1}):a.push({...e,isDefault:!1})}),await Promise.all(a.map(e=>n.createWarningCategory(e,t))),e.success(`✅ [SHARDED ORG] Created ${a.length} categories for ${t} (${r.length} default + ${i.length} custom)`)}static async createAdminUser(t,s){try{const a=H(u,"createOrganizationAdmin"),n=(await a({email:s.email,password:s.password,firstName:s.firstName,lastName:s.lastName,role:s.role,organizationId:t,sendWelcomeEmail:!1,requirePasswordChange:!1})).data;if(!n.success)throw new Error(`Failed to create admin user: ${n.message}`);const i=n.uid,l={id:i,email:s.email,firstName:s.firstName,lastName:s.lastName,role:s.role,organizationId:t,isActive:!0,createdAt:o.getServerTimestamp(),lastLogin:null,permissions:{canManageEmployees:!0,canCreateWarnings:!0,canViewReports:!0,canManageUsers:!0,canManageSettings:!0}};await m.createDocument(t,"users",l,i);try{await h.setUserOrganization(i,t,"executive-management",s.email,"sharded")}catch(r){e.error("❌ Failed to create UserOrgIndex entry:",r)}return e.success(`✅ [SHARDED ORG] Admin user created: ${i}`),i}catch(a){if(a?.message?.includes("email-already-exists")||a?.message?.includes("already in use")){const t=`Email ${s.email} is already in use. Please use a different email address or contact support if this is your email.`;throw e.error(`❌ [SHARDED ORG] ${t}`),new Error(t)}throw e.error("❌ [SHARDED ORG] Failed to create admin user:",a),a}}static async cleanupFailedOrganization(t){try{const s=P(a,"organizations",t);await F(s,{},{merge:!1}),e.success(`✅ [SHARDED ORG] Cleanup completed for ${t}`)}catch(s){e.error("❌ [SHARDED ORG] Cleanup failed:",s)}}static async activateOrganization(t){try{const s=P(a,"organizations",t);await F(s,{subscriptionStatus:"active",isActive:!0,activatedAt:o.getServerTimestamp(),updatedAt:o.getServerTimestamp()},{merge:!0});const r=await m.queryDocuments(t,"users",[["role","==","executive-management"]]);if(r.documents.length>0){const e=r.documents[0];await m.updateDocument(t,"users",e.id,{isActive:!0,activatedAt:o.getServerTimestamp()})}e.success(`✅ [SHARDED ORG] Organization ${t} activated`)}catch(s){throw e.error("❌ [SHARDED ORG] Failed to activate organization:",s),s}}static async getShardedOrganization(t){try{P(a,"organizations",t);const e=await m.getDocument(t,"organizations",t);return e.exists?e.data:null}catch(s){return e.error("Failed to get sharded organization:",s),null}}static async migrateToShardedStructure(t){try{return e.warn(`🔄 [MIGRATION] Migrating organization to sharded structure: ${t}`),e.success(`✅ [MIGRATION] Organization ${t} ready for sharded structure`),!0}catch(s){return e.error("❌ [MIGRATION] Failed to migrate organization:",s),!1}}}const zr={modal:9e3,modalNested1:9010,modalNested2:9020},Ir=()=>{const e={minor:"#10b981",serious:"#f59e0b",gross_misconduct:"#ef4444"};return c.map(t=>({id:t.id,name:t.name,description:t.description,icon:t.icon,level:t.escalationPath[0]||"verbal",color:e[t.severity],isActive:!0,isDefault:!0,escalationPath:t.escalationPath}))},Tr={counselling:"Counselling",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Ending of Service"},Or=[{group:"Primary Industries",options:[{value:"agriculture",label:"Agriculture & Farming"},{value:"mining",label:"Mining & Quarrying"},{value:"forestry",label:"Forestry & Logging"},{value:"fishing",label:"Fishing & Aquaculture"}]},{group:"Manufacturing & Production",options:[{value:"manufacturing",label:"Manufacturing (General)"},{value:"food-processing",label:"Food & Beverage Processing"},{value:"textiles",label:"Textiles & Clothing"},{value:"automotive",label:"Automotive Manufacturing"},{value:"pharmaceuticals",label:"Pharmaceuticals & Medical Devices"},{value:"chemicals",label:"Chemicals & Plastics"},{value:"electronics",label:"Electronics & Technology Manufacturing"},{value:"construction-materials",label:"Construction Materials"}]},{group:"Construction & Engineering",options:[{value:"construction",label:"Construction & Building"},{value:"civil-engineering",label:"Civil Engineering"},{value:"electrical-engineering",label:"Electrical Engineering"},{value:"mechanical-engineering",label:"Mechanical Engineering"},{value:"architecture",label:"Architecture & Design"}]},{group:"Retail & Wholesale",options:[{value:"retail",label:"Retail & Commerce (General)"},{value:"wholesale",label:"Wholesale & Distribution"},{value:"supermarkets",label:"Supermarkets & Grocery"},{value:"fashion-retail",label:"Fashion & Apparel Retail"},{value:"automotive-retail",label:"Automotive Sales & Service"},{value:"furniture-retail",label:"Furniture & Home Goods"},{value:"electronics-retail",label:"Electronics & Appliances Retail"}]},{group:"Hospitality & Tourism",options:[{value:"hospitality",label:"Hospitality & Tourism"},{value:"hotels",label:"Hotels & Accommodation"},{value:"restaurants",label:"Restaurants & Food Service"},{value:"travel-agencies",label:"Travel Agencies & Tour Operators"},{value:"entertainment",label:"Entertainment & Recreation"}]},{group:"Healthcare & Social Services",options:[{value:"healthcare",label:"Healthcare (General)"},{value:"hospitals",label:"Hospitals & Clinics"},{value:"nursing-homes",label:"Nursing Homes & Elderly Care"},{value:"medical-practices",label:"Medical Practices & Specialists"},{value:"veterinary",label:"Veterinary Services"},{value:"social-services",label:"Social Services & NGOs"}]},{group:"Education & Training",options:[{value:"education",label:"Education & Training"},{value:"schools",label:"Schools & Colleges"},{value:"universities",label:"Universities & Higher Education"},{value:"vocational-training",label:"Vocational & Skills Training"},{value:"childcare",label:"Childcare & Early Learning"}]},{group:"Financial Services",options:[{value:"banking",label:"Banking & Financial Services"},{value:"insurance",label:"Insurance"},{value:"investment",label:"Investment & Asset Management"},{value:"accounting",label:"Accounting & Auditing"},{value:"real-estate",label:"Real Estate & Property Management"}]},{group:"Professional Services",options:[{value:"legal",label:"Legal Services"},{value:"consulting",label:"Consulting & Advisory"},{value:"marketing",label:"Marketing & Advertising"},{value:"hr-recruitment",label:"HR & Recruitment"},{value:"business-services",label:"Business Support Services"}]},{group:"Technology & Communications",options:[{value:"it-services",label:"IT Services & Software"},{value:"telecommunications",label:"Telecommunications"},{value:"media",label:"Media & Broadcasting"},{value:"publishing",label:"Publishing & Printing"},{value:"data-centers",label:"Data Centers & Cloud Services"}]},{group:"Transportation & Logistics",options:[{value:"logistics",label:"Logistics & Supply Chain"},{value:"transportation",label:"Transportation & Freight"},{value:"warehousing",label:"Warehousing & Storage"},{value:"courier",label:"Courier & Postal Services"},{value:"aviation",label:"Aviation & Airports"},{value:"maritime",label:"Maritime & Shipping"}]},{group:"Energy & Utilities",options:[{value:"energy",label:"Energy & Power Generation"},{value:"renewable-energy",label:"Renewable Energy"},{value:"water-utilities",label:"Water & Sanitation"},{value:"waste-management",label:"Waste Management & Recycling"}]},{group:"Security & Emergency Services",options:[{value:"security",label:"Security Services"},{value:"private-security",label:"Private Security & Guarding"},{value:"emergency-services",label:"Emergency Services"},{value:"fire-safety",label:"Fire Safety & Protection"}]},{group:"Government & Public Sector",options:[{value:"government",label:"Government & Public Administration"},{value:"municipal",label:"Municipal Services"},{value:"public-utilities",label:"Public Utilities"}]},{group:"Other",options:[{value:"sports",label:"Sports & Fitness"},{value:"beauty-wellness",label:"Beauty & Wellness"},{value:"cleaning",label:"Cleaning & Facilities Management"},{value:"maintenance",label:"Maintenance & Repair Services"},{value:"other",label:"Other Industry"}]}],Lr=({category:e,onUpdate:t,onRemove:r})=>{const[a,n]=j.useState(!1),[i,o]=j.useState(e);j.useEffect(()=>{o(e)},[e]);const l=e=>{const s={...i,...e};o(s),t(s)},c=["counselling","verbal","first_written","second_written","final_written","suspension","dismissal"];return s.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[i.icon&&s.jsx("span",{className:"text-lg",children:i.icon}),s.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:i.color}})]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"font-medium text-gray-900",children:[i.name||"Unnamed Category",i.isDefault&&s.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Default"})]}),s.jsx("div",{className:"text-sm text-gray-600",children:i.description||"No description"}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Starting level: ",Tr[i.level]]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{type:"button",onClick:()=>n(!a),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",children:a?s.jsx(Ee,{className:"w-4 h-4"}):s.jsx(Ae,{className:"w-4 h-4"})}),s.jsx("button",{type:"button",onClick:r,className:"p-2 text-red-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:i.isDefault?"Remove default category":"Remove custom category",children:s.jsx(de,{className:"w-4 h-4"})})]})]}),a&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name"}),s.jsx("input",{type:"text",value:i.name,onChange:e=>l({name:e.target.value}),disabled:!1,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),s.jsx("select",{value:i.level,onChange:e=>l({level:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:c.map(e=>s.jsx("option",{value:e,children:Tr[e]},e))})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),s.jsx("textarea",{value:i.description,onChange:e=>l({description:e.target.value}),disabled:!1,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),s.jsx("input",{type:"color",value:i.color,onChange:e=>l({color:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),s.jsx("div",{className:"flex items-center",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:i.isActive,onChange:e=>l({isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),s.jsx("div",{className:"grid grid-cols-8 gap-2 p-4 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(e=>s.jsx("button",{type:"button",onClick:()=>l({icon:e}),className:"w-12 h-12 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 "+(i.icon===e?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"),children:e},e))}),i.icon&&s.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",s.jsx("span",{className:"text-lg",children:i.icon})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Escalation Path",s.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Add, remove, or duplicate steps)"})]}),s.jsx("div",{className:"space-y-2 mb-4",children:i.escalationPath?.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"w-6 h-6 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-semibold",children:t+1}),s.jsx("span",{className:"flex-1 text-sm font-medium",children:Tr[e]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{type:"button",onClick:()=>{if(t>0){const e=[...i.escalationPath||[]];[e[t-1],e[t]]=[e[t],e[t-1]],l({escalationPath:e})}},disabled:0===t,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move up",children:"↑"}),s.jsx("button",{type:"button",onClick:()=>{if(t<(i.escalationPath?.length||0)-1){const e=[...i.escalationPath||[]];[e[t],e[t+1]]=[e[t+1],e[t]],l({escalationPath:e})}},disabled:t===(i.escalationPath?.length||0)-1,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move down",children:"↓"}),s.jsx("button",{type:"button",onClick:()=>{const s=[...i.escalationPath||[]];s.splice(t+1,0,e),l({escalationPath:s})},className:"w-6 h-6 flex items-center justify-center text-blue-500 hover:text-blue-700",title:"Duplicate this step",children:"⧨"}),s.jsx("button",{type:"button",onClick:()=>{const e=i.escalationPath?.filter((e,s)=>s!==t)||[];l({escalationPath:e})},disabled:(i.escalationPath?.length||0)<=1,className:"w-6 h-6 flex items-center justify-center text-red-500 hover:text-red-700 disabled:opacity-30",title:"Remove this step",children:"✕"})]})]},t))}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("select",{onChange:e=>{if(e.target.value){const t=[...i.escalationPath||[],e.target.value];l({escalationPath:t}),e.target.value=""}},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",defaultValue:"",children:[s.jsx("option",{value:"",children:"Add step..."}),c.filter(e=>"suspension"!==e&&"dismissal"!==e).map(e=>s.jsx("option",{value:e,children:Tr[e]},e))]}),s.jsx("span",{className:"text-xs text-gray-500",children:"Note: Escalation stops at Final Written. No suspension/dismissal steps needed."})]}),s.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This shows the progression path for repeated offenses in this category."})]})]})]})},Mr=({isOpen:t,onClose:a,onComplete:n})=>{const{user:i}=l(),[o,d]=j.useState(0),[m,u]=j.useState(!1),[h,p]=j.useState(null),[x,f]=j.useState([]),[y,v]=j.useState(!1),[b,w]=j.useState(null),N="reseller"===i?.role?.id,C="super-user"===i?.role?.id,D=()=>q[o]?.id,[k,A]=j.useState({companyName:"",employeeCount:15,selectedPlan:"professional",industry:"",province:"gauteng",city:"",contactFirstName:"",contactLastName:"",contactEmail:"",contactPhone:"",resellerId:"",adminFirstName:"",adminLastName:"",adminEmail:"",adminPassword:"",adminPasswordConfirm:"",logoUrl:"",primaryColor:"#2563eb",secondaryColor:"#6366f1",accentColor:"#10b981",customCategories:Ir()}),[R,F]=j.useState(null),[P,z]=j.useState(""),[I,T]=j.useState(!1),[O,L]=j.useState(!1),[M,B]=j.useState(""),[W,H]=j.useState(null),U=async t=>{if(!R)return"";try{T(!0);let s=R;"image/jpeg"!==R.type&&"image/jpg"!==R.type||(s=await(async e=>new Promise((t,s)=>{const r=new Image,a=document.createElement("canvas"),n=a.getContext("2d");r.onload=()=>{a.width=r.width,a.height=r.height,n?.drawImage(r,0,0),a.toBlob(e=>{e?t(e):s(new Error("Failed to convert image to PNG"))},"image/png")},r.onerror=()=>s(new Error("Failed to load image")),r.src=URL.createObjectURL(e)}))(R));const r=Date.now(),a=$(g,`organizations/${t}/logos/logo-${r}.png`);await G(a,s);const n=await V(a);return e.success("✅ Logo uploaded successfully"),n}catch(s){throw e.error("Failed to upload logo:",s),s}finally{T(!1)}},q=[{id:"subscription",title:"Subscription & Payment",icon:Re},{id:"company",title:"Company Details",icon:Fe},{id:"reseller",title:"Reseller Assignment",icon:te},{id:"admin",title:"Admin Setup",icon:Z},{id:"customize",title:"Customization",icon:Pe}];j.useEffect(()=>{t&&(Y(),N&&(A(e=>({...e,resellerId:i?.resellerId||""})),K()))},[t,C,N,i]);const Y=async()=>{try{const t=(await r.getAllResellers()).filter(e=>e.isActive),s=await Promise.all(t.map(async t=>{try{const e=await r.getResellerClients(t.id);return{...t,clientIds:e.map(e=>e.id)}}catch(s){return e.error(`Failed to load clients for reseller ${t.id}:`,s),t}}));f(s);const a=s.filter(e=>e.province===k.province);1===a.length&&A(e=>({...e,resellerId:a[0].id}))}catch(t){e.error("Failed to load resellers:",t)}},K=async()=>{if(i?.id&&N)try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=await r.getResellerDeployments(i.id,t),a=s.length,n=s.length>0?new Date(s[0].createdAt):void 0;let o,l=!0;if(a>=10)l=!1,o="Monthly deployment limit reached (10)";else if(n){const t=(e.getTime()-n.getTime())/6e4;t<5&&(l=!1,o=`Rate limit: Please wait ${Math.ceil(5-t)} minutes between deployments`)}w({canDeploy:l,reason:o,deploymentsThisMonth:a,lastDeployment:n})}catch(t){e.error("Failed to check deployment status:",t),w({canDeploy:!1,reason:"Unable to verify deployment status",deploymentsThisMonth:0})}},J=e=>{A(t=>({...t,...e})),p(null)},Q=()=>{switch(D()){case"subscription":return k.companyName.trim()?k.employeeCount<1?{isValid:!1,message:"Employee count must be at least 1"}:{isValid:!0}:{isValid:!1,message:"Company name is required"};case"company":return k.contactFirstName.trim()?k.contactLastName.trim()?k.contactEmail.trim()?k.contactPhone.trim()?{isValid:!0}:{isValid:!1,message:"Contact phone is required"}:{isValid:!1,message:"Contact email is required"}:{isValid:!1,message:"Contact last name is required"}:{isValid:!1,message:"Contact first name is required"};case"reseller":return k.resellerId?{isValid:!0}:{isValid:!1,message:"Please select a reseller"};case"admin":return k.adminFirstName.trim()?k.adminLastName.trim()?k.adminEmail.trim()?{isValid:!0}:{isValid:!1,message:"Admin email is required"}:{isValid:!1,message:"Admin last name is required"}:{isValid:!1,message:"Admin first name is required"};case"customize":return k.customCategories.length<3?{isValid:!1,message:"Please configure at least 3 warning categories before deploying"}:{isValid:!0};default:return{isValid:!0}}},ee=()=>x.filter(e=>e.province===k.province);return t?s.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:zr.modal},children:[s.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Deploy New Client"}),s.jsxs("p",{className:"text-gray-600",children:["Step ",o+1," of ",q.length,": ",q[o].title]})]}),s.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",disabled:m,children:"✕"})]}),s.jsx("div",{className:"flex items-center mt-4 space-x-2",children:q.map((e,t)=>s.jsxs(S.Fragment,{children:[s.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium "+(t<=o?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:t<o?s.jsx(Pe,{className:"w-4 h-4"}):t+1}),t<q.length-1&&s.jsx("div",{className:"flex-1 h-2 rounded "+(t<o?"bg-blue-600":"bg-gray-200")})]},e.id))})]}),s.jsxs("div",{className:"px-6 py-6",children:[N&&b&&!b.canDeploy&&s.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ne,{className:"w-5 h-5 text-red-600"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-red-900",children:"Deployment Temporarily Unavailable"}),s.jsx("p",{className:"text-red-700 text-sm mt-1",children:b.reason}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-red-600",children:"Deployments this month:"}),s.jsxs("div",{className:"font-semibold",children:[b.deploymentsThisMonth," / 10"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-red-600",children:"Last deployment:"}),s.jsx("div",{className:"font-semibold",children:b.lastDeployment?b.lastDeployment.toLocaleDateString("en-ZA"):"Never"})]})]})]})]})}),"subscription"===D()&&s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company & Subscription Details"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),s.jsx("input",{type:"text",value:k.companyName,onChange:e=>J({companyName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter company name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Employees *"}),s.jsx("input",{type:"number",min:"1",value:k.employeeCount,onChange:e=>{const t=e.target.value;if(""===t)J({employeeCount:""});else{const e=parseInt(t);if(!isNaN(e)&&e>0){const t=Dr.getRecommendedTier(e);J({employeeCount:e,selectedPlan:t})}}},onBlur:e=>{const t=e.target.value;if(""===t||isNaN(parseInt(t))){const e=Dr.getRecommendedTier(1);J({employeeCount:1,selectedPlan:e})}},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-md font-semibold mb-2",children:"Subscription Plan"}),s.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Plan automatically selected based on employee count"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(nr).map(([e,t])=>{const r=k.selectedPlan===e;return s.jsx("div",{className:"relative border rounded-lg p-4 transition-all "+(r?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 bg-gray-50 opacity-60"),children:s.jsxs("div",{className:"text-center",children:[s.jsx("h5",{className:"font-semibold "+(r?"text-gray-900":"text-gray-500"),children:t.name}),s.jsx("div",{className:"text-2xl font-bold my-2 "+(r?"text-blue-600":"text-gray-400"),children:"R###"}),s.jsx("div",{className:"text-sm mb-3 "+(r?"text-gray-600":"text-gray-400"),children:"per month"}),s.jsxs("div",{className:"text-sm "+(r?"text-gray-700":"text-gray-400"),children:["Up to ",999999===t.employeeLimit?"unlimited":t.employeeLimit," employees"]}),r&&s.jsx(Pe,{className:"absolute top-2 right-2 w-5 h-5 text-blue-500"})]})},e)})})]})]}),"company"===D()&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company Details"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),s.jsxs("button",{type:"button",onClick:()=>L(!O),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-left flex items-center justify-between bg-white",children:[s.jsx("span",{className:k.industry?"text-gray-900":"text-gray-400",children:k.industry&&Or.flatMap(e=>e.options).find(e=>e.value===k.industry)?.label||"Select industry"}),s.jsx(Ae,{className:"w-4 h-4 text-gray-400 transition-transform "+(O?"rotate-180":"")})]}),O&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>L(!1)}),s.jsxs("div",{className:"absolute z-20 mt-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-96 overflow-hidden flex flex-col",children:[s.jsx("div",{className:"p-2 border-b border-gray-200",children:s.jsxs("div",{className:"relative",children:[s.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search industries...",value:M,onChange:e=>B(e.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoFocus:!0})]})}),s.jsxs("div",{className:"overflow-y-auto",children:[Or.map(e=>{const t=e.options.filter(t=>t.label.toLowerCase().includes(M.toLowerCase())||e.group.toLowerCase().includes(M.toLowerCase()));return 0===t.length?null:s.jsxs("div",{children:[s.jsx("div",{className:"px-3 py-2 text-xs font-semibold text-gray-500 bg-gray-50 sticky top-0",children:e.group}),t.map(e=>s.jsx("button",{type:"button",onClick:()=>{J({industry:e.value}),L(!1),B("")},className:"w-full text-left px-3 py-2 text-sm hover:bg-blue-50 transition-colors "+(k.industry===e.value?"bg-blue-100 text-blue-900 font-medium":"text-gray-700"),children:e.label},e.value))]},e.group)}),Or.every(e=>0===e.options.filter(t=>t.label.toLowerCase().includes(M.toLowerCase())||e.group.toLowerCase().includes(M.toLowerCase())).length)&&s.jsxs("div",{className:"px-3 py-8 text-center text-sm text-gray-500",children:['No industries found matching "',M,'"']})]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),s.jsx("select",{value:k.province,onChange:e=>J({province:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(ir).map(([e,t])=>s.jsx("option",{value:e,children:t.name},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City / Town"}),s.jsx("input",{type:"text",value:k.city,onChange:e=>J({city:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter city or town"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact First Name *"}),s.jsx("input",{type:"text",value:k.contactFirstName,onChange:e=>J({contactFirstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"First name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Last Name *"}),s.jsx("input",{type:"text",value:k.contactLastName,onChange:e=>J({contactLastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Last name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email *"}),s.jsx("input",{type:"email",value:k.contactEmail,onChange:e=>J({contactEmail:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@company.com"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone *"}),s.jsx("input",{type:"tel",value:k.contactPhone,onChange:e=>J({contactPhone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 (0)11 123 4567"})]})]})]}),"reseller"===D()&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Assign Reseller"}),s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[s.jsx(te,{className:"w-5 h-5"}),s.jsxs("span",{className:"font-medium",children:["Available resellers in ",ir[k.province]?.name]})]}),s.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This reseller will receive 50% commission on monthly payments"})]}),s.jsxs("div",{className:"space-y-3",children:[ee().map(e=>s.jsx("div",{className:"border rounded-lg p-4 cursor-pointer transition-all "+(k.resellerId===e.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"),onClick:()=>J({resellerId:e.id}),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium",children:[e.firstName," ",e.lastName]}),s.jsx("p",{className:"text-sm text-gray-600",children:e.email}),s.jsxs("p",{className:"text-sm text-gray-500",children:[e.clientIds?.length||0," active clients • Territory: ",e.territory?.join(", ")||"Not specified"]})]}),k.resellerId===e.id&&s.jsx(Pe,{className:"w-5 h-5 text-blue-500"})]})},e.id)),0===ee().length&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ne,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),s.jsxs("p",{className:"text-gray-600",children:["No resellers available in ",ir[k.province]?.name]}),s.jsx("p",{className:"text-sm text-gray-500",children:"Please contact support to set up resellers in this province"})]})]})]}),"admin"===D()&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Administrator Account"}),s.jsxs("form",{onSubmit:e=>e.preventDefault(),autoComplete:"off",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),s.jsx("input",{type:"text",value:k.adminFirstName,onChange:e=>J({adminFirstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),s.jsx("input",{type:"text",value:k.adminLastName,onChange:e=>J({adminLastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),s.jsx("input",{type:"email",value:k.adminEmail,onChange:e=>J({adminEmail:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]})]}),s.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold mt-0.5",children:"i"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Default Password"}),s.jsxs("p",{className:"text-sm text-blue-800",children:["A temporary password ",s.jsx("span",{className:"font-mono font-semibold",children:"temp123"})," will be set for this administrator. They will be prompted to change it on first login."]})]})]})}),s.jsx("div",{className:"hidden"})]})]}),"customize"===D()&&s.jsxs("div",{className:"space-y-6",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Branding & Category Configuration"}),s.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 bg-gray-50",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Company Logo"}),s.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Upload a JPG or PNG file (max 5MB). JPG files will be automatically converted to PNG."}),P?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"relative inline-block",children:[s.jsx("img",{src:P,alt:"Logo preview",className:"max-w-xs max-h-32 rounded-lg border-2 border-gray-200"}),s.jsx("button",{type:"button",onClick:()=>{F(null),z("")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:s.jsx(X,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[s.jsx(Ie,{className:"w-4 h-4"}),s.jsx("span",{children:R?.name}),R?.type.includes("jpeg")&&s.jsx("span",{className:"text-xs text-blue-600",children:"(will be converted to PNG)"})]})]}):s.jsxs("label",{className:"cursor-pointer",children:[s.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;if(!["image/jpeg","image/jpg","image/png"].includes(t.type))return void alert("Please upload a JPG or PNG file");if(t.size>5242880)return void alert("File size must be less than 5MB");F(t);const s=new FileReader;s.onload=e=>{z(e.target?.result)},s.readAsDataURL(t)},className:"hidden"}),s.jsxs("div",{className:"flex flex-col items-center justify-center py-8 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors",children:[s.jsx(Te,{className:"w-12 h-12 text-gray-400 mb-2"}),s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Click to upload logo"}),s.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"JPG or PNG (max 5MB)"})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Or provide a logo URL:"}),s.jsx("input",{type:"url",value:k.logoUrl,onChange:e=>J({logoUrl:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com/logo.png",disabled:!!R})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),s.jsx("input",{type:"color",value:k.primaryColor,onChange:e=>J({primaryColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),s.jsx("input",{type:"color",value:k.secondaryColor,onChange:e=>J({secondaryColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Accent Color"}),s.jsx("input",{type:"color",value:k.accentColor,onChange:e=>J({accentColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]})]}),s.jsxs("div",{className:"border-t-4 border-blue-200 bg-blue-50 rounded-lg p-6 mt-8",children:[s.jsx("h4",{className:"text-xl font-bold text-blue-900 mb-2 flex items-center gap-2",children:"📋 Warning Categories Configuration"}),s.jsx("p",{className:"text-sm text-blue-800 mb-6 font-medium",children:"⚠️ IMPORTANT: Customize the disciplinary categories for your organization. You can edit, remove, or add categories and configure their escalation paths."}),s.jsxs("div",{className:"grid gap-4",children:[k.customCategories.map((e,t)=>s.jsx(Lr,{category:e,onUpdate:e=>{const s=[...k.customCategories];s[t]=e,J({customCategories:s})},onRemove:()=>{const e=k.customCategories.filter((e,s)=>s!==t);J({customCategories:e})}},e.id)),k.customCategories.length<3&&s.jsx("div",{className:"bg-red-50 border-2 border-red-300 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ne,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-semibold text-red-900 mb-1",children:"Minimum 3 Categories Required"}),s.jsxs("p",{className:"text-sm text-red-800",children:["You currently have ",s.jsx("strong",{children:k.customCategories.length})," ",1===k.customCategories.length?"category":"categories",". Please add at least ",s.jsx("strong",{children:3-k.customCategories.length})," more ",3-k.customCategories.length==1?"category":"categories"," to proceed with deployment. This ensures your organization has adequate disciplinary options configured."]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("button",{type:"button",onClick:()=>v(!0),className:"p-4 border-2 border-dashed border-blue-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-center group",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[s.jsx("span",{className:"text-2xl",children:"📋"}),s.jsx(we,{className:"w-5 h-5 text-blue-400 group-hover:text-blue-600"})]}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Choose from Template"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"SA-compliant categories"})]}),s.jsxs("button",{type:"button",onClick:()=>{const e={id:`custom-${Date.now()}`,name:"",description:"",level:"verbal",color:"#6366f1",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]};J({customCategories:[...k.customCategories,e]})},className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition-colors text-center group",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[s.jsx("span",{className:"text-2xl",children:"✏️"}),s.jsx(we,{className:"w-5 h-5 text-gray-400 group-hover:text-green-600"})]}),s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Create Blank Category"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Start from scratch"})]})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mt-6",children:[s.jsx("h4",{className:"font-semibold mb-4",children:"Deployment Summary"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Company:"})," ",k.companyName]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Plan:"})," ",nr[k.selectedPlan].name]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Monthly Cost:"})," R###"]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Province:"})," ",ir[k.province]?.name]})]}),s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-4",children:s.jsxs("div",{className:"text-sm text-green-800",children:[s.jsx("strong",{children:"Revenue Breakdown (Monthly):"}),s.jsx("br",{}),"• Client pays: R###",s.jsx("br",{}),"• Reseller commission (50%): R###",s.jsx("br",{}),"• Your income (30%): R###",s.jsx("br",{}),"• Company fund (20%): R###"]})})]})]}),h&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2 text-red-800",children:[s.jsx(ne,{className:"w-4 h-4"}),s.jsx("span",{children:h})]})]}),s.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[s.jsxs("button",{onClick:()=>{o>0&&(d(o-1),p(null))},disabled:0===o||m,className:"flex items-center gap-2 px-4 py-2 text-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed",children:[s.jsx(Oe,{className:"w-4 h-4"}),"Previous"]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:a,disabled:m,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:cursor-not-allowed",children:"Cancel"}),o===q.length-1?s.jsx("button",{onClick:async()=>{try{if(N&&b&&!b.canDeploy)return void p(b.reason||"Cannot deploy at this time");u(!0),p(null);const l=k.companyName.toLowerCase().replace(/[^a-z0-9]/g,"-");let c=k.logoUrl;if(R)try{c=await U(l),e.success("✅ Logo uploaded and converted to PNG")}catch(t){e.error("Failed to upload logo:",t)}const d="temp123",m=await Pr.createOrganization({id:l,name:k.companyName,industry:k.industry,province:k.province,city:k.city,contactEmail:k.contactEmail,contactPhone:k.contactPhone,employeeCount:k.employeeCount,subscriptionTier:k.selectedPlan,subscriptionStatus:"active",resellerId:k.resellerId,branding:{logoUrl:c,primaryColor:k.primaryColor,secondaryColor:k.secondaryColor,accentColor:k.accentColor},adminUser:{firstName:k.adminFirstName,lastName:k.adminLastName,email:k.adminEmail,password:d,role:"executive-management"},customCategories:k.customCategories});if(!m.success)throw new Error(m.error||"Failed to create organization");e.success(`✅ Organization '${k.companyName}' deployed successfully!`),e.success(`📧 Admin email: ${k.adminEmail}`),e.success(`🔑 Admin password: ${d}`);try{await E.createDefaultDepartments(l),e.success("✅ Default departments created successfully")}catch(s){e.warn("⚠️ Could not create default departments (expected due to auth state)")}if(N&&i?.id)try{const t=await _(()=>import("./business-owner-dashboard-Dq6MrEKt.js").then(e=>e.E),__vite__mapDeps([0,1,2,3,4])).then(e=>e.TimeService.getServerTimestamp());await r.logResellerDeployment({resellerId:i.id,organizationId:l,organizationName:k.companyName,adminEmail:k.adminEmail,deployedAt:t,notes:"Deployed via unified wizard"}),e.success("✅ Reseller deployment logged successfully")}catch(o){e.error("Failed to log reseller deployment:",o)}alert(`🎉 Organization '${k.companyName}' created successfully!\n\n📧 Admin Login: ${k.adminEmail}\n🔑 Password: ${d}`),a(),n()}catch(t){e.error("❌ Deployment failed:",t),p(t instanceof Error?t.message:"Deployment failed")}finally{u(!1)}},disabled:!Q().isValid||m,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:m?s.jsxs(s.Fragment,{children:[s.jsx(Le,{className:"w-4 h-4 animate-spin"}),"Processing Payment..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Re,{className:"w-4 h-4"}),"Deploy & Pay"]})}):s.jsxs("button",{onClick:()=>{const e=Q();e.isValid?("company"===D()&&(k.adminFirstName||k.adminLastName||k.adminEmail||A(e=>({...e,adminFirstName:e.contactFirstName,adminLastName:e.contactLastName,adminEmail:e.contactEmail}))),o<q.length-1&&(d(o+1),p(null),"reseller"===D()&&Y())):p(e.message||"Please complete all required fields")},disabled:!Q().isValid,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:["Next",s.jsx(Me,{className:"w-4 h-4"})]})]})]})]}),y&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[10001]",children:s.jsxs("div",{className:"bg-white rounded-lg w-[90%] max-w-3xl max-h-[85vh] flex flex-col overflow-hidden",children:[s.jsx("div",{className:"px-4 py-3 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Category Templates"}),s.jsx("p",{className:"text-xs text-gray-600",children:'Click to expand details, then click "Add" to use a template'})]}),s.jsx("button",{onClick:()=>v(!1),className:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(X,{className:"w-5 h-5 text-gray-500"})})]})}),s.jsx("div",{className:"p-4 overflow-y-auto flex-1",children:s.jsx("div",{className:"grid gap-2",children:c.map(e=>{const t={minor:{bg:"bg-blue-100",text:"text-blue-800",label:"Minor"},serious:{bg:"bg-orange-100",text:"text-orange-800",label:"Serious"},gross_misconduct:{bg:"bg-red-100",text:"text-red-800",label:"Gross Misconduct"}}[e.severity],r=W===e.id;return s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden hover:border-blue-500 transition-all",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 cursor-pointer hover:bg-gray-50",onClick:t=>{t.stopPropagation(),H(r?null:e.id)},children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsx("span",{className:"text-2xl flex-shrink-0",children:e.icon}),s.jsx("div",{className:"flex-1 min-w-0",children:s.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx("h5",{className:"text-sm font-semibold text-gray-900 truncate",children:e.name}),s.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium ${t.bg} ${t.text} flex-shrink-0`,children:t.label})]})})]}),s.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[s.jsx("button",{onClick:t=>{t.stopPropagation();const s={id:`custom-${Date.now()}`,name:e.name,description:e.description,level:"verbal",color:"#6366f1",icon:e.icon,isActive:!0,isDefault:!1,escalationPath:e.escalationPath};J({customCategories:[...k.customCategories,s]}),v(!1)},className:"px-3 py-1 bg-blue-600 text-white text-xs font-medium rounded hover:bg-blue-700 transition-colors",children:"Add"}),s.jsx(Ae,{className:"w-4 h-4 text-gray-400 transition-transform "+(r?"rotate-180":"")})]})]}),r&&s.jsxs("div",{className:"px-3 pb-3 pt-0 border-t border-gray-100 bg-gray-50",children:[s.jsx("p",{className:"text-sm text-gray-600 mb-2 mt-2",children:e.description}),e.commonExamples.length>0&&s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Common Examples:"}),s.jsx("ul",{className:"text-xs text-gray-600 space-y-0.5",children:e.commonExamples.map((e,t)=>s.jsxs("li",{className:"flex items-start gap-1.5",children:[s.jsx("span",{className:"text-gray-400 mt-0.5",children:"•"}),s.jsx("span",{children:e})]},t))})]})]})]},e.id)})})})]})})]}):null},Br=Object.freeze(Object.defineProperty({__proto__:null,EnhancedOrganizationWizard:Mr},Symbol.toStringTag,{value:"Module"}));const Wr="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function Hr(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function Ur(e){return"nodeType"in e}function $r(e){var t,s;return e?Hr(e)?e:Ur(e)&&null!=(t=null==(s=e.ownerDocument)?void 0:s.defaultView)?t:window:window}function Gr(e){const{Document:t}=$r(e);return e instanceof t}function Vr(e){return!Hr(e)&&e instanceof $r(e).HTMLElement}function qr(e){return e instanceof $r(e).SVGElement}function Yr(e){return e?Hr(e)?e.document:Ur(e)?Gr(e)?e:Vr(e)||qr(e)?e.ownerDocument:document:document:document}const Kr=Wr?j.useLayoutEffect:j.useEffect;function Xr(e){const t=j.useRef(e);return Kr(()=>{t.current=e}),j.useCallback(function(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return null==t.current?void 0:t.current(...s)},[])}function Jr(e,t){void 0===t&&(t=[e]);const s=j.useRef(e);return Kr(()=>{s.current!==e&&(s.current=e)},t),s}function Zr(e,t){const s=j.useRef();return j.useMemo(()=>{const t=e(s.current);return s.current=t,t},[...t])}function Qr(e){const t=Xr(e),s=j.useRef(null),r=j.useCallback(e=>{e!==s.current&&(null==t||t(e,s.current)),s.current=e},[]);return[s,r]}function ea(e){const t=j.useRef();return j.useEffect(()=>{t.current=e},[e]),t.current}let ta={};function sa(e,t){return j.useMemo(()=>{if(t)return t;const s=null==ta[e]?0:ta[e]+1;return ta[e]=s,e+"-"+s},[e,t])}function ra(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r.reduce((t,s)=>{const r=Object.entries(s);for(const[a,n]of r){const s=t[a];null!=s&&(t[a]=s+e*n)}return t},{...t})}}const aa=ra(1),na=ra(-1);function ia(e){if(!e)return!1;const{KeyboardEvent:t}=$r(e.target);return t&&e instanceof t}function oa(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=$r(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:s}=e.touches[0];return{x:t,y:s}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:s}=e.changedTouches[0];return{x:t,y:s}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const la=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:s}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:s}=e;return"scaleX("+t+") scaleY("+s+")"}},Transform:{toString(e){if(e)return[la.Translate.toString(e),la.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:s,easing:r}=e;return t+" "+s+"ms "+r}}}),ca="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function da(e){return e.matches(ca)?e:e.querySelector(ca)}const ma={display:"none"};function ua(e){let{id:t,value:s}=e;return S.createElement("div",{id:t,style:ma},s)}function ha(e){let{id:t,announcement:s,ariaLiveType:r="assertive"}=e;return S.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":r,"aria-atomic":!0},s)}const ga=j.createContext(null);const pa={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},xa={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was moved over droppable area "+s.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:s}=e;return s?"Draggable item "+t.id+" was dropped over droppable area "+s.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function fa(e){let{announcements:t=xa,container:s,hiddenTextDescribedById:r,screenReaderInstructions:a=pa}=e;const{announce:n,announcement:i}=function(){const[e,t]=j.useState("");return{announce:j.useCallback(e=>{null!=e&&t(e)},[]),announcement:e}}(),o=sa("DndLiveRegion"),[l,c]=j.useState(!1);if(j.useEffect(()=>{c(!0)},[]),function(e){const t=j.useContext(ga);j.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}(j.useMemo(()=>({onDragStart(e){let{active:s}=e;n(t.onDragStart({active:s}))},onDragMove(e){let{active:s,over:r}=e;t.onDragMove&&n(t.onDragMove({active:s,over:r}))},onDragOver(e){let{active:s,over:r}=e;n(t.onDragOver({active:s,over:r}))},onDragEnd(e){let{active:s,over:r}=e;n(t.onDragEnd({active:s,over:r}))},onDragCancel(e){let{active:s,over:r}=e;n(t.onDragCancel({active:s,over:r}))}}),[n,t])),!l)return null;const d=S.createElement(S.Fragment,null,S.createElement(ua,{id:r,value:a.draggable}),S.createElement(ha,{id:o,announcement:i}));return s?D.createPortal(d,s):d}var ya;function va(){}function ba(e,t){return j.useMemo(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(ya||(ya={}));const ja=Object.freeze({x:0,y:0});function wa(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Na(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return s-r}function Ca(e,t){let{data:{value:s}}=e,{data:{value:r}}=t;return r-s}function Sa(e){let{left:t,top:s,height:r,width:a}=e;return[{x:t,y:s},{x:t+a,y:s},{x:t,y:s+r},{x:t+a,y:s+r}]}function Da(e,t){if(!e||0===e.length)return null;const[s]=e;return s[t]}function ka(e,t,s){return void 0===t&&(t=e.left),void 0===s&&(s=e.top),{x:t+.5*e.width,y:s+.5*e.height}}const Ea=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=ka(t,t.left,t.top),n=[];for(const i of r){const{id:e}=i,t=s.get(e);if(t){const s=wa(ka(t),a);n.push({id:e,data:{droppableContainer:i,value:s}})}}return n.sort(Na)};function Aa(e,t){const s=Math.max(t.top,e.top),r=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),n=Math.min(t.top+t.height,e.top+e.height),i=a-r,o=n-s;if(r<a&&s<n){const s=t.width*t.height,r=e.width*e.height,a=i*o;return Number((a/(s+r-a)).toFixed(4))}return 0}const _a=e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=[];for(const n of r){const{id:e}=n,r=s.get(e);if(r){const s=Aa(r,t);s>0&&a.push({id:e,data:{droppableContainer:n,value:s}})}}return a.sort(Ca)};function Ra(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ja}function Fa(e){return function(t){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];return r.reduce((t,s)=>({...t,top:t.top+e*s.y,bottom:t.bottom+e*s.y,left:t.left+e*s.x,right:t.right+e*s.x}),{...t})}}const Pa=Fa(1);const za={ignoreTransform:!1};function Ia(e,t){void 0===t&&(t=za);let s=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:r}=$r(e).getComputedStyle(e);t&&(s=function(e,t,s){const r=function(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!r)return e;const{scaleX:a,scaleY:n,x:i,y:o}=r,l=e.left-i-(1-a)*parseFloat(s),c=e.top-o-(1-n)*parseFloat(s.slice(s.indexOf(" ")+1)),d=a?e.width/a:e.width,m=n?e.height/n:e.height;return{width:d,height:m,top:c,right:l+d,bottom:c+m,left:l}}(s,t,r))}const{top:r,left:a,width:n,height:i,bottom:o,right:l}=s;return{top:r,left:a,width:n,height:i,bottom:o,right:l}}function Ta(e){return Ia(e,{ignoreTransform:!0})}function Oa(e,t){const s=[];return e?function r(a){if(null!=t&&s.length>=t)return s;if(!a)return s;if(Gr(a)&&null!=a.scrollingElement&&!s.includes(a.scrollingElement))return s.push(a.scrollingElement),s;if(!Vr(a)||qr(a))return s;if(s.includes(a))return s;const n=$r(e).getComputedStyle(a);return a!==e&&function(e,t){void 0===t&&(t=$r(e).getComputedStyle(e));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const r=t[e];return"string"==typeof r&&s.test(r)})}(a,n)&&s.push(a),function(e,t){return void 0===t&&(t=$r(e).getComputedStyle(e)),"fixed"===t.position}(a,n)?s:r(a.parentNode)}(e):s}function La(e){const[t]=Oa(e,1);return null!=t?t:null}function Ma(e){return Wr&&e?Hr(e)?e:Ur(e)?Gr(e)||e===Yr(e).scrollingElement?window:Vr(e)?e:null:null:null}function Ba(e){return Hr(e)?e.scrollX:e.scrollLeft}function Wa(e){return Hr(e)?e.scrollY:e.scrollTop}function Ha(e){return{x:Ba(e),y:Wa(e)}}var Ua;function $a(e){return!(!Wr||!e)&&e===document.scrollingElement}function Ga(e){const t={x:0,y:0},s=$a(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-s.width,y:e.scrollHeight-s.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=r.y,isRight:e.scrollLeft>=r.x,maxScroll:r,minScroll:t}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(Ua||(Ua={}));const Va={x:.2,y:.2};function qa(e,t,s,r,a){let{top:n,left:i,right:o,bottom:l}=s;void 0===r&&(r=10),void 0===a&&(a=Va);const{isTop:c,isBottom:d,isLeft:m,isRight:u}=Ga(e),h={x:0,y:0},g={x:0,y:0},p=t.height*a.y,x=t.width*a.x;return!c&&n<=t.top+p?(h.y=Ua.Backward,g.y=r*Math.abs((t.top+p-n)/p)):!d&&l>=t.bottom-p&&(h.y=Ua.Forward,g.y=r*Math.abs((t.bottom-p-l)/p)),!u&&o>=t.right-x?(h.x=Ua.Forward,g.x=r*Math.abs((t.right-x-o)/x)):!m&&i<=t.left+x&&(h.x=Ua.Backward,g.x=r*Math.abs((t.left+x-i)/x)),{direction:h,speed:g}}function Ya(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:s,right:r,bottom:a}=e.getBoundingClientRect();return{top:t,left:s,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Ka(e){return e.reduce((e,t)=>aa(e,Ha(t)),ja)}const Xa=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+Ba(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+Wa(t),0)}]];class Ja{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=Oa(t),r=Ka(s);this.rect={...e},this.width=e.width,this.height=e.height;for(const[a,n,i]of Xa)for(const e of n)Object.defineProperty(this,e,{get:()=>{const t=i(s),n=r[a]-t;return this.rect[e]+n},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Za{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,s){var r;null==(r=this.target)||r.addEventListener(e,t,s),this.listeners.push([e,t,s])}}function Qa(e,t){const s=Math.abs(e.x),r=Math.abs(e.y);return"number"==typeof t?Math.sqrt(s**2+r**2)>t:"x"in t&&"y"in t?s>t.x&&r>t.y:"x"in t?s>t.x:"y"in t&&r>t.y}var en,tn;function sn(e){e.preventDefault()}function rn(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(en||(en={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(tn||(tn={}));const an={start:[tn.Space,tn.Enter],cancel:[tn.Esc],end:[tn.Space,tn.Enter,tn.Tab]},nn=(e,t)=>{let{currentCoordinates:s}=t;switch(e.code){case tn.Right:return{...s,x:s.x+25};case tn.Left:return{...s,x:s.x-25};case tn.Down:return{...s,y:s.y+25};case tn.Up:return{...s,y:s.y-25}}};class on{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Za(Yr(t)),this.windowListeners=new Za($r(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(en.Resize,this.handleCancel),this.windowListeners.add(en.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(en.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,s=e.node.current;s&&function(e,t){if(void 0===t&&(t=Ia),!e)return;const{top:s,left:r,bottom:a,right:n}=t(e);La(e)&&(a<=0||n<=0||s>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(s),t(ja)}handleKeyDown(e){if(ia(e)){const{active:t,context:s,options:r}=this.props,{keyboardCodes:a=an,coordinateGetter:n=nn,scrollBehavior:i="smooth"}=r,{code:o}=e;if(a.end.includes(o))return void this.handleEnd(e);if(a.cancel.includes(o))return void this.handleCancel(e);const{collisionRect:l}=s.current,c=l?{x:l.left,y:l.top}:ja;this.referenceCoordinates||(this.referenceCoordinates=c);const d=n(e,{active:t,context:s.current,currentCoordinates:c});if(d){const t=na(d,c),r={x:0,y:0},{scrollableAncestors:a}=s.current;for(const s of a){const a=e.code,{isTop:n,isRight:o,isLeft:l,isBottom:c,maxScroll:m,minScroll:u}=Ga(s),h=Ya(s),g={x:Math.min(a===tn.Right?h.right-h.width/2:h.right,Math.max(a===tn.Right?h.left:h.left+h.width/2,d.x)),y:Math.min(a===tn.Down?h.bottom-h.height/2:h.bottom,Math.max(a===tn.Down?h.top:h.top+h.height/2,d.y))},p=a===tn.Right&&!o||a===tn.Left&&!l,x=a===tn.Down&&!c||a===tn.Up&&!n;if(p&&g.x!==d.x){const e=s.scrollLeft+t.x,n=a===tn.Right&&e<=m.x||a===tn.Left&&e>=u.x;if(n&&!t.y)return void s.scrollTo({left:e,behavior:i});r.x=n?s.scrollLeft-e:a===tn.Right?s.scrollLeft-m.x:s.scrollLeft-u.x,r.x&&s.scrollBy({left:-r.x,behavior:i});break}if(x&&g.y!==d.y){const e=s.scrollTop+t.y,n=a===tn.Down&&e<=m.y||a===tn.Up&&e>=u.y;if(n&&!t.x)return void s.scrollTo({top:e,behavior:i});r.y=n?s.scrollTop-e:a===tn.Down?s.scrollTop-m.y:s.scrollTop-u.y,r.y&&s.scrollBy({top:-r.y,behavior:i});break}}this.handleMove(e,aa(na(d,this.referenceCoordinates),r))}}}handleMove(e,t){const{onMove:s}=this.props;e.preventDefault(),s(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function ln(e){return Boolean(e&&"distance"in e)}function cn(e){return Boolean(e&&"delay"in e)}on.activators=[{eventName:"onKeyDown",handler:(e,t,s)=>{let{keyboardCodes:r=an,onActivation:a}=t,{active:n}=s;const{code:i}=e.nativeEvent;if(r.start.includes(i)){const t=n.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==a||a({event:e.nativeEvent}),!0)}return!1}}];class dn{constructor(e,t,s){var r;void 0===s&&(s=function(e){const{EventTarget:t}=$r(e);return e instanceof t?e:Yr(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:a}=e,{target:n}=a;this.props=e,this.events=t,this.document=Yr(n),this.documentListeners=new Za(this.document),this.listeners=new Za(s),this.windowListeners=new Za($r(n)),this.initialCoordinates=null!=(r=oa(a))?r:ja,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:s}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(en.Resize,this.handleCancel),this.windowListeners.add(en.DragStart,sn),this.windowListeners.add(en.VisibilityChange,this.handleCancel),this.windowListeners.add(en.ContextMenu,sn),this.documentListeners.add(en.Keydown,this.handleKeydown),t){if(null!=s&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(cn(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(ln(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:s,onPending:r}=this.props;r(s,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(en.Click,rn,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(en.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:s,initialCoordinates:r,props:a}=this,{onMove:n,options:{activationConstraint:i}}=a;if(!r)return;const o=null!=(t=oa(e))?t:ja,l=na(r,o);if(!s&&i){if(ln(i)){if(null!=i.tolerance&&Qa(l,i.tolerance))return this.handleCancel();if(Qa(l,i.distance))return this.handleStart()}return cn(i)&&Qa(l,i.tolerance)?this.handleCancel():void this.handlePending(i,l)}e.cancelable&&e.preventDefault(),n(o)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===tn.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const mn={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class un extends dn{constructor(e){const{event:t}=e,s=Yr(t.target);super(e,mn,s)}}un.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return!(!s.isPrimary||0!==s.button)&&(null==r||r({event:s}),!0)}}];const hn={move:{name:"mousemove"},end:{name:"mouseup"}};var gn;!function(e){e[e.RightClick=2]="RightClick"}(gn||(gn={}));(class extends dn{constructor(e){super(e,hn,Yr(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;return s.button!==gn.RightClick&&(null==r||r({event:s}),!0)}}];const pn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var xn,fn;function yn(e){let{acceleration:t,activator:s=xn.Pointer,canScroll:r,draggingRect:a,enabled:n,interval:i=5,order:o=fn.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:d,delta:m,threshold:u}=e;const h=function(e){let{delta:t,disabled:s}=e;const r=ea(t);return Zr(e=>{if(s||!r||!e)return vn;const a={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[Ua.Backward]:e.x[Ua.Backward]||-1===a.x,[Ua.Forward]:e.x[Ua.Forward]||1===a.x},y:{[Ua.Backward]:e.y[Ua.Backward]||-1===a.y,[Ua.Forward]:e.y[Ua.Forward]||1===a.y}}},[s,t,r])}({delta:m,disabled:!n}),[g,p]=function(){const e=j.useRef(null);return[j.useCallback((t,s)=>{e.current=setInterval(t,s)},[]),j.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),x=j.useRef({x:0,y:0}),f=j.useRef({x:0,y:0}),y=j.useMemo(()=>{switch(s){case xn.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case xn.DraggableRect:return a}},[s,a,l]),v=j.useRef(null),b=j.useCallback(()=>{const e=v.current;if(!e)return;const t=x.current.x*f.current.x,s=x.current.y*f.current.y;e.scrollBy(t,s)},[]),w=j.useMemo(()=>o===fn.TreeOrder?[...c].reverse():c,[o,c]);j.useEffect(()=>{if(n&&c.length&&y){for(const e of w){if(!1===(null==r?void 0:r(e)))continue;const s=c.indexOf(e),a=d[s];if(!a)continue;const{direction:n,speed:o}=qa(e,a,y,t,u);for(const e of["x","y"])h[e][n[e]]||(o[e]=0,n[e]=0);if(o.x>0||o.y>0)return p(),v.current=e,g(b,i),x.current=o,void(f.current=n)}x.current={x:0,y:0},f.current={x:0,y:0},p()}else p()},[t,b,r,p,n,i,JSON.stringify(y),JSON.stringify(h),g,c,w,d,JSON.stringify(u)])}(class extends dn{constructor(e){super(e,pn)}static setup(){return window.addEventListener(pn.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(pn.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:s}=e,{onActivation:r}=t;const{touches:a}=s;return!(a.length>1)&&(null==r||r({event:s}),!0)}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(xn||(xn={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(fn||(fn={}));const vn={x:{[Ua.Backward]:!1,[Ua.Forward]:!1},y:{[Ua.Backward]:!1,[Ua.Forward]:!1}};var bn,jn;!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(bn||(bn={})),function(e){e.Optimized="optimized"}(jn||(jn={}));const wn=new Map;function Nn(e,t){return Zr(s=>e?s||("function"==typeof t?t(e):e):null,[t,e])}function Cn(e){let{callback:t,disabled:s}=e;const r=Xr(t),a=j.useMemo(()=>{if(s||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(r)},[s]);return j.useEffect(()=>()=>null==a?void 0:a.disconnect(),[a]),a}function Sn(e){return new Ja(Ia(e),e)}function Dn(e,t,s){void 0===t&&(t=Sn);const[r,a]=j.useState(null);function n(){a(r=>{if(!e)return null;var a;if(!1===e.isConnected)return null!=(a=null!=r?r:s)?a:null;const n=t(e);return JSON.stringify(r)===JSON.stringify(n)?r:n})}const i=function(e){let{callback:t,disabled:s}=e;const r=Xr(t),a=j.useMemo(()=>{if(s||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(r)},[r,s]);return j.useEffect(()=>()=>null==a?void 0:a.disconnect(),[a]),a}({callback(t){if(e)for(const s of t){const{type:t,target:r}=s;if("childList"===t&&r instanceof HTMLElement&&r.contains(e)){n();break}}}}),o=Cn({callback:n});return Kr(()=>{n(),e?(null==o||o.observe(e),null==i||i.observe(document.body,{childList:!0,subtree:!0})):(null==o||o.disconnect(),null==i||i.disconnect())},[e]),r}const kn=[];function En(e,t){void 0===t&&(t=[]);const s=j.useRef(null);return j.useEffect(()=>{s.current=null},t),j.useEffect(()=>{const t=e!==ja;t&&!s.current&&(s.current=e),!t&&s.current&&(s.current=null)},[e]),s.current?na(e,s.current):ja}function An(e){return j.useMemo(()=>e?function(e){const t=e.innerWidth,s=e.innerHeight;return{top:0,left:0,right:t,bottom:s,width:t,height:s}}(e):null,[e])}const _n=[];function Rn(e){let{measure:t}=e;const[s,r]=j.useState(null),a=j.useCallback(e=>{for(const{target:s}of e)if(Vr(s)){r(e=>{const r=t(s);return e?{...e,width:r.width,height:r.height}:r});break}},[t]),n=Cn({callback:a}),i=j.useCallback(e=>{const s=function(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Vr(t)?t:e}(e);null==n||n.disconnect(),s&&(null==n||n.observe(s)),r(s?t(s):null)},[t,n]),[o,l]=Qr(i);return j.useMemo(()=>({nodeRef:o,rect:s,setRef:l}),[s,o,l])}const Fn=[{sensor:un,options:{}},{sensor:on,options:{}}],Pn={current:{}},zn={draggable:{measure:Ta},droppable:{measure:Ta,strategy:bn.WhileDragging,frequency:jn.Optimized},dragOverlay:{measure:Ia}};class In extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,s;return null!=(t=null==(s=this.get(e))?void 0:s.node.current)?t:void 0}}const Tn={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new In,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:va},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:zn,measureDroppableContainers:va,windowRect:null,measuringScheduled:!1},On={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:va,draggableNodes:new Map,over:null,measureDroppableContainers:va},Ln=j.createContext(On),Mn=j.createContext(Tn);function Bn(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new In}}}function Wn(e,t){switch(t.type){case ya.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ya.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ya.DragEnd:case ya.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ya.RegisterDroppable:{const{element:s}=t,{id:r}=s,a=new In(e.droppable.containers);return a.set(r,s),{...e,droppable:{...e.droppable,containers:a}}}case ya.SetDroppableDisabled:{const{id:s,key:r,disabled:a}=t,n=e.droppable.containers.get(s);if(!n||r!==n.key)return e;const i=new In(e.droppable.containers);return i.set(s,{...n,disabled:a}),{...e,droppable:{...e.droppable,containers:i}}}case ya.UnregisterDroppable:{const{id:s,key:r}=t,a=e.droppable.containers.get(s);if(!a||r!==a.key)return e;const n=new In(e.droppable.containers);return n.delete(s),{...e,droppable:{...e.droppable,containers:n}}}default:return e}}function Hn(e){let{disabled:t}=e;const{active:s,activatorEvent:r,draggableNodes:a}=j.useContext(Ln),n=ea(r),i=ea(null==s?void 0:s.id);return j.useEffect(()=>{if(!t&&!r&&n&&null!=i){if(!ia(n))return;if(document.activeElement===n.target)return;const e=a.get(i);if(!e)return;const{activatorNode:t,node:s}=e;if(!t.current&&!s.current)return;requestAnimationFrame(()=>{for(const e of[t.current,s.current]){if(!e)continue;const t=da(e);if(t){t.focus();break}}})}},[r,t,a,i,n]),null}const Un=j.createContext({...ja,scaleX:1,scaleY:1});var $n;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}($n||($n={}));const Gn=j.memo(function(e){var t,s,r,a;let{id:n,accessibility:i,autoScroll:o=!0,children:l,sensors:c=Fn,collisionDetection:d=_a,measuring:m,modifiers:u,...h}=e;const g=j.useReducer(Wn,void 0,Bn),[p,x]=g,[f,y]=function(){const[e]=j.useState(()=>new Set),t=j.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[j.useCallback(t=>{let{type:s,event:r}=t;e.forEach(e=>{var t;return null==(t=e[s])?void 0:t.call(e,r)})},[e]),t]}(),[v,b]=j.useState($n.Uninitialized),w=v===$n.Initialized,{draggable:{active:N,nodes:C,translate:k},droppable:{containers:E}}=p,A=null!=N?C.get(N):null,_=j.useRef({initial:null,translated:null}),R=j.useMemo(()=>{var e;return null!=N?{id:N,data:null!=(e=null==A?void 0:A.data)?e:Pn,rect:_}:null},[N,A]),F=j.useRef(null),[P,z]=j.useState(null),[I,T]=j.useState(null),O=Jr(h,Object.values(h)),L=sa("DndDescribedBy",n),M=j.useMemo(()=>E.getEnabled(),[E]),B=(W=m,j.useMemo(()=>({draggable:{...zn.draggable,...null==W?void 0:W.draggable},droppable:{...zn.droppable,...null==W?void 0:W.droppable},dragOverlay:{...zn.dragOverlay,...null==W?void 0:W.dragOverlay}}),[null==W?void 0:W.draggable,null==W?void 0:W.droppable,null==W?void 0:W.dragOverlay]));var W;const{droppableRects:H,measureDroppableContainers:U,measuringScheduled:$}=function(e,t){let{dragging:s,dependencies:r,config:a}=t;const[n,i]=j.useState(null),{frequency:o,measure:l,strategy:c}=a,d=j.useRef(e),m=function(){switch(c){case bn.Always:return!1;case bn.BeforeDragging:return s;default:return!s}}(),u=Jr(m),h=j.useCallback(function(e){void 0===e&&(e=[]),u.current||i(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[u]),g=j.useRef(null),p=Zr(t=>{if(m&&!s)return wn;if(!t||t===wn||d.current!==e||null!=n){const t=new Map;for(let s of e){if(!s)continue;if(n&&n.length>0&&!n.includes(s.id)&&s.rect.current){t.set(s.id,s.rect.current);continue}const e=s.node.current,r=e?new Ja(l(e),e):null;s.rect.current=r,r&&t.set(s.id,r)}return t}return t},[e,n,s,m,l]);return j.useEffect(()=>{d.current=e},[e]),j.useEffect(()=>{m||h()},[s,m]),j.useEffect(()=>{n&&n.length>0&&i(null)},[JSON.stringify(n)]),j.useEffect(()=>{m||"number"!=typeof o||null!==g.current||(g.current=setTimeout(()=>{h(),g.current=null},o))},[o,m,h,...r]),{droppableRects:p,measureDroppableContainers:h,measuringScheduled:null!=n}}(M,{dragging:w,dependencies:[k.x,k.y],config:B.droppable}),G=function(e,t){const s=null!=t?e.get(t):void 0,r=s?s.node.current:null;return Zr(e=>{var s;return null==t?null:null!=(s=null!=r?r:e)?s:null},[r,t])}(C,N),V=j.useMemo(()=>I?oa(I):null,[I]),q=function(){const e=!1===(null==P?void 0:P.autoScrollEnabled),t="object"==typeof o?!1===o.enabled:!1===o,s=w&&!e&&!t;if("object"==typeof o)return{...o,enabled:s};return{enabled:s}}(),Y=function(e,t){return Nn(e,t)}(G,B.draggable.measure);!function(e){let{activeNode:t,measure:s,initialRect:r,config:a=!0}=e;const n=j.useRef(!1),{x:i,y:o}="boolean"==typeof a?{x:a,y:a}:a;Kr(()=>{if(!i&&!o||!t)return void(n.current=!1);if(n.current||!r)return;const e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;const a=Ra(s(e),r);if(i||(a.x=0),o||(a.y=0),n.current=!0,Math.abs(a.x)>0||Math.abs(a.y)>0){const t=La(e);t&&t.scrollBy({top:a.y,left:a.x})}},[t,i,o,r,s])}({activeNode:null!=N?C.get(N):null,config:q.layoutShiftCompensation,initialRect:Y,measure:B.draggable.measure});const K=Dn(G,B.draggable.measure,Y),X=Dn(G?G.parentElement:null),J=j.useRef({activatorEvent:null,active:null,activeNode:G,collisionRect:null,collisions:null,droppableRects:H,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:E,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Z=E.getNodeFor(null==(t=J.current.over)?void 0:t.id),Q=Rn({measure:B.dragOverlay.measure}),ee=null!=(s=Q.nodeRef.current)?s:G,te=w?null!=(r=Q.rect)?r:K:null,se=Boolean(Q.nodeRef.current&&Q.rect),re=Ra(ae=se?null:K,Nn(ae));var ae;const ne=An(ee?$r(ee):null),ie=function(e){const t=j.useRef(e),s=Zr(s=>e?s&&s!==kn&&e&&t.current&&e.parentNode===t.current.parentNode?s:Oa(e):kn,[e]);return j.useEffect(()=>{t.current=e},[e]),s}(w?null!=Z?Z:G:null),oe=function(e,t){void 0===t&&(t=Ia);const[s]=e,r=An(s?$r(s):null),[a,n]=j.useState(_n);function i(){n(()=>e.length?e.map(e=>$a(e)?r:new Ja(t(e),e)):_n)}const o=Cn({callback:i});return Kr(()=>{null==o||o.disconnect(),i(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),a}(ie),le=function(e,t){let{transform:s,...r}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...r}),s):s}(u,{transform:{x:k.x-re.x,y:k.y-re.y,scaleX:1,scaleY:1},activatorEvent:I,active:R,activeNodeRect:K,containerNodeRect:X,draggingNodeRect:te,over:J.current.over,overlayNodeRect:Q.rect,scrollableAncestors:ie,scrollableAncestorRects:oe,windowRect:ne}),ce=V?aa(V,k):null,de=function(e){const[t,s]=j.useState(null),r=j.useRef(e),a=j.useCallback(e=>{const t=Ma(e.target);t&&s(e=>e?(e.set(t,Ha(t)),new Map(e)):null)},[]);return j.useEffect(()=>{const t=r.current;if(e!==t){n(t);const i=e.map(e=>{const t=Ma(e);return t?(t.addEventListener("scroll",a,{passive:!0}),[t,Ha(t)]):null}).filter(e=>null!=e);s(i.length?new Map(i):null),r.current=e}return()=>{n(e),n(t)};function n(e){e.forEach(e=>{const t=Ma(e);null==t||t.removeEventListener("scroll",a)})}},[a,e]),j.useMemo(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>aa(e,t),ja):Ka(e):ja,[e,t])}(ie),me=En(de),ue=En(de,[K]),he=aa(le,me),ge=te?Pa(te,le):null,pe=R&&ge?d({active:R,collisionRect:ge,droppableRects:H,droppableContainers:M,pointerCoordinates:ce}):null,xe=Da(pe,"id"),[fe,ye]=j.useState(null),ve=function(e,t,s){return{...e,scaleX:t&&s?t.width/s.width:1,scaleY:t&&s?t.height/s.height:1}}(se?le:aa(le,ue),null!=(a=null==fe?void 0:fe.rect)?a:null,K),be=j.useRef(null),je=j.useCallback((e,t)=>{let{sensor:s,options:r}=t;if(null==F.current)return;const a=C.get(F.current);if(!a)return;const n=e.nativeEvent,i=new s({active:F.current,activeNode:a,event:n,options:r,context:J,onAbort(e){if(!C.get(e))return;const{onDragAbort:t}=O.current,s={id:e};null==t||t(s),f({type:"onDragAbort",event:s})},onPending(e,t,s,r){if(!C.get(e))return;const{onDragPending:a}=O.current,n={id:e,constraint:t,initialCoordinates:s,offset:r};null==a||a(n),f({type:"onDragPending",event:n})},onStart(e){const t=F.current;if(null==t)return;const s=C.get(t);if(!s)return;const{onDragStart:r}=O.current,a={activatorEvent:n,active:{id:t,data:s.data,rect:_}};D.unstable_batchedUpdates(()=>{null==r||r(a),b($n.Initializing),x({type:ya.DragStart,initialCoordinates:e,active:t}),f({type:"onDragStart",event:a}),z(be.current),T(n)})},onMove(e){x({type:ya.DragMove,coordinates:e})},onEnd:o(ya.DragEnd),onCancel:o(ya.DragCancel)});function o(e){return async function(){const{active:t,collisions:s,over:r,scrollAdjustedTranslate:a}=J.current;let i=null;if(t&&a){const{cancelDrop:o}=O.current;if(i={activatorEvent:n,active:t,collisions:s,delta:a,over:r},e===ya.DragEnd&&"function"==typeof o){await Promise.resolve(o(i))&&(e=ya.DragCancel)}}F.current=null,D.unstable_batchedUpdates(()=>{x({type:e}),b($n.Uninitialized),ye(null),z(null),T(null),be.current=null;const t=e===ya.DragEnd?"onDragEnd":"onDragCancel";if(i){const e=O.current[t];null==e||e(i),f({type:t,event:i})}})}}be.current=i},[C]),we=j.useCallback((e,t)=>(s,r)=>{const a=s.nativeEvent,n=C.get(r);if(null!==F.current||!n||a.dndKit||a.defaultPrevented)return;const i={active:n};!0===e(s,t.options,i)&&(a.dndKit={capturedBy:t.sensor},F.current=r,je(s,t))},[C,je]),Ne=function(e,t){return j.useMemo(()=>e.reduce((e,s)=>{const{sensor:r}=s;return[...e,...r.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,s)}))]},[]),[e,t])}(c,we);!function(e){j.useEffect(()=>{if(!Wr)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(c),Kr(()=>{K&&v===$n.Initializing&&b($n.Initialized)},[K,v]),j.useEffect(()=>{const{onDragMove:e}=O.current,{active:t,activatorEvent:s,collisions:r,over:a}=J.current;if(!t||!s)return;const n={active:t,activatorEvent:s,collisions:r,delta:{x:he.x,y:he.y},over:a};D.unstable_batchedUpdates(()=>{null==e||e(n),f({type:"onDragMove",event:n})})},[he.x,he.y]),j.useEffect(()=>{const{active:e,activatorEvent:t,collisions:s,droppableContainers:r,scrollAdjustedTranslate:a}=J.current;if(!e||null==F.current||!t||!a)return;const{onDragOver:n}=O.current,i=r.get(xe),o=i&&i.rect.current?{id:i.id,rect:i.rect.current,data:i.data,disabled:i.disabled}:null,l={active:e,activatorEvent:t,collisions:s,delta:{x:a.x,y:a.y},over:o};D.unstable_batchedUpdates(()=>{ye(o),null==n||n(l),f({type:"onDragOver",event:l})})},[xe]),Kr(()=>{J.current={activatorEvent:I,active:R,activeNode:G,collisionRect:ge,collisions:pe,droppableRects:H,draggableNodes:C,draggingNode:ee,draggingNodeRect:te,droppableContainers:E,over:fe,scrollableAncestors:ie,scrollAdjustedTranslate:he},_.current={initial:te,translated:ge}},[R,G,pe,ge,C,ee,te,H,E,fe,ie,he]),yn({...q,delta:k,draggingRect:ge,pointerCoordinates:ce,scrollableAncestors:ie,scrollableAncestorRects:oe});const Ce=j.useMemo(()=>({active:R,activeNode:G,activeNodeRect:K,activatorEvent:I,collisions:pe,containerNodeRect:X,dragOverlay:Q,draggableNodes:C,droppableContainers:E,droppableRects:H,over:fe,measureDroppableContainers:U,scrollableAncestors:ie,scrollableAncestorRects:oe,measuringConfiguration:B,measuringScheduled:$,windowRect:ne}),[R,G,K,I,pe,X,Q,C,E,H,fe,U,ie,oe,B,$,ne]),Se=j.useMemo(()=>({activatorEvent:I,activators:Ne,active:R,activeNodeRect:K,ariaDescribedById:{draggable:L},dispatch:x,draggableNodes:C,over:fe,measureDroppableContainers:U}),[I,Ne,R,K,x,L,C,fe,U]);return S.createElement(ga.Provider,{value:y},S.createElement(Ln.Provider,{value:Se},S.createElement(Mn.Provider,{value:Ce},S.createElement(Un.Provider,{value:ve},l)),S.createElement(Hn,{disabled:!1===(null==i?void 0:i.restoreFocus)})),S.createElement(fa,{...i,hiddenTextDescribedById:L}))}),Vn=j.createContext(null),qn="button";function Yn(e){let{id:t,data:s,disabled:r=!1,attributes:a}=e;const n=sa("Draggable"),{activators:i,activatorEvent:o,active:l,activeNodeRect:c,ariaDescribedById:d,draggableNodes:m,over:u}=j.useContext(Ln),{role:h=qn,roleDescription:g="draggable",tabIndex:p=0}=null!=a?a:{},x=(null==l?void 0:l.id)===t,f=j.useContext(x?Un:Vn),[y,v]=Qr(),[b,w]=Qr(),N=function(e,t){return j.useMemo(()=>e.reduce((e,s)=>{let{eventName:r,handler:a}=s;return e[r]=e=>{a(e,t)},e},{}),[e,t])}(i,t),C=Jr(s);Kr(()=>(m.set(t,{id:t,key:n,node:y,activatorNode:b,data:C}),()=>{const e=m.get(t);e&&e.key===n&&m.delete(t)}),[m,t]);return{active:l,activatorEvent:o,activeNodeRect:c,attributes:j.useMemo(()=>({role:h,tabIndex:p,"aria-disabled":r,"aria-pressed":!(!x||h!==qn)||void 0,"aria-roledescription":g,"aria-describedby":d.draggable}),[r,h,p,x,g,d.draggable]),isDragging:x,listeners:r?void 0:N,node:y,over:u,setNodeRef:v,setActivatorNodeRef:w,transform:f}}const Kn={timeout:25};function Xn(e,t,s){const r=e.slice();return r.splice(s<0?r.length+s:s,0,r.splice(t,1)[0]),r}function Jn(e,t){return e.reduce((e,s,r)=>{const a=t.get(s);return a&&(e[r]=a),e},Array(e.length))}function Zn(e){return null!==e&&e>=0}const Qn=e=>{let{rects:t,activeIndex:s,overIndex:r,index:a}=e;const n=Xn(t,r,s),i=t[a],o=n[a];return o&&i?{x:o.left-i.left,y:o.top-i.top,scaleX:o.width/i.width,scaleY:o.height/i.height}:null},ei={scaleX:1,scaleY:1},ti=e=>{var t;let{activeIndex:s,activeNodeRect:r,index:a,rects:n,overIndex:i}=e;const o=null!=(t=n[s])?t:r;if(!o)return null;if(a===s){const e=n[i];return e?{x:0,y:s<i?e.top+e.height-(o.top+o.height):e.top-o.top,...ei}:null}const l=function(e,t,s){const r=e[t],a=e[t-1],n=e[t+1];if(!r)return 0;if(s<t)return a?r.top-(a.top+a.height):n?n.top-(r.top+r.height):0;return n?n.top-(r.top+r.height):a?r.top-(a.top+a.height):0}(n,a,s);return a>s&&a<=i?{x:0,y:-o.height-l,...ei}:a<s&&a>=i?{x:0,y:o.height+l,...ei}:{x:0,y:0,...ei}};const si="Sortable",ri=S.createContext({activeIndex:-1,containerId:si,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Qn,disabled:{draggable:!1,droppable:!1}});function ai(e){let{children:t,id:s,items:r,strategy:a=Qn,disabled:n=!1}=e;const{active:i,dragOverlay:o,droppableRects:l,over:c,measureDroppableContainers:d}=j.useContext(Mn),m=sa(si,s),u=Boolean(null!==o.rect),h=j.useMemo(()=>r.map(e=>"object"==typeof e&&"id"in e?e.id:e),[r]),g=null!=i,p=i?h.indexOf(i.id):-1,x=c?h.indexOf(c.id):-1,f=j.useRef(h),y=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}(h,f.current),v=-1!==x&&-1===p||y,b=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(n);Kr(()=>{y&&g&&d(h)},[y,h,g,d]),j.useEffect(()=>{f.current=h},[h]);const w=j.useMemo(()=>({activeIndex:p,containerId:m,disabled:b,disableTransforms:v,items:h,overIndex:x,useDragOverlay:u,sortedRects:Jn(h,l),strategy:a}),[p,m,b.draggable,b.droppable,v,h,x,l,u,a]);return S.createElement(ri.Provider,{value:w},t)}const ni=e=>{let{id:t,items:s,activeIndex:r,overIndex:a}=e;return Xn(s,r,a).indexOf(t)},ii=e=>{let{containerId:t,isSorting:s,wasDragging:r,index:a,items:n,newIndex:i,previousItems:o,previousContainerId:l,transition:c}=e;return!(!c||!r)&&((o===n||a!==i)&&(!!s||i!==a&&t===l))},oi={duration:200,easing:"ease"},li="transform",ci=la.Transition.toString({property:li,duration:0,easing:"linear"}),di={roleDescription:"sortable"};function mi(e){let{animateLayoutChanges:t=ii,attributes:s,disabled:r,data:a,getNewIndex:n=ni,id:i,strategy:o,resizeObserverConfig:l,transition:c=oi}=e;const{items:d,containerId:m,activeIndex:u,disabled:h,disableTransforms:g,sortedRects:p,overIndex:x,useDragOverlay:f,strategy:y}=j.useContext(ri),v=function(e,t){var s,r;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(s=null==e?void 0:e.draggable)?s:t.draggable,droppable:null!=(r=null==e?void 0:e.droppable)?r:t.droppable}}(r,h),b=d.indexOf(i),w=j.useMemo(()=>({sortable:{containerId:m,index:b,items:d},...a}),[m,a,b,d]),N=j.useMemo(()=>d.slice(d.indexOf(i)),[d,i]),{rect:C,node:S,isOver:D,setNodeRef:k}=function(e){let{data:t,disabled:s=!1,id:r,resizeObserverConfig:a}=e;const n=sa("Droppable"),{active:i,dispatch:o,over:l,measureDroppableContainers:c}=j.useContext(Ln),d=j.useRef({disabled:s}),m=j.useRef(!1),u=j.useRef(null),h=j.useRef(null),{disabled:g,updateMeasurementsFor:p,timeout:x}={...Kn,...a},f=Jr(null!=p?p:r),y=Cn({callback:j.useCallback(()=>{m.current?(null!=h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{c(Array.isArray(f.current)?f.current:[f.current]),h.current=null},x)):m.current=!0},[x]),disabled:g||!i}),v=j.useCallback((e,t)=>{y&&(t&&(y.unobserve(t),m.current=!1),e&&y.observe(e))},[y]),[b,w]=Qr(v),N=Jr(t);return j.useEffect(()=>{y&&b.current&&(y.disconnect(),m.current=!1,y.observe(b.current))},[b,y]),j.useEffect(()=>(o({type:ya.RegisterDroppable,element:{id:r,key:n,disabled:s,node:b,rect:u,data:N}}),()=>o({type:ya.UnregisterDroppable,key:n,id:r})),[r]),j.useEffect(()=>{s!==d.current.disabled&&(o({type:ya.SetDroppableDisabled,id:r,key:n,disabled:s}),d.current.disabled=s)},[r,n,s,o]),{active:i,rect:u,isOver:(null==l?void 0:l.id)===r,node:b,over:l,setNodeRef:w}}({id:i,data:w,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:N,...l}}),{active:E,activatorEvent:A,activeNodeRect:_,attributes:R,setNodeRef:F,listeners:P,isDragging:z,over:I,setActivatorNodeRef:T,transform:O}=Yn({id:i,data:w,attributes:{...di,...s},disabled:v.draggable}),L=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return j.useMemo(()=>e=>{t.forEach(t=>t(e))},t)}(k,F),M=Boolean(E),B=M&&!g&&Zn(u)&&Zn(x),W=!f&&z,H=W&&B?O:null,U=B?null!=H?H:(null!=o?o:y)({rects:p,activeNodeRect:_,activeIndex:u,overIndex:x,index:b}):null,$=Zn(u)&&Zn(x)?n({id:i,items:d,activeIndex:u,overIndex:x}):b,G=null==E?void 0:E.id,V=j.useRef({activeId:G,items:d,newIndex:$,containerId:m}),q=d!==V.current.items,Y=t({active:E,containerId:m,isDragging:z,isSorting:M,id:i,index:b,items:d,newIndex:V.current.newIndex,previousItems:V.current.items,previousContainerId:V.current.containerId,transition:c,wasDragging:null!=V.current.activeId}),K=function(e){let{disabled:t,index:s,node:r,rect:a}=e;const[n,i]=j.useState(null),o=j.useRef(s);return Kr(()=>{if(!t&&s!==o.current&&r.current){const e=a.current;if(e){const t=Ia(r.current,{ignoreTransform:!0}),s={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(s.x||s.y)&&i(s)}}s!==o.current&&(o.current=s)},[t,s,r,a]),j.useEffect(()=>{n&&i(null)},[n]),n}({disabled:!Y,index:b,node:S,rect:C});return j.useEffect(()=>{M&&V.current.newIndex!==$&&(V.current.newIndex=$),m!==V.current.containerId&&(V.current.containerId=m),d!==V.current.items&&(V.current.items=d)},[M,$,m,d]),j.useEffect(()=>{if(G===V.current.activeId)return;if(null!=G&&null==V.current.activeId)return void(V.current.activeId=G);const e=setTimeout(()=>{V.current.activeId=G},50);return()=>clearTimeout(e)},[G]),{active:E,activeIndex:u,attributes:R,data:w,rect:C,index:b,newIndex:$,items:d,isOver:D,isSorting:M,isDragging:z,listeners:P,node:S,overIndex:x,over:I,setNodeRef:L,setActivatorNodeRef:T,setDroppableNodeRef:k,setDraggableNodeRef:F,transform:null!=K?K:U,transition:function(){if(K||q&&V.current.newIndex===b)return ci;if(W&&!ia(A)||!c)return;if(M||Y)return la.Transition.toString({...c,property:li});return}()}}function ui(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const hi=[tn.Down,tn.Right,tn.Up,tn.Left],gi=(e,t)=>{let{context:{active:s,collisionRect:r,droppableRects:a,droppableContainers:n,over:i,scrollableAncestors:o}}=t;if(hi.includes(e.code)){if(e.preventDefault(),!s||!r)return;const t=[];n.getEnabled().forEach(s=>{if(!s||null!=s&&s.disabled)return;const n=a.get(s.id);if(n)switch(e.code){case tn.Down:r.top<n.top&&t.push(s);break;case tn.Up:r.top>n.top&&t.push(s);break;case tn.Left:r.left>n.left&&t.push(s);break;case tn.Right:r.left<n.left&&t.push(s)}});const l=(e=>{let{collisionRect:t,droppableRects:s,droppableContainers:r}=e;const a=Sa(t),n=[];for(const i of r){const{id:e}=i,t=s.get(e);if(t){const s=Sa(t),r=a.reduce((e,t,r)=>e+wa(s[r],t),0),o=Number((r/4).toFixed(4));n.push({id:e,data:{droppableContainer:i,value:o}})}}return n.sort(Na)})({collisionRect:r,droppableRects:a,droppableContainers:t});let c=Da(l,"id");if(c===(null==i?void 0:i.id)&&l.length>1&&(c=l[1].id),null!=c){const e=n.get(s.id),t=n.get(c),i=t?a.get(t.id):null,l=null==t?void 0:t.node.current;if(l&&i&&e&&t){const s=Oa(l).some((e,t)=>o[t]!==e),a=pi(e,t),n=function(e,t){if(!ui(e)||!ui(t))return!1;if(!pi(e,t))return!1;return e.data.current.sortable.index<t.data.current.sortable.index}(e,t),c=s||!a?{x:0,y:0}:{x:n?r.width-i.width:0,y:n?r.height-i.height:0},d={x:i.left,y:i.top};return c.x&&c.y?d:na(d,c)}}}};function pi(e,t){return!(!ui(e)||!ui(t))&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}const xi={"Employee Fields":[{label:"First Name",placeholder:"{{employee.firstName}}"},{label:"Last Name",placeholder:"{{employee.lastName}}"},{label:"Employee Number",placeholder:"{{employee.employeeNumber}}"},{label:"Email",placeholder:"{{employee.email}}"},{label:"Phone",placeholder:"{{employee.phoneNumber}}"},{label:"Department",placeholder:"{{employee.department}}"},{label:"Position",placeholder:"{{employee.position}}"}],"Warning Fields":[{label:"Warning Level",placeholder:"{{warning.level}}"},{label:"Issue Date",placeholder:"{{warning.issueDate}}"},{label:"Incident Date",placeholder:"{{warning.incidentDate}}"},{label:"Category",placeholder:"{{warning.category}}"},{label:"Description",placeholder:"{{warning.description}}"},{label:"Next Level",placeholder:"{{warning.nextLevel}}"}],"Organization Fields":[{label:"Company Name",placeholder:"{{organization.name}}"},{label:"Industry",placeholder:"{{organization.industry}}"}],"Manager Fields":[{label:"Manager Name",placeholder:"{{manager.name}}"},{label:"Manager Position",placeholder:"{{manager.position}}"}]},fi=({section:e,isOpen:t,onClose:r,onSave:a})=>{const[n,i]=j.useState(null),[o,l]=j.useState(null),[c,d]=j.useState("");if(j.useEffect(()=>{e&&t&&i({...e})},[e,t]),!n||!t)return null;const m=(e,t)=>{i("heading"===e?{...n,content:{...n.content,heading:n.content.heading+" "+t}}:{...n,content:{...n.content,body:(n.content.body||"")+" "+t}}),l(null)},u=()=>{c.trim()&&(i({...n,content:{...n.content,bulletPoints:[...n.content.bulletPoints||[],c.trim()]}}),d(""))},h=(e,t)=>{const s=[...n.content.subsections||[]],r=s[e].content;"paragraph"===t&&Array.isArray(r)?s[e]={...s[e],content:r.join(" ")}:"bullet"===t&&"string"==typeof r&&(s[e]={...s[e],content:r?[r]:[]}),i({...n,content:{...n.content,subsections:s}})};return s.jsxs(gt,{isOpen:t,onClose:r,size:"lg",zIndex:zr.MODAL,children:[s.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Edit Section: ",e?.name]}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Customize section content and insert custom fields"})]}),s.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(X,{className:"w-6 h-6"})})]}),s.jsxs("div",{className:"px-6 py-4 space-y-6 max-h-[calc(100vh-200px)] overflow-y-auto",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section Name"}),s.jsx("input",{type:"text",value:n.name,onChange:e=>i({...n,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Employee Information"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (optional)"}),s.jsx("input",{type:"text",value:n.description||"",onChange:e=>i({...n,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Brief description of this section's purpose"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[s.jsx(Be,{className:"w-4 h-4 inline mr-1"}),"Heading"]}),s.jsxs("button",{onClick:()=>l("heading"),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[s.jsx(We,{className:"w-3 h-3"}),"Insert Field"]})]}),s.jsx("input",{type:"text",value:n.content.heading,onChange:e=>i({...n,content:{...n.content,heading:e.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg font-medium",placeholder:"Section heading"}),"heading"===o&&s.jsxs("div",{className:"mt-2 p-3 border border-blue-200 bg-blue-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Available Fields"}),s.jsx("button",{onClick:()=>l(null),className:"text-xs text-blue-600 hover:text-blue-700",children:"Close"})]}),Object.entries(xi).map(([e,t])=>s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:e}),s.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(e=>s.jsx("button",{onClick:()=>m("heading",e.placeholder),className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-blue-100 hover:border-blue-400 transition-colors",children:e.label},e.placeholder))})]},e))]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[s.jsx(Be,{className:"w-4 h-4 inline mr-1"}),"Body Text"]}),s.jsxs("button",{onClick:()=>l("body"),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[s.jsx(We,{className:"w-3 h-3"}),"Insert Field"]})]}),s.jsx("textarea",{value:n.content.body||"",onChange:e=>i({...n,content:{...n.content,body:e.target.value}}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Main section content. Use {{placeholders}} for dynamic data."}),"body"===o&&s.jsxs("div",{className:"mt-2 p-3 border border-blue-200 bg-blue-50 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Available Fields"}),s.jsx("button",{onClick:()=>l(null),className:"text-xs text-blue-600 hover:text-blue-700",children:"Close"})]}),Object.entries(xi).map(([e,t])=>s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:e}),s.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(e=>s.jsx("button",{onClick:()=>m("body",e.placeholder),className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-blue-100 hover:border-blue-400 transition-colors",children:e.label},e.placeholder))})]},e))]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.jsx(He,{className:"w-4 h-4 inline mr-1"}),"Bullet Points (optional)"]}),n.content.bulletPoints&&n.content.bulletPoints.length>0&&s.jsx("div",{className:"space-y-2 mb-3",children:n.content.bulletPoints.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-400",children:"•"}),s.jsx("input",{type:"text",value:e,onChange:e=>((e,t)=>{const s=[...n.content.bulletPoints||[]];s[e]=t,i({...n,content:{...n.content,bulletPoints:s}})})(t,e.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"}),s.jsx("button",{onClick:()=>(e=>{i({...n,content:{...n.content,bulletPoints:n.content.bulletPoints?.filter((t,s)=>s!==e)}})})(t),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:s.jsx(de,{className:"w-4 h-4"})})]},t))}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&u(),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Add bullet point (press Enter or click +)"}),s.jsxs("button",{onClick:u,disabled:!c.trim(),className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:[s.jsx(we,{className:"w-4 h-4"}),"Add"]})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s.jsx(He,{className:"w-4 h-4 inline mr-1"}),"Subsections (optional)"]}),s.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Create structured multi-part sections with titles and content blocks. Used for Employee Rights, Consequences, etc."}),n.content.subsections&&n.content.subsections.length>0&&s.jsx("div",{className:"space-y-4 mb-4",children:n.content.subsections.map((e,t)=>s.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Subsection Title"}),s.jsx("input",{type:"text",value:e.title,onChange:e=>((e,t)=>{const s=[...n.content.subsections||[]];s[e]={...s[e],title:t},i({...n,content:{...n.content,subsections:s}})})(t,e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm mt-1",placeholder:"e.g., Your Rights:"})]}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Content Type:"}),s.jsx("button",{onClick:()=>h(t,"paragraph"),className:"px-2 py-1 text-xs rounded "+("string"==typeof e.content?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Paragraph"}),s.jsx("button",{onClick:()=>h(t,"bullet"),className:"px-2 py-1 text-xs rounded "+(Array.isArray(e.content)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Bullet Points"})]}),"string"==typeof e.content?s.jsx("textarea",{value:e.content,onChange:e=>((e,t)=>{const s=[...n.content.subsections||[]];s[e]={...s[e],content:t},i({...n,content:{...n.content,subsections:s}})})(t,e.target.value),rows:3,className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Enter paragraph content (use {{placeholders}} for dynamic data)"}):s.jsxs("div",{className:"space-y-2",children:[e.content.map((e,r)=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-gray-400",children:"•"}),s.jsx("input",{type:"text",value:e,onChange:e=>((e,t,s)=>{const r=[...n.content.subsections||[]],a=r[e].content;a[t]=s,r[e]={...r[e],content:a},i({...n,content:{...n.content,subsections:r}})})(t,r,e.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"}),s.jsx("button",{onClick:()=>((e,t)=>{const s=[...n.content.subsections||[]],r=s[e].content.filter((e,s)=>s!==t);s[e]={...s[e],content:r},i({...n,content:{...n.content,subsections:s}})})(t,r),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:s.jsx(de,{className:"w-3 h-3"})})]},r)),s.jsxs("button",{onClick:()=>(e=>{const t=[...n.content.subsections||[]],s=t[e].content;s.push(""),t[e]={...t[e],content:s},i({...n,content:{...n.content,subsections:t}})})(t),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[s.jsx(we,{className:"w-3 h-3"}),"Add bullet point"]})]}),s.jsxs("button",{onClick:()=>(e=>{i({...n,content:{...n.content,subsections:n.content.subsections?.filter((t,s)=>s!==e)}})})(t),className:"mt-3 text-xs text-red-600 hover:text-red-700 flex items-center gap-1",children:[s.jsx(de,{className:"w-3 h-3"}),"Delete Subsection"]})]},t))}),s.jsxs("button",{onClick:()=>{i({...n,content:{...n.content,subsections:[...n.content.subsections||[],{title:"New Subsection",content:[]}]}})},className:"w-full px-3 py-2 border-2 border-dashed border-gray-300 rounded-lg text-sm text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex items-center justify-center gap-2",children:[s.jsx(we,{className:"w-4 h-4"}),"Add Subsection"]})]}),s.jsxs("div",{className:"border-t pt-4",children:[s.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[s.jsx(Ue,{className:"w-4 h-4 inline mr-1"}),"Section Styling (optional)"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Heading Font Size (pt)"}),s.jsx("input",{type:"number",min:"10",max:"20",value:n.styling?.headingFontSize||"",onChange:e=>i({...n,styling:{...n.styling,headingFontSize:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Default"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs text-gray-600",children:"Body Font Size (pt)"}),s.jsx("input",{type:"number",min:"8",max:"16",value:n.styling?.bodyFontSize||"",onChange:e=>i({...n,styling:{...n.styling,bodyFontSize:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Default"})]})]})]}),"standard"===e?.type&&s.jsx("div",{className:"border-t pt-4",children:s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:n.isLocked||!1,onChange:e=>i({...n,isLocked:e.target.checked}),className:"w-4 h-4"}),s.jsx("span",{className:"text-sm text-gray-700",children:"Lock section (prevent editing in future)"})]})})]}),s.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t bg-gray-50",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:"Cancel"}),s.jsxs("button",{onClick:()=>{n&&(a({...n,updatedAt:new Date,updatedBy:"current-user"}),r())},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[s.jsx(Be,{className:"w-4 h-4"}),"Save Section"]})]})]})},yi=({section:e,onToggle:t,onEdit:r,onDelete:a})=>{const{attributes:n,listeners:i,setNodeRef:o,transform:l,transition:c,isDragging:d}=mi({id:e.id}),m={transform:la.Transform.toString(l),transition:c,opacity:d?.5:1};return s.jsxs("div",{ref:o,style:m,className:"flex items-center gap-3 px-3 py-2 border rounded-lg bg-white hover:border-gray-400 transition-colors",children:[s.jsx("button",{...n,...i,className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600","aria-label":"Drag to reorder",children:s.jsx(Ne,{className:"w-5 h-5"})}),s.jsx("input",{type:"checkbox",checked:e.enabled,onChange:()=>t(e.id),className:"w-4 h-4 cursor-pointer"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium text-sm text-gray-900 truncate",children:e.name}),e.isLocked&&s.jsx(be,{className:"w-3 h-3 text-gray-400 flex-shrink-0"}),s.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 flex-shrink-0",children:e.type})]}),e.description&&s.jsx("p",{className:"text-xs text-gray-500 mt-0.5 truncate",children:e.description})]}),s.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.jsx("button",{onClick:()=>r(e),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors","aria-label":"Edit section",children:s.jsx($e,{className:"w-4 h-4"})}),!e.isLocked&&"custom"===e.type&&s.jsx("button",{onClick:()=>a(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors","aria-label":"Delete section",children:s.jsx(de,{className:"w-4 h-4"})})]})]})},vi=({settings:e,onChange:t})=>{const[r,a]=j.useState(null),[n,i]=j.useState(!1),o=(()=>{if(e.sections&&e.sections.length>0)return e.sections;return[{id:"previous-disciplinary-actions",type:"standard",name:"Previous Disciplinary Actions",enabled:e.features.enablePreviousWarnings,order:0,content:{heading:"Previous Disciplinary Action",body:"This section provides a record of any prior warnings or disciplinary actions."}},{id:"consequences-section",type:"standard",name:"Consequences Section",enabled:e.features.enableConsequences,order:1,content:{heading:"Consequences of Further Misconduct",body:"Failure to improve your conduct may result in further disciplinary action."}},{id:"employee-rights-lra",type:"standard",name:"Employee Rights (LRA Compliance)",enabled:e.features.enableEmployeeRights,order:2,content:{heading:"Your Rights as an Employee",body:"In accordance with the Labour Relations Act 66 of 1995..."},isLocked:!0},{id:"appeal-history",type:"standard",name:"Appeal History Section",enabled:e.features.enableAppealSection,order:3,content:{heading:"Appeal Information",body:"If you wish to appeal this warning..."}},{id:"signatures",type:"standard",name:"Signature Section",enabled:e.features.enableSignatures,order:4,content:{heading:"Acknowledgment of Receipt",body:"By signing below, you acknowledge receipt of this warning."}}]})(),l=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return j.useMemo(()=>[...t].filter(e=>null!=e),[...t])}(ba(un),ba(on,{coordinateGetter:gi})),c=s=>{const r=o.map(e=>e.id===s?{...e,enabled:!e.enabled}:e);t({...e,sections:r})},d=e=>{a(e),i(!0)},m=s=>{const r=o.find(e=>e.id===s);if(r&&confirm(`Are you sure you want to delete "${r.name}"?\n\nThis action cannot be undone.`)){const r=o.filter(e=>e.id!==s).map((e,t)=>({...e,order:t}));t({...e,sections:r})}};return s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:s.jsxs("p",{className:"text-sm text-blue-900",children:[s.jsx("strong",{children:"Drag"})," sections to reorder, ",s.jsx("strong",{children:"check/uncheck"})," to enable/disable, click ",s.jsx("strong",{children:"Edit"})," to customize content and add custom fields."]})}),s.jsx(Gn,{sensors:l,collisionDetection:Ea,onDragEnd:s=>{const{active:r,over:a}=s;if(a&&r.id!==a.id){const s=o.findIndex(e=>e.id===r.id),n=o.findIndex(e=>e.id===a.id),i=Xn(o,s,n).map((e,t)=>({...e,order:t}));t({...e,sections:i})}},children:s.jsx(ai,{items:o.map(e=>e.id),strategy:ti,children:s.jsx("div",{className:"space-y-2",children:o.map(e=>s.jsx(yi,{section:e,onToggle:c,onEdit:d,onDelete:m},e.id))})})}),s.jsxs("button",{onClick:()=>{const s={id:`custom-section-${Date.now()}`,type:"custom",name:"New Custom Section",enabled:!0,order:o.length,content:{heading:"Custom Section Heading",body:"Enter your custom content here. You can use {{placeholders}} for dynamic data.",bulletPoints:[]},description:"Custom section created by user",createdAt:new Date,createdBy:"current-user"};t({...e,sections:[...o,s]}),setTimeout(()=>{a(s),i(!0)},100)},className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 font-medium",children:[s.jsx(we,{className:"w-5 h-5"}),"Add Custom Section"]}),s.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[o.filter(e=>e.enabled).length," of ",o.length," sections enabled"]}),s.jsx(fi,{section:r,isOpen:n,onClose:()=>{i(!1),a(null)},onSave:s=>{const r=o.map(e=>e.id===s.id?s:e);t({...e,sections:r}),i(!1),a(null)}})]})},bi=({settings:e,onChange:t})=>{const[r,a]=j.useState(new Set(["colors","sections"])),n=(s,r)=>{const a=s.split("."),n={...e};let i=n;for(let e=0;e<a.length-1;e++)i[a[e]]={...i[a[e]]},i=i[a[e]];i[a[a.length-1]]=r,t(n)},i=({id:e,title:t,icon:n,children:i})=>{const o=r.has(e);return s.jsxs("div",{className:"border rounded-lg",style:{borderColor:"var(--color-border)"},children:[s.jsxs("button",{onClick:()=>(e=>{const t=new Set(r);t.has(e)?t.delete(e):t.add(e),a(t)})(e),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50 transition-colors",style:{backgroundColor:o?"var(--color-primary-bg)":"transparent"},children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(n,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:t})]}),o?s.jsx(Ee,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}}):s.jsx(Ae,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]}),o&&s.jsx("div",{className:"px-4 py-4 border-t",style:{borderColor:"var(--color-border)"},children:i})]})};return s.jsxs("div",{className:"space-y-3",children:[s.jsx(i,{id:"colors",title:"Colors",icon:Ue,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Header Background"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"color",value:e.styling.headerBackground,onChange:e=>n("styling.headerBackground",e.target.value),className:"w-16 h-10 rounded border cursor-pointer",style:{borderColor:"var(--color-border)"}}),s.jsx("input",{type:"text",value:e.styling.headerBackground,onChange:e=>n("styling.headerBackground",e.target.value),className:"flex-1 px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)"},placeholder:"#3B82F6"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Section Headers"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"color",value:e.styling.sectionHeaderColor,onChange:e=>n("styling.sectionHeaderColor",e.target.value),className:"w-16 h-10 rounded border cursor-pointer",style:{borderColor:"var(--color-border)"}}),s.jsx("input",{type:"text",value:e.styling.sectionHeaderColor,onChange:e=>n("styling.sectionHeaderColor",e.target.value),className:"flex-1 px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)"},placeholder:"#333333"})]})]}),s.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[s.jsx("input",{type:"checkbox",id:"useBrandColors",checked:e.styling.useBrandColors,onChange:e=>n("styling.useBrandColors",e.target.checked),className:"w-4 h-4 cursor-pointer"}),s.jsx("label",{htmlFor:"useBrandColors",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Use organization's brand colors"})]})]})}),s.jsx(i,{id:"typography",title:"Typography",icon:Be,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Font Family"}),s.jsxs("select",{value:e.styling.fontFamily,onChange:e=>n("styling.fontFamily",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"},children:[s.jsx("option",{value:"Helvetica",children:"Helvetica"}),s.jsx("option",{value:"Times",children:"Times New Roman"}),s.jsx("option",{value:"Arial",children:"Arial"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Base Font Size: ",e.styling.fontSize,"pt"]}),s.jsx("input",{type:"range",min:"10",max:"12",step:"0.5",value:e.styling.fontSize,onChange:e=>n("styling.fontSize",parseFloat(e.target.value)),className:"w-full"}),s.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[s.jsx("span",{children:"10pt"}),s.jsx("span",{children:"12pt"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Line Height: ",e.styling.lineHeight.toFixed(1)]}),s.jsx("input",{type:"range",min:"1.0",max:"2.0",step:"0.1",value:e.styling.lineHeight,onChange:e=>n("styling.lineHeight",parseFloat(e.target.value)),className:"w-full"}),s.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[s.jsx("span",{children:"1.0"}),s.jsx("span",{children:"2.0"})]})]})]})}),s.jsx(i,{id:"layout",title:"Layout",icon:Ge,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Page Size"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx("button",{onClick:()=>n("styling.pageSize","A4"),className:"px-4 py-2 rounded border font-medium "+("A4"===e.styling.pageSize?"ring-2":""),style:{borderColor:"A4"===e.styling.pageSize?"var(--color-primary)":"var(--color-border)",backgroundColor:"A4"===e.styling.pageSize?"var(--color-primary-bg)":"transparent",color:"var(--color-text)"},children:"A4"}),s.jsx("button",{onClick:()=>n("styling.pageSize","Letter"),className:"px-4 py-2 rounded border font-medium "+("Letter"===e.styling.pageSize?"ring-2":""),style:{borderColor:"Letter"===e.styling.pageSize?"var(--color-primary)":"var(--color-border)",backgroundColor:"Letter"===e.styling.pageSize?"var(--color-primary-bg)":"transparent",color:"var(--color-text)"},children:"Letter"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Margins (mm)"}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Top"}),s.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.top,onChange:e=>n("styling.margins.top",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Bottom"}),s.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.bottom,onChange:e=>n("styling.margins.bottom",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Left"}),s.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.left,onChange:e=>n("styling.margins.left",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Right"}),s.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.right,onChange:e=>n("styling.margins.right",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]})]})]})]})}),s.jsx(i,{id:"branding",title:"Branding",icon:Ie,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"showLogo",checked:e.content.showLogo,onChange:e=>n("content.showLogo",e.target.checked),className:"w-4 h-4 cursor-pointer"}),s.jsx("label",{htmlFor:"showLogo",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Show company logo"})]}),e.content.showLogo&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Logo Position"}),s.jsxs("select",{value:e.content.logoPosition,onChange:e=>n("content.logoPosition",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"},children:[s.jsx("option",{value:"top-left",children:"Top Left"}),s.jsx("option",{value:"top-center",children:"Top Center"}),s.jsx("option",{value:"top-right",children:"Top Right"})]})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Logo Max Height: ",e.content.logoMaxHeight,"mm"]}),s.jsx("input",{type:"range",min:"10",max:"30",value:e.content.logoMaxHeight,onChange:e=>n("content.logoMaxHeight",parseInt(e.target.value)),className:"w-full"}),s.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[s.jsx("span",{children:"10mm"}),s.jsx("span",{children:"30mm"})]})]})]})]})}),s.jsx(i,{id:"sections",title:"PDF Sections",icon:_e,children:s.jsx(vi,{settings:e,onChange:t})}),s.jsx(i,{id:"watermark",title:"Watermark",icon:pe,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"showWatermark",checked:e.content.showWatermark,onChange:e=>n("content.showWatermark",e.target.checked),className:"w-4 h-4 cursor-pointer"}),s.jsx("label",{htmlFor:"showWatermark",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Enable watermark"})]}),e.content.showWatermark&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Watermark Text"}),s.jsx("input",{type:"text",value:e.content.watermarkText,onChange:e=>n("content.watermarkText",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)"},placeholder:"CONFIDENTIAL"})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Opacity: ",Math.round(100*e.content.watermarkOpacity),"%"]}),s.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:e.content.watermarkOpacity,onChange:e=>n("content.watermarkOpacity",parseFloat(e.target.value)),className:"w-full"}),s.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[s.jsx("span",{children:"0%"}),s.jsx("span",{children:"100%"})]})]})]})]})}),s.jsx(i,{id:"version",title:"Version Control",icon:Ve,children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"PDF Generator Version"}),s.jsxs("select",{value:e.generatorVersion,onChange:e=>n("generatorVersion",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"},children:[s.jsx("option",{value:"1.0.0",children:"v1.0.0 (Legacy)"}),s.jsx("option",{value:"1.1.0",children:"v1.1.0 (Current)"})]}),s.jsx("p",{className:"text-xs mt-2",style:{color:"var(--color-text-secondary)"},children:"Version determines PDF format for new warnings"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"autoUpgrade",checked:e.autoUpgrade,onChange:e=>n("autoUpgrade",e.target.checked),className:"w-4 h-4 cursor-pointer"}),s.jsx("label",{htmlFor:"autoUpgrade",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Auto-upgrade to new versions when released"})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"betaFeatures",checked:e.betaFeatures,onChange:e=>n("betaFeatures",e.target.checked),className:"w-4 h-4 cursor-pointer"}),s.jsx("label",{htmlFor:"betaFeatures",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Enable experimental features"})]})]})})]})},ji=({settings:t,organization:r})=>{const[a,n]=j.useState(null),[i,o]=j.useState(!1),[l,c]=j.useState(null),[d,m]=j.useState(100),u=j.useRef(null),h=j.useCallback(async()=>{o(!0),c(null);try{const s=function(e,t){const s=new Date;return{warningId:"PREVIEW_SAMPLE",organizationId:e.id,status:"issued",pdfGeneratorVersion:t.generatorVersion,pdfSettings:t,issuedByName:"John Smith",issuedDate:s,incidentDate:new Date(s.getTime()-1728e5),employee:{firstName:"Jane",lastName:"Doe",employeeNumber:"EMP001",department:"Operations",position:"Production Operator",email:"jane.doe@example.com",phone:"+27 82 123 4567"},warningLevel:"first_written",category:"Attendance Issues",description:"Employee arrived 45 minutes late to shift without prior notification or valid reason. This is the third occurrence of tardiness in the past month.",incidentTime:"08:45",incidentLocation:"Production Floor A",organization:e,signatures:{managerName:"John Smith",managerSignature:null,employeeSignature:null,witnessSignature:null},additionalNotes:"Employee expressed understanding of the policy and committed to improved punctuality.",validityPeriod:6,employeeStatement:"I apologize for being late. I had car trouble and my phone battery died so I couldn't call ahead. I understand this has happened before and I take full responsibility. I will ensure I leave earlier to account for potential delays.",expectedBehaviorStandards:"All employees are expected to:\n• Arrive at their designated workstation at least 5 minutes before shift start time\n• Notify their supervisor immediately if they will be late (via phone call, not SMS)\n• Maintain a punctuality record of at least 95% over any 3-month period\n• Plan transportation with buffer time to account for potential delays",factsLeadingToDecision:"After reviewing the attendance records, CCTV footage, and the employee's statement, the following facts were established:\n\n1. Employee arrived at 08:45 AM, 45 minutes after shift start (08:00 AM)\n2. No advance notification was provided to the supervisor\n3. This is the third late arrival in the past 30 days\n4. Previous verbal warning was issued on "+new Date(s.getTime()-2592e6).toLocaleDateString()+"\n5. Employee's explanation is noted, but the pattern of tardiness remains a concern\n\nGiven the repeated nature of the offense and the previous warning, escalation to a written warning is appropriate under our progressive discipline policy.",improvementCommitments:[{commitment:"Leave home 30 minutes earlier each day to ensure on-time arrival",timeline:"Immediate - starting next shift"},{commitment:"Keep phone charged and ensure supervisor's number is saved for emergency contact",timeline:"Immediate"},{commitment:"Maintain 100% on-time attendance for the next 90 days",timeline:"90 days from "+s.toLocaleDateString()}],reviewDate:new Date(s.getTime()+2592e6),interventionDetails:"Employee was provided with a copy of the attendance policy and counseled on time management strategies. Discussed setting multiple alarms and planning alternative transport routes.",resourcesProvided:["Company Attendance Policy (Updated 2024)","Time Management Tips for Shift Workers","Emergency Contact Procedures Guide"],disciplineRecommendation:{recommendedLevel:"first_written",reasoning:"Progressive discipline - first written warning appropriate for repeated attendance issues",activeWarnings:[{date:new Date(s.getTime()-2592e6),level:"verbal",category:"Attendance Issues",description:"Late arrival without notification"}],lraCompliance:{isCompliant:!0,notes:"Follows progressive discipline as per LRA guidelines"}},legalCompliance:{framework:"LRA 1995 - South African Labour Law",isCompliant:!0,requirements:["Progressive discipline followed as per Schedule 8 of LRA","Employee provided with opportunity to respond","Proportionate response to misconduct severity","Documented evidence of incident","Prior warnings considered in escalation decision"],safetyRisk:!1,repeatOffense:!0,priorWarnings:1,notes:"Warning issued in accordance with company disciplinary code and LRA guidelines"}}}(r,t),{PDFGenerationService:a}=await _(async()=>{const{PDFGenerationService:e}=await Promise.resolve().then(()=>Rr);return{PDFGenerationService:e}},void 0),i=await a.generateWarningPDF(s,t.generatorVersion,t);n(e=>(e&&URL.revokeObjectURL(e),URL.createObjectURL(i))),e.success("PDF preview generated successfully")}catch(s){e.error("Failed to generate PDF preview:",s),c(s instanceof Error?s.message:"Failed to generate preview")}finally{o(!1)}},[t,r]);j.useEffect(()=>(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{h()},500),()=>{u.current&&clearTimeout(u.current)}),[t,h]),j.useEffect(()=>(h(),()=>{a&&URL.revokeObjectURL(a)}),[]);return s.jsx(p,{padding:"md",shadow:"md",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Live PDF Preview"}),s.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Sample warning with current template settings"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg border",style:{borderColor:"var(--color-border)"},children:[s.jsx("button",{onClick:()=>{m(e=>Math.max(e-25,50))},disabled:d<=50,className:"p-1 rounded hover:bg-opacity-10 hover:bg-gray-500 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Zoom Out",children:s.jsx(qe,{className:"w-4 h-4",style:{color:"var(--color-text)"}})}),s.jsxs("span",{className:"text-xs font-medium mx-1",style:{color:"var(--color-text)"},children:[d,"%"]}),s.jsx("button",{onClick:()=>{m(e=>Math.min(e+25,200))},disabled:d>=200,className:"p-1 rounded hover:bg-opacity-10 hover:bg-gray-500 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Zoom In",children:s.jsx(Ye,{className:"w-4 h-4",style:{color:"var(--color-text)"}})}),s.jsx("button",{onClick:()=>{m(100)},className:"p-1 rounded hover:bg-opacity-10 hover:bg-gray-500 transition-colors ml-1",title:"Reset Zoom",children:s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"1:1"})})]}),s.jsxs("button",{onClick:h,disabled:i,className:"px-3 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-1.5",style:{backgroundColor:"var(--color-surface)",color:"var(--color-text)",border:"1px solid var(--color-border)"},title:"Regenerate Preview",children:[s.jsx(oe,{className:"w-4 h-4 "+(i?"animate-spin":"")}),"Refresh"]}),s.jsxs("button",{onClick:()=>{if(!a)return;const e=document.createElement("a");e.href=a,e.download=`${r.name}_PDF_Template_Preview.pdf`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},disabled:!a||i,className:"px-3 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-1.5 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},title:"Download Test PDF",children:[s.jsx(Ke,{className:"w-4 h-4"}),"Download"]})]})]}),s.jsxs("div",{className:"relative w-full",style:{minHeight:"600px"},children:[i&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 rounded-lg",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:s.jsxs("div",{className:"text-center",children:[s.jsx(Le,{className:"w-8 h-8 animate-spin mx-auto mb-2",style:{color:"var(--color-text-inverse)"}}),s.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-inverse)"},children:"Generating preview..."})]})}),l&&s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(ne,{className:"w-12 h-12 mb-4",style:{color:"var(--color-error)"}}),s.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--color-text)"},children:"Preview Generation Failed"}),s.jsx("p",{className:"text-sm text-center max-w-md",style:{color:"var(--color-text-secondary)"},children:l}),s.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:"Try Again"})]}),a&&!l&&s.jsx("div",{className:"w-full overflow-auto rounded-lg border",style:{borderColor:"var(--color-border)",height:"700px",backgroundColor:"#525659"},children:s.jsx("iframe",{src:a,className:"w-full h-full",style:{transform:`scale(${d/100})`,transformOrigin:"top center",minHeight:d>100?d/100*700+"px":"700px"},title:"PDF Preview"})}),!a&&!l&&!i&&s.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx(_e,{className:"w-12 h-12 mb-4",style:{color:"var(--color-text-tertiary)"}}),s.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--color-text)"},children:"Generating Preview..."}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Please wait while we generate a sample PDF"})]})]}),s.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg",style:{backgroundColor:"var(--color-info-bg)"},children:[s.jsx(ne,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-info)"}}),s.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[s.jsx("p",{className:"font-medium mb-1",children:"Preview uses sample data"}),s.jsx("p",{children:"This preview shows how warning documents will appear with your current template settings. Changes are automatically reflected after 500ms."})]})]})]})})};const wi=({organizations:t,onTemplateUpdate:r})=>{const{user:a}=l(),[n,i]=j.useState(null),[o,c]=j.useState(""),[d,m]=j.useState(!1),[u,h]=j.useState(!1),[g,x]=j.useState(null),[f,y]=j.useState(!1),v=t.find(e=>e.id===n),b=t.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.id.toLowerCase().includes(o.toLowerCase())),w=j.useCallback(e=>{if(i(e.id),m(!0),e.pdfSettings)x(e.pdfSettings);else{const e=Fr.getDefaultSettings("system");x(e)}e.name},[]),N=j.useCallback(async t=>{if(n&&a?.id){y(!0);try{await Fr.saveTemplate(n,t,a.id),e.success("PDF template saved successfully!"),alert("✅ PDF Template saved successfully!"),r&&await r()}catch(s){e.error("Failed to save PDF template:",s);const t=s instanceof Error?s.message:"Unknown error occurred";alert(`❌ Failed to save PDF template: ${t}`)}finally{y(!1)}}else e.warn("⚠️ Cannot save: missing selectedOrgId or user.id")},[n,a,r]);return s.jsxs("div",{className:"space-y-6",children:[s.jsx(p,{padding:"md",shadow:"md",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"📄 PDF Template Manager"}),s.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Customize PDF generation per organization with live preview"})]})})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-1",children:s.jsx(p,{padding:"md",shadow:"md",children:s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("h3",{className:"font-semibold",style:{color:"var(--color-text)"},children:["Organizations (",t.length,")"]})}),s.jsxs("div",{className:"relative",children:[s.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-secondary)"}}),s.jsx("input",{type:"text",placeholder:"Search organizations...",value:o,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"}})]}),s.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:0===b.length?s.jsxs("div",{className:"text-center py-8",children:[s.jsx(ne,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"No organizations found"})]}):b.map(e=>s.jsx("button",{onClick:()=>w(e),className:"w-full text-left px-4 py-3 rounded-lg transition-colors "+(n===e.id?"ring-2":""),style:{backgroundColor:n===e.id?"var(--color-primary-bg)":"var(--color-background)",border:n===e.id?"1px solid var(--color-primary)":"1px solid var(--color-border)"},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-semibold truncate",style:{color:"var(--color-text)"},children:e.name}),s.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.pdfSettings?.generatorVersion||"No version set"})]}),n===e.id&&s.jsx(Pe,{className:"w-5 h-5 flex-shrink-0 ml-2",style:{color:"var(--color-primary)"}})]})},e.id))})]})})}),s.jsx("div",{className:"lg:col-span-2",children:v?s.jsxs("div",{className:"space-y-6",children:[s.jsx(p,{padding:"md",shadow:"md",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:v.name}),s.jsxs("p",{className:"text-sm mt-0.5",style:{color:"var(--color-text-secondary)"},children:["PDF Version: ",v.pdfSettings?.generatorVersion||"Not set"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>h(!u),className:"px-3 py-2 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:u?"var(--color-primary)":"transparent",color:u?"var(--color-text-inverse)":"var(--color-text)",border:"1px solid "+(u?"transparent":"var(--color-border)")},children:[u?"Hide":"Show"," Preview"]}),s.jsxs("button",{onClick:()=>{g&&N(g)},disabled:f,className:"px-3 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[f&&s.jsx(Le,{className:"w-4 h-4 animate-spin"}),f?"Saving...":"Save Template"]})]})]})}),g&&s.jsx(bi,{settings:g,onChange:x}),u&&g&&v&&s.jsx(ji,{settings:g,organization:v})]}):s.jsx(p,{padding:"lg",shadow:"md",children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx(_e,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),s.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"Select an Organization"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Choose an organization from the list to customize its PDF templates"})]})})})]})]})};const Ni=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,t)).toFixed(2))} ${["B","KB","MB","GB"][t]}`},Ci=()=>{const{user:t}=l(),a=x(768),[n,i]=j.useState({totalOrganizations:0,totalEmployees:0,totalResellers:0,monthlyGrowth:0}),[o,c]=j.useState([]),[d,u]=j.useState(!0),[h,f]=j.useState(null),[y,v]=j.useState(!1),[b,w]=j.useState({isOpen:!1,organizationId:"",organizationName:""});j.useEffect(()=>{N()},[]);const N=async()=>{try{u(!0);const[t,s]=await Promise.all([r.loadOrganizations(),r.getAllResellers()]);let a=0;const n=s.length,o=await Promise.all(t.map(async t=>{try{const s=(await m.queryDocuments(t.id,"warnings")).documents.filter(e=>!0===e.isActive),r=await(async t=>{try{let e=0;const r=$(g,`organizations/${t}/audio`);try{const t=await q(r);for(const s of t.items)e+=(await Y(s)).size||0}catch(s){}const a=$(g,`organizations/${t}/signatures`);try{const t=await q(a);for(const s of t.items)e+=(await Y(s)).size||0}catch(s){}return e}catch(s){return e.error(`Error calculating storage for ${t}:`,s),0}})(t.id);return{...t,warningCount:s.length,storageUsage:r}}catch(s){return{...t,warningCount:0,storageUsage:0}}}));c(o),o.forEach(e=>{a+=e.employeeCount||0});const l=new Date,d=l.getMonth(),h=l.getFullYear(),p=0===d?11:d-1,x=0===d?h-1:h;let f=0,y=0;o.forEach(e=>{if(e.createdAt){const t=e.createdAt instanceof Date?e.createdAt:e.createdAt.toDate?.()||new Date(e.createdAt),s=t.getMonth(),r=t.getFullYear();s===d&&r===h&&f++,s===p&&r===x&&y++}});let v=0;y>0?v=Math.round((f-y)/y*100):f>0&&(v=100),i({totalOrganizations:o.length,totalEmployees:a,totalResellers:n,monthlyGrowth:v}),e.success("SuperAdmin dashboard data loaded successfully")}catch(t){e.error("Error loading SuperAdmin dashboard:",t)}finally{u(!1)}},C=async t=>{e.success("Organization deployed successfully!",t),v(!1),await N()};return a?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>f("organizations"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Fe,{className:"w-8 h-8 text-blue-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Organizations"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:n.totalOrganizations})]})]})}),s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>f("organizations"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(te,{className:"w-8 h-8 text-green-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Employees"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:n.totalEmployees.toLocaleString()})]})]})}),s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>f("resellers"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Je,{className:"w-8 h-8 text-orange-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Active Resellers"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:n.totalResellers})]})]})}),s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>f("financial"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(re,{className:"w-8 h-8 text-purple-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Monthly Growth"}),s.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:["+",n.monthlyGrowth,"%"]})]})]})})]}),s.jsx("div",{className:"border-b",style:{borderColor:"var(--color-border)"},children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"organizations",label:"Organizations",count:n.totalOrganizations},{id:"resellers",label:"Resellers",count:n.totalResellers},{id:"pdf-templates",label:"PDF Templates",count:null},{id:"audio",label:"Audio Cleanup",count:null},{id:"financial",label:"Financial",count:null}].map(e=>s.jsxs("button",{onClick:()=>f(e.id),className:"py-3 px-1 border-b-2 font-medium text-sm transition-colors "+(h===e.id?"border-blue-500 text-blue-600":"border-transparent hover:border-gray-300"),style:{color:h===e.id?"var(--color-primary)":"var(--color-text-secondary)"},children:[e.label,null!==e.count&&s.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100",children:e.count})]},e.id))})}),h&&function(){switch(h){case"organizations":return s.jsxs(p,{padding:"none",shadow:"md",children:[s.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",style:{borderColor:"var(--color-border)"},children:[s.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"🏢 Organizations & Category Management"}),s.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-colors",style:{background:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[s.jsx(Xe,{className:"w-4 h-4"}),"Deploy New Organization"]})]}),d?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Loading organizations..."})]})}):0===o.length?s.jsxs("div",{className:"px-6 py-12 text-center",children:[s.jsx(Fe,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),s.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"No Organizations Yet"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Deploy your first organization to start managing the system"})]}):s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{style:{background:"var(--color-background-secondary)"},children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Organization"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Industry"}),s.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Employees"}),s.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Warnings"}),s.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Storage"}),s.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y",style:{borderColor:"var(--color-border)"},children:o.map(e=>s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold",style:{color:"var(--color-text)"},children:e.name}),s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:e.id})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-50 text-blue-700 capitalize",children:e.industry||e.sector})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:s.jsx("span",{className:0===e.employeeCount?"text-gray-500":"text-green-600",children:e.employeeCount||0})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:s.jsx("span",{className:0===e.warningCount?"text-green-600":"text-red-600",children:e.warningCount||0})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:s.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm",style:{color:"var(--color-text-secondary)"},children:[s.jsx(Ze,{className:"w-4 h-4"}),s.jsx("span",{className:"font-medium",children:Ni(e.storageUsage||0)})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:s.jsx("div",{className:"flex items-center justify-center gap-2",children:s.jsx("button",{onClick:()=>(e=>{w({isOpen:!0,organizationId:e.id,organizationName:e.name})})(e),className:"text-xs px-3 py-1 rounded font-semibold bg-purple-600 text-white hover:bg-purple-700",children:"Categories"})})})]},e.id))})]})})]});case"resellers":return s.jsx(or,{});case"pdf-templates":return s.jsx(wi,{organizations:o,onTemplateUpdate:N});case"audio":return s.jsx(dr,{});case"financial":return s.jsx(p,{padding:"lg",shadow:"md",children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx(se,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),s.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"Financial Dashboard"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Revenue tracking and commission management coming soon"})]})});default:return null}}(),s.jsx(lt,{}),S()]}):s.jsxs("div",{className:"space-y-6 pb-20",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:"👑 Super Admin"}),s.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Global system management"})]}),s.jsx(p,{padding:"md",shadow:"lg",hover:!0,onClick:()=>v(!0),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",color:"var(--color-text-inverse)",minHeight:"64px",willChange:"transform"},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Xe,{className:"w-6 h-6"}),s.jsx("span",{className:"font-bold text-lg",children:"Deploy New Organization"})]}),s.jsx(Ce,{className:"w-5 h-5"})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>f("organizations"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(Fe,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Organizations"}),s.jsx("span",{className:"text-lg font-bold",children:n.totalOrganizations})]})}),s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>f("organizations"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(te,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Employees"}),s.jsx("span",{className:"text-lg font-bold",children:n.totalEmployees.toLocaleString()})]})}),s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>f("resellers"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(Je,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Resellers"}),s.jsx("span",{className:"text-lg font-bold",children:n.totalResellers})]})}),s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>f("financial"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #8b5cf6, #7c3aed)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(re,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Growth"}),s.jsxs("span",{className:"text-lg font-bold",children:["+",n.monthlyGrowth,"%"]})]})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(p,{padding:"md",shadow:"sm",hover:!0,onClick:()=>f("audio"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(he,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Audio Cleanup"})]}),s.jsx(Ce,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),s.jsx(p,{padding:"md",shadow:"sm",hover:!0,onClick:()=>f("pdf-templates"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(_e,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"PDF Templates"})]}),s.jsx(Ce,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),s.jsx(p,{padding:"md",shadow:"sm",hover:!0,onClick:()=>f("financial"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(se,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Financial Dashboard"})]}),s.jsx(Ce,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),s.jsx(lt,{}),S()]});function S(){return s.jsxs(s.Fragment,{children:[y&&s.jsx(Mr,{isOpen:y,onClose:()=>v(!1),onComplete:C}),b.isOpen&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] flex flex-col shadow-2xl my-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-purple-50 to-blue-50 flex-shrink-0",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Warning Categories"}),s.jsx("p",{className:"text-sm text-gray-600",children:b.organizationName})]}),s.jsx("button",{onClick:()=>w(e=>({...e,isOpen:!1})),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:s.jsx(X,{className:"w-5 h-5 text-gray-600"})})]}),s.jsx("div",{className:"overflow-y-auto flex-1 p-6",children:s.jsx(ur,{onClose:()=>w(e=>({...e,isOpen:!1})),organizationId:b.organizationId,organizationName:b.organizationName,inline:!0,allowEdit:!0})})]})})]})}},Si=j.createContext(null),Di={didCatch:!1,error:null};class ki extends j.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Di}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var t,s,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];null===(t=(s=this.props).onReset)||void 0===t||t.call(s,{args:a,reason:"imperative-api"}),this.setState(Di)}}componentDidCatch(e,t){var s,r;null===(s=(r=this.props).onError)||void 0===s||s.call(r,e,t)}componentDidUpdate(e,t){const{didCatch:s}=this.state,{resetKeys:r}=this.props;var a,n;s&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,s)=>!Object.is(e,t[s]))}(e.resetKeys,r)&&(null===(a=(n=this.props).onReset)||void 0===a||a.call(n,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(Di))}render(){const{children:e,fallbackRender:t,FallbackComponent:s,fallback:r}=this.props,{didCatch:a,error:n}=this.state;let i=e;if(a){const e={error:n,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)i=t(e);else if(s)i=j.createElement(s,e);else{if(void 0===r)throw n;i=r}}return j.createElement(Si.Provider,{value:{didCatch:a,error:n,resetErrorBoundary:this.resetErrorBoundary}},i)}}const Ei="hr-system-selected-dashboard-role",Ai=j.memo(({selectedRole:e,onRoleChange:t,className:r=""})=>{const{canManageOrganization:a,canManageHR:n}=A(),[i,o]=j.useState(!1),l=j.useRef(null),c=[];if(a()&&c.push({id:"executive-management",label:"Executive Management",description:"Executive & Configuration",icon:Qe}),n()&&c.push({id:"hr-manager",label:"HR Manager",description:"HR Operations & Compliance",icon:pe}),(a()||n())&&c.push({id:"hod-manager",label:"Department Manager",description:"Team Management",icon:te}),c.length<2)return null;j.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&o(!1)};if(i)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i]);const d=j.useCallback(e=>{t(e),localStorage.setItem(Ei,e),o(!1)},[t]),m=c.find(t=>t.id===e),u=m?.icon||Qe;return s.jsxs("div",{className:`relative ${r}`,ref:l,children:[s.jsxs("button",{onClick:()=>o(!i),className:"flex items-center gap-1.5 px-2 py-1.5 sm:px-3 sm:py-2 sm:gap-2 rounded-lg transition-all duration-200 hover:scale-105 w-full sm:w-auto",style:{backgroundColor:"rgba(255,255,255,0.15)",backdropFilter:"blur(4px)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--color-text-inverse)"},children:[s.jsx(u,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),s.jsxs("div",{className:"text-left flex-1 min-w-0",children:[s.jsx("div",{className:"text-[10px] sm:text-xs opacity-70 leading-none",children:"View as"}),s.jsx("div",{className:"text-xs sm:text-sm font-semibold leading-tight truncate",children:m?.label})]}),s.jsx(Ae,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0 transition-transform duration-200 "+(i?"rotate-180":"")})]}),i&&s.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 rounded-lg shadow-2xl overflow-hidden",style:{backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-border)",zIndex:9999},children:[s.jsxs("div",{className:"p-2",children:[s.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2 px-3 py-1",style:{color:"var(--color-text-secondary)"},children:"Switch Dashboard View"}),c.map(t=>{const r=t.icon,a=t.id===e;return s.jsxs("button",{onClick:()=>d(t.id),className:"w-full flex items-start gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 hover:scale-[1.02]",style:{backgroundColor:a?"var(--color-primary-subtle)":"transparent",borderLeft:a?"3px solid var(--color-primary)":"3px solid transparent"},children:[s.jsx(r,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"var(--color-primary)"}}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--color-text)"},children:[t.label,a&&s.jsx("span",{className:"ml-2 text-xs font-normal",style:{color:"var(--color-success)"},children:"● Active"})]}),s.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:t.description})]})]},t.id)})]}),s.jsx("div",{className:"px-3 py-2 text-xs",style:{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderTop:"1px solid var(--color-border)"},children:"💡 Your selection will be remembered for this session"})]})]})});function _i(e,t,s){const r=s(),a=localStorage.getItem(Ei);return"executive-management"===a&&e||"hr-manager"===a&&t||"hod-manager"===a&&(e||t)&&"executive-management"!==r&&"hr-manager"!==r?a:"executive-management"===r&&e?"executive-management":"hr-manager"===r&&t?"hr-manager":"hod-manager"===r?"hod-manager":e?"executive-management":t?"hr-manager":"executive-management"}Ai.displayName="DashboardRoleSelector";const Ri=j.memo(({className:e="",selectedRole:t,onRoleChange:r})=>{const a=x(768),{user:n}=l();let i=null;try{i=f()?.organization}catch(u){i=null}const{getPrimaryRole:o}=A(),c=()=>{switch(o()){case"executive-management":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-primary))"};case"hr-manager":return{background:"linear-gradient(135deg, var(--color-success), var(--color-info))"};case"hod-manager":return{background:"linear-gradient(135deg, var(--color-primary), var(--color-info))"};case"supervisor":return{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning-hover))"};case"super-user":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent-hover))"};default:return{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))"}}},d=()=>o()?.replace(/-/g," ").toUpperCase()||"USER",m=()=>{const e=(new Date).getHours();return e<12?"Morning":e<17?"Afternoon":"Evening"};return s.jsx("div",{className:e,children:a?s.jsxs(p,{padding:"md",shadow:"lg",className:"relative",style:{...c(),color:"var(--color-text-inverse)",overflow:"visible"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 rounded-full -translate-y-16 translate-x-16",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),s.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("h1",{className:"text-2xl font-bold",children:["Good ",m(),", ",n?.firstName,"! 👋"]})}),s.jsx("div",{className:"hidden lg:block text-sm opacity-90 pl-4 ml-2",style:{borderLeft:"1px solid rgba(255,255,255,0.2)"},children:i?.name||"SuperUser Dashboard"})]}),s.jsx("div",{className:"flex items-center gap-6",children:t&&r?s.jsx(Ai,{selectedRole:t,onRoleChange:r}):s.jsxs(y,{variant:"primary",size:"md",className:"flex items-center gap-2",style:{backgroundColor:"rgba(255,255,255,0.1)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)"},children:[s.jsx(et,{className:"w-4 h-4 opacity-80"}),s.jsx("div",{className:"text-sm font-medium",children:d()})]})})]})]}):s.jsxs(p,{padding:"none",shadow:"lg",className:"relative",style:{...c(),color:"var(--color-text-inverse)",overflow:"visible"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 rounded-full -translate-y-10 translate-x-10",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),s.jsxs("div",{className:"relative z-10 p-3 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs leading-none",style:{opacity:.85},children:["Good ",m(),","]}),s.jsxs("h1",{className:"text-lg font-bold leading-tight mt-0.5",children:[n?.firstName,"! 👋"]})]}),s.jsx(y,{variant:"primary",size:"sm",className:"inline-block",style:{backgroundColor:"rgba(255,255,255,0.15)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)",fontSize:"9px",padding:"2px 5px",lineHeight:"1"},children:s.jsx("span",{className:"font-bold tracking-wider uppercase",children:d()})})]}),t&&r&&s.jsx(Ai,{selectedRole:t,onRoleChange:r})]})]})})});Ri.displayName="WelcomeSection";const Fi=S.lazy(()=>_(()=>import("./hr-dashboard-Dso9aBo_.js").then(e=>e.H),__vite__mapDeps([5,1,0,2,3,4])).then(e=>({default:e.HRDashboardSection}))),Pi=S.lazy(()=>_(()=>import("./hod-dashboard-CL_RWHxj.js").then(e=>e.H),__vite__mapDeps([6,1,0,2,3,4,5])).then(e=>({default:e.HODDashboardSection}))),zi=S.lazy(()=>_(()=>import("./business-owner-dashboard-Dq6MrEKt.js").then(e=>e.I),__vite__mapDeps([0,1,2,3,4])).then(e=>({default:e.ExecutiveManagementDashboardSection}))),Ii=j.memo(({error:e,resetErrorBoundary:t})=>s.jsxs("div",{className:"rounded-lg p-6 m-4",style:{backgroundColor:"var(--color-alert-error-bg)",border:"1px solid var(--color-alert-error-border)"},children:[s.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--color-alert-error-text)"},children:"Something went wrong"}),s.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-alert-error-text)"},children:e.message}),s.jsx("button",{onClick:t,className:"px-4 py-2 rounded-lg transition-colors text-white",style:{backgroundColor:"var(--color-error)",hover:{backgroundColor:"var(--color-error)"}},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Try again"})]}));Ii.displayName="ErrorFallback";const Ti=j.memo(()=>s.jsxs("div",{className:"animate-pulse py-4",children:[s.jsx("div",{className:"h-8 rounded w-1/3 mb-2",style:{backgroundColor:"var(--color-muted)"}}),s.jsx("div",{className:"h-4 rounded w-2/3",style:{backgroundColor:"var(--color-subtle)"}})]})),Oi=j.memo(()=>s.jsxs("div",{className:"rounded-2xl p-6 animate-pulse",style:{backgroundColor:"var(--color-card-background)",boxShadow:"var(--shadow-lg)",border:"1px solid var(--color-card-border)"},children:[s.jsx("div",{className:"h-6 rounded w-1/3 mb-4",style:{backgroundColor:"var(--color-muted)"}}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"h-4 rounded w-full",style:{backgroundColor:"var(--color-subtle)"}}),s.jsx("div",{className:"h-4 rounded w-3/4",style:{backgroundColor:"var(--color-subtle)"}})]})]}));Ti.displayName="WelcomeSkeleton",Oi.displayName="SkeletonCard";const Li=j.memo(()=>{const{user:e}=l(),{organizationData:t}=f(),{getPrimaryRole:r,canManageOrganization:a,canManageHR:n}=A(),[i,o]=j.useState(()=>_i(a(),n(),r));j.useEffect(()=>{const e=_i(a(),n(),r);("executive-management"===i&&!a()||"hr-manager"===i&&!n()||"hod-manager"===i&&!a()&&!n())&&o(e)},[a,n,r,i]);return e?s.jsxs("div",{className:"space-y-6",children:[s.jsx(ki,{FallbackComponent:Ii,children:s.jsx(j.Suspense,{fallback:s.jsx(Ti,{}),children:s.jsx(Ri,{selectedRole:i,onRoleChange:e=>{o(e)}})})}),s.jsxs("div",{children:["executive-management"===i&&a()&&s.jsx(ki,{FallbackComponent:Ii,children:s.jsx(j.Suspense,{fallback:s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[s.jsx(Oi,{}),s.jsx(Oi,{}),s.jsx(Oi,{})]}),children:s.jsx(zi,{})})}),"hr-manager"===i&&n()&&s.jsx(ki,{FallbackComponent:Ii,children:s.jsx(j.Suspense,{fallback:s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-4 mb-6",children:[s.jsx(Oi,{}),s.jsx(Oi,{}),s.jsx(Oi,{}),s.jsx(Oi,{})]}),children:s.jsx(Fi,{})})}),("hod-manager"===i||"hod-manager"===r())&&s.jsx(ki,{FallbackComponent:Ii,children:s.jsx(j.Suspense,{fallback:s.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[s.jsx(Oi,{}),s.jsx(Oi,{}),s.jsx(Oi,{})]}),children:s.jsx(Pi,{})})}),"hod-manager"!==i&&"hod-manager"!==r()&&s.jsx("div",{className:"mt-6",children:s.jsx(ki,{FallbackComponent:Ii,children:s.jsx(j.Suspense,{fallback:s.jsx("div",{className:"h-20 bg-white rounded-xl shadow-sm animate-pulse border border-gray-100"}),children:s.jsx(lt,{})})})})]})]}):s.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:s.jsx("div",{className:"text-center",children:s.jsx("div",{className:"text-gray-600",children:"Loading dashboard..."})})})});Li.displayName="BusinessDashboard";const Mi=({client:t,isOpen:r,onClose:a,onUpdate:i})=>{const[o,l]=j.useState("general"),[c,d]=j.useState(!1),[u,h]=j.useState(!1),[g,p]=j.useState({totalEmployees:0,totalWarnings:0,totalCategories:0,totalUsers:0}),[x,f]=j.useState({name:t.name||"",contactEmail:t.contactEmail||"",contactPhone:t.contactPhone||"",address:t.address||"",industry:t.industry||"",description:t.description||""});j.useEffect(()=>{console.log("📊 Client data received:",t),console.log("📊 Client.industry:",t.industry),console.log("📊 Client.sector:",t.sector),f({name:t.name||"",contactEmail:t.contactEmail||"",contactPhone:t.contactPhone||"",address:t.address||"",industry:t.industry||t.sector||"",description:t.description||""})},[t]),j.useEffect(()=>{r&&t.id&&y()},[r,t.id]);const y=async()=>{try{d(!0),t.id;const s=await n.loadEmployees(t.id),r=await n.loadWarnings(t.id),a=await m.queryDocuments(t.id,"categories",[]);p({totalEmployees:s.documents.length,totalWarnings:r.documents.length,totalCategories:a.documents.length,totalUsers:0}),e.success("Client statistics loaded successfully")}catch(s){"permission-denied"===s?.code||s?.message?.includes("Missing or insufficient permissions")?p({totalEmployees:0,totalWarnings:0,totalCategories:0,totalUsers:0}):e.error("Failed to load client statistics:",s)}finally{d(!1)}},v=[{id:"general",label:"General Info",icon:Fe,description:"Basic organization details"},{id:"categories",label:"Warning Categories",icon:fe,description:"Manage warning categories and escalation paths"},{id:"analytics",label:"Analytics",icon:re,description:"Performance metrics and insights"}];return r?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:s.jsx(Fe,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:t.name}),s.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[s.jsx(tt,{className:"w-4 h-4 text-yellow-500"}),"Client Organization Management"]})]})]}),s.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:s.jsx(X,{className:"w-5 h-5 text-gray-600"})})]}),s.jsx("div",{className:"p-6 border-b bg-gray-50",children:s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.totalEmployees}),s.jsx("div",{className:"text-xs text-gray-600",children:"Employees"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.totalCategories}),s.jsx("div",{className:"text-xs text-gray-600",children:"Categories"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:g.totalWarnings}),s.jsx("div",{className:"text-xs text-gray-600",children:"Total Warnings"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:"✓"}),s.jsx("div",{className:"text-xs text-gray-600",children:"Status"})]})]})}),s.jsx("div",{className:"border-b",children:s.jsx("nav",{className:"flex space-x-1 p-2",children:v.map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>l(e.id),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors "+(o===e.id?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[s.jsx(t,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:block",children:e.label})]},e.id)})})}),s.jsxs("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:["general"===o&&s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Organization Details"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Update basic organization information"})]}),s.jsxs("button",{onClick:async()=>{try{h(!0),await i(t.id,x),e.success("Client information updated successfully")}catch(s){e.error("Failed to update client information:",s)}finally{h(!1)}},disabled:u,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[u?s.jsx(oe,{className:"w-4 h-4 animate-spin"}):s.jsx(st,{className:"w-4 h-4"}),u?"Saving...":"Save Changes"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Organization Name"}),s.jsx("input",{type:"text",value:x.name,onChange:e=>f({...x,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter organization name"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),s.jsxs("select",{value:x.industry,onChange:e=>f({...x,industry:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"Select industry"}),s.jsxs("optgroup",{label:"Primary Industries",children:[s.jsx("option",{value:"agriculture",children:"Agriculture & Farming"}),s.jsx("option",{value:"mining",children:"Mining & Quarrying"}),s.jsx("option",{value:"forestry",children:"Forestry & Logging"}),s.jsx("option",{value:"fishing",children:"Fishing & Aquaculture"})]}),s.jsxs("optgroup",{label:"Manufacturing & Production",children:[s.jsx("option",{value:"manufacturing",children:"Manufacturing (General)"}),s.jsx("option",{value:"food-processing",children:"Food & Beverage Processing"}),s.jsx("option",{value:"textiles",children:"Textiles & Clothing"}),s.jsx("option",{value:"automotive",children:"Automotive Manufacturing"}),s.jsx("option",{value:"pharmaceuticals",children:"Pharmaceuticals & Medical Devices"}),s.jsx("option",{value:"chemicals",children:"Chemicals & Plastics"}),s.jsx("option",{value:"electronics",children:"Electronics & Technology Manufacturing"}),s.jsx("option",{value:"construction-materials",children:"Construction Materials"})]}),s.jsxs("optgroup",{label:"Construction & Engineering",children:[s.jsx("option",{value:"construction",children:"Construction & Building"}),s.jsx("option",{value:"civil-engineering",children:"Civil Engineering"}),s.jsx("option",{value:"electrical-engineering",children:"Electrical Engineering"}),s.jsx("option",{value:"mechanical-engineering",children:"Mechanical Engineering"}),s.jsx("option",{value:"architecture",children:"Architecture & Design"})]}),s.jsxs("optgroup",{label:"Retail & Wholesale",children:[s.jsx("option",{value:"retail",children:"Retail & Commerce (General)"}),s.jsx("option",{value:"wholesale",children:"Wholesale & Distribution"}),s.jsx("option",{value:"supermarkets",children:"Supermarkets & Grocery"}),s.jsx("option",{value:"fashion-retail",children:"Fashion & Apparel Retail"}),s.jsx("option",{value:"automotive-retail",children:"Automotive Sales & Service"}),s.jsx("option",{value:"furniture-retail",children:"Furniture & Home Goods"}),s.jsx("option",{value:"electronics-retail",children:"Electronics & Appliances Retail"})]}),s.jsxs("optgroup",{label:"Hospitality & Tourism",children:[s.jsx("option",{value:"hospitality",children:"Hospitality & Tourism"}),s.jsx("option",{value:"hotels",children:"Hotels & Accommodation"}),s.jsx("option",{value:"restaurants",children:"Restaurants & Food Service"}),s.jsx("option",{value:"travel-agencies",children:"Travel Agencies & Tour Operators"}),s.jsx("option",{value:"entertainment",children:"Entertainment & Recreation"})]}),s.jsxs("optgroup",{label:"Healthcare & Social Services",children:[s.jsx("option",{value:"healthcare",children:"Healthcare (General)"}),s.jsx("option",{value:"hospitals",children:"Hospitals & Clinics"}),s.jsx("option",{value:"nursing-homes",children:"Nursing Homes & Elderly Care"}),s.jsx("option",{value:"medical-practices",children:"Medical Practices & Specialists"}),s.jsx("option",{value:"veterinary",children:"Veterinary Services"}),s.jsx("option",{value:"social-services",children:"Social Services & NGOs"})]}),s.jsxs("optgroup",{label:"Education & Training",children:[s.jsx("option",{value:"education",children:"Education & Training"}),s.jsx("option",{value:"schools",children:"Schools & Colleges"}),s.jsx("option",{value:"universities",children:"Universities & Higher Education"}),s.jsx("option",{value:"vocational-training",children:"Vocational & Skills Training"}),s.jsx("option",{value:"childcare",children:"Childcare & Early Learning"})]}),s.jsxs("optgroup",{label:"Financial Services",children:[s.jsx("option",{value:"banking",children:"Banking & Financial Services"}),s.jsx("option",{value:"insurance",children:"Insurance"}),s.jsx("option",{value:"investment",children:"Investment & Asset Management"}),s.jsx("option",{value:"accounting",children:"Accounting & Auditing"}),s.jsx("option",{value:"real-estate",children:"Real Estate & Property Management"})]}),s.jsxs("optgroup",{label:"Professional Services",children:[s.jsx("option",{value:"legal",children:"Legal Services"}),s.jsx("option",{value:"consulting",children:"Consulting & Advisory"}),s.jsx("option",{value:"marketing",children:"Marketing & Advertising"}),s.jsx("option",{value:"hr-recruitment",children:"HR & Recruitment"}),s.jsx("option",{value:"business-services",children:"Business Support Services"})]}),s.jsxs("optgroup",{label:"Technology & Communications",children:[s.jsx("option",{value:"it-services",children:"IT Services & Software"}),s.jsx("option",{value:"telecommunications",children:"Telecommunications"}),s.jsx("option",{value:"media",children:"Media & Broadcasting"}),s.jsx("option",{value:"publishing",children:"Publishing & Printing"}),s.jsx("option",{value:"data-centers",children:"Data Centers & Cloud Services"})]}),s.jsxs("optgroup",{label:"Transportation & Logistics",children:[s.jsx("option",{value:"logistics",children:"Logistics & Supply Chain"}),s.jsx("option",{value:"transportation",children:"Transportation & Freight"}),s.jsx("option",{value:"warehousing",children:"Warehousing & Storage"}),s.jsx("option",{value:"courier",children:"Courier & Postal Services"}),s.jsx("option",{value:"aviation",children:"Aviation & Airports"}),s.jsx("option",{value:"maritime",children:"Maritime & Shipping"})]}),s.jsxs("optgroup",{label:"Energy & Utilities",children:[s.jsx("option",{value:"energy",children:"Energy & Power Generation"}),s.jsx("option",{value:"renewable-energy",children:"Renewable Energy"}),s.jsx("option",{value:"water-utilities",children:"Water & Sanitation"}),s.jsx("option",{value:"waste-management",children:"Waste Management & Recycling"})]}),s.jsxs("optgroup",{label:"Security & Emergency Services",children:[s.jsx("option",{value:"security",children:"Security Services"}),s.jsx("option",{value:"private-security",children:"Private Security & Guarding"}),s.jsx("option",{value:"emergency-services",children:"Emergency Services"}),s.jsx("option",{value:"fire-safety",children:"Fire Safety & Protection"})]}),s.jsxs("optgroup",{label:"Government & Public Sector",children:[s.jsx("option",{value:"government",children:"Government & Public Administration"}),s.jsx("option",{value:"municipal",children:"Municipal Services"}),s.jsx("option",{value:"public-utilities",children:"Public Utilities"})]}),s.jsxs("optgroup",{label:"Other",children:[s.jsx("option",{value:"sports",children:"Sports & Fitness"}),s.jsx("option",{value:"beauty-wellness",children:"Beauty & Wellness"}),s.jsx("option",{value:"cleaning",children:"Cleaning & Facilities Management"}),s.jsx("option",{value:"maintenance",children:"Maintenance & Repair Services"}),s.jsx("option",{value:"other",children:"Other Industry"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email"}),s.jsxs("div",{className:"relative",children:[s.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"email",value:x.contactEmail,onChange:e=>f({...x,contactEmail:e.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@organization.com"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone"}),s.jsxs("div",{className:"relative",children:[s.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"tel",value:x.contactPhone,onChange:e=>f({...x,contactPhone:e.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 XX XXX XXXX"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),s.jsxs("div",{className:"relative",children:[s.jsx(Z,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),s.jsx("textarea",{value:x.address,onChange:e=>f({...x,address:e.target.value}),rows:3,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Full business address"})]})]})]}),"categories"===o&&s.jsx(ur,{onClose:()=>{},inline:!0,organizationId:t.id,organizationName:t.name,allowEdit:!0}),"analytics"===o&&s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Analytics"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Insights and metrics for this client organization"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"font-semibold text-gray-900",children:"Active Warnings"}),s.jsx(ne,{className:"w-5 h-5 text-orange-500"})]}),s.jsx("div",{className:"text-3xl font-bold text-orange-600",children:g.activeWarnings}),s.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Out of ",g.totalWarnings," total warnings"]})]}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"font-semibold text-gray-900",children:"Total Employees"}),s.jsx(te,{className:"w-5 h-5 text-blue-500"})]}),s.jsx("div",{className:"text-3xl font-bold text-blue-600",children:g.totalEmployees}),s.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Managed workforce"})]})]}),s.jsxs("div",{className:"mt-8",children:[s.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Quick Recommendations"}),s.jsxs("div",{className:"space-y-3",children:[g.activeWarnings>5&&s.jsxs("div",{className:"flex items-start gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[s.jsx(ne,{className:"w-5 h-5 text-orange-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-orange-900",children:"High Active Warnings"}),s.jsx("p",{className:"text-sm text-orange-700",children:"Consider reviewing and resolving active warnings to improve workforce management."})]})]}),g.totalCategories<5&&s.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx(Se,{className:"w-5 h-5 text-blue-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h5",{className:"font-medium text-blue-900",children:"Limited Warning Categories"}),s.jsx("p",{className:"text-sm text-blue-700",children:"Consider adding more specific warning categories to improve HR management granularity."})]})]})]})]})]})]})]})}):null},Bi=({client:e,isOpen:t,onClose:r})=>{return s.jsx(gt,{isOpen:t,onClose:r,title:"Client Organization Summary",maxWidth:"2xl",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-start gap-4 pb-6 border-b border-gray-200",children:[s.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(rt,{className:"w-6 h-6 text-blue-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900",children:e.name}),s.jsx("p",{className:"text-gray-600",children:e.sector}),s.jsx("div",{className:"mt-2",children:s.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-red-600 bg-red-100";case"trial":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}})(e.metrics.subscriptionStatus)}`,children:[(e=>{switch(e){case"active":return s.jsx(ae,{className:"w-4 h-4"});case"inactive":return s.jsx(ne,{className:"w-4 h-4"});case"trial":return s.jsx(ue,{className:"w-4 h-4"});default:return null}})(e.metrics.subscriptionStatus),e.metrics.subscriptionStatus.charAt(0).toUpperCase()+e.metrics.subscriptionStatus.slice(1)]})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(te,{className:"w-4 h-4 text-blue-600"}),s.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Employees"})]}),s.jsx("div",{className:"text-2xl font-bold text-blue-900",children:e.metrics.employeeCount})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(se,{className:"w-4 h-4 text-green-600"}),s.jsx("span",{className:"text-sm font-medium text-green-900",children:"Revenue"})]}),s.jsx("div",{className:"text-2xl font-bold text-green-900",children:(a=e.metrics.monthlyRevenue,`R${(a/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`)}),s.jsx("div",{className:"text-xs text-green-700 mt-1",children:"per month"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(re,{className:"w-4 h-4 text-purple-600"}),s.jsx("span",{className:"text-sm font-medium text-purple-900",children:"Warnings"})]}),s.jsx("div",{className:"text-2xl font-bold text-purple-900",children:e.metrics.warningsThisMonth}),s.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"this month"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:"Contact Information"}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Q,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Email"}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.contactEmail||"Not provided"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ee,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Phone"}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.contactPhone||"Not provided"})]})]}),e.address&&s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(Z,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Address"}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.address})]})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:"Activity"}),s.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(ue,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Last Activity"}),s.jsx("div",{className:"text-sm font-medium text-gray-900",children:new Date(e.metrics.lastActivity).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})})]})]})})]}),e.registrationNumber&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:"Organization Details"}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("div",{className:"text-xs text-gray-500",children:"Registration Number"}),s.jsx("div",{className:"text-sm font-medium text-gray-900 mt-1",children:e.registrationNumber})]})]}),s.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:s.jsx("button",{onClick:r,className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Close"})})]})});var a},Wi=({onDeployClient:t})=>{const{user:a}=l(),[n,i]=j.useState([]),[o,c]=j.useState(!0),[d,m]=j.useState(""),[u,h]=j.useState("all"),[g,p]=j.useState(null),[x,f]=j.useState(!1),[y,v]=j.useState(!1),[b,w]=j.useState(null),[N,C]=j.useState(1);j.useEffect(()=>{a?.resellerId&&S()},[a?.resellerId]);const S=async()=>{if(a?.resellerId)try{c(!0),a.resellerId;const t=await r.getResellerClients(a.resellerId),s=await Promise.all(t.map(async e=>{const t=await pt.getClientMetrics(e.id,e);return{...e,metrics:t}}));i(s),e.success(`Loaded ${s.length} clients`)}catch(t){e.error("Failed to load clients:",t)}finally{c(!1)}},D=n.filter(e=>{const t=e.name.toLowerCase().includes(d.toLowerCase())||e.sector.toLowerCase().includes(d.toLowerCase()),s="all"===u||e.metrics.subscriptionStatus===u;return t&&s}),k=Math.ceil(D.length/10),E=10*(N-1),A=E+10,_=D.slice(E,A);j.useEffect(()=>{C(1)},[d,u]);const R=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-red-600 bg-red-100";case"trial":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}};return o?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading your clients..."})]})}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[s.jsxs("div",{className:"relative flex-1 max-w-md",children:[s.jsx(ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search clients by name or sector...",value:d,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),s.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[t&&s.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-medium text-sm",children:[s.jsx(Xe,{className:"w-4 h-4"}),"Deploy New Client"]}),s.jsxs("span",{className:"text-sm text-gray-500 whitespace-nowrap",children:[D.length," of ",n.length," clients"]})]})]}),s.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:s.jsxs("div",{className:"overflow-x-auto",children:[s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organization"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Performance"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:_.map(e=>{return s.jsxs("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.name}),s.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[s.jsx("span",{children:e.sector}),s.jsx("span",{children:"•"}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(te,{className:"w-3 h-3"}),e.metrics.employeeCount," employees"]})]})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"text-sm flex items-center gap-1",children:[s.jsx(Q,{className:"w-3 h-3 text-gray-400"}),s.jsx("span",{children:e.contactEmail||"Not provided"})]}),s.jsxs("div",{className:"text-sm flex items-center gap-1",children:[s.jsx(ee,{className:"w-3 h-3 text-gray-400"}),s.jsx("span",{children:e.contactPhone||"Not provided"})]})]})}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${R(e.metrics.subscriptionStatus)}`,children:["active"===e.metrics.subscriptionStatus&&s.jsx(ae,{className:"w-3 h-3"}),"inactive"===e.metrics.subscriptionStatus&&s.jsx(ne,{className:"w-3 h-3"}),"trial"===e.metrics.subscriptionStatus&&s.jsx(ue,{className:"w-3 h-3"}),e.metrics.subscriptionStatus.charAt(0).toUpperCase()+e.metrics.subscriptionStatus.slice(1)]}),s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Last active: ",new Date(e.metrics.lastActivity).toLocaleDateString("en-ZA")]})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsx("div",{className:"font-semibold text-gray-900",children:(t=e.metrics.monthlyRevenue,`R${(t/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`)}),s.jsx("div",{className:"text-xs text-gray-500",children:"per month"})]}),s.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[s.jsxs("div",{className:"text-sm text-gray-900",children:[s.jsx("span",{className:"font-medium",children:e.metrics.warningsThisMonth}),s.jsx("span",{className:"text-gray-500",children:" warnings"})]}),s.jsx("div",{className:"text-xs text-gray-500",children:"this month"})]}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{p(e),f(!0)},className:"text-blue-600 hover:text-blue-800",title:"Manage client organization",children:s.jsx(ie,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{w(e),v(!0)},className:"text-green-600 hover:text-green-800",title:"View organization summary",children:s.jsx(ke,{className:"w-4 h-4"})})]})})]},e.id);var t})})]}),0===D.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(rt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-600",children:"No clients found"}),s.jsx("p",{className:"text-sm text-gray-500",children:d||"all"!==u?"Try adjusting your search or filters":"Your client organizations will appear here"})]}),k>1&&s.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[s.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",E+1," to ",Math.min(A,D.length)," of ",D.length," clients"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>C(Math.max(1,N-1)),disabled:1===N,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:"Previous"}),Array.from({length:Math.min(5,k)},(e,t)=>{const r=Math.max(1,N-2)+t;return r>k?null:s.jsx("button",{onClick:()=>C(r),className:`\n                          px-3 py-1 border rounded text-sm transition-colors\n                          ${r===N?"bg-blue-600 border-blue-600 text-white":"border-gray-300 hover:bg-gray-50"}\n                        `,children:r},r)}),s.jsx("button",{onClick:()=>C(Math.min(k,N+1)),disabled:N===k,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:"Next"})]})]})})]})}),g&&s.jsx(Mi,{client:g,isOpen:x,onClose:()=>{f(!1),p(null)},onUpdate:async(t,s)=>{try{await r.updateOrganization(t,s),e.success("Client updated successfully"),await S(),f(!1),p(null)}catch(a){e.error("Failed to update client:",a)}}}),b&&s.jsx(Bi,{client:b,isOpen:y,onClose:()=>{v(!1),w(null)}})]})},Hi=Object.freeze(Object.defineProperty({__proto__:null,MyClients:Wi},Symbol.toStringTag,{value:"Module"})),Ui=()=>{const{user:t}=l(),a=x(768),[n,i]=j.useState(null),[o,c]=j.useState(!0),[d,m]=j.useState("6m"),[u,h]=j.useState(null),[g,f]=j.useState(!1);j.useEffect(()=>{t?.resellerId&&y()},[t?.resellerId,d]);const y=async()=>{if(t?.resellerId)try{c(!0),t.resellerId;const[s,a,n,o,l]=await Promise.all([r.getReseller(t.resellerId),pt.getResellerMetrics(t.resellerId),r.getResellerClients(t.resellerId),pt.getRecentCommissions(t.resellerId,5),pt.getPerformanceTrend(t.resellerId,d)]);if(!s)throw new Error("Reseller profile not found");i({reseller:s,metrics:a,clients:n,recentCommissions:o,monthlyTrend:l}),e.success("Reseller dashboard loaded successfully")}catch(s){e.error("Failed to load reseller dashboard:",s)}finally{c(!1)}},v=e=>`R${(e/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,b=e=>`${e>0?"+":""}${e.toFixed(1)}%`,w=async()=>{if(t?.resellerId)try{await pt.generateCommissionStatement(t.resellerId),e.success("Commission statement downloaded")}catch(s){e.error("Failed to generate commission statement:",s)}},N=async t=>{e.success("Organization deployed successfully!",t),f(!1),await y()};if(o)return s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});if(!n)return s.jsxs("div",{className:"text-center py-12",children:[s.jsx(rt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reseller Profile Not Found"}),s.jsx("p",{className:"text-gray-600",children:"Please contact support to set up your reseller account."})]});const{reseller:C,metrics:S,clients:D,recentCommissions:k,monthlyTrend:E}=n;return a?s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white",children:s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",C.firstName,"!"]}),s.jsxs("p",{className:"text-blue-100 flex items-center gap-4 mt-2",children:[s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Je,{className:"w-4 h-4"}),C.province]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Se,{className:"w-4 h-4"}),(100*C.commissionRate).toFixed(0),"% Commission Rate"]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3",children:[s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("clients"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(te,{className:"w-8 h-8 text-blue-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Clients"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:S.totalClients}),s.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[S.activeClients," active"]})]})]})}),s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(se,{className:"w-8 h-8 text-green-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Monthly Revenue"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:v(S.monthlyRecurringRevenue)}),s.jsxs("div",{className:"text-xs text-green-600 flex items-center gap-1",children:[s.jsx(re,{className:"w-3 h-3"}),b(S.monthlyGrowth)]})]})]})}),s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(at,{className:"w-8 h-8 text-yellow-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Commissions"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:v(S.totalCommissionsEarned)}),s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Lifetime earnings"})]})]})}),s.jsx(p,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer",style:{minHeight:"80px"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Se,{className:"w-8 h-8 text-purple-600",style:{opacity:.7}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Avg Client Value"}),s.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:v(S.averageClientValue)}),s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Per month"})]})]})})]}),s.jsx("div",{className:"border-b",style:{borderColor:"var(--color-border)"},children:s.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Overview",count:null},{id:"clients",label:"My Clients",count:S.totalClients},{id:"performance",label:"Performance",count:null}].map(e=>s.jsxs("button",{onClick:()=>h(e.id),className:"py-3 px-1 border-b-2 font-medium text-sm transition-colors "+(u===e.id?"border-blue-500 text-blue-600":"border-transparent hover:border-gray-300"),style:{color:u===e.id?"var(--color-primary)":"var(--color-text-secondary)"},children:[e.label,null!==e.count&&s.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100",children:e.count})]},e.id))})}),u&&function(){switch(u){case"overview":return s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs(p,{padding:"lg",shadow:"md",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-text)"},children:"Recent Clients"}),s.jsxs("div",{className:"space-y-3",children:[D.slice(0,2).map(e=>s.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.name}),s.jsxs("div",{className:"text-sm flex items-center gap-3",style:{color:"var(--color-text-secondary)"},children:[s.jsx("span",{children:e.industry||e.sector}),s.jsxs("span",{children:[e.employeeCount||0," employees"]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm font-semibold text-green-600",children:v(e.monthlySubscription||0)}),s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"monthly"})]})]},e.id)),D.length>2&&s.jsx("div",{className:"text-center pt-2",children:s.jsxs("button",{onClick:()=>h("clients"),className:"text-sm text-blue-600 hover:text-blue-800",children:["View all ",D.length," clients →"]})}),0===D.length&&s.jsxs("div",{className:"text-center py-6",children:[s.jsx(rt,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No clients yet"}),s.jsx("button",{onClick:()=>f(!0),className:"mt-3 text-sm text-blue-600 hover:text-blue-800",children:"Deploy your first client"})]})]})]}),s.jsxs(p,{padding:"lg",shadow:"md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Recent Earnings"}),s.jsxs("button",{onClick:w,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[s.jsx(Ke,{className:"w-4 h-4"}),"Download"]})]}),s.jsxs("div",{className:"space-y-3",children:[k.map(e=>s.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.clientName}),s.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:new Date(e.periodStart).toLocaleDateString("en-ZA")})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"font-semibold text-green-600",children:v(e.commissionAmount)}),s.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[(100*e.commissionRate).toFixed(0),"% of ",v(e.baseAmount)]})]})]},e.id)),0===k.length&&s.jsxs("div",{className:"text-center py-6",children:[s.jsx(se,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No recent commissions"}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:"Earnings will appear here as clients are billed"})]})]})]})]});case"clients":return s.jsx(Wi,{onDeployClient:()=>f(!0)});case"performance":return s.jsxs(p,{padding:"lg",shadow:"md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Performance Trend"}),s.jsxs("select",{value:d,onChange:e=>m(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[s.jsx("option",{value:"3m",children:"3 Months"}),s.jsx("option",{value:"6m",children:"6 Months"}),s.jsx("option",{value:"12m",children:"12 Months"})]})]}),s.jsxs("div",{className:"space-y-3",children:[E.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[s.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:e.month}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Revenue: "}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:v(e.revenue)})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Commission: "}),s.jsx("span",{className:"font-semibold text-green-600",children:v(e.commissions)})]})]})]},t)),0===E.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No performance data available yet"})]})]})]});default:return null}}(),s.jsx(lt,{}),A()]}):s.jsxs("div",{className:"space-y-6 pb-20",children:[s.jsxs("div",{className:"mb-6",children:[s.jsxs("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:["Welcome back, ",C.firstName,"!"]}),s.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:[C.province," • ",(100*C.commissionRate).toFixed(0),"% Commission Rate"]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("clients"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(te,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Clients"}),s.jsx("span",{className:"text-lg font-bold",children:S.totalClients})]})}),s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(se,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Monthly Earnings"}),s.jsx("span",{className:"text-lg font-bold",children:v(S.monthlyCommissions)})]})}),s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(at,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Earned"}),s.jsx("span",{className:"text-lg font-bold",children:v(S.totalCommissionsEarned)})]})}),s.jsx(p,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("performance"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #8b5cf6, #7c3aed)",color:"white",minHeight:"80px",willChange:"transform"},children:s.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[s.jsx(re,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Growth"}),s.jsx("span",{className:"text-lg font-bold",children:b(S.monthlyGrowth)})]})})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(p,{padding:"md",shadow:"sm",hover:!0,onClick:()=>h("clients"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(rt,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"My Clients"})]}),s.jsx(Ce,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),s.jsx(p,{padding:"md",shadow:"sm",hover:!0,onClick:()=>h("performance"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(re,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Performance Trends"})]}),s.jsx(Ce,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),s.jsx(p,{padding:"md",shadow:"sm",hover:!0,onClick:w,className:"cursor-pointer transition-all duration-200 active:scale-95",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Ke,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Download Statement"})]}),s.jsx(Ce,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),s.jsx(lt,{}),"clients"===u&&s.jsx("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:s.jsxs("div",{className:"p-4",children:[s.jsx("button",{onClick:()=>h(null),className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center gap-2",children:"← Back to Dashboard"}),s.jsx(Wi,{onDeployClient:()=>f(!0)})]})}),"performance"===u&&s.jsx("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:s.jsxs("div",{className:"p-4",children:[s.jsx("button",{onClick:()=>h(null),className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center gap-2",children:"← Back to Dashboard"}),s.jsxs(p,{padding:"lg",shadow:"md",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Performance Trend"}),s.jsxs("select",{value:d,onChange:e=>m(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[s.jsx("option",{value:"3m",children:"3 Months"}),s.jsx("option",{value:"6m",children:"6 Months"}),s.jsx("option",{value:"12m",children:"12 Months"})]})]}),s.jsxs("div",{className:"space-y-3",children:[E.map((e,t)=>s.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[s.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:e.month}),s.jsxs("div",{className:"flex flex-col gap-1 text-right",children:[s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Revenue: "}),s.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:v(e.revenue)})]}),s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Commission: "}),s.jsx("span",{className:"font-semibold text-green-600",children:v(e.commissions)})]})]})]},t)),0===E.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No performance data available yet"})]})]})]})]})}),A()]});function A(){return s.jsx(s.Fragment,{children:g&&s.jsx(Mr,{isOpen:g,onClose:()=>f(!1),onComplete:N})})}},$i=Object.freeze(Object.defineProperty({__proto__:null,ResellerDashboard:Ui},Symbol.toStringTag,{value:"Module"})),Gi={"super-user":{id:"super-user",name:"Super User",description:"System administrator with global access",level:1},reseller:{id:"reseller",name:"Reseller",description:"Provincial sales partner with client management",level:1.5},"executive-management":{id:"executive-management",name:"Executive Management",description:"Senior leadership with organization overview",level:2},"hr-manager":{id:"hr-manager",name:"HR Manager",description:"Human Resources with employee management",level:3},"hod-manager":{id:"hod-manager",name:"HOD/Manager",description:"Department head with warning creation",level:4}},Vi={"super-user":{canManage:["super-user","reseller","executive-management","hr-manager","hod-manager"],canCreate:["reseller","executive-management","hr-manager","hod-manager"],canDelete:["reseller","executive-management","hr-manager","hod-manager"],scope:"global"},reseller:{canManage:[],canCreate:!1,canDelete:!1,canUpdate:!1,scope:"assigned-clients",restrictions:["Cannot create or manage user accounts","Cannot access employee data or warnings","Can only view and update assigned client organizations","Limited to commission and billing information"]},"executive-management":{canManage:["hr-manager","hod-manager"],canCreate:["hr-manager","hod-manager"],canDelete:!1,canDeactivate:["hr-manager","hod-manager"],scope:"organization",restrictions:["Cannot create users for other organizations","Cannot modify super-user accounts","Cannot modify other executive-management accounts","Can only deactivate, not permanently delete users"]},"hr-manager":{canManage:["hod-manager"],canCreate:["hod-manager"],canUpdate:["hr-manager","hod-manager"],canDelete:!1,scope:"organization",restrictions:["Cannot modify business-owner accounts","Cannot change user roles","Cannot create HR manager accounts","Profile updates only (name, email, departments)"]}},qi=(e,t,s,r,a)=>{const n=Vi[e];if(!n)return!1;if("organization"===n.scope&&(!t||t!==r))return!1;switch(a){case"create":return n.canCreate?.includes(s)||!1;case"read":case"update":return n.canManage?.includes(s)||!1;case"delete":return!0===n.canDelete&&n.canManage?.includes(s)||!1;case"deactivate":return n.canDeactivate?.includes(s)||!1;default:return!1}},Yi={"executive-management":{capabilities:["✅ Create HR Manager accounts","✅ Create Department Manager accounts","✅ Update user profiles and departments","✅ Deactivate user accounts","✅ Reset user passwords","✅ View user activity logs","❌ Cannot manage other Executive Managements","❌ Cannot permanently delete users","❌ Cannot access Super User accounts"],actions:["create","read","update","deactivate"],manageable_roles:["hr-manager","hod-manager"]},"hr-manager":{capabilities:["✅ Update user profiles (name, email)","✅ Update department assignments","✅ View user activity","✅ Create Department Manager accounts","❌ Cannot change user roles","❌ Cannot create HR Manager accounts","❌ Cannot deactivate users"],actions:["read","update"],manageable_roles:["hod-manager"]}},Ki=[{id:"executive",name:"Executive"},{id:"human-resources",name:"Human Resources"},{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"logistics",name:"Logistics"},{id:"finance",name:"Finance"}],Xi=()=>{const{user:t}=l(),[s,r]=j.useState({users:[],loading:!0,error:null,creatableRoles:[],userManagementRules:Vi["executive-management"]});j.useEffect(()=>{if(t?.role?.id){const e=Vi[t.role.id],s=(e=>{const t=Vi[e];return t?.canCreate?t.canCreate.map(e=>Gi[e]).filter(Boolean):[]})(t.role.id);r(t=>({...t,userManagementRules:e||Vi["executive-management"],creatableRoles:s}))}},[t]);const a=(e,r)=>!(!t||!s.userManagementRules)&&qi(t.role.id,t.organizationId,e.role.id,e.organizationId,r),n=async()=>{if(t?.organizationId)try{r(e=>({...e,loading:!0,error:null})),t.organizationId;const s=await m.queryDocuments(t.organizationId,"users",[]),a=e=>"string"==typeof e?e:e?.id||"",n=s.documents.filter(e=>{const s=a(e.role);return"executive-management"!==s&&qi(t.role.id,t.organizationId,s,e.organizationId,"read")}).map(e=>({...e,role:"string"==typeof e.role?Gi[e.role]:e.role}));e.success(`✅ Loaded ${n.length} manageable users from sharded structure`),r(e=>({...e,users:n,loading:!1}))}catch(s){e.error("❌ Error loading users:",s),r(e=>({...e,loading:!1,error:s instanceof Error?s.message:"Failed to load users"}))}else r(e=>({...e,loading:!1,error:"No organization found"}))};return j.useEffect(()=>{t?.organizationId&&s.userManagementRules&&n()},[t?.organizationId,s.userManagementRules]),{users:s.users,loading:s.loading,error:s.error,creatableRoles:s.creatableRoles,userManagementRules:s.userManagementRules,loadUsers:n,createUser:async a=>{if(!t?.organizationId)throw new Error("No organization found");if(!(s.userManagementRules.canCreate?.includes(a.roleId)||!1))throw new Error(`You don't have permission to create ${a.roleId} accounts`);try{a.email;const s=await v.signUp(a.email,a.password);e.success(5389);const n={id:s.uid,email:a.email,firstName:a.firstName,lastName:a.lastName,role:Gi[a.roleId],organizationId:t.organizationId,departmentIds:"hod-manager"===a.roleId?a.departmentIds:[],isActive:!0,createdAt:(new Date).toISOString(),lastLogin:void 0};await v.createDocument(b.USERS,n,s.uid),e.success(6159),r(e=>({...e,users:[...e.users,n]}))}catch(n){if(e.error("❌ Error creating user:",n),n instanceof Error){if(n.message.includes("email-already-in-use"))throw new Error("This email address is already registered");if(n.message.includes("weak-password"))throw new Error("Password is too weak. Please choose a stronger password");if(n.message.includes("invalid-email"))throw new Error("Please enter a valid email address")}throw n}},updateUser:async(s,a)=>{if(!t?.organizationId)throw new Error("No organization found");try{await m.updateDocument(t.organizationId,"users",s,{...a,updatedAt:(new Date).toISOString(),updatedBy:t?.id}),r(e=>({...e,users:e.users.map(e=>e.id===s?{...e,...a}:e)})),e.success(7586)}catch(n){throw e.error("❌ Error updating user:",n),n}},deactivateUser:async n=>{const i=s.users.find(e=>e.id===n);if(!i)throw new Error("User not found");if(!a(i,"deactivate"))throw new Error("You don't have permission to deactivate this user");try{await m.updateDocument(t.organizationId,"users",n,{isActive:!1,deactivatedAt:(new Date).toISOString(),deactivatedBy:t?.id}),r(e=>({...e,users:e.users.map(e=>e.id===n?{...e,isActive:!1}:e)})),e.success(8612)}catch(o){throw e.error("❌ Error deactivating user:",o),o}},reactivateUser:async s=>{try{await m.updateDocument(t.organizationId,"users",s,{isActive:!0,reactivatedAt:(new Date).toISOString(),reactivatedBy:t?.id}),r(e=>({...e,users:e.users.map(e=>e.id===s?{...e,isActive:!0}:e)})),e.success(9358)}catch(a){throw e.error("❌ Error reactivating user:",a),a}},canManageUser:a,getRoleColor:e=>{switch(e){case"executive-management":return"#dc2626";case"hr-manager":return"#059669";case"hod-manager":return"#7c3aed";default:return"#64748b"}},formatLastLogin:e=>{if(!e)return"Never";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},departments:Ki}},Ji=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],Zi=({onSubmit:e,onCancel:t,creatableRoles:r,loading:a})=>{const[n,i]=j.useState({email:"",firstName:"",lastName:"",roleId:"",departmentIds:[],password:"",confirmPassword:""}),[o,l]=j.useState({});return s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:s.jsxs("div",{className:"hr-card",style:{width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",margin:"1rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid #e5e7eb"},children:[s.jsxs("h2",{style:{margin:0,color:"#1f2937",fontSize:"1.25rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(nt,{size:20}),"Create New User Account"]}),s.jsx("button",{onClick:t,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6b7280"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#f3f4f6",onMouseOut:e=>e.currentTarget.style.backgroundColor="transparent",children:s.jsx(X,{size:20})})]}),s.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return n.firstName.trim()||(e.firstName="First name is required"),n.lastName.trim()||(e.lastName="Last name is required"),n.email.trim()||(e.email="Email is required"),n.roleId||(e.roleId="Role is required"),n.password||(e.password="Password is required"),n.confirmPassword||(e.confirmPassword="Please confirm password"),n.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&(e.email="Please enter a valid email address"),n.password&&n.password.length<6&&(e.password="Password must be at least 6 characters"),n.password!==n.confirmPassword&&(e.confirmPassword="Passwords do not match"),"hod-manager"===n.roleId&&0===n.departmentIds.length&&(e.departmentIds="Please select at least one department for managers"),l(e),0===Object.keys(e).length})())try{await e(n)}catch(s){}},children:[s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Personal Information"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"First Name *"}),s.jsx("input",{type:"text",value:n.firstName,onChange:e=>i(t=>({...t,firstName:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.firstName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.firstName?"#ef4444":"#d1d5db"}),o.firstName&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.firstName})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"Last Name *"}),s.jsx("input",{type:"text",value:n.lastName,onChange:e=>i(t=>({...t,lastName:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.lastName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.lastName?"#ef4444":"#d1d5db"}),o.lastName&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.lastName})]})]}),s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[s.jsx(Q,{size:16}),"Email Address *"]}),s.jsx("input",{type:"email",value:n.email,onChange:e=>i(t=>({...t,email:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.email?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.email?"#ef4444":"#d1d5db"}),o.email&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.email})]})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Role & Permissions"}),s.jsxs("div",{style:{marginBottom:"1rem"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[s.jsx(pe,{size:16}),"User Role *"]}),s.jsxs("select",{value:n.roleId,onChange:e=>i(t=>({...t,roleId:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.roleId?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none",backgroundColor:"white"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.roleId?"#ef4444":"#d1d5db",children:[s.jsx("option",{value:"",children:"Select Role"}),r.map(e=>s.jsxs("option",{value:e.id,children:[e.name," - ",e.description]},e.id))]}),o.roleId&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.roleId})]}),"hod-manager"===n.roleId&&s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[s.jsx(te,{size:16}),"Departments (for HOD/Manager role) *"]}),s.jsx("div",{style:{border:o.departmentIds?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",padding:"0.75rem",backgroundColor:"#f9fafb",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:Ji.map(e=>s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontSize:"0.875rem"},children:[s.jsx("input",{type:"checkbox",checked:n.departmentIds.includes(e.id),onChange:()=>{return t=e.id,void i(e=>({...e,departmentIds:e.departmentIds.includes(t)?e.departmentIds.filter(e=>e!==t):[...e.departmentIds,t]}));var t},style:{margin:0}}),e.name]},e.id))}),o.departmentIds&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.departmentIds})]})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Account Security"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[s.jsx(be,{size:16}),"Password *"]}),s.jsx("input",{type:"password",value:n.password,onChange:e=>i(t=>({...t,password:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.password?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.password?"#ef4444":"#d1d5db",minLength:6}),o.password&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.password})]}),s.jsxs("div",{children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[s.jsx(be,{size:16}),"Confirm Password *"]}),s.jsx("input",{type:"password",value:n.confirmPassword,onChange:e=>i(t=>({...t,confirmPassword:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.confirmPassword?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.confirmPassword?"#ef4444":"#d1d5db",minLength:6}),o.confirmPassword&&s.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.confirmPassword})]})]})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:[s.jsx("button",{type:"button",onClick:t,className:"hr-button-secondary",disabled:a,children:"Cancel"}),s.jsx("button",{type:"submit",className:"hr-button-primary",disabled:a,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:a?s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Creating..."]}):s.jsx(s.Fragment,{children:"✅ Create User"})})]})]})]})})},Qi=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],eo=({users:t,loading:r,onDeactivateUser:a,onReactivateUser:n,onEditUser:i,canManageUser:o,getRoleColor:l,formatLastLogin:c})=>{const[d,m]=j.useState(null),u=e=>{if(!e)return"Unknown";try{return new Date(e).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},h=e=>s.jsx("span",{className:"hr-badge",style:{backgroundColor:l(e.role.id)+"20",color:l(e.role.id),border:`1px solid ${l(e.role.id)}`,fontWeight:"600"},children:e.role.name});return r?s.jsxs("div",{className:"hr-card",style:{padding:"3rem",textAlign:"center"},children:[s.jsx("h2",{style:{color:"#1e40af"},children:"👤 Loading Users..."}),s.jsx("p",{style:{color:"#64748b"},children:"Please wait while we load the user data."})]}):0===t.length?s.jsx("div",{className:"hr-card",children:s.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:[s.jsx(nt,{size:48,style:{color:"#d1d5db",margin:"0 auto 1rem"}}),s.jsx("h3",{style:{color:"#6b7280",marginBottom:"0.5rem"},children:"No manageable users found."}),s.jsx("p",{style:{color:"#9ca3af",margin:0},children:"Create your first HR Manager or Department Head!"})]})}):s.jsxs("div",{className:"hr-card",children:[s.jsxs("h3",{style:{margin:"0 0 1rem",color:"#1e40af",fontSize:"1.125rem",fontWeight:"600"},children:["👥 Organization Users (",t.length,")"]}),s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{borderBottom:"2px solid #e5e7eb"},children:[s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"User"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Role"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Departments"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Status"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Created"}),s.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Actions"})]})}),s.jsx("tbody",{children:t.map(r=>{return s.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb",opacity:r.isActive?1:.7,backgroundColor:r.isActive?"transparent":"#f9fafb"},children:[s.jsx("td",{style:{padding:"0.75rem"},children:s.jsxs("div",{children:[s.jsxs("div",{style:{fontWeight:"600",color:r.isActive?"#1f2937":"#6b7280",marginBottom:"0.25rem"},children:[r.firstName," ",r.lastName]}),s.jsx("div",{style:{fontSize:"0.875rem",color:r.isActive?"#64748b":"#9ca3af"},children:r.email})]})}),s.jsx("td",{style:{padding:"0.75rem"},children:h(r)}),s.jsx("td",{style:{padding:"0.75rem"},children:s.jsx("span",{style:{fontSize:"0.875rem",color:r.isActive?"#374151":"#6b7280"},children:(l=r.departmentIds,l&&0!==l.length?l.map(e=>Qi.find(t=>t.id===e)?.name||e).join(", "):"-")})}),s.jsx("td",{style:{padding:"0.75rem"},children:s.jsx("span",{className:"hr-badge "+(r.isActive?"hr-badge-success":"hr-badge-danger"),children:r.isActive?"✅ Active":"❌ Inactive"})}),s.jsx("td",{style:{padding:"0.75rem",fontSize:"0.875rem",color:"#6b7280"},children:u(r.createdAt)}),s.jsx("td",{style:{padding:"0.75rem"},children:s.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[o(r,"update")&&s.jsxs("button",{onClick:()=>i(r),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",border:"1px solid #bfdbfe",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Edit user details",children:[s.jsx(ie,{size:12}),"Edit"]}),o(r,"deactivate")&&s.jsx(s.Fragment,{children:r.isActive?s.jsxs("button",{onClick:()=>(async s=>{const r=t.find(e=>e.id===s);if(!r)return;if(confirm(`Are you sure you want to deactivate ${r.firstName} ${r.lastName}?\n\nThey will no longer be able to log in to the system.`))try{m(s),await a(s)}catch(n){e.error("Error deactivating user:",n)}finally{m(null)}})(r.id),disabled:d===r.id,className:"hr-button-danger",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:d===r.id?.6:1,cursor:d===r.id?"not-allowed":"pointer"},title:"Deactivate user account",children:[d===r.id?s.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):s.jsx(it,{size:12}),"🚫 Deactivate"]}):s.jsxs("button",{onClick:()=>(async s=>{const r=t.find(e=>e.id===s);if(!r)return;if(confirm(`Are you sure you want to reactivate ${r.firstName} ${r.lastName}?\n\nThey will be able to log in again.`))try{m(s),await n(s)}catch(a){e.error("Error reactivating user:",a)}finally{m(null)}})(r.id),disabled:d===r.id,className:"hr-button-success",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:d===r.id?.6:1,cursor:d===r.id?"not-allowed":"pointer"},title:"Reactivate user account",children:[d===r.id?s.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #059669",borderRadius:"50%",animation:"spin 1s linear infinite"}}):s.jsx(ot,{size:12}),"✅ Reactivate"]})})]})})]},r.id);var l})})]})})]})},to=({currentUser:e,userManagementRules:t})=>{const r=Yi[e.role.id];return r?s.jsxs("div",{className:"hr-card",children:[s.jsxs("h4",{style:{margin:"0 0 1rem",color:"#7c3aed",fontSize:"1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:["🛡️ Your User Management Permissions (",e.role.name,")"]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[s.jsxs("div",{children:[s.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#059669",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(ae,{size:16}),"✅ You Can:"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:r.capabilities.filter(e=>e.startsWith("✅")).map((e,t)=>s.jsx("li",{style:{color:"#166534",marginBottom:"0.25rem"},children:e.replace("✅ ","")},t))})]}),s.jsxs("div",{children:[s.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#dc2626",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx(it,{size:16}),"❌ You Cannot:"]}),s.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:r.capabilities.filter(e=>e.startsWith("❌")).map((e,t)=>s.jsx("li",{style:{color:"#991b1b",marginBottom:"0.25rem"},children:e.replace("❌ ","")},t))}),t.restrictions&&s.jsxs(s.Fragment,{children:[s.jsx("h6",{style:{margin:"1rem 0 0.5rem",color:"#6b7280",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase"},children:"System Restrictions:"}),s.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:t.restrictions.map((e,t)=>s.jsx("li",{style:{color:"#6b7280",marginBottom:"0.25rem"},children:e},t))})]})]})]}),s.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#f0f9ff",borderRadius:"6px",border:"1px solid #bfdbfe"},children:s.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#1e40af"},children:[s.jsx("strong",{children:"Scope:"})," ","organization"===t.scope?"Organization-wide":"Global"," •",s.jsx("strong",{children:" Manageable Roles:"})," ",t.canManage?.join(", ")||"None"]})})]}):null},so=()=>{const e=k(),{user:t,organization:r}=l(),{users:a,loading:n,error:i,creatableRoles:o,userManagementRules:c,createUser:d,deactivateUser:m,reactivateUser:u,canManageUser:h,getRoleColor:g,formatLastLogin:p}=Xi(),x=dt(),[f,y]=j.useState(!1),[v,b]=j.useState(null),[w,N]=j.useState(null),C=Yi[t?.role?.id];S.useEffect(()=>{if(v){const e=setTimeout(()=>b(null),5e3);return()=>clearTimeout(e)}},[v]);return t?C?s.jsxs("div",{children:[s.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[s.jsxs("button",{onClick:()=>e("/dashboard"),className:"hr-button-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},title:"Back to Dashboard",children:[s.jsx(Oe,{className:"w-4 h-4"}),"Back"]}),s.jsxs("div",{children:[s.jsx("h2",{style:{margin:"0 0 0.5rem",color:"#1e40af",fontSize:"1.5rem",fontWeight:"600"},children:"👤 User Management"}),s.jsxs("p",{style:{margin:"0 0 1rem",color:"#64748b"},children:["Manage HR Managers and Department Heads for ",r?.name]}),s.jsxs("div",{style:{display:"flex",gap:"2rem",fontSize:"0.875rem"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#10b981"}}),s.jsxs("span",{style:{color:"#6b7280"},children:["Active Users: ",a.filter(e=>e.isActive).length]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#ef4444"}}),s.jsxs("span",{style:{color:"#6b7280"},children:["Inactive Users: ",a.filter(e=>!e.isActive).length]})]})]})]})]}),o.length>0&&s.jsx("button",{onClick:x.open,className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:"➕ Create New User"})]})}),v&&s.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem",border:"2px solid "+("success"===v.type?"#059669":"error"===v.type?"#dc2626":"#3b82f6"),background:"success"===v.type?"#f0fdf4":"error"===v.type?"#fef2f2":"#eff6ff"},children:s.jsxs("div",{style:{color:"success"===v.type?"#059669":"error"===v.type?"#dc2626":"#1d4ed8",fontWeight:"600",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("span",{children:["success"===v.type?"✅":"error"===v.type?"❌":"ℹ️"," ",v.text]}),s.jsx("button",{onClick:()=>b(null),style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",color:"inherit"},children:"×"})]})}),i&&s.jsxs("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#ef4444"},children:[s.jsx(ne,{size:20}),s.jsx("span",{style:{fontWeight:"500"},children:"Error loading users"})]}),s.jsx("p",{style:{margin:"0.5rem 0 0",color:"#6b7280",fontSize:"0.875rem"},children:i})]}),s.jsx(to,{currentUser:t,userManagementRules:c}),s.jsx("div",{style:{marginTop:"1.5rem"},children:s.jsx(eo,{users:a,loading:n,onDeactivateUser:async e=>{try{const t=a.find(t=>t.id===e);await m(e),b({type:"success",text:`User ${t?.firstName} ${t?.lastName} deactivated successfully`})}catch(t){b({type:"error",text:t instanceof Error?t.message:"Failed to deactivate user"})}},onReactivateUser:async e=>{try{const t=a.find(t=>t.id===e);await u(e),b({type:"success",text:`User ${t?.firstName} ${t?.lastName} reactivated successfully`})}catch(t){b({type:"error",text:t instanceof Error?t.message:"Failed to reactivate user"})}},onEditUser:e=>{N(e),b({type:"info",text:"Edit functionality coming soon!"})},canManageUser:h,getRoleColor:g,formatLastLogin:p})}),x.isOpen&&s.jsx(Zi,{onSubmit:async e=>{y(!0);try{await d(e),b({type:"success",text:`User ${e.firstName} ${e.lastName} created successfully!`}),x.close()}catch(t){throw b({type:"error",text:t instanceof Error?t.message:"Failed to create user"}),t}finally{y(!1)}},onCancel:x.close,creatableRoles:o,loading:f}),s.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f0f9ff",borderRadius:"6px",fontSize:"0.875rem",color:"#0369a1"},children:[s.jsx("strong",{children:"Development Status:"})," Enhanced User Management v2.0 - Organization: ",r?.name," • Current User: ",t.role.name," • Manageable Roles: ",c.canManage?.join(", ")||"None"," • Users Loaded: ",a.length]})]}):s.jsx("div",{className:"hr-card",children:s.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[s.jsx(pe,{size:48,style:{color:"#f59e0b",margin:"0 auto 1rem"}}),s.jsx("h2",{style:{color:"#f59e0b",marginBottom:"0.5rem"},children:"Access Restricted"}),s.jsxs("p",{style:{color:"#6b7280",margin:0},children:["Your role (",t.role.name,") does not have user management permissions."]})]})}):s.jsx("div",{className:"hr-card",children:s.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[s.jsx(ne,{size:48,style:{color:"#ef4444",margin:"0 auto 1rem"}}),s.jsx("h2",{style:{color:"#ef4444",marginBottom:"0.5rem"},children:"Authentication Required"}),s.jsx("p",{style:{color:"#6b7280",margin:0},children:"Please log in to access user management."})]})})},ro=Object.freeze(Object.defineProperty({__proto__:null,UserManagement:so},Symbol.toStringTag,{value:"Module"})),ao=()=>{const{user:e}=l(),{getPrimaryRole:t}=A(),[r,a]=j.useState("dashboard"),n=()=>{a("dashboard")};if(!e)return s.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[s.jsx("h2",{style:{color:"#ef4444"},children:"Authentication Required"}),s.jsx("p",{style:{color:"#64748b"},children:"Please log in to access the dashboard."})]});const i=t(),o=()=>s.jsx("div",{style:{marginBottom:"1rem"},children:s.jsx("button",{onClick:n,className:"hr-button-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"← Back to Dashboard"})});if("user-management"===r)return s.jsxs("div",{children:[s.jsx(o,{}),s.jsx(so,{})]});switch(i){case"super-user":return s.jsxs("div",{className:"space-y-6",children:[s.jsx(Ri,{}),s.jsx(Ci,{})]});case"reseller":return s.jsx(Ui,{});case"executive-management":case"hr-manager":case"hod-manager":return s.jsx(Li,{});default:return s.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[s.jsxs("h2",{style:{color:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[s.jsx(he,{style:{width:"1.5rem",height:"1.5rem"}}),"Role Configuration Needed"]}),s.jsxs("p",{style:{color:"#64748b",margin:"1rem 0"},children:['Your user role "',e.role.name,'" needs dashboard configuration. Please contact your system administrator.']}),s.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[s.jsx("div",{style:{fontSize:"0.875rem",color:"#374151",marginBottom:"0.5rem"},children:s.jsx("strong",{children:"Debug Information:"})}),s.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280",fontFamily:"monospace"},children:["Role ID: ",e.role.id,s.jsx("br",{}),"Role Name: ",e.role.name,s.jsx("br",{}),"User ID: ",e.id,s.jsx("br",{}),"Organization: ",e.organizationId||"None"]})]}),s.jsx("div",{style:{marginTop:"1.5rem"},children:s.jsxs("button",{onClick:()=>a("dashboard"),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:"0 auto"},children:[s.jsx(ke,{style:{width:"1rem",height:"1rem"}}),"Try Dashboard Anyway"]})})]})}};export{ao as D,Br as E,mr as L,Hi as M,hr as O,Ar as P,lr as R,gt as U,zr as Z,dt as a,Er as b,mt as c,Rr as d,$i as e,ro as f,ht as g,ut as i,ct as u};
