const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/warning-components-B7bdZBSN.js","assets/business-owner-dashboard-DOtdDQPt.js","assets/pdf-vendor-CbrIsI36.js","assets/react-vendor-BMk1H4su.js","assets/firebase-vendor-BIBOIkWK.js","assets/ui-vendor-DcCoi79t.js","assets/dashboard-router-Bm16grTz.js","assets/hr-dashboard-C6Z88PJy.js","assets/hod-dashboard-Cj63oRzY.js"])))=>i.map(i=>d[i]);
import{L as e,j as s,v as a,g as t,f as r,T as i,w as o,x as n,y as l,o as c,i as d,s as m,d as u,u as h,a as g,A as x}from"./business-owner-dashboard-DOtdDQPt.js";import{r as p,R as y,d as v}from"./react-vendor-BMk1H4su.js";import{E as f,G as w,H as b,x as j,l as N,p as k,j as C,u as S}from"./firebase-vendor-BIBOIkWK.js";import{ah as D,g as R,X as I,Q as E,c as z,S as T,aG as A,at as L,d as _,T as $,F,n as P,p as W,aH as M,aI as q,s as U,C as O,h as H,R as B,aa as V,aJ as G,U as Q,L as Y,I as X,aw as K,M as Z,an as J,J as ee,E as se,aK as ae,aL as te,aM as re,a8 as ie,aN as oe,aO as ne,ao as le,q as ce,am as de,l as me,O as ue,A as he,y as ge,aP as xe,t as pe,i as ye}from"./ui-vendor-DcCoi79t.js";import{C as ve}from"./CustomDatePicker-QWbBY-_G.js";import{b as fe,c as we,u as be,d as je,P as Ne}from"./dashboard-router-Bm16grTz.js";import{a as ke}from"./pdf-vendor-CbrIsI36.js";import{D as Ce,a as Se,P as De,b as Re}from"./warning-components-B7bdZBSN.js";import"./hr-dashboard-C6Z88PJy.js";import"./hod-dashboard-Cj63oRzY.js";class Ie{constructor(){this.flows=new Map,this.listeners=[],this.stepConfigs=new Map,this.styles={info:"color: #2563eb; font-weight: bold;",warn:"color: #d97706; font-weight: bold;",error:"color: #dc2626; font-weight: bold;",debug:"color: #6b7280; font-weight: normal;",step:"color: #7c3aed; font-weight: bold; font-size: 14px;",data:"color: #059669; font-weight: normal;",validation:"color: #dc2626; font-weight: bold;"},this.initializeStepConfigs()}static getInstance(){return Ie.instance||(Ie.instance=new Ie),Ie.instance}initializeStepConfigs(){this.stepConfigs.set("INCIDENT_DETAILS",{name:"Incident Details",requiredFields:["employeeId","categoryId","incidentDate","incidentTime","incidentLocation","incidentDescription","issueDate","validityPeriod"],validations:[this.validateIncidentDetails.bind(this),this.validateDescriptionLength.bind(this),this.validateDates.bind(this)]}),this.stepConfigs.set("LEGAL_REVIEW_SIGNATURES",{name:"Legal Review & Signatures",requiredFields:["lraRecommendation","signatures.manager","signatures.employee"],validations:[this.validateLegalReview.bind(this),this.validateSignatures.bind(this)]}),this.stepConfigs.set("DELIVERY_COMPLETION",{name:"Delivery & Completion",requiredFields:["id","status","deliveryMethod"],validations:[this.validateDeliveryData.bind(this),this.validateFirestoreReadiness.bind(this)]})}startWizardSession(e){const s=e||`wizard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={sessionId:s,startTime:new Date,currentStep:"",completedSteps:[],logs:[],dataSnapshots:{},issues:[]};return this.flows.set(s,a),this.log(s,"info","SESSION","STARTED",null,{sessionId:s,timestamp:a.startTime}),s}endWizardSession(e,s){const a=this.flows.get(e);if(!a)return;const t=Date.now()-a.startTime.getTime();this.log(e,"info","SESSION","ENDED",null,{outcome:s,duration:`${Math.round(t/1e3)}s`,totalSteps:a.completedSteps.length,totalIssues:a.issues.length,finalStep:a.currentStep}),setTimeout(()=>{this.flows.delete(e)},3e5)}enterStep(e,s,a){const t=this.flows.get(e);t&&(t.currentStep=s,this.log(e,"info",s,"STEP_ENTERED",a,{previousStep:t.completedSteps[t.completedSteps.length-1]||"none",stepIndex:t.completedSteps.length+1}),a&&this.validateStepData(e,s,a,"STEP_ENTRY"))}exitStep(e,s,a,t=!0){const r=this.flows.get(e);r&&(t&&!r.completedSteps.includes(s)&&r.completedSteps.push(s),this.log(e,t?"info":"warn",s,"STEP_EXITED",a,{completed:t,timeInStep:this.getTimeInStep(e,s),totalCompletedSteps:r.completedSteps.length}),a&&t&&this.validateStepData(e,s,a,"STEP_EXIT"))}trackDataChange(e,s,a,t,r){this.log(e,"debug",s,"DATA_CHANGED",{field:a,oldValue:t,newValue:r,valueType:typeof r},{hasValue:null!=r&&""!==r,isValidChange:r!==t}),void 0===r&&void 0!==t&&this.trackIssue(e,s,`Field ${a} became undefined`,"medium"),typeof r!=typeof t&&void 0!==t&&this.trackIssue(e,s,`Field ${a} type changed from ${typeof t} to ${typeof r}`,"low")}trackFormSubmission(e,s,a){const t=this.flows.get(e);t&&(t.dataSnapshots[`${s}_${Date.now()}`]={...a},this.log(e,"info",s,"FORM_SUBMITTED",a,{fieldCount:Object.keys(a||{}).length,hasRequiredFields:this.checkRequiredFields(s,a)}),this.validateStepData(e,s,a,"FORM_SUBMISSION"))}trackAPICall(e,s,a,t,r,i){const o=i?"error":"info";this.log(e,o,s,"API_CALL",{api:a,params:t,result:i?void 0:r,error:i?.message||i},{success:!i,responseTime:Date.now()}),i&&this.trackIssue(e,s,`API call failed: ${a} - ${i.message}`,"high")}validateStepData(e,s,a,t){const r=this.stepConfigs.get(s);if(!r)return{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};let i={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return r.validations.forEach(e=>{const s=e(a);i.errors.push(...s.errors),i.warnings.push(...s.warnings),i.missingFields.push(...s.missingFields),i.undefinedFields.push(...s.undefinedFields),i.isValid=i.isValid&&s.isValid}),this.log(e,i.isValid?"info":"error",s,"VALIDATION",a,{context:t,validation:i}),i.errors.forEach(a=>{this.trackIssue(e,s,`Validation Error: ${a}`,"high")}),i.warnings.forEach(a=>{this.trackIssue(e,s,`Validation Warning: ${a}`,"medium")}),i}validateIncidentDetails(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return["employeeId","categoryId","incidentDate","incidentLocation","incidentDescription"].forEach(a=>{e[a]&&""!==e[a]||(s.errors.push(`Missing required field: ${a}`),s.missingFields.push(a),s.isValid=!1)}),Object.keys(e).forEach(a=>{void 0===e[a]&&(s.undefinedFields.push(a),s.errors.push(`Field ${a} is undefined`),s.isValid=!1)}),s}validateDescriptionLength(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDescription){const a=e.incidentDescription.trim().split(/\s+/).length;a<15&&s.warnings.push(`Incident description should be at least 15 words (currently ${a})`)}return s}validateDates(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDate){new Date(e.incidentDate)>new Date&&(s.errors.push("Incident date cannot be in the future"),s.isValid=!1)}if(e.issueDate){new Date(e.issueDate)>new Date&&s.warnings.push("Issue date is in the future")}return s}validateLegalReview(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.lraRecommendation||(s.errors.push("LRA recommendation is required"),s.missingFields.push("lraRecommendation"),s.isValid=!1),s}validateSignatures(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.signatures?.manager||(s.warnings.push("Manager signature missing"),s.missingFields.push("signatures.manager")),e.signatures?.employee||(s.warnings.push("Employee signature missing"),s.missingFields.push("signatures.employee")),s}validateDeliveryData(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.id||(s.errors.push("Warning ID is required for delivery"),s.missingFields.push("id"),s.isValid=!1),e.deliveryMethod||(s.warnings.push("Delivery method not specified"),s.missingFields.push("deliveryMethod")),s}validateFirestoreReadiness(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},a=this.findUndefinedFields(e);a.length>0&&(s.errors.push(`Undefined fields will cause Firestore errors: ${a.join(", ")}`),s.undefinedFields.push(...a),s.isValid=!1);return["id","organizationId","employeeId","categoryId"].forEach(a=>{e[a]||(s.errors.push(`Firestore requires field: ${a}`),s.missingFields.push(a),s.isValid=!1)}),s}findUndefinedFields(e,s=""){const a=[];return"object"!=typeof e||null===e||e instanceof Date||Object.entries(e).forEach(([e,t])=>{const r=s?`${s}.${e}`:e;void 0===t?a.push(r):"object"!=typeof t||null===t||t instanceof Date||a.push(...this.findUndefinedFields(t,r))}),a}trackIssue(e,s,a,t){const r=this.flows.get(e);if(!r)return;const i={step:s,issue:a,severity:t,timestamp:new Date};r.issues.push(i),this.log(e,"high"===t?"error":"warn",s,"ISSUE_DETECTED",null,{issue:a,severity:t,totalIssues:r.issues.length})}log(e,s,a,t,r,i){const o={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:new Date,level:s,step:a,action:t,data:r,metadata:i},n=this.flows.get(e);n&&n.logs.push(o),this.logToConsole(o,e),this.listeners.forEach(e=>e(o))}logToConsole(e,s){const a=`%c${{info:"ðŸ’™",warn:"âš ï¸",error:"âŒ",debug:"ðŸ”"}[e.level]} [${e.step}] ${e.action}`,t=this.styles[e.level];e.data?(console.groupCollapsed(`${a} (${s.slice(-6)})`,t),this.styles.data,e.data,e.validation&&(this.styles.validation,e.validation),e.metadata&&(this.styles.debug,e.metadata),console.groupEnd()):(s.slice(-6),e.metadata&&(this.styles.debug,e.metadata))}checkRequiredFields(e,s){const a=this.stepConfigs.get(e);return!a||a.requiredFields.every(e=>{const a=e.split(".");let t=s;for(const s of a)t=t?.[s];return null!=t&&""!==t})}getTimeInStep(e,s){const a=this.flows.get(e);if(!a)return"0s";const t=a.logs.reverse().find(e=>e.step===s&&"STEP_ENTERED"===e.action);if(!t)return"0s";const r=Date.now()-t.timestamp.getTime();return`${Math.round(r/1e3)}s`}addListener(e){this.listeners.push(e)}removeListener(e){const s=this.listeners.indexOf(e);s>-1&&this.listeners.splice(s,1)}getSessionLogs(e){return this.flows.get(e)?.logs||[]}getSessionIssues(e){return this.flows.get(e)?.issues||[]}getSessionSummary(e){const s=this.flows.get(e);return s?{sessionId:s.sessionId,startTime:s.startTime,currentStep:s.currentStep,completedSteps:s.completedSteps,totalLogs:s.logs.length,totalIssues:s.issues.length,issuesByLevel:{high:s.issues.filter(e=>"high"===e.severity).length,medium:s.issues.filter(e=>"medium"===e.severity).length,low:s.issues.filter(e=>"low"===e.severity).length},dataSnapshots:Object.keys(s.dataSnapshots).length}:null}exportSessionData(e){const s=this.flows.get(e);return s?JSON.stringify({summary:this.getSessionSummary(e),logs:s.logs,issues:s.issues,dataSnapshots:s.dataSnapshots},null,2):""}trackError(e,s,a,t){this.log(e,"error",s,"ERROR",{message:a.message,stack:a.stack,context:t}),this.trackIssue(e,s,a.message,"high")}trackSuccess(e,s,a,t){this.log(e,"info",s,`SUCCESS_${a}`,t)}trackWarning(e,s,a,t){this.log(e,"warn",s,"WARNING",t,{warning:a}),this.trackIssue(e,s,a,"medium")}}const Ee=Ie.getInstance(),ze=({employees:e,selectedEmployeeId:o,onEmployeeSelect:n,warningHistory:l=[],isLoadingWarningHistory:c=!1,disabled:d=!1,className:m=""})=>{const[u,h]=p.useState(""),[g,x]=p.useState(!1),[y,v]=p.useState(!1),[f,w]=p.useState(!1),b=(e,s)=>e[s]?String(e[s]):e.profile?.[s]?String(e.profile[s]):"position"===s&&e.employment?.position?String(e.employment.position):"department"===s&&e.profile?.department?String(e.profile.department):"",j=p.useMemo(()=>{if(!u.trim())return e;const s=u.toLowerCase();return e.filter(e=>{const a=`${b(e,"firstName")} ${b(e,"lastName")}`.toLowerCase(),t=e.id?.toLowerCase()||"",r=b(e,"department").toLowerCase();return a.includes(s)||t.includes(s)||r.includes(s)})},[e,u]),N=p.useMemo(()=>e.find(e=>e.id===o),[e,o]),k=p.useCallback(e=>{n(e),x(!1),v(!1),w(!1),h("")},[n]),C=p.useCallback(()=>{if(d)return;window.innerWidth<768?w(!0):v(!y)},[d,y]),S=p.useCallback(()=>{w(!1),h("")},[]);return s.jsxs("div",{className:`space-y-4 ${m}`,children:[s.jsx(a,{icon:D,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:s.jsx(t,{variant:"secondary",size:"sm",children:j.length})}),s.jsx("div",{className:"relative",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(d?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:y?"var(--color-primary)":"var(--color-border)",boxShadow:y?"0 0 0 2px var(--color-primary-light)":void 0},onClick:C,children:N?s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:s.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[b(N,"firstName").charAt(0),b(N,"lastName").charAt(0)]})}),s.jsxs("div",{className:"min-w-0",children:[s.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[b(N,"firstName")," ",b(N,"lastName")]}),s.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[b(N,"position")," â€¢ ",b(N,"department")]})]})]}),s.jsx(R,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(y?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),s.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),s.jsx(R,{className:"w-4 h-4 transition-transform "+(y?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),y&&s.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[s.jsx("div",{className:"p-3 border-b border-gray-200",children:s.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),s.jsx("div",{className:"max-h-60 overflow-y-auto",children:j.length>0?s.jsx("div",{className:"py-2",children:j.map(e=>((e=>{e.riskIndicators&&e.riskIndicators.highRisk})(e),(e=>{if(!e.recentWarnings)return null;const{count:s,lastDate:a,level:t}=e.recentWarnings})(e),s.jsx("button",{onClick:()=>k(e.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:s.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[b(e,"firstName")," ",b(e,"lastName")," - ",b(e,"position")]})},e.id)))}):s.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[s.jsx(D,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),s.jsxs("p",{children:['No employees found matching "',u,'"']})]})})]})]})}),f&&s.jsxs("div",{className:"mobile-employee-modal",children:[s.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:S}),s.jsxs("div",{className:"mobile-employee-modal-content",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),s.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-full",children:s.jsx(I,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-4",children:s.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),s.jsx("div",{className:"mobile-category-list",children:j.length>0?s.jsx("div",{children:j.map(e=>s.jsx("button",{onClick:()=>k(e.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:s.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[b(e,"firstName")," ",b(e,"lastName")," - ",b(e,"position")]})},e.id))}):s.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[s.jsx("p",{children:"No employees found"}),u&&s.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',u,'"']})]})})]})]}),N&&g&&s.jsxs(r,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),s.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"flex items-center gap-1",children:[g?s.jsx(E,{className:"w-4 h-4"}):s.jsx(R,{className:"w-4 h-4"}),g?"Hide":"Show"]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["ðŸ“§ ",b(N,"email")||"No email",s.jsx("br",{}),"ðŸ“± ",b(N,"phone")||"No phone"]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[b(N,"position"),s.jsx("br",{}),b(N,"department")]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),c?s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(z,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),s.jsx("span",{className:"font-medium text-gray-900",children:N.recentWarnings?.count||0})]}),N.recentWarnings?.lastDate&&s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),s.jsx("span",{className:"text-sm text-gray-900",children:new Date(N.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),N.riskIndicators&&s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),s.jsxs(t,{variant:N.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[s.jsx(T,{className:"w-4 h-4"}),N.riskIndicators.highRisk?"High Risk":"Low Risk"]}),N.riskIndicators.reasons.length>0&&s.jsx("div",{className:"mt-2",children:s.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:N.riskIndicators.reasons.slice(0,3).map((e,a)=>s.jsxs("li",{className:"flex items-start gap-1",children:[s.jsx("span",{className:"text-amber-500 mt-0.5",children:"â€¢"}),e]},a))})})]})]})]})]})]})},Te=({categories:e,selectedCategoryId:t,onCategorySelect:i,lraRecommendation:l,disabled:c=!1,className:d=""})=>{const[m,u]=p.useState(!1),[h,g]=p.useState(!1),[x,y]=p.useState(!1),[v,f]=p.useState(""),w=p.useMemo(()=>{if(!v.trim())return e;const s=v.toLowerCase();return e.filter(e=>{const a=e.name?.toLowerCase()||"",t=e.description?.toLowerCase()||"",r=e.severity?.toLowerCase()||"";return a.includes(s)||t.includes(s)||r.includes(s)})},[e,v]),b=p.useMemo(()=>e.find(e=>e.id===t),[e,t]),j=p.useCallback(e=>{i(e),u(!1),g(!1),y(!1),f("")},[i]),N=p.useCallback(()=>{if(c)return;window.innerWidth<768?y(!0):g(!h)},[c,h]),k=p.useCallback(()=>{y(!1),f("")},[]),C=p.useMemo(()=>b?b.escalationPath||o(b.id):[],[b]),S=p.useMemo(()=>l&&C.length?C.findIndex(e=>e===l.suggestedLevel):-1,[l,C]);return s.jsxs("div",{className:`space-y-4 ${d}`,children:[s.jsx(a,{icon:A,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:e.length})}),s.jsx("div",{className:"relative",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(r,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(c?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:h?"var(--color-primary)":"var(--color-border)",boxShadow:h?"0 0 0 2px var(--color-primary-light)":void 0},onClick:N,children:b?s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:b.name}),b.description&&s.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:b.description})]})]}),s.jsx(R,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),s.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),s.jsx(R,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),h&&s.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[s.jsx("div",{className:"p-3 border-b border-gray-200",children:s.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),s.jsx("div",{className:"max-h-60 overflow-y-auto",children:w.length>0?s.jsx("div",{className:"py-2",children:w.map(e=>s.jsx("button",{onClick:()=>j(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),e.description&&s.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.description})]})]})},e.id))}):s.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[s.jsx(A,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),s.jsx("p",{children:"No categories found"}),v&&s.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',v,'"']})]})})]})]})}),x&&s.jsxs("div",{className:"mobile-category-modal",children:[s.jsx("div",{className:"mobile-category-modal-backdrop",onClick:k}),s.jsxs("div",{className:"mobile-category-modal-content",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),s.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 rounded-full",children:s.jsx(I,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-4",children:s.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>f(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),s.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:w.length>0?s.jsx("div",{children:w.map(e=>s.jsxs("button",{onClick:()=>j(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[s.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),s.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[s.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.name}),e.description&&s.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:e.description})]})]},e.id))}):s.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[s.jsx("p",{children:"No categories found"}),v&&s.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',v,'"']})]})})]})]}),b&&m&&s.jsxs(r,{className:"rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),s.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[m?s.jsx(E,{className:"w-4 h-4"}):s.jsx(R,{className:"w-4 h-4"}),m?"Hide":"Show"]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:(e=>{switch(e?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}})(b.severity),children:b.severity})]}),b.description&&s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),s.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:b.description})]})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),l?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(L,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:n(l.suggestedLevel)}),l.isEscalation&&s.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l.reason})]}):s.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:C.map((e,a)=>{const t=a===S,r=S>=0&&a<S;return s.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:t?"var(--color-badge-primary)":r?"var(--color-muted)":"var(--color-card-background)",borderColor:t?"var(--color-primary)":"var(--color-border)",color:t?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[t&&s.jsx(_,{className:"w-4 h-4"}),r&&s.jsx($,{className:"w-4 h-4"}),s.jsx("span",{children:n(e)}),a<C.length-1&&s.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"â†’"})]},e)})}),l&&s.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(L,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",n(l.suggestedLevel)]}),s.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",l.categoryWarningCount??0," previous warning(s) in this category",l.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},Ae=({formData:e,onFormDataChange:t,disabled:r=!1,className:i=""})=>{const[o,n]=p.useState(!1),[c,d]=p.useState({}),[m,u]=p.useState({}),h=p.useMemo(()=>{const s=e.incidentDescription||"",a=s.trim().split(/\s+/).filter(e=>e.length>0).length,t=a>=6,r=[];return a<6&&r.push(`Add ${6-a} more word${6-a==1?"":"s"} for a complete description (minimum 6 words)`),!s.includes("when")&&!s.includes("time")&&a>=6&&r.push("Consider adding when the incident occurred"),!s.includes("where")&&!s.includes("location")&&a>=6&&r.push("Consider specifying where the incident took place"),!s.includes("what")&&!s.includes("action")&&a>=6&&r.push("Be specific about what actions were observed"),!s.includes("witness")&&a>10&&r.push("Were there any witnesses to mention?"),{wordCount:a,isMinimumMet:t,suggestions:r}},[e.incidentDescription]),g=p.useCallback((e,s)=>{switch(e){case"incidentDate":if(!s)return"Incident date is required";return new Date(s)>new Date?"Incident date cannot be in the future":null;case"incidentTime":if(!s)return"Incident time is required";return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(s)?null:"Please enter time in HH:MM format";case"incidentLocation":return!s||s.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":const e=s.trim().split(/\s+/).filter(e=>e.length>0).length;return 0===e?"Description is required":e<6?`Description must be at least 6 words (currently ${e} word${1===e?"":"s"})`:e>500?`Description is too long (maximum 500 words, currently ${e} words)`:null;default:return null}},[]),x=p.useCallback((e,s)=>{t({[e]:s}),u(s=>({...s,[e]:!0}));const a=g(e,s);d(s=>({...s,[e]:a}))},[t,g]);return(new Date).toISOString().split("T")[0],s.jsxs("div",{className:`space-y-4 ${i}`,children:[s.jsx(a,{icon:F,title:"Incident Details",subtitle:"Provide comprehensive details about the incident"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(ve,{type:"date",label:"Incident Date",value:e.incidentDate||"",onChange:e=>x("incidentDate",e),icon:P,required:!0,disabled:r,error:c.incidentDate&&m.incidentDate?c.incidentDate:void 0}),s.jsx(ve,{type:"time",label:"Incident Time",value:e.incidentTime||"",onChange:e=>x("incidentTime",e),icon:z,required:!0,disabled:r,error:c.incidentTime&&m.incidentTime?c.incidentTime:void 0})]}),s.jsx(l,{type:"text",label:"Incident Location",value:e.incidentLocation||"",onChange:e=>x("incidentLocation",e),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:W,required:!0,disabled:r,error:c.incidentLocation&&m.incidentLocation?c.incidentLocation:void 0}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[s.jsx(M,{className:"w-3 h-3 inline mr-1"}),"What Happened *"]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("button",{type:"button",onClick:()=>n(!o),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-primary)"},children:[s.jsx(q,{className:"w-3 h-3"}),"Writing Tips"]}),s.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:h.isMinimumMet?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:h.isMinimumMet?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[h.wordCount," words"]})]})]}),s.jsx("textarea",{value:e.incidentDescription||"",onChange:e=>x("incidentDescription",e.target.value),placeholder:"Describe the incident: What did the employee do or fail to do? Include specific details like what was said, actions taken, who was present, and when/where it happened...",disabled:r,rows:6,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical "+(r?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:c.incidentDescription&&m.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:c.incidentDescription&&m.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),c.incidentDescription&&m.incidentDescription&&s.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[s.jsx($,{className:"w-3 h-3"}),c.incidentDescription]}),s.jsxs("div",{className:"flex items-start gap-1.5 text-xs p-2 rounded",style:{backgroundColor:"var(--color-alert-info-bg)",color:"var(--color-alert-info-text)"},children:[s.jsx(q,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),s.jsxs("span",{children:[s.jsx("strong",{children:"Tip:"})," Focus on describing what happened during the incident. In the next step, you'll explain why this warning level is appropriate."]})]}),o&&s.jsxs("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[s.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:"var(--color-alert-info-text)"},children:"Writing Assistance"}),s.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--color-alert-info-text)"},children:[h.suggestions.map((e,a)=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(q,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),s.jsx("span",{children:e})]},a)),0===h.suggestions.length&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),s.jsx("span",{className:"text-green-700",children:"Your description looks comprehensive!"})]})]})]})]})]})},Le=({employees:e,categories:a,formData:t,updateFormData:r,selectedEmployee:i,selectedCategory:o,warningHistory:n=[],isLoadingWarningHistory:l=!1,loadWarningHistory:d,lraRecommendation:m,isAnalyzing:u=!1,analysisStep:h=0,analysisSteps:g=[]})=>{const x=p.useMemo(()=>{const e={employee:!!t.employeeId,category:!!t.categoryId,date:!!t.incidentDate,time:!!t.incidentTime,location:!!t.incidentLocation&&t.incidentLocation.length>=3,description:!!t.incidentDescription&&t.incidentDescription.length>=20},s=Object.values(e).filter(Boolean).length,a=Object.keys(e).length;return{checks:e,completed:s,total:a,percentage:Math.round(s/a*100)}},[t]);return s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between px-1",children:[s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Progress"}),s.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[x.completed,"/",x.total]})]}),s.jsx("div",{className:"w-full rounded h-1",style:{backgroundColor:"var(--color-surface)"},children:s.jsx("div",{className:"h-1 rounded transition-all duration-300",style:{width:`${x.percentage}%`,backgroundColor:"var(--color-primary)"}})}),s.jsx(ze,{employees:e,selectedEmployeeId:t.employeeId,onEmployeeSelect:e=>{r({employeeId:e}),d&&d(e)},warningHistory:n,isLoadingWarningHistory:l,disabled:u}),s.jsx(Te,{categories:a,selectedCategoryId:t.categoryId,onCategorySelect:e=>{r({categoryId:e})},lraRecommendation:m,disabled:u}),s.jsx(Ae,{formData:t,onFormDataChange:r,disabled:u}),u&&s.jsx(c,{variant:"info",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),s.jsx("span",{className:"text-sm",children:g[h]||"Analyzing incident..."})]})}),m&&!u&&m.requiresHRIntervention&&s.jsx(c,{variant:"error",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-error)"},children:"Contact HR Required"}),s.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text)"},children:m.interventionReason}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee has final warning on record - HR intervention required before proceeding"})]})]})}),m&&!u&&!m.requiresHRIntervention&&s.jsx(c,{variant:"success",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(U,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-success)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:["Recommended: ",m.recommendedLevel]}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:m.reason})]})]})}),100===x.percentage&&!u&&s.jsx(c,{variant:"info",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(O,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:"Ready for Legal Review"}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:'All details completed. Click "Next" to proceed.'})]})]})})]})},_e="Africa/Johannesburg",$e=({onSignatureComplete:e,disabled:a=!1,label:t,placeholder:r="Click and drag to sign",initialSignature:i=null,className:o="",width:n=400,height:l=200,signerName:c})=>{const d=p.useRef(null),m=p.useRef(null),[u,h]=p.useState(!1),[g,x]=p.useState(!1),[y,v]=p.useState(!1),[f,w]=p.useState([]),[b,j]=p.useState(!1),N=p.useCallback(()=>{const e=d.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const a=e.getBoundingClientRect(),t=window.devicePixelRatio||1;e.width=a.width*t,e.height=a.height*t,s.scale(t,t),s.strokeStyle="#1e293b",s.lineWidth=2,s.lineCap="round",s.lineJoin="round",s.globalCompositeOperation="source-over",s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height),j(!0)},[]),k=p.useCallback(e=>{const s=d.current;if(!s)return{x:0,y:0};const a=s.getBoundingClientRect();let t,r;if("touches"in e&&e.touches.length>0)t=e.touches[0].clientX,r=e.touches[0].clientY;else{if(!("clientX"in e))return{x:0,y:0};t=e.clientX,r=e.clientY}return{x:t-a.left,y:r-a.top}},[]),C=p.useCallback(e=>{if(a)return;e.preventDefault();const s=d.current,t=s?.getContext("2d");if(!s||!t)return;h(!0);const{x:r,y:i}=k(e);t.beginPath(),t.moveTo(r,i);const o={points:[{x:r,y:i}],timestamp:Date.now()};w(e=>[...e,o])},[a,k]),S=p.useCallback(e=>{if(!u||a)return;e.preventDefault();const s=d.current,t=s?.getContext("2d");if(!s||!t)return;const{x:r,y:i}=k(e);t.lineTo(r,i),t.stroke(),w(e=>{if(0===e.length)return e;const s=[...e];return s[s.length-1].points.push({x:r,y:i}),s})},[u,a,k]),D=p.useCallback(()=>{u&&(h(!1),v(!0))},[u]),R=p.useCallback(e=>{if(!e||""===e.trim())return"";const s=e.trim().split(/\s+/);if(0===s.length)return"";if(1===s.length)return s[0];return`${s.slice(0,-1).map(e=>e.charAt(0).toUpperCase()+".").join(" ")} ${s[s.length-1]}`},[]),I=p.useCallback(()=>{if(a)return;const s=d.current,t=s?.getContext("2d");if(!s||!t)return;const r=((e,s=_e)=>(e instanceof Date?e:new Date(e)).toLocaleString("en-ZA",{timeZone:s,year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}))(new Date,_e),i=c?R(c):"",o=s.getBoundingClientRect(),n=fe({strokes:f,width:o.width,height:o.height,signerName:i,timestamp:r,strokeColor:"#1e293b",strokeWidth:2,textColor:"#64748b",fontSize:10});t.save(),t.font="10px Arial, sans-serif",t.fillStyle="#64748b",t.textAlign="right",t.textBaseline="bottom";let l=o.height-8;t.fillText(r,o.width-8,l),i&&(l-=12,t.fillText(i,o.width-8,l)),t.restore(),x(!0),v(!1),e(n)},[a,e,c,R,f]),E=p.useCallback(()=>{if(a)return;const s=d.current,t=s?.getContext("2d");s&&t&&(t.fillStyle="#ffffff",t.fillRect(0,0,s.width,s.height),x(!1),v(!1),w([]),e(null))},[a,e]);return p.useEffect(()=>{if(!b||a)return;const e=d.current;if(!e)return;const s=e=>C(e),t=e=>S(e),r=()=>D(),i=()=>D(),o=e=>C(e),n=e=>S(e),l=()=>D();return e.addEventListener("mousedown",s,{passive:!1}),e.addEventListener("mousemove",t,{passive:!1}),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",i),e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("touchmove",n,{passive:!1}),e.addEventListener("touchend",l),m.current=()=>{e.removeEventListener("mousedown",s),e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",r),e.removeEventListener("mouseleave",i),e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",l)},m.current},[b,a,C,S,D]),p.useEffect(()=>{N()},[N]),p.useEffect(()=>{if(i&&b){const e=d.current,s=e?.getContext("2d");if(!e||!s)return;const a=new Image;a.onload=()=>{const t=e.getBoundingClientRect();s.clearRect(0,0,e.width,e.height),s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height),s.drawImage(a,0,0,t.width,t.height),x(!0)},a.onerror=()=>{console.error("Failed to load signature image")},a.src=i}},[i,b]),p.useEffect(()=>()=>{m.current&&m.current()},[]),f.length>=1&&(f.some(e=>e.points.length>=5)||f.length),s.jsxs("div",{className:`space-y-3 ${o}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-sm font-medium text-gray-700",children:t}),s.jsxs("div",{className:"flex items-center gap-2",children:[g&&s.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[s.jsx(H,{className:"w-3 h-3"}),s.jsx("span",{children:"Saved"})]}),y&&!g&&s.jsxs("button",{type:"button",onClick:I,disabled:a,className:"flex items-center gap-1 px-2 py-1 text-xs text-green-600 hover:text-green-700 disabled:opacity-50",children:[s.jsx(H,{className:"w-3 h-3"}),"Save Signature"]}),s.jsxs("button",{type:"button",onClick:E,disabled:a||!g&&!y,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-red-600 disabled:opacity-50",children:[s.jsx(B,{className:"w-3 h-3"}),"Clear"]})]})]}),s.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg bg-white\n        ${a?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}\n        ${g?"border-green-300 bg-green-50":""}\n      `,children:[s.jsx("canvas",{ref:d,width:n,height:l,className:`\n            block w-full h-full cursor-crosshair rounded-lg\n            ${a?"cursor-not-allowed":""}\n          `,style:{width:`${n}px`,height:`${l}px`}}),!g&&!a&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:s.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[s.jsx(M,{className:"w-4 h-4"}),s.jsx("span",{children:r})]})})]})]})},Fe=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],Pe={en:{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},af:{counselling:"Beradingsessie",verbal:"Mondelinge Waarskuwing",first_written:"Eerste Geskrewe Waarskuwing",second_written:"Tweede Geskrewe Waarskuwing",final_written:"Finale Geskrewe Waarskuwing"},zu:{counselling:"Iseshini Yokweluleka",verbal:"Isexwayiso Ngomlomo",first_written:"Isexwayiso Sokuqala Esibhaliwe",second_written:"Isexwayiso Sesibili Esibhaliwe",final_written:"Isexwayiso Sokugcina Esibhaliwe"},xh:{counselling:"Iseshoni Yokucebisa",verbal:"Isilumkiso Ngomlomo",first_written:"Isilumkiso Sokuqala Esibhaliweyo",second_written:"Isilumkiso Sesibini Esibhaliweyo",final_written:"Isilumkiso Sokugqibela Esibhaliweyo"},st:{counselling:"Seboka sa Keletso",verbal:"Temoso ya Molomo",first_written:"Temoso ya Pele e Ngotsweng",second_written:"Temoso ya Bobedi e Ngotsweng",final_written:"Temoso ya ho Qetela e Ngotsweng"},ts:{counselling:"Nkarhi wo Tivonela",verbal:"Xilumkiso xa Marito",first_written:"Xilumkiso xa Sinthoma xa Ku Tsariwa",second_written:"Xilumkiso xa Vumbirhi xa Ku Tsariwa",final_written:"Xilumkiso xa Makumu xa Ku Tsariwa"},ve:{counselling:"Tshikhala tsha Themendelo",verbal:"Tivhiso ya Ipfi",first_written:"Tivhiso ya u Thoma yo á¹„walwaho",second_written:"Tivhiso ya vhuvhili yo á¹„walwaho",final_written:"Tivhiso ya u Fhedzisela yo á¹„walwaho"},ss:{counselling:"Seshoni Sekululeleka",verbal:"Sixwayiso Ngemlomo",first_written:"Sixwayiso Sekucala Lesibhaliwe",second_written:"Sixwayiso Sesibili Lesibhaliwe",final_written:"Sixwayiso Sekugcina Lesibhaliwe"},tn:{counselling:"Khuduthamaga ya Kgakololo",verbal:"Temoso ya Molomo",first_written:"Temoso ya Ntlha e e Kwadilweng",second_written:"Temoso ya Bobedi e e Kwadilweng",final_written:"Temoso ya Bofelo e e Kwadilweng"},nr:{counselling:"Iseshini Yokululeleka",verbal:"Isixwayiso Ngomlomo",first_written:"Isixwayiso Sokuqala Esibhaliwe",second_written:"Isixwayiso Sesibili Esibhaliwe",final_written:"Isixwayiso Sokugcina Esibhaliwe"},ns:{counselling:"Kopano ya KeletÅ¡o",verbal:"TemoÅ¡o ya Molomo",first_written:"TemoÅ¡o ya Pele yeo e Ngwadilwego",second_written:"TemoÅ¡o ya Bobedi yeo e Ngwadilwego",final_written:"TemoÅ¡o ya Mafelelo yeo e Ngwadilwego"}},We={en:{formalCharge:(e,s,a,t,r)=>`${e}, you are being charged with ${s}: ${a}. This is a ${t}, valid for ${r} months.`,documentNotice:()=>"This warning will be generated as a digital document containing all details of our discussion, including your version of events, expected behavior standards, and improvement commitments. You will receive this document to review carefully - either by downloading it now via QR code, or it will be sent to you by HR.",legalRights:()=>"Your rights under the Labour Relations Act: You may appeal to HR in writing within 48 hours if you disagree. You may have a fellow employee or shop steward represent you. All unexpired warnings accumulate, and further misconduct may result in additional discipline, up to ending of service.",signatureExplanation:()=>"Your signature confirms you understand this warning and will review the document - not that you agree with it. If you refuse to sign, a witness will confirm the warning was explained. The warning is valid either way. Do you have any questions before we collect signatures?"},af:{formalCharge:(e,s,a,t,r)=>`${e}, jy word aangekla van ${s}: ${a}. Dit is 'n ${t}, geldig vir ${r} maande.`,documentNotice:()=>"Hierdie waarskuwing sal as 'n digitale dokument gegenereer word wat alle besonderhede van ons bespreking bevat, insluitend jou weergawe van gebeure, verwagte gedragstandaarde, en verbeteringsverpligtinge. Jy sal hierdie dokument ontvang om noukeurig te hersien - Ã³f deur dit nou via QR-kode af te laai, Ã³f dit sal deur HR aan jou gestuur word.",legalRights:()=>"Jou regte onder die Wet op Arbeidsverhoudinge: Jy mag binne 48 uur skriftelik by HR appelieer as jy nie saamstem nie. Jy mag 'n mede-werknemer of vakbondverteenwoordiger hÃª om jou te verteenwoordig. Alle onverstreke waarskuwings akkumuleer, en verdere wangedrag kan lei tot addisionele dissipline, tot beÃ«indiging van diens.",signatureExplanation:()=>"Jou handtekening bevestig dat jy hierdie waarskuwing verstaan en die dokument sal hersien - nie dat jy daarmee saamstem nie. As jy weier om te teken, sal 'n getuie bevestig dat die waarskuwing verduidelik is. Die waarskuwing is beide kante geldig. Het jy enige vrae voordat ons handtekeninge versamel?"},zu:{formalCharge:(e,s,a,t,r)=>`${e}, uyabekwa icala nge-${s}: ${a}. Lesi yisixwayiso se-${t}, esisebenza izinyanga ezingu-${r}.`,documentNotice:()=>"Lesi sixwayiso sizokwenziwa njengomqulu wedijithali oqukethe zonke imininingwane yengxoxo yethu, kufaka phakathi inguqulo yakho yezigameko, izindinganiso zokuziphatha ezilindelekile, nezibopho zokuthuthuka. Uzothola lo mqulu ukuze uwubuyekeze ngokucophelela - kungaba ngokuwulanda manje ngekhodi ye-QR, noma uzothunyelwa yihostela ye-HR.",legalRights:()=>"Amalungelo akho ngaphansi koMthetho Wobudlelwano Basebenzi: Ungaphikisa ku-HR ngokubhaliwe ngamahora angu-48 uma ungavumelani. Ungaba nomsebenzi ofana nawe noma ummeleli wenyunyana ukuthi akumele. Zonke izixwayiso ezingaphelelanga ziyaqoqeka, futhi ukuziphatha okubi okwengeziwe kungase kuholele esinyweni esinye, kuya ekuphethweni kwenkonzo.",signatureExplanation:()=>"Ukusayina kwakho kuqinisekisa ukuthi uyaqonda lesi sixwayiso futhi uzobuyekeza umqulu - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, ufakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela. Ingabe unemibuzo ngaphambi kokuba siqoqe izimo zokusayina?"},xh:{formalCharge:(e,s,a,t,r)=>`${e}, uyatyholwa nge-${s}: ${a}. Esi sisilumkiso se-${t}, esisebenza iinyanga ezingu-${r}.`,documentNotice:()=>"Esi silumkiso siya kuveliswa njengoxwebhu lwedijithali oluqulathe zonke iinkcukacha zengxoxo yethu, kuquka inguqulelo yakho yeziganeko, imigangatho yokuziphatha elindelekileyo, nezibophelelo zophuculo. Uya kulufumana olu xwebhu ukuze uluphononge ngononophelo - nokuba ngokulushutha ngoku ngekhowudi ye-QR, okanye luya kuthunyelwa kuwe yi-HR.",legalRights:()=>"Amalungelo akho phantsi koMthetho woBudlelwane baBasebenzi: Ungabhena kwi-HR ngokubhaliwe kwiiyure ezingama-48 ukuba awuvumelani. Ungaba nomsebenzi ofana nawe okanye ummeli wemanyano ukuba akumele. Zonke izilumkiso ezingaphelelwanga ziyaqokelelana, kwaye ukuziphatha okubi okongezelelweyo kunokubangela ukulungiswa okongezelelweyo, ukuya ekupheliseni kwenkonzo.",signatureExplanation:()=>"Utyikityo lwakho luqinisekisa ukuba uyaqonda esi silumkiso kwaye uya kuphonononga uxwebhu - hayi ukuba uyavuma. Ukuba ukhaba ukusayina, ingqina iya kuqinisekisa ukuba isilumkiso sichaziwe. Isilumkiso sisebenza ngazo zombini iindlela. Ingaba unemibuzo ngaphambi kokuba siqokelele iityikityo?"},st:{formalCharge:(e,s,a,t,r)=>`${e}, o a fuoa lengolo la ${s}: ${a}. Ena ke temoso ea ${t}, e sebetsang likhoeli tse ${r}.`,documentNotice:()=>"Temoso ena e tla etsoa e le tokomane ea digital e nang le lintlha tsohle tsa puisano ea rona, ho kenyelletsa maikutlo a hao a ditiragalo, litekanyetso tsa boitshwaro tse lebelletsoeng, le likano tsa ntlafatso. O tla fumana tokomane ena hore o e hlahlobe ka hloko - kapa ka ho e khoasolla hona joale ka QR code, kapa e tla romelloa ho wena ke HR.",legalRights:()=>"Litokelo tsa hao ka tlasa Molao oa Likamano tsa Basebetsi: O ka ipeela ho HR ka ho ngola ka mora dihora tse 48 haeba o sa lumellane. O ka ba le mosebetsi ea tÅ¡oanang le uena kapa moemeli oa kesara ho u emela. Litemoso tsohle tse sa felang li bokellana, 'me boitshwaro bo bobe bo eketsehileng bo ka hlahisa kgetho e eketsehileng, ho fihla feteletsong ea ts'ebeletso.",signatureExplanation:()=>"Saeno ea hao e tiisa hore o utloisisa temoso ena 'me o tla hlahloba tokomane - eseng hore o lumela. Haeba o hana ho saena, paki e tla tiisa hore temoso e hlalositsoe. Temoso e sebetsa ka tsela ka bobeli. Na o na le lipotso pele re bokella mesaeno?"},ts:{formalCharge:(e,s,a,t,r)=>`${e}, u rhumiwa hi ${s}: ${a}. Lexi i xilumkiso xa ${t}, lexi tirhaka tin'hweti ta ${r}.`,documentNotice:()=>"Xilumkiso lexi xi ta endliwa xi ri dokumente ya didjithali leyi nga ni swileriso hinkwaswo swa vulavurisani bya hina, ku katsa xivono xa wena xa swiendlakalo, swiyimo swa mavanyiselo leswi languteriwaka, ni swipimelo swa ku antswisa. U ta kuma dokumente leyi leswaku u yi kambisisa hi vukheta - hambiloko hi ku yi hoxa sweswi hi khodi ya QR, kumbe yi ta rhumiwa eka wena hi HR.",legalRights:()=>"Timfanelo ta wena hi ka tlhelo ka Nawu wa Vuhlanganisi bya Vatirhi: U nga appila eka HR hi ku tsala hi nkarhi wa tawa ta 48 loko u nga pfumeli. U nga va ni mutirhimutsongo wa n'wina kumbe muemimuhlangani leswaku a ku yimela. Swilumkiso hinkwaswo leswi nga heli swi hlengeletiwa, naswona mavanyiselo yo biha lama engetelekeke ma nga endla ndzulavulo wo engetela, ku ya eka ku herisiwa ka vutirheri.",signatureExplanation:()=>"Vusayini bya wena byi tiyisisa leswaku u twisisa xilumkiso lexi naswona u ta kambisisa dokumente - ku nga ri leswaku u pfumela. Loko u vavisa ku sayini, nhlamulo a nga tiyisisa leswaku xilumkiso xi hlamuseriwile. Xilumkiso xi tirhaka hi tindlela hinkwato. Xana u na swivutiso loko hi nga si hlengeleta vusayini?"},ve:{formalCharge:(e,s,a,t,r)=>`${e}, no á¹±uá¹±uwedzwa nga ha ${s}: ${a}. Iyi ndi tivhiso ya ${t}, yo shuma minwedzi ya ${r}.`,documentNotice:()=>"Tivhiso iyi i á¸“o bveledzwa sa á¸“okumente ya diá¸“ijitali ine ya vha na vhubvo hoá¹±he ha mushumo washu, hu tshi katelwa ndivho yavho ya zwithu, mielo ya maitele ane a linganiswa, na zwikhahlamelo zwa u khwinisa. No á¸“o wana á¸“okumente iyi uri no i sedze nga vhuá¹±ali - arali nga u i khou dowuloda zwino nga QR code, kana i á¸“o rumela khavho nga HR.",legalRights:()=>"Pfanelo dzavho kha fhasi ha Mulayo wa Vhushaka ha Vhashumi: No nga appela kha HR hu tshi á¹…walwa nga tshifhinga tsha awara dza 48 arali no sa tendelani. No nga vha na mushumi wa zwiambaro kana muvhuyeli wa shango u ni á¹±uá¹±uwedza. Tivhiso dzoá¹±he dzi songo fhela dzi a kuvhanganya, nahone maitele a si zwavhuá¸“i ano engedziwa a nga khwinisa mulandu wo engedzeaho, u swika kha u fhedza ha mushumo.",signatureExplanation:()=>"U saena havho zwi tiyisedza uri no pfesesa iyi tivhiso nahone no á¸“o sedza á¸“okumente - zwi si uri no tendelana. Arali no nanga u si saini, muhumbeli o do tiyisedza uri tivhiso yo talutshedzelwa. Tivhiso i shuma nga ndila dzoá¹±he. Vho na mbudziso sa ri si khou kuvhanganya masaena?"},ss:{formalCharge:(e,s,a,t,r)=>`${e}, ubekwa licala nge-${s}: ${a}. Lesi yisixwayiso se-${t}, lesisebenta etinyanga letingu-${r}.`,documentNotice:()=>"Lesixwayiso sitawukhiciwa njenge-document ye-digital lenato tonkhe tincukacha tekulukuluma kwetfu, kufaka ekhatsi incenye yakho yetintfo letehlilebile, tisisetjeniswa tekutiphatsa letilindzelelwako, netitfembiso tekuntfula. Utawutfola le-document kutewubuyekeza ngalokucophelela - nobe ngekuyilanda manje nge-QR code, nobe itawutfunyelwa kuwe ngu-HR.",legalRights:()=>"Emalungelo akho ngansi kweMtsetfo weTinhlangano teTisebenzi: Ungaphikisana ku-HR ngekubhalwa ngetikhatsi tetinshintfu tange-48 uma ungavumelani. Ungaba nemsebenzi lofana nawe noma umemeti welihlangano kutsi akumele. Tonkhe tixwayiso letingapheli tiyabutana, nekutiphatsa lokubi lokucondzako kungase kuholele kulajiswa lokucondzako, kuya ekuphetseni kwemsebenzi.",signatureExplanation:()=>"Kusayina kwakho kucincisekisa kutsi uyatizwa lesixwayiso futsi utawubuyekeza le-document - kusho nje kutsi uyavuma. Uma ukhetsa kungasayini, umfakazi utawucincisekisa kutsi sixwayiso sichaziwe. Sixwayiso sisebenta ngatindzlela tonkhe. Ingabe unemibuto ngaphambi kwekutsi sitfole kusayina?"},tn:{formalCharge:(e,s,a,t,r)=>`${e}, o a sekisiwa ka ${s}: ${a}. Eno ke temoso ya ${t}, e e dirang dikgwedi tse ${r}.`,documentNotice:()=>"Temoso eno e tla dirwa e le tokomane ya ditÅ¡itale e e nang le dintlha tsotlhe tsa puisano ya rona, go akaretsa lekanyo la gago la ditiragalo, mekgwa ya boitshwaro e e solofetsweng, le ditsholofelo tsa tokafatso. O tla bona tokomane eno gore o e sekaseke ka kelotlhoko - kgotsa ka go e khurumetsa jaanong ka khouthu ya QR, kgotsa e tla romelwa go wena ke HR.",legalRights:()=>"Ditshwanelo tsa gago ka fa tlase ga Molao wa Dikamano tsa Badiri: O ka boipiletsa kwa HR ka go kwala mo diureng tse 48 fa o sa dumelane. O ka nna le modiri yo o tshwanang le wena kgotsa moemedi wa lekgotla go go emela. Ditemoso tsotlhe tse di sa feleng di a kokoana, mme boitshwaro jo bo sa siamang jo bo oketsegileng bo ka felela ka kgalemelo e e oketsegileng, go fitlha kwa go fediseleng tiro.",signatureExplanation:()=>"Go saena ga gago go netefatsa gore o tlhaloganya temoso eno le gore o tla sekaseka tokomane - ga go reye gore o dumelana. Fa o tlhopha go sa saena, paki e tla netefatsa gore temoso e tlhalosetse. Temoso e bereka ka ditsela tsotlhe. A o na le dipotso fa pele ga re kokoanya mesaeno?"},nr:{formalCharge:(e,s,a,t,r)=>`${e}, uyabekwa icala nge-${s}: ${a}. Lesi yisixwayiso se-${t}, esisebenza izinyanga ezingu-${r}.`,documentNotice:()=>"Lesi sixwayiso sizokwenziwa njengomqulu wedijithali oqukethe zonke imininingwane yengxoxo yethu, kufaka phakathi inguqulo yakho yezigameko, izindinganiso zokuziphatha ezilindelekile, nezibopho zokuthuthuka. Uzothola lo mqulu ukuze uwubuyekeze ngokucophelela - kungaba ngokuwulanda manje ngekhodi ye-QR, noma uzothunyelwa yihostela ye-HR.",legalRights:()=>"Amalungelo akho ngaphansi koMthetho weBudlelwano Basebenzi: Ungabhena ku-HR ngokubhaliwe ngamahora angama-48 uma ungavumelani. Ungaba nomsebenzi ofana nawe noma ummeleli wenyunyana ukukumela. Zonke izixwayiso ezingaphelelanga ziyaqoqeka, futhi ukuziphatha okubi okwengeziwe kungase kuholele esinyweni esinye, kuya ekuphethweni kwenkonzo.",signatureExplanation:()=>"Ukusayina kwakho kuqinisekisa ukuthi uqonda lesi sixwayiso futhi uzobuyekeza umqulu - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, umfakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela. Ingabe unemibuzo ngaphambi kokuba siqoqe izimo zokusayina?"},ns:{formalCharge:(e,s,a,t,r)=>`${e}, o a sekiÅ¡etÅ¡wa ka ${s}: ${a}. Ye ke temoÅ¡o ya ${t}, yeo e Å¡omago dikgwedi tÅ¡e ${r}.`,documentNotice:()=>"TemoÅ¡o ye e tla dirwa bjalo ka tokumente ya diditÅ¡hitale yeo e nago le dintlha tÅ¡ohle tÅ¡a polediÅ¡ano ya rena, go akaretÅ¡a kanegelo ya gago ya ditiragalo, maemo a boitshwaro ao a letelwago, le ditshepiÅ¡i tÅ¡a kaonafatÅ¡o. O tla hwetÅ¡a tokumente ye gore o e sekaseke ka kelohloko - e ka ba ka go e kgauswi gona bjale ka khouthu ya QR, goba e tla romelwa go wena ke HR.",legalRights:()=>"Ditokelo tÅ¡a gago ka fase ga Molao wa Dikamano tÅ¡a BaÅ¡omi: O ka boipiletÅ¡a go HR ka go ngwala ka gare ga diiri tÅ¡e 48 ge o sa dumelelane. O ka ba le modiri yo o swanago le wena goba moemeli wa kesara go go emela. DitemoÅ¡o tÅ¡ohle tÅ¡e di sa feleng di a kokoana, gomme boitshwaro bjo bo sa lokago bjo bo oketÅ¡egilego bo ka fela ka kgalemo ye e oketÅ¡egilego, go fihla go fediÅ¡a moÅ¡omo.",signatureExplanation:()=>"Go saena ga gago go netefatÅ¡a gore o kweÅ¡iÅ¡a temoÅ¡o ye le gore o tla sekaseka tokumente - e sego gore o dumelelana le yona. Ge o gana go saena, paki e tlago netefatÅ¡a gore temoÅ¡o e hlaloÅ¡itÅ¡we. TemoÅ¡o e Å¡oma ka ditsela tÅ¡e ka bobedi. Na o na le dipotÅ¡iÅ¡o pele re kgoboketÅ¡a mesaeno?"}},Me=({employeeName:e,managerName:a,categoryName:t,incidentDescription:r,warningLevel:i,validityPeriod:o,onScriptRead:n,disabled:l=!1,activeWarnings:c=[],issuedDate:d})=>{const[m,u]=p.useState("en"),[h,g]=p.useState(!1),[x,y]=p.useState(!1),v=We[m]||We.en;Fe.find(e=>e.code===m)||Fe[0];const f=((e,s)=>{const a=e.toLowerCase().replace(/ /g,"_");return Pe[s][a]||e})(i,m);return s.jsx("div",{className:"space-y-2",children:h?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between pb-3 border-b",style:{borderColor:"var(--color-alert-warning-border)"},children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(G,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),s.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸ“– Employee Warning Script"})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(V,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),s.jsx("select",{value:m,onChange:e=>u(e.target.value),disabled:x||l,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Fe.map(e=>s.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),s.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:s.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[s.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[s.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Formal Charge"}),s.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.formalCharge(e,t,r,f,o)})]}),s.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[s.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Digital Document Notice"}),s.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.documentNotice()})]}),s.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[s.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Your Rights"}),s.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.legalRights()})]}),s.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[s.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Signature & Questions"}),s.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.signatureExplanation()})]})]})}),s.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[s.jsx(Q,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),s.jsxs("span",{children:["Read this complete script aloud to ",e]})]}),x?s.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[s.jsx(H,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):s.jsxs("button",{onClick:()=>{y(!0),n()},disabled:l,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:[s.jsx(H,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"relative flex-1 max-w-[140px]",children:[s.jsx("select",{value:m,onChange:e=>u(e.target.value),disabled:x||l,className:"appearance-none w-full pl-3 pr-7 py-1.5 border rounded text-xs focus:ring-2 focus:ring-blue-500 transition-all cursor-pointer",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Fe.map(e=>s.jsx("option",{value:e.code,children:e.nativeName},e.code))}),s.jsx(V,{className:"w-3.5 h-3.5 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none",style:{color:"var(--color-text-secondary)"}})]}),s.jsxs("button",{onClick:()=>g(!0),disabled:l,className:"flex items-center gap-1.5 px-3 py-1.5 border rounded text-xs font-medium transition-all hover:bg-gray-50 active:scale-95",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)"},children:[s.jsx(F,{className:"w-3.5 h-3.5"}),s.jsx("span",{children:"View Script"})]})]})})},qe=(e,s="Unknown")=>null==e?s:"string"==typeof e?e:"object"==typeof e&&e.name?String(e.name):String(e),Ue=e=>({counselling:{label:"Counselling",color:"#0ea5e9",bgColor:"rgba(14, 165, 233, 0.1)"},verbal:{label:"Verbal",color:"#f59e0b",bgColor:"rgba(245, 158, 11, 0.1)"},first_written:{label:"Written",color:"#f97316",bgColor:"rgba(249, 115, 22, 0.1)"},final_written:{label:"Final Written",color:"#ef4444",bgColor:"rgba(239, 68, 68, 0.1)"}}[e]||{label:e,color:"#6b7280",bgColor:"rgba(107, 114, 128, 0.1)"}),Oe=({warning:e})=>{const[a,t]=p.useState(!1),r=Ue(e.level||"verbal"),i=(e=>{const s=new Date,a="string"==typeof e?new Date(e):e,t=s.getTime()-a.getTime(),r=Math.floor(t/864e5);return 0===r?"Today":1===r?"Yesterday":r<7?`${r} days ago`:r<30?`${Math.floor(r/7)} weeks ago`:r<365?`${Math.floor(r/30)} months ago`:`${Math.floor(r/365)} years ago`})(e.issueDate||e.createdAt);return s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>t(!0),className:"w-full text-left p-2 rounded border transition-all hover:shadow-sm active:scale-[0.98]",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border-light)",minHeight:"44px"},children:s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("span",{className:"px-2 py-0.5 rounded text-xs font-medium flex-shrink-0",style:{backgroundColor:r.bgColor,color:r.color},children:r.label}),s.jsx("span",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:i})]}),s.jsx(R,{className:"w-3.5 h-3.5 rotate-[-90deg] flex-shrink-0",style:{color:"var(--color-text-tertiary)"}})]})}),a&&s.jsx(He,{warning:e,onClose:()=>t(!1)})]})},He=({warning:e,onClose:a})=>{const t=Ue(e.level||"verbal"),r=e.issueDate||e.createdAt,i=r?new Date(r).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}):"Unknown date",o=e.validityPeriod||6,n=((e,s)=>{const a="string"==typeof e?new Date(e):e,t=new Date(a);t.setMonth(t.getMonth()+s);const r=new Date,i=t.getTime()-r.getTime();return Math.ceil(i/864e5)})(r,o),l=new Date(new Date(r).setMonth(new Date(r).getMonth()+o)).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}),c=n<30?"#ef4444":n<60?"#f59e0b":"#10b981",d=e.incidentDescription||e.description||"",m=e.incidentLocation||"",u=e.incidentTime||"",h=e.categoryName||e.category||"",g=e.issuedByName||e.managerName||e.issuerName||"Manager";return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/50 z-[9500] animate-fade-in",onClick:a}),s.jsx("div",{className:"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-[9600] w-[90vw] max-w-md",onClick:e=>e.stopPropagation(),children:s.jsxs("div",{className:"rounded-lg shadow-xl overflow-hidden",style:{backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-card-border)"},children:[s.jsxs("div",{className:"p-4 border-b flex items-center justify-between",style:{backgroundColor:t.bgColor,borderColor:"var(--color-border)"},children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{className:"w-5 h-5",style:{color:t.color}}),s.jsx("h3",{className:"font-bold text-base",style:{color:"var(--color-text)"},children:"Warning Details"})]}),s.jsx("button",{onClick:a,className:"p-1 rounded-full hover:bg-black/5 active:scale-95 transition-all",children:s.jsx(I,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),s.jsxs("div",{className:"p-4 space-y-4 max-h-[60vh] overflow-y-auto",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-xs font-medium mb-1",style:{color:"var(--color-text-secondary)"},children:"Warning Level"}),s.jsx("div",{className:"inline-block px-3 py-1.5 rounded-lg text-sm font-bold",style:{backgroundColor:t.bgColor,color:t.color},children:t.label})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(P,{className:"w-3.5 h-3.5",style:{color:"var(--color-text-secondary)"}}),s.jsx("div",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date"})]}),s.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:i})]}),h&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(F,{className:"w-3.5 h-3.5",style:{color:"var(--color-text-secondary)"}}),s.jsx("div",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Category"})]}),s.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:h})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(D,{className:"w-3.5 h-3.5",style:{color:"var(--color-text-secondary)"}}),s.jsx("div",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issued By"})]}),s.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:g})]}),e.incidentDate&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(P,{className:"w-3.5 h-3.5",style:{color:"var(--color-text-secondary)"}}),s.jsx("div",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Incident Date"})]}),s.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:[new Date(e.incidentDate).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}),u&&s.jsxs("span",{className:"ml-2 text-xs",style:{color:"var(--color-text-secondary)"},children:["at ",u]})]})]}),m&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(X,{className:"w-3.5 h-3.5",style:{color:"var(--color-text-secondary)"}}),s.jsx("div",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Location"})]}),s.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:m})]}),d&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(Z,{className:"w-3.5 h-3.5",style:{color:"var(--color-text-secondary)"}}),s.jsx("div",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Incident Details"})]}),s.jsx("div",{className:"text-sm leading-relaxed p-3 rounded-lg border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border-light)",color:"var(--color-text)"},children:d})]}),s.jsxs("div",{className:"p-3 rounded-lg border",style:{backgroundColor:n<30?"rgba(239, 68, 68, 0.05)":"var(--color-background)",borderColor:c},children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[s.jsx(z,{className:"w-3.5 h-3.5",style:{color:c}}),s.jsx("div",{className:"text-xs font-medium",style:{color:c},children:"Expiry Date"})]}),s.jsx("div",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:l}),s.jsx("div",{className:"text-xs",style:{color:c},children:n>0?s.jsxs(s.Fragment,{children:["â³ ",n," days remaining"]}):s.jsx(s.Fragment,{children:"âš ï¸ Expired"})})]})]}),s.jsx("div",{className:"p-4 border-t",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)"},children:s.jsx("button",{onClick:a,className:"w-full py-2.5 px-4 rounded-lg font-medium text-sm transition-all hover:opacity-90 active:scale-[0.98]",style:{backgroundColor:"var(--color-primary)",color:"white"},children:"Close"})})]})})]})},Be=({lraRecommendation:e,selectedEmployee:a,selectedCategory:o,formData:n,currentManagerName:l,onSignaturesComplete:d,isAnalyzing:m=!1,signaturesFinalized:u=!1,currentSignatures:h,warningId:g,audioUploadStatus:x,onLevelOverride:y})=>{const[v,f]=p.useState(!1),[w,b]=p.useState(!1),[j,N]=p.useState(!1),[k,C]=p.useState(!1),[S,A]=p.useState(h||{manager:null,employee:null,witness:null}),[P,W]=p.useState(null),[M,q]=p.useState(!1),[O,H]=p.useState("employee");p.useEffect(()=>{h&&A(h)},[h]),p.useEffect(()=>{w&&C(!0)},[w]),p.useEffect(()=>{y&&y(P)},[P,y]),p.useEffect(()=>{u&&setTimeout(()=>{const e=document.querySelector(".warning-success-alert");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},300)},[u]);const B=!(!S.manager||!S.employee&&!S.witness);p.useCallback(()=>{N(!0),setTimeout(()=>{b(!0),N(!1)},1500)},[]);const V=p.useCallback(e=>{A(s=>({...s,manager:e}))},[]),G=p.useCallback(e=>Promise.resolve(we(e)),[]),Z=p.useCallback(async e=>{if("witness"===O)if(e)try{const s=await G(e);A(e=>({...e,witness:s}))}catch(s){console.error("Failed to apply witness watermark:",s),A(s=>({...s,witness:e}))}else A(e=>({...e,witness:null}));else A(s=>({...s,employee:e}))},[O,G]),J=p.useCallback(()=>{if(!B||u)return;const e=a?`${a.profile?.firstName||"Unknown"} ${a.profile?.lastName||"Employee"}`:"Unknown Employee",s={...S,timestamp:(new Date).toISOString(),managerName:l,employeeName:S.employee?e:void 0,witnessName:S.witness?e:void 0};d(s,!0)},[S,B,u,l,a,d]);return m?s.jsxs(r,{padding:"xl",className:"text-center",children:[s.jsx(Y,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"var(--color-primary)"}}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Analyzing legal requirements..."})]}):s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs(t,{variant:"warning",size:"lg",className:"font-semibold",children:["âš ï¸ ",e?.isEscalation?"Escalated Action":"Recommended Sanction"]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(L,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),s.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e?.isEscalation?"Discipline Level":"Severity Assessment"})]}),s.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>f(!v),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[v?"Hide":"Details",v?s.jsx(E,{className:"w-3 h-3"}):s.jsx(R,{className:"w-3 h-3"})]})]}),s.jsxs(r,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("button",{onClick:()=>q(!M),className:"transition-all hover:opacity-80 active:scale-95",disabled:u,children:s.jsx(t,{variant:"primary",size:"sm",className:"font-semibold cursor-pointer",children:P?"counselling"===P?"Counselling":"verbal"===P?"Verbal":"first_written"===P?"First Written":"final_written"===P?"Final Written":P:"Counselling Session"===e?.recommendedLevel?"Counselling":qe(e?.recommendedLevel)})}),e?.isEscalation&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(_,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-warning)"},children:"Escalation"})]}),s.jsxs("button",{onClick:()=>q(!M),className:"flex items-center gap-1 text-xs hover:opacity-80 active:scale-95 transition-all",style:{color:"var(--color-text-secondary)"},disabled:u,children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-primary)"}}),s.jsx("span",{className:"font-medium",style:{color:"var(--color-primary)"},children:e?.categoryWarningCount??0}),s.jsx("span",{children:"previous"})]})]})}),s.jsx("div",{className:"mt-2 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:s.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:e?.isEscalation?`Based on ${e.categoryWarningCount??0} previous incident${1===(e.categoryWarningCount??0)?"":"s"}, escalating to maintain consistent discipline standards.`:"No prior incidents in this category. Starting with a supportive, corrective approach."})})]})]}),v&&s.jsx(r,{padding:"sm",className:"border",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(T,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),s.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Analysis Summary"})]}),s.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:qe(e?.explanation||e?.reason,"Progressive discipline assessment completed based on employee warning history and incident severity.")})]}),e?.legalRequirements&&e.legalRequirements.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(L,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),s.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Legal Compliance"})]}),s.jsxs("div",{className:"space-y-1",children:[e.legalRequirements.slice(0,2).map((e,a)=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5",style:{backgroundColor:"var(--color-info)"}}),s.jsx("span",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:e})]},a)),e.legalRequirements.length>2&&s.jsxs("p",{className:"text-xs ml-3.5",style:{color:"var(--color-info)"},children:["+ ",e.legalRequirements.length-2," more requirements"]})]})]}),s.jsxs("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-card-border)"},children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(z,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),s.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-text)"},children:"Warning History (This Category)"})]}),s.jsxs("div",{className:"text-xs mb-2",style:{color:"var(--color-text-secondary)"},children:["Employee has ",s.jsx("strong",{children:e?.categoryWarningCount??0})," active warning(s) in this category."]}),e?.activeWarnings&&e.activeWarnings.length>0&&s.jsx("div",{className:"space-y-1 mt-2",children:e.activeWarnings.map((e,a)=>s.jsx(Oe,{warning:e},e.id||a))})]})]})}),M&&s.jsx(r,{padding:"md",className:"border-2",style:{borderColor:"var(--color-warning-light)",backgroundColor:"var(--color-alert-warning-bg)"},children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[s.jsx(X,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-warning)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-bold text-sm mb-1",style:{color:"var(--color-text)"},children:"âš–ï¸ Override Recommendation"}),s.jsxs("p",{className:"text-xs leading-relaxed mb-3",style:{color:"var(--color-text-secondary)"},children:["The system recommends ",s.jsx("strong",{style:{color:"var(--color-text)"},children:qe(e?.recommendedLevel)}),". You may override this to escalate faster or re-issue the same level if circumstances warrant it."]})]})]}),s.jsx("button",{onClick:()=>q(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",disabled:u,children:s.jsx(I,{className:"w-4 h-4"})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Warning Level:"}),s.jsxs("select",{value:P||e?.suggestedLevel||"",onChange:s=>{const a=s.target.value===(e?.suggestedLevel||"")?null:s.target.value;W(a)},className:"w-full px-3 py-2 text-sm rounded-lg border-2 transition-colors",style:{borderColor:P?"var(--color-warning)":"var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)"},disabled:u,children:[s.jsx("option",{value:"",children:"-- Use System Recommendation --"}),e?.escalationPath?.map(a=>s.jsxs("option",{value:a,children:[{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",final_written:"Final Written Warning"}[a]||a,a===e.suggestedLevel?" (Recommended)":""]},a))]})]}),P&&s.jsxs(c,{variant:"warning",className:"text-xs",children:[s.jsx("strong",{children:"Override Active:"})," This warning will be issued as ",s.jsx("strong",{children:"counselling"===P?"Counselling Session":"verbal"===P?"Verbal Warning":"first_written"===P?"Written Warning":"final_written"===P?"Final Written Warning":P})," instead of the recommended level. Future warnings will consider this custom escalation path."]})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(F,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),s.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸ“– Employee Warning Script"})]}),s.jsxs(r,{padding:"sm",className:"border",style:{borderColor:"var(--color-border-light)"},children:[s.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--color-text-secondary)"},children:[s.jsx("strong",{children:"Read this completely to ensure your employee understands their rights."})," This script covers all legal requirements and communicates the warning clearly."]}),s.jsx(Me,{employeeName:a?`${a.profile?.firstName||"Unknown"} ${a.profile?.lastName||"Employee"}`:"Unknown Employee",managerName:l,categoryName:o?.name||"General Misconduct",incidentDescription:n.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:P||e?.recommendedLevel||"verbal",validityPeriod:n.validityPeriod,onScriptRead:()=>b(!0),disabled:w,activeWarnings:e?.activeWarnings,issuedDate:n.issueDate})]})]}),x&&"complete"!==x&&s.jsxs("div",{className:"mb-3 p-3 rounded-lg border flex items-center gap-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:[s.jsx(Y,{className:"w-5 h-5 animate-spin",style:{color:"var(--color-info)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("p",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["stopping"===x&&"ðŸŽ¤ Stopping recording...","uploading"===x&&"â˜ï¸ Uploading audio to Firebase..."]}),s.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-tertiary)"},children:"Please wait while we save your warning"})]})]}),k&&s.jsxs(r,{padding:"sm",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),s.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"âœï¸ Collect Signatures"})]}),s.jsx("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:s.jsx("span",{children:B?"Complete":"Pending"})})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[s.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(D,{className:"w-3.5 h-3.5",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Manager"}),s.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:l})]}),S.manager&&s.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),s.jsx($e,{onSignatureComplete:V,disabled:u,label:"Manager Signature",placeholder:"Manager signature",initialSignature:S.manager,width:300,height:80,signerName:l})]}),s.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-success-bg)",opacity:S.manager?1:.6},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(D,{className:"w-3.5 h-3.5",style:{color:"var(--color-success)"}}),s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"employee"===O?"Employee":"Witness"}),s.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:a?`${a.profile?.firstName||"Unknown"} ${a.profile?.lastName||"Employee"}`:"Unknown Employee"})]}),S.employee&&s.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),!S.manager&&!u&&s.jsx("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-warning)"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx($,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-alert-warning-text)"},children:"Manager must save their signature first"})]})}),!u&&S.manager&&s.jsxs("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border-light)"},children:[s.jsx("div",{className:"text-xs font-medium mb-2",style:{color:"var(--color-text)"},children:"Signature Type:"}),s.jsxs("div",{className:"flex gap-4",children:[s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"radio",name:"signatureType",value:"employee",checked:"employee"===O,onChange:e=>H(e.target.value),className:"w-4 h-4",style:{accentColor:"var(--color-success)"}}),s.jsx("span",{className:"text-xs",style:{color:"var(--color-text)"},children:"Employee Signature"})]}),s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"radio",name:"signatureType",value:"witness",checked:"witness"===O,onChange:e=>H(e.target.value),className:"w-4 h-4",style:{accentColor:"var(--color-warning)"}}),s.jsx("span",{className:"text-xs",style:{color:"var(--color-text)"},children:"Witness Signature"})]})]}),s.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"employee"===O?"Employee signs to acknowledge notification":"Witness confirms this warning was explained to the employee"})]}),s.jsx($e,{onSignatureComplete:Z,disabled:u||!S.manager,label:"employee"===O?"Employee Signature":"Witness Signature",placeholder:"employee"===O?"Employee signature":"Witness signature",initialSignature:S.employee,width:300,height:80,signerName:a?`${a.profile?.firstName||"Unknown"} ${a.profile?.lastName||"Employee"}`:"Unknown Employee"})]})]}),B&&!u&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"hidden md:block mt-3 p-2 rounded-lg flex items-center justify-between",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),s.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Ready to finalize"})]}),s.jsxs(i,{onClick:J,size:"sm",className:"px-3 py-1.5",children:[s.jsx(K,{className:"w-3 h-3 mr-1"}),"Upload Signatures & Continue"]})]}),s.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white border-t-2 shadow-lg z-50",style:{borderColor:"var(--color-success)"},children:s.jsxs(i,{onClick:J,className:"w-full h-12 text-base font-semibold",children:[s.jsx(K,{className:"w-4 h-4 mr-2"}),"Upload Signatures & Continue"]})})]}),u&&s.jsx("div",{className:"warning-success-alert mt-4",children:s.jsx(c,{variant:"success",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:s.jsx(U,{className:"w-6 h-6",style:{color:"var(--color-success)"}})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-bold text-base mb-2",style:{color:"var(--color-text)"},children:"âœ… Warning Officially Recorded"}),s.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--color-text-secondary)"},children:[s.jsx("p",{children:"â€¢ Signatures captured and saved"}),s.jsx("p",{children:"â€¢ Audio recording uploaded to Firebase"}),g&&s.jsxs("p",{children:["â€¢ Warning ",s.jsxs("span",{className:"font-mono font-semibold",children:["#",g.slice(-8)]})," created in database"]}),s.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:[s.jsx(Y,{className:"w-4 h-4 animate-spin",style:{color:"var(--color-primary)"}}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:"Advancing to delivery setup..."})]})]})]})]})})})]})]})},Ve=()=>{const e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]},Ge=({warningLevel:e,currentData:t,onDataChange:o,onValidationChange:n,issueDate:l,validityPeriod:d=6,onIssueDateChange:m,onValidityPeriodChange:u})=>{const[h,g]=p.useState(()=>({employeeStatement:t?.employeeStatement||"",expectedBehavior:t?.expectedBehavior||"",factsAndReasoning:t?.factsAndReasoning||"",actionCommitments:t?.actionCommitments||[],reviewDate:t?.reviewDate||"",interventionDetails:t?.interventionDetails||"",resourcesProvided:t?.resourcesProvided||[]})),[x,y]=p.useState(""),[v,f]=p.useState({}),w=p.useMemo(()=>{return{counselling:{label:"Counselling",color:"#0ea5e9",requiresCommitments:!0},verbal:{label:"Verbal",color:"#f59e0b",requiresCommitments:!0},first_written:{label:"Written",color:"#f97316",requiresCommitments:!0},second_written:{label:"Second Written",color:"#f97316",requiresCommitments:!0},final_written:{label:"Final Written",color:"#ef4444",requiresCommitments:!1},suspension:{label:"Suspension",color:"#dc2626",requiresCommitments:!1},dismissal:{label:"Ending of Service",color:"#991b1b",requiresCommitments:!1}}[s=e]||{label:s,color:"#6b7280",requiresCommitments:!0};var s},[e]),[b,j]=p.useState(!w.requiresCommitments),[N,k]=p.useState(!w.requiresCommitments),C=p.useCallback(()=>{const e={};let s=!0;return w.requiresCommitments&&(!h.employeeStatement||h.employeeStatement.trim().length<20)&&(e.employeeStatement="Employee statement required (min 20 characters)",s=!1),(!h.expectedBehavior||h.expectedBehavior.trim().length<20)&&(e.expectedBehavior="Expected behavior required (min 20 characters)",s=!1),(!h.factsAndReasoning||h.factsAndReasoning.trim().length<20)&&(e.factsAndReasoning="Facts and reasoning required (min 20 characters)",s=!1),w.requiresCommitments&&0===h.actionCommitments.length&&(e.actionCommitments="At least 1 improvement commitment required",s=!1),h.actionCommitments.forEach((a,t)=>{(!a.commitment||a.commitment.trim().length<10)&&(e[`commitment_${t}`]="Commitment text required (min 10 characters)",s=!1),(!a.timeline||a.timeline.trim().length<3)&&(e[`timeline_${t}`]='Timeline required (e.g., "Within 2 weeks")',s=!1)}),w.requiresCommitments&&!h.reviewDate&&(e.reviewDate="Follow-up review date required",s=!1),f(e),s},[h,w]);p.useEffect(()=>{const e=C();n?.(e),o(h)},[h,C,o,n]);const S=p.useCallback((e,s)=>{g(a=>({...a,[e]:s}))},[]),E=p.useCallback(()=>{const e={id:`commitment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,commitment:"",timeline:""};g(s=>({...s,actionCommitments:[...s.actionCommitments,e]}))},[]),z=p.useCallback(e=>{g(s=>({...s,actionCommitments:s.actionCommitments.filter(s=>s.id!==e)}))},[]),T=p.useCallback((e,s,a)=>{g(t=>({...t,actionCommitments:t.actionCommitments.map(t=>t.id===e?{...t,[s]:a}:t)}))},[]),A=p.useCallback(()=>{x.trim()&&(g(e=>({...e,resourcesProvided:[...e.resourcesProvided||[],x.trim()]})),y(""))},[x]),F=p.useCallback(e=>{g(s=>({...s,resourcesProvided:(s.resourcesProvided||[]).filter((s,a)=>a!==e)}))},[]);return s.jsxs("div",{className:"space-y-4",children:[s.jsx(r,{padding:"md",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(J,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"Meeting Documentation"}),s.jsx("p",{className:"text-sm mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Record the discussion details and improvement commitments"})]})]})}),s.jsxs(r,{padding:"md",children:[s.jsx("div",{onClick:()=>j(!b),className:"cursor-pointer",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[b?s.jsx(O,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}):s.jsx(R,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx(D,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:"Employee Statement"}),s.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Section B: The employee's side of the story and response"})]})]}),w.requiresCommitments?s.jsx("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:"Required"}):s.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Optional"})]})}),b&&!w.requiresCommitments&&s.jsxs("div",{className:"mt-3 flex items-start gap-2 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[s.jsx(X,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-alert-info-text)"}}),s.jsxs("div",{className:"text-sm",style:{color:"var(--color-alert-info-text)"},children:[s.jsxs("strong",{children:["For ",w.label," warnings,"]})," employee statement is optional. Focus on documenting facts and expected standards. Click to expand if you need to record their statement."]})]}),!b&&s.jsxs("div",{className:"space-y-2 mt-4",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:"Employee Statement"})}),s.jsx("textarea",{value:h.employeeStatement,onChange:e=>S("employeeStatement",e.target.value),placeholder:w.requiresCommitments?"Document the employee's explanation of what happened and their response to the incident...":"If the employee provides a statement, document it here (optional for serious warnings)...",rows:5,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:v.employeeStatement?"#ef4444":"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),v.employeeStatement&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"#ef4444"},children:[s.jsx($,{className:"w-3 h-3"}),s.jsx("span",{children:v.employeeStatement})]}),s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-tertiary)"},children:[s.jsxs("span",{children:["Character count: ",h.employeeStatement.trim().length]}),h.employeeStatement.trim().length>=20&&s.jsx(U,{className:"w-3 h-3",style:{color:"#10b981"}})]})]})]}),s.jsxs(r,{padding:"md",children:[s.jsx(a,{icon:ee,title:"Expected Behavior Standards",subtitle:"Section C: Clearly explain what correct behavior or performance is expected",className:"mb-4"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:"Expected Standards"}),s.jsx("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:"Required"})]}),s.jsx("textarea",{value:h.expectedBehavior,onChange:e=>S("expectedBehavior",e.target.value),placeholder:"Clearly describe the expected behavior, performance standards, and company policies that should be followed going forward...",rows:5,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:v.expectedBehavior?"#ef4444":"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),v.expectedBehavior&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"#ef4444"},children:[s.jsx($,{className:"w-3 h-3"}),s.jsx("span",{children:v.expectedBehavior})]}),s.jsxs("div",{className:"flex items-start gap-1.5 text-xs p-2 rounded",style:{backgroundColor:"var(--color-alert-info-bg)",color:"var(--color-alert-info-text)"},children:[s.jsx(X,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),s.jsxs("span",{children:[s.jsx("strong",{children:"Tip:"})," Clearly state what the employee should do instead. Reference specific company policies, performance standards, or behavioral expectations they must follow going forward."]})]}),s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-tertiary)"},children:[s.jsxs("span",{children:["Character count: ",h.expectedBehavior.trim().length]}),h.expectedBehavior.trim().length>=20&&s.jsx(U,{className:"w-3 h-3",style:{color:"#10b981"}})]})]})]}),s.jsxs(r,{padding:"md",children:[s.jsx(a,{icon:L,title:"Decision Reasoning",subtitle:"Section E: Explain why this warning level is appropriate based on the facts",className:"mb-4"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:"Facts & Decision Rationale"}),s.jsx("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:"Required"})]}),s.jsx("textarea",{value:h.factsAndReasoning,onChange:e=>S("factsAndReasoning",e.target.value),placeholder:"Explain WHY this warning level is appropriate: What policies were violated? Why was this incident serious? What aggravating or mitigating factors did you consider? How does the employee's history affect this decision?",rows:5,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:v.factsAndReasoning?"#ef4444":"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),v.factsAndReasoning&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"#ef4444"},children:[s.jsx($,{className:"w-3 h-3"}),s.jsx("span",{children:v.factsAndReasoning})]}),s.jsxs("div",{className:"flex items-start gap-1.5 text-xs p-2 rounded",style:{backgroundColor:"var(--color-alert-info-bg)",color:"var(--color-alert-info-text)"},children:[s.jsx(X,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),s.jsxs("span",{children:[s.jsx("strong",{children:"Tip:"})," This is different from describing what happened (Step 0). Here, explain your reasoning for choosing this warning level based on the incident severity, company policy, and employee history."]})]}),s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-tertiary)"},children:[s.jsxs("span",{children:["Character count: ",h.factsAndReasoning.trim().length]}),h.factsAndReasoning.trim().length>=20&&s.jsx(U,{className:"w-3 h-3",style:{color:"#10b981"}})]})]})]}),s.jsxs(r,{padding:"md",children:[s.jsx("div",{onClick:()=>k(!N),className:"cursor-pointer",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[N?s.jsx(O,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}):s.jsx(R,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsx(_,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:"Improvement Commitments"}),s.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Section F: Specific actions the employee commits to take"})]})]}),w.requiresCommitments?s.jsx("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:"Required"}):s.jsx("span",{className:"text-xs font-medium",style:{color:"#6b7280"},children:"Optional"})]})}),N&&!w.requiresCommitments&&s.jsxs("div",{className:"mt-3 flex items-start gap-2 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[s.jsx(X,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-alert-info-text)"}}),s.jsxs("div",{className:"text-sm",style:{color:"var(--color-alert-info-text)"},children:[s.jsxs("strong",{children:["For ",w.label," warnings,"]})," improvement commitments are optional. Focus on documenting facts and expected standards. Click to expand if you need to record commitments."]})]}),!N&&s.jsxs("div",{className:"space-y-3 mt-4",children:[0===h.actionCommitments.length?s.jsxs(c,{variant:"warning",className:"flex items-start gap-2",children:[s.jsx($,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("strong",{children:"No Commitments Added:"})," Add at least one improvement commitment with a timeline."]})]}):s.jsx("div",{className:"space-y-3",children:h.actionCommitments.map((e,a)=>s.jsxs("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)"},children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("span",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:["Commitment ",a+1]}),s.jsx("button",{onClick:()=>z(e.id),className:"p-1 rounded hover:bg-red-50 transition-colors",title:"Remove commitment",children:s.jsx(I,{className:"w-4 h-4",style:{color:"#ef4444"}})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium mb-1 block",style:{color:"var(--color-text-secondary)"},children:"Action/Commitment"}),s.jsx("input",{type:"text",value:e.commitment,onChange:s=>T(e.id,"commitment",s.target.value),placeholder:"e.g., Attend time management training and improve punctuality",className:"w-full px-3 py-2 rounded border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:v[`commitment_${a}`]?"#ef4444":"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),v[`commitment_${a}`]&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs mt-1",style:{color:"#ef4444"},children:[s.jsx($,{className:"w-3 h-3"}),s.jsx("span",{children:v[`commitment_${a}`]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium mb-1 block",style:{color:"var(--color-text-secondary)"},children:"Timeline/Deadline"}),s.jsx("input",{type:"text",value:e.timeline,onChange:s=>T(e.id,"timeline",s.target.value),placeholder:"e.g., Within 2 weeks, By end of month",className:"w-full px-3 py-2 rounded border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:v[`timeline_${a}`]?"#ef4444":"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),v[`timeline_${a}`]&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs mt-1",style:{color:"#ef4444"},children:[s.jsx($,{className:"w-3 h-3"}),s.jsx("span",{children:v[`timeline_${a}`]})]})]})]})]},e.id))}),s.jsx(i,{variant:"outline",onClick:E,className:"w-full",icon:se,children:"Add Improvement Commitment"})]})]}),w.requiresCommitments&&s.jsxs(r,{padding:"md",children:[s.jsx(a,{icon:P,title:"Follow-up Review Date",subtitle:"When will progress on these commitments be reviewed?",className:"mb-4"}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:"Review Date"}),s.jsx("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:"Required"})]}),s.jsx("input",{type:"date",value:h.reviewDate,onChange:e=>S("reviewDate",e.target.value),min:Ve(),className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:v.reviewDate?"#ef4444":"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),v.reviewDate&&s.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"#ef4444"},children:[s.jsx($,{className:"w-3 h-3"}),s.jsx("span",{children:v.reviewDate})]}),s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:"Select a date when you will meet with the employee to review their progress on the improvement commitments."})]})]}),s.jsxs(r,{padding:"md",children:[s.jsx(a,{icon:ae,title:"Training/Coaching Provided (Optional)",subtitle:"Describe any support provided during this discussion",className:"mb-4"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("textarea",{value:h.interventionDetails||"",onChange:e=>S("interventionDetails",e.target.value),placeholder:"Describe any training, coaching, mentoring, or other support provided to help the employee improve (optional)...",rows:4,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:"Examples: Job shadowing arrangement, additional training scheduled, coaching sessions planned, etc."})]})]}),s.jsxs(r,{padding:"md",children:[s.jsx(a,{icon:te,title:"Resources Provided (Optional)",subtitle:"List any tools, documents, or resources given",className:"mb-4"}),s.jsxs("div",{className:"space-y-2",children:[h.resourcesProvided&&h.resourcesProvided.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:h.resourcesProvided.map((e,a)=>s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium",style:{backgroundColor:"var(--color-primary-light)",color:"var(--color-primary)"},children:[e,s.jsx("button",{onClick:()=>F(a),className:"hover:opacity-70 transition-opacity",children:s.jsx(I,{className:"w-3 h-3"})})]},a))}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:x,onChange:e=>y(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),A())},placeholder:"e.g., Company policy handbook, Training manual",className:"flex-1 px-3 py-2 rounded border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}}),s.jsx(i,{variant:"outline",onClick:A,icon:se,disabled:!x.trim(),children:"Add"})]}),s.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:"Press Enter or click Add to include a resource. Examples: Policy documents, job aids, reference materials, etc."})]})]}),s.jsxs(r,{padding:"md",children:[s.jsx(a,{icon:P,title:"Warning Parameters",subtitle:"Set the issue date and validity period for this warning",className:"mb-4"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:"Issue Date"}),s.jsx("input",{type:"date",value:l||(new Date).toISOString().split("T")[0],onChange:e=>m?.(e.target.value),className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"}})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-secondary)"},children:"Validity Period"}),s.jsxs("select",{value:d,onChange:e=>u?.(parseInt(e.target.value)),className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)",minHeight:"44px"},children:[s.jsx("option",{value:3,children:"3 months"}),s.jsx("option",{value:6,children:"6 months"}),s.jsx("option",{value:12,children:"12 months"})]})]})]})]})]})};class Qe{static{this.EXPIRY_HOURS=1}static async generateTemporaryLink(s){s.filename,s.pdfBlob.size,s.employeeId,s.warningId,s.organizationId;try{const a=d.currentUser;if(!a)throw e.error("âŒ [TemporaryLinkService] User not authenticated"),new Error("User not authenticated");e.success(2228);const t=this.generateTokenId(),r=Date.now(),i=Math.random().toString(36).substr(2,12),o=s.filename.replace(/[^a-zA-Z0-9.-]/g,"_"),n=`temp-downloads/${s.organizationId||"default"}/${r}_${i}_${o}`,l=f(m,n),c={contentType:"application/pdf",customMetadata:{organizationId:s.organizationId||"",employeeId:s.employeeId||"",warningId:s.warningId||"",filename:s.filename,tokenId:t,createdAt:(new Date).toISOString(),size:s.pdfBlob.size.toString(),uploadedBy:a.uid,purpose:"temporary-download"}};await w(l,s.pdfBlob,c);const u=await b(l),h=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);await this.trackTemporaryFile({tokenId:t,storagePath:n,downloadUrl:u,filename:s.filename,organizationId:s.organizationId,employeeId:s.employeeId,warningId:s.warningId,uploadedBy:a.uid,expiresAt:h,createdAt:new Date}),e.success(4558);const g=await this.generateQRCode(u),x=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);return x.toISOString(),u.substring(0,60),{downloadUrl:u,qrCodeData:g,expiresAt:x.toISOString(),tokenId:t,filename:s.filename}}catch(a){throw e.error("âŒ [TemporaryLinkService] Failed to generate temporary link:",a),new Error(`Failed to generate temporary link: ${a instanceof Error?a.message:"Unknown error"}`)}}static async validateTemporaryToken(e){return!0}static async revokeTemporaryToken(e){return!0}static generateTokenId(){return`tmp_${Date.now()}_${Math.random().toString(36).substr(2,12)}`}static async blobToBase64(e){return new Promise((s,a)=>{const t=new FileReader;t.onload=()=>{const e=t.result;s(e.split(",")[1])},t.onerror=a,t.readAsDataURL(e)})}static async generateQRCode(s){try{const e=`${"https://api.qrserver.com/v1/create-qr-code/"}?${new URLSearchParams({size:"300x300",data:s,format:"png",ecc:"M",margin:"10"}).toString()}`,a=await fetch(e);if(!a.ok)throw new Error("QR code generation failed");const t=await a.blob();return new Promise((e,s)=>{const a=new FileReader;a.onload=()=>e(a.result),a.onerror=s,a.readAsDataURL(t)})}catch(a){return e.error("âŒ QR Code generation failed:",a),`data:text/plain;base64,${btoa(s)}`}}static formatExpiryTime(e){const s=new Date(e),a=new Date,t=s.getTime()-a.getTime();if(t<=0)return"Expired";const r=Math.floor(t/6e4),i=Math.floor(r/60),o=r%60;return i>0?`${i}h ${o}m remaining`:`${o}m remaining`}static isExpired(e){return new Date(e).getTime()<=Date.now()}static async trackTemporaryFile(s){try{await j(N(u,"temporaryFiles"),{tokenId:s.tokenId,storagePath:s.storagePath,downloadUrl:s.downloadUrl,filename:s.filename,fileType:"pdf",organizationId:s.organizationId||"",employeeId:s.employeeId||"",warningId:s.warningId||"",uploadedBy:s.uploadedBy,expiresAt:s.expiresAt,createdAt:k(),isExpired:!1,fileSize:0}),e.success(10578)}catch(a){e.error("âŒ [TemporaryLinkService] Failed to track temporary file:",a)}}}const Ye=({isOpen:a,onClose:t,pdfBlob:o,filename:n,employeeId:l,warningId:d,organizationId:m,employeeName:u,onLinkGenerated:h})=>{be(a);const[g,x]=p.useState(!1),[f,w]=p.useState(null),[b,j]=p.useState(null),[N,k]=p.useState({hours:0,minutes:0,seconds:0,expired:!1}),[C,S]=p.useState(!1),D=y.useRef(!1),R=p.useCallback(async()=>{if(o&&(o.size/1024).toFixed(1),o)try{x(!0),j(null);const s=await Qe.generateTemporaryLink({pdfBlob:o,filename:n,employeeId:l,warningId:d,organizationId:m});e.success(2764),w(s),h?.(s)}catch(s){e.error("âŒ QR link generation failed:",s),j(s.message||"Failed to generate QR code")}finally{x(!1)}else e.error("âŒ [QRCodeDownloadModal] No PDF blob provided")},[o,n,l,d,m,h]);p.useEffect(()=>{if(!f?.expiresAt)return;const e=()=>{const e=(new Date).getTime(),s=new Date(f.expiresAt).getTime()-e;if(s<=0)return void k({hours:0,minutes:0,seconds:0,expired:!0});const a=Math.floor(s/36e5),t=Math.floor(s%36e5/6e4),r=Math.floor(s%6e4/1e3);k({hours:a,minutes:t,seconds:r,expired:!1})};e();const s=setInterval(e,1e3);return()=>clearInterval(s)},[f?.expiresAt]);const E=p.useCallback(async()=>{if(f?.downloadUrl)try{await navigator.clipboard.writeText(f.downloadUrl),S(!0),setTimeout(()=>S(!1),2e3)}catch(s){e.error("âŒ Failed to copy link:",s)}},[f?.downloadUrl]);return p.useEffect(()=>{!a||!o||f||g||D.current||(D.current=!0,R())},[a,o,f,g,R]),p.useEffect(()=>{a||(w(null),j(null),k({hours:0,minutes:0,seconds:0,expired:!1}),S(!1),D.current=!1)},[a]),a?v.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:1e4},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col",children:[s.jsxs("div",{className:"bg-white border-b px-6 py-4 flex items-center justify-between flex-shrink-0",style:{borderColor:"var(--color-border)"},children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:s.jsx(re,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Mobile Download"}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Scan to download on your phone"})]})]}),s.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(I,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[s.jsx(r,{padding:"md",className:"border",style:{borderColor:"var(--color-border)"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:s.jsx(ie,{className:"w-5 h-5",style:{color:"var(--color-success)"}})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h4",{className:"font-medium text-sm truncate",style:{color:"var(--color-text)"},children:n}),u&&s.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["For: ",u]}),s.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Size: ",(o.size/1024).toFixed(1)," KB"]})]})]})}),g&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto mb-4",style:{borderWidth:"2px",borderColor:"transparent",borderTopColor:"var(--color-primary)"}}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:"Generating secure download link..."}),s.jsx("p",{className:"text-xs mt-2",style:{color:"var(--color-text-secondary)"},children:"This may take a moment"})]}),b&&s.jsxs(c,{variant:"error",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($,{className:"w-5 h-5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium text-sm",children:"Generation Failed"}),s.jsx("p",{className:"text-xs mt-1",children:b})]})]}),s.jsx(i,{variant:"danger",size:"sm",onClick:R,disabled:g,className:"mt-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(B,{className:"w-4 h-4"}),s.jsx("span",{children:"Try Again"})]})})]}),f&&!N.expired&&s.jsxs("div",{className:"space-y-4",children:[s.jsx(c,{variant:"warning",className:"border-l-4",style:{borderLeftColor:"var(--color-warning)"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(oe,{className:"w-5 h-5"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-sm",children:"Time-Limited Access"}),s.jsxs("p",{className:"text-xs mt-1",children:["Link expires in: ",N.hours>0&&`${N.hours}h `,N.minutes,"m ",N.seconds,"s"]})]})]})}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"bg-white p-6 rounded-lg border-2 inline-block",style:{borderColor:"var(--color-border)"},children:s.jsx("img",{src:f.qrCodeData,alt:"Download QR Code",className:"w-64 h-64 mx-auto",style:{imageRendering:"pixelated"}})}),s.jsxs("div",{className:"mt-4",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[s.jsx(ne,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Point your camera at the QR code"})]}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"No app needed - works with built-in camera on iOS & Android"})]})]}),s.jsx("div",{className:"space-y-3",children:s.jsx(i,{variant:C?"success":"secondary",size:"md",fullWidth:!0,onClick:E,children:s.jsx("div",{className:"flex items-center justify-center gap-2",children:C?s.jsxs(s.Fragment,{children:[s.jsx(U,{className:"w-5 h-5"}),s.jsx("span",{children:"Link Copied!"})]}):s.jsxs(s.Fragment,{children:[s.jsx(le,{className:"w-5 h-5"}),s.jsx("span",{children:"Copy Download Link"})]})})})}),s.jsx(c,{variant:"info",className:"border-l-4",style:{borderLeftColor:"var(--color-info)"},children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(T,{className:"w-5 h-5 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-sm",children:"Security Features"}),s.jsxs("ul",{className:"text-xs mt-1 space-y-1",children:[s.jsx("li",{children:"â€¢ Link expires automatically in 1 hour"}),s.jsx("li",{children:"â€¢ Single-use download link"}),s.jsx("li",{children:"â€¢ Encrypted token authentication"}),s.jsx("li",{children:"â€¢ No app needed - works with any camera"})]})]})]})})]}),f&&N.expired&&s.jsxs("div",{className:"text-center py-8",children:[s.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:"var(--color-error-light)"},children:s.jsx(z,{className:"w-8 h-8",style:{color:"var(--color-error)"}})}),s.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text)"},children:"Link Expired"}),s.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"The download link has expired for security reasons."}),s.jsx(i,{variant:"primary",size:"md",onClick:R,disabled:g,children:"Generate New Link"})]})]})]})}),document.body):null},Xe=e=>{if(!e)return"Counselling Session";return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"}[e]||e},Ke=({selectedEmployee:a,selectedCategory:o,formData:n,lraRecommendation:l,signatures:d,organizationName:m,currentManagerName:u,audioRecording:x,onComplete:y,onWarningCreated:f,warningId:w,onFinalizeReady:b})=>{const{user:j}=h(),{organization:N}=g();p.useEffect(()=>{a&&(a.profile,a.profile)},[a,o,n]);const[k,C]=p.useState(null),[S,R]=p.useState(!1),[I,E]=p.useState(!1),[z,T]=p.useState(null),[A,L]=p.useState(!1),[_,F]=p.useState(!1),[P,W]=p.useState(!1),[M,q]=p.useState(!1),[O,H]=p.useState(null),[V,G]=p.useState(!1),[Q,X]=p.useState(null),[Z,ee]=p.useState(!1),[se,ae]=p.useState(null),[te,ie]=p.useState(!1),oe=[{id:"email",name:"Email",icon:ce,description:"Receive warning document via email",available:!!a?.email},{id:"whatsapp",name:"WhatsApp",icon:J,description:"Receive warning document via WhatsApp",available:!!a?.phone},{id:"printed",name:"Printed Copy",icon:de,description:"Receive a printed physical copy",available:!0},{id:"qr",name:"QR Code",icon:re,description:"Download warning with QR code",available:!0}],ne=p.useCallback(async()=>{try{R(!0)}catch(s){e.error("âŒ Error opening PDF preview:",s),H("Failed to generate PDF preview")}},[]),le=p.useCallback(async()=>{if(a&&o&&N){L(!0);try{if(!N||!N.id)throw new Error("Organization data is not available. Please try again.");const{transformWarningDataForPDF:s}=await ke(async()=>{const{transformWarningDataForPDF:e}=await import("./warning-components-B7bdZBSN.js").then(e=>e.p);return{transformWarningDataForPDF:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),t={id:n.id||n.warningId||w||`WRN_${Date.now()}`,organizationId:N.id,level:n.level||l?.suggestedLevel||"counselling",category:o?.name||n.category||"General Misconduct",description:n.incidentDescription||n.description||"",incidentDate:n.incidentDate,incidentTime:n.incidentTime||"09:00",incidentLocation:n.incidentLocation||"",issueDate:n.issueDate||n.issuedDate,validityPeriod:n.validityPeriod||6,signatures:d,additionalNotes:n.additionalNotes||"",status:n.status,disciplineRecommendation:l,legalCompliance:{isCompliant:!0,framework:"LRA Section 188",requirements:l?.legalRequirements||[]},employeeStatement:n.employeeStatement,expectedBehaviorStandards:n.expectedBehaviorStandards,factsLeadingToDecision:n.factsLeadingToDecision,actionSteps:n.actionSteps,reviewDate:n.reviewDate,interventionDetails:n.interventionDetails,resourcesProvided:n.resourcesProvided},r=await s(t,a,N),{PDFGenerationService:i}=await ke(async()=>{const{PDFGenerationService:e}=await import("./dashboard-router-Bm16grTz.js").then(e=>e.f);return{PDFGenerationService:e}},__vite__mapDeps([6,1,2,3,4,5,7,8])),c=await i.generateWarningPDF(r,r.pdfGeneratorVersion,r.pdfSettings);T(c),E(!0),e.success("âœ… QR PDF generated successfully")}catch(s){e.error("âŒ QR PDF generation failed:",s),H(`Failed to generate QR code: ${s instanceof Error?s.message:"Unknown error"}`)}finally{L(!1)}}else H("Missing required data for QR code generation")},[a,o,N,n,l,d,w]),ge=p.useCallback(async(s,t)=>{if(a&&N&&j&&w)try{W(!0),H(null);try{ee(!0);const s=await Ce.createDeliveryNotification({warningId:w,organizationId:N.id,employeeId:a.id,employeeName:`${a.profile?.firstName||a.firstName||"Unknown"} ${a.profile?.lastName||a.lastName||"Employee"}`,employeeEmail:a.profile?.email||a.email||"",employeePhone:a.profile?.phoneNumber||a.phone||"",warningLevel:l?.suggestedLevel||n.level||"counselling",warningCategory:l?.category||n.category||"General",incidentDate:n.incidentDate,employeeRequestedDeliveryMethod:k,createdBy:j.id,createdByName:u});ae(s),e.success(9578),G(!0)}catch(r){e.error("âŒ Failed to create delivery notification:",r),H(r.message||"Failed to notify HR about delivery")}finally{ee(!1)}e.success(10016)}catch(i){e.error("âŒ Error creating HR notification:",i),H(i.message||"Failed to create HR notification")}finally{W(!1)}else H("Missing required data for HR notification")},[a,N,j,w,k,l,n,u]),xe=p.useCallback(async()=>"qr"===k?(G(!0),ae("QR_INSTANT_DELIVERY"),void e.success("âœ… QR Code delivery completed - instant delivery, no HR action needed")):ge(),[k,ge]),pe=p.useMemo(()=>!(!w||!k||P||se),[w,k,P,se]);return oe.find(e=>e.id===k),p.useEffect(()=>{b?.({canFinalize:pe,finalizeHandler:xe})},[pe,xe,b]),p.useEffect(()=>{if(V&&se){const e=setTimeout(()=>{y()},2e3);return()=>clearTimeout(e)}},[V,se,y]),V?s.jsx(r,{padding:"xl",className:"max-w-2xl mx-auto text-center",children:s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-success-light)"},children:s.jsx(U,{className:"w-8 h-8 sm:w-10 sm:h-10",style:{color:"var(--color-success)"}})}),s.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",style:{color:"var(--color-text)"},children:"Warning Issued Successfully!"}),s.jsxs("p",{style:{color:"var(--color-text-secondary)"},children:["Warning ",Q?`#${Q.slice(-8)}`:""," has been created."]}),s.jsx("p",{className:"font-medium mt-2",style:{color:"var(--color-primary)"},children:"qr"===k?"ðŸ”— QR Code generated - instant delivery completed!":`ðŸ“¬ HR has been notified to deliver via ${k}`}),x?.audioUrl&&!O&&s.jsx(c,{variant:"success",className:"mt-4 text-center",children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(me,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Audio recording saved successfully"})]})}),se&&"qr"!==k&&s.jsxs(c,{variant:"info",className:"mt-4 text-center",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(K,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"HR Team Notified"})]}),s.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:["Delivery notification #",se.slice(-8)," created for HR team"]})]}),"qr"!==k&&s.jsx("div",{className:"mt-6",children:s.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>ie(!te),className:"text-sm font-medium underline min-h-[40px]",children:[te?"Hide":"View"," Delivery Instructions for HR"]})}),te&&"qr"!==k&&s.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[s.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text)"},children:Se.getDeliveryInstructions(k).title}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Steps to Follow:"}),s.jsx("ol",{className:"text-sm list-decimal list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Se.getDeliveryInstructions(k).steps.map((e,a)=>s.jsx("li",{children:e},a))})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Requirements:"}),s.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Se.getDeliveryInstructions(k).requirements.map((e,a)=>s.jsx("li",{children:e},a))})]}),s.jsxs("div",{children:[s.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Documentation Needed:"}),s.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Se.getDeliveryInstructions(k).documentation.map((e,a)=>s.jsx("li",{children:e},a))})]})]})]}),O&&s.jsxs("div",{className:"mt-4 p-3 rounded-lg border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)"},children:[s.jsxs("div",{className:"flex items-center justify-center gap-2",style:{color:"var(--color-alert-warning-text)"},children:[s.jsx($,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm font-medium",children:"Warning created, but audio upload had issues"})]}),s.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-alert-warning-text)"},children:O})]})]})}):s.jsxs("div",{className:"space-y-3",children:[s.jsx(r,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-success)"},children:s.jsx(U,{className:"w-6 h-6 text-white"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"Warning Successfully Recorded"}),s.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Warning #",w?.slice(-8)," â€¢ Signatures captured â€¢ Audio uploaded"]})]})]})}),s.jsx(r,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(U,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"Ready to Hand Off to HR"}),s.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Choose delivery method and notify your HR team"})]})]})}),s.jsx(r,{padding:"sm",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-4 h-4",style:{color:"var(--color-text-secondary)"}}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee"}),s.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[a?.profile?.firstName," ",a?.profile?.lastName]})]})]}),s.jsx(t,{variant:"success",size:"sm",className:"font-semibold",children:Xe(n.level)||"Counselling Session"})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",style:{color:"var(--color-text)"},children:[s.jsx(D,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),"How would the employee like to receive this warning?"]}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Ask the employee their preference. HR can adjust this later if needed."}),s.jsx("div",{className:"grid grid-cols-1 gap-2",children:oe.map(e=>{const a=e.icon;return s.jsx(r,{padding:"sm",hover:e.available,className:"cursor-pointer transition-all border-l-4 "+(e.available?"":"opacity-50 cursor-not-allowed"),style:{borderLeftColor:k===e.id?"var(--color-primary)":"transparent",backgroundColor:k===e.id?"var(--color-alert-info-bg)":"transparent"},onClick:()=>{e.available&&(C(e.id),"qr"===e.id&&le())},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(a,{className:"w-4 h-4",style:{color:"var(--color-text)"}}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),!e.available&&"whatsapp"===e.id&&s.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-error)"},children:"No phone number available"})]})]}),k===e.id&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),s.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-primary)"},children:"Selected"})]}),s.jsx("input",{type:"radio",name:"deliveryMethod",value:e.id,checked:k===e.id,onChange:()=>{},disabled:!e.available,className:"sr-only"})]})},e.id)})})]}),!se&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("button",{onClick:ne,className:"w-full py-3 px-4 rounded-lg border transition-all hover:shadow-sm",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)"},children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(ue,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Preview"})]})}),s.jsx("div",{className:"text-xs text-center px-4",style:{color:"var(--color-text-secondary)"},children:"Your HR team will handle delivery and proof of receipt"})]}),O&&s.jsx(c,{variant:"error",children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[s.jsx($,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-error)"}}),s.jsxs("div",{children:[s.jsx("span",{className:"text-sm font-medium",children:"Error"}),s.jsx("p",{className:"text-xs mt-1",children:O})]})]}),s.jsxs(i,{variant:"ghost",size:"sm",onClick:()=>{H(null),xe()},className:"flex items-center gap-1",children:[s.jsx(B,{className:"w-3 h-3"}),"Retry"]})]})}),M&&s.jsx(c,{variant:"info",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Y,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{className:"text-sm",children:"Uploading audio..."})]})}),Z&&s.jsx(c,{variant:"info",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Y,{className:"w-4 h-4 animate-spin"}),s.jsx("span",{className:"text-sm",children:"Notifying HR..."})]})}),S&&s.jsx(De,{isOpen:S,onClose:()=>R(!1),warningData:{selectedEmployee:a,selectedCategory:o,formData:n,lraRecommendation:l,signatures:d,deliveryChoice:{method:k,timestamp:new Date,chosenBy:u},organizationName:m,currentManagerName:u,employee:a,organization:N},onPDFGenerated:(e,s)=>{},isCompleted:!1}),z&&s.jsx(Ye,{isOpen:I,onClose:()=>{F(!0)},pdfBlob:z,filename:`Warning_QR_${a?.profile?.firstName}_${a?.profile?.lastName}_${(new Date).toISOString().split("T")[0]}.pdf`,employeeId:a?.id,warningId:w||n.id||n.warningId,organizationId:N?.id,employeeName:a&&`${a.profile?.firstName||a.firstName||""} ${a.profile?.lastName||a.lastName||""}`.trim(),onLinkGenerated:e=>{}}),_&&v.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:10001},children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[s.jsx("div",{className:"bg-white border-b px-6 py-4",style:{borderColor:"var(--color-border)"},children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--color-warning-light)"},children:s.jsx($,{className:"w-5 h-5",style:{color:"var(--color-warning)"}})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Employee Download Incomplete"}),s.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Action required before continuing"})]})]})}),s.jsxs("div",{className:"p-6",children:[s.jsx(c,{variant:"warning",className:"mb-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx($,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-sm",children:[s.jsx("p",{className:"font-medium mb-2",children:"If the employee did not download their warning document:"}),s.jsx("p",{children:"You must select another delivery method before exiting this wizard to ensure they receive their copy."})]})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Choose an option:"}),s.jsxs(i,{variant:"primary",size:"md",fullWidth:!0,onClick:()=>{F(!1),E(!1),T(null)},children:[s.jsx(he,{className:"w-4 h-4"}),"Select Another Delivery Method"]}),s.jsxs(i,{variant:"secondary",size:"md",fullWidth:!0,onClick:()=>{F(!1),E(!1),T(null)},children:[s.jsx(U,{className:"w-4 h-4"}),"Employee Successfully Downloaded"]}),s.jsx("button",{onClick:()=>{F(!1)},className:"w-full text-sm py-2",style:{color:"var(--color-text-secondary)"},children:"Cancel - Return to QR Code"})]})]})]})}),document.body)]})},Ze=y.memo(({size:e="medium",color:a="#3b82f6"})=>{const t={small:"1.5rem",medium:"3rem",large:"5rem"};return s.jsx("div",{style:{width:t[e],height:t[e],border:"4px solid #e2e8f0",borderTop:`4px solid ${a}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})});Ze.displayName="LoadingSpinner";y.memo(()=>s.jsxs("div",{className:"hr-card skeleton-card",children:[s.jsx("div",{className:"skeleton-header"}),s.jsxs("div",{className:"skeleton-content",children:[s.jsx("div",{className:"skeleton-line",style:{width:"100%"}}),s.jsx("div",{className:"skeleton-line",style:{width:"80%"}}),s.jsx("div",{className:"skeleton-line",style:{width:"60%"}})]})]})).displayName="CardSkeleton";y.memo(()=>s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"1rem"},children:[1,2,3,4,5,6].map(e=>s.jsxs("div",{className:"hr-card skeleton-card",style:{padding:"1.5rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{className:"skeleton-line",style:{width:"60%",marginBottom:"0.5rem"}}),s.jsx("div",{className:"skeleton-line",style:{width:"40%",height:"2rem"}})]}),s.jsx("div",{className:"skeleton-circle",style:{width:"3rem",height:"3rem"}})]}),s.jsx("div",{className:"skeleton-line",style:{width:"50%"}})]},e))})).displayName="StatsSkeleton";if("undefined"!=typeof document){const e=document.createElement("style");e.innerHTML="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n\n  @keyframes shimmer {\n    0% { background-position: -1000px 0; }\n    100% { background-position: 1000px 0; }\n  }\n\n  .skeleton-card {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .skeleton-line {\n    height: 1rem;\n    margin-bottom: 0.5rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n  }\n\n  .skeleton-header {\n    height: 1.5rem;\n    margin-bottom: 1rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n    width: 40%;\n  }\n\n  .skeleton-circle {\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 50%;\n  }\n\n  .skeleton-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n",document.head.appendChild(e)}const Je={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},es=({onPermissionGranted:a,onPermissionDenied:t,organizationName:r,managerName:i})=>{const[o,n]=p.useState("requesting"),[l,c]=p.useState("");p.useRef(Math.random().toString(36).substr(2,9)),p.useEffect(()=>(Je.callbacks.push(a),Je.errorCallbacks.push(t),Je.isGranted?(n("granted"),void setTimeout(a,100)):(Je.isRequesting||(Je.isRequesting=!0,d()),()=>{const e=Je.callbacks.indexOf(a);e>-1&&Je.callbacks.splice(e,1);const s=Je.errorCallbacks.indexOf(t);s>-1&&Je.errorCallbacks.splice(s,1)})),[]);const d=async()=>{try{if(n("requesting"),c(""),!navigator.mediaDevices?.getUserMedia)return n("not-supported"),void c("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");try{if(navigator.permissions&&navigator.permissions.query){if("denied"===(await navigator.permissions.query({name:"microphone"})).state)return e.warn("âš ï¸ Microphone permission is permanently blocked"),n("denied"),void c("Microphone access is blocked in your browser settings. Click the lock icon in the address bar to allow access.")}}catch(s){}(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(e=>e.stop()),n("granted"),Je.isGranted||(Je.isGranted=!0,Je.isRequesting=!1,Je.callbacks.forEach(e=>{setTimeout(e,1e3)}))}catch(a){e.error("Microphone permission error:",a),Je.isRequesting=!1,"NotAllowedError"===a.name?(n("denied"),c("Microphone access was denied. Click the lock/info icon in your browser's address bar, then allow microphone access and refresh this page.")):"NotFoundError"===a.name?(n("error"),c("No microphone was found on your device. Please connect a microphone and try again.")):"NotReadableError"===a.name?(n("error"),c("Your microphone is being used by another application. Please close other apps and try again.")):(n("error"),c("An error occurred while accessing your microphone. Please check your browser settings.")),Je.errorCallbacks.forEach(e=>{e()})}},m=(()=>{switch(o){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:l};case"not-supported":return{title:"Browser Not Supported",message:l};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:s.jsxs("div",{className:"max-w-sm w-full",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:(()=>{switch(o){case"requesting":return s.jsx(Ze,{size:"medium",color:"#3b82f6"});case"granted":return s.jsx(Ze,{size:"medium",color:"#16a34a"});case"denied":return s.jsx(xe,{className:"w-6 h-6 text-red-600"});case"error":return s.jsx(pe,{className:"w-6 h-6 text-red-600"});case"not-supported":return s.jsx(xe,{className:"w-6 h-6 text-gray-600"});default:return s.jsx(me,{className:"w-6 h-6 text-gray-600"})}})()}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m.title}),s.jsx("p",{className:"text-sm text-gray-600",children:m.message})]}),("denied"===o||"error"===o)&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3 text-left",children:s.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[s.jsx(ge,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-xs text-blue-900",children:[s.jsx("p",{className:"font-semibold mb-1",children:"To enable microphone:"}),s.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-blue-800",children:[s.jsxs("li",{children:["Click the ",s.jsx("strong",{children:"lock icon"})," or ",s.jsx("strong",{children:"site settings"})," in your browser's address bar"]}),s.jsxs("li",{children:["Find ",s.jsx("strong",{children:"Microphone"})," settings"]}),s.jsxs("li",{children:["Change to ",s.jsx("strong",{children:"Allow"})]}),s.jsx("li",{children:"Refresh this page or click Try Again below"})]})]})]})}),s.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"})]})]}),s.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:s.jsx("p",{children:r})})]})})},ss="audio/webm;codecs=opus",as=16e3,ts=8e3,rs=1,is=3e5,os=819200,ns=24e4,ls=!0,cs=!0,ds=!0;class ms{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return ms.instance||(ms.instance=new ms),ms.instance}canStart(){const e=Date.now();return!this.isRecording&&!this.isStarting&&(!(this.startedAt>0&&e-this.startedAt<1e3)&&(!(this.allActiveStreams.size>0||this.allActiveTracks.size>0)||(this.allActiveStreams.size,this.allActiveTracks.size,!1)))}tryReserve(){return!!this.canStart()&&(this.isStarting=!0,this.startedAt=Date.now(),!0)}startRecording(){this.isRecording=!0}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{try{e.stop()}catch(s){}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null)}setStream(e){return this.mediaStream||this.allActiveStreams.size>0?(this.allActiveStreams.size,e.getTracks().forEach(e=>e.stop()),!1):(this.allActiveStreams.add(e),e.getTracks().forEach(e=>{this.allActiveTracks.add(e),e.addEventListener("ended",()=>{this.allActiveTracks.delete(e)})}),this.mediaStream=e,this.isStarting=!1,this.allActiveStreams.size,!0)}stopAllStreams(){this.allActiveStreams.size,this.allActiveTracks.size,this.allActiveStreams.forEach(e=>{e.getTracks().forEach(e=>{try{e.stop()}catch(s){}})}),this.allActiveTracks.forEach(e=>{try{"live"===e.readyState&&e.stop()}catch(s){}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0}}const us=ms.getInstance(),hs=y.memo(({employees:a,categories:t,currentManagerName:r,organizationName:i,onComplete:o,onCancel:n,preSelectedEmployeeId:l,preSelectedCategoryId:c,isFullScreen:d})=>{p.useRef(Math.random().toString(36).substr(2,9));const{user:y}=h(),{organization:v}=g(),j=(()=>{const[s,a]=p.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),t=p.useRef(null),r=p.useRef([]),i=p.useRef(null),o=p.useRef(0),n=p.useRef(null),l=p.useRef(!1),c=p.useRef(!1),d=p.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),u=p.useCallback(e=>e<1024?`${e}B`:e<1048576?`${(e/1024).toFixed(1)}KB`:`${(e/1048576).toFixed(1)}MB`,[]),h=p.useCallback(()=>`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),g=p.useCallback(()=>{if(!o.current)return;if(!s.isRecording)return void(n.current&&(clearInterval(n.current),n.current=null));const e=(Date.now()-o.current)/1e3,r=Date.now()-o.current;if(a(s=>s.isRecording?{...s,duration:e}:s),r>=is)return n.current&&(clearInterval(n.current),n.current=null),void setTimeout(()=>{t.current&&"recording"===t.current.state&&t.current.stop()},0);r>=ns&&!l.current&&(l.current=!0)},[]),x=p.useCallback(()=>{try{if(t.current){try{"recording"===t.current.state&&t.current.stop()}catch(s){}t.current=null}[i.current,us.mediaStream].filter(Boolean).forEach(e=>{e&&e.getTracks().forEach(e=>{try{e.stop()}catch(s){}})}),i.current=null,us.stopAllStreams(),n.current&&(clearInterval(n.current),n.current=null),r.current=[],l.current=!1,o.current=0,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(s){e.error("âŒ Error during force cleanup:",s)}},[]),y=p.useCallback(async()=>{if(us.tryReserve())try{if(c.current=!1,(i.current||t.current||us.mediaStream)&&(x(),await new Promise(e=>setTimeout(e,100))),a(e=>({...e,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const s=await navigator.mediaDevices.getUserMedia({audio:{channelCount:rs,sampleRate:ts,echoCancellation:ls,noiseSuppression:cs,autoGainControl:ds}});if(!us.setStream(s))return void a(e=>({...e,isProcessing:!1,error:"Another recording is already active"}));i.current=s,r.current=[];const d=new MediaRecorder(s,{mimeType:ss,audioBitsPerSecond:as});t.current=d,d.ondataavailable=s=>{if(!c.current&&s.data.size>0){r.current.push(s.data);const o=r.current.reduce((e,s)=>e+s.size,0);if(a(e=>({...e,size:o})),o>=os&&"recording"===t.current?.state){u(o),c.current=!0;try{t.current.stop()}catch(i){e.error("âŒ Error stopping MediaRecorder:",i)}}}},d.onstop=()=>{i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null)},d.start(1e3),o.current=Date.now(),l.current=!1,us.startRecording(),n.current=setInterval(g,100);const m=h();a(e=>({...e,isRecording:!0,isProcessing:!1,recordingId:m,duration:0,size:0}))}catch(s){e.error("âŒ Error starting recording:",s),us.stopRecording(),a(e=>({...e,isRecording:!1,isProcessing:!1,error:s.message||"Failed to start recording"}))}},[g,h]),v=p.useCallback(async()=>{try{return t.current&&s.isRecording?(a(e=>({...e,isProcessing:!0})),n.current&&(clearInterval(n.current),n.current=null),new Promise(s=>{const i=t.current;i.onstop=()=>{try{const e=new Blob(r.current,{type:ss}),t=URL.createObjectURL(e);a(s=>({...s,isRecording:!1,isProcessing:!1,audioUrl:t,size:e.size})),u(e.size),c.current=!1,s(t)}catch(t){e.error("âŒ Error processing recording:",t),a(e=>({...e,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),c.current=!1,s(null)}},i.stop(),a(e=>({...e,isRecording:!1}))})):(c.current=!1,null)}catch(i){return e.error("âŒ Error stopping recording:",i),a(e=>({...e,isRecording:!1,isProcessing:!1,error:i.message||"Failed to stop recording"})),c.current=!1,null}},[s.isRecording,u]),j=p.useCallback(()=>{t.current&&s.isRecording&&(t.current.pause(),n.current&&(clearInterval(n.current),n.current=null))},[s.isRecording]),N=p.useCallback(()=>{t.current&&s.isRecording&&(t.current.resume(),o.current=Date.now()-1e3*s.duration,n.current=setInterval(g,100))},[s.isRecording,s.duration,g]),k=p.useCallback(()=>{try{t.current&&t.current.stop(),i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null),n.current&&(clearInterval(n.current),n.current=null),s.audioUrl&&URL.revokeObjectURL(s.audioUrl),r.current=[],l.current=!1,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(o){e.error("âŒ Error cancelling recording:",o)}},[s.audioUrl]),C=p.useCallback(async(t,r)=>{try{if(!s.audioUrl||!s.recordingId)throw new Error("No recording available to upload");a(e=>({...e,isProcessing:!0}));const i=await fetch(s.audioUrl),o=await i.blob(),n=`warnings/${t}/${r}/audio/${s.recordingId}.webm`,l=f(m,n),c={contentType:ss,customMetadata:{warningId:r,organizationId:t,duration:s.duration.toString(),size:s.size.toString(),recordingId:s.recordingId,createdAt:(new Date).toISOString()}};await w(l,o,c);const d=await b(l);return a(e=>({...e,isProcessing:!1})),e.success(13735),d}catch(i){return e.error("âŒ Error uploading audio:",i),a(e=>({...e,isProcessing:!1,error:i.message||"Failed to upload audio"})),null}},[s.audioUrl,s.recordingId,s.duration,s.size]),S=p.useCallback(async(t,r,i,o)=>{try{if(!t||!r)throw new Error("No recording data provided for upload");a(e=>({...e,isProcessing:!0}));const n=await fetch(t),l=await n.blob(),c=f(m,`warnings/${i}/${o}/audio/${r}.webm`),d={contentType:ss,customMetadata:{warningId:o,organizationId:i,duration:s.duration.toString(),size:l.size.toString(),recordingId:r,createdAt:(new Date).toISOString()}};await w(c,l,d);const u=await b(c);return a(e=>({...e,isProcessing:!1})),e.success(15712),u}catch(n){return e.error("âŒ Error uploading audio from URL:",n),a(e=>({...e,isProcessing:!1,error:n.message||"Failed to upload audio"})),null}},[s.duration]);p.useEffect(()=>()=>{if(n.current&&(clearInterval(n.current),n.current=null),i.current&&(i.current.getTracks().forEach(e=>{e.stop()}),i.current=null),t.current){try{"recording"===t.current.state&&t.current.stop()}catch(e){}t.current=null}r.current=[],l.current=!1,o.current=0,us.stopAllStreams()},[]);const D=s.duration>=ns/1e3,R=!s.isRecording&&!s.isProcessing;return{...s,startRecording:y,stopRecording:v,pauseRecording:j,resumeRecording:N,cancelRecording:k,forceCleanup:x,uploadToFirebase:C,uploadToFirebaseFromUrl:S,formatDuration:d,formatSize:u,isNearLimit:D,canRecord:R}})(),N=p.useCallback(async()=>{z(!0),A(!1)},[]),k=p.useCallback(()=>{z(!1)},[]);p.useEffect(()=>{const e=e=>{if("undefined"!=typeof window)if(e){const e=window.scrollY;document.documentElement.style.setProperty("--scroll-y",`-${e}px`),document.body.classList.add("modal-open")}else{document.body.classList.remove("modal-open");const e=document.documentElement.style.getPropertyValue("--scroll-y");document.documentElement.style.removeProperty("--scroll-y"),e&&window.scrollTo(0,-1*parseInt(e.replace("px","")))}};return e(!0),()=>e(!1)},[]),p.useEffect(()=>{const e=setTimeout(()=>{alert("â±ï¸ Session Timeout\n\nThis warning session has been open for 30 minutes and will now close. Please start a new warning if needed."),j&&j.forceCleanup(),n()},18e5);return()=>{clearTimeout(e)}},[]);const[D,R]=p.useState(0),[E,z]=p.useState(!1),[T,A]=p.useState(!0),[_,P]=p.useState(new Set),[W,M]=p.useState(!1),[q,B]=p.useState(!1),[V]=p.useState(()=>je()),[G,Q]=p.useState({employeeId:l||null,categoryId:c||null,incidentDate:(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),incidentTime:(new Date).toTimeString().split(" ")[0].substring(0,5),incidentLocation:"",incidentDescription:"",additionalNotes:"",issueDate:(()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})(),validityPeriod:6}),[Y,X]=p.useState(!1),[Z,ee]=p.useState([]),[se,ae]=p.useState(null),[te,re]=p.useState(null),[ie,oe]=p.useState({employeeId:null,warnings:null,timestamp:null}),[ne,le]=p.useState(null),[ce,de]=p.useState({employeeStatement:"",expectedBehavior:"",factsAndReasoning:"",actionCommitments:[],reviewDate:"",interventionDetails:"",resourcesProvided:[]});p.useEffect(()=>{const e=ne||se?.suggestedLevel||"counselling";G.level!==e&&Q(s=>({...s,level:e,wasOverridden:!!ne}))},[ne,se?.suggestedLevel,G.level]);const[me,ue]=p.useState(!1),[he,ge]=p.useState(null),[xe,pe]=p.useState(null),[ve,fe]=p.useState(!1),[we,be]=p.useState(null),[ke,Ce]=p.useState(0),Se=["Fetching employee warning history","Checking for active warnings","Verifying escalation safety","Calculating recommendation","Applying LRA compliance rules"],[De,Ie]=p.useState({manager:null,employee:null}),[ze,Te]=p.useState(!1),[Ae,_e]=p.useState(!1),[$e,Fe]=p.useState(null),Pe=(({sessionId:e,stepName:s,autoStart:a=!0,enableRealTimeValidation:t=!0})=>{const[r,i]=p.useState(e||""),[o,n]=p.useState([]),[l,c]=p.useState([]),[d,m]=p.useState(null),u=p.useRef(!1),h=p.useRef(!1);p.useEffect(()=>{if(!a||u.current||e)e&&(i(e),u.current=!0);else{const e=Ee.startWizardSession();i(e),u.current=!0}},[a,e]),p.useEffect(()=>{if(!r)return;const e=()=>{const e=Ee.getSessionLogs(r),s=Ee.getSessionIssues(r),a=Ee.getSessionSummary(r);n(e),c(s),m(a)};e();const s=s=>{(s.metadata?.sessionId===r||o.some(e=>e.id===s.id))&&e()};Ee.addListener(s);const a=setInterval(e,2e3);return()=>{Ee.removeListener(s),clearInterval(a)}},[r]);const g=p.useCallback(()=>{if(!u.current){const e=Ee.startWizardSession();return i(e),u.current=!0,e}return r},[r]),x=p.useCallback(e=>{r&&(h.current&&(Ee.exitStep(r,s,void 0,"completed"===e),h.current=!1),Ee.endWizardSession(r,e),u.current=!1)},[r,s]),y=p.useCallback(e=>{r&&!h.current&&(Ee.enterStep(r,s,e),h.current=!0)},[r,s]),v=p.useCallback((e,a=!0)=>{r&&h.current&&(Ee.exitStep(r,s,e,a),h.current=!1)},[r,s]),f=p.useCallback((e,a,t)=>{r&&Ee.trackDataChange(r,s,e,a,t)},[r,s]),w=p.useCallback(e=>{r&&Ee.trackFormSubmission(r,s,e)},[r,s]),b=p.useCallback((e,a,t,i)=>{r&&Ee.trackAPICall(r,s,e,a,t,i)},[r,s]),j=p.useCallback((e,a)=>{r&&Ee.trackError(r,s,e,a)},[r,s]),N=p.useCallback((e,a)=>{r&&Ee.trackSuccess(r,s,e,a)},[r,s]),k=p.useCallback((e,a)=>{r&&Ee.trackWarning(r,s,e,a)},[r,s]),C=p.useCallback(e=>r&&t&&Ee.validateStepData?.(r,s,e,"MANUAL_VALIDATION")||{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},[r,s,t]),S=p.useCallback(()=>r?Ee.exportSessionData(r):"",[r]);return p.useEffect(()=>{r&&a&&!h.current&&y()},[r,a,y]),p.useEffect(()=>()=>{r&&h.current&&v(void 0,!1)},[r,v]),{sessionId:r,startSession:g,endSession:x,enterStep:y,exitStep:v,trackChange:f,trackFormSubmit:w,trackAPI:b,trackError:j,trackSuccess:N,trackWarning:k,validateData:C,logs:o,issues:l,summary:d,exportSession:S}})({stepName:`STEP_${D||1}`,autoStart:!0,enableRealTimeValidation:!1}),We=p.useRef(0);p.useRef(G),p.useRef(new Set);const Me=p.useRef(!1),qe=p.useMemo(()=>a.find(e=>e.id===G.employeeId),[a,G.employeeId]),Ue=p.useMemo(()=>t.find(e=>e.id===G.categoryId),[t,G.categoryId]),Oe=p.useMemo(()=>v?.id,[v?.id]);p.useEffect(()=>{const s=G.employeeId;s&&Oe&&ie.employeeId!==s&&0===D&&x.warnings.getActiveWarnings(s,Oe).then(a=>{e.success(`âš¡ [ANTICIPATORY] Preloaded ${a.length} active warnings (ready for instant LRA generation)`),oe({employeeId:s,warnings:a,timestamp:Date.now()})}).catch(s=>{e.warn("âš ï¸ [ANTICIPATORY] Failed to preload warnings (will fetch on-demand):",s)})},[G.employeeId,Oe,ie.employeeId,D]),p.useCallback(()=>{D>0&&!ve&&R(D-1)},[D,ve]),p.useCallback(()=>{D<4&&!ve&&R(D+1)},[D,ve]),p.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"});const e=document.querySelector(".modal-content__scrollable");e&&e.scrollTo({top:0,behavior:"smooth"});const s=document.querySelector(".modal-system");s&&s.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{window.scrollTo({top:0,behavior:"instant"}),e&&e.scrollTop>0&&(e.scrollTop=0)},500)},[D]),p.useEffect(()=>{We.current!==D&&(Pe.trackSuccess("STEP_CHANGED",{from:We.current,to:D,stepName:0===D?"Incident Details":2===D?"Legal Review":1===D?"Corrective Discussion":"Delivery Completion"}),We.current=D)},[D,Pe]),j.isRecording;const He=p.useCallback(async e=>{if(e&&Oe){Pe.trackAPI("loadWarningHistory",{employeeId:e,organizationId:Oe}),X(!0);try{const s=await x.warnings.getAll(Oe,{employeeId:e});ee(s),Pe.trackAPI("loadWarningHistory",{employeeId:e,organizationId:Oe},{count:s.length})}catch(s){Pe.trackError(s,{employeeId:e,organizationId:Oe}),ee([])}finally{X(!1)}}},[Oe,Pe]),Ve=p.useRef(null);p.useEffect(()=>{qe&&!Y&&Ve.current!==qe.id&&(Ve.current=qe.id,He(qe.id))},[qe?.id,Y,He]);const Qe=p.useCallback(async(s,r)=>{if(!(s&&r&&Oe&&G.incidentDescription)){const e={employeeId:!!s,categoryId:!!r,organizationId:!!Oe,incidentDescription:!!G.incidentDescription};return void Pe.trackError(new Error("Cannot generate LRA - missing data"),e)}let i;M(!0),Pe.trackAPI("generateLRARecommendation",{employeeId:s,categoryId:r});try{i=await x.warnings.getActiveWarnings(s,Oe),i.length}catch(o){e.error("âŒ Failed to fetch active warnings:",o),Pe.trackError(o,{employeeId:s,categoryId:r,context:"final_warning_verification_failed"});const i=a.find(e=>e.id===s),n=t.find(e=>e.id===r);return ue(!0),ge({employeeName:i&&`${i.profile?.firstName||i.firstName||""} ${i.profile?.lastName||i.lastName||""}`.trim()||"Employee",categoryName:n?.name||"Category",warningDate:"cannot_verify_escalation"}),void M(!1)}if(i.some(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===r)){const e=i.find(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===r),o=a.find(e=>e.id===s),n=t.find(e=>e.id===r);return ue(!0),ge({employeeName:o&&`${o.profile?.firstName||o.firstName||""} ${o.profile?.lastName||o.lastName||""}`.trim()||"Employee",categoryName:n?.name||"Category",warningDate:e?.issueDate||(new Date).toISOString()}),void M(!1)}try{const a=ie.employeeId===s?ie.warnings:null;a&&e.success(`âš¡ [ANTICIPATORY] Using ${a.length} preloaded warnings - near-instant LRA generation!`);const t=await x.warnings.getEscalationRecommendation(s,r,v?.id||"default",Ue,a||void 0);ae(t),Pe.trackAPI("generateLRARecommendation",{employeeId:s,categoryId:r},t)}catch(n){Pe.trackError(n,{employeeId:s,categoryId:r,formData:G,context:"lra_generation_failed"});const e=Ue?.escalationPath||["counselling","verbal","first_written","final_written"],a={suggestedLevel:e[0]||"counselling",recommendedLevel:"counselling"===e[0]?"Counselling Session":"verbal"===e[0]?"Verbal Warning":"first_written"===e[0]?"Written Warning":"Counselling Session",reason:"Fallback recommendation due to analysis error. Manual review required.",activeWarnings:i,escalationPath:e,isEscalation:!1,category:Ue?.name||"General Misconduct",categoryId:r,legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure procedural fairness","Document thoroughly"],warningCount:i.length,nextExpiryDate:null,examples:["Review case manually","Consult HR if needed"],explanation:"Unable to analyze history - system error occurred",previousWarnings:[],confidence:60};ae(a),Pe.trackWarning("Using fallback LRA recommendation",a)}finally{M(!1)}},[Oe,G.incidentDescription,Ue,Pe,a,t]),Ye=p.useCallback(e=>{const s=["employeeId","categoryId","incidentLocation"];Object.keys(e).some(a=>s.includes(a)&&e[a]!==G[a])&&Pe.trackSuccess("SIGNIFICANT_FORM_UPDATE",e),Q(s=>({...s,...e}))},[G,Pe]),Xe=p.useCallback(()=>{Pe.trackSuccess("WIZARD_COMPLETED",{sessionDuration:Date.now()-new Date(Pe.summary?.startTime||Date.now()).getTime(),totalSteps:_.size,totalIssues:Pe.issues.length,finalWarningId:te}),Pe.endSession("completed"),o()},[o,Pe,_.size,te]),Ze=p.useCallback(()=>{Pe.trackWarning("WIZARD_CANCELLED",{currentStep:D,completedSteps:Array.from(_)}),j.forceCleanup(),document.body.classList.remove("modal-open"),Pe.endSession("cancelled"),n()},[n,Pe,D,_,j]);p.useEffect(()=>{if(Me.current||!E||j.isRecording||j.audioUrl)return;return(async()=>{try{Me.current=!0,await j.startRecording(),Pe.trackSuccess("AUDIO_RECORDING_STARTED",{duration:j.duration,size:j.size})}catch(e){Pe.trackError(e,{context:"AUDIO_RECORDING_START"}),Me.current=!1}})(),()=>{Me.current=!1}},[E]),p.useEffect(()=>{if(W){Ce(0);const e=setInterval(()=>{Ce(e=>e<Se.length-1?e+1:e)},600);return()=>clearInterval(e)}Ce(0)},[W,Se.length]),p.useEffect(()=>{we&&!W&&se&&(Pe.trackSuccess("LRA_ANALYSIS_COMPLETE_PROCEEDING",{pendingStep:we,hasRecommendation:!!se}),R(we),be(null),fe(!1)),me&&we&&(be(null),fe(!1))},[we,W,se,me,Pe]);const Je=p.useCallback(async()=>{if(Pe.trackSuccess("NEXT_STEP_REQUESTED",{currentStep:D,hasLRA:!!se}),3===D)return void(xe?.canFinalize&&xe?.finalizeHandler&&(Pe.trackSuccess("FINALIZING_WARNING",{}),xe.finalizeHandler()));const e=D+1;if(P(e=>new Set([...e,D])),0===D&&1===e)return G.employeeId&&G.categoryId&&G.incidentDescription?se&&!W?(Pe.trackSuccess("PROCEEDING_TO_STEP_2",{hasLRA:!0}),void R(e)):(Pe.trackSuccess("TRIGGERING_LRA_GENERATION",G),fe(!0),be(e),void(await Qe(G.employeeId,G.categoryId))):void Pe.trackError(new Error("Missing required data for step 2"),{employeeId:!!G.employeeId,categoryId:!!G.categoryId,incidentDescription:!!G.incidentDescription});Pe.trackSuccess("STEP_NAVIGATION_COMPLETE",{from:D,to:e}),R(e)},[D,G.employeeId,G.categoryId,G.incidentDescription,se,W,Qe,Pe,xe]),ms=p.useCallback(()=>{D>0&&(Pe.trackSuccess("PREVIOUS_STEP",{from:D,to:D-1}),R(D-1),ve&&(fe(!1),be(null),Pe.trackWarning("NAVIGATION_CANCELLED_BY_BACK",{currentStep:D})))},[D,ve,Pe]),hs=p.useCallback(async(s,a=!1)=>{if(Pe.trackSuccess("SIGNATURES_COMPLETED",{hasManager:!!s.manager,hasEmployee:!!s.employee,hasWitness:!!s.witness,finalized:a,timestamp:s.timestamp}),Ie(s),a){_e(!0),Te(!0);try{let a=null;if(j?.isRecording&&(Fe("stopping"),Pe.trackSuccess("AUDIO_AUTO_STOP_BEFORE_SAVE",{duration:j.duration,size:j.size}),a=await j.stopRecording(),e.success(21068),a||e.warn("âš ï¸ Audio URL not returned from stopRecording. Will create warning with placeholder.")),!qe||!Ue||!v)throw new Error("Missing required data for warning creation");const n=y?.firstName&&y?.lastName?`${y.firstName} ${y.lastName}`.trim():r||"Manager";let l;if(v?.pdfSettings&&Object.keys(v.pdfSettings),v?.pdfSettings&&y?.uid)try{l=await Re.ensureTemplateVersionExists(v.id,v.pdfSettings,y.uid),e.success(`âœ… PDF template version ${l} saved/verified`)}catch(t){e.error("âŒ Failed to save PDF template version:",t)}const c={employeeId:qe.id,categoryId:Ue.id,organizationId:v.id,issuedBy:y?.uid||"",issuedByName:n,employeeName:qe.profile?.firstName||"Unknown",employeeLastName:qe.profile?.lastName||"Employee",employeeNumber:qe.profile?.employeeNumber||"Unknown",employeeDepartment:qe.profile?.department||"Unknown",employeePosition:qe.profile?.position||"Unknown",categoryName:Ue.name||"Unknown",level:ne||se?.suggestedLevel||"counselling",wasOverridden:!!ne,originalRecommendedLevel:se?.suggestedLevel,incidentDate:G.incidentDate,incidentTime:G.incidentTime,incidentLocation:G.incidentLocation,incidentDescription:G.incidentDescription,additionalNotes:G.additionalNotes,issueDate:G.issueDate,validityPeriod:G.validityPeriod,signatures:s,employeeStatement:ce.employeeStatement||void 0,expectedBehaviorStandards:ce.expectedBehavior||void 0,factsLeadingToDecision:ce.factsAndReasoning||void 0,actionSteps:ce.actionCommitments.length>0?ce.actionCommitments.map(e=>({action:e.commitment,timeline:e.timeline})):void 0,reviewDate:ce.reviewDate||void 0,...ce.reviewDate&&{reviewStatus:"pending",reviewLastChecked:new Date},interventionDetails:ce.interventionDetails||void 0,resourcesProvided:ce.resourcesProvided&&ce.resourcesProvided.length>0?ce.resourcesProvided:void 0,pdfGeneratorVersion:Ne,...l?{pdfTemplateVersion:l}:{},disciplineRecommendation:se||void 0};Object.keys(c),c.disciplineRecommendation,c.disciplineRecommendation,c.pdfSettings,c.pdfSettings&&Object.keys(c.pdfSettings),a?(c.audioRecording={url:a,duration:j?.duration||0,size:j?.size||0,recordingId:j?.recordingId,timestamp:new Date,recordedAt:new Date,recordedBy:y?.id||"",recordedByName:y?.name||r||"Manager",format:"webm",uploadToFirebase:!0,status:"ready",processingStatus:"pending"},e.success(23340)):(e.error("âŒ Audio recording is mandatory for all warnings"),Pe.trackError(new Error("Audio recording missing"),{warningData:G,audioState:{isRecording:j?.isRecording,hasDirectUrl:!!a,hasStateUrl:!!j?.audioUrl,duration:j?.duration}}),c.audioRecording={status:"missing",processingStatus:"required",error:"Audio recording is mandatory but was not captured",duration:j?.duration||0,size:j?.size||0,uploadToFirebase:!1,requiresAttention:!0});const d=await x.warnings.create(c);if(e.success(24554),re(d),a&&j?.uploadToFirebaseFromUrl&&j?.recordingId&&d)try{Fe("uploading");const s=await j.uploadToFirebaseFromUrl(a,j.recordingId,v.id,d);if(s){e.success(25382);const a=C(u,"organizations",v.id,"warnings",d);await S(a,{"audioRecording.url":s,"audioRecording.storageePath":`warnings/${v.id}/${d}/audio/${j.recordingId}.webm`,"audioRecording.processingStatus":"complete","audioRecording.uploadedAt":new Date,updatedAt:new Date}),e.success(26224),Pe.trackSuccess("AUDIO_UPLOADED_AND_UPDATED",{warningId:d,firebaseUrl:s,duration:j.duration,size:j.size}),Fe("complete"),j.forceCleanup()}else e.warn("âš ï¸ Audio upload returned null URL"),Pe.trackWarning("AUDIO_UPLOAD_NULL_URL",{warningId:d})}catch(i){e.error("âŒ Audio upload failed:",i),Pe.trackError(i,{context:"AUDIO_UPLOAD_STEP2",warningId:d,duration:j?.duration,size:j?.size});try{const e=C(u,"organizations",v.id,"warnings",d);await S(e,{"audioRecording.processingStatus":"failed","audioRecording.error":i.message||"Upload failed in Step 2","audioRecording.failedAt":new Date,updatedAt:new Date})}catch(o){e.error("âŒ Failed to update warning with audio error:",o),Pe.trackError(o,{context:"AUDIO_ERROR_UPDATE"})}j.forceCleanup()}Pe.trackSuccess("WARNING_FULLY_CREATED_STEP2",{warningId:d}),_e(!1),R(3),setTimeout(()=>{P(e=>new Set([...e,2])),Pe.trackSuccess("SIGNATURES_FINALIZED_AFTER_ADVANCE",{currentStep:D})},50),Pe.trackSuccess("AUTO_ADVANCED_TO_STEP3",{fromStep:D})}catch(t){e.error("âŒ Error creating warning:",t),Pe.trackError(t,{context:"WARNING_CREATION_ON_SIGNATURE_COMPLETE"}),_e(!1),P(e=>new Set([...e,D]))}}},[D,Pe,j,qe,Ue,v,G,se,x,y,r,ne,ce]),gs=p.useMemo(()=>({0:{title:"Incident Details",subtitle:"Step 1 of 4",description:"Select employee, choose violation category, and document the incident with all relevant details.",icon:F},1:{title:"Corrective Discussion",subtitle:"Step 2 of 4",description:"Document employee response, expected behavior, and improvement commitments.",icon:J},2:{title:"Review & Sign",subtitle:"Step 3 of 4",description:"Review escalation recommendation, read warning script, and collect required signatures.",icon:L},3:{title:"Delivery Setup",subtitle:"Step 4 of 4 - Administrative",description:"âœ… Warning saved. Choose how HR will deliver to employee.",icon:K}}),[]),xs=p.useMemo(()=>{switch(D){case 0:return!!(G.employeeId&&G.categoryId&&G.incidentDate&&G.incidentTime&&G.incidentLocation&&G.incidentDescription&&G.incidentDescription.length>=20);case 2:return!!(se&&!W&&De.manager&&De.employee&&ze);case 1:{const e=!["final_written","suspension","dismissal"].includes(ne||se?.suggestedLevel||"counselling");return!(!ce.expectedBehavior||ce.expectedBehavior.trim().length<20)&&(!(e&&(!ce.employeeStatement||ce.employeeStatement.trim().length<20))&&((!e||0!==ce.actionCommitments.length)&&!(e&&!ce.reviewDate)))}case 3:return!0;default:return!1}},[D,G,se,W,De,ze,ce,ne]),ps=p.useCallback(()=>{switch(D){case 0:if(me&&he){const e="cannot_verify_escalation"===he.warningDate;return s.jsxs("div",{className:"p-6 space-y-5",children:[s.jsx("div",{className:"p-5 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)",borderLeft:"4px solid var(--color-error)"},children:s.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[s.jsx($,{className:"w-6 h-6 flex-shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-base font-bold mb-1",style:{color:"var(--color-error)"},children:e?"HR Approval Required":"Cannot Issue Warning"}),s.jsxs("p",{className:"text-sm mb-2",style:{color:"var(--color-alert-error-text)"},children:[s.jsx("strong",{children:he.employeeName})," has a Final Written Warning on file."]}),s.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)",opacity:.9},children:e?"Cannot verify warning history. Contact HR to approve further escalation.":"This is the final step before termination. HR must handle any further escalation."})]})]})}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:async()=>{alert("HR Notification feature coming soon!\n\nFor now, please contact your HR Manager directly via phone or email.")},className:"flex-1 px-4 py-3 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[s.jsx(K,{className:"w-4 h-4 inline mr-2"}),"Notify HR Manager"]}),s.jsxs("button",{onClick:()=>{ue(!1),ge(null),n()},className:"px-4 py-3 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-error)",color:"var(--color-text-inverse)"},children:[s.jsx(I,{className:"w-4 h-4 inline mr-2"}),"Close"]})]})]})}return s.jsx(Le,{employees:a,categories:t,formData:G,updateFormData:Ye,selectedEmployee:qe,selectedCategory:Ue,warningHistory:Z,isLoadingWarningHistory:Y,loadWarningHistory:He,lraRecommendation:se,isAnalyzing:W,analysisStep:ke,analysisSteps:Se});case 1:return s.jsx(Ge,{warningLevel:ne||se?.suggestedLevel||"counselling",currentData:ce,onDataChange:de,issueDate:G.issueDate,validityPeriod:G.validityPeriod,onIssueDateChange:e=>Ye({issueDate:e}),onValidityPeriodChange:e=>Ye({validityPeriod:e})});case 2:return s.jsx(Be,{lraRecommendation:se,selectedEmployee:qe,selectedCategory:Ue,formData:G,currentManagerName:r,onSignaturesComplete:hs,isAnalyzing:W,signaturesFinalized:ze,currentSignatures:De,warningId:te,audioUploadStatus:$e,onLevelOverride:le});case 3:return s.jsx(Ke,{selectedEmployee:qe,selectedCategory:Ue,formData:G,lraRecommendation:se,signatures:De,organizationName:i,currentManagerName:r,audioRecording:j,onComplete:Xe,onWarningCreated:re,warningId:te,onFinalizeReady:pe});default:return s.jsxs("div",{className:"p-8 text-center text-red-600",children:["Unknown step: ",D]})}},[D,i,r,a,t,G,Ye,qe,Ue,Z,Y,He,se,W,hs,De,j,Xe,me,he,n,ce,ne]),ys=(()=>{if(me)return{show:!1,disabled:!0,loading:!1,text:""};if(2===D&&Ae)return{show:!1,disabled:!0,loading:!1,text:""};if(3===D)return{show:!0,disabled:!xe?.canFinalize,loading:!1,text:"Finalize"};if(0===D&&!xs){const e=[];if(G.employeeId)if(G.categoryId){if(!G.incidentLocation||G.incidentLocation.length<3)e.push("Add location");else if(!G.incidentDescription||G.incidentDescription.length<20){const s=G.incidentDescription?.trim().split(/\s+/).filter(e=>e.length>0)||[],a=Math.max(0,20-s.length);e.push(`Add ${a} more word${1===a?"":"s"}`)}}else e.push("Choose category");else e.push("Select employee");return{show:!0,disabled:!0,loading:!1,text:e.length>0?`Next - ${e[0]}`:"Next"}}return 0===D&&xs&&(ve||W)?{show:!0,disabled:!0,loading:!0,text:Se[ke]||"Analyzing..."}:{show:!0,disabled:!xs,loading:!1,text:"Next"}})();return p.useMemo(()=>({formData:G,signatures:De,lraRecommendation:se,selectedEmployee:qe,selectedCategory:Ue,organizationId:v?.id,currentStep:D,isStepValid:xs,isAnalyzing:W,warningHistory:Z,finalWarningId:te}),[G,De,se,qe,Ue,v?.id,D,xs,W,Z,te]),p.useEffect(()=>()=>{j.forceCleanup(),document.body.classList.remove("modal-open")},[]),T&&!E?s.jsx(es,{onPermissionGranted:N,onPermissionDenied:k,organizationName:i,managerName:r}):s.jsx("div",{className:`\n    modal-system\n    ${d?"modal-system--fullscreen":""}\n    ${V.isLegacyDevice?"legacy-device":""}\n    ${V.hasGoodPerformance?"perf-high":"perf-low"}\n    ${V.hasModernCSS?"css-modern":"css-legacy"}\n  `,children:s.jsxs("div",{className:`\n      modal-container\n      ${d?"modal-container--fullscreen":""}\n      ${V.browserInfo.isAndroid4x?"android-4x":""}\n      ${V.browserInfo.isIOS6to7?"ios-6-7":""}\n    `,children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("div",{className:"modal-header__left",children:s.jsxs("div",{children:[s.jsx("h2",{className:"modal-header__title",children:"Issue Warning"}),s.jsx("p",{className:"modal-header__subtitle",children:"Document disciplinary action and intervention"})]})}),s.jsx("button",{onClick:Ze,className:"modal-header__close-button",title:"Cancel and close wizard",children:s.jsx(I,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"modal-header__center",children:[s.jsx("div",{className:"modal-header__progress-mobile md:hidden",children:s.jsxs("div",{className:"mobile-step-indicator",children:[s.jsxs("div",{className:"mobile-step-dots",children:[Object.entries(gs).map(([e,a])=>{const t=parseInt(e),r=t===D,i=_.has(t);return s.jsx("div",{className:`mobile-step-dot ${r?"mobile-step-dot--active":""} ${i?"mobile-step-dot--completed":""} ${r||i?"":"mobile-step-dot--inactive"}`,title:a.title,children:i?s.jsx(H,{className:"w-3 h-3"}):t+1},e)}),j.isRecording&&s.jsx("div",{className:"mobile-recording-indicator",children:s.jsx("div",{className:"mobile-recording-dot-pulse"})})]}),s.jsx("div",{className:"mobile-step-info",children:s.jsx("div",{className:"mobile-step-title",children:gs[D]?.title||"Loading..."})})]})}),s.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Object.entries(gs).map(([e,a])=>{const t=parseInt(e),r=t===D,i=_.has(t);return s.jsxs("div",{className:"step-container",children:[s.jsx("div",{className:`\n                step-dot\n                ${r?"step-dot--active":""}\n                ${i?"step-dot--completed":""}\n                ${r||i?"":"step-dot--inactive"}\n              `,title:a.title,children:i?s.jsx(H,{className:"w-3 h-3"}):t+1}),t<Math.max(...Object.keys(gs).map(Number))&&s.jsx("div",{className:`\n                step-connector\n                ${i?"step-connector--completed":"step-connector--inactive"}\n              `})]},e)})})]}),s.jsx("div",{className:"modal-content",children:s.jsx("div",{className:"modal-content__scrollable step-transition",children:ps()},D)}),s.jsx("div",{className:"modal-footer",children:!me&&s.jsx("div",{className:"modal-footer__nav",children:3===D&&te?s.jsxs("button",{onClick:Xe,className:"modal-footer__button modal-footer__button--primary w-full",children:[s.jsx(U,{className:"w-4 h-4"}),"Close"]}):s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:ms,disabled:0===D||ve,className:`\n                    modal-footer__button modal-footer__button--secondary\n                    ${0===D||ve?"opacity-50":""}\n                  `,children:[s.jsx(ye,{className:"w-4 h-4"}),"Previous"]}),ys.show&&s.jsxs("button",{onClick:Je,disabled:ys.disabled,className:`\n                      modal-footer__button modal-footer__button--primary\n                      ${ys.loading?"modal-footer__button--loading":""}\n                    `,children:[!ys.loading&&ys.text,s.jsx(O,{className:"w-4 h-4"})]})]})})})]})})},(e,s)=>e.currentManagerName===s.currentManagerName&&e.organizationName===s.organizationName&&e.preSelectedEmployeeId===s.preSelectedEmployeeId&&e.preSelectedCategoryId===s.preSelectedCategoryId&&e.isFullScreen===s.isFullScreen&&(e.employees.length===s.employees.length&&e.categories.length===s.categories.length));export{hs as EnhancedWarningWizard};
