import{a as e}from"./pdf-vendor-tUwojRr6.js";import{w as t,P as i,L as o}from"./business-owner-dashboard-Cigg9BdB.js";import"./react-vendor-CWjEGAcE.js";import"./firebase-vendor-Cc210LOb.js";import"./ui-vendor-B2Ap5xvl.js";class n{static async generateWarningPDF(n){try{const a=t||{isLegacyDevice:!1};i(a);if(a.isLegacyDevice)return o.warn("🚨 Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(n);n.employee,n.organization,!n.description&&n.incidentLocation,n.employee&&(n.employee.firstName,n.employee.lastName),n.organization,n.warningLevel,n.category;Date.now();const{default:s}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),r=new s({orientation:"portrait",unit:"mm",format:"a4",compress:!0});o.success(3579),r.setFont("helvetica","normal");let l=15;const c=r.internal.pageSize.width,d=r.internal.pageSize.height,m=20,g=40;l=this.addOrganizationHeader(r,n.organization,l,c,m),o.success(4172),l=this.addDocumentTitle(r,n,l,c,m,d,g),o.success(4459),l=this.addEmployeeSection(r,n.employee,l,c,m,d,g),o.success(4759),l=this.addWarningDetailsSection(r,n,l,c,m,d,g),o.success(5060),l=this.addIncidentDetailsSection(r,n,l,c,m,d,g),o.success(5387),n.disciplineRecommendation&&(l=this.addProgressiveDisciplineSection(r,n.disciplineRecommendation,l,c,m,d,g),o.success(5796)),n.legalCompliance&&(l=this.addLegalComplianceSection(r,n.legalCompliance,l,c,m,d,g),o.success(6262)),n.additionalNotes&&(l=this.addAdditionalNotesSection(r,n.additionalNotes,l,c,m,d,g),o.success(6716)),l=this.addSignaturesSection(r,n.signatures,n.employee,l,c,m,d,g),o.success(7166),n.deliveryChoice&&(l=this.addDeliverySection(r,n.deliveryChoice,l,c,m,d,g),o.success(7512)),this.addDocumentFooter(r,n,c),o.success(7804),this.addSecurityWatermark(r,c),o.success(7997);const h=r.output("blob");Date.now();return n.warningId,n.employee.firstName,n.employee.lastName,(h.size/1024).toFixed(1),h}catch(a){throw o.error("❌ PDF generation failed:",a),new Error(`PDF generation failed: ${a instanceof Error?a.message:"Unknown error"}`)}}static addOrganizationHeader(e,t,i,n,a){const s=this.parseColor(t.branding?.colors?.primary)||{r:59,g:130,b:246};e.setFillColor(s.r,s.g,s.b),e.rect(0,0,n,35,"F");let r=0;if(t.branding?.logo)try{const i=20;r=30,e.addImage(t.branding.logo,"PNG",a,7,r,i)}catch(d){o.warn("Failed to add organization logo to PDF:",d),r=0}e.setTextColor(255,255,255),e.setFontSize(20),e.setFont("helvetica","bold");const l=t.branding?.companyName||t.name||"Organization Name";e.text(l,a+r+(r>0?10:0),15),e.setFontSize(10),e.setFont("helvetica","normal");const c=[];return t.address&&c.push(t.address),t.phone&&c.push(`Tel: ${t.phone}`),t.email&&c.push(`Email: ${t.email}`),c.length>0&&e.text(c.join(" | "),a,25),t.registrationNumber&&e.text(`Registration: ${t.registrationNumber}`,a,30),45}static addDocumentTitle(e,t,i,o,n,a,s){i=this.checkPageOverflow(e,i,30,a,s),e.setTextColor(0,0,0),e.setFontSize(18),e.setFont("helvetica","bold");const r=this.getWarningLevelTitle(t.warningLevel),l=e.getTextWidth(r),c=(o-l)/2;e.text(r,c,i);if("Employee"===t.employee?.firstName||"Category Not Selected"===t.category||!t.description?.trim()){e.setFontSize(12),e.setTextColor(200,50,50);const t="[DRAFT - INCOMPLETE DATA]",n=(o-e.getTextWidth(t))/2;e.text(t,n,i+6),i+=6}e.setTextColor(0,0,0),e.setLineWidth(.5),e.line(c,i+2,c+l,i+2),e.setFontSize(10),e.setFont("helvetica","normal");const d=`Document ID: ${t.warningId} | Issue Date: ${this.formatDate(t.issuedDate)}`,m=(o-e.getTextWidth(d))/2;return e.text(d,m,i+8),i+20}static addEmployeeSection(e,t,i,o,n,a,s){i=this.checkPageOverflow(e,i,40,a,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("EMPLOYEE INFORMATION",n,i);const r="Employee"===t.firstName||"Not Selected"===t.lastName;r?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(n,i+2,o-2*n,25),r&&(e.setFillColor(255,245,245),e.rect(n+1,i+3,o-2*n-2,23,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),r?e.setTextColor(150,0,0):e.setTextColor(0,0,0);const l=[`Name: ${t.firstName} ${t.lastName}`,`Employee ID: ${t.employeeNumber}`,`Position: ${t.position}`,`Department: ${t.department}`];t.email&&""!==t.email&&l.push(`Email: ${t.email}`),r&&l.push("⚠️ Complete employee selection in wizard for full details");let c=i+8;return l.forEach(t=>{e.text(t,n+3,c),c+=4}),i+35}static addWarningDetailsSection(e,t,i,o,n,a,s){i=this.checkPageOverflow(e,i,25,a,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("WARNING DETAILS",n,i);const r="Category Not Selected"===t.category;e.setFontSize(10),e.setFont("helvetica","normal"),r?e.setTextColor(150,0,0):e.setTextColor(0,0,0);let l=i+8;e.text(`Warning Level: ${this.getWarningLevelDisplay(t.warningLevel)}`,n,l),l+=5;const c=t.category&&"Unknown"!==t.category&&"Category Not Selected"!==t.category?t.category:"General Misconduct";return e.text(`Category: ${c}`,n,l),l+=5,t.validityPeriod&&(e.text(`Validity Period: ${t.validityPeriod} months`,n,l),l+=5),l+5}static addIncidentDetailsSection(e,t,i,o,n,a,s){const r=this.calculateIncidentSectionHeight(e,t,o,n);i=this.checkPageOverflow(e,i,r,a,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("INCIDENT DETAILS",n,i);const l=t.description&&""!==t.description.trim(),c=t.incidentLocation&&""!==t.incidentLocation.trim(),d=!l&&!c,m=this.calculateIncidentSectionHeight(e,t,o,n);d?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(n,i+2,o-2*n,m),d&&(e.setFillColor(255,245,245),e.rect(n+1,i+3,o-2*n-2,m-2,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let g=i+10;e.setFont("helvetica","bold"),e.text("Date & Time:",n+3,g),e.setFont("helvetica","normal"),e.text(`${this.formatDate(t.incidentDate)} at ${t.incidentTime}`,n+30,g),g+=6,e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Location:",n+3,g),e.setFont("helvetica","normal");const h=c?t.incidentLocation:"Not specified";e.text(h,n+25,g),g+=6,e.setFont("helvetica","bold"),e.text("Description:",n+3,g),g+=5,e.setFont("helvetica","normal");const _=l?t.description:"Details to be completed";return this.wrapText(e,_,o-2*n-6).forEach(t=>{e.text(t,n+3,g),g+=4}),i+m+10}static addProgressiveDisciplineSection(e,t,i,o,n,a,s){if(!t)return i;i=this.checkPageOverflow(e,i,35,a,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("PROGRESSIVE DISCIPLINE ANALYSIS",n,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=i+8;if(e.text(`Recommended Level: ${this.getWarningLevelDisplay(t.suggestedLevel)}`,n,r),r+=5,e.text(`Previous Warnings: ${t.warningCount}`,n,r),r+=5,t.reason){e.text("Escalation Reason:",n,r),r+=4;this.wrapText(e,t.reason,o-2*n).forEach(t=>{e.text(t,n+3,r),r+=4})}return r+5}static addLegalComplianceSection(e,t,i,o,n,a,s){if(!t)return i;i=this.checkPageOverflow(e,i,30,a,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("LEGAL COMPLIANCE",n,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=i+8;return e.text(`Framework: ${t.framework}`,n,r),r+=5,e.text("Compliance Status: "+(t.isCompliant?"COMPLIANT":"NON-COMPLIANT"),n,r),r+=5,t.requirements.length>0&&(e.text("Legal Requirements:",n,r),r+=4,t.requirements.forEach(t=>{e.text(`• ${t}`,n+3,r),r+=4})),r+5}static addAdditionalNotesSection(e,t,i,o,n,a,s){const r=this.wrapText(e,t,o-2*n),l=15+4*r.length;i=this.checkPageOverflow(e,i,l,a,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("ADDITIONAL NOTES",n,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=i+8;return r.forEach(t=>{e.text(t,n,c),c+=4}),c+5}static addSignaturesSection(e,t,i,n,a,s,r,l){n=this.checkPageOverflow(e,n,50,r,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("SIGNATURES",s,n);const c=(a-3*s)/2;if(e.setDrawColor(150,150,150),e.setLineWidth(.3),e.rect(s,n+5,c,30),e.setFontSize(10),e.setFont("helvetica","normal"),e.text("Manager Signature:",s+2,n+12),t?.manager)try{const i=c-4,o=15;e.addImage(t.manager,"PNG",s+2,n+15,i,o),e.setFontSize(8),e.text(`Date: ${this.formatDate(new Date)}`,s+2,n+32)}catch(d){o.warn("Failed to embed manager signature image:",d),e.setFontSize(8),e.text("✓ Digitally Signed",s+2,n+20),e.text(`Date: ${this.formatDate(new Date)}`,s+2,n+25)}else e.text("_________________________",s+2,n+25),e.text("Date: ___________",s+2,n+30);if(e.rect(s+c+10,n+5,c,30),e.text("Employee Signature:",s+c+12,n+12),e.text(`${i.firstName} ${i.lastName}`,s+c+12,n+16),t?.employee)try{const i=c-4,o=15;e.addImage(t.employee,"PNG",s+c+12,n+15,i,o),e.setFontSize(8),e.text(`Date: ${this.formatDate(new Date)}`,s+c+12,n+32)}catch(d){o.warn("Failed to embed employee signature image:",d),e.setFontSize(8),e.text("✓ Digitally Signed",s+c+12,n+20),e.text(`Date: ${this.formatDate(new Date)}`,s+c+12,n+25)}else e.text("_________________________",s+c+12,n+25),e.text("Date: ___________",s+c+12,n+30);return n+30+15}static addDeliverySection(e,t,i,o,n,a,s){if(!t)return i;i=this.checkPageOverflow(e,i,20,a,s),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("DELIVERY INFORMATION",n,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=i+6;return e.text(`Delivery Method: ${t.method.toUpperCase()}`,n,r),r+=4,e.text(`Delivery Date: ${this.formatDate(t.timestamp)}`,n,r),r+=4,e.text(`Authorized by: ${t.chosenBy}`,n,r),r+8}static addDocumentFooter(e,t,i){const o=e.internal.pageSize.height,n=e.getNumberOfPages();for(let a=1;a<=n;a++){e.setPage(a),e.setDrawColor(180,180,180),e.setLineWidth(.3),e.line(20,o-25,i-20,o-25),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(120,120,120);const t="This document has been generated electronically and constitutes an official warning as per LRA Section 188.",s=(i-e.getTextWidth(t))/2;e.text(t,s,o-20);const r="CONFIDENTIAL DOCUMENT - For authorized personnel only",l=(i-e.getTextWidth(r))/2;e.text(r,l,o-15),e.text(`Generated: ${(new Date).toLocaleString()}`,20,o-10),e.text(`Page ${a} of ${n}`,i-50,o-10)}}static addSecurityWatermark(e,t){const i=e.internal.pageSize.height,o=e.getNumberOfPages();for(let n=1;n<=o;n++){e.setPage(n),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.1})),e.setTextColor(150,150,150),e.setFontSize(40),e.setFont("helvetica","bold");const o=t/2,a=i/2;e.text("OFFICIAL WARNING",o,a,{angle:45,align:"center"}),e.restoreGraphicsState()}}static checkPageOverflow(e,t,i,o,n){return t+i>o-n?(e.addPage(),20):t}static addPageHeader(e,t,i){const o=e.internal.pageSize.width;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const n=`${t.organization.name} - Warning Document (Continued)`;e.text(n,20,10);const a=`Page ${i}`;e.text(a,o-40,10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(20,12,o-20,12)}static getWarningLevelDisplay(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"}[e]||e.replace("_"," ").toUpperCase()}static getWarningLevelTitle(e){return{counselling:"COUNSELLING SESSION RECORD",verbal:"VERBAL WARNING NOTICE",first_written:"FIRST WRITTEN WARNING",second_written:"SECOND WRITTEN WARNING",final_written:"FINAL WRITTEN WARNING",suspension:"SUSPENSION NOTICE",dismissal:"DISMISSAL NOTICE"}[e]||"WARNING NOTICE"}static formatDate(e){return e.toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})}static wrapText(e,t,i){const o=t.split(" "),n=[];let a="";return o.forEach(t=>{const o=a+(a?" ":"")+t;e.getTextWidth(o)<=i?a=o:(a&&n.push(a),a=t)}),a&&n.push(a),n}static calculateIncidentSectionHeight(e,t,i,o){let n=25;const a=t.description&&""!==t.description.trim()?t.description:"[Incident description not provided - complete in wizard]";n+=4*this.wrapText(e,a,i-2*o-6).length;const s=t.description&&""!==t.description.trim(),r=t.incidentLocation&&""!==t.incidentLocation.trim();return!s&&!r&&(n+=10),Math.max(n,45)}static parseColor(e){if(!e)return null;if(e.startsWith("#")){const t=e.substring(1);if(6===t.length)return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}return null}static async generateSimplifiedPDF(t){try{const{default:i}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),o=new i({orientation:"portrait",unit:"mm",format:"a4",compress:!0});let n=20;const a=15,s=6;o.setFont("helvetica","normal"),o.setFontSize(16),o.text("DISCIPLINARY WARNING",a,n),n+=2*s,o.setFontSize(12),t.organization?.name&&(o.text(`Organization: ${t.organization.name}`,a,n),n+=s),n+=s,o.setFontSize(11),o.text("EMPLOYEE DETAILS:",a,n),n+=s,o.setFontSize(10);[`Name: ${t.employee.firstName} ${t.employee.lastName}`,`Employee ID: ${t.employee.employeeNumber}`,`Department: ${t.employee.department}`,`Position: ${t.employee.position}`].forEach(e=>{o.text(e,a+5,n),n+=s}),n+=s,o.setFontSize(11),o.text("WARNING DETAILS:",a,n),n+=s,o.setFontSize(10);[`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,`Location: ${t.incidentLocation||"Not specified"}`].forEach(e=>{o.text(e,a+5,n),n+=s}),n+=s,o.setFontSize(11),o.text("INCIDENT DESCRIPTION:",a,n),n+=s,o.setFontSize(10);const r=170;o.splitTextToSize(t.description,r).forEach(e=>{n>270&&(o.addPage(),n=20),o.text(e,a+5,n),n+=s}),n+=2*s,n>240&&(o.addPage(),n=20),o.setFontSize(11),o.text("SIGNATURES:",a,n),n+=2*s,o.setFontSize(10),o.text("Manager: ________________________",a,n),n+=s,o.text(`Date: ${t.issuedDate.toLocaleDateString()}`,a,n),n+=3*s,o.text("Employee: _______________________ ",a,n),n+=s,o.text("Date: _______________",a,n);const l=o.internal.pageSize.height;o.setFontSize(8),o.text("Generated by HR System - Simplified for mobile device",a,l-10);const c=o.output("blob");return window.gc&&setTimeout(()=>window.gc(),100),c}catch(i){return o.error("❌ Simplified PDF generation failed:",i),this.generatePlainTextPDF(t)}}static async generatePlainTextPDF(t){try{const{default:i}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),o=new i;o.setFontSize(12);let n=20;const a=10;return["DISCIPLINARY WARNING","",`Employee: ${t.employee.firstName} ${t.employee.lastName}`,`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,"","Description:",t.description,"","This is a simplified version generated for older devices."].forEach(e=>{n>280&&(o.addPage(),n=20),o.text(e,20,n),n+=a}),o.output("blob")}catch(i){throw o.error("❌ Even plain text PDF failed:",i),new Error("PDF generation not supported on this device")}}}export{n as PDFGenerationService};
