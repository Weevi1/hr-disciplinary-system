import{d as e,L as r}from"./business-owner-dashboard-Bj9FFBk6.js";import{l as a,q as i,w as t,m as n,p as s,x as o}from"./firebase-vendor-CkRVjyOf.js";import"./react-vendor-CWjEGAcE.js";import"./pdf-vendor-tUwojRr6.js";import"./ui-vendor-CHg7YHN-.js";const l=[{event:"warning_needs_delivery",roles:["hr-manager","business-owner"],priority:"warning",title:"Warning Delivery Required",messageTemplate:"Warning for {{employeeName}} ({{warningLevel}}) needs delivery via {{deliveryMethod}}",category:"delivery",actions:[{label:"View Warning",action:"view_warning",variant:"primary"},{label:"Start Delivery",action:"start_delivery",variant:"secondary"}]},{event:"absence_report_submitted",roles:["hr-manager","business-owner"],priority:"info",title:"New Absence Report",messageTemplate:"{{employeeName}} absence report submitted by {{managerName}} - requires HR review",category:"hr_review",actions:[{label:"Review Report",action:"review_absence",variant:"primary"}]},{event:"hr_meeting_requested",roles:["hr-manager","business-owner"],priority:"info",title:"HR Meeting Request",messageTemplate:"{{managerName}} requested HR meeting for {{employeeName}} - {{reason}}",category:"meetings",actions:[{label:"Schedule Meeting",action:"schedule_meeting",variant:"primary"},{label:"View Details",action:"view_request",variant:"secondary"}]},{event:"warning_needs_delivery",roles:["hr-manager","business-owner"],priority:"high",title:"Warning Needs Delivery",messageTemplate:"New {{warningLevel}} warning for {{employeeName}} requires delivery via {{deliveryMethod}}",category:"delivery",actions:[{label:"Process Delivery",action:"process_delivery",variant:"primary"},{label:"View Warning",action:"view_warning",variant:"secondary"}]},{event:"warning_approaching_expiry",roles:["hod-manager","department-manager"],priority:"warning",title:"Warning Expiring Soon",messageTemplate:"{{employeeName}} warning expires in {{daysRemaining}} days - consider follow-up action",category:"follow_up"},{event:"employee_absence_alert",roles:["hod-manager","department-manager"],priority:"info",title:"Employee Absence Alert",messageTemplate:"{{employeeName}} has been absent for {{consecutiveDays}} consecutive days",category:"absence"},{event:"warning_delivered_confirmation",roles:["hod-manager","department-manager"],priority:"success",title:"Warning Delivered",messageTemplate:"Warning for {{employeeName}} has been successfully delivered via {{deliveryMethod}}",category:"confirmation"},{event:"high_severity_warning",roles:["business-owner"],priority:"error",title:"High Severity Warning Issued",messageTemplate:"{{warningLevel}} warning issued to {{employeeName}} - immediate attention required",category:"escalation",actions:[{label:"Review Case",action:"review_case",variant:"danger"}]},{event:"compliance_deadline",roles:["business-owner","hr-manager"],priority:"warning",title:"Compliance Deadline Approaching",messageTemplate:"{{complianceType}} deadline in {{daysRemaining}} days for {{organizationName}}",category:"compliance"},{event:"monthly_report_ready",roles:["business-owner"],priority:"info",title:"Monthly HR Report Available",messageTemplate:"HR disciplinary report for {{monthYear}} is now available for review",category:"reports",actions:[{label:"View Report",action:"view_report",variant:"primary"}]},{event:"system_error",roles:["super-user"],priority:"error",title:"System Error Detected",messageTemplate:"{{errorType}} error in organization {{organizationName}} - {{errorDetails}}",category:"system"},{event:"organization_deployment",roles:["super-user"],priority:"info",title:"Organization Deployment Status",messageTemplate:"Organization {{organizationName}} deployment {{status}} - {{details}}",category:"deployment"},{event:"user_account_issue",roles:["super-user"],priority:"warning",title:"User Account Issue",messageTemplate:"Account issue for {{userName}} in {{organizationName}} - {{issueType}}",category:"user_management"}];class c{static async sendRoleBasedNotification(c,m,d){try{const g=l.find(e=>e.event===m);if(!g)return r.warn(`📭 No notification rule found for event: ${m}`),0;const y=this.processMessageTemplate(g.messageTemplate,d);g.roles;const p=await(async(l,c,m,d,g,y)=>{try{const r=a(e,"users"),p=i(r,t("organizationId","==",l),t("role","in",c)),u=(await n(p)).docs.map(e=>({userId:e.id,organizationId:l,type:m,title:d,message:g,read:!1,timestamp:s(),data:y||{}})),v=a(e,"notifications"),w=u.map(e=>o(v,e));return await Promise.all(w),u.length}catch(p){throw r.error("Error creating bulk notifications:",p),p}})(c,g.roles,g.priority,g.title,y,{event:m,category:g.category,actions:g.actions,...d});return r.success(6887),p}catch(g){throw r.error(`❌ Failed to send role-based notification for event: ${m}`,g),g}}static async sendUserNotification(i,t,n,l,c,m){try{const d=t.map(e=>({userId:e,organizationId:i,type:n,title:l,message:c,read:!1,timestamp:s(),data:m||{}})),g=a(e,"notifications"),y=d.map(e=>o(g,e));await Promise.all(y),r.success(7892)}catch(d){throw r.error("❌ Failed to send user notifications:",d),d}}static async sendSystemNotification(s,o,l,c,m){try{const d=a(e,"users"),g=i(d,t("organizationId","==",s)),y=(await n(g)).docs.map(e=>e.id);await this.sendUserNotification(s,y,o,l,c,m),r.success(8803)}catch(d){throw r.error("❌ Failed to send system notification:",d),d}}static getNotificationRulesForRole(e){return l.filter(r=>r.roles.includes(e))}static getAvailableEvents(){return l.map(e=>e.event)}static processMessageTemplate(e,r){let a=e;for(const[i,t]of Object.entries(r)){const e=`{{${i}}}`;a=a.replace(new RegExp(e,"g"),String(t))}return a}static determinePriority(e,r){if(e)switch(e.toLowerCase()){case"dismissal":case"suspension":return"error";case"final_written":case"final written warning":return"warning";default:return"info"}if(r)switch(r.toLowerCase()){case"critical":case"urgent":return"error";case"high":return"warning";default:return"info"}return"info"}}class m{static async warningNeedsDelivery(e,r,a,i){return c.sendRoleBasedNotification(e,"warning_needs_delivery",{employeeName:r,warningLevel:a,deliveryMethod:i})}static async absenceReportSubmitted(e,r,a){return c.sendRoleBasedNotification(e,"absence_report_submitted",{employeeName:r,managerName:a})}static async hrMeetingRequested(e,r,a,i){return c.sendRoleBasedNotification(e,"hr_meeting_requested",{managerName:r,employeeName:a,reason:i})}static async warningApproachingExpiry(e,r,a){return c.sendRoleBasedNotification(e,"warning_approaching_expiry",{employeeName:r,daysRemaining:a})}static async warningDeliveredConfirmation(e,r,a){return c.sendRoleBasedNotification(e,"warning_delivered_confirmation",{employeeName:r,deliveryMethod:a})}static async highSeverityWarning(e,r,a){return c.sendRoleBasedNotification(e,"high_severity_warning",{employeeName:r,warningLevel:a})}static async monthlyReportReady(e,r){return c.sendRoleBasedNotification(e,"monthly_report_ready",{monthYear:r})}static async systemError(e,r,a,i){return c.sendRoleBasedNotification(e,"system_error",{organizationName:r,errorType:a,errorDetails:i})}}export{c as NotificationDeliveryService,m as QuickNotifications};
