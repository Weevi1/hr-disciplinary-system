import{a as e,p as s,z as a,N as t,q as r,A as i,L as l,j as o,f as n,o as d,g as c}from"./business-owner-dashboard-Dq6MrEKt.js";import{r as m}from"./react-vendor-BMk1H4su.js";import{T as p,g as x}from"./ui-vendor-Bx41JZPX.js";import"./pdf-vendor-CbrIsI36.js";import"./firebase-vendor-BIBOIkWK.js";const y=({employees:y,className:f=""})=>{const{organization:g}=e(),[h,v]=m.useState([]),[j,u]=m.useState(!1),[w,N]=m.useState(!1),D=m.useCallback(async()=>{if(g?.id&&!j){u(!0);try{let e;if(s()&&a()){e=(await t.getActiveWarningsIndex(g.id,100)).filter(e=>"high"===e.priority).map(e=>({...e.metadata,id:e.id,employeeId:e.employeeId,level:e.metadata.level,employeeName:e.metadata.employeeName}))}else if(s()&&r()){e=(await t.getOrganizationWarnings(g.id,{level:"final_written"},{pageSize:100,orderField:"issueDate",orderDirection:"desc"})).warnings}else e=await i.warnings.getAll(g.id);let l=e.filter(e=>"final_written"===e.level);if(y&&y.length>0){const e=new Set(y.map(e=>e.id));l=l.filter(s=>e.has(s.employeeId))}const o=await i.employees.getAll(g.id),n=l.map(e=>{const s=o.find(s=>s.id===e.employeeId);return{...e,employeeName:s?.name||`${s?.profile?.firstName||""} ${s?.profile?.lastName||""}`.trim()||"Unknown",employee:s}});n.sort((e,s)=>new Date(s.issueDate).getTime()-new Date(e.issueDate).getTime()),v(n)}catch(e){l.error("Failed to fetch final warning employees:",e)}finally{u(!1)}}},[g?.id,y]);return m.useEffect(()=>{g?.id&&D()},[g?.id,D]),j||0!==h.length?j?o.jsx(n,{padding:"md",className:f,children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:"var(--color-primary)"}}),o.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Loading final warnings watch list..."})]})}):o.jsxs(d,{variant:"error",className:`border-2 ${f}`,children:[o.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>N(!w),children:[o.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[o.jsx(p,{className:"w-4 h-4"}),"Final Warnings Watch List (",h.length,")",o.jsx(c,{variant:"error",size:"sm",className:"animate-pulse hidden sm:inline-block",children:"MONITOR CLOSELY"})]}),o.jsx(x,{className:"w-4 h-4 transition-transform "+(w?"rotate-180":""),style:{color:"var(--color-alert-error-text)"}})]}),w&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"space-y-1.5 mt-3",children:h.map(e=>{let s,a;s=e.issueDate?.toDate?e.issueDate.toDate():e.issueDate?.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),a=e.expiryDate?.toDate?e.expiryDate.toDate():e.expiryDate?.seconds?new Date(1e3*e.expiryDate.seconds):new Date(e.expiryDate);const t=Math.floor((Date.now()-s.getTime())/864e5),r=Math.floor((a.getTime()-Date.now())/864e5);return o.jsx(n,{padding:"md",className:"border-2",style:{borderColor:"var(--color-alert-error-border)"},children:o.jsx("div",{className:"flex items-center justify-between",children:o.jsxs("div",{className:"flex-1",children:[o.jsx("div",{className:"font-medium",style:{color:"var(--color-alert-error-text)"},children:e.employeeName}),o.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)",opacity:.8},children:[e.category," ‚Ä¢ ",t," days ago"]}),o.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-alert-error-text)"},children:["‚ö†Ô∏è Next offense requires HR intervention ‚Ä¢ Expires in ",r," days"]})]})})},e.id||`${e.employeeId}-${e.categoryId||e.category}-${s.getTime()}`)})}),o.jsx(n,{padding:"sm",className:"mt-3",style:{backgroundColor:"var(--color-alert-error-bg)",opacity:.7},children:o.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)"},children:["üí° ",o.jsx("strong",{children:"Tip:"})," Monitor these employees closely. Any new offenses will trigger urgent HR intervention alerts."]})})]})]}):null};export{y as FinalWarningsWatchList};
