const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dashboard-router-DriKLXjX.js","assets/business-owner-dashboard-Cw2S2b3C.js","assets/pdf-vendor-CbrIsI36.js","assets/react-vendor-BMk1H4su.js","assets/firebase-vendor-BIBOIkWK.js","assets/ui-vendor-DjDr2yFV.js","assets/hr-dashboard-DCNKcWEX.js","assets/hod-dashboard-BWpKy7JX.js","assets/warning-components-D4Kh8JfB.js"])))=>i.map(i=>d[i]);
import{a as e}from"./pdf-vendor-CbrIsI36.js";import{j as a,T as s,v as r,g as t,f as i,w as o,x as n,y as l,L as c,i as d,s as m,d as u,o as h,u as g,a as x,A as p}from"./business-owner-dashboard-Cw2S2b3C.js";import{r as y,R as v,d as w}from"./react-vendor-BMk1H4su.js";import{E as b,G as f,H as k,x as j,l as N,p as C,j as S,u as z}from"./firebase-vendor-BIBOIkWK.js";import{I as R,i as I,s as D,C as T,ah as E,g as L,X as P,Q as $,c as A,S as q,aG as F,at as M,d as W,T as _,F as U,n as B,p as H,aH as O,aI as G,aa as Q,aJ as V,U as Y,h as X,R as K,aK as Z,a8 as J,aL as ee,aM as ae,ao as se,y as re,l as te,aN as ie,t as oe,aO as ne,an as le,J as ce,aP as de,aw as me,O as ue}from"./ui-vendor-DjDr2yFV.js";import{C as he}from"./CustomDatePicker-BAurchyo.js";import{b as ge,u as xe,c as pe,P as ye}from"./dashboard-router-DriKLXjX.js";import{P as ve}from"./warning-components-D4Kh8JfB.js";import"./hr-dashboard-DCNKcWEX.js";import"./hod-dashboard-BWpKy7JX.js";const we=({currentPhase:e,totalPhases:s,completedPhases:r,onPhaseClick:t})=>{const i=(e+1)/s*100;return a.jsx("div",{className:"mb-3",children:a.jsx("div",{className:"h-1 rounded-full overflow-hidden",style:{backgroundColor:"var(--color-border-light)"},children:a.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${i}%`,backgroundColor:"var(--color-primary)"}})})})},be=({title:e,icon:s,phaseNumber:r,totalPhases:t,employeeName:i,incidentDate:o})=>a.jsxs("div",{className:"mb-4",children:[(i||o)&&a.jsxs("div",{className:"flex items-center gap-3 text-xs mb-3 pb-3 border-b",style:{color:"var(--color-text-secondary)",borderColor:"var(--color-border)"},children:[i&&a.jsxs("span",{children:[a.jsx("strong",{children:"Employee:"})," ",i]}),o&&a.jsxs("span",{children:[a.jsx("strong",{children:"Date:"})," ",o]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsx(s,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:e}),a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Phase ",r," of ",t]})]})]})]}),fe=({children:e,variant:s="info"})=>{const r={info:{bg:"var(--color-alert-info-bg)",text:"var(--color-alert-info-text)",border:"var(--color-primary)"},tip:{bg:"var(--color-alert-success-bg)",text:"var(--color-alert-success-text)",border:"#10b981"},warning:{bg:"var(--color-alert-warning-bg)",text:"var(--color-alert-warning-text)",border:"#f59e0b"}}[s];return a.jsx("div",{className:"p-4 rounded-lg mb-4",style:{backgroundColor:r.bg,borderLeft:`3px solid ${r.border}`},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(R,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:r.border}}),a.jsx("div",{className:"text-sm",style:{color:r.text},children:e})]})})},ke=({currentPhase:e,totalPhases:r,isValid:t,isLoading:i=!1,onPrevious:o,onNext:n,customNextText:l,customNextIcon:c,showFinalize:d,onFinalize:m})=>{const u=e===r-1,h=0===e;return a.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",style:{borderColor:"var(--color-border)"},children:[a.jsx(s,{variant:"outline",onClick:o,disabled:h,icon:I,children:"Back"}),d&&m?a.jsx(s,{onClick:m,disabled:!t||i,loading:i,icon:D,children:"Finalize"}):a.jsx(s,{onClick:n,disabled:!t||i,loading:i,icon:c||(u?D:T),iconPosition:"right",children:l||(u?"Complete":"Continue")})]})},je=({employees:e,selectedEmployeeId:o,onEmployeeSelect:n,warningHistory:l=[],isLoadingWarningHistory:c=!1,disabled:d=!1,className:m=""})=>{const[u,h]=y.useState(""),[g,x]=y.useState(!1),[p,v]=y.useState(!1),[w,b]=y.useState(!1),f=(e,a)=>e[a]?String(e[a]):e.profile?.[a]?String(e.profile[a]):"position"===a&&e.employment?.position?String(e.employment.position):"department"===a&&e.profile?.department?String(e.profile.department):"",k=y.useMemo(()=>{if(!u.trim())return e;const a=u.toLowerCase();return e.filter(e=>{const s=`${f(e,"firstName")} ${f(e,"lastName")}`.toLowerCase(),r=e.id?.toLowerCase()||"",t=f(e,"department").toLowerCase();return s.includes(a)||r.includes(a)||t.includes(a)})},[e,u]),j=y.useMemo(()=>e.find(e=>e.id===o),[e,o]),N=y.useCallback(e=>{n(e),x(!1),v(!1),b(!1),h("")},[n]),C=y.useCallback(()=>{if(d)return;window.innerWidth<768?b(!0):v(!p)},[d,p]),S=y.useCallback(()=>{b(!1),h("")},[]);return a.jsxs("div",{className:`space-y-4 ${m}`,children:[a.jsx(r,{icon:E,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:a.jsx(t,{variant:"secondary",size:"sm",children:k.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(d?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:p?"var(--color-primary)":"var(--color-border)",boxShadow:p?"0 0 0 2px var(--color-primary-light)":void 0},onClick:C,children:j?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[f(j,"firstName").charAt(0),f(j,"lastName").charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[f(j,"firstName")," ",f(j,"lastName")]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[f(j,"position")," â€¢ ",f(j,"department")]})]})]}),a.jsx(L,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(L,{className:"w-4 h-4 transition-transform "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),p&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:k.length>0?a.jsx("div",{className:"py-2",children:k.map(e=>((e=>{e.riskIndicators&&e.riskIndicators.highRisk})(e),(e=>{if(!e.recentWarnings)return null;const{count:a,lastDate:s,level:r}=e.recentWarnings})(e),a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:a.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[f(e,"firstName")," ",f(e,"lastName")," - ",f(e,"position")]})},e.id)))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(E,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsxs("p",{children:['No employees found matching "',u,'"']})]})})]})]})}),w&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:S}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),a.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(P,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),a.jsx("div",{className:"mobile-category-list",children:k.length>0?a.jsx("div",{children:k.map(e=>a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:a.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[f(e,"firstName")," ",f(e,"lastName")," - ",f(e,"position")]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No employees found"}),u&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',u,'"']})]})})]})]}),j&&g&&a.jsxs(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),a.jsxs(s,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"flex items-center gap-1",children:[g?a.jsx($,{className:"w-4 h-4"}):a.jsx(L,{className:"w-4 h-4"}),g?"Hide":"Show"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["ðŸ“§ ",f(j,"email")||"No email",a.jsx("br",{}),"ðŸ“± ",f(j,"phone")||"No phone"]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[f(j,"position"),a.jsx("br",{}),f(j,"department")]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(A,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),a.jsx("span",{className:"font-medium text-gray-900",children:j.recentWarnings?.count||0})]}),j.recentWarnings?.lastDate&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),a.jsx("span",{className:"text-sm text-gray-900",children:new Date(j.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),j.riskIndicators&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),a.jsxs(t,{variant:j.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[a.jsx(q,{className:"w-4 h-4"}),j.riskIndicators.highRisk?"High Risk":"Low Risk"]}),j.riskIndicators.reasons.length>0&&a.jsx("div",{className:"mt-2",children:a.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:j.riskIndicators.reasons.slice(0,3).map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"text-amber-500 mt-0.5",children:"â€¢"}),e]},s))})})]})]})]})]})]})},Ne=({categories:e,selectedCategoryId:s,onCategorySelect:t,lraRecommendation:l,disabled:c=!1,className:d=""})=>{const[m,u]=y.useState(!1),[h,g]=y.useState(!1),[x,p]=y.useState(!1),[v,w]=y.useState(""),b=y.useMemo(()=>{if(!v.trim())return e;const a=v.toLowerCase();return e.filter(e=>{const s=e.name?.toLowerCase()||"",r=e.description?.toLowerCase()||"",t=e.severity?.toLowerCase()||"";return s.includes(a)||r.includes(a)||t.includes(a)})},[e,v]),f=y.useMemo(()=>e.find(e=>e.id===s),[e,s]),k=y.useCallback(e=>{t(e),u(!1),g(!1),p(!1),w("")},[t]),j=y.useCallback(()=>{if(c)return;window.innerWidth<768?p(!0):g(!h)},[c,h]),N=y.useCallback(()=>{p(!1),w("")},[]),C=y.useMemo(()=>f?f.escalationPath||o(f.id):[],[f]),S=y.useMemo(()=>l&&C.length?C.findIndex(e=>e===l.suggestedLevel):-1,[l,C]);return a.jsxs("div",{className:`space-y-4 ${d}`,children:[a.jsx(r,{icon:F,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:e.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(c?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:h?"var(--color-primary)":"var(--color-border)",boxShadow:h?"0 0 0 2px var(--color-primary-light)":void 0},onClick:j,children:f?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:f.name}),f.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:f.description})]})]}),a.jsx(L,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),a.jsx(L,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),h&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:b.length>0?a.jsx("div",{className:"py-2",children:b.map(e=>a.jsx("button",{onClick:()=>k(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.description})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(F,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{children:"No categories found"}),v&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',v,'"']})]})})]})]})}),x&&a.jsxs("div",{className:"mobile-category-modal",children:[a.jsx("div",{className:"mobile-category-modal-backdrop",onClick:N}),a.jsxs("div",{className:"mobile-category-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),a.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(P,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>w(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:b.length>0?a.jsx("div",{children:b.map(e=>a.jsxs("button",{onClick:()=>k(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:e.description})]})]},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No categories found"}),v&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',v,'"']})]})})]})]}),f&&m&&a.jsxs(i,{className:"rounded-xl p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),a.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[m?a.jsx($,{className:"w-4 h-4"}):a.jsx(L,{className:"w-4 h-4"}),m?"Hide":"Show"]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:(e=>{switch(e?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}})(f.severity),children:f.severity})]}),f.description&&a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:f.description})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),l?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(M,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:n(l.suggestedLevel)}),l.isEscalation&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l.reason})]}):a.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:C.map((e,s)=>{const r=s===S,t=S>=0&&s<S;return a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:r?"var(--color-badge-primary)":t?"var(--color-muted)":"var(--color-card-background)",borderColor:r?"var(--color-primary)":"var(--color-border)",color:r?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[r&&a.jsx(W,{className:"w-4 h-4"}),t&&a.jsx(_,{className:"w-4 h-4"}),a.jsx("span",{children:n(e)}),s<C.length-1&&a.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"â†’"})]},e)})}),l&&a.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(M,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",n(l.suggestedLevel)]}),a.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",l.categoryWarningCount??0," previous warning(s) in this category",l.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},Ce=({formData:e,onFormDataChange:s,disabled:t=!1,className:i=""})=>{const[o,n]=y.useState(!1),[c,d]=y.useState({}),[m,u]=y.useState({}),h=y.useMemo(()=>{const a=e.incidentDescription||"",s=a.trim().split(/\s+/).filter(e=>e.length>0).length,r=s>=6,t=[];return s<6&&t.push(`Add ${6-s} more word${6-s==1?"":"s"} for a complete description (minimum 6 words)`),!a.includes("when")&&!a.includes("time")&&s>=6&&t.push("Consider adding when the incident occurred"),!a.includes("where")&&!a.includes("location")&&s>=6&&t.push("Consider specifying where the incident took place"),!a.includes("what")&&!a.includes("action")&&s>=6&&t.push("Be specific about what actions were observed"),!a.includes("witness")&&s>10&&t.push("Were there any witnesses to mention?"),{wordCount:s,isMinimumMet:r,suggestions:t}},[e.incidentDescription]),g=y.useCallback((e,a)=>{switch(e){case"incidentDate":if(!a)return"Incident date is required";return new Date(a)>new Date?"Incident date cannot be in the future":null;case"incidentTime":if(!a)return"Incident time is required";return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(a)?null:"Please enter time in HH:MM format";case"incidentLocation":return!a||a.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":const e=a.trim().split(/\s+/).filter(e=>e.length>0).length;return 0===e?"Description is required":e<6?`Description must be at least 6 words (currently ${e} word${1===e?"":"s"})`:e>500?`Description is too long (maximum 500 words, currently ${e} words)`:null;default:return null}},[]),x=y.useCallback((e,a)=>{s({[e]:a}),u(a=>({...a,[e]:!0}));const r=g(e,a);d(a=>({...a,[e]:r}))},[s,g]);return(new Date).toISOString().split("T")[0],a.jsxs("div",{className:`space-y-4 ${i}`,children:[a.jsx(r,{icon:U,title:"Incident Details",subtitle:"Provide comprehensive details about the incident"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(he,{type:"date",label:"Incident Date",value:e.incidentDate||"",onChange:e=>x("incidentDate",e),icon:B,required:!0,disabled:t,error:c.incidentDate&&m.incidentDate?c.incidentDate:void 0}),a.jsx(he,{type:"time",label:"Incident Time",value:e.incidentTime||"",onChange:e=>x("incidentTime",e),icon:A,required:!0,disabled:t,error:c.incidentTime&&m.incidentTime?c.incidentTime:void 0})]}),a.jsx(l,{type:"text",label:"Incident Location",value:e.incidentLocation||"",onChange:e=>x("incidentLocation",e),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:H,required:!0,disabled:t,error:c.incidentLocation&&m.incidentLocation?c.incidentLocation:void 0}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[a.jsx(O,{className:"w-3 h-3 inline mr-1"}),"What Happened *"]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsxs("button",{type:"button",onClick:()=>n(!o),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-primary)"},children:[a.jsx(G,{className:"w-3 h-3"}),"Writing Tips"]}),a.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:h.isMinimumMet?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:h.isMinimumMet?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[h.wordCount," words"]})]})]}),a.jsx("textarea",{value:e.incidentDescription||"",onChange:e=>x("incidentDescription",e.target.value),placeholder:"Describe the incident: What did the employee do or fail to do? Include specific details like what was said, actions taken, who was present, and when/where it happened...",disabled:t,rows:6,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical "+(t?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:c.incidentDescription&&m.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:c.incidentDescription&&m.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),c.incidentDescription&&m.incidentDescription&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[a.jsx(_,{className:"w-3 h-3"}),c.incidentDescription]}),a.jsxs("div",{className:"flex items-start gap-1.5 text-xs p-2 rounded",style:{backgroundColor:"var(--color-alert-info-bg)",color:"var(--color-alert-info-text)"},children:[a.jsx(G,{className:"w-3.5 h-3.5 mt-0.5 flex-shrink-0"}),a.jsxs("span",{children:[a.jsx("strong",{children:"Tip:"})," Focus on describing what happened during the incident. In the next step, you'll explain why this warning level is appropriate."]})]}),o&&a.jsxs("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[a.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:"var(--color-alert-info-text)"},children:"Writing Assistance"}),a.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--color-alert-info-text)"},children:[h.suggestions.map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(G,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsx("span",{children:e})]},s)),0===h.suggestions.length&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-green-700",children:"Your description looks comprehensive!"})]})]})]})]})]})},Se=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],ze={en:{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},af:{counselling:"Beradingsessie",verbal:"Mondelinge Waarskuwing",first_written:"Eerste Geskrewe Waarskuwing",second_written:"Tweede Geskrewe Waarskuwing",final_written:"Finale Geskrewe Waarskuwing"},zu:{counselling:"Iseshini Yokweluleka",verbal:"Isexwayiso Ngomlomo",first_written:"Isexwayiso Sokuqala Esibhaliwe",second_written:"Isexwayiso Sesibili Esibhaliwe",final_written:"Isexwayiso Sokugcina Esibhaliwe"},xh:{counselling:"Iseshoni Yokucebisa",verbal:"Isilumkiso Ngomlomo",first_written:"Isilumkiso Sokuqala Esibhaliweyo",second_written:"Isilumkiso Sesibini Esibhaliweyo",final_written:"Isilumkiso Sokugqibela Esibhaliweyo"},st:{counselling:"Seboka sa Keletso",verbal:"Temoso ya Molomo",first_written:"Temoso ya Pele e Ngotsweng",second_written:"Temoso ya Bobedi e Ngotsweng",final_written:"Temoso ya ho Qetela e Ngotsweng"},ts:{counselling:"Nkarhi wo Tivonela",verbal:"Xilumkiso xa Marito",first_written:"Xilumkiso xa Sinthoma xa Ku Tsariwa",second_written:"Xilumkiso xa Vumbirhi xa Ku Tsariwa",final_written:"Xilumkiso xa Makumu xa Ku Tsariwa"},ve:{counselling:"Tshikhala tsha Themendelo",verbal:"Tivhiso ya Ipfi",first_written:"Tivhiso ya u Thoma yo á¹„walwaho",second_written:"Tivhiso ya vhuvhili yo á¹„walwaho",final_written:"Tivhiso ya u Fhedzisela yo á¹„walwaho"},ss:{counselling:"Seshoni Sekululeleka",verbal:"Sixwayiso Ngemlomo",first_written:"Sixwayiso Sekucala Lesibhaliwe",second_written:"Sixwayiso Sesibili Lesibhaliwe",final_written:"Sixwayiso Sekugcina Lesibhaliwe"},tn:{counselling:"Khuduthamaga ya Kgakololo",verbal:"Temoso ya Molomo",first_written:"Temoso ya Ntlha e e Kwadilweng",second_written:"Temoso ya Bobedi e e Kwadilweng",final_written:"Temoso ya Bofelo e e Kwadilweng"},nr:{counselling:"Iseshini Yokululeleka",verbal:"Isixwayiso Ngomlomo",first_written:"Isixwayiso Sokuqala Esibhaliwe",second_written:"Isixwayiso Sesibili Esibhaliwe",final_written:"Isixwayiso Sokugcina Esibhaliwe"},ns:{counselling:"Kopano ya KeletÅ¡o",verbal:"TemoÅ¡o ya Molomo",first_written:"TemoÅ¡o ya Pele yeo e Ngwadilwego",second_written:"TemoÅ¡o ya Bobedi yeo e Ngwadilwego",final_written:"TemoÅ¡o ya Mafelelo yeo e Ngwadilwego"}},Re={en:{formalCharge:(e,a,s,r,t)=>`${e}, you are being charged with ${a}: ${s}. This is a ${r}, valid for ${t} months.`,documentNotice:()=>"This warning will be generated as a digital document containing all details of our discussion, including your version of events, expected behavior standards, and improvement commitments. You will receive this document to review carefully - either by downloading it now via QR code, or it will be sent to you by HR.",legalRights:()=>"Your rights under the Labour Relations Act: You may appeal to HR in writing within 48 hours if you disagree. You may have a fellow employee or shop steward represent you. All unexpired warnings accumulate, and further misconduct may result in additional discipline, up to ending of service.",signatureExplanation:()=>"Your signature confirms you understand this warning and will review the document - not that you agree with it. If you refuse to sign, a witness will confirm the warning was explained. The warning is valid either way. Do you have any questions before we collect signatures?"},af:{formalCharge:(e,a,s,r,t)=>`${e}, jy word aangekla van ${a}: ${s}. Dit is 'n ${r}, geldig vir ${t} maande.`,documentNotice:()=>"Hierdie waarskuwing sal as 'n digitale dokument gegenereer word wat alle besonderhede van ons bespreking bevat, insluitend jou weergawe van gebeure, verwagte gedragstandaarde, en verbeteringsverpligtinge. Jy sal hierdie dokument ontvang om noukeurig te hersien - Ã³f deur dit nou via QR-kode af te laai, Ã³f dit sal deur HR aan jou gestuur word.",legalRights:()=>"Jou regte onder die Wet op Arbeidsverhoudinge: Jy mag binne 48 uur skriftelik by HR appelieer as jy nie saamstem nie. Jy mag 'n mede-werknemer of vakbondverteenwoordiger hÃª om jou te verteenwoordig. Alle onverstreke waarskuwings akkumuleer, en verdere wangedrag kan lei tot addisionele dissipline, tot beÃ«indiging van diens.",signatureExplanation:()=>"Jou handtekening bevestig dat jy hierdie waarskuwing verstaan en die dokument sal hersien - nie dat jy daarmee saamstem nie. As jy weier om te teken, sal 'n getuie bevestig dat die waarskuwing verduidelik is. Die waarskuwing is beide kante geldig. Het jy enige vrae voordat ons handtekeninge versamel?"},zu:{formalCharge:(e,a,s,r,t)=>`${e}, uyabekwa icala nge-${a}: ${s}. Lesi yisixwayiso se-${r}, esisebenza izinyanga ezingu-${t}.`,documentNotice:()=>"Lesi sixwayiso sizokwenziwa njengomqulu wedijithali oqukethe zonke imininingwane yengxoxo yethu, kufaka phakathi inguqulo yakho yezigameko, izindinganiso zokuziphatha ezilindelekile, nezibopho zokuthuthuka. Uzothola lo mqulu ukuze uwubuyekeze ngokucophelela - kungaba ngokuwulanda manje ngekhodi ye-QR, noma uzothunyelwa yihostela ye-HR.",legalRights:()=>"Amalungelo akho ngaphansi koMthetho Wobudlelwano Basebenzi: Ungaphikisa ku-HR ngokubhaliwe ngamahora angu-48 uma ungavumelani. Ungaba nomsebenzi ofana nawe noma ummeleli wenyunyana ukuthi akumele. Zonke izixwayiso ezingaphelelanga ziyaqoqeka, futhi ukuziphatha okubi okwengeziwe kungase kuholele esinyweni esinye, kuya ekuphethweni kwenkonzo.",signatureExplanation:()=>"Ukusayina kwakho kuqinisekisa ukuthi uyaqonda lesi sixwayiso futhi uzobuyekeza umqulu - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, ufakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela. Ingabe unemibuzo ngaphambi kokuba siqoqe izimo zokusayina?"},xh:{formalCharge:(e,a,s,r,t)=>`${e}, uyatyholwa nge-${a}: ${s}. Esi sisilumkiso se-${r}, esisebenza iinyanga ezingu-${t}.`,documentNotice:()=>"Esi silumkiso siya kuveliswa njengoxwebhu lwedijithali oluqulathe zonke iinkcukacha zengxoxo yethu, kuquka inguqulelo yakho yeziganeko, imigangatho yokuziphatha elindelekileyo, nezibophelelo zophuculo. Uya kulufumana olu xwebhu ukuze uluphononge ngononophelo - nokuba ngokulushutha ngoku ngekhowudi ye-QR, okanye luya kuthunyelwa kuwe yi-HR.",legalRights:()=>"Amalungelo akho phantsi koMthetho woBudlelwane baBasebenzi: Ungabhena kwi-HR ngokubhaliwe kwiiyure ezingama-48 ukuba awuvumelani. Ungaba nomsebenzi ofana nawe okanye ummeli wemanyano ukuba akumele. Zonke izilumkiso ezingaphelelwanga ziyaqokelelana, kwaye ukuziphatha okubi okongezelelweyo kunokubangela ukulungiswa okongezelelweyo, ukuya ekupheliseni kwenkonzo.",signatureExplanation:()=>"Utyikityo lwakho luqinisekisa ukuba uyaqonda esi silumkiso kwaye uya kuphonononga uxwebhu - hayi ukuba uyavuma. Ukuba ukhaba ukusayina, ingqina iya kuqinisekisa ukuba isilumkiso sichaziwe. Isilumkiso sisebenza ngazo zombini iindlela. Ingaba unemibuzo ngaphambi kokuba siqokelele iityikityo?"},st:{formalCharge:(e,a,s,r,t)=>`${e}, o a fuoa lengolo la ${a}: ${s}. Ena ke temoso ea ${r}, e sebetsang likhoeli tse ${t}.`,documentNotice:()=>"Temoso ena e tla etsoa e le tokomane ea digital e nang le lintlha tsohle tsa puisano ea rona, ho kenyelletsa maikutlo a hao a ditiragalo, litekanyetso tsa boitshwaro tse lebelletsoeng, le likano tsa ntlafatso. O tla fumana tokomane ena hore o e hlahlobe ka hloko - kapa ka ho e khoasolla hona joale ka QR code, kapa e tla romelloa ho wena ke HR.",legalRights:()=>"Litokelo tsa hao ka tlasa Molao oa Likamano tsa Basebetsi: O ka ipeela ho HR ka ho ngola ka mora dihora tse 48 haeba o sa lumellane. O ka ba le mosebetsi ea tÅ¡oanang le uena kapa moemeli oa kesara ho u emela. Litemoso tsohle tse sa felang li bokellana, 'me boitshwaro bo bobe bo eketsehileng bo ka hlahisa kgetho e eketsehileng, ho fihla feteletsong ea ts'ebeletso.",signatureExplanation:()=>"Saeno ea hao e tiisa hore o utloisisa temoso ena 'me o tla hlahloba tokomane - eseng hore o lumela. Haeba o hana ho saena, paki e tla tiisa hore temoso e hlalositsoe. Temoso e sebetsa ka tsela ka bobeli. Na o na le lipotso pele re bokella mesaeno?"},ts:{formalCharge:(e,a,s,r,t)=>`${e}, u rhumiwa hi ${a}: ${s}. Lexi i xilumkiso xa ${r}, lexi tirhaka tin'hweti ta ${t}.`,documentNotice:()=>"Xilumkiso lexi xi ta endliwa xi ri dokumente ya didjithali leyi nga ni swileriso hinkwaswo swa vulavurisani bya hina, ku katsa xivono xa wena xa swiendlakalo, swiyimo swa mavanyiselo leswi languteriwaka, ni swipimelo swa ku antswisa. U ta kuma dokumente leyi leswaku u yi kambisisa hi vukheta - hambiloko hi ku yi hoxa sweswi hi khodi ya QR, kumbe yi ta rhumiwa eka wena hi HR.",legalRights:()=>"Timfanelo ta wena hi ka tlhelo ka Nawu wa Vuhlanganisi bya Vatirhi: U nga appila eka HR hi ku tsala hi nkarhi wa tawa ta 48 loko u nga pfumeli. U nga va ni mutirhimutsongo wa n'wina kumbe muemimuhlangani leswaku a ku yimela. Swilumkiso hinkwaswo leswi nga heli swi hlengeletiwa, naswona mavanyiselo yo biha lama engetelekeke ma nga endla ndzulavulo wo engetela, ku ya eka ku herisiwa ka vutirheri.",signatureExplanation:()=>"Vusayini bya wena byi tiyisisa leswaku u twisisa xilumkiso lexi naswona u ta kambisisa dokumente - ku nga ri leswaku u pfumela. Loko u vavisa ku sayini, nhlamulo a nga tiyisisa leswaku xilumkiso xi hlamuseriwile. Xilumkiso xi tirhaka hi tindlela hinkwato. Xana u na swivutiso loko hi nga si hlengeleta vusayini?"},ve:{formalCharge:(e,a,s,r,t)=>`${e}, no á¹±uá¹±uwedzwa nga ha ${a}: ${s}. Iyi ndi tivhiso ya ${r}, yo shuma minwedzi ya ${t}.`,documentNotice:()=>"Tivhiso iyi i á¸“o bveledzwa sa á¸“okumente ya diá¸“ijitali ine ya vha na vhubvo hoá¹±he ha mushumo washu, hu tshi katelwa ndivho yavho ya zwithu, mielo ya maitele ane a linganiswa, na zwikhahlamelo zwa u khwinisa. No á¸“o wana á¸“okumente iyi uri no i sedze nga vhuá¹±ali - arali nga u i khou dowuloda zwino nga QR code, kana i á¸“o rumela khavho nga HR.",legalRights:()=>"Pfanelo dzavho kha fhasi ha Mulayo wa Vhushaka ha Vhashumi: No nga appela kha HR hu tshi á¹…walwa nga tshifhinga tsha awara dza 48 arali no sa tendelani. No nga vha na mushumi wa zwiambaro kana muvhuyeli wa shango u ni á¹±uá¹±uwedza. Tivhiso dzoá¹±he dzi songo fhela dzi a kuvhanganya, nahone maitele a si zwavhuá¸“i ano engedziwa a nga khwinisa mulandu wo engedzeaho, u swika kha u fhedza ha mushumo.",signatureExplanation:()=>"U saena havho zwi tiyisedza uri no pfesesa iyi tivhiso nahone no á¸“o sedza á¸“okumente - zwi si uri no tendelana. Arali no nanga u si saini, muhumbeli o do tiyisedza uri tivhiso yo talutshedzelwa. Tivhiso i shuma nga ndila dzoá¹±he. Vho na mbudziso sa ri si khou kuvhanganya masaena?"},ss:{formalCharge:(e,a,s,r,t)=>`${e}, ubekwa licala nge-${a}: ${s}. Lesi yisixwayiso se-${r}, lesisebenta etinyanga letingu-${t}.`,documentNotice:()=>"Lesixwayiso sitawukhiciwa njenge-document ye-digital lenato tonkhe tincukacha tekulukuluma kwetfu, kufaka ekhatsi incenye yakho yetintfo letehlilebile, tisisetjeniswa tekutiphatsa letilindzelelwako, netitfembiso tekuntfula. Utawutfola le-document kutewubuyekeza ngalokucophelela - nobe ngekuyilanda manje nge-QR code, nobe itawutfunyelwa kuwe ngu-HR.",legalRights:()=>"Emalungelo akho ngansi kweMtsetfo weTinhlangano teTisebenzi: Ungaphikisana ku-HR ngekubhalwa ngetikhatsi tetinshintfu tange-48 uma ungavumelani. Ungaba nemsebenzi lofana nawe noma umemeti welihlangano kutsi akumele. Tonkhe tixwayiso letingapheli tiyabutana, nekutiphatsa lokubi lokucondzako kungase kuholele kulajiswa lokucondzako, kuya ekuphetseni kwemsebenzi.",signatureExplanation:()=>"Kusayina kwakho kucincisekisa kutsi uyatizwa lesixwayiso futsi utawubuyekeza le-document - kusho nje kutsi uyavuma. Uma ukhetsa kungasayini, umfakazi utawucincisekisa kutsi sixwayiso sichaziwe. Sixwayiso sisebenta ngatindzlela tonkhe. Ingabe unemibuto ngaphambi kwekutsi sitfole kusayina?"},tn:{formalCharge:(e,a,s,r,t)=>`${e}, o a sekisiwa ka ${a}: ${s}. Eno ke temoso ya ${r}, e e dirang dikgwedi tse ${t}.`,documentNotice:()=>"Temoso eno e tla dirwa e le tokomane ya ditÅ¡itale e e nang le dintlha tsotlhe tsa puisano ya rona, go akaretsa lekanyo la gago la ditiragalo, mekgwa ya boitshwaro e e solofetsweng, le ditsholofelo tsa tokafatso. O tla bona tokomane eno gore o e sekaseke ka kelotlhoko - kgotsa ka go e khurumetsa jaanong ka khouthu ya QR, kgotsa e tla romelwa go wena ke HR.",legalRights:()=>"Ditshwanelo tsa gago ka fa tlase ga Molao wa Dikamano tsa Badiri: O ka boipiletsa kwa HR ka go kwala mo diureng tse 48 fa o sa dumelane. O ka nna le modiri yo o tshwanang le wena kgotsa moemedi wa lekgotla go go emela. Ditemoso tsotlhe tse di sa feleng di a kokoana, mme boitshwaro jo bo sa siamang jo bo oketsegileng bo ka felela ka kgalemelo e e oketsegileng, go fitlha kwa go fediseleng tiro.",signatureExplanation:()=>"Go saena ga gago go netefatsa gore o tlhaloganya temoso eno le gore o tla sekaseka tokomane - ga go reye gore o dumelana. Fa o tlhopha go sa saena, paki e tla netefatsa gore temoso e tlhalosetse. Temoso e bereka ka ditsela tsotlhe. A o na le dipotso fa pele ga re kokoanya mesaeno?"},nr:{formalCharge:(e,a,s,r,t)=>`${e}, uyabekwa icala nge-${a}: ${s}. Lesi yisixwayiso se-${r}, esisebenza izinyanga ezingu-${t}.`,documentNotice:()=>"Lesi sixwayiso sizokwenziwa njengomqulu wedijithali oqukethe zonke imininingwane yengxoxo yethu, kufaka phakathi inguqulo yakho yezigameko, izindinganiso zokuziphatha ezilindelekile, nezibopho zokuthuthuka. Uzothola lo mqulu ukuze uwubuyekeze ngokucophelela - kungaba ngokuwulanda manje ngekhodi ye-QR, noma uzothunyelwa yihostela ye-HR.",legalRights:()=>"Amalungelo akho ngaphansi koMthetho weBudlelwano Basebenzi: Ungabhena ku-HR ngokubhaliwe ngamahora angama-48 uma ungavumelani. Ungaba nomsebenzi ofana nawe noma ummeleli wenyunyana ukukumela. Zonke izixwayiso ezingaphelelanga ziyaqoqeka, futhi ukuziphatha okubi okwengeziwe kungase kuholele esinyweni esinye, kuya ekuphethweni kwenkonzo.",signatureExplanation:()=>"Ukusayina kwakho kuqinisekisa ukuthi uqonda lesi sixwayiso futhi uzobuyekeza umqulu - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, umfakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela. Ingabe unemibuzo ngaphambi kokuba siqoqe izimo zokusayina?"},ns:{formalCharge:(e,a,s,r,t)=>`${e}, o a sekiÅ¡etÅ¡wa ka ${a}: ${s}. Ye ke temoÅ¡o ya ${r}, yeo e Å¡omago dikgwedi tÅ¡e ${t}.`,documentNotice:()=>"TemoÅ¡o ye e tla dirwa bjalo ka tokumente ya diditÅ¡hitale yeo e nago le dintlha tÅ¡ohle tÅ¡a polediÅ¡ano ya rena, go akaretÅ¡a kanegelo ya gago ya ditiragalo, maemo a boitshwaro ao a letelwago, le ditshepiÅ¡i tÅ¡a kaonafatÅ¡o. O tla hwetÅ¡a tokumente ye gore o e sekaseke ka kelohloko - e ka ba ka go e kgauswi gona bjale ka khouthu ya QR, goba e tla romelwa go wena ke HR.",legalRights:()=>"Ditokelo tÅ¡a gago ka fase ga Molao wa Dikamano tÅ¡a BaÅ¡omi: O ka boipiletÅ¡a go HR ka go ngwala ka gare ga diiri tÅ¡e 48 ge o sa dumelelane. O ka ba le modiri yo o swanago le wena goba moemeli wa kesara go go emela. DitemoÅ¡o tÅ¡ohle tÅ¡e di sa feleng di a kokoana, gomme boitshwaro bjo bo sa lokago bjo bo oketÅ¡egilego bo ka fela ka kgalemo ye e oketÅ¡egilego, go fihla go fediÅ¡a moÅ¡omo.",signatureExplanation:()=>"Go saena ga gago go netefatÅ¡a gore o kweÅ¡iÅ¡a temoÅ¡o ye le gore o tla sekaseka tokumente - e sego gore o dumelelana le yona. Ge o gana go saena, paki e tlago netefatÅ¡a gore temoÅ¡o e hlaloÅ¡itÅ¡we. TemoÅ¡o e Å¡oma ka ditsela tÅ¡e ka bobedi. Na o na le dipotÅ¡iÅ¡o pele re kgoboketÅ¡a mesaeno?"}},Ie=({employeeName:e,managerName:s,categoryName:r,incidentDescription:t,warningLevel:i,validityPeriod:o,onScriptRead:n,disabled:l=!1,activeWarnings:c=[],issuedDate:d})=>{const[m,u]=y.useState("en"),[h,g]=y.useState(!1),[x,p]=y.useState(!1),v=Re[m]||Re.en;Se.find(e=>e.code===m)||Se[0];const w=((e,a)=>{const s=e.toLowerCase().replace(/ /g,"_");return ze[a][s]||e})(i,m);return a.jsx("div",{className:"space-y-2",children:h?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between pb-3 border-b",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(V,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸ“– Employee Warning Script"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(Q,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:m,onChange:e=>u(e.target.value),disabled:x||l,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Se.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:a.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Formal Charge"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.formalCharge(e,r,t,w,o)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Digital Document Notice"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.documentNotice()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Your Rights"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.legalRights()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Signature & Questions"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.signatureExplanation()})]})]})}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(Y,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsxs("span",{children:["Read this complete script aloud to ",e]})]}),x?a.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[a.jsx(X,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):a.jsxs("button",{onClick:()=>{p(!0),n()},disabled:l,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:[a.jsx(X,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1 max-w-[140px]",children:[a.jsx("select",{value:m,onChange:e=>u(e.target.value),disabled:x||l,className:"appearance-none w-full pl-3 pr-7 py-1.5 border rounded text-xs focus:ring-2 focus:ring-blue-500 transition-all cursor-pointer",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Se.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))}),a.jsx(Q,{className:"w-3.5 h-3.5 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none",style:{color:"var(--color-text-secondary)"}})]}),a.jsxs("button",{onClick:()=>g(!0),disabled:l,className:"flex items-center gap-1.5 px-3 py-1.5 border rounded text-xs font-medium transition-all hover:bg-gray-50 active:scale-95",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)"},children:[a.jsx(U,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:"View Script"})]})]})})},De="Africa/Johannesburg",Te=({onSignatureComplete:e,disabled:s=!1,label:r,placeholder:t="Click and drag to sign",initialSignature:i=null,className:o="",width:n=400,height:l=200,signerName:c})=>{const d=y.useRef(null),m=y.useRef(null),[u,h]=y.useState(!1),[g,x]=y.useState(!1),[p,v]=y.useState(!1),[w,b]=y.useState([]),[f,k]=y.useState(!1),j=y.useCallback(()=>{const e=d.current;if(!e)return;const a=e.getContext("2d");if(!a)return;const s=e.getBoundingClientRect(),r=window.devicePixelRatio||1;e.width=s.width*r,e.height=s.height*r,a.scale(r,r),a.strokeStyle="#1e293b",a.lineWidth=2,a.lineCap="round",a.lineJoin="round",a.globalCompositeOperation="source-over",a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),k(!0)},[]),N=y.useCallback(e=>{const a=d.current;if(!a)return{x:0,y:0};const s=a.getBoundingClientRect();let r,t;if("touches"in e&&e.touches.length>0)r=e.touches[0].clientX,t=e.touches[0].clientY;else{if(!("clientX"in e))return{x:0,y:0};r=e.clientX,t=e.clientY}return{x:r-s.left,y:t-s.top}},[]),C=y.useCallback(e=>{if(s)return;e.preventDefault();const a=d.current,r=a?.getContext("2d");if(!a||!r)return;h(!0);const{x:t,y:i}=N(e);r.beginPath(),r.moveTo(t,i);const o={points:[{x:t,y:i}],timestamp:Date.now()};b(e=>[...e,o])},[s,N]),S=y.useCallback(e=>{if(!u||s)return;e.preventDefault();const a=d.current,r=a?.getContext("2d");if(!a||!r)return;const{x:t,y:i}=N(e);r.lineTo(t,i),r.stroke(),b(e=>{if(0===e.length)return e;const a=[...e];return a[a.length-1].points.push({x:t,y:i}),a})},[u,s,N]),z=y.useCallback(()=>{u&&(h(!1),v(!0))},[u]),R=y.useCallback(e=>{if(!e||""===e.trim())return"";const a=e.trim().split(/\s+/);if(0===a.length)return"";if(1===a.length)return a[0];return`${a.slice(0,-1).map(e=>e.charAt(0).toUpperCase()+".").join(" ")} ${a[a.length-1]}`},[]),I=y.useCallback(()=>{if(s)return;const a=d.current,r=a?.getContext("2d");if(!a||!r)return;const t=((e,a=De)=>(e instanceof Date?e:new Date(e)).toLocaleString("en-ZA",{timeZone:a,year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}))(new Date,De),i=c?R(c):"",o=a.getBoundingClientRect(),n=ge({strokes:w,width:o.width,height:o.height,signerName:i,timestamp:t,strokeColor:"#1e293b",strokeWidth:2,textColor:"#64748b",fontSize:10});r.save(),r.font="10px Arial, sans-serif",r.fillStyle="#64748b",r.textAlign="right",r.textBaseline="bottom";let l=o.height-8;r.fillText(t,o.width-8,l),i&&(l-=12,r.fillText(i,o.width-8,l)),r.restore(),x(!0),v(!1),e(n)},[s,e,c,R,w]),D=y.useCallback(()=>{if(s)return;const a=d.current,r=a?.getContext("2d");a&&r&&(r.fillStyle="#ffffff",r.fillRect(0,0,a.width,a.height),x(!1),v(!1),b([]),e(null))},[s,e]);return y.useEffect(()=>{if(!f||s)return;const e=d.current;if(!e)return;const a=e=>C(e),r=e=>S(e),t=()=>z(),i=()=>z(),o=e=>C(e),n=e=>S(e),l=()=>z();return e.addEventListener("mousedown",a,{passive:!1}),e.addEventListener("mousemove",r,{passive:!1}),e.addEventListener("mouseup",t),e.addEventListener("mouseleave",i),e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("touchmove",n,{passive:!1}),e.addEventListener("touchend",l),m.current=()=>{e.removeEventListener("mousedown",a),e.removeEventListener("mousemove",r),e.removeEventListener("mouseup",t),e.removeEventListener("mouseleave",i),e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",l)},m.current},[f,s,C,S,z]),y.useEffect(()=>{j()},[j]),y.useEffect(()=>{if(i&&f){const e=d.current,a=e?.getContext("2d");if(!e||!a)return;const s=new Image;s.onload=()=>{const r=e.getBoundingClientRect();a.clearRect(0,0,e.width,e.height),a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),a.drawImage(s,0,0,r.width,r.height),x(!0)},s.onerror=()=>{console.error("Failed to load signature image")},s.src=i}},[i,f]),y.useEffect(()=>()=>{m.current&&m.current()},[]),w.length>=1&&(w.some(e=>e.points.length>=5)||w.length),a.jsxs("div",{className:`space-y-3 ${o}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:r}),a.jsxs("div",{className:"flex items-center gap-2",children:[g&&a.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[a.jsx(X,{className:"w-3 h-3"}),a.jsx("span",{children:"Saved"})]}),p&&!g&&a.jsxs("button",{type:"button",onClick:I,disabled:s,className:"flex items-center gap-1 px-2 py-1 text-xs text-green-600 hover:text-green-700 disabled:opacity-50",children:[a.jsx(X,{className:"w-3 h-3"}),"Save Signature"]}),a.jsxs("button",{type:"button",onClick:D,disabled:s||!g&&!p,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-red-600 disabled:opacity-50",children:[a.jsx(K,{className:"w-3 h-3"}),"Clear"]})]})]}),a.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg bg-white\n        ${s?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}\n        ${g?"border-green-300 bg-green-50":""}\n      `,children:[a.jsx("canvas",{ref:d,width:n,height:l,className:`\n            block w-full h-full cursor-crosshair rounded-lg\n            ${s?"cursor-not-allowed":""}\n          `,style:{width:`${n}px`,height:`${l}px`}}),!g&&!s&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[a.jsx(O,{className:"w-4 h-4"}),a.jsx("span",{children:t})]})})]})]})};class Ee{static{this.EXPIRY_HOURS=1}static async generateTemporaryLink(e){e.filename,e.pdfBlob.size,e.employeeId,e.warningId,e.organizationId;try{const a=d.currentUser;if(!a)throw c.error("âŒ [TemporaryLinkService] User not authenticated"),new Error("User not authenticated");c.success(2228);const s=this.generateTokenId(),r=Date.now(),t=Math.random().toString(36).substr(2,12),i=e.filename.replace(/[^a-zA-Z0-9.-]/g,"_"),o=`temp-downloads/${e.organizationId||"default"}/${r}_${t}_${i}`,n=b(m,o),l={contentType:"application/pdf",customMetadata:{organizationId:e.organizationId||"",employeeId:e.employeeId||"",warningId:e.warningId||"",filename:e.filename,tokenId:s,createdAt:(new Date).toISOString(),size:e.pdfBlob.size.toString(),uploadedBy:a.uid,purpose:"temporary-download"}};await f(n,e.pdfBlob,l);const u=await k(n),h=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);await this.trackTemporaryFile({tokenId:s,storagePath:o,downloadUrl:u,filename:e.filename,organizationId:e.organizationId,employeeId:e.employeeId,warningId:e.warningId,uploadedBy:a.uid,expiresAt:h,createdAt:new Date}),c.success(4558);const g=await this.generateQRCode(u),x=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);return x.toISOString(),u.substring(0,60),{downloadUrl:u,qrCodeData:g,expiresAt:x.toISOString(),tokenId:s,filename:e.filename}}catch(a){throw c.error("âŒ [TemporaryLinkService] Failed to generate temporary link:",a),new Error(`Failed to generate temporary link: ${a instanceof Error?a.message:"Unknown error"}`)}}static async validateTemporaryToken(e){return!0}static async revokeTemporaryToken(e){return!0}static generateTokenId(){return`tmp_${Date.now()}_${Math.random().toString(36).substr(2,12)}`}static async blobToBase64(e){return new Promise((a,s)=>{const r=new FileReader;r.onload=()=>{const e=r.result;a(e.split(",")[1])},r.onerror=s,r.readAsDataURL(e)})}static async generateQRCode(e){try{const a=`${"https://api.qrserver.com/v1/create-qr-code/"}?${new URLSearchParams({size:"300x300",data:e,format:"png",ecc:"M",margin:"10"}).toString()}`,s=await fetch(a);if(!s.ok)throw new Error("QR code generation failed");const r=await s.blob();return new Promise((e,a)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=a,s.readAsDataURL(r)})}catch(a){return c.error("âŒ QR Code generation failed:",a),`data:text/plain;base64,${btoa(e)}`}}static formatExpiryTime(e){const a=new Date(e),s=new Date,r=a.getTime()-s.getTime();if(r<=0)return"Expired";const t=Math.floor(r/6e4),i=Math.floor(t/60),o=t%60;return i>0?`${i}h ${o}m remaining`:`${o}m remaining`}static isExpired(e){return new Date(e).getTime()<=Date.now()}static async trackTemporaryFile(e){try{await j(N(u,"temporaryFiles"),{tokenId:e.tokenId,storagePath:e.storagePath,downloadUrl:e.downloadUrl,filename:e.filename,fileType:"pdf",organizationId:e.organizationId||"",employeeId:e.employeeId||"",warningId:e.warningId||"",uploadedBy:e.uploadedBy,expiresAt:e.expiresAt,createdAt:C(),isExpired:!1,fileSize:0}),c.success(10578)}catch(a){c.error("âŒ [TemporaryLinkService] Failed to track temporary file:",a)}}}const Le=({isOpen:e,onClose:r,pdfBlob:t,filename:o,employeeId:n,warningId:l,organizationId:d,employeeName:m,onLinkGenerated:u})=>{xe(e);const[g,x]=y.useState(!1),[p,b]=y.useState(null),[f,k]=y.useState(null),[j,N]=y.useState({hours:0,minutes:0,seconds:0,expired:!1}),[C,S]=y.useState(!1),z=v.useRef(!1),R=y.useCallback(async()=>{if(t&&(t.size/1024).toFixed(1),t)try{x(!0),k(null);const e=await Ee.generateTemporaryLink({pdfBlob:t,filename:o,employeeId:n,warningId:l,organizationId:d});c.success(2764),b(e),u?.(e)}catch(e){c.error("âŒ QR link generation failed:",e),k(e.message||"Failed to generate QR code")}finally{x(!1)}else c.error("âŒ [QRCodeDownloadModal] No PDF blob provided")},[t,o,n,l,d,u]);y.useEffect(()=>{if(!p?.expiresAt)return;const e=()=>{const e=(new Date).getTime(),a=new Date(p.expiresAt).getTime()-e;if(a<=0)return void N({hours:0,minutes:0,seconds:0,expired:!0});const s=Math.floor(a/36e5),r=Math.floor(a%36e5/6e4),t=Math.floor(a%6e4/1e3);N({hours:s,minutes:r,seconds:t,expired:!1})};e();const a=setInterval(e,1e3);return()=>clearInterval(a)},[p?.expiresAt]);const I=y.useCallback(async()=>{if(p?.downloadUrl)try{await navigator.clipboard.writeText(p.downloadUrl),S(!0),setTimeout(()=>S(!1),2e3)}catch(e){c.error("âŒ Failed to copy link:",e)}},[p?.downloadUrl]);return y.useEffect(()=>{!e||!t||p||g||z.current||(z.current=!0,R())},[e,t,p,g,R]),y.useEffect(()=>{e||(b(null),k(null),N({hours:0,minutes:0,seconds:0,expired:!1}),S(!1),z.current=!1)},[e]),e?w.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:1e4},children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"bg-white border-b px-6 py-4 flex items-center justify-between flex-shrink-0",style:{borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsx(Z,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Mobile Download"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Scan to download on your phone"})]})]}),a.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx(P,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[a.jsx(i,{padding:"md",className:"border",style:{borderColor:"var(--color-border)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(J,{className:"w-5 h-5",style:{color:"var(--color-success)"}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-sm truncate",style:{color:"var(--color-text)"},children:o}),m&&a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["For: ",m]}),a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Size: ",(t.size/1024).toFixed(1)," KB"]})]})]})}),g&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto mb-4",style:{borderWidth:"2px",borderColor:"transparent",borderTopColor:"var(--color-primary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:"Generating secure download link..."}),a.jsx("p",{className:"text-xs mt-2",style:{color:"var(--color-text-secondary)"},children:"This may take a moment"})]}),f&&a.jsxs(h,{variant:"error",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(_,{className:"w-5 h-5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-sm",children:"Generation Failed"}),a.jsx("p",{className:"text-xs mt-1",children:f})]})]}),a.jsx(s,{variant:"danger",size:"sm",onClick:R,disabled:g,className:"mt-3",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(K,{className:"w-4 h-4"}),a.jsx("span",{children:"Try Again"})]})})]}),p&&!j.expired&&a.jsxs("div",{className:"space-y-4",children:[a.jsx(h,{variant:"warning",className:"border-l-4",style:{borderLeftColor:"var(--color-warning)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ee,{className:"w-5 h-5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",children:"Time-Limited Access"}),a.jsxs("p",{className:"text-xs mt-1",children:["Link expires in: ",j.hours>0&&`${j.hours}h `,j.minutes,"m ",j.seconds,"s"]})]})]})}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg border-2 inline-block",style:{borderColor:"var(--color-border)"},children:a.jsx("img",{src:p.qrCodeData,alt:"Download QR Code",className:"w-64 h-64 mx-auto",style:{imageRendering:"pixelated"}})}),a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[a.jsx(ae,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Point your camera at the QR code"})]}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"No app needed - works with built-in camera on iOS & Android"})]})]}),a.jsx("div",{className:"space-y-3",children:a.jsx(s,{variant:C?"success":"secondary",size:"md",fullWidth:!0,onClick:I,children:a.jsx("div",{className:"flex items-center justify-center gap-2",children:C?a.jsxs(a.Fragment,{children:[a.jsx(D,{className:"w-5 h-5"}),a.jsx("span",{children:"Link Copied!"})]}):a.jsxs(a.Fragment,{children:[a.jsx(se,{className:"w-5 h-5"}),a.jsx("span",{children:"Copy Download Link"})]})})})}),a.jsx(h,{variant:"info",className:"border-l-4",style:{borderLeftColor:"var(--color-info)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(q,{className:"w-5 h-5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",children:"Security Features"}),a.jsxs("ul",{className:"text-xs mt-1 space-y-1",children:[a.jsx("li",{children:"â€¢ Link expires automatically in 1 hour"}),a.jsx("li",{children:"â€¢ Single-use download link"}),a.jsx("li",{children:"â€¢ Encrypted token authentication"}),a.jsx("li",{children:"â€¢ No app needed - works with any camera"})]})]})]})})]}),p&&j.expired&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:"var(--color-error-light)"},children:a.jsx(A,{className:"w-8 h-8",style:{color:"var(--color-error)"}})}),a.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text)"},children:"Link Expired"}),a.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"The download link has expired for security reasons."}),a.jsx(s,{variant:"primary",size:"md",onClick:R,disabled:g,children:"Generate New Link"})]})]})]})}),document.body):null},Pe="audio/webm;codecs=opus",$e=16e3,Ae=8e3,qe=1,Fe=3e5,Me=819200,We=24e4,_e=!0,Ue=!0,Be=!0;class He{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return He.instance||(He.instance=new He),He.instance}canStart(){const e=Date.now();return!this.isRecording&&!this.isStarting&&(!(this.startedAt>0&&e-this.startedAt<1e3)&&(!(this.allActiveStreams.size>0||this.allActiveTracks.size>0)||(this.allActiveStreams.size,this.allActiveTracks.size,!1)))}tryReserve(){return!!this.canStart()&&(this.isStarting=!0,this.startedAt=Date.now(),!0)}startRecording(){this.isRecording=!0}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{try{e.stop()}catch(a){}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null)}setStream(e){return this.mediaStream||this.allActiveStreams.size>0?(this.allActiveStreams.size,e.getTracks().forEach(e=>e.stop()),!1):(this.allActiveStreams.add(e),e.getTracks().forEach(e=>{this.allActiveTracks.add(e),e.addEventListener("ended",()=>{this.allActiveTracks.delete(e)})}),this.mediaStream=e,this.isStarting=!1,this.allActiveStreams.size,!0)}stopAllStreams(){this.allActiveStreams.size,this.allActiveTracks.size,this.allActiveStreams.forEach(e=>{e.getTracks().forEach(e=>{try{e.stop()}catch(a){}})}),this.allActiveTracks.forEach(e=>{try{"live"===e.readyState&&e.stop()}catch(a){}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0}}const Oe=He.getInstance(),Ge=v.memo(({size:e="medium",color:s="#3b82f6"})=>{const r={small:"1.5rem",medium:"3rem",large:"5rem"};return a.jsx("div",{style:{width:r[e],height:r[e],border:"4px solid #e2e8f0",borderTop:`4px solid ${s}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})});Ge.displayName="LoadingSpinner";v.memo(()=>a.jsxs("div",{className:"hr-card skeleton-card",children:[a.jsx("div",{className:"skeleton-header"}),a.jsxs("div",{className:"skeleton-content",children:[a.jsx("div",{className:"skeleton-line",style:{width:"100%"}}),a.jsx("div",{className:"skeleton-line",style:{width:"80%"}}),a.jsx("div",{className:"skeleton-line",style:{width:"60%"}})]})]})).displayName="CardSkeleton";v.memo(()=>a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"1rem"},children:[1,2,3,4,5,6].map(e=>a.jsxs("div",{className:"hr-card skeleton-card",style:{padding:"1.5rem"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{className:"skeleton-line",style:{width:"60%",marginBottom:"0.5rem"}}),a.jsx("div",{className:"skeleton-line",style:{width:"40%",height:"2rem"}})]}),a.jsx("div",{className:"skeleton-circle",style:{width:"3rem",height:"3rem"}})]}),a.jsx("div",{className:"skeleton-line",style:{width:"50%"}})]},e))})).displayName="StatsSkeleton";if("undefined"!=typeof document){const e=document.createElement("style");e.innerHTML="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n\n  @keyframes shimmer {\n    0% { background-position: -1000px 0; }\n    100% { background-position: 1000px 0; }\n  }\n\n  .skeleton-card {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .skeleton-line {\n    height: 1rem;\n    margin-bottom: 0.5rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n  }\n\n  .skeleton-header {\n    height: 1.5rem;\n    margin-bottom: 1rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n    width: 40%;\n  }\n\n  .skeleton-circle {\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 50%;\n  }\n\n  .skeleton-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n",document.head.appendChild(e)}const Qe={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},Ve=({onPermissionGranted:e,onPermissionDenied:s,organizationName:r,managerName:t})=>{const[i,o]=y.useState("requesting"),[n,l]=y.useState("");y.useRef(Math.random().toString(36).substr(2,9)),y.useEffect(()=>(Qe.callbacks.push(e),Qe.errorCallbacks.push(s),Qe.isGranted?(o("granted"),void setTimeout(e,100)):(Qe.isRequesting||(Qe.isRequesting=!0,d()),()=>{const a=Qe.callbacks.indexOf(e);a>-1&&Qe.callbacks.splice(a,1);const r=Qe.errorCallbacks.indexOf(s);r>-1&&Qe.errorCallbacks.splice(r,1)})),[]);const d=async()=>{try{if(o("requesting"),l(""),!navigator.mediaDevices?.getUserMedia)return o("not-supported"),void l("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");try{if(navigator.permissions&&navigator.permissions.query){if("denied"===(await navigator.permissions.query({name:"microphone"})).state)return c.warn("âš ï¸ Microphone permission is permanently blocked"),o("denied"),void l("Microphone access is blocked in your browser settings. Click the lock icon in the address bar to allow access.")}}catch(e){}(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(e=>e.stop()),o("granted"),Qe.isGranted||(Qe.isGranted=!0,Qe.isRequesting=!1,Qe.callbacks.forEach(e=>{setTimeout(e,1e3)}))}catch(a){c.error("Microphone permission error:",a),Qe.isRequesting=!1,"NotAllowedError"===a.name?(o("denied"),l("Microphone access was denied. Click the lock/info icon in your browser's address bar, then allow microphone access and refresh this page.")):"NotFoundError"===a.name?(o("error"),l("No microphone was found on your device. Please connect a microphone and try again.")):"NotReadableError"===a.name?(o("error"),l("Your microphone is being used by another application. Please close other apps and try again.")):(o("error"),l("An error occurred while accessing your microphone. Please check your browser settings.")),Qe.errorCallbacks.forEach(e=>{e()})}},m=(()=>{switch(i){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:n};case"not-supported":return{title:"Browser Not Supported",message:n};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"max-w-sm w-full",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:(()=>{switch(i){case"requesting":return a.jsx(Ge,{size:"medium",color:"#3b82f6"});case"granted":return a.jsx(Ge,{size:"medium",color:"#16a34a"});case"denied":return a.jsx(ie,{className:"w-6 h-6 text-red-600"});case"error":return a.jsx(oe,{className:"w-6 h-6 text-red-600"});case"not-supported":return a.jsx(ie,{className:"w-6 h-6 text-gray-600"});default:return a.jsx(te,{className:"w-6 h-6 text-gray-600"})}})()}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m.title}),a.jsx("p",{className:"text-sm text-gray-600",children:m.message})]}),("denied"===i||"error"===i)&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3 text-left",children:a.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[a.jsx(re,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-xs text-blue-900",children:[a.jsx("p",{className:"font-semibold mb-1",children:"To enable microphone:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-blue-800",children:[a.jsxs("li",{children:["Click the ",a.jsx("strong",{children:"lock icon"})," or ",a.jsx("strong",{children:"site settings"})," in your browser's address bar"]}),a.jsxs("li",{children:["Find ",a.jsx("strong",{children:"Microphone"})," settings"]}),a.jsxs("li",{children:["Change to ",a.jsx("strong",{children:"Allow"})]}),a.jsx("li",{children:"Refresh this page or click Try Again below"})]})]})]})}),a.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"})]})]}),a.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:a.jsx("p",{children:r})})]})})},Ye=[{title:"Employee Selection",icon:E,guidance:"Who is involved in this incident?"},{title:"Category & Recommendation",icon:ne,guidance:"Classify the misconduct and review the system recommendation"},{title:"Incident Details",icon:U,guidance:"Document the facts: when, where, and what happened"},{title:"Employee's Response",icon:le,guidance:"What did the employee say when you discussed the incident?"},{title:"Expected Standards",icon:ce,guidance:"What behavior, performance, or conduct is expected?"},{title:"Improvement Plan",icon:W,guidance:"Record specific commitments with timelines and set follow-up"},{title:"Review Documentation",icon:D,guidance:"Review all information before proceeding to signatures"},{title:"Script & PDF Review",icon:de,guidance:"Read the warning script aloud, then review the PDF together"},{title:"Signatures",icon:O,guidance:"Collect signatures to finalize and save the warning"},{title:"Delivery",icon:me,guidance:"Select how the warning will be delivered to the employee"}],Xe=()=>{const e=new Date;return new Intl.DateTimeFormat("en-ZA",{timeZone:"Africa/Johannesburg",hour:"2-digit",minute:"2-digit",hour12:!1}).format(e)},Ke=()=>{const e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit"}).format(e)},Ze=e=>({counselling:{label:"Counselling",requiresCommitments:!0},verbal:{label:"Verbal",requiresCommitments:!0},first_written:{label:"Written",requiresCommitments:!0},second_written:{label:"Second Written",requiresCommitments:!0},final_written:{label:"Final Written",requiresCommitments:!1},suspension:{label:"Suspension",requiresCommitments:!1},dismissal:{label:"Ending of Service",requiresCommitments:!1}}[e]||{label:e,requiresCommitments:!0}),Je=({employees:r,categories:t,currentManagerName:o,organizationName:n,onComplete:l,onCancel:d,preSelectedEmployeeId:v,preSelectedCategoryId:w,isFullScreen:j})=>{const{user:N}=g(),{organization:C}=x(),R=(()=>{const[e,a]=y.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),s=y.useRef(null),r=y.useRef([]),t=y.useRef(null),i=y.useRef(0),o=y.useRef(null),n=y.useRef(!1),l=y.useRef(!1),d=y.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),u=y.useCallback(e=>e<1024?`${e}B`:e<1048576?`${(e/1024).toFixed(1)}KB`:`${(e/1048576).toFixed(1)}MB`,[]),h=y.useCallback(()=>`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),g=y.useCallback(()=>{if(!i.current)return;if(!e.isRecording)return void(o.current&&(clearInterval(o.current),o.current=null));const r=(Date.now()-i.current)/1e3,t=Date.now()-i.current;if(a(e=>e.isRecording?{...e,duration:r}:e),t>=Fe)return o.current&&(clearInterval(o.current),o.current=null),void setTimeout(()=>{s.current&&"recording"===s.current.state&&s.current.stop()},0);t>=We&&!n.current&&(n.current=!0)},[]),x=y.useCallback(()=>{try{if(s.current){try{"recording"===s.current.state&&s.current.stop()}catch(e){}s.current=null}[t.current,Oe.mediaStream].filter(Boolean).forEach(a=>{a&&a.getTracks().forEach(a=>{try{a.stop()}catch(e){}})}),t.current=null,Oe.stopAllStreams(),o.current&&(clearInterval(o.current),o.current=null),r.current=[],n.current=!1,i.current=0,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(e){c.error("âŒ Error during force cleanup:",e)}},[]),p=y.useCallback(async()=>{if(Oe.tryReserve())try{if(l.current=!1,(t.current||s.current||Oe.mediaStream)&&(x(),await new Promise(e=>setTimeout(e,100))),a(e=>({...e,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:qe,sampleRate:Ae,echoCancellation:_e,noiseSuppression:Ue,autoGainControl:Be}});if(!Oe.setStream(e))return void a(e=>({...e,isProcessing:!1,error:"Another recording is already active"}));t.current=e,r.current=[];const d=new MediaRecorder(e,{mimeType:Pe,audioBitsPerSecond:$e});s.current=d,d.ondataavailable=e=>{if(!l.current&&e.data.size>0){r.current.push(e.data);const i=r.current.reduce((e,a)=>e+a.size,0);if(a(e=>({...e,size:i})),i>=Me&&"recording"===s.current?.state){u(i),l.current=!0;try{s.current.stop()}catch(t){c.error("âŒ Error stopping MediaRecorder:",t)}}}},d.onstop=()=>{t.current&&(t.current.getTracks().forEach(e=>e.stop()),t.current=null)},d.start(1e3),i.current=Date.now(),n.current=!1,Oe.startRecording(),o.current=setInterval(g,100);const m=h();a(e=>({...e,isRecording:!0,isProcessing:!1,recordingId:m,duration:0,size:0}))}catch(e){c.error("âŒ Error starting recording:",e),Oe.stopRecording(),a(a=>({...a,isRecording:!1,isProcessing:!1,error:e.message||"Failed to start recording"}))}},[g,h]),v=y.useCallback(async()=>{try{return s.current&&e.isRecording?(a(e=>({...e,isProcessing:!0})),o.current&&(clearInterval(o.current),o.current=null),new Promise(e=>{const t=s.current;t.onstop=()=>{try{const s=new Blob(r.current,{type:Pe}),t=URL.createObjectURL(s);a(e=>({...e,isRecording:!1,isProcessing:!1,audioUrl:t,size:s.size})),u(s.size),l.current=!1,e(t)}catch(s){c.error("âŒ Error processing recording:",s),a(e=>({...e,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),l.current=!1,e(null)}},t.stop(),a(e=>({...e,isRecording:!1}))})):(l.current=!1,null)}catch(t){return c.error("âŒ Error stopping recording:",t),a(e=>({...e,isRecording:!1,isProcessing:!1,error:t.message||"Failed to stop recording"})),l.current=!1,null}},[e.isRecording,u]),w=y.useCallback(()=>{s.current&&e.isRecording&&(s.current.pause(),o.current&&(clearInterval(o.current),o.current=null))},[e.isRecording]),j=y.useCallback(()=>{s.current&&e.isRecording&&(s.current.resume(),i.current=Date.now()-1e3*e.duration,o.current=setInterval(g,100))},[e.isRecording,e.duration,g]),N=y.useCallback(()=>{try{s.current&&s.current.stop(),t.current&&(t.current.getTracks().forEach(e=>e.stop()),t.current=null),o.current&&(clearInterval(o.current),o.current=null),e.audioUrl&&URL.revokeObjectURL(e.audioUrl),r.current=[],n.current=!1,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(i){c.error("âŒ Error cancelling recording:",i)}},[e.audioUrl]),C=y.useCallback(async(s,r)=>{try{if(!e.audioUrl||!e.recordingId)throw new Error("No recording available to upload");a(e=>({...e,isProcessing:!0}));const t=await fetch(e.audioUrl),i=await t.blob(),o=`warnings/${s}/${r}/audio/${e.recordingId}.webm`,n=b(m,o),l={contentType:Pe,customMetadata:{warningId:r,organizationId:s,duration:e.duration.toString(),size:e.size.toString(),recordingId:e.recordingId,createdAt:(new Date).toISOString()}};await f(n,i,l);const d=await k(n);return a(e=>({...e,isProcessing:!1})),c.success(13735),d}catch(t){return c.error("âŒ Error uploading audio:",t),a(e=>({...e,isProcessing:!1,error:t.message||"Failed to upload audio"})),null}},[e.audioUrl,e.recordingId,e.duration,e.size]),S=y.useCallback(async(s,r,t,i)=>{try{if(!s||!r)throw new Error("No recording data provided for upload");a(e=>({...e,isProcessing:!0}));const o=await fetch(s),n=await o.blob(),l=b(m,`warnings/${t}/${i}/audio/${r}.webm`),d={contentType:Pe,customMetadata:{warningId:i,organizationId:t,duration:e.duration.toString(),size:n.size.toString(),recordingId:r,createdAt:(new Date).toISOString()}};await f(l,n,d);const u=await k(l);return a(e=>({...e,isProcessing:!1})),c.success(15712),u}catch(o){return c.error("âŒ Error uploading audio from URL:",o),a(e=>({...e,isProcessing:!1,error:o.message||"Failed to upload audio"})),null}},[e.duration]);y.useEffect(()=>()=>{if(o.current&&(clearInterval(o.current),o.current=null),t.current&&(t.current.getTracks().forEach(e=>{e.stop()}),t.current=null),s.current){try{"recording"===s.current.state&&s.current.stop()}catch(e){}s.current=null}r.current=[],n.current=!1,i.current=0,Oe.stopAllStreams()},[]);const z=e.duration>=We/1e3,R=!e.isRecording&&!e.isProcessing;return{...e,startRecording:p,stopRecording:v,pauseRecording:w,resumeRecording:j,cancelRecording:N,forceCleanup:x,uploadToFirebase:C,uploadToFirebaseFromUrl:S,formatDuration:d,formatSize:u,isNearLimit:z,canRecord:R}})(),[I,T]=y.useState(0),[L,$]=y.useState(new Set),[A,q]=y.useState(()=>({employeeId:v||"",categoryId:w||"",incidentDate:Ke(),incidentTime:Xe(),incidentLocation:"",incidentDescription:"",level:"counselling",issueDate:Ke(),validityPeriod:6})),[F,W]=y.useState(),[U,B]=y.useState(),[H,O]=y.useState(null),[G,Q]=y.useState(!1),[V,Y]=y.useState(null),[X,K]=y.useState([]),[Z,J]=y.useState(!1),[ee,ae]=y.useState(""),[se,re]=y.useState(""),[te,ie]=y.useState([]),[oe,ne]=y.useState(""),[le,ce]=y.useState(""),[me,he]=y.useState([]),[ge,xe]=y.useState({manager:null,employee:null,witness:null,managerName:o}),[Se,ze]=y.useState("employee"),[Re,De]=y.useState(!1),[Ee,He]=y.useState(!1),[Ge,Qe]=y.useState(!1),[Je,aa]=y.useState(""),[sa,ra]=y.useState(""),[ta,ia]=y.useState(""),[oa,na]=y.useState(!1),[la,ca]=y.useState(!1),[da,ma]=y.useState(!0),[ua,ha]=y.useState(!1),[ga,xa]=y.useState(!1),[pa,ya]=y.useState(!1),[va,wa]=y.useState(null),[ba,fa]=y.useState(!1),[ka,ja]=y.useState(null),Na=y.useMemo(()=>V||H?.suggestedLevel||"counselling",[V,H]),Ca=y.useMemo(()=>Ze(Na),[Na]),Sa=y.useMemo(()=>{if(!F)return"";return`${F.profile?.firstName||F.firstName||""} ${F.profile?.lastName||F.lastName||""}`.trim()},[F]),za=y.useMemo(()=>{switch(I){case 0:return!!A.employeeId;case 2:{const e=(A.incidentDescription||"").trim().split(/\s+/).filter(e=>e.length>0);return!!(A.incidentDate&&A.incidentTime&&A.incidentLocation?.length>=3&&e.length>=6)}case 1:return!(!A.categoryId||G||Z);case 3:return!Ca.requiresCommitments||ee.length>=20;case 4:return se.length>=20;case 5:return!Ca.requiresCommitments||!!(te.length>0&&oe&&A.issueDate);case 6:return!0;case 7:return Ge&&Ee;case 8:return!!(ge.manager&&Re&&(ge.employee||ge.witness)&&F&&U&&C?.id);case 9:return!!sa;default:return!1}},[I,A,H,G,Z,Ca,ee,se,te,oe,Ge,Ee,ge,sa,Re,F,U,C?.id]);y.useEffect(()=>{if(A.employeeId){const e=r.find(e=>e.id===A.employeeId);W(e),e&&C?.id&&p.warnings.getActiveWarnings(e.id,C.id).then(e=>K(e)).catch(e=>c.error("Failed to load warning history:",e))}},[A.employeeId,r,C?.id]),y.useEffect(()=>{if(A.categoryId){const e=t.find(e=>e.id===A.categoryId);B(e)}},[A.categoryId,t]),y.useEffect(()=>{A.employeeId&&A.categoryId&&C?.id&&!G&&Ra()},[A.employeeId,A.categoryId,C?.id]),y.useEffect(()=>{!ua||R.isRecording||da||R.startRecording().catch(e=>{c.error("Failed to start audio recording:",e)})},[ua,da]);const Ra=async()=>{if(A.employeeId&&A.categoryId&&C?.id){Q(!0);try{const e=X.length>0?X:await p.warnings.getActiveWarnings(A.employeeId,C.id);if(e.some(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===A.categoryId))return J(!0),void Q(!1);const a=await p.warnings.getEscalationRecommendation(A.employeeId,A.categoryId,C.id,U,e);O(a),q(e=>({...e,level:a.suggestedLevel}))}catch(e){c.error("Failed to generate LRA recommendation:",e);const a=U?.escalationPath||["counselling","verbal_warning","first_written","final_written"],s={suggestedLevel:a[0]||"counselling",recommendedLevel:"counselling"===a[0]?"Counselling Session":"verbal_warning"===a[0]?"Verbal Warning":"Counselling Session",reason:"Unable to analyze history - using default first step.",activeWarnings:[],escalationPath:a,isEscalation:!1,category:U?.name||"General Misconduct",categoryId:A.categoryId,warningCount:0};O(s),q(e=>({...e,level:s.suggestedLevel}))}finally{Q(!1)}}},Ia=y.useCallback(()=>{I>0&&T(I-1)},[I]),Da=y.useCallback(()=>{za&&I<9&&($(e=>new Set([...e,I])),T(I+1))},[I,za]),Ta=y.useCallback(e=>{(e<=I||L.has(e))&&T(e)},[I,L]),Ea=y.useCallback(e=>{xe(a=>({...a,manager:e}))},[]),La=y.useCallback(e=>Promise.resolve(pe(e)),[]),Pa=y.useCallback(async e=>{if("witness"===Se)if(e)try{const a=await La(e);xe(e=>({...e,witness:a,employee:null}))}catch(a){c.error("Failed to apply witness watermark:",a),xe(a=>({...a,witness:e,employee:null}))}else xe(e=>({...e,witness:null}));else xe(a=>({...a,employee:e,witness:null}))},[Se,La]),$a=y.useCallback(()=>{R.isRecording&&R.forceCleanup(),d()},[R,d]),Aa=Ye[I];return da&&!ua?a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9000] flex items-center justify-center p-4",children:a.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:a.jsx(Ve,{onPermissionGranted:()=>{ha(!0),ma(!1)},onPermissionDenied:()=>ma(!1),onSkip:()=>ma(!1)})})}):a.jsxs("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9000] flex items-center justify-center p-4",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"enhanced-warning-wizard-container p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"Issue Warning"}),R.isRecording&&a.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full",style:{backgroundColor:"rgba(239, 68, 68, 0.1)"},children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),a.jsx("span",{className:"text-xs font-medium",style:{color:"#ef4444"},children:R.formatDuration(R.duration)})]})]}),a.jsx("button",{onClick:$a,className:"p-2 rounded-lg hover:bg-gray-100",children:a.jsx(P,{className:"w-5 h-5"})})]}),a.jsx(we,{currentPhase:I,totalPhases:10,completedPhases:L,onPhaseClick:Ta}),a.jsxs(i,{padding:"md",className:"mt-4",children:[a.jsx(be,{title:Aa.title,icon:Aa.icon,phaseNumber:I+1,totalPhases:10,employeeName:I>0?Sa:void 0,incidentDate:I>1?A.incidentDate:void 0}),a.jsx(fe,{children:Aa.guidance}),(()=>{switch(I){case 0:return a.jsx("div",{className:"space-y-4",children:a.jsx(je,{employees:r,selectedEmployeeId:A.employeeId,onEmployeeSelect:e=>q(a=>({...a,employeeId:e})),warningHistory:X})});case 2:return a.jsx(Ce,{formData:A,onFormDataChange:e=>q(a=>({...a,...e}))});case 1:return a.jsxs("div",{className:"space-y-4",children:[a.jsx(Ne,{categories:t,selectedCategoryId:A.categoryId,onCategorySelect:e=>{q(a=>({...a,categoryId:e})),O(null)},lraRecommendation:H}),G&&a.jsx(h,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-primary border-t-transparent rounded-full"}),a.jsx("span",{children:"Analyzing warning history..."})]})}),H&&!G&&a.jsx(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(M,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"var(--color-primary)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text-primary)"},children:["Recommended: ",H.recommendedLevel||Ze(H.suggestedLevel).label]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:H.reason}),H.activeWarnings&&H.activeWarnings.length>0&&a.jsxs("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("p",{className:"text-xs font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:["Active Warnings (",H.activeWarnings.length,"):"]}),a.jsxs("div",{className:"space-y-1",children:[H.activeWarnings.slice(0,3).map((e,s)=>a.jsxs("button",{onClick:()=>ja(e),className:"w-full text-left text-xs flex items-center gap-2 p-1.5 rounded hover:bg-gray-100 transition-colors cursor-pointer",style:{color:"var(--color-text-secondary)"},children:[a.jsx(_,{className:"w-3 h-3 flex-shrink-0",style:{color:"var(--color-warning)"}}),a.jsxs("span",{className:"hover:underline",children:[Ze(e.level||e.suggestedLevel).label," - ",e.categoryName||e.category||"General",e.issueDate&&` (${new Date(e.issueDate).toLocaleDateString("en-ZA")})`]})]},s)),H.activeWarnings.length>3&&a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:["+",H.activeWarnings.length-3," more warnings"]})]})]}),(!H.activeWarnings||0===H.activeWarnings.length)&&a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[a.jsx(D,{className:"w-3 h-3",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-success)"},children:"No active warnings on file"})]}),H.isEscalation&&a.jsxs("div",{className:"mt-2 px-2 py-1 rounded text-xs inline-flex items-center gap-1",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:[a.jsx(_,{className:"w-3 h-3"}),"Escalation from previous warning"]})]})]})}),Z&&a.jsx(h,{variant:"error",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(_,{className:"w-5 h-5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("strong",{children:"HR Intervention Required"}),a.jsx("p",{className:"text-sm mt-1",children:"This employee has a final warning on file. Contact HR before proceeding."})]})]})})]});case 3:return a.jsxs("div",{className:"space-y-4",children:[!Ca.requiresCommitments&&a.jsxs(h,{variant:"info",children:["For ",Ca.label," warnings, this section is optional."]}),a.jsx("textarea",{value:ee,onChange:e=>ae(e.target.value),placeholder:"Record the employee's response to the incident discussion...",rows:6,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}}),a.jsxs("div",{className:"flex items-center justify-between text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsxs("span",{children:[ee.length,"/20 characters minimum"]}),ee.length>=20&&a.jsx(D,{className:"w-4 h-4 text-green-500"})]})]});case 4:return a.jsxs("div",{className:"space-y-4",children:[a.jsx("textarea",{value:se,onChange:e=>re(e.target.value),placeholder:"Document the expected behavior, performance, or conduct standards...",rows:6,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}}),a.jsxs("div",{className:"flex items-center justify-between text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsxs("span",{children:[se.length,"/20 characters minimum"]}),se.length>=20&&a.jsx(D,{className:"w-4 h-4 text-green-500"})]})]});case 5:return a.jsxs("div",{className:"space-y-4",children:[!Ca.requiresCommitments&&a.jsxs(h,{variant:"info",children:["For ",Ca.label," warnings, improvement commitments are optional."]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Action Commitments"}),te.map((e,s)=>a.jsxs("div",{className:"flex gap-2 mb-2",children:[a.jsx("input",{type:"text",value:e.commitment,onChange:e=>{const a=[...te];a[s].commitment=e.target.value,ie(a)},placeholder:"What will be done...",className:"flex-1 px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}}),a.jsx("input",{type:"text",value:e.timeline,onChange:e=>{const a=[...te];a[s].timeline=e.target.value,ie(a)},placeholder:"By when...",className:"w-32 px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}}),a.jsx("button",{onClick:()=>ie(te.filter(a=>a.id!==e.id)),className:"p-2 text-red-500 hover:bg-red-50 rounded",children:a.jsx(P,{className:"w-4 h-4"})})]},e.id)),a.jsx(s,{variant:"outline",size:"sm",onClick:()=>ie([...te,{id:`commitment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,commitment:"",timeline:""}]),children:"+ Add Commitment"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Follow-up Review Date"}),a.jsx("input",{type:"date",value:oe,onChange:e=>ne(e.target.value),min:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Issue Date"}),a.jsx("input",{type:"date",value:A.issueDate,onChange:e=>q(a=>({...a,issueDate:e.target.value})),className:"w-full px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Validity Period"}),a.jsxs("select",{value:A.validityPeriod,onChange:e=>q(a=>({...a,validityPeriod:parseInt(e.target.value)})),className:"w-full px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},children:[a.jsx("option",{value:3,children:"3 months"}),a.jsx("option",{value:6,children:"6 months"}),a.jsx("option",{value:12,children:"12 months"})]})]})]})]});case 6:return a.jsxs("div",{className:"space-y-3",children:[a.jsx(h,{variant:"success",children:"Review all information below. Click any section to edit."}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(ea,{title:"Employee",onClick:()=>Ta(0),children:Sa||"Not selected"}),a.jsxs(ea,{title:"Incident",onClick:()=>Ta(2),children:[A.incidentDate," at ",A.incidentTime," - ",A.incidentLocation]}),a.jsxs(ea,{title:"Category",onClick:()=>Ta(1),children:[U?.name||"Not selected"," â†’ ",Ca.label]}),Ca.requiresCommitments&&a.jsxs(a.Fragment,{children:[a.jsxs(ea,{title:"Employee Response",onClick:()=>Ta(3),children:[ee.substring(0,100),ee.length>100?"...":""]}),a.jsxs(ea,{title:"Expected Standards",onClick:()=>Ta(4),children:[se.substring(0,100),se.length>100?"...":""]}),a.jsxs(ea,{title:"Improvement Plan",onClick:()=>Ta(5),children:[te.length," commitment(s) - Review: ",oe||"Not set"]})]})]})]});case 7:return a.jsxs("div",{className:"space-y-4",children:[a.jsxs(i,{padding:"md",className:"border",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Read this completely to ensure your employee understands their rights."})," This script covers all legal requirements and communicates the warning clearly."]}),a.jsx(Ie,{employeeName:Sa||"Employee",managerName:o,categoryName:U?.name||"General Misconduct",incidentDescription:A.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:Na,validityPeriod:A.validityPeriod,onScriptRead:()=>Qe(!0),disabled:Ge,activeWarnings:H?.activeWarnings,issuedDate:A.issueDate})]}),Ge&&a.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-success-bg)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Script has been read to the employee"})]})}),a.jsx("div",{className:"p-3 rounded-lg border transition-all",style:{backgroundColor:Ee?"var(--color-alert-success-bg)":"var(--color-card-background)",borderColor:Ee?"var(--color-success)":"var(--color-border-light)",opacity:Ge?1:.6},children:a.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:Ee,onChange:e=>He(e.target.checked),disabled:!Ge,className:"w-5 h-5 mt-0.5 rounded flex-shrink-0",style:{accentColor:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"I confirm the employee has reviewed and understands this warning"}),a.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:"The employee understands the nature of the misconduct and their right to representation under the Labour Relations Act."})]})]})})]});case 8:return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Step 1: Manager Signature"})]}),ge.manager&&a.jsx(D,{className:"w-5 h-5",style:{color:"var(--color-success)"}})]}),a.jsx(Te,{onSignatureComplete:Ea,disabled:la,label:"Manager Signature",placeholder:"Sign here",initialSignature:ge.manager,width:300,height:100,signerName:o})]}),ge.manager&&a.jsxs("div",{className:"space-y-3",children:[a.jsx(i,{padding:"md",hover:!0,className:"cursor-pointer transition-all duration-200 active:scale-95",onClick:()=>xa(!0),style:{border:"2px dashed var(--color-primary)",backgroundColor:"var(--color-primary-light)"},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(de,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("span",{className:"font-semibold text-sm block",style:{color:"var(--color-primary)"},children:"Step 2: Preview Warning PDF"}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Pass device to employee to review the complete document"})]})]}),a.jsx(ue,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})]})}),a.jsx("div",{className:"p-3 rounded-lg border transition-all",style:{backgroundColor:Re?"var(--color-alert-success-bg)":"var(--color-card-background)",borderColor:Re?"var(--color-success)":"var(--color-border-light)"},children:a.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:Re,onChange:e=>De(e.target.checked),className:"w-5 h-5 mt-0.5 rounded flex-shrink-0",style:{accentColor:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"I have reviewed the warning document"}),a.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:"Employee confirms they have viewed and understood the complete PDF document"})]})]})})]}),ge.manager&&Re&&a.jsxs("div",{className:"rounded-lg p-3",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["Step 3: ","employee"===Se?"Employee":"Witness"," Signature"]})]}),(ge.employee||ge.witness)&&a.jsx(D,{className:"w-5 h-5",style:{color:"var(--color-success)"}})]}),a.jsxs("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border-light)"},children:[a.jsx("div",{className:"text-xs font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Signature Type:"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"signatureType",value:"employee",checked:"employee"===Se,onChange:()=>ze("employee"),className:"w-4 h-4",style:{accentColor:"var(--color-success)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-primary)"},children:"Employee Signature"})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"signatureType",value:"witness",checked:"witness"===Se,onChange:()=>ze("witness"),className:"w-4 h-4",style:{accentColor:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-primary)"},children:"Witness Signature"})]})]}),a.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"employee"===Se?"Employee signs to acknowledge the warning":"Use witness if employee refuses to sign"})]}),a.jsx(Te,{onSignatureComplete:Pa,disabled:la,label:"employee"===Se?"Employee Signature":"Witness Signature",placeholder:"Sign here",initialSignature:ge.employee||ge.witness,width:300,height:100,signerName:Sa})]}),!ge.manager&&a.jsx("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-warning)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(_,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-alert-warning-text)"},children:"Manager must sign first before proceeding"})]})})]});case 9:return a.jsxs("div",{className:"space-y-4",children:[a.jsx(h,{variant:"success",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"w-5 h-5"}),a.jsxs("span",{children:["Warning saved successfully! ID: ",ta]})]})}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:["email","whatsapp","printed","qr"].map(s=>a.jsx("button",{onClick:()=>{"qr"===s?(async()=>{if(C?.id&&F&&U){fa(!0),ra("qr");try{const{PDFGenerationService:a}=await e(async()=>{const{PDFGenerationService:e}=await import("./dashboard-router-DriKLXjX.js").then(e=>e.e);return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7])),{transformWarningDataForPDF:s}=await e(async()=>{const{transformWarningDataForPDF:e}=await import("./warning-components-D4Kh8JfB.js").then(e=>e.p);return{transformWarningDataForPDF:e}},__vite__mapDeps([8,1,2,3,4,5,0,6,7])),r={id:ta,organizationId:C.id,level:Na,category:U.name,description:A.incidentDescription,incidentDate:A.incidentDate,incidentTime:A.incidentTime,incidentLocation:A.incidentLocation,issueDate:A.issueDate,validityPeriod:A.validityPeriod,signatures:{manager:ge.manager,employee:ge.employee,witness:ge.witness,managerName:o,employeeName:Sa,signedAt:(new Date).toISOString()},employeeStatement:ee,expectedBehaviorStandards:se,actionSteps:te.map(e=>({action:e.commitment,timeline:e.timeline})),reviewDate:oe,disciplineRecommendation:H,pdfGeneratorVersion:ye},t=await s(r,F,C),i=await a.generateWarningPDF(t,t.pdfGeneratorVersion,t.pdfSettings);wa(i),ya(!0),c.success("PDF generated for QR code delivery")}catch(a){c.error("Failed to generate PDF for QR code:",a),alert("Failed to generate PDF for QR code. Please try again.")}finally{fa(!1)}}else c.error("Missing data for QR code generation")})():ra(s)},disabled:"qr"===s&&ba,className:`\n                    p-4 rounded-lg border text-center transition-all\n                    ${sa===s?"ring-2 ring-primary":""}\n                    ${"qr"===s&&ba?"opacity-50 cursor-wait":""}\n                  `,style:{borderColor:sa===s?"var(--color-primary)":"var(--color-border)",backgroundColor:sa===s?"var(--color-primary-light)":"var(--color-background)"},children:a.jsx("span",{className:"text-sm font-medium capitalize",style:{color:"var(--color-text-primary)"},children:"qr"===s?ba?"Generating...":"QR Code":s})},s))})]});default:return null}})(),a.jsx(ke,{currentPhase:I,totalPhases:10,isValid:za,isLoading:la||oa,onPrevious:Ia,onNext:8===I?async()=>{if(C?.id)if(F)if(U){A.employeeId,A.categoryId,ca(!0);try{const a={organizationId:C.id,employeeId:A.employeeId,categoryId:A.categoryId,categoryName:U.name,level:Na,incidentDescription:A.incidentDescription,incidentDate:A.incidentDate,incidentTime:A.incidentTime,incidentLocation:A.incidentLocation,issueDate:A.issueDate,validityPeriod:A.validityPeriod,employeeName:Sa,employeeLastName:F.profile?.lastName||F.lastName||"",employeeNumber:F.profile?.employeeNumber||F.employeeNumber||"",employeeDepartment:F.employment?.department||F.department||"",employeePosition:F.employment?.position||F.position||"",issuedBy:N?.uid||"",issuedByName:o,signatures:{manager:ge.manager,employee:ge.employee||null,witness:ge.witness||null,managerName:ge.managerName||o,..."employee"===Se&&{employeeName:Sa},..."witness"===Se&&ge.witnessName&&{witnessName:ge.witnessName},signedAt:(new Date).toISOString()},employeeStatement:ee,expectedBehaviorStandards:se,actionSteps:te.map(e=>({action:e.commitment,timeline:e.timeline})),reviewDate:oe,interventionDetails:le,resourcesProvided:me,disciplineRecommendation:H,wasOverridden:!!V,originalRecommendedLevel:H?.suggestedLevel,pdfGeneratorVersion:ye,status:"issued",createdAt:new Date,createdBy:N?.uid};Object.keys(a);const s=await p.warnings.create(a);if(c.success("Warning created with ID:",s),ia(s),R.isRecording)try{if(await R.stopRecording()&&s){const e=await R.uploadToFirebase(C.id,s);if(e){const a=S(u,"organizations",C.id,"warnings",s);await z(a,{audioRecordingUrl:e,audioMetadata:{recordedBy:N?.uid,recordedByName:o,recordedAt:(new Date).toISOString(),duration:R.duration||0}}),c.success("Audio uploaded successfully:",e)}}}catch(e){c.error("Failed to upload audio recording:",e)}$(e=>new Set([...e,8])),T(9),c.success("Warning saved successfully:",s)}catch(a){c.error("Failed to save warning:",a),c.error("Error details:",{message:a?.message,code:a?.code,stack:a?.stack?.substring(0,500)}),alert(`Failed to save warning: ${a?.message||"Unknown error"}`)}finally{ca(!1)}}else c.error("Cannot save warning: No category selected",{categoryId:A.categoryId});else c.error("Cannot save warning: No employee selected",{employeeId:A.employeeId});else c.error("Cannot save warning: No organization ID")}:Da,customNextText:8===I?"Save Warning":void 0,showFinalize:9===I,onFinalize:async()=>{if(sa&&ta){na(!0);try{c.success("Warning finalized with delivery method:",sa),setTimeout(()=>{l()},1500)}catch(e){c.error("Failed to finalize:",e)}finally{na(!1)}}}})]})]})}),a.jsx(ve,{isOpen:ga,onClose:()=>xa(!1),warningData:{wizardState:{currentStep:I,selectedEmployee:F,selectedCategory:U,formData:{...A,employeeStatement:ee,expectedBehaviorStandards:se,actionSteps:te.map(e=>({action:e.commitment,timeline:e.timeline})),reviewDate:oe,interventionDetails:le,resourcesProvided:me},signatures:ge,lraRecommendation:H,organizationId:C?.id||""},selectedEmployee:F,selectedCategory:U,organizationId:C?.id},title:"Warning Document Preview"}),va&&a.jsx(Le,{isOpen:pa,onClose:()=>ya(!1),pdfBlob:va,filename:`Warning_${U?.name||"Document"}_${Sa}_${A.issueDate}.pdf`,employeeId:A.employeeId,warningId:ta,organizationId:C?.id,employeeName:Sa}),ka&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9100] flex items-center justify-center p-4",onClick:()=>ja(null),children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-4",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--color-text)"},children:"Warning Details"}),a.jsx("button",{onClick:()=>ja(null),className:"p-1 hover:bg-gray-100 rounded",children:a.jsx(P,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Level"}),a.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:Ze(ka.level||ka.suggestedLevel).label})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Category"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:ka.categoryName||ka.category||"General"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:ka.issueDate?new Date(ka.issueDate).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}):"Not recorded"})]}),ka.expiryDate&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Expiry Date"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:new Date(ka.expiryDate).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})})]}),ka.description&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Description"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:ka.description})]}),ka.issuedByName&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issued By"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:ka.issuedByName})]})]}),a.jsx("button",{onClick:()=>ja(null),className:"w-full mt-4 py-2 px-4 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-primary)",color:"white"},children:"Close"})]})})]})},ea=({title:e,onClick:s,children:r})=>a.jsxs("button",{onClick:s,className:"w-full text-left p-3 rounded-lg border hover:bg-gray-50 transition-colors",style:{borderColor:"var(--color-border)"},children:[a.jsx("span",{className:"text-xs font-semibold uppercase",style:{color:"var(--color-text-secondary)"},children:e}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-primary)"},children:r})]});export{Je as UnifiedWarningWizard,Je as default};
