import{A as e,L as s,j as t,u as a,D as r,a as l}from"./business-owner-dashboard-Cw2S2b3C.js";import{r as n,R as i}from"./react-vendor-BMk1H4su.js";import{u as o,Z as d,U as c,d as m,g as x,a as p,L as h}from"./dashboard-router-DriKLXjX.js";import{c as g,f as u,a as b,b as y,g as f,d as j,e as N,h as v}from"./employee-BVTMyN2H.js";import{D as w}from"./hr-dashboard-DCNKcWEX.js";import{a as k}from"./warning-components-D4Kh8JfB.js";import{X as C,ah as S,ag as D,w as E,L as A,af as I,U as $,E as M,aQ as P,B as T,t as F,S as L,ae as R,g as z,C as O,aR as W,W as U,az as V,a8 as B,aS as q,aT as H,q as _,r as J,n as Y,O as Q,Q as G,Z,ay as K,aU as X,a4 as ee}from"./ui-vendor-DjDr2yFV.js";import"./pdf-vendor-CbrIsI36.js";import"./firebase-vendor-BIBOIkWK.js";import"./hod-dashboard-BWpKy7JX.js";const se=({employees:e})=>{const s=b(e),a=[{value:s.total,label:"Total Employees",color:"blue",icon:"ðŸ‘¥"},{value:s.active,label:"Active",color:"green",icon:"âœ…"},{value:s.onProbationWithWarnings,label:"On Probation, With Warnings",color:"red",icon:"âš ï¸"}];return t.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:a.map((e,s)=>t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-2 sm:p-3 text-center shadow-md hover:shadow-lg transition-all duration-200",children:[t.jsx("div",{className:"text-lg sm:text-xl mb-0.5 sm:mb-1",children:e.icon}),t.jsx("div",{className:`text-lg sm:text-xl font-bold text-${e.color}-600 mb-0.5 sm:mb-1`,children:e.value}),t.jsx("div",{className:"text-xs text-gray-600 font-medium leading-tight",children:e.label})]},s))})},te=({filters:e,setFilters:s,departments:a,viewMode:r,setViewMode:l})=>t.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl p-6 mb-8 shadow-xl",children:t.jsx("div",{className:"flex flex-col gap-4",children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[t.jsx("div",{className:"flex-1",children:t.jsx("input",{type:"text",placeholder:"ðŸ” Search employees by name, number, or email...",value:e.search,onChange:t=>s({...e,search:t.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"})}),t.jsxs("select",{value:e.department,onChange:t=>s({...e,department:t.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[t.jsx("option",{value:"",children:"All Departments"}),a.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:e.contractType,onChange:t=>s({...e,contractType:t.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[t.jsx("option",{value:"",children:"All Contract Types"}),t.jsx("option",{value:"permanent",children:"Permanent"}),t.jsx("option",{value:"contract",children:"Contract"}),t.jsx("option",{value:"temporary",children:"Temporary"})]}),t.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[t.jsx("input",{type:"checkbox",checked:e.hasWarnings,onChange:t=>s({...e,hasWarnings:t.target.checked}),className:"w-4 h-4"}),t.jsx("span",{className:"font-medium text-gray-700",children:"Has Warnings"})]}),t.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[t.jsx("input",{type:"checkbox",checked:e.isActive,onChange:t=>s({...e,isActive:t.target.checked}),className:"w-4 h-4"}),t.jsx("span",{className:"font-medium text-gray-700",children:"Active Only"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>l("table"),className:"px-4 py-3 rounded-xl font-medium transition-all "+("table"===r?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ðŸ“‹ Table"}),t.jsx("button",{onClick:()=>l("cards"),className:"px-4 py-3 rounded-xl font-medium transition-all "+("cards"===r?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"ðŸ“± Cards"})]})]})})}),ae=({employee:e,permissions:s,onEdit:a,onArchive:r,onViewWarnings:l,onView:n})=>{const i=(()=>{if(!e.employment?.probationEndDate)return null;const s=new Date(e.employment.probationEndDate),t=new Date,a=Math.ceil((s.getTime()-t.getTime())/864e5);return a<=0?null:{daysLeft:a,status:a<=7?"critical":a<=30?"warning":"normal"}})(),o=e.disciplinaryRecord?.activeWarnings||0,d=s.canEdit||n;return t.jsxs("div",{className:`\n        bg-white rounded-lg border border-gray-200 overflow-hidden\n        transition-all duration-200 hover:shadow-md\n        ${e.isActive?"":"opacity-60"}\n      `,onClick:d?()=>{s.canEdit?a(e):n&&n(e)}:void 0,style:{cursor:d?"pointer":"default"},children:[t.jsxs("div",{className:"px-3 py-2.5 sm:px-4 sm:py-4",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("h3",{className:"text-base font-bold text-gray-900 truncate leading-tight",children:[e.profile.firstName," ",e.profile.lastName]}),t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e.profile?.position||"N/A"})]}),o>0&&t.jsxs("div",{className:`\n              flex items-center gap-1 px-2 py-1 rounded-full flex-shrink-0\n              ${o>=3?"bg-red-100":"bg-yellow-100"}\n            `,children:[t.jsx("span",{className:"text-sm",children:"âš ï¸"}),t.jsx("span",{className:`\n                text-xs font-bold\n                ${o>=3?"text-red-700":"text-yellow-700"}\n              `,children:o})]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 mb-2",children:[t.jsx("span",{className:"truncate",children:e.profile?.department||"N/A"}),t.jsx("span",{className:"text-gray-400",children:"â€¢"}),t.jsxs("span",{className:"flex-shrink-0",children:["#",e.profile.employeeNumber]})]}),t.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.jsxs("span",{className:`\n            inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full\n            ${e.isActive?"bg-green-50 text-green-700":"bg-gray-100 text-gray-600"}\n          `,children:[t.jsx("span",{className:"w-1.5 h-1.5 rounded-full ${employee.isActive ? 'bg-green-500' : 'bg-gray-400'}"}),e.isActive?"Active":"Archived"]}),t.jsx("span",{className:`\n            inline-flex px-2 py-1 text-xs font-medium rounded-full capitalize\n            ${"permanent"===e.employment?.contractType?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700"}\n          `,children:e.employment?.contractType||"N/A"}),i&&e.isActive&&t.jsxs("span",{className:`\n              inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full\n              ${"critical"===i.status?"bg-red-50 text-red-700":"warning"===i.status?"bg-orange-50 text-orange-700":"bg-blue-50 text-blue-700"}\n            `,children:["â³ ",i.daysLeft,"d"]}),0===o&&t.jsxs("span",{className:"hidden sm:inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-green-50 text-green-700",children:[t.jsx("span",{className:"text-xs",children:"âœ“"})," Clean Record"]})]})]}),t.jsxs("div",{className:"border-t border-gray-100 px-3 py-2 sm:px-4 sm:py-2 bg-gray-50/50",children:[o>0&&l&&t.jsxs("button",{onClick:s=>{s.stopPropagation(),l(e)},className:"w-full mb-2 py-2 sm:py-2.5 px-3 bg-amber-50 border border-amber-200 text-amber-700 rounded-lg hover:bg-amber-100 font-medium transition-colors text-sm active:scale-95 flex items-center justify-center gap-2",children:[t.jsx("span",{children:"âš ï¸"}),t.jsxs("span",{children:["View ",o," Active Warning",1!==o?"s":""]})]}),s.canEdit&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:s=>{s.stopPropagation(),a(e)},className:"flex-1 py-2 sm:py-2.5 px-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors text-sm active:scale-95",children:"Edit Details"}),e.isActive&&s.canArchive&&t.jsx("button",{onClick:s=>{s.stopPropagation(),r(e)},className:"px-3 py-2 sm:py-2.5 border border-gray-300 bg-white text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors text-sm active:scale-95",children:"Archive"})]})]})]})},re=({employee:l,onClose:i,onSave:c,basicMode:m=!1})=>{const{organization:x,user:p}=a(),[h,g]=n.useState({employeeNumber:"",firstName:"",lastName:"",email:"",phoneNumber:"",whatsappNumber:"",department:"",position:"",startDate:"",contractType:"permanent",probationEndDate:"",managerIds:[],managerId:"",isActive:!0}),[u,b]=n.useState(null),[N,v]=n.useState(!1),[$,M]=n.useState([]),[P,T]=n.useState(!1),[F,L]=n.useState([]),[R,z]=n.useState(!1);o(!0);const{containerRef:O,ariaProps:W}=k({isOpen:!0,onClose:i,titleId:"employee-form-title",descriptionId:"employee-form-description"});n.useEffect(()=>{(async()=>{if(x)try{T(!0);const e=await r.queryDocuments(x.id,"users",[]),s=e.documents.filter(e=>{const s="string"==typeof(t=e.role)?t:t?.id||"";var t;return"hod-manager"===s||"hr-manager"===s||"executive-management"===s});M(s)}catch(e){s.error("Failed to load managers:",e)}finally{T(!1)}})()},[x]),n.useEffect(()=>{(async()=>{if(x)try{z(!0);const e=await w.getDepartments(x.id);L(e)}catch(e){s.error("Failed to load departments:",e)}finally{z(!1)}})()},[x]),n.useEffect(()=>{if(l){const e=y(l);g(e)}else if(m&&x){const e=(new Date).toISOString().split("T")[0];g(s=>({...s,employeeNumber:f(x.id),department:p?.departmentIds?.[0]||p?.profile?.department||"Operations",startDate:e,managerIds:p?.id?[p.id]:[],managerId:p?.id||"",isActive:!0}))}},[l,m,x,p]);return t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:d.modal},onClick:e=>{e.target===e.currentTarget&&i()},children:t.jsxs("div",{ref:O,...W,className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 flex-shrink-0",children:[t.jsxs("div",{children:[t.jsx("h2",{id:"employee-form-title",className:"text-xl font-bold text-slate-800",children:l?"Edit Employee":m?"Quick Add Employee":"Add New Employee"}),t.jsx("p",{id:"employee-form-description",className:"text-sm text-slate-600 mt-1",children:m?"Basic details only - HR can complete the full profile later":"Fill in the employee details below"})]}),t.jsx("button",{type:"button",onClick:i,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors","aria-label":"Close employee form modal",children:t.jsx(C,{className:"w-5 h-5"})})]}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),x){v(!0),b(null);try{if(l){const s={...l,profile:{...l.profile,employeeNumber:h.employeeNumber,firstName:h.firstName,lastName:h.lastName,email:h.email||"",phoneNumber:h.phoneNumber||null,whatsappNumber:h.whatsappNumber||null,department:h.department||"",position:h.position,startDate:h.startDate?new Date(h.startDate):new Date},employment:{...l.employment,contractType:h.contractType,department:h.department||"",managerIds:h.managerIds||[],...h.managerIds?.[0]&&{managerId:h.managerIds[0]},...h.probationEndDate&&{probationEndDate:new Date(h.probationEndDate)}},isActive:l.isActive,updatedAt:new Date};await e.employees.update(l.id,x.id,s),l.id}else{const s=j(h,x.id),{id:t,...a}=s;await e.employees.create(a)}c()}catch(a){s.error("Error saving employee:",a),b(a.message||"Failed to save employee")}finally{v(!1)}}},className:"flex flex-col flex-1 min-h-0",children:[t.jsxs("div",{className:"overflow-y-auto flex-1 p-6 space-y-6",children:[u&&t.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:t.jsx("p",{className:"text-red-800 text-sm",children:u})}),t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[t.jsx(S,{className:"w-5 h-5 text-blue-600"}),"Personal Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Employee Number *"}),t.jsx("input",{type:"text",required:!0,value:h.employeeNumber,onChange:e=>g({...h,employeeNumber:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none "+(m?"bg-slate-50":""),placeholder:"EMP001",readOnly:m,title:m?"Auto-generated - HR can change this later":""})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Start Date *"}),t.jsx("input",{type:"date",required:!0,value:h.startDate,onChange:e=>g({...h,startDate:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"First Name *"}),t.jsx("input",{type:"text",required:!0,value:h.firstName,onChange:e=>g({...h,firstName:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"John"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Last Name *"}),t.jsx("input",{type:"text",required:!0,value:h.lastName,onChange:e=>g({...h,lastName:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Doe"})]}),!m&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Address (Optional)"}),t.jsx("input",{type:"email",value:h.email,onChange:e=>g({...h,email:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"john.doe@company.com"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Phone Number *"}),t.jsx("input",{type:"tel",required:!0,value:h.phoneNumber,onChange:e=>g({...h,phoneNumber:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})]})]})]}),t.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[t.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[t.jsx(D,{className:"w-5 h-5 text-emerald-600"}),"Work Information"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[!m&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department (Optional)"}),t.jsxs("select",{value:h.department,onChange:e=>g({...h,department:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",disabled:R,children:[t.jsx("option",{value:"",children:"Select Department"}),F.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]}),R&&t.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading departments..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Position / Job Title *"}),t.jsx("input",{type:"text",required:!0,value:h.position,onChange:e=>g({...h,position:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"HR Manager"})]}),!m&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Contract Type *"}),t.jsxs("select",{required:!0,value:h.contractType,onChange:e=>g({...h,contractType:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",children:[t.jsx("option",{value:"permanent",children:"Permanent"}),t.jsx("option",{value:"contract",children:"Contract"}),t.jsx("option",{value:"temporary",children:"Temporary"}),t.jsx("option",{value:"intern",children:"Intern"})]})]}),t.jsxs("div",{className:m?"md:col-span-1":"md:col-span-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Reporting Manager",m?" *":"s (Select one or more)"]}),P?t.jsx("div",{className:"text-sm text-gray-500 p-3 border border-slate-200 rounded-lg",children:"Loading managers..."}):0===$.length?t.jsx("div",{className:"text-sm text-slate-500 p-3 border border-slate-200 rounded-lg",children:"No managers available in organization"}):t.jsx("div",{className:"border border-slate-200 rounded-lg max-h-48 overflow-y-auto",children:$.map(e=>{const s=h.managerIds?.includes(e.id)||!1;return t.jsxs("label",{className:"flex items-center gap-3 p-3 hover:bg-slate-50 cursor-pointer border-b border-slate-100 last:border-b-0 transition-colors",children:[t.jsx("input",{type:"checkbox",checked:s,onChange:s=>{const t=h.managerIds||[],a=s.target.checked?[...t,e.id]:t.filter(s=>s!==e.id);g({...h,managerIds:a,managerId:a[0]||""})},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"text-sm font-medium text-slate-800",children:[e.firstName," ",e.lastName]}),t.jsx("div",{className:"text-xs text-slate-500",children:"string"==typeof e.role?e.role:e.role?.name})]})]},e.id)})}),t.jsx("p",{className:"text-xs text-slate-500 mt-2",children:h.managerIds&&h.managerIds.length>0?`${h.managerIds.length} manager${1!==h.managerIds.length?"s":""} selected`:m?"Required - select the reporting manager":"No managers selected - employee will report to HR"})]}),!m&&t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Probation End Date (Optional)"}),t.jsx("input",{type:"date",value:h.probationEndDate,onChange:e=>g({...h,probationEndDate:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Leave empty if no probation period"}),t.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Typical probation periods are 3-6 months for new hires"})]})]})]}),!m&&t.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[t.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[t.jsx(E,{className:"w-5 h-5 text-amber-600"}),"Communication Preferences"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"WhatsApp Number"}),t.jsx("input",{type:"tel",value:h.whatsappNumber,onChange:e=>g({...h,whatsappNumber:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})})]})]}),t.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-200 flex-shrink-0",children:[t.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:N,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:N?t.jsxs(t.Fragment,{children:[t.jsx(A,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(I,{className:"w-4 h-4"}),l?"Update Employee":"Add Employee"]})})]})]})]})})},le=({onClose:r,onImportComplete:l})=>{const{organization:i}=a(),{csvData:c,importResult:m,isImporting:x,importProgress:p,currentImportStep:h,handleFileUpload:g,handleImport:u,resetImport:b}=(()=>{const[t,a]=n.useState(null),[r,l]=n.useState([]),[i,o]=n.useState(null),[d,c]=n.useState(!1),[m,x]=n.useState(0),[p,h]=n.useState(""),g=e=>{if(!e)return"";let s=e.replace(/[\s\-\(\)]/g,"");return s.startsWith("0")?s="+27"+s.substring(1):s.startsWith("27")&&!s.startsWith("+27")?s="+"+s:s.startsWith("+")||s.startsWith("27")||(s="+27"+s),s},u=e=>{if(!e)return null;const s=e.trim(),t=e=>parseInt(e)<=29?`20${e.padStart(2,"0")}`:`19${e.padStart(2,"0")}`,a=s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);if(a){const e=a[1].padStart(2,"0"),s=a[2].padStart(2,"0"),t=a[3],r=parseInt(e),l=parseInt(s);return r<1||r>31||l<1||l>12?null:`${t}-${s}-${e}`}const r=s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})$/);if(r){const e=r[1].padStart(2,"0"),s=r[2].padStart(2,"0"),a=t(r[3]),l=parseInt(e),n=parseInt(s);return l<1||l>31||n<1||n>12?null:`${a}-${s}-${e}`}const l=s.match(/^(\d{2})(\d{2})(\d{4})$/);if(l){const e=l[1],s=l[2],t=l[3],a=parseInt(e),r=parseInt(s);return a<1||a>31||r<1||r>12?null:`${t}-${s}-${e}`}const n=s.match(/^(\d{2})(\d{2})(\d{2})$/);if(n){const e=n[1],s=n[2],a=t(n[3]),r=parseInt(e),l=parseInt(s);return r<1||r>31||l<1||l>12?null:`${a}-${s}-${e}`}const i=s.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);if(i){const e=i[1],s=i[2].padStart(2,"0"),t=i[3].padStart(2,"0"),a=parseInt(t),r=parseInt(s);return a<1||a>31||r<1||r>12?null:`${e}-${s}-${t}`}return null},b=e=>{const s=[];let t="",a=!1;for(let r=0;r<e.length;r++){const l=e[r];'"'===l?a&&'"'===e[r+1]?(t+='"',r++):a=!a:","!==l||a?t+=l:(s.push(t),t="")}return s.push(t),s};return{csvFile:t,csvData:r,importResult:i,isImporting:d,importProgress:m,currentImportStep:p,handleFileUpload:e=>{a(e);const t=new FileReader;t.onload=e=>{const t=e.target?.result;try{const e=t.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===e.length)return void l([]);const r=e[0].split(",").map(e=>e.trim().replace(/"/g,"")),n=[],i=[];for(let s=1;s<e.length;s++){const t=s+1,l=e[s];try{const e=b(l);if(e.length!==r.length){i.push(`Row ${t}: Field count mismatch`);continue}const s={};if(r.forEach((t,a)=>{s[t]=e[a]?.trim().replace(/"/g,"")||""}),!(s.employeeNumber&&s.firstName&&s.lastName&&s.phoneNumber&&s.position&&s.startDate)){i.push(`Row ${t}: Missing required fields (employeeNumber, firstName, lastName, phoneNumber, position, startDate)`);continue}const a=u(s.startDate);if(!a){i.push(`Row ${t}: Invalid date format for startDate "${s.startDate}". Please use dd/mm/yyyy (e.g., 15/01/2024)`);continue}const o={employeeNumber:s.employeeNumber||"",firstName:s.firstName,lastName:s.lastName,email:s.email?s.email.toLowerCase():"",phoneNumber:g(s.phoneNumber),whatsappNumber:s.whatsappNumber?g(s.whatsappNumber):"",position:s.position,startDate:a};n.push(o)}catch(a){i.push(`Row ${t}: Parse error`)}}l(n),i.length>0&&s.warn("CSV Import Warnings:",i)}catch(r){s.error("CSV parsing failed:",r),l([])}},t.readAsText(e)},handleImport:async t=>{if(!r.length)return{success:!1,imported:0,failed:0,errors:[{row:1,field:"file",message:"No data to import"}]};c(!0),x(0),h("Validating employee data...");const a=[],l=[];try{for(let s=0;s<r.length;s++){const i=r[s],o=s+2,d=Math.round(s/r.length*30);x(d),h(`Validating employee ${s+1} of ${r.length}: ${i.firstName} ${i.lastName}...`);try{const s=i.employeeNumber;if(!(await e.employees.validateEmployeeNumber(t,s)).isAvailable){a.push({row:o,field:"employeeNumber",message:`Employee "${s}" already exists - not imported (duplicate found)`});continue}const r={employeeNumber:s,firstName:i.firstName,lastName:i.lastName,email:i.email||void 0,phoneNumber:i.phoneNumber,whatsappNumber:i.whatsappNumber||void 0,department:"",position:i.position,startDate:i.startDate,contractType:"permanent",isActive:!0},n=j(r,t),{id:d,...c}=n;l.push(c)}catch(n){a.push({row:o,field:"validation",message:n instanceof Error?n.message:"Validation error"})}}let c=0,m=a.length;if(x(30),h("Validation complete. Starting employee creation..."),l.length>0)try{l.length;for(let t=0;t<l.length;t++){const r=30+Math.round(t/l.length*60);x(r);const n=l[t];h(`Creating employee ${t+1} of ${l.length}: ${n.profile?.firstName} ${n.profile?.lastName}...`);let o=0;const d=3;let p=!1;for(;!p&&o<d;)try{t>0&&await new Promise(e=>setTimeout(e,500)),await e.employees.create(l[t]),c++,p=!0,h(`âœ… Created: ${n.profile?.firstName} ${n.profile?.lastName}`),await new Promise(e=>setTimeout(e,200))}catch(i){o++;const e=i instanceof Error?i.message:"Unknown error";o<d&&e.includes("permissions")?(s.warn(`âš ï¸ Retry ${o}/${d} for employee ${t+1}: ${e}`),h(`âš ï¸ Retrying ${n.profile?.firstName} ${n.profile?.lastName} (${o}/${d})...`),await new Promise(e=>setTimeout(e,1e3*o))):(s.error(`âŒ Failed to create employee ${t+1} after ${o} attempts:`,i),m++,a.push({row:t+2,field:"individual_create",message:`${e} (after ${o} retries)`}),p=!0)}}x(90),h("Finalizing import..."),await new Promise(e=>setTimeout(e,500)),s.success(10447)}catch(d){s.error("âŒ Import process failed:",d),m+=l.length-c}const p={success:0===m,imported:c,failed:m,errors:a};return o(p),x(100),h("Import completed!"),p}finally{c(!1)}},resetImport:()=>{a(null),l([]),o(null),x(0),h("")}}})(),[y,f]=n.useState("upload");o(!0);const v=()=>{b(),r()};return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:d.modal},children:t.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-hidden shadow-xl",children:[t.jsxs("div",{className:"bg-white border-b border-gray-200 p-3 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-8 h-8 bg-green-100 rounded flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-lg",children:"ðŸ“Š"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Import Employees from CSV"}),t.jsx("p",{className:"text-xs text-gray-600",children:"Bulk import multiple employees"})]})]}),!x&&t.jsx("button",{onClick:v,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),t.jsxs("div",{className:"p-4",children:["upload"===y&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[t.jsxs("h3",{className:"text-xs font-semibold text-blue-900 mb-1.5 flex items-center gap-1",children:[t.jsx("span",{children:"ðŸ“‹"})," Import Instructions"]}),t.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 text-xs text-blue-800",children:[t.jsx("li",{children:"Download the CSV template below"}),t.jsx("li",{children:"Fill in employee information following the template format"}),t.jsx("li",{children:"Save the file as CSV (comma-separated values)"}),t.jsx("li",{children:"Upload the completed file using the form below"})]})]}),t.jsx("div",{className:"text-center",children:t.jsxs("button",{onClick:()=>{const e=N(),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="employee_import_template.csv",a.click(),window.URL.revokeObjectURL(t)},className:"inline-flex items-center gap-1.5 px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV Template"]})}),t.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[t.jsx("input",{type:"file",accept:".csv",onChange:e=>{const s=e.target.files?.[0];s&&(g(s),f("preview"))},className:"hidden",id:"csv-upload"}),t.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[t.jsx("div",{className:"text-4xl mb-2",children:"ðŸ“"}),t.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Click to upload CSV file"}),t.jsx("p",{className:"text-xs text-gray-500",children:"or drag and drop your file here"})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2",children:"Sample CSV Format:"}),t.jsxs("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:[t.jsx("strong",{children:"ðŸ’¡ Tips:"}),t.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-0.5",children:[t.jsxs("li",{children:[t.jsx("strong",{children:"Required fields:"})," Employee Number, First Name, Last Name, Phone Number, Position, Start Date"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"Date format:"})," Use dd/mm/yyyy (e.g., 15/01/2024) - South African standard format"]}),t.jsx("li",{children:"Employee number must be unique - duplicates will be skipped"}),t.jsx("li",{children:"Email and WhatsApp number are optional (can be blank)"}),t.jsx("li",{children:"Phone numbers accepts 0825254011, 825254011 (missing leading zero), or +27825254011 (auto-converts to +27)"}),t.jsx("li",{children:"All employees are automatically set to permanent contracts"})]})]}),t.jsx("pre",{className:"text-[10px] bg-white p-2 rounded border overflow-x-auto leading-relaxed",children:"employeeNumber,firstName,lastName,email,phoneNumber,whatsappNumber,position,startDate\nEMP001,John,Doe,john.doe@company.com,0123456789,0123456789,Software Developer,15/01/2024\nEMP002,Sarah,Johnson,,+27987654321,+27987654321,HR Manager,01/06/2023\nEMP003,Michael,Smith,michael.smith@company.com,0825254011,,Operations Coordinator,01/11/2024"}),t.jsxs("div",{className:"text-[10px] text-gray-600 mt-1.5 space-y-0.5",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Dates:"})," Accepts dd/mm/yyyy, dd/mm/yy, dd-mm-yyyy, dd-mm-yy, ddmmyyyy, ddmmyy, or yyyy-mm-dd formats"]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Phones:"})," All formats accepted - 0825254011 (local), 825254011 (missing leading 0), +27825254011 (international) - all auto-convert to +27"]})]})]})]}),"preview"===y&&c.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2.5",children:t.jsxs("p",{className:"text-xs text-green-800",children:["âœ… Found ",t.jsx("strong",{children:c.length})," employees ready to import"]})}),t.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Employee #"}),t.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Name"}),t.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Email"}),t.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Department"}),t.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Position"}),t.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Start Date"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:c.slice(0,10).map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-3 py-2",children:e.employeeNumber}),t.jsxs("td",{className:"px-3 py-2",children:[e.firstName," ",e.lastName]}),t.jsx("td",{className:"px-3 py-2",children:e.email}),t.jsx("td",{className:"px-3 py-2",children:e.department}),t.jsx("td",{className:"px-3 py-2",children:e.position}),t.jsx("td",{className:"px-3 py-2",children:e.startDate})]},s))})]})}),c.length>10&&t.jsxs("p",{className:"text-center text-gray-500 text-xs",children:["... and ",c.length-10," more employees"]}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx("button",{onClick:()=>{f("upload"),b()},className:"px-3 py-1.5 text-xs border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Upload Different File"}),t.jsxs("button",{onClick:async()=>{if(!i)return;f("importing");const e=await u(i.id);f("result"),e.success&&0===e.failed&&setTimeout(()=>{l(),r()},2e3)},className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded-md hover:bg-green-700 font-medium",children:["Import ",c.length," Employees"]})]})]}),"importing"===y&&t.jsxs("div",{className:"space-y-3 text-center",children:[t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[t.jsx("div",{className:"text-4xl mb-3",children:"âš¡"}),t.jsx("h3",{className:"text-sm font-bold text-blue-900 mb-1",children:"Importing Employees"}),t.jsx("p",{className:"text-xs text-blue-700 mb-3",children:"Please wait while we create your employees..."}),t.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 mb-3",children:t.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${p}%`}})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[p,"% Complete"]}),t.jsx("p",{className:"text-xs text-blue-600 min-h-[1rem]",children:h})]})]}),t.jsxs("div",{className:"text-[10px] text-gray-500 space-y-0.5",children:[t.jsx("p",{children:"â±ï¸ This may take a few moments depending on the number of employees"}),t.jsx("p",{children:"ðŸ”„ Please don't close this window during the import process"})]})]}),"result"===y&&m&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"border rounded-lg p-4 "+(m.success&&0===m.failed?"bg-green-50 border-green-200":m.imported>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:m.success&&0===m.failed?"âœ…":m.imported>0?"âš ï¸":"âŒ"}),t.jsx("h3",{className:"text-sm font-bold mb-2",children:m.success&&0===m.failed?"Import Successful!":m.imported>0?"Partial Import Complete":"Import Failed"}),t.jsxs("div",{className:"space-y-0.5 text-xs",children:[t.jsxs("p",{className:"text-green-700",children:["âœ… Successfully imported: ",t.jsx("strong",{children:m.imported})," employees"]}),m.failed>0&&t.jsxs("p",{className:"text-red-700",children:["âŒ Failed to import: ",t.jsx("strong",{children:m.failed})," employees"]})]})]})}),m.errors.length>0&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[t.jsx("h4",{className:"text-xs font-semibold text-red-900 mb-1.5",children:"Import Errors:"}),t.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:m.errors.map((e,s)=>t.jsxs("div",{className:"text-xs text-red-700",children:[t.jsxs("strong",{children:["Row ",e.row,":"]})," ",e.message]},s))})]}),t.jsx("div",{className:"flex justify-center",children:t.jsx("button",{onClick:v,className:"px-4 py-2 text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 font-medium",children:"Close"})})]})]})]})})},ne=({employee:e,onClose:a,onArchive:r})=>{const[l,i]=n.useState(""),[c,m]=n.useState(!1);o(!0);const{containerRef:x,ariaProps:p}=k({isOpen:!0,onClose:a,titleId:"archive-modal-title",descriptionId:"archive-modal-description"});return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:d.modal},children:t.jsx("div",{ref:x,...p,className:"bg-white rounded-2xl max-w-md w-full shadow-2xl",children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{id:"archive-modal-title",className:"text-2xl font-bold text-amber-600 mb-4",children:"âš ï¸ Archive Employee"}),t.jsxs("p",{id:"archive-modal-description",className:"text-gray-700 mb-4",children:["Are you sure you want to archive ",t.jsxs("strong",{children:[e.profile.firstName," ",e.profile.lastName]}),"?"]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs",children:t.jsxs("p",{className:"text-blue-800",children:[t.jsx("strong",{children:"Debug Info:"})," Employee ID: ",e.id||"MISSING ID!"]})}),t.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[t.jsxs("p",{className:"text-sm text-amber-800",children:[t.jsx("strong",{children:"Note:"})," Archiving an employee will:"]}),t.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-amber-800",children:[t.jsx("li",{children:"â€¢ Mark their record as inactive"}),t.jsx("li",{children:"â€¢ Preserve all historical data"}),t.jsx("li",{children:"â€¢ Remove them from active employee lists"}),t.jsx("li",{children:"â€¢ Maintain compliance with HR regulations"})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for archiving (optional)"}),t.jsx("textarea",{value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none",rows:3,placeholder:"e.g., Resignation, End of contract, etc."})]}),t.jsxs("div",{className:"flex gap-4",children:[t.jsx("button",{onClick:async()=>{if(e?.id&&e.id.trim().length,!e||!e.id||0===e.id.trim().length)return s.error("ðŸš¨ CRITICAL ERROR: Invalid employee or missing employee ID"),void alert("Error: Invalid employee data. Cannot archive.");m(!0);try{await r(e,l.trim()||void 0),s.success(1682),a()}catch(t){s.error("âŒ Archive operation failed:",t),alert(`Failed to archive employee: ${t instanceof Error?t.message:"Unknown error"}`)}finally{m(!1)}},disabled:c||!e?.id,className:"flex-1 py-3 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Archiving...":"Yes, Archive"}),t.jsx("button",{onClick:a,disabled:c,className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})]})})})},ie=({isOpen:e,onClose:a,employees:i,onAssign:o})=>{const{organization:d}=l(),[m,x]=n.useState([]),[p,h]=n.useState(""),[g,u]=n.useState("add"),[b,y]=n.useState(!1),[f,j]=n.useState(!1),[N,v]=n.useState(null);n.useEffect(()=>{(async()=>{if(d?.id&&e){y(!0),v(null);try{const e=(await r.queryDocuments(d.id,"users")).documents.filter(e=>"hr-manager"===e.role?.id||"hod-manager"===e.role?.id).map(e=>({id:e.id,firstName:e.firstName||e.profile?.firstName||"Unknown",lastName:e.lastName||e.profile?.lastName||"User",role:e.role,departmentIds:e.departmentIds}));x(e),e.length}catch(t){s.error("Failed to load managers:",t),v("Failed to load managers. Please try again.")}finally{y(!1)}}})()},[d?.id,e]);const w=m.find(e=>e.id===p);return t.jsx(c,{isOpen:e,onClose:a,title:"Assign Employees to Manager",size:"md",children:t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-bg)"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx($,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",style:{color:"var(--color-text)"},children:[i.length," employee",1!==i.length?"s":""," selected"]}),t.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:i.map(e=>`${e.profile.firstName} ${e.profile.lastName}`).join(", ")})]})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-3",style:{color:"var(--color-text)"},children:"Assignment Mode"}),t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"assignmentMode",value:"add",checked:"add"===g,onChange:e=>u(e.target.value),className:"w-4 h-4 text-blue-600"}),t.jsx(M,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),t.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[t.jsx("strong",{children:"Add Manager"})," - Keep existing managers"]})]}),t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"assignmentMode",value:"replace",checked:"replace"===g,onChange:e=>u(e.target.value),className:"w-4 h-4 text-blue-600"}),t.jsx(P,{className:"w-4 h-4",style:{color:"var(--color-alert-warning-text)"}}),t.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[t.jsx("strong",{children:"Replace All"})," - Remove existing managers"]})]})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Manager"}),b?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"var(--color-primary)"}})}):0===m.length?t.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-warning-bg)"},children:t.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-warning-text)"},children:"No managers found in your organization."})}):t.jsxs("select",{value:p,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",color:"var(--color-text)"},children:[t.jsx("option",{value:"",children:"-- Select a manager --"}),m.map(e=>t.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.role.name,")"]},e.id))]})]}),w&&t.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"replace"===g?"var(--color-alert-warning-bg)":"var(--color-alert-info-bg)"},children:t.jsxs("div",{className:"flex items-start gap-3",children:["add"===g?t.jsx(M,{className:"w-5 h-5 mt-0.5",style:{color:"var(--color-alert-info-text)"}}):t.jsx(P,{className:"w-5 h-5 mt-0.5",style:{color:"var(--color-alert-warning-text)"}}),t.jsxs("div",{children:[t.jsxs("p",{className:"text-sm font-medium mb-1",style:{color:"replace"===g?"var(--color-alert-warning-text)":"var(--color-alert-info-text)"},children:["Confirm ","add"===g?"Add":"Replace"," Assignment"]}),t.jsx("p",{className:"text-sm",style:{color:"replace"===g?"var(--color-alert-warning-text)":"var(--color-alert-info-text)"},children:"add"===g?t.jsxs(t.Fragment,{children:[t.jsxs("strong",{children:[w.firstName," ",w.lastName]})," will be"," ",t.jsx("strong",{children:"added"})," as a manager for ",i.length," employee",1!==i.length?"s":"",". Existing managers will be kept."]}):t.jsxs(t.Fragment,{children:[t.jsxs("strong",{children:[w.firstName," ",w.lastName]})," will"," ",t.jsx("strong",{children:"replace all existing managers"})," for ",i.length," employee",1!==i.length?"s":"","."]})})]})]})}),N&&t.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)"},children:t.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)"},children:N})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:a,disabled:f,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(p){j(!0),v(null);try{await o(p,g),a()}catch(e){s.error("Failed to assign manager:",e),v(e.message||"Failed to assign manager. Please try again.")}finally{j(!1)}}else v("Please select a manager")},disabled:!p||f||b,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(to right, var(--color-primary), var(--color-primary-hover))",color:"var(--color-text-inverse)"},children:f?"Assigning...":"Assign Manager"})]})]})})},oe=({isOpen:e,onClose:a,employees:r,onAssign:i})=>{const{organization:o}=l(),[d,m]=n.useState([]),[x,p]=n.useState(""),[h,g]=n.useState(!1),[u,b]=n.useState(!1),[y,f]=n.useState(null);n.useEffect(()=>{(async()=>{if(o?.id&&e){g(!0),f(null);try{const e=await w.getDepartments(o.id);m(e),e.length}catch(t){s.error("Failed to load departments:",t),f("Failed to load departments. Please try again.")}finally{g(!1)}}})()},[o?.id,e]);const j=d.find(e=>e.name===x);return t.jsx(c,{isOpen:e,onClose:a,title:"Assign Employees to Department",size:"md",children:t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-bg)"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(T,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium",style:{color:"var(--color-text)"},children:[r.length," employee",1!==r.length?"s":""," selected"]}),t.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.map(e=>`${e.profile.firstName} ${e.profile.lastName}`).join(", ")})]})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Department"}),h?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"var(--color-primary)"}})}):0===d.length?t.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-warning-bg)"},children:t.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-warning-text)"},children:"No departments found in your organization. Please create departments first."})}):t.jsxs("select",{value:x,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",color:"var(--color-text)"},children:[t.jsx("option",{value:"",children:"-- Select a department --"}),d.map(e=>t.jsx("option",{value:e.name,children:e.name},e.id))]})]}),j&&t.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)"},children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(F,{className:"w-5 h-5 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--color-alert-info-text)"},children:"Confirm Assignment"}),t.jsxs("p",{className:"text-sm",style:{color:"var(--color-alert-info-text)"},children:[r.length," employee",1!==r.length?"s":""," will be assigned to"," ",t.jsx("strong",{children:j.name})," department."]})]})]})}),y&&t.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)"},children:t.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)"},children:y})}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:a,disabled:u,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(x){b(!0),f(null);try{await i(x),a()}catch(e){s.error("Failed to assign department:",e),f(e.message||"Failed to assign department. Please try again.")}finally{b(!1)}}else f("Please select a department")},disabled:!x||u||h,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(to right, var(--color-primary), var(--color-primary-hover))",color:"var(--color-text-inverse)"},children:u?"Assigning...":"Assign Department"})]})]})})},de={"executive-management":{level:0,icon:R,color:"from-purple-500 to-purple-600"},"hr-manager":{level:1,icon:L,color:"from-blue-500 to-blue-600"},"hod-manager":{level:2,icon:$,color:"from-emerald-500 to-emerald-600"},employee:{level:3,icon:S,color:"from-gray-500 to-gray-600"}},ce=({employees:e,onEmployeeClick:s,selectedEmployee:r,inline:l=!1})=>{const{user:i}=a(),[o,d]=n.useState(new Set),[c,m]=n.useState("tree"),x=n.useMemo(()=>{if(!e.length)return[];const s=new Map;e.forEach(e=>s.set(e.id,e));const t=[],a=new Set,r=(t,l=0)=>{if(a.has(t))return null;const n=s.get(t);if(!n)return null;a.add(t);const i=[];return e.filter(e=>e.employment.managerId===t).forEach(e=>{const s=r(e.id,l+1);s&&i.push(s)}),{employee:n,children:i,level:l}};return e.filter(e=>!e.employment.managerId||!s.has(e.employment.managerId)).forEach(e=>{const s=r(e.id);s&&t.push(s)}),t},[e]),p=n.useMemo(()=>{if(!i)return x;if(["hr-manager","executive-management"].includes(i.role?.id))return x;if("hod-manager"===i.role?.id){const s=e=>{for(const t of e){if(t.employee.id===i.id)return[t];const e=s(t.children);if(e.length>0)return e}return[]},t=s(x);if(t.length>0)return t;const a=e.filter(e=>e.employment.managerId===i.id);if(a.length>0){const s=e.find(e=>e.id===i.id)||{id:i.id,profile:{firstName:i.firstName||i.displayName?.split(" ")[0]||"Manager",lastName:i.lastName||i.displayName?.split(" ")[1]||"",email:i.email||"",employeeNumber:"MGR-"+i.id.slice(-6),department:i.department||"Management",position:"Manager"},employment:{department:i.department||"Management",position:"Manager",managerId:null}},t=[];return a.forEach(s=>{const a={employee:s,children:e.filter(e=>e.employment.managerId===s.id).map(e=>({employee:e,children:[],level:2})),level:1};t.push(a)}),[{employee:s,children:t,level:0}]}return[]}return x},[x,i]),h=n.useMemo(()=>{const s=new Map;return e.forEach(e=>{const t=e.profile.department||"Unassigned";s.has(t)||s.set(t,[]),s.get(t).push(e)}),Array.from(s.entries()).sort(([e],[s])=>e.localeCompare(s))},[e]),g=n.useCallback(e=>{d(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},[]),u=n.useCallback(e=>{s?.(e)},[s]),b=({employee:e,level:s,hasChildren:a,isExpanded:r,isSelected:l,childCount:n=0})=>{const i=e.employment.position||"Employee",o=de[i]?.icon||S,d=de[i]?.color||"from-gray-500 to-gray-600";return t.jsx("div",{className:`\n          relative bg-white rounded-lg shadow-md border-2 transition-all duration-200 cursor-pointer\n          ${l?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}\n          ${0===s?"w-56":"w-48"}\n        `,onClick:()=>u(e),children:t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:`\n              w-10 h-10 rounded-full bg-gradient-to-br ${d} \n              flex items-center justify-center shadow-md\n            `,children:t.jsx(o,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs("h3",{className:"font-medium text-sm text-gray-900 truncate",children:[e.profile.firstName," ",e.profile.lastName]}),0===s&&t.jsx(R,{className:"w-3 h-3 text-yellow-500 flex-shrink-0"})]}),t.jsx("p",{className:"text-xs text-gray-600 truncate",children:i})]})]}),t.jsx("div",{className:"text-xs text-gray-500 mb-2",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(D,{className:"w-3 h-3 flex-shrink-0"}),t.jsx("span",{className:"truncate",children:e.profile.department})]})}),a&&t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded text-xs font-medium",children:n}),t.jsx("button",{onClick:s=>{s.stopPropagation(),g(e.id)},className:"p-0.5 hover:bg-gray-100 rounded transition-colors",children:r?t.jsx(z,{className:"w-3 h-3 text-gray-600"}):t.jsx(O,{className:"w-3 h-3 text-gray-600"})})]})]})})},y=(s,a=!0)=>0===s.length?null:t.jsx("div",{className:"flex flex-col items-center space-y-6 "+(a?"w-full":""),children:s.map((s,a)=>{const l=s.children.length>0,n=o.has(s.employee.id),i=r?.id===s.employee.id,d=e.filter(e=>e.employment.managerId===s.employee.id).length;return t.jsxs("div",{className:"flex flex-col items-center relative",children:[t.jsx("div",{className:"relative z-10",children:t.jsx(b,{employee:s.employee,level:s.level,hasChildren:l,isExpanded:n,isSelected:i,childCount:d})}),l&&n&&t.jsxs("div",{className:"relative mt-4",children:[t.jsx("div",{className:"absolute top-0 left-1/2 w-0.5 h-4 bg-blue-300 transform -translate-x-0.5"}),t.jsx("div",{className:"pt-4 space-y-4",children:s.children.map((e,s)=>t.jsxs("div",{className:"relative flex items-center",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"w-0.5 h-8 bg-blue-300"}),t.jsx("div",{className:"w-8 h-0.5 bg-blue-300"})]}),t.jsx("div",{className:"ml-2",children:y([e],!1)})]},e.employee.id))}),s.children.length>1&&t.jsx("div",{className:"absolute left-1/2 w-0.5 bg-blue-300 transform -translate-x-0.5",style:{top:"16px",height:112*(s.children.length-1)+32+"px"}})]})]},s.employee.id)})});return e.length?t.jsxs("div",{className:l?"space-y-3":"space-y-6",children:[!l&&t.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[t.jsx($,{className:"w-8 h-8 text-blue-600"}),"Team Structure"]}),t.jsx("p",{className:"text-gray-600 mt-1",children:"hr-manager"===i?.role?.id?"Complete organizational hierarchy":"hod-manager"===i?.role?.id?"Your team and direct reports":"Team overview"})]}),t.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[t.jsx("button",{onClick:()=>m("tree"),className:`\n                  px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                  ${"tree"===c?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}\n                `,children:"Hierarchy"}),t.jsx("button",{onClick:()=>m("departments"),className:`\n                  px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                  ${"departments"===c?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}\n                  `,children:"Departments"})]})]})}),t.jsx("div",{className:"rounded-lg border border-gray-200 "+(l?"bg-white p-3":"bg-gradient-to-br from-gray-50 to-white p-6"),children:"tree"===c?t.jsx("div",{className:"max-h-96 overflow-y-auto overflow-x-auto "+(l?"p-2":"p-4"),children:p.length>0?t.jsx("div",{className:"min-w-max pb-8",children:y(p)}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx($,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"hod-manager"===i?.role?.id?"No Team Members Found":"No Organizational Structure"}),t.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"hod-manager"===i?.role?.id?"You currently have no direct reports assigned to you. Contact HR to add team members.":"There are no employees to display in the organizational hierarchy."}),"hod-manager"===i?.role?.id&&t.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"User ID:"})," ",i.id]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Role:"})," ",i.role?.id]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Total Employees:"})," ",e.length]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Direct Reports:"})," ",e.filter(e=>e.employment.managerId===i.id).length]})]})]})}):t.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:h.map(([e,s])=>t.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[t.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:[t.jsxs("h3",{className:"text-white font-bold flex items-center gap-2",children:[t.jsx(D,{className:"w-5 h-5"}),e]}),t.jsxs("p",{className:"text-blue-100 text-sm",children:[s.length," employees"]})]}),t.jsx("div",{className:"p-4 space-y-3",children:s.map(e=>t.jsx("div",{onClick:()=>u(e),className:`\n                  p-3 rounded-lg cursor-pointer transition-all duration-200\n                  hover:bg-blue-50 hover:border-blue-200 border border-transparent\n                  ${r?.id===e.id?"bg-blue-50 border-blue-500":""}\n                `,children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(S,{className:"w-8 h-8 text-gray-600"}),t.jsxs("div",{children:[t.jsxs("p",{className:"font-medium text-gray-900",children:[e.profile.firstName," ",e.profile.lastName]}),t.jsx("p",{className:"text-sm text-gray-600",children:e.employment.position})]})]})},e.id))})]},e))})})]}):t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 text-center",children:[t.jsx($,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),t.jsx("p",{className:"text-gray-600",children:"Start by adding employees to your organization."})]})},me=({employees:e,onEmployeeSelect:o,onEmployeeEdit:d,onEmployeeDelete:c,onEmployeePromote:m,onBulkAction:x,selectedEmployee:p,loading:h=!1,compact:g=!1,readOnly:u=!1})=>{const{user:b}=a(),{organization:y}=l(),[f,j]=n.useState([]);n.useEffect(()=>{(async()=>{if(y?.id)try{const e=await r.queryDocuments(y.id,"users");j(e.documents),e.documents.length}catch(e){s.error("Failed to load users for manager lookup:",e)}})()},[y?.id]);const N=n.useCallback(s=>{const t=v(s);return 0===t.length?["No Manager"]:t.map(s=>{const t=e.find(e=>e.id===s);if(t)return`${t.profile.firstName} ${t.profile.lastName}`;const a=f.find(e=>e.id===s);if(a){const e=a.firstName||a.profile?.firstName,s=a.lastName||a.profile?.lastName;return e&&s?`${e} ${s}`:"Manager"}return"Unknown Manager"})},[e,f]),[w,k]=n.useState("name"),[C,E]=n.useState("asc"),[A,I]=n.useState(""),[M,P]=n.useState(""),[T,F]=n.useState(""),[L,R]=n.useState(new Set),[O,Z]=n.useState(!1),[K,X]=n.useState(1),[ee,se]=n.useState(25),te=n.useMemo(()=>{const s=new Set(e.map(e=>e.profile.department).filter(Boolean));return Array.from(s).sort()},[e]),ae=n.useMemo(()=>{let s=e.filter(e=>{const s=[e.profile.firstName,e.profile.lastName,e.profile.employeeNumber,e.profile.department,e.employment.position,e.profile.email].join(" ").toLowerCase(),t=!A||s.includes(A.toLowerCase()),a=!M||e.profile.department===M,r=!T||("active"===T?e.isActive:!e.isActive);return t&&a&&r});return s.sort((e,s)=>{let t,a;switch(w){case"name":t=`${e.profile.firstName} ${e.profile.lastName}`,a=`${s.profile.firstName} ${s.profile.lastName}`;break;case"department":t=e.profile.department||"",a=s.profile.department||"";break;case"position":t=e.employment.position||"",a=s.employment.position||"";break;case"manager":const r=N(e.employment),l=N(s.employment);t=r[0]||"",a=l[0]||"";break;case"startDate":const n=e=>{const s=e.employment?.startDate||e.profile?.startDate;if(!s)return 0;try{if(s&&"function"==typeof s.toDate)return s.toDate().getTime();if(s instanceof Date)return s.getTime();const e=new Date(s);return isNaN(e.getTime())?0:e.getTime()}catch(t){return 0}};t=n(e),a=n(s);break;case"status":t=e.isActive?"Active":"Inactive",a=s.isActive?"Active":"Inactive";break;default:return 0}return t<a?"asc"===C?-1:1:t>a?"asc"===C?1:-1:0}),s},[e,A,M,T,w,C]),re=n.useMemo(()=>{const e=(K-1)*ee;return ae.slice(e,e+ee)},[ae,K,ee]),le=Math.ceil(ae.length/ee),ne=n.useCallback(e=>{e===w?E("asc"===C?"desc":"asc"):(k(e),E("asc"))},[w,C]),ie=n.useCallback(e=>{R(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},[]),oe=n.useCallback(()=>{L.size===re.length?R(new Set):R(new Set(re.map(e=>e.id)))},[L.size,re]),de=n.useCallback(s=>{const t=e.filter(e=>L.has(e.id));x?.(s,t),R(new Set)},[e,L,x]),ce=n.useCallback(()=>{const e=[["Name","Employee ID","Department","Position","Managers","Email","Phone","Start Date","Status"],...ae.map(e=>[`${e.profile.firstName} ${e.profile.lastName}`,e.profile.employeeNumber,e.profile.department,e.employment.position,N(e.employment).join("; "),e.profile.email||"",e.profile.phoneNumber||"",(()=>{const s=e.employment?.startDate||e.profile?.startDate;if(!s)return"Not set";try{if(s&&"function"==typeof s.toDate)return s.toDate().toLocaleDateString();if(s instanceof Date)return s.toLocaleDateString();const e=new Date(s);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString()}catch(t){return"Invalid date"}})(),e.isActive?"Active":"Inactive"])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),a=URL.createObjectURL(s);t.setAttribute("href",a),t.setAttribute("download",`employees-${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(t),t.click(),document.body.removeChild(t)},[ae]);return h?t.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-8",children:t.jsxs("div",{className:"animate-pulse space-y-4",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),t.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>t.jsx("div",{className:"h-12 bg-gray-200 rounded"},s))})]})}):t.jsxs("div",{className:"space-y-4",children:[!g&&t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(W,{className:"w-6 h-6 text-blue-600"}),"Employee Directory"]}),t.jsxs("p",{className:"text-gray-600 text-sm",children:[ae.length," of ",e.length," employees"]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(U,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search employees...",value:A,onChange:e=>I(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64"})]}),t.jsxs("button",{onClick:()=>Z(!O),className:`\n                  flex items-center gap-2 px-4 py-2 border rounded-lg transition-colors\n                  ${O?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}\n                `,children:[t.jsx(V,{className:"w-4 h-4"}),"Filters"]}),t.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[t.jsx(B,{className:"w-4 h-4"}),"Export"]})]})]}),O&&t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),t.jsxs("select",{value:M,onChange:e=>P(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"All Departments"}),te.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),t.jsxs("select",{value:T,onChange:e=>F(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Size"}),t.jsxs("select",{value:ee,onChange:e=>se(Number(e.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"10",children:"10 per page"}),t.jsx("option",{value:"25",children:"25 per page"}),t.jsx("option",{value:"50",children:"50 per page"}),t.jsx("option",{value:"100",children:"100 per page"})]})]})]})})]}),L.size>0&&t.jsx("div",{className:"mt-4 p-4 bg-white rounded-xl border border-blue-200 shadow-sm",children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[L.size," employee",1!==L.size?"s":""," selected"]}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:["hr-manager"===b?.role?.id&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>de("assign-manager"),className:"flex items-center gap-1 px-3 py-1.5 bg-purple-600 text-white rounded text-sm hover:bg-purple-700 transition-colors",children:[t.jsx($,{className:"w-3.5 h-3.5"}),"Assign to Manager"]}),t.jsxs("button",{onClick:()=>de("assign-department"),className:"flex items-center gap-1 px-3 py-1.5 bg-emerald-600 text-white rounded text-sm hover:bg-emerald-700 transition-colors",children:[t.jsx(D,{className:"w-3.5 h-3.5"}),"Assign to Department"]})]}),t.jsx("button",{onClick:()=>de("export"),className:"px-3 py-1.5 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",children:"Export Selected"})]})]})}),t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:t.jsx("tr",{children:[{key:"select",label:"",sortable:!1,width:"48px",align:"center"},{key:"name",label:"Employee",sortable:!0,width:"200px"},{key:"employeeNumber",label:"ID",sortable:!0,width:"100px"},{key:"department",label:"Department",sortable:!0,width:"130px"},{key:"position",label:"Position",sortable:!0,width:"130px"},{key:"manager",label:"Manager",sortable:!0,width:"120px"},{key:"contact",label:"Contact",sortable:!1,width:"80px",align:"center"},{key:"startDate",label:"Start Date",sortable:!0,width:"100px"},{key:"status",label:"Status",sortable:!0,width:"100px"},{key:"actions",label:"Actions",sortable:!1,width:"80px",align:"center"}].map(e=>{return t.jsx("th",{className:`\n                      px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider\n                      ${"center"===e.align?"text-center":""}\n                      ${"right"===e.align?"text-right":""}\n                      ${e.sortable?"cursor-pointer hover:bg-gray-100":""}\n                    `,style:{width:e.width},onClick:()=>e.sortable&&ne(e.key),children:t.jsx("div",{className:"flex items-center gap-1",children:"select"===e.key?t.jsx("button",{onClick:oe,children:L.size===re.length?t.jsx(q,{className:"w-4 h-4 text-blue-600"}):t.jsx(H,{className:"w-4 h-4 text-gray-400"})}):t.jsxs(t.Fragment,{children:[e.label,e.sortable&&(s=e.key,w!==s?null:"asc"===C?t.jsx(G,{className:"w-4 h-4"}):t.jsx(z,{className:"w-4 h-4"}))]})})},e.key);var s})})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:re.map(e=>t.jsxs(i.Fragment,{children:[t.jsxs("tr",{className:`\n                      hover:bg-gray-50 transition-colors cursor-pointer\n                      ${p?.id===e.id?"bg-blue-50":""}\n                      ${L.has(e.id)?"bg-blue-25":""}\n                    `,onClick:()=>o?.(e),children:[t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsx("button",{onClick:s=>{s.stopPropagation(),ie(e.id)},children:L.has(e.id)?t.jsx(q,{className:"w-4 h-4 text-blue-600"}):t.jsx(H,{className:"w-4 h-4 text-gray-400"})})}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:t.jsx(S,{className:"w-4 h-4 text-blue-600"})}),t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[e.profile.firstName," ",e.profile.lastName]}),t.jsx("div",{className:"text-sm text-gray-500",children:e.profile.employeeNumber})]})]})}),t.jsx("td",{className:"px-4 py-3 text-sm font-mono text-gray-900",children:e.profile.employeeNumber}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(D,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:e.profile.department})]})}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.employment.position}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("div",{className:"flex flex-wrap gap-1",children:N(e.employment).map((e,s)=>t.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:e},s))})}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[("hr-manager"===b?.role?.id||"executive-management"===b?.role?.id)&&t.jsxs(t.Fragment,{children:[e.profile.email&&t.jsx(_,{className:"w-4 h-4 text-green-600",title:`Email: ${e.profile.email}`}),e.profile.phoneNumber&&t.jsx(J,{className:"w-4 h-4 text-blue-600",title:`Phone: ${e.profile.phoneNumber}`}),!e.profile.email&&!e.profile.phoneNumber&&t.jsx("span",{className:"text-sm text-gray-400",children:"â€”"})]}),"hr-manager"!==b?.role?.id&&"executive-management"!==b?.role?.id&&t.jsx("span",{className:"text-sm text-gray-400",children:"â€”"})]})}),t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Y,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-900",children:(()=>{const s=e.employment?.startDate||e.profile?.startDate;if(!s)return"Not set";try{if(s&&"function"==typeof s.toDate)return s.toDate().toLocaleDateString();if(s instanceof Date)return s.toLocaleDateString();const e=new Date(s);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString()}catch(t){return"Invalid date"}})()})]})}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:`\n                        inline-flex px-2 py-1 text-xs font-medium rounded-full\n                        ${e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}\n                      `,children:e.isActive?"Active":"Inactive"})}),t.jsx("td",{className:"px-4 py-3 text-center",children:t.jsx("div",{className:"flex items-center justify-center gap-1",children:t.jsx("button",{onClick:s=>{s.stopPropagation(),o?.(e)},className:"p-1 text-gray-400 hover:text-green-600 transition-colors",children:t.jsx(Q,{className:"w-4 h-4"})})})})]}),p?.id===e.id&&t.jsx("tr",{className:"bg-blue-50/50",children:t.jsx("td",{colSpan:10,className:"px-4 py-4",children:t.jsxs("div",{className:"bg-white rounded-lg border border-blue-200 shadow-sm p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h4",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(Q,{className:"w-5 h-5 text-blue-600"}),"Employee Details"]}),t.jsx("button",{onClick:e=>{e.stopPropagation(),o?.(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:"âœ•"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Personal Information"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Name:"})," ",e.profile.firstName," ",e.profile.lastName]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"ID:"})," ",e.profile.employeeNumber]}),("hr-manager"===b?.role?.id||"executive-management"===b?.role?.id)&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Email:"})," ",e.profile.email]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Phone:"})," ",e.profile.phoneNumber||"Not provided"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Employment Details"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Department:"})," ",e.profile.department]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Position:"})," ",e.employment.position]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Managers:"}),t.jsx("span",{className:"ml-2",children:N(e.employment).join(", ")})]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Start Date:"})," ",(()=>{const s=e.employment?.startDate||e.profile?.startDate;if(!s)return"Not set";try{if(s&&"function"==typeof s.toDate)return s.toDate().toLocaleDateString();if(s instanceof Date)return s.toLocaleDateString();const e=new Date(s);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString()}catch(t){return"Invalid date"}})()]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Status:"}),t.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})]})]})]})]}),!u&&("hr-manager"===b?.role?.id||"executive-management"===b?.role?.id)&&t.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:s=>{s.stopPropagation(),d?.(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Edit Employee"}),t.jsx("button",{onClick:s=>{s.stopPropagation(),c?.(e)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Archive Employee"})]})]})})})]},e.id))})]})}),le>1&&t.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(K-1)*ee+1," to ",Math.min(K*ee,ae.length)," of ",ae.length," results"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>X(Math.max(1,K-1)),disabled:1===K,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),Array.from({length:Math.min(5,le)},(e,s)=>{const a=Math.max(1,K-2)+s;return a>le?null:t.jsx("button",{onClick:()=>X(a),className:`\n                        px-3 py-1 border rounded text-sm transition-colors\n                        ${a===K?"bg-blue-600 border-blue-600 text-white":"border-gray-300 hover:bg-gray-50"}\n                      `,children:a},a)}),t.jsx("button",{onClick:()=>X(Math.min(le,K+1)),disabled:K===le,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})})]}),0===ae.length&&t.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[t.jsx(S,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),t.jsx("p",{className:"text-gray-600 mb-4",children:A||M||T?"Try adjusting your search or filter criteria.":"Start by adding employees to your organization."}),(A||M||T)&&t.jsx("button",{onClick:()=>{I(""),P(""),F("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Clear Filters"})]})]})},xe=({width:e="100%",height:s="1rem",className:a=""})=>t.jsx("div",{className:`bg-gray-200 rounded animate-pulse legacy-simple-layout ${a}`,style:{width:e,height:s}}),pe=({rows:e=5})=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg legacy-simple-layout",children:[t.jsx("div",{className:"p-4 border-b border-gray-200",children:t.jsxs("div",{className:"flex gap-4",children:[t.jsx(xe,{width:"150px",height:"16px"}),t.jsx(xe,{width:"120px",height:"16px"}),t.jsx(xe,{width:"100px",height:"16px"}),t.jsx(xe,{width:"80px",height:"16px"})]})}),Array.from({length:e}).map((e,s)=>t.jsx("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:t.jsxs("div",{className:"flex gap-4 items-center",children:[t.jsx(xe,{width:"150px",height:"14px"}),t.jsx(xe,{width:"120px",height:"14px"}),t.jsx(xe,{width:"100px",height:"14px"}),t.jsx(xe,{width:"80px",height:"14px"})]})},s))]}),he=()=>t.jsx("div",{className:"grid grid-cols-1 gap-4 legacy-simple-layout",children:Array.from({length:4}).map((e,s)=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx(xe,{width:"60px",height:"14px"}),t.jsx(xe,{width:"24px",height:"24px",className:"rounded"})]}),t.jsx(xe,{width:"40px",height:"24px",className:"mb-1"}),t.jsx(xe,{width:"80px",height:"12px"})]},s))}),ge=()=>t.jsxs("div",{className:"space-y-4 legacy-simple-layout",children:[t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(xe,{width:"32px",height:"32px",className:"rounded"}),t.jsxs("div",{children:[t.jsx(xe,{width:"120px",height:"18px",className:"mb-1"}),t.jsx(xe,{width:"80px",height:"14px"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(xe,{width:"80px",height:"36px",className:"rounded"}),t.jsx(xe,{width:"80px",height:"36px",className:"rounded"})]})]})}),t.jsx(he,{}),t.jsx(pe,{rows:3})]}),ue=({message:e="Loading..."})=>t.jsxs("div",{className:"text-center py-8 legacy-simple-layout",children:[t.jsx("div",{className:"inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),t.jsx("p",{className:"text-gray-600 legacy-text-size",children:e}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This may take a moment on slower connections"})]}),be=({onDataChange:r,hideFloatingButton:l=!1,onAddEmployeeClick:i,inline:o=!1,readOnly:d=!1})=>{const{user:b,organization:y}=a(),f="hod-manager"===b?.role?.id,j=y?.id,{employees:N,loading:v,loadingMore:w,error:k,loadEmployees:C,loadMoreEmployees:S,archiveEmployee:D,updateEmployee:E,pagination:A}=((t,a)=>{const[r,l]=n.useState([]),[i,o]=n.useState([]),[d,c]=n.useState(!0),[m,x]=n.useState(!1),[p,h]=n.useState(null),[g,u]=n.useState({hasMore:!0,currentPage:0,pageSize:50}),b=async(r=!0)=>{if(t)try{if(r?(c(!0),l([]),u(e=>({...e,currentPage:0,lastId:void 0}))):x(!0),h(null),a){const s=await e.employees.getByManager(a,t);return l(s),o(s),void u(e=>({...e,hasMore:!1}))}const s=await e.employees.getAll(t),n=!1,i=void 0;r?(l(s),o(s)):(l(e=>[...e,...s]),o(e=>[...e,...s])),u(e=>({...e,hasMore:n,lastId:i,currentPage:r?1:e.currentPage+1}))}catch(n){h("Failed to load employees"),s.error("Error loading employees:",n)}finally{c(!1),x(!1)}};return n.useEffect(()=>{b()},[t]),{employees:r,allEmployees:i,loading:d,loadingMore:m,error:p,loadEmployees:b,loadMoreEmployees:async()=>{g.hasMore&&!m&&await b(!1)},archiveEmployee:async(a,r)=>{if(t)try{await e.employees.delete(a.id,t),await b()}catch(l){throw h("Failed to archive employee"),s.error("Archive error:",l),l}},updateEmployee:async s=>{if(t)try{await e.employees.update(s.id,t,s),await b()}catch(a){throw h("Failed to update employee"),a}},pagination:{hasMore:g.hasMore,currentPage:g.currentPage,pageSize:g.pageSize,canLoadMore:g.hasMore&&!d&&!m}}})(j,f?b?.id:void 0),{filters:I,setFilters:P,filteredEmployees:T}=((e,s)=>{const[t,a]=n.useState({search:"",department:"",contractType:"",hasWarnings:!1,isActive:!0}),r=n.useMemo(()=>g(s?.role.id,s?.departmentIds),[s]),l=n.useMemo(()=>u(e,t,r,s?.role?.id,s?.id),[e,t,r,s?.role?.id,s?.id]);return{filters:t,setFilters:a,filteredEmployees:l}})(N,b),F=n.useMemo(()=>m(x||{isLegacyDevice:!1}),[]),[L,R]=n.useState(1),O=x?.isLegacyDevice?F.employeeListLimit:50,B=n.useMemo(()=>{if(!x?.isLegacyDevice)return T;const e=(L-1)*O,s=e+O;return T.slice(e,s)},[T,L,O,x?.isLegacyDevice]),q=Math.ceil(T.length/O),H=n.useMemo(()=>window.innerWidth<768,[]),[_,J]=n.useState(H?"cards":"table"),Y=p(),Q=p(),G=p(),de=p();n.useEffect(()=>(i&&(window.__openAddEmployeeModal=()=>Y.open()),()=>{delete window.__openAddEmployeeModal}),[i,Y]);const[xe,pe]=n.useState(null),[he,be]=n.useState(null),[ye,fe]=n.useState(null),[je,Ne]=n.useState(!1),ve=g(b?.role.id,b?.departmentIds),we=n.useCallback(e=>{fe(e)},[]),ke=n.useCallback(e=>{pe(e)},[]),Ce=n.useCallback(e=>{be(e)},[]),Se=n.useCallback((e,s)=>{switch(e){case"assign-manager":G.open(s);break;case"assign-department":de.open(s)}},[G,de]),De=n.useCallback(async(e,s)=>{if(!j||!G.data)return;const t=G.data.map(t=>{const a=t.employment?.managerIds||(t.employment?.managerId?[t.employment.managerId]:[]),r="add"===s?[...new Set([...a,e])]:[e];return E({...t,employment:{...t.employment,managerIds:r}})});await Promise.all(t),await C(),G.close()},[G.data,j,E,C,G]),Ee=n.useCallback(async e=>{if(!j||!de.data)return;const s=de.data.map(s=>E({...s,profile:{...s.profile,department:e}}));await Promise.all(s),await C(),de.close()},[de.data,j,E,C,de]);return v?x?.isLegacyDevice?t.jsxs("div",{className:"w-full p-4",children:[t.jsx(ue,{message:"Loading Employees..."}),t.jsx("div",{className:"mt-4",children:t.jsx(ge,{})})]}):t.jsx(h,{message:"Loading employees...",size:"lg"}):t.jsxs("div",{className:`w-full ${o?"space-y-3":"space-y-2 md:space-y-4"} relative`,children:[!o&&t.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium",children:[t.jsx($,{className:"w-4 h-4"}),T.length]}),I.search&&t.jsx("button",{onClick:()=>P({...I,search:""}),className:"text-xs text-gray-500 hover:text-gray-700",children:"Clear search"})]}),ve.canBulkImport&&t.jsxs("button",{onClick:()=>Q.open(),className:"flex items-center gap-1.5 px-3 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg font-medium text-sm",children:[t.jsx(Z,{className:"w-4 h-4"}),"Import"]})]}),!o&&t.jsx("div",{className:"hidden md:block md:bg-white/95 md:backdrop-blur-sm md:rounded-xl md:shadow-lg md:border md:border-white/50 overflow-hidden",children:t.jsx("div",{className:"hidden md:block bg-gradient-to-r from-indigo-600 via-purple-700 to-indigo-800 p-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:t.jsx($,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold text-white tracking-tight",children:"Employee Management"}),t.jsx("p",{className:"text-indigo-100 text-xs font-medium",children:x?.isLegacyDevice?`${B.length} of ${T.length} employees`:`${T.length} employees`})]})]}),t.jsxs("div",{className:"flex gap-2",children:[ve.canCreate&&t.jsxs("button",{onClick:()=>Y.open(),className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-medium border border-white/30 hover:border-white/50 transition-all text-sm",children:[t.jsx(M,{className:"w-4 h-4"}),t.jsx("span",{children:"Add"})]}),ve.canBulkImport&&t.jsxs("button",{onClick:()=>Q.open(),className:"flex items-center gap-2 px-3 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[t.jsx(Z,{className:"w-4 h-4"}),t.jsx("span",{children:"Import"})]}),ve.canViewArchived&&t.jsxs("button",{onClick:()=>J("archive"),className:"flex items-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[t.jsx(K,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Archive"})]})]})]})})}),k&&t.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 border border-red-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-red-600 text-lg",children:"âš ï¸"}),t.jsx("p",{className:"text-red-800 font-medium text-sm",children:k})]})}),!o&&t.jsx("div",{className:"hidden md:block",children:t.jsx(se,{employees:T})}),o&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("select",{value:_,onChange:e=>J(e.target.value),className:"pl-3 pr-8 py-1.5 border border-gray-300 rounded text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",children:["hod-manager"!==b?.role?.id&&t.jsx("option",{value:"organogram",children:"Hierarchy"}),t.jsx("option",{value:"table",children:"Table"}),t.jsx("option",{value:"cards",children:"Cards"})]}),t.jsxs("span",{className:"text-xs text-gray-600",children:[T.length," employees"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[ve.canCreate&&t.jsxs("button",{onClick:()=>Y.open(),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors",children:[t.jsx(M,{className:"w-3.5 h-3.5"}),"Add Employee"]}),ve.canBulkImport&&t.jsxs("button",{onClick:()=>Q.open(),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100 rounded-md transition-colors",children:[t.jsx(Z,{className:"w-3.5 h-3.5"}),"Import"]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(U,{className:"w-3.5 h-3.5 absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search employees...",value:I.search,onChange:e=>P({...I,search:e.target.value}),className:"w-full pl-8 pr-3 py-1.5 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"})]}),t.jsxs("button",{onClick:()=>Ne(!je),className:"flex items-center gap-1 px-2.5 py-1.5 border rounded text-xs font-medium transition-all "+(je?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:[t.jsx(V,{className:"w-3.5 h-3.5"}),t.jsx("span",{className:"hidden sm:inline",children:"Filters"})]})]}),je&&t.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[t.jsxs("select",{value:I.department,onChange:e=>P({...I,department:e.target.value}),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-xs focus:ring-2 focus:ring-blue-500 bg-white",children:[t.jsx("option",{value:"",children:"All Departments"}),[...new Set(N.map(e=>e.profile?.department).filter(Boolean))].map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:I.contractType,onChange:e=>P({...I,contractType:e.target.value}),className:"w-full px-2 py-1.5 border border-gray-300 rounded text-xs focus:ring-2 focus:ring-blue-500 bg-white",children:[t.jsx("option",{value:"",children:"All Contract Types"}),t.jsx("option",{value:"permanent",children:"Permanent"}),t.jsx("option",{value:"contract",children:"Contract"}),t.jsx("option",{value:"temporary",children:"Temporary"})]}),t.jsxs("div",{className:"flex gap-1.5",children:[t.jsxs("label",{className:"flex-1 flex items-center gap-1.5 px-2 py-1.5 bg-gray-50 rounded border border-gray-200 text-xs cursor-pointer hover:bg-gray-100",children:[t.jsx("input",{type:"checkbox",checked:I.hasWarnings,onChange:e=>P({...I,hasWarnings:e.target.checked}),className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-gray-700",children:"Warnings"})]}),t.jsxs("label",{className:"flex-1 flex items-center gap-1.5 px-2 py-1.5 bg-gray-50 rounded border border-gray-200 text-xs cursor-pointer hover:bg-gray-100",children:[t.jsx("input",{type:"checkbox",checked:I.isActive,onChange:e=>P({...I,isActive:e.target.checked}),className:"w-3.5 h-3.5"}),t.jsx("span",{className:"text-gray-700",children:"Active"})]})]})]})})]}),!o&&t.jsxs("div",{className:"hidden md:flex md:items-center md:justify-between",children:[t.jsx("div",{className:"text-sm text-slate-600",children:"hr-manager"===b?.role?.id?"Full organizational view":"hod-manager"===b?.role?.id?"Your team structure":"Team directory"}),t.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:["hod-manager"!==b?.role?.id&&t.jsxs("button",{onClick:()=>J("organogram"),className:"flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs "+("organogram"===_?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"),children:[t.jsx(X,{className:"w-3 h-3"}),t.jsx("span",{children:"Hierarchy"})]}),t.jsxs("button",{onClick:()=>J("table"),className:"flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs "+("table"===_?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"),children:[t.jsx(W,{className:"w-3 h-3"}),t.jsx("span",{children:"Table"})]}),t.jsxs("button",{onClick:()=>J("cards"),className:"flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs "+("cards"===_?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"),children:[t.jsx(ee,{className:"w-3 h-3"}),t.jsx("span",{children:"Cards"})]})]})]}),!o&&"cards"===_&&t.jsx("div",{className:"hidden md:block bg-white/95 backdrop-blur-sm rounded-lg shadow-md border border-white/50 p-3",children:t.jsx(te,{filters:I,setFilters:P,departments:[...new Set(N.map(e=>e.profile.department))],viewMode:_,setViewMode:J})}),!o&&t.jsxs("div",{className:"md:hidden -mt-1 space-y-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",placeholder:"ðŸ” Search employees...",value:I.search,onChange:e=>P({...I,search:e.target.value}),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition-all bg-white text-sm"}),t.jsx("button",{onClick:()=>Ne(!je),className:"px-3 py-2.5 border rounded-lg font-medium text-sm transition-all "+(je?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-700"),children:t.jsx(V,{className:"w-4 h-4"})})]}),je&&t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2",children:[t.jsxs("select",{value:I.department,onChange:e=>P({...I,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm",children:[t.jsx("option",{value:"",children:"All Departments"}),[...new Set(N.map(e=>e.profile?.department).filter(Boolean))].map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:I.contractType,onChange:e=>P({...I,contractType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm",children:[t.jsx("option",{value:"",children:"All Contract Types"}),t.jsx("option",{value:"permanent",children:"Permanent"}),t.jsx("option",{value:"contract",children:"Contract"}),t.jsx("option",{value:"temporary",children:"Temporary"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("label",{className:"flex-1 flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsx("input",{type:"checkbox",checked:I.hasWarnings,onChange:e=>P({...I,hasWarnings:e.target.checked}),className:"w-4 h-4"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Has Warnings"})]}),t.jsxs("label",{className:"flex-1 flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsx("input",{type:"checkbox",checked:I.isActive,onChange:e=>P({...I,isActive:e.target.checked}),className:"w-4 h-4"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Active Only"})]})]})]})]}),"organogram"===_&&t.jsx(ce,{employees:T,onEmployeeClick:we,selectedEmployee:ye,inline:o}),"table"===_&&t.jsx(me,{employees:B,onEmployeeSelect:we,onEmployeeEdit:d?void 0:ke,onEmployeeDelete:d?void 0:Ce,onBulkAction:d?void 0:Se,selectedEmployee:ye,loading:v,compact:o,readOnly:d}),"cards"===_&&t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2.5 md:gap-3 pb-24 md:pb-0 -mt-0.5 md:mt-0",children:B.map(e=>t.jsx(ae,{employee:e,permissions:ve,onEdit:pe,onArchive:be,onView:we,onViewWarnings:e=>{e.id,localStorage.setItem("warningFilterEmployeeId",e.id),localStorage.setItem("warningFilterEmployeeName",`${e.profile.firstName} ${e.profile.lastName}`),window.dispatchEvent(new CustomEvent("navigateToWarnings",{detail:{employeeId:e.id}}))}},e.id))}),x?.isLegacyDevice&&q>1&&t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mt-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-600 legacy-text-size",children:["Page ",L," of ",q," (",T.length," total employees)"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>R(e=>Math.max(1,e-1)),disabled:1===L,className:"px-3 py-2 rounded-md legacy-touch-target legacy-text-size "+(1===L?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"),children:"Previous"}),t.jsxs("div",{className:"flex items-center px-3 py-2 text-sm text-gray-600 legacy-text-size",children:[Math.max(1,L-1),"-",Math.min(q,L+1)]}),t.jsx("button",{onClick:()=>R(e=>Math.min(q,e+1)),disabled:L===q,className:"px-3 py-2 rounded-md legacy-touch-target legacy-text-size "+(L===q?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"),children:"Next"})]})]})}),"archive"===_&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx("p",{className:"text-gray-500",children:"Archive list view is being reimplemented. Use the Archive button on individual employees."}),t.jsx("button",{onClick:()=>J("table"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Employee List"})]}),"cards"===_&&A.canLoadMore&&!v&&t.jsxs("div",{className:"text-center py-4",children:[t.jsx("button",{onClick:S,disabled:w,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 disabled:from-slate-400 disabled:to-slate-500 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:w?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:"Loading..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(z,{className:"w-4 h-4"}),t.jsxs("span",{children:["Load More (",N.length,")"]})]})}),t.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Page ",A.currentPage," â€¢ ",A.pageSize," per page"]})]}),!o&&!v&&0===T.length&&t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-6 text-center shadow-lg border border-white/50",children:[t.jsx("div",{className:"text-3xl mb-3",children:"ðŸ‘¥"}),t.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:0===N.length?"No employees yet":"No matching employees"}),t.jsx("p",{className:"text-slate-600 mb-4 text-sm",children:0===N.length?"Add your first employee or import from CSV":"Try adjusting your search criteria"}),ve.canCreate&&0===N.length&&t.jsxs("button",{onClick:()=>Y.open(),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[t.jsx(M,{className:"w-4 h-4"}),"Add First Employee"]})]}),(Y.isOpen||xe)&&t.jsx(re,{employee:xe,onClose:()=>{Y.close(),pe(null)},onSave:async()=>{await C(),Y.close(),pe(null),r?.()},basicMode:f}),Q.isOpen&&t.jsx(le,{onClose:Q.close,onImportComplete:async()=>{await C(),r?.()}}),he&&t.jsx(ne,{employee:he,onClose:()=>be(null),onArchive:async e=>{await D(e),be(null),r?.()}}),G.isOpen&&G.data&&t.jsx(ie,{isOpen:G.isOpen,onClose:G.close,employees:G.data,onAssign:De}),de.isOpen&&de.data&&t.jsx(oe,{isOpen:de.isOpen,onClose:de.close,employees:de.data,onAssign:Ee}),ye&&"cards"===_&&t.jsx(c,{isOpen:!0,onClose:()=>fe(null),title:"Employee Details",maxWidth:"2xl",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Personal Information"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Name:"})," ",ye.profile.firstName," ",ye.profile.lastName]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"ID:"})," ",ye.profile.employeeNumber]}),("hr-manager"===b?.role?.id||"executive-management"===b?.role?.id)&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Email:"})," ",ye.profile.email]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Phone:"})," ",ye.profile.phoneNumber||"Not provided"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Employment Details"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Department:"})," ",ye.profile.department]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Position:"})," ",ye.employment.position]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Start Date:"})," ",ye.employment?.startDate?new Date(ye.employment.startDate).toLocaleDateString():"Not set"]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Status:"}),t.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs "+(ye.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:ye.isActive?"Active":"Inactive"})]})]})]})]}),ve.canEdit&&t.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:()=>{pe(ye),fe(null)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Edit Employee"}),ye.isActive&&ve.canArchive&&t.jsx("button",{onClick:()=>{be(ye),fe(null)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Archive Employee"})]})]})}),!l&&ve.canCreate&&t.jsx("div",{className:"md:hidden fixed bottom-6 right-6 w-14 h-14 z-50",children:t.jsx("button",{onClick:Y.open,className:"w-full h-full bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95 flex items-center justify-center","aria-label":"Add Employee",children:t.jsx(M,{className:"w-6 h-6"})})})]})};export{be as EmployeeManagement};
