const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmployeeLifecycleService-B6O4LcrH.js","assets/react-vendor-e4uWabrV.js","assets/pdf-vendor-D1mz_3s2.js","assets/firebase-vendor-ZA7KOHFb.js","assets/ui-vendor-DaBpJB-Q.js"])))=>i.map(i=>d[i]);
import{a as fr,r as p,R as Ie,b as Yt,u as Zt}from"./react-vendor-e4uWabrV.js";import{a as Se}from"./pdf-vendor-D1mz_3s2.js";import{i as yr,g as br,a as vr,b as wr,c as Nr,d as jr,e as Dr,s as Ar,f as Er,h as Sr,o as Qt,j as O,k as le,l as F,q as M,m as B,n as ie,p as z,u as re,r as Jt,w as I,t as H,v as fe,F as Cr,x as ot,y as He,z as Xt,A as Le,T as De,B as Rr,C as kr,D as kt}from"./firebase-vendor-ZA7KOHFb.js";import{C as $r,X as _e,L as St,T as Ze,R as Qe,a as qe,b as Ne,I as Or,c as $t,S as bt,P as ze,d as Ot,E as Tr,e as vt,f as er,g as tr,h as rt,F as wt,i as xe,U as Be,B as lt,j as rr,k as sr,l as ht,m as ct,n as me,o as Xe,p as We,q as ar,r as nr,s as ir,D as Lr,t as Tt,u as Lt,M as Pr,v as Mr,w as Ir,x as et,y as _r,G as zr,z as Fr,A as it,W as Ur,H as Wr,J as Ee,K as pt,N as Pt,O as Mt,Q as It,V as Hr}from"./ui-vendor-DaBpJB-Q.js";var xt={exports:{}},Ke={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _t;function qr(){if(_t)return Ke;_t=1;var i=fr(),t=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function l(c,m,d){var u,x={},b=null,f=null;d!==void 0&&(b=""+d),m.key!==void 0&&(b=""+m.key),m.ref!==void 0&&(f=m.ref);for(u in m)s.call(m,u)&&!n.hasOwnProperty(u)&&(x[u]=m[u]);if(c&&c.defaultProps)for(u in m=c.defaultProps,m)x[u]===void 0&&(x[u]=m[u]);return{$$typeof:t,type:c,key:b,ref:f,props:x,_owner:a.current}}return Ke.Fragment=r,Ke.jsx=l,Ke.jsxs=l,Ke}var zt;function Vr(){return zt||(zt=1,xt.exports=qr()),xt.exports}var e=Vr();class o{static{this.isDevelopment=!1}static{this.isProduction=!0}static{this.productionWhitelist=["❌","🚨","⚠️","✅","🎯"]}static debug(t,r,s){this.isDevelopment&&console.debug(this.formatMessage("DEBUG",t,s),r)}static info(t,r,s){(this.isDevelopment||this.isWhitelistedMessage(t))&&console.info(this.formatMessage("INFO",t,s),r)}static warn(t,r,s){const a=this.isProduction?this.sanitizeData(r):r;console.warn(this.formatMessage("WARN",t,s),a)}static error(t,r,s){const a=this.isProduction?this.sanitizeError(r):r;console.error(this.formatMessage("ERROR",t,s),a),this.isProduction&&this.sendToMonitoring("error",t,a,s)}static success(t,r,s){const a=String(t);(this.isDevelopment||this.isWhitelistedMessage(t))&&console.log(this.formatMessage("SUCCESS",a,s),r)}static perf(t,r,s){if(this.isDevelopment){const a=Date.now()-r;console.debug(this.formatMessage("PERF",`${t} completed in ${a}ms`,s))}}static isWhitelistedMessage(t){const r=String(t);return this.productionWhitelist.some(s=>r.startsWith(s))}static formatMessage(t,r,s){const a=new Date().toISOString(),n=s?this.formatContext(s):"";return`[${a}] ${t}: ${r}${n}`}static formatContext(t){const r=[];return t.organizationId&&r.push(`org:${t.organizationId.slice(-8)}`),t.userId&&r.push(`user:${t.userId.slice(-8)}`),t.component&&r.push(`comp:${t.component}`),t.action&&r.push(`action:${t.action}`),r.length>0?` [${r.join(", ")}]`:""}static sanitizeData(t){if(!t)return t;if(typeof t=="string")return this.sanitizeString(t);if(typeof t=="object"){const r={};for(const[s,a]of Object.entries(t))this.isSensitiveKey(s)?r[s]="[REDACTED]":typeof a=="object"?r[s]=this.sanitizeData(a):r[s]=a;return r}return t}static sanitizeError(t){return t&&(t instanceof Error?{name:t.name,message:this.sanitizeString(t.message),stack:this.isDevelopment?t.stack:"[REDACTED]"}:this.sanitizeData(t))}static isSensitiveKey(t){const r=["password","token","secret","key","auth","credential","email","phone","address","ssn","id_number","passport","salary","wage","bank","account","credit","personal","medical","health","disciplinary","performance"],s=t.toLowerCase();return r.some(a=>s.includes(a))}static sanitizeString(t){return!t||typeof t!="string"||(t=t.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,"[EMAIL]"),t=t.replace(/(\+27|0)[6-8][0-9]{8}/g,"[PHONE]"),t=t.replace(/\b\d{13}\b/g,"[ID_NUMBER]"),t=t.replace(/\b[a-zA-Z0-9]{20,}\b/g,"[TOKEN]")),t}static sendToMonitoring(t,r,s,a){try{const n={level:t,message:r,data:s,context:a,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href},l=JSON.parse(localStorage.getItem("hr_production_errors")||"[]");l.push(n),l.length>20&&l.shift(),localStorage.setItem("hr_production_errors",JSON.stringify(l))}catch{}}static getProductionLogs(){try{return JSON.parse(localStorage.getItem("hr_production_errors")||"[]")}catch{return[]}}static clearProductionLogs(){localStorage.removeItem("hr_production_errors")}}o.debug.bind(o),o.info.bind(o),o.warn.bind(o),o.error.bind(o),o.success.bind(o),o.perf.bind(o);const Br={apiKey:"AIzaSyCghheyHpRDcc-2sue-u1apExJr6jQCzyw",authDomain:"hr-disciplinary-system.firebaseapp.com",projectId:"hr-disciplinary-system",storageBucket:"hr-disciplinary-system.firebasestorage.app",messagingSenderId:"989741369966",appId:"1:989741369966:web:e388dc78d75744d828747f",measurementId:void 0},Ge=yr(Br),Te=br(Ge),y=vr(Ge),Gr=wr(Ge),Nt=Nr(Ge,"us-central1");jr(Ge);Dr(y).then(()=>{o.debug("🔥 Firestore network enabled successfully")}).catch(i=>{o.error("Failed to enable Firestore network:",i)});const Kr=Object.freeze(Object.defineProperty({__proto__:null,app:Ge,auth:Te,db:y,functions:Nt,storage:Gr},Symbol.toStringTag,{value:"Module"}));class Yr{constructor(){this.isCreatingUser=!1,this.pendingUserIds=new Set}startUserCreation(t){this.isCreatingUser=!0,this.pendingUserIds.add(t)}finishUserCreation(t){this.pendingUserIds.delete(t),this.pendingUserIds.size===0&&(this.isCreatingUser=!1)}isCreating(){return this.isCreatingUser}isPendingUser(t){return this.pendingUserIds.has(t)}}const jt=new Yr;class Ve extends Error{constructor(t,r,s){super(t),this.code=r,this.originalError=s,this.name="FirebaseServiceError"}}class we{static handle(t,r){throw o.error(`[FirebaseService] ${r} failed`,t),t instanceof Cr?new Ve(`Firestore error during ${r}: ${t.message}`,t.code,t):t&&typeof t=="object"&&"code"in t&&"message"in t?new Ve(`Auth error during ${r}: ${t.message}`,t.code,t):new Ve(`Unknown error during ${r}`,"unknown",t)}}class de{static async signIn(t,r){try{o.debug("Attempting sign in",{email:t});const s=await Ar(Te,t,r);return o.debug("Sign in successful",{uid:s.user.uid}),s.user}catch(s){we.handle(s,"signIn")}}static async signUp(t,r){try{o.debug("Creating new user",{email:t});const s=await Er(Te,t,r);return o.debug("User created successfully",{uid:s.user.uid}),s.user}catch(s){we.handle(s,"signUp")}}static async signOut(){try{o.debug("Signing out user"),await Sr(Te),o.debug("Sign out successful")}catch(t){we.handle(t,"signOut")}}static onAuthStateChanged(t){return Qt(Te,t)}static async getDocument(t,r){try{o.debug("Getting document",{collection:t,id:r});const s=O(y,t,r),a=await le(s);return a.exists()?(o.debug("Document found",{collection:t,id:r}),{id:a.id,...a.data()}):(jt.isPendingUser(r)||jt.isCreating()?o.debug("Document not found (expected during user creation)",{collection:t,id:r}):o.warn("Document not found",{collection:t,id:r}),null)}catch(s){we.handle(s,`getDocument(${t}/${r})`)}}static async getCollection(t,r){try{o.debug("Getting collection",{collection:t});const s=F(y,t);let a=r?M(s,...r):s;const l=(await B(a)).docs.map(c=>({id:c.id,...c.data()}));return o.debug("Collection retrieved",{collection:t,count:l.length}),l}catch(s){we.handle(s,`getCollection(${t})`)}}static async createDocument(t,r,s){try{const a=s||O(F(y,t)).id;o.debug("Creating document",{collection:t,id:a});const n=O(y,t,a),{id:l,...c}=r;return await ie(n,{...c,createdAt:z(),updatedAt:z()}),o.debug("Document created",{collection:t,id:a}),a}catch(a){we.handle(a,`createDocument(${t})`)}}static async setDocument(t,r,s){try{o.debug("Setting document",{collection:t,id:r});const a=O(y,t,r);await ie(a,s),o.debug("Document set",{collection:t,id:r})}catch(a){we.handle(a,`setDocument(${t}/${r})`)}}static async updateDocument(t,r,s){try{o.debug("Updating document",{collection:t,id:r});const a=O(y,t,r);await re(a,{...s,updatedAt:z()}),o.debug("Document updated",{collection:t,id:r})}catch(a){we.handle(a,`updateDocument(${t}/${r})`)}}static async deleteDocument(t,r){try{o.debug("Deleting document",{collection:t,id:r});const s=O(y,t,r);await Jt(s),o.debug("Document deleted",{collection:t,id:r})}catch(s){we.handle(s,`deleteDocument(${t}/${r})`)}}static async queryDocuments(t,r,s,a){try{o.debug("Querying documents",{collection:t,conditions:r.length});const n=r.map(l=>I(l.field,l.operator,l.value));return s&&n.push(H(s)),a&&n.push(fe(a)),await this.getCollection(t,n)}catch(n){we.handle(n,`queryDocuments(${t})`)}}static async batchCreate(t,r){try{o.debug("Batch creating documents",{collection:t,count:r.length});const s=[];for(let a=0;a<r.length;a+=10){const l=r.slice(a,a+10).map(m=>this.createDocument(t,m)),c=await Promise.all(l);s.push(...c)}return o.debug("Batch create completed",{collection:t,created:s.length}),s}catch(s){we.handle(s,`batchCreate(${t})`)}}static async refreshUserClaims(t){try{o.debug("Refreshing user custom claims",{targetUserId:t});const{getFunctions:r,httpsCallable:s}=await Se(async()=>{const{getFunctions:c,httpsCallable:m}=await import("./firebase-vendor-ZA7KOHFb.js").then(d=>d.Y);return{getFunctions:c,httpsCallable:m}},[]),a=r(),l=await s(a,"refreshUserClaims")({targetUserId:t});return o.debug("Custom claims refreshed successfully",l.data),l.data}catch(r){throw o.error("Failed to refresh custom claims:",r),new Ve("Failed to refresh custom claims","refresh-claims-failed",r)}}static async refreshOrganizationUserClaims(t){try{o.debug("Refreshing organization user claims",{organizationId:t});const{getFunctions:r,httpsCallable:s}=await Se(async()=>{const{getFunctions:c,httpsCallable:m}=await import("./firebase-vendor-ZA7KOHFb.js").then(d=>d.Y);return{getFunctions:c,httpsCallable:m}},[]),a=r(),l=await s(a,"refreshOrganizationUserClaims")({organizationId:t});return o.debug("Organization claims refreshed successfully",l.data),l.data}catch(r){throw o.error("Failed to refresh organization claims:",r),new Ve("Failed to refresh organization claims","refresh-org-claims-failed",r)}}static async getUserClaims(){try{o.debug("Getting user custom claims");const{getFunctions:t,httpsCallable:r}=await Se(async()=>{const{getFunctions:l,httpsCallable:c}=await import("./firebase-vendor-ZA7KOHFb.js").then(m=>m.Y);return{getFunctions:l,httpsCallable:c}},[]),s=t(),n=await r(s,"getUserClaims")();return o.debug("User claims retrieved",n.data),n.data}catch(t){throw o.error("Failed to get user claims:",t),new Ve("Failed to get user claims","get-claims-failed",t)}}}const Vs={ORGANIZATIONS:"organizations",USERS:"users",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warningCategories",ESCALATION_RULES:"escalationRules",AUDIT_LOGS:"auditLogs",DOCUMENTS:"documents",TEMPLATES:"templates"};class Ae{static getServerTimestamp(){return z()}static getClientTimeForDisplay(){return o.debug("⚠️ Using client time for display only - NOT stored in database"),new Date}static formatSADateTime(t){return(typeof t=="string"?new Date(t):t).toLocaleString("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}static formatSADate(t){return(typeof t=="string"?new Date(t):t).toLocaleDateString("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit"})}static getClientISOString(){return o.warn("⚠️ CLIENT ISO STRING - For display/calculation only, NOT for database storage"),new Date().toISOString()}static daysBetween(t,r){const s=typeof t=="string"?new Date(t):t,a=typeof r=="string"?new Date(r):r,n=Math.abs(a.getTime()-s.getTime());return Math.ceil(n/(1e3*60*60*24))}static isServerTimestamp(t){return t&&typeof t=="object"&&"_methodName"in t}static getWarningExpiryTimestamp(){return z()}static createAuditTimestamp(t,r){return{action:t,userId:r,timestamp:z(),source:"web-client"}}}const Bs=Object.freeze(Object.defineProperty({__proto__:null,TimeService:Ae},Symbol.toStringTag,{value:"Module"}));class Y{static{this.config={maxDocumentsPerShard:1e4,enableCollectionGroups:!0,enableCrossOrgQueries:!1,cacheEnabled:!0,batchSize:500}}static{this.pathCache=new Map}static getShardedPath(t,r){const s=`${t}:${r}`;if(this.config.cacheEnabled&&this.pathCache.has(s))return this.pathCache.get(s);const a=`organizations/${t}/${r}`;return this.config.cacheEnabled&&this.pathCache.set(s,a),a}static getShardedCollection(t,r){const s=this.getShardedPath(t,r);return F(y,s)}static getShardedDocument(t,r,s){const a=this.getShardedPath(t,r);return O(y,a,s)}static async createDocument(t,r,s,a){try{const n=Date.now(),l=this.getShardedCollection(t,r);let c;a?(c=O(l,a),await ie(c,{...s,organizationId:t,createdAt:Ae.getServerTimestamp(),updatedAt:Ae.getServerTimestamp()})):c=await ot(l,{...s,organizationId:t,createdAt:Ae.getServerTimestamp(),updatedAt:Ae.getServerTimestamp()});const m=Date.now()-n;return o.debug(`🗂️ [SHARD] Document created in ${m}ms`,{organizationId:t,collection:r,documentId:c.id,path:this.getShardedPath(t,r)}),c.id}catch(n){throw o.error(`❌ [SHARD] Create failed for ${t}/${r}:`,n),n}}static async getDocument(t,r,s){try{const a=Date.now(),n=this.getShardedDocument(t,r,s),l=await le(n),c=Date.now()-a;return o.debug(`📄 [SHARD] Document retrieved in ${c}ms`,{organizationId:t,collection:r,documentId:s,exists:l.exists()}),l.exists()?{id:l.id,...l.data()}:null}catch(a){throw o.error(`❌ [SHARD] Read failed for ${t}/${r}/${s}:`,a),a}}static async updateDocument(t,r,s,a){try{const n=Date.now(),l=this.getShardedDocument(t,r,s);await re(l,{...a,updatedAt:Ae.getServerTimestamp()});const c=Date.now()-n;o.debug(`✏️ [SHARD] Document updated in ${c}ms`,{organizationId:t,collection:r,documentId:s})}catch(n){throw o.error(`❌ [SHARD] Update failed for ${t}/${r}/${s}:`,n),n}}static async deleteDocument(t,r,s){try{const a=Date.now(),n=this.getShardedDocument(t,r,s);await Jt(n);const l=Date.now()-a;o.debug(`🗑️ [SHARD] Document deleted in ${l}ms`,{organizationId:t,collection:r,documentId:s})}catch(a){throw o.error(`❌ [SHARD] Delete failed for ${t}/${r}/${s}:`,a),a}}static async queryDocuments(t,r,s=[],a){try{const n=Date.now(),l=this.getShardedCollection(t,r);let c=M(l,...s);a&&(a.orderField&&(c=M(c,H(a.orderField,a.orderDirection||"desc"))),a.lastDocument&&(c=M(c,He(a.lastDocument))),c=M(c,fe(a.pageSize)));const m=await B(c),d=m.docs.map(b=>({id:b.id,...b.data()})),u=Date.now()-n,x=m.docs[m.docs.length-1];return o.debug(`🔍 [SHARD] Query completed in ${u}ms`,{organizationId:t,collection:r,resultCount:d.length,hasMore:m.docs.length===(a?.pageSize||0)}),{documents:d,lastDocument:x,hasMore:a?m.docs.length===a.pageSize:!1,shardInfo:{organizationId:t,path:this.getShardedPath(t,r),queryTime:u}}}catch(n){throw o.error(`❌ [SHARD] Query failed for ${t}/${r}:`,n),n}}static async queryCollectionGroup(t,r=[],s){if(!this.config.enableCrossOrgQueries)throw new Error("Cross-organization queries are disabled for security");try{const a=Date.now(),n=Xt(y,t);let l=M(n,...r);s&&(s.orderField&&(l=M(l,H(s.orderField,s.orderDirection||"desc"))),s.lastDocument&&(l=M(l,He(s.lastDocument))),l=M(l,fe(s.pageSize)));const c=await B(l),m=c.docs.map(x=>({id:x.id,...x.data()})),d=Date.now()-a,u=c.docs[c.docs.length-1];return o.warn(`⚠️ [SHARD] Cross-org query executed in ${d}ms`,{collection:t,resultCount:m.length,security:"CROSS_ORG_QUERY_USED"}),{documents:m,lastDocument:u,hasMore:s?c.docs.length===s.pageSize:!1,shardInfo:{organizationId:"COLLECTION_GROUP",path:`collectionGroup(${t})`,queryTime:d}}}catch(a){throw o.error(`❌ [SHARD] Collection group query failed for ${t}:`,a),a}}static async batchWrite(t){try{const r=Date.now(),s=Le(y);for(const n of t){const{organizationId:l,collectionName:c,operation:m,documentId:d,data:u}=n;if(m==="create"){const x=d?this.getShardedDocument(l,c,d):O(this.getShardedCollection(l,c));s.set(x,{...u,organizationId:l,createdAt:new Date,updatedAt:Ae.getServerTimestamp()})}else if(m==="update"&&d){const x=this.getShardedDocument(l,c,d);s.update(x,{...u,updatedAt:Ae.getServerTimestamp()})}else if(m==="delete"&&d){const x=this.getShardedDocument(l,c,d);s.delete(x)}}await s.commit();const a=Date.now()-r;o.success(`📦 [SHARD] Batch operation completed in ${a}ms`,{operationCount:t.length,organizations:[...new Set(t.map(n=>n.organizationId))]})}catch(r){throw o.error("❌ [SHARD] Batch write failed:",r),r}}static async getShardStatistics(t){try{const r=["warnings","employees","categories","meetings","absences"],s=[];let a=0;for(const l of r){const m=(await this.queryDocuments(t,l,[],{pageSize:1e3})).documents.length;a+=m,s.push({name:l,documentCount:m,path:this.getShardedPath(t,l)})}const n=a>this.config.maxDocumentsPerShard*.8?"warning":a>this.config.maxDocumentsPerShard?"critical":"healthy";return{organizationId:t,collections:s,totalDocuments:a,shardHealth:n}}catch(r){throw o.error(`❌ [SHARD] Statistics failed for ${t}:`,r),r}}static async getSystemShardingMetrics(){return{totalOrganizations:2700,averageDocumentsPerOrg:8500,largestShards:[{organizationId:"large-corp-1",documentCount:95e3},{organizationId:"enterprise-2",documentCount:87e3},{organizationId:"global-org-3",documentCount:76e3}],performanceMetrics:{averageQueryTime:245,slowQueries:12,errorRate:.003}}}static async migrateFlatToSharded(t,r,s=100){o.warn(`🔄 [MIGRATION] Starting migration: ${t} -> ${r}`);const a={migrated:0,failed:0,skipped:0,errors:[]};try{const n=F(y,t),l=M(n,fe(s));let c=null,m=!0;for(;m;){let d=l;c&&(d=M(n,He(c),fe(s)));const u=await B(d);if(u.empty){m=!1;continue}const x=[];for(const b of u.docs){const f=b.data();if(!f.organizationId){a.skipped++,a.errors.push(`Document ${b.id} missing organizationId`);continue}x.push({organizationId:f.organizationId,collectionName:r,operation:"create",documentId:b.id,data:f})}try{await this.batchWrite(x),a.migrated+=x.length,o.debug(`✅ [MIGRATION] Migrated batch: ${x.length} documents`)}catch(b){a.failed+=x.length,a.errors.push(`Batch migration failed: ${b}`),o.error("❌ [MIGRATION] Batch failed:",b)}c=u.docs[u.docs.length-1],m=u.docs.length===s}return o.success(`🎉 [MIGRATION] Completed: ${a.migrated} migrated, ${a.failed} failed, ${a.skipped} skipped`),a}catch(n){throw o.error("❌ [MIGRATION] Migration failed:",n),n}}static updateConfig(t){this.config={...this.config,...t},o.debug("⚙️ [SHARD] Configuration updated:",this.config)}static clearCache(){this.pathCache.clear(),o.debug("🧹 [SHARD] Path cache cleared")}}class Ye{static{this.COLLECTION="userOrgIndex"}static{this.CACHE_TTL=300*1e3}static{this.cache=new Map}static async getUserOrganization(t){try{const r=this.cache.get(t);if(r&&Date.now()-r.timestamp<this.CACHE_TTL)return o.debug(`📋 Cache hit for user ${t}`),r.entry;const s=await de.getDocument(this.COLLECTION,t);return s?(this.cache.set(t,{entry:s,timestamp:Date.now()}),o.success(`✅ Found user organization mapping: ${t} → ${s.organizationId}`),s):(o.debug(`❌ No organization mapping found for user: ${t}`),null)}catch(r){return o.error("❌ Error fetching user organization mapping:",r),null}}static async setUserOrganization(t,r,s,a,n="sharded"){try{const l={userId:t,organizationId:r,role:s,email:a,isActive:!0,lastUpdated:new Date,userType:n};await de.setDocument(this.COLLECTION,t,l),this.cache.set(t,{entry:l,timestamp:Date.now()}),o.success(`✅ User organization mapping created: ${t} → ${r}`)}catch(l){throw o.error("❌ Error creating user organization mapping:",l),l}}static async removeUserOrganization(t){try{await de.deleteDocument(this.COLLECTION,t),this.cache.delete(t),o.success(`✅ User organization mapping removed: ${t}`)}catch(r){throw o.error("❌ Error removing user organization mapping:",r),r}}static async setUserActiveStatus(t,r){try{const s=await this.getUserOrganization(t);if(s){const a={...s,isActive:r,lastUpdated:new Date};await de.updateDocument(this.COLLECTION,t,a),this.cache.set(t,{entry:a,timestamp:Date.now()}),o.success(`✅ User active status updated: ${t} → ${r}`)}}catch(s){throw o.error("❌ Error updating user active status:",s),s}}static async getOrganizationUsers(t){try{const r=await de.queryDocuments(this.COLLECTION,[{field:"organizationId",operator:"==",value:t},{field:"isActive",operator:"==",value:!0}]);return o.success(`✅ Found ${r.length} users for organization: ${t}`),r}catch(r){return o.error("❌ Error fetching organization users:",r),[]}}static async getUserWithOrganization(t){try{const r=await this.getUserOrganization(t);if(!r)return null;let s=null;return r.userType==="flat"?s=await de.getDocument("users",t):s=await Y.getDocument(r.organizationId,"users",t),s?{user:s,organizationId:r.organizationId}:(o.warn(`⚠️ Index exists but user data missing for ${t}, cleaning up index...`),await this.removeUserOrganization(t),null)}catch(r){return o.error("❌ Error getting user with organization:",r),null}}static clearCache(){this.cache.clear(),o.debug("🧹 User organization cache cleared")}static async migrateExistingUsers(){try{o.debug("🔄 Starting user organization index migration...");const t=await de.getCollection("users");for(const s of t)s.id&&s.email&&s.role&&await this.setUserOrganization(s.id,s.organizationId||"system",s.role,s.email,"flat");const r=await de.getCollection("organizations");for(const s of r)try{const a=await Y.getCollection(s.id,"users");for(const n of a)n.id&&n.email&&n.role&&await this.setUserOrganization(n.id,s.id,n.role,n.email,"sharded");o.debug(`✅ Migrated ${a.length} users from organization: ${s.id}`)}catch(a){o.error(`❌ Error migrating users from organization ${s.id}:`,a)}o.success("✅ User organization index migration completed")}catch(t){throw o.error("❌ Error during migration:",t),t}}static async healthCheck(){const t=[];try{const r=await de.getCollection(this.COLLECTION);for(const a of r)try{a.userType==="flat"?await de.getDocument("users",a.userId)||t.push(`Orphaned flat user index: ${a.userId}`):await Y.getDocument(a.organizationId,"users",a.userId)||t.push(`Orphaned sharded user index: ${a.userId} in ${a.organizationId}`)}catch(n){t.push(`Error checking user ${a.userId}: ${n}`)}const s=t.length===0;return s?o.success("✅ User organization index health check passed"):o.warn(`⚠️ User organization index health check found ${t.length} issues`),{healthy:s,issues:t}}catch(r){return o.error("❌ Error during health check:",r),{healthy:!1,issues:[`Health check failed: ${r}`]}}}}const Ue={USERS:"users",ORGANIZATIONS:"organizations",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warning_categories",ESCALATION_RULES:"escalation_rules",AUDIT_LOGS:"audit_logs"},ft=i=>{if(typeof i=="object"&&i?.id)return i;if(typeof i=="string"){const t={"super-user":"Super User","business-owner":"Business Owner","hr-manager":"HR Manager","hod-manager":"Department Manager"},r={"super-user":"Global system administrator with full access","business-owner":"Organization owner with business oversight","hr-manager":"Human resources manager with employee management access","hod-manager":"Department head with team management capabilities"},s={"super-user":1,"business-owner":2,"hr-manager":3,"hod-manager":4};return{id:i,name:t[i]||i.charAt(0).toUpperCase()+i.slice(1),description:r[i]||`${i} role`,level:s[i]||5}}return o.warn("⚠️ Invalid role format detected:",i),{id:"unknown",name:"Unknown Role",description:"Role format not recognized",level:99}},Zr=(i,t)=>{switch(t.type){case"SET_LOADING":return{...i,loading:t.payload};case"SET_USER":return{...i,user:t.payload,loading:!1,error:null};case"SET_ORGANIZATION":return{...i,organization:t.payload};case"SET_ERROR":return{...i,error:t.payload,loading:!1};case"LOGOUT":return{user:null,organization:null,loading:!1,error:null};default:return i}},Qr={user:null,organization:null,loading:!0,error:null},or=p.createContext(void 0),Gs=({children:i})=>{const[t,r]=p.useReducer(Zr,Qr);p.useEffect(()=>(o.debug("🔐 Initializing Firebase authentication..."),Qt(Te,async m=>{try{if(m){if(o.debug("👤 Firebase user authenticated:",m.email),jt.isPendingUser(m.uid)){o.debug("⏳ User creation in progress, waiting for completion..."),r({type:"SET_LOADING",payload:!0}),setTimeout(async()=>{const u=await Ye.getUserWithOrganization(m.uid);if(u){const x=ft(u.user.role);if(r({type:"SET_USER",payload:{...u.user,role:x}}),u.organizationId&&u.organizationId!=="system"){const b=await de.getDocument(Ue.ORGANIZATIONS,u.organizationId);b&&r({type:"SET_ORGANIZATION",payload:b})}}else o.error("❌ User creation completed but user not found in index"),r({type:"SET_ERROR",payload:"User profile not found after creation"});r({type:"SET_LOADING",payload:!1})},2e3);return}const d=await Ye.getUserWithOrganization(m.uid);if(d){const u=await m.getIdTokenResult();if(!u.claims.role||typeof u.claims.role=="object"){console.warn("⚠️ [AUTH] Role missing or incorrectly formatted! Calling refreshUserClaims...");try{const{getFunctions:f,httpsCallable:S}=await Se(async()=>{const{getFunctions:g,httpsCallable:h}=await import("./firebase-vendor-ZA7KOHFb.js").then(D=>D.Y);return{getFunctions:g,httpsCallable:h}},[]),C=f(void 0,"us-central1");await S(C,"refreshUserClaims")({}),console.log("✅ [AUTH] Claims refreshed! Signing out..."),await Te.signOut(),alert("Your user role has been refreshed! Please SIGN IN AGAIN.");return}catch(f){console.error("❌ [AUTH] Failed to refresh claims:",f)}}const b=ft(d.user.role);if(r({type:"SET_USER",payload:{...d.user,role:b}}),d.organizationId&&d.organizationId!=="system"){const f=await de.getDocument(Ue.ORGANIZATIONS,d.organizationId);f&&r({type:"SET_ORGANIZATION",payload:f})}o.success(`✅ User authenticated via index: ${d.user.email} → ${d.organizationId}`)}else{o.debug("👤 User not found in index, trying legacy lookup...");let u=await de.getDocument(Ue.USERS,m.uid);if(u){o.success("✅ Found user in flat structure (super user/reseller)");try{await Ye.setUserOrganization(m.uid,u.organizationId||"system",u.role,u.email,"flat"),o.success(`✅ Created index entry for flat user: ${m.uid}`)}catch(x){o.error("❌ Failed to create index entry for flat user:",x)}}else{o.debug("👤 User not found in flat structure, searching sharded organizations...");const b=(await de.getCollection(Ue.ORGANIZATIONS)).map(async C=>{try{const w=await Y.getDocument(C.id,"users",m.uid);return w?{user:w,orgId:C.id}:null}catch{return null}}),S=(await Promise.all(b)).find(C=>C!==null);if(S){u=S.user,o.success(`✅ Found user in sharded organization: ${S.orgId}`);try{await Ye.setUserOrganization(m.uid,S.orgId,u.role,u.email,"sharded"),o.success(`✅ Created index entry for user: ${m.uid}`)}catch(w){o.error("❌ Failed to create index entry:",w)}const C=await de.getDocument(Ue.ORGANIZATIONS,S.orgId);C&&r({type:"SET_ORGANIZATION",payload:C})}}if(u){const x=ft(u.role);r({type:"SET_USER",payload:{...u,role:x}})}else o.error("❌ User not found in any organization"),r({type:"SET_ERROR",payload:"User profile not found"})}}else o.debug("🚪 No authenticated user found"),r({type:"LOGOUT"})}catch(d){o.error("❌ Error in authentication flow:",d),r({type:"SET_ERROR",payload:"Authentication error occurred. Please try again."})}finally{r({type:"SET_LOADING",payload:!1})}})),[]);const s=async(c,m)=>{o.debug("🚀 Login attempt for:",c);try{if(!c||!m)throw new Error("Email and password are required");if(!c.includes("@"))throw new Error("Please enter a valid email address");if(r({type:"SET_LOADING",payload:!0}),r({type:"SET_ERROR",payload:null}),o.debug("🔐 Authenticating with Firebase..."),!await de.signIn(c,m))throw new Error("Authentication failed");o.success(8714)}catch(d){let u="Login failed";throw d instanceof Error&&(d.message.includes("user-not-found")?u="No account found with this email address":d.message.includes("wrong-password")?u="Incorrect password":d.message.includes("invalid-email")?u="Invalid email address format":d.message.includes("too-many-requests")?u="Too many failed attempts. Please try again later":d.message.includes("user-disabled")?u="This account has been disabled. Please contact support":u=d.message),o.error("❌ Login failed:",u),r({type:"SET_ERROR",payload:u}),new Error(u)}},a=async()=>{o.debug("🚪 Logging out...");try{await de.signOut(),o.success(10222)}catch(c){o.error("⚠️ Logout error:",c),r({type:"LOGOUT"})}},n=async c=>{if(!t.user)throw new Error("No authenticated user");if(t.user.role.id!=="super-user")throw new Error("Only super users can switch organizations");try{if(r({type:"SET_LOADING",payload:!0}),r({type:"SET_ERROR",payload:null}),c==="all"||c==="")o.debug("🌐 Switching to global view"),r({type:"SET_ORGANIZATION",payload:null});else{o.debug("🔄 Switching to organization:",c);const m=await de.getDocument(Ue.ORGANIZATIONS,c);if(!m)throw new Error(`Organization '${c}' not found`);o.success(11662),r({type:"SET_ORGANIZATION",payload:m})}}catch(m){const d=m instanceof Error?m.message:"Failed to switch organization";throw o.error("❌ Organization switch failed:",d),r({type:"SET_ERROR",payload:d}),m}finally{r({type:"SET_LOADING",payload:!1})}},l={user:t.user,organization:t.organization,loading:t.loading,error:t.error,login:s,logout:a,switchOrganization:n};return e.jsx(or.Provider,{value:l,children:i})},ye=()=>{const i=p.useContext(or);if(!i)throw new Error("useAuth must be used within an AuthProvider");return i},Jr=()=>{const i=navigator.userAgent,t=/Android [234]\./.test(i),r=/OS [67]_/.test(i),s=t||r||/Android [234]/.test(i)||/iPhone OS [1-7]_/.test(i),a="mediaDevices"in navigator&&"MediaRecorder"in window,n=CSS?.supports?.("display","grid")&&CSS?.supports?.("color","var(--test)"),l=navigator.hardwareConcurrency>2&&navigator.deviceMemory>1,c="MediaRecorder"in window;let m="unknown",d="unknown";return/Chrome\//.test(i)?(m="Chrome",d=i.match(/Chrome\/(\d+)/)?.[1]||"unknown"):/Safari\//.test(i)&&!/Chrome/.test(i)?(m="Safari",d=i.match(/Version\/(\d+)/)?.[1]||"unknown"):/Android.*Browser/.test(i)&&(m="Android Browser",d=i.match(/Android (\d+\.\d+)/)?.[1]||"unknown"),{isLegacyDevice:s,hasModernAudio:a,hasModernCSS:n,hasGoodPerformance:l,supportsMediaRecorder:c,browserInfo:{name:m,version:d,isAndroid4x:t,isIOS6to7:r}}},lr=i=>i.isLegacyDevice?{employeeListLimit:10,warningHistoryLimit:5,imageMaxSize:500,audioMaxDuration:30,enableAnimations:!1,enableTransitions:!1}:{employeeListLimit:50,warningHistoryLimit:20,imageMaxSize:2048,audioMaxDuration:180,enableAnimations:!0,enableTransitions:!0},Xr=i=>{const t=document.body;i.isLegacyDevice&&t.classList.add("legacy-device"),i.browserInfo.isAndroid4x&&t.classList.add("android-4x"),i.browserInfo.isIOS6to7&&t.classList.add("ios-6-7"),i.hasModernAudio||t.classList.add("no-modern-audio"),i.hasModernCSS||t.classList.add("no-modern-css")},es=()=>{const i=()=>{const t=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${t}px`),document.documentElement.classList.add("js-viewport-fixed")};i(),window.addEventListener("resize",i),window.addEventListener("orientationchange",()=>{setTimeout(i,100)})},ts=i=>{if(!i.isLegacyDevice)return;setInterval(()=>{if("memory"in performance){const s=performance.memory.usedJSHeapSize/1048576;s>50&&(console.warn("High memory usage detected on legacy device:",s.toFixed(2),"MB"),window.gc&&window.gc())}},3e4)},rs=()=>{const i=Jr();return Xr(i),es(),ts(i),i.isLegacyDevice&&console.log("Legacy device detected:",{browser:i.browserInfo,hasModernAudio:i.hasModernAudio,hasModernCSS:i.hasModernCSS,performance:lr(i)}),i};let $e;typeof window<"u"&&($e=rs());class tt{static async getWarningCategories(t){try{const r=F(y,"organizations",t,"categories"),s=M(r,I("isActive","==",!0),H("name"));return(await B(s)).docs.map(n=>({id:n.id,...n.data()}))}catch(r){return o.error("[DataServiceV2] Error getting categories:",r),[]}}static async getWarningCategory(t,r){try{const s=O(y,"organizations",t,"categories",r),a=await le(s);return a.exists()?{id:a.id,...a.data()}:null}catch(s){return o.error("[DataServiceV2] Error getting category:",s),null}}static async updateWarningCategory(t,r,s){try{const a=O(y,"organizations",t,"categories",r);await re(a,{...s,updatedAt:z()})}catch(a){throw o.error("[DataServiceV2] Error updating category:",a),a}}static async getEmployeesByOrganization(t){try{const r=F(y,"organizations",t,"employees"),s=M(r,H("profile.lastName"),H("profile.firstName"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertDate(n.data().createdAt),updatedAt:this.convertDate(n.data().updatedAt)}))}catch(r){return o.error("[DataServiceV2] Error getting employees:",r),[]}}static async getEmployee(t,r){try{const s=O(y,"organizations",t,"employees",r),a=await le(s);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),updatedAt:this.convertDate(a.data().updatedAt)}:null}catch(s){return o.error("[DataServiceV2] Error getting employee:",s),null}}static async saveEmployee(t,r){try{const s=r.id?O(y,"organizations",t,"employees",r.id):O(F(y,"organizations",t,"employees")),a={...r,organizationId:t,updatedAt:z(),...r.id?{}:{createdAt:z()}};return await ie(s,a),s.id}catch(s){throw o.error("[DataServiceV2] Error saving employee:",s),s}}static async employeeNumberExists(t,r){try{const s=F(y,"organizations",t,"employees"),a=M(s,I("profile.employeeNumber","==",r));return!(await B(a)).empty}catch(s){return o.error("[DataServiceV2] Error checking employee number:",s),!1}}static async getWarningsByOrganization(t,r){try{const s=F(y,"organizations",t,"warnings");let a=M(s,H("issueDate","desc"));return r&&(a=M(s,H("issueDate","desc"),fe(r))),(await B(a)).docs.map(l=>({id:l.id,...l.data(),issueDate:this.convertDate(l.data().issueDate),expiryDate:this.convertDate(l.data().expiryDate),incidentDate:this.convertDate(l.data().incidentDate),createdAt:this.convertDate(l.data().createdAt),updatedAt:this.convertDate(l.data().updatedAt)}))}catch(s){return o.error("[DataServiceV2] Error getting warnings:",s),[]}}static async getWarningsForEmployee(t,r){try{const s=F(y,"organizations",t,"warnings"),a=M(s,I("employeeId","==",r),H("issueDate","desc"));return(await B(a)).docs.map(l=>({id:l.id,...l.data(),issueDate:this.convertDate(l.data().issueDate),expiryDate:this.convertDate(l.data().expiryDate),incidentDate:this.convertDate(l.data().incidentDate),createdAt:this.convertDate(l.data().createdAt),updatedAt:this.convertDate(l.data().updatedAt)}))}catch(s){return o.error("[DataServiceV2] Error getting employee warnings:",s),[]}}static async saveWarning(t,r){try{const s=r.id?O(y,"organizations",t,"warnings",r.id):O(F(y,"organizations",t,"warnings")),a={...r,organizationId:t,updatedAt:z(),...r.id?{}:{createdAt:z()}};return await ie(s,a),s.id}catch(s){throw o.error("[DataServiceV2] Error saving warning:",s),s}}static async getUsersByOrganization(t){try{const r=F(y,"organizations",t,"users"),s=M(r,I("isActive","==",!0),H("lastName"),H("firstName"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertDate(n.data().createdAt),lastLogin:this.convertOptionalDate(n.data().lastLogin)}))}catch(r){return o.error("[DataServiceV2] Error getting users:",r),[]}}static async getUser(t,r){try{const s=O(y,"organizations",t,"users",r),a=await le(s);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),lastLogin:this.convertOptionalDate(a.data().lastLogin)}:null}catch(s){return o.error("[DataServiceV2] Error getting user:",s),null}}static async getDocumentTemplates(t){try{const r=F(y,"organizations",t,"templates"),s=M(r,I("isActive","==",!0),H("name"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertDate(n.data().createdAt),updatedAt:this.convertDate(n.data().updatedAt)}))}catch(r){return o.error("[DataServiceV2] Error getting templates:",r),[]}}static async getEscalationRules(t){try{const r=F(y,"organizations",t,"escalationRules"),s=M(r,I("isActive","==",!0),H("category"));return(await B(s)).docs.map(n=>({id:n.id,...n.data()}))}catch(r){return o.error("[DataServiceV2] Error getting escalation rules:",r),[]}}static async getOrganization(t){try{const r=O(y,"organizations",t),s=await le(r);return s.exists()?{id:s.id,...s.data(),createdAt:this.convertDate(s.data().createdAt),updatedAt:this.convertDate(s.data().updatedAt)}:null}catch(r){return o.error("[DataServiceV2] Error getting organization:",r),null}}static convertDate(t){return t?t instanceof De||t.toDate?t.toDate():new Date(t):new Date}static convertOptionalDate(t){return t?this.convertDate(t):null}}class ee{static{this.CACHE_DURATION=300*1e3}static{this.cache=new Map}static clearCache(){this.cache.clear(),o.debug("🗑️ [SHARD] Cache cleared")}static async loadEmployees(t,r){try{const s=`employees:${t}:${JSON.stringify(r||{})}`;if(!r&&this.isCacheValid(s)){const l=this.cache.get(s);return o.debug("💰 [SHARD] Returning cached employees"),{documents:l.data,hasMore:!1,shardInfo:{organizationId:t,path:Y.getShardedPath(t,"employees"),queryTime:0}}}const a=await Y.queryDocuments(t,"employees",[],r||{pageSize:1e3,orderField:"createdAt",orderDirection:"desc"}),n=a.documents.filter(l=>l.id==="metadata"||!l.profile&&!l.firstName&&!l.lastName?!1:l.isActive!==!1);return a.documents=n,r||this.cache.set(s,{data:a.documents,timestamp:Date.now(),organizationId:t}),o.success(`👥 [SHARD] Loaded ${a.documents.length} employees for ${t}`),a}catch(s){throw o.error(`❌ [SHARD] Failed to load employees for ${t}:`,s),s}}static async getAllEmployees(t){try{return(await this.loadEmployees(t)).documents}catch(r){throw o.error(`❌ [SHARD] Failed to get all employees for ${t}:`,r),r}}static async getEmployeeById(t,r){try{const s=await Y.getDocument(r,"employees",t);return s?o.debug(`👤 [SHARD] Retrieved employee: ${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`):o.warn(`⚠️ [SHARD] Employee not found: ${t} in ${r}`),s}catch(s){throw o.error(`❌ [SHARD] Failed to get employee ${t}:`,s),s}}static async createEmployee(t,r){try{const s=await Y.createDocument(r,"employees",{...t,organizationId:r,isActive:!0,createdAt:new Date,updatedAt:new Date});return this.invalidateCache(`employees:${r}`),o.success(`✅ [SHARD] Created employee: ${t.firstName} ${t.lastName}`),s}catch(s){throw o.error("❌ [SHARD] Failed to create employee:",s),s}}static async updateEmployee(t,r,s){try{await Y.updateDocument(r,"employees",t,s),this.invalidateCache(`employees:${r}`),o.success(`✅ [SHARD] Updated employee: ${t}`)}catch(a){throw o.error(`❌ [SHARD] Failed to update employee ${t}:`,a),a}}static async saveEmployee(t,r){try{if(t.id){await this.updateEmployee(t.id,r,t);const s=await this.getEmployeeById(t.id,r);if(!s)throw new Error("Failed to retrieve updated employee");return s}else{const s=await this.createEmployee(t,r),a=await this.getEmployeeById(s,r);if(!a)throw new Error("Failed to retrieve created employee");return a}}catch(s){throw o.error("❌ [SHARD] Failed to save employee:",s),s}}static async loadArchivedEmployees(t,r){try{const s=`archived-employees:${t}:${JSON.stringify(r||{})}`;if(!r&&this.isCacheValid(s)){const l=this.cache.get(s);return o.debug("💰 [SHARD] Returning cached archived employees"),{documents:l.data,hasMore:!1,shardInfo:{organizationId:t,path:Y.getShardedPath(t,"employees"),queryTime:0}}}const a=await Y.queryDocuments(t,"employees",[],r||{pageSize:1e3,orderField:"archivedAt",orderDirection:"desc"}),n=a.documents.filter(l=>!l.profile||l.id==="metadata"?!1:l.isActive===!1);return a.documents=n,r||this.cache.set(s,{data:a.documents,timestamp:Date.now(),organizationId:t}),o.success(`🗄️ [SHARD] Loaded ${a.documents.length} archived employees for ${t}`),a}catch(s){throw o.error(`❌ [SHARD] Failed to load archived employees for ${t}:`,s),s}}static async archiveEmployee(t,r){try{await this.updateEmployee(t,r,{isActive:!1,archivedAt:new Date}),this.invalidateCache(`employees:${r}`),this.invalidateCache(`archived-employees:${r}`),o.success(`🗄️ [SHARD] Archived employee: ${t}`)}catch(s){throw o.error(`❌ [SHARD] Failed to archive employee ${t}:`,s),s}}static async deleteDocument(t,r,s){try{await Y.deleteDocument(t,r,s),this.invalidateCache(`${r}:${t}`),o.warn(`🗑️ [SHARD] PERMANENTLY DELETED document: ${s} from ${r}`)}catch(a){throw o.error(`❌ [SHARD] Failed to delete document ${s}:`,a),a}}static async loadWarnings(t,r,s){try{const a=[];r?.employeeId&&a.push(I("employeeId","==",r.employeeId)),r?.categoryId&&a.push(I("categoryId","==",r.categoryId)),r?.level&&a.push(I("level","==",r.level)),r?.isActive!==void 0&&a.push(I("isActive","==",r.isActive));const n=await Y.queryDocuments(t,"warnings",a,s||{pageSize:500,orderField:"issueDate",orderDirection:"desc"});return o.success(`⚠️ [SHARD] Loaded ${n.documents.length} warnings for ${t}`),n}catch(a){throw o.error(`❌ [SHARD] Failed to load warnings for ${t}:`,a),a}}static async getActiveWarningsForEmployee(t,r){try{const s=await this.loadWarnings(r,{employeeId:t,isActive:!0},{pageSize:100,orderField:"issueDate",orderDirection:"desc"});return o.debug(`📋 [SHARD] Found ${s.documents.length} active warnings for employee ${t}`),s.documents}catch(s){throw o.error(`❌ [SHARD] Failed to get active warnings for employee ${t}:`,s),s}}static async getAllWarningsForEmployee(t,r,s=!0){try{const a={employeeId:t};s||(a.isActive=!0);const n=await this.loadWarnings(r,a,{pageSize:500,orderField:"issueDate",orderDirection:"desc"});return o.debug(`📋 [SHARD] Found ${n.documents.length} total warnings for employee ${t}`),n.documents}catch(a){throw o.error(`❌ [SHARD] Failed to get all warnings for employee ${t}:`,a),a}}static async createWarning(t,r){try{const s=await Y.createDocument(r,"warnings",{...t,organizationId:r,isActive:!0,status:"issued",createdAt:new Date,updatedAt:new Date});return o.success(`✅ [SHARD] Created warning: ${s} for ${t.employeeId}`),s}catch(s){throw o.error("❌ [SHARD] Failed to create warning:",s),s}}static async getWarning(t,r){try{const s=await Y.getDocument(t,"warnings",r);return o.debug(`🔍 [SHARD] Retrieved warning: ${r}`),s}catch(s){return o.error(`❌ [SHARD] Failed to get warning ${r}:`,s),null}}static async getWarningCategories(t){try{const r=`categories:${t}`;if(this.isCacheValid(r)){const a=this.cache.get(r);return o.debug("💰 [SHARD] Returning cached categories"),a.data}const s=await Y.queryDocuments(t,"categories",[I("isActive","==",!0)],{pageSize:100,orderField:"name",orderDirection:"asc"});return this.cache.set(r,{data:s.documents,timestamp:Date.now(),organizationId:t}),o.success(`📂 [SHARD] Loaded ${s.documents.length} categories for ${t}`),s.documents}catch(r){throw o.error(`❌ [SHARD] Failed to load categories for ${t}:`,r),r}}static async createWarningCategory(t,r){try{const s=await Y.createDocument(r,"categories",{...t,organizationId:r,isActive:!0,createdAt:new Date,updatedAt:new Date});return this.invalidateCache(`categories:${r}`),o.success(`✅ [SHARD] Created category: ${t.name}`),s}catch(s){throw o.error("❌ [SHARD] Failed to create category:",s),s}}static async createDocument(t,r,s,a){try{const n=await Y.createDocument(t,r,s,a);return this.invalidateCache(`${r}:${t}`),o.success(`✅ [SHARD] Created document in ${r}: ${n}`),n}catch(n){throw o.error(`❌ [SHARD] Failed to create document in ${r}:`,n),n}}static async queryDocuments(t,r,s=[],a){try{const n=await Y.queryDocuments(t,r,s,a||{pageSize:1e3,orderField:"createdAt",orderDirection:"desc"});return o.debug(`🔍 [SHARD] Queried ${n.documents.length} documents from ${r}`),n}catch(n){throw o.error(`❌ [SHARD] Failed to query documents from ${r}:`,n),n}}static async getOrganizationStats(t){try{const[r,s]=await Promise.all([this.loadEmployees(t),this.loadWarnings(t,{isActive:!0})]),a={},n={};for(const m of s.documents)a[m.level]=(a[m.level]||0)+1,n[m.categoryId]=(n[m.categoryId]||0)+1;const l=Array.from({length:12},(m,d)=>({month:new Date(0,d).toLocaleString("default",{month:"short"}),count:Math.floor(Math.random()*50)})),c={totalEmployees:r.documents.length,activeWarnings:s.documents.length,warningsByLevel:a,warningsByCategory:n,monthlyTrends:l};return o.success(`📊 [SHARD] Generated stats for ${t}`),c}catch(r){throw o.error(`❌ [SHARD] Failed to generate stats for ${t}:`,r),r}}static async getSystemAnalytics(){return{totalOrganizations:2700,totalEmployees:13500,totalWarnings:8100,topOrganizations:[{name:"Global Enterprise Corp",organizationId:"global-1",employeeCount:250},{name:"Large Manufacturing Ltd",organizationId:"mfg-2",employeeCount:180},{name:"Tech Solutions Inc",organizationId:"tech-3",employeeCount:150}],performanceMetrics:{averageQueryTime:245,cacheHitRate:.85,shardDistribution:{small:2100,medium:500,large:95,enterprise:5}}}}static async bulkCreateEmployees(t,r){try{const s={success:0,failed:0,errors:[]},a=100;for(let n=0;n<t.length;n+=a){const l=t.slice(n,n+a),c=l.map(m=>({organizationId:r,collectionName:"employees",operation:"create",data:{...m,organizationId:r,isActive:!0,createdAt:new Date,updatedAt:new Date}}));try{await Y.batchWrite(c),s.success+=l.length}catch(m){s.failed+=l.length,s.errors.push(`Batch ${n/a+1}: ${m}`)}}return this.invalidateCache(`employees:${r}`),o.success(`📦 [SHARD] Bulk created ${s.success} employees, ${s.failed} failed`),s}catch(s){throw o.error("❌ [SHARD] Bulk create employees failed:",s),s}}static isCacheValid(t){const r=this.cache.get(t);return r!==void 0&&Date.now()-r.timestamp<this.CACHE_DURATION}static invalidateCache(t){for(const[r]of this.cache)r.includes(t)&&this.cache.delete(r);o.debug(`🧹 [SHARD] Invalidated cache: ${t}`)}static getCacheStats(){let t=0,r=Date.now();for(const[s,a]of this.cache)t+=JSON.stringify(a).length,a.timestamp<r&&(r=a.timestamp);return{totalEntries:this.cache.size,cacheSize:t,hitRate:.85,oldestEntry:r}}static async migrateOrganizationToShards(t){o.warn(`🔄 [MIGRATION] Starting organization migration: ${t}`);try{const[r,s,a]=await Promise.all([Y.migrateFlatToSharded("employees","employees"),Y.migrateFlatToSharded("warnings","warnings"),Y.migrateFlatToSharded("warningCategories","categories")]),n={employees:{migrated:r.migrated,failed:r.failed},warnings:{migrated:s.migrated,failed:s.failed},categories:{migrated:a.migrated,failed:a.failed}};return o.success(`🎉 [MIGRATION] Organization ${t} migration complete`,n),n}catch(r){throw o.error(`❌ [MIGRATION] Organization migration failed for ${t}:`,r),r}}}const Ks=Object.freeze(Object.defineProperty({__proto__:null,ShardedDataService:ee},Symbol.toStringTag,{value:"Module"}));class X{static{this.cache=new Map}static{this.accessOrder=new Map}static{this.accessCounter=0}static{this.config={defaultTTL:300*1e3,maxSize:1e3}}static{this.TTL_CONFIG={employees:120*1e3,warnings:60*1e3,followUps:30*1e3,categories:600*1e3,organization:900*1e3,settings:900*1e3,userOrgIndex:1800*1e3,sectors:3600*1e3,roles:3600*1e3}}static get(t){const r=this.cache.get(t);return r?Date.now()>r.expiryTime?(this.delete(t),o.debug(`🗑️ [CACHE] Expired entry removed: ${t}`),null):(this.accessOrder.set(t,++this.accessCounter),o.debug(`💰 [CACHE] Hit: ${t}`),r.data):null}static set(t,r,s){const a=s||this.getTTLForKey(t),n=Date.now()+a;this.cache.size>=this.config.maxSize&&this.evictLRU(),this.cache.set(t,{data:r,timestamp:Date.now(),expiryTime:n}),this.accessOrder.set(t,++this.accessCounter),o.debug(`💾 [CACHE] Set: ${t} (TTL: ${a/1e3}s)`)}static delete(t){this.cache.delete(t),this.accessOrder.delete(t),o.debug(`🗑️ [CACHE] Deleted: ${t}`)}static clearByPrefix(t){let r=0;for(const s of this.cache.keys())s.startsWith(t)&&(this.cache.delete(s),this.accessOrder.delete(s),r++);o.success(`🧹 [CACHE] Cleared ${r} entries with prefix: ${t}`)}static clear(){const t=this.cache.size;this.cache.clear(),this.accessOrder.clear(),this.accessCounter=0,o.success(`🧹 [CACHE] Cleared all ${t} entries`)}static getStats(){Array.from(this.cache.entries());const t=Array.from(this.accessOrder.entries()),r=t.reduce((a,[n,l])=>l<a.access?{key:n,access:l}:a,{key:"",access:1/0}),s=t.reduce((a,[n,l])=>l>a.access?{key:n,access:l}:a,{key:"",access:-1});return{size:this.cache.size,maxSize:this.config.maxSize,hitRate:0,oldestEntry:r.key||null,newestEntry:s.key||null}}static async getOrFetch(t,r,s){const a=this.get(t);if(a!==null)return a;o.debug(`🔄 [CACHE] Miss: ${t} - fetching...`);const n=await r();return this.set(t,n,s),n}static getTTLForKey(t){for(const[r,s]of Object.entries(this.TTL_CONFIG))if(t.includes(r))return s;return this.config.defaultTTL}static evictLRU(){if(this.accessOrder.size===0)return;let t="",r=1/0;for(const[s,a]of this.accessOrder.entries())a<r&&(r=a,t=s);t&&(this.delete(t),o.debug(`♻️ [CACHE] LRU evicted: ${t}`))}static startCleanupTimer(){setInterval(()=>{this.cleanupExpired()},60*1e3),o.debug("🕐 [CACHE] Cleanup timer started")}static cleanupExpired(){const t=Date.now();let r=0;for(const[s,a]of this.cache.entries())t>a.expiryTime&&(this.delete(s),r++);r>0&&o.debug(`🧹 [CACHE] Cleaned ${r} expired entries`)}static generateOrgKey(t,r,...s){const a=s.length>0?`:${s.join(":")}`:"";return`org:${t}:${r}${a}`}static generateUserKey(t,r,...s){const a=s.length>0?`:${s.join(":")}`:"";return`user:${t}:${r}${a}`}}X.startCleanupTimer();const dt=p.createContext(null),Fe=()=>{const i=p.useContext(dt);if(!i)throw new Error("useOrganization must be used within an OrganizationProvider");return i},Ys=({children:i,organizationId:t})=>{const[r,s]=p.useState(null),[a,n]=p.useState(null),[l,c]=p.useState(null),[m,d]=p.useState(!0),[u,x]=p.useState(null),b=p.useRef(!1),f=p.useRef(null),S=p.useRef(!1),C=`org-loading-${t}`,w=()=>typeof window<"u"&&window[C],g=A=>{typeof window<"u"&&(A?window[C]=!0:delete window[C])},h=async()=>{if(b.current||w()){o.debug(`[OrganizationProvider] Already loading, skipping duplicate for: ${t}`);return}if(f.current===t&&r&&a!==null){o.debug(`[OrganizationProvider] Already loaded, skipping reload for: ${t}`),d(!1);return}if(f.current===t&&a&&a.length>0){o.debug(`[OrganizationProvider] Organization ${t} already loaded with ${a.length} categories, skipping`),d(!1);return}b.current=!0,g(!0);try{d(!0),x(null),o.debug(`[OrganizationProvider] 🚀 Loading data in parallel for organization ID: ${t}`);const[A,T]=await Promise.all([X.getOrFetch(X.generateOrgKey(t,"organization"),()=>tt.getOrganization(t)),X.getOrFetch(X.generateOrgKey(t,"categories"),()=>ee.getWarningCategories(t))]);A?(s(A),o.debug(`[OrganizationProvider] ✅ Organization loaded: ${A.name}`)):(o.error(`[OrganizationProvider] 🚨 Failed to load organization: ${t}`),x("Failed to load organization")),T&&Array.isArray(T)?(o.debug(`[OrganizationProvider] ✅ Setting ${T.length} categories in state`,T.map(N=>N.name)),n(T),o.debug("[OrganizationProvider] ✅ Categories state updated")):(o.warn(`[OrganizationProvider] ⚠️ No categories found, setting empty array for organization: ${t}`),n([])),c(null),o.debug("[OrganizationProvider] ✅ Using UniversalCategories system"),f.current=t,d(!1)}catch(A){o.error("[OrganizationProvider] 🚨 Failed to load organization data:",A),x(A instanceof Error?A.message:"Failed to load organization data"),d(!1)}finally{b.current=!1,g(!1)}},D=async()=>{b.current=!1,f.current=null,await h()},v=async(A,T)=>{try{d(!0),o.warn("SectorService not imported - sector initialization disabled"),await h()}catch(N){throw o.error("Failed to initialize sector:",N),N}};p.useEffect(()=>(S.current||(S.current=!0,t?(f.current!==t&&(b.current=!1,f.current=null,f.current&&X.clearByPrefix(`org:${f.current}:`)),h()):o.warn("[OrganizationProvider] No organizationId provided, skipping data load")),()=>{S.current=!1}),[t]);const k={organization:r,organizationId:t,categories:a,sectorInfo:l,loading:m,error:u,refreshOrganization:D,initializeSector:v};return p.useEffect(()=>{!m&&a&&a.length>0&&o.debug(`[OrganizationProvider] ✅ Context ready: ${r?.name} with ${a.length} categories`)},[m,a,r]),e.jsx(dt.Provider,{value:k,children:i})},Dt=({isOpen:i,onClose:t,title:r,subtitle:s,showBackButton:a=!1,onBack:n,currentStep:l,totalSteps:c,stepTitles:m,showStepProgress:d=!1,size:u="lg",className:x="",primaryAction:b,secondaryAction:f,customFooter:S,children:C})=>{if(p.useContext(dt)?.organization,p.useEffect(()=>(i?(document.body.style.overflow="hidden",document.body.classList.add("modal-open")):(document.body.style.overflow="",document.body.classList.remove("modal-open")),()=>{document.body.style.overflow="",document.body.classList.remove("modal-open")}),[i]),!i)return null;const g=()=>!d||!c||!l?null:e.jsxs("div",{className:"modal-header__center",children:[e.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:e.jsx("div",{className:"mobile-step-indicator",children:e.jsx("div",{className:"mobile-step-dots",children:Array.from({length:c},(h,D)=>{const v=D+1,k=v===l,A=v<l;return e.jsx("div",{className:`mobile-step-dot ${k?"mobile-step-dot--active":A?"mobile-step-dot--completed":"mobile-step-dot--inactive"}`,children:A?"✓":v},D)})})})}),e.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Array.from({length:c},(h,D)=>{const v=D+1,k=v===l,A=v<l;return e.jsx("div",{className:"step-container",children:e.jsx("div",{className:`modal-header__step ${k?"modal-header__step--active":A?"modal-header__step--completed":"modal-header__step--inactive"}`,children:A?"✓":v})},D)})})]});return e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-header__left",children:[a&&n&&e.jsx("button",{onClick:n,className:"modal-header__close-button",children:e.jsx($r,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:r}),s&&e.jsx("p",{className:"modal-header__subtitle",children:s})]})]}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsx(g,{}),d&&m&&l&&m[l-1]&&e.jsx("div",{className:"sm:hidden text-center",children:e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:m[l-1]})}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:C})}),(b||f||S)&&e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"modal-footer__nav",children:S||e.jsxs(e.Fragment,{children:[f&&e.jsx("button",{onClick:f.onClick,className:"modal-footer__button modal-footer__button--secondary",children:f.label}),b&&e.jsx("button",{onClick:b.onClick,disabled:b.disabled,className:`modal-footer__button modal-footer__button--primary ${b.loading?"modal-footer__button--loading":""}`,children:b.label})]})})})]})})},ss=()=>{const{user:i}=ye(),r=(()=>{if(!i)return[];const N=i.role?.id||i.role;return N?[N]:[]})(),s=N=>r.includes(N),a=N=>N.some(_=>r.includes(_));return{canViewBusinessMetrics:()=>s("business-owner")||s("super-user"),canManageOrganization:()=>s("business-owner")||s("super-user"),canViewComplianceReports:()=>a(["business-owner","hr-manager","super-user"]),canManageOrganizationSettings:()=>s("business-owner")||s("super-user"),canManageEmployees:()=>a(["hr-manager","business-owner","super-user"]),canManageHR:()=>a(["hr-manager","business-owner","super-user"]),canReviewWarnings:()=>a(["hr-manager","business-owner","super-user"]),canReviewDocuments:()=>a(["hr-manager","business-owner","super-user"]),canManageUsers:()=>a(["hr-manager","business-owner","super-user"]),canManageDepartments:()=>a(["hr-manager","business-owner","super-user"]),canCreateHRManagers:()=>s("business-owner")||s("super-user"),canCreateHODManagers:()=>a(["hr-manager","business-owner","super-user"]),canCreateWarnings:()=>a(["hod-manager","hr-manager","business-owner","super-user"]),canCaptureDocuments:()=>a(["hod-manager","hr-manager","super-user"]),canViewTeamMembers:()=>a(["hod-manager","hr-manager","business-owner","super-user"]),canManageTeam:()=>a(["hod-manager","hr-manager","business-owner","super-user"]),hasRole:s,hasAnyRole:a,hasAllRoles:N=>N.every(_=>r.includes(_)),getPrimaryRole:()=>r[0]||"unknown",getAllRoles:()=>[...r]}},Je=[{id:"attendance_punctuality",name:"Attendance & Punctuality",description:"Late coming, unauthorized absence, early departure without permission",severity:"minor",icon:"⏰",lraSection:"Section 188(1)(a) - Incapacity or poor work performance",schedule8Reference:"Schedule 8, Item 10 - Incapacity/poor performance procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Attendance issues are typically correctable behavior problems that benefit from full progressive discipline, giving employees maximum opportunity to improve while building strong legal documentation.",commonExamples:["Arriving late for work without valid reason (3+ times per month)","Leaving work early without supervisor permission","Unauthorized absence during working hours","Excessive sick leave without proper medical certificates","Not notifying supervisor of absence per company policy","Consistently returning late from breaks","Pattern of Monday/Friday absences without valid reasons"],proceduralRequirements:["Maintain accurate attendance records for minimum 6 months","Investigate reasons for poor attendance before disciplinary action","Consider personal circumstances (Schedule 8 factors)","Provide counselling and support where appropriate","Follow progressive discipline unless pattern shows willful misconduct","Document all interventions and employee responses","Allow employee opportunity to provide medical evidence"],evidenceRequired:["Daily attendance register or electronic time records","Previous warnings and counselling records","Medical certificates (if absence-related)","Communication records about absences","Witness statements from supervisors","Company attendance policy documentation","Impact assessment on operations"],ccmaFactors:["Length of service and previous disciplinary record","Personal circumstances affecting attendance","Whether adequate counselling and support was provided","Consistency of employer response to similar cases","Impact on operations and other employees","Economic circumstances and job market conditions","Whether alternative arrangements were considered"],defaultValidityPeriod:6},{id:"performance_issues",name:"Performance Issues",description:"Poor work quality, failure to meet targets, lack of required skills",severity:"minor",icon:"📈",lraSection:"Section 188(1)(a) - Incapacity or poor work performance",schedule8Reference:"Schedule 8, Item 10 - Poor performance procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Performance issues often stem from lack of training, unclear expectations, or personal challenges. Full progressive discipline allows time for coaching, training, and performance improvement plans.",commonExamples:["Consistently missing production targets despite training","Work quality below acceptable company standards","Failure to follow established procedures","Inability to learn new skills required for position","Poor customer service resulting in complaints","Errors in work output affecting quality or safety","Lack of productivity compared to similar employees"],proceduralRequirements:["Provide clear performance standards and expectations","Offer training and development opportunities","Implement performance improvement plans with measurable goals","Regular monitoring and feedback sessions","Consider whether incapacity is due to ill-health or lack of skill","Explore alternative positions if performance cannot improve","Document all training provided and performance measurements"],evidenceRequired:["Performance metrics and measurement records","Training records and certificates","Performance improvement plan documentation","Regular performance review records","Customer complaints or feedback (if applicable)","Comparison with similar employees' performance","Evidence of support and resources provided"],ccmaFactors:["Whether clear performance standards were communicated","Adequacy of training and support provided","Personal circumstances affecting performance","Length of service and previous performance record","Whether alternative positions were considered","Consistency with treatment of other employees","Economic impact of dismissal on employee"],defaultValidityPeriod:6},{id:"safety_violations",name:"Safety Violations",description:"Failure to follow safety procedures, endangering self or others",severity:"serious",icon:"🚨",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["verbal","first_written","final_written"],escalationRationale:"Safety violations can result in injury, death, or legal liability. While counselling might be appropriate for first-time minor oversights, repeated or serious safety violations require formal progressive discipline.",commonExamples:["Failure to wear required Personal Protective Equipment (PPE)","Operating machinery without proper authorization","Ignoring safety procedures and protocols","Creating unsafe working conditions for others","Failure to report safety hazards or incidents","Horseplay or reckless behavior in workplace","Smoking in prohibited areas or fire hazard zones"],proceduralRequirements:["Immediate investigation of safety incidents","Ensure employee understands safety requirements","Provide additional safety training if needed","Consider whether violation was willful or due to lack of knowledge","Implement corrective measures to prevent recurrence","May require temporary removal from dangerous areas","Report serious incidents to relevant authorities"],evidenceRequired:["Incident reports and investigation findings","Safety training records and certificates","Photographs of safety violations or hazards","Witness statements from supervisors or colleagues","Safety inspection reports","Company safety policies and procedures","Medical reports if injury occurred"],ccmaFactors:["Seriousness of safety risk created","Whether violation was willful or negligent","Previous safety training provided","Employee's safety record and length of service","Potential consequences of the safety violation","Consistency of safety enforcement","Industry standards and legal requirements"],defaultValidityPeriod:12,requiresImmediateAction:!0},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",description:"Refusal to follow instructions, disrespectful behavior, undermining authority",severity:"serious",icon:"🚫",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","final_written"],escalationRationale:"Insubordination varies from minor attitude issues (requiring counselling) to serious defiance. Progressive discipline allows distinction between momentary lapses and persistent defiant behavior.",commonExamples:["Refusing to follow reasonable and lawful instructions","Disrespectful language or behavior toward supervisors","Undermining management authority in front of colleagues","Aggressive or threatening behavior toward management","Consistently challenging management decisions inappropriately","Showing contempt for company policies or procedures","Public criticism of management or company"],proceduralRequirements:["Distinguish between reasonable management instruction and unreasonable demands","Consider employee's right to raise legitimate grievances","Assess whether behavior was influenced by workplace stress","Provide opportunity for employee to explain their perspective","Consider mediation or conflict resolution where appropriate","Document specific instances with dates and witnesses","Ensure consistency with treatment of similar cases"],evidenceRequired:["Written statements from witnesses present","Documentation of specific incidents with dates and times","Records of instructions given and employee response","Previous disciplinary records for pattern evidence","Email or written communication showing insubordination","Performance reviews or feedback sessions","Evidence of impact on team morale or productivity"],ccmaFactors:["Severity of the insubordinate behavior","Whether employee had legitimate grievances","Length of service and previous disciplinary record","Impact on workplace authority and discipline","Whether behavior was out of character","Workplace stress factors or personal circumstances","Potential for rehabilitation and improved behavior"],defaultValidityPeriod:6},{id:"policy_violations",name:"Policy Violations",description:"Breach of company policies, procedures, or workplace rules",severity:"minor",icon:"📋",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Policy violations vary greatly in seriousness. Progressive discipline allows proportionate responses based on policy importance and violation severity.",commonExamples:["Violation of dress code or appearance standards","Inappropriate use of company property or equipment","Breach of confidentiality or privacy policies","Unauthorized use of company internet or email","Violation of social media and communication policies","Failure to follow administrative procedures","Breach of conflict of interest policies"],proceduralRequirements:["Ensure policy was clearly communicated to employee","Verify employee had access to and understood policy","Consider seriousness of policy violated","Investigate whether violation was intentional","Provide policy training if knowledge gaps identified","Consider impact of violation on business operations","Ensure consistent application across all employees"],evidenceRequired:["Copy of relevant company policy document","Evidence of policy communication (training records, handbook)","Documentation of the specific violation","Computer logs, emails, or digital evidence if applicable","Witness statements or supervisor observations","Previous policy violations or training records","Impact assessment on business or colleagues"],ccmaFactors:["Clarity and accessibility of the policy violated","Seriousness of the policy and business impact","Employee's knowledge and understanding of policy","Intent behind the violation","Consistency of policy enforcement","Length of service and previous violations","Whether remedial action is possible"],defaultValidityPeriod:6},{id:"dishonesty_theft",name:"Dishonesty & Theft",description:"Stealing, fraud, falsifying records, dishonest behavior",severity:"gross_misconduct",icon:"💰",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["first_written","final_written"],escalationRationale:"Dishonesty and theft break fundamental trust required for employment. Minor dishonesty may warrant progressive discipline, but serious theft or fraud often justifies immediate dismissal after investigation.",commonExamples:["Stealing company property, money, or resources","Fraudulent claiming of overtime or expenses","Falsifying time records, reports, or documentation","Misappropriation of company funds or assets","Lying about qualifications, experience, or credentials","Concealing conflicts of interest or kickbacks","Falsifying safety records or inspection reports"],proceduralRequirements:["Conduct thorough investigation before taking action","Preserve evidence and maintain chain of custody","Consider suspension pending investigation if necessary","Distinguish between minor dishonesty and serious fraud","Involve security or law enforcement if appropriate","Ensure fair hearing and right to respond","Consider whether criminal charges should be laid"],evidenceRequired:["Financial records, receipts, or transaction evidence","Security camera footage or access logs","Witness statements from colleagues or customers","Forensic accounting or audit reports","Documentation of missing inventory or assets","Computer records or digital evidence","Statements from employee during investigation"],ccmaFactors:["Value and nature of property stolen or involved","Level of trust and responsibility in employee's position","Impact on employer's business or reputation","Length of service and previous disciplinary record","Whether employee admitted wrongdoing and showed remorse","Consistency with treatment of similar cases","Potential for rehabilitation vs. need to deter others"],defaultValidityPeriod:12,requiresImmediateAction:!0,allowsWarningSkipping:!0},{id:"substance_abuse",name:"Substance Abuse",description:"Use of alcohol or drugs affecting work performance or safety",severity:"serious",icon:"🍺",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","final_written"],escalationRationale:"Substance abuse is both a health issue and workplace safety concern. Counselling and support are prioritized initially, but safety concerns require firm boundaries.",commonExamples:["Reporting to work under influence of alcohol or drugs","Possession or use of illegal substances at work","Performance deterioration due to substance abuse","Erratic behavior suggesting intoxication","Positive results on random drug/alcohol testing","Alcohol odor or visible signs of intoxication","Refusing to submit to required substance testing"],proceduralRequirements:["Follow company substance abuse policy procedures","Conduct testing according to established protocols","Distinguish between addiction (health issue) and misconduct","Offer employee assistance programs where available","Consider rehabilitation and treatment options","Ensure safety of employee and colleagues","Document all incidents and interventions"],evidenceRequired:["Drug/alcohol test results and chain of custody","Witness observations of behavior and condition","Supervisor reports of performance decline","Medical evidence or treatment records (if disclosed)","Company substance abuse policies","Previous incidents or test results","Evidence of impact on work performance or safety"],ccmaFactors:["Whether substance abuse affects work performance","Safety implications for employee and colleagues","Employee's willingness to seek treatment","Length of service and previous record","Availability of rehabilitation programs","Consistency of policy application","Balance between health support and workplace safety"],defaultValidityPeriod:6,requiresImmediateAction:!0},{id:"harassment_discrimination",name:"Harassment & Discrimination",description:"Sexual harassment, racial discrimination, bullying, or creating hostile work environment",severity:"gross_misconduct",icon:"⚖️",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["final_written"],escalationRationale:"Harassment and discrimination create legal liability and hostile work environments. While investigation is required, proven cases often warrant immediate serious action.",commonExamples:["Sexual harassment or unwanted sexual advances","Racial, gender, or religious discrimination","Bullying, intimidation, or creating hostile environment","Inappropriate comments about appearance or personal life","Displaying offensive material or making discriminatory jokes","Retaliation against employees who report discrimination","Creating work environment that excludes certain groups"],proceduralRequirements:["Immediate investigation by trained investigators","Ensure complainant safety and prevent retaliation","Maintain confidentiality while conducting investigation","Follow company harassment and discrimination policies","Consider interim measures to separate parties","Provide support to affected employees","Report to relevant authorities if required by law"],evidenceRequired:["Written complaint or incident report","Witness statements from colleagues","Documentation of previous similar incidents","Email, text messages, or other communications","Records of previous complaints or warnings","Medical or psychological reports (if applicable)","Evidence of impact on work environment"],ccmaFactors:["Seriousness and persistence of the harassment","Impact on victim and workplace environment","Position of power or authority of perpetrator","Previous incidents or complaints","Whether behavior was part of pattern","Legal and reputational risk to organization","Need to protect other employees and deter similar conduct"],defaultValidityPeriod:12,requiresImmediateAction:!0,allowsWarningSkipping:!0}];function mt(i){return Je.find(t=>t.id===i)}function as(i){return mt(i)?.escalationPath||["counselling","verbal","first_written","final_written"]}function ns(i,t){const r=mt(i);if(!r)return null;const s=r.escalationPath.indexOf(t);return s===-1||s===r.escalationPath.length-1?null:r.escalationPath[s+1]}function st(i){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"}[i]||i}const te={ORGANIZATIONS:"organizations",USERS:"users",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warningCategories",ESCALATION_RULES:"escalationRules",AUDIT_LOGS:"auditLogs",DOCUMENTS:"documents",TEMPLATES:"templates"};class Ft{static{this.categoryCache=new Map}static{this.CACHE_DURATION=300*1e3}static convertDate(t){if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t=="object"&&typeof t.toDate=="function")return t.toDate();const r=new Date(t);return isNaN(r.getTime())?new Date:r}static convertOptionalDate(t){if(t)return this.convertDate(t)}static async getWarningCategories(t){const r=this.categoryCache.get(t);if(r&&Date.now()-r.timestamp<this.CACHE_DURATION)return o.debug("[DataService] 💰 Returning cached categories"),r.data;try{o.debug("[DataService] 🔄 Loading categories with smart merging for org:",t);const s=Je;o.debug("[DataService] 📋 Base universal categories:",s.length);const a=F(y,"organizations",t,"categories"),n=M(a,I("isActive","==",!0),H("name")),c=(await B(n)).docs.map(u=>({id:u.id,...u.data(),createdAt:u.data().createdAt?.toDate()||new Date,updatedAt:u.data().updatedAt?.toDate()||new Date}));o.debug("[DataService] 🏢 Organization customizations:",c.length);const m=[];for(const u of s){const x=c.find(f=>f.universalCategoryId===u.id&&!f.isCustomCategory);if(x&&x.isDisabled){o.debug("[DataService] ❌ Category disabled by organization:",u.name);continue}const b={id:x?.id||u.id,organizationId:t,name:x?.customName||u.name,description:x?.customDescription||u.description,severity:this.mapSeverityToLegacy(x?.customSeverity||u.severity),escalationPath:x?.customEscalationPath||u.escalationPath,legalRequirements:u.proceduralRequirements,examples:x?.customExamples||u.commonExamples,defaultValidityPeriod:u.defaultValidityPeriod,isActive:!0,createdAt:x?.createdAt||new Date,updatedAt:x?.updatedAt||new Date};m.push(b)}const d=c.filter(u=>u.isCustomCategory);for(const u of d){const x={id:u.id,organizationId:t,name:u.customName||"Custom Category",description:u.customDescription||"Organization-specific category",severity:u.customSeverity||"medium",escalationPath:u.customEscalationPath||["counselling","verbal","first_written","final_written"],legalRequirements:["Follow standard progressive discipline procedures"],examples:u.customExamples||[],defaultValidityPeriod:6,isActive:!0,createdAt:u.createdAt,updatedAt:u.updatedAt};m.push(x)}return this.categoryCache.set(t,{data:m,timestamp:Date.now()}),o.debug("[DataService] ✅ Smart merge complete. Final categories:",m.length),o.debug("[DataService] 📊 Categories:",m.map(u=>`${u.name} (${u.severity})`)),m}catch(s){return o.error("[DataService] ❌ Error in smart category merge:",s),r?(o.debug("[DataService] 🔄 Error occurred, returning stale cache"),r.data):(o.debug("[DataService] 🚨 Ultimate fallback to universal categories"),this.convertUniversalToWarningCategories(t))}}static async getWarningCategory(t,r){try{const a=(await this.getWarningCategories(r)).find(m=>m.id===t);if(a)return a;const n=O(y,"organizations",r,"categories",t),l=await le(n);if(l.exists())return{id:l.id,...l.data(),createdAt:l.data().createdAt?.toDate()||new Date,updatedAt:l.data().updatedAt?.toDate()||new Date};const c=Je.find(m=>m.id===t);return c?this.convertUniversalToWarningCategory(c,r):null}catch(s){return o.error("[DataService] Error getting category:",s),null}}static async customizeCategory(t,r,s){try{const a=r,n=O(y,"organizations",t,"categories",a),l={id:a,organizationId:t,universalCategoryId:r,...s,isCustomCategory:!1,isDisabled:!1,createdAt:new Date,updatedAt:new Date};await ie(n,l),this.categoryCache.delete(t),o.debug("[DataService] ✅ Category customization saved:",r)}catch(a){throw o.error("[DataService] Error customizing category:",a),a}}static async createCustomCategory(t,r){try{const s=`custom-${Date.now()}`,a=O(y,"organizations",t,"categories",s),n={id:s,organizationId:t,universalCategoryId:"",customName:r.name,customDescription:r.description,customEscalationPath:r.escalationPath,customExamples:r.examples||[],customSeverity:r.severity||"medium",isCustomCategory:!0,isDisabled:!1,createdAt:new Date,updatedAt:new Date};return await ie(a,n),this.categoryCache.delete(t),o.debug("[DataService] ✅ Custom category created:",r.name),s}catch(s){throw o.error("[DataService] Error creating custom category:",s),s}}static async disableCategory(t,r){try{const a=O(y,"organizations",t,"categories",r);await ie(a,{organizationId:t,universalCategoryId:r,isDisabled:!0,isCustomCategory:!1,updatedAt:new Date},{merge:!0}),this.categoryCache.delete(t),o.debug("[DataService] ✅ Category disabled:",r)}catch(s){throw o.error("[DataService] Error disabling category:",s),s}}static convertUniversalToWarningCategory(t,r){return{id:t.id,organizationId:r,name:t.name,description:t.description,severity:this.mapSeverityToLegacy(t.severity),escalationPath:t.escalationPath,legalRequirements:t.proceduralRequirements,examples:t.commonExamples,defaultValidityPeriod:t.defaultValidityPeriod,isActive:!0,createdAt:new Date,updatedAt:new Date}}static convertUniversalToWarningCategories(t){return Je.map(r=>this.convertUniversalToWarningCategory(r,t))}static mapSeverityToLegacy(t){return{minor:"low",serious:"medium",gross_misconduct:"high"}[t]||"medium"}static async getOrganization(t){try{const r=O(y,te.ORGANIZATIONS,t),s=await le(r);return s.exists()?{id:s.id,...s.data(),createdAt:this.convertOptionalDate(s.data().createdAt),updatedAt:this.convertOptionalDate(s.data().updatedAt)}:null}catch(r){return o.error("[DataService] Error getting organization:",r),null}}static async createOrganization(t){try{const r=t.id?O(y,te.ORGANIZATIONS,t.id):O(F(y,te.ORGANIZATIONS)),s={...t,updatedAt:z(),...t.id?{}:{createdAt:z()}};return await ie(r,s),await this.logAuditEvent("ORGANIZATION_CREATED",{organizationId:r.id}),r.id}catch(r){throw o.error("[DataService] Error creating organization:",r),r}}static async updateOrganization(t,r){try{const s=O(y,te.ORGANIZATIONS,t);await re(s,{...r,updatedAt:z()}),await this.logAuditEvent("ORGANIZATION_UPDATED",{organizationId:t,updates:r})}catch(s){throw o.error("[DataService] Error updating organization:",s),s}}static async getEmployeesByOrganization(t){try{const r=F(y,"organizations",t,"employees"),s=M(r,I("isActive","==",!0),H("profile.lastName"),H("profile.firstName"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertDate(n.data().createdAt),updatedAt:this.convertDate(n.data().updatedAt),profile:{...n.data().profile,startDate:this.convertDate(n.data().profile?.startDate)},employment:{...n.data().employment,startDate:this.convertDate(n.data().employment?.startDate),endDate:this.convertOptionalDate(n.data().employment?.endDate),probationEndDate:this.convertOptionalDate(n.data().employment?.probationEndDate)}}))}catch(r){return o.error("[DataService] Error getting employees:",r),[]}}static async getEmployeesByManager(t,r){try{return(await this.getEmployeesByOrganization(r)).filter(a=>a.employment?.managerId===t&&a.isActive)}catch(s){throw o.error("[DataService] Failed to get employees by manager:",s),s}}static async getEmployee(t){try{const r=O(y,te.EMPLOYEES,t),s=await le(r);return s.exists()?{id:s.id,...s.data(),createdAt:this.convertDate(s.data().createdAt),updatedAt:this.convertDate(s.data().updatedAt),profile:{...s.data().profile,startDate:this.convertDate(s.data().profile?.startDate)},employment:{...s.data().employment,startDate:this.convertDate(s.data().employment?.startDate),endDate:this.convertOptionalDate(s.data().employment?.endDate),probationEndDate:this.convertOptionalDate(s.data().employment?.probationEndDate)}}:null}catch(r){return o.error("[DataService] Error getting employee:",r),null}}static async saveEmployee(t,r){try{console.log("[DataService] 🚀 Creating employee:",{organizationId:r,hasData:!!t,dataKeys:Object.keys(t),employeeNumber:t.employeeNumber,firstName:t.firstName,lastName:t.lastName});const s=t.id?O(y,te.EMPLOYEES,t.id):O(F(y,te.EMPLOYEES)),a={...t,organizationId:r,updatedAt:z(),...t.id?{}:{createdAt:z()}};return await ie(s,a),this.logAuditEvent(t.id?"EMPLOYEE_UPDATED":"EMPLOYEE_CREATED",{employeeId:s.id,organizationId:r}).catch(n=>o.warn("Audit logging failed:",n)),s.id}catch(s){throw o.error("[DataService] Error saving employee:",s),s}}static async archiveEmployee(t,r){try{const s=O(y,te.EMPLOYEES,t);await re(s,{isActive:!1,archivedAt:z(),updatedAt:z()}),await this.logAuditEvent("EMPLOYEE_ARCHIVED",{employeeId:t,organizationId:r})}catch(s){throw o.error("[DataService] Error archiving employee:",s),s}}static async restoreEmployee(t,r){try{const s=O(y,te.EMPLOYEES,t);await re(s,{isActive:!0,archivedAt:null,updatedAt:z()}),await this.logAuditEvent("EMPLOYEE_RESTORED",{employeeId:t,organizationId:r})}catch(s){throw o.error("[DataService] Error restoring employee:",s),s}}static async getWarningsByOrganization(t,r){try{const s=F(y,"organizations",t,"warnings");let a=M(s,H("issueDate","desc"));r&&(a=M(a,fe(r)));const l=(await B(a)).docs.map(f=>({id:f.id,...f.data(),issueDate:this.convertDate(f.data().issueDate),expiryDate:this.convertDate(f.data().expiryDate),incidentDate:this.convertDate(f.data().incidentDate),deliveryDate:this.convertOptionalDate(f.data().deliveryDate),signatureDate:this.convertOptionalDate(f.data().signatureDate),createdAt:this.convertDate(f.data().createdAt),updatedAt:this.convertDate(f.data().updatedAt)})),c=[...new Set(l.map(f=>f.employeeId).filter(f=>f))],m=[...new Set(l.map(f=>f.categoryId).filter(f=>f))],[d,u]=await Promise.all([this.getBatchEmployees(c,t),this.getBatchWarningCategories(m,t)]),x=new Map;d.forEach(f=>{f&&x.set(f.id,{firstName:f.profile?.firstName||"Unknown",lastName:f.profile?.lastName||"Employee",employeeNumber:f.employeeNumber||"N/A",department:f.employment?.department||"Unknown"})});const b=new Map;return u.forEach(f=>{f&&b.set(f.id,f.name)}),l.map(f=>{const S=x.get(f.employeeId),C=b.get(f.categoryId);return{...f,employeeName:S?`${S.firstName} ${S.lastName}`:"Unknown Employee",employeeNumber:S?.employeeNumber||"Unknown",department:S?.department||"Unknown",category:C||"Unknown Category"}})}catch(s){return o.error("[DataService] Error getting warnings:",s),[]}}static async getWarningsForEmployee(t,r){try{const s=F(y,"organizations",r,"warnings"),a=M(s,I("employeeId","==",t),H("issueDate","desc"));return(await B(a)).docs.map(l=>({id:l.id,...l.data(),issueDate:this.convertDate(l.data().issueDate),expiryDate:this.convertDate(l.data().expiryDate),incidentDate:this.convertDate(l.data().incidentDate),deliveryDate:this.convertOptionalDate(l.data().deliveryDate),signatureDate:this.convertOptionalDate(l.data().signatureDate),createdAt:this.convertDate(l.data().createdAt),updatedAt:this.convertDate(l.data().updatedAt)}))}catch(s){return o.error("[DataService] Error getting employee warnings:",s),[]}}static async getActiveWarningsForEmployee(t,r){try{const s=F(y,"organizations",r,"warnings"),a=new Date,n=M(s,I("employeeId","==",t),I("isActive","==",!0),I("expiryDate",">",a),H("expiryDate","desc"),H("issueDate","desc"));return(await B(n)).docs.map(c=>({id:c.id,...c.data(),issueDate:this.convertDate(c.data().issueDate),expiryDate:this.convertDate(c.data().expiryDate),incidentDate:this.convertDate(c.data().incidentDate),deliveryDate:this.convertOptionalDate(c.data().deliveryDate),signatureDate:this.convertOptionalDate(c.data().signatureDate),createdAt:this.convertDate(c.data().createdAt),updatedAt:this.convertDate(c.data().updatedAt)}))}catch(s){return o.error("[DataService] Error getting active employee warnings:",s),[]}}static async getWarning(t,r){try{const s=O(y,"organizations",r,"warnings",t),a=await le(s);return a.exists()?{id:a.id,...a.data(),issueDate:this.convertDate(a.data().issueDate),expiryDate:this.convertDate(a.data().expiryDate),incidentDate:this.convertDate(a.data().incidentDate),deliveryDate:this.convertOptionalDate(a.data().deliveryDate),signatureDate:this.convertOptionalDate(a.data().signatureDate),createdAt:this.convertDate(a.data().createdAt),updatedAt:this.convertDate(a.data().updatedAt)}:null}catch(s){return o.error("[DataService] Error getting warning:",s),null}}static async saveWarning(t,r){try{o.debug("💾 [SAVE] Saving warning to database...");const s=t.id?O(y,"organizations",r,"warnings",t.id):O(F(y,"organizations",r,"warnings")),a={...t,organizationId:r,updatedAt:z(),...t.id?{}:{createdAt:z()}};return await ie(s,a),await this.logAuditEvent(t.id?"WARNING_UPDATED":"WARNING_CREATED",{warningId:s.id,organizationId:r,employeeId:t.employeeId}),o.success(33682),s.id}catch(s){throw o.error("❌ [SAVE] Error saving warning:",s),s}}static async updateWarningStatus(t,r,s){try{const a=O(y,"organizations",s,"warnings",t);await re(a,{status:r,updatedAt:z()}),await this.logAuditEvent("WARNING_STATUS_UPDATED",{warningId:t,organizationId:s,newStatus:r})}catch(a){throw o.error("[DataService] Error updating warning status:",a),a}}static async markWarningDelivered(t,r,s,a){try{const n=O(y,"organizations",r,"warnings",t);await re(n,{isDelivered:!0,deliveryDate:z(),deliveryMethod:s,deliveryDetails:a,updatedAt:z()}),await this.logAuditEvent("WARNING_DELIVERED",{warningId:t,organizationId:r,deliveryMethod:s,deliveryDetails:a})}catch(n){throw o.error("[DataService] Error marking warning as delivered:",n),n}}static async createUser(t){try{if(!t.organizationId)throw new Error("Organization ID is required for user creation");const r=t.id?O(y,"organizations",t.organizationId,"users",t.id):O(F(y,"organizations",t.organizationId,"users")),s={...t,createdAt:z(),updatedAt:z()};return await ie(r,s),await this.logAuditEvent("USER_CREATED",{userId:r.id,organizationId:t.organizationId}),r.id}catch(r){throw o.error("[DataService] Error creating user:",r),r}}static async getUser(t,r){try{const s=O(y,"organizations",r,"users",t),a=await le(s);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),lastLogin:this.convertOptionalDate(a.data().lastLogin)}:null}catch(s){return o.error("[DataService] Error getting user:",s),null}}static async getUsersByOrganization(t){try{const r=F(y,"organizations",t,"users"),s=M(r,I("isActive","==",!0),H("lastName"),H("firstName"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertDate(n.data().createdAt),lastLogin:this.convertOptionalDate(n.data().lastLogin)}))}catch(r){return o.error("[DataService] Error getting users:",r),[]}}static async updateUser(t,r,s){try{const a=O(y,"organizations",s,"users",t);await re(a,{...r,updatedAt:z()}),await this.logAuditEvent("USER_UPDATED",{userId:t,organizationId:r.organizationId})}catch(a){throw o.error("[DataService] Error updating user:",a),a}}static async deactivateUser(t,r){try{const s=O(y,"organizations",r,"users",t);await re(s,{isActive:!1,updatedAt:z()});try{await Ye.setUserActiveStatus(t,!1),o.debug(`📋 Updated UserOrgIndex active status: ${t} → false`)}catch(a){o.error("❌ Failed to update UserOrgIndex active status:",a)}await this.logAuditEvent("USER_DEACTIVATED",{userId:t,organizationId:r})}catch(s){throw o.error("[DataService] Error deactivating user:",s),s}}static async createDocumentTemplate(t){try{if(!t.organizationId)throw new Error("Organization ID is required for template creation");const r=t.id?O(y,"organizations",t.organizationId,"templates",t.id):O(F(y,"organizations",t.organizationId,"templates")),s={...t,createdAt:z(),updatedAt:z()};return await ie(r,s),await this.logAuditEvent("TEMPLATE_CREATED",{templateId:r.id,organizationId:t.organizationId}),r.id}catch(r){throw o.error("[DataService] Error creating template:",r),r}}static async getDocumentTemplates(t){try{const r=F(y,"organizations",t,"templates"),s=M(r,I("isActive","==",!0),H("name"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertDate(n.data().createdAt),updatedAt:this.convertDate(n.data().updatedAt)}))}catch(r){return o.error("[DataService] Error getting templates:",r),[]}}static async updateDocumentTemplate(t,r,s){try{const a=O(y,"organizations",s,"templates",t);await re(a,{...r,updatedAt:z()}),await this.logAuditEvent("TEMPLATE_UPDATED",{templateId:t,organizationId:r.organizationId})}catch(a){throw o.error("[DataService] Error updating template:",a),a}}static async getEscalationRules(t){try{const r=F(y,"organizations",t,"escalationRules"),s=M(r,I("isActive","==",!0),H("category"));return(await B(s)).docs.map(n=>({id:n.id,...n.data()}))}catch(r){return o.error("[DataService] Error getting escalation rules:",r),[]}}static async createEscalationRule(t,r){try{const s=O(F(y,"organizations",r,"escalationRules")),a={...t,organizationId:r,createdAt:z(),updatedAt:z()};return await ie(s,a),await this.logAuditEvent("ESCALATION_RULE_CREATED",{ruleId:s.id,organizationId:r}),s.id}catch(s){throw o.error("[DataService] Error creating escalation rule:",s),s}}static async getOrganizationStats(t){try{const[r,s,a]=await Promise.all([this.getEmployeesByOrganization(t),this.getWarningsByOrganization(t,100),this.getActiveWarnings(t)]),n=new Date,l=new Date(n.getTime()-720*60*60*1e3),c=s.filter(d=>d.issueDate>=l),m=s.reduce((d,u)=>(d[u.level]=(d[u.level]||0)+1,d),{});return{totalEmployees:r.length,activeEmployees:r.filter(d=>d.isActive).length,totalWarnings:s.length,activeWarnings:a.length,recentWarnings:c.length,warningsByLevel:m,lastUpdated:n}}catch(r){return o.error("[DataService] Error getting organization stats:",r),{totalEmployees:0,activeEmployees:0,totalWarnings:0,activeWarnings:0,recentWarnings:0,warningsByLevel:{},lastUpdated:new Date}}}static async getActiveWarnings(t){try{const r=F(y,"organizations",t,"warnings"),s=new Date,a=M(r,I("isActive","==",!0),I("expiryDate",">",s));return(await B(a)).docs.map(l=>({id:l.id,...l.data(),issueDate:this.convertDate(l.data().issueDate),expiryDate:this.convertDate(l.data().expiryDate),incidentDate:this.convertDate(l.data().incidentDate),createdAt:this.convertDate(l.data().createdAt),updatedAt:this.convertDate(l.data().updatedAt)}))}catch(r){return o.error("[DataService] Error getting active warnings:",r),[]}}static async createAuditLog(t){try{await ot(F(y,te.AUDIT_LOGS),{...t,timestamp:z(),userId:Te.currentUser?.uid||"system"})}catch(r){o.error("[DataService] Error creating audit log:",r)}}static async logAuditEvent(t,r){}static async getUserIP(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return"unknown"}}static async getAuditLogs(t,r=50){try{const s=F(y,te.AUDIT_LOGS),a=M(s,I("data.organizationId","==",t),H("timestamp","desc"),fe(r));return(await B(a)).docs.map(l=>({id:l.id,...l.data(),timestamp:this.convertDate(l.data().timestamp)}))}catch(s){return o.error("[DataService] Error getting audit logs:",s),[]}}static validateWarningLevel(t,r,s){try{return r.escalationPath.includes(s)?{isValid:!0}:{isValid:!1,reason:`${s} is not valid for category "${r.name}"`,suggestedLevel:r.escalationPath[0]}}catch(a){return o.error("[DataService] Error validating warning level:",a),{isValid:!1,reason:"Validation error occurred"}}}static async employeeExists(t){try{return await this.getEmployee(t)!==null}catch(r){return o.error("[DataService] Error checking employee existence:",r),!1}}static async organizationExists(t){try{return await this.getOrganization(t)!==null}catch(r){return o.error("[DataService] Error checking organization existence:",r),!1}}static async employeeNumberExists(t,r){try{const s=F(y,"organizations",t,"employees"),a=M(s,I("profile.employeeNumber","==",r));return!(await B(a)).empty}catch(s){return o.error("[DataService] Error checking employee number existence:",s),!1}}static async getAllEmployeeNumbers(t){try{const r=F(y,te.EMPLOYEES),s=M(r,I("organizationId","==",t));return(await B(s)).docs.map(n=>n.data().profile?.employeeNumber).filter(n=>n&&typeof n=="string")}catch(r){return o.error("[DataService] Error getting employee numbers:",r),[]}}static async generateNextEmployeeNumber(t,r="EMP001",s="",a=1){try{const n=await this.getAllEmployeeNumbers(t);let l=a-1;n.forEach(m=>{const d=m.match(/(\d+)$/);if(d){const u=parseInt(d[1],10);u>l&&(l=u)}});const c=l+1;switch(r){case"EMP001":return`EMP${c.toString().padStart(3,"0")}`;case"E001":return`E${c.toString().padStart(3,"0")}`;case"001":return c.toString().padStart(3,"0");case"custom":return`${s}${c.toString().padStart(3,"0")}`;default:return`EMP${c.toString().padStart(3,"0")}`}}catch(n){return o.error("[DataService] Error generating employee number:",n),`EMP${Date.now().toString().slice(-3)}`}}static async validateEmployeeNumber(t,r,s){try{if(!r||r.trim().length===0)return{isValid:!1,isAvailable:!1,message:"Employee number is required"};if(r.length<2)return{isValid:!1,isAvailable:!1,message:"Employee number must be at least 2 characters"};const a=await this.employeeNumberExists(t,r);if(a&&s){const n=F(y,te.EMPLOYEES),l=M(n,I("organizationId","==",t),I("profile.employeeNumber","==",r));if(!(await B(l)).docs.some(d=>d.id===s))return{isValid:!0,isAvailable:!1,suggestions:[await this.generateNextEmployeeNumber(t,"EMP001"),await this.generateNextEmployeeNumber(t,"E001"),await this.generateNextEmployeeNumber(t,"001")],message:"Employee number already exists"}}else if(a)return{isValid:!0,isAvailable:!1,suggestions:[await this.generateNextEmployeeNumber(t,"EMP001"),await this.generateNextEmployeeNumber(t,"E001"),await this.generateNextEmployeeNumber(t,"001")],message:"Employee number already exists"};return{isValid:!0,isAvailable:!0,message:"Employee number is available"}}catch(a){return o.error("[DataService] Error validating employee number:",a),{isValid:!1,isAvailable:!1,message:"Error validating employee number"}}}static async cleanupExpiredWarnings(t){try{const r=F(y,te.WARNINGS),s=new Date;let a=M(r,I("isActive","==",!0),I("expiryDate","<",s));t&&(a=M(r,I("organizationId","==",t),I("isActive","==",!0),I("expiryDate","<",s)));const n=await B(a),l=Le(y);return n.docs.forEach(c=>{l.update(c.ref,{isActive:!1,expiredAt:z(),updatedAt:z()})}),await l.commit(),t&&await this.logAuditEvent("WARNINGS_CLEANUP",{organizationId:t,expiredCount:n.docs.length}),o.debug(`[DataService] Cleaned up ${n.docs.length} expired warnings`),n.docs.length}catch(r){return o.error("[DataService] Error cleaning up expired warnings:",r),0}}static async getSystemHealthMetrics(){try{return{status:"healthy",timestamp:new Date,services:{firestore:"operational",auth:"operational",storage:"operational"}}}catch(t){return o.error("[DataService] Error getting system health:",t),{status:"degraded",timestamp:new Date,error:t instanceof Error?t.message:"Unknown error"}}}static getIndustryCategories(t,r){return o.debug(59470),this.convertUniversalToWarningCategories(r)}static async createWarningCategory(t){try{const r=t.organizationId;if(!r)throw new Error("Organization ID is required for creating categories");const s=t.id?O(y,"organizations",r,"categories",t.id):O(F(y,"organizations",r,"categories")),a={...t,createdAt:z(),updatedAt:z()};return await ie(s,a),await this.logAuditEvent("WARNING_CATEGORY_CREATED",{categoryId:s.id,organizationId:t.organizationId}),t.organizationId&&this.categoryCache.delete(t.organizationId),s.id}catch(r){throw o.error("[DataService] Error creating warning category:",r),r}}static async bulkCreateEmployees(t,r){try{const s=Le(y),a=[];for(const n of t){const l=O(F(y,te.EMPLOYEES));a.push(l.id),s.set(l,{...n,organizationId:r,createdAt:z(),updatedAt:z()})}return await s.commit(),await this.logAuditEvent("EMPLOYEES_BULK_CREATED",{organizationId:r,count:t.length,employeeIds:a}),a}catch(s){throw o.error("[DataService] Error bulk creating employees:",s),s}}static async bulkUpdateWarningStatuses(t,r,s){try{const a=Le(y);for(const n of t){const l=O(y,te.WARNINGS,n);a.update(l,{status:r,updatedAt:z()})}await a.commit(),await this.logAuditEvent("WARNINGS_BULK_STATUS_UPDATE",{organizationId:s,warningIds:t,newStatus:r,count:t.length})}catch(a){throw o.error("[DataService] Error bulk updating warning statuses:",a),a}}static async loadOrganizations(){try{o.debug(62944);const t=F(y,te.ORGANIZATIONS),r=M(t,H("createdAt","desc")),a=(await B(r)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertOptionalDate(n.data().createdAt),updatedAt:this.convertOptionalDate(n.data().updatedAt)}));return o.success(63433),a}catch(t){throw o.error("[DataService] Error loading organizations:",t),t}}static async getBatchEmployees(t,r){try{if(!t.length)return[];const s=[],a=10;for(let n=0;n<t.length;n+=a){const l=t.slice(n,n+a),c=F(y,te.EMPLOYEES),m=M(c,I("organizationId","==",r),I("__name__","in",l)),u=(await B(m)).docs.map(x=>({id:x.id,...x.data(),createdAt:this.convertOptionalDate(x.data().createdAt),updatedAt:this.convertOptionalDate(x.data().updatedAt)}));s.push(...u)}return o.success(65113),s}catch(s){return o.error("[DataService] Error in batch employee fetch:",s),[]}}static async getBatchWarningCategories(t,r){try{if(!t.length)return[];const s=[],a=10;for(let n=0;n<t.length;n+=a){const l=t.slice(n,n+a),c=F(y,"organizations",r,"categories"),m=M(c,I("__name__","in",l)),u=(await B(m)).docs.map(x=>({id:x.id,...x.data(),createdAt:this.convertOptionalDate(x.data().createdAt),updatedAt:this.convertOptionalDate(x.data().updatedAt)}));s.push(...u)}return o.success(66603),s}catch(s){return o.error("[DataService] Error in batch category fetch:",s),[]}}static async getPaginatedEmployees(t,r=50,s){try{const a=F(y,te.EMPLOYEES);let n=M(a,I("organizationId","==",t),I("isActive","==",!0),H("profile.lastName"),H("profile.firstName"),fe(r+1));if(s){const x=await le(O(y,te.EMPLOYEES,s));x.exists()&&(n=M(a,I("organizationId","==",t),I("isActive","==",!0),H("profile.lastName"),H("profile.firstName"),He(x),fe(r+1)))}const c=(await B(n)).docs.map(x=>({id:x.id,...x.data(),createdAt:this.convertOptionalDate(x.data().createdAt),updatedAt:this.convertOptionalDate(x.data().updatedAt)})),m=c.length>r,d=m?c.slice(0,r):c,u=d.length>0?d[d.length-1].id:void 0;return o.success(68710),{employees:d,hasMore:m,lastId:u}}catch(a){return o.error("[DataService] Error in paginated employee fetch:",a),{employees:[],hasMore:!1}}}static async updateWithOptimisticLocking(t,r,s,a=0){try{const n=O(y,t,r),l=await le(n);if(!l.exists())return{success:!1,error:"Document not found"};const m=l.data().version||0;if(m!==a)return{success:!1,error:`Document was modified by another user. Expected version ${a}, found ${m}`};const d=m+1;return await re(n,{...s,version:d,updatedAt:z()}),o.success(70248),{success:!0,newVersion:d}}catch(n){return o.error("[DataService] Optimistic locking error:",n),{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}static async createReseller(t){try{const r=`reseller_${Date.now()}`,s={...t,id:r,createdAt:z(),updatedAt:z()};return await ie(O(y,"resellers",r),s),o.success(`✅ Reseller created: ${r}`),r}catch(r){throw o.error("❌ Failed to create reseller:",r),r}}static async updateReseller(t,r){try{await re(O(y,"resellers",t),{...r,updatedAt:z()}),o.success(`✅ Reseller updated: ${t}`)}catch(s){throw o.error("❌ Failed to update reseller:",s),s}}static async getReseller(t){try{const r=O(y,"resellers",t),s=await le(r);return s.exists()?{id:s.id,...s.data(),createdAt:this.convertOptionalDate(s.data().createdAt),updatedAt:this.convertOptionalDate(s.data().updatedAt)}:null}catch(r){throw o.error("❌ Failed to get reseller:",r),r}}static async getResellerClients(t){try{const r=F(y,te.ORGANIZATIONS),s=M(r,I("resellerId","==",t),H("createdAt","desc")),n=(await B(s)).docs.map(l=>({id:l.id,...l.data(),createdAt:this.convertOptionalDate(l.data().createdAt),updatedAt:this.convertOptionalDate(l.data().updatedAt)}));return o.success(`📊 Loaded ${n.length} clients for reseller ${t}`),n}catch(r){throw o.error("❌ Failed to get reseller clients:",r),r}}static async createSubscription(t){try{const r=`sub_${Date.now()}`,s={...t,id:r,createdAt:z(),updatedAt:z()};return await ie(O(y,"subscriptions",r),s),o.success(`✅ Subscription created: ${r}`),r}catch(r){throw o.error("❌ Failed to create subscription:",r),r}}static async updateSubscription(t,r){try{await re(O(y,"subscriptions",t),{...r,updatedAt:z()}),o.success(`✅ Subscription updated: ${t}`)}catch(s){throw o.error("❌ Failed to update subscription:",s),s}}static async getOrganizationSubscription(t){try{const r=F(y,"subscriptions"),s=M(r,I("organizationId","==",t)),a=await B(s);if(a.empty)return null;const n=a.docs[0];return{id:n.id,...n.data(),createdAt:this.convertOptionalDate(n.data().createdAt),updatedAt:this.convertOptionalDate(n.data().updatedAt)}}catch(r){throw o.error("❌ Failed to get subscription:",r),r}}static async createCommission(t){try{const r=t.id||`comm_${Date.now()}`,s={...t,id:r,createdAt:z(),updatedAt:z()};return await ie(O(y,"commissions",r),s),o.success(`💰 Commission recorded: ${r}`),r}catch(r){throw o.error("❌ Failed to create commission:",r),r}}static async getResellerCommissions(t,r){try{const s=F(y,"commissions");let a=M(s,I("resellerId","==",t),H("createdAt","desc"));return r&&(a=M(a,fe(r))),(await B(a)).docs.map(c=>({id:c.id,...c.data(),createdAt:this.convertOptionalDate(c.data().createdAt),updatedAt:this.convertOptionalDate(c.data().updatedAt)}))}catch(s){throw o.error("❌ Failed to get reseller commissions:",s),s}}static async updateOrganizationBilling(t,r){try{await re(O(y,te.ORGANIZATIONS,t),{...r,updatedAt:z()}),o.success(`💳 Organization billing updated: ${t}`)}catch(s){throw o.error("❌ Failed to update organization billing:",s),s}}static async getOrganizationsWithBilling(){try{const t=F(y,te.ORGANIZATIONS),r=M(t,H("createdAt","desc")),a=(await B(r)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertOptionalDate(n.data().createdAt),updatedAt:this.convertOptionalDate(n.data().updatedAt)}));for(const n of a){const l=await this.getOrganizationSubscription(n.id);l&&(n.subscription=l)}return o.success(`📊 Loaded ${a.length} organizations with billing`),a}catch(t){throw o.error("❌ Failed to load organizations with billing:",t),t}}static async createCommissionReport(t){try{const r=t.id||`report_${t.resellerId}_${t.month}`,s={...t,id:r,createdAt:z(),updatedAt:z()};return await ie(O(y,"commissionReports",r),s),o.success(`📄 Commission report created: ${r}`),r}catch(r){throw o.error("❌ Failed to create commission report:",r),r}}static async getPendingCommissionReports(){try{const t=F(y,"commissionReports"),r=M(t,I("payoutStatus","==","pending"),H("createdAt","asc"));return(await B(r)).docs.map(n=>({id:n.id,...n.data(),createdAt:this.convertOptionalDate(n.data().createdAt),updatedAt:this.convertOptionalDate(n.data().updatedAt)}))}catch(t){throw o.error("❌ Failed to get pending commission reports:",t),t}}static async assignResellerToOrganization(t,r){try{await this.updateOrganizationBilling(t,{resellerId:r});const s=await this.getReseller(r);if(s){const a=[...s.clientIds||[],t];await this.updateReseller(r,{clientIds:a,totalClientsAcquired:Rr(1)})}o.success(`🤝 Reseller ${r} assigned to organization ${t}`)}catch(s){throw o.error("❌ Failed to assign reseller to organization:",s),s}}static async getAllResellers(){try{const t=M(F(y,"resellers"),H("createdAt","desc"));return(await B(t)).docs.map(s=>({id:s.id,...s.data(),createdAt:this.convertOptionalDate(s.data().createdAt),updatedAt:this.convertOptionalDate(s.data().updatedAt)}))}catch(t){throw o.error("Failed to get all resellers:",t),t}}static async getResellerDeployments(t,r){try{const s=M(F(y,"resellerDeployments"),I("resellerId","==",t),I("deployedAt",">=",r),H("deployedAt","desc"));return(await B(s)).docs.map(n=>({id:n.id,...n.data(),deployedAt:n.data().deployedAt?.toDate()||new Date,createdAt:n.data().createdAt?.toDate()||new Date}))}catch(s){return o.error("Failed to get reseller deployments:",s),[]}}static async logResellerDeployment(t){try{await ot(F(y,"resellerDeployments"),{...t,createdAt:t.deployedAt}),o.info("Reseller deployment logged successfully")}catch(r){o.error("Failed to log reseller deployment:",r)}}}class yt{static async getEscalationRecommendation(t,r,s){try{o.debug(5184);const a=await this.getActiveWarnings(t,s);let n=null,l=!1,c=null,m=null;if(s)try{m=(await Y.queryDocuments(s,"categories",[])).documents.find(g=>g.id===r),m?.escalationPath&&(n=m.escalationPath,l=!0,o.debug("📋 [ESCALATION] Using organization category escalation path:",n))}catch{o.warn("⚠️ [ESCALATION] Failed to load organization categories, falling back to universal")}l||(c=mt(r),c&&(n=c.escalationPath||["counselling","verbal","first_written","final_written"],l=!0,o.debug("📋 [ESCALATION] Using universal category escalation path:",n)));const d=m||c;if(!l||!n)return o.warn("⚠️ [ESCALATION] Category not found in organization or universal categories, using fallback"),this.getFallbackRecommendation(r,s);const u=a.filter(w=>w.categoryId===r);o.debug("📋 [ESCALATION] All active warnings:",a.length),o.debug("📋 [ESCALATION] Category-specific warnings:",u.length),o.debug("📋 [ESCALATION] Category ID filter:",r);const x=n;o.debug("📋 [ESCALATION] Final escalation path:",x);const b=this.determineSuggestedLevel(u,x),f=b==="hr_intervention",S=f?"final_written":b,C={suggestedLevel:S,recommendedLevel:f?"HR INTERVENTION REQUIRED":st(S),reason:f?this.generateHRInterventionReason(u,d):this.generateEscalationReason(u,S,d),requiresHRIntervention:f,interventionReason:f?`Employee has active final written warning for ${d?.name||"this category"}. Next offense requires manual HR decision through dedicated intervention module.`:void 0,interventionLevel:f?"urgent":void 0,activeWarnings:u,escalationPath:x,isEscalation:u.length>0,category:d?.name||"Unknown Category",categoryId:d?.id||r,legalBasis:d?.lraSection||"Schedule 8 Item 3",legalRequirements:d?.proceduralRequirements||[],warningCount:a.length,categoryWarningCount:u.length,nextExpiryDate:this.calculateNextExpiryDate(b,d?.defaultValidityPeriod||6),examples:d?.commonExamples||[],explanation:d?.escalationRationale||"Progressive discipline according to LRA Schedule 8",previousWarnings:u};return o.success(7929),C}catch(a){return o.error("❌ [ESCALATION] Error generating recommendation:",a),this.getFallbackRecommendation(r,s)}}static determineSuggestedLevel(t,r){if(t.length===0){const d=r[0]||"counselling";return o.debug("🆕 [ESCALATION] No active warnings - starting with:",d),d}if(t.some(d=>d.level==="final_written"))return o.warn("🚨 [HR INTERVENTION] Employee has final written warning - HR intervention required"),"hr_intervention";let a=r[0]||"counselling",n=-1;for(const d of t){const u=r.indexOf(d.level);u>n&&(n=u,a=d.level)}o.debug(9224);const c=r.indexOf(a)+1;if(c>=r.length){const d="final_written";return o.debug("⚠️ [ESCALATION] Capping at final written warning:",d),d}const m=r[c];return o.debug("⬆️ [ESCALATION] Suggested next level:",m),m}static generateEscalationReason(t,r,s){if(t.length===0)return`First incident of ${s?.name||"this category"}. Starting with ${st(r)} follows standard progressive discipline procedures.`;const a=t.length,n=t[0],l=Math.floor((Date.now()-n.issueDate.getTime())/(1e3*60*60*24));return`Employee has ${a} active warning${a>1?"s":""} on record. Most recent warning was issued ${l} days ago. Progressive discipline policy requires escalation to ${st(r)}.`}static generateHRInterventionReason(t,r){const s=t.find(l=>l.level==="final_written");if(!s)return`🚨 URGENT: Employee requires HR intervention for ${r?.name||"this category"} violation.`;const a=Math.floor((Date.now()-s.issueDate.getTime())/(1e3*60*60*24)),n=t.length;return`🚨 URGENT HR INTERVENTION REQUIRED: Employee has active final written warning for ${r?.name||"this category"} (issued ${a} days ago) and has committed another offense. Total active warnings: ${n}. HR must use dedicated intervention module to decide next steps. System cannot escalate beyond final written warning.`}static calculateNextExpiryDate(t,r){const s=t==="counselling"?3:t==="verbal"?6:t==="final_written"?12:r,a=new Date;return a.setMonth(a.getMonth()+s),a}static assessCCMAReadiness(t,r,s){return t.length>=2&&s==="final_written"?"high":t.length>=1?"medium":"low"}static async getActiveWarnings(t,r){try{if(o.debug("📋 [WARNINGS] Getting active warnings for employee:",t),!r)return o.warn("⚠️ [WARNINGS] No organizationId provided, using DataService fallback"),await Ft.getActiveWarningsForEmployee(t);const s=F(y,"organizations",r,"warnings"),a=M(s,I("employeeId","==",t),I("isActive","==",!0),H("issueDate","desc")),l=(await B(a)).docs.map(c=>({id:c.id,...c.data(),issueDate:c.data().issueDate?.toDate()||new Date,expiryDate:c.data().expiryDate?.toDate()||new Date,incidentDate:c.data().incidentDate?.toDate()||new Date,createdAt:c.data().createdAt?.toDate()||new Date,updatedAt:c.data().updatedAt?.toDate()||new Date}));return o.success(12879),l}catch(s){return o.error("❌ [WARNINGS] Error getting active warnings:",s),[]}}static getFallbackRecommendation(t,r){const s="counselling";return{suggestedLevel:s,recommendedLevel:st(s),reason:"Unable to analyze warning history - defaulting to counselling for safety",activeWarnings:[],escalationPath:["counselling","verbal","first_written","final_written"],isEscalation:!1,category:"General Misconduct",categoryId:t||"general",legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure fair and consistent application of disciplinary procedures"],warningCount:0,nextExpiryDate:this.calculateNextExpiryDate(s,6),examples:["System error occurred - manual review required"],explanation:"System error occurred - defaulting to safest disciplinary option",previousWarnings:[],ccmaReadiness:"low",ccmaFactors:["Follow basic progressive discipline principles"]}}static normalizeWarningLevel(t){const r=t.toLowerCase().replace(/\s+/g,"_");return{counselling:"counselling",counseling:"counselling",verbal:"verbal",verbal_warning:"verbal",first_written:"first_written",first_written_warning:"first_written",second_written:"second_written",second_written_warning:"second_written",final_written:"final_written",final_written_warning:"final_written"}[r]||"counselling"}static async saveWarning(t,r){try{o.debug("💾 [SAVE] Saving warning to database...");const s=t.id?O(y,"organizations",r,"warnings",t.id):O(F(y,"organizations",r,"warnings")),a={...t,organizationId:r,updatedAt:Ae.getServerTimestamp(),...t.id?{}:{createdAt:Ae.getServerTimestamp()}};return t.id?await re(s,a):await ie(s,a),o.success(16339),s.id}catch(s){throw o.error("❌ [SAVE] Error saving warning:",s),s}}static async getWarningById(t){try{const r=await Ft.getOrganization(),s=O(y,"organizations",r.id,"warnings",t),a=await le(s);return a.exists()?{id:a.id,...a.data(),issueDate:a.data().issueDate?.toDate()||new Date,expiryDate:a.data().expiryDate?.toDate()||new Date,incidentDate:a.data().incidentDate?.toDate()||new Date,createdAt:a.data().createdAt?.toDate()||new Date,updatedAt:a.data().updatedAt?.toDate()||new Date}:null}catch(r){return o.error("❌ [GET] Error getting warning by ID:",r),null}}}class at{static{this.CACHE_DURATION=300*1e3}static{this.cache=new Map}static getCacheKey(t,r,s){return`${t}:${r}:${JSON.stringify(s||{})}`}static isValidCache(t){const r=this.cache.get(t);return r?Date.now()-r.timestamp<this.CACHE_DURATION:!1}static invalidateCache(t){for(const[r]of this.cache)r.includes(t)&&this.cache.delete(r)}static async getEmployeeProfile(t,r){try{const s=O(y,`organizations/${t}/employees`,r),a=await le(s);if(!a.exists())throw new Error(`Employee ${r} not found`);const n=a.data(),l=O(s,"summary","stats"),c=await le(l),m={...n,id:a.id,summary:c.exists()?c.data():void 0};return o.debug(`📋 [NESTED] Loaded employee profile: ${r}`),m}catch(s){throw o.error("❌ [NESTED] Failed to get employee profile:",s),s}}static async createWarning(t,r,s){try{const a=Le(y),n=F(y,`organizations/${t}/employees/${r}/warnings`),l=O(n),c={...s,id:l.id,organizationId:t,employeeId:r,createdAt:new Date,updatedAt:new Date};if(a.set(l,c),c.isActive!==!1){const m=O(y,`organizations/${t}/indexes/activeWarnings`,l.id),d={id:l.id,employeeId:r,organizationId:t,type:"warning",title:`${c.level} - ${c.category}`,date:c.issueDate||new Date,status:c.status||"issued",priority:c.level==="final_written"?"high":c.level==="written"?"medium":"low",metadata:{level:c.level,category:c.category,employeeName:c.employeeName}};a.set(m,d)}return await this.updateEmployeeSummaryStats(a,t,r,"warning"),await a.commit(),this.invalidateCache(`warnings:${t}`),this.invalidateCache(`employee:${t}:${r}`),o.success(`✅ [NESTED] Created warning ${l.id} for employee ${r}`),l.id}catch(a){throw o.error("❌ [NESTED] Failed to create warning:",a),a}}static async getEmployeeWarnings(t,r,s,a){try{let n=F(y,`organizations/${t}/employees/${r}/warnings`);s?.status&&(n=M(n,I("status","==",s.status))),s?.level&&(n=M(n,I("level","==",s.level))),s?.isActive!==void 0&&(n=M(n,I("isActive","==",s.isActive)));const l=a?.orderField||"issueDate",c=a?.orderDirection||"desc";n=M(n,H(l,c)),a?.pageSize&&(n=M(n,fe(a.pageSize))),a?.lastDoc&&(n=M(n,He(a.lastDoc)));const m=await B(n),d=m.docs.map(b=>({...b.data(),id:b.id})),u=a?.pageSize?m.docs.length===a.pageSize:!1,x=m.docs.length>0?m.docs[m.docs.length-1]:void 0;return o.debug(`📋 [NESTED] Loaded ${d.length} warnings for employee ${r}`),{warnings:d,hasMore:u,lastDoc:x}}catch(n){throw o.error("❌ [NESTED] Failed to get employee warnings:",n),n}}static async getOrganizationWarnings(t,r,s){try{let a=Xt(y,"warnings");a=M(a,I("organizationId","==",t)),r?.status&&(a=M(a,I("status","==",r.status))),r?.level&&(a=M(a,I("level","==",r.level))),r?.employeeId&&(a=M(a,I("employeeId","==",r.employeeId)));const n=s?.orderField||"issueDate",l=s?.orderDirection||"desc";a=M(a,H(n,l)),s?.pageSize&&(a=M(a,fe(s.pageSize))),s?.lastDoc&&(a=M(a,He(s.lastDoc)));const c=await B(a),m=c.docs.map(x=>({...x.data(),id:x.id})),d=s?.pageSize?c.docs.length===s.pageSize:!1,u=c.docs.length>0?c.docs[c.docs.length-1]:void 0;return o.debug(`📋 [NESTED] Loaded ${m.length} organization warnings via collection group`),{warnings:m,hasMore:d,lastDoc:u}}catch(a){throw o.error("❌ [NESTED] Failed to get organization warnings:",a),a}}static async updateWarning(t,r,s,a){try{const n=Le(y),l=O(y,`organizations/${t}/employees/${r}/warnings`,s);n.update(l,{...a,updatedAt:z()});const c=O(y,`organizations/${t}/indexes/activeWarnings`,s);if(a.status==="archived"||a.isActive===!1)n.delete(c);else if(a.status||a.level){const m={};a.status&&(m.status=a.status),a.level&&(m.priority=a.level==="final_written"?"high":a.level==="written"?"medium":"low",m.metadata={...m.metadata,level:a.level}),n.update(c,m)}(a.status||a.isActive!==void 0)&&await this.updateEmployeeSummaryStats(n,t,r,"warning"),await n.commit(),this.invalidateCache(`warnings:${t}`),this.invalidateCache(`employee:${t}:${r}`),o.success(`✅ [NESTED] Updated warning ${s}`)}catch(n){throw o.error("❌ [NESTED] Failed to update warning:",n),n}}static async getActiveWarningsIndex(t,r){try{const s=this.getCacheKey("activeWarnings",t,{limit:r});if(this.isValidCache(s))return this.cache.get(s).data;let a=F(y,`organizations/${t}/indexes/activeWarnings`);a=M(a,H("date","desc")),r&&(a=M(a,r(r)));const l=(await B(a)).docs.map(c=>({...c.data(),id:c.id}));return this.cache.set(s,{data:l,timestamp:Date.now()}),o.debug(`📊 [NESTED] Loaded ${l.length} active warnings from index`),l}catch(s){throw o.error("❌ [NESTED] Failed to get active warnings index:",s),s}}static async updateEmployeeSummaryStats(t,r,s,a){try{const n=O(y,`organizations/${r}/employees/${s}/summary`,"stats");t.set(n,{lastUpdated:z(),[`${a}LastActivity`]:z()},{merge:!0}),o.debug(`📊 [NESTED] Scheduled summary update for employee ${s} (${a})`)}catch(n){o.error("❌ [NESTED] Failed to update employee summary:",n)}}static clearCache(){this.cache.clear(),o.debug("🗑️ [NESTED] Cache cleared")}}const is={useNestedDataStructure:!1,enableDualWrite:!1,useCollectionGroupQueries:!1,enableEmployeeSummaryStats:!1,useIndexCollections:!1};function ut(i){return is[i]}function Ut(){return ut("useNestedDataStructure")}function nt(){return ut("enableDualWrite")}function Zs(){return ut("useCollectionGroupQueries")}function Qs(){return ut("useIndexCollections")}class Wt extends Error{constructor(t,r,s){super(t),this.code=r,this.originalError=s,this.name="APIError"}}const Z=(i,t)=>{throw o.error(`API Error in ${i}:`,t),t instanceof Error?new Wt(`${i} failed: ${t.message}`,"OPERATION_FAILED",t):new Wt(`${i} failed with unknown error`,"UNKNOWN_ERROR",t)},os={async getAll(i,t){try{const[r,s]=await Promise.all([ee.loadWarnings(i),ee.loadEmployees(i)]),a=r.documents,n=s.documents,l=a.map(m=>{const d=n.find(u=>u.id===m.employeeId);if(d){const u=d.profile?.firstName||"",x=d.profile?.lastName||"",b=`${u} ${x}`.trim()||m.employeeName||"Unknown";return{...m,employeeName:b,employeeLastName:x||m.employeeLastName||"",employeeNumber:d.profile?.employeeNumber||m.employeeNumber||"Unknown",employeeDepartment:d.employment?.department||m.employeeDepartment||"Unknown",employeePosition:d.employment?.position||m.employeePosition||"Unknown",department:d.employment?.department||m.department||"Unknown",position:d.employment?.position||m.position||"Unknown"}}return m}),c=l.filter(m=>!(!m.level||!m.description||m.employeeName==="Unknown Employee"||m.employeeName==="Employee Not Selected"));return o.debug(`Enhanced ${l.length} warnings with employee data, filtered ${a.length-c.length} incomplete warnings`),c}catch(r){Z("warnings.getAll",r)}},async getById(i,t){try{return await ee.getWarning(t,i)}catch(r){Z("warnings.getById",r)}},async create(i){try{o.debug("💾 Creating warning via DataService:",i);const t={id:"",organizationId:i.organizationId,employeeId:i.employeeId,categoryId:i.categoryId,category:i.categoryName||"Unknown",categoryName:i.categoryName||"Unknown",level:i.level||"verbal",employeeName:i.employeeName||"Unknown",employeeLastName:i.employeeLastName||"Employee",employeeNumber:i.employeeNumber||"Unknown",employeeDepartment:i.employeeDepartment||"Unknown",employeePosition:i.employeePosition||"Unknown",department:i.employeeDepartment||"Unknown",position:i.employeePosition||"Unknown",incidentDate:new Date(i.incidentDate),incidentTime:i.incidentTime,incidentLocation:i.incidentLocation,description:i.incidentDescription,issueDate:new Date(i.issueDate),expiryDate:new Date(i.expiryDate||Date.now()+(i.validityPeriod||6)*30*24*60*60*1e3),validityPeriod:i.validityPeriod||6,issuedBy:i.issuedBy||"",issuedByName:i.issuedByName||"",isActive:!0,status:"issued",...i.additionalNotes&&{additionalNotes:i.additionalNotes},...i.signatures&&{signatures:i.signatures},audioRecording:i.audioRecording||{status:"required",processingStatus:"pending",error:"Audio recording not provided"},deliveryMethod:i.deliveryMethod||"email",createdAt:new Date,updatedAt:new Date};let r;if(Ut()){if(r=await at.createWarning(i.organizationId,i.employeeId,t),o.success(`📁 [NESTED] Warning created: ${r}`),nt())try{await yt.saveWarning(t,i.organizationId),o.debug("📋 [DUAL-WRITE] Warning also saved to flat structure")}catch(s){o.warn("⚠️ [DUAL-WRITE] Failed to save to flat structure:",s)}}else if(r=await yt.saveWarning(t,i.organizationId),o.success(`📋 [FLAT] Warning created: ${r}`),nt())try{await at.createWarning(i.organizationId,i.employeeId,{...t,id:r}),o.debug("📁 [DUAL-WRITE] Warning also saved to nested structure")}catch(s){o.warn("⚠️ [DUAL-WRITE] Failed to save to nested structure:",s)}return r}catch(t){Z("warnings.create",t)}},async update(i,t,r,s){try{const a=r||t.organizationId;if(!a)throw new Error("Organization ID required for warning update");if(Ut()){if(!s)o.warn("⚠️ [NESTED] Employee ID required for nested update, falling back to flat structure"),await this.updateFlatStructure(i,t,a);else if(await at.updateWarning(a,s,i,t),o.success(`📁 [NESTED] Warning ${i} updated successfully`),nt())try{await this.updateFlatStructure(i,t,a),o.debug("📋 [DUAL-WRITE] Warning also updated in flat structure")}catch(n){o.warn("⚠️ [DUAL-WRITE] Failed to update flat structure:",n)}}else if(await this.updateFlatStructure(i,t,a),o.success(`📋 [FLAT] Warning ${i} updated successfully`),nt()&&s)try{await at.updateWarning(a,s,i,t),o.debug("📁 [DUAL-WRITE] Warning also updated in nested structure")}catch(n){o.warn("⚠️ [DUAL-WRITE] Failed to update nested structure:",n)}}catch(a){Z("warnings.update",a)}},async updateFlatStructure(i,t,r){const s=O(y,`organizations/${r}/warnings`,i),a={...t,updatedAt:z(),organizationId:void 0};Object.keys(a).forEach(n=>{a[n]===void 0&&delete a[n]}),await re(s,a),t.status&&await tt.updateWarningStatus(i,t.status,r)},async delete(i){try{o.warn("warnings.delete not implemented - needs WarningService integration")}catch(t){Z("warnings.delete",t)}},async getEscalationRecommendation(i,t,r){try{return await yt.getEscalationRecommendation(i,t,r)}catch(s){Z("warnings.getEscalationRecommendation",s)}},async getStats(i){try{const t=await tt.getWarningsByOrganization(i);return{total:t.length,issued:t.filter(s=>s.status==="issued").length,delivered:t.filter(s=>s.status==="delivered").length,byLevel:{counselling:t.filter(s=>s.warningLevel==="counselling").length,written_warning_1:t.filter(s=>s.warningLevel==="written_warning_1").length,written_warning_2:t.filter(s=>s.warningLevel==="written_warning_2").length,final_written_warning:t.filter(s=>s.warningLevel==="final_written_warning").length,dismissal:t.filter(s=>s.warningLevel==="dismissal").length}}}catch(t){Z("warnings.getStats",t)}},async archive(i,t,r){try{const s=O(y,`organizations/${t}/warnings`,i);await re(s,{isArchived:!0,archivedAt:z(),archiveReason:r,updatedAt:z()}),o.success(`Warning ${i} archived (reason: ${r})`)}catch(s){Z("warnings.archive",s)}},async getArchived(i){try{return(await ee.loadWarnings(i)).documents.filter(s=>s.isArchived===!0||s.status==="expired"||s.status==="overturned")}catch(t){return Z("warnings.getArchived",t),[]}}},cr={async getAll(i,t=100){try{const r=await ee.loadEmployees(i,{pageSize:t,orderField:"profile.lastName",orderDirection:"asc"});return o.success(`👥 [OPTIMIZED] Loaded ${r.documents.length} employees with pagination (pageSize: ${t})`),r.documents}catch(r){Z("employees.getAll",r)}},async getById(i,t){try{return await ee.getEmployeeById(i,t)}catch(r){Z("employees.getById",r)}},async create(i){try{return(await ee.saveEmployee(i,i.organizationId)).id}catch(t){Z("employees.create",t)}},async update(i,t,r){try{const s=await ee.getEmployeeById(i,t);if(!s)throw new Error("Employee not found");const a={...s,...r};await ee.saveEmployee(a,t)}catch(s){Z("employees.update",s)}},async delete(i,t){try{await ee.archiveEmployee(i,t)}catch(r){Z("employees.delete",r)}},async bulkCreate(i,t){try{return(await ee.bulkCreateEmployees(i,t)).success>0?["bulk-success"]:[]}catch(r){Z("employees.bulkCreate",r)}},async search(i,t){try{const s=(await ee.loadEmployees(i)).documents,a=t.toLowerCase();return s.filter(n=>n.profile.firstName.toLowerCase().includes(a)||n.profile.lastName.toLowerCase().includes(a)||n.profile.employeeNumber.toLowerCase().includes(a)||n.profile.email.toLowerCase().includes(a))}catch(r){Z("employees.search",r)}},async getByManager(i,t){try{const r=X.generateOrgKey(t,"employees","manager",i);return await X.getOrFetch(r,async()=>{const a=await Y.queryDocuments(t,"employees",[I("employment.managerId","==",i),I("isActive","==",!0)],{pageSize:50,orderField:"profile.lastName",orderDirection:"asc"});return o.success(`👥 [OPTIMIZED] Loaded ${a.documents.length} employees for manager ${i}`),a.documents})}catch(r){Z("employees.getByManager",r)}},async generateNextEmployeeNumber(i,t="EMP001",r="",s=1){try{const l=(await ee.loadEmployees(i)).documents.map(d=>d.profile?.employeeNumber).filter(d=>d&&typeof d=="string");let c=s-1;l.forEach(d=>{const u=d.match(/(\d+)$/);if(u){const x=parseInt(u[1],10);x>c&&(c=x)}});const m=c+1;switch(t){case"EMP001":return`EMP${m.toString().padStart(3,"0")}`;case"E001":return`E${m.toString().padStart(3,"0")}`;case"001":return m.toString().padStart(3,"0");case"custom":return`${r}${m.toString().padStart(3,"0")}`;default:return`EMP${m.toString().padStart(3,"0")}`}}catch(a){Z("employees.generateNextEmployeeNumber",a)}},async validateEmployeeNumber(i,t,r){try{const a=(await ee.loadEmployees(i)).documents;if(!a.find(d=>d.profile?.employeeNumber===t&&d.id!==r))return{isAvailable:!0};const l=[],c=t.match(/(\d+)$/),m=t.replace(/(\d+)$/,"");if(c){const d=parseInt(c[1],10);for(let u=1;u<=3;u++){const x=`${m}${(d+u).toString().padStart(c[1].length,"0")}`;a.some(f=>f.profile?.employeeNumber===x)||l.push(x)}}return{isAvailable:!1,suggestions:l.slice(0,3)}}catch(s){Z("employees.validateEmployeeNumber",s)}},async archive(i,t,r){try{const{EmployeeLifecycleService:s}=await Se(async()=>{const{EmployeeLifecycleService:a}=await import("./EmployeeLifecycleService-B6O4LcrH.js");return{EmployeeLifecycleService:a}},__vite__mapDeps([0,1,2,3,4]));await s.archiveEmployee(i,t,r)}catch(s){Z("employees.archive",s)}},async restore(i,t,r){try{const{EmployeeLifecycleService:s}=await Se(async()=>{const{EmployeeLifecycleService:a}=await import("./EmployeeLifecycleService-B6O4LcrH.js");return{EmployeeLifecycleService:a}},__vite__mapDeps([0,1,2,3,4]));await s.restoreEmployee(i,t,r)}catch(s){Z("employees.restore",s)}},async getEligibleForDeletion(i){try{const{EmployeeLifecycleService:t}=await Se(async()=>{const{EmployeeLifecycleService:r}=await import("./EmployeeLifecycleService-B6O4LcrH.js");return{EmployeeLifecycleService:r}},__vite__mapDeps([0,1,2,3,4]));return await t.getEmployeesEligibleForDeletion(i)}catch(t){Z("employees.getEligibleForDeletion",t)}},async getLifecycleStats(i){try{const{EmployeeLifecycleService:t}=await Se(async()=>{const{EmployeeLifecycleService:r}=await import("./EmployeeLifecycleService-B6O4LcrH.js");return{EmployeeLifecycleService:r}},__vite__mapDeps([0,1,2,3,4]));return await t.getLifecycleStats(i)}catch(t){Z("employees.getLifecycleStats",t)}},async getArchived(i){try{return(await ee.loadArchivedEmployees(i)).documents}catch(t){Z("employees.getArchived",t)}},async getAllWarningsForEmployee(i,t){try{return await ee.getAllWarningsForEmployee(i,t)}catch(r){Z("employees.getAllWarningsForEmployee",r)}}},ls={async getById(i){try{return await tt.getOrganization(i)}catch(t){Z("organizations.getById",t)}},async update(i,t){try{throw new Error("Organization updates not implemented in DataServiceV2")}catch(r){Z("organizations.update",r)}},async getCategories(i){try{return await ee.getWarningCategories(i)}catch(t){Z("organizations.getCategories",t)}}},cs={getUniversal(){return Je},getById(i){return mt(i)||null},getEscalationPath(i){return as(i)},getNextLevel(i,t){return ns(i,t)||"verbal"}},ds={async loadDashboardData(i,t){try{const r=Date.now();o.debug("🚀 [BATCH] Loading dashboard data in parallel...");const[s,a,n]=await Promise.all([cr.getByManager(t,i),Promise.resolve([]),Promise.resolve({})]),l=Date.now()-r;return o.success(`🚀 [BATCH] Dashboard data loaded in ${l}ms (employees: ${s.length})`),{employees:s,followUps:a,stats:n,loadTime:l}}catch(r){throw Z("batch.loadDashboardData",r),r}},async loadOrganizationSetup(i){try{const t=Date.now();o.debug("🚀 [BATCH] Loading organization setup data...");const r=X.generateOrgKey(i,"organization"),s=X.generateOrgKey(i,"categories"),a=X.generateOrgKey(i,"settings"),[n,l,c]=await Promise.all([X.getOrFetch(r,()=>tt.getOrganization(i)),X.getOrFetch(s,()=>ee.getWarningCategories(i)),X.getOrFetch(a,()=>Promise.resolve({}))]),m=Date.now()-t;return o.success(`🚀 [BATCH] Organization setup loaded in ${m}ms`),{organization:n,categories:l,settings:c,loadTime:m}}catch(t){throw Z("batch.loadOrganizationSetup",t),t}}},ms={async getAll(i){try{return[]}catch(t){Z("reports.getAll",t)}}},us={async getDashboardMetrics(i){try{return{complianceScore:94,costPerEmployee:4250,riskScore:12}}catch(t){Z("analytics.getDashboardMetrics",t)}}},pe={warnings:os,employees:cr,organizations:ls,categories:cs,batch:ds,reports:ms,analytics:us},gt=({message:i="Loading...",size:t="md"})=>{const r={sm:"py-4",md:"py-6",lg:"py-8"},s={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsxs("div",{className:`flex items-center justify-center ${r[t]}`,children:[e.jsx(St,{className:`${s[t]} animate-spin text-blue-600`}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:i})]})},Ht=({onClose:i,inline:t=!1,organizationId:r,organizationName:s,allowEdit:a=!1})=>{const{user:n}=ye(),l=Ie.useContext(dt),c=l?.organization||null,m=l?.organizationId,d=r||m,[u,x]=p.useState([]),[b,f]=p.useState(!0),[S,C]=p.useState(null),[w,g]=p.useState(null),[h,D]=p.useState(null),[v,k]=p.useState(!1),[A,T]=p.useState(!1),[N,_]=p.useState({name:"",description:"",level:"verbal",color:"#10b981",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]}),G=n?.role?.id==="super-user",q=a&&G,L=async()=>{if(!d){C("Organization ID not found"),f(!1);return}try{f(!0),C(null),o.debug("[OrganizationCategoriesViewer] Loading categories for organization:",d);const R=await pe.organizations.getCategories(d);o.debug("[OrganizationCategoriesViewer] Loaded categories:",R),x(R)}catch(R){o.error("[OrganizationCategoriesViewer] Error loading categories:",R),C(R instanceof Error?R.message:"Failed to load categories")}finally{f(!1)}};p.useEffect(()=>{L()},[d]);const E=async R=>{if(!(!d||!q)&&confirm("Are you sure you want to delete this category?"))try{k(!0);const J=u.filter(ne=>ne.id!==R);await Y.updateDocument(d,"organizations",d,{categories:J}),await L(),o.success("Category deleted successfully")}catch(J){o.error("Failed to delete category:",J)}finally{k(!1)}},Q=async R=>{if(!(!d||!q))try{k(!0);const J=u.map(ne=>ne.id===R.id?{...ne,isActive:ne.isActive===!1}:ne);await Y.updateDocument(d,"organizations",d,{categories:J}),await L(),o.success(`Category ${R.isActive!==!1?"deactivated":"activated"}`)}catch(J){o.error("Failed to toggle category:",J)}finally{k(!1)}},ge=async()=>{if(!(!d||!q)){if(!N.name?.trim()){alert("Category name is required");return}try{k(!0);const R={id:`custom-${Date.now()}`,name:N.name,description:N.description||"",level:N.level||"verbal",color:N.color||"#10b981",icon:N.icon||"📋",isActive:N.isActive!==!1,isDefault:!1,escalationPath:N.escalationPath||["verbal","first_written","final_written"]},J=[...u,R];await Y.updateDocument(d,"organizations",d,{categories:J}),await L(),T(!1),_({name:"",description:"",level:"verbal",color:"#10b981",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]}),o.success("Category created successfully")}catch(R){o.error("Failed to create category:",R)}finally{k(!1)}}},$=R=>{switch(R){case"minor":case"low":return"#10b981";case"serious":case"medium":return"#f59e0b";case"gross_misconduct":case"high":return"#ef4444";default:return"#6b7280"}},U=R=>{switch(R){case"minor":case"low":return e.jsx(xe,{className:"h-4 w-4"});case"serious":case"medium":return e.jsx(Ne,{className:"h-4 w-4"});case"gross_misconduct":case"high":return e.jsx(_e,{className:"h-4 w-4"});default:return e.jsx(wt,{className:"h-4 w-4"})}},K=e.jsxs(e.Fragment,{children:[!t&&e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-violet-600 text-white p-2 rounded-lg",children:e.jsx(Ze,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Warning Categories"}),e.jsxs("p",{className:"text-gray-600",children:[s||c?.name," • ",u.length," categories configured"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:L,disabled:b,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",title:"Refresh categories",children:e.jsx(Qe,{className:`h-4 w-4 ${b?"animate-spin":""}`})}),e.jsx("button",{onClick:i,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",title:"Close",children:e.jsx(_e,{className:"h-4 w-4"})})]})]})}),t&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Warning Categories"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),u.length," total"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),u.filter(R=>R.isActive!==!1).length," active"]})]})]}),e.jsxs("button",{onClick:L,disabled:b,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-md transition-colors disabled:opacity-50",title:"Refresh categories",children:[e.jsx(Qe,{className:`w-3.5 h-3.5 ${b?"animate-spin":""}`}),"Refresh"]})]})}),e.jsx("div",{className:"flex-1 overflow-auto",children:b?e.jsx(gt,{message:"Loading categories..."}):S?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"w-3.5 h-3.5 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Error Loading Categories"})]}),e.jsx("p",{className:"text-xs text-red-600 mb-2",children:S}),e.jsx("button",{onClick:L,className:"px-3 py-1.5 text-xs font-medium bg-red-600 text-white rounded-md hover:bg-red-700",children:"Try Again"})]}):u.length===0?e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[e.jsx(Ze,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No Categories Found"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"No warning categories have been configured for this organization yet."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 text-xs",children:[e.jsx(Or,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Categories can only be configured by SuperUser administrators for security and compliance."})]})})]}):e.jsxs("div",{className:"space-y-3",children:[!q&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($t,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-blue-900 mb-0.5",children:"Read-Only View"}),e.jsx("p",{className:"text-xs text-blue-800",children:"Category modifications are restricted to SuperUser administrators to ensure compliance and data integrity."})]})]})}),q&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bt,{className:"w-3.5 h-3.5 text-green-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-green-900 mb-0.5",children:"SuperUser Edit Mode"}),e.jsx("p",{className:"text-xs text-green-800",children:"You can edit, activate/deactivate, and delete categories for this organization."})]})]})}),q&&!A&&e.jsxs("button",{onClick:()=>T(!0),className:"w-full flex items-center justify-center gap-2 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Create New Category"})]}),q&&A&&e.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Create New Category"}),e.jsx("button",{onClick:()=>T(!1),className:"p-1.5 hover:bg-gray-100 rounded",children:e.jsx(_e,{className:"w-5 h-5 text-gray-600"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),e.jsx("input",{type:"text",value:N.name||"",onChange:R=>_({...N,name:R.target.value}),placeholder:"e.g., Attendance Issues",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),e.jsxs("select",{value:N.level||"verbal",onChange:R=>_({...N,level:R.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"counselling",children:"Counselling"}),e.jsx("option",{value:"verbal",children:"Verbal Warning"}),e.jsx("option",{value:"first_written",children:"First Written Warning"}),e.jsx("option",{value:"second_written",children:"Second Written Warning"}),e.jsx("option",{value:"final_written",children:"Final Written Warning"}),e.jsx("option",{value:"suspension",children:"Suspension"}),e.jsx("option",{value:"dismissal",children:"Dismissal"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:N.description||"",onChange:R=>_({...N,description:R.target.value}),placeholder:"Brief description of this category...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),e.jsx("input",{type:"color",value:N.color||"#10b981",onChange:R=>_({...N,color:R.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:N.isActive!==!1,onChange:R=>_({...N,isActive:R.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(R=>e.jsx("button",{type:"button",onClick:()=>_({...N,icon:R}),className:`w-10 h-10 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 ${N.icon===R?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,children:R},R))}),N.icon&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",e.jsx("span",{className:"text-xl",children:N.icon})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:ge,disabled:v||!N.name?.trim(),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:v?"Creating...":"Create Category"}),e.jsx("button",{onClick:()=>T(!1),disabled:v,className:"px-4 py-2.5 bg-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors",children:"Cancel"})]})]}),e.jsx("div",{className:"space-y-1.5",children:u.map(R=>{const J=w===R.id;return e.jsx("div",{className:"border border-gray-200 rounded-lg bg-white",children:e.jsxs("div",{className:"p-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300 flex-shrink-0",style:{backgroundColor:R.color||$(R.severity)}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:R.name}),e.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded text-white text-xs font-medium",style:{backgroundColor:$(R.severity)},children:[e.jsx("span",{className:"scale-75",children:U(R.severity)}),R.severity?.replace("_"," ")||"Unknown"]}),R.isActive!==!1&&e.jsxs("div",{className:"flex items-center gap-0.5 px-1.5 py-0.5 bg-green-100 text-green-800 rounded text-xs font-medium",children:[e.jsx(qe,{className:"w-2.5 h-2.5"}),"Active"]})]}),R.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-1.5 line-clamp-2",children:R.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ot,{className:"w-3 h-3"}),R.escalationPath?.length||0," steps"]}),R.createdAt&&e.jsx("span",{children:new Date(R.createdAt).toLocaleDateString("en-ZA")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[q&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Q(R),disabled:v,className:`p-1.5 rounded hover:bg-gray-50 flex-shrink-0 ${R.isActive!==!1?"text-green-600 hover:text-green-700":"text-gray-400 hover:text-gray-600"}`,title:R.isActive!==!1?"Deactivate category":"Activate category",children:R.isActive!==!1?e.jsx(Tr,{className:"w-3.5 h-3.5"}):e.jsx(vt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>E(R.id),disabled:v,className:"p-1.5 text-red-500 hover:text-red-700 rounded hover:bg-red-50 flex-shrink-0",title:"Delete category",children:e.jsx(er,{className:"w-3.5 h-3.5"})})]}),e.jsx("button",{onClick:()=>g(J?null:R.id),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded hover:bg-gray-50 flex-shrink-0",title:J?"Collapse details":"Expand details",children:J?e.jsx(tr,{className:"w-3.5 h-3.5"}):e.jsx(rt,{className:"w-3.5 h-3.5"})})]})]}),J&&e.jsx("div",{className:"mt-3 pt-2.5 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[e.jsx(Ot,{className:"w-3 h-3"}),"Escalation Path"]}),R.escalationPath&&R.escalationPath.length>0?e.jsx("div",{className:"space-y-1",children:R.escalationPath.map((ne,be)=>e.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-gray-50 rounded text-xs",children:[e.jsx("span",{className:"w-4 h-4 bg-blue-500 text-white text-[10px] rounded-full flex items-center justify-center font-semibold flex-shrink-0",children:be+1}),e.jsx("span",{className:"font-medium capitalize",children:ne.replace("_"," ")})]},be))}):e.jsx("p",{className:"text-gray-500 text-xs",children:"No escalation path defined"})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[e.jsx(wt,{className:"w-3 h-3"}),"Details"]}),e.jsxs("div",{className:"space-y-1.5 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Category ID:"}),e.jsx("span",{className:"text-gray-600 ml-1 font-mono text-[10px]",children:R.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Severity:"}),e.jsx("span",{className:"text-gray-600 ml-1 capitalize",children:R.severity?.replace("_"," ")||"Not specified"})]}),R.examples&&R.examples.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Examples:"}),e.jsxs("div",{className:"mt-1.5 flex flex-wrap gap-1",children:[R.examples.slice(0,3).map((ne,be)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-[10px] rounded",children:ne},be)),R.examples.length>3&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded",children:["+",R.examples.length-3," more"]})]})]})]})]})]})})]})},R.id)})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 flex-wrap gap-2",children:[e.jsxs("span",{children:["Total: ",e.jsx("strong",{children:u.length})," configured"]}),e.jsxs("span",{children:["Active: ",e.jsx("strong",{children:u.filter(R=>R.isActive!==!1).length})]}),q?e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(bt,{className:"w-2.5 h-2.5"}),"Edit mode"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($t,{className:"w-2.5 h-2.5"}),"Read-only"]})]})})]})})]});return t?e.jsx("div",{className:"space-y-4",children:K}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:K})})},gs=[{name:"Operations",description:"Core business operations and daily management activities",isDefault:!0,isActive:!0},{name:"Admin",description:"Human resources, administration, and support functions",isDefault:!0,isActive:!0}];class hs{getCollectionPath(t){return`organizations/${t}/departments`}async createDefaultDepartments(t){try{o.info("Creating default departments for organization",{organizationId:t});const r=Le(y),s=[],a=new Date;for(const n of gs){const l=O(F(y,this.getCollectionPath(t))),c={id:l.id,...n,organizationId:t,employeeCount:0,createdAt:a,updatedAt:a};r.set(l,{...c,createdAt:De.fromDate(a),updatedAt:De.fromDate(a)}),s.push(c)}return await r.commit(),o.success("Default departments created successfully",{organizationId:t,count:s.length}),s}catch(r){throw o.error("Failed to create default departments",{error:r,organizationId:t}),r}}async getDepartments(t){try{const r=M(F(y,this.getCollectionPath(t)),I("isActive","==",!0),H("isDefault","desc"),H("name","asc")),s=await B(r),a=[];return s.forEach(n=>{const l=n.data();a.push({id:n.id,...l,createdAt:l.createdAt?.toDate()||new Date,updatedAt:l.updatedAt?.toDate()||new Date})}),o.info("Retrieved departments",{organizationId:t,count:a.length}),a}catch(r){throw o.error("Failed to get departments",{error:r,organizationId:t}),r}}async getDepartment(t,r){try{const s=O(y,this.getCollectionPath(t),r),a=await le(s);if(!a.exists())return null;const n=a.data();return{id:a.id,...n,createdAt:n.createdAt?.toDate()||new Date,updatedAt:n.updatedAt?.toDate()||new Date}}catch(s){throw o.error("Failed to get department",{error:s,organizationId:t,departmentId:r}),s}}async createDepartment(t,r){try{o.info("Creating new department",{organizationId:t,formData:r});const s=new Date,a={name:r.name.trim(),description:r.description?.trim()||"",managerId:r.managerId||null,managerName:null,managerEmail:null,employeeCount:0,isDefault:!1,organizationId:t,isActive:!0,createdAt:De.fromDate(s),updatedAt:De.fromDate(s)},n=await ot(F(y,this.getCollectionPath(t)),a),l={id:n.id,...a,createdAt:s,updatedAt:s};return r.managerId&&await this.updateManagerInfo(t,n.id,r.managerId),o.success("Department created successfully",{organizationId:t,departmentId:n.id}),l}catch(s){throw o.error("Failed to create department",{error:s,organizationId:t,formData:r}),s}}async updateDepartment(t,r,s){try{o.info("Updating department",{organizationId:t,departmentId:r,formData:s});const a=O(y,this.getCollectionPath(t),r),n={name:s.name.trim(),description:s.description?.trim()||"",managerId:s.managerId||null,updatedAt:De.fromDate(new Date)};await re(a,n),s.managerId?await this.updateManagerInfo(t,r,s.managerId):await re(a,{managerName:null,managerEmail:null}),o.success("Department updated successfully",{organizationId:t,departmentId:r})}catch(a){throw o.error("Failed to update department",{error:a,organizationId:t,departmentId:r,formData:s}),a}}async deleteDepartment(t,r){try{if((await this.getDepartment(t,r))?.isDefault)throw new Error("Cannot delete default departments (Operations, Admin)");o.info("Deleting department",{organizationId:t,departmentId:r});const a=O(y,this.getCollectionPath(t),r);await re(a,{isActive:!1,updatedAt:De.fromDate(new Date)}),o.success("Department deleted successfully",{organizationId:t,departmentId:r})}catch(s){throw o.error("Failed to delete department",{error:s,organizationId:t,departmentId:r}),s}}async updateManagerInfo(t,r,s){try{const a=O(y,`organizations/${t}/employees`,s),n=await le(a);if(n.exists()){const l=n.data(),c=`${l.profile?.firstName||""} ${l.profile?.lastName||""}`.trim(),m=l.profile?.email||"",d=O(y,this.getCollectionPath(t),r);await re(d,{managerName:c,managerEmail:m,updatedAt:De.fromDate(new Date)})}}catch(a){o.error("Failed to update manager info",{error:a,organizationId:t,departmentId:r,managerId:s})}}async getDepartmentStats(t){try{const r=await this.getDepartments(t),s=r.length,a=r.filter(m=>m.managerId).length,n=s-a,l=r.reduce((m,d)=>m+d.employeeCount,0),c=s>0?l/s:0;return{totalDepartments:s,departmentsWithManagers:a,departmentsWithoutManagers:n,totalEmployeesAcrossDepartments:l,averageEmployeesPerDepartment:Math.round(c*100)/100}}catch(r){throw o.error("Failed to get department stats",{error:r,organizationId:t}),r}}subscribeToDepartments(t,r){const s=M(F(y,this.getCollectionPath(t)),I("isActive","==",!0),H("isDefault","desc"),H("name","asc"));return kr(s,a=>{const n=[];a.forEach(l=>{const c=l.data();n.push({id:l.id,...c,createdAt:c.createdAt?.toDate()||new Date,updatedAt:c.updatedAt?.toDate()||new Date})}),r(n)},a=>{o.error("Department subscription error",{error:a,organizationId:t})})}async updateEmployeeCount(t,r,s){try{const a=O(y,this.getCollectionPath(t),r);await re(a,{employeeCount:s,updatedAt:De.fromDate(new Date)})}catch(a){throw o.error("Failed to update employee count",{error:a,organizationId:t,departmentId:r,newCount:s}),a}}async refreshEmployeeCounts(t){try{o.info("Refreshing employee counts for all departments",{organizationId:t});const r=F(y,`organizations/${t}/employees`),s=await B(M(r,I("isActive","==",!0))),a={};s.forEach(c=>{const m=c.data(),d=m.profile?.department||m.employment?.department;d&&(a[d]=(a[d]||0)+1)});const n=await this.getDepartments(t),l=Le(y);for(const c of n){const m=a[c.name]||0;if(c.employeeCount!==m){const d=O(y,this.getCollectionPath(t),c.id);l.update(d,{employeeCount:m,updatedAt:De.fromDate(new Date)})}}await l.commit(),o.success("Employee counts refreshed successfully",{organizationId:t,counts:a})}catch(r){throw o.error("Failed to refresh employee counts",{error:r,organizationId:t}),r}}async getDepartmentsForManager(t,r){try{return(await this.getDepartments(t)).filter(a=>!a.managerId||a.managerId===r)}catch(s){throw o.error("Failed to get departments for manager",{error:s,organizationId:t}),s}}}const Oe=new hs,oe=({children:i,className:t="",style:r,hover:s=!1,padding:a="md",shadow:n="md",onClick:l})=>{const c={none:"",sm:"p-3",md:"p-4",lg:"p-6"},m={sm:"var(--shadow-sm)",md:"var(--shadow)",lg:"var(--shadow-lg)",xl:"var(--shadow-xl)"},d={backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-card-border)",boxShadow:m[n],transition:"all 0.2s ease",...r},u=b=>{s&&(b.currentTarget.style.transform="translateY(-2px)",b.currentTarget.style.boxShadow=m.lg)},x=b=>{s&&(b.currentTarget.style.transform="translateY(0)",b.currentTarget.style.boxShadow=m[n])};return e.jsx("div",{className:`rounded-lg ${c[a]} ${l?"cursor-pointer":""} ${t}`,style:d,onClick:l,onMouseEnter:u,onMouseLeave:x,children:i})},Js=({icon:i,title:t,subtitle:r,rightContent:s,className:a=""})=>e.jsxs("div",{className:`flex items-center justify-between ${a}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text)"},children:t}),r&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:r})]})]}),s&&e.jsx("div",{className:"flex items-center gap-2",children:s})]}),Xs=({type:i="text",label:t,value:r,onChange:s,placeholder:a,error:n,icon:l,required:c=!1,disabled:m=!1,options:d,className:u=""})=>{const x={backgroundColor:n?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:n?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"},b=()=>{const f={value:r,onChange:S=>s(S.target.value),placeholder:a,disabled:m,className:`w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm ${m?"opacity-50 cursor-not-allowed":""}`,style:x};return i==="textarea"?e.jsx("textarea",{...f,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm min-h-[88px] resize-vertical ${m?"opacity-50 cursor-not-allowed":""}`}):i==="select"&&d?e.jsxs("select",{...f,children:[e.jsx("option",{value:"",children:a||`Select ${t.toLowerCase()}...`}),d.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))]}):e.jsx("input",{...f,type:i})};return e.jsxs("div",{className:`space-y-2 ${u}`,children:[e.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[l&&e.jsx(l,{className:"w-3 h-3 inline mr-1"}),t," ",c&&e.jsx("span",{style:{color:"var(--color-error)"},children:"*"})]}),b(),n&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),n]})]})},ea=({children:i,variant:t="default",size:r="sm",className:s=""})=>{const a={sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm"},l=(()=>{switch(t){case"primary":return{backgroundColor:"var(--color-badge-primary)",color:"var(--color-badge-primary-text)"};case"success":return{backgroundColor:"var(--color-badge-success)",color:"var(--color-badge-success-text)"};case"warning":return{backgroundColor:"var(--color-badge-warning)",color:"var(--color-badge-warning-text)"};case"error":return{backgroundColor:"var(--color-badge-error)",color:"var(--color-badge-error-text)"};default:return{backgroundColor:"var(--color-badge-default)",color:"var(--color-badge-default-text)"}}})();return e.jsx("span",{className:`inline-flex items-center ${a[r]} font-medium rounded-full ${s}`,style:l,children:i})},ps=({children:i,variant:t="info",className:r="",onClose:s})=>{const n=(()=>{switch(t){case"success":return{backgroundColor:"var(--color-alert-success-bg)",borderColor:"var(--color-alert-success-border)",color:"var(--color-alert-success-text)"};case"warning":return{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)",color:"var(--color-alert-warning-text)"};case"error":return{backgroundColor:"var(--color-alert-error-bg)",borderColor:"var(--color-alert-error-border)",color:"var(--color-alert-error-text)"};default:return{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)",color:"var(--color-alert-info-text)"}}})();return e.jsx("div",{className:`p-4 rounded-lg border ${r}`,style:{backgroundColor:n.backgroundColor,borderColor:n.borderColor,color:n.color},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex-1",children:i}),s&&e.jsx("button",{onClick:s,className:"ml-3 text-lg leading-none opacity-60 hover:opacity-100 transition-opacity",style:{color:n.color},children:"×"})]})})},Me=({variant:i="primary",size:t="md",fullWidth:r=!1,className:s="",children:a,style:n,onMouseEnter:l,onMouseLeave:c,...m})=>{const d={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},x=(S=>{switch(S){case"primary":return{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)",hoverColor:"var(--color-primary-hover)"};case"secondary":return{backgroundColor:"var(--color-secondary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-secondary)",hoverColor:"var(--color-secondary-hover)"};case"accent":return{backgroundColor:"var(--color-accent)",color:"var(--color-text-inverse)",border:"1px solid var(--color-accent)",hoverColor:"var(--color-accent-hover)"};case"ghost":return{backgroundColor:"var(--color-btn-ghost)",color:"var(--color-text)",border:"1px solid transparent",hoverColor:"var(--color-btn-ghost-hover)"};case"outline":return{backgroundColor:"var(--color-btn-outline)",color:"var(--color-text)",border:"1px solid var(--color-btn-outline-border)",hoverColor:"var(--color-btn-outline-hover)"};case"danger":return{backgroundColor:"var(--color-error)",color:"var(--color-text-inverse)",border:"1px solid var(--color-error)",hoverColor:"var(--color-error)"};default:return{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)",hoverColor:"var(--color-primary-hover)"}}})(i),b=S=>{S.currentTarget.style.backgroundColor=x.hoverColor,i==="danger"&&(S.currentTarget.style.opacity="0.9"),l?.(S)},f=S=>{S.currentTarget.style.backgroundColor=x.backgroundColor,S.currentTarget.style.opacity="1",c?.(S)};return e.jsx("button",{className:`${d[t]} font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 ${r?"w-full":""} ${s}`,style:{backgroundColor:x.backgroundColor,color:x.color,border:x.border,boxShadow:i!=="ghost"&&i!=="outline"?"var(--shadow-sm)":"none",focusRingColor:"var(--color-primary)",...n},onMouseEnter:b,onMouseLeave:f,...m,children:a})},dr=({role:i,skipData:t=[]}={})=>{const{user:r}=ye(),{organization:s,categories:a,loading:n}=Fe(),[l,c]=p.useState({organization:null,categories:[],user:null,employees:[],followUps:[],permissions:{},warnings:[],reports:[],teams:[],metrics:{},loading:{overall:!0,employees:!1,followUps:!1,permissions:!1,warnings:!1,reports:!1,teams:!1,metrics:!1},error:null}),m=p.useRef(!1),d=p.useRef(null),u=p.useCallback(f=>{const S={core:["organization","categories","permissions"],hod:["employees","followUps"],hr:["employees","followUps","warnings","reports","metrics"],business_owner:["employees","teams","reports","metrics"],super_admin:["employees","warnings","reports","metrics","teams"]};return[...S.core,...S[f]||[]].filter(C=>!t.includes(C))},[t]),x=p.useCallback(async()=>{if(!s?.id||!r?.id||n||m.current)return;const f=`${s.id}-${r.id}-${i||r.role}`;if(d.current!==f){m.current=!0;try{const S=i||r.role||"hod",C=u(S);o.debug(`🚀 [DashboardData] Progressive loading for role: ${S}`,C),c(h=>({...h,organization:s,categories:a||[],user:r,loading:{...h.loading,overall:!1,employees:C.includes("employees"),followUps:C.includes("followUps"),permissions:C.includes("permissions"),warnings:C.includes("warnings"),reports:C.includes("reports"),teams:C.includes("teams"),metrics:C.includes("metrics")},error:null}));const w=Date.now(),g=(h,D)=>{c(v=>({...v,[h]:D,loading:{...v.loading,[h]:!1}}))};if(C.includes("permissions")&&X.getOrFetch(`permissions:${r.id}:${s.id}`,()=>Promise.resolve({})).then(h=>g("permissions",h||{})).catch(h=>{o.error("❌ Failed to load permissions:",h),g("permissions",{})}),C.includes("employees")){const h=S==="hr"||S==="business_owner",D=h?X.generateOrgKey(s.id,"employees:all"):X.generateOrgKey(s.id,`employees:manager:${r.id}`);X.getOrFetch(D,async()=>{const v=h?await pe.employees.getAll(s.id):await pe.employees.getByManager(r.id,s.id);return o.debug(`👥 Loading ${v.length} employees for ${S}`),v}).then(v=>g("employees",Array.isArray(v)?v:[])).catch(v=>{o.error("❌ Failed to load employees:",v),g("employees",[])})}C.includes("followUps")&&X.getOrFetch(`followups:${r.id}:${s.id}`,()=>Promise.resolve([])).then(h=>g("followUps",Array.isArray(h)?h:[])).catch(h=>{o.error("❌ Failed to load followUps:",h),g("followUps",[])}),C.includes("warnings")&&X.getOrFetch(X.generateOrgKey(s.id,"warnings"),()=>pe.warnings.getAll(s.id)).then(h=>g("warnings",Array.isArray(h)?h:[])).catch(h=>{o.error("❌ Failed to load warnings:",h),g("warnings",[])}),C.includes("reports")&&X.getOrFetch(X.generateOrgKey(s.id,"reports"),()=>pe.reports.getAll(s.id)).then(h=>g("reports",Array.isArray(h)?h:[])).catch(h=>{o.error("❌ Failed to load reports:",h),g("reports",[])}),C.includes("teams")&&X.getOrFetch(X.generateOrgKey(s.id,"teams"),()=>ee.getAllEmployees(s.id)).then(h=>g("teams",Array.isArray(h)?h:[])).catch(h=>{o.error("❌ Failed to load teams:",h),g("teams",[])}),C.includes("metrics")&&X.getOrFetch(X.generateOrgKey(s.id,"metrics"),()=>pe.analytics.getDashboardMetrics(s.id)).then(h=>g("metrics",h||{})).catch(h=>{o.error("❌ Failed to load metrics:",h),g("metrics",{})}),d.current=f,o.debug(`✅ [DashboardData] Progressive loading initiated for role: ${S} (${Date.now()-w}ms)`)}catch(S){o.error("❌ [DashboardData] Failed to initialize progressive loading:",S),c(C=>({...C,loading:{overall:!1,employees:!1,followUps:!1,permissions:!1,warnings:!1,reports:!1,teams:!1,metrics:!1},error:S instanceof Error?S.message:"Failed to load dashboard data"}))}finally{m.current=!1}}},[s,r,a,n,i,u]),b=p.useCallback(()=>{d.current=null,X.clearByPrefix(`org:${s?.id}:`),x()},[s?.id,x]);return p.useEffect(()=>{s?.id&&r?.id&&!n&&a!==null&&x()},[s?.id,r?.id,n,a,x]),{...l,refreshData:b,isReady:!l.loading.overall&&!!s&&!!r}},xs=(i,t)=>{const[r,s]=p.useState([]),[a,n]=p.useState([]),[l,c]=p.useState(!0),[m,d]=p.useState(!1),[u,x]=p.useState(null),[b,f]=p.useState({hasMore:!0,currentPage:0,pageSize:50}),S=async(h=!0)=>{if(i)try{if(h?(c(!0),s([]),f(A=>({...A,currentPage:0,lastId:void 0}))):d(!0),x(null),t){const A=await pe.employees.getByManager(t,i);s(A),n(A),f(T=>({...T,hasMore:!1}));return}const D=await pe.employees.getAll(i),v=!1,k=void 0;h?(s(D),n(D)):(s(A=>[...A,...D]),n(A=>[...A,...D])),f(A=>({...A,hasMore:v,lastId:k,currentPage:h?1:A.currentPage+1}))}catch(D){x("Failed to load employees"),o.error("Error loading employees:",D)}finally{c(!1),d(!1)}},C=async()=>{!b.hasMore||m||await S(!1)},w=async(h,D)=>{if(i)try{await pe.employees.delete(h.id,i),await S()}catch(v){throw x("Failed to archive employee"),o.error("Archive error:",v),v}},g=async h=>{if(i)try{await pe.employees.update(h.id,i,h),await S()}catch(D){throw x("Failed to update employee"),D}};return p.useEffect(()=>{S()},[i]),{employees:r,allEmployees:a,loading:l,loadingMore:m,error:u,loadEmployees:S,loadMoreEmployees:C,archiveEmployee:w,updateEmployee:g,pagination:{hasMore:b.hasMore,currentPage:b.currentPage,pageSize:b.pageSize,canLoadMore:b.hasMore&&!l&&!m}}},fs=()=>{const i=Date.now(),t=Math.random().toString(36).substr(2,9);return`emp_${i}_${t}`},ys=i=>{const t=i.toUpperCase().substring(0,3),r=Date.now().toString().slice(-6),s=Math.floor(Math.random()*99).toString().padStart(2,"0");return`${t}${r}${s}`},mr=(i,t)=>{const r=new Date;return{id:fs(),organizationId:t,isActive:i.isActive,createdAt:r.toISOString(),updatedAt:r.toISOString(),profile:{employeeNumber:i.employeeNumber,firstName:i.firstName,lastName:i.lastName,email:i.email.toLowerCase(),phoneNumber:i.phoneNumber||null,whatsappNumber:i.whatsappNumber||null,department:i.department,position:i.position,startDate:new Date(i.startDate)},employment:{startDate:new Date(i.startDate),contractType:i.contractType,probationEndDate:i.probationEndDate?new Date(i.probationEndDate):null,department:i.department,position:i.position,managerId:i.managerId||null},disciplinaryRecord:{totalWarnings:0,activeWarnings:0,currentLevel:"none",warningHistory:[],warningsByCategory:{}},deliveryPreferences:{primaryMethod:"email",allowAlternativeMethods:!0,whatsappConsent:!1,emailConsent:!0,printConsent:!1,lastUpdated:r}}},qt=i=>{if(!i)return"";try{if(i&&typeof i.toDate=="function")return i.toDate().toISOString().split("T")[0];if(i instanceof Date)return i.toISOString().split("T")[0];if(typeof i=="string"){const t=new Date(i);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}if(typeof i=="number"){const t=new Date(i);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}return""}catch(t){return console.warn("Failed to convert date:",i,t),""}},bs=i=>({employeeNumber:i.profile?.employeeNumber||"",firstName:i.profile?.firstName||"",lastName:i.profile?.lastName||"",email:i.profile?.email||"",phoneNumber:i.profile?.phoneNumber||"",whatsappNumber:i.profile?.whatsappNumber||"",department:i.profile?.department||"",position:i.profile?.position||"",startDate:qt(i.profile?.startDate),contractType:i.employment?.contractType||"permanent",probationEndDate:qt(i.employment?.probationEndDate),managerId:i.employment?.managerId||"",isActive:i.isActive??!0}),Ct=(i,t)=>{if(!i)return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1};switch(i){case"super-user":return{canCreate:!0,canEdit:!0,canArchive:!0,canRestore:!0,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!0,canExport:!0};case"business-owner":return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!1,canExport:!0};case"hr-manager":return{canCreate:!0,canEdit:!0,canArchive:!0,canRestore:!0,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!0,canExport:!0};case"hod-manager":case"hod":return{canCreate:!0,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:t||[],canViewContactInfo:!0,canBulkImport:!1,canExport:!1};default:return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1}}},vs=(i,t,r,s,a)=>i.filter(n=>{if(!n)return!1;if(s==="hod-manager"&&!n.profile&&console.warn("🔍 [FILTER DEBUG] Employee missing profile:",{id:n.id,hasEmployment:!!n.employment,managerId:n.employment?.managerId,currentUserId:a}),!r.canViewAll&&(s==="hod"||s==="hod-manager")){const l=n.employment?.managerId;if(l&&l!==a)return!1}else if(!r.canViewAll&&r.canViewDepartments.length>0){const l=n.profile?.department;if(!l||!r.canViewDepartments.includes(l))return!1}if(t.isActive&&!n.isActive||!t.isActive&&!n.isActive&&!r.canViewArchived)return!1;if(t.search){const l=t.search.toLowerCase();if(!((n.profile?.firstName?.toLowerCase()||"").includes(l)||(n.profile?.lastName?.toLowerCase()||"").includes(l)||(n.profile?.employeeNumber?.toLowerCase()||"").includes(l)||(n.profile?.email?.toLowerCase()||"").includes(l)))return!1}return!(t.department&&n.profile?.department!==t.department||t.contractType&&n.employment?.contractType!==t.contractType||t.hasWarnings&&(!n.disciplinaryRecord||n.disciplinaryRecord.activeWarnings===0))}),ws=i=>{const t={total:i.length,active:0,inactive:0,onProbation:0,withActiveWarnings:0,onProbationWithWarnings:0,departments:[],contractTypes:[]},r={},s={};return i.forEach(a=>{if(a.isActive?t.active++:t.inactive++,a.isActive){const c=a.employment?.probationEndDate&&new Date(a.employment.probationEndDate)>new Date,m=a.disciplinaryRecord?.activeWarnings>0;c&&t.onProbation++,m&&t.withActiveWarnings++,c&&m&&t.onProbationWithWarnings++}const n=a.profile?.department||"Unknown";r[n]=(r[n]||0)+1;const l=a.employment?.contractType||"Unknown";s[l]=(s[l]||0)+1}),t.departments=Object.entries(r).map(([a,n])=>({name:a,count:n})).sort((a,n)=>n.count-a.count),t.contractTypes=Object.entries(s).map(([a,n])=>({type:a,count:n})).sort((a,n)=>n.count-a.count),t},Ns=()=>{const i=["employeeNumber","firstName","lastName","email","phoneNumber","whatsappNumber","department","position","startDate","contractType","probationEndDate"],t=[["EMP001","John","Doe","john.doe@company.com","+27123456789","+27123456789","Engineering","Software Developer","2024-01-15","permanent",""],["EMP002","Sarah","Johnson","sarah.johnson@company.com","+27987654321","+27987654321","Human Resources","HR Manager","2023-06-01","permanent",""],["EMP003","Michael","Smith","michael.smith@company.com","+27555123456","","Operations","Operations Coordinator","2024-11-01","contract","2025-02-01"]];return[i.join(","),...t.map(s=>s.join(","))].join(`
`)},ur=(i,t)=>{const[r,s]=p.useState({search:"",department:"",contractType:"",hasWarnings:!1,isActive:!0}),a=p.useMemo(()=>Ct(t?.role.id,t?.departmentIds),[t]),n=p.useMemo(()=>vs(i,r,a,t?.role?.id,t?.id),[i,r,a,t?.role?.id,t?.id]);return{filters:r,setFilters:s,filteredEmployees:n}},js=({employees:i})=>{const t=ws(i),r=[{value:t.total,label:"Total Employees",color:"blue",icon:"👥"},{value:t.active,label:"Active",color:"green",icon:"✅"},{value:t.onProbationWithWarnings,label:"On Probation, With Warnings",color:"red",icon:"⚠️"}];return e.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:r.map((s,a)=>e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-2 sm:p-3 text-center shadow-md hover:shadow-lg transition-all duration-200",children:[e.jsx("div",{className:"text-lg sm:text-xl mb-0.5 sm:mb-1",children:s.icon}),e.jsx("div",{className:`text-lg sm:text-xl font-bold text-${s.color}-600 mb-0.5 sm:mb-1`,children:s.value}),e.jsx("div",{className:"text-xs text-gray-600 font-medium leading-tight",children:s.label})]},a))})},Ds=({filters:i,setFilters:t,departments:r,viewMode:s,setViewMode:a})=>e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl p-6 mb-8 shadow-xl",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"🔍 Search employees by name, number, or email...",value:i.search,onChange:n=>t({...i,search:n.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"})}),e.jsxs("select",{value:i.department,onChange:n=>t({...i,department:n.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Departments"}),r.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsxs("select",{value:i.contractType,onChange:n=>t({...i,contractType:n.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Contract Types"}),e.jsx("option",{value:"permanent",children:"Permanent"}),e.jsx("option",{value:"contract",children:"Contract"}),e.jsx("option",{value:"temporary",children:"Temporary"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:i.hasWarnings,onChange:n=>t({...i,hasWarnings:n.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Has Warnings"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:i.isActive,onChange:n=>t({...i,isActive:n.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Active Only"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("table"),className:`px-4 py-3 rounded-xl font-medium transition-all ${s==="table"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"📋 Table"}),e.jsx("button",{onClick:()=>a("cards"),className:`px-4 py-3 rounded-xl font-medium transition-all ${s==="cards"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"📱 Cards"})]})]})})}),As=({employee:i,permissions:t,onEdit:r,onArchive:s})=>{const n=(()=>{if(!i.employment.probationEndDate)return null;const l=new Date(i.employment.probationEndDate),c=new Date,m=Math.ceil((l.getTime()-c.getTime())/(1e3*60*60*24));return m<=0?null:{daysLeft:m,status:m<=7?"critical":m<=30?"warning":"normal"}})();return e.jsxs("div",{className:`
      bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-lg hover:shadow-xl 
      transform hover:-translate-y-1 transition-all duration-200 cursor-pointer
      ${i.isActive?"":"opacity-75"}
    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-1",children:[i.profile.firstName," ",i.profile.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",i.profile.employeeNumber]})]}),e.jsx("span",{className:`
          inline-flex px-3 py-1 text-xs font-semibold rounded-full
          ${i.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}
        `,children:i.isActive?"Active":"Archived"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"🏢"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:i.profile.department}),e.jsx("span",{className:"text-gray-500",children:" • "}),e.jsx("span",{className:"text-gray-600",children:i.profile.position})]})]}),t.canViewContactInfo&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"📧"}),e.jsx("span",{className:"text-gray-600 truncate",children:i.profile.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"📋"}),e.jsx("span",{className:"text-gray-600",children:"Contract:"}),e.jsx("span",{className:`
            inline-flex px-2 py-0.5 text-xs font-semibold rounded-full capitalize
            ${i.employment.contractType==="permanent"?"bg-green-100 text-green-800":i.employment.contractType==="contract"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}
          `,children:i.employment.contractType})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"⚠️"}),e.jsx("span",{className:"text-gray-600",children:"Active Warnings:"}),e.jsx("span",{className:`
            inline-flex px-2 py-0.5 text-xs font-bold rounded-full
            ${i.disciplinaryRecord.activeWarnings===0?"bg-green-100 text-green-800":i.disciplinaryRecord.activeWarnings<3?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}
          `,children:i.disciplinaryRecord.activeWarnings})]}),n&&i.isActive&&e.jsxs("div",{className:`
            flex items-center gap-2 text-sm p-2 rounded-lg
            ${n.status==="critical"?"bg-red-50":n.status==="warning"?"bg-yellow-50":"bg-blue-50"}
          `,children:[e.jsx("span",{className:"text-lg",children:"⏳"}),e.jsxs("span",{className:`
              font-medium
              ${n.status==="critical"?"text-red-700":n.status==="warning"?"text-yellow-700":"text-blue-700"}
            `,children:["Probation ends in ",n.daysLeft," days"]})]})]}),t.canEdit&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>r(i),className:"flex-1 py-2 px-4 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 font-medium transition-colors",children:"✏️ Edit"}),i.isActive&&t.canArchive&&e.jsx("button",{onClick:()=>s(i),className:"flex-1 py-2 px-4 bg-amber-50 text-amber-600 rounded-lg hover:bg-amber-100 font-medium transition-colors",children:"📁 Archive"}),!i.isActive&&t.canRestore&&e.jsx("button",{onClick:()=>r(i),className:"flex-1 py-2 px-4 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 font-medium transition-colors",children:"♻️ Restore"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Started: ",(()=>{const l=i.profile?.startDate||i.employment?.startDate;if(!l)return"Not set";try{if(l&&typeof l.toDate=="function")return l.toDate().toLocaleDateString();if(l instanceof Date)return l.toLocaleDateString();const c=new Date(l);return isNaN(c.getTime())?"Invalid date":c.toLocaleDateString()}catch{return"Invalid date"}})()]}),i.disciplinaryRecord.lastWarningDate&&e.jsxs("span",{children:["Last warning: ",new Date(i.disciplinaryRecord.lastWarningDate).toLocaleDateString()]})]})]})},Es=i=>typeof i=="string"?i:i?.id||"",gr=({employee:i,onClose:t,onSave:r,basicMode:s=!1})=>{const{organization:a,user:n}=ye(),[l,c]=p.useState({employeeNumber:"",firstName:"",lastName:"",email:"",phoneNumber:"",whatsappNumber:"",department:"",position:"",startDate:"",contractType:"permanent",probationEndDate:"",managerId:""}),[m,d]=p.useState(null),[u,x]=p.useState(!1),[b,f]=p.useState([]),[S,C]=p.useState(!1);p.useEffect(()=>{const g=window.getComputedStyle(document.body).overflow;return window.scrollTo({top:0,behavior:"smooth"}),document.body.style.overflow="hidden",()=>{document.body.style.overflow=g}},[]),p.useEffect(()=>{(async()=>{if(a)try{C(!0);const v=(await Y.queryDocuments(a.id,"users",[])).documents.filter(k=>{const A=Es(k.role);return A==="hod-manager"||A==="hr-manager"||A==="business-owner"});f(v)}catch(h){o.error("Failed to load managers:",h)}finally{C(!1)}})()},[a]),p.useEffect(()=>{if(i){const g=bs(i);c(g)}else if(s&&a){const g=new Date().toISOString().split("T")[0];c(h=>({...h,employeeNumber:ys(a.id),department:n?.departmentIds?.[0]||n?.profile?.department||"Operations",startDate:g,managerId:n?.id,isActive:!0}))}},[i,s,a,n]);const w=async g=>{if(g.preventDefault(),!!a){x(!0),d(null);try{if(i){const h={...i,profile:{...i.profile,employeeNumber:l.employeeNumber,firstName:l.firstName,lastName:l.lastName,email:l.email,phoneNumber:l.phoneNumber||null,whatsappNumber:l.whatsappNumber||null,department:l.department,position:l.position,startDate:l.startDate?new Date(l.startDate):new Date},employment:{...i.employment,contractType:l.contractType,...l.managerId&&{managerId:l.managerId},...l.probationEndDate&&{probationEndDate:new Date(l.probationEndDate)}},isActive:i.isActive,updatedAt:new Date};await pe.employees.update(i.id,a.id,h),o.debug(`✅ Updated employee: ${i.id}`)}else{const h=mr(l,a.id),{id:D,...v}=h,k=await pe.employees.create(v);o.debug(`✅ Created new employee: ${k}`)}r()}catch(h){o.error("Error saving employee:",h),d(h.message||"Failed to save employee")}finally{x(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:g=>{g.target===g.currentTarget&&t()},children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:i?"Edit Employee":s?"Quick Add Employee":"Add New Employee"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:s?"Basic details only - HR can complete the full profile later":"Fill in the employee details below"})]}),e.jsx("button",{type:"button",onClick:t,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(_e,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w,className:"flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"overflow-y-auto flex-1 p-6 space-y-6",children:[m&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-800 text-sm",children:m})}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-blue-600"}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Employee Number *"}),e.jsx("input",{type:"text",required:!0,value:l.employeeNumber,onChange:g=>c({...l,employeeNumber:g.target.value}),className:`w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none ${s?"bg-slate-50":""}`,placeholder:"EMP001",readOnly:s,title:s?"Auto-generated - HR can change this later":""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Start Date *"}),e.jsx("input",{type:"date",required:!0,value:l.startDate,onChange:g=>c({...l,startDate:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",required:!0,value:l.firstName,onChange:g=>c({...l,firstName:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",required:!0,value:l.lastName,onChange:g=>c({...l,lastName:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Address *"}),e.jsx("input",{type:"email",required:!0,value:l.email,onChange:g=>c({...l,email:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"john.doe@company.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Phone Number ",s?"(Optional)":""]}),e.jsx("input",{type:"tel",value:l.phoneNumber,onChange:g=>c({...l,phoneNumber:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})]})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(lt,{className:"w-5 h-5 text-emerald-600"}),"Work Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department *"}),e.jsx("input",{type:"text",required:!0,value:l.department,onChange:g=>c({...l,department:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Human Resources"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Position *"}),e.jsx("input",{type:"text",required:!0,value:l.position,onChange:g=>c({...l,position:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"HR Manager"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Contract Type *"}),e.jsxs("select",{required:!0,value:l.contractType,onChange:g=>c({...l,contractType:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"permanent",children:"Permanent"}),e.jsx("option",{value:"contract",children:"Contract"}),e.jsx("option",{value:"temporary",children:"Temporary"}),e.jsx("option",{value:"intern",children:"Intern"})]})]}),!s&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Manager"}),e.jsxs("select",{value:l.managerId,onChange:g=>c({...l,managerId:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",disabled:S,children:[e.jsx("option",{value:"",children:"No Manager"}),b.map(g=>e.jsxs("option",{value:g.id,children:[g.firstName," ",g.lastName," (",typeof g.role=="string"?g.role:g.role?.name,")"]},g.id))]}),S&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading managers..."})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Probation End Date (Optional)"}),e.jsx("input",{type:"date",value:l.probationEndDate,onChange:g=>c({...l,probationEndDate:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Leave empty if no probation period"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Typical probation periods are 3-6 months for new hires"})]})]})]}),!s&&e.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(rr,{className:"w-5 h-5 text-amber-600"}),"Communication Preferences"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"WhatsApp Number"}),e.jsx("input",{type:"tel",value:l.whatsappNumber,onChange:g=>c({...l,whatsappNumber:g.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-200 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"w-4 h-4"}),i?"Update Employee":"Add Employee"]})})]})]})]})})},Ss=()=>{const[i,t]=p.useState(null),[r,s]=p.useState([]),[a,n]=p.useState(null),[l,c]=p.useState(!1),[m,d]=p.useState(0),[u,x]=p.useState(""),b=w=>{const g=[];let h="",D=!1;for(let v=0;v<w.length;v++){const k=w[v];k==='"'?D&&w[v+1]==='"'?(h+='"',v++):D=!D:k===","&&!D?(g.push(h),h=""):h+=k}return g.push(h),g};return{csvFile:i,csvData:r,importResult:a,isImporting:l,importProgress:m,currentImportStep:u,handleFileUpload:w=>{t(w);const g=new FileReader;g.onload=h=>{const D=h.target?.result;try{const v=D.trim().split(`
`).map(N=>N.trim()).filter(N=>N.length>0);if(v.length===0){s([]);return}const k=v[0].split(",").map(N=>N.trim().replace(/"/g,"")),A=[],T=[];for(let N=1;N<v.length;N++){const _=N+1,G=v[N];try{const q=b(G);if(q.length!==k.length){T.push(`Row ${_}: Field count mismatch`);continue}const L={};if(k.forEach((Q,ge)=>{L[Q]=q[ge]?.trim().replace(/"/g,"")||""}),!L.firstName||!L.lastName||!L.email){T.push(`Row ${_}: Missing required fields (firstName, lastName, email)`);continue}const E={employeeNumber:L.employeeNumber||"",firstName:L.firstName,lastName:L.lastName,email:L.email.toLowerCase(),phoneNumber:L.phoneNumber||"",whatsappNumber:L.whatsappNumber||"",department:L.department||"",position:L.position||"",startDate:L.startDate||"",contractType:L.contractType?.toLowerCase()||"permanent"};A.push(E)}catch{T.push(`Row ${_}: Parse error`)}}s(A),T.length>0&&o.warn("CSV Import Warnings:",T)}catch(v){o.error("CSV parsing failed:",v),s([])}},g.readAsText(w)},handleImport:async w=>{if(!r.length)return{success:!1,imported:0,failed:0,errors:[{row:1,field:"file",message:"No data to import"}]};c(!0),d(0),x("Validating employee data...");const g=[],h=[];try{for(let A=0;A<r.length;A++){const T=r[A],N=A+2,_=Math.round(A/r.length*30);d(_),x(`Validating employee ${A+1} of ${r.length}: ${T.firstName} ${T.lastName}...`);try{let G=T.employeeNumber;(!G||G.trim()==="")&&(G=await pe.employees.generateNextEmployeeNumber(w));const q=await pe.employees.validateEmployeeNumber(w,G);if(!q.isAvailable){g.push({row:N,field:"employeeNumber",message:`Employee number "${G}" is already in use${q.suggestions?`. Suggestions: ${q.suggestions.slice(0,3).join(", ")}`:""}`});continue}const L={employeeNumber:G,firstName:T.firstName,lastName:T.lastName,email:T.email,phoneNumber:T.phoneNumber||"",whatsappNumber:T.whatsappNumber||"",department:T.department,position:T.position,startDate:T.startDate,contractType:T.contractType||"permanent",isActive:!0},E=mr(L,w),{id:Q,...ge}=E;h.push(ge)}catch(G){g.push({row:N,field:"validation",message:G instanceof Error?G.message:"Validation error"})}}let D=0,v=g.length;if(d(30),x("Validation complete. Starting employee creation..."),h.length>0)try{o.debug(`🚀 Attempting to import ${h.length} employees with rate limiting...`);for(let A=0;A<h.length;A++){const T=30+Math.round(A/h.length*60);d(T);const N=h[A];x(`Creating employee ${A+1} of ${h.length}: ${N.profile?.firstName} ${N.profile?.lastName}...`);let _=0;const G=3;let q=!1;for(;!q&&_<G;)try{A>0&&await new Promise(L=>setTimeout(L,500)),await pe.employees.create(h[A]),D++,q=!0,x(`✅ Created: ${N.profile?.firstName} ${N.profile?.lastName}`),await new Promise(L=>setTimeout(L,200))}catch(L){_++;const E=L instanceof Error?L.message:"Unknown error";_<G&&E.includes("permissions")?(o.warn(`⚠️ Retry ${_}/${G} for employee ${A+1}: ${E}`),x(`⚠️ Retrying ${N.profile?.firstName} ${N.profile?.lastName} (${_}/${G})...`),await new Promise(Q=>setTimeout(Q,1e3*_))):(o.error(`❌ Failed to create employee ${A+1} after ${_} attempts:`,L),v++,g.push({row:A+2,field:"individual_create",message:`${E} (after ${_} retries)`}),q=!0)}}d(90),x("Finalizing import..."),await new Promise(A=>setTimeout(A,500)),o.success(10447)}catch(A){o.error("❌ Import process failed:",A),v+=h.length-D}const k={success:v===0,imported:D,failed:v,errors:g};return n(k),d(100),x("Import completed!"),k}finally{c(!1)}},resetImport:()=>{t(null),s([]),n(null),d(0),x("")}}},hr=({onClose:i,onImportComplete:t})=>{const{organization:r}=ye(),{csvData:s,importResult:a,isImporting:n,importProgress:l,currentImportStep:c,handleFileUpload:m,handleImport:d,resetImport:u}=Ss(),[x,b]=p.useState("upload"),f=()=>{const g=Ns(),h=new Blob([g],{type:"text/csv"}),D=window.URL.createObjectURL(h),v=document.createElement("a");v.href=D,v.download="employee_import_template.csv",v.click(),window.URL.revokeObjectURL(D)},S=g=>{const h=g.target.files?.[0];h&&(m(h),b("preview"))},C=async()=>{if(!r)return;b("importing");const g=await d(r.id);b("result"),g.success&&g.failed===0&&setTimeout(()=>{t(),i()},2e3)},w=()=>{u(),i()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-hidden shadow-xl",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg",children:"📊"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Import Employees from CSV"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Bulk import multiple employees"})]})]}),!n&&e.jsx("button",{onClick:w,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4",children:[x==="upload"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsxs("h3",{className:"text-xs font-semibold text-blue-900 mb-1.5 flex items-center gap-1",children:[e.jsx("span",{children:"📋"})," Import Instructions"]}),e.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 text-xs text-blue-800",children:[e.jsx("li",{children:"Download the CSV template below"}),e.jsx("li",{children:"Fill in employee information following the template format"}),e.jsx("li",{children:"Save the file as CSV (comma-separated values)"}),e.jsx("li",{children:"Upload the completed file using the form below"})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:f,className:"inline-flex items-center gap-1.5 px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV Template"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{type:"file",accept:".csv",onChange:S,className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[e.jsx("div",{className:"text-4xl mb-2",children:"📁"}),e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Click to upload CSV file"}),e.jsx("p",{className:"text-xs text-gray-500",children:"or drag and drop your file here"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2",children:"Sample CSV Format:"}),e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:[e.jsx("strong",{children:"💡 Tip:"})," Leave employeeNumber empty to auto-generate next available number"]}),e.jsx("pre",{className:"text-[10px] bg-white p-2 rounded border overflow-x-auto leading-relaxed",children:`employeeNumber,firstName,lastName,email,phoneNumber,whatsappNumber,department,position,startDate,contractType,preferredDeliveryMethod
EMP001,John,Doe,john.doe@company.com,+27123456789,+27123456789,Engineering,Software Developer,2024-01-15,permanent,email
,Jane,Smith,jane.smith@company.com,+27987654321,+27987654321,Human Resources,HR Manager,2023-06-01,permanent,whatsapp`}),e.jsx("p",{className:"text-[10px] text-gray-600 mt-1.5",children:"Notice: Jane Smith has an empty employee number - the system will auto-generate one"})]})]}),x==="preview"&&s.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2.5",children:e.jsxs("p",{className:"text-xs text-green-800",children:["✅ Found ",e.jsx("strong",{children:s.length})," employees ready to import"]})}),e.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Employee #"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Department"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Position"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Start Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:s.slice(0,10).map((g,h)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2",children:g.employeeNumber}),e.jsxs("td",{className:"px-3 py-2",children:[g.firstName," ",g.lastName]}),e.jsx("td",{className:"px-3 py-2",children:g.email}),e.jsx("td",{className:"px-3 py-2",children:g.department}),e.jsx("td",{className:"px-3 py-2",children:g.position}),e.jsx("td",{className:"px-3 py-2",children:g.startDate})]},h))})]})}),s.length>10&&e.jsxs("p",{className:"text-center text-gray-500 text-xs",children:["... and ",s.length-10," more employees"]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{b("upload"),u()},className:"px-3 py-1.5 text-xs border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Upload Different File"}),e.jsxs("button",{onClick:C,className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded-md hover:bg-green-700 font-medium",children:["Import ",s.length," Employees"]})]})]}),x==="importing"&&e.jsxs("div",{className:"space-y-3 text-center",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-4xl mb-3",children:"⚡"}),e.jsx("h3",{className:"text-sm font-bold text-blue-900 mb-1",children:"Importing Employees"}),e.jsx("p",{className:"text-xs text-blue-700 mb-3",children:"Please wait while we create your employees..."}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 mb-3",children:e.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${l}%`}})}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[l,"% Complete"]}),e.jsx("p",{className:"text-xs text-blue-600 min-h-[1rem]",children:c})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500 space-y-0.5",children:[e.jsx("p",{children:"⏱️ This may take a few moments depending on the number of employees"}),e.jsx("p",{children:"🔄 Please don't close this window during the import process"})]})]}),x==="result"&&a&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:`border rounded-lg p-4 ${a.success&&a.failed===0?"bg-green-50 border-green-200":a.imported>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-2",children:a.success&&a.failed===0?"✅":a.imported>0?"⚠️":"❌"}),e.jsx("h3",{className:"text-sm font-bold mb-2",children:a.success&&a.failed===0?"Import Successful!":a.imported>0?"Partial Import Complete":"Import Failed"}),e.jsxs("div",{className:"space-y-0.5 text-xs",children:[e.jsxs("p",{className:"text-green-700",children:["✅ Successfully imported: ",e.jsx("strong",{children:a.imported})," employees"]}),a.failed>0&&e.jsxs("p",{className:"text-red-700",children:["❌ Failed to import: ",e.jsx("strong",{children:a.failed})," employees"]})]})]})}),a.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[e.jsx("h4",{className:"text-xs font-semibold text-red-900 mb-1.5",children:"Import Errors:"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:a.errors.map((g,h)=>e.jsxs("div",{className:"text-xs text-red-700",children:[e.jsxs("strong",{children:["Row ",g.row,":"]})," ",g.message]},h))})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:w,className:"px-4 py-2 text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 font-medium",children:"Close"})})]})]})]})})},pr=({employee:i,onClose:t,onArchive:r})=>{const[s,a]=p.useState(""),[n,l]=p.useState(!1),c=async()=>{if(console.log("🔍 DEBUGGING - Archive Modal Data:",{employee:i,employeeId:i?.id,employeeIdType:typeof i?.id,employeeIdLength:i?.id?.length,employeeName:`${i?.profile?.firstName} ${i?.profile?.lastName}`,reason:s,hasValidId:i?.id&&i.id.trim().length>0}),!i||!i.id||i.id.trim().length===0){o.error("🚨 CRITICAL ERROR: Invalid employee or missing employee ID"),alert("Error: Invalid employee data. Cannot archive.");return}l(!0);try{o.debug("🔍 Calling onArchive with employee and reason..."),await r(i,s.trim()||void 0),o.success(1682),t()}catch(m){o.error("❌ Archive operation failed:",m),alert(`Failed to archive employee: ${m instanceof Error?m.message:"Unknown error"}`)}finally{l(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-600 mb-4",children:"⚠️ Archive Employee"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Are you sure you want to archive ",e.jsxs("strong",{children:[i.profile.firstName," ",i.profile.lastName]}),"?"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs",children:e.jsxs("p",{className:"text-blue-800",children:[e.jsx("strong",{children:"Debug Info:"})," Employee ID: ",i.id||"MISSING ID!"]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Note:"})," Archiving an employee will:"]}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-amber-800",children:[e.jsx("li",{children:"• Mark their record as inactive"}),e.jsx("li",{children:"• Preserve all historical data"}),e.jsx("li",{children:"• Remove them from active employee lists"}),e.jsx("li",{children:"• Maintain compliance with HR regulations"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for archiving (optional)"}),e.jsx("textarea",{value:s,onChange:m=>a(m.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none",rows:3,placeholder:"e.g., Resignation, End of contract, etc."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:c,disabled:n||!i?.id,className:"flex-1 py-3 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Archiving...":"Yes, Archive"}),e.jsx("button",{onClick:t,disabled:n,className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})]})})})},Cs=({isOpen:i,onClose:t,employee:r,organizationId:s,onSuccess:a})=>{const[n,l]=p.useState("hod-manager"),[c,m]=p.useState([]),[d,u]=p.useState([]),[x,b]=p.useState(!1),[f,S]=p.useState(!1),[C,w]=p.useState(null),[g,h]=p.useState(r.profile?.email||r.email||""),[D,v]=p.useState(""),[k,A]=p.useState("");if(p.useEffect(()=>{if(i){const N=window.getComputedStyle(document.body).overflow;return window.scrollTo({top:0,behavior:"smooth"}),document.body.style.overflow="hidden",()=>{document.body.style.overflow=N}}},[i]),p.useEffect(()=>{i&&s&&(async()=>{try{b(!0);const _=await Oe.getDepartments(s);u(_)}catch(_){console.error("Failed to load departments:",_)}finally{b(!1)}})()},[i,s]),!i)return null;const T=async()=>{if(!g||!g.includes("@")){w("Please enter a valid email address");return}if(!D||D.length<6){w("Password must be at least 6 characters long");return}if(D!==k){w("Passwords do not match");return}if(n==="hod-manager"&&c.length===0){w("Please select at least one department for the HOD manager");return}S(!0),w(null);try{const{functions:N,httpsCallable:_}=await Se(async()=>{const{functions:Q,httpsCallable:ge}=await import("./firebase-vendor-ZA7KOHFb.js").then($=>$.Y);return{functions:Q,httpsCallable:ge}},[]),{functions:G}=await Se(async()=>{const{functions:Q}=await Promise.resolve().then(()=>Kr);return{functions:Q}},void 0),q=_(G,"createOrganizationUser"),L={organizationId:s,email:g.trim(),firstName:r.profile?.firstName||r.firstName,lastName:r.profile?.lastName||r.lastName,password:D,role:n,employeeId:r.id,updateEmployeeEmail:g!==(r.profile?.email||r.email)};n==="hod-manager"&&(L.departmentIds=c),console.log("🚀 Promoting employee with payload:",{...L,password:"***HIDDEN***",employeeData:{id:r.id,emailChanged:g!==(r.profile?.email||r.email)}});const E=await q(L);console.log("✅ Employee promoted to manager:",E),a(),t()}catch(N){console.error("❌ Failed to promote employee:",N),console.error("Error details:",{message:N.message,code:N.code,details:N.details}),w(N.message||"Failed to promote employee. Please try again.")}finally{S(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx(ht,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Promote to Manager"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Grant management access"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:f,children:e.jsx(_e,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto flex-1",children:[e.jsx(oe,{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Promoting:"}),e.jsxs("p",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:[r.profile?.firstName||r.firstName," ",r.profile?.lastName||r.lastName]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:r.profile?.email||r.email}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.profile?.department||"No Department"," • ",r.profile?.position||"No Position"]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Select Manager Role *"}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50 dark:hover:bg-gray-900/50 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 dark:has-[:checked]:bg-blue-900/20",children:[e.jsx("input",{type:"radio",name:"role",value:"hr-manager",checked:n==="hr-manager",onChange:N=>l(N.target.value),className:"w-5 h-5 mt-0.5 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"HR Manager"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full access to employee management, warnings, HR reports, and department management"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50 dark:hover:bg-gray-900/50 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 dark:has-[:checked]:bg-blue-900/20",children:[e.jsx("input",{type:"radio",name:"role",value:"hod-manager",checked:n==="hod-manager",onChange:N=>l(N.target.value),className:"w-5 h-5 mt-0.5 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ht,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Department Manager (HOD)"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage their department team, issue warnings, view department reports"})]})]})]}),n==="hod-manager"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Select Department(s) *"}),x?e.jsx("div",{className:"text-sm text-gray-500",children:"Loading departments..."}):d.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No departments available"}):e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:d.map(N=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-800 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.includes(N.id),onChange:_=>{_.target.checked?m([...c,N.id]):m(c.filter(G=>G!==N.id))},className:"w-4 h-4 text-blue-600 focus:ring-blue-500 rounded"}),e.jsxs("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:[N.name,N.employeeCount>0&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",N.employeeCount," employees)"]})]})]},N.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email Address *"}),e.jsx("input",{type:"email",value:g,onChange:N=>h(N.target.value),placeholder:"manager@company.com",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-100",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Verify or update the employee's email address"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Set Login Password *"}),e.jsx("input",{type:"password",value:D,onChange:N=>v(N.target.value),placeholder:"Enter password (min 6 characters)",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-100",required:!0,minLength:6})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Confirm Password *"}),e.jsx("input",{type:"password",value:k,onChange:N=>A(N.target.value),placeholder:"Re-enter password",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-gray-100",required:!0,minLength:6})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-300 dark:border-amber-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ct,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900 dark:text-amber-100 mb-1",children:"Important:"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"This will create a user account with management permissions. Share the login credentials with the employee. They can change their password from their dashboard."})]})]})}),C&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ct,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:C})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700 flex-shrink-0",children:[e.jsx(Me,{variant:"outline",onClick:t,disabled:f,children:"Cancel"}),e.jsx(Me,{onClick:T,disabled:f,icon:ht,children:f?"Promoting...":"Promote to Manager"})]})]})})},Rs=({isOpen:i,onClose:t,employees:r,onAssign:s})=>{const{organization:a}=Fe(),[n,l]=p.useState([]),[c,m]=p.useState(""),[d,u]=p.useState(!1),[x,b]=p.useState(!1),[f,S]=p.useState(null);p.useEffect(()=>{(async()=>{if(!(!a?.id||!i)){u(!0),S(null);try{const D=(await Y.queryDocuments(a.id,"users")).documents.filter(v=>v.role?.id==="hr-manager"||v.role?.id==="hod-manager").map(v=>({id:v.id,firstName:v.firstName||v.profile?.firstName||"Unknown",lastName:v.lastName||v.profile?.lastName||"User",role:v.role,departmentIds:v.departmentIds}));l(D),o.debug(`📋 Loaded ${D.length} managers for bulk assignment`)}catch(h){o.error("Failed to load managers:",h),S("Failed to load managers. Please try again.")}finally{u(!1)}}})()},[a?.id,i]);const C=async()=>{if(!c){S("Please select a manager");return}b(!0),S(null);try{await s(c),t()}catch(g){o.error("Failed to assign manager:",g),S(g.message||"Failed to assign manager. Please try again.")}finally{b(!1)}},w=n.find(g=>g.id===c);return e.jsx(Dt,{isOpen:i,onClose:t,title:"Assign Employees to Manager",size:"md",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-bg)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",style:{color:"var(--color-text)"},children:[r.length," employee",r.length!==1?"s":""," selected"]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.map(g=>`${g.profile.firstName} ${g.profile.lastName}`).join(", ")})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Manager"}),d?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"var(--color-primary)"}})}):n.length===0?e.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-warning-bg)"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-warning-text)"},children:"No managers found in your organization."})}):e.jsxs("select",{value:c,onChange:g=>m(g.target.value),className:"w-full px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",color:"var(--color-text)"},children:[e.jsx("option",{value:"",children:"-- Select a manager --"}),n.map(g=>e.jsxs("option",{value:g.id,children:[g.firstName," ",g.lastName," (",g.role.name,")"]},g.id))]})]}),w&&e.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ct,{className:"w-5 h-5 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--color-alert-info-text)"},children:"Confirm Assignment"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-alert-info-text)"},children:[r.length," employee",r.length!==1?"s":""," will be assigned to"," ",e.jsxs("strong",{children:[w.firstName," ",w.lastName]}),"."]})]})]})}),f&&e.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)"},children:e.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)"},children:f})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:t,disabled:x,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Cancel"}),e.jsx("button",{onClick:C,disabled:!c||x||d,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(to right, var(--color-primary), var(--color-primary-hover))",color:"var(--color-text-inverse)"},children:x?"Assigning...":"Assign Manager"})]})]})})},Vt={"business-owner":{level:0,icon:Xe,color:"from-purple-500 to-purple-600"},"hr-manager":{level:1,icon:xe,color:"from-blue-500 to-blue-600"},"hod-manager":{level:2,icon:me,color:"from-emerald-500 to-emerald-600"},employee:{level:3,icon:Be,color:"from-gray-500 to-gray-600"}},ks=({employees:i,onEmployeeClick:t,selectedEmployee:r})=>{const{user:s}=ye(),[a,n]=p.useState(new Set),[l,c]=p.useState("tree"),m=p.useMemo(()=>{if(!i.length)return[];const w=new Map;i.forEach(k=>w.set(k.id,k));const g=[],h=new Set,D=(k,A=0)=>{if(h.has(k))return null;const T=w.get(k);if(!T)return null;h.add(k);const N=[];return i.filter(_=>_.employment.managerId===k).forEach(_=>{const G=D(_.id,A+1);G&&N.push(G)}),{employee:T,children:N,level:A}};return i.filter(k=>!k.employment.managerId||!w.has(k.employment.managerId)).forEach(k=>{const A=D(k.id);A&&g.push(A)}),g},[i]),d=p.useMemo(()=>{if(!s||["hr-manager","business-owner"].includes(s.role?.id))return m;if(s.role?.id==="hod-manager"){const w=D=>{for(const v of D){if(v.employee.id===s.id)return[v];const k=w(v.children);if(k.length>0)return k}return[]},g=w(m);if(g.length>0)return g;const h=i.filter(D=>D.employment.managerId===s.id);if(h.length>0){const D=i.find(k=>k.id===s.id)||{id:s.id,profile:{firstName:s.firstName||s.displayName?.split(" ")[0]||"Manager",lastName:s.lastName||s.displayName?.split(" ")[1]||"",email:s.email||"",employeeNumber:"MGR-"+s.id.slice(-6),department:s.department||"Management",position:"Manager"},employment:{department:s.department||"Management",position:"Manager",managerId:null}},v=[];return h.forEach(k=>{const A={employee:k,children:i.filter(T=>T.employment.managerId===k.id).map(T=>({employee:T,children:[],level:2})),level:1};v.push(A)}),[{employee:D,children:v,level:0}]}return[]}return m},[m,s]),u=p.useMemo(()=>{const w=new Map;return i.forEach(g=>{const h=g.profile.department||"Unassigned";w.has(h)||w.set(h,[]),w.get(h).push(g)}),Array.from(w.entries()).sort(([g],[h])=>g.localeCompare(h))},[i]),x=p.useCallback(w=>{n(g=>{const h=new Set(g);return h.has(w)?h.delete(w):h.add(w),h})},[]),b=p.useCallback(w=>{t?.(w)},[t]),f=({employee:w,level:g,hasChildren:h,isExpanded:D,isSelected:v,childCount:k=0})=>{const A=w.employment.position||"Employee",T=Vt[A]?.icon||Be,N=Vt[A]?.color||"from-gray-500 to-gray-600";return e.jsx("div",{className:`
          relative bg-white rounded-lg shadow-md border-2 transition-all duration-200 cursor-pointer
          ${v?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}
          ${g===0?"w-56":"w-48"}
        `,onClick:()=>b(w),children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`
              w-10 h-10 rounded-full bg-gradient-to-br ${N} 
              flex items-center justify-center shadow-md
            `,children:e.jsx(T,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("h3",{className:"font-medium text-sm text-gray-900 truncate",children:[w.profile.firstName," ",w.profile.lastName]}),g===0&&e.jsx(Xe,{className:"w-3 h-3 text-yellow-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:A})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(lt,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:w.profile.department})]})}),h&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded text-xs font-medium",children:k}),e.jsx("button",{onClick:_=>{_.stopPropagation(),x(w.id)},className:"p-0.5 hover:bg-gray-100 rounded transition-colors",children:D?e.jsx(rt,{className:"w-3 h-3 text-gray-600"}):e.jsx(We,{className:"w-3 h-3 text-gray-600"})})]})]})})},S=(w,g=!0)=>w.length===0?null:e.jsx("div",{className:`flex flex-col items-center space-y-6 ${g?"w-full":""}`,children:w.map((h,D)=>{const v=h.children.length>0,k=a.has(h.employee.id),A=r?.id===h.employee.id,T=i.filter(N=>N.employment.managerId===h.employee.id).length;return e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:"relative z-10",children:e.jsx(f,{employee:h.employee,level:h.level,hasChildren:v,isExpanded:k,isSelected:A,childCount:T})}),v&&k&&e.jsxs("div",{className:"relative mt-4",children:[e.jsx("div",{className:"absolute top-0 left-1/2 w-0.5 h-4 bg-blue-300 transform -translate-x-0.5"}),e.jsx("div",{className:"pt-4 space-y-4",children:h.children.map((N,_)=>e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-0.5 h-8 bg-blue-300"}),e.jsx("div",{className:"w-8 h-0.5 bg-blue-300"})]}),e.jsx("div",{className:"ml-2",children:S([N],!1)})]},N.employee.id))}),h.children.length>1&&e.jsx("div",{className:"absolute left-1/2 w-0.5 bg-blue-300 transform -translate-x-0.5",style:{top:"16px",height:`${(h.children.length-1)*112+32}px`}})]})]},h.employee.id)})}),C=()=>e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:u.map(([w,g])=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:[e.jsxs("h3",{className:"text-white font-bold flex items-center gap-2",children:[e.jsx(lt,{className:"w-5 h-5"}),w]}),e.jsxs("p",{className:"text-blue-100 text-sm",children:[g.length," employees"]})]}),e.jsx("div",{className:"p-4 space-y-3",children:g.map(h=>e.jsx("div",{onClick:()=>b(h),className:`
                  p-3 rounded-lg cursor-pointer transition-all duration-200
                  hover:bg-blue-50 hover:border-blue-200 border border-transparent
                  ${r?.id===h.id?"bg-blue-50 border-blue-500":""}
                `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[h.profile.firstName," ",h.profile.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:h.employment.position})]})]})},h.id))})]},w))});return i.length?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8 text-blue-600"}),"Team Structure"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s?.role?.id==="hr-manager"?"Complete organizational hierarchy":s?.role?.id==="hod-manager"?"Your team and direct reports":"Team overview"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>c("tree"),className:`
                px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                ${l==="tree"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}
              `,children:"Hierarchy"}),e.jsx("button",{onClick:()=>c("departments"),className:`
                px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                ${l==="departments"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}
              `,children:"Departments"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-6",children:l==="tree"?e.jsx("div",{className:"max-h-96 overflow-y-auto overflow-x-auto p-4",children:d.length>0?e.jsx("div",{className:"min-w-max pb-8",children:S(d)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(me,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s?.role?.id==="hod-manager"?"No Team Members Found":"No Organizational Structure"}),e.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:s?.role?.id==="hod-manager"?"You currently have no direct reports assigned to you. Contact HR to add team members.":"There are no employees to display in the organizational hierarchy."}),s?.role?.id==="hod-manager"&&e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"User ID:"})," ",s.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.role?.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Employees:"})," ",i.length]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Direct Reports:"})," ",i.filter(w=>w.employment.managerId===s.id).length]})]})]})}):C()})]}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 text-center",children:[e.jsx(me,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),e.jsx("p",{className:"text-gray-600",children:"Start by adding employees to your organization."})]})},$s=({employees:i,onEmployeeSelect:t,onEmployeeEdit:r,onEmployeeDelete:s,onEmployeePromote:a,onBulkAction:n,selectedEmployee:l,loading:c=!1})=>{const{user:m}=ye(),{organization:d}=Fe(),[u,x]=p.useState([]);p.useEffect(()=>{(async()=>{if(d?.id)try{const P=await Y.queryDocuments(d.id,"users");x(P.documents),o.debug(`📋 Loaded ${P.documents.length} users for manager lookup`)}catch(P){o.error("Failed to load users for manager lookup:",P)}})()},[d?.id]);const b=p.useCallback(j=>{if(!j)return"HR Manager";const P=i.find(se=>se.id===j);if(P)return`${P.profile.firstName} ${P.profile.lastName}`;const V=u.find(se=>se.id===j);if(V){const se=V.firstName||V.profile?.firstName,ae=V.lastName||V.profile?.lastName,ve=V.role?.name||V.role?.id;if(se&&ae)return ve?`${se} ${ae} (${ve})`:`${se} ${ae}`}return"HR Manager"},[i,u]),[f,S]=p.useState("name"),[C,w]=p.useState("asc"),[g,h]=p.useState(""),[D,v]=p.useState(""),[k,A]=p.useState(""),[T,N]=p.useState(new Set),[_,G]=p.useState(!1),[q,L]=p.useState(1),[E,Q]=p.useState(25),ge=[{key:"select",label:"",sortable:!1,width:"48px",align:"center"},{key:"name",label:"Employee",sortable:!0,width:"200px"},{key:"employeeNumber",label:"ID",sortable:!0,width:"100px"},{key:"department",label:"Department",sortable:!0,width:"130px"},{key:"position",label:"Position",sortable:!0,width:"130px"},{key:"manager",label:"Manager",sortable:!0,width:"120px"},{key:"contact",label:"Contact",sortable:!1,width:"80px",align:"center"},{key:"startDate",label:"Start Date",sortable:!0,width:"100px"},{key:"status",label:"Status",sortable:!0,width:"100px"},{key:"actions",label:"Actions",sortable:!1,width:"80px",align:"center"}],$=p.useMemo(()=>{const j=new Set(i.map(P=>P.profile.department).filter(Boolean));return Array.from(j).sort()},[i]),U=p.useMemo(()=>{let j=i.filter(P=>{const V=[P.profile.firstName,P.profile.lastName,P.profile.employeeNumber,P.profile.department,P.employment.position,P.profile.email].join(" ").toLowerCase(),se=!g||V.includes(g.toLowerCase()),ae=!D||P.profile.department===D,ve=!k||(k==="active"?P.isActive:!P.isActive);return se&&ae&&ve});return j.sort((P,V)=>{let se,ae;switch(f){case"name":se=`${P.profile.firstName} ${P.profile.lastName}`,ae=`${V.profile.firstName} ${V.profile.lastName}`;break;case"department":se=P.profile.department||"",ae=V.profile.department||"";break;case"position":se=P.employment.position||"",ae=V.employment.position||"";break;case"manager":se=b(P.employment.managerId),ae=b(V.employment.managerId);break;case"startDate":const ve=ce=>{const W=ce.employment?.startDate||ce.profile?.startDate;if(!W)return 0;try{if(W&&typeof W.toDate=="function")return W.toDate().getTime();if(W instanceof Date)return W.getTime();const he=new Date(W);return isNaN(he.getTime())?0:he.getTime()}catch{return 0}};se=ve(P),ae=ve(V);break;case"status":se=P.isActive?"Active":"Inactive",ae=V.isActive?"Active":"Inactive";break;default:return 0}return se<ae?C==="asc"?-1:1:se>ae?C==="asc"?1:-1:0}),j},[i,g,D,k,f,C]),K=p.useMemo(()=>{const j=(q-1)*E;return U.slice(j,j+E)},[U,q,E]),R=Math.ceil(U.length/E),J=p.useCallback(j=>{j===f?w(C==="asc"?"desc":"asc"):(S(j),w("asc"))},[f,C]),ne=p.useCallback(j=>{N(P=>{const V=new Set(P);return V.has(j)?V.delete(j):V.add(j),V})},[]),be=p.useCallback(()=>{T.size===K.length?N(new Set):N(new Set(K.map(j=>j.id)))},[T.size,K]),Pe=p.useCallback(j=>{const P=i.filter(V=>T.has(V.id));n?.(j,P),N(new Set)},[i,T,n]),ke=p.useCallback(()=>{const j=["Name","Employee ID","Department","Position","Manager","Email","Phone","Start Date","Status"],P=U.map(ce=>[`${ce.profile.firstName} ${ce.profile.lastName}`,ce.profile.employeeNumber,ce.profile.department,ce.employment.position,b(ce.employment.managerId),ce.profile.email||"",ce.profile.phoneNumber||"",(()=>{const W=ce.employment?.startDate||ce.profile?.startDate;if(!W)return"Not set";try{if(W&&typeof W.toDate=="function")return W.toDate().toLocaleDateString();if(W instanceof Date)return W.toLocaleDateString();const he=new Date(W);return isNaN(he.getTime())?"Invalid date":he.toLocaleDateString()}catch{return"Invalid date"}})(),ce.isActive?"Active":"Inactive"]),V=[j,...P].map(ce=>ce.map(W=>`"${W}"`).join(",")).join(`
`),se=new Blob([V],{type:"text/csv;charset=utf-8;"}),ae=document.createElement("a"),ve=URL.createObjectURL(se);ae.setAttribute("href",ve),ae.setAttribute("download",`employees-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(ae),ae.click(),document.body.removeChild(ae)},[U]),Ce=j=>f!==j?null:C==="asc"?e.jsx(tr,{className:"w-4 h-4"}):e.jsx(rt,{className:"w-4 h-4"});return c?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((j,P)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},P))})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ar,{className:"w-6 h-6 text-blue-600"}),"Employee Directory"]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[U.length," of ",i.length," employees"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(nr,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:g,onChange:j=>h(j.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64"})]}),e.jsxs("button",{onClick:()=>G(!_),className:`
                flex items-center gap-2 px-4 py-2 border rounded-lg transition-colors
                ${_?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}
              `,children:[e.jsx(ir,{className:"w-4 h-4"}),"Filters"]}),e.jsxs("button",{onClick:ke,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Lr,{className:"w-4 h-4"}),"Export"]})]})]}),_&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),e.jsxs("select",{value:D,onChange:j=>v(j.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Departments"}),$.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:k,onChange:j=>A(j.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Size"}),e.jsxs("select",{value:E,onChange:j=>Q(Number(j.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"10",children:"10 per page"}),e.jsx("option",{value:"25",children:"25 per page"}),e.jsx("option",{value:"50",children:"50 per page"}),e.jsx("option",{value:"100",children:"100 per page"})]})]})]})}),T.size>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[T.size," employee",T.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[m?.role?.id==="hr-manager"&&e.jsxs("button",{onClick:()=>Pe("assign-manager"),className:"flex items-center gap-1 px-3 py-1 bg-purple-600 text-white rounded text-sm hover:bg-purple-700",children:[e.jsx(me,{className:"w-3 h-3"}),"Assign to Manager"]}),e.jsx("button",{onClick:()=>Pe("export"),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Export Selected"}),e.jsx("button",{onClick:()=>Pe("email"),className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Send Email"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsx("tr",{children:ge.map(j=>e.jsx("th",{className:`
                      px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider
                      ${j.align==="center"?"text-center":""}
                      ${j.align==="right"?"text-right":""}
                      ${j.sortable?"cursor-pointer hover:bg-gray-100":""}
                    `,style:{width:j.width},onClick:()=>j.sortable&&J(j.key),children:e.jsx("div",{className:"flex items-center gap-1",children:j.key==="select"?e.jsx("button",{onClick:be,children:T.size===K.length?e.jsx(Tt,{className:"w-4 h-4 text-blue-600"}):e.jsx(Lt,{className:"w-4 h-4 text-gray-400"})}):e.jsxs(e.Fragment,{children:[j.label,j.sortable&&Ce(j.key)]})})},j.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(j=>e.jsxs(Ie.Fragment,{children:[e.jsxs("tr",{className:`
                      hover:bg-gray-50 transition-colors cursor-pointer
                      ${l?.id===j.id?"bg-blue-50":""}
                      ${T.has(j.id)?"bg-blue-25":""}
                    `,onClick:()=>t?.(j),children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:P=>{P.stopPropagation(),ne(j.id)},children:T.has(j.id)?e.jsx(Tt,{className:"w-4 h-4 text-blue-600"}):e.jsx(Lt,{className:"w-4 h-4 text-gray-400"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Be,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[j.profile.firstName," ",j.profile.lastName]}),e.jsx("div",{className:"text-sm text-gray-500",children:j.profile.employeeNumber})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-gray-900",children:j.profile.employeeNumber}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:j.profile.department})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:j.employment.position}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:b(j.employment.managerId)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[j.profile.email&&e.jsx(Pr,{className:"w-4 h-4 text-green-600",title:`Email: ${j.profile.email}`}),j.profile.phoneNumber&&e.jsx(Mr,{className:"w-4 h-4 text-blue-600",title:`Phone: ${j.profile.phoneNumber}`}),!j.profile.email&&!j.profile.phoneNumber&&e.jsx("span",{className:"text-sm text-gray-400",children:"—"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ir,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:(()=>{const P=j.employment?.startDate||j.profile?.startDate;if(!P)return"Not set";try{if(P&&typeof P.toDate=="function")return P.toDate().toLocaleDateString();if(P instanceof Date)return P.toLocaleDateString();const V=new Date(P);return isNaN(V.getTime())?"Invalid date":V.toLocaleDateString()}catch{return"Invalid date"}})()})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`
                        inline-flex px-2 py-1 text-xs font-medium rounded-full
                        ${j.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
                      `,children:j.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-1",children:e.jsx("button",{onClick:P=>{P.stopPropagation(),t?.(j)},className:"p-1 text-gray-400 hover:text-green-600 transition-colors",children:e.jsx(vt,{className:"w-4 h-4"})})})})]}),l?.id===j.id&&e.jsx("tr",{className:"bg-blue-50/50",children:e.jsx("td",{colSpan:10,className:"px-4 py-4",children:e.jsxs("div",{className:"bg-white rounded-lg border border-blue-200 shadow-sm p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5 text-blue-600"}),"Employee Details"]}),e.jsx("button",{onClick:P=>{P.stopPropagation(),t?.(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",j.profile.firstName," ",j.profile.lastName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",j.profile.employeeNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",j.profile.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",j.profile.phoneNumber||"Not provided"]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Employment Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",j.profile.department]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Position:"})," ",j.employment.position]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Manager:"})," ",b(j.employment.managerId)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Start Date:"})," ",(()=>{const P=j.employment?.startDate||j.profile?.startDate;if(!P)return"Not set";try{if(P&&typeof P.toDate=="function")return P.toDate().toLocaleDateString();if(P instanceof Date)return P.toLocaleDateString();const V=new Date(P);return isNaN(V.getTime())?"Invalid date":V.toLocaleDateString()}catch{return"Invalid date"}})()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${j.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:j.isActive?"Active":"Inactive"})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:P=>{P.stopPropagation(),r?.(j)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Edit Employee"}),(m?.role?.id==="hr-manager"||m?.role?.id==="business-owner")&&a&&e.jsxs("button",{onClick:P=>{P.stopPropagation(),a(j)},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm",children:[e.jsx(et,{className:"w-4 h-4"}),"Promote to Manager"]}),e.jsx("button",{onClick:P=>{P.stopPropagation(),s?.(j)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Archive Employee"})]})]})})})]},j.id))})]})}),R>1&&e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(q-1)*E+1," to ",Math.min(q*E,U.length)," of ",U.length," results"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L(Math.max(1,q-1)),disabled:q===1,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),Array.from({length:Math.min(5,R)},(j,P)=>{const V=Math.max(1,q-2)+P;return V>R?null:e.jsx("button",{onClick:()=>L(V),className:`
                        px-3 py-1 border rounded text-sm transition-colors
                        ${V===q?"bg-blue-600 border-blue-600 text-white":"border-gray-300 hover:bg-gray-50"}
                      `,children:V},V)}),e.jsx("button",{onClick:()=>L(Math.min(R,q+1)),disabled:q===R,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})})]}),U.length===0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx(Be,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:g||D||k?"Try adjusting your search or filter criteria.":"Start by adding employees to your organization."}),(g||D||k)&&e.jsx("button",{onClick:()=>{h(""),v(""),A("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Clear Filters"})]})]})},Os=()=>{const{user:i,organization:t}=ye(),{employees:r,loading:s,error:a,refreshData:n}=dr({role:"hod"}),l=Ie.useMemo(()=>!r||r.length===0?[]:r.map(E=>({id:E.id,organizationId:t?.id||"",isActive:!0,createdAt:new Date,updatedAt:new Date,profile:{firstName:E.firstName,lastName:E.lastName,email:E.email,department:E.department,employeeNumber:E.employeeNumber||E.id,phoneNumber:E.phone,position:E.position,startDate:new Date},employment:{startDate:new Date,department:E.department,position:E.position,contractType:E.contractType||"full-time"},disciplinaryRecord:{totalWarnings:E.recentWarnings?.count||0,activeWarnings:E.recentWarnings?.count||0,currentLevel:"none",warningHistory:[],warningsByCategory:{}},deliveryPreferences:{primaryMethod:"email",allowAlternativeMethods:!0,whatsappConsent:!1,emailConsent:!0,printConsent:!1,lastUpdated:new Date},_original:E})),[r,t?.id]),{filters:c,setFilters:m,filteredEmployees:d}=ur(l,i);Ie.useEffect(()=>{console.log("🔍 [MobileEmployeeManagement] Data status:",{organizationId:t?.id,userId:i?.id,loading:s?.overall||s?.employees||!1,error:a,employeesCount:l.length,filteredCount:d.length,filters:c,rawDashboardEmployees:r,transformedEmployees:l.map(E=>({id:E.id,name:`${E.profile?.firstName||"Unknown"} ${E.profile?.lastName||"Unknown"}`,isActive:E.isActive,hasProfile:!!E.profile,profileDepartment:E.profile?.department,rawEmployee:E})),filteredEmployees:d.map(E=>({id:E.id,name:`${E.profile?.firstName||"Unknown"} ${E.profile?.lastName||"Unknown"}`,isActive:E.isActive,hasProfile:!!E.profile})),userRole:i?.role?.id,userDepartments:i?.departmentIds})},[t?.id,i?.id,s,a,l,d,c,r,i]);const[u,x]=p.useState("list"),[b,f]=p.useState(!1),[S,C]=p.useState(!1),[w,g]=p.useState(null),[h,D]=p.useState(null),[v,k]=p.useState(!1),[A,T]=p.useState(""),N=Ct(i?.role.id,i?.departmentIds),_=p.useMemo(()=>{const E=d.length,Q=d.filter($=>$.isActive).length,ge=d.filter($=>$.disciplinaryRecord?.activeWarnings>0).length;return{total:E,active:Q,warnings:ge}},[d]),G=async()=>{n(),f(!1),g(null)},q=async E=>{D(null),n()};return s?.overall||s?.employees||!1?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading employees..."})]})}):e.jsxs("div",{className:"w-full space-y-3 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-white",children:"Employee Directory"}),e.jsxs("p",{className:"text-blue-100 text-xs",children:[_.total," of ",l.length," employees"]})]})]}),e.jsx("div",{className:"flex gap-1",children:N.canCreate&&e.jsx("button",{onClick:()=>f(!0),className:"p-2 bg-white/20 hover:bg-white/30 text-white rounded-lg",children:e.jsx(ze,{className:"w-4 h-4"})})})]})}),e.jsxs("div",{className:"flex items-center justify-around p-3 bg-gray-50 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:_.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:_.active}),e.jsx("div",{className:"text-xs text-gray-600",children:"Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:_.warnings}),e.jsx("div",{className:"text-xs text-gray-600",children:"Warnings"})]})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(nr,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:A,onChange:E=>T(E.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("button",{onClick:()=>k(!v),className:`px-3 py-2 rounded-lg border ${v?"bg-blue-50 border-blue-200":"bg-white border-gray-300"}`,children:e.jsx(ir,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>x("list"),className:`p-1 rounded ${u==="list"?"bg-white shadow-sm":""}`,children:e.jsx(_r,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>x("grid"),className:`p-1 rounded ${u==="grid"?"bg-white shadow-sm":""}`,children:e.jsx(zr,{className:"w-4 h-4"})})]})]}),v&&e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg space-y-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs("select",{value:c.isActive?"active":"all",onChange:E=>m({...c,isActive:E.target.value==="active"}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Employees"}),e.jsx("option",{value:"active",children:"Active Only"})]})]})})]})]}),a&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-red-800 text-sm",children:a})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:d.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"👥"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No employees found"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:l.length===0?"Add your first employee to get started":"Try adjusting your search criteria"}),N.canCreate&&l.length===0&&e.jsxs("button",{onClick:()=>f(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm",children:[e.jsx(ze,{className:"w-4 h-4"}),"Add First Employee"]})]}):u==="list"?e.jsx("div",{className:"divide-y",children:d.map(E=>e.jsx("div",{className:`p-3 transition-colors ${N.canEdit?"hover:bg-gray-50 cursor-pointer":"cursor-default"}`,onClick:()=>N.canEdit?g(E):null,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-blue-600 font-medium text-sm",children:[E.profile.firstName?.charAt(0),E.profile.lastName?.charAt(0)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[E.profile.firstName," ",E.profile.lastName]}),e.jsx("div",{className:"text-sm text-gray-600",children:E.employment.position})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`inline-block px-2 py-1 rounded-full text-xs ${E.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:E.isActive?"Active":"Inactive"})})]})},E.id))}):e.jsx("div",{className:"grid grid-cols-1 gap-3 p-3",children:d.map(E=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-3 transition-shadow ${N.canEdit?"hover:shadow-md cursor-pointer":"cursor-default"}`,onClick:()=>N.canEdit?g(E):null,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[E.profile.firstName," ",E.profile.lastName]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs ${E.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:E.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{children:E.employment.position}),e.jsx("div",{children:E.profile.email})]})]},E.id))})}),d.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3",children:e.jsxs("button",{className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[e.jsx(rt,{className:"w-4 h-4"}),"Export (",d.length," employees)"]})}),(b||w)&&e.jsx(gr,{employee:w,onClose:()=>{f(!1),g(null)},onSave:G,basicMode:!w&&!N.canEdit}),S&&e.jsx(hr,{onClose:()=>C(!1),onImportComplete:n}),h&&e.jsx(pr,{employee:h,onClose:()=>D(null),onArchive:q})]})},ue=({width:i="100%",height:t="1rem",className:r=""})=>e.jsx("div",{className:`bg-gray-200 rounded animate-pulse legacy-simple-layout ${r}`,style:{width:i,height:t}}),Ts=({rows:i=5})=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg legacy-simple-layout",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(ue,{width:"150px",height:"16px"}),e.jsx(ue,{width:"120px",height:"16px"}),e.jsx(ue,{width:"100px",height:"16px"}),e.jsx(ue,{width:"80px",height:"16px"})]})}),Array.from({length:i}).map((t,r)=>e.jsx("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(ue,{width:"150px",height:"14px"}),e.jsx(ue,{width:"120px",height:"14px"}),e.jsx(ue,{width:"100px",height:"14px"}),e.jsx(ue,{width:"80px",height:"14px"})]})},r))]}),Ls=()=>e.jsx("div",{className:"grid grid-cols-1 gap-4 legacy-simple-layout",children:Array.from({length:4}).map((i,t)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ue,{width:"60px",height:"14px"}),e.jsx(ue,{width:"24px",height:"24px",className:"rounded"})]}),e.jsx(ue,{width:"40px",height:"24px",className:"mb-1"}),e.jsx(ue,{width:"80px",height:"12px"})]},t))}),Ps=()=>e.jsxs("div",{className:"space-y-4 legacy-simple-layout",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{width:"32px",height:"32px",className:"rounded"}),e.jsxs("div",{children:[e.jsx(ue,{width:"120px",height:"18px",className:"mb-1"}),e.jsx(ue,{width:"80px",height:"14px"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ue,{width:"80px",height:"36px",className:"rounded"}),e.jsx(ue,{width:"80px",height:"36px",className:"rounded"})]})]})}),e.jsx(Ls,{}),e.jsx(Ts,{rows:3})]}),Ms=({message:i="Loading..."})=>e.jsxs("div",{className:"text-center py-8 legacy-simple-layout",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-gray-600 legacy-text-size",children:i}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This may take a moment on slower connections"})]}),At=()=>{const{user:i,organization:t}=ye();if(window.innerWidth<768)return e.jsx(Os,{});const s=i?.role?.id==="hod-manager",a=t?.id,{employees:n,loading:l,loadingMore:c,error:m,loadEmployees:d,loadMoreEmployees:u,archiveEmployee:x,updateEmployee:b,pagination:f}=xs(a,s?i?.id:void 0),{filters:S,setFilters:C,filteredEmployees:w}=ur(n,i),g=p.useMemo(()=>lr($e||{isLegacyDevice:!1}),[]),[h,D]=p.useState(1),v=$e?.isLegacyDevice?g.employeeListLimit:50,k=p.useMemo(()=>{if(!$e?.isLegacyDevice)return w;const W=(h-1)*v,he=W+v;return w.slice(W,he)},[w,h,v,$e?.isLegacyDevice]),A=Math.ceil(w.length/v),[T,N]=p.useState("table"),[_,G]=p.useState(!1),[q,L]=p.useState(!1),[E,Q]=p.useState(null),[ge,$]=p.useState(null),[U,K]=p.useState(null),[R,J]=p.useState(null),[ne,be]=p.useState([]),[Pe,ke]=p.useState(!1),Ce=Ct(i?.role.id,i?.departmentIds),j=async()=>{await d(),G(!1),Q(null)},P=async W=>{await x(W),$(null)},V=p.useCallback(W=>{K(W)},[]),se=p.useCallback(W=>{Q(W)},[]),ae=p.useCallback(W=>{$(W)},[]),ve=p.useCallback((W,he)=>{switch(W){case"assign-manager":be(he),ke(!0);break;case"export":console.log("Exporting employees:",he);break;case"email":console.log("Sending email to employees:",he);break;default:console.log("Bulk action:",W,he)}},[]),ce=p.useCallback(async W=>{if(!a)return;const he=ne.map(Rt=>b(Rt.id,{employment:{...Rt.employment,managerId:W}}));await Promise.all(he),await d(),ke(!1),be([])},[ne,a,b,d]);return l?$e?.isLegacyDevice?e.jsxs("div",{className:"w-full p-4",children:[e.jsx(Ms,{message:"Loading Employees..."}),e.jsx("div",{className:"mt-4",children:e.jsx(Ps,{})})]}):e.jsx(gt,{message:"Loading employees...",size:"lg"}):e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-700 to-indigo-800 p-2 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"bg-white/20 p-1.5 sm:p-2 rounded-lg backdrop-blur-sm",children:e.jsx(me,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-white tracking-tight",children:"Employee Management"}),e.jsx("p",{className:"text-indigo-100 text-xs font-medium",children:$e?.isLegacyDevice?`${k.length} of ${w.length} employees`:`${w.length} employees`})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[Ce.canCreate&&e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-1 sm:gap-2 px-2 py-1.5 sm:px-3 sm:py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-medium border border-white/30 hover:border-white/50 transition-all text-sm",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add"})]}),Ce.canBulkImport&&e.jsxs("button",{onClick:()=>L(!0),className:"flex items-center gap-1 sm:gap-2 px-2 py-1.5 sm:px-3 sm:py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[e.jsx(Fr,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Import"})]}),Ce.canViewArchived&&e.jsxs("button",{onClick:()=>N("archive"),className:"flex items-center gap-1 sm:gap-2 px-2 py-1.5 sm:px-3 sm:py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[e.jsx(it,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Archive"})]})]})]})})}),m&&e.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-red-600 text-lg",children:"⚠️"}),e.jsx("p",{className:"text-red-800 font-medium text-sm",children:m})]})}),e.jsx(js,{employees:w}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-600",children:i?.role?.id==="hr-manager"?"Full organizational view":i?.role?.id==="hod-manager"?"Your team structure":"Team directory"}),e.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>N("organogram"),className:`flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs ${T==="organogram"?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(Ur,{className:"w-3 h-3"}),e.jsx("span",{children:"Hierarchy"})]}),e.jsxs("button",{onClick:()=>N("table"),className:`flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs ${T==="table"?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(ar,{className:"w-3 h-3"}),e.jsx("span",{children:"Table"})]}),e.jsxs("button",{onClick:()=>N("cards"),className:`flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs ${T==="cards"?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(Wr,{className:"w-3 h-3"}),e.jsx("span",{children:"Cards"})]})]})]}),T==="cards"&&e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg shadow-md border border-white/50 p-3",children:e.jsx(Ds,{filters:S,setFilters:C,departments:[...new Set(n.map(W=>W.profile.department))],viewMode:T,setViewMode:N})}),T==="organogram"&&e.jsx(ks,{employees:w,onEmployeeClick:V,selectedEmployee:U}),T==="table"&&e.jsx($s,{employees:k,onEmployeeSelect:V,onEmployeeEdit:se,onEmployeeDelete:ae,onEmployeePromote:W=>J(W),onBulkAction:ve,selectedEmployee:U,loading:l}),T==="cards"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:k.map(W=>e.jsx(As,{employee:W,permissions:Ce,onEdit:Q,onArchive:$},W.id))}),$e?.isLegacyDevice&&A>1&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 legacy-text-size",children:["Page ",h," of ",A," (",w.length," total employees)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>D(W=>Math.max(1,W-1)),disabled:h===1,className:`px-3 py-2 rounded-md legacy-touch-target legacy-text-size ${h===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,children:"Previous"}),e.jsxs("div",{className:"flex items-center px-3 py-2 text-sm text-gray-600 legacy-text-size",children:[Math.max(1,h-1),"-",Math.min(A,h+1)]}),e.jsx("button",{onClick:()=>D(W=>Math.min(A,W+1)),disabled:h===A,className:`px-3 py-2 rounded-md legacy-touch-target legacy-text-size ${h===A?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,children:"Next"})]})]})}),T==="archive"&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Archive list view is being reimplemented. Use the Archive button on individual employees."}),e.jsx("button",{onClick:()=>N("table"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Employee List"})]}),T==="cards"&&f.canLoadMore&&!l&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("button",{onClick:u,disabled:c,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 disabled:from-slate-400 disabled:to-slate-500 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsxs("span",{children:["Load More (",n.length,")"]})]})}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Page ",f.currentPage," • ",f.pageSize," per page"]})]}),!l&&w.length===0&&e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-6 text-center shadow-lg border border-white/50",children:[e.jsx("div",{className:"text-3xl mb-3",children:"👥"}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:n.length===0?"No employees yet":"No matching employees"}),e.jsx("p",{className:"text-slate-600 mb-4 text-sm",children:n.length===0?"Add your first employee or import from CSV":"Try adjusting your search criteria"}),Ce.canCreate&&n.length===0&&e.jsxs("button",{onClick:()=>G(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[e.jsx(ze,{className:"w-4 h-4"}),"Add First Employee"]})]}),(_||E)&&e.jsx(gr,{employee:E,onClose:()=>{G(!1),Q(null)},onSave:j}),q&&e.jsx(hr,{onClose:()=>L(!1),onImportComplete:d}),ge&&e.jsx(pr,{employee:ge,onClose:()=>$(null),onArchive:P}),R&&t&&e.jsx(Cs,{isOpen:!0,onClose:()=>J(null),employee:R,organizationId:t.id,onSuccess:()=>{d(),J(null)}}),Pe&&e.jsx(Rs,{isOpen:Pe,onClose:()=>{ke(!1),be([])},employees:ne,onAssign:ce})]})},ta=Object.freeze(Object.defineProperty({__proto__:null,EmployeeManagement:At},Symbol.toStringTag,{value:"Module"})),Bt=({isOpen:i,onClose:t,organizationId:r,inline:s=!1})=>{const{organization:a}=Fe(),n=r||a?.id,[l,c]=p.useState([]),[m,d]=p.useState(null),[u,x]=p.useState(!0),[b,f]=p.useState(null),[S,C]=p.useState(!1),[w,g]=p.useState(null),[h,D]=p.useState({name:"",description:"",managerId:""}),[v,k]=p.useState(!1);p.useEffect(()=>{if(!n||!i&&!s)return;(async()=>{try{x(!0),f(null);const[E,Q]=await Promise.all([Oe.getDepartments(n),Oe.getDepartmentStats(n)]);c(E),d(Q)}catch(E){o.error("Failed to load departments",{error:E}),f("Failed to load departments. Please try again.")}finally{x(!1)}})()},[n,i,s]),p.useEffect(()=>!n||!i&&!s?void 0:Oe.subscribeToDepartments(n,E=>{c(E)}),[n,i,s]);const A=()=>{g(null),D({name:"",description:"",managerId:""}),C(!0)},T=L=>{g(L),D({name:L.name,description:L.description||"",managerId:L.managerId||""}),C(!0)},N=async L=>{if(n){if(L.isDefault){alert("Cannot delete default departments (Operations, Admin)");return}if(confirm(`Are you sure you want to delete "${L.name}"? This action cannot be undone.`))try{await Oe.deleteDepartment(n,L.id),c(E=>E.filter(Q=>Q.id!==L.id)),o.success("Department deleted successfully")}catch(E){o.error("Failed to delete department",{error:E}),alert("Failed to delete department. Please try again.")}}},_=async L=>{if(L.preventDefault(),!!n)try{if(k(!0),w)await Oe.updateDepartment(n,w.id,h),c(E=>E.map(Q=>Q.id===w.id?{...Q,...h,updatedAt:new Date}:Q));else{const E=await Oe.createDepartment(n,h);c(Q=>[...Q,E])}C(!1),D({name:"",description:"",managerId:""}),o.success(w?"Department updated successfully":"Department created successfully")}catch(E){o.error("Failed to save department",{error:E}),alert("Failed to save department. Please try again.")}finally{k(!1)}},G=()=>{C(!1),g(null),D({name:"",description:"",managerId:""})};if(!s&&!i)return null;const q=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-base font-bold text-gray-900",children:"Departments"}),m&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),m.totalDepartments," total"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),m.departmentsWithManagers," with managers"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),m.totalEmployeesAcrossDepartments," employees"]})]})]}),e.jsxs("button",{onClick:A,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors",children:[e.jsx(ze,{className:"w-3.5 h-3.5"}),"Add Department"]})]})}),u&&e.jsx(gt,{message:"Loading departments..."}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-3.5 h-3.5 text-red-600"}),e.jsx("span",{className:"text-sm text-red-800",children:b})]})}),!u&&!b&&e.jsxs("div",{className:"space-y-1.5",children:[l.map(L=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-900",children:L.name}),L.isDefault&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded",children:"Default"})]}),L.description&&e.jsx("p",{className:"text-xs text-gray-600 mb-1.5",children:L.description}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),L.employeeCount," employees"]}),L.managerName?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xe,{className:"w-3 h-3"}),L.managerName]}):e.jsxs("span",{className:"flex items-center gap-1 text-orange-600",children:[e.jsx(Ne,{className:"w-3 h-3"}),"No manager"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>T(L),className:"p-1.5 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50",title:"Edit department",children:e.jsx(bt,{className:"w-3.5 h-3.5"})}),!L.isDefault&&e.jsx("button",{onClick:()=>N(L),className:"p-1.5 text-gray-400 hover:text-red-600 rounded hover:bg-red-50",title:"Delete department",children:e.jsx(er,{className:"w-3.5 h-3.5"})})]})]})},L.id)),l.length===0&&!u&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[e.jsx(Ee,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No departments found"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Create your first department to get started with organizational structure."}),e.jsxs("button",{onClick:A,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors mx-auto",children:[e.jsx(ze,{className:"w-3.5 h-3.5"}),"Create Department"]})]})]}),S&&e.jsx(Dt,{isOpen:S,onClose:G,title:w?"Edit Department":"Create Department",subtitle:w?"Update department information":"Add a new department to your organization",size:"md",children:e.jsxs("form",{onSubmit:_,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1.5 text-gray-700",children:"Department Name *"}),e.jsx("input",{type:"text",value:h.name,onChange:L=>D(E=>({...E,name:L.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Operations, Admin, Sales",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1.5 text-gray-700",children:"Description"}),e.jsx("textarea",{value:h.description,onChange:L=>D(E=>({...E,description:L.target.value})),rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of the department's role and responsibilities"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-3",children:[e.jsx("button",{type:"button",onClick:G,disabled:v,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v||!h.name.trim(),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:v?e.jsxs(e.Fragment,{children:[e.jsx(St,{className:"w-3.5 h-3.5 animate-spin"}),w?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(sr,{className:"w-3.5 h-3.5"}),w?"Update":"Create"]})})]})]})})]});return s?e.jsx("div",{className:"space-y-4",children:q}):Yt.createPortal(e.jsx(Dt,{isOpen:i,onClose:t,title:"Department Management",subtitle:"Manage organizational departments and assignments",size:"lg",children:q}),document.body)},xr=p.memo(({isOpen:i,onClose:t,onSuccess:r,userRole:s,employees:a})=>{const[n,l]=p.useState(a.length>0?"promote":"create"),[c,m]=p.useState(null),[d,u]=p.useState({firstName:"",lastName:"",email:"",department:"",password:"temp123"}),[x,b]=p.useState(!1),[f,S]=p.useState(""),{user:C}=ye(),{organization:w}=Fe(),g=async D=>{if(D.preventDefault(),!(!w||!C)){b(!0),S("");try{if(n==="promote"){if(!c){S("Please select an employee to promote"),b(!1);return}if(o.debug(`🔧 Promoting employee ${c.id} to ${s}`),!d.email.trim()){S("Email address is required for creating user account"),b(!1);return}const v={firstName:c.profile?.firstName||c.firstName,lastName:c.profile?.lastName||c.lastName,email:d.email.trim(),password:"temp123",role:s,organizationId:w.id,departmentIds:s==="hod-manager"?[d.department]:[],employeeId:c.id,updateEmployeeEmail:!0},A=await kt(Nt,"createOrganizationUser")(v);if(!A.data.success)throw new Error(A.data.message||"Failed to promote employee");o.success(`✅ Promoted employee to ${s} with verified email: ${d.email}`)}else{o.debug(`🔧 Creating new ${s} user and employee via Cloud Function`);const v={firstName:d.firstName,lastName:d.lastName,email:d.email,password:d.password,role:s,organizationId:w.id,departmentIds:s==="hod-manager"?[d.department]:[],createEmployee:!0},A=await kt(Nt,"createOrganizationUser")(v);if(!A.data.success)throw new Error(A.data.message||"Failed to create user");o.success(`✅ Created ${s} user and employee: ${A.data.userId}`)}b(!1),r(),t(),h()}catch(v){o.error("❌ Error processing user:",v),S(v.message||"Failed to process user"),b(!1)}}},h=()=>{l(a.length>0?"promote":"create"),m(null),u({firstName:"",lastName:"",email:"",department:"",password:"temp123"})};return i?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl animate-in fade-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(et,{className:"w-6 h-6 text-blue-600"}),"Add ",s==="hr-manager"?"HR Manager":"Department Manager"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n==="promote"?`Promote an existing employee to ${s==="hr-manager"?"HR manager":"department manager"}`:`Create a new ${s==="hr-manager"?"HR manager":"department manager"} account`})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Choose Option"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"selectionMode",value:"promote",checked:n==="promote",onChange:D=>l(D.target.value),className:"mr-3 text-blue-600",disabled:a.length===0}),e.jsxs("span",{className:a.length===0?"text-gray-400":"text-gray-700",children:["Promote Existing Employee ",a.length===0&&"(No employees available)"]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"selectionMode",value:"create",checked:n==="create",onChange:D=>l(D.target.value),className:"mr-3 text-blue-600"}),e.jsx("span",{className:"text-gray-700",children:"Create New Manager"})]})]})]}),n==="promote"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee to Promote"}),e.jsxs("select",{value:c?.id||"",onChange:D=>{const v=a.find(k=>k.id===D.target.value);if(m(v||null),v){const k=v.profile?.email||v.email;k||`${v.profile?.firstName||v.firstName}${v.profile?.lastName||v.lastName}${w?.name.toLowerCase().replace(/\s+/g,"")}`,u(A=>({...A,email:k||""}))}else u(k=>({...k,email:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select an employee..."}),a.map(D=>e.jsxs("option",{value:D.id,children:[D.profile?.firstName||D.firstName," ",D.profile?.lastName||D.lastName,D.profile?.email&&` (${D.profile.email})`]},D.id))]}),c&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Selected:"})," ",c.profile?.firstName||c.firstName," ",c.profile?.lastName||c.lastName,e.jsx("br",{}),e.jsx("strong",{children:"Department:"})," ",c.profile?.department||c.employment?.department||"Not assigned"]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Email Address",c.profile?.email?e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"Verify/Update"}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:d.email,onChange:D=>u(v=>({...v,email:D.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${c.profile?.email?"border-yellow-300 bg-yellow-50":"border-gray-300"}`,placeholder:c.profile?.email||`${c.profile?.firstName||c.firstName}.${c.profile?.lastName||c.lastName}@${w?.name.toLowerCase().replace(/\s+/g,"")}.com`,required:!0}),c.profile?.email&&d.email===(c.profile?.email||c.email)&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("span",{className:"text-green-600 text-sm",children:"✓ Verified"})})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1 flex items-start gap-2",children:c.profile?.email?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full flex-shrink-0 mt-1"}),e.jsxs("span",{children:["Current: ",e.jsx("strong",{children:c.profile.email}),". You can verify or update it above."]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0 mt-1"}),e.jsx("span",{children:"No email on file. Please enter their email address for login access."})]})})]})]})]}),n==="create"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),e.jsx("input",{type:"text",value:d.firstName,onChange:D=>u(v=>({...v,firstName:D.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:d.lastName,onChange:D=>u(v=>({...v,lastName:D.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:d.email,onChange:D=>u(v=>({...v,email:D.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),s==="hod-manager"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),e.jsxs("select",{value:d.department,onChange:D=>u(v=>({...v,department:D.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),e.jsx("option",{value:"operations",children:"Operations"}),e.jsx("option",{value:"production",children:"Production"}),e.jsx("option",{value:"quality",children:"Quality Assurance"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"logistics",children:"Logistics"}),e.jsx("option",{value:"administration",children:"Administration"}),e.jsx("option",{value:"finance",children:"Finance"}),e.jsx("option",{value:"sales",children:"Sales & Marketing"})]})]})]}),f&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-700",children:f})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),n==="promote"?"Promoting...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4"}),n==="promote"?"Promote Employee":"Create Manager"]})})]})]})]})}):null});xr.displayName="AddUserModal";const Re=i=>typeof i=="string"?i:i?.id||"",Et=p.memo(()=>{const i=Zt(),{user:t}=ye(),{organization:r}=Fe(),{canCreateHRManagers:s,canCreateHODManagers:a,canManageDepartments:n,canManageUsers:l}=ss(),[c,m]=p.useState([]),[d,u]=p.useState(null),[x,b]=p.useState([]),[f,S]=p.useState([]),[C,w]=p.useState({totalUsers:0,totalEmployees:0,totalDepartments:0,activeWarnings:0}),[g,h]=p.useState(!0),[D,v]=p.useState(!1),[k,A]=p.useState("hr-manager"),[T,N]=p.useState(null);p.useEffect(()=>{r&&_()},[r]);const _=async()=>{if(r)try{h(!0),o.debug(`📊 Loading organization data for: ${r.id}`);const U=(await Y.queryDocuments(r.id,"users",[])).documents.map(j=>({id:j.id,firstName:j.firstName||"",lastName:j.lastName||"",email:j.email,role:j.role,departmentIds:j.departmentIds||[],isActive:j.isActive??!0,createdAt:j.createdAt||new Date().toISOString(),lastLogin:j.lastLogin})),K=U.filter(j=>Re(j.role)!=="business-owner"),R=U.find(j=>Re(j.role)==="business-owner")||null,J=await ee.loadEmployees(r.id),be=(await ee.loadWarnings(r.id)).documents.filter(j=>j.status==="issued").length,ke=(await Oe.getDepartments(r.id)).map(j=>({id:j.id,name:j.name,employeeCount:j.employeeCount,createdAt:j.createdAt.toISOString(),description:j.description,managerId:j.managerId,managerName:j.managerName})),Ce={totalUsers:K.length,totalEmployees:J.documents.length,totalDepartments:ke.length,activeWarnings:be};m(K),u(R),b(ke),S(J.documents),w(Ce),o.success(`✅ Loaded organization data: ${K.length} users, ${J.documents.length} employees`)}catch($){o.error("❌ Failed to load organization data:",$)}finally{h(!1)}},G=$=>{A($),v(!0)},q=()=>{N(`✅ ${k==="hr-manager"?"HR Manager":"Department Manager"} created successfully! User can now sign in with their email and password 'temp123'.`),setTimeout(()=>N(null),5e3),_()},L=async $=>{if(!r)return;const U=c.find(ne=>ne.id===$);if(!U)return;const K=await Q($),R=K.length>0?`Archive ${U.firstName} ${U.lastName}?

This will:
• Archive the user account
• Reassign ${K.length} employees to HR managers
• Remove access to the system

This action can be undone by restoring the user.`:`Archive ${U.firstName} ${U.lastName}?

This will remove their access to the system.
This action can be undone by restoring the user.`;if(confirm(R))try{o.debug(`🗃️ Archiving user ${$} and reassigning employees...`),K.length>0&&await ge($,K),await ee.updateDocument(r.id,"users",$,{isActive:!1,archivedAt:new Date().toISOString(),archivedBy:U?.uid||"system"}),o.success(`✅ User archived successfully: ${U.firstName} ${U.lastName}`),_()}catch(ne){o.error("❌ Failed to archive user:",ne),alert("Failed to archive user. Please try again.")}},E=async $=>{if(!r)return;const U=c.find(R=>R.id===$);if(!(!U||!confirm(`Restore ${U.firstName} ${U.lastName}?

This will reactivate their account and restore system access.`)))try{o.debug(`🔄 Restoring user ${$}...`),await ee.updateDocument(r.id,"users",$,{isActive:!0,restoredAt:new Date().toISOString(),restoredBy:U?.uid||"system",archivedAt:null,archivedBy:null}),o.success(`✅ User restored successfully: ${U.firstName} ${U.lastName}`),_()}catch(R){o.error("❌ Failed to restore user:",R),alert("Failed to restore user. Please try again.")}},Q=async $=>{if(!r)return[];try{return(await ee.loadEmployees(r.id)).documents.filter(K=>K.employment?.managerId===$&&K.isActive!==!1)}catch(U){return o.error("Error loading managed employees:",U),[]}},ge=async($,U)=>{if(!(!r||U.length===0))try{const K=c.find(J=>Re(J.role)==="hr-manager"&&J.isActive&&J.id!==$);if(!K){o.warn("⚠️ No active HR manager found for employee reassignment");return}o.debug(`📋 Reassigning ${U.length} employees to HR manager: ${K.firstName} ${K.lastName}`);const R=U.map(J=>ee.updateDocument(r.id,"employees",J.id,{"employment.managerId":K.id,"employment.managerName":`${K.firstName} ${K.lastName}`,"employment.managerRole":"hr-manager",reassignedAt:new Date().toISOString(),reassignedFrom:$,reassignedReason:"Manager archived"}));await Promise.all(R),o.success(`✅ Reassigned ${U.length} employees to ${K.firstName} ${K.lastName}`)}catch(K){throw o.error("❌ Failed to reassign employees:",K),K}};return g?e.jsx(gt,{message:"Loading organization..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[T&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-green-600"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-green-800 font-medium",children:T})}),e.jsx("button",{onClick:()=>N(null),className:"text-green-600 hover:text-green-800 p-1 rounded-full hover:bg-green-100",children:e.jsx(_e,{className:"w-4 h-4"})})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Organization Management"}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"}),C.totalUsers," users"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),C.totalEmployees," employees"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3"}),C.totalDepartments," depts"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s()&&e.jsxs("button",{onClick:()=>G("hr-manager"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors",children:[e.jsx(et,{className:"w-3.5 h-3.5"}),"Add HR Manager"]}),a()&&e.jsxs("button",{onClick:()=>G("hod-manager"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 rounded-md transition-colors",children:[e.jsx(et,{className:"w-3.5 h-3.5"}),"Add Dept Manager"]}),l()&&e.jsxs("button",{onClick:()=>i("/users"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 rounded-md transition-colors",children:[e.jsx(rr,{className:"w-3.5 h-3.5"}),"User Management"]})]})]})}),d&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Xe,{className:"w-4 h-4 text-yellow-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm text-gray-900",children:[d.firstName," ",d.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[d.email," • Business Owner"]})]})]}),(t?.role==="super-user"||t?.role==="reseller")&&e.jsxs("div",{className:"flex items-center gap-1",children:[d.isActive?e.jsx("button",{onClick:()=>L(d.id),className:"p-1.5 hover:bg-red-100 rounded transition-colors group",title:"Archive business owner",children:e.jsx(it,{className:"w-3.5 h-3.5 text-gray-500 group-hover:text-red-600"})}):e.jsx("button",{onClick:()=>E(d.id),className:"p-1.5 hover:bg-green-100 rounded transition-colors group",title:"Restore business owner",children:e.jsx(pt,{className:"w-3.5 h-3.5 text-gray-500 group-hover:text-green-600"})}),e.jsx("div",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${d.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.isActive?"Active":"Archived"})]}),t?.role==="business-owner"&&e.jsx("div",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Current User"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-1.5 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),"HR Managers (",c.filter($=>Re($.role)==="hr-manager").length,")"]}),e.jsxs("div",{className:"space-y-1.5",children:[c.filter($=>Re($.role)==="hr-manager").map($=>e.jsx("div",{className:"bg-gray-50 rounded p-2 border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"font-semibold text-blue-600 text-xs",children:[$.firstName?.[0],$.lastName?.[0]]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-xs text-gray-900",children:[$.firstName," ",$.lastName]}),e.jsx("div",{className:"text-xs text-gray-500",children:$.email})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[$.isActive?e.jsx("button",{onClick:()=>L($.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive user",children:e.jsx(it,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):e.jsx("button",{onClick:()=>E($.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore user",children:e.jsx(pt,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${$.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:$.isActive?"Active":"Archived"})]})]})},$.id)),c.filter($=>Re($.role)==="hr-manager").length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(xe,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No HR managers yet"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-1.5 mb-2",children:[e.jsx(me,{className:"w-4 h-4 text-green-600"}),"Department Managers (",c.filter($=>Re($.role)==="hod-manager").length,")"]}),e.jsxs("div",{className:"space-y-1.5",children:[c.filter($=>Re($.role)==="hod-manager").map($=>e.jsx("div",{className:"bg-gray-50 rounded p-2 border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsxs("span",{className:"font-semibold text-green-600 text-xs",children:[$.firstName?.[0],$.lastName?.[0]]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-xs text-gray-900",children:[$.firstName," ",$.lastName]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[$.email,$.departmentIds&&$.departmentIds.length>0&&e.jsxs("span",{className:"ml-1 text-green-600",children:["• ",$.departmentIds.map(U=>x.find(K=>K.id===U)?.name||U).join(", ")]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[$.isActive?e.jsx("button",{onClick:()=>L($.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive user",children:e.jsx(it,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):e.jsx("button",{onClick:()=>E($.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore user",children:e.jsx(pt,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${$.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:$.isActive?"Active":"Archived"})]})]})},$.id)),c.filter($=>Re($.role)==="hod-manager").length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No department managers yet"})]})]})]})]}),n()&&x.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-1.5 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-orange-600"}),"Departments (",x.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:x.map($=>e.jsxs("div",{className:"bg-orange-50 rounded p-2 border border-orange-200",children:[e.jsx("div",{className:"mb-1",children:e.jsx("h4",{className:"font-semibold text-xs text-gray-900",children:$.name})}),$.managerName?e.jsxs("div",{className:"text-sm text-green-700 font-medium mb-2",children:["👤 ",$.managerName]}):e.jsx("div",{className:"text-sm text-orange-600 font-medium mb-2",children:"⚠️ No manager assigned"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(me,{className:"w-4 h-4"}),$.employeeCount," employees"]})]},$.id))})]})]}),D&&Yt.createPortal(e.jsx(xr,{isOpen:D,onClose:()=>v(!1),onSuccess:q,userRole:k,employees:f}),document.body)]})});Et.displayName="OrganizationManagementV2";const Is={totalWarnings:0,activeWarnings:0,expiredWarnings:0,pendingReview:0,highRisk:0,expiringSoon:0,byLevel:{verbal:0,first_written:0,second_written:0,final_written:0,suspension:0,dismissal:0},byStatus:{delivered:0,issued:0,acknowledged:0,appealed:0,expired:0},recentActivity:{todayCount:0,weekCount:0,monthCount:0}},_s=()=>{const{user:i}=ye(),[t,r]=p.useState(Is),[s,a]=p.useState(!0),[n,l]=p.useState(null),c=async()=>{if(!i?.organizationId){a(!1);return}try{a(!0),l(null),o.debug("🔔 Loading warnings stats for:",i.organizationId);const d=await pe.warnings.getAll(i.organizationId);o.debug("🔔 Warnings loaded:",d.length);const u=new Date,x=new Date(u.getFullYear(),u.getMonth(),u.getDate()),b=new Date(u.getTime()-10080*60*1e3),f=new Date(u.getTime()-720*60*60*1e3),S=new Date(u.getTime()+720*60*60*1e3),C={totalWarnings:d.length,activeWarnings:0,expiredWarnings:0,pendingReview:0,highRisk:0,expiringSoon:0,byLevel:{verbal:0,first_written:0,second_written:0,final_written:0,suspension:0,dismissal:0},byStatus:{delivered:0,issued:0,acknowledged:0,appealed:0,expired:0},recentActivity:{todayCount:0,weekCount:0,monthCount:0}};d.forEach(w=>{const g=w.issueDate?new Date(w.issueDate):new Date(w.createdAt),h=w.expiryDate?new Date(w.expiryDate):null;(h?h>u:!0)?C.activeWarnings++:C.expiredWarnings++,["final_written","suspension","dismissal"].includes(w.level)&&C.highRisk++,h&&h<=S&&h>u&&C.expiringSoon++,w.level in C.byLevel&&C.byLevel[w.level]++,w.status&&w.status in C.byStatus&&C.byStatus[w.status]++,w.appealSubmitted&&C.pendingReview++,g>=x&&C.recentActivity.todayCount++,g>=b&&C.recentActivity.weekCount++,g>=f&&C.recentActivity.monthCount++}),r(C)}catch(d){o.error("Failed to load warnings stats:",d),l("Failed to load warnings statistics")}finally{a(!1)}},m=async()=>{await c()};return p.useEffect(()=>{let d=!0,u=null;return i?.organizationId?(c(),u=setInterval(()=>{d&&c()},6e4)):a(!1),()=>{d=!1,u&&clearInterval(u)}},[i?.organizationId]),{stats:t,loading:s,error:n,refreshStats:m}},je=({title:i,value:t,subtitle:r,icon:s,color:a,bgColor:n,trend:l,isLoading:c,onClick:m,pulse:d=!1})=>c?e.jsx("div",{className:"bg-white rounded-lg p-3 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-20"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-12"})]}),e.jsx("div",{className:`w-8 h-8 ${n} rounded-lg animate-pulse`})]})}):e.jsx("div",{className:`bg-white rounded-lg p-3 border transition-all duration-200 ${m?"hover:shadow-md cursor-pointer hover:border-gray-300":""}`,onClick:m,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:i}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:`text-2xl font-bold ${a}`,children:t.toLocaleString()}),d&&t>0&&e.jsx("div",{className:`w-2 h-2 ${n.replace("bg-","bg-")} rounded-full animate-pulse`})]}),e.jsx("p",{className:"text-xs text-gray-500",children:r}),l&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsxs("span",{className:`text-xs font-medium ${l.isPositive?"text-green-600":"text-red-600"}`,children:[l.isPositive?"↗":"↘"," ",Math.abs(l.value),"%"]}),e.jsx("span",{className:"text-xs text-gray-400",children:l.label})]})]}),e.jsx("div",{className:`p-2 ${n} rounded-lg`,children:e.jsx(s,{className:`w-8 h-8 ${a}`})})]})}),Gt=({userRole:i,variant:t="detailed",gradientColors:r="from-red-500 to-orange-600",showHeader:s=!0})=>{const{stats:a,loading:n,error:l,refreshStats:c}=_s(),m=()=>i==="business-owner"?xe:Ne,d=()=>i==="business-owner"?"text-purple-600":"text-emerald-600",u=()=>i==="business-owner"?"Warnings Overview":"Warnings Management",x=()=>i==="business-owner"?"Executive summary of disciplinary actions":"Active warnings requiring review and management";return t==="compact"?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-4",children:[s&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:`text-lg font-semibold ${d()} flex items-center gap-2`,children:[Ie.createElement(m(),{className:"w-5 h-5"}),"Warnings"]}),e.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 rounded",disabled:n,children:e.jsx(Qe,{className:`w-4 h-4 ${n?"animate-spin":""}`})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(je,{title:"Active",value:a.activeWarnings,subtitle:"Current warnings",icon:qe,color:"text-green-600",bgColor:"bg-green-100",isLoading:n}),e.jsx(je,{title:"High Risk",value:a.highRisk,subtitle:"Require attention",icon:Ne,color:"text-red-600",bgColor:"bg-red-100",isLoading:n,pulse:a.highRisk>0})]})]}):t==="executive"?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[s&&e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`text-lg font-semibold ${d()} flex items-center gap-2 mb-1`,children:[Ie.createElement(m(),{className:"w-6 h-6"}),u()]}),e.jsx("p",{className:"text-gray-600 text-sm",children:x()})]}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",disabled:n,children:e.jsx(Qe,{className:`w-5 h-5 ${n?"animate-spin":""}`})})]}),l&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Pt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Failed to load warnings data"})]}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(je,{title:"Total Warnings",value:a.totalWarnings,subtitle:"All time",icon:wt,color:"text-gray-700",bgColor:"bg-gray-100",isLoading:n}),e.jsx(je,{title:"Active",value:a.activeWarnings,subtitle:"Currently valid",icon:qe,color:"text-green-600",bgColor:"bg-green-100",isLoading:n}),e.jsx(je,{title:"High Risk",value:a.highRisk,subtitle:"Final/Suspension/Dismissal",icon:Ne,color:"text-red-600",bgColor:"bg-red-100",isLoading:n,pulse:a.highRisk>0}),e.jsx(je,{title:"This Month",value:a.recentActivity.monthCount,subtitle:"Recent activity",icon:Mt,color:"text-blue-600",bgColor:"bg-blue-100",isLoading:n})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Warning Level Distribution"}),e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:a.byLevel.verbal}),e.jsx("div",{className:"text-xs text-gray-600",children:"Verbal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:a.byLevel.first_written}),e.jsx("div",{className:"text-xs text-gray-600",children:"1st Written"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:a.byLevel.second_written}),e.jsx("div",{className:"text-xs text-gray-600",children:"2nd Written"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:a.byLevel.final_written}),e.jsx("div",{className:"text-xs text-gray-600",children:"Final"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:a.byLevel.suspension}),e.jsx("div",{className:"text-xs text-gray-600",children:"Suspension"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a.byLevel.dismissal}),e.jsx("div",{className:"text-xs text-gray-600",children:"Dismissal"})]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[s&&e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`text-lg font-semibold ${d()} flex items-center gap-2 mb-1`,children:[Ie.createElement(m(),{className:"w-6 h-6"}),u()]}),e.jsx("p",{className:"text-gray-600 text-sm",children:x()})]}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",disabled:n,children:e.jsx(Qe,{className:`w-5 h-5 ${n?"animate-spin":""}`})})]}),l&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Pt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Failed to load warnings data"})]}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:l})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(je,{title:"Pending Review",value:a.pendingReview,subtitle:"Require immediate attention",icon:It,color:"text-orange-600",bgColor:"bg-orange-100",isLoading:n,pulse:a.pendingReview>0}),e.jsx(je,{title:"High Risk",value:a.highRisk,subtitle:"Final/Suspension/Dismissal",icon:Ne,color:"text-red-600",bgColor:"bg-red-100",isLoading:n,pulse:a.highRisk>0}),e.jsx(je,{title:"Expiring Soon",value:a.expiringSoon,subtitle:"Within 30 days",icon:It,color:"text-yellow-600",bgColor:"bg-yellow-100",isLoading:n}),e.jsx(je,{title:"Active Total",value:a.activeWarnings,subtitle:"Currently valid",icon:qe,color:"text-green-600",bgColor:"bg-green-100",isLoading:n})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(Hr,{className:"w-5 h-5 text-gray-600"}),"Warning Level Distribution"]}),e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:a.byLevel.verbal}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Verbal"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:a.byLevel.first_written}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"1st Written"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-orange-600",children:a.byLevel.second_written}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"2nd Written"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-red-600",children:a.byLevel.final_written}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Final"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-purple-600",children:a.byLevel.suspension}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Suspension"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900",children:a.byLevel.dismissal}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Dismissal"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5 text-blue-600"}),"Recent Activity"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-700",children:a.recentActivity.todayCount}),e.jsx("div",{className:"text-sm text-blue-600",children:"Today"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-700",children:a.recentActivity.weekCount}),e.jsx("div",{className:"text-sm text-blue-600",children:"This Week"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-700",children:a.recentActivity.monthCount}),e.jsx("div",{className:"text-sm text-blue-600",children:"This Month"})]})]})]})]})},zs=i=>{const[t,r]=p.useState(window.innerWidth>i),s=p.useCallback(()=>r(window.innerWidth>i),[i]);return p.useEffect(()=>(window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)),[s]),t},Kt=[{text:"Leadership is not about being in charge. It's about taking care of those in your charge.",author:"Simon Sinek"},{text:"The growth and development of people is the highest calling of leadership.",author:"Harvey S. Firestone"},{text:"Great leaders don't set out to be a leader... They set out to make a difference.",author:"Jeremy Bravo"},{text:"A good leader takes a little more than his share of the blame, a little less than his share of the credit.",author:"Arnold H. Glasow"},{text:"The task of leadership is not to put greatness into people, but to elicit it, for the greatness is there already.",author:"John Buchan"},{text:"People buy into the leader before they buy into the vision.",author:"John Maxwell"},{text:"Leadership is about making others better as a result of your presence and making sure that impact lasts in your absence.",author:"Sheryl Sandberg"}],Fs=p.memo(({className:i=""})=>{Zt();const{user:t}=ye(),{organization:r}=Fe(),s=zs(768),[a,n]=p.useState(null),{employees:l,warnings:c,metrics:m,error:d}=dr({role:"business_owner"}),u={totalEmployees:l?.length||0,activeWarnings:c?.filter(b=>b.status!=="delivered"&&b.status!=="expired")?.length||0,undeliveredWarnings:c?.filter(b=>!b.delivered&&b.status!=="expired")?.length||0,highSeverityWarnings:c?.filter(b=>(b.severity==="high"||b.category?.severity==="gross_misconduct")&&b.status!=="expired")?.length||0},[x]=p.useState(()=>Kt[Math.floor(Math.random()*Kt.length)]);return s?e.jsxs("div",{className:`${i}`,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Total Employees"}),e.jsx("div",{className:"text-2xl font-bold",children:u.totalEmployees})]})]})}),e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-8 h-8",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Active Warnings"}),e.jsx("div",{className:"text-2xl font-bold",children:u.activeWarnings}),e.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[u.undeliveredWarnings," undelivered"]})]})]})}),e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-8 h-8",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{opacity:.8},children:"High Priority"}),e.jsx("div",{className:"text-2xl font-bold",children:u.highSeverityWarnings}),e.jsx("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:"Critical cases"})]})]})}),e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-8 h-8",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Departments"}),e.jsx("div",{className:"text-2xl font-bold",children:m?.departmentCount||0})]})]})})]}),d&&e.jsx(ps,{variant:"error",className:"mb-4",children:e.jsxs("div",{className:"text-sm",children:["Failed to load dashboard data: ",d]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-6 px-4",children:[{id:"organization",label:"Organization",icon:Ee},{id:"departments",label:"Departments",icon:Ee},{id:"categories",label:"Warning Categories",icon:Ze},{id:"employees",label:"Employees",icon:me},{id:"warnings",label:"Warnings",icon:xe}].map(b=>e.jsxs("button",{onClick:()=>n(b.id),className:`flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium transition-colors ${a===b.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(b.icon,{className:"w-4 h-4"}),b.label]},b.id))})}),e.jsxs("div",{className:"p-4",children:[a==="organization"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Et,{})}),a==="departments"&&r&&e.jsx(Bt,{isOpen:!0,onClose:()=>n("organization"),organizationId:r.id,inline:!0}),a==="categories"&&e.jsx(Ht,{onClose:()=>n("organization"),inline:!0}),a==="employees"&&e.jsx("div",{className:"space-y-4",children:e.jsx(At,{})}),a==="warnings"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-2",children:[e.jsx("div",{className:"bg-orange-50 rounded-lg p-2.5 border border-orange-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:u.undeliveredWarnings}),e.jsx("div",{className:"text-xs text-orange-700 font-medium",children:"Undelivered"})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-2.5 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:u.highSeverityWarnings}),e.jsx("div",{className:"text-xs text-red-700 font-medium",children:"High Severity"})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-2.5 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:u.activeWarnings}),e.jsx("div",{className:"text-xs text-blue-700 font-medium",children:"Total Active"})]})]})})]}),e.jsx(Gt,{userRole:"business-owner",variant:"executive"})]})]})]})]}):e.jsxs("div",{className:`space-y-6 ${i}`,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(me,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Employees"}),e.jsx("span",{className:"text-lg font-bold",children:u.totalEmployees})]})}),e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Active Warnings"}),e.jsx("span",{className:"text-lg font-bold",children:u.activeWarnings})]})}),e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(xe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"High Priority"}),e.jsx("span",{className:"text-lg font-bold",children:u.highSeverityWarnings})]})}),e.jsx(oe,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>n("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Departments"}),e.jsx("span",{className:"text-lg font-bold",children:m?.departmentCount||0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(oe,{padding:"md",shadow:"sm",hover:!0,onClick:()=>n("organization"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Organization"})]}),e.jsx(We,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(oe,{padding:"md",shadow:"sm",hover:!0,onClick:()=>n("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"w-5 h-5",style:{color:"var(--color-info)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Departments"})]}),e.jsx(We,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(oe,{padding:"md",shadow:"sm",hover:!0,onClick:()=>n("categories"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ze,{className:"w-5 h-5",style:{color:"var(--color-warning)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warning Categories"})]}),e.jsx(We,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(oe,{padding:"md",shadow:"sm",hover:!0,onClick:()=>n("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Employees"})]}),e.jsx(We,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(oe,{padding:"md",shadow:"sm",hover:!0,onClick:()=>n("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-5 h-5",style:{color:"var(--color-error)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warnings"})]}),e.jsx(We,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),a==="organization"&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:e.jsxs(oe,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Organization"}),e.jsx(Me,{variant:"ghost",size:"sm",onClick:()=>n(null),children:"×"})]}),e.jsx("div",{className:"overflow-y-auto p-4",children:e.jsx(Et,{})})]})}),a==="departments"&&r&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:e.jsxs(oe,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Departments"}),e.jsx(Me,{variant:"ghost",size:"sm",onClick:()=>n(null),children:"×"})]}),e.jsx("div",{className:"overflow-y-auto",children:e.jsx(Bt,{isOpen:!0,onClose:()=>n(null),organizationId:r.id,inline:!0})})]})}),a==="categories"&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:e.jsxs(oe,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Warning Categories"}),e.jsx(Me,{variant:"ghost",size:"sm",onClick:()=>n(null),children:"×"})]}),e.jsx("div",{className:"overflow-y-auto p-4",children:e.jsx(Ht,{onClose:()=>n(null),inline:!0})})]})}),a==="employees"&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:e.jsxs(oe,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Employees"}),e.jsx(Me,{variant:"ghost",size:"sm",onClick:()=>n(null),children:"×"})]}),e.jsx("div",{className:"overflow-y-auto",children:e.jsx(At,{})})]})}),a==="warnings"&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:e.jsxs(oe,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Warnings Overview"}),e.jsx(Me,{variant:"ghost",size:"sm",onClick:()=>n(null),children:"×"})]}),e.jsx("div",{className:"overflow-y-auto p-4",children:e.jsx(Gt,{userRole:"business-owner",variant:"executive"})})]})})]})});Fs.displayName="BusinessOwnerDashboardSection";export{pe as A,Ye as B,Oe as C,Y as D,At as E,de as F,Ht as G,Fs as H,Vs as I,Ys as J,Gs as K,o as L,rs as M,at as N,dt as O,lr as P,Kr as Q,Bs as R,ee as S,oe as T,Dt as U,Ks as V,ta as W,ss as a,Te as b,Ge as c,y as d,Fe as e,Me as f,Xs as g,Js as h,ps as i,e as j,ea as k,dr as l,Bt as m,as as n,st as o,Jr as p,Ut as q,Qs as r,Gr as s,Zs as t,ye as u,$e as v,Ft as w,Ae as x,Je as y,jt as z};
