import{q as d,L as o}from"./dashboard-components-fvKPXzEF.js";import{l as p,q as v,w,m as h,p as _,x as b}from"./firebase-vendor-Cz3N8Xg7.js";import"./react-vendor-DrdoFN08.js";import"./pdf-vendor-Bp5yZ91a.js";import"./ui-vendor-X12rCvv3.js";import"./warning-components-DfE_qdbY.js";const R=async(g,r,e,i,t,s)=>{try{const a=p(d,"users"),n=v(a,w("organizationId","==",g),w("role","in",r)),m=(await h(n)).docs.map(u=>({userId:u.id,organizationId:g,type:e,title:i,message:t,read:!1,timestamp:_(),data:s||{}})),l=p(d,"notifications"),N=m.map(u=>b(l,u));return await Promise.all(N),m.length}catch(a){throw o.error("Error creating bulk notifications:",a),a}},f=[{event:"warning_needs_delivery",roles:["hr-manager","business-owner"],priority:"warning",title:"Warning Delivery Required",messageTemplate:"Warning for {{employeeName}} ({{warningLevel}}) needs delivery via {{deliveryMethod}}",category:"delivery",actions:[{label:"View Warning",action:"view_warning",variant:"primary"},{label:"Start Delivery",action:"start_delivery",variant:"secondary"}]},{event:"absence_report_submitted",roles:["hr-manager","business-owner"],priority:"info",title:"New Absence Report",messageTemplate:"{{employeeName}} absence report submitted by {{managerName}} - requires HR review",category:"hr_review",actions:[{label:"Review Report",action:"review_absence",variant:"primary"}]},{event:"hr_meeting_requested",roles:["hr-manager","business-owner"],priority:"info",title:"HR Meeting Request",messageTemplate:"{{managerName}} requested HR meeting for {{employeeName}} - {{reason}}",category:"meetings",actions:[{label:"Schedule Meeting",action:"schedule_meeting",variant:"primary"},{label:"View Details",action:"view_request",variant:"secondary"}]},{event:"warning_needs_delivery",roles:["hr-manager","business-owner"],priority:"high",title:"Warning Needs Delivery",messageTemplate:"New {{warningLevel}} warning for {{employeeName}} requires delivery via {{deliveryMethod}}",category:"delivery",actions:[{label:"Process Delivery",action:"process_delivery",variant:"primary"},{label:"View Warning",action:"view_warning",variant:"secondary"}]},{event:"warning_approaching_expiry",roles:["hod-manager","department-manager"],priority:"warning",title:"Warning Expiring Soon",messageTemplate:"{{employeeName}} warning expires in {{daysRemaining}} days - consider follow-up action",category:"follow_up"},{event:"employee_absence_alert",roles:["hod-manager","department-manager"],priority:"info",title:"Employee Absence Alert",messageTemplate:"{{employeeName}} has been absent for {{consecutiveDays}} consecutive days",category:"absence"},{event:"warning_delivered_confirmation",roles:["hod-manager","department-manager"],priority:"success",title:"Warning Delivered",messageTemplate:"Warning for {{employeeName}} has been successfully delivered via {{deliveryMethod}}",category:"confirmation"},{event:"high_severity_warning",roles:["business-owner"],priority:"error",title:"High Severity Warning Issued",messageTemplate:"{{warningLevel}} warning issued to {{employeeName}} - immediate attention required",category:"escalation",actions:[{label:"Review Case",action:"review_case",variant:"danger"}]},{event:"compliance_deadline",roles:["business-owner","hr-manager"],priority:"warning",title:"Compliance Deadline Approaching",messageTemplate:"{{complianceType}} deadline in {{daysRemaining}} days for {{organizationName}}",category:"compliance"},{event:"monthly_report_ready",roles:["business-owner"],priority:"info",title:"Monthly HR Report Available",messageTemplate:"HR disciplinary report for {{monthYear}} is now available for review",category:"reports",actions:[{label:"View Report",action:"view_report",variant:"primary"}]},{event:"system_error",roles:["super-user"],priority:"error",title:"System Error Detected",messageTemplate:"{{errorType}} error in organization {{organizationName}} - {{errorDetails}}",category:"system"},{event:"organization_deployment",roles:["super-user"],priority:"info",title:"Organization Deployment Status",messageTemplate:"Organization {{organizationName}} deployment {{status}} - {{details}}",category:"deployment"},{event:"user_account_issue",roles:["super-user"],priority:"warning",title:"User Account Issue",messageTemplate:"Account issue for {{userName}} in {{organizationName}} - {{issueType}}",category:"user_management"}];class c{static async sendRoleBasedNotification(r,e,i){try{const t=f.find(n=>n.event===e);if(!t)return o.warn(`📭 No notification rule found for event: ${e}`),0;const s=this.processMessageTemplate(t.messageTemplate,i);o.debug(`🔔 Sending ${e} notification to roles:`,t.roles);const a=await R(r,t.roles,t.priority,t.title,s,{event:e,category:t.category,actions:t.actions,...i});return o.success(6887),a}catch(t){throw o.error(`❌ Failed to send role-based notification for event: ${e}`,t),t}}static async sendUserNotification(r,e,i,t,s,a){try{const n=e.map(l=>({userId:l,organizationId:r,type:i,title:t,message:s,read:!1,timestamp:_(),data:a||{}})),y=p(d,"notifications"),m=n.map(l=>b(y,l));await Promise.all(m),o.success(7892)}catch(n){throw o.error("❌ Failed to send user notifications:",n),n}}static async sendSystemNotification(r,e,i,t,s){try{const a=p(d,"users"),n=v(a,w("organizationId","==",r)),m=(await h(n)).docs.map(l=>l.id);await this.sendUserNotification(r,m,e,i,t,s),o.success(8803)}catch(a){throw o.error("❌ Failed to send system notification:",a),a}}static getNotificationRulesForRole(r){return f.filter(e=>e.roles.includes(r))}static getAvailableEvents(){return f.map(r=>r.event)}static processMessageTemplate(r,e){let i=r;for(const[t,s]of Object.entries(e)){const a=`{{${t}}}`;i=i.replace(new RegExp(a,"g"),String(s))}return i}static determinePriority(r,e){if(r)switch(r.toLowerCase()){case"dismissal":case"suspension":return"error";case"final_written":case"final written warning":return"warning";default:return"info"}if(e)switch(e.toLowerCase()){case"critical":case"urgent":return"error";case"high":return"warning";case"low":return"info";default:return"info"}return"info"}}class W{static async warningNeedsDelivery(r,e,i,t){return c.sendRoleBasedNotification(r,"warning_needs_delivery",{employeeName:e,warningLevel:i,deliveryMethod:t})}static async absenceReportSubmitted(r,e,i){return c.sendRoleBasedNotification(r,"absence_report_submitted",{employeeName:e,managerName:i})}static async hrMeetingRequested(r,e,i,t){return c.sendRoleBasedNotification(r,"hr_meeting_requested",{managerName:e,employeeName:i,reason:t})}static async warningApproachingExpiry(r,e,i){return c.sendRoleBasedNotification(r,"warning_approaching_expiry",{employeeName:e,daysRemaining:i})}static async warningDeliveredConfirmation(r,e,i){return c.sendRoleBasedNotification(r,"warning_delivered_confirmation",{employeeName:e,deliveryMethod:i})}static async highSeverityWarning(r,e,i){return c.sendRoleBasedNotification(r,"high_severity_warning",{employeeName:e,warningLevel:i})}static async monthlyReportReady(r,e){return c.sendRoleBasedNotification(r,"monthly_report_ready",{monthYear:e})}static async systemError(r,e,i,t){return c.sendRoleBasedNotification(r,"system_error",{organizationName:e,errorType:i,errorDetails:t})}}export{c as NotificationDeliveryService,W as QuickNotifications};
