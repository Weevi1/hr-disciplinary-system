import{j as e,L as N,u as Ve,q as Ee,t as ze,N as He,A as J}from"./business-owner-dashboard-mIihUYS1.js";import{r}from"./react-vendor-e4uWabrV.js";import{aE as We,L as je,ay as Ye,ar as Xe,aF as Ze,ak as Je,D as ve,Q as Ne,U as ie,w as ce,i as me,I as we,b as ae,f as Ke,N as Qe,a5 as fe,a as le,aG as Re,l as be,X as q,$ as es,aH as ss,F as De,a8 as Ie,ab as ts,a7 as as,M as rs,aI as ls,aJ as is,a4 as ns,a3 as Ue,B as os,af as ds,aK as cs,aL as ms,aq as xs,R as Ae,k as us,A as Te,r as gs,s as ps,g as hs,h as bs}from"./ui-vendor-DaBpJB-Q.js";import{P as Fe}from"./hr-dashboard-lJxKp818.js";import"./pdf-vendor-D1mz_3s2.js";import"./firebase-vendor-ZA7KOHFb.js";import"./warning-components-Bt10jUXa.js";const Se=s=>s?s.deleted?{status:"deleted",message:"This audio recording has been permanently deleted.",canPlay:!1}:s.autoDeleteDate&&new Date>new Date(s.autoDeleteDate)?{status:"expired",message:"This audio recording has expired and is no longer available.",canPlay:!1}:s.processingStatus==="processing"?{status:"processing",message:"Audio is still being processed. Please try again in a moment.",canPlay:!1}:s.processingStatus==="failed"?{status:"failed",message:"Audio processing failed. The recording may be corrupted.",canPlay:!1}:!s.storageUrl&&!s.url?{status:"unavailable",message:"Audio URL is not available. The recording may not have been uploaded properly.",canPlay:!1}:{status:"available",message:"Audio recording is ready to play.",canPlay:!0}:{status:"not-available",message:"Audio recording not available.",canPlay:!1},ys=s=>Se(s).canPlay,fs=s=>Se(s).status==="deleted",js=s=>Se(s).status==="expired",Me=({audioRecording:s,warningId:m,showDownload:i=!0,showMetadata:R=!0,showTranscript:j=!1,compact:I=!1,autoPlay:y=!1,className:k=""})=>{if(!s)return e.jsx("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 ${k}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(We,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"No audio recording available"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Audio recording not found or not provided"})]})]})});const o=r.useRef(null),v=r.useRef(null),[n,u]=r.useState({isLoading:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,error:null,buffered:0}),f=Se(s),d=ys(s),g=fs(s),p=js(s),D=s?.storageUrl||s?.url;r.useEffect(()=>{const a=o.current;if(!a||!d||!D){u(P=>({...P,isLoading:!1,error:d?"No audio URL available":f.message}));return}a.src=D;const h=()=>{u(P=>({...P,isLoading:!0,error:null}))},E=()=>{u(P=>({...P,duration:a.duration||0,isLoading:!1}))},$=()=>{u(P=>({...P,currentTime:a.currentTime||0}))},Q=()=>{u(P=>({...P,isPlaying:!0}))},B=()=>{u(P=>({...P,isPlaying:!1}))},O=()=>{u(P=>({...P,isPlaying:!1,currentTime:0})),a&&(a.currentTime=0)},X=P=>{N.error("Audio loading error:",P),u(H=>({...H,isLoading:!1,isPlaying:!1,error:"Failed to load audio recording. The file may be corrupted or unavailable."}))},ee=()=>{if(a.buffered.length>0){const P=a.buffered.end(a.buffered.length-1),H=a.duration||0;u(re=>({...re,buffered:H?P/H*100:0}))}};return a.addEventListener("loadstart",h),a.addEventListener("loadedmetadata",E),a.addEventListener("timeupdate",$),a.addEventListener("play",Q),a.addEventListener("pause",B),a.addEventListener("ended",O),a.addEventListener("error",X),a.addEventListener("progress",ee),a.load(),()=>{a.removeEventListener("loadstart",h),a.removeEventListener("loadedmetadata",E),a.removeEventListener("timeupdate",$),a.removeEventListener("play",Q),a.removeEventListener("pause",B),a.removeEventListener("ended",O),a.removeEventListener("error",X),a.removeEventListener("progress",ee)}},[d,D,f.message]),r.useEffect(()=>{y&&o.current&&!n.isLoading&&!n.error&&d&&o.current.play().catch(console.warn)},[y,n.isLoading,n.error,d]);const b=r.useCallback(async()=>{const a=o.current;if(!(!a||!d))try{n.isPlaying?a.pause():await a.play()}catch(h){N.error("Playback error:",h),u(E=>({...E,error:"Playback failed. Please try again."}))}},[n.isPlaying,d]),A=r.useCallback(a=>{const h=o.current;h&&d&&(h.currentTime=a)},[d]),w=r.useCallback(a=>{const h=o.current;h&&(h.volume=a,u(E=>({...E,volume:a,isMuted:a===0})))},[]),M=r.useCallback(()=>{const a=o.current;if(a){const h=!n.isMuted;a.muted=h,u(E=>({...E,isMuted:h}))}},[n.isMuted]),L=a=>{if(!a||isNaN(a))return"0:00";const h=Math.floor(a/60),E=Math.floor(a%60);return`${h}:${E.toString().padStart(2,"0")}`},C=a=>a?a>=32e3?"High":a>=16e3?"Standard":"Basic":"Unknown",S=()=>g?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Ke,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Audio Recording Deleted"}),e.jsx("p",{className:"text-red-600 text-sm",children:f.message})]})]}):p?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(ae,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium",children:"Audio Recording Expired"}),e.jsx("p",{className:"text-yellow-600 text-sm",children:f.message})]})]}):f.status==="processing"?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"Processing Audio"}),e.jsx("p",{className:"text-blue-600 text-sm",children:f.message})]})]}):f.status==="failed"||f.status==="unavailable"?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(Qe,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Audio Unavailable"}),e.jsx("p",{className:"text-red-600 text-sm",children:f.message})]})]}):null;return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${k}`,children:[d&&D&&e.jsx("audio",{ref:o,preload:"metadata"}),S(),d&&!n.error&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:b,disabled:n.isLoading,className:"flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",title:n.isPlaying?"Pause":"Play",children:n.isLoading?e.jsx(je,{className:"w-5 h-5 animate-spin"}):n.isPlaying?e.jsx(Ye,{className:"w-5 h-5"}):e.jsx(Xe,{className:"w-5 h-5 ml-1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{ref:v,className:"relative h-2 bg-gray-200 rounded-full cursor-pointer",onClick:a=>{if(v.current&&n.duration){const h=v.current.getBoundingClientRect(),E=(a.clientX-h.left)/h.width;A(E*n.duration)}},children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 rounded-full",style:{width:`${n.buffered}%`}}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full",style:{width:n.duration?`${n.currentTime/n.duration*100}%`:"0%"}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:L(n.currentTime)}),e.jsx("span",{children:L(n.duration)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:M,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:n.isMuted?"Unmute":"Mute",children:n.isMuted?e.jsx(Ze,{className:"w-4 h-4"}):e.jsx(Je,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:n.isMuted?0:n.volume,onChange:a=>w(parseFloat(a.target.value)),className:"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Volume"})]}),i&&D&&e.jsx("button",{onClick:()=>{const a=document.createElement("a");a.href=D,a.download=`warning-audio-${s.recordingId||"recording"}.webm`,a.click()},className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Download Audio",children:e.jsx(ve,{className:"w-4 h-4"})})]})}),R&&!I&&d&&!n.error&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(Ne,{className:"w-3 h-3"}),"Duration"]}),e.jsx("p",{className:"font-medium",children:L(s.duration||0)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(We,{className:"w-3 h-3"}),"Quality"]}),e.jsx("p",{className:"font-medium",children:C(s.bitrate)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),"Recorded By"]}),e.jsx("p",{className:"font-medium",children:s.recordedByName||"Manager"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Recorded"]}),e.jsx("p",{className:"font-medium",children:s.startTime?new Date(s.startTime).toLocaleDateString():"Unknown"})]})]}),s.consentGiven&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-green-700 bg-green-50 px-3 py-2 rounded-lg",children:[e.jsx(me,{className:"w-3 h-3"}),e.jsx("span",{children:"Recording consent was obtained from all participants"})]}),s.autoDeleteDate&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-lg",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsxs("span",{children:["This recording will be automatically deleted on"," ",new Date(s.autoDeleteDate).toLocaleDateString()]})]})]}),n.error&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:n.error})]})})]})},vs=({signature:s,title:m,subtitle:i,isOpen:R,onClose:j,allowDownload:I=!0})=>{const y=r.useCallback(()=>{try{const o=atob(s.split(",")[1]),v=new Array(o.length);for(let g=0;g<o.length;g++)v[g]=o.charCodeAt(g);const n=new Uint8Array(v),u=new Blob([n],{type:"image/png"}),f=URL.createObjectURL(u),d=document.createElement("a");d.href=f,d.download=`${m.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(f)}catch(o){N.error("Signature download failed:",o)}},[s,m]),k=r.useCallback(async()=>{try{await navigator.clipboard.writeText(s)}catch(o){N.error("Failed to copy signature:",o)}},[s]);return R?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:m}),i&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i})]}),e.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:e.jsx("img",{src:s,alt:m,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:k,className:"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4"}),"Copy Data"]}),I&&e.jsxs("button",{onClick:y,className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Download"]})]})]})]})}):null},Ns=({signatures:s,warningId:m,showTimestamps:i=!0,compact:R=!1,showVerification:j=!0,allowDownload:I=!0,className:y=""})=>{const[k,o]=r.useState(null),v=w=>{if(!w)return!1;try{return w.startsWith("data:image/")&&w.includes("base64,")}catch{return!1}},n=v(s.manager),u=v(s.employee),f=n&&u,d=r.useCallback((w,M,L)=>{o({signature:w,title:M,subtitle:L})},[]),g=r.useCallback(()=>{o(null)},[]),p=w=>{if(!w)return"Not signed";try{return new Date(w).toLocaleString()}catch{return"Invalid timestamp"}},b=f?{status:"complete",message:"Document fully signed",color:"text-green-600 bg-green-50 border-green-200",icon:le}:n||u?{status:"partial",message:"Signatures pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:Ne}:{status:"missing",message:"No signatures collected",color:"text-gray-600 bg-gray-50 border-gray-200",icon:ae},A=b.icon;return R?e.jsxs("div",{className:`inline-flex items-center gap-2 ${y}`,children:[e.jsx(A,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:f?"✓ Signed":"⏳ Pending"}),f&&e.jsx("button",{onClick:()=>d(s.manager,"Digital Signatures","Manager and Employee"),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View"})]}):e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${y}`,children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(fe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Electronic authorization and acknowledgment"})]})]}),j&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${b.color}`,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:b.message})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Manager"}),n&&e.jsx(le,{className:"w-4 h-4 text-green-500"})]}),n&&e.jsx("button",{onClick:()=>d(s.manager,"Manager Signature",s.managerName||"Warning Issuer"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:e.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),n?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:e.jsx("img",{src:s.manager,alt:"Manager Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-3 h-3"}),e.jsx("span",{children:s.managerName||"Manager"})]}),i&&s.managerTimestamp&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:p(s.managerTimestamp)})]})]})]}):e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(ie,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting manager signature"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Employee"}),u&&e.jsx(le,{className:"w-4 h-4 text-green-500"})]}),u&&e.jsx("button",{onClick:()=>d(s.employee,"Employee Signature",s.employeeName||"Warning Recipient"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:e.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:e.jsx("img",{src:s.employee,alt:"Employee Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-3 h-3"}),e.jsx("span",{children:s.employeeName||"Employee"})]}),i&&s.employeeTimestamp&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:p(s.employeeTimestamp)})]})]})]}):e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(be,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting employee acknowledgment"})]})]})]})}),f&&e.jsx("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Document Digitally Signed & Verified"}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["These digital signatures are legally binding and comply with electronic signature regulations.",m&&` Document ID: ${m}`]})]}),I&&e.jsx("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download signatures",children:e.jsx(ve,{className:"w-4 h-4"})})]})}),!f&&(n||u)&&e.jsx("div",{className:"bg-yellow-50 border-t border-yellow-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Signature Collection In Progress"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Document requires signatures from both manager and employee to be legally complete."})]})]})}),k&&e.jsx(vs,{signature:k.signature,title:k.title,subtitle:k.subtitle,isOpen:!0,onClose:g,allowDownload:I})]})},U=(s,m="Not specified")=>s==null?m:typeof s=="string"?s:typeof s=="number"?s.toString():typeof s=="boolean"?s?"Yes":"No":m,K=(s,m="Not set")=>{if(!s)return m;try{return(s instanceof Date?s:new Date(s)).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return m}},ws=(s,m)=>{const i=K(s,"");return!i||i==="Not set"?"Not specified":m?`${i} at ${m}`:i},Oe=(s,m)=>{const i={verbal:{primary:"bg-blue-600",secondary:"bg-blue-50",accent:"text-blue-600",background:"bg-blue-50",text:"text-blue-800",border:"border-blue-200"},written:{primary:"bg-yellow-600",secondary:"bg-yellow-50",accent:"text-yellow-600",background:"bg-yellow-50",text:"text-yellow-800",border:"border-amber-200"},final:{primary:"bg-red-600",secondary:"bg-red-50",accent:"text-red-600",background:"bg-red-50",text:"text-red-800",border:"border-red-200"},dismissal:{primary:"bg-red-700",secondary:"bg-red-50",accent:"text-red-700",background:"bg-red-50",text:"text-red-900",border:"border-red-300"}};return i[s]||i.verbal},Ds=({warning:s,isOpen:m,onClose:i,canTakeAction:R=!1,userRole:j="viewer",className:I="",onApprove:y,onReject:k,onAppealOutcome:o,canManageAppeals:v=!1})=>{const[n,u]=r.useState("overview"),[f,d]=r.useState(new Set(["summary"])),[g,p]=r.useState({type:null,loading:!1}),[D,b]=r.useState(!1),[A,w]=r.useState(""),[M,L]=r.useState(!1),[C,S]=r.useState(!1),[a,h]=r.useState(!1),[E,$]=r.useState(!1),[Q,B]=r.useState(!1),[O,X]=r.useState(null),[ee,P]=r.useState(!1),[H,re]=r.useState(null),[Pe,Le]=r.useState(""),[xe,ne]=r.useState(!1),oe=r.useRef(null),de=r.useRef(null),l=r.useMemo(()=>s?{id:s.id||"",employeeName:U(s.employeeName),employeeNumber:U(s.employeeNumber),department:U(s.department),position:U(s.position),category:U(s.category),level:s.level||"verbal",status:s.status||"issued",incidentDate:K(s.incidentDate),incidentTime:U(s.incidentTime),incidentDateTime:ws(s.incidentDate,s.incidentTime),incidentLocation:U(s.incidentLocation),description:U(s.description),issueDate:K(s.issueDate),expiryDate:K(s.expiryDate),issuedByName:U(s.issuedByName),deliveryMethod:U(s.deliveryMethod),additionalNotes:U(s.additionalNotes),hasAudio:!!s.audioRecording?.url,audioRecording:s.audioRecording||null,hasPDF:!!(s.pdfGenerated||s.pdfFilename),hasSignatures:!!(s.signatures&&Object.keys(s.signatures).length>0),signatures:s.signatures||{manager:null,employee:null},validityPeriod:s.validityPeriod||6,escalationReason:U(s.escalationReason),acknowledgedAt:s.acknowledgedAt?K(s.acknowledgedAt):null,acknowledgedBy:U(s.acknowledgedBy),appealSubmitted:!!s.appealSubmitted,appealDate:s.appealDate?K(s.appealDate):null,createdAt:K(s.createdAt),updatedAt:K(s.updatedAt)}:null,[s]),Y=r.useMemo(()=>l?Oe(l.level,l.status):Oe("verbal"),[l]),z=r.useCallback(()=>{L(!0),setTimeout(()=>{i(),L(!1),u("overview"),d(new Set(["summary"])),p({type:null,loading:!1}),b(!1),w(""),h(!1),$(!1),B(!1),X(null)},300)},[i]);r.useCallback(x=>{d(_=>{const G=new Set(_);return G.has(x)?G.delete(x):G.add(x),G})},[]);const ue=r.useCallback(async()=>{if(!(!y||!l?.id)){p({type:"approve",loading:!0});try{await y(l.id),setTimeout(z,1e3)}catch(x){N.error("Failed to approve warning:",x),p({type:null,loading:!1})}}},[y,l?.id,z]),ge=r.useCallback(async()=>{if(!(!k||!l?.id)){p({type:"reject",loading:!0});try{await k(l.id,A),setTimeout(z,1e3)}catch(x){N.error("Failed to reject warning:",x),p({type:null,loading:!1})}}},[k,l?.id,A,z]),V=r.useCallback(()=>{b(!0)},[]),pe=r.useCallback(()=>{l?.hasAudio&&B(!0)},[l?.hasAudio]),Ce=r.useCallback(()=>{h(!0)},[]),he=r.useCallback(()=>{l?.hasSignatures&&$(!0)},[l?.hasSignatures]),se=r.useCallback(x=>{if(!l?.signatures)return;const _=l.signatures[x];_&&(X({signature:_,title:`${x.charAt(0).toUpperCase()+x.slice(1)} Signature`,subtitle:`Warning ID: ${l.id} • ${l.employeeName}`}),$(!0))},[l]);return!m||!l?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:de,className:`
          fixed inset-0 z-40 flex items-center justify-center p-4
          bg-black/60 backdrop-blur-xl
          transition-all duration-500 ease-out
          ${M?"opacity-0":"opacity-100"}
          ${I}
        `,onClick:x=>x.target===de.current&&z(),children:e.jsxs("div",{ref:oe,className:`
            relative w-full max-w-4xl max-h-[90vh] 
            bg-white rounded-lg shadow-xl border border-gray-200
            overflow-hidden
            transition-all duration-300 ease-out
            ${M?"scale-95 opacity-0":"scale-100 opacity-100"}
          `,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                w-10 h-10 rounded-lg ${Y.primary}
                flex items-center justify-center
              `,children:e.jsx(me,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.employeeName," • ",l.category]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-medium rounded-full ${l.level==="verbal"?"bg-blue-100 text-blue-800":l.level==="written"?"bg-yellow-100 text-yellow-800":l.level==="final"?"bg-red-100 text-red-800":l.level==="dismissal"?"bg-red-200 text-red-900":"bg-gray-100 text-gray-800"}`,children:l.level==="verbal"?"Verbal Warning":l.level==="written"?"Written Warning":l.level==="final"?"Final Warning":l.level==="dismissal"?"Dismissal":"Warning"}),e.jsx("button",{onClick:z,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Incident Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:l.incidentDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Location:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:l.incidentLocation})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-600"}),"Employee Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.employeeName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.employeeNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Position:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.position})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Department:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.department})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-gray-600"}),"Warning Timeline"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.issueDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.expiryDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Issued By:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.issuedByName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ${l.deliveryStatus==="delivered"?"text-green-600":"text-orange-600"}`,children:l.deliveryStatus==="delivered"?"Delivered":"Pending Delivery"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.hasAudio&&e.jsxs("button",{onClick:pe,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",children:[e.jsx(ss,{className:"w-4 h-4"}),"Audio Recording"]}),e.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm",children:[e.jsx(De,{className:"w-4 h-4"}),"View PDF"]}),l.hasSignatures&&e.jsxs("button",{onClick:he,className:"flex items-center gap-2 px-3 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm",children:[e.jsx(fe,{className:"w-4 h-4"}),"Signatures"]})]}),R&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:V,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"Reject"}),e.jsx("button",{onClick:ue,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Approve"})]})]})]})}),D&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reject Warning"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please provide a reason for rejecting this warning:"}),e.jsx("textarea",{value:A,onChange:x=>w(x.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Enter rejection reason..."}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 font-medium transition-colors text-sm",children:"Cancel"}),e.jsx("button",{onClick:ge,disabled:!A.trim()||g.loading,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 font-medium transition-colors text-sm",children:g.loading?"Processing...":"Reject Warning"})]})]})})]})}),Q&&l?.hasAudio&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),e.jsx("button",{onClick:()=>B(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(Me,{audioData:l.audioRecording,compact:!1})})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("button",{onClick:()=>$(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:l?.hasSignatures?e.jsxs("div",{className:"space-y-4",children:[l.signatures?.manager&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Manager Signature"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:e.jsx("img",{src:l.signatures.manager,alt:"Manager Signature",className:"max-w-full h-20 mx-auto"})})]}),l.signatures?.employee&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Employee Signature"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:e.jsx("img",{src:l.signatures.employee,alt:"Employee Signature",className:"max-w-full h-20 mx-auto"})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),e.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),a&&e.jsx(Fe,{isOpen:a,onClose:()=>h(!1),warningData:{selectedEmployee:{id:s.employeeId||"",firstName:s.employeeName||"Unknown",lastName:s.employeeLastName||"Employee",employeeId:s.employeeNumber||"",employeeNumber:s.employeeNumber||"",department:s.employeeDepartment||s.department||"",position:s.employeePosition||s.position||"",email:s.employeeEmail||""},selectedCategory:{id:s.categoryId||"",name:s.categoryName||s.category||"General",severity:"medium",description:s.categoryName||s.category||"General"},formData:{incidentDate:s.incidentDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0],incidentTime:s.incidentTime||"12:00",incidentLocation:s.incidentLocation||"",incidentDescription:s.incidentDescription||s.description||"",additionalNotes:s.additionalNotes||"",validityPeriod:s.validityPeriod||6,issueDate:s.issueDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0]},signatures:s.signatures||{manager:null,employee:null},lraRecommendation:{category:s.categoryName||s.category||"General",recommendedLevel:s.level||"Counselling Session",suggestedLevel:s.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:s.organizationId||""},onPDFGenerated:(x,_)=>{N.debug("PDF generated:",_);const G=URL.createObjectURL(x),T=document.createElement("a");T.href=G,T.download=_,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(G)}}),a&&e.jsx(Fe,{isOpen:a,onClose:()=>h(!1),warningData:{selectedEmployee:{id:s.employeeId||"",firstName:s.employeeName||"Unknown",lastName:s.employeeLastName||"Employee",employeeId:s.employeeNumber||"",employeeNumber:s.employeeNumber||"",department:s.employeeDepartment||s.department||"",position:s.employeePosition||s.position||"",email:s.employeeEmail||""},selectedCategory:{id:s.categoryId||"",name:s.categoryName||s.category||"General",severity:"medium",description:s.categoryName||s.category||"General"},formData:{incidentDate:s.incidentDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0],incidentTime:s.incidentTime||"12:00",incidentLocation:s.incidentLocation||"",incidentDescription:s.incidentDescription||s.description||"",additionalNotes:s.additionalNotes||"",validityPeriod:s.validityPeriod||6,issueDate:s.issueDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0]},signatures:s.signatures||{manager:null,employee:null},lraRecommendation:{category:s.categoryName||s.category||"General",recommendedLevel:s.level||"Counselling Session",suggestedLevel:s.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:s.organizationId||""},onPDFGenerated:(x,_)=>{N.debug("PDF generated:",_),console.log("Warning data for PDF:",{categoryName:s.categoryName,category:s.category,signatures:s.signatures});const G=URL.createObjectURL(x),T=document.createElement("a");T.href=G,T.download=_,document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(G)}}),Q&&l?.hasAudio&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",l.id," • ",l.employeeName]})]}),e.jsx("button",{onClick:()=>B(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(Me,{audioRecording:l.audioRecording,warningId:l.id,showDownload:!0,showMetadata:!0,className:"w-full"})})]})}),E&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",l.id," • ",l.employeeName]})]}),e.jsx("button",{onClick:()=>$(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:l?.hasSignatures?e.jsxs(e.Fragment,{children:[e.jsx(Ns,{signatures:l.signatures,warningId:l.id,showTimestamps:!0,showVerification:!0,allowDownload:!0,className:"w-full mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[l.signatures.manager&&e.jsxs("button",{onClick:()=>se("manager"),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"View Manager Signature"})]}),l.signatures.employee&&e.jsxs("button",{onClick:()=>se("employee"),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[e.jsx(Ie,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"View Employee Signature"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),e.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:O.title}),O.subtitle&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:O.subtitle})]}),e.jsx("button",{onClick:()=>X(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:e.jsx("img",{src:O.signature,alt:O.title,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),e.jsxs("button",{onClick:()=>{const x=document.createElement("a");x.href=O.signature,x.download=`${O.title.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(x),x.click(),document.body.removeChild(x)},className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"Download PNG"]})]})]})})]})},Ss={email:{icon:rs,name:"Email",color:"blue",requiresProof:!0,instructions:["Send the warning document via email","Take a screenshot of the sent email","Include timestamp and recipient email visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Chrome: Press Ctrl + Shift + Alt + 3"]},whatsapp:{icon:as,name:"WhatsApp Business",color:"green",requiresProof:!0,instructions:["Send the warning document via WhatsApp Business","Wait for delivery confirmation (double blue ticks)","Take a screenshot showing the sent message","Include timestamp and delivery status visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Phone: Use screenshot function (varies by device)"]},printed:{icon:ts,name:"Print & Hand Delivery",color:"purple",requiresProof:!1,instructions:["Print the warning document","Hand deliver to the employee","Get employee acknowledgment signature on physical copy","File the signed copy in employee records","Confirm delivery completion below"]}},Cs=({isOpen:s,onClose:m,warningId:i,employeeName:R,deliveryMethod:j,onDeliveryConfirmed:I})=>{const[y,k]=r.useState(null),[o,v]=r.useState(null),[n,u]=r.useState(!1),[f,d]=r.useState(null),g=r.useRef(null),p=Ss[j],D=r.useCallback(C=>{const S=C.target.files?.[0];if(!S)return;if(!S.type.startsWith("image/")){d("Please select an image file (PNG, JPG, etc.)");return}if(S.size>5*1024*1024){d("Image must be less than 5MB");return}d(null),k(S);const a=new FileReader;a.onload=h=>{v(h.target?.result)},a.readAsDataURL(S)},[]),b=r.useCallback(C=>{C.preventDefault(),C.stopPropagation()},[]),A=r.useCallback(C=>{C.preventDefault(),C.stopPropagation();const S=C.dataTransfer.files;if(S.length>0){const a=S[0];a.type.startsWith("image/")&&D({target:{files:[a]}})}},[D]),w=r.useCallback(async()=>{if(p.requiresProof&&!y){d("Please upload proof of delivery screenshot");return}u(!0),d(null);try{await I({warningId:i,deliveryMethod:j,deliveredAt:new Date,proofImage:y||void 0})}catch(C){d(C instanceof Error?C.message:"Failed to confirm delivery")}finally{u(!1)}},[p.requiresProof,y,I,i,j]),M=r.useCallback(()=>{k(null),v(null),g.current&&(g.current.value="")},[]);if(!s)return null;const L=p.icon;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:`bg-gradient-to-r from-${p.color}-600 to-${p.color}-700 p-6 text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(L,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Confirm Delivery"}),e.jsxs("p",{className:"text-sm opacity-90",children:[p.name," delivery for ",R]})]})]}),e.jsx("button",{onClick:m,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Delivery Instructions"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("ol",{className:"space-y-2",children:p.instructions.map((C,S)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[e.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:S+1}),e.jsx("span",{className:"text-gray-700",children:C})]},S))})})]}),p.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ls,{className:"w-4 h-4 text-gray-600"}),"Screenshot Instructions"]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:p.screenshotTips?.map((C,S)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("kbd",{className:"bg-gray-200 px-2 py-1 rounded text-xs font-mono",children:C.split(": ")[1]}),e.jsx("span",{className:"text-xs",children:C.split(": ")[0]})]},S))})})]}),p.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Upload Proof of Delivery"}),y?e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[o&&e.jsx("img",{src:o,alt:"Proof of delivery",className:"w-24 h-24 object-cover rounded-lg border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:y.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(y.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:M,className:"text-red-600 hover:text-red-700 p-1",children:e.jsx(q,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(le,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Ready to upload"})]})]})]})}):e.jsxs("div",{onDragOver:b,onDrop:A,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onClick:()=>g.current?.click(),children:[e.jsx(is,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Drop screenshot here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG up to 5MB"}),e.jsx("input",{ref:g,type:"file",accept:"image/*",onChange:D,className:"hidden"})]})]}),f&&e.jsx("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:f})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:m,disabled:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:n||p.requiresProof&&!y,className:`flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-${p.color}-600 to-${p.color}-700 hover:from-${p.color}-700 hover:to-${p.color}-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:n?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4 animate-spin"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-4 h-4"}),"Confirm Delivery"]})})]})]})]})})},ks=[{value:"procedural_unfair",label:"Procedural Unfairness",description:"The disciplinary process was not followed correctly"},{value:"substantive_unfair",label:"Substantive Unfairness",description:"The warning was not justified by the facts"},{value:"bias_prejudice",label:"Bias or Prejudice",description:"The decision was influenced by bias or unfair treatment"},{value:"insufficient_evidence",label:"Insufficient Evidence",description:"Not enough evidence to support the warning"},{value:"inconsistent_treatment",label:"Inconsistent Treatment",description:"Others were treated differently for similar conduct"},{value:"other",label:"Other Grounds",description:"Different reason (explain in details below)"}],As=({isOpen:s,onClose:m,warning:i,onAppealSubmit:R})=>{const[j,I]=r.useState(""),[y,k]=r.useState(""),[o,v]=r.useState(""),[n,u]=r.useState(!1),[f,d]=r.useState(null),g=i.issueDate?.seconds?new Date(i.issueDate.seconds*1e3):new Date(i.issueDate),p=new Date(g);p.setDate(p.getDate()+30);const D=r.useCallback(async()=>{if(!j){d("Please select grounds for your appeal");return}if(!y.trim()){d("Please provide details explaining your appeal");return}if(!o.trim()){d("Please specify what outcome you are requesting");return}u(!0),d(null);try{await R({warningId:i.id,grounds:j,additionalDetails:y.trim(),requestedOutcome:o.trim()})}catch(b){d(b instanceof Error?b.message:"Failed to submit appeal")}finally{u(!1)}},[j,y,o,R,i.id]);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-600 to-orange-700 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(De,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Appeal Disciplinary Warning"}),e.jsx("p",{className:"text-sm opacity-90",children:"Submit formal appeal as per Labour Relations Act"})]})]}),e.jsx("button",{onClick:m,disabled:n,className:"p-2 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(q,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),"Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Employee:"}),e.jsx("div",{className:"font-medium",children:i.employeeName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Warning Level:"}),e.jsx("div",{className:"font-medium capitalize",children:i.level.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("div",{className:"font-medium",children:i.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("div",{className:"font-medium",children:g.toLocaleDateString()})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Description:"}),e.jsx("div",{className:"text-sm mt-1 p-2 bg-white rounded border",children:i.description})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(we,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-800 font-medium mb-2",children:"Your Appeal Rights"}),e.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs",children:[e.jsxs("li",{children:["• Appeals must be submitted within ",e.jsx("strong",{children:"30 days"})," of the warning (deadline: ",p.toLocaleDateString(),")"]}),e.jsx("li",{children:"• You have the right to fair treatment under the Labour Relations Act"}),e.jsx("li",{children:"• All internal procedures must be exhausted before CCMA referral"}),e.jsx("li",{children:"• You may be assisted by a shop steward or fellow employee"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Grounds for Appeal *"}),e.jsx("div",{className:"space-y-2",children:ks.map(b=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"appealGrounds",value:b.value,checked:j===b.value,onChange:A=>I(A.target.value),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:b.label}),e.jsx("div",{className:"text-xs text-gray-600",children:b.description})]})]},b.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Appeal Details *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Explain in detail why you believe the warning is unfair and what evidence supports your appeal."}),e.jsx("textarea",{value:y,onChange:b=>k(b.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"Provide specific facts, dates, witnesses, and any other relevant information that supports your appeal..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Requested Outcome *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Specify what you would like to happen if your appeal is successful."}),e.jsx("textarea",{value:o,onChange:b=>v(b.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"E.g., 'Remove warning from my record', 'Reduce warning level', 'Replace with verbal counselling', etc."})]})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:f})]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsxs("span",{children:["Appeal deadline: ",p.toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:m,disabled:n,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:n||!j||!y.trim()||!o.trim(),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-600 to-orange-700 hover:from-amber-700 hover:to-orange-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4 animate-spin"}),"Submitting Appeal..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4"}),"Submit Appeal"]})})]})]})]})}):null},Ps=[{value:"upheld",label:"Uphold Warning",icon:me,color:"text-green-600",bgColor:"bg-green-50",description:"Warning is justified and remains unchanged"},{value:"reduced",label:"Reduce Warning Level",icon:ms,color:"text-orange-600",bgColor:"bg-orange-50",description:"Warning is justified but level should be reduced"},{value:"modified",label:"Modify Warning",icon:xs,color:"text-blue-600",bgColor:"bg-blue-50",description:"Warning content needs modification"},{value:"overturned",label:"Overturn Warning",icon:Ae,color:"text-red-600",bgColor:"bg-red-50",description:"Warning is not justified and should be removed"}],ye=[{value:"counselling",label:"Counselling",severity:1},{value:"verbal",label:"Verbal Warning",severity:2},{value:"first_written",label:"First Written Warning",severity:3},{value:"second_written",label:"Second Written Warning",severity:4},{value:"final_written",label:"Final Written Warning",severity:5}],Ls={procedural_unfair:"Procedural Unfairness",substantive_unfair:"Substantive Unfairness",bias_prejudice:"Bias or Prejudice",insufficient_evidence:"Insufficient Evidence",inconsistent_treatment:"Inconsistent Treatment",other:"Other Grounds"},Es=({isOpen:s,onClose:m,warning:i,onDecisionSubmit:R})=>{const[j,I]=r.useState(""),[y,k]=r.useState(""),[o,v]=r.useState(""),[n,u]=r.useState(i.level),[f,d]=r.useState(i.description),[g,p]=r.useState(!1),[D,b]=r.useState(""),[A,w]=r.useState(!1),M=a=>a?(a.toDate?a.toDate():new Date(a)).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}):"Unknown",L=r.useCallback(async()=>{if(!j||!y.trim()){alert("Please select a decision and provide reasoning.");return}w(!0);try{await R({warningId:i.id,decision:j,reasoning:y.trim(),newLevel:j==="reduced"||j==="modified"?n:void 0,newDescription:j==="modified"?f:void 0,hrNotes:o.trim(),followUpRequired:g,followUpDate:g&&D?new Date(D):void 0}),m()}catch(a){console.error("Failed to submit appeal decision:",a),alert("Failed to submit decision. Please try again.")}finally{w(!1)}},[j,y,o,n,f,g,D,i.id,R,m]),C=ye.find(a=>a.value===i.level)?.severity||0,S=ye.filter(a=>a.severity<C);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Ue,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Appeal Review"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review and decide on employee appeal"})]})]}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-gray-600"}),"Original Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Employee:"}),e.jsxs("span",{className:"text-sm",children:[i.employeeName," (",i.employeeNumber,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Department:"}),e.jsx("span",{className:"text-sm",children:i.department})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Issue Date:"}),e.jsx("span",{className:"text-sm",children:M(i.issueDate)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Category:"}),e.jsx("span",{className:"text-sm ml-2",children:i.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Level:"}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${i.level==="final_written"?"bg-red-100 text-red-800":i.level==="second_written"?"bg-orange-100 text-orange-800":i.level==="first_written"?"bg-yellow-100 text-yellow-800":i.level==="verbal"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:ye.find(a=>a.value===i.level)?.label||i.level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Description:"}),e.jsx("p",{className:"text-sm mt-1 text-gray-700",children:i.description})]})]})]})]}),i.appealDetails&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5 text-blue-600"}),"Employee's Appeal"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Appeal Grounds:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:Ls[i.appealDetails.grounds]||i.appealDetails.grounds})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee's Statement:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:i.appealDetails.additionalDetails})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Outcome:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:i.appealDetails.requestedOutcome})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[e.jsxs("span",{children:["Submitted: ",M(i.appealDetails.submittedDate)]}),e.jsxs("span",{children:["By: ",i.appealDetails.submittedBy]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5 text-gray-600"}),"HR Decision"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:Ps.map(a=>{const h=a.icon;return e.jsx("button",{onClick:()=>I(a.value),className:`p-4 rounded-lg border-2 transition-all ${j===a.value?`border-purple-500 ${a.bgColor}`:"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:`w-5 h-5 ${a.color}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-sm",children:a.label}),e.jsx("div",{className:"text-xs text-gray-600",children:a.description})]})]})},a.value)})}),(j==="reduced"||j==="modified")&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:j==="reduced"?"Reduce to Level:":"New Warning Level:"}),e.jsx("select",{value:n,onChange:a=>u(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:j==="reduced"?S.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value)):ye.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),j==="modified"&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modified Warning Description:"}),e.jsx("textarea",{value:f,onChange:a=>d(a.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Enter the modified warning description..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Decision Reasoning (Legal Documentation)"]}),e.jsx("textarea",{value:y,onChange:a=>k(a.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Provide detailed reasoning for your decision. This will be part of the legal record and may be reviewed by labor courts or CCMA...",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Internal Notes (Optional)"}),e.jsx("textarea",{value:o,onChange:a=>v(a.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Internal notes for HR records (not shared with employee)..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:a=>p(a.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Follow-up Required"})]}),g&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date:"}),e.jsx("input",{type:"date",value:D,onChange:a=>b(a.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{children:"This decision will be automatically documented and employee will be notified"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:L,disabled:!j||!y.trim()||A,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors flex items-center gap-2",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(us,{className:"w-4 h-4"}),"Submit Decision"]})})]})]})]})}):null},te=(s,m="Unknown")=>s==null?m:typeof s=="string"?s:typeof s=="number"?s.toString():typeof s=="boolean"?s?"Yes":"No":s instanceof Date?s.toLocaleDateString():typeof s=="object"?s.name?String(s.name):s.title?String(s.title):s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:m:String(s),ke=s=>{if(!s.issueDate)return!1;const m=s.issueDate.seconds?new Date(s.issueDate.seconds*1e3):new Date(s.issueDate),i=new Date(m);return i.setDate(i.getDate()+30),new Date<=i},Us=({organizationId:s,onClose:m,PDFGenerationService:i,DataService:R,canTakeAction:j=!1,userRole:I="viewer"})=>{const{user:y,organization:k}=Ve(),o=s||k?.id;N.debug("🔧 [WarningsReviewDashboard] Using API layer version");const[v,n]=r.useState([]),[u,f]=r.useState([]),[d,g]=r.useState(!0),[p,D]=r.useState(null),[b,A]=r.useState(1),[w,M]=r.useState(""),[L,C]=r.useState("all"),[S,a]=r.useState("all"),[h,E]=r.useState("all"),[$,Q]=r.useState("date"),[B,O]=r.useState("desc"),[X,ee]=r.useState(null),[P,H]=r.useState(!1),[re,Pe]=r.useState(!1),[Le,xe]=r.useState(!1),[ne,oe]=r.useState(null),[de,l]=r.useState(!1),[Y,z]=r.useState(null),[ue,ge]=r.useState(!1),[V,pe]=r.useState(null),[Ce,he]=r.useState("warnings"),se=10,x=r.useCallback(async()=>{if(!o){N.warn("No organization ID available for loading warnings"),g(!1);return}try{g(!0),D(null);let t;Ee()?(N.debug("🔄 Loading warnings via NestedDataService for org:",o),ze()?(t=(await He.getOrganizationWarnings(o,{},{pageSize:500,orderField:"issueDate",orderDirection:"desc"})).warnings,N.debug(`📁 [NESTED] Loaded ${t.length} warnings via collection group`)):(N.debug("📋 [FALLBACK] Collection group disabled, using flat structure"),t=await J.warnings.getAll(o))):(N.debug("🔄 Loading warnings via API layer for org:",o),t=await J.warnings.getAll(o));const W=t.filter(F=>!F.isArchived&&F.status!=="expired"&&F.status!=="overturned").sort((F,Z)=>new Date(Z.createdAt||0).getTime()-new Date(F.createdAt||0).getTime());n(W),f(W),N.success(`📊 Loaded ${W.length} active warnings (${Ee()?"NESTED":"FLAT"} structure)`)}catch(t){N.error("❌ Failed to load warnings:",t);const c=t instanceof Error?t.message:"Unknown error";D(`Failed to load warnings: ${c}`)}finally{g(!1)}},[o]);r.useEffect(()=>{o?x():g(!1)},[o,x]),r.useEffect(()=>{let t=[...v];w&&(t=t.filter(c=>c.employeeName.toLowerCase().includes(w.toLowerCase())||c.employeeNumber.toLowerCase().includes(w.toLowerCase())||c.category.toLowerCase().includes(w.toLowerCase())||c.description.toLowerCase().includes(w.toLowerCase()))),L!=="all"&&(t=t.filter(c=>c.status===L)),S!=="all"&&(t=t.filter(c=>c.level===S)),h!=="all"&&(t=t.filter(c=>c.department===h)),t.sort((c,W)=>{let F,Z;switch($){case"employee":F=c.employeeName,Z=W.employeeName;break;case"level":F=c.level,Z=W.level;break;case"status":F=c.status||"",Z=W.status||"";break;default:F=new Date(c.createdAt||0).getTime(),Z=new Date(W.createdAt||0).getTime()}return F<Z?B==="asc"?-1:1:F>Z?B==="asc"?1:-1:0}),f(t),A(1)},[v,w,L,S,h,$,B]);const _=r.useMemo(()=>{const t=new Set(v.map(c=>c.department).filter(c=>c));return Array.from(t).sort()},[v]),G=r.useMemo(()=>{const t=(b-1)*se,c=t+se;return u.slice(t,c)},[u,b]),T=Math.ceil(u.length/se),$e=r.useCallback(t=>{N.debug("Opening warning details for:",t.id),ee(t),H(!0)},[]),Be=r.useCallback(()=>{N.debug("Closing warning details modal"),H(!1),ee(null)},[]),_e=r.useCallback(async t=>{try{g(!0),await J.warnings.update(t.warningId,{appealSubmitted:!0,appealDate:new Date,status:"appealed",appealDetails:{grounds:t.grounds,details:t.additionalDetails,requestedOutcome:t.requestedOutcome,submittedAt:new Date,submittedBy:y?.email||"Employee"}},o),N.success(`Legal appeal submitted for warning ${t.warningId}`),await x(),l(!1),z(null),alert("Appeal submitted successfully. HR will review your appeal within 5 working days as per company policy.")}catch(c){throw N.error("Failed to submit appeal:",c),new Error("Failed to submit appeal. Please try again.")}finally{g(!1)}},[x,y]);r.useCallback(async(t,c)=>{try{g(!0),await J.warnings.update(t,{status:c==="overturned"?"expired":"acknowledged",appealOutcome:c,appealDate:new Date},o),N.success(`Appeal ${c} for warning ${t}`),await x()}catch(W){N.error("Failed to process appeal:",W),D("Failed to process appeal")}finally{g(!1)}},[x]);const Ge=r.useCallback(async t=>{try{g(!0);let c="acknowledged";t.decision==="overturned"&&(c="overturned");const W={status:c,appealOutcome:t.decision,appealDecisionDate:new Date,appealReasoning:t.reasoning,hrNotes:t.hrNotes,followUpRequired:t.followUpRequired,followUpDate:t.followUpDate};(t.decision==="reduced"||t.decision==="modified")&&(t.newLevel&&(W.level=t.newLevel),t.newDescription&&(W.description=t.newDescription)),await J.warnings.update(t.warningId,W,o),t.decision==="overturned"?(await J.warnings.archive(t.warningId,o,"overturned"),N.success("Warning overturned and archived")):t.decision==="upheld"&&N.info("Warning upheld - remains active"),await x(),N.success("Appeal decision recorded successfully")}catch(c){throw N.error("Failed to record appeal decision:",c),new Error("Failed to record appeal decision. Please try again.")}finally{g(!1)}},[x]);r.useCallback(t=>{N.debug("Opening warning details:",t.id),ee(t),H(!0)},[]);const qe=r.useCallback(async t=>{try{confirm("Are you sure you want to archive this warning? It will be moved to the archive.")&&(g(!0),await J.warnings.archive(t,o,"manual"),N.success("Warning archived successfully"),await x())}catch(c){N.error("Failed to archive warning:",c),D("Failed to archive warning")}finally{g(!1)}},[o,x]);return d?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Loading Warnings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please wait..."})]})}):p?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(ae,{className:"w-8 h-8 text-red-500 mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Error Loading Warnings"}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:p}),e.jsxs("button",{onClick:x,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 text-sm",children:[e.jsx(Ae,{className:"w-4 h-4"}),"Retry Loading"]})]})}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warning Management"}),e.jsxs("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[v.length," total"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>he("archive"),className:"flex items-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"Archive"})]}),e.jsx("button",{onClick:x,disabled:d,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ae,{className:`w-4 h-4 ${d?"animate-spin":""}`})}),m&&e.jsx("button",{onClick:m,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-4 h-4"})})]})]}),Ce==="archive"?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Warning archive view is being reimplemented. Please use the filters to find archived warnings."}),e.jsx("button",{onClick:()=>he("warnings"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Warnings"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(gs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search warnings...",value:w,onChange:t=>M(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsxs("select",{value:L,onChange:t=>C(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"appealed",children:"Under Appeal"}),e.jsx("option",{value:"expired",children:"Expired"})]}),e.jsxs("select",{value:S,onChange:t=>a(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"counselling",children:"Counselling"}),e.jsx("option",{value:"verbal",children:"Verbal"}),e.jsx("option",{value:"first_written",children:"First Written"}),e.jsx("option",{value:"second_written",children:"Second Written"}),e.jsx("option",{value:"final_written",children:"Final Written"}),e.jsx("option",{value:"written",children:"Written (Legacy)"}),e.jsx("option",{value:"final",children:"Final (Legacy)"}),e.jsx("option",{value:"dismissal",children:"Dismissal (Legacy)"})]}),e.jsxs("button",{onClick:()=>Pe(!re),className:"px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors text-sm flex items-center gap-2",children:[e.jsx(ps,{className:"w-4 h-4"}),"More",re?e.jsx(hs,{className:"w-4 h-4"}):e.jsx(bs,{className:"w-4 h-4"})]})]}),re&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("select",{value:h,onChange:t=>E(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Departments"}),_.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:`${$}-${B}`,onChange:t=>{const[c,W]=t.target.value.split("-");Q(c),O(W)},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date-desc",children:"Newest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"employee-asc",children:"Employee A-Z"}),e.jsx("option",{value:"employee-desc",children:"Employee Z-A"}),e.jsx("option",{value:"level-asc",children:"Level (Low to High)"}),e.jsx("option",{value:"level-desc",children:"Level (High to Low)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("select",{value:se,onChange:t=>setItemsPerPage(Number(t.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3 mb-4",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs font-medium",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:v.length})]}),e.jsx(De,{className:"w-5 h-5 text-gray-500"})]})}),e.jsx("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-xs font-medium",children:"Active"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:v.filter(t=>t.isActive).length})]}),e.jsx(le,{className:"w-5 h-5 text-green-500"})]})}),e.jsx("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-600 text-xs font-medium",children:"Undelivered"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:v.filter(t=>t.deliveryStatus!=="delivered").length})]}),e.jsx(Ne,{className:"w-5 h-5 text-orange-500"})]})}),e.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-xs font-medium",children:"Critical"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:v.filter(t=>t.level==="final"||t.level==="dismissal").length})]}),e.jsx(ae,{className:"w-5 h-5 text-red-500"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[u.length," warnings ",u.length!==v.length&&`(filtered from ${v.length})`]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",b," of ",T]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Warning"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:G.map((t,c)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:te(t.employeeName)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[te(t.employeeNumber)," • ",te(t.department)]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.level==="counselling"?"bg-green-100 text-green-800":t.level==="verbal"?"bg-blue-100 text-blue-800":t.level==="first_written"?"bg-yellow-100 text-yellow-800":t.level==="second_written"?"bg-orange-100 text-orange-800":t.level==="final_written"?"bg-red-100 text-red-800":t.level==="written"?"bg-yellow-100 text-yellow-800":t.level==="final"||t.level==="dismissal"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.level==="counselling"?"Counselling":t.level==="verbal"?"Verbal":t.level==="first_written"?"First Written":t.level==="second_written"?"Second Written":t.level==="final_written"?"Final Written":t.level==="written"?"Written":t.level==="final"?"Final":t.level==="dismissal"?"Dismissal":te(t.level,"Unknown")})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:te(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.issueDate?new Date(t.issueDate.seconds?t.issueDate.seconds*1e3:t.issueDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.status==="issued"?"bg-blue-100 text-blue-800":t.status==="acknowledged"?"bg-green-100 text-green-800":t.status==="appealed"?"bg-orange-100 text-orange-800":t.status==="expired"?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"}`,children:t.status==="issued"?"Issued":t.status==="acknowledged"?"Acknowledged":t.status==="appealed"?"Under Appeal":t.status==="expired"?"Expired":te(t.status,"Pending")})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>$e(t),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"View"}),t.status==="appealed"&&e.jsxs("button",{onClick:()=>{pe(t),ge(!0)},className:"text-purple-600 hover:text-purple-800 text-xs px-2 py-1 hover:bg-purple-50 rounded transition-colors flex items-center gap-1",title:"Review Appeal with Enhanced Decision Options",children:[e.jsx(Ue,{className:"w-3 h-3"}),"Review Appeal"]}),t.deliveryStatus!=="delivered"&&t.status!=="appealed"&&e.jsx("button",{onClick:()=>{oe(t),xe(!0)},className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 hover:bg-orange-50 rounded transition-colors",children:"Deliver"}),t.status!=="appealed"&&ke(t)&&e.jsx("button",{onClick:()=>{z(t),l(!0)},className:"text-amber-600 hover:text-amber-800 text-xs px-2 py-1 hover:bg-amber-50 rounded transition-colors",title:(()=>{const W=t.issueDate.seconds?new Date(t.issueDate.seconds*1e3):new Date(t.issueDate),F=new Date(W);return F.setDate(F.getDate()+30),`Appeal this warning (deadline: ${F.toLocaleDateString()})`})(),children:"Appeal"}),t.status!=="appealed"&&!ke(t)&&e.jsx("span",{className:"text-gray-500 text-xs px-2 py-1",title:"Appeal period has expired",children:"Appeal Expired"}),(t.status==="acknowledged"||t.status==="expired"||!ke(t))&&e.jsx("button",{onClick:()=>qe(t.id),className:"text-gray-600 hover:text-gray-800 text-xs px-2 py-1 hover:bg-gray-50 rounded transition-colors",title:"Archive this warning",children:e.jsx(Te,{className:"w-3 h-3"})})]})})]},t.id||`warning-${c}`))})]})})}),u.length===0&&!d&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"No warnings found"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:w||L!=="all"||S!=="all"||h!=="all"?"Try adjusting your search criteria or filters.":"No warnings have been created yet."}),(w||L!=="all"||S!=="all"||h!=="all")&&e.jsx("button",{onClick:()=>{M(""),C("all"),a("all"),E("all")},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear all filters"})]}),T>1&&e.jsxs("div",{className:"flex items-center justify-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>A(Math.max(1,b-1)),disabled:b===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm text-gray-600 bg-gray-50 rounded-lg",children:[b," of ",T]}),e.jsx("button",{onClick:()=>A(Math.min(T,b+1)),disabled:b===T,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]}),e.jsx(Ds,{warning:X,isOpen:P,onClose:Be,canTakeAction:j,userRole:I}),ne&&e.jsx(Cs,{isOpen:Le,onClose:()=>{xe(!1),oe(null)},warningId:ne.id||"",employeeName:te(ne.employee),deliveryMethod:ne.deliveryMethod||"email",onDeliveryConfirmed:async t=>{try{await J.warnings.updateDeliveryStatus(t.warningId,{status:"delivered",deliveredAt:t.deliveredAt,deliveryMethod:t.deliveryMethod,proofImage:t.proofImage}),await x(),xe(!1),oe(null)}catch(c){throw console.error("Failed to confirm delivery:",c),c}}}),de&&Y&&e.jsx(As,{isOpen:de,onClose:()=>{l(!1),z(null)},warning:{id:Y.id,employeeName:Y.employeeName,category:Y.category,level:Y.level,issueDate:Y.issueDate,description:Y.description||"No description provided"},onAppealSubmit:_e}),ue&&V&&e.jsx(Es,{isOpen:ue,onClose:()=>{ge(!1),pe(null)},warning:{id:V.id,employeeName:V.employeeName,employeeNumber:V.employeeNumber,category:V.category,level:V.level,issueDate:V.issueDate,description:V.description||"No description provided",appealDetails:V.appealDetails},onDecisionSubmit:Ge})]})]})};export{Us as WarningsReviewDashboard,Us as default};
