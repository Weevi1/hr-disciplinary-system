import{u as e,g as s,j as t,a as r,x as a,A as i,L as l,S as n,D as o,w as d}from"./business-owner-dashboard-Dg0OWqpi.js";import{r as c}from"./react-vendor-CWjEGAcE.js";import{C as m}from"./dashboard-router-tdPHWQG4.js";import{b as x,j as g,P as h,R as u,X as p,a as f,e as y,ae as b,d as j,L as v,F as w,r as N,E as C,S,g as z,h as k,N as I,f as W,I as R,i as E,G as B,o as A,T as M,n as D,K as U,k as T,M as P,v as L,a2 as O,m as _,B as F,al as H,w as X,an as G}from"./ui-vendor-DTBvTbg1.js";import"./pdf-vendor-tUwojRr6.js";import"./firebase-vendor-BQc9GSQK.js";import"./hr-dashboard-9ESM24bS.js";import"./warning-components-Dg_cmQBg.js";import"./hod-dashboard-D3ZuSAhA.js";const V=({onClose:n,initialTab:o="overview",organizationId:d,isEmbedded:m=!1})=>{const{user:B}=e();let A=null,M=null;try{const e=s();A=e.organization,M=e.organizationId}catch(Ce){}const D=d||M;if(!D)return t.jsxs("div",{className:"p-6 text-center",children:[t.jsxs("div",{className:"text-red-600 mb-4",children:[t.jsx(x,{className:"w-12 h-12 mx-auto mb-2"}),t.jsx("h3",{className:"text-lg font-semibold",children:"Organization ID Required"}),t.jsx("p",{className:"text-sm",children:"Cannot manage categories without an organization ID."})]}),n&&t.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Close"})]});const{canManageCategories:U,canViewAnalytics:T}=r(),[P,L]=c.useState(o),[O,_]=c.useState(!0),[F,H]=c.useState(!1),[X,G]=c.useState(null),[V,$]=c.useState(null),[Y]=c.useState(a),[q,Q]=c.useState([]),[Z,K]=c.useState([]),[J,ee]=c.useState(null),[se,te]=c.useState(null),[re,ae]=c.useState(null),[ie,le]=c.useState(!1),[ne,oe]=c.useState(!1),[de,ce]=c.useState(new Set),[me,xe]=c.useState({search:"",severity:"all",status:"all",usage:"all"}),[ge,he]=c.useState({field:"name",direction:"asc"}),[ue,pe]=c.useState({name:"",description:"",severity:"serious",icon:"📋",escalationPath:["counselling","verbal","first_written","final_written"],examples:[],isActive:!0}),fe=!U,ye=c.useMemo(()=>{let e=Y;if(me.search){const s=me.search.toLowerCase();e=e.filter(e=>e.name.toLowerCase().includes(s)||e.description.toLowerCase().includes(s)||e.commonExamples.some(e=>e.toLowerCase().includes(s)))}return"all"!==me.severity&&(e=e.filter(e=>e.severity===me.severity)),"all"!==me.status&&(e=e.filter(e=>{const s=Z.find(s=>s.universalCategoryId===e.id),t=s?.isDisabled||!1;return"enabled"===me.status?!t:t})),"all"!==me.usage&&J&&(e=e.filter(e=>{const s=J.recentUsage.find(s=>s.categoryId===e.id),t=s?.count||0;switch(me.usage){case"high":return t>=10;case"medium":return t>=3&&t<10;case"low":return t>0&&t<3;case"unused":return 0===t;default:return!0}})),e.sort((e,s)=>{const t="asc"===ge.direction?1:-1;switch(ge.field){case"name":case"created":case"modified":return t*e.name.localeCompare(s.name);case"severity":{const r={minor:1,serious:2,gross_misconduct:3};return t*(r[e.severity]-r[s.severity])}case"usage":if(!J)return 0;return t*((J.recentUsage.find(s=>s.categoryId===e.id)?.count||0)-(J.recentUsage.find(e=>e.categoryId===s.id)?.count||0));default:return 0}})},[Y,Z,J,me,ge]),be=c.useMemo(()=>q.filter(e=>Z.some(s=>s.id===e.id&&s.isCustomCategory)),[q,Z]),je=c.useCallback(async()=>{if(D)try{_(!0),G(null);const e=await i.organizations.getCategories(D);Q(e);if(K([]),T){const e=await ve();ee(e)}}catch(Ce){l.error("[CategoryManagement] ❌ Error loading data:",Ce),G(Ce instanceof Error?Ce.message:"Failed to load category data")}finally{_(!1)}},[D,T]),ve=async()=>({totalCategories:Y.length+be.length,enabledUniversal:Y.length-1,disabledUniversal:1,customCategories:be.length,activeWarnings:45,recentUsage:[{categoryId:"attendance_punctuality",categoryName:"Attendance & Punctuality",count:15,lastUsed:new Date(Date.now()-1728e5)},{categoryId:"safety_violations",categoryName:"Safety Violations",count:8,lastUsed:new Date(Date.now()-432e6)}]});c.useEffect(()=>{D&&je()},[je,D]);const we=e=>{switch(e){case"minor":case"low":return"#10b981";case"serious":case"medium":return"#f59e0b";case"gross_misconduct":case"high":case"critical":return"#ef4444";default:return"#6b7280"}},Ne=e=>{switch(e){case"minor":case"low":return t.jsx(E,{className:"h-4 w-4"});case"serious":case"medium":return t.jsx(x,{className:"h-4 w-4"});case"gross_misconduct":case"high":case"critical":return t.jsx(p,{className:"h-4 w-4"});default:return t.jsx(w,{className:"h-4 w-4"})}};return c.useEffect(()=>{if(V||X){const e=setTimeout(()=>{$(null),G(null)},5e3);return()=>clearTimeout(e)}},[V,X]),D?t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"1rem"},children:t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",width:"100%",maxWidth:"80rem",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[t.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[t.jsx("div",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.5rem",borderRadius:"0.5rem"},children:t.jsx(g,{className:"h-6 w-6"})}),t.jsxs("div",{children:[t.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#1e293b",margin:0,marginBottom:"0.25rem"},children:"Category Management"}),t.jsxs("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:[A?.name," • ",q.length," categories configured"]})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[!fe&&t.jsxs("button",{onClick:()=>le(!0),disabled:F,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:F?"not-allowed":"pointer",opacity:F?.6:1},children:[t.jsx(h,{className:"h-4 w-4"}),"Add Custom Category"]}),t.jsx("button",{onClick:je,disabled:O||F,style:{padding:"0.5rem",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:O||F?"not-allowed":"pointer",display:"flex",alignItems:"center",opacity:O||F?.6:1},children:t.jsx(u,{className:"h-4 w-4 "+(O?"animate-spin":""),style:{color:"#6b7280"}})}),n&&t.jsx("button",{onClick:n,style:{padding:"0.5rem",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:t.jsx(p,{className:"h-4 w-4",style:{color:"#6b7280"}})})]})]}),(V||X)&&t.jsx("div",{style:{padding:"1rem 2rem",backgroundColor:V?"#f0fdf4":"#fef2f2",borderBottom:"1px solid #e2e8f0"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:V?"#16a34a":"#dc2626",fontSize:"0.875rem",fontWeight:"500"},children:[V?t.jsx(f,{className:"h-4 w-4"}):t.jsx(x,{className:"h-4 w-4"}),V||X]})}),t.jsx("div",{style:{borderBottom:"1px solid #e2e8f0",backgroundColor:"white"},children:t.jsx("div",{style:{display:"flex",gap:0,padding:"0 2rem"},children:[{id:"overview",label:"Overview",icon:y},{id:"universal",label:"Universal Categories",icon:b},{id:"custom",label:"Custom Categories",icon:g},...T?[{id:"analytics",label:"Analytics",icon:j}]:[]].map(e=>{const s=e.icon,r=P===e.id;return t.jsxs("button",{onClick:()=>L(e.id),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"1rem 1.5rem",border:"none",backgroundColor:"transparent",borderBottom:r?"2px solid #3b82f6":"2px solid transparent",color:r?"#3b82f6":"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},children:[t.jsx(s,{className:"h-4 w-4"}),e.label]},e.id)})})}),t.jsx("div",{style:{flex:1,overflow:"auto"},children:O?t.jsxs("div",{style:{padding:"4rem",textAlign:"center",color:"#64748b"},children:[t.jsx(v,{className:"h-8 w-8 mx-auto mb-4 animate-spin"}),t.jsx("p",{style:{margin:0},children:"Loading category configuration..."})]}):t.jsxs(t.Fragment,{children:["overview"===P&&t.jsxs("div",{style:{padding:"2rem"},children:[J&&t.jsxs("div",{style:{display:"grid",gridTemplateColumns:window.innerWidth>1024?"repeat(4, 1fr)":window.innerWidth>768?"repeat(2, 1fr)":"1fr",gap:"1.5rem",marginBottom:"2rem"},children:[t.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{backgroundColor:"#dbeafe",color:"#3b82f6",padding:"0.5rem",borderRadius:"0.375rem"},children:t.jsx(g,{className:"h-5 w-5"})}),t.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:J.totalCategories})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Total Categories"})]}),t.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{backgroundColor:"#dcfce7",color:"#16a34a",padding:"0.5rem",borderRadius:"0.375rem"},children:t.jsx(f,{className:"h-5 w-5"})}),t.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:J.enabledUniversal})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Universal Categories Enabled"})]}),t.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{backgroundColor:"#fef3c7",color:"#d97706",padding:"0.5rem",borderRadius:"0.375rem"},children:t.jsx(h,{className:"h-5 w-5"})}),t.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:J.customCategories})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Custom Categories"})]}),t.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[t.jsx("div",{style:{backgroundColor:"#e0e7ff",color:"#6366f1",padding:"0.5rem",borderRadius:"0.375rem"},children:t.jsx(w,{className:"h-5 w-5"})}),t.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:J.activeWarnings})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Active Warnings"})]})]}),t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",border:"1px solid #e2e8f0",padding:"1.5rem",marginBottom:"2rem"},children:[t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:"#1e293b"},children:"Quick Actions"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:window.innerWidth>768?"repeat(3, 1fr)":"1fr",gap:"1rem"},children:[t.jsxs("button",{onClick:()=>L("universal"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.375rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#f1f5f9",onMouseOut:e=>e.currentTarget.style.backgroundColor="#f8fafc",children:[t.jsx(b,{className:"h-5 w-5",style:{color:"#3b82f6"}}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:"Configure Universal Categories"}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Enable, disable or customize the 8 standard categories"})]})]}),t.jsxs("button",{onClick:()=>L("custom"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.375rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#f1f5f9",onMouseOut:e=>e.currentTarget.style.backgroundColor="#f8fafc",children:[t.jsx(g,{className:"h-5 w-5",style:{color:"#8b5cf6"}}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:"Manage Custom Categories"}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Create and manage organization-specific categories"})]})]}),T&&t.jsxs("button",{onClick:()=>L("analytics"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.375rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#f1f5f9",onMouseOut:e=>e.currentTarget.style.backgroundColor="#f8fafc",children:[t.jsx(j,{className:"h-5 w-5",style:{color:"#10b981"}}),t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:"View Usage Analytics"}),t.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Analyze category usage patterns and trends"})]})]})]})]}),J&&J.recentUsage.length>0&&t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",border:"1px solid #e2e8f0",overflow:"hidden"},children:[t.jsx("div",{style:{padding:"1.5rem 1.5rem 0 1.5rem"},children:t.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:"#1e293b"},children:"Recent Category Usage"})}),t.jsx("div",{style:{padding:"0 1.5rem 1.5rem 1.5rem"},children:J.recentUsage.slice(0,5).map((e,s)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 0",borderBottom:s<Math.min(J.recentUsage.length,5)-1?"1px solid #f1f5f9":"none"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:e.categoryName}),t.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:["Last used ",Math.floor((Date.now()-e.lastUsed.getTime())/864e5)," days ago"]})]}),t.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:t.jsxs("div",{style:{padding:"0.25rem 0.5rem",backgroundColor:"#f3f4f6",borderRadius:"0.25rem",fontSize:"0.75rem",fontWeight:"600",color:"#374151"},children:[e.count," warnings"]})})]},e.categoryId))})]})]}),"universal"===P&&t.jsxs("div",{style:{padding:"2rem"},children:[t.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem",flexWrap:"wrap"},children:[t.jsx("div",{style:{flex:1,minWidth:"300px"},children:t.jsxs("div",{style:{position:"relative"},children:[t.jsx(N,{className:"h-4 w-4",style:{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",color:"#9ca3af"}}),t.jsx("input",{type:"text",placeholder:"Search categories...",value:me.search,onChange:e=>xe(s=>({...s,search:e.target.value})),style:{width:"100%",padding:"0.5rem 0.75rem 0.5rem 2.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem"}})]})}),t.jsxs("select",{value:me.severity,onChange:e=>xe(s=>({...s,severity:e.target.value})),style:{padding:"0.5rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",backgroundColor:"white",minWidth:"120px"},children:[t.jsx("option",{value:"all",children:"All Severities"}),t.jsx("option",{value:"minor",children:"Minor"}),t.jsx("option",{value:"serious",children:"Serious"}),t.jsx("option",{value:"gross_misconduct",children:"Gross Misconduct"})]}),t.jsxs("select",{value:me.status,onChange:e=>xe(s=>({...s,status:e.target.value})),style:{padding:"0.5rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",backgroundColor:"white",minWidth:"100px"},children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"enabled",children:"Enabled"}),t.jsx("option",{value:"disabled",children:"Disabled"})]})]}),t.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0.5rem",overflow:"hidden"},children:[ye.map((e,s)=>{const r=(e=>{const s=Z.find(s=>s.universalCategoryId===e);return s?.isDisabled||!1})(e.id),a=se===e.id;e.id;const i=(n=e.id,J?J.recentUsage.find(e=>e.categoryId===n):null);var n;const o=(e=>{const s=Z.find(s=>s.universalCategoryId===e.id);return s?{...e,name:s.customName||e.name,description:s.customDescription||e.description,escalationPath:s.customEscalationPath||e.escalationPath,commonExamples:s.customExamples||e.commonExamples,severity:s.customSeverity?"low"===s.customSeverity?"minor":"medium"===s.customSeverity?"serious":"gross_misconduct":e.severity}:e})(e);return t.jsx("div",{children:t.jsxs("div",{style:{padding:"1.5rem",borderBottom:s<ye.length-1?"1px solid #f1f5f9":"none",backgroundColor:r?"#f8fafc":"white",opacity:r?.7:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[t.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",color:r?"#6b7280":"#1e293b",margin:0},children:o.name}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"0.75rem",backgroundColor:we(o.severity),color:"white",fontSize:"0.75rem",fontWeight:"600"},children:[Ne(o.severity),o.severity.replace("_"," ")]}),i&&i.count>0&&t.jsxs("div",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#f3f4f6",borderRadius:"0.75rem",fontSize:"0.75rem",fontWeight:"500",color:"#374151"},children:[i.count," warnings"]}),r&&t.jsx("div",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#fee2e2",borderRadius:"0.75rem",fontSize:"0.75rem",fontWeight:"500",color:"#dc2626"},children:"Disabled"})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:r?"#9ca3af":"#64748b",margin:"0 0 0.75rem 0",lineHeight:"1.5"},children:o.description}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[t.jsx(j,{className:"h-3 w-3"}),o.escalationPath.length," steps"]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[t.jsx(b,{className:"h-3 w-3"}),o.lraSection]}),o.commonExamples.length>0&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[t.jsx(w,{className:"h-3 w-3"}),o.commonExamples.length," examples"]})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[!fe&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>(async e=>{if(!fe)try{H(!0),G(null);const s=Z.find(s=>s.universalCategoryId===e);s?await DataService.customizeCategory(D,e,{...s,isDisabled:!s.isDisabled}):await DataService.customizeCategory(D,e,{isDisabled:!0}),await je(),$(`Category ${s?.isDisabled?"enabled":"disabled"} successfully`)}catch(Ce){l.error("[CategoryManagement] Error toggling category:",Ce),G("Failed to update category status")}finally{H(!1)}})(e.id),disabled:F,style:{padding:"0.5rem",backgroundColor:r?"#10b981":"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:F?"not-allowed":"pointer",fontSize:"0.75rem",fontWeight:"500",opacity:F?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:[r?t.jsx(y,{className:"h-3 w-3"}):t.jsx(C,{className:"h-3 w-3"}),r?"Enable":"Disable"]}),t.jsx("button",{onClick:()=>ae({type:"universal",id:e.id,data:{}}),style:{padding:"0.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:t.jsx(S,{className:"h-3 w-3"})})]}),t.jsx("button",{onClick:()=>te(a?null:e.id),style:{padding:"0.5rem",backgroundColor:"transparent",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:a?t.jsx(z,{className:"h-4 w-4"}):t.jsx(k,{className:"h-4 w-4"})})]})]}),a&&t.jsx("div",{style:{marginTop:"1.5rem",padding:"1.5rem",backgroundColor:"#f8fafc",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:t.jsxs("div",{style:{display:"grid",gap:"1.5rem",gridTemplateColumns:window.innerWidth>1024?"repeat(3, 1fr)":"1fr"},children:[t.jsxs("div",{children:[t.jsxs("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[t.jsx(j,{className:"h-4 w-4"}),"Escalation Path"]}),t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:o.escalationPath.map((e,s)=>t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.25rem 0.5rem",backgroundColor:"white",borderRadius:"0.25rem",fontSize:"0.75rem"},children:[t.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",width:"1.25rem",height:"1.25rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.625rem",fontWeight:"600"},children:s+1}),e.replace("_"," ")]},s))})]}),t.jsxs("div",{children:[t.jsxs("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[t.jsx(b,{className:"h-4 w-4"}),"Legal Framework"]}),t.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"white",borderRadius:"0.375rem",fontSize:"0.75rem",lineHeight:"1.4"},children:[t.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:o.lraSection}),t.jsx("div",{style:{color:"#6b7280"},children:o.schedule8Reference})]})]}),o.commonExamples.length>0&&t.jsxs("div",{children:[t.jsxs("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[t.jsx(w,{className:"h-4 w-4"}),"Common Examples"]}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:[o.commonExamples.slice(0,6).map((e,s)=>t.jsx("span",{style:{padding:"0.25rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",borderRadius:"0.375rem",fontSize:"0.75rem",fontWeight:"500"},children:e},s)),o.commonExamples.length>6&&t.jsxs("span",{style:{fontSize:"0.75rem",color:"#6b7280",fontStyle:"italic",alignSelf:"center"},children:["+",o.commonExamples.length-6," more..."]})]})]})]})})]})},e.id)}),0===ye.length&&t.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[t.jsx(N,{className:"h-8 w-8 mx-auto mb-4",style:{color:"#9ca3af"}}),t.jsx("p",{style:{margin:0,fontSize:"0.875rem"},children:"No categories found matching your filters."})]})]})]}),"custom"===P&&t.jsxs("div",{style:{padding:"2rem"},children:[t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"2rem"},children:t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1e293b",margin:0,marginBottom:"0.25rem"},children:"Custom Categories"}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Organization-specific categories beyond the universal standards."})]})}),be.length>0?t.jsx("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0.5rem",overflow:"hidden"},children:be.map((e,s)=>t.jsx("div",{style:{padding:"1.5rem",borderBottom:s<be.length-1?"1px solid #f1f5f9":"none"},children:t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem"},children:[t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[t.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1e293b",margin:0},children:e.name}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"0.75rem",backgroundColor:we(e.severity),color:"white",fontSize:"0.75rem",fontWeight:"600"},children:[Ne(e.severity),e.severity]}),t.jsx("div",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#fef3c7",borderRadius:"0.75rem",fontSize:"0.75rem",fontWeight:"500",color:"#d97706"},children:"Custom"})]}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:"0 0 0.75rem 0",lineHeight:"1.5"},children:e.description||"No description provided"}),t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[t.jsx(j,{className:"h-3 w-3"}),e.escalationPath?.length||0," steps"]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[t.jsx(I,{className:"h-3 w-3"}),"Created ",new Date(e.createdAt).toLocaleDateString()]})]})]}),!fe&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("button",{onClick:()=>ae({type:"custom",id:e.id,data:e}),style:{padding:"0.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:t.jsx(S,{className:"h-3 w-3"})}),t.jsx("button",{onClick:()=>(async()=>{if(fe)return;if(window.confirm("Are you sure you want to delete this custom category? This action cannot be undone."))try{H(!0),G(null),await je(),$("Custom category deleted successfully")}catch(Ce){l.error("[CategoryManagement] Error deleting custom category:",Ce),G("Failed to delete custom category")}finally{H(!1)}})(e.id),style:{padding:"0.5rem",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:t.jsx(W,{className:"h-3 w-3"})})]})]})},e.id))}):t.jsxs("div",{style:{padding:"3rem",textAlign:"center",border:"2px dashed #e2e8f0",borderRadius:"0.5rem",color:"#64748b"},children:[t.jsx(g,{className:"h-12 w-12 mx-auto mb-4",style:{color:"#9ca3af"}}),t.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"0.5rem",color:"#374151"},children:"No Custom Categories"}),t.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.875rem"},children:"Create organization-specific categories to supplement the universal standards."}),!fe&&t.jsxs("button",{onClick:()=>le(!0),style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:[t.jsx(h,{className:"h-4 w-4"}),"Create First Custom Category"]})]})]}),"analytics"===P&&T&&t.jsxs("div",{style:{padding:"2rem"},children:[t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"2rem"},children:t.jsxs("div",{children:[t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1e293b",margin:0,marginBottom:"0.25rem"},children:"Category Usage Analytics"}),t.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Insights into how categories are being used across your organization."})]})}),J?t.jsx("div",{style:{display:"grid",gap:"2rem"},children:t.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0.5rem",padding:"2rem",textAlign:"center"},children:[t.jsx(j,{className:"h-12 w-12 mx-auto mb-4",style:{color:"#9ca3af"}}),t.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"0.5rem",color:"#374151"},children:"Usage Analytics Coming Soon"}),t.jsx("p",{style:{color:"#64748b",margin:0,fontSize:"0.875rem"},children:"Detailed analytics and charts will be available in a future update."})]})}):t.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[t.jsx(v,{className:"h-8 w-8 mx-auto mb-4 animate-spin"}),t.jsx("p",{style:{margin:0},children:"Loading analytics data..."})]})]})]})}),ie&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"2rem",width:"90%",maxWidth:"42rem",maxHeight:"80vh",overflowY:"auto"},children:[t.jsx("h4",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1.5rem",color:"#1e293b"},children:"Create Custom Category"}),t.jsxs("div",{style:{display:"grid",gap:"1.5rem"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Category Name *"}),t.jsx("input",{type:"text",value:ue.name||"",onChange:e=>pe(s=>({...s,name:e.target.value})),placeholder:"e.g., Social Media Policy Violations",style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Description"}),t.jsx("textarea",{value:ue.description||"",onChange:e=>pe(s=>({...s,description:e.target.value})),placeholder:"Brief description of what this category covers...",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",resize:"vertical"}})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Severity Level"}),t.jsxs("select",{value:ue.severity||"serious",onChange:e=>pe(s=>({...s,severity:e.target.value})),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",backgroundColor:"white"},children:[t.jsx("option",{value:"minor",children:"Minor - Correctable behavior issues"}),t.jsx("option",{value:"serious",children:"Serious - Policy violations or misconduct"}),t.jsx("option",{value:"gross_misconduct",children:"Gross Misconduct - Severe violations"})]})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Category Icon"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",gap:"0.5rem",padding:"1rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",backgroundColor:"#f9fafb"},children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(e=>t.jsx("button",{type:"button",onClick:()=>pe(s=>({...s,icon:e})),style:{width:"3rem",height:"3rem",border:ue.icon===e?"2px solid #8b5cf6":"1px solid #d1d5db",borderRadius:"0.375rem",backgroundColor:ue.icon===e?"#f3f4f6":"white",fontSize:"1.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:s=>{ue.icon!==e&&(s.currentTarget.style.backgroundColor="#f3f4f6")},onMouseLeave:s=>{ue.icon!==e&&(s.currentTarget.style.backgroundColor="white")},children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Common Examples (Optional)"}),t.jsx("textarea",{value:ue.examples?.join("\n")||"",onChange:e=>pe(s=>({...s,examples:e.target.value.split("\n").filter(e=>e.trim())})),placeholder:"Enter examples, one per line...",rows:4,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",resize:"vertical"}}),t.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",margin:"0.5rem 0 0 0"},children:"Enter one example per line to help managers understand when to use this category."})]})]}),t.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"2rem",justifyContent:"flex-end"},children:[t.jsx("button",{onClick:()=>{le(!1),pe({name:"",description:"",severity:"serious",icon:"📋",escalationPath:["counselling","verbal","first_written","final_written"],examples:[],isActive:!0})},style:{padding:"0.75rem 1.5rem",border:"1px solid #d1d5db",backgroundColor:"white",color:"#374151",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:"pointer"},children:"Cancel"}),t.jsxs("button",{onClick:async()=>{if(!fe&&ue.name?.trim())try{H(!0),G(null);const e={name:ue.name,description:ue.description||"",icon:ue.icon||"📋",escalationPath:ue.escalationPath||["verbal","first_written","final_written"],examples:ue.examples||[],severity:"minor"===ue.severity?"low":"serious"===ue.severity?"medium":"high"};await DataService.createCustomCategory(D,e),await je(),pe({name:"",description:"",severity:"serious",icon:"📋",escalationPath:["counselling","verbal","first_written","final_written"],examples:[],isActive:!0}),le(!1),$("Custom category created successfully")}catch(Ce){l.error("[CategoryManagement] Error creating custom category:",Ce),G("Failed to create custom category")}finally{H(!1)}},disabled:!ue.name?.trim()||F,style:{padding:"0.75rem 1.5rem",border:"none",backgroundColor:!ue.name?.trim()||F?"#9ca3af":"#8b5cf6",color:"white",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:!ue.name?.trim()||F?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[F?t.jsx(v,{className:"h-4 w-4 animate-spin"}):t.jsx(h,{className:"h-4 w-4"}),F?"Creating...":"Create Category"]})]})]})}),re&&t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:t.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"2rem",width:"90%",maxWidth:"42rem",maxHeight:"80vh",overflowY:"auto"},children:[t.jsxs("h4",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1.5rem",color:"#1e293b"},children:["Edit ","universal"===re.type?"Universal":"Custom"," Category"]}),t.jsx("div",{style:{padding:"1rem",backgroundColor:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#0369a1"},children:[t.jsx(R,{className:"h-4 w-4"}),"Category editing functionality will be implemented in the next phase."]})}),t.jsx("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:t.jsx("button",{onClick:()=>ae(null),style:{padding:"0.75rem 1.5rem",border:"1px solid #d1d5db",backgroundColor:"white",color:"#374151",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:"pointer"},children:"Close"})})]})})]})}):t.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[t.jsx(x,{className:"h-12 w-12 mx-auto mb-4",style:{color:"#f59e0b"}}),t.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"0.5rem",color:"#374151"},children:"Organization Not Found"}),t.jsx("p",{style:{margin:0},children:"Please ensure you're logged into a valid organization to manage categories."})]})},$=({client:e,isOpen:s,onClose:r,onUpdate:a})=>{const[i,d]=c.useState("general"),[m,x]=c.useState(!1),[g,h]=c.useState(!1),[y,b]=c.useState({totalEmployees:0,totalWarnings:0,totalCategories:0,totalUsers:0,activeWarnings:0,complianceScore:85}),[v,N]=c.useState({name:e.name||"",contactEmail:e.contactEmail||"",contactPhone:e.contactPhone||"",address:e.address||"",sector:e.sector||"",description:e.description||""});c.useEffect(()=>{s&&e.id&&C()},[s,e.id]);const C=async()=>{try{x(!0),e.id;const s=await n.loadEmployees(e.id),t=await n.loadWarnings(e.id),r=await o.queryDocuments(e.id,"categories",[]),a=t.documents.filter(e=>"issued"===e.status).length,i=Math.max(95-3*a,60);b({totalEmployees:s.documents.length,totalWarnings:t.documents.length,totalCategories:r.documents.length,totalUsers:0,activeWarnings:a,complianceScore:i}),l.success("Client statistics loaded successfully")}catch(s){l.error("Failed to load client statistics:",s)}finally{x(!1)}},S=[{id:"general",label:"General Info",icon:B,description:"Basic organization details"},{id:"categories",label:"Warning Categories",icon:M,description:"Manage warning categories and escalation paths"},{id:"users",label:"User Management",icon:D,description:"Organization users and permissions"},{id:"analytics",label:"Analytics",icon:U,description:"Performance metrics and insights"}];return s?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:t.jsx(B,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:e.name}),t.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[t.jsx(A,{className:"w-4 h-4 text-yellow-500"}),"Client Organization Management"]})]})]}),t.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:t.jsx(p,{className:"w-5 h-5 text-gray-600"})})]}),t.jsx("div",{className:"p-6 border-b bg-gray-50",children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.totalEmployees}),t.jsx("div",{className:"text-xs text-gray-600",children:"Employees"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.totalCategories}),t.jsx("div",{className:"text-xs text-gray-600",children:"Categories"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:y.totalWarnings}),t.jsx("div",{className:"text-xs text-gray-600",children:"Total Warnings"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-red-600",children:y.activeWarnings}),t.jsx("div",{className:"text-xs text-gray-600",children:"Active"})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[y.complianceScore,"%"]}),t.jsx("div",{className:"text-xs text-gray-600",children:"Compliance"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold "+(y.complianceScore>=80?"text-green-600":y.complianceScore>=60?"text-yellow-600":"text-red-600"),children:y.complianceScore>=80?"✓":y.complianceScore>=60?"⚠":"✗"}),t.jsx("div",{className:"text-xs text-gray-600",children:"Status"})]})]})}),t.jsx("div",{className:"border-b",children:t.jsx("nav",{className:"flex space-x-1 p-2",children:S.map(e=>{const s=e.icon;return t.jsxs("button",{onClick:()=>d(e.id),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors "+(i===e.id?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[t.jsx(s,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:block",children:e.label})]},e.id)})})}),t.jsxs("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:["general"===i&&t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Organization Details"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update basic organization information"})]}),t.jsxs("button",{onClick:async()=>{try{h(!0),await a(e.id,v),l.success("Client information updated successfully")}catch(s){l.error("Failed to update client information:",s)}finally{h(!1)}},disabled:g,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[g?t.jsx(u,{className:"w-4 h-4 animate-spin"}):t.jsx(T,{className:"w-4 h-4"}),g?"Saving...":"Save Changes"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Organization Name"}),t.jsx("input",{type:"text",value:v.name,onChange:e=>N({...v,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter organization name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sector"}),t.jsx("input",{type:"text",value:v.sector,onChange:e=>N({...v,sector:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Manufacturing, Retail, etc."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email"}),t.jsxs("div",{className:"relative",children:[t.jsx(P,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"email",value:v.contactEmail,onChange:e=>N({...v,contactEmail:e.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@organization.com"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone"}),t.jsxs("div",{className:"relative",children:[t.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"tel",value:v.contactPhone,onChange:e=>N({...v,contactPhone:e.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 XX XXX XXXX"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),t.jsxs("div",{className:"relative",children:[t.jsx(O,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),t.jsx("textarea",{value:v.address,onChange:e=>N({...v,address:e.target.value}),rows:3,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Full business address"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.jsxs("div",{className:"relative",children:[t.jsx(w,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),t.jsx("textarea",{value:v.description,onChange:e=>N({...v,description:e.target.value}),rows:4,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of the organization..."})]})]})]}),"categories"===i&&t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warning Categories Management"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Manage warning categories and escalation paths for this client organization"})]}),t.jsx("div",{className:"border border-gray-200 rounded-xl overflow-hidden",children:t.jsx(V,{onClose:()=>{},organizationId:e.id,isEmbedded:!0})})]}),"users"===i&&t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx(D,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"User Management"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"Manage organization users and their permissions"}),t.jsxs("div",{className:"text-sm text-yellow-700 bg-yellow-50 border border-yellow-200 rounded-lg p-4 max-w-md mx-auto",children:[t.jsx(_,{className:"w-4 h-4 inline mr-2"}),"This feature is coming soon. Users can be managed directly through the organization's admin interface."]})]})}),"analytics"===i&&t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Analytics"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Insights and metrics for this client organization"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:"Compliance Score"}),t.jsx(E,{className:"w-5 h-5 text-green-500"})]}),t.jsxs("div",{className:"text-3xl font-bold text-green-600",children:[y.complianceScore,"%"]}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:y.complianceScore>=80?"Excellent":y.complianceScore>=60?"Good":"Needs Improvement"})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:"Active Warnings"}),t.jsx(_,{className:"w-5 h-5 text-orange-500"})]}),t.jsx("div",{className:"text-3xl font-bold text-orange-600",children:y.activeWarnings}),t.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Out of ",y.totalWarnings," total warnings"]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:"Total Employees"}),t.jsx(D,{className:"w-5 h-5 text-blue-500"})]}),t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:y.totalEmployees}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Managed workforce"})]})]}),t.jsxs("div",{className:"mt-8",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Quick Recommendations"}),t.jsxs("div",{className:"space-y-3",children:[y.activeWarnings>5&&t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[t.jsx(_,{className:"w-5 h-5 text-orange-500 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-orange-900",children:"High Active Warnings"}),t.jsx("p",{className:"text-sm text-orange-700",children:"Consider reviewing and resolving active warnings to improve compliance score."})]})]}),y.totalCategories<5&&t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsx(j,{className:"w-5 h-5 text-blue-500 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-blue-900",children:"Limited Warning Categories"}),t.jsx("p",{className:"text-sm text-blue-700",children:"Consider adding more specific warning categories to improve HR management granularity."})]})]}),y.complianceScore>=90&&t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-green-50 border border-green-200 rounded-lg",children:[t.jsx(f,{className:"w-5 h-5 text-green-500 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-green-900",children:"Excellent Compliance"}),t.jsx("p",{className:"text-sm text-green-700",children:"This organization maintains excellent HR compliance standards."})]})]})]})]})]})]})]})}):null},Y=()=>{const{user:s}=e(),[r,a]=c.useState([]),[i,n]=c.useState(!0),[o,x]=c.useState(""),[g,h]=c.useState("all"),[u,p]=c.useState(null),[b,j]=c.useState(!1);c.useEffect(()=>{s?.resellerId&&v()},[s?.resellerId]);const v=async()=>{if(s?.resellerId)try{n(!0),s.resellerId;const e=await d.getResellerClients(s.resellerId),t=await Promise.all(e.map(async e=>{const s=await m.getClientMetrics(e.id);return{...e,metrics:s}}));a(t),l.success(`Loaded ${t.length} clients`)}catch(e){l.error("Failed to load clients:",e)}finally{n(!1)}},w=r.filter(e=>{const s=e.name.toLowerCase().includes(o.toLowerCase())||e.sector.toLowerCase().includes(o.toLowerCase()),t="all"===g||e.metrics.subscriptionStatus===g;return s&&t}),C=e=>`R${(e/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,S=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-red-600 bg-red-100";case"trial":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}};return i?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading your clients..."})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"My Clients"}),t.jsx("p",{className:"text-gray-600",children:"Manage your client organizations"})]}),t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("span",{className:"text-sm text-gray-600",children:[w.length," of ",r.length," clients"]})})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(N,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search clients by name or sector...",value:o,onChange:e=>x(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("select",{value:g,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"trial",children:"Trial"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(F,{className:"w-5 h-5 text-blue-500"}),t.jsx("span",{className:"font-medium",children:"Active Clients"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.filter(e=>"active"===e.metrics.subscriptionStatus).length})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(H,{className:"w-5 h-5 text-green-500"}),t.jsx("span",{className:"font-medium",children:"Monthly Revenue"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:C(r.reduce((e,s)=>e+s.metrics.monthlyRevenue,0))})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(D,{className:"w-5 h-5 text-purple-500"}),t.jsx("span",{className:"font-medium",children:"Total Employees"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:r.reduce((e,s)=>e+s.metrics.employeeCount,0)})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-semibold",children:"Client Organizations"})}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organization"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Performance"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[t.jsx("span",{children:e.sector}),t.jsx("span",{children:"•"}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(D,{className:"w-3 h-3"}),e.metrics.employeeCount," employees"]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-sm flex items-center gap-1",children:[t.jsx(P,{className:"w-3 h-3 text-gray-400"}),t.jsx("span",{children:e.contactEmail||"Not provided"})]}),t.jsxs("div",{className:"text-sm flex items-center gap-1",children:[t.jsx(L,{className:"w-3 h-3 text-gray-400"}),t.jsx("span",{children:e.contactPhone||"Not provided"})]})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${S(e.metrics.subscriptionStatus)}`,children:["active"===e.metrics.subscriptionStatus&&t.jsx(f,{className:"w-3 h-3"}),"inactive"===e.metrics.subscriptionStatus&&t.jsx(_,{className:"w-3 h-3"}),"trial"===e.metrics.subscriptionStatus&&t.jsx(X,{className:"w-3 h-3"}),e.metrics.subscriptionStatus.charAt(0).toUpperCase()+e.metrics.subscriptionStatus.slice(1)]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Last active: ",new Date(e.metrics.lastActivity).toLocaleDateString("en-ZA")]})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"font-semibold text-gray-900",children:C(e.metrics.monthlyRevenue)}),t.jsx("div",{className:"text-xs text-gray-500",children:"per month"})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("div",{className:"text-sm",children:[t.jsxs("span",{className:"font-medium",children:[e.metrics.complianceScore,"%"]}),t.jsx("span",{className:"text-gray-500",children:" compliance"})]})}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.metrics.warningsThisMonth," warnings this month"]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{p(e),j(!0)},className:"text-blue-600 hover:text-blue-800",title:"Manage client organization",children:t.jsx(G,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>window.open(`/organizations/${e.id}`,"_blank"),className:"text-green-600 hover:text-green-800",title:"View organization",children:t.jsx(y,{className:"w-4 h-4"})})]})})]},e.id))})]}),0===w.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-600",children:"No clients found"}),t.jsx("p",{className:"text-sm text-gray-500",children:o||"all"!==g?"Try adjusting your search or filters":"Your client organizations will appear here"})]})]})]}),u&&t.jsx($,{client:u,isOpen:b,onClose:()=>{j(!1),p(null)},onUpdate:async(e,s)=>{try{await d.updateOrganization(e,s),l.success("Client updated successfully"),await v(),j(!1),p(null)}catch(t){l.error("Failed to update client:",t)}}})]})};export{Y as MyClients};
