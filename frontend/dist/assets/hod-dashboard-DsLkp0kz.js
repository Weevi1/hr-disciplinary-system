const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotificationDeliveryService-EtTDFHY7.js","assets/business-owner-dashboard-DtOK4El9.js","assets/react-vendor-CWjEGAcE.js","assets/pdf-vendor-tUwojRr6.js","assets/firebase-vendor-BQc9GSQK.js","assets/ui-vendor-zQeyjr6j.js"])))=>i.map(i=>d[i]);
import{L as e,j as a,i as s,k as t,T as i,e as o,n as r,o as n,h as l,c,d,u as m,g as u,s as h,p as g,A as x,D as p,q as y,F as v,a as f,l as b,r as w,t as k,N,v as j,E as S}from"./business-owner-dashboard-DtOK4El9.js";import{r as C,R as _,u as D}from"./react-vendor-CWjEGAcE.js";import{p as I,x as E,l as z,E as R,G as T,H as L,j as A,u as M,q,w as $,t as F,m as P}from"./firebase-vendor-BQc9GSQK.js";import{U as W,h as U,X as O,g as H,N as B,i as V,al as G,a7 as K,K as Y,b as X,F as J,k as Z,a as Q,x as ee,aa as ae,am as se,an as te,q as ie,a9 as oe,R as re,_ as ne,ao as le,n as ce,L as de,I as me,ae as ue,M as he,ac as ge,af as xe,ap as pe,e as ye,aq as ve,m as fe,C as be,s as we,ak as ke,l as Ne,ai as je,H as Se,ar as Ce,as as _e,aj as De,d as Ie}from"./ui-vendor-zQeyjr6j.js";import{C as Ee,P as ze}from"./hr-dashboard-Bm2StNZs.js";import{a as Re}from"./pdf-vendor-tUwojRr6.js";class Te{constructor(){this.flows=new Map,this.listeners=[],this.stepConfigs=new Map,this.styles={info:"color: #2563eb; font-weight: bold;",warn:"color: #d97706; font-weight: bold;",error:"color: #dc2626; font-weight: bold;",debug:"color: #6b7280; font-weight: normal;",step:"color: #7c3aed; font-weight: bold; font-size: 14px;",data:"color: #059669; font-weight: normal;",validation:"color: #dc2626; font-weight: bold;"},this.initializeStepConfigs()}static getInstance(){return Te.instance||(Te.instance=new Te),Te.instance}initializeStepConfigs(){this.stepConfigs.set("INCIDENT_DETAILS",{name:"Incident Details",requiredFields:["employeeId","categoryId","incidentDate","incidentTime","incidentLocation","incidentDescription","issueDate","validityPeriod"],validations:[this.validateIncidentDetails.bind(this),this.validateDescriptionLength.bind(this),this.validateDates.bind(this)]}),this.stepConfigs.set("LEGAL_REVIEW_SIGNATURES",{name:"Legal Review & Signatures",requiredFields:["lraRecommendation","signatures.manager","signatures.employee"],validations:[this.validateLegalReview.bind(this),this.validateSignatures.bind(this)]}),this.stepConfigs.set("DELIVERY_COMPLETION",{name:"Delivery & Completion",requiredFields:["id","status","deliveryMethod"],validations:[this.validateDeliveryData.bind(this),this.validateFirestoreReadiness.bind(this)]})}startWizardSession(e){const a=e||`wizard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={sessionId:a,startTime:new Date,currentStep:"",completedSteps:[],logs:[],dataSnapshots:{},issues:[]};return this.flows.set(a,s),this.log(a,"info","SESSION","STARTED",null,{sessionId:a,timestamp:s.startTime}),a}endWizardSession(e,a){const s=this.flows.get(e);if(!s)return;const t=Date.now()-s.startTime.getTime();this.log(e,"info","SESSION","ENDED",null,{outcome:a,duration:`${Math.round(t/1e3)}s`,totalSteps:s.completedSteps.length,totalIssues:s.issues.length,finalStep:s.currentStep}),setTimeout(()=>{this.flows.delete(e)},3e5)}enterStep(e,a,s){const t=this.flows.get(e);t&&(t.currentStep=a,this.log(e,"info",a,"STEP_ENTERED",s,{previousStep:t.completedSteps[t.completedSteps.length-1]||"none",stepIndex:t.completedSteps.length+1}),s&&this.validateStepData(e,a,s,"STEP_ENTRY"))}exitStep(e,a,s,t=!0){const i=this.flows.get(e);i&&(t&&!i.completedSteps.includes(a)&&i.completedSteps.push(a),this.log(e,t?"info":"warn",a,"STEP_EXITED",s,{completed:t,timeInStep:this.getTimeInStep(e,a),totalCompletedSteps:i.completedSteps.length}),s&&t&&this.validateStepData(e,a,s,"STEP_EXIT"))}trackDataChange(e,a,s,t,i){this.log(e,"debug",a,"DATA_CHANGED",{field:s,oldValue:t,newValue:i,valueType:typeof i},{hasValue:null!=i&&""!==i,isValidChange:i!==t}),void 0===i&&void 0!==t&&this.trackIssue(e,a,`Field ${s} became undefined`,"medium"),typeof i!=typeof t&&void 0!==t&&this.trackIssue(e,a,`Field ${s} type changed from ${typeof t} to ${typeof i}`,"low")}trackFormSubmission(e,a,s){const t=this.flows.get(e);t&&(t.dataSnapshots[`${a}_${Date.now()}`]={...s},this.log(e,"info",a,"FORM_SUBMITTED",s,{fieldCount:Object.keys(s||{}).length,hasRequiredFields:this.checkRequiredFields(a,s)}),this.validateStepData(e,a,s,"FORM_SUBMISSION"))}trackAPICall(e,a,s,t,i,o){const r=o?"error":"info";this.log(e,r,a,"API_CALL",{api:s,params:t,result:o?void 0:i,error:o?.message||o},{success:!o,responseTime:Date.now()}),o&&this.trackIssue(e,a,`API call failed: ${s} - ${o.message}`,"high")}validateStepData(e,a,s,t){const i=this.stepConfigs.get(a);if(!i)return{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};let o={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return i.validations.forEach(e=>{const a=e(s);o.errors.push(...a.errors),o.warnings.push(...a.warnings),o.missingFields.push(...a.missingFields),o.undefinedFields.push(...a.undefinedFields),o.isValid=o.isValid&&a.isValid}),this.log(e,o.isValid?"info":"error",a,"VALIDATION",s,{context:t,validation:o}),o.errors.forEach(s=>{this.trackIssue(e,a,`Validation Error: ${s}`,"high")}),o.warnings.forEach(s=>{this.trackIssue(e,a,`Validation Warning: ${s}`,"medium")}),o}validateIncidentDetails(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return["employeeId","categoryId","incidentDate","incidentLocation","incidentDescription"].forEach(s=>{e[s]&&""!==e[s]||(a.errors.push(`Missing required field: ${s}`),a.missingFields.push(s),a.isValid=!1)}),Object.keys(e).forEach(s=>{void 0===e[s]&&(a.undefinedFields.push(s),a.errors.push(`Field ${s} is undefined`),a.isValid=!1)}),a}validateDescriptionLength(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDescription){const s=e.incidentDescription.trim().split(/\s+/).length;s<15&&a.warnings.push(`Incident description should be at least 15 words (currently ${s})`)}return a}validateDates(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDate){new Date(e.incidentDate)>new Date&&(a.errors.push("Incident date cannot be in the future"),a.isValid=!1)}if(e.issueDate){new Date(e.issueDate)>new Date&&a.warnings.push("Issue date is in the future")}return a}validateLegalReview(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.lraRecommendation||(a.errors.push("LRA recommendation is required"),a.missingFields.push("lraRecommendation"),a.isValid=!1),a}validateSignatures(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.signatures?.manager||(a.warnings.push("Manager signature missing"),a.missingFields.push("signatures.manager")),e.signatures?.employee||(a.warnings.push("Employee signature missing"),a.missingFields.push("signatures.employee")),a}validateDeliveryData(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.id||(a.errors.push("Warning ID is required for delivery"),a.missingFields.push("id"),a.isValid=!1),e.deliveryMethod||(a.warnings.push("Delivery method not specified"),a.missingFields.push("deliveryMethod")),a}validateFirestoreReadiness(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},s=this.findUndefinedFields(e);s.length>0&&(a.errors.push(`Undefined fields will cause Firestore errors: ${s.join(", ")}`),a.undefinedFields.push(...s),a.isValid=!1);return["id","organizationId","employeeId","categoryId"].forEach(s=>{e[s]||(a.errors.push(`Firestore requires field: ${s}`),a.missingFields.push(s),a.isValid=!1)}),a}findUndefinedFields(e,a=""){const s=[];return"object"!=typeof e||null===e||e instanceof Date||Object.entries(e).forEach(([e,t])=>{const i=a?`${a}.${e}`:e;void 0===t?s.push(i):"object"!=typeof t||null===t||t instanceof Date||s.push(...this.findUndefinedFields(t,i))}),s}trackIssue(e,a,s,t){const i=this.flows.get(e);if(!i)return;const o={step:a,issue:s,severity:t,timestamp:new Date};i.issues.push(o),this.log(e,"high"===t?"error":"warn",a,"ISSUE_DETECTED",null,{issue:s,severity:t,totalIssues:i.issues.length})}log(e,a,s,t,i,o){const r={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:new Date,level:a,step:s,action:t,data:i,metadata:o},n=this.flows.get(e);n&&n.logs.push(r),this.logToConsole(r,e),this.listeners.forEach(e=>e(r))}logToConsole(e,a){const s=`%c${{info:"💙",warn:"⚠️",error:"❌",debug:"🔍"}[e.level]} [${e.step}] ${e.action}`,t=this.styles[e.level];e.data?(console.groupCollapsed(`${s} (${a.slice(-6)})`,t),this.styles.data,e.data,e.validation&&(this.styles.validation,e.validation),e.metadata&&(this.styles.debug,e.metadata),console.groupEnd()):(a.slice(-6),e.metadata&&(this.styles.debug,e.metadata))}checkRequiredFields(e,a){const s=this.stepConfigs.get(e);return!s||s.requiredFields.every(e=>{const s=e.split(".");let t=a;for(const a of s)t=t?.[a];return null!=t&&""!==t})}getTimeInStep(e,a){const s=this.flows.get(e);if(!s)return"0s";const t=s.logs.reverse().find(e=>e.step===a&&"STEP_ENTERED"===e.action);if(!t)return"0s";const i=Date.now()-t.timestamp.getTime();return`${Math.round(i/1e3)}s`}addListener(e){this.listeners.push(e)}removeListener(e){const a=this.listeners.indexOf(e);a>-1&&this.listeners.splice(a,1)}getSessionLogs(e){return this.flows.get(e)?.logs||[]}getSessionIssues(e){return this.flows.get(e)?.issues||[]}getSessionSummary(e){const a=this.flows.get(e);return a?{sessionId:a.sessionId,startTime:a.startTime,currentStep:a.currentStep,completedSteps:a.completedSteps,totalLogs:a.logs.length,totalIssues:a.issues.length,issuesByLevel:{high:a.issues.filter(e=>"high"===e.severity).length,medium:a.issues.filter(e=>"medium"===e.severity).length,low:a.issues.filter(e=>"low"===e.severity).length},dataSnapshots:Object.keys(a.dataSnapshots).length}:null}exportSessionData(e){const a=this.flows.get(e);return a?JSON.stringify({summary:this.getSessionSummary(e),logs:a.logs,issues:a.issues,dataSnapshots:a.dataSnapshots},null,2):""}trackError(e,a,s,t){this.log(e,"error",a,"ERROR",{message:s.message,stack:s.stack,context:t}),this.trackIssue(e,a,s.message,"high")}trackSuccess(e,a,s,t){this.log(e,"info",a,`SUCCESS_${s}`,t)}trackWarning(e,a,s,t){this.log(e,"warn",a,"WARNING",t,{warning:s}),this.trackIssue(e,a,s,"medium")}}const Le=Te.getInstance(),Ae=({employees:e,selectedEmployeeId:r,onEmployeeSelect:n,warningHistory:l=[],isLoadingWarningHistory:c=!1,disabled:d=!1,className:m=""})=>{const[u,h]=C.useState(""),[g,x]=C.useState(!1),[p,y]=C.useState(!1),[v,f]=C.useState(!1),b=(e,a)=>e[a]?String(e[a]):e.profile?.[a]?String(e.profile[a]):"position"===a&&e.employment?.position?String(e.employment.position):"department"===a&&e.profile?.department?String(e.profile.department):"",w=C.useMemo(()=>{if(!u.trim())return e;const a=u.toLowerCase();return e.filter(e=>{const s=`${b(e,"firstName")} ${b(e,"lastName")}`.toLowerCase(),t=e.id?.toLowerCase()||"",i=b(e,"department").toLowerCase();return s.includes(a)||t.includes(a)||i.includes(a)})},[e,u]),k=C.useMemo(()=>e.find(e=>e.id===r),[e,r]),N=C.useCallback(e=>{n(e),x(!1),y(!1),f(!1),h("")},[n]),j=C.useCallback(()=>{if(d)return;window.innerWidth<768?f(!0):y(!p)},[d,p]),S=C.useCallback(()=>{f(!1),h("")},[]);return a.jsxs("div",{className:`space-y-4 ${m}`,children:[a.jsx(s,{icon:W,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:a.jsx(t,{variant:"secondary",size:"sm",children:w.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(d?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:p?"var(--color-primary)":"var(--color-border)",boxShadow:p?"0 0 0 2px var(--color-primary-light)":void 0},onClick:j,children:k?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[b(k,"firstName").charAt(0),b(k,"lastName").charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[b(k,"firstName")," ",b(k,"lastName")]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[b(k,"position")," • ",b(k,"department")]})]})]}),a.jsx(U,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(W,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(U,{className:"w-4 h-4 transition-transform "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),p&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:w.length>0?a.jsx("div",{className:"py-2",children:w.map(e=>((e=>{e.riskIndicators&&e.riskIndicators.highRisk})(e),(e=>{if(!e.recentWarnings)return null;const{count:a,lastDate:s,level:t}=e.recentWarnings})(e),a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:a.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[b(e,"firstName")," ",b(e,"lastName")," - ",b(e,"position")]})},e.id)))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(W,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsxs("p",{children:['No employees found matching "',u,'"']})]})})]})]})}),v&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:S}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),a.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),a.jsx("div",{className:"mobile-category-list",children:w.length>0?a.jsx("div",{children:w.map(e=>a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:a.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[b(e,"firstName")," ",b(e,"lastName")," - ",b(e,"position")]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No employees found"}),u&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',u,'"']})]})})]})]}),k&&g&&a.jsxs(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"flex items-center gap-1",children:[g?a.jsx(H,{className:"w-4 h-4"}):a.jsx(U,{className:"w-4 h-4"}),g?"Hide":"Show"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["📧 ",b(k,"email")||"No email",a.jsx("br",{}),"📱 ",b(k,"phone")||"No phone"]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[b(k,"position"),a.jsx("br",{}),b(k,"department")]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(B,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),a.jsx("span",{className:"font-medium text-gray-900",children:k.recentWarnings?.count||0})]}),k.recentWarnings?.lastDate&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),a.jsx("span",{className:"text-sm text-gray-900",children:new Date(k.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),k.riskIndicators&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),a.jsxs(t,{variant:k.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[a.jsx(V,{className:"w-4 h-4"}),k.riskIndicators.highRisk?"High Risk":"Low Risk"]}),k.riskIndicators.reasons.length>0&&a.jsx("div",{className:"mt-2",children:a.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:k.riskIndicators.reasons.slice(0,3).map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"text-amber-500 mt-0.5",children:"•"}),e]},s))})})]})]})]})]})]})},Me=({categories:e,selectedCategoryId:t,onCategorySelect:o,lraRecommendation:l,disabled:c=!1,className:d=""})=>{const[m,u]=C.useState(!1),[h,g]=C.useState(!1),[x,p]=C.useState(!1),[y,v]=C.useState(""),f=C.useMemo(()=>{if(!y.trim())return e;const a=y.toLowerCase();return e.filter(e=>{const s=e.name?.toLowerCase()||"",t=e.description?.toLowerCase()||"",i=e.severity?.toLowerCase()||"";return s.includes(a)||t.includes(a)||i.includes(a)})},[e,y]),b=C.useMemo(()=>e.find(e=>e.id===t),[e,t]),w=C.useCallback(e=>{o(e),u(!1),g(!1),p(!1),v("")},[o]),k=C.useCallback(()=>{if(c)return;window.innerWidth<768?p(!0):g(!h)},[c,h]),N=C.useCallback(()=>{p(!1),v("")},[]),j=C.useMemo(()=>b?b.escalationPath||r(b.id):[],[b]),S=C.useMemo(()=>l&&j.length?j.findIndex(e=>e===l.suggestedLevel):-1,[l,j]);return a.jsxs("div",{className:`space-y-4 ${d}`,children:[a.jsx(s,{icon:G,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:e.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(c?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:h?"var(--color-primary)":"var(--color-border)",boxShadow:h?"0 0 0 2px var(--color-primary-light)":void 0},onClick:k,children:b?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(W,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:b.name}),b.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:b.description})]})]}),a.jsx(U,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(W,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),a.jsx(U,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),h&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:f.length>0?a.jsx("div",{className:"py-2",children:f.map(e=>a.jsx("button",{onClick:()=>w(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.description})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(G,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{children:"No categories found"}),y&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',y,'"']})]})})]})]})}),x&&a.jsxs("div",{className:"mobile-category-modal",children:[a.jsx("div",{className:"mobile-category-modal-backdrop",onClick:N}),a.jsxs("div",{className:"mobile-category-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),a.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:f.length>0?a.jsx("div",{children:f.map(e=>a.jsxs("button",{onClick:()=>w(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:e.description})]})]},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No categories found"}),y&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',y,'"']})]})})]})]}),b&&m&&a.jsxs(i,{className:"rounded-xl p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),a.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[m?a.jsx(H,{className:"w-4 h-4"}):a.jsx(U,{className:"w-4 h-4"}),m?"Hide":"Show"]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:(e=>{switch(e?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}})(b.severity),children:b.severity})]}),b.description&&a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:b.description})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),l?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(K,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:n(l.suggestedLevel)}),l.isEscalation&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l.reason})]}):a.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((e,s)=>{const t=s===S,i=S>=0&&s<S;return a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:t?"var(--color-badge-primary)":i?"var(--color-muted)":"var(--color-card-background)",borderColor:t?"var(--color-primary)":"var(--color-border)",color:t?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[t&&a.jsx(Y,{className:"w-4 h-4"}),i&&a.jsx(X,{className:"w-4 h-4"}),a.jsx("span",{children:n(e)}),s<j.length-1&&a.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"→"})]},e)})}),l&&a.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(K,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",n(l.suggestedLevel)]}),a.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",l.categoryWarningCount??0," previous warning(s) in this category",l.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},qe=({formData:t,onFormDataChange:i,disabled:o=!1,className:r=""})=>{const[n,c]=C.useState(!1),[d,m]=C.useState({}),[u,h]=C.useState({}),{isSaving:g,lastSaved:x}=((e,a,s=2e3)=>{const t=C.useRef(),[i,o]=C.useState(!1),[r,n]=C.useState(null),l=C.useCallback(()=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{o(!0),a(e),n(new Date),o(!1)},s)},[e,a,s]);return C.useEffect(()=>(l(),()=>{t.current&&clearTimeout(t.current)}),[l]),{isSaving:i,lastSaved:r}})(t,e=>{localStorage.setItem("warningWizard_incidentDetails",JSON.stringify(e))});C.useEffect(()=>{const a=localStorage.getItem("warningWizard_incidentDetails");if(a)try{const e=JSON.parse(a);!t.incidentDescription&&!t.incidentLocation&&i(e)}catch(s){e.warn("Failed to load saved incident details:",s)}},[]);const p=C.useMemo(()=>{const e=t.incidentDescription||"",a=e.trim().split(/\s+/).filter(e=>e.length>0).length,s=a>=20,i=[];return a<20&&i.push(`Add ${20-a} more words for a complete description`),e.includes("when")||e.includes("time")||i.push("Consider adding when the incident occurred"),e.includes("where")||e.includes("location")||i.push("Consider specifying where the incident took place"),e.includes("what")||e.includes("action")||i.push("Be specific about what actions were observed"),!e.includes("witness")&&a>10&&i.push("Were there any witnesses to mention?"),{wordCount:a,isMinimumMet:s,suggestions:i}},[t.incidentDescription]),y=C.useCallback((e,a)=>{switch(e){case"incidentDate":if(!a)return"Incident date is required";return new Date(a)>new Date?"Incident date cannot be in the future":null;case"incidentTime":if(!a)return"Incident time is required";return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(a)?null:"Please enter time in HH:MM format";case"incidentLocation":return!a||a.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":return!a||a.trim().length<20?"Description must be at least 20 characters":a.trim().length>2e3?"Description is too long (maximum 2000 characters)":null;default:return null}},[]),v=C.useCallback((e,a)=>{i({[e]:a}),h(a=>({...a,[e]:!0}));const s=y(e,a);m(a=>({...a,[e]:s}))},[i,y]),f=(new Date).toISOString().split("T")[0];return a.jsxs("div",{className:`space-y-4 ${r}`,children:[a.jsx(s,{icon:J,title:"Incident Details",subtitle:"Provide comprehensive details about the incident",rightContent:a.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--color-text-tertiary)"},children:[g&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{className:"w-4 h-4 animate-pulse"}),a.jsx("span",{children:"Saving..."})]}),x&&!g&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsxs("span",{children:["Saved ",x.toLocaleTimeString()]})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ee,{type:"date",label:"Incident Date",value:t.incidentDate||"",onChange:e=>v("incidentDate",e),icon:ee,required:!0,disabled:o,error:d.incidentDate&&u.incidentDate?d.incidentDate:void 0}),a.jsx(Ee,{type:"time",label:"Incident Time",value:t.incidentTime||"",onChange:e=>v("incidentTime",e),icon:B,required:!0,disabled:o,error:d.incidentTime&&u.incidentTime?d.incidentTime:void 0})]}),a.jsx(l,{type:"text",label:"Incident Location",value:t.incidentLocation||"",onChange:e=>v("incidentLocation",e),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:ae,required:!0,disabled:o,error:d.incidentLocation&&u.incidentLocation?d.incidentLocation:void 0}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[a.jsx(se,{className:"w-3 h-3 inline mr-1"}),"Incident Description *"]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsxs("button",{type:"button",onClick:()=>c(!n),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-primary)"},children:[a.jsx(te,{className:"w-3 h-3"}),"Writing Tips"]}),a.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:p.isMinimumMet?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:p.isMinimumMet?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[p.wordCount," words"]})]})]}),a.jsx("textarea",{value:t.incidentDescription||"",onChange:e=>v("incidentDescription",e.target.value),placeholder:"Describe exactly what happened. Include specific details such as what was said or done, who was present, and any relevant context...",disabled:o,rows:6,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical "+(o?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:d.incidentDescription&&u.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:d.incidentDescription&&u.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),d.incidentDescription&&u.incidentDescription&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[a.jsx(X,{className:"w-3 h-3"}),d.incidentDescription]}),n&&a.jsxs("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[a.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:"var(--color-alert-info-text)"},children:"Writing Assistance"}),a.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--color-alert-info-text)"},children:[p.suggestions.map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(te,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsx("span",{children:e})]},s)),0===p.suggestions.length&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-green-700",children:"Your description looks comprehensive!"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-xs font-medium text-gray-700",children:["Additional Notes",a.jsx("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),a.jsx("textarea",{value:t.additionalNotes||"",onChange:e=>v("additionalNotes",e.target.value),placeholder:"Any additional context, background information, or relevant details...",disabled:o,rows:3,className:`\n            w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n            ${o?"opacity-50 cursor-not-allowed":""}\n          `})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date *"}),a.jsx("input",{type:"date",value:t.issueDate||f,onChange:e=>v("issueDate",e.target.value),disabled:o,className:`\n              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n              ${o?"opacity-50 cursor-not-allowed":""}\n            `})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Validity Period *"}),a.jsxs("select",{value:t.validityPeriod||6,onChange:e=>v("validityPeriod",parseInt(e.target.value)),disabled:o,className:`\n              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n              ${o?"opacity-50 cursor-not-allowed":""}\n            `,children:[a.jsx("option",{value:3,children:"3 months"}),a.jsx("option",{value:6,children:"6 months"}),a.jsx("option",{value:12,children:"12 months"})]})]})]})]})},$e=({employees:e,categories:s,formData:t,updateFormData:i,selectedEmployee:o,selectedCategory:r,warningHistory:n=[],isLoadingWarningHistory:l=!1,loadWarningHistory:d,lraRecommendation:m,isAnalyzing:u=!1})=>{const h=C.useMemo(()=>{const e={employee:!!t.employeeId,category:!!t.categoryId,date:!!t.incidentDate,time:!!t.incidentTime,location:!!t.incidentLocation&&t.incidentLocation.length>=3,description:!!t.incidentDescription&&t.incidentDescription.length>=20},a=Object.values(e).filter(Boolean).length,s=Object.keys(e).length;return{checks:e,completed:a,total:s,percentage:Math.round(a/s*100)}},[t]);return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between px-1",children:[a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Progress"}),a.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[h.completed,"/",h.total]})]}),a.jsx("div",{className:"w-full rounded h-1",style:{backgroundColor:"var(--color-surface)"},children:a.jsx("div",{className:"h-1 rounded transition-all duration-300",style:{width:`${h.percentage}%`,backgroundColor:"var(--color-primary)"}})}),a.jsx(Ae,{employees:e,selectedEmployeeId:t.employeeId,onEmployeeSelect:e=>{i({employeeId:e}),d&&d(e)},warningHistory:n,isLoadingWarningHistory:l,disabled:u}),a.jsx(Me,{categories:s,selectedCategoryId:t.categoryId,onCategorySelect:e=>{i({categoryId:e})},lraRecommendation:m,disabled:u}),a.jsx(qe,{formData:t,onFormDataChange:i,disabled:u}),u&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),a.jsx("span",{className:"text-sm",children:"Analyzing incident..."})]})}),m&&!u&&m.requiresHRIntervention&&a.jsx(c,{variant:"error",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(X,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-error)"},children:"Contact HR Required"}),a.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text)"},children:m.interventionReason}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee has final warning on record - HR intervention required before proceeding"})]})]})}),m&&!u&&!m.requiresHRIntervention&&a.jsx(c,{variant:"success",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Q,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:["Recommended: ",m.recommendedLevel]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:m.reason})]})]})}),100===h.percentage&&!u&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(ie,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:"Ready for Legal Review"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:'All details completed. Click "Next" to proceed.'})]})]})})]})},Fe="Africa/Johannesburg",Pe=({onSignatureComplete:e,disabled:s=!1,label:t,placeholder:i="Click and drag to sign",initialSignature:o=null,className:r="",width:n=400,height:l=200})=>{const c=C.useRef(null),d=C.useRef(null),[m,u]=C.useState(!1),[h,g]=C.useState(!1),[x,p]=C.useState(!1),[y,v]=C.useState([]),[f,b]=C.useState(!1),w=C.useCallback(()=>{const e=c.current;if(!e)return;const a=e.getContext("2d");if(!a)return;const s=e.getBoundingClientRect(),t=window.devicePixelRatio||1;e.width=s.width*t,e.height=s.height*t,a.scale(t,t),a.strokeStyle="#1e293b",a.lineWidth=2,a.lineCap="round",a.lineJoin="round",a.globalCompositeOperation="source-over",a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),b(!0)},[]),k=C.useCallback(e=>{const a=c.current;if(!a)return{x:0,y:0};const s=a.getBoundingClientRect();let t,i;if("touches"in e&&e.touches.length>0)t=e.touches[0].clientX,i=e.touches[0].clientY;else{if(!("clientX"in e))return{x:0,y:0};t=e.clientX,i=e.clientY}return{x:t-s.left,y:i-s.top}},[]),N=C.useCallback(e=>{if(s)return;e.preventDefault();const a=c.current,t=a?.getContext("2d");if(!a||!t)return;u(!0);const{x:i,y:o}=k(e);t.beginPath(),t.moveTo(i,o);const r={points:[{x:i,y:o}],timestamp:Date.now()};v(e=>[...e,r])},[s,k]),j=C.useCallback(e=>{if(!m||s)return;e.preventDefault();const a=c.current,t=a?.getContext("2d");if(!a||!t)return;const{x:i,y:o}=k(e);t.lineTo(i,o),t.stroke(),v(e=>{if(0===e.length)return e;const a=[...e];return a[a.length-1].points.push({x:i,y:o}),a})},[m,s,k]),S=C.useCallback(()=>{m&&(u(!1),p(!0))},[m]),_=C.useCallback(()=>{if(s)return;const a=c.current,t=a?.getContext("2d");if(!a||!t)return;const i=((e,a=Fe)=>(e instanceof Date?e:new Date(e)).toLocaleString("en-ZA",{timeZone:a,year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}))(new Date,Fe),o=a.getBoundingClientRect();t.save(),t.font="10px Arial, sans-serif",t.fillStyle="#64748b",t.textAlign="right",t.textBaseline="bottom",t.fillText(i,o.width-8,o.height-8),t.restore();const r=a.toDataURL("image/png");g(!0),p(!1),e(r)},[s,e]),D=C.useCallback(()=>{if(s)return;const a=c.current,t=a?.getContext("2d");a&&t&&(t.fillStyle="#ffffff",t.fillRect(0,0,a.width,a.height),g(!1),p(!1),v([]),e(null))},[s,e]);return C.useEffect(()=>{if(!f||s)return;const e=c.current;if(!e)return;const a=e=>N(e),t=e=>j(e),i=()=>S(),o=()=>S(),r=e=>N(e),n=e=>j(e),l=()=>S();return e.addEventListener("mousedown",a,{passive:!1}),e.addEventListener("mousemove",t,{passive:!1}),e.addEventListener("mouseup",i),e.addEventListener("mouseleave",o),e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("touchmove",n,{passive:!1}),e.addEventListener("touchend",l),d.current=()=>{e.removeEventListener("mousedown",a),e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i),e.removeEventListener("mouseleave",o),e.removeEventListener("touchstart",r),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",l)},d.current},[f,s,N,j,S]),C.useEffect(()=>{w()},[w]),C.useEffect(()=>{if(o&&f){const e=c.current,a=e?.getContext("2d");if(!e||!a)return;const s=new Image;s.onload=()=>{const t=e.getBoundingClientRect();a.clearRect(0,0,e.width,e.height),a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),a.drawImage(s,0,0,t.width,t.height),g(!0)},s.onerror=()=>{console.error("Failed to load signature image")},s.src=o}},[o,f]),C.useEffect(()=>()=>{d.current&&d.current()},[]),y.length>=1&&(y.some(e=>e.points.length>=5)||y.length),a.jsxs("div",{className:`space-y-3 ${r}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:t}),a.jsxs("div",{className:"flex items-center gap-2",children:[h&&a.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[a.jsx(oe,{className:"w-3 h-3"}),a.jsx("span",{children:"Saved"})]}),x&&!h&&a.jsxs("button",{type:"button",onClick:_,disabled:s,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded disabled:opacity-50",children:[a.jsx(oe,{className:"w-3 h-3"}),"Save Signature"]}),a.jsxs("button",{type:"button",onClick:D,disabled:s||!h&&!x,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-red-600 disabled:opacity-50",children:[a.jsx(re,{className:"w-3 h-3"}),"Clear"]})]})]}),a.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg bg-white\n        ${s?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}\n        ${h?"border-green-300 bg-green-50":""}\n      `,children:[a.jsx("canvas",{ref:c,width:n,height:l,className:`\n            block w-full h-full cursor-crosshair rounded-lg\n            ${s?"cursor-not-allowed":""}\n          `,style:{width:`${n}px`,height:`${l}px`}}),!h&&!s&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[a.jsx(se,{className:"w-4 h-4"}),a.jsx("span",{children:i})]})})]})]})},We=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],Ue={en:{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},af:{counselling:"Beradingsessie",verbal:"Mondelinge Waarskuwing",first_written:"Eerste Geskrewe Waarskuwing",second_written:"Tweede Geskrewe Waarskuwing",final_written:"Finale Geskrewe Waarskuwing"},zu:{counselling:"Iseshini Yokweluleka",verbal:"Isexwayiso Ngomlomo",first_written:"Isexwayiso Sokuqala Esibhaliwe",second_written:"Isexwayiso Sesibili Esibhaliwe",final_written:"Isexwayiso Sokugcina Esibhaliwe"},xh:{counselling:"Iseshoni Yokucebisa",verbal:"Isilumkiso Ngomlomo",first_written:"Isilumkiso Sokuqala Esibhaliweyo",second_written:"Isilumkiso Sesibini Esibhaliweyo",final_written:"Isilumkiso Sokugqibela Esibhaliweyo"},st:{counselling:"Seboka sa Keletso",verbal:"Temoso ya Molomo",first_written:"Temoso ya Pele e Ngotsweng",second_written:"Temoso ya Bobedi e Ngotsweng",final_written:"Temoso ya ho Qetela e Ngotsweng"},ts:{counselling:"Nkarhi wo Tivonela",verbal:"Xilumkiso xa Marito",first_written:"Xilumkiso xa Sinthoma xa Ku Tsariwa",second_written:"Xilumkiso xa Vumbirhi xa Ku Tsariwa",final_written:"Xilumkiso xa Makumu xa Ku Tsariwa"},ve:{counselling:"Tshikhala tsha Themendelo",verbal:"Tivhiso ya Ipfi",first_written:"Tivhiso ya u Thoma yo Ṅwalwaho",second_written:"Tivhiso ya vhuvhili yo Ṅwalwaho",final_written:"Tivhiso ya u Fhedzisela yo Ṅwalwaho"},ss:{counselling:"Seshoni Sekululeleka",verbal:"Sixwayiso Ngemlomo",first_written:"Sixwayiso Sekucala Lesibhaliwe",second_written:"Sixwayiso Sesibili Lesibhaliwe",final_written:"Sixwayiso Sekugcina Lesibhaliwe"},tn:{counselling:"Khuduthamaga ya Kgakololo",verbal:"Temoso ya Molomo",first_written:"Temoso ya Ntlha e e Kwadilweng",second_written:"Temoso ya Bobedi e e Kwadilweng",final_written:"Temoso ya Bofelo e e Kwadilweng"},nr:{counselling:"Iseshini Yokululeleka",verbal:"Isixwayiso Ngomlomo",first_written:"Isixwayiso Sokuqala Esibhaliwe",second_written:"Isixwayiso Sesibili Esibhaliwe",final_written:"Isixwayiso Sokugcina Esibhaliwe"},ns:{counselling:"Kopano ya Keletšo",verbal:"Temošo ya Molomo",first_written:"Temošo ya Pele yeo e Ngwadilwego",second_written:"Temošo ya Bobedi yeo e Ngwadilwego",final_written:"Temošo ya Mafelelo yeo e Ngwadilwego"}},Oe={en:{greeting:(e,a)=>`${e}, as we've discussed, this meeting is to formalize the written warning regarding the workplace incident that occurred.`,purpose:()=>"We've already covered the details of what happened. Now I need to formally explain the warning level, the validity period, your rights, and the consequences if similar behavior occurs again. This process follows the Labour Relations Act and our company's disciplinary policy.",incident:e=>`To recap what we discussed earlier: ${e}. This behavior is not acceptable under our workplace standards and company policies, and it must be corrected immediately.`,warningExplanation:(e,a)=>`This is a ${e}. It will remain on your employment record for ${a} months from today's date. During this validity period, you are expected to demonstrate immediate and sustained improvement in your conduct.`,rights:()=>"Now, it's very important that you understand your rights:",rightsList:()=>["You have the right to appeal this warning within 48 hours if you believe it is unfair or procedurally incorrect. Your appeal must be submitted in writing to HR.","This disciplinary process is progressive - if similar conduct occurs during the validity period of this warning, it may result in further disciplinary action, up to and including dismissal for gross misconduct.","All information will be kept confidential and only shared with relevant management and HR personnel."],witnessOption:()=>"Your signature on this document acknowledges that this warning has been explained to you and that you understand its contents and your rights. Your signature does NOT mean you agree with the warning - it simply confirms you have been properly notified. If you choose not to sign, that is your right. In that case, a witness will sign to confirm that this warning was explained to you in your presence and that you were informed of all your rights. The warning remains valid regardless of whether you sign it or a witness signs it.",questions:()=>"Do you have any questions about this warning, the validity period, the consequences, or your rights? I want to make sure you fully understand everything before we proceed with signatures.",closing:()=>"Thank you. We will now proceed to collect signatures to formalize this warning. Remember, this is an opportunity for you to correct your conduct. We expect to see immediate improvement, and we hope this will be the end of this matter."},af:{greeting:(e,a)=>`${e}, soos ons bespreek het, is hierdie vergadering om die skriftelike waarskuwing te formaliseer rakende die werkplek incident wat plaasgevind het.`,purpose:()=>"Ons het reeds die besonderhede van wat gebeur het gedek. Nou moet ek formeel die waarskuwingsvlak, die geldigheidsperiode, jou regte, en die gevolge verduidelik as soortgelyke gedrag weer voorkom. Hierdie proses volg die Wet op Arbeidsverhoudinge en ons maatskappy se dissiplinêre beleid.",incident:e=>`Om op te som wat ons vroeër bespreek het: ${e}. Hierdie gedrag is nie aanvaarbaar onder ons werkplek standaarde en maatskappy beleide nie, en dit moet onmiddellik reggestel word.`,warningExplanation:(e,a)=>`Dit is 'n ${e}. Dit sal in jou werkrekord bly vir ${a} maande vanaf vandag se datum. Gedurende hierdie geldigheidsperiode word daar van jou verwag om onmiddellike en volgehoue verbetering in jou gedrag te toon.`,rights:()=>"Nou, dit is baie belangrik dat jy jou regte verstaan:",rightsList:()=>["Jy het die reg om hierdie waarskuwing binne 48 uur te appelieer as jy glo dit is onregverdig of prosedureel verkeerd. Jou appèl moet skriftelik by HR ingedien word.","Hierdie dissiplinêre proses is progressief - as soortgelyke gedrag gedurende die geldigheidsperiode van hierdie waarskuwing voorkom, kan dit lei tot verdere dissiplinêre aksie, tot en met ontslag vir growwe wangedrag.","Alle inligting sal vertroulik gehou word en slegs met relevante bestuur en HR personeel gedeel word."],witnessOption:()=>"Jou handtekening op hierdie dokument erken dat hierdie waarskuwing aan jou verduidelik is en dat jy die inhoud en jou regte verstaan. Jou handtekening beteken NIE dat jy met die waarskuwing saamstem nie - dit bevestig bloot dat jy behoorlik in kennis gestel is. As jy kies om nie te teken nie, is dit jou reg. In daardie geval sal 'n getuie teken om te bevestig dat hierdie waarskuwing aan jou in jou teenwoordigheid verduidelik is en dat jy van al jou regte ingelig is. Die waarskuwing bly geldig ongeag of jy dit teken of 'n getuie dit teken.",questions:()=>"Het jy enige vrae oor hierdie waarskuwing, die geldigheidsperiode, die gevolge, of jou regte? Ek wil seker maak dat jy alles ten volle verstaan voordat ons voortgaan met handtekeninge.",closing:()=>"Dankie. Ons sal nou voortgaan om handtekeninge te versamel om hierdie waarskuwing te formaliseer. Onthou, dit is 'n geleentheid vir jou om jou gedrag reg te stel. Ons verwag onmiddellike verbetering, en ons hoop dit sal die einde van hierdie saak wees."},zu:{greeting:(e,a)=>`${e}, njengoba sixoxe, le mihlangano iwukuqinisa isixwayiso esibhaliwe mayelana nesigameko somsebenzi esenzekile.`,purpose:()=>"Sesivele saxoxa imininingwane yalokho okwenzekile. Manje ngidinga ukuchaza ngokusemthethweni izinga lesixwayiso, isikhathi sokusebenza, amalungelo akho, nemiphumela uma ukuziphatha okufanayo kuphinde kwenzeke. Le nqubo ilandela uMthetho Wobudlelwano Basebenzi kanye nenqubomgomo yokuqeqesha yenkampani yethu.",incident:e=>`Ukuphinda kulokho esikuxoxe kuqala: ${e}. Lokhu kuziphatha akwamukeleki ngaphansi kwezindinganiso zethu zendawo yomsebenzi nezinqubomgomo zenkampani, futhi kumele kulungiswe masinyane.`,warningExplanation:(e,a)=>`Lesi isixwayiso se-${e}. Sizosala kumarekhodi akho womsebenzi izinyanga ezingu-${a} kusukela namuhla. Phakathi nalesi sikhathi sokusebenza, kulindeleke ukuba ukhombise ukuthuthuka okusheshayo nokuqhubekayo ekuziphatheni kwakho.`,rights:()=>"Manje, kubalulekile kakhulu ukuthi uqonde amalungelo akho:",rightsList:()=>["Unelungelo lokuphikisa lesi sixwayiso phakathi namahora angu-48 uma ukholelwa ukuthi asilungile noma asenziwa ngendlela engalungile. Isicelo sakho sokubhena kufanele sinikezwe ngokubhaliwe ku-HR.","Le nqubo yokuqeqesha iyaqhubeka - uma ukuziphatha okufanayo kwenzeka phakathi nesikhathi sokusebenza salesi sixwayiso, kungase kuholele esinyweni esinye sokuqeqesha, kuya ekuxoshweni ngenxa yokuziphatha okubi kakhulu.","Lonke ulwazi luzogcinwa luyimfihlo futhi lubelane kuphela nabapha boholi nabadlulisi be-HR abadingekayo."],witnessOption:()=>"Ukusayina kwakho kule dokhumenti kuyavuma ukuthi lesi sixwayiso sikuchazelwe futhi uyaqonda okuqukethwe namalungelo akho. Ukusayina kwakho AKUSHO ukuthi uyavuma nesixwayiso - kusho nje ukuthi wazisiwe ngendlela efanele. Uma ukhetha ukungasayini, yilelo ilungelo lakho. Kuleso sigameko, ufakazi uzosayina ukuqinisekisa ukuthi lesi sixwayiso sikuchazelwe ebukheneni bakho nokuthi wazisiwa ngawo onke amalungelo akho. Isixwayiso sihlala sisebenza kungakhathaliseki ukuthi uyasisayina noma ufakazi uyasisayina.",questions:()=>"Ingabe unemibuzo mayelana nalesi sixwayiso, isikhathi sokusebenza, imiphumela, noma amalungelo akho? Ngifuna ukuqinisekisa ukuthi uqonda konke ngokugcwele ngaphambi kokuqhubeka nezimo zokusayina.",closing:()=>"Ngiyabonga. Manje sizokwenza ukuqoqa izimo zokusayina ukuqinisa lesi sixwayiso. Khumbula, leli ithuba lokuthi ulungise ukuziphatha kwakho. Silindele ukubona ukuthuthuka okusheshayo, futhi sithemba ukuthi lokhu kuzoba ukuphela kwalolu daba."},xh:{greeting:(e,a)=>`${e}, njengoko sixoxile, le ntlanganiso ikuqinisekisa isilumkiso esibhaliweyo malunga nesiganeko emsebenzini esenzekileyo.`,purpose:()=>"Sele sixoxile ngeenkcukacha zoko kwenzekileyo. Ngoku kufuneka ndichaze ngokusemthethweni inqanaba lesilumkiso, ixesha lokusebenza, amalungelo akho, kunye neziphumo ukuba ukuziphatha okufanayo kuphinde kwenzeke. Le nkqubo ilandela uMthetho woBudlelwane baBasebenzi kunye nemigaqo-nkqubo yenkampani yethu yokulungisa.",incident:e=>`Ukuphinda oko saxoxe ngako ngaphambili: ${e}. Oku kuziphatha akwamkelekanga phantsi kwemigangatho yethu yendawo yomsebenzi kunye nemigaqo-nkqubo yenkampani, kwaye kufuneka kulungiswe ngokukhawuleza.`,warningExplanation:(e,a)=>`Esi yisilumkiso se-${e}. Siza kuhlala kwiirekhodi zakho zomsebenzi iinyanga ezingu-${a} ukusuka kulo mhla. Ngeli xesha lokusebenza, kulindeleke ukukhombisa uphuculo olukhawulezayo noluqhubekayo ekuziphatheni kwakho.`,rights:()=>"Ngoku, kubalulekile kakhulu ukuba uqonde amalungelo akho:",rightsList:()=>["Unelungelo lokubhena esi silumkiso ngaphakathi kweeyure ezingama-48 ukuba ukholelwa ukuba asifanelekanga okanye asenziwa kakubi. Isibheno sakho kufuneka sinikezelwe ngokubhaliwe kwi-HR.","Le nkqubo yokulungisa iyaqhubeka - ukuba ukuziphatha okufanayo kwenzeka ngeli xesha lokusebenza lwesi silumkiso, kunokukhokelela kwelinye inyathelo lokulungisa, kuya ekugxothweni ngenxa yokuziphatha okugwenxa kakhulu.","Lonke ulwazi luya kugcinwa luyimfihlo kwaye lwabiwe kuphela nabaphathi abafanelekileyo nabasebenzi be-HR."],witnessOption:()=>"Utyikityo lwakho kolu xwebhu luvuma ukuba esi silumkiso sichaziwe kuwe kwaye uyakuqonda okuqulethwe kunye namalungelo akho. Utyikityo lwakho ALUSITHI uyavumelana nesilumkiso - lusithi kuphela ukuba waziswa ngokufanelekileyo. Ukuba ukhetha ukungasayini, lelo lilungelo lakho. Kwimeko enjalo, ingqina iya kusayina ukuqinisekisa ukuba esi silumkiso sichaziwe kuwe ubukho bakho kwaye waziswa ngawo onke amalungelo akho. Isilumkiso sihlala sisebenza nokuba usisayinile okanye ingqina iyasisayina.",questions:()=>"Ingaba unemibuzo malunga nesi silumkiso, ixesha lokusebenza, iziphumo, okanye amalungelo akho? Ndifuna ukuqinisekisa ukuba uyakuqonda konke ngokupheleleyo ngaphambi kokuqhubeka neetyikityo.",closing:()=>"Enkosi. Ngoku siya kuqhubeka ukuqokelela iityikityo ukuqinisekisa esi silumkiso. Khumbula, eli lithuba lakho lokulungisa ukuziphatha kwakho. Silindele ukubona uphuculo olukhawulezayo, kwaye sinethemba lokuba oku kuya kuba sisiphelo sale meko."},st:{greeting:(e,a)=>`${e}, joalo ka ha re buisaneng, kopano ena ke ho tiisa temoso e ngotsoeng mabapi le ketsahalo ea mosebetsi e etsahetseng.`,purpose:()=>"Re se re buisane ka lintlha tsa se etsahetseng. Joale ke hloka ho hlalosa ka molao boemo ba temoso, nako ea tšebetso, litokelo tsa hao, le ditlamorao haeba boits'oaro bo tšoanang bo hlaha hape. Tshebetso ena e latela Molao oa Likamano tsa Basebetsi le pholisi ea kgetho ea khamphani ea rona.",incident:e=>`Ho pheta se re buisaneng ka sona pele: ${e}. Boitshwaro bona ha bo amohelehe ka tlasa litekanyetso tsa rona tsa sebaka sa mosebetsi le dipholisi tsa khamphani, 'me e tlameha ho lokisoa hang-hang.`,warningExplanation:(e,a)=>`Ena ke temoso ea ${e}. E tla lula lirekoting tsa hao tsa mosebetsi likhoeli tse ${a} ho tloha kajeno. Nakong ena ea tšebetso, ho lebelletsoe hore o bonts'e ntlafatso e potlakileng le e tsoelang pele boitshwarong ba hao.`,rights:()=>"Joale, ho bohlokwa haholo hore o utloisise litokelo tsa hao:",rightsList:()=>["O na le tokelo la ho ipeela temoso ena ka mora dihora tse 48 haeba o lumela hore ha e nepahale kapa e etsoa hampe. Kopo ea hao ea ho ipeela e tlameha ho fanoa ka ho ngola ho HR.","Tshebetso ena ea kgetho e tsoela pele - haeba boitshwaro bo tšoanang bo etsahala nakong ea tšebetso ea temoso ena, ho ka hlahisa khato e 'ngoe ea kgetho, ho fihla tlōsong ka lebaka la boitshwaro bo bobe haholo.","Tlhahisoleseding eohle e tla bolokoa e le lekunutu 'me e arolelane feela le bataoli ba hlokahalang le basebetsi ba HR."],witnessOption:()=>"Saeno ea hao tokomaneng ena e amohela hore temoso ena e hlalositsoe ho uena 'me o utloisisa litaba le litokelo tsa hao. Saeno ea hao HA E BOLELE hore o lumela le temoso - e bolela feela hore o tsebisitsoe ka nepo. Haeba o khetha ho se saene, ke tokelo la hao. Tabeng eo, paki e tla saena ho tiisa hore temoso ena e hlalositsoe ho uena sebakeng sa hao le hore o tsebisitsoe litokelo tsa hao tsohle. Temoso e lula e sebetsa ho sa natsoe hore na o e saenile kapa paki e e saenile.",questions:()=>"Na o na le lipotso mabapi le temoso ena, nako ea tšebetso, ditlamorao, kapa litokelo tsa hao? Ke batla ho netefatsa hore o utloisisa tsohle ka botlalo pele re tsoela pele ka mesaeno.",closing:()=>"Kea leboha. Joale re tla tsoela pele ho bokella mesaeno ho tiisa temoso ena. Hopola, ena ke monyetla oa hao oa ho lokisa boitshwaro ba hao. Re lebeletse ho bona ntlafatso e potlakileng, 'me re ts'epa hore ena e tla ba qetello ea taba ena."},ts:{greeting:(e,a)=>`${e}, tanihileswi hi burisene, nhlanganiso lowu i ku tiyisa xilumkiso lexi tsariweke hi timhaka ta xivangelo xa ntirho lexi nga endleke.`,purpose:()=>"Hi se hi burisene hi swileriso swa leswi nga endleke. Sweswi ndzi lava ku hlamusela hi ndlela ya nawu mpimo wa xilumkiso, nkarhi wa ku tirhisa, timfanelo ta wena, ni mimpikiselo loko mavanyiselo yo fana ma nga hluvukisa hi n'wana. Nongonoko lowu wu landzela Nawu wa Vuhlanganisi bya Vatirhi ni pholisi ya ndzulavulo ya khamphani ya hina.",incident:e=>`Ku phindha leswi hi swi burisene khale: ${e}. Mavanyiselo lawa ma nga amukeleriwi hi ka tlhelo ka swiyimo swa hina swa ndhawu ya ntirho ni tipholisi ta khamphani, naswona ma fanele ku lulamisiwa hi ku hatlisa.`,warningExplanation:(e,a)=>`Lexi i xilumkiso xa ${e}. Xi ta tshama eka rhekhodo ya wena ya ntirho tin'hweti ta ${a} ku suka namuntlha. Eka nkarhi lowu wa ku tirhisa, ku languteriwa leswaku u kombisa ku antswisa loku hatlisaka ni loku ya emahlweni eka mavanyiselo ya wena.`,rights:()=>"Sweswi, swa nkoka swinene leswaku u twisisa timfanelo ta wena:",rightsList:()=>["U na timfanelo ro appila xilumkiso lexi hi nkarhi wa tawa ta 48 loko u tshemba leswaku a xi lulamanga kumbe xi endliwile hambi. Xikombelo xa wena xo appila xi fanele ku nyikeriwa hi ku tsala eka HR.","Nongonoko lowu wa ndzulavulo wu ya emahlweni - loko mavanyiselo yo fana ma nga endleka eka nkarhi wa ku tirhisa wa xilumkiso lexi, swi nga endla leswaku ku va goza rin'wana ra ndzulavulo, ku ya eka ku herisiwa hikuva ka mavanyiselo yo biha swinene.","Rungula hinkwaro ri ta hlayisiwa ri ri swihlayiselo naswona ri avelaniwa ntsena na vafambisi lava lavekaka ni vatirhi va HR."],witnessOption:()=>"Vusayini bya wena eka tsalwa leri byi amukela leswaku xilumkiso lexi xi hlamuseriwile eka wena naswona u twisisa leswi nga endzeni ni timfanelo ta wena. Vusayini bya wena A BYI VULI leswaku u pfumela ni xilumkiso - byi vula ntsena leswaku u tivisisiwile hi ndlela yo lulamela. Loko u hlawula ku nga sayini, sweswo i timfanelo ta wena. Eka xiyimo lexinyana, nhlamulo a nga ta ku sayina ku tiyisisa leswaku xilumkiso lexi xi hlamuseriwile eka wena hi vukona bya wena naswona u tivisisiwile hi timfanelo ta wena hinkwato. Xilumkiso xi hlaya xi tirhaka hambi leswaku u xi sayinile kumbe nhlamulo a xi sayinile.",questions:()=>"Xana u na swivutiso hi xilumkiso lexi, nkarhi wa ku tirhisa, mimpikiselo, kumbe timfanelo ta wena? Ndzi lava ku tiyisisa leswaku u twisisa hinkwaswo hi ku helela ka ku ya emahlweni ni vusayini.",closing:()=>"Inkomu. Sweswi hi ta ya emahlweni ku hlengeleta vusayini ku tiyisa xilumkiso lexi. Tsundzuka, leswi i nkarhi wa wena wo lulamisa mavanyiselo ya wena. Hi langutera ku vona ku antswisa loku hatlisaka, naswona hi tshemba leswaku leswi swi ta va makumu wa xiyimo lexi."},ve:{greeting:(e,a)=>`${e}, sa zwe ra amba, iyi meetingi ndi ya u tiyisedza tivhiso yo ṅwalwaho nga ha zwithu zwa mushumo zwine zwa itika.`,purpose:()=>"Ro vha ro amba nga ha zwine zwa itika. Zwino ndi tea u talutshedzisa nga ndila ya mulayo vhuimo ha tivhiso, tshifhinga tsha u shuma, pfanelo dzavho, na mvelelo arali maitele a tshi tou fana a tshi itea hafhu. Uyu muitero u tevhedza Mulayo wa Vhushaka ha Vhashumi na polisi ya mulandu ya khamphani yashu.",incident:e=>`U dovhola zwine ra zwi amba khaladzi: ${e}. Maitele aya a si kha fhasi ha zwiyimo zwashu zwa fhethu ha mushumo na mipholisi ya khamphani, nahone a tea u khwiniswa zwino-zwino.`,warningExplanation:(e,a)=>`Iyi ndi tivhiso ya ${e}. I do dzula kha rekhodho yavho ya mushumo minwedzi ya ${a} u bva ḓuvha la namusi. Nga tshifhinga tsha u shuma hetshi, hu tea uri no kombedza u khwinisa ha u tavhanya na u fhiraho phanḓa kha maitele avho.`,rights:()=>"Zwino, zwa konḓelele uri no pfesese pfanelo dzavho:",rightsList:()=>["No na pfanelo ya u appela iyi tivhiso nga tshifhinga tsha awara dza 48 arali no tenda uri a i kha fhasi ha vhulungana kana yo itiwa zwi si zwone. Kumbelo yavho ya u appela i tea u nedziwa hu tshi ṅwalwa kha HR.","Uyu muitero wa mulandu u khou fhiraho phanḓa - arali maitele a tshi tou fana a tshi itea nga tshifhinga tsha u shuma ha iyi tivhiso, zwi nga vha zwa khwinisa kha magato mafhelo a mulandu, u swika kha u thithiswa nga nṱha ha maitele mabe khulwane.","Mafhungo othe o do bulukanywa sa swihlayiselo nahone o do abelaniwa fhedzi na vhaṱhohi vhane vha tea nahone na vhashumi vha HR."],witnessOption:()=>"U saena havho kha iyi bugu zwi amba uri iyi tivhiso yo talutshedzelwa kwavho nahone no pfesesa zwine zwo bulwa na pfanelo dzavho. U saena havho A ZWI AMBA uri no tendelana na tivhiso - zwi amba fhedzi uri no divhiswa nga ndila yo teaho. Arali no nanga u si saini, ndi pfanelo yavho. Kha zwenezwo, muhumbeli o do saini u tiyisedza uri iyi tivhiso yo talutshedzelwa kwavho mbele yavho nahone no divhisiwa pfanelo dzavho dzoṱhe. Tivhiso i khou sala i khou shuma hu sa nwali uri no i saena kana muhumbeli o i saena.",questions:()=>"Vho na mbudziso nga ha iyi tivhiso, tshifhinga tsha u shuma, mvelelo, kana pfanelo dzavho? Ndi khou toda u tiyisedza uri no pfesesa zwoṱhe nga u fhedzisesa phanḓa ha u fhiraho phanḓa nga masaena.",closing:()=>"Ndo livhuwa. Zwino ro do fhiraho phanḓa u kuvhanganya masaena u tiyisedza iyi tivhiso. Humbulani, iyi ndi tshifhinga tshavho tsha u khwinisa maitele avho. Ri khou lindela u vhona u khwinisa ha u tavhanya, nahone ri khou humbela uri zwi vhe tshiphelo tsha iyi nyimele."},ss:{greeting:(e,a)=>`${e}, njengobe sakhuluma, loluhlangano ngalokucinisekisa sixwayiso lesibhaliwe ngesehlo lemsebenzi lesehlekeleko.`,purpose:()=>"Sese sakhuluma ngalokucondze ngeloko kwentekako. Manje ngidvinga kuchaza ngelitsatfu lesilinganiso sesixwayiso, sikhatsi sekuphila, emalungelo akho, nemiphumela uma kutiphatsa lekufanako kuphindze kwenteke. Lenqubo ilandzela Umtsetfo weTinhlangano teTisebenzi kanye nephalisinkomba yekulajiswa yekhamphani yaletfu.",incident:e=>`Kuphindza loko sasakhuluma ngako ngaphambile: ${e}. Loku kutiphatsa akwemukelekile ngansi kwetingcikitelo tetfu tendzawo yemsebenzi kanye nephalisinkomba yekhamphani, futhi kumele kulungiswe masinyane.`,warningExplanation:(e,a)=>`Lesi yisixwayiso se-${e}. Sitawuhlala emarekhodini akho emsebenzi etinyanga letingu-${a} kusuka lamuhla. Ngelesikhatsi sekuphila, kulindelekile kutsi ubonise kuntfula lokushesha nekucondzaphambili kutiphatsa kwakho.`,rights:()=>"Manje, kubalulekile kakhulu kutsi uwatizwe emalungelo akho:",rightsList:()=>["Unelilungelo lekuphikisana nalesi sixwayiso ngetikhatsi tetinshintfu tange-48 uma ukholwa kutsi asifanele noma senziwa hambi. Sicelo sakho sekuphikisana kufanele sanikelwe ngekubhalwa ku-HR.","Lenqubo yekulajiswa iyacondzaphambili - uma kutiphatsa lekufanako kwenteka ngelesikhatsi sekuphila salesixwayiso, kungase kuholele kusinyatselo sesinye sekulajiswa, kuya ekuxoshwa ngenxa yekutiphatsa lekubi kakhulu.","Tonkhe lwati lutawugcinwa luyimfihlo futhi lutsatfwe kubaphati labadzingekako kuphela kanye netisebenzi te-HR."],witnessOption:()=>"Kusayina kwakho kule ncwadzi kusamukela kutsi lesixwayiso sichaziwe kuwe futhi uyatizwa lokutsiwe kanye nemalungelo akho. Kusayina kwakho AKUSHO kutsi uyavuma nesixwayiso - kusho nje kutsi watiswa ngendlela lefanele. Uma ukhetsa kungasayini, yilelo ilungelo lakho. Kuleso sigameko, umfakazi utawusayina kucincisekisa kutsi lesixwayiso sichaziwe kuwe ekubeni kwakho futhi watiswa ngemalungelo akho onkhe. Sixwayiso sihlala sisebenta noma usisayinile noma umfakazi uyasisayina.",questions:()=>"Ingabe unemibuto ngalesi sixwayiso, sikhatsi sekuphila, imiphumela, noma emalungelo akho? Ngifuna kucincisekisa kutsi uyakutizwa konke kachubeka ngaphambili nekusayina.",closing:()=>"Ngiyabonga. Manje sitawucondzaphambili kutfola kusayina kucincisekisa lesixwayiso. Khumbulanani, loku kuyindzawo yakho yekulungisa kutiphatsa kwakho. Silindele kubona kuntfula lokushesha, futhi sitfemba kutsi loku kutabe kugcina kwale ndzaba."},tn:{greeting:(e,a)=>`${e}, jaaka re buisane, kopano eno ke go tiisa temoso e e kwadilweng ka kgang ya tiro e e diragetseng.`,purpose:()=>"Re setse re buisane ka dintlha tsa se se diragetseng. Jaanong ke tshwanetse go tlhalosa ka semolao seelo sa temoso, nako ya go bereka, ditshwanelo tsa gago, le ditlamorago fa boitshwaro jo bo tshwanang bo ka diragala gape. Thulaganyo eno e latela Molao wa Dikamano tsa Badiri le pholisi ya kgalemelo ya khampani ya rona.",incident:e=>`Go boeletsa se re neng re buisana ka sone pele: ${e}. Boitshwaro jono ga bo amogelwe ka fa tlase ga ditekanyetso tsa rona tsa lefelo la tiro le dipholisi tsa khampani, mme bo tshwanetse go baakanyediwa ka bonako.`,warningExplanation:(e,a)=>`Eno ke temoso ya ${e}. E tla nna mo rekotong ya gago ya tiro dikgwedi tse ${a} go simolola gompieno. Ka nako eno ya go bereka, o solofetswe go bontsha tokafatso e e bonalang le e e tswelelang mo boitshwarong jwa gago.`,rights:()=>"Jaanong, go botlhokwa thata gore o tlhaloganye ditshwanelo tsa gago:",rightsList:()=>["O na le tshwanelo ya go boipiletsa temoso eno mo diureng tse 48 fa o dumela gore ga e siame kgotsa e dirwa ka phoso. Boipiletso jwa gago bo tshwanetse go neelwa ka go kwala go HR.","Thulaganyo eno ya kgalemelo e tswelela - fa boitshwaro jo bo tshwanang bo diragala ka nako ya go bereka ya temoso eno, go ka felela ka kgato e nngwe ya kgalemelo, go fitlha kwa go tlosiwa tiro ka ntlha ya boitshwaro jo bo maswe thata.","Tshedimosetso yotlhe e tla bolokwa e le sephiri mme e abelane fela le batsamaisi ba ba tlhokegang le badiri ba HR."],witnessOption:()=>"Go saena ga gago mo tokomaning eno go amogela gore temoso eno e tlhalosetse wena mme o tlhaloganya se se mo go yone le ditshwanelo tsa gago. Go saena ga gago GA GO REYE gore o dumalana le temoso - go raya fela gore o itsisitswe ka tsela e e siameng. Fa o tlhopha go sa saena, ke tshwanelo ya gago. Mo maemong a, paki e tla saena go netefatsa gore temoso eno e tlhalosetse wena mo go bonweng ga gago le gore o itsisitswe ka ditshwanelo tsa gago tsotlhe. Temoso e nna e bereka go sa kgathalesege gore o e saenile kgotsa paki e e saenile.",questions:()=>"A o na le dipotso ka temoso eno, nako ya go bereka, ditlamorago, kgotsa ditshwanelo tsa gago? Ke batla go netefatsa gore o tlhaloganya tsotlhe pele re tswelela ka go saena.",closing:()=>"Ke a leboga. Jaanong re tla tswelela go kokoanya mesaeno go tiisa temoso eno. Gopola, seno ke sebaka sa gago sa go baakanya boitshwaro jwa gago. Re lebeletse go bona tokafatso e e bonalang, mme re tshepa gore seno se tla nna bokhutlo jwa kgang eno."},nr:{greeting:(e,a)=>`${e}, njengalokuthi sakhulumako, leli hlangano ngolokuqinisekisa isixwayiso esibhaliwe ngodaba lomsebenzi olwenzekako.`,purpose:()=>"Sesivele saxoxa ngemininingwane yalokho okwenzekako. Manje ngidinga ukuchaza ngomthetho izinga lesixwayiso, isikhathi sokusebenza, amalungelo akho, nemiphumela uma ukuziphatha okufanako kuphinde kwenzeke. Le nqubo ilandela uMthetho weBudlelwano Basebenzi kanye nenqubomgomo yokuqeqesha yenkampani yethu.",incident:e=>`Ukuphinda lokho esikuxoxe kuqala: ${e}. Lokhu kuziphatha akwamukelekile ngaphansi kwezindinganiso zethu zendawo yomsebenzi nezinqubomgomo zenkampani, futhi kumele kulungiswe masinyane.`,warningExplanation:(e,a)=>`Lesi yisixwayiso se-${e}. Sizosala emarekhodi akho omsebenzi izinyanga ezingu-${a} kusukela namuhla. Ngalesi sikhathi sokusebenza, kulindelwe ukuthi ukhombise ukuthuthuka okusheshayo nokuqhubekayo ekuziphatheni kwakho.`,rights:()=>"Manje, kubaluleke kakhulu ukuthi uqonde amalungelo akho:",rightsList:()=>["Unelungelo lokubhena lesi sixwayiso phakathi namahora angama-48 uma ukholelwa ukuthi asilungile noma asenziwa ngendlela engalungile. Isicelo sakho sokubhena kufanele sinikezwe ngokubhaliwe ku-HR.","Le nqubo yokuqeqesha iyaqhubeka - uma ukuziphatha okufanayo kwenzeka phakathi nesikhathi sokusebenza salesi sixwayiso, kungase kuholele esinyweni esinye sokuqeqesha, kuya ekuxoshweni ngenxa yokuziphatha okubi kakhulu.","Lonke ulwazi luzogcinwa luyimfihlo futhi lubelane kuphela nabapha boholi abadingekayo nabadlulisi be-HR."],witnessOption:()=>"Ukusayina kwakho kule dokhumenti kuyavuma ukuthi lesi sixwayiso sikuchazelwe futhi uyaqonda okuqukethwe namalungelo akho. Ukusayina kwakho AKUSHO ukuthi uyavuma nesixwayiso - kusho nje ukuthi wazisiwe ngendlela efanele. Uma ukhetha ukungasayini, lelo ilungelo lakho. Kuleso sigameko, umfakazi uzosayina ukuqinisekisa ukuthi lesi sixwayiso sikuchazelwe ebukheneni bakho nokuthi wazisiwa ngawo onke amalungelo akho. Isixwayiso sihlala sisebenza noma uyasisayina noma umfakazi uyasisayina.",questions:()=>"Ingabe unemibuzo ngalesi sixwayiso, isikhathi sokusebenza, imiphumela, noma amalungelo akho? Ngifuna ukuqinisekisa ukuthi uqonda konke ngokuphelele ngaphambi kokuqhubeka nezimo zokusayina.",closing:()=>"Ngiyabonga. Manje sizokwanda siqhubeke nokuqoqa izimo zokusayina ukuqinisekisa lesi sixwayiso. Khumbula, lokhu kuyithuba lokuthi ulungise ukuziphatha kwakho. Silindele ukubona ukuthuthuka okusheshayo, futhi sithemba ukuthi lokhu kuzoba ukuphela kwalolu daba."},ns:{greeting:(e,a)=>`${e}, bjalo ka ge re boledišanego, kopano ye ke go tiišetša temošo ye e ngwadilwego mabapi le tiragalo ya mošomo yeo e diregile go.`,purpose:()=>"Re šetše re boledišane ka dintlha tša se se diregile go. Bjale ke swanetše go hlaloša ka molao maemo a temošo, nako ya go šoma, ditokelo tša gago, le ditlamorago ge boitshwaro bjo bjo swanago bo ka direga gape. Tshepedišo ye e latela Molao wa Dikamano tša Bašomi le pholisi ya kgalemo ya khamphani ya rena.",incident:e=>`Go boeletša seo re boledišanego ka sona pele: ${e}. Boitshwaro bjo ga bjo amogelwe ka fase ga ditekanyetšo tša rena tša lefelo la mošomo le dipholisi tša khamphani, gomme bo swanetše go baakanywa ka pela.`,warningExplanation:(e,a)=>`Ye ke temošo ya ${e}. E tla dula go direkoto tša gago tša mošomo dikgwedi tše ${a} go thoma lehono. Ka nako ye ya go šoma, go lebelletšwe gore o bontšhe kaonafatšo ye e bonalago le yeo e tšwelelago boitshwarong bja gago.`,rights:()=>"Bjale, go bohlokwa kudu gore o kwešiše ditokelo tša gago:",rightsList:()=>["O na le tokelo ya go boipiletša temošo ye ka gare ga diiri tše 48 ge o dumela gore ga e nepagetšego goba e dirwa ka phošo. Boipiletšo bja gago bo swanetše go fiwa ka go ngwala go HR.","Tshepedišo ye ya kgalemo e tšwela pele - ge boitshwaro bjo bjo swanago bo direga ka nako ya go šoma ya temošo ye, go ka fela ka kgato ye nngwe ya kgalemo, go fihla go tlošweng mošomo ka lebaka la boitshwaro bjo bobe kudu.","Tshedimošo ka moka e tlago bolokwa e le sephiri gomme e abelanwa feela le balaodi ba bohlokwa le bašomi ba HR."],witnessOption:()=>"Go saena ga gago tokong ye go amogela gore temošo ye e hlalošitšwe go wena gomme o kwešiša seo se lego go yona le ditokelo tša gago. Go saena ga gago GA GO REYE gore o dumelelana le temošo - go bolela fela gore o tsebišitšwe ka tsela ye e nepagetšego. Ge o kgetha go se saene, ke tokelo ya gago. Maemong ao, paki e tlago saena go netefatša gore temošo ye e hlalošitšwe go wena pele ga gago le gore o tsebišitšwe ka ditokelo tša gago ka moka. Temošo e dula e šoma ntle le go ela hloko gore o e saenile goba paki e e saenile.",questions:()=>"Na o na le dipotšišo ka temošo ye, nako ya go šoma, ditlamorago, goba ditokelo tša gago? Ke nyaka go netefatša gore o kwešiša tše ka moka pele re tšwelapele ka mesaeno.",closing:()=>"Ke leboga. Bjale re tlago tšwelapele go kgoboketša mesaeno go tiišetša temošo ye. Gopola, se ke sebaka sa gago sa go baakanya boitshwaro bja gago. Re lebelletše go bona kaonafatšo ye e bonalago, gomme re holofela gore se se tlabe bokhutlo bja taba ye."}},He=({employeeName:e,managerName:s,incidentDescription:t,warningLevel:i,validityPeriod:o,onScriptRead:r,disabled:n=!1})=>{const[l,c]=C.useState("en"),[d,m]=C.useState(!1),[u,h]=C.useState(!1),g=Oe[l]||Oe.en,x=We.find(e=>e.code===l)||We[0],p=((e,a)=>{const s=e.toLowerCase().replace(/ /g,"_");return Ue[a][s]||e})(i,l);return a.jsx("div",{className:"space-y-2",children:a.jsx("div",{className:"border rounded-lg p-3",style:{background:"linear-gradient(to right, var(--color-alert-warning-bg), var(--color-alert-warning-bg))",borderColor:"var(--color-alert-warning-border)"},children:d?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between pb-3 border-b",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ne,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"📖 Employee Warning Script"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(le,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:l,onChange:e=>c(e.target.value),disabled:u||n,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:We.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:a.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Opening & Introduction"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.greeting(e,s)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Meeting Purpose"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.purpose()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Incident Details"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.incident(t)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Warning Details"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.warningExplanation(p,o)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"5. Your Rights"}),a.jsx("p",{className:"text-xs leading-relaxed mb-2",style:{color:"var(--color-text-secondary)"},children:g.rights()}),a.jsx("ul",{className:"space-y-1 text-xs",style:{color:"var(--color-text-secondary)"},children:g.rightsList().map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx(oe,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--color-success)"}}),e]},s))})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-secondary)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"6. Witness & Signature Rights"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.witnessOption()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"7. Questions & Clarifications"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.questions()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-text-tertiary)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"8. Closing"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:g.closing()})]})]})}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(ce,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsxs("span",{children:["Read this complete script aloud to ",e]})]}),u?a.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[a.jsx(oe,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):a.jsxs("button",{onClick:()=>{h(!0),r()},disabled:n,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:[a.jsx(oe,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]}),a.jsx("div",{className:"border rounded-lg p-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(J,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-info)"}}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-info-text)"},children:[a.jsx("p",{className:"font-medium mb-0.5",children:"Legal Compliance Notice"}),a.jsx("p",{children:"This script ensures compliance with the Labour Relations Act (LRA) requirements for procedural fairness in disciplinary proceedings. All employee rights have been comprehensively covered in their preferred language."})]})]})})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ne,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Employee Warning Script"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Complete script covering all employee rights"})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(le,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:l,onChange:e=>c(e.target.value),disabled:u||n,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:We.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-1 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-warning-text)"},children:["Script available in ",a.jsx("strong",{children:x.nativeName})," • Ready to read aloud"]}),a.jsxs("button",{onClick:()=>m(!0),disabled:n,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-medium",style:{backgroundColor:"var(--color-warning)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-warning)",e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-warning)",e.currentTarget.style.opacity="1"},children:[a.jsx(J,{className:"w-3 h-3"}),"View Full Script"]})]})]})})})},Be=(e,a="Unknown")=>null==e?a:"string"==typeof e?e:"object"==typeof e&&e.name?String(e.name):String(e),Ve=({lraRecommendation:e,selectedEmployee:s,formData:r,currentManagerName:n,onSignaturesComplete:l,isAnalyzing:d=!1,signaturesFinalized:m=!1,currentSignatures:u,warningId:h,audioUploadStatus:g,onLevelOverride:x})=>{const[p,y]=C.useState(!1),[v,f]=C.useState(!1),[b,w]=C.useState(!1),[k,N]=C.useState(!1),[j,S]=C.useState(u||{manager:null,employee:null}),[_,D]=C.useState(null),[I,E]=C.useState(!1),[z,R]=C.useState("employee");C.useEffect(()=>{u&&S(u)},[u]),C.useEffect(()=>{v&&N(!0)},[v]),C.useEffect(()=>{x&&x(_)},[_,x]),C.useEffect(()=>{m&&setTimeout(()=>{const e=document.querySelector(".warning-success-alert");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},300)},[m]);const T=!(!j.manager||!j.employee);C.useCallback(()=>{w(!0),setTimeout(()=>{f(!0),w(!1)},1500)},[]);const L=C.useCallback(e=>{S(a=>({...a,manager:e}))},[]),A=C.useCallback(e=>new Promise((a,s)=>{const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(!i)return void s(new Error("Failed to get canvas context"));i.drawImage(t,0,0),i.save(),i.translate(e.width/2,e.height/2),i.rotate(-Math.PI/6);const o=Math.max(48,e.width/8);i.font=`bold ${o}px Arial`,i.textAlign="center",i.textBaseline="middle",i.strokeStyle="rgba(220, 38, 38, 0.8)",i.lineWidth=o/16,i.strokeText("WITNESS",0,0),i.fillStyle="rgba(220, 38, 38, 0.55)",i.fillText("WITNESS",0,0),i.restore(),a(e.toDataURL("image/png"))},t.onerror=()=>s(new Error("Failed to load signature image")),t.src=e}),[]),M=C.useCallback(async e=>{if(e&&"witness"===z)try{const a=await A(e);S(e=>({...e,employee:a}))}catch(a){console.error("Failed to apply witness watermark:",a),S(a=>({...a,employee:e}))}else S(a=>({...a,employee:e}))},[z,A]),q=C.useCallback(()=>{if(!T||m)return;const e={...j,timestamp:(new Date).toISOString(),managerName:n,employeeName:s?`${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`:"Unknown Employee"};l(e,!0)},[j,T,m,n,s,l]);return d?a.jsxs(i,{padding:"xl",className:"text-center",children:[a.jsx(de,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"var(--color-primary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Analyzing legal requirements..."})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(J,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),a.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"📋 Review & Prepare for Warning Meeting"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(B,{className:"w-3 h-3"}),a.jsx("span",{children:"Takes 5-10 minutes to review"})]})]}),a.jsxs(i,{padding:"md",className:"border",style:{borderColor:"var(--color-primary-light)",backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsx("h3",{className:"text-sm font-bold mb-3",style:{color:"var(--color-text)"},children:"What You'll Do Next:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:"1️⃣"}),a.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[a.jsx("strong",{children:"Review the system recommendation"})," below (legal analysis)"]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:"2️⃣"}),a.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[a.jsx("strong",{children:"Read the employee warning script"})," thoroughly"]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:"3️⃣"}),a.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[a.jsx("strong",{children:"Collect both signatures"})," (yours and employee's)"]})]})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs(t,{variant:"warning",size:"lg",className:"font-semibold",children:["⚠️ ",Be(e?.recommendedLevel)," • ",e?.isEscalation?"Escalated":"First Offense"]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(K,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"🎯 System Recommendation"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e?.isEscalation?"Escalation recommended based on history":"Start with "+Be(e?.recommendedLevel).toLowerCase()})]})]}),a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>y(!p),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[p?"Hide":"Details",p?a.jsx(H,{className:"w-3 h-3"}):a.jsx(U,{className:"w-3 h-3"})]})]}),a.jsxs(i,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>E(!I),className:"transition-all hover:opacity-80 active:scale-95",disabled:m,children:a.jsx(t,{variant:"primary",size:"sm",className:"font-semibold cursor-pointer",children:_?"counselling"===_?"Counselling Session":"verbal"===_?"Verbal Warning":"first_written"===_?"First Written Warning":"final_written"===_?"Final Written Warning":_:Be(e?.recommendedLevel)})}),e?.isEscalation&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Y,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-warning)"},children:"Escalation"})]}),a.jsxs("button",{onClick:()=>E(!I),className:"flex items-center gap-1 text-xs hover:opacity-80 active:scale-95 transition-all",style:{color:"var(--color-text-secondary)"},disabled:m,children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-primary)"},children:e?.categoryWarningCount??0}),a.jsx("span",{children:"in category"})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-success)"},children:"Analyzed"})]})]}),a.jsx("div",{className:"mt-2 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:e?.isEscalation?`This employee has ${e.categoryWarningCount??0} previous warning(s) in this category. We're escalating to ${Be(e.recommendedLevel).toLowerCase()} to follow proper progressive discipline procedures.`:`Since this is a first offense in this category, we recommend starting with ${Be(e.recommendedLevel).toLowerCase()} rather than a formal written warning. This follows best practice progressive discipline.`})})]})]}),p&&a.jsx(i,{padding:"sm",className:"border",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(V,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Analysis Summary"})]}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:Be(e?.explanation||e?.reason,"Progressive discipline assessment completed based on employee warning history and incident severity.")})]}),e?.legalRequirements&&e.legalRequirements.length>0&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(K,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Legal Compliance"})]}),a.jsxs("div",{className:"space-y-1",children:[e.legalRequirements.slice(0,2).map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5",style:{backgroundColor:"var(--color-info)"}}),a.jsx("span",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:e})]},s)),e.legalRequirements.length>2&&a.jsxs("p",{className:"text-xs ml-3.5",style:{color:"var(--color-info)"},children:["+ ",e.legalRequirements.length-2," more requirements"]})]})]}),a.jsxs("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-card-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(B,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-text)"},children:"Warning History (This Category)"})]}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Employee has ",a.jsx("strong",{children:e?.categoryWarningCount??0})," active warning(s) in this category.",e?.activeWarnings&&e.activeWarnings.length>0&&a.jsxs("span",{className:"ml-1",children:["Most recent warning was issued ",a.jsx("strong",{children:"0 days ago"}),"."]})]})]})]})}),I&&a.jsx(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-warning-light)",backgroundColor:"var(--color-alert-warning-bg)"},children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[a.jsx(me,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-bold text-sm mb-1",style:{color:"var(--color-text)"},children:"⚖️ Override Recommendation"}),a.jsxs("p",{className:"text-xs leading-relaxed mb-3",style:{color:"var(--color-text-secondary)"},children:["The system recommends ",a.jsx("strong",{style:{color:"var(--color-text)"},children:Be(e?.recommendedLevel)}),". You may override this to escalate faster or re-issue the same level if circumstances warrant it."]})]})]}),a.jsx("button",{onClick:()=>E(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",disabled:m,children:a.jsx(O,{className:"w-4 h-4"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Warning Level:"}),a.jsxs("select",{value:_||e?.suggestedLevel||"",onChange:a=>{const s=a.target.value===(e?.suggestedLevel||"")?null:a.target.value;D(s)},className:"w-full px-3 py-2 text-sm rounded-lg border-2 transition-colors",style:{borderColor:_?"var(--color-warning)":"var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)"},disabled:m,children:[a.jsx("option",{value:"",children:"-- Use System Recommendation --"}),e?.escalationPath?.map(s=>a.jsxs("option",{value:s,children:[{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",final_written:"Final Written Warning"}[s]||s,s===e.suggestedLevel?" (Recommended)":""]},s))]})]}),_&&a.jsxs(c,{variant:"warning",className:"text-xs",children:[a.jsx("strong",{children:"Override Active:"})," This warning will be issued as ",a.jsx("strong",{children:"counselling"===_?"Counselling Session":"verbal"===_?"Verbal Warning":"first_written"===_?"First Written Warning":"final_written"===_?"Final Written Warning":_})," instead of the recommended level. Future warnings will consider this custom escalation path."]})]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(J,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"📖 Employee Warning Script"})]}),a.jsxs(i,{padding:"sm",className:"border",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Read this script before your meeting."})," It ensures you cover all legal requirements and communicate clearly with the employee."]}),a.jsx(He,{employeeName:s?`${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`:"Unknown Employee",managerName:n,incidentDescription:r.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:_||e?.recommendedLevel||"verbal",validityPeriod:r.validityPeriod,onScriptRead:()=>f(!0),disabled:v})]})]}),g&&"complete"!==g&&a.jsxs("div",{className:"mb-3 p-3 rounded-lg border flex items-center gap-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:[a.jsx(de,{className:"w-5 h-5 animate-spin",style:{color:"var(--color-info)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["stopping"===g&&"🎤 Stopping recording...","uploading"===g&&"☁️ Uploading audio to Firebase..."]}),a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-tertiary)"},children:"Please wait while we save your warning"})]})]}),k&&a.jsx(c,{variant:"info",className:"border-l-4",style:{borderLeftColor:"var(--color-info)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(me,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"var(--color-info)"}}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-sm mb-2",style:{color:"var(--color-text)"},children:"ℹ️ What Happens After Signatures?"}),a.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--color-text-secondary)"},children:[a.jsx("p",{children:"• ✅ Warning is officially recorded in the system"}),a.jsx("p",{children:"• 📧 Employee receives their copy (email/WhatsApp/print)"}),a.jsx("p",{children:"• 🔔 HR is notified automatically"})]})]})]})}),k&&a.jsxs(i,{padding:"sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ce,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"✍️ Collect Signatures"})]}),a.jsx("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:a.jsx("span",{children:T?"Complete":"Pending"})})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(W,{className:"w-3.5 h-3.5",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Manager"}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:n})]}),j.manager&&a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),a.jsx(Pe,{onSignatureComplete:L,disabled:m,label:"Manager Signature",placeholder:"Manager signature",initialSignature:j.manager,width:300,height:80})]}),a.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-success-bg)",opacity:j.manager?1:.6},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(W,{className:"w-3.5 h-3.5",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"employee"===z?"Employee":"Witness"}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:s?`${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`:"Unknown Employee"})]}),j.employee&&a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),!j.manager&&!m&&a.jsx("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-warning)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(X,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-alert-warning-text)"},children:"Manager must save their signature first"})]})}),!m&&j.manager&&a.jsxs("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border-light)"},children:[a.jsx("div",{className:"text-xs font-medium mb-2",style:{color:"var(--color-text)"},children:"Signature Type:"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"signatureType",value:"employee",checked:"employee"===z,onChange:e=>R(e.target.value),className:"w-4 h-4",style:{accentColor:"var(--color-success)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text)"},children:"Employee Signature"})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"signatureType",value:"witness",checked:"witness"===z,onChange:e=>R(e.target.value),className:"w-4 h-4",style:{accentColor:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text)"},children:"Witness Signature"})]})]}),a.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"employee"===z?"Employee signs to acknowledge notification":"Witness confirms this warning was explained to the employee"})]}),a.jsx(Pe,{onSignatureComplete:M,disabled:m||!j.manager,label:"employee"===z?"Employee Signature":"Witness Signature",placeholder:"employee"===z?"Employee signature":"Witness signature",initialSignature:j.employee,width:300,height:80})]})]}),T&&!m&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"hidden md:block mt-3 p-2 rounded-lg flex items-center justify-between",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Ready to finalize"})]}),a.jsxs(o,{onClick:q,size:"sm",className:"px-3 py-1.5",children:[a.jsx(ue,{className:"w-3 h-3 mr-1"}),"Finalize & Save Warning"]})]}),a.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white border-t-2 shadow-lg z-50",style:{borderColor:"var(--color-success)"},children:a.jsxs(o,{onClick:q,className:"w-full h-12 text-base font-semibold",children:[a.jsx(ue,{className:"w-4 h-4 mr-2"}),"Finalize & Save Warning"]})})]}),m&&a.jsx("div",{className:"warning-success-alert mt-4",children:a.jsx(c,{variant:"success",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(Q,{className:"w-6 h-6",style:{color:"var(--color-success)"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-bold text-base mb-2",style:{color:"var(--color-text)"},children:"✅ Warning Officially Recorded"}),a.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--color-text-secondary)"},children:[a.jsx("p",{children:"• Signatures captured and saved"}),a.jsx("p",{children:"• Audio recording uploaded to Firebase"}),h&&a.jsxs("p",{children:["• Warning ",a.jsxs("span",{className:"font-mono font-semibold",children:["#",h.slice(-8)]})," created in database"]}),a.jsx("p",{className:"text-xs mt-3 pt-2 border-t",style:{borderColor:"var(--color-border)",color:"var(--color-text-tertiary)"},children:'🎯 Click "Next" to set up delivery for HR team'})]})]})]})})})]})]})};class Ge{static async createDeliveryNotification(a){try{const s=this.determinePriority(a.warningLevel),t=this.prepareContactDetails(a),i={organizationId:a.organizationId,warningId:a.warningId,employeeId:a.employeeId,employeeName:a.employeeName,employeeEmail:a.employeeEmail,employeePhone:a.employeePhone,warningLevel:a.warningLevel,warningCategory:a.warningCategory,incidentDate:a.incidentDate,deliveryMethod:a.deliveryMethod,deliveryPreference:a.isEmployeePreference?"employee_choice":"manager_choice",contactDetails:t,status:"pending",priority:s,deliveryAttempts:0,createdAt:I(),updatedAt:I(),createdBy:a.createdBy,createdByName:a.createdByName},o=await E(z(d,"organizations",a.organizationId,"deliveryNotifications"),i);return e.success(3842),await this.createSystemNotification(a,o.id),o.id}catch(s){throw e.error("❌ Failed to create delivery notification:",s),s}}static async updateDeliveryStatus(a,s,t,i){try{const e={status:s,updatedAt:I()};"delivered"===s&&(e.deliveryDate=I(),e.deliveredBy=i),t&&(e.deliveryNotes=t)}catch(o){throw e.error("❌ Failed to update delivery status:",o),o}}static determinePriority(e){switch(e.toLowerCase()){case"dismissal":case"suspension":return"urgent";case"final_written":case"final written warning":return"high";default:return"normal"}}static prepareContactDetails(e){const a={};switch(e.deliveryMethod){case"email":e.employeeEmail&&(a.email=e.employeeEmail);break;case"whatsapp":e.employeePhone&&(a.phone=e.employeePhone);break;case"printed":a.address="To be confirmed by HR"}return a}static async createSystemNotification(a,s){try{const{QuickNotifications:e}=await Re(async()=>{const{QuickNotifications:e}=await import("./NotificationDeliveryService-EtTDFHY7.js");return{QuickNotifications:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.warningNeedsDelivery(a.organizationId,a.employeeName,a.warningLevel,this.getDeliveryMethodName(a.deliveryMethod))}catch(t){e.error("❌ Failed to create system notification:",t)}}static generateNotificationMessage(e){const a=this.getDeliveryMethodName(e.deliveryMethod),s=e.isEmployeePreference?" (employee's preferred method)":" (selected by manager)";return`Warning issued to ${e.employeeName} requires delivery via ${a}${s}. Warning level: ${e.warningLevel}.`}static getDeliveryMethodName(e){switch(e){case"email":return"Email";case"whatsapp":return"WhatsApp";case"printed":return"Print & Hand Delivery";default:return e}}}class Ke{static getDeliveryInstructions(e){switch(e){case"email":return{title:"Email Delivery Instructions",steps:["Download the warning PDF from the system","Compose professional email with warning attached","Send to employee's work email address","Request read receipt if supported","Follow up if no acknowledgment within 2 business days"],requirements:["Valid email address on file","PDF warning document","Professional email template"],documentation:["Screenshot of sent email","Read receipt (if available)","Employee acknowledgment response"]};case"whatsapp":return{title:"WhatsApp Business Delivery Instructions",steps:["Verify employee's WhatsApp Business number","Send professional message introducing the warning","Share warning PDF as document attachment","Request confirmation of receipt","Document the conversation for records"],requirements:["WhatsApp Business account","Employee's valid phone number","Professional communication standards"],documentation:["Screenshot of conversation","Delivery receipt confirmation","Employee read/response confirmation"]};case"printed":return{title:"Print & Hand Delivery Instructions",steps:["Print warning document on company letterhead","Prepare delivery receipt form","Locate employee at their workstation/department","Hand deliver in presence of witness (if possible)","Obtain signed receipt of delivery","Scan and upload proof of delivery"],requirements:["Printed warning document","Delivery receipt form","Employee location/schedule","Witness (recommended)"],documentation:["Signed delivery receipt","Photo of handed document (if permitted)","Witness statement (if applicable)","Date, time, and location of delivery"]};default:return{title:"General Delivery Instructions",steps:["Contact IT support for delivery method guidance"],requirements:["Valid employee contact information"],documentation:["Proof of delivery attempt"]}}}}const Ye=e=>{if(!e)return"Counselling Session";return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"}[e]||e},Xe=({selectedEmployee:s,selectedCategory:r,formData:n,lraRecommendation:l,signatures:d,organizationName:h,currentManagerName:g,audioRecording:x,onComplete:p,onWarningCreated:y,warningId:v,onFinalizeReady:f})=>{const{user:b}=m(),{organization:w}=u();C.useEffect(()=>{s&&(s.profile,s.profile)},[s,r,n]);const[k,N]=C.useState("email"),[j,S]=C.useState(!1),[_,D]=C.useState(!1),[I,E]=C.useState(!1),[z,R]=C.useState(null),[T,L]=C.useState(!1),[A,M]=C.useState(null),[q,$]=C.useState(!1),[F,P]=C.useState(null),[U,O]=C.useState(!1),H=[{id:"email",name:"Email Delivery",icon:he,description:"HR will deliver via email with read receipt tracking",available:!!s?.email},{id:"whatsapp",name:"WhatsApp Business",icon:ge,description:"HR will deliver via WhatsApp Business with confirmation",available:!!s?.phone},{id:"printed",name:"Print & Hand Deliver",icon:xe,description:"HR will print and hand deliver with signed receipt",available:!0}],B=C.useCallback(async()=>{try{S(!0)}catch(a){e.error("❌ Error opening PDF preview:",a),R("Failed to generate PDF preview")}},[]),V=C.useCallback(async(a,t)=>{if(s&&w&&b&&v)try{D(!0),R(null);try{$(!0);const a=await Ge.createDeliveryNotification({warningId:v,organizationId:w.id,employeeId:s.id,employeeName:`${s.profile?.firstName||s.firstName||"Unknown"} ${s.profile?.lastName||s.lastName||"Employee"}`,employeeEmail:s.profile?.email||s.email||"",employeePhone:s.profile?.phoneNumber||s.phone||"",warningLevel:l?.suggestedLevel||n.level||"counselling",warningCategory:l?.category||n.category||"General",incidentDate:n.incidentDate,deliveryMethod:k,isEmployeePreference:s?.deliveryPreference===k,createdBy:b.id,createdByName:g});P(a),e.success(9578),L(!0)}catch(i){e.error("❌ Failed to create delivery notification:",i),R(i.message||"Failed to notify HR about delivery")}finally{$(!1)}e.success(10016)}catch(o){e.error("❌ Error creating HR notification:",o),R(o.message||"Failed to create HR notification")}finally{D(!1)}else R("Missing required data for HR notification")},[s,w,b,v,k,l,n,g]),G=C.useCallback(async()=>V(),[V]),K=C.useMemo(()=>!(!v||!k||_||F),[v,k,_,F]);return H.find(e=>e.id===k),C.useEffect(()=>{f?.({canFinalize:K,finalizeHandler:G})},[K,G,f]),C.useEffect(()=>{if(T&&F){const e=setTimeout(()=>{p()},2e3);return()=>clearTimeout(e)}},[T,F,p]),T?a.jsx(i,{padding:"xl",className:"max-w-2xl mx-auto text-center",children:a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(Q,{className:"w-8 h-8 sm:w-10 sm:h-10",style:{color:"var(--color-success)"}})}),a.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",style:{color:"var(--color-text)"},children:"Warning Issued Successfully!"}),a.jsxs("p",{style:{color:"var(--color-text-secondary)"},children:["Warning ",A?`#${A.slice(-8)}`:""," has been created."]}),a.jsxs("p",{className:"font-medium mt-2",style:{color:"var(--color-primary)"},children:["📬 HR has been notified to deliver via ",k]}),x?.audioUrl&&!z&&a.jsx(c,{variant:"success",className:"mt-4 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(pe,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Audio recording saved successfully"})]})}),F&&a.jsxs(c,{variant:"info",className:"mt-4 text-center",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ue,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"HR Team Notified"})]}),a.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:["Delivery notification #",F.slice(-8)," created for HR team"]})]}),a.jsx("div",{className:"mt-6",children:a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>O(!U),className:"text-sm font-medium underline min-h-[40px]",children:[U?"Hide":"View"," Delivery Instructions for HR"]})}),U&&a.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[a.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text)"},children:Ke.getDeliveryInstructions(k).title}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Steps to Follow:"}),a.jsx("ol",{className:"text-sm list-decimal list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Ke.getDeliveryInstructions(k).steps.map((e,s)=>a.jsx("li",{children:e},s))})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Requirements:"}),a.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Ke.getDeliveryInstructions(k).requirements.map((e,s)=>a.jsx("li",{children:e},s))})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Documentation Needed:"}),a.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Ke.getDeliveryInstructions(k).documentation.map((e,s)=>a.jsx("li",{children:e},s))})]})]})]}),z&&a.jsxs("div",{className:"mt-4 p-3 rounded-lg border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",style:{color:"var(--color-alert-warning-text)"},children:[a.jsx(X,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Warning created, but audio upload had issues"})]}),a.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-alert-warning-text)"},children:z})]})]})}):a.jsxs("div",{className:"space-y-3",children:[a.jsx(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-success)"},children:a.jsx(Q,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"Warning Successfully Recorded"}),a.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Warning #",v?.slice(-8)," • Signatures captured • Audio uploaded"]})]})]})}),a.jsx(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"Ready to Hand Off to HR"}),a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Choose delivery method and notify your HR team"})]})]})}),a.jsx(i,{padding:"sm",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(W,{className:"w-4 h-4",style:{color:"var(--color-text-secondary)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee"}),a.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[s?.profile?.firstName," ",s?.profile?.lastName]})]})]}),a.jsx(t,{variant:"success",size:"sm",className:"font-semibold",children:Ye(n.level)||"Counselling Session"})]})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",style:{color:"var(--color-text)"},children:[a.jsx(ue,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),"How should HR deliver this warning?"]}),a.jsx("div",{className:"grid grid-cols-1 gap-2",children:H.map(e=>{const s=e.icon;return a.jsx(i,{padding:"sm",hover:e.available,className:"cursor-pointer transition-all border-l-4 "+(e.available?"":"opacity-50 cursor-not-allowed"),style:{borderLeftColor:k===e.id?"var(--color-primary)":"transparent",backgroundColor:k===e.id?"var(--color-alert-info-bg)":"transparent"},onClick:()=>e.available&&N(e.id),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(s,{className:"w-4 h-4",style:{color:"var(--color-text)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),!e.available&&"whatsapp"===e.id&&a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-error)"},children:"No phone number available"})]})]}),k===e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-primary)"},children:"Selected"})]}),a.jsx("input",{type:"radio",name:"deliveryMethod",value:e.id,checked:k===e.id,onChange:()=>{},disabled:!e.available,className:"sr-only"})]})},e.id)})})]}),!F&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:B,className:"w-full py-3 px-4 rounded-lg border transition-all hover:shadow-sm",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)"},children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ye,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Preview Document (Optional)"})]})}),a.jsx("div",{className:"text-xs text-center px-4",style:{color:"var(--color-text-secondary)"},children:"Your HR team will handle delivery and proof of receipt"})]}),z&&a.jsx(c,{variant:"error",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[a.jsx(X,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",children:"Error"}),a.jsx("p",{className:"text-xs mt-1",children:z})]})]}),a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>{R(null),G()},className:"flex items-center gap-1",children:[a.jsx(re,{className:"w-3 h-3"}),"Retry"]})]})}),I&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Uploading audio..."})]})}),q&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Notifying HR..."})]})}),j&&a.jsx(ze,{isOpen:j,onClose:()=>S(!1),warningData:{selectedEmployee:s,selectedCategory:r,formData:n,lraRecommendation:l,signatures:d,deliveryChoice:{method:k,timestamp:new Date,chosenBy:g},organizationName:h,currentManagerName:g,employee:s,organization:w},onPDFGenerated:(e,a)=>{},isCompleted:!1})]})},Je=({size:e="medium",color:s="#3b82f6"})=>{const t={small:"1.5rem",medium:"3rem",large:"5rem"};return a.jsx("div",{style:{width:t[e],height:t[e],border:"4px solid #e2e8f0",borderTop:`4px solid ${s}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})};if("undefined"!=typeof document){const e=document.createElement("style");e.innerHTML="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n\n  @keyframes shimmer {\n    0% { background-position: -1000px 0; }\n    100% { background-position: 1000px 0; }\n  }\n\n  .skeleton-card {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .skeleton-line {\n    height: 1rem;\n    margin-bottom: 0.5rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n  }\n\n  .skeleton-header {\n    height: 1.5rem;\n    margin-bottom: 1rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n    width: 40%;\n  }\n\n  .skeleton-circle {\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 50%;\n  }\n\n  .skeleton-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n",document.head.appendChild(e)}const Ze={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},Qe=({onPermissionGranted:s,onPermissionDenied:t,organizationName:i,managerName:o})=>{const[r,n]=C.useState("requesting"),[l,c]=C.useState("");C.useRef(Math.random().toString(36).substr(2,9)),C.useEffect(()=>(Ze.callbacks.push(s),Ze.errorCallbacks.push(t),Ze.isGranted?(n("granted"),void setTimeout(s,100)):(Ze.isRequesting||(Ze.isRequesting=!0,d()),()=>{const e=Ze.callbacks.indexOf(s);e>-1&&Ze.callbacks.splice(e,1);const a=Ze.errorCallbacks.indexOf(t);a>-1&&Ze.errorCallbacks.splice(a,1)})),[]);const d=async()=>{try{if(n("requesting"),c(""),!navigator.mediaDevices?.getUserMedia)return n("not-supported"),void c("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(e=>e.stop()),n("granted"),Ze.isGranted||(Ze.isGranted=!0,Ze.isRequesting=!1,Ze.callbacks.forEach(e=>{setTimeout(e,1e3)}))}catch(a){e.error("Microphone permission error:",a),Ze.isRequesting=!1,"NotAllowedError"===a.name?(n("denied"),c("Microphone access was denied. Please allow microphone access and try again.")):"NotFoundError"===a.name?(n("error"),c("No microphone was found on your device.")):"NotReadableError"===a.name?(n("error"),c("Your microphone is being used by another application.")):(n("error"),c("An error occurred while accessing your microphone.")),Ze.errorCallbacks.forEach(e=>{e()})}},m=(()=>{switch(r){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:l};case"not-supported":return{title:"Browser Not Supported",message:l};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"max-w-sm w-full",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:(()=>{switch(r){case"requesting":return a.jsx(Je,{size:"medium",color:"#3b82f6"});case"granted":return a.jsx(Je,{size:"medium",color:"#16a34a"});case"denied":return a.jsx(ve,{className:"w-6 h-6 text-red-600"});case"error":return a.jsx(fe,{className:"w-6 h-6 text-red-600"});case"not-supported":return a.jsx(ve,{className:"w-6 h-6 text-gray-600"});default:return a.jsx(pe,{className:"w-6 h-6 text-gray-600"})}})()}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m.title}),a.jsx("p",{className:"text-sm text-gray-600",children:m.message})]}),("denied"===r||"error"===r)&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"}),a.jsx("div",{className:"text-xs text-gray-500",children:a.jsx("p",{children:'Look for the microphone icon in your browser\'s address bar and click "Allow"'})})]})]}),a.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:a.jsx("p",{children:i})})]})})},ea="audio/webm;codecs=opus",aa=16e3,sa=8e3,ta=1,ia=3e5,oa=819200,ra=24e4,na=!0,la=!0,ca=!0;class da{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return da.instance||(da.instance=new da),da.instance}canStart(){const e=Date.now();return!this.isRecording&&!this.isStarting&&(!(this.startedAt>0&&e-this.startedAt<1e3)&&(!(this.allActiveStreams.size>0||this.allActiveTracks.size>0)||(this.allActiveStreams.size,this.allActiveTracks.size,!1)))}tryReserve(){return!!this.canStart()&&(this.isStarting=!0,this.startedAt=Date.now(),!0)}startRecording(){this.isRecording=!0}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{try{e.stop()}catch(a){}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null)}setStream(e){return this.mediaStream||this.allActiveStreams.size>0?(this.allActiveStreams.size,e.getTracks().forEach(e=>e.stop()),!1):(this.allActiveStreams.add(e),e.getTracks().forEach(e=>{this.allActiveTracks.add(e),e.addEventListener("ended",()=>{this.allActiveTracks.delete(e)})}),this.mediaStream=e,this.isStarting=!1,this.allActiveStreams.size,!0)}stopAllStreams(){this.allActiveStreams.size,this.allActiveTracks.size,this.allActiveStreams.forEach(e=>{e.getTracks().forEach(e=>{try{e.stop()}catch(a){}})}),this.allActiveTracks.forEach(e=>{try{"live"===e.readyState&&e.stop()}catch(a){}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0}}const ma=da.getInstance(),ua=_.memo(({employees:s,categories:t,currentManagerName:i,organizationName:o,onComplete:r,onCancel:n,preSelectedEmployeeId:l,preSelectedCategoryId:c,isFullScreen:p})=>{C.useRef(Math.random().toString(36).substr(2,9));const{user:y}=m(),{organization:v}=u(),f=(()=>{const[a,s]=C.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),t=C.useRef(null),i=C.useRef([]),o=C.useRef(null),r=C.useRef(0),n=C.useRef(null),l=C.useRef(!1),c=C.useRef(!1),d=C.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),m=C.useCallback(e=>e<1024?`${e}B`:e<1048576?`${(e/1024).toFixed(1)}KB`:`${(e/1048576).toFixed(1)}MB`,[]),u=C.useCallback(()=>`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),g=C.useCallback(()=>{if(!r.current)return;if(!a.isRecording)return void(n.current&&(clearInterval(n.current),n.current=null));const e=(Date.now()-r.current)/1e3,i=Date.now()-r.current;if(s(a=>a.isRecording?{...a,duration:e}:a),i>=ia)return n.current&&(clearInterval(n.current),n.current=null),void setTimeout(()=>{t.current&&"recording"===t.current.state&&t.current.stop()},0);i>=ra&&!l.current&&(l.current=!0)},[]),x=C.useCallback(()=>{try{if(t.current){try{"recording"===t.current.state&&t.current.stop()}catch(a){}t.current=null}[o.current,ma.mediaStream].filter(Boolean).forEach(e=>{e&&e.getTracks().forEach(e=>{try{e.stop()}catch(a){}})}),o.current=null,ma.stopAllStreams(),n.current&&(clearInterval(n.current),n.current=null),i.current=[],l.current=!1,r.current=0,s({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(a){e.error("❌ Error during force cleanup:",a)}},[]),p=C.useCallback(async()=>{if(ma.tryReserve())try{if(c.current=!1,(o.current||t.current||ma.mediaStream)&&(x(),await new Promise(e=>setTimeout(e,100))),s(e=>({...e,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const a=await navigator.mediaDevices.getUserMedia({audio:{channelCount:ta,sampleRate:sa,echoCancellation:na,noiseSuppression:la,autoGainControl:ca}});if(!ma.setStream(a))return void s(e=>({...e,isProcessing:!1,error:"Another recording is already active"}));o.current=a,i.current=[];const d=new MediaRecorder(a,{mimeType:ea,audioBitsPerSecond:aa});t.current=d,d.ondataavailable=a=>{if(!c.current&&a.data.size>0){i.current.push(a.data);const r=i.current.reduce((e,a)=>e+a.size,0);if(s(e=>({...e,size:r})),r>=oa&&"recording"===t.current?.state){m(r),c.current=!0;try{t.current.stop()}catch(o){e.error("❌ Error stopping MediaRecorder:",o)}}}},d.onstop=()=>{o.current&&(o.current.getTracks().forEach(e=>e.stop()),o.current=null)},d.start(1e3),r.current=Date.now(),l.current=!1,ma.startRecording(),n.current=setInterval(g,100);const h=u();s(e=>({...e,isRecording:!0,isProcessing:!1,recordingId:h,duration:0,size:0}))}catch(a){e.error("❌ Error starting recording:",a),ma.stopRecording(),s(e=>({...e,isRecording:!1,isProcessing:!1,error:a.message||"Failed to start recording"}))}},[g,u]),y=C.useCallback(async()=>{try{return t.current&&a.isRecording?(s(e=>({...e,isProcessing:!0})),n.current&&(clearInterval(n.current),n.current=null),new Promise(a=>{const o=t.current;o.onstop=()=>{try{const e=new Blob(i.current,{type:ea}),t=URL.createObjectURL(e);s(a=>({...a,isRecording:!1,isProcessing:!1,audioUrl:t,size:e.size})),m(e.size),c.current=!1,a(t)}catch(t){e.error("❌ Error processing recording:",t),s(e=>({...e,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),c.current=!1,a(null)}},o.stop(),s(e=>({...e,isRecording:!1}))})):(c.current=!1,null)}catch(o){return e.error("❌ Error stopping recording:",o),s(e=>({...e,isRecording:!1,isProcessing:!1,error:o.message||"Failed to stop recording"})),c.current=!1,null}},[a.isRecording,m]),v=C.useCallback(()=>{t.current&&a.isRecording&&(t.current.pause(),n.current&&(clearInterval(n.current),n.current=null))},[a.isRecording]),f=C.useCallback(()=>{t.current&&a.isRecording&&(t.current.resume(),r.current=Date.now()-1e3*a.duration,n.current=setInterval(g,100))},[a.isRecording,a.duration,g]),b=C.useCallback(()=>{try{t.current&&t.current.stop(),o.current&&(o.current.getTracks().forEach(e=>e.stop()),o.current=null),n.current&&(clearInterval(n.current),n.current=null),a.audioUrl&&URL.revokeObjectURL(a.audioUrl),i.current=[],l.current=!1,s({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(r){e.error("❌ Error cancelling recording:",r)}},[a.audioUrl]),w=C.useCallback(async(t,i)=>{try{if(!a.audioUrl||!a.recordingId)throw new Error("No recording available to upload");s(e=>({...e,isProcessing:!0}));const o=await fetch(a.audioUrl),r=await o.blob(),n=`warnings/${t}/${i}/audio/${a.recordingId}.webm`,l=R(h,n),c={contentType:ea,customMetadata:{warningId:i,organizationId:t,duration:a.duration.toString(),size:a.size.toString(),recordingId:a.recordingId,createdAt:(new Date).toISOString()}};await T(l,r,c);const d=await L(l);return s(e=>({...e,isProcessing:!1})),e.success(13735),d}catch(o){return e.error("❌ Error uploading audio:",o),s(e=>({...e,isProcessing:!1,error:o.message||"Failed to upload audio"})),null}},[a.audioUrl,a.recordingId,a.duration,a.size]),k=C.useCallback(async(t,i,o,r)=>{try{if(!t||!i)throw new Error("No recording data provided for upload");s(e=>({...e,isProcessing:!0}));const n=await fetch(t),l=await n.blob(),c=R(h,`warnings/${o}/${r}/audio/${i}.webm`),d={contentType:ea,customMetadata:{warningId:r,organizationId:o,duration:a.duration.toString(),size:l.size.toString(),recordingId:i,createdAt:(new Date).toISOString()}};await T(c,l,d);const m=await L(c);return s(e=>({...e,isProcessing:!1})),e.success(15712),m}catch(n){return e.error("❌ Error uploading audio from URL:",n),s(e=>({...e,isProcessing:!1,error:n.message||"Failed to upload audio"})),null}},[a.duration]);C.useEffect(()=>()=>{if(n.current&&(clearInterval(n.current),n.current=null),o.current&&(o.current.getTracks().forEach(e=>{e.stop()}),o.current=null),t.current){try{"recording"===t.current.state&&t.current.stop()}catch(e){}t.current=null}i.current=[],l.current=!1,r.current=0,ma.stopAllStreams()},[]);const N=a.duration>=ra/1e3,j=!a.isRecording&&!a.isProcessing;return{...a,startRecording:p,stopRecording:y,pauseRecording:v,resumeRecording:f,cancelRecording:b,forceCleanup:x,uploadToFirebase:w,uploadToFirebaseFromUrl:k,formatDuration:d,formatSize:m,isNearLimit:N,canRecord:j}})(),b=C.useCallback(async()=>{S(!0),D(!1)},[]),w=C.useCallback(()=>{S(!1)},[]);C.useEffect(()=>{const e=e=>{if("undefined"!=typeof window)if(e){const e=window.scrollY;document.documentElement.style.setProperty("--scroll-y",`-${e}px`),document.body.classList.add("modal-open")}else{document.body.classList.remove("modal-open");const e=document.documentElement.style.getPropertyValue("--scroll-y");document.documentElement.style.removeProperty("--scroll-y"),e&&window.scrollTo(0,-1*parseInt(e.replace("px","")))}};return e(!0),()=>e(!1)},[]),C.useEffect(()=>{const e=setTimeout(()=>{alert("⏱️ Session Timeout\n\nThis warning session has been open for 30 minutes and will now close. Please start a new warning if needed."),f&&f.forceCleanup(),n()},18e5);return()=>{clearTimeout(e)}},[]);const[k,N]=C.useState(0),[j,S]=C.useState(!1),[_,D]=C.useState(!0),[I,E]=C.useState(new Set),[z,q]=C.useState(!1),[$,F]=C.useState(!1),[P]=C.useState(()=>g()),[W,U]=C.useState({employeeId:l||null,categoryId:c||null,incidentDate:(new Date).toISOString().split("T")[0],incidentTime:(new Date).toTimeString().split(" ")[0].substring(0,5),incidentLocation:"",incidentDescription:"",additionalNotes:"",issueDate:(new Date).toISOString().split("T")[0],validityPeriod:6}),[H,B]=C.useState(!1),[V,G]=C.useState([]),[Y,Z]=C.useState(null),[ee,ae]=C.useState(null),[se,te]=C.useState(null);C.useEffect(()=>{const e=se||Y?.suggestedLevel||"counselling";W.level!==e&&U(a=>({...a,level:e,wasOverridden:!!se}))},[se,Y?.suggestedLevel,W.level]);const[re,ne]=C.useState(!1),[le,ce]=C.useState(null),[de,me]=C.useState(null),[he,ge]=C.useState(!1),[xe,pe]=C.useState(null),[ye,ve]=C.useState({manager:null,employee:null}),[fe,we]=C.useState(!1),[ke,Ne]=C.useState(null),je=(({sessionId:e,stepName:a,autoStart:s=!0,enableRealTimeValidation:t=!0})=>{const[i,o]=C.useState(e||""),[r,n]=C.useState([]),[l,c]=C.useState([]),[d,m]=C.useState(null),u=C.useRef(!1),h=C.useRef(!1);C.useEffect(()=>{if(!s||u.current||e)e&&(o(e),u.current=!0);else{const e=Le.startWizardSession();o(e),u.current=!0}},[s,e]),C.useEffect(()=>{if(!i)return;const e=()=>{const e=Le.getSessionLogs(i),a=Le.getSessionIssues(i),s=Le.getSessionSummary(i);n(e),c(a),m(s)};e();const a=a=>{(a.metadata?.sessionId===i||r.some(e=>e.id===a.id))&&e()};Le.addListener(a);const s=setInterval(e,2e3);return()=>{Le.removeListener(a),clearInterval(s)}},[i]);const g=C.useCallback(()=>{if(!u.current){const e=Le.startWizardSession();return o(e),u.current=!0,e}return i},[i]),x=C.useCallback(e=>{i&&(h.current&&(Le.exitStep(i,a,void 0,"completed"===e),h.current=!1),Le.endWizardSession(i,e),u.current=!1)},[i,a]),p=C.useCallback(e=>{i&&!h.current&&(Le.enterStep(i,a,e),h.current=!0)},[i,a]),y=C.useCallback((e,s=!0)=>{i&&h.current&&(Le.exitStep(i,a,e,s),h.current=!1)},[i,a]),v=C.useCallback((e,s,t)=>{i&&Le.trackDataChange(i,a,e,s,t)},[i,a]),f=C.useCallback(e=>{i&&Le.trackFormSubmission(i,a,e)},[i,a]),b=C.useCallback((e,s,t,o)=>{i&&Le.trackAPICall(i,a,e,s,t,o)},[i,a]),w=C.useCallback((e,s)=>{i&&Le.trackError(i,a,e,s)},[i,a]),k=C.useCallback((e,s)=>{i&&Le.trackSuccess(i,a,e,s)},[i,a]),N=C.useCallback((e,s)=>{i&&Le.trackWarning(i,a,e,s)},[i,a]),j=C.useCallback(e=>i&&t&&Le.validateStepData?.(i,a,e,"MANUAL_VALIDATION")||{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},[i,a,t]),S=C.useCallback(()=>i?Le.exportSessionData(i):"",[i]);return C.useEffect(()=>{i&&s&&!h.current&&p()},[i,s,p]),C.useEffect(()=>()=>{i&&h.current&&y(void 0,!1)},[i,y]),{sessionId:i,startSession:g,endSession:x,enterStep:p,exitStep:y,trackChange:v,trackFormSubmit:f,trackAPI:b,trackError:w,trackSuccess:k,trackWarning:N,validateData:j,logs:r,issues:l,summary:d,exportSession:S}})({stepName:`STEP_${k||1}`,autoStart:!0,enableRealTimeValidation:!1}),Se=C.useRef(0);C.useRef(W),C.useRef(new Set);const Ce=C.useRef(!1),_e=C.useMemo(()=>s.find(e=>e.id===W.employeeId),[s,W.employeeId]),De=C.useMemo(()=>t.find(e=>e.id===W.categoryId),[t,W.categoryId]),Ie=C.useMemo(()=>v?.id,[v?.id]);C.useCallback(()=>{k>0&&!he&&N(k-1)},[k,he]),C.useCallback(()=>{k<3&&!he&&N(k+1)},[k,he]),C.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"});const e=document.querySelector(".modal-content__scrollable");e&&e.scrollTo({top:0,behavior:"smooth"});const a=document.querySelector(".modal-system");a&&a.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{window.scrollTo({top:0,behavior:"instant"}),e&&e.scrollTop>0&&(e.scrollTop=0)},500)},[k]),C.useEffect(()=>{Se.current!==k&&(je.trackSuccess("STEP_CHANGED",{from:Se.current,to:k,stepName:0===k?"Incident Details":1===k?"Legal Review":"Delivery Completion"}),Se.current=k)},[k,je]),f.isRecording;const Ee=C.useCallback(async e=>{if(e&&Ie){je.trackAPI("loadWarningHistory",{employeeId:e,organizationId:Ie}),B(!0);try{const a=await x.warnings.getAll(Ie,{employeeId:e});G(a),je.trackAPI("loadWarningHistory",{employeeId:e,organizationId:Ie},{count:a.length})}catch(a){je.trackError(a,{employeeId:e,organizationId:Ie}),G([])}finally{B(!1)}}},[Ie,je]),ze=C.useRef(null);C.useEffect(()=>{_e&&!H&&ze.current!==_e.id&&(ze.current=_e.id,Ee(_e.id))},[_e?.id,H,Ee]);const Re=C.useCallback(async(a,i)=>{if(!(a&&i&&Ie&&W.incidentDescription)){const e={employeeId:!!a,categoryId:!!i,organizationId:!!Ie,incidentDescription:!!W.incidentDescription};return void je.trackError(new Error("Cannot generate LRA - missing data"),e)}let o;q(!0),je.trackAPI("generateLRARecommendation",{employeeId:a,categoryId:i});try{o=await x.warnings.getActiveWarnings(a,Ie),o.length}catch(r){e.error("❌ Failed to fetch active warnings:",r),je.trackError(r,{employeeId:a,categoryId:i,context:"final_warning_verification_failed"});const o=s.find(e=>e.id===a),n=t.find(e=>e.id===i);return ne(!0),ce({employeeName:o?`${o.firstName} ${o.lastName}`:"Employee",categoryName:n?.name||"Category",warningDate:"cannot_verify_escalation"}),void q(!1)}if(o.some(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===i)){const e=o.find(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===i),r=s.find(e=>e.id===a),n=t.find(e=>e.id===i);return ne(!0),ce({employeeName:r?`${r.firstName} ${r.lastName}`:"Employee",categoryName:n?.name||"Category",warningDate:e?.issueDate||(new Date).toISOString()}),void q(!1)}try{const e=await x.warnings.getEscalationRecommendation(a,i,v?.id||"default");Z(e),je.trackAPI("generateLRARecommendation",{employeeId:a,categoryId:i},e)}catch(n){je.trackError(n,{employeeId:a,categoryId:i,formData:W,context:"lra_generation_failed"});const e=De?.escalationPath||["counselling","verbal","first_written","final_written"],s={suggestedLevel:e[0]||"counselling",recommendedLevel:"counselling"===e[0]?"Counselling Session":"verbal"===e[0]?"Verbal Warning":"first_written"===e[0]?"First Written Warning":"Counselling Session",reason:"Fallback recommendation due to analysis error. Manual review required.",activeWarnings:o,escalationPath:e,isEscalation:!1,category:De?.name||"General Misconduct",categoryId:i,legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure procedural fairness","Document thoroughly"],warningCount:o.length,nextExpiryDate:null,examples:["Review case manually","Consult HR if needed"],explanation:"Unable to analyze history - system error occurred",previousWarnings:[],confidence:60};Z(s),je.trackWarning("Using fallback LRA recommendation",s)}finally{q(!1)}},[Ie,W.incidentDescription,De,je,s,t]),Te=C.useCallback(e=>{const a=["employeeId","categoryId","incidentLocation"];Object.keys(e).some(s=>a.includes(s)&&e[s]!==W[s])&&je.trackSuccess("SIGNIFICANT_FORM_UPDATE",e),U(a=>({...a,...e}))},[W,je]),Ae=C.useCallback(()=>{je.trackSuccess("WIZARD_COMPLETED",{sessionDuration:Date.now()-new Date(je.summary?.startTime||Date.now()).getTime(),totalSteps:I.size,totalIssues:je.issues.length,finalWarningId:ee}),je.endSession("completed"),r()},[r,je,I.size,ee]),Me=C.useCallback(()=>{je.trackWarning("WIZARD_CANCELLED",{currentStep:k,completedSteps:Array.from(I)}),f.forceCleanup(),document.body.classList.remove("modal-open"),je.endSession("cancelled"),n()},[n,je,k,I,f]);C.useEffect(()=>{if(Ce.current||!j||f.isRecording||f.audioUrl)return;return(async()=>{try{Ce.current=!0,await f.startRecording(),je.trackSuccess("AUDIO_RECORDING_STARTED",{duration:f.duration,size:f.size})}catch(e){je.trackError(e,{context:"AUDIO_RECORDING_START"}),Ce.current=!1}})(),()=>{Ce.current=!1}},[j]),C.useEffect(()=>{xe&&!z&&Y&&(je.trackSuccess("LRA_ANALYSIS_COMPLETE_PROCEEDING",{pendingStep:xe,hasRecommendation:!!Y}),N(xe),pe(null),ge(!1)),re&&xe&&(pe(null),ge(!1))},[xe,z,Y,re,je]);const qe=C.useCallback(async()=>{if(je.trackSuccess("NEXT_STEP_REQUESTED",{currentStep:k,hasLRA:!!Y}),2===k)return void(de?.canFinalize&&de?.finalizeHandler&&(je.trackSuccess("FINALIZING_WARNING",{}),de.finalizeHandler()));const e=k+1;if(E(e=>new Set([...e,k])),0===k&&1===e)return W.employeeId&&W.categoryId&&W.incidentDescription?Y&&!z?(je.trackSuccess("PROCEEDING_TO_STEP_2",{hasLRA:!0}),void N(e)):(je.trackSuccess("TRIGGERING_LRA_GENERATION",W),ge(!0),pe(e),void(await Re(W.employeeId,W.categoryId))):void je.trackError(new Error("Missing required data for step 2"),{employeeId:!!W.employeeId,categoryId:!!W.categoryId,incidentDescription:!!W.incidentDescription});je.trackSuccess("STEP_NAVIGATION_COMPLETE",{from:k,to:e}),N(e)},[k,W.employeeId,W.categoryId,W.incidentDescription,Y,z,Re,je,de]),Fe=C.useCallback(()=>{k>0&&(je.trackSuccess("PREVIOUS_STEP",{from:k,to:k-1}),N(k-1),he&&(ge(!1),pe(null),je.trackWarning("NAVIGATION_CANCELLED_BY_BACK",{currentStep:k})))},[k,he,je]),Pe=C.useCallback(async(a,s=!1)=>{if(je.trackSuccess("SIGNATURES_COMPLETED",{hasManager:!!a.manager,hasEmployee:!!a.employee,finalized:s,timestamp:a.timestamp}),ve(a),s){we(!0);try{let s=null;if(f?.isRecording&&(Ne("stopping"),je.trackSuccess("AUDIO_AUTO_STOP_BEFORE_SAVE",{duration:f.duration,size:f.size}),s=await f.stopRecording(),e.success(21068),s||e.warn("⚠️ Audio URL not returned from stopRecording. Will create warning with placeholder.")),!_e||!De||!v)throw new Error("Missing required data for warning creation");const o={employeeId:_e.id,categoryId:De.id,organizationId:v.id,employeeName:_e.profile?.firstName||"Unknown",employeeLastName:_e.profile?.lastName||"Employee",employeeNumber:_e.profile?.employeeNumber||"Unknown",employeeDepartment:_e.profile?.department||"Unknown",employeePosition:_e.profile?.position||"Unknown",categoryName:De.name||"Unknown",level:se||Y?.suggestedLevel||"counselling",wasOverridden:!!se,originalRecommendedLevel:Y?.suggestedLevel,incidentDate:W.incidentDate,incidentTime:W.incidentTime,incidentLocation:W.incidentLocation,incidentDescription:W.incidentDescription,additionalNotes:W.additionalNotes,issueDate:W.issueDate,validityPeriod:W.validityPeriod,signatures:a};s?(o.audioRecording={url:s,duration:f?.duration||0,size:f?.size||0,recordingId:f?.recordingId,uploadToFirebase:!0,status:"ready",processingStatus:"pending"},e.success(23340)):(e.error("❌ Audio recording is mandatory for all warnings"),je.trackError(new Error("Audio recording missing"),{warningData:W,audioState:{isRecording:f?.isRecording,hasDirectUrl:!!s,hasStateUrl:!!f?.audioUrl,duration:f?.duration}}),o.audioRecording={status:"missing",processingStatus:"required",error:"Audio recording is mandatory but was not captured",duration:f?.duration||0,size:f?.size||0,uploadToFirebase:!1,requiresAttention:!0});const r=await x.warnings.create(o);if(e.success(24554),ae(r),s&&f?.uploadToFirebaseFromUrl&&f?.recordingId&&r)try{Ne("uploading");const a=await f.uploadToFirebaseFromUrl(s,f.recordingId,v.id,r);if(a){e.success(25382);const s=A(d,"organizations",v.id,"warnings",r);await M(s,{"audioRecording.url":a,"audioRecording.storageePath":`warnings/${v.id}/${r}/audio/${f.recordingId}.webm`,"audioRecording.processingStatus":"complete","audioRecording.uploadedAt":new Date,updatedAt:new Date}),e.success(26224),je.trackSuccess("AUDIO_UPLOADED_AND_UPDATED",{warningId:r,firebaseUrl:a,duration:f.duration,size:f.size}),Ne("complete"),f.forceCleanup()}else e.warn("⚠️ Audio upload returned null URL"),je.trackWarning("AUDIO_UPLOAD_NULL_URL",{warningId:r})}catch(t){e.error("❌ Audio upload failed:",t),je.trackError(t,{context:"AUDIO_UPLOAD_STEP2",warningId:r,duration:f?.duration,size:f?.size});try{const e=A(d,"organizations",v.id,"warnings",r);await M(e,{"audioRecording.processingStatus":"failed","audioRecording.error":t.message||"Upload failed in Step 2","audioRecording.failedAt":new Date,updatedAt:new Date})}catch(i){e.error("❌ Failed to update warning with audio error:",i),je.trackError(i,{context:"AUDIO_ERROR_UPDATE"})}f.forceCleanup()}je.trackSuccess("WARNING_FULLY_CREATED_STEP2",{warningId:r})}catch(o){e.error("❌ Error creating warning:",o),je.trackError(o,{context:"WARNING_CREATION_ON_SIGNATURE_COMPLETE"})}E(e=>new Set([...e,k])),je.trackSuccess("SIGNATURES_FINALIZED_NEXT_ENABLED",{currentStep:k})}},[k,je,f,_e,De,v,W,Y,x]),We=C.useMemo(()=>({0:{title:"Incident Details",subtitle:"Step 1 of 3",description:"Select employee, choose violation category, and document the incident with all relevant details.",icon:J},1:{title:"Review & Sign",subtitle:"Step 2 of 3",description:"Review escalation recommendation, read warning script, and collect required signatures.",icon:K},2:{title:"Delivery Setup",subtitle:"Step 3 of 3 - Administrative",description:"✅ Warning saved. Choose how HR will deliver to employee.",icon:ue}}),[]),Ue=C.useMemo(()=>{switch(k){case 0:return!!(W.employeeId&&W.categoryId&&W.incidentDate&&W.incidentTime&&W.incidentLocation&&W.incidentDescription&&W.incidentDescription.length>=20);case 1:return!!(Y&&!z&&ye.manager&&ye.employee&&fe);case 2:return!0;default:return!1}},[k,W,Y,z,ye,fe]),Oe=C.useCallback(()=>{switch(k){case 0:if(re&&le){const e="cannot_verify_escalation"===le.warningDate;return a.jsxs("div",{className:"p-6 space-y-5",children:[a.jsx("div",{className:"p-5 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)",borderLeft:"4px solid var(--color-error)"},children:a.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[a.jsx(X,{className:"w-6 h-6 flex-shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-base font-bold mb-1",style:{color:"var(--color-error)"},children:e?"HR Approval Required":"Cannot Issue Warning"}),a.jsxs("p",{className:"text-sm mb-2",style:{color:"var(--color-alert-error-text)"},children:[a.jsx("strong",{children:le.employeeName})," has a Final Written Warning on file."]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)",opacity:.9},children:e?"Cannot verify warning history. Contact HR to approve further escalation.":"This is the final step before termination. HR must handle any further escalation."})]})]})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{onClick:async()=>{alert("HR Notification feature coming soon!\n\nFor now, please contact your HR Manager directly via phone or email.")},className:"flex-1 px-4 py-3 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[a.jsx(ue,{className:"w-4 h-4 inline mr-2"}),"Notify HR Manager"]}),a.jsxs("button",{onClick:()=>{ne(!1),ce(null),n()},className:"px-4 py-3 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-error)",color:"var(--color-text-inverse)"},children:[a.jsx(O,{className:"w-4 h-4 inline mr-2"}),"Close"]})]})]})}return a.jsx($e,{employees:s,categories:t,formData:W,updateFormData:Te,selectedEmployee:_e,selectedCategory:De,warningHistory:V,isLoadingWarningHistory:H,loadWarningHistory:Ee,lraRecommendation:Y,isAnalyzing:z});case 1:return a.jsx(Ve,{lraRecommendation:Y,selectedEmployee:_e,formData:W,currentManagerName:i,onSignaturesComplete:Pe,isAnalyzing:z,signaturesFinalized:fe,currentSignatures:ye,warningId:ee,audioUploadStatus:ke,onLevelOverride:te});case 2:return a.jsx(Xe,{selectedEmployee:_e,selectedCategory:De,formData:W,lraRecommendation:Y,signatures:ye,organizationName:o,currentManagerName:i,audioRecording:f,onComplete:Ae,onWarningCreated:ae,warningId:ee,onFinalizeReady:me});default:return a.jsxs("div",{className:"p-8 text-center text-red-600",children:["Unknown step: ",k]})}},[k,o,i,s,t,W,Te,_e,De,V,H,Ee,Y,z,Pe,ye,f,Ae,re,le,n]),He=(()=>{if(re)return{show:!1,disabled:!0,loading:!1,text:""};if(2===k)return{show:!0,disabled:!de?.canFinalize,loading:!1,text:"Finalize"};if(0===k&&!Ue){const e=[];if(W.employeeId)if(W.categoryId){if(!W.incidentLocation||W.incidentLocation.length<3)e.push("Add location");else if(!W.incidentDescription||W.incidentDescription.length<20){const a=W.incidentDescription?.trim().split(/\s+/).filter(e=>e.length>0)||[],s=Math.max(0,20-a.length);e.push(`Add ${s} more word${1===s?"":"s"}`)}}else e.push("Choose category");else e.push("Select employee");return{show:!0,disabled:!0,loading:!1,text:e.length>0?`Next - ${e[0]}`:"Next"}}return 0===k&&Ue&&(he||z)?{show:!0,disabled:!0,loading:!0,text:"Analyzing..."}:{show:!0,disabled:!Ue,loading:!1,text:"Next"}})();return C.useMemo(()=>({formData:W,signatures:ye,lraRecommendation:Y,selectedEmployee:_e,selectedCategory:De,organizationId:v?.id,currentStep:k,isStepValid:Ue,isAnalyzing:z,warningHistory:V,finalWarningId:ee}),[W,ye,Y,_e,De,v?.id,k,Ue,z,V,ee]),C.useEffect(()=>()=>{f.forceCleanup(),document.body.classList.remove("modal-open")},[]),_&&!j?a.jsx(Qe,{onPermissionGranted:b,onPermissionDenied:w,organizationName:o,managerName:i}):a.jsx("div",{className:`\n    modal-system\n    ${p?"modal-system--fullscreen":""}\n    ${P.isLegacyDevice?"legacy-device":""}\n    ${P.hasGoodPerformance?"perf-high":"perf-low"}\n    ${P.hasModernCSS?"css-modern":"css-legacy"}\n  `,children:a.jsxs("div",{className:`\n      modal-container\n      ${p?"modal-container--fullscreen":""}\n      ${P.browserInfo.isAndroid4x?"android-4x":""}\n      ${P.browserInfo.isIOS6to7?"ios-6-7":""}\n    `,children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Issue Warning"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document disciplinary action and intervention"})]})}),a.jsx("button",{onClick:Me,className:"modal-header__close-button",title:"Cancel and close wizard",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"modal-header__center",children:[a.jsx("div",{className:"modal-header__progress-mobile md:hidden",children:a.jsxs("div",{className:"mobile-step-indicator",children:[a.jsxs("div",{className:"mobile-step-dots",children:[Object.entries(We).map(([e,s])=>{const t=parseInt(e),i=t===k,o=I.has(t);return a.jsx("div",{className:`mobile-step-dot ${i?"mobile-step-dot--active":""} ${o?"mobile-step-dot--completed":""} ${i||o?"":"mobile-step-dot--inactive"}`,title:s.title,children:o?a.jsx(oe,{className:"w-3 h-3"}):t+1},e)}),f.isRecording&&a.jsx("div",{className:"mobile-recording-indicator",children:a.jsx("div",{className:"mobile-recording-dot-pulse"})})]}),a.jsx("div",{className:"mobile-step-info",children:a.jsx("div",{className:"mobile-step-title",children:We[k]?.title||"Loading..."})})]})}),a.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Object.entries(We).map(([e,s])=>{const t=parseInt(e),i=t===k,o=I.has(t);return a.jsxs("div",{className:"step-container",children:[a.jsx("div",{className:`\n                step-dot\n                ${i?"step-dot--active":""}\n                ${o?"step-dot--completed":""}\n                ${i||o?"":"step-dot--inactive"}\n              `,title:s.title,children:o?a.jsx(oe,{className:"w-3 h-3"}):t+1}),t<Math.max(...Object.keys(We).map(Number))&&a.jsx("div",{className:`\n                step-connector\n                ${o?"step-connector--completed":"step-connector--inactive"}\n              `})]},e)})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable step-transition",children:Oe()},k)}),a.jsx("div",{className:"modal-footer",children:!re&&a.jsx("div",{className:"modal-footer__nav",children:2===k&&ee?a.jsxs("button",{onClick:Ae,className:"modal-footer__button modal-footer__button--primary w-full",children:[a.jsx(Q,{className:"w-4 h-4"}),"Close"]}):a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:Fe,disabled:0===k||he,className:`\n                    modal-footer__button modal-footer__button--secondary\n                    ${0===k||he?"opacity-50":""}\n                  `,children:[a.jsx(be,{className:"w-4 h-4"}),"Previous"]}),He.show&&a.jsx("button",{onClick:qe,disabled:He.disabled,className:`\n                      modal-footer__button modal-footer__button--primary\n                      ${He.loading?"modal-footer__button--loading":""}\n                    `,children:!He.loading&&a.jsxs(a.Fragment,{children:[He.text,a.jsx(ie,{className:"w-4 h-4"})]})})]})})})]})})},(e,a)=>e.currentManagerName===a.currentManagerName&&e.organizationName===a.organizationName&&e.preSelectedEmployeeId===a.preSelectedEmployeeId&&e.preSelectedCategoryId===a.preSelectedCategoryId&&e.isFullScreen===a.isFullScreen&&(e.employees.length===a.employees.length&&e.categories.length===a.categories.length)),ha=Object.freeze(Object.defineProperty({__proto__:null,EnhancedWarningWizard:ua},Symbol.toStringTag,{value:"Module"})),ga=({employees:e,selectedEmployeeId:s,onEmployeeSelect:t,disabled:i=!1,className:o="",title:r="Employee Selection",subtitle:n="Choose the employee for this action"})=>{const[l,c]=C.useState(""),[d,m]=C.useState(!1),[u,h]=C.useState(!1),g=C.useMemo(()=>{if(!l.trim())return e;const a=l.toLowerCase();return e.filter(e=>{const s=`${e.firstName} ${e.lastName}`.toLowerCase(),t=e.department?.toLowerCase()||"";return s.includes(a)||t.includes(a)})},[e,l]),x=C.useMemo(()=>e.find(e=>e.id===s),[e,s]),p=C.useCallback(e=>{t(e),m(!1),h(!1),c("")},[t]),y=C.useCallback(()=>{if(i)return;window.innerWidth<768?h(!0):m(!d)},[i,d]),v=C.useCallback(()=>{h(!1),c("")},[]);return a.jsxs("div",{className:`form-section ${o}`,children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(W,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:r}),a.jsx("p",{className:"unified-section-header__subtitle",children:n})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border "+(i?"opacity-50 cursor-not-allowed":"hover:border-primary"),style:{backgroundColor:"var(--color-input-background)",borderColor:d?"var(--color-primary)":"var(--color-input-border)",boxShadow:d?"0 0 0 2px var(--color-primary-light)":void 0},onClick:y,children:x?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[x.firstName?.charAt(0),x.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[x.firstName," ",x.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[x.position," • ",x.department]})]})]}),a.jsx(U,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(d?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(W,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(U,{className:"w-4 h-4 transition-transform "+(d?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),d&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[a.jsx("div",{className:"p-3",style:{borderBottom:"1px solid var(--color-border)"},children:a.jsxs("div",{className:"relative",children:[a.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-3 py-2 rounded border text-sm focus:ring-2",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)","--ring-color":"var(--color-primary)"}})]})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:g.length>0?a.jsx("div",{className:"py-2",children:g.map(e=>a.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left px-3 py-2 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:[e.firstName," ",e.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[e.position," • ",e.department]})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center",children:[a.jsx(W,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l?`No employees found matching "${l}"`:"No employees available"})]})})]})]})}),u&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:v}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Employee"}),a.jsx("button",{onClick:v,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(O,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-3 py-2 rounded border",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)"}})]})}),a.jsx("div",{className:"mobile-category-list",children:g.length>0?a.jsx("div",{children:g.map(e=>a.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left px-4 py-3 transition-colors",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-sm",style:{color:"var(--color-primary)"},children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-medium text-base",style:{color:"var(--color-text)"},children:[e.firstName," ",e.lastName]}),a.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[e.position," • ",e.department]})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center",children:[a.jsx(W,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l?`No employees found matching "${l}"`:"No employees available"})]})})]})]})]})},xa=[{id:"training",label:"Training & Development",description:"Skills training, knowledge sharing, and competency development",icon:"📚",color:"blue"},{id:"coaching",label:"Performance Coaching",description:"Performance improvement, goal setting, and mentoring",icon:"🎯",color:"green"},{id:"behavioral",label:"Behavioral Discussion",description:"Conduct, attitude, and workplace behavior guidance",icon:"🤝",color:"purple"}],pa=({isOpen:e,onClose:s})=>{const{user:t}=m(),{organization:i}=u(),[o,r]=C.useState(null),[n,l]=C.useState(null),[c,d]=C.useState("coaching"),[h,g]=C.useState(""),[y,v]=C.useState(""),[f,b]=C.useState(!1),[w,k]=C.useState(null),[N,j]=C.useState(!1),[S,_]=C.useState(!0),[D,I]=C.useState([]),[E,z]=C.useState([]);C.useEffect(()=>{if(i?.id&&t?.id&&e){(async()=>{try{_(!0),k(null);const e=(await x.employees.getByManager(t?.id||"",i.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",email:e.profile?.email||e.contact?.email||e.email||"",phone:e.profile?.phone||e.contact?.phone||e.phone||"",deliveryPreference:e.deliveryPreference||"email",...e}));I(e);let a=await x.organizations.getCategories(i.id);a&&0!==a.length||(a=[{id:"attendance_punctuality",name:"Attendance & Punctuality",severity:"minor"},{id:"performance_issues",name:"Performance Issues",severity:"moderate"},{id:"safety_violations",name:"Safety Violations",severity:"serious"},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",severity:"serious"},{id:"policy_violations",name:"Policy Violations",severity:"serious"},{id:"dishonesty_theft",name:"Dishonesty & Theft",severity:"gross_misconduct"},{id:"substance_abuse",name:"Substance Abuse",severity:"gross_misconduct"},{id:"harassment_discrimination",name:"Harassment & Discrimination",severity:"gross_misconduct"}]),z(a)}catch(e){k("Failed to load data. Please try again."),I([]),z([])}finally{_(!1)}})()}else e||_(!1)},[t?.id,i?.id,e]);return e?S?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Loading Counselling Data"}),a.jsx("p",{className:"modal-header__subtitle",children:"Preparing counselling session data"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[a.jsx("div",{className:"animate-spin mx-auto h-16 w-16 border-4 border-gray-200 border-t-primary rounded-full"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading counselling data..."})]})})})]})}):N?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Counselling Session Recorded"}),a.jsx("p",{className:"modal-header__subtitle",children:"Successfully documented and available for HR review"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Session Successfully Recorded"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The corrective counselling session with ",a.jsxs("strong",{children:[o?.firstName," ",o?.lastName]})," has been successfully documented and will be available to HR for review."]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting automatically in a few seconds..."})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:s,className:"modal-footer__button modal-footer__button--primary",children:"Return to Dashboard"})})})]})}):a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container modal-container--xl",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Corrective Counselling Session"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document training, coaching, and discussions"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[w&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),a.jsx(ga,{employees:D,selectedEmployeeId:o?.id||null,onEmployeeSelect:e=>{const a=D.find(a=>a.id===e);r(a||null)},title:"Employee Selection",subtitle:"Choose the employee involved in this counselling session",disabled:S}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2 unified-field-required",children:"Related Category"}),a.jsxs("select",{value:n?.id||"",onChange:e=>{const a=E.find(a=>a.id===e.target.value);l(a||null)},className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",required:!0,children:[a.jsx("option",{value:"",children:"Choose a category..."}),E.map(e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.severity]},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(ke,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Counselling Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the appropriate type of counselling session"})]})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:xa.map(e=>a.jsx("div",{className:"category-card cursor-pointer "+(c===e.id?"category-card--selected":""),onClick:()=>d(e.id),children:a.jsxs("div",{className:"category-card__content",children:[a.jsx("span",{className:"category-card__icon",children:e.icon}),a.jsxs("div",{className:"category-card__details",children:[a.jsx("div",{className:"category-card__title",children:e.label}),a.jsx("p",{className:"category-card__description",children:e.description})]})]})},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(J,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Issue/Topic Description"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the issue or topic that prompted this counselling session"})]})]}),a.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Describe the issue, topic, or area for improvement that prompted this counselling session...",rows:4,minLength:20,maxLength:500,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),a.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[h.length,"/500 characters (minimum 20)"]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(Q,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Intervention Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Document what was discussed and addressed during the session"})]})]}),a.jsx("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"Describe what was discussed, taught, or addressed during the counselling session...",rows:4,minLength:30,maxLength:1e3,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),a.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[y.length,"/1000 characters (minimum 30)"]})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:s,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(t&&o&&n&&t.organizationId)try{b(!0),k(null);const e={organizationId:t.organizationId,managerId:t.id,managerName:`${t.firstName} ${t.lastName}`,employeeId:o.id,employeeName:`${o.firstName} ${o.lastName}`,employeeNumber:o.employeeNumber||"",department:o.department||"",category:n.name,categoryId:n.id,counsellingType:c,issueDescription:h.trim(),interventionDetails:y.trim(),trainingProvided:"",resourcesProvided:[],promisesToPerform:[],improvementTimeline:"",followUpDate:"",managerSignature:"",employeeAcknowledged:!1,employeeComments:"",status:"completed",improvementNoted:!1,followUpCompleted:!1,escalationRequired:!1,dateCreated:(new Date).toISOString(),lastUpdated:(new Date).toISOString(),createdBy:t.id,documentVersion:1};await p.createDocument(i.id,"reports",e),j(!0),setTimeout(()=>{s()},3e3)}catch(e){k("Failed to submit counselling record. Please try again.")}finally{b(!1)}},disabled:!(o&&n&&h.trim().length>=20&&y.trim().length>=30)||f,className:"modal-footer__button modal-footer__button--primary",children:f?"Submitting...":"Submit Counselling Session"})]})})]})}):null},ya=({onSignatureChange:e,label:s,required:t=!1,role:i="manager",personName:o})=>{const r=C.useRef(null),[n,l]=C.useState(!1),[c,d]=C.useState(!1),m=C.useCallback(e=>{const a=r.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(l(!0),t.beginPath(),t.moveTo(e.clientX-s.left,e.clientY-s.top))},[]),u=C.useCallback(e=>{if(!n)return;const a=r.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(t.lineTo(e.clientX-s.left,e.clientY-s.top),t.stroke(),d(!0))},[n]),h=C.useCallback(()=>{if(n&&r.current){l(!1);const a=r.current.toDataURL();e(a)}},[n,e]),g=C.useCallback(()=>{const a=r.current;if(!a)return;const s=a.getContext("2d");s&&(s.clearRect(0,0,a.width,a.height),d(!1),e(""))},[e]),x=C.useCallback(()=>{const e=r.current;if(!e)return;const a=e.getContext("2d");if(!a)return;const s=e.getBoundingClientRect();e.width=s.width,e.height=s.height,a.strokeStyle="var(--color-text)",a.lineWidth=2,a.lineCap="round",a.lineJoin="round"},[]);return C.useEffect(()=>{x();const e=()=>{setTimeout(x,100)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[x]),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("label",{className:"unified-field-label",children:[s," ",t&&a.jsx("span",{className:"unified-field-required"})]}),a.jsx("p",{className:"unified-section-header__subtitle",children:"manager"===i?"Please sign below to confirm this meeting request":`${o}, please sign below if you agree to this meeting`})]}),a.jsx("div",{className:"flex items-center gap-2",children:c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[a.jsx(Q,{className:"w-4 h-4"}),a.jsx("span",{children:"Signed"})]}):a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(fe,{className:"w-4 h-4"}),a.jsx("span",{children:"Pending"})]})})]}),a.jsxs("div",{className:"border-2 border-dashed rounded p-4",style:{borderColor:"var(--color-border)"},children:[a.jsx("canvas",{ref:r,className:"w-full h-32 cursor-crosshair rounded",onMouseDown:m,onMouseMove:u,onMouseUp:h,onMouseLeave:h}),a.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:c?"Signature captured":"Click and drag to sign above"}),a.jsxs("button",{onClick:g,disabled:!c,className:"px-3 py-1 text-sm rounded flex items-center gap-1",style:{color:"var(--color-text-secondary)",backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[a.jsx(Se,{className:"w-4 h-4"}),"Clear"]})]})]})]})},va=({isOpen:s,onClose:t})=>{const{user:i}=m(),{organization:o}=u(),[r,n]=C.useState(null),[l,c]=C.useState(""),[d,h]=C.useState(""),[g,v]=C.useState(""),[f,b]=C.useState(null),[w,k]=C.useState(!1),[N,j]=C.useState(!1),[S,_]=C.useState(null),[D,I]=C.useState(!1),[E,z]=C.useState([]);C.useEffect(()=>{s&&(async()=>{if(i?.id&&o?.id)try{const e=(await x.employees.getByManager(i.id,o.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",email:e.profile?.email||e.contact?.email||e.email||"",...e}));z(e)}catch(a){e.error("Failed to load employees:",a),_("Failed to load employees")}})()},[i?.id,o?.id,s]);const R=()=>r&&l.trim().length>=20&&d.trim(),T=e=>{b(e),e?k(!0):(k(!1),v(""))};return C.useEffect(()=>{s||(n(null),c(""),h(""),v(""),b(null),k(!1),_(null),I(!1))},[s]),D?s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Meeting Request Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"HR will be notified and will schedule the meeting"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Meeting Request Submitted"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["Your meeting request for ",r?.firstName," ",r?.lastName," has been successfully submitted to HR. They will review the request and schedule the meeting accordingly."]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:[a.jsx(ee,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"You will receive notification once the meeting is scheduled"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Book HR Meeting"}),a.jsx("p",{className:"modal-header__subtitle",children:"Schedule intervention meeting with HR"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-header__center",children:a.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:a.jsx("div",{className:"mobile-step-indicator",children:a.jsx("div",{className:"mobile-step-dots",children:a.jsx("div",{className:"mobile-step-dot mobile-step-dot--active",children:"1"})})})})}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[S&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:S})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(ga,{employees:E,selectedEmployeeId:r?.id||null,onEmployeeSelect:e=>{const a=E.find(a=>a.id===e);n(a||null)},title:"Select Employee",subtitle:"Choose the team member for this HR meeting"}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(J,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Meeting Context"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the situation that requires HR intervention"})]})]}),a.jsx("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Describe the situation that requires HR intervention...",className:"unified-field-input",rows:4,minLength:20,maxLength:1e3}),a.jsxs("div",{className:"unified-field-hint",children:[l.length,"/1000 characters (minimum 20)"]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(Ne,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Manager Confirmation"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Please sign to confirm this meeting request"})]})]}),a.jsx(ya,{onSignatureChange:e=>{h(e)},label:"Manager Signature",role:"manager",required:!0})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(je,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Employee Acknowledgment"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional signature from the employee (can be done later)"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:a.jsx("div",{className:"flex-1",children:a.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Note:"})," Employee signature is optional. You can proceed without it and have them sign later."]})})}),w?a.jsxs("div",{className:"space-y-4",children:[a.jsx(ya,{onSignatureChange:e=>{v(e)},label:"Employee Signature",role:"employee",personName:`${r?.firstName} ${r?.lastName}`}),a.jsx("button",{onClick:()=>k(!1),className:"px-4 py-2 rounded",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Back to Options"})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"font-medium",style:{color:"var(--color-text)"},children:"Does the employee want to sign now?"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs("button",{onClick:()=>T(!0),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)"},children:[a.jsx(Ne,{className:"w-4 h-4"}),"Yes, employee will sign now"]}),a.jsxs("button",{onClick:()=>T(!1),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:[a.jsx(je,{className:"w-4 h-4"}),"Skip for now"]})]})]})]})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(i&&r&&o?.id&&R())try{j(!0),_(null);const e={organizationId:o.id,managerId:i.id,managerName:`${i.firstName} ${i.lastName}`,employeeId:r.id,employeeName:`${r.firstName} ${r.lastName}`,context:l.trim(),managerSignature:d,...f&&g&&{employeeSignature:g},employeeConsent:f||!1,status:"pending",requestDate:y.getServerTimestamp(),createdAt:y.getServerTimestamp(),updatedAt:y.getServerTimestamp()};await p.createDocument(o.id,"meetings",e),I(!0),setTimeout(()=>{t()},3e3)}catch(a){e.error("Failed to submit meeting request:",a),_("Failed to submit meeting request. Please try again.")}finally{j(!1)}},disabled:!R()||N,className:"modal-footer__button modal-footer__button--primary "+(N?"modal-footer__button--loading":""),children:"Submit Meeting Request"})]})})]})}):null},fa=Object.freeze(Object.defineProperty({__proto__:null,UnifiedBookHRMeeting:va},Symbol.toStringTag,{value:"Module"})),ba=[{id:"full-day",label:"Full Day Absence",icon:"🏠",payrollImpact:!0,description:"Employee absent for entire work day"},{id:"half-day",label:"Half Day Absence",icon:"🕐",payrollImpact:!0,description:"Employee absent for half of work day"},{id:"late-arrival",label:"Late Arrival",icon:"⏰",payrollImpact:!1,description:"Employee arrived late to work"},{id:"early-departure",label:"Early Departure",icon:"🚪",payrollImpact:!1,description:"Employee left work early"},{id:"sick-leave",label:"Sick Leave",icon:"🤒",payrollImpact:!0,description:"Employee absent due to illness"},{id:"personal-leave",label:"Personal Leave",icon:"👤",payrollImpact:!0,description:"Employee absent for personal reasons"}],wa=({isOpen:s,onClose:t})=>{const{user:i}=m(),{organization:o}=u(),[r,n]=C.useState(null),[l,c]=C.useState((new Date).toISOString().split("T")[0]),[d,h]=C.useState(""),[g,v]=C.useState(""),[f,b]=C.useState(!1),[w,k]=C.useState(null),[N,j]=C.useState(!1),[S,_]=C.useState([]),[D,I]=C.useState(!1),[E,z]=C.useState(!1);C.useEffect(()=>{s&&(async()=>{if(i?.id&&o?.id)try{const e=(await x.employees.getByManager(i.id,o.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",employeeNumber:e.employeeNumber||e.profile?.employeeNumber||"",...e}));_(e)}catch(a){e.error("Failed to load employees:",a),k("Failed to load employees")}})()},[i?.id,o?.id,s]);const R=C.useMemo(()=>ba.find(e=>e.id===d),[d]),T=C.useCallback(e=>{h(e),I(!1),z(!1)},[]),L=C.useCallback(()=>{window.innerWidth<768?z(!0):I(!D)},[D]),A=C.useCallback(()=>{z(!1)},[]),M=()=>r&&l&&d;C.useEffect(()=>{s||(n(null),c((new Date).toISOString().split("T")[0]),h(""),v(""),k(null),j(!1),I(!1),z(!1))},[s]);const q=ba.find(e=>e.id===d);return N?s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"Absence report has been successfully submitted"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Report Submitted Successfully"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The absence report for ",r?.firstName," ",r?.lastName," has been submitted and will be reviewed by HR."]}),q?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(Ce,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"This absence may impact payroll calculations"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Employee Absence"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document unscheduled employee absence"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[w&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(je,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select employee and specify absence information"})]})]}),a.jsx(ga,{employees:S,selectedEmployeeId:r?.id||null,onEmployeeSelect:e=>{const a=S.find(a=>a.id===e);n(a||null)},title:"Employee Selection",subtitle:"Choose the employee for this absence report"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(Ee,{type:"date",label:"Absence Date",value:l,onChange:e=>c(e),icon:ee,required:!0}),a.jsxs("div",{children:[a.jsx("label",{className:"unified-field-label",children:"Reported Date"}),a.jsx("input",{type:"text",value:(new Date).toLocaleDateString(),readOnly:!0,className:"unified-field-input opacity-75"})]})]})})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(B,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the type of absence that occurred"})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border hover:border-primary",style:{backgroundColor:"var(--color-input-background)",borderColor:D?"var(--color-primary)":"var(--color-input-border)",boxShadow:D?"0 0 0 2px var(--color-primary-light)":void 0},onClick:L,children:R?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg",children:R.icon}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:R.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:R.description}),R.payrollImpact&&a.jsx("span",{className:"category-card__badge category-card__badge--warning",children:a.jsx(Ce,{className:"w-3 h-3"})})]})]})]}),a.jsx(U,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(D?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(B,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select absence type..."})]}),a.jsx(U,{className:"w-4 h-4 transition-transform "+(D?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),D&&a.jsx("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:a.jsx("div",{className:"max-h-60 overflow-y-auto",children:a.jsx("div",{className:"py-2",children:ba.map(e=>a.jsx("button",{onClick:()=>T(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg flex-shrink-0",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs",style:{color:"var(--color-warning)"},children:"$ Payroll"})]})]})]})},e.id))})})})]})}),E&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:A}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Absence Type"}),a.jsx("button",{onClick:A,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(O,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:a.jsx("div",{children:ba.map(e=>a.jsxs("button",{onClick:()=>T(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("span",{className:"text-xl flex-shrink-0 mt-0.5",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("div",{className:"text-sm text-left",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs px-2 py-1 rounded flex-shrink-0",style:{backgroundColor:"var(--color-warning-bg)",color:"var(--color-warning)"},children:"$ Payroll"})]})]})]},e.id))})})]})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(J,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Additional Notes"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional context or details about the absence"})]})]}),a.jsx("textarea",{value:g,onChange:e=>v(e.target.value),placeholder:"Optional additional context or details about the absence...",className:"unified-field-input",rows:3,maxLength:500}),a.jsxs("div",{className:"unified-field-hint",children:[g.length,"/500 characters"]})]}),q?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(Ce,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:"Payroll Impact Notice"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"This absence type may affect the employee's pay. HR will review and make appropriate adjustments."})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(i&&r&&o?.id&&M())try{b(!0),k(null);const e=ba.find(e=>e.id===d),a={organizationId:o.id,managerId:i.id,managerName:`${i.firstName} ${i.lastName}`,employeeId:r.id,employeeName:`${r.firstName} ${r.lastName}`,employeeNumber:r.employeeNumber||"",absenceDate:l,absenceType:d,reason:g.trim()||void 0,reportedDate:y.getServerTimestamp(),payrollImpact:e?.payrollImpact||!1,hrReviewed:!1,createdAt:y.getServerTimestamp(),updatedAt:y.getServerTimestamp()},s=Object.fromEntries(Object.entries(a).filter(([e,a])=>void 0!==a));await p.createDocument(o.id,"reports",s),j(!0),setTimeout(()=>{t()},2e3)}catch(a){e.error("Failed to submit absence report:",a),k("Failed to submit absence report. Please try again.")}finally{b(!1)}},disabled:!M()||f,className:"modal-footer__button modal-footer__button--primary "+(f?"modal-footer__button--loading":""),children:"Submit Report"})]})})]})}):null},ka=Object.freeze(Object.defineProperty({__proto__:null,UnifiedReportAbsence:wa},Symbol.toStringTag,{value:"Module"})),Na="corrective_counselling",ja="counselling_followups",Sa="notifications";class Ca{static async getActiveCounsellingForEmployee(a,s){try{const t=q(z(d,Na),$("organizationId","==",s),$("employeeId","==",a),$("status","in",["completed","follow_up_pending"]),F("dateCreated","desc")),i=await P(t),o=[];return i.forEach(e=>{const a=e.data(),s={id:e.id,...a};if(s.followUpDate){const e=new Date(s.followUpDate),a=new Date,t=Math.ceil((e.getTime()-a.getTime())/864e5);t>=-30&&t<=30&&!s.followUpCompleted&&o.push(s)}}),e.success(2097),o}catch(t){return e.error("❌ Error getting active counselling:",t),[]}}static async getDueFollowUps(a,s){try{const t=q(z(d,Na),$("organizationId","==",s),$("managerId","==",a),$("followUpCompleted","==",!1),F("followUpDate","asc")),i=await P(t),o=[],r=new Date;return i.forEach(e=>{const a=e.data(),s={id:e.id,...a};if(s.followUpDate){const e=new Date(s.followUpDate);Math.ceil((e.getTime()-r.getTime())/864e5)<=7&&o.push(s)}}),e.success(3568),o}catch(t){return e.error("❌ Error getting due follow-ups:",t),[]}}static async createFollowUp(a,s){try{e.success(3983);const t={...s,counsellingId:a,createdDate:y.getServerTimestamp()},i=await v.createDocument(ja,t);return await v.updateDocument(Na,a,{followUpCompleted:!0,improvementNoted:s.improvementObserved,lastUpdated:y.getServerTimestamp()}),e.success(4709),i}catch(t){throw e.error("❌ Error creating follow-up:",t),t}}static async getEmployeeCounsellingSummary(a,s){try{const t=q(z(d,Na),$("organizationId","==",s),$("employeeId","==",a),F("dateCreated","desc")),i=await P(t);if(i.empty)return null;const o=[];i.forEach(e=>{const a=e.data();o.push({id:e.id,...a})});const r=o[0],n=o.filter(e=>!e.followUpCompleted&&e.followUpDate).length,l=[...new Set(o.map(e=>e.category))];let c="no_data";if(o.length>=2){const e=o.slice(0,3).filter(e=>e.improvementNoted).length;c=e>=2?"improving":1===e?"stable":"declining"}let m="low";o.length>=5?m="high":o.length>=3&&(m="medium");const u={employeeId:a,employeeName:r.employeeName,totalSessions:o.length,lastSessionDate:r.dateCreated,pendingFollowUps:n,improvementTrend:c,commonCategories:l,escalationRisk:m};return e.success(7051),u}catch(t){return e.error("❌ Error getting counselling summary:",t),null}}static async createFollowUpNotification(a,s,t){try{const e={userId:a,organizationId:s,type:"counselling_followup_due",title:"Counselling Follow-up Due",message:`Follow-up required for ${t.employeeName} regarding ${t.category}`,data:{counsellingId:t.id,employeeId:t.employeeId,employeeName:t.employeeName,followUpDate:t.followUpDate},read:!1,createdAt:y.getServerTimestamp()};await v.createDocument(Sa,e)}catch(i){e.error("❌ Error creating follow-up notification:",i)}}static async getFollowUpRecords(a){try{const e=q(z(d,ja),$("counsellingId","==",a),F("createdDate","desc")),s=await P(e),t=[];return s.forEach(e=>{const a=e.data();t.push({id:e.id,...a})}),t}catch(s){return e.error("❌ Error getting follow-up records:",s),[]}}}const _a=({onSignatureChange:e,label:s,required:t=!1})=>{const i=C.useRef(null),[o,r]=C.useState(!1),[n,l]=C.useState(!1),c=()=>{if(o&&i.current){r(!1);const a=i.current.toDataURL();e(a)}};return _.useEffect(()=>{const e=i.current;if(!e)return;const a=e.getContext("2d");a&&(e.width=e.offsetWidth,e.height=e.offsetHeight,a.strokeStyle="#000",a.lineWidth=2,a.lineCap="round")},[]),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[s," ",t&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-white",children:[a.jsx("canvas",{ref:i,className:"w-full h-24 border border-dashed border-gray-400 rounded cursor-crosshair bg-gray-50",onMouseDown:e=>{const a=i.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(r(!0),t.beginPath(),t.moveTo(e.clientX-s.left,e.clientY-s.top))},onMouseMove:e=>{if(!o)return;const a=i.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(t.lineTo(e.clientX-s.left,e.clientY-s.top),t.stroke(),l(!0))},onMouseUp:c,onMouseLeave:c}),a.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[a.jsx("p",{className:"text-sm text-gray-500",children:n?"Signature captured":"Click and drag to sign above"}),a.jsxs("button",{type:"button",onClick:()=>{const a=i.current;if(!a)return;const s=a.getContext("2d");s&&(s.clearRect(0,0,a.width,a.height),l(!1),e(""))},className:"text-sm text-red-600 hover:text-red-800 flex items-center gap-1",disabled:!n,children:[a.jsx(Se,{className:"w-4 h-4"}),"Clear"]})]})]})]})},Da=({counsellingSession:s,onClose:t,onComplete:i})=>{D();const{user:o}=m(),{organization:r}=u(),[n,l]=C.useState(null),[c,d]=C.useState(""),[h,g]=C.useState(""),[x,p]=C.useState("continue_monitoring"),[y,v]=C.useState(""),[f,b]=C.useState(""),[w,k]=C.useState(""),[N,j]=C.useState(""),[S,_]=C.useState(""),[I,E]=C.useState(null),[z,R]=C.useState(!1),[T,L]=C.useState(!1),[A,M]=C.useState(null),[q,$]=C.useState("review"),F=e=>{j(e),e&&$("employee-decision")},P=e=>{E(e),e?R(!0):H()},U=e=>{_(e),e&&H()},H=async()=>{if(o&&o.organizationId)try{L(!0),M(null);const e={followUpDate:(new Date).toISOString(),improvementObserved:n||!1,improvementDetails:c.trim(),additionalConcerns:h.trim(),nextAction:x,nextActionDate:y||void 0,managerNotes:f.trim(),employeeFeedback:w.trim(),createdBy:o.id};await Ca.createFollowUp(s.id,e),$("complete"),setTimeout(()=>{i()},3e3)}catch(a){e.error("❌ Error submitting follow-up:",a),M("Failed to submit follow-up. Please try again.")}finally{L(!1)}};return"review"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(ee,{className:"w-8 h-8 text-green-600"}),"Counselling Follow-up Review"]}),a.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:a.jsx(O,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Review progress and document outcomes"})]}),A&&a.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-lg flex items-center gap-2",children:[a.jsx(fe,{className:"w-5 h-5 text-red-500"}),a.jsx("p",{className:"text-red-700",children:A})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsxs("h3",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[a.jsx(ke,{className:"w-5 h-5"}),"Original Counselling Session"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Employee:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:s.employeeName})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Date:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:new Date(s.dateCreated).toLocaleDateString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Category:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:s.category})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Type:"}),a.jsx("span",{className:"ml-2 text-blue-600 capitalize",children:s.counsellingType})]})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Issue:"}),a.jsx("p",{className:"text-blue-600 text-sm mt-1",children:s.issueDescription})]}),s.promisesToPerform.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Promises to Perform:"}),a.jsx("ul",{className:"text-blue-600 text-sm mt-1 space-y-1",children:s.promisesToPerform.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-blue-500",children:"•"}),a.jsxs("span",{children:[e.description," (Due: ",new Date(e.targetDate).toLocaleDateString(),")"]})]},s))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Has the employee shown improvement? *"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{type:"button",onClick:()=>l(!0),className:"px-6 py-3 rounded-lg border-2 transition-all "+(!0===n?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(Q,{className:"w-5 h-5 mx-auto mb-1"}),"Yes, Improvement Noted"]}),a.jsxs("button",{type:"button",onClick:()=>l(!1),className:"px-6 py-3 rounded-lg border-2 transition-all "+(!1===n?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(fe,{className:"w-5 h-5 mx-auto mb-1"}),"No, Concerns Remain"]})]})]}),null!==n&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n?"Improvement Details *":"Ongoing Concerns *"}),a.jsx("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:n?"Describe the specific improvements observed...":"Describe the ongoing concerns or lack of improvement...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/500 characters (minimum 10)"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Concerns or Notes"}),a.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Any additional concerns, observations, or context...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Recommended Next Action *"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>p("continue_monitoring"),className:"p-3 rounded-lg border-2 text-left transition-all "+("continue_monitoring"===x?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(B,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Continue Monitoring"}),a.jsx("div",{className:"text-sm opacity-70",children:"Keep observing progress"})]}),a.jsxs("button",{type:"button",onClick:()=>p("additional_training"),className:"p-3 rounded-lg border-2 text-left transition-all "+("additional_training"===x?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(ke,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Additional Training"}),a.jsx("div",{className:"text-sm opacity-70",children:"Provide more support"})]}),a.jsxs("button",{type:"button",onClick:()=>p("formal_warning"),className:"p-3 rounded-lg border-2 text-left transition-all "+("formal_warning"===x?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(fe,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Escalate to Formal Warning"}),a.jsx("div",{className:"text-sm opacity-70",children:"Begin formal discipline"})]}),a.jsxs("button",{type:"button",onClick:()=>p("no_further_action"),className:"p-3 rounded-lg border-2 text-left transition-all "+("no_further_action"===x?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(Q,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Close Successfully"}),a.jsx("div",{className:"text-sm opacity-70",children:"Issue resolved"})]})]})]}),"no_further_action"!==x&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Next Review Date *"}),a.jsx("input",{type:"date",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:(new Date).toISOString().split("T")[0],required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Notes *"}),a.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"Document your overall assessment and any specific observations...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[f.length,"/500 characters (minimum 10)"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee Feedback"}),a.jsx("textarea",{value:w,onChange:e=>k(e.target.value),placeholder:"Optional feedback from the employee during this review...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[a.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(_e,{className:"w-4 h-4"}),"Cancel"]}),a.jsxs("button",{type:"button",onClick:()=>$("manager-sign"),disabled:!(null!==n&&f.trim().length>=10&&(!1!==n||c.trim().length>=10)&&("no_further_action"===x||y)),className:"px-8 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continue to Signatures",a.jsx(Q,{className:"w-4 h-4"})]})]})]})]})}):"manager-sign"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[a.jsx(Ne,{className:"w-8 h-8 text-green-600"}),"Manager Signature Required"]}),a.jsx("div",{className:"mb-6",children:a.jsxs("p",{className:"text-gray-700 mb-4",children:["Please sign to confirm this follow-up review with"," ",a.jsx("strong",{children:s.employeeName}),"."]})}),a.jsx(_a,{onSignatureChange:F,label:"Manager Signature",required:!0}),a.jsx("div",{className:"flex justify-between mt-6",children:a.jsx("button",{type:"button",onClick:()=>$("review"),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Review"})})]})})}):"employee-decision"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(W,{className:"w-8 h-8 text-green-600"}),"Employee Acknowledgment"]}),a.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:a.jsx(O,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("p",{className:"text-gray-700 mb-4",children:["Please ask ",a.jsx("strong",{children:s.employeeName})," if they acknowledge this follow-up review and would like to provide their signature."]}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:a.jsxs("p",{className:"text-green-800 text-sm",children:[a.jsx("strong",{children:"Note:"})," Employee signature confirms they participated in this follow-up review."]})})]}),z?a.jsxs("div",{children:[a.jsx(_a,{onSignatureChange:U,label:"Employee Signature"}),a.jsxs("div",{className:"flex justify-between mt-6",children:[a.jsx("button",{type:"button",onClick:()=>R(!1),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Decision"}),a.jsx("button",{type:"button",onClick:()=>H(),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Skip Signature & Submit"})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-gray-700 font-medium",children:"Does the employee consent to sign?"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{onClick:()=>P(!0),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2",children:[a.jsx(Ne,{className:"w-4 h-4"}),"Yes, employee will sign"]}),a.jsxs("button",{onClick:()=>P(!1),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center gap-2",children:[a.jsx(O,{className:"w-4 h-4"}),"No, proceed without signature"]})]})]})]})})}):"complete"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:a.jsxs("div",{className:"p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Follow-up Review Completed"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["The follow-up review for ",s.employeeName," has been successfully documented and is available to HR for review."]}),a.jsx("button",{onClick:i,className:"w-full px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Return to Dashboard"}),a.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Redirecting automatically..."})]})})}):null},Ia=C.memo(({className:s=""})=>{const r=D(),{user:n}=m(),{organization:l,loading:d}=u(),{canCreateWarnings:h,canManageEmployees:g}=f(),{categories:p,employees:y,followUps:v,loading:_,isReady:I}=b({role:"hod"}),E={total:v?.length||0,overdue:v?.filter(e=>new Date(e.dueDate)<new Date).length||0,dueSoon:v?.filter(e=>{const a=new Date(e.dueDate),s=new Date,t=new Date(s.getTime()+2592e5);return a>=s&&a<=t}).length||0};(e=>{const[a,s]=C.useState(window.innerWidth>e),t=C.useCallback(()=>s(window.innerWidth>e),[e]);C.useEffect(()=>(window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)),[t])})(768);const[z,R]=C.useState(!1),[T,L]=C.useState(!1),[A,M]=C.useState(!1),[q,$]=C.useState(!1),[F,P]=C.useState(!1),[W,O]=C.useState(!1),[H,B]=C.useState(null),[V,G]=C.useState([]),[K,J]=C.useState(!1),[Z,Q]=C.useState(!1),ae=y||[],se=p||[],te=C.useMemo(()=>`${n?.firstName||""} ${n?.lastName||""}`.trim()||"Manager",[n?.firstName,n?.lastName]),oe=C.useMemo(()=>l?.name||"Your Organization",[l?.name]);C.useMemo(()=>0===ae.length||0===se.length?null:{employees:ae,categories:se,currentManagerName:te,organizationName:oe,key:`wizard-${l?.id}-${ae.length}-${se.length}`},[ae.length,se.length,te,oe,l?.id]),C.useEffect(()=>{!d&&p&&p.length>0&&(p.length,ae.length)},[d,p,l,ae]);const re=C.useCallback(async()=>{if(h()){if(I&&!_.overall)return 0===se.length?(e.error("❌ No warning categories configured"),void alert("Cannot issue warning: No warning categories are configured for this organization.")):0===ae.length?(e.warn("⚠️ No team members assigned"),void alert("You have no team members assigned to you as a manager.\n\nAs a Department Manager, you can only issue warnings to employees who report directly to you.\n\nPlease contact HR to have employees assigned to your team, or switch to the HR Dashboard view if you have HR permissions.")):void R(!0);e.warn("⚠️ Please wait for data to load...")}},[h,I,ae.length,se.length,_]),ne=C.useCallback(()=>{R(!1)},[]),le=C.useCallback(()=>{R(!1)},[]),de=C.useCallback(()=>{L(!0)},[]),me=C.useCallback(()=>{L(!1)},[]),ue=C.useCallback(()=>{M(!0)},[]),he=C.useCallback(()=>{M(!1)},[]),ge=C.useCallback(()=>{$(!0)},[]),xe=C.useCallback(()=>{$(!1)},[]),ye=C.useCallback(e=>{e.id,B(e),O(!0)},[]),ve=C.useCallback(()=>{O(!1),B(null)},[]),fe=C.useCallback(()=>{O(!1),B(null)},[]),be=C.useCallback(async()=>{if(l?.id&&!K){J(!0);try{let e;if(w()&&k()){e=(await N.getActiveWarningsIndex(l.id,100)).filter(e=>"high"===e.priority).map(e=>({...e.metadata,id:e.id,employeeId:e.employeeId,level:e.metadata.level,employeeName:e.metadata.employeeName}))}else if(w()&&j()){e=(await N.getOrganizationWarnings(l.id,{level:"final_written"},{pageSize:100,orderField:"issueDate",orderDirection:"desc"})).warnings}else e=await x.warnings.getAll(l.id);const a=await x.employees.getAll(l.id),s=e.filter(e=>"final_written"===e.level).map(e=>{const s=a.find(a=>a.id===e.employeeId);return{...e,employeeName:s?.name||`${s?.profile?.firstName||""} ${s?.profile?.lastName||""}`.trim()||"Unknown",employee:s}});s.sort((e,a)=>new Date(a.issueDate).getTime()-new Date(e.issueDate).getTime()),G(s)}catch(a){e.error("Failed to fetch final warning employees:",a)}finally{J(!1)}}},[l?.id]);C.useEffect(()=>{I&&ae.length>0&&be()},[I,ae.length,l?.id]);const we=[{id:"create-warning",title:"Issue Warning",icon:X,color:"orange",action:re,enabled:h(),hasAudioRecording:!0},{id:"book-hr-meeting",title:"HR Meeting",icon:De,color:"purple",action:ue,enabled:!0,hasAudioRecording:!1},{id:"report-absence",title:"Report Absence",icon:je,color:"red",action:ge,enabled:!0,hasAudioRecording:!1},{id:"corrective-counselling",title:"Counselling",icon:ke,color:"blue",action:de,enabled:!0,hasAudioRecording:!1}].filter(e=>e.enabled);return[{id:"team-performance",title:"Team Performance",description:"Review department performance metrics",icon:Y,color:"green",action:()=>r("/team/performance"),enabled:g()},{id:"schedule-review",title:"Schedule Reviews",description:"Plan performance reviews for team members",icon:ee,color:"blue",action:()=>r("/reviews/schedule"),enabled:g()},{id:"team-goals",title:"Team Goals",description:"Set and track overall department objectives",icon:Ie,color:"indigo",action:()=>r("/goals"),enabled:g()}].filter(e=>e.enabled),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:`space-y-4 ${s}`,children:[a.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 mb-3",children:we.map(e=>a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all duration-200 active:scale-95",onClick:e.action,style:{opacity:(_.overall||_.employees)&&"create-warning"===e.id?.5:1,background:"orange"===e.color?"linear-gradient(135deg, var(--color-warning), var(--color-warning))":"purple"===e.color?"linear-gradient(135deg, var(--color-accent), var(--color-accent))":"red"===e.color?"linear-gradient(135deg, var(--color-error), var(--color-error))":(e.color,"linear-gradient(135deg, var(--color-primary), var(--color-primary))"),color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:a.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(e.icon,{className:"w-5 h-5"}),e.hasAudioRecording&&a.jsx(pe,{className:"w-3.5 h-3.5 opacity-80"})]}),a.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:e.title}),(_.overall||_.employees)&&"create-warning"===e.id&&a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"})]})},e.id))}),a.jsx(i,{hover:!0,padding:"none",className:"mb-3 cursor-pointer transition-all duration-200 overflow-hidden active:scale-[0.98]",onClick:()=>P(!0),style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"64px",willChange:"transform"},children:a.jsxs("div",{className:"flex items-center justify-between p-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ce,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium text-sm",children:"Team Members"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[_.employees?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):a.jsx("span",{className:"text-2xl font-bold",children:ae.length}),a.jsx(ie,{className:"w-4 h-4 opacity-60"})]})]})}),E.total>0&&a.jsxs(i,{padding:"sm",children:[a.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),"Follow-ups Due (",E.due,")"]}),a.jsx("div",{className:"space-y-1",children:v.slice(0,3).map(e=>a.jsxs(o,{variant:"ghost",onClick:()=>ye(e),className:"w-full text-left p-2 text-sm",children:[a.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.employeeName}),a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.sessionType})]},e.id))})]}),V.length>0&&a.jsxs(c,{variant:"error",className:"border-2",children:[a.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>Q(!Z),children:[a.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[a.jsx(X,{className:"w-4 h-4"}),"Final Warnings Watch List (",V.length,")",a.jsx(t,{variant:"error",size:"sm",className:"animate-pulse hidden sm:inline-block",children:"MONITOR CLOSELY"})]}),a.jsx(U,{className:"w-4 h-4 transition-transform "+(Z?"rotate-180":""),style:{color:"var(--color-alert-error-text)"}})]}),Z&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-1.5 mt-3",children:V.map(e=>{let s,t;s=e.issueDate?.toDate?e.issueDate.toDate():e.issueDate?.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),t=e.expiryDate?.toDate?e.expiryDate.toDate():e.expiryDate?.seconds?new Date(1e3*e.expiryDate.seconds):new Date(e.expiryDate);const o=Math.floor((Date.now()-s.getTime())/864e5),r=Math.floor((t.getTime()-Date.now())/864e5);return a.jsx(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-alert-error-border)"},children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",style:{color:"var(--color-alert-error-text)"},children:e.employeeName}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)",opacity:.8},children:[e.category," • ",o," days ago"]}),a.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-alert-error-text)"},children:["⚠️ Next offense requires HR intervention • Expires in ",r," days"]})]})})},e.id||`${e.employeeId}-${e.categoryId||e.category}-${s.getTime()}`)})}),a.jsx(i,{padding:"sm",className:"mt-3",style:{backgroundColor:"var(--color-alert-error-bg)",opacity:.7},children:a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)"},children:["💡 ",a.jsx("strong",{children:"Tip:"})," Monitor these employees closely. Any new offenses will trigger urgent HR intervention alerts."]})})]})]}),K&&a.jsx(i,{padding:"md",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:"var(--color-primary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Loading final warnings watch list..."})]})})]}),z&&a.jsx(ua,{employees:ae,categories:se,currentManagerName:te,organizationName:oe,onComplete:ne,onCancel:le},"enhanced-warning-wizard"),T&&a.jsx(pa,{isOpen:T,onClose:me}),A&&a.jsx(va,{isOpen:A,onClose:he}),q&&a.jsx(wa,{isOpen:q,onClose:xe}),W&&H&&a.jsx(Da,{counsellingSession:H,onClose:ve,onComplete:fe}),F&&a.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:a.jsxs(i,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[a.jsxs("div",{className:"flex items-center justify-between p-6",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Team Management"}),a.jsx(o,{variant:"ghost",size:"sm",onClick:()=>P(!1),children:"×"})]}),a.jsx("div",{className:"overflow-y-auto",children:a.jsx(S,{})})]})})]})});Ia.displayName="HODDashboardSection";export{Da as C,ha as E,Ia as H,fa as U,xa as a,ka as b};
