import{j as e,L as s,u as a,r as t,v as r,N as l,A as i}from"./business-owner-dashboard-Dg0OWqpi.js";import{r as n}from"./react-vendor-CWjEGAcE.js";import{aC as d,L as o,aw as c,ao as m,aD as x,ah as g,D as u,N as p,U as h,w as b,i as y,I as j,b as v,f,J as N,a1 as w,a as D,aE as k,l as C,X as S,Z as A,aF as L,F as P,_ as R,a7 as E,a4 as I,M as T,aG as W,aH as F,a0 as U,ae as M,B as O,ab as $,aI as _,aJ as B,an as G,R as q,k as z,A as V,r as H,s as Y,g as Z,h as J}from"./ui-vendor-DTBvTbg1.js";import{P as K}from"./hr-dashboard-9ESM24bS.js";import"./pdf-vendor-tUwojRr6.js";import"./firebase-vendor-BQc9GSQK.js";import"./warning-components-Dg_cmQBg.js";const Q=e=>e?e.deleted?{status:"deleted",message:"This audio recording has been permanently deleted.",canPlay:!1}:e.autoDeleteDate&&new Date>new Date(e.autoDeleteDate)?{status:"expired",message:"This audio recording has expired and is no longer available.",canPlay:!1}:"processing"===e.processingStatus?{status:"processing",message:"Audio is still being processed. Please try again in a moment.",canPlay:!1}:"failed"===e.processingStatus?{status:"failed",message:"Audio processing failed. The recording may be corrupted.",canPlay:!1}:e.storageUrl||e.url?{status:"available",message:"Audio recording is ready to play.",canPlay:!0}:{status:"unavailable",message:"Audio URL is not available. The recording may not have been uploaded properly.",canPlay:!1}:{status:"not-available",message:"Audio recording not available.",canPlay:!1},X=({audioRecording:a,warningId:t,showDownload:r=!0,showMetadata:l=!0,showTranscript:i=!1,compact:w=!1,autoPlay:D=!1,className:k=""})=>{if(!a)return e.jsx("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 ${k}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(d,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"No audio recording available"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Audio recording not found or not provided"})]})]})});const C=n.useRef(null),S=n.useRef(null),[A,L]=n.useState({isLoading:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,error:null,buffered:0}),P=Q(a),R=(e=>Q(e).canPlay)(a),E=(e=>"deleted"===Q(e).status)(a),I=(e=>"expired"===Q(e).status)(a),T=a?.storageUrl||a?.url;n.useEffect(()=>{const e=C.current;if(!e||!R||!T)return void L(e=>({...e,isLoading:!1,error:R?"No audio URL available":P.message}));e.src=T;const a=()=>{L(e=>({...e,isLoading:!0,error:null}))},t=()=>{L(s=>({...s,duration:e.duration||0,isLoading:!1}))},r=()=>{L(s=>({...s,currentTime:e.currentTime||0}))},l=()=>{L(e=>({...e,isPlaying:!0}))},i=()=>{L(e=>({...e,isPlaying:!1}))},n=()=>{L(e=>({...e,isPlaying:!1,currentTime:0})),e&&(e.currentTime=0)},d=e=>{s.error("Audio loading error:",e),L(e=>({...e,isLoading:!1,isPlaying:!1,error:"Failed to load audio recording. The file may be corrupted or unavailable."}))},o=()=>{if(e.buffered.length>0){const s=e.buffered.end(e.buffered.length-1),a=e.duration||0;L(e=>({...e,buffered:a?s/a*100:0}))}};return e.addEventListener("loadstart",a),e.addEventListener("loadedmetadata",t),e.addEventListener("timeupdate",r),e.addEventListener("play",l),e.addEventListener("pause",i),e.addEventListener("ended",n),e.addEventListener("error",d),e.addEventListener("progress",o),e.load(),()=>{e.removeEventListener("loadstart",a),e.removeEventListener("loadedmetadata",t),e.removeEventListener("timeupdate",r),e.removeEventListener("play",l),e.removeEventListener("pause",i),e.removeEventListener("ended",n),e.removeEventListener("error",d),e.removeEventListener("progress",o)}},[R,T,P.message]),n.useEffect(()=>{D&&C.current&&!A.isLoading&&!A.error&&R&&C.current.play().catch(e=>s.warn("Audio autoplay failed",e))},[D,A.isLoading,A.error,R]);const W=n.useCallback(async()=>{const e=C.current;if(e&&R)try{A.isPlaying?e.pause():await e.play()}catch(a){s.error("Playback error:",a),L(e=>({...e,error:"Playback failed. Please try again."}))}},[A.isPlaying,R]),F=n.useCallback(e=>{const s=C.current;s&&R&&(s.currentTime=e)},[R]),U=n.useCallback(e=>{const s=C.current;s&&(s.volume=e,L(s=>({...s,volume:e,isMuted:0===e})))},[]),M=n.useCallback(()=>{const e=C.current;if(e){const s=!A.isMuted;e.muted=s,L(e=>({...e,isMuted:s}))}},[A.isMuted]),O=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`};return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${k}`,children:[R&&T&&e.jsx("audio",{ref:C,preload:"metadata"}),E?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(f,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Audio Recording Deleted"}),e.jsx("p",{className:"text-red-600 text-sm",children:P.message})]})]}):I?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(v,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium",children:"Audio Recording Expired"}),e.jsx("p",{className:"text-yellow-600 text-sm",children:P.message})]})]}):"processing"===P.status?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(o,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"Processing Audio"}),e.jsx("p",{className:"text-blue-600 text-sm",children:P.message})]})]}):"failed"===P.status||"unavailable"===P.status?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(N,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Audio Unavailable"}),e.jsx("p",{className:"text-red-600 text-sm",children:P.message})]})]}):null,R&&!A.error&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:W,disabled:A.isLoading,className:"flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",title:A.isPlaying?"Pause":"Play",children:A.isLoading?e.jsx(o,{className:"w-5 h-5 animate-spin"}):A.isPlaying?e.jsx(c,{className:"w-5 h-5"}):e.jsx(m,{className:"w-5 h-5 ml-1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{ref:S,className:"relative h-2 bg-gray-200 rounded-full cursor-pointer",onClick:e=>{if(S.current&&A.duration){const s=S.current.getBoundingClientRect(),a=(e.clientX-s.left)/s.width;F(a*A.duration)}},children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 rounded-full",style:{width:`${A.buffered}%`}}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full",style:{width:A.duration?A.currentTime/A.duration*100+"%":"0%"}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:O(A.currentTime)}),e.jsx("span",{children:O(A.duration)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:M,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:A.isMuted?"Unmute":"Mute",children:A.isMuted?e.jsx(x,{className:"w-4 h-4"}):e.jsx(g,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:A.isMuted?0:A.volume,onChange:e=>U(parseFloat(e.target.value)),className:"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Volume"})]}),r&&T&&e.jsx("button",{onClick:()=>{const e=document.createElement("a");e.href=T,e.download=`warning-audio-${a.recordingId||"recording"}.webm`,e.click()},className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Download Audio",children:e.jsx(u,{className:"w-4 h-4"})})]})}),l&&!w&&R&&!A.error&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),"Duration"]}),e.jsx("p",{className:"font-medium",children:O(a.duration||0)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(d,{className:"w-3 h-3"}),"Quality"]}),e.jsx("p",{className:"font-medium",children:($=a.bitrate,$?$>=32e3?"High":$>=16e3?"Standard":"Basic":"Unknown")})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(h,{className:"w-3 h-3"}),"Recorded By"]}),e.jsx("p",{className:"font-medium",children:a.recordedByName||"Manager"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),"Recorded"]}),e.jsx("p",{className:"font-medium",children:a.startTime?new Date(a.startTime).toLocaleDateString():"Unknown"})]})]}),a.consentGiven&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-green-700 bg-green-50 px-3 py-2 rounded-lg",children:[e.jsx(y,{className:"w-3 h-3"}),e.jsx("span",{children:"Recording consent was obtained from all participants"})]}),a.autoDeleteDate&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-lg",children:[e.jsx(j,{className:"w-3 h-3"}),e.jsxs("span",{children:["This recording will be automatically deleted on"," ",new Date(a.autoDeleteDate).toLocaleDateString()]})]})]}),A.error&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:A.error})]})})]});var $},ee=({signature:a,title:t,subtitle:r,isOpen:l,onClose:i,allowDownload:d=!0})=>{const o=n.useCallback(()=>{try{const e=atob(a.split(",")[1]),s=new Array(e.length);for(let a=0;a<e.length;a++)s[a]=e.charCodeAt(a);const r=new Uint8Array(s),l=new Blob([r],{type:"image/png"}),i=URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.download=`${t.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}catch(e){s.error("Signature download failed:",e)}},[a,t]),c=n.useCallback(async()=>{try{await navigator.clipboard.writeText(a)}catch(e){s.error("Failed to copy signature:",e)}},[a]);return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),r&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:r})]}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:e.jsx("img",{src:a,alt:t,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:c,className:"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"Copy Data"]}),d&&e.jsxs("button",{onClick:o,className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Download"]})]})]})]})}):null},se=({signatures:s,warningId:a,showTimestamps:t=!0,compact:r=!1,showVerification:l=!0,allowDownload:i=!0,className:d=""})=>{const[o,c]=n.useState(null),m=e=>{if(!e)return!1;try{return e.startsWith("data:image/")&&e.includes("base64,")}catch{return!1}},x=m(s.manager),g=m(s.employee),f=x&&g,N=n.useCallback((e,s,a)=>{c({signature:e,title:s,subtitle:a})},[]),S=n.useCallback(()=>{c(null)},[]),A=e=>{if(!e)return"Not signed";try{return new Date(e).toLocaleString()}catch{return"Invalid timestamp"}},L=f?{status:"complete",message:"Document fully signed",color:"text-green-600 bg-green-50 border-green-200",icon:D}:x||g?{status:"partial",message:"Signatures pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:p}:{status:"missing",message:"No signatures collected",color:"text-gray-600 bg-gray-50 border-gray-200",icon:v},P=L.icon;return r?e.jsxs("div",{className:`inline-flex items-center gap-2 ${d}`,children:[e.jsx(P,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:f?"✓ Signed":"⏳ Pending"}),f&&e.jsx("button",{onClick:()=>N(s.manager,"Digital Signatures","Manager and Employee"),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View"})]}):e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${d}`,children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(w,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Electronic authorization and acknowledgment"})]})]}),l&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${L.color}`,children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:L.message})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Manager"}),x&&e.jsx(D,{className:"w-4 h-4 text-green-500"})]}),x&&e.jsx("button",{onClick:()=>N(s.manager,"Manager Signature",s.managerName||"Warning Issuer"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:e.jsx(k,{className:"w-4 h-4 text-gray-500"})})]}),x?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:e.jsx("img",{src:s.manager,alt:"Manager Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{children:s.managerName||"Manager"})]}),t&&s.managerTimestamp&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:A(s.managerTimestamp)})]})]})]}):e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(h,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting manager signature"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Employee"}),g&&e.jsx(D,{className:"w-4 h-4 text-green-500"})]}),g&&e.jsx("button",{onClick:()=>N(s.employee,"Employee Signature",s.employeeName||"Warning Recipient"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:e.jsx(k,{className:"w-4 h-4 text-gray-500"})})]}),g?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:e.jsx("img",{src:s.employee,alt:"Employee Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{children:s.employeeName||"Employee"})]}),t&&s.employeeTimestamp&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:A(s.employeeTimestamp)})]})]})]}):e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(C,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting employee acknowledgment"})]})]})]})}),f&&e.jsx("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Document Digitally Signed & Verified"}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["These digital signatures are legally binding and comply with electronic signature regulations.",a&&` Document ID: ${a}`]})]}),i&&e.jsx("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download signatures",children:e.jsx(u,{className:"w-4 h-4"})})]})}),!f&&(x||g)&&e.jsx("div",{className:"bg-yellow-50 border-t border-yellow-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Signature Collection In Progress"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Document requires signatures from both manager and employee to be legally complete."})]})]})}),o&&e.jsx(ee,{signature:o.signature,title:o.title,subtitle:o.subtitle,isOpen:!0,onClose:S,allowDownload:i})]})},ae=(e,s="Not specified")=>null==e?s:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":s,te=(e,s="Not set")=>{if(!e)return s;try{return(e instanceof Date?e:new Date(e)).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return s}},re=(e,s)=>{const a=te(e,"");return a&&"Not set"!==a?s?`${a} at ${s}`:a:"Not specified"},le=(e,s)=>{const a={verbal:{primary:"bg-blue-600",secondary:"bg-blue-50",accent:"text-blue-600",background:"bg-blue-50",text:"text-blue-800",border:"border-blue-200"},written:{primary:"bg-yellow-600",secondary:"bg-yellow-50",accent:"text-yellow-600",background:"bg-yellow-50",text:"text-yellow-800",border:"border-amber-200"},final:{primary:"bg-red-600",secondary:"bg-red-50",accent:"text-red-600",background:"bg-red-50",text:"text-red-800",border:"border-red-200"},dismissal:{primary:"bg-red-700",secondary:"bg-red-50",accent:"text-red-700",background:"bg-red-50",text:"text-red-900",border:"border-red-300"}};return a[e]||a.verbal},ie=({warning:a,isOpen:t,onClose:r,canTakeAction:l=!1,userRole:i="viewer",className:d="",onApprove:o,onReject:c,onAppealOutcome:m,canManageAppeals:x=!1})=>{const[g,b]=n.useState("overview"),[j,v]=n.useState(new Set(["summary"])),[f,N]=n.useState({type:null,loading:!1}),[D,k]=n.useState(!1),[C,A]=n.useState(""),[E,I]=n.useState(!1),[T,W]=n.useState(!1),[F,U]=n.useState(!1),[M,O]=n.useState(!1),[$,_]=n.useState(!1),[B,G]=n.useState(null),[q,z]=n.useState(!1),[V,H]=n.useState(null),[Y,Z]=n.useState(""),[J,Q]=n.useState(!1),ee=n.useRef(null),ie=n.useRef(null),ne=n.useMemo(()=>a?{id:a.id||"",employeeName:ae(a.employeeName),employeeNumber:ae(a.employeeNumber),department:ae(a.department),position:ae(a.position),category:ae(a.category),level:a.level||"verbal",status:a.status||"issued",incidentDate:te(a.incidentDate),incidentTime:ae(a.incidentTime),incidentDateTime:re(a.incidentDate,a.incidentTime),incidentLocation:ae(a.incidentLocation),description:ae(a.description),issueDate:te(a.issueDate),expiryDate:te(a.expiryDate),issuedByName:ae(a.issuedByName),deliveryMethod:ae(a.deliveryMethod),additionalNotes:ae(a.additionalNotes),hasAudio:Boolean(a.audioRecording?.url),audioRecording:a.audioRecording||null,hasPDF:Boolean(a.pdfGenerated||a.pdfFilename),hasSignatures:Boolean(a.signatures&&Object.keys(a.signatures).length>0),signatures:a.signatures||{manager:null,employee:null},validityPeriod:a.validityPeriod||6,escalationReason:ae(a.escalationReason),acknowledgedAt:a.acknowledgedAt?te(a.acknowledgedAt):null,acknowledgedBy:ae(a.acknowledgedBy),appealSubmitted:Boolean(a.appealSubmitted),appealDate:a.appealDate?te(a.appealDate):null,createdAt:te(a.createdAt),updatedAt:te(a.updatedAt)}:null,[a]),de=n.useMemo(()=>ne?le(ne.level,ne.status):le("verbal"),[ne]),oe=n.useCallback(()=>{I(!0),setTimeout(()=>{r(),I(!1),b("overview"),v(new Set(["summary"])),N({type:null,loading:!1}),k(!1),A(""),U(!1),O(!1),_(!1),G(null)},300)},[r]);n.useCallback(e=>{v(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},[]);const ce=n.useCallback(async()=>{if(o&&ne?.id){N({type:"approve",loading:!0});try{await o(ne.id),setTimeout(oe,1e3)}catch(e){s.error("Failed to approve warning:",e),N({type:null,loading:!1})}}},[o,ne?.id,oe]),me=n.useCallback(async()=>{if(c&&ne?.id){N({type:"reject",loading:!0});try{await c(ne.id,C),setTimeout(oe,1e3)}catch(e){s.error("Failed to reject warning:",e),N({type:null,loading:!1})}}},[c,ne?.id,C,oe]),xe=n.useCallback(()=>{k(!0)},[]),ge=n.useCallback(()=>{ne?.hasAudio&&_(!0)},[ne?.hasAudio]),ue=n.useCallback(()=>{U(!0)},[]),pe=n.useCallback(()=>{ne?.hasSignatures&&O(!0)},[ne?.hasSignatures]),he=n.useCallback(e=>{if(!ne?.signatures)return;const s=ne.signatures[e];s&&(G({signature:s,title:`${e.charAt(0).toUpperCase()+e.slice(1)} Signature`,subtitle:`Warning ID: ${ne.id} • ${ne.employeeName}`}),O(!0))},[ne]);return t&&ne?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:ie,className:`\n          fixed inset-0 z-40 flex items-center justify-center p-4\n          bg-black/60 backdrop-blur-xl\n          transition-all duration-500 ease-out\n          ${E?"opacity-0":"opacity-100"}\n          ${d}\n        `,onClick:e=>e.target===ie.current&&oe(),children:e.jsxs("div",{ref:ee,className:`\n            relative w-full max-w-4xl max-h-[90vh] \n            bg-white rounded-lg shadow-xl border border-gray-200\n            overflow-hidden\n            transition-all duration-300 ease-out\n            ${E?"scale-95 opacity-0":"scale-100 opacity-100"}\n          `,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`\n                w-10 h-10 rounded-lg ${de.primary}\n                flex items-center justify-center\n              `,children:e.jsx(y,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[ne.employeeName," • ",ne.category]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium rounded-full "+("verbal"===ne.level?"bg-blue-100 text-blue-800":"written"===ne.level?"bg-yellow-100 text-yellow-800":"final"===ne.level?"bg-red-100 text-red-800":"dismissal"===ne.level?"bg-red-200 text-red-900":"bg-gray-100 text-gray-800"),children:"verbal"===ne.level?"Verbal Warning":"written"===ne.level?"Written Warning":"final"===ne.level?"Final Warning":"dismissal"===ne.level?"Dismissal":"Warning"}),e.jsx("button",{onClick:oe,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Incident Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:ne.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:ne.incidentDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Location:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:ne.incidentLocation})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-gray-600"}),"Employee Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.employeeName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.employeeNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Position:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.position})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Department:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.department})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-gray-600"}),"Warning Timeline"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.issueDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.expiryDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Issued By:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ne.issuedByName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:"font-medium "+("delivered"===ne.deliveryStatus?"text-green-600":"text-orange-600"),children:"delivered"===ne.deliveryStatus?"Delivered":"Pending Delivery"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[ne.hasAudio&&e.jsxs("button",{onClick:ge,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",children:[e.jsx(L,{className:"w-4 h-4"}),"Audio Recording"]}),e.jsxs("button",{onClick:ue,className:"flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm",children:[e.jsx(P,{className:"w-4 h-4"}),"View PDF"]}),ne.hasSignatures&&e.jsxs("button",{onClick:pe,className:"flex items-center gap-2 px-3 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm",children:[e.jsx(w,{className:"w-4 h-4"}),"Signatures"]})]}),l&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:xe,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"Reject"}),e.jsx("button",{onClick:ce,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Approve"})]})]})]})}),D&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reject Warning"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please provide a reason for rejecting this warning:"}),e.jsx("textarea",{value:C,onChange:e=>A(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Enter rejection reason..."}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>k(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 font-medium transition-colors text-sm",children:"Cancel"}),e.jsx("button",{onClick:me,disabled:!C.trim()||f.loading,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 font-medium transition-colors text-sm",children:f.loading?"Processing...":"Reject Warning"})]})]})})]})}),$&&ne?.hasAudio&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),e.jsx("button",{onClick:()=>_(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(X,{audioData:ne.audioRecording,compact:!1})})]})}),M&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("button",{onClick:()=>O(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:ne?.hasSignatures?e.jsxs("div",{className:"space-y-4",children:[ne.signatures?.manager&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Manager Signature"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:e.jsx("img",{src:ne.signatures.manager,alt:"Manager Signature",className:"max-w-full h-20 mx-auto"})})]}),ne.signatures?.employee&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Employee Signature"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:e.jsx("img",{src:ne.signatures.employee,alt:"Employee Signature",className:"max-w-full h-20 mx-auto"})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),e.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),F&&e.jsx(K,{isOpen:F,onClose:()=>U(!1),warningData:{selectedEmployee:{id:a.employeeId||"",firstName:a.employeeName||"Unknown",lastName:a.employeeLastName||"Employee",employeeId:a.employeeNumber||"",employeeNumber:a.employeeNumber||"",department:a.employeeDepartment||a.department||"",position:a.employeePosition||a.position||"",email:a.employeeEmail||""},selectedCategory:{id:a.categoryId||"",name:a.categoryName||a.category||"General",severity:"medium",description:a.categoryName||a.category||"General"},formData:{incidentDate:a.incidentDate?.toISOString?.()?.split("T")[0]||(new Date).toISOString().split("T")[0],incidentTime:a.incidentTime||"12:00",incidentLocation:a.incidentLocation||"",incidentDescription:a.incidentDescription||a.description||"",additionalNotes:a.additionalNotes||"",validityPeriod:a.validityPeriod||6,issueDate:a.issueDate?.toISOString?.()?.split("T")[0]||(new Date).toISOString().split("T")[0]},signatures:a.signatures||{manager:null,employee:null},lraRecommendation:{category:a.categoryName||a.category||"General",recommendedLevel:a.level||"Counselling Session",suggestedLevel:a.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:a.organizationId||""},onPDFGenerated:(e,s)=>{const a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download=s,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a)}}),F&&e.jsx(K,{isOpen:F,onClose:()=>U(!1),warningData:{selectedEmployee:{id:a.employeeId||"",firstName:a.employeeName||"Unknown",lastName:a.employeeLastName||"Employee",employeeId:a.employeeNumber||"",employeeNumber:a.employeeNumber||"",department:a.employeeDepartment||a.department||"",position:a.employeePosition||a.position||"",email:a.employeeEmail||""},selectedCategory:{id:a.categoryId||"",name:a.categoryName||a.category||"General",severity:"medium",description:a.categoryName||a.category||"General"},formData:{incidentDate:a.incidentDate?.toISOString?.()?.split("T")[0]||(new Date).toISOString().split("T")[0],incidentTime:a.incidentTime||"12:00",incidentLocation:a.incidentLocation||"",incidentDescription:a.incidentDescription||a.description||"",additionalNotes:a.additionalNotes||"",validityPeriod:a.validityPeriod||6,issueDate:a.issueDate?.toISOString?.()?.split("T")[0]||(new Date).toISOString().split("T")[0]},signatures:a.signatures||{manager:null,employee:null},lraRecommendation:{category:a.categoryName||a.category||"General",recommendedLevel:a.level||"Counselling Session",suggestedLevel:a.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:a.organizationId||""},onPDFGenerated:(e,s)=>{a.categoryName,a.category,a.signatures;const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}),$&&ne?.hasAudio&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",ne.id," • ",ne.employeeName]})]}),e.jsx("button",{onClick:()=>_(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(X,{audioRecording:ne.audioRecording,warningId:ne.id,showDownload:!0,showMetadata:!0,className:"w-full"})})]})}),M&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",ne.id," • ",ne.employeeName]})]}),e.jsx("button",{onClick:()=>O(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:ne?.hasSignatures?e.jsxs(e.Fragment,{children:[e.jsx(se,{signatures:ne.signatures,warningId:ne.id,showTimestamps:!0,showVerification:!0,allowDownload:!0,className:"w-full mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[ne.signatures.manager&&e.jsxs("button",{onClick:()=>he("manager"),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(R,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"View Manager Signature"})]}),ne.signatures.employee&&e.jsxs("button",{onClick:()=>he("employee"),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[e.jsx(R,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"View Employee Signature"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),e.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),B&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:B.title}),B.subtitle&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:B.subtitle})]}),e.jsx("button",{onClick:()=>G(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:e.jsx("img",{src:B.signature,alt:B.title,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),e.jsxs("button",{onClick:()=>{const e=document.createElement("a");e.href=B.signature,e.download=`${B.title.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Download PNG"]})]})]})})]}):null},ne={email:{icon:T,name:"Email",color:"blue",requiresProof:!0,instructions:["Send the warning document via email","Take a screenshot of the sent email","Include timestamp and recipient email visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Chrome: Press Ctrl + Shift + Alt + 3"]},whatsapp:{icon:I,name:"WhatsApp Business",color:"green",requiresProof:!0,instructions:["Send the warning document via WhatsApp Business","Wait for delivery confirmation (double blue ticks)","Take a screenshot showing the sent message","Include timestamp and delivery status visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Phone: Use screenshot function (varies by device)"]},printed:{icon:E,name:"Print & Hand Delivery",color:"purple",requiresProof:!1,instructions:["Print the warning document","Hand deliver to the employee","Get employee acknowledgment signature on physical copy","File the signed copy in employee records","Confirm delivery completion below"]}},de=({isOpen:s,onClose:a,warningId:t,employeeName:r,deliveryMethod:l,onDeliveryConfirmed:i})=>{const[d,c]=n.useState(null),[m,x]=n.useState(null),[g,u]=n.useState(!1),[p,h]=n.useState(null),b=n.useRef(null),y=ne[l],j=n.useCallback(e=>{const s=e.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/"))return void h("Please select an image file (PNG, JPG, etc.)");if(s.size>5242880)return void h("Image must be less than 5MB");h(null),c(s);const a=new FileReader;a.onload=e=>{x(e.target?.result)},a.readAsDataURL(s)},[]),f=n.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),N=n.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=e.dataTransfer.files;if(s.length>0){const e=s[0];if(e.type.startsWith("image/")){j({target:{files:[e]}})}}},[j]),w=n.useCallback(async()=>{if(!y.requiresProof||d){u(!0),h(null);try{await i({warningId:t,deliveryMethod:l,deliveredAt:new Date,proofImage:d||void 0})}catch(e){h(e instanceof Error?e.message:"Failed to confirm delivery")}finally{u(!1)}}else h("Please upload proof of delivery screenshot")},[y.requiresProof,d,i,t,l]),k=n.useCallback(()=>{c(null),x(null),b.current&&(b.current.value="")},[]);if(!s)return null;const C=y.icon;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:`bg-gradient-to-r from-${y.color}-600 to-${y.color}-700 p-6 text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(C,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Confirm Delivery"}),e.jsxs("p",{className:"text-sm opacity-90",children:[y.name," delivery for ",r]})]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(S,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Delivery Instructions"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("ol",{className:"space-y-2",children:y.instructions.map((s,a)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[e.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:a+1}),e.jsx("span",{className:"text-gray-700",children:s})]},a))})})]}),y.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-600"}),"Screenshot Instructions"]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:y.screenshotTips?.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("kbd",{className:"bg-gray-200 px-2 py-1 rounded text-xs font-mono",children:s.split(": ")[1]}),e.jsx("span",{className:"text-xs",children:s.split(": ")[0]})]},a))})})]}),y.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Upload Proof of Delivery"}),d?e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[m&&e.jsx("img",{src:m,alt:"Proof of delivery",className:"w-24 h-24 object-cover rounded-lg border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:k,className:"text-red-600 hover:text-red-700 p-1",children:e.jsx(S,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(D,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Ready to upload"})]})]})]})}):e.jsxs("div",{onDragOver:f,onDrop:N,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onClick:()=>b.current?.click(),children:[e.jsx(F,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Drop screenshot here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG up to 5MB"}),e.jsx("input",{ref:b,type:"file",accept:"image/*",onChange:j,className:"hidden"})]})]}),p&&e.jsx("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:p})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:a,disabled:g,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:g||y.requiresProof&&!d,className:`flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-${y.color}-600 to-${y.color}-700 hover:from-${y.color}-700 hover:to-${y.color}-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 animate-spin"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4"}),"Confirm Delivery"]})})]})]})]})})},oe=[{value:"procedural_unfair",label:"Procedural Unfairness",description:"The disciplinary process was not followed correctly"},{value:"substantive_unfair",label:"Substantive Unfairness",description:"The warning was not justified by the facts"},{value:"bias_prejudice",label:"Bias or Prejudice",description:"The decision was influenced by bias or unfair treatment"},{value:"insufficient_evidence",label:"Insufficient Evidence",description:"Not enough evidence to support the warning"},{value:"inconsistent_treatment",label:"Inconsistent Treatment",description:"Others were treated differently for similar conduct"},{value:"other",label:"Other Grounds",description:"Different reason (explain in details below)"}],ce=({isOpen:s,onClose:a,warning:t,onAppealSubmit:r})=>{const[l,i]=n.useState(""),[d,c]=n.useState(""),[m,x]=n.useState(""),[g,u]=n.useState(!1),[p,y]=n.useState(null),f=t.issueDate?.seconds?new Date(1e3*t.issueDate.seconds):new Date(t.issueDate),N=new Date(f);N.setDate(N.getDate()+30);const w=n.useCallback(async()=>{if(l)if(d.trim())if(m.trim()){u(!0),y(null);try{await r({warningId:t.id,grounds:l,additionalDetails:d.trim(),requestedOutcome:m.trim()})}catch(e){y(e instanceof Error?e.message:"Failed to submit appeal")}finally{u(!1)}}else y("Please specify what outcome you are requesting");else y("Please provide details explaining your appeal");else y("Please select grounds for your appeal")},[l,d,m,r,t.id]);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-600 to-orange-700 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Appeal Disciplinary Warning"}),e.jsx("p",{className:"text-sm opacity-90",children:"Submit formal appeal as per Labour Relations Act"})]})]}),e.jsx("button",{onClick:a,disabled:g,className:"p-2 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(S,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Employee:"}),e.jsx("div",{className:"font-medium",children:t.employeeName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Warning Level:"}),e.jsx("div",{className:"font-medium capitalize",children:t.level.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("div",{className:"font-medium",children:t.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("div",{className:"font-medium",children:f.toLocaleDateString()})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Description:"}),e.jsx("div",{className:"text-sm mt-1 p-2 bg-white rounded border",children:t.description})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-800 font-medium mb-2",children:"Your Appeal Rights"}),e.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs",children:[e.jsxs("li",{children:["• Appeals must be submitted within ",e.jsx("strong",{children:"30 days"})," of the warning (deadline: ",N.toLocaleDateString(),")"]}),e.jsx("li",{children:"• You have the right to fair treatment under the Labour Relations Act"}),e.jsx("li",{children:"• All internal procedures must be exhausted before CCMA referral"}),e.jsx("li",{children:"• You may be assisted by a shop steward or fellow employee"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Grounds for Appeal *"}),e.jsx("div",{className:"space-y-2",children:oe.map(s=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"appealGrounds",value:s.value,checked:l===s.value,onChange:e=>i(e.target.value),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]})]},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Appeal Details *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Explain in detail why you believe the warning is unfair and what evidence supports your appeal."}),e.jsx("textarea",{value:d,onChange:e=>c(e.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"Provide specific facts, dates, witnesses, and any other relevant information that supports your appeal..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Requested Outcome *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Specify what you would like to happen if your appeal is successful."}),e.jsx("textarea",{value:m,onChange:e=>x(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"E.g., 'Remove warning from my record', 'Reduce warning level', 'Replace with verbal counselling', etc."})]})]}),p&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:p})]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsxs("span",{children:["Appeal deadline: ",N.toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:a,disabled:g,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:g||!l||!d.trim()||!m.trim(),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-600 to-orange-700 hover:from-amber-700 hover:to-orange-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4 animate-spin"}),"Submitting Appeal..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4"}),"Submit Appeal"]})})]})]})]})}):null},me=[{value:"upheld",label:"Uphold Warning",icon:y,color:"text-green-600",bgColor:"bg-green-50",description:"Warning is justified and remains unchanged"},{value:"reduced",label:"Reduce Warning Level",icon:B,color:"text-orange-600",bgColor:"bg-orange-50",description:"Warning is justified but level should be reduced"},{value:"modified",label:"Modify Warning",icon:G,color:"text-blue-600",bgColor:"bg-blue-50",description:"Warning content needs modification"},{value:"overturned",label:"Overturn Warning",icon:q,color:"text-red-600",bgColor:"bg-red-50",description:"Warning is not justified and should be removed"}],xe=[{value:"counselling",label:"Counselling",severity:1},{value:"verbal",label:"Verbal Warning",severity:2},{value:"first_written",label:"First Written Warning",severity:3},{value:"second_written",label:"Second Written Warning",severity:4},{value:"final_written",label:"Final Written Warning",severity:5}],ge={procedural_unfair:"Procedural Unfairness",substantive_unfair:"Substantive Unfairness",bias_prejudice:"Bias or Prejudice",insufficient_evidence:"Insufficient Evidence",inconsistent_treatment:"Inconsistent Treatment",other:"Other Grounds"},ue=({isOpen:a,onClose:t,warning:r,onDecisionSubmit:l})=>{const[i,d]=n.useState(""),[o,c]=n.useState(""),[m,x]=n.useState(""),[g,u]=n.useState(r.level),[p,y]=n.useState(r.description),[v,f]=n.useState(!1),[N,w]=n.useState(""),[D,k]=n.useState(!1),C=e=>{if(!e)return"Unknown";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})},A=n.useCallback(async()=>{if(i&&o.trim()){k(!0);try{await l({warningId:r.id,decision:i,reasoning:o.trim(),newLevel:"reduced"===i||"modified"===i?g:void 0,newDescription:"modified"===i?p:void 0,hrNotes:m.trim(),followUpRequired:v,followUpDate:v&&N?new Date(N):void 0}),t()}catch(e){s.error("Failed to submit appeal decision:",e),alert("Failed to submit decision. Please try again.")}finally{k(!1)}}else alert("Please select a decision and provide reasoning.")},[i,o,m,g,p,v,N,r.id,l,t]),L=xe.find(e=>e.value===r.level)?.severity||0,R=xe.filter(e=>e.severity<L);return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Appeal Review"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review and decide on employee appeal"})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-gray-600"}),"Original Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Employee:"}),e.jsxs("span",{className:"text-sm",children:[r.employeeName," (",r.employeeNumber,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Department:"}),e.jsx("span",{className:"text-sm",children:r.department})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Issue Date:"}),e.jsx("span",{className:"text-sm",children:C(r.issueDate)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Category:"}),e.jsx("span",{className:"text-sm ml-2",children:r.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Level:"}),e.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full "+("final_written"===r.level?"bg-red-100 text-red-800":"second_written"===r.level?"bg-orange-100 text-orange-800":"first_written"===r.level?"bg-yellow-100 text-yellow-800":"verbal"===r.level?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:xe.find(e=>e.value===r.level)?.label||r.level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Description:"}),e.jsx("p",{className:"text-sm mt-1 text-gray-700",children:r.description})]})]})]})]}),r.appealDetails&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-blue-600"}),"Employee's Appeal"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Appeal Grounds:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:ge[r.appealDetails.grounds]||r.appealDetails.grounds})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee's Statement:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:r.appealDetails.additionalDetails})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Outcome:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:r.appealDetails.requestedOutcome})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[e.jsxs("span",{children:["Submitted: ",C(r.appealDetails.submittedDate)]}),e.jsxs("span",{children:["By: ",r.appealDetails.submittedBy]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-gray-600"}),"HR Decision"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:me.map(s=>{const a=s.icon;return e.jsx("button",{onClick:()=>d(s.value),className:"p-4 rounded-lg border-2 transition-all "+(i===s.value?`border-purple-500 ${s.bgColor}`:"border-gray-200 hover:border-gray-300"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a,{className:`w-5 h-5 ${s.color}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-sm",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]})]})},s.value)})}),("reduced"===i||"modified"===i)&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"reduced"===i?"Reduce to Level:":"New Warning Level:"}),e.jsx("select",{value:g,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:"reduced"===i?R.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value)):xe.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),"modified"===i&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modified Warning Description:"}),e.jsx("textarea",{value:p,onChange:e=>y(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Enter the modified warning description..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Decision Reasoning (Legal Documentation)"]}),e.jsx("textarea",{value:o,onChange:e=>c(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Provide detailed reasoning for your decision. This will be part of the legal record and may be reviewed by labor courts or CCMA...",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Internal Notes (Optional)"}),e.jsx("textarea",{value:m,onChange:e=>x(e.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Internal notes for HR records (not shared with employee)..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:e=>f(e.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Follow-up Required"})]}),v&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date:"}),e.jsx("input",{type:"date",value:N,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"This decision will be automatically documented and employee will be notified"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:!i||!o.trim()||D,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors flex items-center gap-2",children:D?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-4 h-4"}),"Submit Decision"]})})]})]})]})}):null},pe=(e,s="Unknown")=>null==e?s:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":e instanceof Date?e.toLocaleDateString():"object"==typeof e?e.name?String(e.name):e.title?String(e.title):e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:s:String(e),he=e=>{if(!e.issueDate)return!1;const s=e.issueDate.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),a=new Date(s);a.setDate(a.getDate()+30);return new Date<=a},be=({organizationId:d,onClose:o,PDFGenerationService:c,DataService:m,canTakeAction:x=!1,userRole:g="viewer",initialEmployeeFilter:u})=>{const{user:h,organization:b}=a(),j=d||b?.id,[f,N]=n.useState([]),[w,k]=n.useState([]),[C,A]=n.useState(!0),[L,R]=n.useState(null),[E,I]=n.useState(1),[T,W]=n.useState(u?.name||""),[F,U]=n.useState("all"),[O,$]=n.useState("all"),[_,B]=n.useState("all"),[G,z]=n.useState("date"),[K,Q]=n.useState("desc"),[X,ee]=n.useState(null),[se,ae]=n.useState(!1),[te,re]=n.useState(!1),[le,ne]=n.useState(!1),[oe,me]=n.useState(null),[xe,ge]=n.useState(!1),[be,ye]=n.useState(null),[je,ve]=n.useState(!1),[fe,Ne]=n.useState(null),[we,De]=n.useState("warnings"),ke=n.useCallback(async()=>{if(!j)return s.warn("No organization ID available for loading warnings"),void A(!1);try{let e;if(A(!0),R(null),t())if(r()){e=(await l.getOrganizationWarnings(j,{},{pageSize:500,orderField:"issueDate",orderDirection:"desc"})).warnings,e.length}else e=await i.warnings.getAll(j);else e=await i.warnings.getAll(j);const a=e.filter(e=>!e.isArchived&&"expired"!==e.status&&"overturned"!==e.status).sort((e,s)=>new Date(s.createdAt||0).getTime()-new Date(e.createdAt||0).getTime());N(a),k(a),s.success(`📊 Loaded ${a.length} active warnings (${t()?"NESTED":"SHARDED"} structure)`)}catch(e){s.error("❌ Failed to load warnings:",e);const a=e instanceof Error?e.message:"Unknown error";R(`Failed to load warnings: ${a}`)}finally{A(!1)}},[j]);n.useEffect(()=>{j?ke():A(!1)},[j,ke]),n.useEffect(()=>{let e=[...f];if(T){const s=T.toLowerCase();e=e.filter(e=>e.employeeName?.toLowerCase().includes(s)||e.employeeNumber?.toLowerCase().includes(s)||e.category?.toLowerCase().includes(s)||e.description?.toLowerCase().includes(s))}"all"!==F&&(e=e.filter(e=>e.status===F)),"all"!==O&&(e=e.filter(e=>e.level===O)),"all"!==_&&(e=e.filter(e=>e.department===_)),e.sort((e,s)=>{let a,t;switch(G){case"employee":a=e.employeeName,t=s.employeeName;break;case"level":a=e.level,t=s.level;break;case"status":a=e.status||"",t=s.status||"";break;default:a=new Date(e.createdAt||0).getTime(),t=new Date(s.createdAt||0).getTime()}return a<t?"asc"===K?-1:1:a>t?"asc"===K?1:-1:0}),k(e),I(1)},[f,T,F,O,_,G,K]);const Ce=n.useMemo(()=>{const e=new Set(f.map(e=>e.department).filter(e=>e));return Array.from(e).sort()},[f]),Se=n.useMemo(()=>{const e=10*(E-1),s=e+10;return w.slice(e,s)},[w,E]),Ae=Math.ceil(w.length/10),Le=n.useCallback(e=>{e.id,ee(e),ae(!0)},[]),Pe=n.useCallback(()=>{ae(!1),ee(null)},[]),Re=n.useCallback(async e=>{try{A(!0),await i.warnings.update(e.warningId,{appealSubmitted:!0,appealDate:new Date,status:"appealed",appealDetails:{grounds:e.grounds,details:e.additionalDetails,requestedOutcome:e.requestedOutcome,submittedAt:new Date,submittedBy:h?.email||"Employee"}},j),s.success(`Legal appeal submitted for warning ${e.warningId}`),await ke(),ge(!1),ye(null),alert("Appeal submitted successfully. HR will review your appeal within 5 working days as per company policy.")}catch(a){throw s.error("Failed to submit appeal:",a),new Error("Failed to submit appeal. Please try again.")}finally{A(!1)}},[ke,h]);n.useCallback(async(e,a)=>{try{A(!0),await i.warnings.update(e,{status:"overturned"===a?"expired":"acknowledged",appealOutcome:a,appealDate:new Date},j),s.success(`Appeal ${a} for warning ${e}`),await ke()}catch(t){s.error("Failed to process appeal:",t),R("Failed to process appeal")}finally{A(!1)}},[ke]);const Ee=n.useCallback(async e=>{try{A(!0);let a="acknowledged";"overturned"===e.decision&&(a="overturned");const t={status:a,appealOutcome:e.decision,appealDecisionDate:new Date,appealReasoning:e.reasoning,hrNotes:e.hrNotes,followUpRequired:e.followUpRequired,followUpDate:e.followUpDate};"reduced"!==e.decision&&"modified"!==e.decision||(e.newLevel&&(t.level=e.newLevel),e.newDescription&&(t.description=e.newDescription)),await i.warnings.update(e.warningId,t,j),"overturned"===e.decision?(await i.warnings.archive(e.warningId,j,"overturned"),s.success("Warning overturned and archived")):e.decision,await ke(),s.success("Appeal decision recorded successfully")}catch(a){throw s.error("Failed to record appeal decision:",a),new Error("Failed to record appeal decision. Please try again.")}finally{A(!1)}},[ke]);n.useCallback(e=>{e.id,ee(e),ae(!0)},[]);const Ie=n.useCallback(async e=>{try{confirm("Are you sure you want to archive this warning? It will be moved to the archive.")&&(A(!0),await i.warnings.archive(e,j,"manual"),s.success("Warning archived successfully"),await ke())}catch(a){s.error("Failed to archive warning:",a),R("Failed to archive warning")}finally{A(!1)}},[j,ke]);return C?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Loading Warnings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please wait..."})]})}):L?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(v,{className:"w-8 h-8 text-red-500 mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Error Loading Warnings"}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:L}),e.jsxs("button",{onClick:ke,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 text-sm",children:[e.jsx(q,{className:"w-4 h-4"}),"Retry Loading"]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Warning Management"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[f.length," total"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>De("archive"),className:"flex items-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Archive"})]}),e.jsx("button",{onClick:ke,disabled:C,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(q,{className:"w-4 h-4 "+(C?"animate-spin":"")})}),o&&e.jsx("button",{onClick:o,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(S,{className:"w-4 h-4"})})]})]}),"archive"===we?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"Warning archive view is being reimplemented. Please use the filters to find archived warnings."}),e.jsx("button",{onClick:()=>De("warnings"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Warnings"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search warnings...",value:T,onChange:e=>W(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:F,onChange:e=>U(e.target.value),className:"flex-1 sm:flex-initial px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"appealed",children:"Under Appeal"}),e.jsx("option",{value:"expired",children:"Expired"})]}),e.jsxs("select",{value:O,onChange:e=>$(e.target.value),className:"flex-1 sm:flex-initial px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"counselling",children:"Counselling"}),e.jsx("option",{value:"verbal",children:"Verbal"}),e.jsx("option",{value:"first_written",children:"First Written"}),e.jsx("option",{value:"second_written",children:"Second Written"}),e.jsx("option",{value:"final_written",children:"Final Written"}),e.jsx("option",{value:"written",children:"Written (Legacy)"}),e.jsx("option",{value:"final",children:"Final (Legacy)"}),e.jsx("option",{value:"dismissal",children:"Dismissal (Legacy)"})]}),e.jsxs("button",{onClick:()=>re(!te),className:"px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors text-sm items-center gap-2 sm:flex hidden",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden lg:inline",children:"More"}),te?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(J,{className:"w-4 h-4"})]})]})]}),te&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("select",{value:_,onChange:e=>B(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Departments"}),Ce.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:`${G}-${K}`,onChange:e=>{const[s,a]=e.target.value.split("-");z(s),Q(a)},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date-desc",children:"Newest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"employee-asc",children:"Employee A-Z"}),e.jsx("option",{value:"employee-desc",children:"Employee Z-A"}),e.jsx("option",{value:"level-asc",children:"Level (Low to High)"}),e.jsx("option",{value:"level-desc",children:"Level (High to Low)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("select",{value:10,onChange:e=>setItemsPerPage(Number(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs font-medium",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:f.length})]}),e.jsx(P,{className:"w-5 h-5 text-gray-500"})]})}),e.jsx("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-xs font-medium",children:"Active"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:f.filter(e=>e.isActive).length})]}),e.jsx(D,{className:"w-5 h-5 text-green-500"})]})}),e.jsx("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-600 text-xs font-medium",children:"Undelivered"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:f.filter(e=>"delivered"!==e.deliveryStatus).length})]}),e.jsx(p,{className:"w-5 h-5 text-orange-500"})]})}),e.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-xs font-medium",children:"Critical"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:f.filter(e=>"final"===e.level||"dismissal"===e.level).length})]}),e.jsx(v,{className:"w-5 h-5 text-red-500"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[w.length," warnings ",w.length!==f.length&&`(filtered from ${f.length})`]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",E," of ",Ae]})})]}),e.jsx("div",{className:"md:hidden space-y-3 mb-4",children:Se.map((s,a)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:pe(s.employeeName)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[pe(s.employeeNumber)," • ",pe(s.department)]})]}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("issued"===s.status?"bg-blue-100 text-blue-800":"acknowledged"===s.status?"bg-green-100 text-green-800":"appealed"===s.status?"bg-orange-100 text-orange-800":"expired"===s.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"issued"===s.status?"Issued":"acknowledged"===s.status?"Acknowledged":"appealed"===s.status?"Under Appeal":"expired"===s.status?"Expired":pe(s.status,"Pending")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Level"}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full mt-1 "+("counselling"===s.level?"bg-green-100 text-green-800":"verbal"===s.level?"bg-blue-100 text-blue-800":"first_written"===s.level?"bg-yellow-100 text-yellow-800":"second_written"===s.level?"bg-orange-100 text-orange-800":"final_written"===s.level?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"counselling"===s.level?"Counselling":"verbal"===s.level?"Verbal":"first_written"===s.level?"1st Written":"second_written"===s.level?"2nd Written":"final_written"===s.level?"Final":pe(s.level,"Unknown")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:pe(s.category)})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.issueDate?new Date(s.issueDate.seconds?1e3*s.issueDate.seconds:s.issueDate).toLocaleDateString():"N/A"}),e.jsx("button",{onClick:()=>Le(s),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1.5 hover:bg-blue-50 rounded transition-colors",children:"View Details"})]})]},s.id||`warning-${a}`))}),e.jsx("div",{className:"hidden md:block bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Warning"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:Se.map((s,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:pe(s.employeeName)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[pe(s.employeeNumber)," • ",pe(s.department)]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("counselling"===s.level?"bg-green-100 text-green-800":"verbal"===s.level?"bg-blue-100 text-blue-800":"first_written"===s.level?"bg-yellow-100 text-yellow-800":"second_written"===s.level?"bg-orange-100 text-orange-800":"final_written"===s.level?"bg-red-100 text-red-800":"written"===s.level?"bg-yellow-100 text-yellow-800":"final"===s.level||"dismissal"===s.level?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"counselling"===s.level?"Counselling":"verbal"===s.level?"Verbal":"first_written"===s.level?"First Written":"second_written"===s.level?"Second Written":"final_written"===s.level?"Final Written":"written"===s.level?"Written":"final"===s.level?"Final":"dismissal"===s.level?"Dismissal":pe(s.level,"Unknown")})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:pe(s.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:s.issueDate?new Date(s.issueDate.seconds?1e3*s.issueDate.seconds:s.issueDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("issued"===s.status?"bg-blue-100 text-blue-800":"acknowledged"===s.status?"bg-green-100 text-green-800":"appealed"===s.status?"bg-orange-100 text-orange-800":"expired"===s.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"issued"===s.status?"Issued":"acknowledged"===s.status?"Acknowledged":"appealed"===s.status?"Under Appeal":"expired"===s.status?"Expired":pe(s.status,"Pending")})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Le(s),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"View"}),"appealed"===s.status&&e.jsxs("button",{onClick:()=>{Ne(s),ve(!0)},className:"text-purple-600 hover:text-purple-800 text-xs px-2 py-1 hover:bg-purple-50 rounded transition-colors flex items-center gap-1",title:"Review Appeal with Enhanced Decision Options",children:[e.jsx(M,{className:"w-3 h-3"}),"Review Appeal"]}),"delivered"!==s.deliveryStatus&&"appealed"!==s.status&&e.jsx("button",{onClick:()=>{me(s),ne(!0)},className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 hover:bg-orange-50 rounded transition-colors",children:"Deliver"}),"appealed"!==s.status&&he(s)&&e.jsx("button",{onClick:()=>{ye(s),ge(!0)},className:"text-amber-600 hover:text-amber-800 text-xs px-2 py-1 hover:bg-amber-50 rounded transition-colors",title:(()=>{const e=s.issueDate.seconds?new Date(1e3*s.issueDate.seconds):new Date(s.issueDate),a=new Date(e);return a.setDate(a.getDate()+30),`Appeal this warning (deadline: ${a.toLocaleDateString()})`})(),children:"Appeal"}),"appealed"!==s.status&&!he(s)&&e.jsx("span",{className:"text-gray-500 text-xs px-2 py-1",title:"Appeal period has expired",children:"Appeal Expired"}),("acknowledged"===s.status||"expired"===s.status||!he(s))&&e.jsx("button",{onClick:()=>Ie(s.id),className:"text-gray-600 hover:text-gray-800 text-xs px-2 py-1 hover:bg-gray-50 rounded transition-colors",title:"Archive this warning",children:e.jsx(V,{className:"w-3 h-3"})})]})})]},s.id||`warning-${a}`))})]})})}),0===w.length&&!C&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"No warnings found"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:T||"all"!==F||"all"!==O||"all"!==_?"Try adjusting your search criteria or filters.":"No warnings have been created yet."}),(T||"all"!==F||"all"!==O||"all"!==_)&&e.jsx("button",{onClick:()=>{W(""),U("all"),$("all"),B("all")},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear all filters"})]}),Ae>1&&e.jsxs("div",{className:"flex items-center justify-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>I(Math.max(1,E-1)),disabled:1===E,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm text-gray-600 bg-gray-50 rounded-lg",children:[E," of ",Ae]}),e.jsx("button",{onClick:()=>I(Math.min(Ae,E+1)),disabled:E===Ae,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]}),e.jsx(ie,{warning:X,isOpen:se,onClose:Pe,canTakeAction:x,userRole:g}),oe&&e.jsx(de,{isOpen:le,onClose:()=>{ne(!1),me(null)},warningId:oe.id||"",employeeName:pe(oe.employee),deliveryMethod:oe.deliveryMethod||"email",onDeliveryConfirmed:async e=>{try{await i.warnings.updateDeliveryStatus(e.warningId,{status:"delivered",deliveredAt:e.deliveredAt,deliveryMethod:e.deliveryMethod,proofImage:e.proofImage}),await ke(),ne(!1),me(null)}catch(a){throw s.error("Failed to confirm delivery:",a),a}}}),xe&&be&&e.jsx(ce,{isOpen:xe,onClose:()=>{ge(!1),ye(null)},warning:{id:be.id,employeeName:be.employeeName,category:be.category,level:be.level,issueDate:be.issueDate,description:be.description||"No description provided"},onAppealSubmit:Re}),je&&fe&&e.jsx(ue,{isOpen:je,onClose:()=>{ve(!1),Ne(null)},warning:{id:fe.id,employeeName:fe.employeeName,employeeNumber:fe.employeeNumber,category:fe.category,level:fe.level,issueDate:fe.issueDate,description:fe.description||"No description provided",appealDetails:fe.appealDetails},onDecisionSubmit:Ee})]})]})};export{be as WarningsReviewDashboard,be as default};
