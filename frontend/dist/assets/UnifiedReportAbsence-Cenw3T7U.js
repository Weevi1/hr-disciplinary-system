import{u as e,a as s,j as a,A as l,L as r,k as t,D as o}from"./business-owner-dashboard-BmQl3e0o.js";import{r as i}from"./react-vendor-BMk1H4su.js";import{U as c}from"./UniversalEmployeeSelector-CunW9H6Q.js";import{C as n}from"./CustomDatePicker-B9cVbv8_.js";import{X as d,s as m,D as x,t as p,b as h,n as u,c as y,g as v,F as b}from"./ui-vendor-nvFuqpTO.js";import"./pdf-vendor-CbrIsI36.js";import"./firebase-vendor-BIBOIkWK.js";const f=[{id:"full-day",label:"Full Day Absence",icon:"ðŸ ",payrollImpact:!0,description:"Employee absent for entire work day"},{id:"half-day",label:"Half Day Absence",icon:"ðŸ•",payrollImpact:!0,description:"Employee absent for half of work day"},{id:"late-arrival",label:"Late Arrival",icon:"â°",payrollImpact:!1,description:"Employee arrived late to work"},{id:"early-departure",label:"Early Departure",icon:"ðŸšª",payrollImpact:!1,description:"Employee left work early"},{id:"sick-leave",label:"Sick Leave",icon:"ðŸ¤’",payrollImpact:!0,description:"Employee absent due to illness"},{id:"personal-leave",label:"Personal Leave",icon:"ðŸ‘¤",payrollImpact:!0,description:"Employee absent for personal reasons"}],j=({isOpen:j,onClose:N})=>{const{user:g}=e(),{organization:_}=s(),[w,k]=i.useState(null),[C,S]=i.useState((new Date).toISOString().split("T")[0]),[I,E]=i.useState(""),[D,T]=i.useState(""),[A,L]=i.useState(!1),[O,R]=i.useState(null),[P,F]=i.useState(!1),[M,$]=i.useState([]),[U,H]=i.useState(!1),[z,B]=i.useState(!1);i.useEffect(()=>{j&&(async()=>{if(g?.id&&_?.id)try{const e=(await l.employees.getByManager(g.id,_.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",employeeNumber:e.employeeNumber||e.profile?.employeeNumber||"",...e}));$(e)}catch(e){r.error("Failed to load employees:",e),R("Failed to load employees")}})()},[g?.id,_?.id,j]);const q=i.useMemo(()=>f.find(e=>e.id===I),[I]),W=i.useCallback(e=>{E(e),H(!1),B(!1)},[]),G=i.useCallback(()=>{window.innerWidth<768?B(!0):H(!U)},[U]),J=i.useCallback(()=>{B(!1)},[]),K=()=>!!(w&&C&&I);i.useEffect(()=>{j||(k(null),S((new Date).toISOString().split("T")[0]),E(""),T(""),R(null),F(!1),H(!1),B(!1))},[j]);const Q=f.find(e=>e.id===I);return P?j?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"Absence report has been successfully submitted"})]})}),a.jsx("button",{onClick:N,className:"modal-header__close-button",children:a.jsx(d,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(m,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Report Submitted Successfully"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The absence report for ",w?.firstName," ",w?.lastName," has been submitted and will be reviewed by HR."]}),Q?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(x,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"This absence may impact payroll calculations"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:N,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:j?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Employee Absence"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document unscheduled employee absence"})]})}),a.jsx("button",{onClick:N,className:"modal-header__close-button",children:a.jsx(d,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[O&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(p,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:O})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(h,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select employee and specify absence information"})]})]}),a.jsx(c,{employees:M,selectedEmployeeId:w?.id||null,onEmployeeSelect:e=>{const s=M.find(s=>s.id===e);k(s||null)},title:"Employee Selection",subtitle:"Choose the employee for this absence report"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(n,{type:"date",label:"Absence Date",value:C,onChange:e=>S(e),icon:u,required:!0}),a.jsxs("div",{children:[a.jsx("label",{className:"unified-field-label",children:"Reported Date"}),a.jsx("input",{type:"text",value:(new Date).toLocaleDateString(),readOnly:!0,className:"unified-field-input opacity-75"})]})]})})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(y,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the type of absence that occurred"})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border hover:border-primary",style:{backgroundColor:"var(--color-input-background)",borderColor:U?"var(--color-primary)":"var(--color-input-border)",boxShadow:U?"0 0 0 2px var(--color-primary-light)":void 0},onClick:G,children:q?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg",children:q.icon}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:q.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:q.description}),q.payrollImpact&&a.jsx("span",{className:"category-card__badge category-card__badge--warning",children:a.jsx(x,{className:"w-3 h-3"})})]})]})]}),a.jsx(v,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(U?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select absence type..."})]}),a.jsx(v,{className:"w-4 h-4 transition-transform "+(U?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),U&&a.jsx("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:a.jsx("div",{className:"max-h-60 overflow-y-auto",children:a.jsx("div",{className:"py-2",children:f.map(e=>a.jsx("button",{onClick:()=>W(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg flex-shrink-0",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs",style:{color:"var(--color-warning)"},children:"$ Payroll"})]})]})]})},e.id))})})})]})}),z&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:J}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Absence Type"}),a.jsx("button",{onClick:J,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(d,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:a.jsx("div",{children:f.map(e=>a.jsxs("button",{onClick:()=>W(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("span",{className:"text-xl flex-shrink-0 mt-0.5",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("div",{className:"text-sm text-left",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs px-2 py-1 rounded flex-shrink-0",style:{backgroundColor:"var(--color-warning-bg)",color:"var(--color-warning)"},children:"$ Payroll"})]})]})]},e.id))})})]})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(b,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Additional Notes"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional context or details about the absence"})]})]}),a.jsx("textarea",{value:D,onChange:e=>T(e.target.value),placeholder:"Optional additional context or details about the absence...",className:"unified-field-input",rows:3,maxLength:500}),a.jsxs("div",{className:"unified-field-hint",children:[D.length,"/500 characters"]})]}),Q?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(x,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:"Payroll Impact Notice"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"This absence type may affect the employee's pay. HR will review and make appropriate adjustments."})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:N,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(g&&w&&_?.id&&K())try{L(!0),R(null);const e=f.find(e=>e.id===I),s={organizationId:_.id,managerId:g.id,managerName:`${g.firstName} ${g.lastName}`,employeeId:w.id,employeeName:`${w.firstName} ${w.lastName}`,employeeNumber:w.employeeNumber||"",absenceDate:C,absenceType:I,reason:D.trim()||void 0,reportedDate:t.getServerTimestamp(),payrollImpact:e?.payrollImpact||!1,hrReviewed:!1,createdAt:t.getServerTimestamp(),updatedAt:t.getServerTimestamp()},a=Object.fromEntries(Object.entries(s).filter(([e,s])=>void 0!==s));await o.createDocument(_.id,"reports",a);F(!0),setTimeout(()=>{N()},2e3)}catch(e){r.error("Failed to submit absence report:",e),R("Failed to submit absence report. Please try again.")}finally{L(!1)}},disabled:!K()||A,className:"modal-footer__button modal-footer__button--primary "+(A?"modal-footer__button--loading":""),children:"Submit Report"})]})})]})}):null};export{j as UnifiedReportAbsence};
