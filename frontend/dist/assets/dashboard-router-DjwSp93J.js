const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/business-owner-dashboard-B1ObU6LN.js","assets/react-vendor-CWjEGAcE.js","assets/pdf-vendor-tUwojRr6.js","assets/firebase-vendor-joTZaqfO.js","assets/ui-vendor-Dyc3avPJ.js"])))=>i.map(i=>d[i]);
import{e,j as t,L as r,z as s,d as a,S as n,t as i,x as o,B as l,C as c,D as d,G as u,u as m,Z as h,o as p,v as g,U as x,T as f,O as y,k as v,h as b,H as j,b as w,I as N,y as C,J as S}from"./business-owner-dashboard-B1ObU6LN.js";import{r as k,g as R,c as E,d as D,R as A,b as P,u as B}from"./react-vendor-CWjEGAcE.js";import{a as z}from"./pdf-vendor-tUwojRr6.js";import{p as I,n as _,j as T,l as M,q as F,w as O,m as L,A as H,u as U,t as W,c as $,D as G,k as q,Q as V,R as Y,S as X,U as K,V as J}from"./firebase-vendor-joTZaqfO.js";import{H as Q,af as Z,M as ee,w as te,m as re,au as se,N as ae,a as ne,p as ie,aw as oe,X as le,R as ce,a7 as de,b as ue,h as me,O as he,x as pe,k as ge,Q as xe,d as fe,ax as ye,o as ve,_ as be,a0 as je,y as we,P as Ne,av as Ce,ay as Se,a4 as ke,i as Re,j as Ee,az as De,aA as Ae,aB as Pe,aC as Be,G as ze,c as Ie,aD as _e,z as Te,F as Me,aE as Fe,aF as Oe,aG as Le,D as He,s as Ue,aH as We,aI as $e,aJ as Ge,C as qe,e as Ve,aK as Ye,a6 as Xe,aL as Ke,ao as Je,aM as Qe,aN as Ze,aO as et,q as tt,T as rt,l as st,f as at,B as nt,g as it,aP as ot,U as lt,K as ct,J as dt}from"./ui-vendor-Dyc3avPJ.js";import{b as ut,c as mt,H as ht}from"./hr-dashboard-BGc_vO1I.js";import{H as pt}from"./hod-dashboard-BkrUIlzI.js";const gt={background:"#f8fafc",backgroundSecondary:"#f1f5f9",backgroundTertiary:"#e2e8f0",text:"#0f172a",textSecondary:"#475569",textTertiary:"#64748b",textInverse:"#ffffff",border:"#e2e8f0",borderSecondary:"#cbd5e1",cardBackground:"#ffffff",cardBorder:"#e2e8f0",inputBackground:"#ffffff",inputBorder:"#cbd5e1",inputBorderFocus:"#3b82f6",primary:"#3b82f6",primaryHover:"#2563eb",secondary:"#6366f1",secondaryHover:"#4f46e5",accent:"#10b981",accentHover:"#059669",success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6",muted:"#f3f4f6",mutedHover:"#e5e7eb",subtle:"#f9fafb",emphasis:"#1f2937",highlight:"#fef3c7",selection:"#dbeafe",navBg:"#ffffff",navText:"#374151",navHover:"#f3f4f6",navActive:"#eff6ff",btnGhost:"transparent",btnGhostHover:"#f3f4f6",btnOutline:"transparent",btnOutlineBorder:"#d1d5db",btnOutlineHover:"#f9fafb",alertInfoBg:"#eff6ff",alertInfoBorder:"#bfdbfe",alertInfoText:"#1e40af",alertSuccessBg:"#ecfdf5",alertSuccessBorder:"#a7f3d0",alertSuccessText:"#065f46",alertWarningBg:"#fffbeb",alertWarningBorder:"#fed7aa",alertWarningText:"#92400e",alertErrorBg:"#fef2f2",alertErrorBorder:"#fecaca",alertErrorText:"#991b1b",badgeDefault:"#f3f4f6",badgeDefaultText:"#374151",badgePrimary:"#eff6ff",badgePrimaryText:"#1e40af",badgeSuccess:"#ecfdf5",badgeSuccessText:"#065f46",badgeWarning:"#fffbeb",badgeWarningText:"#92400e",badgeError:"#fef2f2",badgeErrorText:"#991b1b",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#4b5563",statCardBg:"#ffffff",metricPositive:"#10b981",metricNegative:"#ef4444",urgentBg:"#fef2f2",urgentBorder:"#fecaca",urgentText:"#991b1b",hoverOverlay:"rgba(0, 0, 0, 0.05)",focusRing:"#3b82f6",loadingBg:"#f9fafb",shadowSm:"0 1px 2px 0 rgb(0 0 0 / 0.05)",shadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)",shadowLg:"0 10px 15px -3px rgb(0 0 0 / 0.1)",shadowXl:"0 20px 25px -5px rgb(0 0 0 / 0.1)"},xt={background:"#0a0e1a",backgroundSecondary:"#151b2e",backgroundTertiary:"#1f2937",text:"#f8fafc",textSecondary:"#e2e8f0",textTertiary:"#94a3b8",textInverse:"#0a0e1a",border:"#374151",borderSecondary:"#4b5563",cardBackground:"#1a202c",cardBorder:"#2d3748",inputBackground:"#1a202c",inputBorder:"#4a5568",inputBorderFocus:"#63b3ed",primary:"#60a5fa",primaryHover:"#3b82f6",secondary:"#a78bfa",secondaryHover:"#8b5cf6",accent:"#34d399",accentHover:"#10b981",success:"#48cc8b",warning:"#f6ad55",error:"#fc8181",info:"#63b3ed",muted:"#374151",mutedHover:"#4b5563",subtle:"#1f2937",emphasis:"#f9fafb",highlight:"#365314",selection:"#1e3a8a",navBg:"#1a202c",navText:"#e2e8f0",navHover:"#2d3748",navActive:"#2c5282",btnGhost:"transparent",btnGhostHover:"#2d3748",btnOutline:"transparent",btnOutlineBorder:"#4a5568",btnOutlineHover:"#2d3748",alertInfoBg:"#1e3a8a",alertInfoBorder:"#3b82f6",alertInfoText:"#93c5fd",alertSuccessBg:"#065f46",alertSuccessBorder:"#059669",alertSuccessText:"#a7f3d0",alertWarningBg:"#92400e",alertWarningBorder:"#d97706",alertWarningText:"#fcd34d",alertErrorBg:"#991b1b",alertErrorBorder:"#dc2626",alertErrorText:"#fca5a5",badgeDefault:"#374151",badgeDefaultText:"#d1d5db",badgePrimary:"#1e3a8a",badgePrimaryText:"#93c5fd",badgeSuccess:"#065f46",badgeSuccessText:"#a7f3d0",badgeWarning:"#92400e",badgeWarningText:"#fcd34d",badgeError:"#991b1b",badgeErrorText:"#fca5a5",navTabActive:"#60a5fa",navTabInactive:"#9ca3af",navTabHover:"#d1d5db",statCardBg:"#1a202c",metricPositive:"#34d399",metricNegative:"#fc8181",urgentBg:"#991b1b",urgentBorder:"#dc2626",urgentText:"#fca5a5",hoverOverlay:"rgba(255, 255, 255, 0.1)",focusRing:"#60a5fa",loadingBg:"#1f2937",shadowSm:"0 1px 3px 0 rgb(0 0 0 / 0.5)",shadow:"0 4px 6px -1px rgb(0 0 0 / 0.6), 0 2px 4px -1px rgb(0 0 0 / 0.3)",shadowLg:"0 10px 15px -3px rgb(0 0 0 / 0.7), 0 4px 6px -2px rgb(0 0 0 / 0.4)",shadowXl:"0 20px 25px -5px rgb(0 0 0 / 0.8), 0 10px 10px -5px rgb(0 0 0 / 0.5)"};function ft(e,t){const r="#"===e[0],s=r?e.slice(1):e,a=parseInt(s,16);let n=(a>>16)+t,i=(a>>8&255)+t,o=(255&a)+t;return n=n>255?255:n<0?0:n,i=i>255?255:i<0?0:i,o=o>255?255:o<0?0:o,(r?"#":"")+(n<<16|i<<8|o).toString(16).padStart(6,"0")}function yt(e,t,r){const s=vt(e),a=vt(t);if(!s||!a)return e;return`#${((1<<24)+(Math.round(s.r*(1-r)+a.r*r)<<16)+(Math.round(s.g*(1-r)+a.g*r)<<8)+Math.round(s.b*(1-r)+a.b*r)).toString(16).slice(1)}`}function vt(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function bt(e,t){const r=vt(e);return r?`rgba(${r.r}, ${r.g}, ${r.b}, ${t})`:`rgba(0, 0, 0, ${t})`}const jt=k.createContext(null),wt="hr-system-theme",Nt=({children:r})=>{let s=null;try{const t=e();s=t.organization}catch(p){}const[a,n]=k.useState("light"),[i,o]=k.useState(gt),[l,c]=k.useState(!0);k.useEffect(()=>{const e=localStorage.getItem(wt);e&&["light","dark","branded"].includes(e)&&n(e),c(!1)},[]);const d=k.useCallback(e=>{switch(e){case"dark":return xt;case"branded":if(s?.branding){const{primaryColor:e,secondaryColor:t,accentColor:r}=s.branding;return((e,t,r)=>({...gt,primary:e,primaryHover:ft(e,-15),secondary:t,secondaryHover:ft(t,-15),accent:r,accentHover:ft(r,-15),inputBorderFocus:e,background:yt("#fafafa",e,.04),backgroundSecondary:yt("#f5f5f5",e,.06),backgroundTertiary:yt("#eeeeee",e,.08),cardBackground:yt("#ffffff",e,.02),cardBorder:yt("#e5e7eb",e,.15),inputBackground:yt("#ffffff",e,.01),inputBorder:yt("#d1d5db",e,.2),textSecondary:yt("#6b7280",e,.1),textTertiary:yt("#9ca3af",e,.15),border:yt("#e5e7eb",e,.2),borderSecondary:yt("#d1d5db",e,.25),muted:yt("#f3f4f6",e,.08),mutedHover:yt("#e5e7eb",e,.1),subtle:yt("#f9fafb",e,.04),emphasis:yt("#1f2937",e,.1),highlight:yt("#fef3c7",e,.15),selection:yt("#dbeafe",e,.3),navBg:yt("#ffffff",e,.03),navText:yt("#374151",e,.1),navHover:yt("#f3f4f6",e,.1),navActive:yt("#eff6ff",e,.2),btnGhost:"transparent",btnGhostHover:yt("#f3f4f6",e,.1),btnOutline:"transparent",btnOutlineBorder:yt("#d1d5db",e,.3),btnOutlineHover:yt("#f9fafb",e,.08),alertInfoBg:yt("#eff6ff",e,.2),alertInfoBorder:yt("#bfdbfe",e,.3),alertInfoText:yt("#1e40af",e,.2),alertSuccessBg:yt("#ecfdf5",r,.2),alertSuccessBorder:yt("#a7f3d0",r,.3),alertSuccessText:yt("#065f46",r,.2),alertWarningBg:"#fffbeb",alertWarningBorder:"#fed7aa",alertWarningText:"#92400e",alertErrorBg:"#fef2f2",alertErrorBorder:"#fecaca",alertErrorText:"#991b1b",badgeDefault:yt("#f3f4f6",e,.1),badgeDefaultText:yt("#374151",e,.15),badgePrimary:yt("#eff6ff",e,.3),badgePrimaryText:yt("#1e40af",e,.2),badgeSuccess:yt("#ecfdf5",r,.3),badgeSuccessText:yt("#065f46",r,.2),badgeWarning:"#fffbeb",badgeWarningText:"#92400e",badgeError:"#fef2f2",badgeErrorText:"#991b1b",navTabActive:e,navTabInactive:yt("#6b7280",e,.2),navTabHover:yt("#4b5563",e,.15),statCardBg:yt("#ffffff",e,.02),metricPositive:r,metricNegative:"#ef4444",urgentBg:yt("#fef2f2",e,.1),urgentBorder:yt("#fecaca",e,.2),urgentText:yt("#991b1b",e,.1),hoverOverlay:bt(e,.08),focusRing:e,loadingBg:yt("#f9fafb",e,.05),shadowSm:`0 1px 2px 0 ${bt(e,.1)}`,shadow:`0 4px 6px -1px ${bt(e,.15)}, 0 2px 4px -1px ${bt(e,.06)}`,shadowLg:`0 10px 15px -3px ${bt(e,.2)}, 0 4px 6px -2px ${bt(e,.08)}`,shadowXl:`0 20px 25px -5px ${bt(e,.25)}, 0 10px 10px -5px ${bt(e,.1)}`}))(e||"#3b82f6",t||"#6366f1",r||"#10b981")}return gt;default:return gt}},[s]);k.useEffect(()=>{const e=d(a);o(e),function(e){const t=document.documentElement;t.style.setProperty("--color-background",e.background),t.style.setProperty("--color-background-secondary",e.backgroundSecondary),t.style.setProperty("--color-background-tertiary",e.backgroundTertiary),t.style.setProperty("--color-text",e.text),t.style.setProperty("--color-text-secondary",e.textSecondary),t.style.setProperty("--color-text-tertiary",e.textTertiary),t.style.setProperty("--color-text-inverse",e.textInverse),t.style.setProperty("--color-border",e.border),t.style.setProperty("--color-border-secondary",e.borderSecondary),t.style.setProperty("--color-card-background",e.cardBackground),t.style.setProperty("--color-card-border",e.cardBorder),t.style.setProperty("--color-input-background",e.inputBackground),t.style.setProperty("--color-input-border",e.inputBorder),t.style.setProperty("--color-input-border-focus",e.inputBorderFocus),t.style.setProperty("--color-primary",e.primary),t.style.setProperty("--color-primary-hover",e.primaryHover),t.style.setProperty("--color-secondary",e.secondary),t.style.setProperty("--color-secondary-hover",e.secondaryHover),t.style.setProperty("--color-accent",e.accent),t.style.setProperty("--color-accent-hover",e.accentHover),t.style.setProperty("--color-success",e.success),t.style.setProperty("--color-warning",e.warning),t.style.setProperty("--color-error",e.error),t.style.setProperty("--color-info",e.info),t.style.setProperty("--color-muted",e.muted),t.style.setProperty("--color-muted-hover",e.mutedHover),t.style.setProperty("--color-subtle",e.subtle),t.style.setProperty("--color-emphasis",e.emphasis),t.style.setProperty("--color-highlight",e.highlight),t.style.setProperty("--color-selection",e.selection),t.style.setProperty("--color-nav-bg",e.navBg),t.style.setProperty("--color-nav-text",e.navText),t.style.setProperty("--color-nav-hover",e.navHover),t.style.setProperty("--color-nav-active",e.navActive),t.style.setProperty("--color-btn-ghost",e.btnGhost),t.style.setProperty("--color-btn-ghost-hover",e.btnGhostHover),t.style.setProperty("--color-btn-outline",e.btnOutline),t.style.setProperty("--color-btn-outline-border",e.btnOutlineBorder),t.style.setProperty("--color-btn-outline-hover",e.btnOutlineHover),t.style.setProperty("--color-alert-info-bg",e.alertInfoBg),t.style.setProperty("--color-alert-info-border",e.alertInfoBorder),t.style.setProperty("--color-alert-info-text",e.alertInfoText),t.style.setProperty("--color-alert-success-bg",e.alertSuccessBg),t.style.setProperty("--color-alert-success-border",e.alertSuccessBorder),t.style.setProperty("--color-alert-success-text",e.alertSuccessText),t.style.setProperty("--color-alert-warning-bg",e.alertWarningBg),t.style.setProperty("--color-alert-warning-border",e.alertWarningBorder),t.style.setProperty("--color-alert-warning-text",e.alertWarningText),t.style.setProperty("--color-alert-error-bg",e.alertErrorBg),t.style.setProperty("--color-alert-error-border",e.alertErrorBorder),t.style.setProperty("--color-alert-error-text",e.alertErrorText),t.style.setProperty("--color-badge-default",e.badgeDefault),t.style.setProperty("--color-badge-default-text",e.badgeDefaultText),t.style.setProperty("--color-badge-primary",e.badgePrimary),t.style.setProperty("--color-badge-primary-text",e.badgePrimaryText),t.style.setProperty("--color-badge-success",e.badgeSuccess),t.style.setProperty("--color-badge-success-text",e.badgeSuccessText),t.style.setProperty("--color-badge-warning",e.badgeWarning),t.style.setProperty("--color-badge-warning-text",e.badgeWarningText),t.style.setProperty("--color-badge-error",e.badgeError),t.style.setProperty("--color-badge-error-text",e.badgeErrorText),t.style.setProperty("--color-nav-tab-active",e.navTabActive),t.style.setProperty("--color-nav-tab-inactive",e.navTabInactive),t.style.setProperty("--color-nav-tab-hover",e.navTabHover),t.style.setProperty("--color-stat-card-bg",e.statCardBg),t.style.setProperty("--color-metric-positive",e.metricPositive),t.style.setProperty("--color-metric-negative",e.metricNegative),t.style.setProperty("--color-urgent-bg",e.urgentBg),t.style.setProperty("--color-urgent-border",e.urgentBorder),t.style.setProperty("--color-urgent-text",e.urgentText),t.style.setProperty("--color-hover-overlay",e.hoverOverlay),t.style.setProperty("--color-focus-ring",e.focusRing),t.style.setProperty("--color-loading-bg",e.loadingBg),t.style.setProperty("--shadow-sm",e.shadowSm),t.style.setProperty("--shadow",e.shadow),t.style.setProperty("--shadow-lg",e.shadowLg),t.style.setProperty("--shadow-xl",e.shadowXl)}(e),localStorage.setItem(wt,a),"dark"===a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[a,d]);const u=k.useCallback(e=>{n(e)},[]),m=k.useCallback(()=>{n(e=>{switch(e){case"light":return"dark";case"dark":return"branded";default:return"light"}})},[]),h={currentTheme:a,themeColors:i,setTheme:u,toggleTheme:m,isLoading:l};return k.useEffect(()=>{l||(document.body.style.transition="background-color 0.3s ease, color 0.3s ease")},[l]),t.jsx(jt.Provider,{value:h,children:r})};const Ct=new class{async calculateCommission(e){try{const t=await s.getOrganization(e.organizationId);if(!t?.resellerId)throw new Error("No reseller assigned to organization");if(!(await s.getReseller(t.resellerId)))throw new Error("Reseller not found");const n=e.grossAmount-e.stripeFees,i=Math.round(.5*n),o=Math.round(.3*n),l=Math.round(.2*n),c={id:`${e.organizationId}-${e.periodStart}`,resellerId:t.resellerId,organizationId:e.organizationId,subscriptionId:e.subscriptionId,periodStart:e.periodStart,periodEnd:e.periodEnd,clientRevenue:e.grossAmount,stripeFees:e.stripeFees,netRevenue:n,commissionAmount:i,ownerAmount:o,companyAmount:l,status:"calculated",createdAt:I(),updatedAt:I()};return await _(T(a,"commissions",c.id),c),r.success("Commission calculated and saved:",c),c}catch(t){throw r.error("Failed to calculate commission:",t),t}}async processMonthlyPayouts(){try{const e=new Date;e.setDate(e.getDate()-30);const t=M(a,"commissions"),n=F(t,O("status","==","calculated"),O("createdAt","<",e.toISOString())),i=(await L(n)).docs.map(e=>({id:e.id,...e.data()}));i.length;const o=this.groupCommissionsByResellerMonth(i),l=[];for(const[c,d]of Object.entries(o)){const[e,t]=c.split("|"),n=await s.getReseller(e);if(!n)continue;const i=d.reduce((e,t)=>e+t.commissionAmount,0),o=d.reduce((e,t)=>e+t.netRevenue,0),u={resellerId:e,resellerName:`${n.firstName} ${n.lastName}`,month:t,province:n.province,totalClients:d.length,totalRevenue:o,totalCommission:i,commissions:d,payoutStatus:"pending",payoutDate:I()};await _(T(a,"commissionReports",`${e}-${t}`),u);const m=H(a);for(const r of d)m.update(T(a,"commissions",r.id),{status:"pending",updatedAt:I()});await m.commit(),l.push(u),r.success(`Generated commission report for ${n.firstName} ${n.lastName}: R${(i/100).toFixed(2)}`)}return l}catch(e){throw r.error("Failed to process monthly payouts:",e),e}}async markCommissionsPaid(e,t,s){try{const n=`${e}-${t}`;await U(T(a,"commissionReports",n),{payoutStatus:"paid",payoutReference:s,updatedAt:I()});const i=M(a,"commissions"),o=F(i,O("resellerId","==",e),O("status","==","pending")),l=await L(o),c=H(a);l.docs.forEach(e=>{c.update(e.ref,{status:"paid",payoutReference:s,updatedAt:I()})}),await c.commit(),r.success("Commissions marked as paid",{resellerId:e,month:t,payoutReference:s})}catch(n){throw r.error("Failed to mark commissions as paid:",n),n}}async getResellerMetrics(e){try{if(!(await s.getReseller(e)))throw new Error("Reseller not found");const t=await s.getResellerClients(e),n=t.filter(e=>!1!==e.isActive),i=M(a,"commissions"),o=F(i,O("resellerId","==",e)),l=(await L(o)).docs.map(e=>e.data()),c=l.reduce((e,t)=>e+t.commissionAmount,0),d=(l.reduce((e,t)=>e+t.netRevenue,0),(new Date).toISOString().slice(0,7)),u=l.filter(e=>e.periodStart.startsWith(d)),m=u.reduce((e,t)=>e+t.netRevenue,0),h=u.reduce((e,t)=>e+t.commissionAmount,0),p=n.length>0?m/n.length:0;let g="None";if(t.length>0){const e=t.map(e=>({name:e.name,revenue:e.monthlySubscription||0})).sort((e,t)=>t.revenue-e.revenue)[0];e.revenue>0&&(g=e.name)}const x=new Date;x.setMonth(x.getMonth()-1);const f=x.toISOString().slice(0,7),y=l.filter(e=>e.periodStart.startsWith(f)).reduce((e,t)=>e+t.netRevenue,0),v=y>0?(m-y)/y*100:0,b=75,j={totalClients:t.length,activeClients:n.length,monthlyRecurringRevenue:m,totalCommissionsEarned:c,monthlyCommissions:h,averageClientValue:p,monthlyGrowth:v,conversionRate:b,topPerformingClient:g};return r.success("Reseller metrics calculated:",j),j}catch(t){return r.error("Failed to get reseller metrics:",t),{totalClients:0,activeClients:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0,monthlyCommissions:0,averageClientValue:0,monthlyGrowth:0,conversionRate:0,topPerformingClient:"None"}}}async getProvincialMetrics(){try{const e=await s.getAllResellers(),t={};for(const r of e){const e=r.province;t[e]||(t[e]={resellers:0,clients:0,monthlyRevenue:0,commissionsOwed:0}),t[e].resellers+=1,t[e].clients+=r.clientIds.length,t[e].monthlyRevenue+=r.monthlyRecurringRevenue;const s=M(a,"commissions"),n=F(s,O("resellerId","==",r.id),O("status","in",["pending","calculated"])),i=(await L(n)).docs.reduce((e,t)=>e+(t.data().commissionAmount||0),0);t[e].commissionsOwed+=i}return r.success("Provincial metrics calculated:",t),t}catch(e){throw r.error("Failed to get provincial metrics:",e),e}}groupCommissionsByResellerMonth(e){const t={};for(const r of e){const e=r.periodStart.slice(0,7),s=`${r.resellerId}|${e}`;t[s]||(t[s]=[]),t[s].push(r)}return t}async getRecentCommissions(e,t=5){try{const i=M(a,"commissions"),o=F(i,O("resellerId","==",e),W("createdAt","desc")),l=(await L(o)).docs.map(e=>e.data()),c=[];for(let e=0;e<Math.min(l.length,t);e++){const t=l[e];let a="Unknown Client";try{const e=await s.getOrganization(t.organizationId);e&&(a=e.name)}catch(n){r.warn(`Could not get organization name for ${t.organizationId}`)}c.push({id:t.id,clientName:a,periodStart:t.periodStart,periodEnd:t.periodEnd,commissionAmount:t.commissionAmount,baseAmount:t.netRevenue,commissionRate:.5})}return r.success(`Retrieved ${c.length} recent commissions for reseller`),c}catch(n){return r.error("Failed to get recent commissions:",n),[]}}async getPerformanceTrend(e,t){try{const s="3m"===t?3:"6m"===t?6:12,n=M(a,"commissions"),i=F(n,O("resellerId","==",e),W("periodStart","desc")),o=(await L(i)).docs.map(e=>e.data()),l={};o.forEach(e=>{const t=e.periodStart.slice(0,7);l[t]||(l[t]={revenue:0,commissions:0}),l[t].revenue+=e.netRevenue,l[t].commissions+=e.commissionAmount});const c=[],d=new Date;for(let e=0;e<s;e++){const t=new Date(d.getFullYear(),d.getMonth()-e,1),r=t.toISOString().slice(0,7),s=t.toLocaleDateString("en-US",{month:"short",year:"numeric"});c.unshift({month:s,revenue:l[r]?.revenue||0,commissions:l[r]?.commissions||0})}return r.success(`Retrieved ${c.length} months of performance data for reseller`),c}catch(s){return r.error("Failed to get performance trend:",s),[]}}async generateCommissionStatement(e){try{r.warn("Commission statement generation not yet implemented - feature requested"),await new Promise(e=>setTimeout(e,1e3))}catch(t){throw r.error("Failed to generate commission statement:",t),t}}async getClientMetrics(e,t){try{let r=t;if(!r&&(r=await s.getOrganization(e),!r))throw new Error("Organization not found");let i=0;try{i=(await n.loadEmployees(e)).documents.length}catch(a){i=0}let o=0;try{const t=(await n.loadWarnings(e)).documents,r=new Date;r.setDate(1),o=t.filter(e=>new Date(e.issueDate)>=r).length}catch(a){o=0}return{monthlyRevenue:r.monthlySubscription||0,employeeCount:i,lastActivity:r.lastActivity||r.updatedAt||(new Date).toISOString(),subscriptionStatus:!1===r.isActive?"inactive":"active",warningsThisMonth:o}}catch(i){return r.error("Failed to get client metrics:",i),{monthlyRevenue:0,employeeCount:0,lastActivity:(new Date).toISOString(),subscriptionStatus:"inactive",warningsThisMonth:0}}}formatCurrency(e){return`R${(e/100).toFixed(2)}`}};var St={exports:{}};var kt={exports:{}};const Rt=R(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var Et;function Dt(){return Et||(Et=1,kt.exports=function(){var e=e||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==E&&E.crypto&&(r=E.crypto),!r)try{r=Rt}catch(g){}var s=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=i.WordArray=o.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,s=this.sigBytes,a=e.sigBytes;if(this.clamp(),s%4)for(var n=0;n<a;n++){var i=r[n>>>2]>>>24-n%4*8&255;t[s+n>>>2]|=i<<24-(s+n)%4*8}else for(var o=0;o<a;o+=4)t[s+o>>>2]=r[o>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(s());return new l.init(t,e)}}),c=n.enc={},d=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],a=0;a<r;a++){var n=t[a>>>2]>>>24-a%4*8&255;s.push((n>>>4).toString(16)),s.push((15&n).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s+=2)r[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new l.init(r,t/2)}},u=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],a=0;a<r;a++){var n=t[a>>>2]>>>24-a%4*8&255;s.push(String.fromCharCode(n))}return s.join("")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s++)r[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new l.init(r,t)}},m=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=m.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,s=this._data,a=s.words,n=s.sigBytes,i=this.blockSize,o=n/(4*i),c=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*i,d=e.min(4*c,n);if(c){for(var u=0;u<c;u+=i)this._doProcessBlock(a,u);r=a.splice(0,c),s.sigBytes-=d}return new l.init(r,d)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=n.algo={};return n}(Math);return e}()),kt.exports}var At,Pt={exports:{}};function Bt(){return At||(At=1,Pt.exports=function(e){return s=(r=e).lib,a=s.Base,n=s.WordArray,(i=r.x64={}).Word=a.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=a.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],s=0;s<t;s++){var a=e[s];r.push(a.high),r.push(a.low)}return n.create(r,this.sigBytes)},clone:function(){for(var e=a.clone.call(this),t=e.words=this.words.slice(0),r=t.length,s=0;s<r;s++)t[s]=t[s].clone();return e}}),e;var t,r,s,a,n,i}(Dt())),Pt.exports}var zt,It={exports:{}};function _t(){return zt||(zt=1,It.exports=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init,s=t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,s=[],a=0;a<t;a++)s[a>>>2]|=e[a]<<24-a%4*8;r.call(this,s,t)}else r.apply(this,arguments)};s.prototype=t}}(),e.lib.WordArray}(Dt())),It.exports}var Tt,Mt={exports:{}};function Ft(){return Tt||(Tt=1,Mt.exports=function(e){return function(){var t=e,r=t.lib.WordArray,s=t.enc;function a(e){return e<<8&4278255360|e>>>8&16711935}s.Utf16=s.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],a=0;a<r;a+=2){var n=t[a>>>2]>>>16-a%4*8&65535;s.push(String.fromCharCode(n))}return s.join("")},parse:function(e){for(var t=e.length,s=[],a=0;a<t;a++)s[a>>>1]|=e.charCodeAt(a)<<16-a%2*16;return r.create(s,2*t)}},s.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],n=0;n<r;n+=2){var i=a(t[n>>>2]>>>16-n%4*8&65535);s.push(String.fromCharCode(i))}return s.join("")},parse:function(e){for(var t=e.length,s=[],n=0;n<t;n++)s[n>>>1]|=a(e.charCodeAt(n)<<16-n%2*16);return r.create(s,2*t)}}}(),e.enc.Utf16}(Dt())),Mt.exports}var Ot,Lt={exports:{}};function Ht(){return Ot||(Ot=1,Lt.exports=function(e){return function(){var t=e,r=t.lib.WordArray;function s(e,t,s){for(var a=[],n=0,i=0;i<t;i++)if(i%4){var o=s[e.charCodeAt(i-1)]<<i%4*2|s[e.charCodeAt(i)]>>>6-i%4*2;a[n>>>2]|=o<<24-n%4*8,n++}return r.create(a,n)}t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,s=this._map;e.clamp();for(var a=[],n=0;n<r;n+=3)for(var i=(t[n>>>2]>>>24-n%4*8&255)<<16|(t[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|t[n+2>>>2]>>>24-(n+2)%4*8&255,o=0;o<4&&n+.75*o<r;o++)a.push(s.charAt(i>>>6*(3-o)&63));var l=s.charAt(64);if(l)for(;a.length%4;)a.push(l);return a.join("")},parse:function(e){var t=e.length,r=this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var n=0;n<r.length;n++)a[r.charCodeAt(n)]=n}var i=r.charAt(64);if(i){var o=e.indexOf(i);-1!==o&&(t=o)}return s(e,t,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(Dt())),Lt.exports}var Ut,Wt={exports:{}};function $t(){return Ut||(Ut=1,Wt.exports=function(e){return function(){var t=e,r=t.lib.WordArray;function s(e,t,s){for(var a=[],n=0,i=0;i<t;i++)if(i%4){var o=s[e.charCodeAt(i-1)]<<i%4*2|s[e.charCodeAt(i)]>>>6-i%4*2;a[n>>>2]|=o<<24-n%4*8,n++}return r.create(a,n)}t.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var r=e.words,s=e.sigBytes,a=t?this._safe_map:this._map;e.clamp();for(var n=[],i=0;i<s;i+=3)for(var o=(r[i>>>2]>>>24-i%4*8&255)<<16|(r[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|r[i+2>>>2]>>>24-(i+2)%4*8&255,l=0;l<4&&i+.75*l<s;l++)n.push(a.charAt(o>>>6*(3-l)&63));var c=a.charAt(64);if(c)for(;n.length%4;)n.push(c);return n.join("")},parse:function(e,t){void 0===t&&(t=!0);var r=e.length,a=t?this._safe_map:this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<a.length;i++)n[a.charCodeAt(i)]=i}var o=a.charAt(64);if(o){var l=e.indexOf(o);-1!==l&&(r=l)}return s(e,r,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),e.enc.Base64url}(Dt())),Wt.exports}var Gt,qt={exports:{}};function Vt(){return Gt||(Gt=1,qt.exports=function(e){return function(t){var r=e,s=r.lib,a=s.WordArray,n=s.Hasher,i=r.algo,o=[];!function(){for(var e=0;e<64;e++)o[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=i.MD5=n.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var s=t+r,a=e[s];e[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var n=this._hash.words,i=e[t+0],l=e[t+1],h=e[t+2],p=e[t+3],g=e[t+4],x=e[t+5],f=e[t+6],y=e[t+7],v=e[t+8],b=e[t+9],j=e[t+10],w=e[t+11],N=e[t+12],C=e[t+13],S=e[t+14],k=e[t+15],R=n[0],E=n[1],D=n[2],A=n[3];R=c(R,E,D,A,i,7,o[0]),A=c(A,R,E,D,l,12,o[1]),D=c(D,A,R,E,h,17,o[2]),E=c(E,D,A,R,p,22,o[3]),R=c(R,E,D,A,g,7,o[4]),A=c(A,R,E,D,x,12,o[5]),D=c(D,A,R,E,f,17,o[6]),E=c(E,D,A,R,y,22,o[7]),R=c(R,E,D,A,v,7,o[8]),A=c(A,R,E,D,b,12,o[9]),D=c(D,A,R,E,j,17,o[10]),E=c(E,D,A,R,w,22,o[11]),R=c(R,E,D,A,N,7,o[12]),A=c(A,R,E,D,C,12,o[13]),D=c(D,A,R,E,S,17,o[14]),R=d(R,E=c(E,D,A,R,k,22,o[15]),D,A,l,5,o[16]),A=d(A,R,E,D,f,9,o[17]),D=d(D,A,R,E,w,14,o[18]),E=d(E,D,A,R,i,20,o[19]),R=d(R,E,D,A,x,5,o[20]),A=d(A,R,E,D,j,9,o[21]),D=d(D,A,R,E,k,14,o[22]),E=d(E,D,A,R,g,20,o[23]),R=d(R,E,D,A,b,5,o[24]),A=d(A,R,E,D,S,9,o[25]),D=d(D,A,R,E,p,14,o[26]),E=d(E,D,A,R,v,20,o[27]),R=d(R,E,D,A,C,5,o[28]),A=d(A,R,E,D,h,9,o[29]),D=d(D,A,R,E,y,14,o[30]),R=u(R,E=d(E,D,A,R,N,20,o[31]),D,A,x,4,o[32]),A=u(A,R,E,D,v,11,o[33]),D=u(D,A,R,E,w,16,o[34]),E=u(E,D,A,R,S,23,o[35]),R=u(R,E,D,A,l,4,o[36]),A=u(A,R,E,D,g,11,o[37]),D=u(D,A,R,E,y,16,o[38]),E=u(E,D,A,R,j,23,o[39]),R=u(R,E,D,A,C,4,o[40]),A=u(A,R,E,D,i,11,o[41]),D=u(D,A,R,E,p,16,o[42]),E=u(E,D,A,R,f,23,o[43]),R=u(R,E,D,A,b,4,o[44]),A=u(A,R,E,D,N,11,o[45]),D=u(D,A,R,E,k,16,o[46]),R=m(R,E=u(E,D,A,R,h,23,o[47]),D,A,i,6,o[48]),A=m(A,R,E,D,y,10,o[49]),D=m(D,A,R,E,S,15,o[50]),E=m(E,D,A,R,x,21,o[51]),R=m(R,E,D,A,N,6,o[52]),A=m(A,R,E,D,p,10,o[53]),D=m(D,A,R,E,j,15,o[54]),E=m(E,D,A,R,l,21,o[55]),R=m(R,E,D,A,v,6,o[56]),A=m(A,R,E,D,k,10,o[57]),D=m(D,A,R,E,f,15,o[58]),E=m(E,D,A,R,C,21,o[59]),R=m(R,E,D,A,g,6,o[60]),A=m(A,R,E,D,w,10,o[61]),D=m(D,A,R,E,h,15,o[62]),E=m(E,D,A,R,b,21,o[63]),n[0]=n[0]+R|0,n[1]=n[1]+E|0,n[2]=n[2]+D|0,n[3]=n[3]+A|0},_doFinalize:function(){var e=this._data,r=e.words,s=8*this._nDataBytes,a=8*e.sigBytes;r[a>>>5]|=128<<24-a%32;var n=t.floor(s/4294967296),i=s;r[15+(a+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),r[14+(a+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(r.length+1),this._process();for(var o=this._hash,l=o.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return o},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,r,s,a,n,i){var o=e+(t&r|~t&s)+a+i;return(o<<n|o>>>32-n)+t}function d(e,t,r,s,a,n,i){var o=e+(t&s|r&~s)+a+i;return(o<<n|o>>>32-n)+t}function u(e,t,r,s,a,n,i){var o=e+(t^r^s)+a+i;return(o<<n|o>>>32-n)+t}function m(e,t,r,s,a,n,i){var o=e+(r^(t|~s))+a+i;return(o<<n|o>>>32-n)+t}r.MD5=n._createHelper(l),r.HmacMD5=n._createHmacHelper(l)}(Math),e.MD5}(Dt())),qt.exports}var Yt,Xt={exports:{}};function Kt(){return Yt||(Yt=1,Xt.exports=function(e){return r=(t=e).lib,s=r.WordArray,a=r.Hasher,n=t.algo,i=[],o=n.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],a=r[1],n=r[2],o=r[3],l=r[4],c=0;c<80;c++){if(c<16)i[c]=0|e[t+c];else{var d=i[c-3]^i[c-8]^i[c-14]^i[c-16];i[c]=d<<1|d>>>31}var u=(s<<5|s>>>27)+l+i[c];u+=c<20?1518500249+(a&n|~a&o):c<40?1859775393+(a^n^o):c<60?(a&n|a&o|n&o)-1894007588:(a^n^o)-899497514,l=o,o=n,n=a<<30|a>>>2,a=s,s=u}r[0]=r[0]+s|0,r[1]=r[1]+a|0,r[2]=r[2]+n|0,r[3]=r[3]+o|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[14+(s+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(s+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=a._createHelper(o),t.HmacSHA1=a._createHmacHelper(o),e.SHA1;var t,r,s,a,n,i,o}(Dt())),Xt.exports}var Jt,Qt={exports:{}};function Zt(){return Jt||(Jt=1,Qt.exports=function(e){return function(t){var r=e,s=r.lib,a=s.WordArray,n=s.Hasher,i=r.algo,o=[],l=[];!function(){function e(e){for(var r=t.sqrt(e),s=2;s<=r;s++)if(!(e%s))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var s=2,a=0;a<64;)e(s)&&(a<8&&(o[a]=r(t.pow(s,.5))),l[a]=r(t.pow(s,1/3)),a++),s++}();var c=[],d=i.SHA256=n.extend({_doReset:function(){this._hash=new a.init(o.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],a=r[1],n=r[2],i=r[3],o=r[4],d=r[5],u=r[6],m=r[7],h=0;h<64;h++){if(h<16)c[h]=0|e[t+h];else{var p=c[h-15],g=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,x=c[h-2],f=(x<<15|x>>>17)^(x<<13|x>>>19)^x>>>10;c[h]=g+c[h-7]+f+c[h-16]}var y=s&a^s&n^a&n,v=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),b=m+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&d^~o&u)+l[h]+c[h];m=u,u=d,d=o,o=i+b|0,i=n,n=a,a=s,s=b+(v+y)|0}r[0]=r[0]+s|0,r[1]=r[1]+a|0,r[2]=r[2]+n|0,r[3]=r[3]+i|0,r[4]=r[4]+o|0,r[5]=r[5]+d|0,r[6]=r[6]+u|0,r[7]=r[7]+m|0},_doFinalize:function(){var e=this._data,r=e.words,s=8*this._nDataBytes,a=8*e.sigBytes;return r[a>>>5]|=128<<24-a%32,r[14+(a+64>>>9<<4)]=t.floor(s/4294967296),r[15+(a+64>>>9<<4)]=s,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});r.SHA256=n._createHelper(d),r.HmacSHA256=n._createHmacHelper(d)}(Math),e.SHA256}(Dt())),Qt.exports}var er,tr={exports:{}};var rr,sr={exports:{}};function ar(){return rr||(rr=1,sr.exports=function(e){return function(){var t=e,r=t.lib.Hasher,s=t.x64,a=s.Word,n=s.WordArray,i=t.algo;function o(){return a.create.apply(a,arguments)}var l=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=o()}();var d=i.SHA512=r.extend({_doReset:function(){this._hash=new n.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],a=r[1],n=r[2],i=r[3],o=r[4],d=r[5],u=r[6],m=r[7],h=s.high,p=s.low,g=a.high,x=a.low,f=n.high,y=n.low,v=i.high,b=i.low,j=o.high,w=o.low,N=d.high,C=d.low,S=u.high,k=u.low,R=m.high,E=m.low,D=h,A=p,P=g,B=x,z=f,I=y,_=v,T=b,M=j,F=w,O=N,L=C,H=S,U=k,W=R,$=E,G=0;G<80;G++){var q,V,Y=c[G];if(G<16)V=Y.high=0|e[t+2*G],q=Y.low=0|e[t+2*G+1];else{var X=c[G-15],K=X.high,J=X.low,Q=(K>>>1|J<<31)^(K>>>8|J<<24)^K>>>7,Z=(J>>>1|K<<31)^(J>>>8|K<<24)^(J>>>7|K<<25),ee=c[G-2],te=ee.high,re=ee.low,se=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ae=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ne=c[G-7],ie=ne.high,oe=ne.low,le=c[G-16],ce=le.high,de=le.low;V=(V=(V=Q+ie+((q=Z+oe)>>>0<Z>>>0?1:0))+se+((q+=ae)>>>0<ae>>>0?1:0))+ce+((q+=de)>>>0<de>>>0?1:0),Y.high=V,Y.low=q}var ue,me=M&O^~M&H,he=F&L^~F&U,pe=D&P^D&z^P&z,ge=A&B^A&I^B&I,xe=(D>>>28|A<<4)^(D<<30|A>>>2)^(D<<25|A>>>7),fe=(A>>>28|D<<4)^(A<<30|D>>>2)^(A<<25|D>>>7),ye=(M>>>14|F<<18)^(M>>>18|F<<14)^(M<<23|F>>>9),ve=(F>>>14|M<<18)^(F>>>18|M<<14)^(F<<23|M>>>9),be=l[G],je=be.high,we=be.low,Ne=W+ye+((ue=$+ve)>>>0<$>>>0?1:0),Ce=fe+ge;W=H,$=U,H=O,U=L,O=M,L=F,M=_+(Ne=(Ne=(Ne=Ne+me+((ue+=he)>>>0<he>>>0?1:0))+je+((ue+=we)>>>0<we>>>0?1:0))+V+((ue+=q)>>>0<q>>>0?1:0))+((F=T+ue|0)>>>0<T>>>0?1:0)|0,_=z,T=I,z=P,I=B,P=D,B=A,D=Ne+(xe+pe+(Ce>>>0<fe>>>0?1:0))+((A=ue+Ce|0)>>>0<ue>>>0?1:0)|0}p=s.low=p+A,s.high=h+D+(p>>>0<A>>>0?1:0),x=a.low=x+B,a.high=g+P+(x>>>0<B>>>0?1:0),y=n.low=y+I,n.high=f+z+(y>>>0<I>>>0?1:0),b=i.low=b+T,i.high=v+_+(b>>>0<T>>>0?1:0),w=o.low=w+F,o.high=j+M+(w>>>0<F>>>0?1:0),C=d.low=C+L,d.high=N+O+(C>>>0<L>>>0?1:0),k=u.low=k+U,u.high=S+H+(k>>>0<U>>>0?1:0),E=m.low=E+$,m.high=R+W+(E>>>0<$>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[30+(s+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(s+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});t.SHA512=r._createHelper(d),t.HmacSHA512=r._createHmacHelper(d)}(),e.SHA512}(Dt(),Bt())),sr.exports}var nr,ir={exports:{}};var or,lr={exports:{}};function cr(){return or||(or=1,lr.exports=function(e){return function(t){var r=e,s=r.lib,a=s.WordArray,n=s.Hasher,i=r.x64.Word,o=r.algo,l=[],c=[],d=[];!function(){for(var e=1,t=0,r=0;r<24;r++){l[e+5*t]=(r+1)*(r+2)/2%64;var s=(2*e+3*t)%5;e=t%5,t=s}for(e=0;e<5;e++)for(t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var a=1,n=0;n<24;n++){for(var o=0,u=0,m=0;m<7;m++){if(1&a){var h=(1<<m)-1;h<32?u^=1<<h:o^=1<<h-32}128&a?a=a<<1^113:a<<=1}d[n]=i.create(o,u)}}();var u=[];!function(){for(var e=0;e<25;e++)u[e]=i.create()}();var m=o.SHA3=n.extend({cfg:n.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new i.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,s=this.blockSize/2,a=0;a<s;a++){var n=e[t+2*a],i=e[t+2*a+1];n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),i=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),(E=r[a]).high^=i,E.low^=n}for(var o=0;o<24;o++){for(var m=0;m<5;m++){for(var h=0,p=0,g=0;g<5;g++)h^=(E=r[m+5*g]).high,p^=E.low;var x=u[m];x.high=h,x.low=p}for(m=0;m<5;m++){var f=u[(m+4)%5],y=u[(m+1)%5],v=y.high,b=y.low;for(h=f.high^(v<<1|b>>>31),p=f.low^(b<<1|v>>>31),g=0;g<5;g++)(E=r[m+5*g]).high^=h,E.low^=p}for(var j=1;j<25;j++){var w=(E=r[j]).high,N=E.low,C=l[j];C<32?(h=w<<C|N>>>32-C,p=N<<C|w>>>32-C):(h=N<<C-32|w>>>64-C,p=w<<C-32|N>>>64-C);var S=u[c[j]];S.high=h,S.low=p}var k=u[0],R=r[0];for(k.high=R.high,k.low=R.low,m=0;m<5;m++)for(g=0;g<5;g++){var E=r[j=m+5*g],D=u[j],A=u[(m+1)%5+5*g],P=u[(m+2)%5+5*g];E.high=D.high^~A.high&P.high,E.low=D.low^~A.low&P.low}E=r[0];var B=d[o];E.high^=B.high,E.low^=B.low}},_doFinalize:function(){var e=this._data,r=e.words;this._nDataBytes;var s=8*e.sigBytes,n=32*this.blockSize;r[s>>>5]|=1<<24-s%32,r[(t.ceil((s+1)/n)*n>>>5)-1]|=128,e.sigBytes=4*r.length,this._process();for(var i=this._state,o=this.cfg.outputLength/8,l=o/8,c=[],d=0;d<l;d++){var u=i[d],m=u.high,h=u.low;m=16711935&(m<<8|m>>>24)|4278255360&(m<<24|m>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),c.push(h),c.push(m)}return new a.init(c,o)},clone:function(){for(var e=n.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});r.SHA3=n._createHelper(m),r.HmacSHA3=n._createHmacHelper(m)}(Math),e.SHA3}(Dt(),Bt())),lr.exports}var dr,ur={exports:{}};var mr,hr={exports:{}};function pr(){return mr||(mr=1,hr.exports=function(e){var t,r,s;r=(t=e).lib.Base,s=t.enc.Utf8,t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,a=4*r;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),i=this._iKey=t.clone(),o=n.words,l=i.words,c=0;c<r;c++)o[c]^=1549556828,l[c]^=909522486;n.sigBytes=i.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})}(Dt())),hr.exports}var gr,xr={exports:{}};var fr,yr={exports:{}};function vr(){return fr||(fr=1,yr.exports=function(e){return r=(t=e).lib,s=r.Base,a=r.WordArray,n=t.algo,i=n.MD5,o=n.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:i,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,s=this.cfg,n=s.hasher.create(),i=a.create(),o=i.words,l=s.keySize,c=s.iterations;o.length<l;){r&&n.update(r),r=n.update(e).finalize(t),n.reset();for(var d=1;d<c;d++)r=n.finalize(r),n.reset();i.concat(r)}return i.sigBytes=4*l,i}}),t.EvpKDF=function(e,t,r){return o.create(r).compute(e,t)},e.EvpKDF;var t,r,s,a,n,i,o}(Dt(),Kt(),pr())),yr.exports}var br,jr={exports:{}};function wr(){return br||(br=1,jr.exports=function(e){e.lib.Cipher||function(t){var r=e,s=r.lib,a=s.Base,n=s.WordArray,i=s.BufferedBlockAlgorithm,o=r.enc;o.Utf8;var l=o.Base64,c=r.algo.EvpKDF,d=s.Cipher=i.extend({cfg:a.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?v:f}return function(t){return{encrypt:function(r,s,a){return e(s).encrypt(t,r,s,a)},decrypt:function(r,s,a){return e(s).decrypt(t,r,s,a)}}}}()});s.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var u=r.mode={},m=s.BlockCipherMode=a.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=u.CBC=function(){var e=m.extend();function r(e,r,s){var a,n=this._iv;n?(a=n,this._iv=t):a=this._prevBlock;for(var i=0;i<s;i++)e[r+i]^=a[i]}return e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,a=s.blockSize;r.call(this,e,t,a),s.encryptBlock(e,t),this._prevBlock=e.slice(t,t+a)}}),e.Decryptor=e.extend({processBlock:function(e,t){var s=this._cipher,a=s.blockSize,n=e.slice(t,t+a);s.decryptBlock(e,t),r.call(this,e,t,a),this._prevBlock=n}}),e}(),p=(r.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,s=r-e.sigBytes%r,a=s<<24|s<<16|s<<8|s,i=[],o=0;o<s;o+=4)i.push(a);var l=n.create(i,s);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};s.BlockCipher=d.extend({cfg:d.cfg.extend({mode:h,padding:p}),reset:function(){var e;d.reset.call(this);var t=this.cfg,r=t.iv,s=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=s.createEncryptor:(e=s.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(s,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var g=s.CipherParams=a.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),x=(r.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?n.create([1398893684,1701076831]).concat(r).concat(t):t).toString(l)},parse:function(e){var t,r=l.parse(e),s=r.words;return 1398893684==s[0]&&1701076831==s[1]&&(t=n.create(s.slice(2,4)),s.splice(0,4),r.sigBytes-=16),g.create({ciphertext:r,salt:t})}},f=s.SerializableCipher=a.extend({cfg:a.extend({format:x}),encrypt:function(e,t,r,s){s=this.cfg.extend(s);var a=e.createEncryptor(r,s),n=a.finalize(t),i=a.cfg;return g.create({ciphertext:n,key:r,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:s.format})},decrypt:function(e,t,r,s){return s=this.cfg.extend(s),t=this._parse(t,s.format),e.createDecryptor(r,s).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(r.kdf={}).OpenSSL={execute:function(e,t,r,s,a){if(s||(s=n.random(8)),a)i=c.create({keySize:t+r,hasher:a}).compute(e,s);else var i=c.create({keySize:t+r}).compute(e,s);var o=n.create(i.words.slice(t),4*r);return i.sigBytes=4*t,g.create({key:i,iv:o,salt:s})}},v=s.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:y}),encrypt:function(e,t,r,s){var a=(s=this.cfg.extend(s)).kdf.execute(r,e.keySize,e.ivSize,s.salt,s.hasher);s.iv=a.iv;var n=f.encrypt.call(this,e,t,a.key,s);return n.mixIn(a),n},decrypt:function(e,t,r,s){s=this.cfg.extend(s),t=this._parse(t,s.format);var a=s.kdf.execute(r,e.keySize,e.ivSize,t.salt,s.hasher);return s.iv=a.iv,f.decrypt.call(this,e,t,a.key,s)}})}()}(Dt(),vr())),jr.exports}var Nr,Cr={exports:{}};function Sr(){return Nr||(Nr=1,Cr.exports=function(e){return e.mode.CFB=function(){var t=e.lib.BlockCipherMode.extend();function r(e,t,r,s){var a,n=this._iv;n?(a=n.slice(0),this._iv=void 0):a=this._prevBlock,s.encryptBlock(a,0);for(var i=0;i<r;i++)e[t+i]^=a[i]}return t.Encryptor=t.extend({processBlock:function(e,t){var s=this._cipher,a=s.blockSize;r.call(this,e,t,a,s),this._prevBlock=e.slice(t,t+a)}}),t.Decryptor=t.extend({processBlock:function(e,t){var s=this._cipher,a=s.blockSize,n=e.slice(t,t+a);r.call(this,e,t,a,s),this._prevBlock=n}}),t}(),e.mode.CFB}(Dt(),wr())),Cr.exports}var kr,Rr={exports:{}};function Er(){return kr||(kr=1,Rr.exports=function(e){return e.mode.CTR=(t=e.lib.BlockCipherMode.extend(),r=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,s=r.blockSize,a=this._iv,n=this._counter;a&&(n=this._counter=a.slice(0),this._iv=void 0);var i=n.slice(0);r.encryptBlock(i,0),n[s-1]=n[s-1]+1|0;for(var o=0;o<s;o++)e[t+o]^=i[o]}}),t.Decryptor=r,t),e.mode.CTR;var t,r}(Dt(),wr())),Rr.exports}var Dr,Ar={exports:{}};function Pr(){return Dr||(Dr=1,Ar.exports=function(e){
/** @preserve
			 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
			 * derived from CryptoJS.mode.CTR
			 * Jan Hruby jhruby.web@gmail.com
			 */
return e.mode.CTRGladman=function(){var t=e.lib.BlockCipherMode.extend();function r(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,r=e>>8&255,s=255&e;255===t?(t=0,255===r?(r=0,255===s?s=0:++s):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=s}return e}function s(e){return 0===(e[0]=r(e[0]))&&(e[1]=r(e[1])),e}var a=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,n=this._iv,i=this._counter;n&&(i=this._counter=n.slice(0),this._iv=void 0),s(i);var o=i.slice(0);r.encryptBlock(o,0);for(var l=0;l<a;l++)e[t+l]^=o[l]}});return t.Decryptor=a,t}(),e.mode.CTRGladman}(Dt(),wr())),Ar.exports}var Br,zr={exports:{}};function Ir(){return Br||(Br=1,zr.exports=function(e){return e.mode.OFB=(t=e.lib.BlockCipherMode.extend(),r=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,s=r.blockSize,a=this._iv,n=this._keystream;a&&(n=this._keystream=a.slice(0),this._iv=void 0),r.encryptBlock(n,0);for(var i=0;i<s;i++)e[t+i]^=n[i]}}),t.Decryptor=r,t),e.mode.OFB;var t,r}(Dt(),wr())),zr.exports}var _r,Tr={exports:{}};var Mr,Fr={exports:{}};var Or,Lr={exports:{}};var Hr,Ur={exports:{}};var Wr,$r={exports:{}};var Gr,qr={exports:{}};var Vr,Yr={exports:{}};var Xr,Kr={exports:{}};var Jr,Qr={exports:{}};function Zr(){return Jr||(Jr=1,Qr.exports=function(e){return function(){var t=e,r=t.lib,s=r.WordArray,a=r.BlockCipher,n=t.algo,i=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],c=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=n.DES=a.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var s=i[r]-1;t[r]=e[s>>>5]>>>31-s%32&1}for(var a=this._subKeys=[],n=0;n<16;n++){var c=a[n]=[],d=l[n];for(r=0;r<24;r++)c[r/6|0]|=t[(o[r]-1+d)%28]<<31-r%6,c[4+(r/6|0)]|=t[28+(o[r+24]-1+d)%28]<<31-r%6;for(c[0]=c[0]<<1|c[0]>>>31,r=1;r<7;r++)c[r]=c[r]>>>4*(r-1)+3;c[7]=c[7]<<5|c[7]>>>27}var u=this._invSubKeys=[];for(r=0;r<16;r++)u[r]=a[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],m.call(this,4,252645135),m.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),m.call(this,1,1431655765);for(var s=0;s<16;s++){for(var a=r[s],n=this._lBlock,i=this._rBlock,o=0,l=0;l<8;l++)o|=c[l][((i^a[l])&d[l])>>>0];this._lBlock=i,this._rBlock=n^o}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,m.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),m.call(this,16,65535),m.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function m(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function h(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}t.DES=a._createHelper(u);var p=n.TripleDES=a.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),r=e.length<4?e.slice(0,2):e.slice(2,4),a=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=u.createEncryptor(s.create(t)),this._des2=u.createEncryptor(s.create(r)),this._des3=u.createEncryptor(s.create(a))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=a._createHelper(p)}(),e.TripleDES}(Dt(),Ht(),Vt(),vr(),wr())),Qr.exports}var es,ts={exports:{}};var rs,ss={exports:{}};var as,ns={exports:{}};var is,os={exports:{}};function ls(){return is||(is=1,os.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,s=t.algo;const a=16,n=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],i=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function l(e,t){let r=t>>24&255,s=t>>16&255,a=t>>8&255,n=255&t,i=e.sbox[0][r]+e.sbox[1][s];return i^=e.sbox[2][a],i+=e.sbox[3][n],i}function c(e,t,r){let s,n=t,i=r;for(let o=0;o<a;++o)n^=e.pbox[o],i=l(e,n)^i,s=n,n=i,i=s;return s=n,n=i,i=s,i^=e.pbox[a],n^=e.pbox[a+1],{left:n,right:i}}function d(e,t,r){let s,n=t,i=r;for(let o=a+1;o>1;--o)n^=e.pbox[o],i=l(e,n)^i,s=n,n=i,i=s;return s=n,n=i,i=s,i^=e.pbox[1],n^=e.pbox[0],{left:n,right:i}}function u(e,t,r){for(let a=0;a<4;a++){e.sbox[a]=[];for(let t=0;t<256;t++)e.sbox[a][t]=i[a][t]}let s=0;for(let i=0;i<a+2;i++)e.pbox[i]=n[i]^t[s],s++,s>=r&&(s=0);let o=0,l=0,d=0;for(let n=0;n<a+2;n+=2)d=c(e,o,l),o=d.left,l=d.right,e.pbox[n]=o,e.pbox[n+1]=l;for(let a=0;a<4;a++)for(let t=0;t<256;t+=2)d=c(e,o,l),o=d.left,l=d.right,e.sbox[a][t]=o,e.sbox[a][t+1]=l;return!0}var m=s.Blowfish=r.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4;u(o,t,r)}},encryptBlock:function(e,t){var r=c(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(e,t){var r=d(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},blockSize:2,keySize:4,ivSize:2});t.Blowfish=r._createHelper(m)}(),e.Blowfish}(Dt(),Ht(),Vt(),vr(),wr())),os.exports}var cs;var ds=(cs||(cs=1,St.exports=function(e){return e}(Dt(),Bt(),_t(),Ft(),Ht(),$t(),Vt(),Kt(),Zt(),er||(er=1,tr.exports=function(e){return r=(t=e).lib.WordArray,s=t.algo,a=s.SHA256,n=s.SHA224=a.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),t.SHA224=a._createHelper(n),t.HmacSHA224=a._createHmacHelper(n),e.SHA224;var t,r,s,a,n}(Dt(),Zt())),ar(),nr||(nr=1,ir.exports=function(e){return r=(t=e).x64,s=r.Word,a=r.WordArray,n=t.algo,i=n.SHA512,o=n.SHA384=i.extend({_doReset:function(){this._hash=new a.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=16,e}}),t.SHA384=i._createHelper(o),t.HmacSHA384=i._createHmacHelper(o),e.SHA384;var t,r,s,a,n,i,o}(Dt(),Bt(),ar())),cr(),dr||(dr=1,ur.exports=function(e){
/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/
return function(){var t=e,r=t.lib,s=r.WordArray,a=r.Hasher,n=t.algo,i=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),d=s.create([0,1518500249,1859775393,2400959708,2840853838]),u=s.create([1352829926,1548603684,1836072691,2053994217,0]),m=n.RIPEMD160=a.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var s=t+r,a=e[s];e[s]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}var n,m,v,b,j,w,N,C,S,k,R,E=this._hash.words,D=d.words,A=u.words,P=i.words,B=o.words,z=l.words,I=c.words;for(w=n=E[0],N=m=E[1],C=v=E[2],S=b=E[3],k=j=E[4],r=0;r<80;r+=1)R=n+e[t+P[r]]|0,R+=r<16?h(m,v,b)+D[0]:r<32?p(m,v,b)+D[1]:r<48?g(m,v,b)+D[2]:r<64?x(m,v,b)+D[3]:f(m,v,b)+D[4],R=(R=y(R|=0,z[r]))+j|0,n=j,j=b,b=y(v,10),v=m,m=R,R=w+e[t+B[r]]|0,R+=r<16?f(N,C,S)+A[0]:r<32?x(N,C,S)+A[1]:r<48?g(N,C,S)+A[2]:r<64?p(N,C,S)+A[3]:h(N,C,S)+A[4],R=(R=y(R|=0,I[r]))+k|0,w=k,k=S,S=y(C,10),C=N,N=R;R=E[1]+v+S|0,E[1]=E[2]+b+k|0,E[2]=E[3]+j+w|0,E[3]=E[4]+n+N|0,E[4]=E[0]+m+C|0,E[0]=R},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;t[s>>>5]|=128<<24-s%32,t[14+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var a=this._hash,n=a.words,i=0;i<5;i++){var o=n[i];n[i]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return a},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,r){return e^t^r}function p(e,t,r){return e&t|~e&r}function g(e,t,r){return(e|~t)^r}function x(e,t,r){return e&r|t&~r}function f(e,t,r){return e^(t|~r)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=a._createHelper(m),t.HmacRIPEMD160=a._createHmacHelper(m)}(),e.RIPEMD160}(Dt())),pr(),gr||(gr=1,xr.exports=function(e){return s=(r=(t=e).lib).Base,a=r.WordArray,i=(n=t.algo).SHA256,o=n.HMAC,l=n.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:i,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,s=o.create(r.hasher,e),n=a.create(),i=a.create([1]),l=n.words,c=i.words,d=r.keySize,u=r.iterations;l.length<d;){var m=s.update(t).finalize(i);s.reset();for(var h=m.words,p=h.length,g=m,x=1;x<u;x++){g=s.finalize(g),s.reset();for(var f=g.words,y=0;y<p;y++)h[y]^=f[y]}n.concat(m),c[0]++}return n.sigBytes=4*d,n}}),t.PBKDF2=function(e,t,r){return l.create(r).compute(e,t)},e.PBKDF2;var t,r,s,a,n,i,o,l}(Dt(),Zt(),pr())),vr(),wr(),Sr(),Er(),Pr(),Ir(),_r||(_r=1,Tr.exports=function(e){return e.mode.ECB=((t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t),e.mode.ECB;var t}(Dt(),wr())),Mr||(Mr=1,Fr.exports=function(e){return e.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,s=4*t,a=s-r%s,n=r+a-1;e.clamp(),e.words[n>>>2]|=a<<24-n%4*8,e.sigBytes+=a},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923}(Dt(),wr())),Or||(Or=1,Lr.exports=function(e){return e.pad.Iso10126={pad:function(t,r){var s=4*r,a=s-t.sigBytes%s;t.concat(e.lib.WordArray.random(a-1)).concat(e.lib.WordArray.create([a<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126}(Dt(),wr())),Hr||(Hr=1,Ur.exports=function(e){return e.pad.Iso97971={pad:function(t,r){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,r)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971}(Dt(),wr())),Wr||(Wr=1,$r.exports=function(e){return e.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},e.pad.ZeroPadding}(Dt(),wr())),Gr||(Gr=1,qr.exports=function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding}(Dt(),wr())),Vr||(Vr=1,Yr.exports=function(e){return r=(t=e).lib.CipherParams,s=t.enc.Hex,t.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return r.create({ciphertext:t})}},e.format.Hex;var t,r,s}(Dt(),wr())),Xr||(Xr=1,Kr.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,s=t.algo,a=[],n=[],i=[],o=[],l=[],c=[],d=[],u=[],m=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,s=0;for(t=0;t<256;t++){var p=s^s<<1^s<<2^s<<3^s<<4;p=p>>>8^255&p^99,a[r]=p,n[p]=r;var g=e[r],x=e[g],f=e[x],y=257*e[p]^16843008*p;i[r]=y<<24|y>>>8,o[r]=y<<16|y>>>16,l[r]=y<<8|y>>>24,c[r]=y,y=16843009*f^65537*x^257*g^16843008*r,d[p]=y<<24|y>>>8,u[p]=y<<16|y>>>16,m[p]=y<<8|y>>>24,h[p]=y,r?(r=g^e[e[e[f^g]]],s^=e[e[s]]):r=s=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],g=s.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,s=4*((this._nRounds=r+6)+1),n=this._keySchedule=[],i=0;i<s;i++)i<r?n[i]=t[i]:(c=n[i-1],i%r?r>6&&i%r==4&&(c=a[c>>>24]<<24|a[c>>>16&255]<<16|a[c>>>8&255]<<8|a[255&c]):(c=a[(c=c<<8|c>>>24)>>>24]<<24|a[c>>>16&255]<<16|a[c>>>8&255]<<8|a[255&c],c^=p[i/r|0]<<24),n[i]=n[i-r]^c);for(var o=this._invKeySchedule=[],l=0;l<s;l++){if(i=s-l,l%4)var c=n[i];else c=n[i-4];o[l]=l<4||i<=4?c:d[a[c>>>24]]^u[a[c>>>16&255]]^m[a[c>>>8&255]]^h[a[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,i,o,l,c,a)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,u,m,h,n),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,s,a,n,i,o){for(var l=this._nRounds,c=e[t]^r[0],d=e[t+1]^r[1],u=e[t+2]^r[2],m=e[t+3]^r[3],h=4,p=1;p<l;p++){var g=s[c>>>24]^a[d>>>16&255]^n[u>>>8&255]^i[255&m]^r[h++],x=s[d>>>24]^a[u>>>16&255]^n[m>>>8&255]^i[255&c]^r[h++],f=s[u>>>24]^a[m>>>16&255]^n[c>>>8&255]^i[255&d]^r[h++],y=s[m>>>24]^a[c>>>16&255]^n[d>>>8&255]^i[255&u]^r[h++];c=g,d=x,u=f,m=y}g=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[u>>>8&255]<<8|o[255&m])^r[h++],x=(o[d>>>24]<<24|o[u>>>16&255]<<16|o[m>>>8&255]<<8|o[255&c])^r[h++],f=(o[u>>>24]<<24|o[m>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^r[h++],y=(o[m>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&u])^r[h++],e[t]=g,e[t+1]=x,e[t+2]=f,e[t+3]=y},keySize:8});t.AES=r._createHelper(g)}(),e.AES}(Dt(),Ht(),Vt(),vr(),wr())),Zr(),es||(es=1,ts.exports=function(e){return function(){var t=e,r=t.lib.StreamCipher,s=t.algo,a=s.RC4=r.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,s=this._S=[],a=0;a<256;a++)s[a]=a;a=0;for(var n=0;a<256;a++){var i=a%r,o=t[i>>>2]>>>24-i%4*8&255;n=(n+s[a]+o)%256;var l=s[a];s[a]=s[n],s[n]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=n.call(this)},keySize:8,ivSize:0});function n(){for(var e=this._S,t=this._i,r=this._j,s=0,a=0;a<4;a++){r=(r+e[t=(t+1)%256])%256;var n=e[t];e[t]=e[r],e[r]=n,s|=e[(e[t]+e[r])%256]<<24-8*a}return this._i=t,this._j=r,s}t.RC4=r._createHelper(a);var i=s.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)n.call(this)}});t.RC4Drop=r._createHelper(i)}(),e.RC4}(Dt(),Ht(),Vt(),vr(),wr())),rs||(rs=1,ss.exports=function(e){return function(){var t=e,r=t.lib.StreamCipher,s=t.algo,a=[],n=[],i=[],o=s.Rabbit=r.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var s=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)l.call(this);for(r=0;r<8;r++)a[r]^=s[r+4&7];if(t){var n=t.words,i=n[0],o=n[1],c=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=c>>>16|4294901760&d,m=d<<16|65535&c;for(a[0]^=c,a[1]^=u,a[2]^=d,a[3]^=m,a[4]^=c,a[5]^=u,a[6]^=d,a[7]^=m,r=0;r<4;r++)l.call(this)}},_doProcessBlock:function(e,t){var r=this._X;l.call(this),a[0]=r[0]^r[5]>>>16^r[3]<<16,a[1]=r[2]^r[7]>>>16^r[5]<<16,a[2]=r[4]^r[1]>>>16^r[7]<<16,a[3]=r[6]^r[3]>>>16^r[1]<<16;for(var s=0;s<4;s++)a[s]=16711935&(a[s]<<8|a[s]>>>24)|4278255360&(a[s]<<24|a[s]>>>8),e[t+s]^=a[s]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,r=0;r<8;r++)n[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<n[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<n[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<n[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<n[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<n[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<n[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<n[6]>>>0?1:0)|0,this._b=t[7]>>>0<n[7]>>>0?1:0,r=0;r<8;r++){var s=e[r]+t[r],a=65535&s,o=s>>>16,l=((a*a>>>17)+a*o>>>15)+o*o,c=((4294901760&s)*s|0)+((65535&s)*s|0);i[r]=l^c}e[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,e[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,e[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,e[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,e[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,e[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,e[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,e[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}t.Rabbit=r._createHelper(o)}(),e.Rabbit}(Dt(),Ht(),Vt(),vr(),wr())),as||(as=1,ns.exports=function(e){return function(){var t=e,r=t.lib.StreamCipher,s=t.algo,a=[],n=[],i=[],o=s.RabbitLegacy=r.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],s=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var a=0;a<4;a++)l.call(this);for(a=0;a<8;a++)s[a]^=r[a+4&7];if(t){var n=t.words,i=n[0],o=n[1],c=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),d=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),u=c>>>16|4294901760&d,m=d<<16|65535&c;for(s[0]^=c,s[1]^=u,s[2]^=d,s[3]^=m,s[4]^=c,s[5]^=u,s[6]^=d,s[7]^=m,a=0;a<4;a++)l.call(this)}},_doProcessBlock:function(e,t){var r=this._X;l.call(this),a[0]=r[0]^r[5]>>>16^r[3]<<16,a[1]=r[2]^r[7]>>>16^r[5]<<16,a[2]=r[4]^r[1]>>>16^r[7]<<16,a[3]=r[6]^r[3]>>>16^r[1]<<16;for(var s=0;s<4;s++)a[s]=16711935&(a[s]<<8|a[s]>>>24)|4278255360&(a[s]<<24|a[s]>>>8),e[t+s]^=a[s]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,r=0;r<8;r++)n[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<n[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<n[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<n[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<n[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<n[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<n[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<n[6]>>>0?1:0)|0,this._b=t[7]>>>0<n[7]>>>0?1:0,r=0;r<8;r++){var s=e[r]+t[r],a=65535&s,o=s>>>16,l=((a*a>>>17)+a*o>>>15)+o*o,c=((4294901760&s)*s|0)+((65535&s)*s|0);i[r]=l^c}e[0]=i[0]+(i[7]<<16|i[7]>>>16)+(i[6]<<16|i[6]>>>16)|0,e[1]=i[1]+(i[0]<<8|i[0]>>>24)+i[7]|0,e[2]=i[2]+(i[1]<<16|i[1]>>>16)+(i[0]<<16|i[0]>>>16)|0,e[3]=i[3]+(i[2]<<8|i[2]>>>24)+i[1]|0,e[4]=i[4]+(i[3]<<16|i[3]>>>16)+(i[2]<<16|i[2]>>>16)|0,e[5]=i[5]+(i[4]<<8|i[4]>>>24)+i[3]|0,e[6]=i[6]+(i[5]<<16|i[5]>>>16)+(i[4]<<16|i[4]>>>16)|0,e[7]=i[7]+(i[6]<<8|i[6]>>>24)+i[5]|0}t.RabbitLegacy=r._createHelper(o)}(),e.RabbitLegacy}(Dt(),Ht(),Vt(),vr(),wr())),ls())),St.exports);const us=D(ds);class ms{static{this.ALGORITHM="AES"}static{this.ENCRYPTION_KEY="your-super-secret-key-here-32-chars"}static encrypt(e){if(!e)throw new Error("Cannot encrypt empty string");const t=us.lib.WordArray.random(16);return{encrypted:us.AES.encrypt(e,this.ENCRYPTION_KEY,{iv:t,mode:us.mode.CBC,padding:us.pad.Pkcs7}).toString(),iv:t.toString(),algorithm:this.ALGORITHM}}static decrypt(e){if(!e||!e.encrypted)throw new Error("Invalid encrypted field");try{const t=us.AES.decrypt(e.encrypted,this.ENCRYPTION_KEY,{iv:us.enc.Hex.parse(e.iv),mode:us.mode.CBC,padding:us.pad.Pkcs7}).toString(us.enc.Utf8);if(!t)throw new Error("Decryption failed - invalid key or corrupted data");return t}catch(t){throw new Error("Failed to decrypt data: "+t.message)}}static maskAccountNumber(e){if(!e||e.length<4)return"****";const t=e.slice(-4);return"*".repeat(Math.max(0,e.length-4))+t}static maskBranchCode(e){if(!e||e.length<2)return"***";const t=e.slice(-2);return"*".repeat(Math.max(0,e.length-2))+t}static isEncrypted(e){return"object"==typeof e&&null!==e&&"string"==typeof e.encrypted&&"string"==typeof e.iv&&"AES"===e.algorithm}static encryptBankingDetails(e){return{accountHolder:e.accountHolder,bank:e.bank,accountNumber:e.accountNumber?this.encrypt(e.accountNumber):"",branchCode:e.branchCode?this.encrypt(e.branchCode):""}}static decryptBankingDetails(e){return{accountHolder:e.accountHolder||"",bank:e.bank||"",accountNumber:e.accountNumber&&this.isEncrypted(e.accountNumber)?this.decrypt(e.accountNumber):e.accountNumber||"",branchCode:e.branchCode&&this.isEncrypted(e.branchCode)?this.decrypt(e.branchCode):e.branchCode||""}}static getMaskedBankingDetails(e){const t=this.decryptBankingDetails(e);return{accountHolder:t.accountHolder,bank:t.bank,accountNumber:this.maskAccountNumber(t.accountNumber),branchCode:this.maskBranchCode(t.branchCode)}}}ms.encrypt,ms.decrypt,ms.maskAccountNumber,ms.maskBranchCode;class hs{static async logAccess(e){const t=i.currentUser;if(t)try{const r=`${e.action}_${e.dataType}_${Date.now()}`,s={id:r,userId:t.uid,userEmail:t.email||"unknown",userAgent:navigator.userAgent,timestamp:I(),...e};try{const e=await fetch("https://api.ipify.org?format=json"),t=await e.json();s.ipAddress=t.ip}catch{s.ipAddress="unknown"}await _(T(a,"piiAccessLogs",r),s),e.action,e.dataType,t.email}catch(s){}else r.warn("Attempted to log PII access without authenticated user")}static async logBankingAccess(e,t,r){await this.logAccess({action:t,dataType:"banking",resellerId:e,fieldAccessed:"bankDetails",reason:r||"Business operations"})}static async logPersonalInfoAccess(e,t,r,s){await this.logAccess({action:t,dataType:"personal",targetUserId:e,fieldAccessed:r,reason:s||"User management"})}static async logSessionAccess(e,t,r){await this.logAccess({action:t,dataType:"session",targetUserId:e,fieldAccessed:"sessionData",reason:r||"Session management"})}static async logDataExport(e,t="Data export requested"){await this.logAccess({action:"export",dataType:e,reason:t})}}hs.logBankingAccess,hs.logPersonalInfoAccess,hs.logSessionAccess,hs.logDataExport;const ps={starter:{id:"starter",name:"Starter",price:29900,currency:"ZAR",employeeLimit:10,features:["Up to 10 employees","Basic warning management","PDF document generation","Email notifications","Basic reporting"]},professional:{id:"professional",name:"Professional",price:49900,currency:"ZAR",employeeLimit:50,features:["Up to 50 employees","Advanced warning workflows","Custom warning categories","WhatsApp notifications","Advanced reporting","Counselling management"]},enterprise:{id:"enterprise",name:"Enterprise",price:79900,currency:"ZAR",employeeLimit:200,features:["Up to 200 employees","Full HR disciplinary suite","Custom document templates","API access","Priority support","Advanced analytics"]},"enterprise-plus":{id:"enterprise-plus",name:"Enterprise Plus",price:129900,currency:"ZAR",employeeLimit:999999,features:["Unlimited employees","White-label branding","Multi-location support","Dedicated account manager","Custom integrations","On-site training"]}},gs={"western-cape":{name:"Western Cape"},gauteng:{name:"Gauteng"},"kwazulu-natal":{name:"KwaZulu-Natal"},"eastern-cape":{name:"Eastern Cape"},"free-state":{name:"Free State"},limpopo:{name:"Limpopo"},mpumalanga:{name:"Mpumalanga"},"northern-cape":{name:"Northern Cape"},"north-west":{name:"North West"}},xs=()=>{const[e,a]=k.useState([]),[n,i]=k.useState(!0),[l,c]=k.useState(!1),[d,u]=k.useState(null),[m,h]=k.useState("all"),[p,g]=k.useState({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}});k.useEffect(()=>{x()},[]);const x=async()=>{try{i(!0);const e=await s.getAllResellers(),t=await Promise.all(e.map(async e=>{const t=await Ct.getResellerMetrics(e.id);return{...e,metrics:t}}));a(t),r.success(`Loaded ${t.length} resellers`)}catch(e){r.error("Failed to load resellers:",e)}finally{i(!1)}},f=()=>{c(!1),u(null),g({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}})},y=()=>"all"===m?e:e.filter(e=>e.province===m),v=e=>`R${(e/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`;return n?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading reseller network..."})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reseller Network"}),t.jsx("p",{className:"text-gray-600",children:"Manage your provincial sales network"})]}),t.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[t.jsx(Q,{className:"w-4 h-4"}),"Add Reseller"]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Province:"}),t.jsxs("select",{value:m,onChange:e=>h(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[t.jsx("option",{value:"all",children:"All Provinces"}),Object.entries(gs).map(([e,r])=>t.jsx("option",{value:e,children:r.name},e))]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries((()=>{const t={};for(const r of e){const e=r.province;t[e]||(t[e]={resellers:0,clients:0,revenue:0}),t[e].resellers++,t[e].clients+=r.metrics.totalClients,t[e].revenue+=r.metrics.monthlyRecurringRevenue}return t})()).sort(([,e],[,t])=>t.revenue-e.revenue).slice(0,5).map(([e,r])=>t.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Z,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"font-medium text-sm",children:gs[e]?.name})]}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Resellers:"}),t.jsx("span",{className:"font-semibold",children:r.resellers})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Clients:"}),t.jsx("span",{className:"font-semibold",children:r.clients})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600",children:"Revenue:"}),t.jsx("span",{className:"font-semibold",children:v(r.revenue)})]})]})]},e))}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-semibold",children:["Resellers (",y().length,")"]})}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reseller"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Province"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clients"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monthly Revenue"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission Rate"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:y().map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),t.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(ee,{className:"w-3 h-3"}),e.email]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(te,{className:"w-3 h-3"}),e.phone]})]})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Z,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-sm font-medium",children:gs[e.province]?.name})]}),e.territory.length>0&&t.jsx("div",{className:"text-xs text-gray-500 mt-1",children:e.territory.join(", ")})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(re,{className:"w-4 h-4 text-blue-500"}),t.jsx("span",{className:"font-semibold",children:e.metrics.totalClients})]}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Avg: ",v(e.metrics.averageClientValue)]})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(se,{className:"w-4 h-4 text-green-500"}),t.jsx("span",{className:"font-semibold",children:v(e.metrics.monthlyRecurringRevenue)})]}),t.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[t.jsx(ae,{className:"w-3 h-3"}),"+",e.metrics.monthlyGrowth,"%"]})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("span",{className:"text-sm font-semibold",children:[(100*e.commissionRate).toFixed(0),"%"]}),t.jsxs("div",{className:"text-xs text-gray-500",children:["Earned: ",v(e.metrics.totalCommissions)]})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("button",{onClick:()=>(async e=>{try{await s.updateReseller(e.id,{isActive:!e.isActive,updatedAt:o.getServerTimestamp()}),r.success("Reseller "+(e.isActive?"deactivated":"activated")),await x()}catch(t){r.error("Failed to toggle reseller status:",t)}})(e),className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?t.jsxs(t.Fragment,{children:[t.jsx(ne,{className:"w-3 h-3"}),"Active"]}):t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"w-3 h-3"}),"Inactive"]})})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsx("button",{onClick:()=>(async e=>{try{try{await hs.logBankingAccess(e.id,"view","Editing reseller details")}catch(t){}const r=ms.decryptBankingDetails(e.bankDetails);e.firstName,e.lastName,e.commissionRate,e.commissionRate,u(e),g({firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone,province:e.province,territory:e.territory,commissionRate:e.commissionRate,bankDetails:r}),c(!0)}catch(s){r.error("Failed to decrypt banking details:",s),alert("Error loading banking details. Please contact support.")}})(e),className:"text-blue-600 hover:text-blue-800 mr-3",children:t.jsx(oe,{className:"w-4 h-4"})})})]},e.id))})]}),0===y().length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Q,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-600",children:"No resellers found"}),t.jsx("p",{className:"text-sm text-gray-500",children:"all"!==m?`No resellers in ${gs[m]?.name}`:"Add your first reseller to start building your network"})]})]})]}),l&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-auto",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"text-lg font-semibold",children:d?"Edit Reseller":"Add New Reseller"}),t.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-600",children:t.jsx(le,{className:"w-5 h-5"})})]}),!d&&t.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("p",{className:"text-sm text-blue-700",children:[t.jsx("strong",{children:"ℹ️ Account Creation:"})," A user account will be created with email login and password ",t.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"temp123"}),". The reseller should change this on first login."]})})]}),t.jsxs("form",{onSubmit:d?async e=>{if(e.preventDefault(),d)try{d.id;try{await hs.logBankingAccess(d.id,"edit","Updating reseller banking details")}catch(t){}const e=ms.encryptBankingDetails(p.bankDetails);await s.updateReseller(d.id,{firstName:p.firstName,lastName:p.lastName,email:p.email,phone:p.phone,province:p.province,territory:p.territory,commissionRate:p.commissionRate,bankDetails:e,updatedAt:o.getServerTimestamp()}),r.success("Reseller updated successfully"),u(null),await x()}catch(a){r.error("Failed to update reseller:",a)}}:async e=>{e.preventDefault();try{try{await hs.logBankingAccess("new-reseller","edit","Creating new reseller account")}catch(t){}const e=ms.encryptBankingDetails(p.bankDetails),n={firstName:p.firstName,lastName:p.lastName,email:p.email,phone:p.phone,province:p.province,territory:p.territory,commissionRate:p.commissionRate,isActive:!0,bankDetails:e,clientIds:[],totalClientsAcquired:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0},i=await s.createReseller(n);try{const{httpsCallable:e}=await z(async()=>{const{httpsCallable:e}=await import("./firebase-vendor-joTZaqfO.js").then(e=>e.Y);return{httpsCallable:e}},[]),{functions:t}=await z(async()=>{const{functions:e}=await import("./business-owner-dashboard-B1ObU6LN.js").then(e=>e.X);return{functions:e}},__vite__mapDeps([0,1,2,3,4])),s=e(t,"createResellerUser");await s({email:p.email,password:"temp123",displayName:`${p.firstName} ${p.lastName}`,resellerId:i,firstName:p.firstName,lastName:p.lastName}),r.success("Reseller user account created via Cloud Function")}catch(a){r.warn("Cloud Function not available, using fallback method:",a),r.error("Cannot create user account automatically due to CORS restriction"),alert(`\nRESELLER CREATED SUCCESSFULLY!\n\nHowever, the user account creation failed due to browser security restrictions.\n\nPlease create the Firebase Auth account manually:\n1. Go to Firebase Console > Authentication > Users  \n2. Add user: ${p.email}\n3. Password: temp123\n4. Display name: ${p.firstName} ${p.lastName}\n\nOr the reseller can register at the login page with their email and the password 'temp123'.\n\nThe reseller profile has been saved successfully with ID: ${i}\n        `.trim()),r.warn("Manual user account creation required for:",p.email)}r.success("Reseller and user account created successfully:",{resellerId:i,email:p.email}),g({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}}),c(!1),setTimeout(async()=>{try{await x()}catch(e){r.warn("Could not reload resellers automatically, refresh page manually")}},2e3)}catch(n){r.error("Failed to add reseller:",n)}},className:"p-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),t.jsx("input",{type:"text",value:p.firstName,onChange:e=>g(t=>({...t,firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),t.jsx("input",{type:"text",value:p.lastName,onChange:e=>g(t=>({...t,lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),t.jsx("input",{type:"email",value:p.email,onChange:e=>g(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),t.jsx("input",{type:"tel",value:p.phone,onChange:e=>g(t=>({...t,phone:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),t.jsx("select",{value:p.province,onChange:e=>g(t=>({...t,province:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(gs).map(([e,r])=>t.jsx("option",{value:e,children:r.name},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commission Rate"}),t.jsxs("select",{value:p.commissionRate.toFixed(2),onChange:e=>g(t=>({...t,commissionRate:parseFloat(e.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"0.50",children:"50% (Standard)"}),t.jsx("option",{value:"0.45",children:"45%"}),t.jsx("option",{value:"0.40",children:"40%"}),t.jsx("option",{value:"0.35",children:"35%"})]})]})]}),t.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"text-md font-semibold",children:"Banking Details"}),t.jsx("span",{className:"text-xs text-gray-500 italic",children:"(Optional - can be added later)"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Holder"}),t.jsx("input",{type:"text",value:p.bankDetails.accountHolder,onChange:e=>g(t=>({...t,bankDetails:{...t.bankDetails,accountHolder:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank"}),t.jsxs("select",{value:p.bankDetails.bank,onChange:e=>g(t=>({...t,bankDetails:{...t.bankDetails,bank:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"",children:"Select bank"}),t.jsx("option",{value:"ABSA",children:"ABSA"}),t.jsx("option",{value:"Standard Bank",children:"Standard Bank"}),t.jsx("option",{value:"FirstNational Bank",children:"FirstNational Bank"}),t.jsx("option",{value:"Nedbank",children:"Nedbank"}),t.jsx("option",{value:"Capitec",children:"Capitec"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number"}),t.jsx("input",{type:"text",value:p.bankDetails.accountNumber,onChange:e=>g(t=>({...t,bankDetails:{...t.bankDetails,accountNumber:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Code"}),t.jsx("input",{type:"text",value:p.bankDetails.branchCode,onChange:e=>g(t=>({...t,bankDetails:{...t.bankDetails,branchCode:e.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),t.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),t.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:d?"Update Reseller":"Add Reseller"})]})]})]})})]})},fs=Object.freeze(Object.defineProperty({__proto__:null,ResellerManagement:xs},Symbol.toStringTag,{value:"Module"}));class ys{static async getAuthToken(){const e=i.currentUser;if(!e)throw new Error("User not authenticated");return await e.getIdToken(!0)}static async makeAuthenticatedRequest(e,t={}){try{const r=await this.getAuthToken(),s=await fetch(`https://us-central1-hr-disciplinary-system.cloudfunctions.net/${e}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({data:t}),credentials:"include"});if(!s.ok){const e=await s.json();throw new Error(e.error?.message||`HTTP ${s.status}: ${s.statusText}`)}return(await s.json()).data}catch(s){throw r.error(`❌ Request to ${e} failed:`,s),s}}static async triggerManualCleanup(){try{const e=await this.makeAuthenticatedRequest("manualAudioCleanup");return r.success(2143),e}catch(e){if(r.error("❌ Manual cleanup failed:",e),e.message.includes("Access denied")||e.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Audio cleanup is restricted to super-users only");throw new Error(`Manual cleanup failed: ${e.message}`)}}static async getCleanupStats(){try{const e=await this.makeAuthenticatedRequest("getCleanupStats");return r.success(3047),e}catch(e){if(r.error("❌ Failed to fetch cleanup stats:",e),e.message.includes("Access denied")||e.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Cleanup statistics are restricted to super-users only");throw new Error(`Failed to fetch stats: ${e.message}`)}}static async getGlobalAudioStats(){try{const e=await this.makeAuthenticatedRequest("getGlobalAudioStats");return r.success(4130),e}catch(e){if(r.error("❌ Failed to fetch global audio stats:",e),e.message.includes("Access denied")||e.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Global audio statistics are restricted to super-users only");throw new Error(`Failed to fetch global stats: ${e.message}`)}}static async previewCleanup(){try{const e=await this.makeAuthenticatedRequest("previewAudioCleanup");return r.success(5312),e}catch(e){if(r.error("❌ Failed to preview cleanup:",e),e.message.includes("Access denied")||e.message.includes("PERMISSION_DENIED"))throw new Error("Access denied: Cleanup preview is restricted to super-users only");throw new Error(`Failed to preview cleanup: ${e.message}`)}}static async requestAudioDeletion(e){try{return e.warningId,e.reason,r.success(6517),!0}catch(t){throw r.error("❌ Audio deletion request failed:",t),new Error(`Deletion request failed: ${t.message}`)}}static formatCleanupSummary(e){if(!e.length)return{totalDeletions:0,averageProcessingTime:0,successRate:0,lastCleanupDate:null,recentErrors:[],totalOrganizationsProcessed:0,scheduledRuns:0,manualRuns:0};const t=e.reduce((e,t)=>e+t.result.successfulDeletions,0),r=e.reduce((e,t)=>e+t.result.processingTime,0)/e.length,s=e.reduce((e,t)=>e+t.result.successfulDeletions+t.result.failedDeletions,0),a=s>0?t/s*100:100,n=e[0]?.timestamp?new Date(e[0].timestamp).toLocaleDateString():null,i=e.flatMap(e=>e.result.errors).slice(0,5),o=e.reduce((e,t)=>e+t.result.organizationsProcessed.length,0),l=e.filter(e=>"scheduled"===e.result.triggerMethod).length,c=e.filter(e=>"manual"===e.result.triggerMethod).length;return{totalDeletions:t,averageProcessingTime:Math.round(r),successRate:Math.round(100*a)/100,lastCleanupDate:n,recentErrors:i,totalOrganizationsProcessed:o,scheduledRuns:l,manualRuns:c}}static async isCleanupHealthy(){try{const t=await this.getCleanupStats(),s=[],a=t.lastCleanup?new Date(t.lastCleanup):null,n=a?Math.floor((Date.now()-a.getTime())/864e5):999;if(n>2&&s.push(`Cleanup hasn't run for ${n} days`),t.recentAudits.length>0){const e=t.recentAudits[0],r=e.result.failedDeletions/(e.result.successfulDeletions+e.result.failedDeletions);r>.1&&s.push(`High error rate: ${Math.round(100*r)}% failures`)}try{const e=await this.previewCleanup();e.preview.totalExpired>50&&s.push(`${e.preview.totalExpired} expired audio files awaiting cleanup`)}catch(e){r.warn("Could not check for expired files:",e)}return{healthy:0===s.length,issues:s,lastCleanup:a,daysSinceLastCleanup:n,requiresAttention:s.length>0}}catch(e){return e.message.includes("Access denied")?{healthy:!1,issues:["Access denied: Super-user privileges required"],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}:{healthy:!1,issues:[`Failed to check cleanup health: ${e.message}`],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}}}static getCleanupScheduleInfo(){const e=new Date,t=new Date(e);return t.setUTCHours(2,0,0,0),e.getUTCHours()>=2&&t.setUTCDate(t.getUTCDate()+1),{frequency:"Daily",nextRun:t.toLocaleString(),timezone:"UTC",description:"Automatically deletes expired audio recordings across all organizations",scope:"Global (All Organizations)"}}static async verifySuperUserAccess(){try{return await this.getCleanupStats(),!0}catch(e){return!e.message.includes("Access denied")}}static async withRetry(e,t=2,r=1e3){let s;for(let n=0;n<=t;n++)try{return await e()}catch(a){if(s=a,a.message.includes("Access denied")||a.message.includes("UNAUTHENTICATED")||a.message.includes("PERMISSION_DENIED"))throw a;if(n===t)break;await new Promise(e=>setTimeout(e,r)),r*=1.5}throw s}static async getFullDashboardData(){try{const[e,t,r,s]=await Promise.allSettled([this.withRetry(()=>this.getCleanupStats()),this.withRetry(()=>this.getGlobalAudioStats()),this.withRetry(()=>this.previewCleanup()),this.withRetry(()=>this.isCleanupHealthy())]),a=this.getCleanupScheduleInfo();return{stats:"fulfilled"===e.status?e.value:{error:e.reason?.message},globalStats:"fulfilled"===t.status?t.value:{error:t.reason?.message},preview:"fulfilled"===r.status?r.value:{error:r.reason?.message},health:"fulfilled"===s.status?s.value:{error:s.reason?.message},schedule:a}}catch(e){throw r.error("❌ Failed to load dashboard data:",e),e}}}const vs=()=>{const[e,s]=k.useState(null),[a,n]=k.useState(null),[i,o]=k.useState(!0),[l,c]=k.useState(!1),[d,u]=k.useState(null);k.useEffect(()=>{m()},[]);const m=async()=>{try{o(!0),u(null);const[e,t]=await Promise.all([ys.getCleanupStats(),ys.isCleanupHealthy()]);s(e),n(t)}catch(e){u(e.message),r.error("Failed to load cleanup dashboard:",e)}finally{o(!1)}};if(i)return t.jsxs("div",{className:"flex items-center justify-center p-8",children:[t.jsx(ce,{className:"w-6 h-6 animate-spin text-blue-600"}),t.jsx("span",{className:"ml-2 text-gray-600",children:"Loading cleanup data..."})]});const h=e?ys.formatCleanupSummary(e.recentAudits):null,p=ys.getCleanupScheduleInfo();return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Audio Cleanup Management"}),t.jsx("p",{className:"text-gray-600",children:"Monitor and manage automated audio file deletion"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsxs("button",{onClick:m,disabled:i,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[t.jsx(ce,{className:"w-4 h-4 "+(i?"animate-spin":"")}),"Refresh"]}),t.jsxs("button",{onClick:async()=>{try{c(!0),u(null);const e=await ys.triggerManualCleanup();await m(),alert(`✅ Manual cleanup completed!\n\nDeleted: ${e.result.successfulDeletions} files\nScanned: ${e.result.totalScanned} warnings`)}catch(e){u(e.message),r.error("Manual cleanup failed:",e)}finally{c(!1)}},disabled:l,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:[t.jsx(de,{className:"w-4 h-4 "+(l?"animate-spin":"")}),l?"Running...":"Run Manual Cleanup"]})]})]}),d&&t.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[t.jsx(ue,{className:"w-5 h-5 text-red-600"}),t.jsx("span",{className:"text-red-700",children:d})]}),a&&t.jsxs("div",{className:"p-4 rounded-lg border "+(a.healthy?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.healthy?t.jsx(ne,{className:"w-5 h-5 text-green-600"}):t.jsx(ue,{className:"w-5 h-5 text-yellow-600"}),t.jsxs("h3",{className:"font-semibold "+(a.healthy?"text-green-900":"text-yellow-900"),children:["Cleanup System ",a.healthy?"Healthy":"Needs Attention"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600",children:"Last Cleanup:"}),t.jsx("p",{className:"font-medium",children:a.lastCleanup?a.lastCleanup.toLocaleString():"Never"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600",children:"Days Since Last Run:"}),t.jsx("p",{className:"font-medium",children:a.daysSinceLastCleanup})]})]}),a.issues.length>0&&t.jsxs("div",{className:"mt-3",children:[t.jsx("p",{className:"text-sm font-medium text-yellow-900 mb-1",children:"Issues:"}),t.jsx("ul",{className:"text-sm text-yellow-800 space-y-1",children:a.issues.map((e,r)=>t.jsxs("li",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"w-1 h-1 bg-yellow-600 rounded-full"}),e]},r))})]})]}),h&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(me,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Deletions"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.totalDeletions.toLocaleString()})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:t.jsx(ne,{className:"w-6 h-6 text-green-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Success Rate"}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.successRate,"%"]})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:t.jsx(he,{className:"w-6 h-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Avg Processing"}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.averageProcessingTime,"ms"]})]})]})}),t.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:t.jsx(pe,{className:"w-6 h-6 text-orange-600"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Last Cleanup"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:h.lastCleanupDate||"Never"})]})]})})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(ge,{className:"w-5 h-5"}),"Cleanup Schedule"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600",children:"Frequency:"}),t.jsx("p",{className:"font-medium",children:p.frequency})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600",children:"Next Run:"}),t.jsx("p",{className:"font-medium",children:p.nextRun})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600",children:"Timezone:"}),t.jsx("p",{className:"font-medium",children:p.timezone})]})]}),t.jsx("p",{className:"text-gray-600 mt-3 text-sm",children:p.description})]}),e&&e.recentAudits.length>0&&t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[t.jsx("div",{className:"p-6 border-b border-gray-200",children:t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(xe,{className:"w-5 h-5"}),"Recent Cleanup Logs"]})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Date"}),t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Scanned"}),t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Expired"}),t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Deleted"}),t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Failed"}),t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Processing"}),t.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Orgs"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:e.recentAudits.slice(0,10).map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4",children:new Date(e.timestamp).toLocaleDateString()}),t.jsx("td",{className:"px-6 py-4",children:e.result.totalScanned}),t.jsx("td",{className:"px-6 py-4",children:e.result.totalExpired}),t.jsx("td",{className:"px-6 py-4 text-green-600 font-medium",children:e.result.successfulDeletions}),t.jsx("td",{className:"px-6 py-4 text-red-600 font-medium",children:e.result.failedDeletions}),t.jsxs("td",{className:"px-6 py-4",children:[e.result.processingTime,"ms"]}),t.jsx("td",{className:"px-6 py-4",children:e.result.organizationsProcessed.length})]},e.id))})]})})]}),h&&h.recentErrors.length>0&&t.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(ue,{className:"w-5 h-5 text-red-600"}),"Recent Errors"]}),t.jsx("div",{className:"space-y-2",children:h.recentErrors.map((e,r)=>t.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsx("p",{className:"text-sm text-red-700",children:e})},r))})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(fe,{className:"w-6 h-6 text-blue-600 mt-1"}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Compliance & Data Protection"}),t.jsx("p",{className:"text-blue-800 text-sm mb-3",children:"Audio recordings are automatically deleted when warnings expire to ensure compliance with data protection regulations. All deletion activities are logged for audit purposes."}),t.jsxs("ul",{className:"text-blue-700 text-sm space-y-1",children:[t.jsx("li",{children:"• Audio files are deleted from Firebase Storage"}),t.jsx("li",{children:"• Warning documents remain with deletion metadata"}),t.jsx("li",{children:"• All deletion activities are audited and logged"}),t.jsx("li",{children:"• Manual cleanup can be triggered by administrators"})]})]})]})})]})};var bs,js="https://js.stripe.com",ws="".concat(js,"/").concat("basil","/stripe.js"),Ns=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Cs=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Ss=function(e){return Ns.test(e)||Cs.test(e)},ks=function(e){var t=document.createElement("script");t.src="".concat(ws).concat("");var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(t),t},Rs=null,Es=null,Ds=null,As=function(e){return null!==Rs?Rs:(Rs=new Promise(function(t,r){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)t(window.Stripe);else try{var s=function(){for(var e=document.querySelectorAll('script[src^="'.concat(js,'"]')),t=0;t<e.length;t++){var r=e[t];if(Ss(r.src))return r}return null}();if(s&&e);else if(s){if(s&&null!==Ds&&null!==Es){var a;s.removeEventListener("load",Ds),s.removeEventListener("error",Es),null===(a=s.parentNode)||void 0===a||a.removeChild(s),s=ks()}}else s=ks();Ds=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,r),Es=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(r),s.addEventListener("load",Ds),s.addEventListener("error",Es)}catch(n){return void r(n)}else t(null)})).catch(function(e){return Rs=null,Promise.reject(e)})};Promise.resolve().then(function(){return bs||(bs=As(null).catch(function(e){return bs=null,Promise.reject(e)}))}).catch(function(e){console.warn(e)});const Ps=Promise.resolve(null);const Bs=new class{constructor(){this.stripe=Ps,this.functions=$(),this.isDevelopment=true}async createSubscription(e){try{if(this.isDevelopment)return r.warn("Development mode: Returning mock Stripe session"),{sessionId:`cs_dev_${Date.now()}`,url:`${window.location.origin}/mock-checkout?plan=${e.planTier}&org=${e.organizationId}`};const t=G(this.functions,"createCheckoutSession"),s=(await t({organizationId:e.organizationId,planTier:e.planTier,customerEmail:e.customerEmail,customerName:e.customerName,resellerId:e.resellerId,successUrl:e.successUrl,cancelUrl:e.cancelUrl})).data;return r.success("Stripe checkout session created:",s),s}catch(t){throw r.error("Failed to create Stripe subscription:",t),t}}async updateSubscriptionTier(e,t,s){try{const a=G(this.functions,"updateSubscription"),n=(await a({subscriptionId:e,newTier:t,employeeCount:s})).data;return r.success("Subscription updated:",n),n}catch(a){throw r.error("Failed to update subscription:",a),a}}async cancelSubscription(e,t){try{const s=G(this.functions,"cancelSubscription"),a=(await s({subscriptionId:e,reason:t})).data;return r.success("Subscription canceled:",a),a}catch(s){throw r.error("Failed to cancel subscription:",s),s}}getRecommendedTier(e){return e<=10?"starter":e<=50?"professional":e<=200?"enterprise":"enterprise-plus"}needsUpgrade(e,t){const r=SUBSCRIPTION_PLANS[e],s=this.getRecommendedTier(t);return{needsUpgrade:e!==s,recommendedTier:e!==s?s:void 0,exceedsLimit:t>r.employeeLimit}}calculateProratedUpgrade(e,t,r){const s=SUBSCRIPTION_PLANS[e],a=(SUBSCRIPTION_PLANS[t].price-s.price)/30;return Math.round(a*r)}async createCustomerPortalSession(e,t){try{if(this.isDevelopment)return r.warn("Development mode: Returning mock customer portal URL"),{url:`${window.location.origin}/mock-portal?customer=${e}&return=${encodeURIComponent(t)}`};const s=G(this.functions,"createPortalSession"),a=(await s({customerId:e,returnUrl:t})).data;return r.success("Customer portal session created:",a),a}catch(s){throw r.error("Failed to create customer portal session:",s),s}}formatPrice(e){return`R${(e/100).toFixed(2)}`}getStatusDisplay(e){switch(e){case"active":return{text:"Active",color:"green"};case"past_due":return{text:"Payment Due",color:"yellow"};case"unpaid":return{text:"Payment Failed",color:"red"};case"canceled":return{text:"Canceled",color:"gray"};default:return{text:"Unknown",color:"gray"}}}validateSubscriptionLimits(e,t){const r=SUBSCRIPTION_PLANS[e.plan];if(t<=r.employeeLimit)return{isValid:!0};const s=t-r.employeeLimit;return{isValid:!1,message:`Your organization has ${t} employees but your ${r.name} plan only supports ${r.employeeLimit}. You are ${s} employees over the limit.`,suggestedAction:"upgrade"}}};class zs{static incrementVersion(e,t="minor"){const s=e.split(".").map(Number);let[a,n,i]=s;if(3!==s.length||s.some(isNaN))return r.warn(`⚠️ Invalid version format: ${e}, defaulting to 1.0.0`),"1.0.1";switch(t){case"patch":i+=1;break;case"minor":n+=1,i=0;break;case"major":a+=1,n=0,i=0}return`${a}.${n}.${i}`}static async saveTemplate(e,t,s){try{const n=T(a,"organizations",e),i=await q(n);let o=t.generatorVersion;const l=i.exists()?i.data()?.pdfSettings:null;if(l){const e=l.generatorVersion||"1.0.0",r=JSON.stringify(t.content)!==JSON.stringify(l.content)||JSON.stringify(t.sections)!==JSON.stringify(l.sections),s=JSON.stringify(t.styling)!==JSON.stringify(l.styling);o=r?this.incrementVersion(e,"minor"):s?this.incrementVersion(e,"patch"):e}const c={...t,generatorVersion:o,lastUpdated:new Date,updatedBy:s};c.versionHistory||(c.versionHistory=[]),c.versionHistory.push({version:o,activatedAt:new Date,activatedBy:s,previousVersion:l?.generatorVersion,reason:"Template updated via SuperAdmin dashboard"}),await U(n,{pdfSettings:c,updatedAt:new Date}),r.success("✅ PDF template saved successfully:",{organizationId:e,version:o,versionHistoryLength:c.versionHistory.length})}catch(n){throw r.error("❌ Failed to save PDF template:",n),new Error(`Failed to save PDF template: ${n instanceof Error?n.message:"Unknown error"}`)}}static getDefaultSettings(e="system"){return{generatorVersion:ut,lastUpdated:new Date,updatedBy:e,styling:{headerBackground:"#3B82F6",sectionHeaderColor:"#333333",bodyTextColor:"#000000",borderColor:"#C8C8C8",useBrandColors:!0,fontSize:11,fontFamily:"Helvetica",lineHeight:1.4,pageSize:"A4",margins:{top:20,bottom:20,left:20,right:20}},content:{showLogo:!0,logoPosition:"top-left",logoMaxHeight:20,enabledSections:["employee-info","incident","previous-warnings","consequences","rights","signatures"],showWatermark:!0,watermarkText:"CONFIDENTIAL",watermarkOpacity:.1,footerText:"Confidential & Privileged",showPageNumbers:!0,legalTextVersion:"south-africa-lra"},features:{enablePreviousWarnings:!0,enableConsequences:!0,enableEmployeeRights:!0,enableAppealSection:!0,enableSignatures:!0},sections:[{id:"previous-disciplinary-actions",type:"standard",name:"Previous Disciplinary Actions",enabled:!0,order:0,content:{heading:"PREVIOUS DISCIPLINARY ACTION (Still Valid on File)",body:"The following disciplinary actions are still active and valid on file:"},description:"Displays employee's previous warnings for progressive discipline tracking (gray box with numbered list)",isLocked:!1,requiredFields:[],createdAt:new Date,createdBy:e},{id:"consequences-section",type:"standard",name:"Consequences Section",enabled:!0,order:1,content:{heading:"WARNING: CONSEQUENCES IF EMPLOYEE\nDOES NOT CHANGE BEHAVIOUR",body:"Any further transgressions related or unrelated to the offences shall result in further disciplinary action which can lead to a disciplinary hearing and it can result in dismissal.",bulletPoints:[]},description:"Warning box about consequences of continued behavior (red warning box)",isLocked:!1,requiredFields:["issuedDate"],createdAt:new Date,createdBy:e},{id:"employee-rights-lra",type:"standard",name:"Employee Rights and Next Steps",enabled:!0,order:2,content:{heading:"EMPLOYEE RIGHTS AND NEXT STEPS",subsections:[{title:"Your Rights:",content:["• Right to Appeal: You may appeal this warning within 48 hours by submitting a written appeal to HR. If your internal appeal is unsuccessful, you may refer the matter to the CCMA within 30 days.","• Right to Representation: You have the right to be represented by a fellow employee or shop steward during disciplinary proceedings.","• Signing This Document: Your signature acknowledges that this warning has been explained to you. It does NOT mean you agree with the warning.","• Confidentiality: All information will be kept confidential and shared only with relevant management and HR personnel."]},{title:"What Happens Next:",content:["• This warning remains valid for {{validityPeriod}} months from the date of issue.","• During this period, similar conduct may result in further disciplinary action, up to and including dismissal.","• You are expected to demonstrate immediate and sustained improvement in your conduct."]},{title:"Important Notice:",content:"If you believe this warning is procedurally unfair or unjust, you have recourse through your company's internal appeal process or the Commission for Conciliation, Mediation and Arbitration (CCMA)."}]},description:"LRA-compliant employee rights section with next steps (legally required in South Africa)",isLocked:!0,requiredFields:["validityPeriod"],createdAt:new Date,createdBy:e},{id:"appeal-history",type:"standard",name:"Appeal History Section",enabled:!0,order:3,content:{heading:"Appeal Information",body:"If you wish to appeal this warning, you must submit your appeal in writing to {{organization.name}} within 7 days of receiving this document.",bulletPoints:["Appeals must be submitted in writing","Appeals must be received within 7 calendar days","State clear grounds for your appeal","Appeal will be reviewed by management not involved in original decision","Decision on appeal is final"]},description:"Information about the employee's right to appeal the warning",isLocked:!1,requiredFields:["organization.name"],createdAt:new Date,createdBy:e},{id:"signatures",type:"standard",name:"Signature Section",enabled:!0,order:4,content:{heading:"Acknowledgment of Receipt",body:"By signing below, you acknowledge receipt of this warning and confirm that you have been given an opportunity to respond.",bulletPoints:[]},description:"Signature blocks for manager and employee acknowledgment",isLocked:!1,requiredFields:[],createdAt:new Date,createdBy:e}],versionHistory:[{version:ut,activatedAt:new Date,activatedBy:e,reason:"Initial template creation"}],autoUpgrade:!0,betaFeatures:!1}}static async initializeForNewOrganization(e,t){try{const s=this.getDefaultSettings(t),n=T(a,"organizations",e);await U(n,{pdfSettings:s}),r.success("✅ PDF template initialized for new organization:",e)}catch(s){throw r.error("❌ Failed to initialize PDF template:",s),new Error(`Failed to initialize PDF template: ${s instanceof Error?s.message:"Unknown error"}`)}}static async migrateExistingOrganizations(e){try{const s={total:0,migrated:0,skipped:0,errors:0},n=M(a,"organizations"),i=await L(n);s.total=i.size,s.total;const o=H(a);let l=0;const c=500;for(const d of i.docs){const n=d.data();if(n.pdfSettings)s.skipped++,n.name;else try{const t=this.getDefaultSettings(e),r=T(a,"organizations",d.id);o.update(r,{pdfSettings:t,updatedAt:new Date}),l++,s.migrated++,l>=c&&(await o.commit(),l=0)}catch(t){s.errors++,r.error(`❌ Failed to migrate ${n.name}:`,t)}}return l>0&&await o.commit(),r.success("🎉 PDF template migration complete:",s),s}catch(t){throw r.error("❌ PDF template migration failed:",t),new Error(`Migration failed: ${t instanceof Error?t.message:"Unknown error"}`)}}static async cloneTemplate(e,t,s){try{const n=T(a,"organizations",e),i=await q(n);if(!i.exists())throw new Error(`Source organization ${e} not found`);const o=i.data();if(!o.pdfSettings)throw new Error("Source organization has no PDF settings to clone");const l={...o.pdfSettings,lastUpdated:new Date,updatedBy:s,versionHistory:[...o.pdfSettings.versionHistory||[],{version:o.pdfSettings.generatorVersion,activatedAt:new Date,activatedBy:s,reason:`Template cloned from organization ${e}`}]},c=T(a,"organizations",t);await U(c,{pdfSettings:l,updatedAt:new Date}),r.success("✅ PDF template cloned successfully:",{from:e,to:t})}catch(n){throw r.error("❌ Failed to clone PDF template:",n),new Error(`Failed to clone template: ${n instanceof Error?n.message:"Unknown error"}`)}}static async resetToDefaults(e,t){try{const s=this.getDefaultSettings(t),n=T(a,"organizations",e),i=await q(n);if(i.exists()){const e=i.data();e.pdfSettings?.versionHistory&&(s.versionHistory=[...e.pdfSettings.versionHistory,{version:ut,activatedAt:new Date,activatedBy:t,reason:"Template reset to system defaults"}])}await U(n,{pdfSettings:s,updatedAt:new Date}),r.success("✅ PDF template reset to defaults:",e)}catch(s){throw r.error("❌ Failed to reset PDF template:",s),new Error(`Failed to reset template: ${s instanceof Error?s.message:"Unknown error"}`)}}}class Is{static async createOrganization(e){let t=H(a);const s=e.id;try{e.name,e.adminUser.firstName,e.adminUser.lastName;const n=T(a,"organizations",s),l=zs.getDefaultSettings(i.currentUser?.uid||"system");l.generatorVersion;const c={id:s,name:e.name,industry:e.industry||"",province:e.province||"",city:e.city||"",contactEmail:e.contactEmail,contactPhone:e.contactPhone||"",employeeCount:e.employeeCount||0,subscriptionTier:e.subscriptionTier,subscriptionStatus:e.subscriptionStatus,resellerId:e.resellerId||null,branding:e.branding||{logoUrl:"",primaryColor:"#2563eb"},pdfSettings:l,createdAt:o.getServerTimestamp(),updatedAt:o.getServerTimestamp(),isActive:"active"===e.subscriptionStatus,databaseVersion:"2.0",shardingEnabled:!0,dataStructure:"sharded"};t.set(n,c),await this.initializeShardedCollections(s,t),await t.commit(),r.success(`✅ [SHARDED ORG] Organization ${s} created with sharded structure`),r.success(`✅ [SHARDED ORG] PDF template v${l.generatorVersion} initialized for ${s}`),await this.createDefaultCategories(s,e.customCategories||[]);return{organizationId:s,adminUserId:await this.createAdminUser(s,e.adminUser),success:!0}}catch(n){r.error("❌ [SHARDED ORG] Failed to create organization:",n);try{await this.cleanupFailedOrganization(s)}catch(l){r.error("Failed to cleanup failed organization:",l)}return{organizationId:s,adminUserId:"",success:!1,error:n instanceof Error?n.message:"Unknown error"}}}static async initializeShardedCollections(e,t){const r=["employees","warnings","categories","users","meetings","reports"];for(const n of r){const r=T(a,`organizations/${e}/${n}`,"_metadata");t.set(r,{collectionName:n,organizationId:e,createdAt:o.getServerTimestamp(),totalDocuments:0,lastUpdated:o.getServerTimestamp()})}const s=T(a,`organizations/${e}/settings`,"main");t.set(s,{organizationId:e,defaultWarningLevel:"verbal",requireWitnessSignature:!0,autoEscalation:!0,notificationSettings:{emailNotifications:!0,smsNotifications:!1,deliveryConfirmation:!0},customFields:[],createdAt:o.getServerTimestamp()})}static async createDefaultCategories(e,t=[]){if(t.some(e=>!0===e.isDefault)){t.length;for(const r of t)await n.createWarningCategory(r,e);return void r.success(`✅ [SHARDED ORG] Created ${t.length} categories for ${e}`)}l.length;const s=l.map(e=>({id:e.id,name:e.name,description:e.description,severity:e.severity,escalationPath:e.escalationPath,color:"minor"===e.severity?"#16a34a":"serious"===e.severity?"#ea580c":"#dc2626",isActive:!0,isDefault:!0,lraSection:e.lraSection,schedule8Reference:e.schedule8Reference,commonExamples:e.commonExamples,defaultValidityPeriod:e.defaultValidityPeriod,requiresImmediateAction:e.requiresImmediateAction||!1})),a=[...s],i=t.filter(e=>!e.isDefault);i.forEach((e,t)=>{"string"==typeof e?a.push({id:`custom-${t+1}`,name:e,description:`Custom category: ${e}`,severity:"minor",escalationPath:["counselling","verbal","first_written","final_written"],color:"#6366f1",isActive:!0,isDefault:!1}):a.push({...e,isDefault:!1})});for(const r of a)await n.createWarningCategory(r,e);r.success(`✅ [SHARDED ORG] Created ${a.length} categories for ${e} (${s.length} default + ${i.length} custom)`)}static async createAdminUser(e,t){try{const a=G(c,"createOrganizationAdmin"),n=(await a({email:t.email,password:t.password,firstName:t.firstName,lastName:t.lastName,role:t.role,organizationId:e,sendWelcomeEmail:!1,requirePasswordChange:!1})).data;if(!n.success)throw new Error(`Failed to create admin user: ${n.message}`);const i=n.uid,l={id:i,email:t.email,firstName:t.firstName,lastName:t.lastName,role:t.role,organizationId:e,isActive:!0,createdAt:o.getServerTimestamp(),lastLogin:null,permissions:{canManageEmployees:!0,canCreateWarnings:!0,canViewReports:!0,canManageUsers:!0,canManageSettings:!0}};await d.createDocument(e,"users",l,i);try{await u.setUserOrganization(i,e,"business-owner",t.email,"sharded")}catch(s){r.error("❌ Failed to create UserOrgIndex entry:",s)}return r.success(`✅ [SHARDED ORG] Admin user created: ${i}`),i}catch(a){if(a?.message?.includes("email-already-exists")||a?.message?.includes("already in use")){const e=`Email ${t.email} is already in use. Please use a different email address or contact support if this is your email.`;throw r.error(`❌ [SHARDED ORG] ${e}`),new Error(e)}throw r.error("❌ [SHARDED ORG] Failed to create admin user:",a),a}}static async cleanupFailedOrganization(e){try{const t=T(a,"organizations",e);await _(t,{},{merge:!1}),r.success(`✅ [SHARDED ORG] Cleanup completed for ${e}`)}catch(t){r.error("❌ [SHARDED ORG] Cleanup failed:",t)}}static async activateOrganization(e){try{const t=T(a,"organizations",e);await _(t,{subscriptionStatus:"active",isActive:!0,activatedAt:o.getServerTimestamp(),updatedAt:o.getServerTimestamp()},{merge:!0});const s=await d.queryDocuments(e,"users",[["role","==","business-owner"]]);if(s.documents.length>0){const t=s.documents[0];await d.updateDocument(e,"users",t.id,{isActive:!0,activatedAt:o.getServerTimestamp()})}r.success(`✅ [SHARDED ORG] Organization ${e} activated`)}catch(t){throw r.error("❌ [SHARDED ORG] Failed to activate organization:",t),t}}static async getShardedOrganization(e){try{T(a,"organizations",e);const t=await d.getDocument(e,"organizations",e);return t.exists?t.data:null}catch(t){return r.error("Failed to get sharded organization:",t),null}}static async migrateToShardedStructure(e){try{return r.warn(`🔄 [MIGRATION] Migrating organization to sharded structure: ${e}`),r.success(`✅ [MIGRATION] Organization ${e} ready for sharded structure`),!0}catch(t){return r.error("❌ [MIGRATION] Failed to migrate organization:",t),!1}}}const _s=()=>{const e={minor:"#10b981",serious:"#f59e0b",gross_misconduct:"#ef4444"};return l.map(t=>({id:t.id,name:t.name,description:t.description,icon:t.icon,level:t.escalationPath[0]||"verbal",color:e[t.severity],isActive:!0,isDefault:!0,escalationPath:t.escalationPath}))},Ts={counselling:"Counselling",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"},Ms=({category:e,onUpdate:r,onRemove:s})=>{const[a,n]=k.useState(!1),[i,o]=k.useState(e);k.useEffect(()=>{o(e)},[e]);const l=e=>{const t={...i,...e};o(t),r(t)},c=["counselling","verbal","first_written","second_written","final_written","suspension","dismissal"];return t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[i.icon&&t.jsx("span",{className:"text-lg",children:i.icon}),t.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:i.color}})]}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"font-medium text-gray-900",children:[i.name||"Unnamed Category",i.isDefault&&t.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Default"})]}),t.jsx("div",{className:"text-sm text-gray-600",children:i.description||"No description"}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Starting level: ",Ts[i.level]]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{type:"button",onClick:()=>n(!a),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",children:a?t.jsx(Re,{className:"w-4 h-4"}):t.jsx(Ee,{className:"w-4 h-4"})}),t.jsx("button",{type:"button",onClick:s,className:"p-2 text-red-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:i.isDefault?"Remove default category":"Remove custom category",children:t.jsx(me,{className:"w-4 h-4"})})]})]}),a&&t.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name"}),t.jsx("input",{type:"text",value:i.name,onChange:e=>l({name:e.target.value}),disabled:!1,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),t.jsx("select",{value:i.level,onChange:e=>l({level:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:c.map(e=>t.jsx("option",{value:e,children:Ts[e]},e))})]}),t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),t.jsx("textarea",{value:i.description,onChange:e=>l({description:e.target.value}),disabled:!1,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),t.jsx("input",{type:"color",value:i.color,onChange:e=>l({color:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),t.jsx("div",{className:"flex items-center",children:t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:i.isActive,onChange:e=>l({isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),t.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),t.jsx("div",{className:"grid grid-cols-8 gap-2 p-4 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(e=>t.jsx("button",{type:"button",onClick:()=>l({icon:e}),className:"w-12 h-12 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 "+(i.icon===e?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"),children:e},e))}),i.icon&&t.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",t.jsx("span",{className:"text-lg",children:i.icon})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Escalation Path",t.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Add, remove, or duplicate steps)"})]}),t.jsx("div",{className:"space-y-2 mb-4",children:i.escalationPath?.map((e,r)=>t.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[t.jsx("span",{className:"w-6 h-6 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-semibold",children:r+1}),t.jsx("span",{className:"flex-1 text-sm font-medium",children:Ts[e]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{type:"button",onClick:()=>{if(r>0){const e=[...i.escalationPath||[]];[e[r-1],e[r]]=[e[r],e[r-1]],l({escalationPath:e})}},disabled:0===r,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move up",children:"↑"}),t.jsx("button",{type:"button",onClick:()=>{if(r<(i.escalationPath?.length||0)-1){const e=[...i.escalationPath||[]];[e[r],e[r+1]]=[e[r+1],e[r]],l({escalationPath:e})}},disabled:r===(i.escalationPath?.length||0)-1,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move down",children:"↓"}),t.jsx("button",{type:"button",onClick:()=>{const t=[...i.escalationPath||[]];t.splice(r+1,0,e),l({escalationPath:t})},className:"w-6 h-6 flex items-center justify-center text-blue-500 hover:text-blue-700",title:"Duplicate this step",children:"⧨"}),t.jsx("button",{type:"button",onClick:()=>{const e=i.escalationPath?.filter((e,t)=>t!==r)||[];l({escalationPath:e})},disabled:(i.escalationPath?.length||0)<=1,className:"w-6 h-6 flex items-center justify-center text-red-500 hover:text-red-700 disabled:opacity-30",title:"Remove this step",children:"✕"})]})]},r))}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("select",{onChange:e=>{if(e.target.value){const t=[...i.escalationPath||[],e.target.value];l({escalationPath:t}),e.target.value=""}},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",defaultValue:"",children:[t.jsx("option",{value:"",children:"Add step..."}),c.filter(e=>"suspension"!==e&&"dismissal"!==e).map(e=>t.jsx("option",{value:e,children:Ts[e]},e))]}),t.jsx("span",{className:"text-xs text-gray-500",children:"Note: Escalation stops at Final Written. No suspension/dismissal steps needed."})]}),t.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This shows the progression path for repeated offenses in this category."})]})]})]})},Fs=({isOpen:e,onClose:a,onComplete:n})=>{const{user:i}=m(),[o,l]=k.useState(0),[c,d]=k.useState(!1),[u,x]=k.useState(null),[f,y]=k.useState([]),[v,b]=k.useState(null),j="reseller"===i?.role?.id,w="super-user"===i?.role?.id,N=()=>T[o]?.id,[C,S]=k.useState({companyName:"",employeeCount:15,selectedPlan:"professional",industry:"",province:"gauteng",city:"",contactPerson:"",contactEmail:"",contactPhone:"",resellerId:"",adminFirstName:"",adminLastName:"",adminEmail:"",adminPassword:"",adminPasswordConfirm:"",logoUrl:"",primaryColor:"#2563eb",secondaryColor:"#6366f1",accentColor:"#10b981",customCategories:_s()}),[R,E]=k.useState(null),[D,P]=k.useState(""),[B,I]=k.useState(!1),_=async e=>{if(!R)return"";try{I(!0);let t=R;"image/jpeg"!==R.type&&"image/jpg"!==R.type||(t=await(async e=>new Promise((t,r)=>{const s=new Image,a=document.createElement("canvas"),n=a.getContext("2d");s.onload=()=>{a.width=s.width,a.height=s.height,n?.drawImage(s,0,0),a.toBlob(e=>{e?t(e):r(new Error("Failed to convert image to PNG"))},"image/png")},s.onerror=()=>r(new Error("Failed to load image")),s.src=URL.createObjectURL(e)}))(R));const s=Date.now(),a=V(g,`organizations/${e}/logos/logo-${s}.png`);await Y(a,t);const n=await X(a);return r.success("✅ Logo uploaded successfully"),n}catch(t){throw r.error("Failed to upload logo:",t),t}finally{I(!1)}},T=[{id:"subscription",title:"Subscription & Payment",icon:ye},{id:"company",title:"Company Details",icon:ve},{id:"reseller",title:"Reseller Assignment",icon:re},{id:"admin",title:"Admin Setup",icon:Z},{id:"customize",title:"Customization",icon:be}];k.useEffect(()=>{if(e)if(M(),w){const e=Bs.getRecommendedTier(C.employeeCount);S(t=>({...t,selectedPlan:e}))}else j&&(S(e=>({...e,resellerId:i?.resellerId||"",selectedPlan:"professional",subscriptionTier:"professional"})),F())},[e,C.employeeCount,w,j,i]);const M=async()=>{try{const e=(await s.getAllResellers()).filter(e=>e.isActive),t=await Promise.all(e.map(async e=>{try{const t=await s.getResellerClients(e.id);return{...e,clientIds:t.map(e=>e.id)}}catch(t){return r.error(`Failed to load clients for reseller ${e.id}:`,t),e}}));y(t);const a=t.filter(e=>e.province===C.province);1===a.length&&S(e=>({...e,resellerId:a[0].id}))}catch(e){r.error("Failed to load resellers:",e)}},F=async()=>{if(i?.id&&j)try{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),r=await s.getResellerDeployments(i.id,t),a=r.length,n=r.length>0?new Date(r[0].createdAt):void 0;let o,l=!0;if(a>=10)l=!1,o="Monthly deployment limit reached (10)";else if(n){const t=(e.getTime()-n.getTime())/6e4;t<5&&(l=!1,o=`Rate limit: Please wait ${Math.ceil(5-t)} minutes between deployments`)}b({canDeploy:l,reason:o,deploymentsThisMonth:a,lastDeployment:n})}catch(e){r.error("Failed to check deployment status:",e),b({canDeploy:!1,reason:"Unable to verify deployment status",deploymentsThisMonth:0})}},O=e=>{S(t=>({...t,...e})),x(null)},L=()=>{switch(N()){case"subscription":return C.companyName.trim()?C.employeeCount<1?{isValid:!1,message:"Employee count must be at least 1"}:{isValid:!0}:{isValid:!1,message:"Company name is required"};case"company":return C.contactPerson.trim()?C.contactEmail.trim()?C.contactPhone.trim()?{isValid:!0}:{isValid:!1,message:"Contact phone is required"}:{isValid:!1,message:"Contact email is required"}:{isValid:!1,message:"Contact person is required"};case"reseller":return C.resellerId?{isValid:!0}:{isValid:!1,message:"Please select a reseller"};case"admin":return C.adminFirstName.trim()?C.adminLastName.trim()?C.adminEmail.trim()?{isValid:!0}:{isValid:!1,message:"Admin email is required"}:{isValid:!1,message:"Admin last name is required"}:{isValid:!1,message:"Admin first name is required"};default:return{isValid:!0}}},H=()=>f.filter(e=>e.province===C.province),U=e=>`R${(e/100).toFixed(2)}`;return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:h.modal},children:t.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:[t.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Deploy New Client"}),t.jsxs("p",{className:"text-gray-600",children:["Step ",o+1," of ",T.length,": ",T[o].title]})]}),t.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",disabled:c,children:"✕"})]}),t.jsx("div",{className:"flex items-center mt-4 space-x-2",children:T.map((e,r)=>t.jsxs(A.Fragment,{children:[t.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium "+(r<=o?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"),children:r<o?t.jsx(be,{className:"w-4 h-4"}):r+1}),r<T.length-1&&t.jsx("div",{className:"flex-1 h-2 rounded "+(r<o?"bg-blue-600":"bg-gray-200")})]},e.id))})]}),t.jsxs("div",{className:"px-6 py-6",children:[j&&v&&!v.canDeploy&&t.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ie,{className:"w-5 h-5 text-red-600"}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-red-900",children:"Deployment Temporarily Unavailable"}),t.jsx("p",{className:"text-red-700 text-sm mt-1",children:v.reason}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-red-600",children:"Deployments this month:"}),t.jsxs("div",{className:"font-semibold",children:[v.deploymentsThisMonth," / 10"]})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-red-600",children:"Last deployment:"}),t.jsx("div",{className:"font-semibold",children:v.lastDeployment?v.lastDeployment.toLocaleDateString("en-ZA"):"Never"})]})]})]})]})}),"subscription"===N()&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company & Subscription Details"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),t.jsx("input",{type:"text",value:C.companyName,onChange:e=>O({companyName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter company name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Employees *"}),t.jsx("input",{type:"number",min:"1",value:C.employeeCount,onChange:e=>O({employeeCount:parseInt(e.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"text-md font-semibold mb-4",children:"Select Subscription Plan"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(ps).map(([e,r])=>t.jsx("div",{className:"relative border rounded-lg p-4 cursor-pointer transition-all "+(C.selectedPlan===e?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"),onClick:()=>O({selectedPlan:e}),children:t.jsxs("div",{className:"text-center",children:[t.jsx("h5",{className:"font-semibold",children:r.name}),t.jsx("div",{className:"text-2xl font-bold text-blue-600 my-2",children:U(r.price)}),t.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"per month"}),t.jsxs("div",{className:"text-sm",children:["Up to ",999999===r.employeeLimit?"unlimited":r.employeeLimit," employees"]}),C.selectedPlan===e&&t.jsx(be,{className:"absolute top-2 right-2 w-5 h-5 text-blue-500"})]})},e))}),Bs.getRecommendedTier(C.employeeCount)!==C.selectedPlan&&t.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[t.jsx(ie,{className:"w-4 h-4"}),t.jsxs("span",{className:"text-sm",children:["Based on ",C.employeeCount," employees, we recommend the"," ",t.jsx("strong",{children:ps[Bs.getRecommendedTier(C.employeeCount)].name})," plan"]})]})})]})]}),"company"===N()&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company Details"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),t.jsxs("select",{value:C.industry,onChange:e=>O({industry:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"",children:"Select industry"}),t.jsxs("optgroup",{label:"Primary Industries",children:[t.jsx("option",{value:"agriculture",children:"Agriculture & Farming"}),t.jsx("option",{value:"mining",children:"Mining & Quarrying"}),t.jsx("option",{value:"forestry",children:"Forestry & Logging"}),t.jsx("option",{value:"fishing",children:"Fishing & Aquaculture"})]}),t.jsxs("optgroup",{label:"Manufacturing & Production",children:[t.jsx("option",{value:"manufacturing",children:"Manufacturing (General)"}),t.jsx("option",{value:"food-processing",children:"Food & Beverage Processing"}),t.jsx("option",{value:"textiles",children:"Textiles & Clothing"}),t.jsx("option",{value:"automotive",children:"Automotive Manufacturing"}),t.jsx("option",{value:"pharmaceuticals",children:"Pharmaceuticals & Medical Devices"}),t.jsx("option",{value:"chemicals",children:"Chemicals & Plastics"}),t.jsx("option",{value:"electronics",children:"Electronics & Technology Manufacturing"}),t.jsx("option",{value:"construction-materials",children:"Construction Materials"})]}),t.jsxs("optgroup",{label:"Construction & Engineering",children:[t.jsx("option",{value:"construction",children:"Construction & Building"}),t.jsx("option",{value:"civil-engineering",children:"Civil Engineering"}),t.jsx("option",{value:"electrical-engineering",children:"Electrical Engineering"}),t.jsx("option",{value:"mechanical-engineering",children:"Mechanical Engineering"}),t.jsx("option",{value:"architecture",children:"Architecture & Design"})]}),t.jsxs("optgroup",{label:"Retail & Wholesale",children:[t.jsx("option",{value:"retail",children:"Retail & Commerce (General)"}),t.jsx("option",{value:"wholesale",children:"Wholesale & Distribution"}),t.jsx("option",{value:"supermarkets",children:"Supermarkets & Grocery"}),t.jsx("option",{value:"fashion-retail",children:"Fashion & Apparel Retail"}),t.jsx("option",{value:"automotive-retail",children:"Automotive Sales & Service"}),t.jsx("option",{value:"furniture-retail",children:"Furniture & Home Goods"}),t.jsx("option",{value:"electronics-retail",children:"Electronics & Appliances Retail"})]}),t.jsxs("optgroup",{label:"Hospitality & Tourism",children:[t.jsx("option",{value:"hospitality",children:"Hospitality & Tourism"}),t.jsx("option",{value:"hotels",children:"Hotels & Accommodation"}),t.jsx("option",{value:"restaurants",children:"Restaurants & Food Service"}),t.jsx("option",{value:"travel-agencies",children:"Travel Agencies & Tour Operators"}),t.jsx("option",{value:"entertainment",children:"Entertainment & Recreation"})]}),t.jsxs("optgroup",{label:"Healthcare & Social Services",children:[t.jsx("option",{value:"healthcare",children:"Healthcare (General)"}),t.jsx("option",{value:"hospitals",children:"Hospitals & Clinics"}),t.jsx("option",{value:"nursing-homes",children:"Nursing Homes & Elderly Care"}),t.jsx("option",{value:"medical-practices",children:"Medical Practices & Specialists"}),t.jsx("option",{value:"veterinary",children:"Veterinary Services"}),t.jsx("option",{value:"social-services",children:"Social Services & NGOs"})]}),t.jsxs("optgroup",{label:"Education & Training",children:[t.jsx("option",{value:"education",children:"Education & Training"}),t.jsx("option",{value:"schools",children:"Schools & Colleges"}),t.jsx("option",{value:"universities",children:"Universities & Higher Education"}),t.jsx("option",{value:"vocational-training",children:"Vocational & Skills Training"}),t.jsx("option",{value:"childcare",children:"Childcare & Early Learning"})]}),t.jsxs("optgroup",{label:"Financial Services",children:[t.jsx("option",{value:"banking",children:"Banking & Financial Services"}),t.jsx("option",{value:"insurance",children:"Insurance"}),t.jsx("option",{value:"investment",children:"Investment & Asset Management"}),t.jsx("option",{value:"accounting",children:"Accounting & Auditing"}),t.jsx("option",{value:"real-estate",children:"Real Estate & Property Management"})]}),t.jsxs("optgroup",{label:"Professional Services",children:[t.jsx("option",{value:"legal",children:"Legal Services"}),t.jsx("option",{value:"consulting",children:"Consulting & Advisory"}),t.jsx("option",{value:"marketing",children:"Marketing & Advertising"}),t.jsx("option",{value:"hr-recruitment",children:"HR & Recruitment"}),t.jsx("option",{value:"business-services",children:"Business Support Services"})]}),t.jsxs("optgroup",{label:"Technology & Communications",children:[t.jsx("option",{value:"it-services",children:"IT Services & Software"}),t.jsx("option",{value:"telecommunications",children:"Telecommunications"}),t.jsx("option",{value:"media",children:"Media & Broadcasting"}),t.jsx("option",{value:"publishing",children:"Publishing & Printing"}),t.jsx("option",{value:"data-centers",children:"Data Centers & Cloud Services"})]}),t.jsxs("optgroup",{label:"Transportation & Logistics",children:[t.jsx("option",{value:"logistics",children:"Logistics & Supply Chain"}),t.jsx("option",{value:"transportation",children:"Transportation & Freight"}),t.jsx("option",{value:"warehousing",children:"Warehousing & Storage"}),t.jsx("option",{value:"courier",children:"Courier & Postal Services"}),t.jsx("option",{value:"aviation",children:"Aviation & Airports"}),t.jsx("option",{value:"maritime",children:"Maritime & Shipping"})]}),t.jsxs("optgroup",{label:"Energy & Utilities",children:[t.jsx("option",{value:"energy",children:"Energy & Power Generation"}),t.jsx("option",{value:"renewable-energy",children:"Renewable Energy"}),t.jsx("option",{value:"water-utilities",children:"Water & Sanitation"}),t.jsx("option",{value:"waste-management",children:"Waste Management & Recycling"})]}),t.jsxs("optgroup",{label:"Security & Emergency Services",children:[t.jsx("option",{value:"security",children:"Security Services"}),t.jsx("option",{value:"private-security",children:"Private Security & Guarding"}),t.jsx("option",{value:"emergency-services",children:"Emergency Services"}),t.jsx("option",{value:"fire-safety",children:"Fire Safety & Protection"})]}),t.jsxs("optgroup",{label:"Government & Public Sector",children:[t.jsx("option",{value:"government",children:"Government & Public Administration"}),t.jsx("option",{value:"municipal",children:"Municipal Services"}),t.jsx("option",{value:"public-utilities",children:"Public Utilities"})]}),t.jsxs("optgroup",{label:"Other",children:[t.jsx("option",{value:"sports",children:"Sports & Fitness"}),t.jsx("option",{value:"beauty-wellness",children:"Beauty & Wellness"}),t.jsx("option",{value:"cleaning",children:"Cleaning & Facilities Management"}),t.jsx("option",{value:"maintenance",children:"Maintenance & Repair Services"}),t.jsx("option",{value:"other",children:"Other Industry"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),t.jsx("select",{value:C.province,onChange:e=>O({province:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(gs).map(([e,r])=>t.jsx("option",{value:e,children:r.name},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City / Town"}),t.jsx("input",{type:"text",value:C.city,onChange:e=>O({city:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter city or town"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person *"}),t.jsx("input",{type:"text",value:C.contactPerson,onChange:e=>O({contactPerson:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Primary contact person"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email *"}),t.jsx("input",{type:"email",value:C.contactEmail,onChange:e=>O({contactEmail:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@company.com"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone *"}),t.jsx("input",{type:"tel",value:C.contactPhone,onChange:e=>O({contactPhone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 (0)11 123 4567"})]})]})]}),"reseller"===N()&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Assign Reseller"}),t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[t.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[t.jsx(re,{className:"w-5 h-5"}),t.jsxs("span",{className:"font-medium",children:["Available resellers in ",gs[C.province]?.name]})]}),t.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This reseller will receive 50% commission on monthly payments"})]}),t.jsxs("div",{className:"space-y-3",children:[H().map(e=>t.jsx("div",{className:"border rounded-lg p-4 cursor-pointer transition-all "+(C.resellerId===e.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"),onClick:()=>O({resellerId:e.id}),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium",children:[e.firstName," ",e.lastName]}),t.jsx("p",{className:"text-sm text-gray-600",children:e.email}),t.jsxs("p",{className:"text-sm text-gray-500",children:[e.clientIds?.length||0," active clients • Territory: ",e.territory?.join(", ")||"Not specified"]})]}),C.resellerId===e.id&&t.jsx(be,{className:"w-5 h-5 text-blue-500"})]})},e.id)),0===H().length&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),t.jsxs("p",{className:"text-gray-600",children:["No resellers available in ",gs[C.province]?.name]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Please contact support to set up resellers in this province"})]})]})]}),"admin"===N()&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Administrator Account"}),t.jsxs("form",{onSubmit:e=>e.preventDefault(),autoComplete:"off",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),t.jsx("input",{type:"text",value:C.adminFirstName,onChange:e=>O({adminFirstName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),t.jsx("input",{type:"text",value:C.adminLastName,onChange:e=>O({adminLastName:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),t.jsx("input",{type:"email",value:C.adminEmail,onChange:e=>O({adminEmail:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]})]}),t.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"flex-shrink-0 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold mt-0.5",children:"i"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-1",children:"Default Password"}),t.jsxs("p",{className:"text-sm text-blue-800",children:["A temporary password ",t.jsx("span",{className:"font-mono font-semibold",children:"temp123"})," will be set for this administrator. They will be prompted to change it on first login."]})]})]})}),t.jsx("div",{className:"hidden"})]})]}),"customize"===N()&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Branding & Category Configuration"}),t.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 bg-gray-50",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Company Logo"}),t.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Upload a JPG or PNG file (max 5MB). JPG files will be automatically converted to PNG."}),D?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"relative inline-block",children:[t.jsx("img",{src:D,alt:"Logo preview",className:"max-w-xs max-h-32 rounded-lg border-2 border-gray-200"}),t.jsx("button",{type:"button",onClick:()=>{E(null),P("")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:t.jsx(le,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[t.jsx(je,{className:"w-4 h-4"}),t.jsx("span",{children:R?.name}),R?.type.includes("jpeg")&&t.jsx("span",{className:"text-xs text-blue-600",children:"(will be converted to PNG)"})]})]}):t.jsxs("label",{className:"cursor-pointer",children:[t.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:async e=>{const t=e.target.files?.[0];if(!t)return;if(!["image/jpeg","image/jpg","image/png"].includes(t.type))return void alert("Please upload a JPG or PNG file");if(t.size>5242880)return void alert("File size must be less than 5MB");E(t);const r=new FileReader;r.onload=e=>{P(e.target?.result)},r.readAsDataURL(t)},className:"hidden"}),t.jsxs("div",{className:"flex flex-col items-center justify-center py-8 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors",children:[t.jsx(we,{className:"w-12 h-12 text-gray-400 mb-2"}),t.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Click to upload logo"}),t.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"JPG or PNG (max 5MB)"})]})]}),t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Or provide a logo URL:"}),t.jsx("input",{type:"url",value:C.logoUrl,onChange:e=>O({logoUrl:e.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com/logo.png",disabled:!!R})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),t.jsx("input",{type:"color",value:C.primaryColor,onChange:e=>O({primaryColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),t.jsx("input",{type:"color",value:C.secondaryColor,onChange:e=>O({secondaryColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Accent Color"}),t.jsx("input",{type:"color",value:C.accentColor,onChange:e=>O({accentColor:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]})]}),t.jsxs("div",{className:"border-t-4 border-blue-200 bg-blue-50 rounded-lg p-6 mt-8",children:[t.jsx("h4",{className:"text-xl font-bold text-blue-900 mb-2 flex items-center gap-2",children:"📋 Warning Categories Configuration"}),t.jsx("p",{className:"text-sm text-blue-800 mb-6 font-medium",children:"⚠️ IMPORTANT: Customize the disciplinary categories for your organization. You can edit, remove, or add categories and configure their escalation paths."}),t.jsxs("div",{className:"grid gap-4",children:[C.customCategories.map((e,r)=>t.jsx(Ms,{category:e,onUpdate:e=>{const t=[...C.customCategories];t[r]=e,O({customCategories:t})},onRemove:()=>{const e=C.customCategories.filter((e,t)=>t!==r);O({customCategories:e})}},e.id)),t.jsxs("button",{type:"button",onClick:()=>{const e={id:`custom-${Date.now()}`,name:"",description:"",level:"verbal",color:"#6366f1",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]};O({customCategories:[...C.customCategories,e]})},className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-center",children:[t.jsx(Ne,{className:"w-5 h-5 mx-auto mb-2 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-600",children:"Add Custom Category"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mt-6",children:[t.jsx("h4",{className:"font-semibold mb-4",children:"Deployment Summary"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Company:"})," ",C.companyName]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Plan:"})," ",ps[C.selectedPlan].name]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Monthly Cost:"})," ",U(ps[C.selectedPlan].price)]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Province:"})," ",gs[C.province]?.name]})]}),t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-4",children:t.jsxs("div",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"Revenue Breakdown (Monthly):"}),t.jsx("br",{}),"• Client pays: ",U(ps[C.selectedPlan].price),t.jsx("br",{}),"• Reseller commission (50%): ",U(Math.round(.5*ps[C.selectedPlan].price)),t.jsx("br",{}),"• Your income (30%): ",U(Math.round(.3*ps[C.selectedPlan].price)),t.jsx("br",{}),"• Company fund (20%): ",U(Math.round(.2*ps[C.selectedPlan].price))]})})]})]}),u&&t.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2 text-red-800",children:[t.jsx(ie,{className:"w-4 h-4"}),t.jsx("span",{children:u})]})]}),t.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[t.jsxs("button",{onClick:()=>{o>0&&(l(o-1),x(null))},disabled:0===o||c,className:"flex items-center gap-2 px-4 py-2 text-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed",children:[t.jsx(Ce,{className:"w-4 h-4"}),"Previous"]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:a,disabled:c,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:cursor-not-allowed",children:"Cancel"}),o===T.length-1?t.jsx("button",{onClick:async()=>{try{if(j&&v&&!v.canDeploy)return void x(v.reason||"Cannot deploy at this time");d(!0),x(null);const l=C.companyName.toLowerCase().replace(/[^a-z0-9]/g,"-");let c=C.logoUrl;if(R)try{c=await _(l),r.success("✅ Logo uploaded and converted to PNG")}catch(e){r.error("Failed to upload logo:",e)}const u="temp123",m=await Is.createOrganization({id:l,name:C.companyName,industry:C.industry,province:C.province,city:C.city,contactEmail:C.contactEmail,contactPhone:C.contactPhone,employeeCount:C.employeeCount,subscriptionTier:C.selectedPlan,subscriptionStatus:"active",resellerId:C.resellerId,branding:{logoUrl:c,primaryColor:C.primaryColor,secondaryColor:C.secondaryColor,accentColor:C.accentColor},adminUser:{firstName:C.adminFirstName,lastName:C.adminLastName,email:C.adminEmail,password:u,role:"business-owner"},customCategories:C.customCategories});if(!m.success)throw new Error(m.error||"Failed to create organization");r.success(`✅ Organization '${C.companyName}' deployed successfully!`),r.success(`📧 Admin email: ${C.adminEmail}`),r.success(`🔑 Admin password: ${u}`);try{await p.createDefaultDepartments(l),r.success("✅ Default departments created successfully")}catch(t){r.warn("⚠️ Could not create default departments (expected due to auth state)")}if(j&&i?.id)try{const e=await z(()=>import("./business-owner-dashboard-B1ObU6LN.js").then(e=>e.Y),__vite__mapDeps([0,1,2,3,4])).then(e=>e.TimeService.getServerTimestamp());await s.logResellerDeployment({resellerId:i.id,organizationId:l,organizationName:C.companyName,adminEmail:C.adminEmail,deployedAt:e,notes:"Deployed via unified wizard"}),r.success("✅ Reseller deployment logged successfully")}catch(o){r.error("Failed to log reseller deployment:",o)}alert(`🎉 Organization '${C.companyName}' created successfully!\n\n📧 Admin Login: ${C.adminEmail}\n🔑 Password: ${u}`),a(),n()}catch(e){r.error("❌ Deployment failed:",e),x(e instanceof Error?e.message:"Deployment failed")}finally{d(!1)}},disabled:!L().isValid||c,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:c?t.jsxs(t.Fragment,{children:[t.jsx(Se,{className:"w-4 h-4 animate-spin"}),"Processing Payment..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ye,{className:"w-4 h-4"}),"Deploy & Pay"]})}):t.jsxs("button",{onClick:()=>{const e=L();e.isValid?o<T.length-1&&(l(o+1),x(null),"reseller"===N()&&M()):x(e.message||"Please complete all required fields")},disabled:!L().isValid,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:["Next",t.jsx(ke,{className:"w-4 h-4"})]})]})]})]})}):null},Os=Object.freeze(Object.defineProperty({__proto__:null,EnhancedOrganizationWizard:Fs},Symbol.toStringTag,{value:"Module"}));const Ls="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement;function Hs(e){const t=Object.prototype.toString.call(e);return"[object Window]"===t||"[object global]"===t}function Us(e){return"nodeType"in e}function Ws(e){var t,r;return e?Hs(e)?e:Us(e)&&null!=(t=null==(r=e.ownerDocument)?void 0:r.defaultView)?t:window:window}function $s(e){const{Document:t}=Ws(e);return e instanceof t}function Gs(e){return!Hs(e)&&e instanceof Ws(e).HTMLElement}function qs(e){return e instanceof Ws(e).SVGElement}function Vs(e){return e?Hs(e)?e.document:Us(e)?$s(e)?e:Gs(e)||qs(e)?e.ownerDocument:document:document:document}const Ys=Ls?k.useLayoutEffect:k.useEffect;function Xs(e){const t=k.useRef(e);return Ys(()=>{t.current=e}),k.useCallback(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return null==t.current?void 0:t.current(...r)},[])}function Ks(e,t){void 0===t&&(t=[e]);const r=k.useRef(e);return Ys(()=>{r.current!==e&&(r.current=e)},t),r}function Js(e,t){const r=k.useRef();return k.useMemo(()=>{const t=e(r.current);return r.current=t,t},[...t])}function Qs(e){const t=Xs(e),r=k.useRef(null),s=k.useCallback(e=>{e!==r.current&&(null==t||t(e,r.current)),r.current=e},[]);return[r,s]}function Zs(e){const t=k.useRef();return k.useEffect(()=>{t.current=e},[e]),t.current}let ea={};function ta(e,t){return k.useMemo(()=>{if(t)return t;const r=null==ea[e]?0:ea[e]+1;return ea[e]=r,e+"-"+r},[e,t])}function ra(e){return function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return s.reduce((t,r)=>{const s=Object.entries(r);for(const[a,n]of s){const r=t[a];null!=r&&(t[a]=r+e*n)}return t},{...t})}}const sa=ra(1),aa=ra(-1);function na(e){if(!e)return!1;const{KeyboardEvent:t}=Ws(e.target);return t&&e instanceof t}function ia(e){if(function(e){if(!e)return!1;const{TouchEvent:t}=Ws(e.target);return t&&e instanceof t}(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:r}=e.touches[0];return{x:t,y:r}}if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:r}=e.changedTouches[0];return{x:t,y:r}}}return function(e){return"clientX"in e&&"clientY"in e}(e)?{x:e.clientX,y:e.clientY}:null}const oa=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:r}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:r}=e;return"scaleX("+t+") scaleY("+r+")"}},Transform:{toString(e){if(e)return[oa.Translate.toString(e),oa.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:r,easing:s}=e;return t+" "+r+"ms "+s}}}),la="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ca(e){return e.matches(la)?e:e.querySelector(la)}const da={display:"none"};function ua(e){let{id:t,value:r}=e;return A.createElement("div",{id:t,style:da},r)}function ma(e){let{id:t,announcement:r,ariaLiveType:s="assertive"}=e;return A.createElement("div",{id:t,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":s,"aria-atomic":!0},r)}const ha=k.createContext(null);const pa={draggable:"\n    To pick up a draggable item, press the space bar.\n    While dragging, use the arrow keys to move the item.\n    Press space again to drop the item in its new position, or press escape to cancel.\n  "},ga={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was moved over droppable area "+r.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:r}=e;return r?"Draggable item "+t.id+" was dropped over droppable area "+r.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function xa(e){let{announcements:t=ga,container:r,hiddenTextDescribedById:s,screenReaderInstructions:a=pa}=e;const{announce:n,announcement:i}=function(){const[e,t]=k.useState("");return{announce:k.useCallback(e=>{null!=e&&t(e)},[]),announcement:e}}(),o=ta("DndLiveRegion"),[l,c]=k.useState(!1);if(k.useEffect(()=>{c(!0)},[]),function(e){const t=k.useContext(ha);k.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}(k.useMemo(()=>({onDragStart(e){let{active:r}=e;n(t.onDragStart({active:r}))},onDragMove(e){let{active:r,over:s}=e;t.onDragMove&&n(t.onDragMove({active:r,over:s}))},onDragOver(e){let{active:r,over:s}=e;n(t.onDragOver({active:r,over:s}))},onDragEnd(e){let{active:r,over:s}=e;n(t.onDragEnd({active:r,over:s}))},onDragCancel(e){let{active:r,over:s}=e;n(t.onDragCancel({active:r,over:s}))}}),[n,t])),!l)return null;const d=A.createElement(A.Fragment,null,A.createElement(ua,{id:s,value:a.draggable}),A.createElement(ma,{id:o,announcement:i}));return r?P.createPortal(d,r):d}var fa;function ya(){}function va(e,t){return k.useMemo(()=>({sensor:e,options:null!=t?t:{}}),[e,t])}!function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"}(fa||(fa={}));const ba=Object.freeze({x:0,y:0});function ja(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function wa(e,t){let{data:{value:r}}=e,{data:{value:s}}=t;return r-s}function Na(e,t){let{data:{value:r}}=e,{data:{value:s}}=t;return s-r}function Ca(e){let{left:t,top:r,height:s,width:a}=e;return[{x:t,y:r},{x:t+a,y:r},{x:t,y:r+s},{x:t+a,y:r+s}]}function Sa(e,t){if(!e||0===e.length)return null;const[r]=e;return r[t]}function ka(e,t,r){return void 0===t&&(t=e.left),void 0===r&&(r=e.top),{x:t+.5*e.width,y:r+.5*e.height}}const Ra=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:s}=e;const a=ka(t,t.left,t.top),n=[];for(const i of s){const{id:e}=i,t=r.get(e);if(t){const r=ja(ka(t),a);n.push({id:e,data:{droppableContainer:i,value:r}})}}return n.sort(wa)};function Ea(e,t){const r=Math.max(t.top,e.top),s=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),n=Math.min(t.top+t.height,e.top+e.height),i=a-s,o=n-r;if(s<a&&r<n){const r=t.width*t.height,s=e.width*e.height,a=i*o;return Number((a/(r+s-a)).toFixed(4))}return 0}const Da=e=>{let{collisionRect:t,droppableRects:r,droppableContainers:s}=e;const a=[];for(const n of s){const{id:e}=n,s=r.get(e);if(s){const r=Ea(s,t);r>0&&a.push({id:e,data:{droppableContainer:n,value:r}})}}return a.sort(Na)};function Aa(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:ba}function Pa(e){return function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return s.reduce((t,r)=>({...t,top:t.top+e*r.y,bottom:t.bottom+e*r.y,left:t.left+e*r.x,right:t.right+e*r.x}),{...t})}}const Ba=Pa(1);const za={ignoreTransform:!1};function Ia(e,t){void 0===t&&(t=za);let r=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:t,transformOrigin:s}=Ws(e).getComputedStyle(e);t&&(r=function(e,t,r){const s=function(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}(t);if(!s)return e;const{scaleX:a,scaleY:n,x:i,y:o}=s,l=e.left-i-(1-a)*parseFloat(r),c=e.top-o-(1-n)*parseFloat(r.slice(r.indexOf(" ")+1)),d=a?e.width/a:e.width,u=n?e.height/n:e.height;return{width:d,height:u,top:c,right:l+d,bottom:c+u,left:l}}(r,t,s))}const{top:s,left:a,width:n,height:i,bottom:o,right:l}=r;return{top:s,left:a,width:n,height:i,bottom:o,right:l}}function _a(e){return Ia(e,{ignoreTransform:!0})}function Ta(e,t){const r=[];return e?function s(a){if(null!=t&&r.length>=t)return r;if(!a)return r;if($s(a)&&null!=a.scrollingElement&&!r.includes(a.scrollingElement))return r.push(a.scrollingElement),r;if(!Gs(a)||qs(a))return r;if(r.includes(a))return r;const n=Ws(e).getComputedStyle(a);return a!==e&&function(e,t){void 0===t&&(t=Ws(e).getComputedStyle(e));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(e=>{const s=t[e];return"string"==typeof s&&r.test(s)})}(a,n)&&r.push(a),function(e,t){return void 0===t&&(t=Ws(e).getComputedStyle(e)),"fixed"===t.position}(a,n)?r:s(a.parentNode)}(e):r}function Ma(e){const[t]=Ta(e,1);return null!=t?t:null}function Fa(e){return Ls&&e?Hs(e)?e:Us(e)?$s(e)||e===Vs(e).scrollingElement?window:Gs(e)?e:null:null:null}function Oa(e){return Hs(e)?e.scrollX:e.scrollLeft}function La(e){return Hs(e)?e.scrollY:e.scrollTop}function Ha(e){return{x:Oa(e),y:La(e)}}var Ua;function Wa(e){return!(!Ls||!e)&&e===document.scrollingElement}function $a(e){const t={x:0,y:0},r=Wa(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-r.width,y:e.scrollHeight-r.height};return{isTop:e.scrollTop<=t.y,isLeft:e.scrollLeft<=t.x,isBottom:e.scrollTop>=s.y,isRight:e.scrollLeft>=s.x,maxScroll:s,minScroll:t}}!function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"}(Ua||(Ua={}));const Ga={x:.2,y:.2};function qa(e,t,r,s,a){let{top:n,left:i,right:o,bottom:l}=r;void 0===s&&(s=10),void 0===a&&(a=Ga);const{isTop:c,isBottom:d,isLeft:u,isRight:m}=$a(e),h={x:0,y:0},p={x:0,y:0},g=t.height*a.y,x=t.width*a.x;return!c&&n<=t.top+g?(h.y=Ua.Backward,p.y=s*Math.abs((t.top+g-n)/g)):!d&&l>=t.bottom-g&&(h.y=Ua.Forward,p.y=s*Math.abs((t.bottom-g-l)/g)),!m&&o>=t.right-x?(h.x=Ua.Forward,p.x=s*Math.abs((t.right-x-o)/x)):!u&&i<=t.left+x&&(h.x=Ua.Backward,p.x=s*Math.abs((t.left+x-i)/x)),{direction:h,speed:p}}function Va(e){if(e===document.scrollingElement){const{innerWidth:e,innerHeight:t}=window;return{top:0,left:0,right:e,bottom:t,width:e,height:t}}const{top:t,left:r,right:s,bottom:a}=e.getBoundingClientRect();return{top:t,left:r,right:s,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Ya(e){return e.reduce((e,t)=>sa(e,Ha(t)),ba)}const Xa=[["x",["left","right"],function(e){return e.reduce((e,t)=>e+Oa(t),0)}],["y",["top","bottom"],function(e){return e.reduce((e,t)=>e+La(t),0)}]];class Ka{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=Ta(t),s=Ya(r);this.rect={...e},this.width=e.width,this.height=e.height;for(const[a,n,i]of Xa)for(const e of n)Object.defineProperty(this,e,{get:()=>{const t=i(r),n=s[a]-t;return this.rect[e]+n},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ja{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(e=>{var t;return null==(t=this.target)?void 0:t.removeEventListener(...e)})},this.target=e}add(e,t,r){var s;null==(s=this.target)||s.addEventListener(e,t,r),this.listeners.push([e,t,r])}}function Qa(e,t){const r=Math.abs(e.x),s=Math.abs(e.y);return"number"==typeof t?Math.sqrt(r**2+s**2)>t:"x"in t&&"y"in t?r>t.x&&s>t.y:"x"in t?r>t.x:"y"in t&&s>t.y}var Za,en;function tn(e){e.preventDefault()}function rn(e){e.stopPropagation()}!function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"}(Za||(Za={})),function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"}(en||(en={}));const sn={start:[en.Space,en.Enter],cancel:[en.Esc],end:[en.Space,en.Enter,en.Tab]},an=(e,t)=>{let{currentCoordinates:r}=t;switch(e.code){case en.Right:return{...r,x:r.x+25};case en.Left:return{...r,x:r.x-25};case en.Down:return{...r,y:r.y+25};case en.Up:return{...r,y:r.y-25}}};class nn{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Ja(Vs(t)),this.windowListeners=new Ja(Ws(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Za.Resize,this.handleCancel),this.windowListeners.add(Za.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Za.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,r=e.node.current;r&&function(e,t){if(void 0===t&&(t=Ia),!e)return;const{top:r,left:s,bottom:a,right:n}=t(e);Ma(e)&&(a<=0||n<=0||r>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}(r),t(ba)}handleKeyDown(e){if(na(e)){const{active:t,context:r,options:s}=this.props,{keyboardCodes:a=sn,coordinateGetter:n=an,scrollBehavior:i="smooth"}=s,{code:o}=e;if(a.end.includes(o))return void this.handleEnd(e);if(a.cancel.includes(o))return void this.handleCancel(e);const{collisionRect:l}=r.current,c=l?{x:l.left,y:l.top}:ba;this.referenceCoordinates||(this.referenceCoordinates=c);const d=n(e,{active:t,context:r.current,currentCoordinates:c});if(d){const t=aa(d,c),s={x:0,y:0},{scrollableAncestors:a}=r.current;for(const r of a){const a=e.code,{isTop:n,isRight:o,isLeft:l,isBottom:c,maxScroll:u,minScroll:m}=$a(r),h=Va(r),p={x:Math.min(a===en.Right?h.right-h.width/2:h.right,Math.max(a===en.Right?h.left:h.left+h.width/2,d.x)),y:Math.min(a===en.Down?h.bottom-h.height/2:h.bottom,Math.max(a===en.Down?h.top:h.top+h.height/2,d.y))},g=a===en.Right&&!o||a===en.Left&&!l,x=a===en.Down&&!c||a===en.Up&&!n;if(g&&p.x!==d.x){const e=r.scrollLeft+t.x,n=a===en.Right&&e<=u.x||a===en.Left&&e>=m.x;if(n&&!t.y)return void r.scrollTo({left:e,behavior:i});s.x=n?r.scrollLeft-e:a===en.Right?r.scrollLeft-u.x:r.scrollLeft-m.x,s.x&&r.scrollBy({left:-s.x,behavior:i});break}if(x&&p.y!==d.y){const e=r.scrollTop+t.y,n=a===en.Down&&e<=u.y||a===en.Up&&e>=m.y;if(n&&!t.x)return void r.scrollTo({top:e,behavior:i});s.y=n?r.scrollTop-e:a===en.Down?r.scrollTop-u.y:r.scrollTop-m.y,s.y&&r.scrollBy({top:-s.y,behavior:i});break}}this.handleMove(e,sa(aa(d,this.referenceCoordinates),s))}}}handleMove(e,t){const{onMove:r}=this.props;e.preventDefault(),r(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function on(e){return Boolean(e&&"distance"in e)}function ln(e){return Boolean(e&&"delay"in e)}nn.activators=[{eventName:"onKeyDown",handler:(e,t,r)=>{let{keyboardCodes:s=sn,onActivation:a}=t,{active:n}=r;const{code:i}=e.nativeEvent;if(s.start.includes(i)){const t=n.activatorNode.current;return(!t||e.target===t)&&(e.preventDefault(),null==a||a({event:e.nativeEvent}),!0)}return!1}}];class cn{constructor(e,t,r){var s;void 0===r&&(r=function(e){const{EventTarget:t}=Ws(e);return e instanceof t?e:Vs(e)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:a}=e,{target:n}=a;this.props=e,this.events=t,this.document=Vs(n),this.documentListeners=new Ja(this.document),this.listeners=new Ja(r),this.windowListeners=new Ja(Ws(n)),this.initialCoordinates=null!=(s=ia(a))?s:ba,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:r}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Za.Resize,this.handleCancel),this.windowListeners.add(Za.DragStart,tn),this.windowListeners.add(Za.VisibilityChange,this.handleCancel),this.windowListeners.add(Za.ContextMenu,tn),this.documentListeners.add(Za.Keydown,this.handleKeydown),t){if(null!=r&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(ln(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(on(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:r,onPending:s}=this.props;s(r,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Za.Click,rn,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Za.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:r,initialCoordinates:s,props:a}=this,{onMove:n,options:{activationConstraint:i}}=a;if(!s)return;const o=null!=(t=ia(e))?t:ba,l=aa(s,o);if(!r&&i){if(on(i)){if(null!=i.tolerance&&Qa(l,i.tolerance))return this.handleCancel();if(Qa(l,i.distance))return this.handleStart()}return ln(i)&&Qa(l,i.tolerance)?this.handleCancel():void this.handlePending(i,l)}e.cancelable&&e.preventDefault(),n(o)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===en.Esc&&this.handleCancel()}removeTextSelection(){var e;null==(e=this.document.getSelection())||e.removeAllRanges()}}const dn={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class un extends cn{constructor(e){const{event:t}=e,r=Vs(t.target);super(e,dn,r)}}un.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:s}=t;return!(!r.isPrimary||0!==r.button)&&(null==s||s({event:r}),!0)}}];const mn={move:{name:"mousemove"},end:{name:"mouseup"}};var hn;!function(e){e[e.RightClick=2]="RightClick"}(hn||(hn={}));(class extends cn{constructor(e){super(e,mn,Vs(e.event.target))}}).activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:s}=t;return r.button!==hn.RightClick&&(null==s||s({event:r}),!0)}}];const pn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};var gn,xn;function fn(e){let{acceleration:t,activator:r=gn.Pointer,canScroll:s,draggingRect:a,enabled:n,interval:i=5,order:o=xn.TreeOrder,pointerCoordinates:l,scrollableAncestors:c,scrollableAncestorRects:d,delta:u,threshold:m}=e;const h=function(e){let{delta:t,disabled:r}=e;const s=Zs(t);return Js(e=>{if(r||!s||!e)return yn;const a={x:Math.sign(t.x-s.x),y:Math.sign(t.y-s.y)};return{x:{[Ua.Backward]:e.x[Ua.Backward]||-1===a.x,[Ua.Forward]:e.x[Ua.Forward]||1===a.x},y:{[Ua.Backward]:e.y[Ua.Backward]||-1===a.y,[Ua.Forward]:e.y[Ua.Forward]||1===a.y}}},[r,t,s])}({delta:u,disabled:!n}),[p,g]=function(){const e=k.useRef(null);return[k.useCallback((t,r)=>{e.current=setInterval(t,r)},[]),k.useCallback(()=>{null!==e.current&&(clearInterval(e.current),e.current=null)},[])]}(),x=k.useRef({x:0,y:0}),f=k.useRef({x:0,y:0}),y=k.useMemo(()=>{switch(r){case gn.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case gn.DraggableRect:return a}},[r,a,l]),v=k.useRef(null),b=k.useCallback(()=>{const e=v.current;if(!e)return;const t=x.current.x*f.current.x,r=x.current.y*f.current.y;e.scrollBy(t,r)},[]),j=k.useMemo(()=>o===xn.TreeOrder?[...c].reverse():c,[o,c]);k.useEffect(()=>{if(n&&c.length&&y){for(const e of j){if(!1===(null==s?void 0:s(e)))continue;const r=c.indexOf(e),a=d[r];if(!a)continue;const{direction:n,speed:o}=qa(e,a,y,t,m);for(const e of["x","y"])h[e][n[e]]||(o[e]=0,n[e]=0);if(o.x>0||o.y>0)return g(),v.current=e,p(b,i),x.current=o,void(f.current=n)}x.current={x:0,y:0},f.current={x:0,y:0},g()}else g()},[t,b,s,g,n,i,JSON.stringify(y),JSON.stringify(h),p,c,j,d,JSON.stringify(m)])}(class extends cn{constructor(e){super(e,pn)}static setup(){return window.addEventListener(pn.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(pn.move.name,e)};function e(){}}}).activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:r}=e,{onActivation:s}=t;const{touches:a}=r;return!(a.length>1)&&(null==s||s({event:r}),!0)}}],function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"}(gn||(gn={})),function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"}(xn||(xn={}));const yn={x:{[Ua.Backward]:!1,[Ua.Forward]:!1},y:{[Ua.Backward]:!1,[Ua.Forward]:!1}};var vn,bn;!function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"}(vn||(vn={})),function(e){e.Optimized="optimized"}(bn||(bn={}));const jn=new Map;function wn(e,t){return Js(r=>e?r||("function"==typeof t?t(e):e):null,[t,e])}function Nn(e){let{callback:t,disabled:r}=e;const s=Xs(t),a=k.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.ResizeObserver)return;const{ResizeObserver:e}=window;return new e(s)},[r]);return k.useEffect(()=>()=>null==a?void 0:a.disconnect(),[a]),a}function Cn(e){return new Ka(Ia(e),e)}function Sn(e,t,r){void 0===t&&(t=Cn);const[s,a]=k.useState(null);function n(){a(s=>{if(!e)return null;var a;if(!1===e.isConnected)return null!=(a=null!=s?s:r)?a:null;const n=t(e);return JSON.stringify(s)===JSON.stringify(n)?s:n})}const i=function(e){let{callback:t,disabled:r}=e;const s=Xs(t),a=k.useMemo(()=>{if(r||"undefined"==typeof window||void 0===window.MutationObserver)return;const{MutationObserver:e}=window;return new e(s)},[s,r]);return k.useEffect(()=>()=>null==a?void 0:a.disconnect(),[a]),a}({callback(t){if(e)for(const r of t){const{type:t,target:s}=r;if("childList"===t&&s instanceof HTMLElement&&s.contains(e)){n();break}}}}),o=Nn({callback:n});return Ys(()=>{n(),e?(null==o||o.observe(e),null==i||i.observe(document.body,{childList:!0,subtree:!0})):(null==o||o.disconnect(),null==i||i.disconnect())},[e]),s}const kn=[];function Rn(e,t){void 0===t&&(t=[]);const r=k.useRef(null);return k.useEffect(()=>{r.current=null},t),k.useEffect(()=>{const t=e!==ba;t&&!r.current&&(r.current=e),!t&&r.current&&(r.current=null)},[e]),r.current?aa(e,r.current):ba}function En(e){return k.useMemo(()=>e?function(e){const t=e.innerWidth,r=e.innerHeight;return{top:0,left:0,right:t,bottom:r,width:t,height:r}}(e):null,[e])}const Dn=[];function An(e){let{measure:t}=e;const[r,s]=k.useState(null),a=k.useCallback(e=>{for(const{target:r}of e)if(Gs(r)){s(e=>{const s=t(r);return e?{...e,width:s.width,height:s.height}:s});break}},[t]),n=Nn({callback:a}),i=k.useCallback(e=>{const r=function(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Gs(t)?t:e}(e);null==n||n.disconnect(),r&&(null==n||n.observe(r)),s(r?t(r):null)},[t,n]),[o,l]=Qs(i);return k.useMemo(()=>({nodeRef:o,rect:r,setRef:l}),[r,o,l])}const Pn=[{sensor:un,options:{}},{sensor:nn,options:{}}],Bn={current:{}},zn={draggable:{measure:_a},droppable:{measure:_a,strategy:vn.WhileDragging,frequency:bn.Optimized},dragOverlay:{measure:Ia}};class In extends Map{get(e){var t;return null!=e&&null!=(t=super.get(e))?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,r;return null!=(t=null==(r=this.get(e))?void 0:r.node.current)?t:void 0}}const _n={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new In,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:ya},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:zn,measureDroppableContainers:ya,windowRect:null,measuringScheduled:!1},Tn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:ya,draggableNodes:new Map,over:null,measureDroppableContainers:ya},Mn=k.createContext(Tn),Fn=k.createContext(_n);function On(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new In}}}function Ln(e,t){switch(t.type){case fa.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case fa.DragMove:return null==e.draggable.active?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case fa.DragEnd:case fa.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case fa.RegisterDroppable:{const{element:r}=t,{id:s}=r,a=new In(e.droppable.containers);return a.set(s,r),{...e,droppable:{...e.droppable,containers:a}}}case fa.SetDroppableDisabled:{const{id:r,key:s,disabled:a}=t,n=e.droppable.containers.get(r);if(!n||s!==n.key)return e;const i=new In(e.droppable.containers);return i.set(r,{...n,disabled:a}),{...e,droppable:{...e.droppable,containers:i}}}case fa.UnregisterDroppable:{const{id:r,key:s}=t,a=e.droppable.containers.get(r);if(!a||s!==a.key)return e;const n=new In(e.droppable.containers);return n.delete(r),{...e,droppable:{...e.droppable,containers:n}}}default:return e}}function Hn(e){let{disabled:t}=e;const{active:r,activatorEvent:s,draggableNodes:a}=k.useContext(Mn),n=Zs(s),i=Zs(null==r?void 0:r.id);return k.useEffect(()=>{if(!t&&!s&&n&&null!=i){if(!na(n))return;if(document.activeElement===n.target)return;const e=a.get(i);if(!e)return;const{activatorNode:t,node:r}=e;if(!t.current&&!r.current)return;requestAnimationFrame(()=>{for(const e of[t.current,r.current]){if(!e)continue;const t=ca(e);if(t){t.focus();break}}})}},[s,t,a,i,n]),null}const Un=k.createContext({...ba,scaleX:1,scaleY:1});var Wn;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(Wn||(Wn={}));const $n=k.memo(function(e){var t,r,s,a;let{id:n,accessibility:i,autoScroll:o=!0,children:l,sensors:c=Pn,collisionDetection:d=Da,measuring:u,modifiers:m,...h}=e;const p=k.useReducer(Ln,void 0,On),[g,x]=p,[f,y]=function(){const[e]=k.useState(()=>new Set),t=k.useCallback(t=>(e.add(t),()=>e.delete(t)),[e]);return[k.useCallback(t=>{let{type:r,event:s}=t;e.forEach(e=>{var t;return null==(t=e[r])?void 0:t.call(e,s)})},[e]),t]}(),[v,b]=k.useState(Wn.Uninitialized),j=v===Wn.Initialized,{draggable:{active:w,nodes:N,translate:C},droppable:{containers:S}}=g,R=null!=w?N.get(w):null,E=k.useRef({initial:null,translated:null}),D=k.useMemo(()=>{var e;return null!=w?{id:w,data:null!=(e=null==R?void 0:R.data)?e:Bn,rect:E}:null},[w,R]),B=k.useRef(null),[z,I]=k.useState(null),[_,T]=k.useState(null),M=Ks(h,Object.values(h)),F=ta("DndDescribedBy",n),O=k.useMemo(()=>S.getEnabled(),[S]),L=(H=u,k.useMemo(()=>({draggable:{...zn.draggable,...null==H?void 0:H.draggable},droppable:{...zn.droppable,...null==H?void 0:H.droppable},dragOverlay:{...zn.dragOverlay,...null==H?void 0:H.dragOverlay}}),[null==H?void 0:H.draggable,null==H?void 0:H.droppable,null==H?void 0:H.dragOverlay]));var H;const{droppableRects:U,measureDroppableContainers:W,measuringScheduled:$}=function(e,t){let{dragging:r,dependencies:s,config:a}=t;const[n,i]=k.useState(null),{frequency:o,measure:l,strategy:c}=a,d=k.useRef(e),u=function(){switch(c){case vn.Always:return!1;case vn.BeforeDragging:return r;default:return!r}}(),m=Ks(u),h=k.useCallback(function(e){void 0===e&&(e=[]),m.current||i(t=>null===t?e:t.concat(e.filter(e=>!t.includes(e))))},[m]),p=k.useRef(null),g=Js(t=>{if(u&&!r)return jn;if(!t||t===jn||d.current!==e||null!=n){const t=new Map;for(let r of e){if(!r)continue;if(n&&n.length>0&&!n.includes(r.id)&&r.rect.current){t.set(r.id,r.rect.current);continue}const e=r.node.current,s=e?new Ka(l(e),e):null;r.rect.current=s,s&&t.set(r.id,s)}return t}return t},[e,n,r,u,l]);return k.useEffect(()=>{d.current=e},[e]),k.useEffect(()=>{u||h()},[r,u]),k.useEffect(()=>{n&&n.length>0&&i(null)},[JSON.stringify(n)]),k.useEffect(()=>{u||"number"!=typeof o||null!==p.current||(p.current=setTimeout(()=>{h(),p.current=null},o))},[o,u,h,...s]),{droppableRects:g,measureDroppableContainers:h,measuringScheduled:null!=n}}(O,{dragging:j,dependencies:[C.x,C.y],config:L.droppable}),G=function(e,t){const r=null!=t?e.get(t):void 0,s=r?r.node.current:null;return Js(e=>{var r;return null==t?null:null!=(r=null!=s?s:e)?r:null},[s,t])}(N,w),q=k.useMemo(()=>_?ia(_):null,[_]),V=function(){const e=!1===(null==z?void 0:z.autoScrollEnabled),t="object"==typeof o?!1===o.enabled:!1===o,r=j&&!e&&!t;if("object"==typeof o)return{...o,enabled:r};return{enabled:r}}(),Y=function(e,t){return wn(e,t)}(G,L.draggable.measure);!function(e){let{activeNode:t,measure:r,initialRect:s,config:a=!0}=e;const n=k.useRef(!1),{x:i,y:o}="boolean"==typeof a?{x:a,y:a}:a;Ys(()=>{if(!i&&!o||!t)return void(n.current=!1);if(n.current||!s)return;const e=null==t?void 0:t.node.current;if(!e||!1===e.isConnected)return;const a=Aa(r(e),s);if(i||(a.x=0),o||(a.y=0),n.current=!0,Math.abs(a.x)>0||Math.abs(a.y)>0){const t=Ma(e);t&&t.scrollBy({top:a.y,left:a.x})}},[t,i,o,s,r])}({activeNode:null!=w?N.get(w):null,config:V.layoutShiftCompensation,initialRect:Y,measure:L.draggable.measure});const X=Sn(G,L.draggable.measure,Y),K=Sn(G?G.parentElement:null),J=k.useRef({activatorEvent:null,active:null,activeNode:G,collisionRect:null,collisions:null,droppableRects:U,draggableNodes:N,draggingNode:null,draggingNodeRect:null,droppableContainers:S,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Q=S.getNodeFor(null==(t=J.current.over)?void 0:t.id),Z=An({measure:L.dragOverlay.measure}),ee=null!=(r=Z.nodeRef.current)?r:G,te=j?null!=(s=Z.rect)?s:X:null,re=Boolean(Z.nodeRef.current&&Z.rect),se=Aa(ae=re?null:X,wn(ae));var ae;const ne=En(ee?Ws(ee):null),ie=function(e){const t=k.useRef(e),r=Js(r=>e?r&&r!==kn&&e&&t.current&&e.parentNode===t.current.parentNode?r:Ta(e):kn,[e]);return k.useEffect(()=>{t.current=e},[e]),r}(j?null!=Q?Q:G:null),oe=function(e,t){void 0===t&&(t=Ia);const[r]=e,s=En(r?Ws(r):null),[a,n]=k.useState(Dn);function i(){n(()=>e.length?e.map(e=>Wa(e)?s:new Ka(t(e),e)):Dn)}const o=Nn({callback:i});return Ys(()=>{null==o||o.disconnect(),i(),e.forEach(e=>null==o?void 0:o.observe(e))},[e]),a}(ie),le=function(e,t){let{transform:r,...s}=t;return null!=e&&e.length?e.reduce((e,t)=>t({transform:e,...s}),r):r}(m,{transform:{x:C.x-se.x,y:C.y-se.y,scaleX:1,scaleY:1},activatorEvent:_,active:D,activeNodeRect:X,containerNodeRect:K,draggingNodeRect:te,over:J.current.over,overlayNodeRect:Z.rect,scrollableAncestors:ie,scrollableAncestorRects:oe,windowRect:ne}),ce=q?sa(q,C):null,de=function(e){const[t,r]=k.useState(null),s=k.useRef(e),a=k.useCallback(e=>{const t=Fa(e.target);t&&r(e=>e?(e.set(t,Ha(t)),new Map(e)):null)},[]);return k.useEffect(()=>{const t=s.current;if(e!==t){n(t);const i=e.map(e=>{const t=Fa(e);return t?(t.addEventListener("scroll",a,{passive:!0}),[t,Ha(t)]):null}).filter(e=>null!=e);r(i.length?new Map(i):null),s.current=e}return()=>{n(e),n(t)};function n(e){e.forEach(e=>{const t=Fa(e);null==t||t.removeEventListener("scroll",a)})}},[a,e]),k.useMemo(()=>e.length?t?Array.from(t.values()).reduce((e,t)=>sa(e,t),ba):Ya(e):ba,[e,t])}(ie),ue=Rn(de),me=Rn(de,[X]),he=sa(le,ue),pe=te?Ba(te,le):null,ge=D&&pe?d({active:D,collisionRect:pe,droppableRects:U,droppableContainers:O,pointerCoordinates:ce}):null,xe=Sa(ge,"id"),[fe,ye]=k.useState(null),ve=function(e,t,r){return{...e,scaleX:t&&r?t.width/r.width:1,scaleY:t&&r?t.height/r.height:1}}(re?le:sa(le,me),null!=(a=null==fe?void 0:fe.rect)?a:null,X),be=k.useRef(null),je=k.useCallback((e,t)=>{let{sensor:r,options:s}=t;if(null==B.current)return;const a=N.get(B.current);if(!a)return;const n=e.nativeEvent,i=new r({active:B.current,activeNode:a,event:n,options:s,context:J,onAbort(e){if(!N.get(e))return;const{onDragAbort:t}=M.current,r={id:e};null==t||t(r),f({type:"onDragAbort",event:r})},onPending(e,t,r,s){if(!N.get(e))return;const{onDragPending:a}=M.current,n={id:e,constraint:t,initialCoordinates:r,offset:s};null==a||a(n),f({type:"onDragPending",event:n})},onStart(e){const t=B.current;if(null==t)return;const r=N.get(t);if(!r)return;const{onDragStart:s}=M.current,a={activatorEvent:n,active:{id:t,data:r.data,rect:E}};P.unstable_batchedUpdates(()=>{null==s||s(a),b(Wn.Initializing),x({type:fa.DragStart,initialCoordinates:e,active:t}),f({type:"onDragStart",event:a}),I(be.current),T(n)})},onMove(e){x({type:fa.DragMove,coordinates:e})},onEnd:o(fa.DragEnd),onCancel:o(fa.DragCancel)});function o(e){return async function(){const{active:t,collisions:r,over:s,scrollAdjustedTranslate:a}=J.current;let i=null;if(t&&a){const{cancelDrop:o}=M.current;if(i={activatorEvent:n,active:t,collisions:r,delta:a,over:s},e===fa.DragEnd&&"function"==typeof o){await Promise.resolve(o(i))&&(e=fa.DragCancel)}}B.current=null,P.unstable_batchedUpdates(()=>{x({type:e}),b(Wn.Uninitialized),ye(null),I(null),T(null),be.current=null;const t=e===fa.DragEnd?"onDragEnd":"onDragCancel";if(i){const e=M.current[t];null==e||e(i),f({type:t,event:i})}})}}be.current=i},[N]),we=k.useCallback((e,t)=>(r,s)=>{const a=r.nativeEvent,n=N.get(s);if(null!==B.current||!n||a.dndKit||a.defaultPrevented)return;const i={active:n};!0===e(r,t.options,i)&&(a.dndKit={capturedBy:t.sensor},B.current=s,je(r,t))},[N,je]),Ne=function(e,t){return k.useMemo(()=>e.reduce((e,r)=>{const{sensor:s}=r;return[...e,...s.activators.map(e=>({eventName:e.eventName,handler:t(e.handler,r)}))]},[]),[e,t])}(c,we);!function(e){k.useEffect(()=>{if(!Ls)return;const t=e.map(e=>{let{sensor:t}=e;return null==t.setup?void 0:t.setup()});return()=>{for(const e of t)null==e||e()}},e.map(e=>{let{sensor:t}=e;return t}))}(c),Ys(()=>{X&&v===Wn.Initializing&&b(Wn.Initialized)},[X,v]),k.useEffect(()=>{const{onDragMove:e}=M.current,{active:t,activatorEvent:r,collisions:s,over:a}=J.current;if(!t||!r)return;const n={active:t,activatorEvent:r,collisions:s,delta:{x:he.x,y:he.y},over:a};P.unstable_batchedUpdates(()=>{null==e||e(n),f({type:"onDragMove",event:n})})},[he.x,he.y]),k.useEffect(()=>{const{active:e,activatorEvent:t,collisions:r,droppableContainers:s,scrollAdjustedTranslate:a}=J.current;if(!e||null==B.current||!t||!a)return;const{onDragOver:n}=M.current,i=s.get(xe),o=i&&i.rect.current?{id:i.id,rect:i.rect.current,data:i.data,disabled:i.disabled}:null,l={active:e,activatorEvent:t,collisions:r,delta:{x:a.x,y:a.y},over:o};P.unstable_batchedUpdates(()=>{ye(o),null==n||n(l),f({type:"onDragOver",event:l})})},[xe]),Ys(()=>{J.current={activatorEvent:_,active:D,activeNode:G,collisionRect:pe,collisions:ge,droppableRects:U,draggableNodes:N,draggingNode:ee,draggingNodeRect:te,droppableContainers:S,over:fe,scrollableAncestors:ie,scrollAdjustedTranslate:he},E.current={initial:te,translated:pe}},[D,G,ge,pe,N,ee,te,U,S,fe,ie,he]),fn({...V,delta:C,draggingRect:pe,pointerCoordinates:ce,scrollableAncestors:ie,scrollableAncestorRects:oe});const Ce=k.useMemo(()=>({active:D,activeNode:G,activeNodeRect:X,activatorEvent:_,collisions:ge,containerNodeRect:K,dragOverlay:Z,draggableNodes:N,droppableContainers:S,droppableRects:U,over:fe,measureDroppableContainers:W,scrollableAncestors:ie,scrollableAncestorRects:oe,measuringConfiguration:L,measuringScheduled:$,windowRect:ne}),[D,G,X,_,ge,K,Z,N,S,U,fe,W,ie,oe,L,$,ne]),Se=k.useMemo(()=>({activatorEvent:_,activators:Ne,active:D,activeNodeRect:X,ariaDescribedById:{draggable:F},dispatch:x,draggableNodes:N,over:fe,measureDroppableContainers:W}),[_,Ne,D,X,x,F,N,fe,W]);return A.createElement(ha.Provider,{value:y},A.createElement(Mn.Provider,{value:Se},A.createElement(Fn.Provider,{value:Ce},A.createElement(Un.Provider,{value:ve},l)),A.createElement(Hn,{disabled:!1===(null==i?void 0:i.restoreFocus)})),A.createElement(xa,{...i,hiddenTextDescribedById:F}))}),Gn=k.createContext(null),qn="button";function Vn(e){let{id:t,data:r,disabled:s=!1,attributes:a}=e;const n=ta("Draggable"),{activators:i,activatorEvent:o,active:l,activeNodeRect:c,ariaDescribedById:d,draggableNodes:u,over:m}=k.useContext(Mn),{role:h=qn,roleDescription:p="draggable",tabIndex:g=0}=null!=a?a:{},x=(null==l?void 0:l.id)===t,f=k.useContext(x?Un:Gn),[y,v]=Qs(),[b,j]=Qs(),w=function(e,t){return k.useMemo(()=>e.reduce((e,r)=>{let{eventName:s,handler:a}=r;return e[s]=e=>{a(e,t)},e},{}),[e,t])}(i,t),N=Ks(r);Ys(()=>(u.set(t,{id:t,key:n,node:y,activatorNode:b,data:N}),()=>{const e=u.get(t);e&&e.key===n&&u.delete(t)}),[u,t]);return{active:l,activatorEvent:o,activeNodeRect:c,attributes:k.useMemo(()=>({role:h,tabIndex:g,"aria-disabled":s,"aria-pressed":!(!x||h!==qn)||void 0,"aria-roledescription":p,"aria-describedby":d.draggable}),[s,h,g,x,p,d.draggable]),isDragging:x,listeners:s?void 0:w,node:y,over:m,setNodeRef:v,setActivatorNodeRef:j,transform:f}}const Yn={timeout:25};function Xn(e,t,r){const s=e.slice();return s.splice(r<0?s.length+r:r,0,s.splice(t,1)[0]),s}function Kn(e,t){return e.reduce((e,r,s)=>{const a=t.get(r);return a&&(e[s]=a),e},Array(e.length))}function Jn(e){return null!==e&&e>=0}const Qn=e=>{let{rects:t,activeIndex:r,overIndex:s,index:a}=e;const n=Xn(t,s,r),i=t[a],o=n[a];return o&&i?{x:o.left-i.left,y:o.top-i.top,scaleX:o.width/i.width,scaleY:o.height/i.height}:null},Zn={scaleX:1,scaleY:1},ei=e=>{var t;let{activeIndex:r,activeNodeRect:s,index:a,rects:n,overIndex:i}=e;const o=null!=(t=n[r])?t:s;if(!o)return null;if(a===r){const e=n[i];return e?{x:0,y:r<i?e.top+e.height-(o.top+o.height):e.top-o.top,...Zn}:null}const l=function(e,t,r){const s=e[t],a=e[t-1],n=e[t+1];if(!s)return 0;if(r<t)return a?s.top-(a.top+a.height):n?n.top-(s.top+s.height):0;return n?n.top-(s.top+s.height):a?s.top-(a.top+a.height):0}(n,a,r);return a>r&&a<=i?{x:0,y:-o.height-l,...Zn}:a<r&&a>=i?{x:0,y:o.height+l,...Zn}:{x:0,y:0,...Zn}};const ti="Sortable",ri=A.createContext({activeIndex:-1,containerId:ti,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Qn,disabled:{draggable:!1,droppable:!1}});function si(e){let{children:t,id:r,items:s,strategy:a=Qn,disabled:n=!1}=e;const{active:i,dragOverlay:o,droppableRects:l,over:c,measureDroppableContainers:d}=k.useContext(Fn),u=ta(ti,r),m=Boolean(null!==o.rect),h=k.useMemo(()=>s.map(e=>"object"==typeof e&&"id"in e?e.id:e),[s]),p=null!=i,g=i?h.indexOf(i.id):-1,x=c?h.indexOf(c.id):-1,f=k.useRef(h),y=!function(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}(h,f.current),v=-1!==x&&-1===g||y,b=function(e){return"boolean"==typeof e?{draggable:e,droppable:e}:e}(n);Ys(()=>{y&&p&&d(h)},[y,h,p,d]),k.useEffect(()=>{f.current=h},[h]);const j=k.useMemo(()=>({activeIndex:g,containerId:u,disabled:b,disableTransforms:v,items:h,overIndex:x,useDragOverlay:m,sortedRects:Kn(h,l),strategy:a}),[g,u,b.draggable,b.droppable,v,h,x,l,m,a]);return A.createElement(ri.Provider,{value:j},t)}const ai=e=>{let{id:t,items:r,activeIndex:s,overIndex:a}=e;return Xn(r,s,a).indexOf(t)},ni=e=>{let{containerId:t,isSorting:r,wasDragging:s,index:a,items:n,newIndex:i,previousItems:o,previousContainerId:l,transition:c}=e;return!(!c||!s)&&((o===n||a!==i)&&(!!r||i!==a&&t===l))},ii={duration:200,easing:"ease"},oi="transform",li=oa.Transition.toString({property:oi,duration:0,easing:"linear"}),ci={roleDescription:"sortable"};function di(e){let{animateLayoutChanges:t=ni,attributes:r,disabled:s,data:a,getNewIndex:n=ai,id:i,strategy:o,resizeObserverConfig:l,transition:c=ii}=e;const{items:d,containerId:u,activeIndex:m,disabled:h,disableTransforms:p,sortedRects:g,overIndex:x,useDragOverlay:f,strategy:y}=k.useContext(ri),v=function(e,t){var r,s;if("boolean"==typeof e)return{draggable:e,droppable:!1};return{draggable:null!=(r=null==e?void 0:e.draggable)?r:t.draggable,droppable:null!=(s=null==e?void 0:e.droppable)?s:t.droppable}}(s,h),b=d.indexOf(i),j=k.useMemo(()=>({sortable:{containerId:u,index:b,items:d},...a}),[u,a,b,d]),w=k.useMemo(()=>d.slice(d.indexOf(i)),[d,i]),{rect:N,node:C,isOver:S,setNodeRef:R}=function(e){let{data:t,disabled:r=!1,id:s,resizeObserverConfig:a}=e;const n=ta("Droppable"),{active:i,dispatch:o,over:l,measureDroppableContainers:c}=k.useContext(Mn),d=k.useRef({disabled:r}),u=k.useRef(!1),m=k.useRef(null),h=k.useRef(null),{disabled:p,updateMeasurementsFor:g,timeout:x}={...Yn,...a},f=Ks(null!=g?g:s),y=Nn({callback:k.useCallback(()=>{u.current?(null!=h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{c(Array.isArray(f.current)?f.current:[f.current]),h.current=null},x)):u.current=!0},[x]),disabled:p||!i}),v=k.useCallback((e,t)=>{y&&(t&&(y.unobserve(t),u.current=!1),e&&y.observe(e))},[y]),[b,j]=Qs(v),w=Ks(t);return k.useEffect(()=>{y&&b.current&&(y.disconnect(),u.current=!1,y.observe(b.current))},[b,y]),k.useEffect(()=>(o({type:fa.RegisterDroppable,element:{id:s,key:n,disabled:r,node:b,rect:m,data:w}}),()=>o({type:fa.UnregisterDroppable,key:n,id:s})),[s]),k.useEffect(()=>{r!==d.current.disabled&&(o({type:fa.SetDroppableDisabled,id:s,key:n,disabled:r}),d.current.disabled=r)},[s,n,r,o]),{active:i,rect:m,isOver:(null==l?void 0:l.id)===s,node:b,over:l,setNodeRef:j}}({id:i,data:j,disabled:v.droppable,resizeObserverConfig:{updateMeasurementsFor:w,...l}}),{active:E,activatorEvent:D,activeNodeRect:A,attributes:P,setNodeRef:B,listeners:z,isDragging:I,over:_,setActivatorNodeRef:T,transform:M}=Vn({id:i,data:j,attributes:{...ci,...r},disabled:v.draggable}),F=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return k.useMemo(()=>e=>{t.forEach(t=>t(e))},t)}(R,B),O=Boolean(E),L=O&&!p&&Jn(m)&&Jn(x),H=!f&&I,U=H&&L?M:null,W=L?null!=U?U:(null!=o?o:y)({rects:g,activeNodeRect:A,activeIndex:m,overIndex:x,index:b}):null,$=Jn(m)&&Jn(x)?n({id:i,items:d,activeIndex:m,overIndex:x}):b,G=null==E?void 0:E.id,q=k.useRef({activeId:G,items:d,newIndex:$,containerId:u}),V=d!==q.current.items,Y=t({active:E,containerId:u,isDragging:I,isSorting:O,id:i,index:b,items:d,newIndex:q.current.newIndex,previousItems:q.current.items,previousContainerId:q.current.containerId,transition:c,wasDragging:null!=q.current.activeId}),X=function(e){let{disabled:t,index:r,node:s,rect:a}=e;const[n,i]=k.useState(null),o=k.useRef(r);return Ys(()=>{if(!t&&r!==o.current&&s.current){const e=a.current;if(e){const t=Ia(s.current,{ignoreTransform:!0}),r={x:e.left-t.left,y:e.top-t.top,scaleX:e.width/t.width,scaleY:e.height/t.height};(r.x||r.y)&&i(r)}}r!==o.current&&(o.current=r)},[t,r,s,a]),k.useEffect(()=>{n&&i(null)},[n]),n}({disabled:!Y,index:b,node:C,rect:N});return k.useEffect(()=>{O&&q.current.newIndex!==$&&(q.current.newIndex=$),u!==q.current.containerId&&(q.current.containerId=u),d!==q.current.items&&(q.current.items=d)},[O,$,u,d]),k.useEffect(()=>{if(G===q.current.activeId)return;if(null!=G&&null==q.current.activeId)return void(q.current.activeId=G);const e=setTimeout(()=>{q.current.activeId=G},50);return()=>clearTimeout(e)},[G]),{active:E,activeIndex:m,attributes:P,data:j,rect:N,index:b,newIndex:$,items:d,isOver:S,isSorting:O,isDragging:I,listeners:z,node:C,overIndex:x,over:_,setNodeRef:F,setActivatorNodeRef:T,setDroppableNodeRef:R,setDraggableNodeRef:B,transform:null!=X?X:W,transition:function(){if(X||V&&q.current.newIndex===b)return li;if(H&&!na(D)||!c)return;if(O||Y)return oa.Transition.toString({...c,property:oi});return}()}}function ui(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&"object"==typeof t.sortable&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const mi=[en.Down,en.Right,en.Up,en.Left],hi=(e,t)=>{let{context:{active:r,collisionRect:s,droppableRects:a,droppableContainers:n,over:i,scrollableAncestors:o}}=t;if(mi.includes(e.code)){if(e.preventDefault(),!r||!s)return;const t=[];n.getEnabled().forEach(r=>{if(!r||null!=r&&r.disabled)return;const n=a.get(r.id);if(n)switch(e.code){case en.Down:s.top<n.top&&t.push(r);break;case en.Up:s.top>n.top&&t.push(r);break;case en.Left:s.left>n.left&&t.push(r);break;case en.Right:s.left<n.left&&t.push(r)}});const l=(e=>{let{collisionRect:t,droppableRects:r,droppableContainers:s}=e;const a=Ca(t),n=[];for(const i of s){const{id:e}=i,t=r.get(e);if(t){const r=Ca(t),s=a.reduce((e,t,s)=>e+ja(r[s],t),0),o=Number((s/4).toFixed(4));n.push({id:e,data:{droppableContainer:i,value:o}})}}return n.sort(wa)})({collisionRect:s,droppableRects:a,droppableContainers:t});let c=Sa(l,"id");if(c===(null==i?void 0:i.id)&&l.length>1&&(c=l[1].id),null!=c){const e=n.get(r.id),t=n.get(c),i=t?a.get(t.id):null,l=null==t?void 0:t.node.current;if(l&&i&&e&&t){const r=Ta(l).some((e,t)=>o[t]!==e),a=pi(e,t),n=function(e,t){if(!ui(e)||!ui(t))return!1;if(!pi(e,t))return!1;return e.data.current.sortable.index<t.data.current.sortable.index}(e,t),c=r||!a?{x:0,y:0}:{x:n?s.width-i.width:0,y:n?s.height-i.height:0},d={x:i.left,y:i.top};return c.x&&c.y?d:aa(d,c)}}}};function pi(e,t){return!(!ui(e)||!ui(t))&&e.data.current.sortable.containerId===t.data.current.sortable.containerId}const gi={"Employee Fields":[{label:"First Name",placeholder:"{{employee.firstName}}"},{label:"Last Name",placeholder:"{{employee.lastName}}"},{label:"Employee Number",placeholder:"{{employee.employeeNumber}}"},{label:"Email",placeholder:"{{employee.email}}"},{label:"Phone",placeholder:"{{employee.phoneNumber}}"},{label:"Department",placeholder:"{{employee.department}}"},{label:"Position",placeholder:"{{employee.position}}"}],"Warning Fields":[{label:"Warning Level",placeholder:"{{warning.level}}"},{label:"Issue Date",placeholder:"{{warning.issueDate}}"},{label:"Incident Date",placeholder:"{{warning.incidentDate}}"},{label:"Category",placeholder:"{{warning.category}}"},{label:"Description",placeholder:"{{warning.description}}"},{label:"Next Level",placeholder:"{{warning.nextLevel}}"}],"Organization Fields":[{label:"Company Name",placeholder:"{{organization.name}}"},{label:"Industry",placeholder:"{{organization.industry}}"}],"Manager Fields":[{label:"Manager Name",placeholder:"{{manager.name}}"},{label:"Manager Position",placeholder:"{{manager.position}}"}]},xi=({section:e,isOpen:r,onClose:s,onSave:a})=>{const[n,i]=k.useState(null),[o,l]=k.useState(null),[c,d]=k.useState("");if(k.useEffect(()=>{e&&r&&i({...e})},[e,r]),!n||!r)return null;const u=(e,t)=>{i("heading"===e?{...n,content:{...n.content,heading:n.content.heading+" "+t}}:{...n,content:{...n.content,body:(n.content.body||"")+" "+t}}),l(null)},m=()=>{c.trim()&&(i({...n,content:{...n.content,bulletPoints:[...n.content.bulletPoints||[],c.trim()]}}),d(""))},p=(e,t)=>{const r=[...n.content.subsections||[]],s=r[e].content;"paragraph"===t&&Array.isArray(s)?r[e]={...r[e],content:s.join(" ")}:"bullet"===t&&"string"==typeof s&&(r[e]={...r[e],content:s?[s]:[]}),i({...n,content:{...n.content,subsections:r}})};return t.jsxs(x,{isOpen:r,onClose:s,size:"lg",zIndex:h.MODAL,children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Edit Section: ",e?.name]}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Customize section content and insert custom fields"})]}),t.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:t.jsx(le,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"px-6 py-4 space-y-6 max-h-[calc(100vh-200px)] overflow-y-auto",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section Name"}),t.jsx("input",{type:"text",value:n.name,onChange:e=>i({...n,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"e.g., Employee Information"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (optional)"}),t.jsx("input",{type:"text",value:n.description||"",onChange:e=>i({...n,description:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Brief description of this section's purpose"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t.jsx(De,{className:"w-4 h-4 inline mr-1"}),"Heading"]}),t.jsxs("button",{onClick:()=>l("heading"),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[t.jsx(Ae,{className:"w-3 h-3"}),"Insert Field"]})]}),t.jsx("input",{type:"text",value:n.content.heading,onChange:e=>i({...n,content:{...n.content,heading:e.target.value}}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg font-medium",placeholder:"Section heading"}),"heading"===o&&t.jsxs("div",{className:"mt-2 p-3 border border-blue-200 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Available Fields"}),t.jsx("button",{onClick:()=>l(null),className:"text-xs text-blue-600 hover:text-blue-700",children:"Close"})]}),Object.entries(gi).map(([e,r])=>t.jsxs("div",{className:"mb-2",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:e}),t.jsx("div",{className:"flex flex-wrap gap-1",children:r.map(e=>t.jsx("button",{onClick:()=>u("heading",e.placeholder),className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-blue-100 hover:border-blue-400 transition-colors",children:e.label},e.placeholder))})]},e))]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t.jsx(De,{className:"w-4 h-4 inline mr-1"}),"Body Text"]}),t.jsxs("button",{onClick:()=>l("body"),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[t.jsx(Ae,{className:"w-3 h-3"}),"Insert Field"]})]}),t.jsx("textarea",{value:n.content.body||"",onChange:e=>i({...n,content:{...n.content,body:e.target.value}}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg",placeholder:"Main section content. Use {{placeholders}} for dynamic data."}),"body"===o&&t.jsxs("div",{className:"mt-2 p-3 border border-blue-200 bg-blue-50 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-xs font-medium text-blue-900",children:"Available Fields"}),t.jsx("button",{onClick:()=>l(null),className:"text-xs text-blue-600 hover:text-blue-700",children:"Close"})]}),Object.entries(gi).map(([e,r])=>t.jsxs("div",{className:"mb-2",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 mb-1",children:e}),t.jsx("div",{className:"flex flex-wrap gap-1",children:r.map(e=>t.jsx("button",{onClick:()=>u("body",e.placeholder),className:"px-2 py-1 text-xs bg-white border border-gray-300 rounded hover:bg-blue-100 hover:border-blue-400 transition-colors",children:e.label},e.placeholder))})]},e))]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Pe,{className:"w-4 h-4 inline mr-1"}),"Bullet Points (optional)"]}),n.content.bulletPoints&&n.content.bulletPoints.length>0&&t.jsx("div",{className:"space-y-2 mb-3",children:n.content.bulletPoints.map((e,r)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-gray-400",children:"•"}),t.jsx("input",{type:"text",value:e,onChange:e=>((e,t)=>{const r=[...n.content.bulletPoints||[]];r[e]=t,i({...n,content:{...n.content,bulletPoints:r}})})(r,e.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"}),t.jsx("button",{onClick:()=>(e=>{i({...n,content:{...n.content,bulletPoints:n.content.bulletPoints?.filter((t,r)=>r!==e)}})})(r),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:t.jsx(me,{className:"w-4 h-4"})})]},r))}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&m(),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm",placeholder:"Add bullet point (press Enter or click +)"}),t.jsxs("button",{onClick:m,disabled:!c.trim(),className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",children:[t.jsx(Ne,{className:"w-4 h-4"}),"Add"]})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx(Pe,{className:"w-4 h-4 inline mr-1"}),"Subsections (optional)"]}),t.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Create structured multi-part sections with titles and content blocks. Used for Employee Rights, Consequences, etc."}),n.content.subsections&&n.content.subsections.length>0&&t.jsx("div",{className:"space-y-4 mb-4",children:n.content.subsections.map((e,r)=>t.jsxs("div",{className:"border border-gray-300 rounded-lg p-4 bg-gray-50",children:[t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Subsection Title"}),t.jsx("input",{type:"text",value:e.title,onChange:e=>((e,t)=>{const r=[...n.content.subsections||[]];r[e]={...r[e],title:t},i({...n,content:{...n.content,subsections:r}})})(r,e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm mt-1",placeholder:"e.g., Your Rights:"})]}),t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("label",{className:"text-xs font-medium text-gray-700",children:"Content Type:"}),t.jsx("button",{onClick:()=>p(r,"paragraph"),className:"px-2 py-1 text-xs rounded "+("string"==typeof e.content?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Paragraph"}),t.jsx("button",{onClick:()=>p(r,"bullet"),className:"px-2 py-1 text-xs rounded "+(Array.isArray(e.content)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Bullet Points"})]}),"string"==typeof e.content?t.jsx("textarea",{value:e.content,onChange:e=>((e,t)=>{const r=[...n.content.subsections||[]];r[e]={...r[e],content:t},i({...n,content:{...n.content,subsections:r}})})(r,e.target.value),rows:3,className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Enter paragraph content (use {{placeholders}} for dynamic data)"}):t.jsxs("div",{className:"space-y-2",children:[e.content.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-gray-400",children:"•"}),t.jsx("input",{type:"text",value:e,onChange:e=>((e,t,r)=>{const s=[...n.content.subsections||[]],a=s[e].content;a[t]=r,s[e]={...s[e],content:a},i({...n,content:{...n.content,subsections:s}})})(r,s,e.target.value),className:"flex-1 px-2 py-1 border border-gray-300 rounded text-sm"}),t.jsx("button",{onClick:()=>((e,t)=>{const r=[...n.content.subsections||[]],s=r[e].content.filter((e,r)=>r!==t);r[e]={...r[e],content:s},i({...n,content:{...n.content,subsections:r}})})(r,s),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:t.jsx(me,{className:"w-3 h-3"})})]},s)),t.jsxs("button",{onClick:()=>(e=>{const t=[...n.content.subsections||[]],r=t[e].content;r.push(""),t[e]={...t[e],content:r},i({...n,content:{...n.content,subsections:t}})})(r),className:"text-xs text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[t.jsx(Ne,{className:"w-3 h-3"}),"Add bullet point"]})]}),t.jsxs("button",{onClick:()=>(e=>{i({...n,content:{...n.content,subsections:n.content.subsections?.filter((t,r)=>r!==e)}})})(r),className:"mt-3 text-xs text-red-600 hover:text-red-700 flex items-center gap-1",children:[t.jsx(me,{className:"w-3 h-3"}),"Delete Subsection"]})]},r))}),t.jsxs("button",{onClick:()=>{i({...n,content:{...n.content,subsections:[...n.content.subsections||[],{title:"New Subsection",content:[]}]}})},className:"w-full px-3 py-2 border-2 border-dashed border-gray-300 rounded-lg text-sm text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex items-center justify-center gap-2",children:[t.jsx(Ne,{className:"w-4 h-4"}),"Add Subsection"]})]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:[t.jsx(Be,{className:"w-4 h-4 inline mr-1"}),"Section Styling (optional)"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Heading Font Size (pt)"}),t.jsx("input",{type:"number",min:"10",max:"20",value:n.styling?.headingFontSize||"",onChange:e=>i({...n,styling:{...n.styling,headingFontSize:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Default"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-gray-600",children:"Body Font Size (pt)"}),t.jsx("input",{type:"number",min:"8",max:"16",value:n.styling?.bodyFontSize||"",onChange:e=>i({...n,styling:{...n.styling,bodyFontSize:e.target.value?parseInt(e.target.value):void 0}}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"Default"})]})]})]}),"standard"===e?.type&&t.jsx("div",{className:"border-t pt-4",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:n.isLocked||!1,onChange:e=>i({...n,isLocked:e.target.checked}),className:"w-4 h-4"}),t.jsx("span",{className:"text-sm text-gray-700",children:"Lock section (prevent editing in future)"})]})})]}),t.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t bg-gray-50",children:[t.jsx("button",{onClick:s,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:"Cancel"}),t.jsxs("button",{onClick:()=>{n&&(a({...n,updatedAt:new Date,updatedBy:"current-user"}),s())},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[t.jsx(De,{className:"w-4 h-4"}),"Save Section"]})]})]})},fi=({section:e,onToggle:r,onEdit:s,onDelete:a})=>{const{attributes:n,listeners:i,setNodeRef:o,transform:l,transition:c,isDragging:d}=di({id:e.id}),u={transform:oa.Transform.toString(l),transition:c,opacity:d?.5:1};return t.jsxs("div",{ref:o,style:u,className:"flex items-center gap-3 px-3 py-2 border rounded-lg bg-white hover:border-gray-400 transition-colors",children:[t.jsx("button",{...n,...i,className:"cursor-grab active:cursor-grabbing text-gray-400 hover:text-gray-600","aria-label":"Drag to reorder",children:t.jsx(ze,{className:"w-5 h-5"})}),t.jsx("input",{type:"checkbox",checked:e.enabled,onChange:()=>r(e.id),className:"w-4 h-4 cursor-pointer"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-medium text-sm text-gray-900 truncate",children:e.name}),e.isLocked&&t.jsx(Ie,{className:"w-3 h-3 text-gray-400 flex-shrink-0"}),t.jsx("span",{className:"text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 flex-shrink-0",children:e.type})]}),e.description&&t.jsx("p",{className:"text-xs text-gray-500 mt-0.5 truncate",children:e.description})]}),t.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[t.jsx("button",{onClick:()=>s(e),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors","aria-label":"Edit section",children:t.jsx(_e,{className:"w-4 h-4"})}),!e.isLocked&&"custom"===e.type&&t.jsx("button",{onClick:()=>a(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors","aria-label":"Delete section",children:t.jsx(me,{className:"w-4 h-4"})})]})]})},yi=({settings:e,onChange:r})=>{const[s,a]=k.useState(null),[n,i]=k.useState(!1),o=(()=>{if(e.sections&&e.sections.length>0)return e.sections;return[{id:"previous-disciplinary-actions",type:"standard",name:"Previous Disciplinary Actions",enabled:e.features.enablePreviousWarnings,order:0,content:{heading:"Previous Disciplinary Action",body:"This section provides a record of any prior warnings or disciplinary actions."}},{id:"consequences-section",type:"standard",name:"Consequences Section",enabled:e.features.enableConsequences,order:1,content:{heading:"Consequences of Further Misconduct",body:"Failure to improve your conduct may result in further disciplinary action."}},{id:"employee-rights-lra",type:"standard",name:"Employee Rights (LRA Compliance)",enabled:e.features.enableEmployeeRights,order:2,content:{heading:"Your Rights as an Employee",body:"In accordance with the Labour Relations Act 66 of 1995..."},isLocked:!0},{id:"appeal-history",type:"standard",name:"Appeal History Section",enabled:e.features.enableAppealSection,order:3,content:{heading:"Appeal Information",body:"If you wish to appeal this warning..."}},{id:"signatures",type:"standard",name:"Signature Section",enabled:e.features.enableSignatures,order:4,content:{heading:"Acknowledgment of Receipt",body:"By signing below, you acknowledge receipt of this warning."}}]})(),l=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return k.useMemo(()=>[...t].filter(e=>null!=e),[...t])}(va(un),va(nn,{coordinateGetter:hi})),c=t=>{const s=o.map(e=>e.id===t?{...e,enabled:!e.enabled}:e);r({...e,sections:s})},d=e=>{a(e),i(!0)},u=t=>{const s=o.find(e=>e.id===t);if(s&&confirm(`Are you sure you want to delete "${s.name}"?\n\nThis action cannot be undone.`)){const s=o.filter(e=>e.id!==t).map((e,t)=>({...e,order:t}));r({...e,sections:s})}};return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-sm text-blue-900",children:[t.jsx("strong",{children:"Drag"})," sections to reorder, ",t.jsx("strong",{children:"check/uncheck"})," to enable/disable, click ",t.jsx("strong",{children:"Edit"})," to customize content and add custom fields."]})}),t.jsx($n,{sensors:l,collisionDetection:Ra,onDragEnd:t=>{const{active:s,over:a}=t;if(a&&s.id!==a.id){const t=o.findIndex(e=>e.id===s.id),n=o.findIndex(e=>e.id===a.id),i=Xn(o,t,n).map((e,t)=>({...e,order:t}));r({...e,sections:i})}},children:t.jsx(si,{items:o.map(e=>e.id),strategy:ei,children:t.jsx("div",{className:"space-y-2",children:o.map(e=>t.jsx(fi,{section:e,onToggle:c,onEdit:d,onDelete:u},e.id))})})}),t.jsxs("button",{onClick:()=>{const t={id:`custom-section-${Date.now()}`,type:"custom",name:"New Custom Section",enabled:!0,order:o.length,content:{heading:"Custom Section Heading",body:"Enter your custom content here. You can use {{placeholders}} for dynamic data.",bulletPoints:[]},description:"Custom section created by user",createdAt:new Date,createdBy:"current-user"};r({...e,sections:[...o,t]}),setTimeout(()=>{a(t),i(!0)},100)},className:"w-full px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50 transition-colors flex items-center justify-center gap-2 font-medium",children:[t.jsx(Ne,{className:"w-5 h-5"}),"Add Custom Section"]}),t.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[o.filter(e=>e.enabled).length," of ",o.length," sections enabled"]}),t.jsx(xi,{section:s,isOpen:n,onClose:()=>{i(!1),a(null)},onSave:t=>{const s=o.map(e=>e.id===t.id?t:e);r({...e,sections:s}),i(!1),a(null)}})]})},vi=({settings:e,onChange:r})=>{const[s,a]=k.useState(new Set(["colors","sections"])),n=(t,s)=>{const a=t.split("."),n={...e};let i=n;for(let e=0;e<a.length-1;e++)i[a[e]]={...i[a[e]]},i=i[a[e]];i[a[a.length-1]]=s,r(n)},i=({id:e,title:r,icon:n,children:i})=>{const o=s.has(e);return t.jsxs("div",{className:"border rounded-lg",style:{borderColor:"var(--color-border)"},children:[t.jsxs("button",{onClick:()=>(e=>{const t=new Set(s);t.has(e)?t.delete(e):t.add(e),a(t)})(e),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-opacity-50 transition-colors",style:{backgroundColor:o?"var(--color-primary-bg)":"transparent"},children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(n,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:r})]}),o?t.jsx(Re,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}}):t.jsx(Ee,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]}),o&&t.jsx("div",{className:"px-4 py-4 border-t",style:{borderColor:"var(--color-border)"},children:i})]})};return t.jsxs("div",{className:"space-y-3",children:[t.jsx(i,{id:"colors",title:"Colors",icon:Be,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Header Background"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"color",value:e.styling.headerBackground,onChange:e=>n("styling.headerBackground",e.target.value),className:"w-16 h-10 rounded border cursor-pointer",style:{borderColor:"var(--color-border)"}}),t.jsx("input",{type:"text",value:e.styling.headerBackground,onChange:e=>n("styling.headerBackground",e.target.value),className:"flex-1 px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)"},placeholder:"#3B82F6"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Section Headers"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"color",value:e.styling.sectionHeaderColor,onChange:e=>n("styling.sectionHeaderColor",e.target.value),className:"w-16 h-10 rounded border cursor-pointer",style:{borderColor:"var(--color-border)"}}),t.jsx("input",{type:"text",value:e.styling.sectionHeaderColor,onChange:e=>n("styling.sectionHeaderColor",e.target.value),className:"flex-1 px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)"},placeholder:"#333333"})]})]}),t.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[t.jsx("input",{type:"checkbox",id:"useBrandColors",checked:e.styling.useBrandColors,onChange:e=>n("styling.useBrandColors",e.target.checked),className:"w-4 h-4 cursor-pointer"}),t.jsx("label",{htmlFor:"useBrandColors",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Use organization's brand colors"})]})]})}),t.jsx(i,{id:"typography",title:"Typography",icon:De,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Font Family"}),t.jsxs("select",{value:e.styling.fontFamily,onChange:e=>n("styling.fontFamily",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"},children:[t.jsx("option",{value:"Helvetica",children:"Helvetica"}),t.jsx("option",{value:"Times",children:"Times New Roman"}),t.jsx("option",{value:"Arial",children:"Arial"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Base Font Size: ",e.styling.fontSize,"pt"]}),t.jsx("input",{type:"range",min:"10",max:"12",step:"0.5",value:e.styling.fontSize,onChange:e=>n("styling.fontSize",parseFloat(e.target.value)),className:"w-full"}),t.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[t.jsx("span",{children:"10pt"}),t.jsx("span",{children:"12pt"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Line Height: ",e.styling.lineHeight.toFixed(1)]}),t.jsx("input",{type:"range",min:"1.0",max:"2.0",step:"0.1",value:e.styling.lineHeight,onChange:e=>n("styling.lineHeight",parseFloat(e.target.value)),className:"w-full"}),t.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[t.jsx("span",{children:"1.0"}),t.jsx("span",{children:"2.0"})]})]})]})}),t.jsx(i,{id:"layout",title:"Layout",icon:Te,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Page Size"}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx("button",{onClick:()=>n("styling.pageSize","A4"),className:"px-4 py-2 rounded border font-medium "+("A4"===e.styling.pageSize?"ring-2":""),style:{borderColor:"A4"===e.styling.pageSize?"var(--color-primary)":"var(--color-border)",backgroundColor:"A4"===e.styling.pageSize?"var(--color-primary-bg)":"transparent",color:"var(--color-text)"},children:"A4"}),t.jsx("button",{onClick:()=>n("styling.pageSize","Letter"),className:"px-4 py-2 rounded border font-medium "+("Letter"===e.styling.pageSize?"ring-2":""),style:{borderColor:"Letter"===e.styling.pageSize?"var(--color-primary)":"var(--color-border)",backgroundColor:"Letter"===e.styling.pageSize?"var(--color-primary-bg)":"transparent",color:"var(--color-text)"},children:"Letter"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Margins (mm)"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Top"}),t.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.top,onChange:e=>n("styling.margins.top",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Bottom"}),t.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.bottom,onChange:e=>n("styling.margins.bottom",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Left"}),t.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.left,onChange:e=>n("styling.margins.left",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Right"}),t.jsx("input",{type:"number",min:"10",max:"40",value:e.styling.margins.right,onChange:e=>n("styling.margins.right",parseInt(e.target.value)),className:"w-full px-2 py-1 rounded border text-sm",style:{borderColor:"var(--color-border)",color:"var(--color-text)"}})]})]})]})]})}),t.jsx(i,{id:"branding",title:"Branding",icon:je,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",id:"showLogo",checked:e.content.showLogo,onChange:e=>n("content.showLogo",e.target.checked),className:"w-4 h-4 cursor-pointer"}),t.jsx("label",{htmlFor:"showLogo",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Show company logo"})]}),e.content.showLogo&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Logo Position"}),t.jsxs("select",{value:e.content.logoPosition,onChange:e=>n("content.logoPosition",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"},children:[t.jsx("option",{value:"top-left",children:"Top Left"}),t.jsx("option",{value:"top-center",children:"Top Center"}),t.jsx("option",{value:"top-right",children:"Top Right"})]})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Logo Max Height: ",e.content.logoMaxHeight,"mm"]}),t.jsx("input",{type:"range",min:"10",max:"30",value:e.content.logoMaxHeight,onChange:e=>n("content.logoMaxHeight",parseInt(e.target.value)),className:"w-full"}),t.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[t.jsx("span",{children:"10mm"}),t.jsx("span",{children:"30mm"})]})]})]})]})}),t.jsx(i,{id:"sections",title:"PDF Sections",icon:Me,children:t.jsx(yi,{settings:e,onChange:r})}),t.jsx(i,{id:"watermark",title:"Watermark",icon:fe,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",id:"showWatermark",checked:e.content.showWatermark,onChange:e=>n("content.showWatermark",e.target.checked),className:"w-4 h-4 cursor-pointer"}),t.jsx("label",{htmlFor:"showWatermark",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Enable watermark"})]}),e.content.showWatermark&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Watermark Text"}),t.jsx("input",{type:"text",value:e.content.watermarkText,onChange:e=>n("content.watermarkText",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)"},placeholder:"CONFIDENTIAL"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:["Opacity: ",Math.round(100*e.content.watermarkOpacity),"%"]}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:e.content.watermarkOpacity,onChange:e=>n("content.watermarkOpacity",parseFloat(e.target.value)),className:"w-full"}),t.jsxs("div",{className:"flex justify-between text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:[t.jsx("span",{children:"0%"}),t.jsx("span",{children:"100%"})]})]})]})]})}),t.jsx(i,{id:"version",title:"Version Control",icon:Fe,children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"PDF Generator Version"}),t.jsxs("select",{value:e.generatorVersion,onChange:e=>n("generatorVersion",e.target.value),className:"w-full px-3 py-2 rounded border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"},children:[t.jsx("option",{value:"1.0.0",children:"v1.0.0 (Legacy)"}),t.jsx("option",{value:"1.1.0",children:"v1.1.0 (Current)"})]}),t.jsx("p",{className:"text-xs mt-2",style:{color:"var(--color-text-secondary)"},children:"Version determines PDF format for new warnings"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",id:"autoUpgrade",checked:e.autoUpgrade,onChange:e=>n("autoUpgrade",e.target.checked),className:"w-4 h-4 cursor-pointer"}),t.jsx("label",{htmlFor:"autoUpgrade",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Auto-upgrade to new versions when released"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("input",{type:"checkbox",id:"betaFeatures",checked:e.betaFeatures,onChange:e=>n("betaFeatures",e.target.checked),className:"w-4 h-4 cursor-pointer"}),t.jsx("label",{htmlFor:"betaFeatures",className:"text-sm cursor-pointer",style:{color:"var(--color-text)"},children:"Enable experimental features"})]})]})})]})},bi=({settings:e,organization:s})=>{const[a,n]=k.useState(null),[i,o]=k.useState(!1),[l,c]=k.useState(null),[d,u]=k.useState(100),m=k.useRef(null),h=k.useCallback(async()=>{o(!0),c(null);try{const t=function(e,t){const r=new Date;return{warningId:"PREVIEW_SAMPLE",organizationId:e.id,status:"issued",pdfGeneratorVersion:t.generatorVersion,pdfSettings:t,issuedByName:"John Smith",issuedDate:r,incidentDate:new Date(r.getTime()-1728e5),employee:{firstName:"Jane",lastName:"Doe",employeeNumber:"EMP001",department:"Operations",position:"Production Operator",email:"jane.doe@example.com",phone:"+27 82 123 4567"},warningLevel:"first_written",category:"Attendance Issues",description:"Employee arrived 45 minutes late to shift without prior notification or valid reason. This is the third occurrence of tardiness in the past month.",incidentTime:"08:45",incidentLocation:"Production Floor A",organization:e,signatures:{managerName:"John Smith",managerSignature:null,employeeSignature:null,witnessSignature:null},additionalNotes:"Employee expressed understanding of the policy and committed to improved punctuality.",validityPeriod:6,disciplineRecommendation:{recommendedLevel:"first_written",reasoning:"Progressive discipline - first written warning appropriate for repeated attendance issues",activeWarnings:[{date:new Date(r.getTime()-2592e6),level:"verbal",category:"Attendance Issues",description:"Late arrival without notification"}],lraCompliance:{isCompliant:!0,notes:"Follows progressive discipline as per LRA guidelines"}},legalCompliance:{framework:"LRA 1995 - South African Labour Law",isCompliant:!0,requirements:["Progressive discipline followed as per Schedule 8 of LRA","Employee provided with opportunity to respond","Proportionate response to misconduct severity","Documented evidence of incident","Prior warnings considered in escalation decision"],safetyRisk:!1,repeatOffense:!0,priorWarnings:1,notes:"Warning issued in accordance with company disciplinary code and LRA guidelines"}}}(s,e),a=await mt.generateWarningPDF(t,e.generatorVersion,e);n(e=>(e&&URL.revokeObjectURL(e),URL.createObjectURL(a))),r.success("PDF preview generated successfully")}catch(t){r.error("Failed to generate PDF preview:",t),c(t instanceof Error?t.message:"Failed to generate preview")}finally{o(!1)}},[e,s]);k.useEffect(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{h()},500),()=>{m.current&&clearTimeout(m.current)}),[e,h]),k.useEffect(()=>(h(),()=>{a&&URL.revokeObjectURL(a)}),[]);return t.jsx(f,{padding:"md",shadow:"md",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Live PDF Preview"}),t.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Sample warning with current template settings"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-lg border",style:{borderColor:"var(--color-border)"},children:[t.jsx("button",{onClick:()=>{u(e=>Math.max(e-25,50))},disabled:d<=50,className:"p-1 rounded hover:bg-opacity-10 hover:bg-gray-500 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Zoom Out",children:t.jsx(Oe,{className:"w-4 h-4",style:{color:"var(--color-text)"}})}),t.jsxs("span",{className:"text-xs font-medium mx-1",style:{color:"var(--color-text)"},children:[d,"%"]}),t.jsx("button",{onClick:()=>{u(e=>Math.min(e+25,200))},disabled:d>=200,className:"p-1 rounded hover:bg-opacity-10 hover:bg-gray-500 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",title:"Zoom In",children:t.jsx(Le,{className:"w-4 h-4",style:{color:"var(--color-text)"}})}),t.jsx("button",{onClick:()=>{u(100)},className:"p-1 rounded hover:bg-opacity-10 hover:bg-gray-500 transition-colors ml-1",title:"Reset Zoom",children:t.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"1:1"})})]}),t.jsxs("button",{onClick:h,disabled:i,className:"px-3 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-1.5",style:{backgroundColor:"var(--color-surface)",color:"var(--color-text)",border:"1px solid var(--color-border)"},title:"Regenerate Preview",children:[t.jsx(ce,{className:"w-4 h-4 "+(i?"animate-spin":"")}),"Refresh"]}),t.jsxs("button",{onClick:()=>{if(!a)return;const e=document.createElement("a");e.href=a,e.download=`${s.name}_PDF_Template_Preview.pdf`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},disabled:!a||i,className:"px-3 py-1.5 rounded-lg font-medium text-sm transition-colors flex items-center gap-1.5 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},title:"Download Test PDF",children:[t.jsx(He,{className:"w-4 h-4"}),"Download"]})]})]}),t.jsxs("div",{className:"relative w-full",style:{minHeight:"600px"},children:[i&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10 rounded-lg",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:t.jsxs("div",{className:"text-center",children:[t.jsx(Se,{className:"w-8 h-8 animate-spin mx-auto mb-2",style:{color:"var(--color-text-inverse)"}}),t.jsx("p",{className:"text-sm font-medium",style:{color:"var(--color-text-inverse)"},children:"Generating preview..."})]})}),l&&t.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[t.jsx(ie,{className:"w-12 h-12 mb-4",style:{color:"var(--color-error)"}}),t.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--color-text)"},children:"Preview Generation Failed"}),t.jsx("p",{className:"text-sm text-center max-w-md",style:{color:"var(--color-text-secondary)"},children:l}),t.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:"Try Again"})]}),a&&!l&&t.jsx("div",{className:"w-full overflow-auto rounded-lg border",style:{borderColor:"var(--color-border)",height:"700px",backgroundColor:"#525659"},children:t.jsx("iframe",{src:a,className:"w-full h-full",style:{transform:`scale(${d/100})`,transformOrigin:"top center",minHeight:d>100?d/100*700+"px":"700px"},title:"PDF Preview"})}),!a&&!l&&!i&&t.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[t.jsx(Me,{className:"w-12 h-12 mb-4",style:{color:"var(--color-text-tertiary)"}}),t.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--color-text)"},children:"Generating Preview..."}),t.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Please wait while we generate a sample PDF"})]})]}),t.jsxs("div",{className:"flex items-start gap-2 p-3 rounded-lg",style:{backgroundColor:"var(--color-info-bg)"},children:[t.jsx(ie,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--color-info)"}}),t.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[t.jsx("p",{className:"font-medium mb-1",children:"Preview uses sample data"}),t.jsx("p",{children:"This preview shows how warning documents will appear with your current template settings. Changes are automatically reflected after 500ms."})]})]})]})})};const ji=({organizations:e,onTemplateUpdate:s})=>{const{user:a}=m(),[n,i]=k.useState(null),[o,l]=k.useState(""),[c,d]=k.useState(!1),[u,h]=k.useState(!1),[p,g]=k.useState(null),[x,y]=k.useState(!1),v=e.find(e=>e.id===n),b=e.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.id.toLowerCase().includes(o.toLowerCase())),j=k.useCallback(e=>{if(i(e.id),d(!0),e.pdfSettings)g(e.pdfSettings);else{const e=zs.getDefaultSettings("system");g(e)}e.name},[]),w=k.useCallback(async e=>{if(n&&a?.id){y(!0);try{await zs.saveTemplate(n,e,a.id),r.success("PDF template saved successfully!"),alert("✅ PDF Template saved successfully!"),s&&await s()}catch(t){r.error("Failed to save PDF template:",t);const e=t instanceof Error?t.message:"Unknown error occurred";alert(`❌ Failed to save PDF template: ${e}`)}finally{y(!1)}}else r.warn("⚠️ Cannot save: missing selectedOrgId or user.id")},[n,a,s]);return t.jsxs("div",{className:"space-y-6",children:[t.jsx(f,{padding:"md",shadow:"md",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"📄 PDF Template Manager"}),t.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Customize PDF generation per organization with live preview"})]})})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[t.jsx("div",{className:"lg:col-span-1",children:t.jsx(f,{padding:"md",shadow:"md",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("h3",{className:"font-semibold",style:{color:"var(--color-text)"},children:["Organizations (",e.length,")"]})}),t.jsxs("div",{className:"relative",children:[t.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-secondary)"}}),t.jsx("input",{type:"text",placeholder:"Search organizations...",value:o,onChange:e=>l(e.target.value),className:"w-full pl-10 pr-4 py-2 rounded-lg border",style:{borderColor:"var(--color-border)",color:"var(--color-text)",backgroundColor:"var(--color-background)"}})]}),t.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:0===b.length?t.jsxs("div",{className:"text-center py-8",children:[t.jsx(ie,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),t.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"No organizations found"})]}):b.map(e=>t.jsx("button",{onClick:()=>j(e),className:"w-full text-left px-4 py-3 rounded-lg transition-colors "+(n===e.id?"ring-2":""),style:{backgroundColor:n===e.id?"var(--color-primary-bg)":"var(--color-background)",border:n===e.id?"1px solid var(--color-primary)":"1px solid var(--color-border)"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-semibold truncate",style:{color:"var(--color-text)"},children:e.name}),t.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.pdfSettings?.generatorVersion||"No version set"})]}),n===e.id&&t.jsx(be,{className:"w-5 h-5 flex-shrink-0 ml-2",style:{color:"var(--color-primary)"}})]})},e.id))})]})})}),t.jsx("div",{className:"lg:col-span-2",children:v?t.jsxs("div",{className:"space-y-6",children:[t.jsx(f,{padding:"md",shadow:"md",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:v.name}),t.jsxs("p",{className:"text-sm mt-0.5",style:{color:"var(--color-text-secondary)"},children:["PDF Version: ",v.pdfSettings?.generatorVersion||"Not set"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>h(!u),className:"px-3 py-2 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:u?"var(--color-primary)":"transparent",color:u?"var(--color-text-inverse)":"var(--color-text)",border:"1px solid "+(u?"transparent":"var(--color-border)")},children:[u?"Hide":"Show"," Preview"]}),t.jsxs("button",{onClick:()=>{p&&w(p)},disabled:x,className:"px-3 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[x&&t.jsx(Se,{className:"w-4 h-4 animate-spin"}),x?"Saving...":"Save Template"]})]})]})}),p&&t.jsx(vi,{settings:p,onChange:g}),u&&p&&v&&t.jsx(bi,{settings:p,organization:v})]}):t.jsx(f,{padding:"lg",shadow:"md",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Me,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),t.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"Select an Organization"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Choose an organization from the list to customize its PDF templates"})]})})})]})]})};const wi="dashboard_quotes_preferences",Ni=[{id:1,text:"There is no passion to be found playing small – in settling for a life that is less than the one you are capable of living.",author:"Nelson Mandela",category:"leadership",isPopular:!0},{id:2,text:"I learned that courage was not the absence of fear, but the triumph over it.",author:"Nelson Mandela",category:"courage",isPopular:!0},{id:3,text:"Ubuntu does not mean that people should not enrich themselves. The question is: are you going to do so in order to enable the community around you to be able to improve?",author:"Nelson Mandela",category:"unity"},{id:4,text:"Don't look where you fall, but where you slipped.",author:"African Proverb",category:"wisdom"},{id:5,text:"However long the night, the dawn will break.",author:"African Proverb",category:"perseverance",isPopular:!0},{id:6,text:"If you want to go fast, go alone. If you want to go far, go together.",author:"African Proverb",category:"unity",isPopular:!0},{id:7,text:"The brave may not live forever, but the cautious do not live at all.",author:"Desmond Tutu",category:"courage"},{id:8,text:"Hope is being able to see that there is light despite all of the darkness.",author:"Desmond Tutu",category:"perseverance"},{id:9,text:"Education is the most powerful weapon which you can use to change the world.",author:"Nelson Mandela",category:"wisdom",isPopular:!0},{id:10,text:"It always seems impossible until it's done.",author:"Nelson Mandela",category:"perseverance",isPopular:!0}],Ci=()=>{const{currentTheme:e,setTheme:r}=(()=>{const e=k.useContext(jt);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e})(),s=k.useContext(y),a=s?.organization||null,[n,i]=k.useState(!1),o=k.useRef(null),l=[{value:"light",label:"Light",icon:t.jsx(We,{className:"w-4 h-4"}),description:"Clean and bright"},{value:"dark",label:"Dark",icon:t.jsx($e,{className:"w-4 h-4"}),description:"Easy on the eyes"},{value:"branded",label:"Branded",icon:t.jsx(Be,{className:"w-4 h-4"}),description:a?.name?`${a.name} colors`:"Organization colors"}],c=a?l:l.filter(e=>"branded"!==e.value),d=c.find(t=>t.value===e)||c[0];k.useEffect(()=>{a||"branded"!==e||r("light")},[a,e,r]),k.useEffect(()=>{const e=e=>{o.current&&!o.current.contains(e.target)&&i(!1)};return n&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[n]);return t.jsxs("div",{className:"relative",ref:o,children:[t.jsxs("button",{onClick:()=>i(!n),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg border\r\n                   bg-[var(--color-card-background)] text-[var(--color-text)]\r\n                   border-[var(--color-border)] hover:border-[var(--color-border-secondary)]\r\n                   transition-all duration-200 hover:shadow-sm","aria-label":"Select theme",children:[t.jsx("span",{className:"text-[var(--color-primary)]",children:d.icon}),t.jsx("span",{className:"hidden sm:inline",children:d.label}),t.jsx(Ee,{className:"w-4 h-4 text-[var(--color-text-tertiary)] transition-transform duration-200 "+(n?"rotate-180":"")})]}),n&&t.jsx("div",{className:"absolute right-0 bottom-full mb-2 w-56 rounded-lg shadow-lg\r\n                        bg-[var(--color-card-background)] border border-[var(--color-border)]\r\n                        overflow-hidden z-50 animate-fade-in",children:t.jsx("div",{className:"p-1",children:c.map(s=>t.jsxs("button",{onClick:()=>{return e=s.value,r(e),void i(!1);var e},className:"w-full flex items-center gap-3 px-3 py-2 text-sm rounded-md\n                           transition-all duration-150\n                           "+(e===s.value?"bg-[var(--color-primary)] text-white":"hover:bg-[var(--color-background-secondary)] text-[var(--color-text)]"),children:[t.jsx("span",{className:e===s.value?"text-white":"text-[var(--color-primary)]",children:s.icon}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"font-medium",children:s.label}),t.jsx("div",{className:"text-xs "+(e===s.value?"text-white/80":"text-[var(--color-text-tertiary)]"),children:s.description})]}),e===s.value&&t.jsx(be,{className:"w-4 h-4"})]},s.value))})})]})},Si=k.memo(({className:e=""})=>{const s=(e=>{const[t,r]=k.useState(window.innerWidth>e),s=k.useCallback(()=>{r(window.innerWidth>e)},[e]);return k.useEffect(()=>(s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)),[s]),t})(768),{currentQuote:a,isRotating:n,preferences:i,nextQuote:o,previousQuote:l,toggleRotation:c,toggleFavorite:d}=(()=>{const[e,t]=k.useState(0),[s,a]=k.useState(!0),[n,i]=k.useState({favoriteQuotes:[],showOnlyFavorites:!1,rotationEnabled:!0});k.useEffect(()=>{try{const e=localStorage.getItem(wi);if(e){const t=JSON.parse(e);i(t),a(t.rotationEnabled)}}catch(e){r.warn("⚠️ Failed to load quotes preferences:",e)}},[]);const o=k.useCallback(e=>{try{localStorage.setItem(wi,JSON.stringify(e))}catch(t){r.warn("⚠️ Failed to save quotes preferences:",t)}},[]),l=k.useCallback(()=>n.showOnlyFavorites&&n.favoriteQuotes.length>0?Ni.filter(e=>n.favoriteQuotes.includes(e.id)):Ni,[n])(),c=l[e]||Ni[0];k.useEffect(()=>{if(!s||l.length<=1)return;const e=setInterval(()=>{t(e=>(e+1)%l.length)},15e3);return()=>clearInterval(e)},[s,l.length]);const d=k.useCallback(()=>{t(e=>(e+1)%l.length)},[l.length]),u=k.useCallback(()=>{t(e=>(e-1+l.length)%l.length)},[l.length]),m=k.useCallback(()=>{const e=!s;a(e);const t={...n,rotationEnabled:e};i(t),o(t)},[s,n,o]),h=k.useCallback(e=>{const t=n.favoriteQuotes.includes(e)?n.favoriteQuotes.filter(t=>t!==e):[...n.favoriteQuotes,e],r={...n,favoriteQuotes:t};i(r),o(r)},[n,o]),p=k.useCallback(e=>{const t={...n,...e};i(t),o(t),void 0!==e.rotationEnabled&&a(e.rotationEnabled)},[n,o]);return{currentQuote:c,allQuotes:Ni,isRotating:s,preferences:n,nextQuote:d,previousQuote:u,toggleRotation:m,toggleFavorite:h,updatePreferences:p}})(),u=i.favoriteQuotes.includes(a.id);return t.jsx("div",{className:e,children:s?t.jsx(f,{padding:"md",shadow:"sm",className:e,style:{background:"linear-gradient(to right, var(--color-background-secondary), var(--color-card-background))",border:"1px solid var(--color-border)"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{className:"flex-1 mr-6",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(Ge,{className:"w-4 h-4 mt-1 flex-shrink-0",style:{color:"var(--color-primary)"}}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("blockquote",{className:"italic text-sm leading-tight",style:{color:"var(--color-text-secondary)"},children:['"',a.text,'"']}),t.jsxs("div",{className:"flex items-center justify-between mt-2",children:[t.jsxs("cite",{className:"text-xs font-medium not-italic",style:{color:"var(--color-primary)"},children:["— ",a.author]}),t.jsxs("div",{className:"flex items-center gap-2",children:[a.isPopular&&t.jsx(v,{variant:"warning",size:"sm",children:"⭐"}),t.jsx(v,{variant:"default",size:"sm",className:"capitalize",children:a.category})]})]})]})]})}),t.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[t.jsx(b,{variant:"ghost",size:"sm",onClick:l,title:"Previous quote",children:t.jsx(qe,{className:"w-4 h-4"})}),t.jsx(b,{variant:"ghost",size:"sm",onClick:o,title:"Next quote",children:t.jsx(Ve,{className:"w-4 h-4"})}),t.jsx("div",{className:"w-px h-6 mx-1",style:{backgroundColor:"var(--color-border)"}}),t.jsx(b,{variant:"ghost",size:"sm",onClick:()=>d(a.id),title:u?"Remove from favorites":"Add to favorites",style:{color:u?"var(--color-error)":"var(--color-text-tertiary)",backgroundColor:u?"var(--color-alert-error-bg)":"transparent"},children:t.jsx(Ye,{className:"w-4 h-4 "+(u?"fill-current":"")})}),t.jsx(b,{variant:"ghost",size:"sm",onClick:c,title:n?"Pause rotation":"Start rotation",style:{color:n?"var(--color-success)":"var(--color-text-tertiary)",backgroundColor:n?"var(--color-alert-success-bg)":"transparent"},children:n?t.jsx(Xe,{className:"w-4 h-4"}):t.jsx(de,{className:"w-4 h-4"})}),t.jsx("div",{className:"w-px h-6 mx-1",style:{backgroundColor:"var(--color-border)"}}),t.jsx("div",{className:"ml-1",children:t.jsx(Ci,{})})]})]})}):t.jsxs(f,{padding:"sm",shadow:"md",style:{background:"linear-gradient(135deg, var(--color-card-background), var(--color-background-secondary))",backdropFilter:"blur(10px)"},children:[t.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[t.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--color-text)"},children:[t.jsx(Ge,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),"Daily Inspiration"]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(b,{variant:"ghost",size:"sm",onClick:()=>d(a.id),"aria-label":u?"Remove from favorites":"Add to favorites",style:{color:u?"var(--color-error)":"var(--color-text-tertiary)",backgroundColor:u?"var(--color-alert-error-bg)":"transparent",padding:"4px"},children:t.jsx(Ye,{className:"w-3.5 h-3.5 "+(u?"fill-current":"")})}),t.jsx("div",{className:"scale-75",children:t.jsx(Ci,{})})]})]}),t.jsxs("blockquote",{className:"mb-1.5 italic text-sm leading-tight",style:{color:"var(--color-text-secondary)"},children:['"',a.text,'"']}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(b,{variant:"ghost",size:"sm",onClick:l,"aria-label":"Previous quote",style:{padding:"4px"},children:t.jsx(qe,{className:"w-3.5 h-3.5"})}),t.jsx(b,{variant:"ghost",size:"sm",onClick:o,"aria-label":"Next quote",style:{padding:"4px"},children:t.jsx(Ve,{className:"w-3.5 h-3.5"})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("cite",{className:"text-xs font-medium not-italic",style:{color:"var(--color-primary)"},children:["— ",a.author]}),t.jsx(v,{variant:"primary",size:"sm",className:"capitalize text-xs",children:a.category})]})]})]})})});Si.displayName="QuotesSection";const ki=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,t)).toFixed(2))} ${["B","KB","MB","GB"][t]}`},Ri=()=>{const{user:e}=m(),a=(e=>{const[t,r]=k.useState(window.innerWidth>e),s=k.useCallback(()=>r(window.innerWidth>e),[e]);return k.useEffect(()=>(window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)),[s]),t})(768),[n,i]=k.useState({totalOrganizations:0,totalEmployees:0,totalResellers:0,monthlyGrowth:0}),[o,l]=k.useState([]),[c,u]=k.useState(!0),[h,p]=k.useState(null),[x,y]=k.useState(!1),[v,b]=k.useState({isOpen:!1,organizationId:"",organizationName:""});k.useEffect(()=>{w()},[]);const w=async()=>{try{u(!0);const[e,t]=await Promise.all([s.loadOrganizations(),s.getAllResellers()]);let a=0;const n=t.length,o=await Promise.all(e.map(async e=>{try{const t=(await d.queryDocuments(e.id,"warnings")).documents.filter(e=>!0===e.isActive),s=await(async e=>{try{let r=0;const s=V(g,`organizations/${e}/audio`);try{const e=await K(s);for(const t of e.items)r+=(await J(t)).size||0}catch(t){}const a=V(g,`organizations/${e}/signatures`);try{const e=await K(a);for(const t of e.items)r+=(await J(t)).size||0}catch(t){}return r}catch(t){return r.error(`Error calculating storage for ${e}:`,t),0}})(e.id);return{...e,warningCount:t.length,storageUsage:s}}catch(t){return{...e,warningCount:0,storageUsage:0}}}));l(o),o.forEach(e=>{a+=e.employeeCount||0});const c=new Date,m=c.getMonth(),h=c.getFullYear(),p=0===m?11:m-1,x=0===m?h-1:h;let f=0,y=0;o.forEach(e=>{if(e.createdAt){const t=e.createdAt instanceof Date?e.createdAt:e.createdAt.toDate?.()||new Date(e.createdAt),r=t.getMonth(),s=t.getFullYear();r===m&&s===h&&f++,r===p&&s===x&&y++}});let v=0;y>0?v=Math.round((f-y)/y*100):f>0&&(v=100),i({totalOrganizations:o.length,totalEmployees:a,totalResellers:n,monthlyGrowth:v}),r.success("SuperAdmin dashboard data loaded successfully")}catch(e){r.error("Error loading SuperAdmin dashboard:",e)}finally{u(!1)}},N=async e=>{r.success("Organization deployed successfully!",e),y(!1),await w()};return a?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>p("organizations"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ve,{className:"w-8 h-8 text-blue-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Organizations"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:n.totalOrganizations})]})]})}),t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>p("organizations"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(re,{className:"w-8 h-8 text-green-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Employees"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:n.totalEmployees.toLocaleString()})]})]})}),t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>p("resellers"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Je,{className:"w-8 h-8 text-orange-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Active Resellers"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:n.totalResellers})]})]})}),t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>p("financial"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ae,{className:"w-8 h-8 text-purple-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Monthly Growth"}),t.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:["+",n.monthlyGrowth,"%"]})]})]})})]}),t.jsx("div",{className:"border-b",style:{borderColor:"var(--color-border)"},children:t.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"organizations",label:"Organizations",count:n.totalOrganizations},{id:"resellers",label:"Resellers",count:n.totalResellers},{id:"pdf-templates",label:"PDF Templates",count:null},{id:"audio",label:"Audio Cleanup",count:null},{id:"financial",label:"Financial",count:null}].map(e=>t.jsxs("button",{onClick:()=>p(e.id),className:"py-3 px-1 border-b-2 font-medium text-sm transition-colors "+(h===e.id?"border-blue-500 text-blue-600":"border-transparent hover:border-gray-300"),style:{color:h===e.id?"var(--color-primary)":"var(--color-text-secondary)"},children:[e.label,null!==e.count&&t.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100",children:e.count})]},e.id))})}),h&&function(){switch(h){case"organizations":return t.jsxs(f,{padding:"none",shadow:"md",children:[t.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",style:{borderColor:"var(--color-border)"},children:[t.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"🏢 Organizations & Category Management"}),t.jsxs("button",{onClick:()=>y(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-colors",style:{background:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[t.jsx(Ke,{className:"w-4 h-4"}),"Deploy New Organization"]})]}),c?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Loading organizations..."})]})}):0===o.length?t.jsxs("div",{className:"px-6 py-12 text-center",children:[t.jsx(ve,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),t.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"No Organizations Yet"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Deploy your first organization to start managing the system"})]}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{style:{background:"var(--color-background-secondary)"},children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Organization"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Industry"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Employees"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Warnings"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Storage"}),t.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y",style:{borderColor:"var(--color-border)"},children:o.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"font-semibold",style:{color:"var(--color-text)"},children:e.name}),t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:e.id})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-50 text-blue-700 capitalize",children:e.industry||e.sector})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:t.jsx("span",{className:0===e.employeeCount?"text-gray-500":"text-green-600",children:e.employeeCount||0})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:t.jsx("span",{className:0===e.warningCount?"text-green-600":"text-red-600",children:e.warningCount||0})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm",style:{color:"var(--color-text-secondary)"},children:[t.jsx(Qe,{className:"w-4 h-4"}),t.jsx("span",{className:"font-medium",children:ki(e.storageUsage||0)})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:t.jsx("div",{className:"flex items-center justify-center gap-2",children:t.jsx("button",{onClick:()=>(e=>{b({isOpen:!0,organizationId:e.id,organizationName:e.name})})(e),className:"text-xs px-3 py-1 rounded font-semibold bg-purple-600 text-white hover:bg-purple-700",children:"Categories"})})})]},e.id))})]})})]});case"resellers":return t.jsx(xs,{});case"pdf-templates":return t.jsx(ji,{organizations:o,onTemplateUpdate:w});case"audio":return t.jsx(vs,{});case"financial":return t.jsx(f,{padding:"lg",shadow:"md",children:t.jsxs("div",{className:"text-center py-12",children:[t.jsx(se,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),t.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"Financial Dashboard"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Revenue tracking and commission management coming soon"})]})});default:return null}}(),t.jsx(Si,{}),C()]}):t.jsxs("div",{className:"space-y-6 pb-20",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:"👑 Super Admin"}),t.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Global system management"})]}),t.jsx(f,{padding:"md",shadow:"lg",hover:!0,onClick:()=>y(!0),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",color:"var(--color-text-inverse)",minHeight:"64px",willChange:"transform"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Ke,{className:"w-6 h-6"}),t.jsx("span",{className:"font-bold text-lg",children:"Deploy New Organization"})]}),t.jsx(Ve,{className:"w-5 h-5"})]})}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>p("organizations"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(ve,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Organizations"}),t.jsx("span",{className:"text-lg font-bold",children:n.totalOrganizations})]})}),t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>p("organizations"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(re,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Employees"}),t.jsx("span",{className:"text-lg font-bold",children:n.totalEmployees.toLocaleString()})]})}),t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>p("resellers"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(Je,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Resellers"}),t.jsx("span",{className:"text-lg font-bold",children:n.totalResellers})]})}),t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>p("financial"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #8b5cf6, #7c3aed)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(ae,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Growth"}),t.jsxs("span",{className:"text-lg font-bold",children:["+",n.monthlyGrowth,"%"]})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(f,{padding:"md",shadow:"sm",hover:!0,onClick:()=>p("audio"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ge,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Audio Cleanup"})]}),t.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),t.jsx(f,{padding:"md",shadow:"sm",hover:!0,onClick:()=>p("pdf-templates"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Me,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"PDF Templates"})]}),t.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),t.jsx(f,{padding:"md",shadow:"sm",hover:!0,onClick:()=>p("financial"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(se,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Financial Dashboard"})]}),t.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),t.jsx(Si,{}),C()]});function C(){return t.jsxs(t.Fragment,{children:[x&&t.jsx(Fs,{isOpen:x,onClose:()=>y(!1),onComplete:N}),v.isOpen&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] flex flex-col shadow-2xl my-auto",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-purple-50 to-blue-50 flex-shrink-0",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Warning Categories"}),t.jsx("p",{className:"text-sm text-gray-600",children:v.organizationName})]}),t.jsx("button",{onClick:()=>b(e=>({...e,isOpen:!1})),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:t.jsx(le,{className:"w-5 h-5 text-gray-600"})})]}),t.jsx("div",{className:"overflow-y-auto flex-1 p-6",children:t.jsx(j,{onClose:()=>b(e=>({...e,isOpen:!1})),organizationId:v.organizationId,organizationName:v.organizationName,inline:!0,allowEdit:!0})})]})})]})}},Ei=k.createContext(null),Di={didCatch:!1,error:null};class Ai extends k.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Di}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){const{error:e}=this.state;if(null!==e){for(var t,r,s=arguments.length,a=new Array(s),n=0;n<s;n++)a[n]=arguments[n];null===(t=(r=this.props).onReset)||void 0===t||t.call(r,{args:a,reason:"imperative-api"}),this.setState(Di)}}componentDidCatch(e,t){var r,s;null===(r=(s=this.props).onError)||void 0===r||r.call(s,e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:s}=this.props;var a,n;r&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,r)=>!Object.is(e,t[r]))}(e.resetKeys,s)&&(null===(a=(n=this.props).onReset)||void 0===a||a.call(n,{next:s,prev:e.resetKeys,reason:"keys"}),this.setState(Di))}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:s}=this.props,{didCatch:a,error:n}=this.state;let i=e;if(a){const e={error:n,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)i=t(e);else if(r)i=k.createElement(r,e);else{if(void 0===s)throw n;i=s}}return k.createElement(Ei.Provider,{value:{didCatch:a,error:n,resetErrorBoundary:this.resetErrorBoundary}},i)}}const Pi="hr-system-selected-dashboard-role",Bi=k.memo(({selectedRole:e,onRoleChange:r,className:s=""})=>{const{canManageOrganization:a,canManageHR:n}=w(),[i,o]=k.useState(!1),l=k.useRef(null),c=[];if(a()&&c.push({id:"business-owner",label:"Business Owner",description:"Executive & Configuration",icon:Ze}),n()&&c.push({id:"hr-manager",label:"HR Manager",description:"HR Operations & Compliance",icon:fe}),(a()||n())&&c.push({id:"hod-manager",label:"Department Manager",description:"Team Management",icon:re}),c.length<2)return null;k.useEffect(()=>{const e=e=>{l.current&&!l.current.contains(e.target)&&o(!1)};if(i)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i]);const d=k.useCallback(e=>{r(e),localStorage.setItem(Pi,e),o(!1)},[r]),u=c.find(t=>t.id===e),m=u?.icon||Ze;return t.jsxs("div",{className:`relative ${s}`,ref:l,children:[t.jsxs("button",{onClick:()=>o(!i),className:"flex items-center gap-1.5 px-2 py-1.5 sm:px-3 sm:py-2 sm:gap-2 rounded-lg transition-all duration-200 hover:scale-105 w-full sm:w-auto",style:{backgroundColor:"rgba(255,255,255,0.15)",backdropFilter:"blur(4px)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--color-text-inverse)"},children:[t.jsx(m,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0"}),t.jsxs("div",{className:"text-left flex-1 min-w-0",children:[t.jsx("div",{className:"text-[10px] sm:text-xs opacity-70 leading-none",children:"View as"}),t.jsx("div",{className:"text-xs sm:text-sm font-semibold leading-tight truncate",children:u?.label})]}),t.jsx(Ee,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0 transition-transform duration-200 "+(i?"rotate-180":"")})]}),i&&t.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 rounded-lg shadow-2xl overflow-hidden",style:{backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-border)",zIndex:9999},children:[t.jsxs("div",{className:"p-2",children:[t.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2 px-3 py-1",style:{color:"var(--color-text-secondary)"},children:"Switch Dashboard View"}),c.map(r=>{const s=r.icon,a=r.id===e;return t.jsxs("button",{onClick:()=>d(r.id),className:"w-full flex items-start gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 hover:scale-[1.02]",style:{backgroundColor:a?"var(--color-primary-subtle)":"transparent",borderLeft:a?"3px solid var(--color-primary)":"3px solid transparent"},children:[t.jsx(s,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"var(--color-primary)"}}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--color-text)"},children:[r.label,a&&t.jsx("span",{className:"ml-2 text-xs font-normal",style:{color:"var(--color-success)"},children:"● Active"})]}),t.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:r.description})]})]},r.id)})]}),t.jsx("div",{className:"px-3 py-2 text-xs",style:{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderTop:"1px solid var(--color-border)"},children:"💡 Your selection will be remembered for this session"})]})]})});function zi(e,t,r){const s=r(),a=localStorage.getItem(Pi);return"business-owner"===a&&e||"hr-manager"===a&&t||"hod-manager"===a&&(e||t)&&"business-owner"!==s&&"hr-manager"!==s?a:"business-owner"===s&&e?"business-owner":"hr-manager"===s&&t?"hr-manager":"hod-manager"===s?"hod-manager":e?"business-owner":t?"hr-manager":"business-owner"}Bi.displayName="DashboardRoleSelector";const Ii=k.memo(({className:r="",selectedRole:s,onRoleChange:a})=>{const n=(e=>{const[t,r]=k.useState(window.innerWidth>e),s=k.useCallback(()=>{r(window.innerWidth>e)},[e]);return k.useEffect(()=>(s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)),[s]),t})(768),{user:i}=m();let o=null;try{o=e()?.organization}catch(h){o=null}const{getPrimaryRole:l}=w(),c=()=>{switch(l()){case"business-owner":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-primary))"};case"hr-manager":return{background:"linear-gradient(135deg, var(--color-success), var(--color-info))"};case"hod-manager":return{background:"linear-gradient(135deg, var(--color-primary), var(--color-info))"};case"supervisor":return{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning-hover))"};case"super-user":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent-hover))"};default:return{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))"}}},d=()=>l()?.replace(/-/g," ").toUpperCase()||"USER",u=()=>{const e=(new Date).getHours();return e<12?"Morning":e<17?"Afternoon":"Evening"};return t.jsx("div",{className:r,children:n?t.jsxs(f,{padding:"md",shadow:"lg",className:"relative",style:{...c(),color:"var(--color-text-inverse)",overflow:"visible"},children:[t.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 rounded-full -translate-y-16 translate-x-16",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),t.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("h1",{className:"text-2xl font-bold",children:["Good ",u(),", ",i?.firstName,"! 👋"]})}),t.jsx("div",{className:"hidden lg:block text-sm opacity-90 pl-4 ml-2",style:{borderLeft:"1px solid rgba(255,255,255,0.2)"},children:o?.name||"SuperUser Dashboard"})]}),t.jsx("div",{className:"flex items-center gap-6",children:s&&a?t.jsx(Bi,{selectedRole:s,onRoleChange:a}):t.jsxs(v,{variant:"primary",size:"md",className:"flex items-center gap-2",style:{backgroundColor:"rgba(255,255,255,0.1)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)"},children:[t.jsx(et,{className:"w-4 h-4 opacity-80"}),t.jsx("div",{className:"text-sm font-medium",children:d()})]})})]})]}):t.jsxs(f,{padding:"none",shadow:"lg",className:"relative",style:{...c(),color:"var(--color-text-inverse)",overflow:"visible"},children:[t.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 rounded-full -translate-y-10 translate-x-10",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),t.jsxs("div",{className:"relative z-10 p-3 space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("p",{className:"text-xs leading-none",style:{opacity:.85},children:["Good ",u(),","]}),t.jsxs("h1",{className:"text-lg font-bold leading-tight mt-0.5",children:[i?.firstName,"! 👋"]})]}),t.jsx(v,{variant:"primary",size:"sm",className:"inline-block",style:{backgroundColor:"rgba(255,255,255,0.15)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)",fontSize:"9px",padding:"2px 5px",lineHeight:"1"},children:t.jsx("span",{className:"font-bold tracking-wider uppercase",children:d()})})]}),s&&a&&t.jsx(Bi,{selectedRole:s,onRoleChange:a})]})]})})});Ii.displayName="WelcomeSection";const _i=k.memo(({error:e,resetErrorBoundary:r})=>t.jsxs("div",{className:"rounded-lg p-6 m-4",style:{backgroundColor:"var(--color-alert-error-bg)",border:"1px solid var(--color-alert-error-border)"},children:[t.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--color-alert-error-text)"},children:"Something went wrong"}),t.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-alert-error-text)"},children:e.message}),t.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg transition-colors text-white",style:{backgroundColor:"var(--color-error)",hover:{backgroundColor:"var(--color-error)"}},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Try again"})]}));_i.displayName="ErrorFallback";const Ti=k.memo(()=>t.jsxs("div",{className:"animate-pulse py-4",children:[t.jsx("div",{className:"h-8 rounded w-1/3 mb-2",style:{backgroundColor:"var(--color-muted)"}}),t.jsx("div",{className:"h-4 rounded w-2/3",style:{backgroundColor:"var(--color-subtle)"}})]})),Mi=k.memo(()=>t.jsxs("div",{className:"rounded-2xl p-6 animate-pulse",style:{backgroundColor:"var(--color-card-background)",boxShadow:"var(--shadow-lg)",border:"1px solid var(--color-card-border)"},children:[t.jsx("div",{className:"h-6 rounded w-1/3 mb-4",style:{backgroundColor:"var(--color-muted)"}}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-4 rounded w-full",style:{backgroundColor:"var(--color-subtle)"}}),t.jsx("div",{className:"h-4 rounded w-3/4",style:{backgroundColor:"var(--color-subtle)"}})]})]}));Ti.displayName="WelcomeSkeleton",Mi.displayName="SkeletonCard";const Fi=k.memo(()=>{const{user:r}=m(),{organizationData:s}=e(),{getPrimaryRole:a,canManageOrganization:n,canManageHR:i}=w(),[o,l]=k.useState(()=>zi(n(),i(),a));k.useEffect(()=>{const e=zi(n(),i(),a);("business-owner"===o&&!n()||"hr-manager"===o&&!i()||"hod-manager"===o&&!n()&&!i())&&l(e)},[n,i,a,o]);return r?t.jsxs("div",{className:"space-y-6",children:[t.jsx(Ai,{FallbackComponent:_i,children:t.jsx(k.Suspense,{fallback:t.jsx(Ti,{}),children:t.jsx(Ii,{selectedRole:o,onRoleChange:e=>{l(e)}})})}),t.jsxs("div",{children:["business-owner"===o&&n()&&t.jsx(Ai,{FallbackComponent:_i,children:t.jsx(k.Suspense,{fallback:t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[t.jsx(Mi,{}),t.jsx(Mi,{}),t.jsx(Mi,{})]}),children:t.jsx(N,{})})}),"hr-manager"===o&&i()&&t.jsx(Ai,{FallbackComponent:_i,children:t.jsx(k.Suspense,{fallback:t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-4 mb-6",children:[t.jsx(Mi,{}),t.jsx(Mi,{}),t.jsx(Mi,{}),t.jsx(Mi,{})]}),children:t.jsx(ht,{})})}),("hod-manager"===o||"hod-manager"===a())&&t.jsx(Ai,{FallbackComponent:_i,children:t.jsx(k.Suspense,{fallback:t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[t.jsx(Mi,{}),t.jsx(Mi,{}),t.jsx(Mi,{})]}),children:t.jsx(pt,{})})}),t.jsx("div",{className:"mt-6",children:t.jsx(Ai,{FallbackComponent:_i,children:t.jsx(k.Suspense,{fallback:t.jsx("div",{className:"h-20 bg-white rounded-xl shadow-sm animate-pulse border border-gray-100"}),children:t.jsx(Si,{})})})})]})]}):t.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:t.jsx("div",{className:"text-center",children:t.jsx("div",{className:"text-gray-600",children:"Loading dashboard..."})})})});Fi.displayName="BusinessDashboard";const Oi=({client:e,isOpen:s,onClose:a,onUpdate:i})=>{const[o,l]=k.useState("general"),[c,u]=k.useState(!1),[m,h]=k.useState(!1),[p,g]=k.useState({totalEmployees:0,totalWarnings:0,totalCategories:0,totalUsers:0}),[x,f]=k.useState({name:e.name||"",contactEmail:e.contactEmail||"",contactPhone:e.contactPhone||"",address:e.address||"",industry:e.industry||"",description:e.description||""});k.useEffect(()=>{console.log("📊 Client data received:",e),console.log("📊 Client.industry:",e.industry),console.log("📊 Client.sector:",e.sector),f({name:e.name||"",contactEmail:e.contactEmail||"",contactPhone:e.contactPhone||"",address:e.address||"",industry:e.industry||e.sector||"",description:e.description||""})},[e]),k.useEffect(()=>{s&&e.id&&y()},[s,e.id]);const y=async()=>{try{u(!0),e.id;const t=await n.loadEmployees(e.id),s=await n.loadWarnings(e.id),a=await d.queryDocuments(e.id,"categories",[]);g({totalEmployees:t.documents.length,totalWarnings:s.documents.length,totalCategories:a.documents.length,totalUsers:0}),r.success("Client statistics loaded successfully")}catch(t){"permission-denied"===t?.code||t?.message?.includes("Missing or insufficient permissions")?g({totalEmployees:0,totalWarnings:0,totalCategories:0,totalUsers:0}):r.error("Failed to load client statistics:",t)}finally{u(!1)}},v=[{id:"general",label:"General Info",icon:ve,description:"Basic organization details"},{id:"categories",label:"Warning Categories",icon:rt,description:"Manage warning categories and escalation paths"},{id:"analytics",label:"Analytics",icon:ae,description:"Performance metrics and insights"}];return s?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:t.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-blue-50 to-indigo-50",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:t.jsx(ve,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-gray-900",children:e.name}),t.jsxs("p",{className:"text-sm text-gray-600 flex items-center gap-2",children:[t.jsx(tt,{className:"w-4 h-4 text-yellow-500"}),"Client Organization Management"]})]})]}),t.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:t.jsx(le,{className:"w-5 h-5 text-gray-600"})})]}),t.jsx("div",{className:"p-6 border-b bg-gray-50",children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-blue-600",children:p.totalEmployees}),t.jsx("div",{className:"text-xs text-gray-600",children:"Employees"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.totalCategories}),t.jsx("div",{className:"text-xs text-gray-600",children:"Categories"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-orange-600",children:p.totalWarnings}),t.jsx("div",{className:"text-xs text-gray-600",children:"Total Warnings"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-2xl font-bold text-green-600",children:"✓"}),t.jsx("div",{className:"text-xs text-gray-600",children:"Status"})]})]})}),t.jsx("div",{className:"border-b",children:t.jsx("nav",{className:"flex space-x-1 p-2",children:v.map(e=>{const r=e.icon;return t.jsxs("button",{onClick:()=>l(e.id),className:"flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg transition-colors "+(o===e.id?"bg-blue-100 text-blue-700 border border-blue-200":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),children:[t.jsx(r,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:block",children:e.label})]},e.id)})})}),t.jsxs("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 200px)"},children:["general"===o&&t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Organization Details"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Update basic organization information"})]}),t.jsxs("button",{onClick:async()=>{try{h(!0),await i(e.id,x),r.success("Client information updated successfully")}catch(t){r.error("Failed to update client information:",t)}finally{h(!1)}},disabled:m,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[m?t.jsx(ce,{className:"w-4 h-4 animate-spin"}):t.jsx(st,{className:"w-4 h-4"}),m?"Saving...":"Save Changes"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Organization Name"}),t.jsx("input",{type:"text",value:x.name,onChange:e=>f({...x,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter organization name"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),t.jsxs("select",{value:x.industry,onChange:e=>f({...x,industry:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"",children:"Select industry"}),t.jsxs("optgroup",{label:"Primary Industries",children:[t.jsx("option",{value:"agriculture",children:"Agriculture & Farming"}),t.jsx("option",{value:"mining",children:"Mining & Quarrying"}),t.jsx("option",{value:"forestry",children:"Forestry & Logging"}),t.jsx("option",{value:"fishing",children:"Fishing & Aquaculture"})]}),t.jsxs("optgroup",{label:"Manufacturing & Production",children:[t.jsx("option",{value:"manufacturing",children:"Manufacturing (General)"}),t.jsx("option",{value:"food-processing",children:"Food & Beverage Processing"}),t.jsx("option",{value:"textiles",children:"Textiles & Clothing"}),t.jsx("option",{value:"automotive",children:"Automotive Manufacturing"}),t.jsx("option",{value:"pharmaceuticals",children:"Pharmaceuticals & Medical Devices"}),t.jsx("option",{value:"chemicals",children:"Chemicals & Plastics"}),t.jsx("option",{value:"electronics",children:"Electronics & Technology Manufacturing"}),t.jsx("option",{value:"construction-materials",children:"Construction Materials"})]}),t.jsxs("optgroup",{label:"Construction & Engineering",children:[t.jsx("option",{value:"construction",children:"Construction & Building"}),t.jsx("option",{value:"civil-engineering",children:"Civil Engineering"}),t.jsx("option",{value:"electrical-engineering",children:"Electrical Engineering"}),t.jsx("option",{value:"mechanical-engineering",children:"Mechanical Engineering"}),t.jsx("option",{value:"architecture",children:"Architecture & Design"})]}),t.jsxs("optgroup",{label:"Retail & Wholesale",children:[t.jsx("option",{value:"retail",children:"Retail & Commerce (General)"}),t.jsx("option",{value:"wholesale",children:"Wholesale & Distribution"}),t.jsx("option",{value:"supermarkets",children:"Supermarkets & Grocery"}),t.jsx("option",{value:"fashion-retail",children:"Fashion & Apparel Retail"}),t.jsx("option",{value:"automotive-retail",children:"Automotive Sales & Service"}),t.jsx("option",{value:"furniture-retail",children:"Furniture & Home Goods"}),t.jsx("option",{value:"electronics-retail",children:"Electronics & Appliances Retail"})]}),t.jsxs("optgroup",{label:"Hospitality & Tourism",children:[t.jsx("option",{value:"hospitality",children:"Hospitality & Tourism"}),t.jsx("option",{value:"hotels",children:"Hotels & Accommodation"}),t.jsx("option",{value:"restaurants",children:"Restaurants & Food Service"}),t.jsx("option",{value:"travel-agencies",children:"Travel Agencies & Tour Operators"}),t.jsx("option",{value:"entertainment",children:"Entertainment & Recreation"})]}),t.jsxs("optgroup",{label:"Healthcare & Social Services",children:[t.jsx("option",{value:"healthcare",children:"Healthcare (General)"}),t.jsx("option",{value:"hospitals",children:"Hospitals & Clinics"}),t.jsx("option",{value:"nursing-homes",children:"Nursing Homes & Elderly Care"}),t.jsx("option",{value:"medical-practices",children:"Medical Practices & Specialists"}),t.jsx("option",{value:"veterinary",children:"Veterinary Services"}),t.jsx("option",{value:"social-services",children:"Social Services & NGOs"})]}),t.jsxs("optgroup",{label:"Education & Training",children:[t.jsx("option",{value:"education",children:"Education & Training"}),t.jsx("option",{value:"schools",children:"Schools & Colleges"}),t.jsx("option",{value:"universities",children:"Universities & Higher Education"}),t.jsx("option",{value:"vocational-training",children:"Vocational & Skills Training"}),t.jsx("option",{value:"childcare",children:"Childcare & Early Learning"})]}),t.jsxs("optgroup",{label:"Financial Services",children:[t.jsx("option",{value:"banking",children:"Banking & Financial Services"}),t.jsx("option",{value:"insurance",children:"Insurance"}),t.jsx("option",{value:"investment",children:"Investment & Asset Management"}),t.jsx("option",{value:"accounting",children:"Accounting & Auditing"}),t.jsx("option",{value:"real-estate",children:"Real Estate & Property Management"})]}),t.jsxs("optgroup",{label:"Professional Services",children:[t.jsx("option",{value:"legal",children:"Legal Services"}),t.jsx("option",{value:"consulting",children:"Consulting & Advisory"}),t.jsx("option",{value:"marketing",children:"Marketing & Advertising"}),t.jsx("option",{value:"hr-recruitment",children:"HR & Recruitment"}),t.jsx("option",{value:"business-services",children:"Business Support Services"})]}),t.jsxs("optgroup",{label:"Technology & Communications",children:[t.jsx("option",{value:"it-services",children:"IT Services & Software"}),t.jsx("option",{value:"telecommunications",children:"Telecommunications"}),t.jsx("option",{value:"media",children:"Media & Broadcasting"}),t.jsx("option",{value:"publishing",children:"Publishing & Printing"}),t.jsx("option",{value:"data-centers",children:"Data Centers & Cloud Services"})]}),t.jsxs("optgroup",{label:"Transportation & Logistics",children:[t.jsx("option",{value:"logistics",children:"Logistics & Supply Chain"}),t.jsx("option",{value:"transportation",children:"Transportation & Freight"}),t.jsx("option",{value:"warehousing",children:"Warehousing & Storage"}),t.jsx("option",{value:"courier",children:"Courier & Postal Services"}),t.jsx("option",{value:"aviation",children:"Aviation & Airports"}),t.jsx("option",{value:"maritime",children:"Maritime & Shipping"})]}),t.jsxs("optgroup",{label:"Energy & Utilities",children:[t.jsx("option",{value:"energy",children:"Energy & Power Generation"}),t.jsx("option",{value:"renewable-energy",children:"Renewable Energy"}),t.jsx("option",{value:"water-utilities",children:"Water & Sanitation"}),t.jsx("option",{value:"waste-management",children:"Waste Management & Recycling"})]}),t.jsxs("optgroup",{label:"Security & Emergency Services",children:[t.jsx("option",{value:"security",children:"Security Services"}),t.jsx("option",{value:"private-security",children:"Private Security & Guarding"}),t.jsx("option",{value:"emergency-services",children:"Emergency Services"}),t.jsx("option",{value:"fire-safety",children:"Fire Safety & Protection"})]}),t.jsxs("optgroup",{label:"Government & Public Sector",children:[t.jsx("option",{value:"government",children:"Government & Public Administration"}),t.jsx("option",{value:"municipal",children:"Municipal Services"}),t.jsx("option",{value:"public-utilities",children:"Public Utilities"})]}),t.jsxs("optgroup",{label:"Other",children:[t.jsx("option",{value:"sports",children:"Sports & Fitness"}),t.jsx("option",{value:"beauty-wellness",children:"Beauty & Wellness"}),t.jsx("option",{value:"cleaning",children:"Cleaning & Facilities Management"}),t.jsx("option",{value:"maintenance",children:"Maintenance & Repair Services"}),t.jsx("option",{value:"other",children:"Other Industry"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email"}),t.jsxs("div",{className:"relative",children:[t.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"email",value:x.contactEmail,onChange:e=>f({...x,contactEmail:e.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@organization.com"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone"}),t.jsxs("div",{className:"relative",children:[t.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"tel",value:x.contactPhone,onChange:e=>f({...x,contactPhone:e.target.value}),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 XX XXX XXXX"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),t.jsxs("div",{className:"relative",children:[t.jsx(Z,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),t.jsx("textarea",{value:x.address,onChange:e=>f({...x,address:e.target.value}),rows:3,className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Full business address"})]})]})]}),"categories"===o&&t.jsx(j,{onClose:()=>{},inline:!0,organizationId:e.id,organizationName:e.name,allowEdit:!0}),"analytics"===o&&t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Performance Analytics"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Insights and metrics for this client organization"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:"Active Warnings"}),t.jsx(ie,{className:"w-5 h-5 text-orange-500"})]}),t.jsx("div",{className:"text-3xl font-bold text-orange-600",children:p.activeWarnings}),t.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["Out of ",p.totalWarnings," total warnings"]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:"Total Employees"}),t.jsx(re,{className:"w-5 h-5 text-blue-500"})]}),t.jsx("div",{className:"text-3xl font-bold text-blue-600",children:p.totalEmployees}),t.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Managed workforce"})]})]}),t.jsxs("div",{className:"mt-8",children:[t.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:"Quick Recommendations"}),t.jsxs("div",{className:"space-y-3",children:[p.activeWarnings>5&&t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[t.jsx(ie,{className:"w-5 h-5 text-orange-500 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-orange-900",children:"High Active Warnings"}),t.jsx("p",{className:"text-sm text-orange-700",children:"Consider reviewing and resolving active warnings to improve workforce management."})]})]}),p.totalCategories<5&&t.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[t.jsx(at,{className:"w-5 h-5 text-blue-500 mt-0.5"}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-medium text-blue-900",children:"Limited Warning Categories"}),t.jsx("p",{className:"text-sm text-blue-700",children:"Consider adding more specific warning categories to improve HR management granularity."})]})]})]})]})]})]})]})}):null},Li=({client:e,isOpen:r,onClose:s})=>{return t.jsx(x,{isOpen:r,onClose:s,title:"Client Organization Summary",maxWidth:"2xl",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-start gap-4 pb-6 border-b border-gray-200",children:[t.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:t.jsx(nt,{className:"w-6 h-6 text-blue-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900",children:e.name}),t.jsx("p",{className:"text-gray-600",children:e.sector}),t.jsx("div",{className:"mt-2",children:t.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium ${(e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-red-600 bg-red-100";case"trial":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}})(e.metrics.subscriptionStatus)}`,children:[(e=>{switch(e){case"active":return t.jsx(ne,{className:"w-4 h-4"});case"inactive":return t.jsx(ie,{className:"w-4 h-4"});case"trial":return t.jsx(pe,{className:"w-4 h-4"});default:return null}})(e.metrics.subscriptionStatus),e.metrics.subscriptionStatus.charAt(0).toUpperCase()+e.metrics.subscriptionStatus.slice(1)]})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-4 border border-blue-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(re,{className:"w-4 h-4 text-blue-600"}),t.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Employees"})]}),t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:e.metrics.employeeCount})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-4 border border-green-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(se,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-900",children:"Revenue"})]}),t.jsx("div",{className:"text-2xl font-bold text-green-900",children:(a=e.metrics.monthlyRevenue,`R${(a/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`)}),t.jsx("div",{className:"text-xs text-green-700 mt-1",children:"per month"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-4 border border-purple-200",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(ae,{className:"w-4 h-4 text-purple-600"}),t.jsx("span",{className:"text-sm font-medium text-purple-900",children:"Warnings"})]}),t.jsx("div",{className:"text-2xl font-bold text-purple-900",children:e.metrics.warningsThisMonth}),t.jsx("div",{className:"text-xs text-purple-700 mt-1",children:"this month"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:"Contact Information"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ee,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Email"}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.contactEmail||"Not provided"})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(te,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Phone"}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.contactPhone||"Not provided"})]})]}),e.address&&t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(Z,{className:"w-4 h-4 text-gray-400 flex-shrink-0 mt-0.5"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Address"}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.address})]})]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:"Activity"}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(pe,{className:"w-4 h-4 text-gray-400 flex-shrink-0"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Last Activity"}),t.jsx("div",{className:"text-sm font-medium text-gray-900",children:new Date(e.metrics.lastActivity).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})})]})]})})]}),e.registrationNumber&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:"Organization Details"}),t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Registration Number"}),t.jsx("div",{className:"text-sm font-medium text-gray-900 mt-1",children:e.registrationNumber})]})]}),t.jsx("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:t.jsx("button",{onClick:s,className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Close"})})]})});var a},Hi=({onDeployClient:e})=>{const{user:a}=m(),[n,i]=k.useState([]),[o,l]=k.useState(!0),[c,d]=k.useState(""),[u,h]=k.useState("all"),[p,g]=k.useState(null),[x,f]=k.useState(!1),[y,v]=k.useState(!1),[b,j]=k.useState(null),[w,N]=k.useState(1);k.useEffect(()=>{a?.resellerId&&C()},[a?.resellerId]);const C=async()=>{if(a?.resellerId)try{l(!0),a.resellerId;const e=await s.getResellerClients(a.resellerId),t=await Promise.all(e.map(async e=>{const t=await Ct.getClientMetrics(e.id,e);return{...e,metrics:t}}));i(t),r.success(`Loaded ${t.length} clients`)}catch(e){r.error("Failed to load clients:",e)}finally{l(!1)}},S=n.filter(e=>{const t=e.name.toLowerCase().includes(c.toLowerCase())||e.sector.toLowerCase().includes(c.toLowerCase()),r="all"===u||e.metrics.subscriptionStatus===u;return t&&r}),R=Math.ceil(S.length/10),E=10*(w-1),D=E+10,A=S.slice(E,D);k.useEffect(()=>{N(1)},[c,u]);const P=e=>`R${(e/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,B=e=>{switch(e){case"active":return"text-green-600 bg-green-100";case"inactive":return"text-red-600 bg-red-100";case"trial":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}};return o?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading your clients..."})]})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"My Clients"}),t.jsx("p",{className:"text-gray-600",children:"Manage your client organizations"})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[e&&t.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors font-semibold",children:[t.jsx(Ke,{className:"w-4 h-4"}),"Deploy New Client"]}),t.jsxs("span",{className:"text-sm text-gray-600",children:[S.length," of ",n.length," clients"]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(Ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"Search clients by name or sector...",value:c,onChange:e=>d(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),t.jsxs("select",{value:u,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm min-w-[140px]",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"inactive",children:"Inactive"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(nt,{className:"w-5 h-5 text-blue-500"}),t.jsx("span",{className:"font-medium",children:"Active Clients"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:n.filter(e=>"active"===e.metrics.subscriptionStatus).length})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(se,{className:"w-5 h-5 text-green-500"}),t.jsx("span",{className:"font-medium",children:"Monthly Revenue"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:P(n.reduce((e,t)=>e+t.metrics.monthlyRevenue,0))})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx(re,{className:"w-5 h-5 text-purple-500"}),t.jsx("span",{className:"font-medium",children:"Total Employees"})]}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:n.reduce((e,t)=>e+t.metrics.employeeCount,0)})]})]}),t.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-semibold",children:"Client Organizations"})}),t.jsxs("div",{className:"overflow-x-auto",children:[t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organization"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Revenue"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Performance"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),t.jsx("tbody",{className:"divide-y divide-gray-200",children:A.map(e=>t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[t.jsx("span",{children:e.sector}),t.jsx("span",{children:"•"}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(re,{className:"w-3 h-3"}),e.metrics.employeeCount," employees"]})]})]})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"text-sm flex items-center gap-1",children:[t.jsx(ee,{className:"w-3 h-3 text-gray-400"}),t.jsx("span",{children:e.contactEmail||"Not provided"})]}),t.jsxs("div",{className:"text-sm flex items-center gap-1",children:[t.jsx(te,{className:"w-3 h-3 text-gray-400"}),t.jsx("span",{children:e.contactPhone||"Not provided"})]})]})}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${B(e.metrics.subscriptionStatus)}`,children:["active"===e.metrics.subscriptionStatus&&t.jsx(ne,{className:"w-3 h-3"}),"inactive"===e.metrics.subscriptionStatus&&t.jsx(ie,{className:"w-3 h-3"}),"trial"===e.metrics.subscriptionStatus&&t.jsx(pe,{className:"w-3 h-3"}),e.metrics.subscriptionStatus.charAt(0).toUpperCase()+e.metrics.subscriptionStatus.slice(1)]}),t.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Last active: ",new Date(e.metrics.lastActivity).toLocaleDateString("en-ZA")]})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsx("div",{className:"font-semibold text-gray-900",children:P(e.metrics.monthlyRevenue)}),t.jsx("div",{className:"text-xs text-gray-500",children:"per month"})]}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[t.jsxs("div",{className:"text-sm text-gray-900",children:[t.jsx("span",{className:"font-medium",children:e.metrics.warningsThisMonth}),t.jsx("span",{className:"text-gray-500",children:" warnings"})]}),t.jsx("div",{className:"text-xs text-gray-500",children:"this month"})]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>{g(e),f(!0)},className:"text-blue-600 hover:text-blue-800",title:"Manage client organization",children:t.jsx(oe,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{j(e),v(!0)},className:"text-green-600 hover:text-green-800",title:"View organization summary",children:t.jsx(it,{className:"w-4 h-4"})})]})})]},e.id))})]}),0===S.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(nt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-600",children:"No clients found"}),t.jsx("p",{className:"text-sm text-gray-500",children:c||"all"!==u?"Try adjusting your search or filters":"Your client organizations will appear here"})]}),R>1&&t.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",E+1," to ",Math.min(D,S.length)," of ",S.length," clients"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>N(Math.max(1,w-1)),disabled:1===w,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:"Previous"}),Array.from({length:Math.min(5,R)},(e,r)=>{const s=Math.max(1,w-2)+r;return s>R?null:t.jsx("button",{onClick:()=>N(s),className:`\n                          px-3 py-1 border rounded text-sm transition-colors\n                          ${s===w?"bg-blue-600 border-blue-600 text-white":"border-gray-300 hover:bg-gray-50"}\n                        `,children:s},s)}),t.jsx("button",{onClick:()=>N(Math.min(R,w+1)),disabled:w===R,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:"Next"})]})]})})]})]}),p&&t.jsx(Oi,{client:p,isOpen:x,onClose:()=>{f(!1),g(null)},onUpdate:async(e,t)=>{try{await s.updateOrganization(e,t),r.success("Client updated successfully"),await C(),f(!1),g(null)}catch(a){r.error("Failed to update client:",a)}}}),b&&t.jsx(Li,{client:b,isOpen:y,onClose:()=>{v(!1),j(null)}})]})},Ui=Object.freeze(Object.defineProperty({__proto__:null,MyClients:Hi},Symbol.toStringTag,{value:"Module"})),Wi=()=>{const{user:e}=m(),a=(e=>{const[t,r]=k.useState(window.innerWidth>e),s=k.useCallback(()=>r(window.innerWidth>e),[e]);return k.useEffect(()=>(window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)),[s]),t})(768),[n,i]=k.useState(null),[o,l]=k.useState(!0),[c,d]=k.useState("6m"),[u,h]=k.useState(null),[p,g]=k.useState(!1);k.useEffect(()=>{e?.resellerId&&x()},[e?.resellerId,c]);const x=async()=>{if(e?.resellerId)try{l(!0),e.resellerId;const[t,a,n,o,d]=await Promise.all([s.getReseller(e.resellerId),Ct.getResellerMetrics(e.resellerId),s.getResellerClients(e.resellerId),Ct.getRecentCommissions(e.resellerId,5),Ct.getPerformanceTrend(e.resellerId,c)]);if(!t)throw new Error("Reseller profile not found");i({reseller:t,metrics:a,clients:n,recentCommissions:o,monthlyTrend:d}),r.success("Reseller dashboard loaded successfully")}catch(t){r.error("Failed to load reseller dashboard:",t)}finally{l(!1)}},y=e=>`R${(e/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,v=e=>`${e>0?"+":""}${e.toFixed(1)}%`,b=async()=>{if(e?.resellerId)try{await Ct.generateCommissionStatement(e.resellerId),r.success("Commission statement downloaded")}catch(t){r.error("Failed to generate commission statement:",t)}},j=async e=>{r.success("Organization deployed successfully!",e),g(!1),await x()};if(o)return t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});if(!n)return t.jsxs("div",{className:"text-center py-12",children:[t.jsx(nt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reseller Profile Not Found"}),t.jsx("p",{className:"text-gray-600",children:"Please contact support to set up your reseller account."})]});const{reseller:w,metrics:N,clients:C,recentCommissions:S,monthlyTrend:R}=n;return a?t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white",children:t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",w.firstName,"!"]}),t.jsxs("p",{className:"text-blue-100 flex items-center gap-4 mt-2",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(Je,{className:"w-4 h-4"}),w.province]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(at,{className:"w-4 h-4"}),(100*w.commissionRate).toFixed(0),"% Commission Rate"]})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3",children:[t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("clients"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(re,{className:"w-8 h-8 text-blue-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Clients"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:N.totalClients}),t.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[N.activeClients," active"]})]})]})}),t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(se,{className:"w-8 h-8 text-green-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Monthly Revenue"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:y(N.monthlyRecurringRevenue)}),t.jsxs("div",{className:"text-xs text-green-600 flex items-center gap-1",children:[t.jsx(ae,{className:"w-3 h-3"}),v(N.monthlyGrowth)]})]})]})}),t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ot,{className:"w-8 h-8 text-yellow-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Commissions"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:y(N.totalCommissionsEarned)}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Lifetime earnings"})]})]})}),t.jsx(f,{padding:"sm",shadow:"md",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer",style:{minHeight:"80px"},children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(at,{className:"w-8 h-8 text-purple-600",style:{opacity:.7}}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Avg Client Value"}),t.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:y(N.averageClientValue)}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Per month"})]})]})})]}),t.jsx("div",{className:"border-b",style:{borderColor:"var(--color-border)"},children:t.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"overview",label:"Overview",count:null},{id:"clients",label:"My Clients",count:N.totalClients},{id:"performance",label:"Performance",count:null}].map(e=>t.jsxs("button",{onClick:()=>h(e.id),className:"py-3 px-1 border-b-2 font-medium text-sm transition-colors "+(u===e.id?"border-blue-500 text-blue-600":"border-transparent hover:border-gray-300"),style:{color:u===e.id?"var(--color-primary)":"var(--color-text-secondary)"},children:[e.label,null!==e.count&&t.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100",children:e.count})]},e.id))})}),u&&function(){switch(u){case"overview":return t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs(f,{padding:"lg",shadow:"md",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-text)"},children:"Recent Clients"}),t.jsxs("div",{className:"space-y-3",children:[C.slice(0,2).map(e=>t.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.name}),t.jsxs("div",{className:"text-sm flex items-center gap-3",style:{color:"var(--color-text-secondary)"},children:[t.jsx("span",{children:e.industry||e.sector}),t.jsxs("span",{children:[e.employeeCount||0," employees"]})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm font-semibold text-green-600",children:y(e.monthlySubscription||0)}),t.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"monthly"})]})]},e.id)),C.length>2&&t.jsx("div",{className:"text-center pt-2",children:t.jsxs("button",{onClick:()=>h("clients"),className:"text-sm text-blue-600 hover:text-blue-800",children:["View all ",C.length," clients →"]})}),0===C.length&&t.jsxs("div",{className:"text-center py-6",children:[t.jsx(nt,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No clients yet"}),t.jsx("button",{onClick:()=>g(!0),className:"mt-3 text-sm text-blue-600 hover:text-blue-800",children:"Deploy your first client"})]})]})]}),t.jsxs(f,{padding:"lg",shadow:"md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Recent Earnings"}),t.jsxs("button",{onClick:b,className:"text-sm text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[t.jsx(He,{className:"w-4 h-4"}),"Download"]})]}),t.jsxs("div",{className:"space-y-3",children:[S.map(e=>t.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.clientName}),t.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:new Date(e.periodStart).toLocaleDateString("en-ZA")})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"font-semibold text-green-600",children:y(e.commissionAmount)}),t.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[(100*e.commissionRate).toFixed(0),"% of ",y(e.baseAmount)]})]})]},e.id)),0===S.length&&t.jsxs("div",{className:"text-center py-6",children:[t.jsx(se,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No recent commissions"}),t.jsx("p",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:"Earnings will appear here as clients are billed"})]})]})]})]});case"clients":return t.jsx(Hi,{onDeployClient:()=>g(!0)});case"performance":return t.jsxs(f,{padding:"lg",shadow:"md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Performance Trend"}),t.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[t.jsx("option",{value:"3m",children:"3 Months"}),t.jsx("option",{value:"6m",children:"6 Months"}),t.jsx("option",{value:"12m",children:"12 Months"})]})]}),t.jsxs("div",{className:"space-y-3",children:[R.map((e,r)=>t.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:e.month}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Revenue: "}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:y(e.revenue)})]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Commission: "}),t.jsx("span",{className:"font-semibold text-green-600",children:y(e.commissions)})]})]})]},r)),0===R.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No performance data available yet"})]})]})]});default:return null}}(),t.jsx(Si,{}),E()]}):t.jsxs("div",{className:"space-y-6 pb-20",children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:["Welcome back, ",w.firstName,"!"]}),t.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:[w.province," • ",(100*w.commissionRate).toFixed(0),"% Commission Rate"]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("clients"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(re,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Clients"}),t.jsx("span",{className:"text-lg font-bold",children:N.totalClients})]})}),t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(se,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Monthly Earnings"}),t.jsx("span",{className:"text-lg font-bold",children:y(N.monthlyCommissions)})]})}),t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("overview"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(ot,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Earned"}),t.jsx("span",{className:"text-lg font-bold",children:y(N.totalCommissionsEarned)})]})}),t.jsx(f,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>h("performance"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #8b5cf6, #7c3aed)",color:"white",minHeight:"80px",willChange:"transform"},children:t.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[t.jsx(ae,{className:"w-5 h-5"}),t.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Growth"}),t.jsx("span",{className:"text-lg font-bold",children:v(N.monthlyGrowth)})]})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx(f,{padding:"md",shadow:"sm",hover:!0,onClick:()=>h("clients"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(nt,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"My Clients"})]}),t.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),t.jsx(f,{padding:"md",shadow:"sm",hover:!0,onClick:()=>h("performance"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(ae,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Performance Trends"})]}),t.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),t.jsx(f,{padding:"md",shadow:"sm",hover:!0,onClick:b,className:"cursor-pointer transition-all duration-200 active:scale-95",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(He,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Download Statement"})]}),t.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),t.jsx(Si,{}),"clients"===u&&t.jsx("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:t.jsxs("div",{className:"p-4",children:[t.jsx("button",{onClick:()=>h(null),className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center gap-2",children:"← Back to Dashboard"}),t.jsx(Hi,{onDeployClient:()=>g(!0)})]})}),"performance"===u&&t.jsx("div",{className:"fixed inset-0 bg-white z-50 overflow-y-auto",children:t.jsxs("div",{className:"p-4",children:[t.jsx("button",{onClick:()=>h(null),className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center gap-2",children:"← Back to Dashboard"}),t.jsxs(f,{padding:"lg",shadow:"md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Performance Trend"}),t.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[t.jsx("option",{value:"3m",children:"3 Months"}),t.jsx("option",{value:"6m",children:"6 Months"}),t.jsx("option",{value:"12m",children:"12 Months"})]})]}),t.jsxs("div",{className:"space-y-3",children:[R.map((e,r)=>t.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:e.month}),t.jsxs("div",{className:"flex flex-col gap-1 text-right",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Revenue: "}),t.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:y(e.revenue)})]}),t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{style:{color:"var(--color-text-secondary)"},children:"Commission: "}),t.jsx("span",{className:"font-semibold text-green-600",children:y(e.commissions)})]})]})]},r)),0===R.length&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),t.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No performance data available yet"})]})]})]})]})}),E()]});function E(){return t.jsx(t.Fragment,{children:p&&t.jsx(Fs,{isOpen:p,onClose:()=>g(!1),onComplete:j})})}},$i=Object.freeze(Object.defineProperty({__proto__:null,ResellerDashboard:Wi},Symbol.toStringTag,{value:"Module"})),Gi={"super-user":{id:"super-user",name:"Super User",description:"System administrator with global access",level:1},reseller:{id:"reseller",name:"Reseller",description:"Provincial sales partner with client management",level:1.5},"business-owner":{id:"business-owner",name:"Business Owner",description:"CEO/Director with organization overview",level:2},"hr-manager":{id:"hr-manager",name:"HR Manager",description:"Human Resources with employee management",level:3},"hod-manager":{id:"hod-manager",name:"HOD/Manager",description:"Department head with warning creation",level:4}},qi={"super-user":{canManage:["super-user","reseller","business-owner","hr-manager","hod-manager"],canCreate:["reseller","business-owner","hr-manager","hod-manager"],canDelete:["reseller","business-owner","hr-manager","hod-manager"],scope:"global"},reseller:{canManage:[],canCreate:!1,canDelete:!1,canUpdate:!1,scope:"assigned-clients",restrictions:["Cannot create or manage user accounts","Cannot access employee data or warnings","Can only view and update assigned client organizations","Limited to commission and billing information"]},"business-owner":{canManage:["hr-manager","hod-manager"],canCreate:["hr-manager","hod-manager"],canDelete:!1,canDeactivate:["hr-manager","hod-manager"],scope:"organization",restrictions:["Cannot create users for other organizations","Cannot modify super-user accounts","Cannot modify other business-owner accounts","Can only deactivate, not permanently delete users"]},"hr-manager":{canManage:["hod-manager"],canCreate:["hod-manager"],canUpdate:["hr-manager","hod-manager"],canDelete:!1,scope:"organization",restrictions:["Cannot modify business-owner accounts","Cannot change user roles","Cannot create HR manager accounts","Profile updates only (name, email, departments)"]}},Vi=(e,t,r,s,a)=>{const n=qi[e];if(!n)return!1;if("organization"===n.scope&&(!t||t!==s))return!1;switch(a){case"create":return n.canCreate?.includes(r)||!1;case"read":case"update":return n.canManage?.includes(r)||!1;case"delete":return!0===n.canDelete&&n.canManage?.includes(r)||!1;case"deactivate":return n.canDeactivate?.includes(r)||!1;default:return!1}},Yi={"business-owner":{capabilities:["✅ Create HR Manager accounts","✅ Create Department Manager accounts","✅ Update user profiles and departments","✅ Deactivate user accounts","✅ Reset user passwords","✅ View user activity logs","❌ Cannot manage other Business Owners","❌ Cannot permanently delete users","❌ Cannot access Super User accounts"],actions:["create","read","update","deactivate"],manageable_roles:["hr-manager","hod-manager"]},"hr-manager":{capabilities:["✅ Update user profiles (name, email)","✅ Update department assignments","✅ View user activity","✅ Create Department Manager accounts","❌ Cannot change user roles","❌ Cannot create HR Manager accounts","❌ Cannot deactivate users"],actions:["read","update"],manageable_roles:["hod-manager"]}},Xi=[{id:"executive",name:"Executive"},{id:"human-resources",name:"Human Resources"},{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"logistics",name:"Logistics"},{id:"finance",name:"Finance"}],Ki=()=>{const{user:e}=m(),[t,s]=k.useState({users:[],loading:!0,error:null,creatableRoles:[],userManagementRules:qi["business-owner"]});k.useEffect(()=>{if(e?.role?.id){const t=qi[e.role.id],r=(e=>{const t=qi[e];return t?.canCreate?t.canCreate.map(e=>Gi[e]).filter(Boolean):[]})(e.role.id);s(e=>({...e,userManagementRules:t||qi["business-owner"],creatableRoles:r}))}},[e]);const a=(r,s)=>!(!e||!t.userManagementRules)&&Vi(e.role.id,e.organizationId,r.role.id,r.organizationId,s),n=async()=>{if(e?.organizationId)try{s(e=>({...e,loading:!0,error:null})),e.organizationId;const t=await d.queryDocuments(e.organizationId,"users",[]),a=e=>"string"==typeof e?e:e?.id||"",n=t.documents.filter(t=>{const r=a(t.role);return"business-owner"!==r&&Vi(e.role.id,e.organizationId,r,t.organizationId,"read")}).map(e=>({...e,role:"string"==typeof e.role?Gi[e.role]:e.role}));r.success(`✅ Loaded ${n.length} manageable users from sharded structure`),s(e=>({...e,users:n,loading:!1}))}catch(t){r.error("❌ Error loading users:",t),s(e=>({...e,loading:!1,error:t instanceof Error?t.message:"Failed to load users"}))}else s(e=>({...e,loading:!1,error:"No organization found"}))};return k.useEffect(()=>{e?.organizationId&&t.userManagementRules&&n()},[e?.organizationId,t.userManagementRules]),{users:t.users,loading:t.loading,error:t.error,creatableRoles:t.creatableRoles,userManagementRules:t.userManagementRules,loadUsers:n,createUser:async a=>{if(!e?.organizationId)throw new Error("No organization found");if(!(t.userManagementRules.canCreate?.includes(a.roleId)||!1))throw new Error(`You don't have permission to create ${a.roleId} accounts`);try{a.email;const t=await C.signUp(a.email,a.password);r.success(5389);const n={id:t.uid,email:a.email,firstName:a.firstName,lastName:a.lastName,role:Gi[a.roleId],organizationId:e.organizationId,departmentIds:"hod-manager"===a.roleId?a.departmentIds:[],isActive:!0,createdAt:(new Date).toISOString(),lastLogin:void 0};await C.createDocument(S.USERS,n,t.uid),r.success(6159),s(e=>({...e,users:[...e.users,n]}))}catch(n){if(r.error("❌ Error creating user:",n),n instanceof Error){if(n.message.includes("email-already-in-use"))throw new Error("This email address is already registered");if(n.message.includes("weak-password"))throw new Error("Password is too weak. Please choose a stronger password");if(n.message.includes("invalid-email"))throw new Error("Please enter a valid email address")}throw n}},updateUser:async(t,a)=>{if(!e?.organizationId)throw new Error("No organization found");try{await d.updateDocument(e.organizationId,"users",t,{...a,updatedAt:(new Date).toISOString(),updatedBy:e?.id}),s(e=>({...e,users:e.users.map(e=>e.id===t?{...e,...a}:e)})),r.success(7586)}catch(n){throw r.error("❌ Error updating user:",n),n}},deactivateUser:async n=>{const i=t.users.find(e=>e.id===n);if(!i)throw new Error("User not found");if(!a(i,"deactivate"))throw new Error("You don't have permission to deactivate this user");try{await d.updateDocument(e.organizationId,"users",n,{isActive:!1,deactivatedAt:(new Date).toISOString(),deactivatedBy:e?.id}),s(e=>({...e,users:e.users.map(e=>e.id===n?{...e,isActive:!1}:e)})),r.success(8612)}catch(o){throw r.error("❌ Error deactivating user:",o),o}},reactivateUser:async t=>{try{await d.updateDocument(e.organizationId,"users",t,{isActive:!0,reactivatedAt:(new Date).toISOString(),reactivatedBy:e?.id}),s(e=>({...e,users:e.users.map(e=>e.id===t?{...e,isActive:!0}:e)})),r.success(9358)}catch(a){throw r.error("❌ Error reactivating user:",a),a}},canManageUser:a,getRoleColor:e=>{switch(e){case"business-owner":return"#dc2626";case"hr-manager":return"#059669";case"hod-manager":return"#7c3aed";default:return"#64748b"}},formatLastLogin:e=>{if(!e)return"Never";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},departments:Xi}},Ji=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],Qi=({onSubmit:e,onCancel:r,creatableRoles:s,loading:a})=>{const[n,i]=k.useState({email:"",firstName:"",lastName:"",roleId:"",departmentIds:[],password:"",confirmPassword:""}),[o,l]=k.useState({});return t.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:t.jsxs("div",{className:"hr-card",style:{width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",margin:"1rem"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid #e5e7eb"},children:[t.jsxs("h2",{style:{margin:0,color:"#1f2937",fontSize:"1.25rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(lt,{size:20}),"Create New User Account"]}),t.jsx("button",{onClick:r,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6b7280"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#f3f4f6",onMouseOut:e=>e.currentTarget.style.backgroundColor="transparent",children:t.jsx(le,{size:20})})]}),t.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return n.firstName.trim()||(e.firstName="First name is required"),n.lastName.trim()||(e.lastName="Last name is required"),n.email.trim()||(e.email="Email is required"),n.roleId||(e.roleId="Role is required"),n.password||(e.password="Password is required"),n.confirmPassword||(e.confirmPassword="Please confirm password"),n.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&(e.email="Please enter a valid email address"),n.password&&n.password.length<6&&(e.password="Password must be at least 6 characters"),n.password!==n.confirmPassword&&(e.confirmPassword="Passwords do not match"),"hod-manager"===n.roleId&&0===n.departmentIds.length&&(e.departmentIds="Please select at least one department for managers"),l(e),0===Object.keys(e).length})())try{await e(n)}catch(r){}},children:[t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Personal Information"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"First Name *"}),t.jsx("input",{type:"text",value:n.firstName,onChange:e=>i(t=>({...t,firstName:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.firstName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.firstName?"#ef4444":"#d1d5db"}),o.firstName&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.firstName})]}),t.jsxs("div",{children:[t.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"Last Name *"}),t.jsx("input",{type:"text",value:n.lastName,onChange:e=>i(t=>({...t,lastName:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.lastName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.lastName?"#ef4444":"#d1d5db"}),o.lastName&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.lastName})]})]}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[t.jsx(ee,{size:16}),"Email Address *"]}),t.jsx("input",{type:"email",value:n.email,onChange:e=>i(t=>({...t,email:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.email?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.email?"#ef4444":"#d1d5db"}),o.email&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.email})]})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Role & Permissions"}),t.jsxs("div",{style:{marginBottom:"1rem"},children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[t.jsx(fe,{size:16}),"User Role *"]}),t.jsxs("select",{value:n.roleId,onChange:e=>i(t=>({...t,roleId:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.roleId?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none",backgroundColor:"white"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.roleId?"#ef4444":"#d1d5db",children:[t.jsx("option",{value:"",children:"Select Role"}),s.map(e=>t.jsxs("option",{value:e.id,children:[e.name," - ",e.description]},e.id))]}),o.roleId&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.roleId})]}),"hod-manager"===n.roleId&&t.jsxs("div",{children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[t.jsx(re,{size:16}),"Departments (for HOD/Manager role) *"]}),t.jsx("div",{style:{border:o.departmentIds?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",padding:"0.75rem",backgroundColor:"#f9fafb",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:Ji.map(e=>t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontSize:"0.875rem"},children:[t.jsx("input",{type:"checkbox",checked:n.departmentIds.includes(e.id),onChange:()=>{return t=e.id,void i(e=>({...e,departmentIds:e.departmentIds.includes(t)?e.departmentIds.filter(e=>e!==t):[...e.departmentIds,t]}));var t},style:{margin:0}}),e.name]},e.id))}),o.departmentIds&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.departmentIds})]})]}),t.jsxs("div",{style:{marginBottom:"1.5rem"},children:[t.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Account Security"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[t.jsxs("div",{children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[t.jsx(Ie,{size:16}),"Password *"]}),t.jsx("input",{type:"password",value:n.password,onChange:e=>i(t=>({...t,password:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.password?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.password?"#ef4444":"#d1d5db",minLength:6}),o.password&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.password})]}),t.jsxs("div",{children:[t.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[t.jsx(Ie,{size:16}),"Confirm Password *"]}),t.jsx("input",{type:"password",value:n.confirmPassword,onChange:e=>i(t=>({...t,confirmPassword:e.target.value})),style:{width:"100%",padding:"0.75rem",border:o.confirmPassword?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:e=>e.target.style.borderColor="#3b82f6",onBlur:e=>e.target.style.borderColor=o.confirmPassword?"#ef4444":"#d1d5db",minLength:6}),o.confirmPassword&&t.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.confirmPassword})]})]})]}),t.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:[t.jsx("button",{type:"button",onClick:r,className:"hr-button-secondary",disabled:a,children:"Cancel"}),t.jsx("button",{type:"submit",className:"hr-button-primary",disabled:a,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:a?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Creating..."]}):t.jsx(t.Fragment,{children:"✅ Create User"})})]})]})]})})},Zi=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],eo=({users:e,loading:s,onDeactivateUser:a,onReactivateUser:n,onEditUser:i,canManageUser:o,getRoleColor:l,formatLastLogin:c})=>{const[d,u]=k.useState(null),m=e=>{if(!e)return"Unknown";try{return new Date(e).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},h=e=>t.jsx("span",{className:"hr-badge",style:{backgroundColor:l(e.role.id)+"20",color:l(e.role.id),border:`1px solid ${l(e.role.id)}`,fontWeight:"600"},children:e.role.name});return s?t.jsxs("div",{className:"hr-card",style:{padding:"3rem",textAlign:"center"},children:[t.jsx("h2",{style:{color:"#1e40af"},children:"👤 Loading Users..."}),t.jsx("p",{style:{color:"#64748b"},children:"Please wait while we load the user data."})]}):0===e.length?t.jsx("div",{className:"hr-card",children:t.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:[t.jsx(lt,{size:48,style:{color:"#d1d5db",margin:"0 auto 1rem"}}),t.jsx("h3",{style:{color:"#6b7280",marginBottom:"0.5rem"},children:"No manageable users found."}),t.jsx("p",{style:{color:"#9ca3af",margin:0},children:"Create your first HR Manager or Department Head!"})]})}):t.jsxs("div",{className:"hr-card",children:[t.jsxs("h3",{style:{margin:"0 0 1rem",color:"#1e40af",fontSize:"1.125rem",fontWeight:"600"},children:["👥 Organization Users (",e.length,")"]}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{borderBottom:"2px solid #e5e7eb"},children:[t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"User"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Role"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Departments"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Status"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Created"}),t.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Actions"})]})}),t.jsx("tbody",{children:e.map(s=>{return t.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb",opacity:s.isActive?1:.7,backgroundColor:s.isActive?"transparent":"#f9fafb"},children:[t.jsx("td",{style:{padding:"0.75rem"},children:t.jsxs("div",{children:[t.jsxs("div",{style:{fontWeight:"600",color:s.isActive?"#1f2937":"#6b7280",marginBottom:"0.25rem"},children:[s.firstName," ",s.lastName]}),t.jsx("div",{style:{fontSize:"0.875rem",color:s.isActive?"#64748b":"#9ca3af"},children:s.email})]})}),t.jsx("td",{style:{padding:"0.75rem"},children:h(s)}),t.jsx("td",{style:{padding:"0.75rem"},children:t.jsx("span",{style:{fontSize:"0.875rem",color:s.isActive?"#374151":"#6b7280"},children:(l=s.departmentIds,l&&0!==l.length?l.map(e=>Zi.find(t=>t.id===e)?.name||e).join(", "):"-")})}),t.jsx("td",{style:{padding:"0.75rem"},children:t.jsx("span",{className:"hr-badge "+(s.isActive?"hr-badge-success":"hr-badge-danger"),children:s.isActive?"✅ Active":"❌ Inactive"})}),t.jsx("td",{style:{padding:"0.75rem",fontSize:"0.875rem",color:"#6b7280"},children:m(s.createdAt)}),t.jsx("td",{style:{padding:"0.75rem"},children:t.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[o(s,"update")&&t.jsxs("button",{onClick:()=>i(s),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",border:"1px solid #bfdbfe",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Edit user details",children:[t.jsx(oe,{size:12}),"Edit"]}),o(s,"deactivate")&&t.jsx(t.Fragment,{children:s.isActive?t.jsxs("button",{onClick:()=>(async t=>{const s=e.find(e=>e.id===t);if(!s)return;if(confirm(`Are you sure you want to deactivate ${s.firstName} ${s.lastName}?\n\nThey will no longer be able to log in to the system.`))try{u(t),await a(t)}catch(n){r.error("Error deactivating user:",n)}finally{u(null)}})(s.id),disabled:d===s.id,className:"hr-button-danger",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:d===s.id?.6:1,cursor:d===s.id?"not-allowed":"pointer"},title:"Deactivate user account",children:[d===s.id?t.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):t.jsx(ct,{size:12}),"🚫 Deactivate"]}):t.jsxs("button",{onClick:()=>(async t=>{const s=e.find(e=>e.id===t);if(!s)return;if(confirm(`Are you sure you want to reactivate ${s.firstName} ${s.lastName}?\n\nThey will be able to log in again.`))try{u(t),await n(t)}catch(a){r.error("Error reactivating user:",a)}finally{u(null)}})(s.id),disabled:d===s.id,className:"hr-button-success",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:d===s.id?.6:1,cursor:d===s.id?"not-allowed":"pointer"},title:"Reactivate user account",children:[d===s.id?t.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #059669",borderRadius:"50%",animation:"spin 1s linear infinite"}}):t.jsx(dt,{size:12}),"✅ Reactivate"]})})]})})]},s.id);var l})})]})})]})},to=({currentUser:e,userManagementRules:r})=>{const s=Yi[e.role.id];return s?t.jsxs("div",{className:"hr-card",children:[t.jsxs("h4",{style:{margin:"0 0 1rem",color:"#7c3aed",fontSize:"1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:["🛡️ Your User Management Permissions (",e.role.name,")"]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[t.jsxs("div",{children:[t.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#059669",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(ne,{size:16}),"✅ You Can:"]}),t.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:s.capabilities.filter(e=>e.startsWith("✅")).map((e,r)=>t.jsx("li",{style:{color:"#166534",marginBottom:"0.25rem"},children:e.replace("✅ ","")},r))})]}),t.jsxs("div",{children:[t.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#dc2626",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(ct,{size:16}),"❌ You Cannot:"]}),t.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:s.capabilities.filter(e=>e.startsWith("❌")).map((e,r)=>t.jsx("li",{style:{color:"#991b1b",marginBottom:"0.25rem"},children:e.replace("❌ ","")},r))}),r.restrictions&&t.jsxs(t.Fragment,{children:[t.jsx("h6",{style:{margin:"1rem 0 0.5rem",color:"#6b7280",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase"},children:"System Restrictions:"}),t.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:r.restrictions.map((e,r)=>t.jsx("li",{style:{color:"#6b7280",marginBottom:"0.25rem"},children:e},r))})]})]})]}),t.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#f0f9ff",borderRadius:"6px",border:"1px solid #bfdbfe"},children:t.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#1e40af"},children:[t.jsx("strong",{children:"Scope:"})," ","organization"===r.scope?"Organization-wide":"Global"," •",t.jsx("strong",{children:" Manageable Roles:"})," ",r.canManage?.join(", ")||"None"]})})]}):null},ro=()=>{const e=B(),{user:r,organization:s}=m(),{users:a,loading:n,error:i,creatableRoles:o,userManagementRules:l,createUser:c,deactivateUser:d,reactivateUser:u,canManageUser:h,getRoleColor:p,formatLastLogin:g}=Ki(),[x,f]=k.useState(!1),[y,v]=k.useState(!1),[b,j]=k.useState(null),[w,N]=k.useState(null),C=Yi[r?.role?.id];A.useEffect(()=>{if(b){const e=setTimeout(()=>j(null),5e3);return()=>clearTimeout(e)}},[b]);return r?C?t.jsxs("div",{children:[t.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[t.jsxs("button",{onClick:()=>e("/dashboard"),className:"hr-button-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},title:"Back to Dashboard",children:[t.jsx(Ce,{className:"w-4 h-4"}),"Back"]}),t.jsxs("div",{children:[t.jsx("h2",{style:{margin:"0 0 0.5rem",color:"#1e40af",fontSize:"1.5rem",fontWeight:"600"},children:"👤 User Management"}),t.jsxs("p",{style:{margin:"0 0 1rem",color:"#64748b"},children:["Manage HR Managers and Department Heads for ",s?.name]}),t.jsxs("div",{style:{display:"flex",gap:"2rem",fontSize:"0.875rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#10b981"}}),t.jsxs("span",{style:{color:"#6b7280"},children:["Active Users: ",a.filter(e=>e.isActive).length]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#ef4444"}}),t.jsxs("span",{style:{color:"#6b7280"},children:["Inactive Users: ",a.filter(e=>!e.isActive).length]})]})]})]})]}),o.length>0&&t.jsx("button",{onClick:()=>f(!0),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:"➕ Create New User"})]})}),b&&t.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem",border:"2px solid "+("success"===b.type?"#059669":"error"===b.type?"#dc2626":"#3b82f6"),background:"success"===b.type?"#f0fdf4":"error"===b.type?"#fef2f2":"#eff6ff"},children:t.jsxs("div",{style:{color:"success"===b.type?"#059669":"error"===b.type?"#dc2626":"#1d4ed8",fontWeight:"600",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("span",{children:["success"===b.type?"✅":"error"===b.type?"❌":"ℹ️"," ",b.text]}),t.jsx("button",{onClick:()=>j(null),style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",color:"inherit"},children:"×"})]})}),i&&t.jsxs("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#ef4444"},children:[t.jsx(ie,{size:20}),t.jsx("span",{style:{fontWeight:"500"},children:"Error loading users"})]}),t.jsx("p",{style:{margin:"0.5rem 0 0",color:"#6b7280",fontSize:"0.875rem"},children:i})]}),t.jsx(to,{currentUser:r,userManagementRules:l}),t.jsx("div",{style:{marginTop:"1.5rem"},children:t.jsx(eo,{users:a,loading:n,onDeactivateUser:async e=>{try{const t=a.find(t=>t.id===e);await d(e),j({type:"success",text:`User ${t?.firstName} ${t?.lastName} deactivated successfully`})}catch(t){j({type:"error",text:t instanceof Error?t.message:"Failed to deactivate user"})}},onReactivateUser:async e=>{try{const t=a.find(t=>t.id===e);await u(e),j({type:"success",text:`User ${t?.firstName} ${t?.lastName} reactivated successfully`})}catch(t){j({type:"error",text:t instanceof Error?t.message:"Failed to reactivate user"})}},onEditUser:e=>{N(e),j({type:"info",text:"Edit functionality coming soon!"})},canManageUser:h,getRoleColor:p,formatLastLogin:g})}),x&&t.jsx(Qi,{onSubmit:async e=>{v(!0);try{await c(e),j({type:"success",text:`User ${e.firstName} ${e.lastName} created successfully!`}),f(!1)}catch(t){throw j({type:"error",text:t instanceof Error?t.message:"Failed to create user"}),t}finally{v(!1)}},onCancel:()=>f(!1),creatableRoles:o,loading:y}),t.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f0f9ff",borderRadius:"6px",fontSize:"0.875rem",color:"#0369a1"},children:[t.jsx("strong",{children:"Development Status:"})," Enhanced User Management v2.0 - Organization: ",s?.name," • Current User: ",r.role.name," • Manageable Roles: ",l.canManage?.join(", ")||"None"," • Users Loaded: ",a.length]})]}):t.jsx("div",{className:"hr-card",children:t.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[t.jsx(fe,{size:48,style:{color:"#f59e0b",margin:"0 auto 1rem"}}),t.jsx("h2",{style:{color:"#f59e0b",marginBottom:"0.5rem"},children:"Access Restricted"}),t.jsxs("p",{style:{color:"#6b7280",margin:0},children:["Your role (",r.role.name,") does not have user management permissions."]})]})}):t.jsx("div",{className:"hr-card",children:t.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[t.jsx(ie,{size:48,style:{color:"#ef4444",margin:"0 auto 1rem"}}),t.jsx("h2",{style:{color:"#ef4444",marginBottom:"0.5rem"},children:"Authentication Required"}),t.jsx("p",{style:{color:"#6b7280",margin:0},children:"Please log in to access user management."})]})})},so=Object.freeze(Object.defineProperty({__proto__:null,UserManagement:ro},Symbol.toStringTag,{value:"Module"})),ao=()=>{const{user:e}=m(),{getPrimaryRole:r}=w(),[s,a]=k.useState("dashboard"),n=()=>{a("dashboard")};if(!e)return t.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[t.jsx("h2",{style:{color:"#ef4444"},children:"Authentication Required"}),t.jsx("p",{style:{color:"#64748b"},children:"Please log in to access the dashboard."})]});const i=r(),o=()=>t.jsx("div",{style:{marginBottom:"1rem"},children:t.jsx("button",{onClick:n,className:"hr-button-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"← Back to Dashboard"})});if("user-management"===s)return t.jsxs("div",{children:[t.jsx(o,{}),t.jsx(ro,{})]});switch(i){case"super-user":return t.jsxs("div",{className:"space-y-6",children:[t.jsx(Ii,{}),t.jsx(Ri,{})]});case"reseller":return t.jsx(Wi,{});case"business-owner":case"hr-manager":case"hod-manager":return t.jsx(Fi,{});default:return t.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[t.jsxs("h2",{style:{color:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[t.jsx(ge,{style:{width:"1.5rem",height:"1.5rem"}}),"Role Configuration Needed"]}),t.jsxs("p",{style:{color:"#64748b",margin:"1rem 0"},children:['Your user role "',e.role.name,'" needs dashboard configuration. Please contact your system administrator.']}),t.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:"0.875rem",color:"#374151",marginBottom:"0.5rem"},children:t.jsx("strong",{children:"Debug Information:"})}),t.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280",fontFamily:"monospace"},children:["Role ID: ",e.role.id,t.jsx("br",{}),"Role Name: ",e.role.name,t.jsx("br",{}),"User ID: ",e.id,t.jsx("br",{}),"Organization: ",e.organizationId||"None"]})]}),t.jsx("div",{style:{marginTop:"1.5rem"},children:t.jsxs("button",{onClick:()=>a("dashboard"),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:"0 auto"},children:[t.jsx(it,{style:{width:"1rem",height:"1rem"}}),"Try Dashboard Anyway"]})})]})}};export{ao as D,Os as E,Ui as M,fs as R,Nt as T,so as U,$i as a};
