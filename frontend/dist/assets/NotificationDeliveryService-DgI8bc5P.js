import{d as e,L as a}from"./business-owner-dashboard-CK-ZpSaU.js";import{l as r,q as t,w as i,m as n,p as o,x as s}from"./firebase-vendor-BIBOIkWK.js";import"./react-vendor-BMk1H4su.js";import"./pdf-vendor-CbrIsI36.js";import"./ui-vendor-CMPykBlV.js";const l=[{event:"warning_needs_delivery",roles:["hr-manager","executive-management"],priority:"warning",title:"Warning Delivery Required",messageTemplate:"Warning for {{employeeName}} ({{warningLevel}}) needs delivery via {{deliveryMethod}}",category:"delivery",actions:[{label:"View Warning",action:"view_warning",variant:"primary"},{label:"Start Delivery",action:"start_delivery",variant:"secondary"}]},{event:"absence_report_submitted",roles:["hr-manager","executive-management"],priority:"info",title:"New Absence Report",messageTemplate:"{{employeeName}} absence report submitted by {{managerName}} - requires HR review",category:"hr_review",actions:[{label:"Review Report",action:"review_absence",variant:"primary"}]},{event:"hr_meeting_requested",roles:["hr-manager","executive-management"],priority:"info",title:"HR Meeting Request",messageTemplate:"{{managerName}} requested HR meeting for {{employeeName}} - {{reason}}",category:"meetings",actions:[{label:"Schedule Meeting",action:"schedule_meeting",variant:"primary"},{label:"View Details",action:"view_request",variant:"secondary"}]},{event:"warning_needs_delivery",roles:["hr-manager","executive-management"],priority:"high",title:"Warning Needs Delivery",messageTemplate:"New {{warningLevel}} warning for {{employeeName}} requires delivery via {{deliveryMethod}}",category:"delivery",actions:[{label:"Process Delivery",action:"process_delivery",variant:"primary"},{label:"View Warning",action:"view_warning",variant:"secondary"}]},{event:"warning_approaching_expiry",roles:["hod-manager","department-manager"],priority:"warning",title:"Warning Expiring Soon",messageTemplate:"{{employeeName}} warning expires in {{daysRemaining}} days - consider follow-up action",category:"follow_up"},{event:"employee_absence_alert",roles:["hod-manager","department-manager"],priority:"info",title:"Employee Absence Alert",messageTemplate:"{{employeeName}} has been absent for {{consecutiveDays}} consecutive days",category:"absence"},{event:"warning_delivered_confirmation",roles:["hod-manager","department-manager"],priority:"success",title:"Warning Delivered",messageTemplate:"Warning for {{employeeName}} has been successfully delivered via {{deliveryMethod}}",category:"confirmation"},{event:"high_severity_warning",roles:["executive-management"],priority:"error",title:"High Severity Warning Issued",messageTemplate:"{{warningLevel}} warning issued to {{employeeName}} - immediate attention required",category:"escalation",actions:[{label:"Review Case",action:"review_case",variant:"danger"}]},{event:"compliance_deadline",roles:["executive-management","hr-manager"],priority:"warning",title:"Compliance Deadline Approaching",messageTemplate:"{{complianceType}} deadline in {{daysRemaining}} days for {{organizationName}}",category:"compliance"},{event:"monthly_report_ready",roles:["executive-management"],priority:"info",title:"Monthly HR Report Available",messageTemplate:"HR disciplinary report for {{monthYear}} is now available for review",category:"reports",actions:[{label:"View Report",action:"view_report",variant:"primary"}]},{event:"system_error",roles:["super-user"],priority:"error",title:"System Error Detected",messageTemplate:"{{errorType}} error in organization {{organizationName}} - {{errorDetails}}",category:"system"},{event:"organization_deployment",roles:["super-user"],priority:"info",title:"Organization Deployment Status",messageTemplate:"Organization {{organizationName}} deployment {{status}} - {{details}}",category:"deployment"},{event:"user_account_issue",roles:["super-user"],priority:"warning",title:"User Account Issue",messageTemplate:"Account issue for {{userName}} in {{organizationName}} - {{issueType}}",category:"user_management"}];class c{static async sendRoleBasedNotification(c,m,g){try{const d=l.find(e=>e.event===m);if(!d)return a.warn(`ðŸ“­ No notification rule found for event: ${m}`),0;const y=this.processMessageTemplate(d.messageTemplate,g);d.roles;const p=await(async(l,c,m,g,d,y)=>{try{const a=r(e,"users"),p=t(a,i("organizationId","==",l),i("role","in",c)),v=(await n(p)).docs.map(e=>({userId:e.id,organizationId:l,type:m,title:g,message:d,read:!1,timestamp:o(),data:y||{}})),u=r(e,"notifications"),w=v.map(e=>s(u,e));return await Promise.all(w),v.length}catch(p){throw a.error("Error creating bulk notifications:",p),p}})(c,d.roles,d.priority,d.title,y,{event:m,category:d.category,actions:d.actions,...g});return a.success(6887),p}catch(d){throw a.error(`âŒ Failed to send role-based notification for event: ${m}`,d),d}}static async sendUserNotification(t,i,n,l,c,m){try{const g=i.map(e=>({userId:e,organizationId:t,type:n,title:l,message:c,read:!1,timestamp:o(),data:m||{}})),d=r(e,"notifications"),y=g.map(e=>s(d,e));await Promise.all(y),a.success(7892)}catch(g){throw a.error("âŒ Failed to send user notifications:",g),g}}static async sendSystemNotification(o,s,l,c,m){try{const g=r(e,"users"),d=t(g,i("organizationId","==",o)),y=(await n(d)).docs.map(e=>e.id);await this.sendUserNotification(o,y,s,l,c,m),a.success(8803)}catch(g){throw a.error("âŒ Failed to send system notification:",g),g}}static getNotificationRulesForRole(e){return l.filter(a=>a.roles.includes(e))}static getAvailableEvents(){return l.map(e=>e.event)}static processMessageTemplate(e,a){let r=e;for(const[t,i]of Object.entries(a)){const e=`{{${t}}}`;r=r.replace(new RegExp(e,"g"),String(i))}return r}static determinePriority(e,a){if(e)switch(e.toLowerCase()){case"dismissal":case"suspension":return"error";case"final_written":case"final written warning":return"warning";default:return"info"}if(a)switch(a.toLowerCase()){case"critical":case"urgent":return"error";case"high":return"warning";default:return"info"}return"info"}}class m{static async warningNeedsDelivery(e,a,r,t){return c.sendRoleBasedNotification(e,"warning_needs_delivery",{employeeName:a,warningLevel:r,deliveryMethod:t})}static async absenceReportSubmitted(e,a,r){return c.sendRoleBasedNotification(e,"absence_report_submitted",{employeeName:a,managerName:r})}static async hrMeetingRequested(e,a,r,t){return c.sendRoleBasedNotification(e,"hr_meeting_requested",{managerName:a,employeeName:r,reason:t})}static async warningApproachingExpiry(e,a,r){return c.sendRoleBasedNotification(e,"warning_approaching_expiry",{employeeName:a,daysRemaining:r})}static async warningDeliveredConfirmation(e,a,r){return c.sendRoleBasedNotification(e,"warning_delivered_confirmation",{employeeName:a,deliveryMethod:r})}static async highSeverityWarning(e,a,r){return c.sendRoleBasedNotification(e,"high_severity_warning",{employeeName:a,warningLevel:r})}static async monthlyReportReady(e,a){return c.sendRoleBasedNotification(e,"monthly_report_ready",{monthYear:a})}static async systemError(e,a,r,t){return c.sendRoleBasedNotification(e,"system_error",{organizationName:a,errorType:r,errorDetails:t})}}export{c as NotificationDeliveryService,m as QuickNotifications};
