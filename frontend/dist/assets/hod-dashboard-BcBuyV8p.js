const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotificationDeliveryService-D7YP0pl6.js","assets/business-owner-dashboard-SKPFtfOP.js","assets/react-vendor-CWjEGAcE.js","assets/pdf-vendor-tUwojRr6.js","assets/firebase-vendor-BQc9GSQK.js","assets/ui-vendor-CbYg3h9k.js"])))=>i.map(i=>d[i]);
import{L as e,d as s,j as a,l as t,i as r,T as i,f as o,o as l,p as n,k as c,e as d,u as m,h as u,s as h,q as g,A as x,D as p,r as y,F as v,a as f,m as b,t as w,v as N,N as j,w as k,E as S}from"./business-owner-dashboard-SKPFtfOP.js";import{r as C,R as _,u as D}from"./react-vendor-CWjEGAcE.js";import{p as I,x as E,l as R,j as T,u as z,E as L,G as A,H as M,q as $,w as F,t as P,m as W}from"./firebase-vendor-BQc9GSQK.js";import{U,h as q,X as O,g as H,N as B,i as V,al as G,ae as Y,K,b as X,F as J,k as Z,a as Q,x as ee,ag as se,am as ae,an as te,q as re,a1 as ie,R as oe,ab as le,ao as ne,n as ce,L as de,I as me,a3 as ue,M as he,a0 as ge,a4 as xe,ap as pe,e as ye,aq as ve,m as fe,C as be,s as we,ak as Ne,l as je,ai as ke,H as Se,ar as Ce,as as _e,aj as De,d as Ie}from"./ui-vendor-CbYg3h9k.js";import{C as Ee,P as Re}from"./hr-dashboard-RfjefpeW.js";import{a as Te}from"./pdf-vendor-tUwojRr6.js";class ze{static async createDeliveryNotification(a){try{const t=this.determinePriority(a.warningLevel),r=this.prepareContactDetails(a),i={organizationId:a.organizationId,warningId:a.warningId,employeeId:a.employeeId,employeeName:a.employeeName,employeeEmail:a.employeeEmail,employeePhone:a.employeePhone,warningLevel:a.warningLevel,warningCategory:a.warningCategory,incidentDate:a.incidentDate,employeeRequestedDeliveryMethod:a.employeeRequestedDeliveryMethod,contactDetails:r,status:"pending",priority:t,deliveryAttempts:0,createdAt:I(),updatedAt:I(),createdBy:a.createdBy,createdByName:a.createdByName},o=await E(R(s,"organizations",a.organizationId,"deliveryNotifications"),i);return e.success(3842),await this.createSystemNotification(a,o.id),o.id}catch(t){throw e.error("âŒ Failed to create delivery notification:",t),t}}static async updateDeliveryStatus(s,a,t,r){try{const e={status:a,updatedAt:I()};"delivered"===a&&(e.deliveryDate=I(),e.deliveredBy=r),t&&(e.deliveryNotes=t)}catch(i){throw e.error("âŒ Failed to update delivery status:",i),i}}static async updateDeliveryMethod(a,t,r){try{const i=T(s,"organizations",a,"deliveryNotifications",t);await z(i,{deliveryMethod:r,status:"in_progress",updatedAt:I()}),e.success("âœ… Delivery method updated successfully")}catch(i){throw e.error("âŒ Failed to update delivery method:",i),i}}static determinePriority(e){switch(e.toLowerCase()){case"dismissal":case"suspension":return"urgent";case"final_written":case"final written warning":return"high";default:return"normal"}}static prepareContactDetails(e){const s={};return e.employeeEmail&&(s.email=e.employeeEmail),e.employeePhone&&(s.phone=e.employeePhone),s.address="To be confirmed by HR",s}static async createSystemNotification(s,a){try{const{QuickNotifications:e}=await Te(async()=>{const{QuickNotifications:e}=await import("./NotificationDeliveryService-D7YP0pl6.js");return{QuickNotifications:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.warningNeedsDelivery(s.organizationId,s.employeeName,s.warningLevel,this.getDeliveryMethodName(s.deliveryMethod))}catch(t){e.error("âŒ Failed to create system notification:",t)}}static generateNotificationMessage(e){const s=this.getDeliveryMethodName(e.deliveryMethod),a=e.isEmployeePreference?" (employee's preferred method)":" (selected by manager)";return`Warning issued to ${e.employeeName} requires delivery via ${s}${a}. Warning level: ${e.warningLevel}.`}static getDeliveryMethodName(e){switch(e){case"email":return"Email";case"whatsapp":return"WhatsApp";case"printed":return"Print & Hand Delivery";default:return e}}}class Le{static getDeliveryInstructions(e){switch(e){case"email":return{title:"Email Delivery Instructions",steps:["Download the warning PDF from the system","Compose professional email with warning attached","Send to employee's work email address","Request read receipt if supported","Follow up if no acknowledgment within 2 business days"],requirements:["Valid email address on file","PDF warning document","Professional email template"],documentation:["Screenshot of sent email","Read receipt (if available)","Employee acknowledgment response"]};case"whatsapp":return{title:"WhatsApp Business Delivery Instructions",steps:["Verify employee's WhatsApp Business number","Send professional message introducing the warning","Share warning PDF as document attachment","Request confirmation of receipt","Document the conversation for records"],requirements:["WhatsApp Business account","Employee's valid phone number","Professional communication standards"],documentation:["Screenshot of conversation","Delivery receipt confirmation","Employee read/response confirmation"]};case"printed":return{title:"Print & Hand Delivery Instructions",steps:["Print warning document on company letterhead","Prepare delivery receipt form","Locate employee at their workstation/department","Hand deliver in presence of witness (if possible)","Obtain signed receipt of delivery","Scan and upload proof of delivery"],requirements:["Printed warning document","Delivery receipt form","Employee location/schedule","Witness (recommended)"],documentation:["Signed delivery receipt","Photo of handed document (if permitted)","Witness statement (if applicable)","Date, time, and location of delivery"]};default:return{title:"General Delivery Instructions",steps:["Contact IT support for delivery method guidance"],requirements:["Valid employee contact information"],documentation:["Proof of delivery attempt"]}}}}class Ae{constructor(){this.flows=new Map,this.listeners=[],this.stepConfigs=new Map,this.styles={info:"color: #2563eb; font-weight: bold;",warn:"color: #d97706; font-weight: bold;",error:"color: #dc2626; font-weight: bold;",debug:"color: #6b7280; font-weight: normal;",step:"color: #7c3aed; font-weight: bold; font-size: 14px;",data:"color: #059669; font-weight: normal;",validation:"color: #dc2626; font-weight: bold;"},this.initializeStepConfigs()}static getInstance(){return Ae.instance||(Ae.instance=new Ae),Ae.instance}initializeStepConfigs(){this.stepConfigs.set("INCIDENT_DETAILS",{name:"Incident Details",requiredFields:["employeeId","categoryId","incidentDate","incidentTime","incidentLocation","incidentDescription","issueDate","validityPeriod"],validations:[this.validateIncidentDetails.bind(this),this.validateDescriptionLength.bind(this),this.validateDates.bind(this)]}),this.stepConfigs.set("LEGAL_REVIEW_SIGNATURES",{name:"Legal Review & Signatures",requiredFields:["lraRecommendation","signatures.manager","signatures.employee"],validations:[this.validateLegalReview.bind(this),this.validateSignatures.bind(this)]}),this.stepConfigs.set("DELIVERY_COMPLETION",{name:"Delivery & Completion",requiredFields:["id","status","deliveryMethod"],validations:[this.validateDeliveryData.bind(this),this.validateFirestoreReadiness.bind(this)]})}startWizardSession(e){const s=e||`wizard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,a={sessionId:s,startTime:new Date,currentStep:"",completedSteps:[],logs:[],dataSnapshots:{},issues:[]};return this.flows.set(s,a),this.log(s,"info","SESSION","STARTED",null,{sessionId:s,timestamp:a.startTime}),s}endWizardSession(e,s){const a=this.flows.get(e);if(!a)return;const t=Date.now()-a.startTime.getTime();this.log(e,"info","SESSION","ENDED",null,{outcome:s,duration:`${Math.round(t/1e3)}s`,totalSteps:a.completedSteps.length,totalIssues:a.issues.length,finalStep:a.currentStep}),setTimeout(()=>{this.flows.delete(e)},3e5)}enterStep(e,s,a){const t=this.flows.get(e);t&&(t.currentStep=s,this.log(e,"info",s,"STEP_ENTERED",a,{previousStep:t.completedSteps[t.completedSteps.length-1]||"none",stepIndex:t.completedSteps.length+1}),a&&this.validateStepData(e,s,a,"STEP_ENTRY"))}exitStep(e,s,a,t=!0){const r=this.flows.get(e);r&&(t&&!r.completedSteps.includes(s)&&r.completedSteps.push(s),this.log(e,t?"info":"warn",s,"STEP_EXITED",a,{completed:t,timeInStep:this.getTimeInStep(e,s),totalCompletedSteps:r.completedSteps.length}),a&&t&&this.validateStepData(e,s,a,"STEP_EXIT"))}trackDataChange(e,s,a,t,r){this.log(e,"debug",s,"DATA_CHANGED",{field:a,oldValue:t,newValue:r,valueType:typeof r},{hasValue:null!=r&&""!==r,isValidChange:r!==t}),void 0===r&&void 0!==t&&this.trackIssue(e,s,`Field ${a} became undefined`,"medium"),typeof r!=typeof t&&void 0!==t&&this.trackIssue(e,s,`Field ${a} type changed from ${typeof t} to ${typeof r}`,"low")}trackFormSubmission(e,s,a){const t=this.flows.get(e);t&&(t.dataSnapshots[`${s}_${Date.now()}`]={...a},this.log(e,"info",s,"FORM_SUBMITTED",a,{fieldCount:Object.keys(a||{}).length,hasRequiredFields:this.checkRequiredFields(s,a)}),this.validateStepData(e,s,a,"FORM_SUBMISSION"))}trackAPICall(e,s,a,t,r,i){const o=i?"error":"info";this.log(e,o,s,"API_CALL",{api:a,params:t,result:i?void 0:r,error:i?.message||i},{success:!i,responseTime:Date.now()}),i&&this.trackIssue(e,s,`API call failed: ${a} - ${i.message}`,"high")}validateStepData(e,s,a,t){const r=this.stepConfigs.get(s);if(!r)return{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};let i={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return r.validations.forEach(e=>{const s=e(a);i.errors.push(...s.errors),i.warnings.push(...s.warnings),i.missingFields.push(...s.missingFields),i.undefinedFields.push(...s.undefinedFields),i.isValid=i.isValid&&s.isValid}),this.log(e,i.isValid?"info":"error",s,"VALIDATION",a,{context:t,validation:i}),i.errors.forEach(a=>{this.trackIssue(e,s,`Validation Error: ${a}`,"high")}),i.warnings.forEach(a=>{this.trackIssue(e,s,`Validation Warning: ${a}`,"medium")}),i}validateIncidentDetails(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return["employeeId","categoryId","incidentDate","incidentLocation","incidentDescription"].forEach(a=>{e[a]&&""!==e[a]||(s.errors.push(`Missing required field: ${a}`),s.missingFields.push(a),s.isValid=!1)}),Object.keys(e).forEach(a=>{void 0===e[a]&&(s.undefinedFields.push(a),s.errors.push(`Field ${a} is undefined`),s.isValid=!1)}),s}validateDescriptionLength(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDescription){const a=e.incidentDescription.trim().split(/\s+/).length;a<15&&s.warnings.push(`Incident description should be at least 15 words (currently ${a})`)}return s}validateDates(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDate){new Date(e.incidentDate)>new Date&&(s.errors.push("Incident date cannot be in the future"),s.isValid=!1)}if(e.issueDate){new Date(e.issueDate)>new Date&&s.warnings.push("Issue date is in the future")}return s}validateLegalReview(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.lraRecommendation||(s.errors.push("LRA recommendation is required"),s.missingFields.push("lraRecommendation"),s.isValid=!1),s}validateSignatures(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.signatures?.manager||(s.warnings.push("Manager signature missing"),s.missingFields.push("signatures.manager")),e.signatures?.employee||(s.warnings.push("Employee signature missing"),s.missingFields.push("signatures.employee")),s}validateDeliveryData(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.id||(s.errors.push("Warning ID is required for delivery"),s.missingFields.push("id"),s.isValid=!1),e.deliveryMethod||(s.warnings.push("Delivery method not specified"),s.missingFields.push("deliveryMethod")),s}validateFirestoreReadiness(e){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},a=this.findUndefinedFields(e);a.length>0&&(s.errors.push(`Undefined fields will cause Firestore errors: ${a.join(", ")}`),s.undefinedFields.push(...a),s.isValid=!1);return["id","organizationId","employeeId","categoryId"].forEach(a=>{e[a]||(s.errors.push(`Firestore requires field: ${a}`),s.missingFields.push(a),s.isValid=!1)}),s}findUndefinedFields(e,s=""){const a=[];return"object"!=typeof e||null===e||e instanceof Date||Object.entries(e).forEach(([e,t])=>{const r=s?`${s}.${e}`:e;void 0===t?a.push(r):"object"!=typeof t||null===t||t instanceof Date||a.push(...this.findUndefinedFields(t,r))}),a}trackIssue(e,s,a,t){const r=this.flows.get(e);if(!r)return;const i={step:s,issue:a,severity:t,timestamp:new Date};r.issues.push(i),this.log(e,"high"===t?"error":"warn",s,"ISSUE_DETECTED",null,{issue:a,severity:t,totalIssues:r.issues.length})}log(e,s,a,t,r,i){const o={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:new Date,level:s,step:a,action:t,data:r,metadata:i},l=this.flows.get(e);l&&l.logs.push(o),this.logToConsole(o,e),this.listeners.forEach(e=>e(o))}logToConsole(e,s){const a=`%c${{info:"ðŸ’™",warn:"âš ï¸",error:"âŒ",debug:"ðŸ”"}[e.level]} [${e.step}] ${e.action}`,t=this.styles[e.level];e.data?(console.groupCollapsed(`${a} (${s.slice(-6)})`,t),this.styles.data,e.data,e.validation&&(this.styles.validation,e.validation),e.metadata&&(this.styles.debug,e.metadata),console.groupEnd()):(s.slice(-6),e.metadata&&(this.styles.debug,e.metadata))}checkRequiredFields(e,s){const a=this.stepConfigs.get(e);return!a||a.requiredFields.every(e=>{const a=e.split(".");let t=s;for(const s of a)t=t?.[s];return null!=t&&""!==t})}getTimeInStep(e,s){const a=this.flows.get(e);if(!a)return"0s";const t=a.logs.reverse().find(e=>e.step===s&&"STEP_ENTERED"===e.action);if(!t)return"0s";const r=Date.now()-t.timestamp.getTime();return`${Math.round(r/1e3)}s`}addListener(e){this.listeners.push(e)}removeListener(e){const s=this.listeners.indexOf(e);s>-1&&this.listeners.splice(s,1)}getSessionLogs(e){return this.flows.get(e)?.logs||[]}getSessionIssues(e){return this.flows.get(e)?.issues||[]}getSessionSummary(e){const s=this.flows.get(e);return s?{sessionId:s.sessionId,startTime:s.startTime,currentStep:s.currentStep,completedSteps:s.completedSteps,totalLogs:s.logs.length,totalIssues:s.issues.length,issuesByLevel:{high:s.issues.filter(e=>"high"===e.severity).length,medium:s.issues.filter(e=>"medium"===e.severity).length,low:s.issues.filter(e=>"low"===e.severity).length},dataSnapshots:Object.keys(s.dataSnapshots).length}:null}exportSessionData(e){const s=this.flows.get(e);return s?JSON.stringify({summary:this.getSessionSummary(e),logs:s.logs,issues:s.issues,dataSnapshots:s.dataSnapshots},null,2):""}trackError(e,s,a,t){this.log(e,"error",s,"ERROR",{message:a.message,stack:a.stack,context:t}),this.trackIssue(e,s,a.message,"high")}trackSuccess(e,s,a,t){this.log(e,"info",s,`SUCCESS_${a}`,t)}trackWarning(e,s,a,t){this.log(e,"warn",s,"WARNING",t,{warning:a}),this.trackIssue(e,s,a,"medium")}}const Me=Ae.getInstance(),$e=({employees:e,selectedEmployeeId:s,onEmployeeSelect:l,warningHistory:n=[],isLoadingWarningHistory:c=!1,disabled:d=!1,className:m=""})=>{const[u,h]=C.useState(""),[g,x]=C.useState(!1),[p,y]=C.useState(!1),[v,f]=C.useState(!1),b=(e,s)=>e[s]?String(e[s]):e.profile?.[s]?String(e.profile[s]):"position"===s&&e.employment?.position?String(e.employment.position):"department"===s&&e.profile?.department?String(e.profile.department):"",w=C.useMemo(()=>{if(!u.trim())return e;const s=u.toLowerCase();return e.filter(e=>{const a=`${b(e,"firstName")} ${b(e,"lastName")}`.toLowerCase(),t=e.id?.toLowerCase()||"",r=b(e,"department").toLowerCase();return a.includes(s)||t.includes(s)||r.includes(s)})},[e,u]),N=C.useMemo(()=>e.find(e=>e.id===s),[e,s]),j=C.useCallback(e=>{l(e),x(!1),y(!1),f(!1),h("")},[l]),k=C.useCallback(()=>{if(d)return;window.innerWidth<768?f(!0):y(!p)},[d,p]),S=C.useCallback(()=>{f(!1),h("")},[]);return a.jsxs("div",{className:`space-y-4 ${m}`,children:[a.jsx(t,{icon:U,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:a.jsx(r,{variant:"secondary",size:"sm",children:w.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(d?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:p?"var(--color-primary)":"var(--color-border)",boxShadow:p?"0 0 0 2px var(--color-primary-light)":void 0},onClick:k,children:N?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[b(N,"firstName").charAt(0),b(N,"lastName").charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[b(N,"firstName")," ",b(N,"lastName")]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[b(N,"position")," â€¢ ",b(N,"department")]})]})]}),a.jsx(q,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(q,{className:"w-4 h-4 transition-transform "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),p&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:w.length>0?a.jsx("div",{className:"py-2",children:w.map(e=>((e=>{e.riskIndicators&&e.riskIndicators.highRisk})(e),(e=>{if(!e.recentWarnings)return null;const{count:s,lastDate:a,level:t}=e.recentWarnings})(e),a.jsx("button",{onClick:()=>j(e.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:a.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[b(e,"firstName")," ",b(e,"lastName")," - ",b(e,"position")]})},e.id)))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(U,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsxs("p",{children:['No employees found matching "',u,'"']})]})})]})]})}),v&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:S}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),a.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),a.jsx("div",{className:"mobile-category-list",children:w.length>0?a.jsx("div",{children:w.map(e=>a.jsx("button",{onClick:()=>j(e.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:a.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[b(e,"firstName")," ",b(e,"lastName")," - ",b(e,"position")]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No employees found"}),u&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',u,'"']})]})})]})]}),N&&g&&a.jsxs(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"flex items-center gap-1",children:[g?a.jsx(H,{className:"w-4 h-4"}):a.jsx(q,{className:"w-4 h-4"}),g?"Hide":"Show"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["ðŸ“§ ",b(N,"email")||"No email",a.jsx("br",{}),"ðŸ“± ",b(N,"phone")||"No phone"]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[b(N,"position"),a.jsx("br",{}),b(N,"department")]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(B,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),a.jsx("span",{className:"font-medium text-gray-900",children:N.recentWarnings?.count||0})]}),N.recentWarnings?.lastDate&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),a.jsx("span",{className:"text-sm text-gray-900",children:new Date(N.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),N.riskIndicators&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),a.jsxs(r,{variant:N.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[a.jsx(V,{className:"w-4 h-4"}),N.riskIndicators.highRisk?"High Risk":"Low Risk"]}),N.riskIndicators.reasons.length>0&&a.jsx("div",{className:"mt-2",children:a.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:N.riskIndicators.reasons.slice(0,3).map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"text-amber-500 mt-0.5",children:"â€¢"}),e]},s))})})]})]})]})]})]})},Fe=({categories:e,selectedCategoryId:s,onCategorySelect:r,lraRecommendation:o,disabled:c=!1,className:d=""})=>{const[m,u]=C.useState(!1),[h,g]=C.useState(!1),[x,p]=C.useState(!1),[y,v]=C.useState(""),f=C.useMemo(()=>{if(!y.trim())return e;const s=y.toLowerCase();return e.filter(e=>{const a=e.name?.toLowerCase()||"",t=e.description?.toLowerCase()||"",r=e.severity?.toLowerCase()||"";return a.includes(s)||t.includes(s)||r.includes(s)})},[e,y]),b=C.useMemo(()=>e.find(e=>e.id===s),[e,s]),w=C.useCallback(e=>{r(e),u(!1),g(!1),p(!1),v("")},[r]),N=C.useCallback(()=>{if(c)return;window.innerWidth<768?p(!0):g(!h)},[c,h]),j=C.useCallback(()=>{p(!1),v("")},[]),k=C.useMemo(()=>b?b.escalationPath||l(b.id):[],[b]),S=C.useMemo(()=>o&&k.length?k.findIndex(e=>e===o.suggestedLevel):-1,[o,k]);return a.jsxs("div",{className:`space-y-4 ${d}`,children:[a.jsx(t,{icon:G,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:e.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(c?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:h?"var(--color-primary)":"var(--color-border)",boxShadow:h?"0 0 0 2px var(--color-primary-light)":void 0},onClick:N,children:b?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:b.name}),b.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:b.description})]})]}),a.jsx(q,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),a.jsx(q,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),h&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:f.length>0?a.jsx("div",{className:"py-2",children:f.map(e=>a.jsx("button",{onClick:()=>w(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.description})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(G,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{children:"No categories found"}),y&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',y,'"']})]})})]})]})}),x&&a.jsxs("div",{className:"mobile-category-modal",children:[a.jsx("div",{className:"mobile-category-modal-backdrop",onClick:j}),a.jsxs("div",{className:"mobile-category-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),a.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:f.length>0?a.jsx("div",{children:f.map(e=>a.jsxs("button",{onClick:()=>w(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:e.description})]})]},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No categories found"}),y&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',y,'"']})]})})]})]}),b&&m&&a.jsxs(i,{className:"rounded-xl p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),a.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[m?a.jsx(H,{className:"w-4 h-4"}):a.jsx(q,{className:"w-4 h-4"}),m?"Hide":"Show"]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:(e=>{switch(e?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}})(b.severity),children:b.severity})]}),b.description&&a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:b.description})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),o?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Y,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:n(o.suggestedLevel)}),o.isEscalation&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:o.reason})]}):a.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:k.map((e,s)=>{const t=s===S,r=S>=0&&s<S;return a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:t?"var(--color-badge-primary)":r?"var(--color-muted)":"var(--color-card-background)",borderColor:t?"var(--color-primary)":"var(--color-border)",color:t?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[t&&a.jsx(K,{className:"w-4 h-4"}),r&&a.jsx(X,{className:"w-4 h-4"}),a.jsx("span",{children:n(e)}),s<k.length-1&&a.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"â†’"})]},e)})}),o&&a.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(Y,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",n(o.suggestedLevel)]}),a.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",o.categoryWarningCount??0," previous warning(s) in this category",o.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},Pe=({formData:s,onFormDataChange:r,disabled:i=!1,className:o=""})=>{const[l,n]=C.useState(!1),[d,m]=C.useState({}),[u,h]=C.useState({}),{isSaving:g,lastSaved:x}=((e,s,a=2e3)=>{const t=C.useRef(),[r,i]=C.useState(!1),[o,l]=C.useState(null),n=C.useCallback(()=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{i(!0),s(e),l(new Date),i(!1)},a)},[e,s,a]);return C.useEffect(()=>(n(),()=>{t.current&&clearTimeout(t.current)}),[n]),{isSaving:r,lastSaved:o}})(s,e=>{localStorage.setItem("warningWizard_incidentDetails",JSON.stringify(e))});C.useEffect(()=>{const a=localStorage.getItem("warningWizard_incidentDetails");if(a)try{const e=JSON.parse(a);!s.incidentDescription&&!s.incidentLocation&&r(e)}catch(t){e.warn("Failed to load saved incident details:",t)}},[]);const p=C.useMemo(()=>{const e=s.incidentDescription||"",a=e.trim().split(/\s+/).filter(e=>e.length>0).length,t=a>=20,r=[];return a<20&&r.push(`Add ${20-a} more words for a complete description`),e.includes("when")||e.includes("time")||r.push("Consider adding when the incident occurred"),e.includes("where")||e.includes("location")||r.push("Consider specifying where the incident took place"),e.includes("what")||e.includes("action")||r.push("Be specific about what actions were observed"),!e.includes("witness")&&a>10&&r.push("Were there any witnesses to mention?"),{wordCount:a,isMinimumMet:t,suggestions:r}},[s.incidentDescription]),y=C.useCallback((e,s)=>{switch(e){case"incidentDate":if(!s)return"Incident date is required";return new Date(s)>new Date?"Incident date cannot be in the future":null;case"incidentTime":if(!s)return"Incident time is required";return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(s)?null:"Please enter time in HH:MM format";case"incidentLocation":return!s||s.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":return!s||s.trim().length<20?"Description must be at least 20 characters":s.trim().length>2e3?"Description is too long (maximum 2000 characters)":null;default:return null}},[]),v=C.useCallback((e,s)=>{r({[e]:s}),h(s=>({...s,[e]:!0}));const a=y(e,s);m(s=>({...s,[e]:a}))},[r,y]),f=(new Date).toISOString().split("T")[0];return a.jsxs("div",{className:`space-y-4 ${o}`,children:[a.jsx(t,{icon:J,title:"Incident Details",subtitle:"Provide comprehensive details about the incident",rightContent:a.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--color-text-tertiary)"},children:[g&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Z,{className:"w-4 h-4 animate-pulse"}),a.jsx("span",{children:"Saving..."})]}),x&&!g&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsxs("span",{children:["Saved ",x.toLocaleTimeString()]})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Ee,{type:"date",label:"Incident Date",value:s.incidentDate||"",onChange:e=>v("incidentDate",e),icon:ee,required:!0,disabled:i,error:d.incidentDate&&u.incidentDate?d.incidentDate:void 0}),a.jsx(Ee,{type:"time",label:"Incident Time",value:s.incidentTime||"",onChange:e=>v("incidentTime",e),icon:B,required:!0,disabled:i,error:d.incidentTime&&u.incidentTime?d.incidentTime:void 0})]}),a.jsx(c,{type:"text",label:"Incident Location",value:s.incidentLocation||"",onChange:e=>v("incidentLocation",e),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:se,required:!0,disabled:i,error:d.incidentLocation&&u.incidentLocation?d.incidentLocation:void 0}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[a.jsx(ae,{className:"w-3 h-3 inline mr-1"}),"Incident Description *"]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsxs("button",{type:"button",onClick:()=>n(!l),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-primary)"},children:[a.jsx(te,{className:"w-3 h-3"}),"Writing Tips"]}),a.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:p.isMinimumMet?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:p.isMinimumMet?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[p.wordCount," words"]})]})]}),a.jsx("textarea",{value:s.incidentDescription||"",onChange:e=>v("incidentDescription",e.target.value),placeholder:"Describe exactly what happened. Include specific details such as what was said or done, who was present, and any relevant context...",disabled:i,rows:6,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical "+(i?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:d.incidentDescription&&u.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:d.incidentDescription&&u.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),d.incidentDescription&&u.incidentDescription&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[a.jsx(X,{className:"w-3 h-3"}),d.incidentDescription]}),l&&a.jsxs("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[a.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:"var(--color-alert-info-text)"},children:"Writing Assistance"}),a.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--color-alert-info-text)"},children:[p.suggestions.map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(te,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsx("span",{children:e})]},s)),0===p.suggestions.length&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-green-700",children:"Your description looks comprehensive!"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-xs font-medium text-gray-700",children:["Additional Notes",a.jsx("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),a.jsx("textarea",{value:s.additionalNotes||"",onChange:e=>v("additionalNotes",e.target.value),placeholder:"Any additional context, background information, or relevant details...",disabled:i,rows:3,className:`\n            w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n            ${i?"opacity-50 cursor-not-allowed":""}\n          `})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date *"}),a.jsx("input",{type:"date",value:s.issueDate||f,onChange:e=>v("issueDate",e.target.value),disabled:i,className:`\n              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n              ${i?"opacity-50 cursor-not-allowed":""}\n            `})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Validity Period *"}),a.jsxs("select",{value:s.validityPeriod||6,onChange:e=>v("validityPeriod",parseInt(e.target.value)),disabled:i,className:`\n              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n              ${i?"opacity-50 cursor-not-allowed":""}\n            `,children:[a.jsx("option",{value:3,children:"3 months"}),a.jsx("option",{value:6,children:"6 months"}),a.jsx("option",{value:12,children:"12 months"})]})]})]})]})},We=({employees:e,categories:s,formData:t,updateFormData:r,selectedEmployee:i,selectedCategory:o,warningHistory:l=[],isLoadingWarningHistory:n=!1,loadWarningHistory:c,lraRecommendation:m,isAnalyzing:u=!1})=>{const h=C.useMemo(()=>{const e={employee:!!t.employeeId,category:!!t.categoryId,date:!!t.incidentDate,time:!!t.incidentTime,location:!!t.incidentLocation&&t.incidentLocation.length>=3,description:!!t.incidentDescription&&t.incidentDescription.length>=20},s=Object.values(e).filter(Boolean).length,a=Object.keys(e).length;return{checks:e,completed:s,total:a,percentage:Math.round(s/a*100)}},[t]);return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between px-1",children:[a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Progress"}),a.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[h.completed,"/",h.total]})]}),a.jsx("div",{className:"w-full rounded h-1",style:{backgroundColor:"var(--color-surface)"},children:a.jsx("div",{className:"h-1 rounded transition-all duration-300",style:{width:`${h.percentage}%`,backgroundColor:"var(--color-primary)"}})}),a.jsx($e,{employees:e,selectedEmployeeId:t.employeeId,onEmployeeSelect:e=>{r({employeeId:e}),c&&c(e)},warningHistory:l,isLoadingWarningHistory:n,disabled:u}),a.jsx(Fe,{categories:s,selectedCategoryId:t.categoryId,onCategorySelect:e=>{r({categoryId:e})},lraRecommendation:m,disabled:u}),a.jsx(Pe,{formData:t,onFormDataChange:r,disabled:u}),u&&a.jsx(d,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),a.jsx("span",{className:"text-sm",children:"Analyzing incident..."})]})}),m&&!u&&m.requiresHRIntervention&&a.jsx(d,{variant:"error",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(X,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-error)"},children:"Contact HR Required"}),a.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text)"},children:m.interventionReason}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee has final warning on record - HR intervention required before proceeding"})]})]})}),m&&!u&&!m.requiresHRIntervention&&a.jsx(d,{variant:"success",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Q,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:["Recommended: ",m.recommendedLevel]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:m.reason})]})]})}),100===h.percentage&&!u&&a.jsx(d,{variant:"info",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(re,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:"Ready for Legal Review"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:'All details completed. Click "Next" to proceed.'})]})]})})]})},Ue="Africa/Johannesburg",qe=({onSignatureComplete:e,disabled:s=!1,label:t,placeholder:r="Click and drag to sign",initialSignature:i=null,className:o="",width:l=400,height:n=200})=>{const c=C.useRef(null),d=C.useRef(null),[m,u]=C.useState(!1),[h,g]=C.useState(!1),[x,p]=C.useState(!1),[y,v]=C.useState([]),[f,b]=C.useState(!1),w=C.useCallback(()=>{const e=c.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const a=e.getBoundingClientRect(),t=window.devicePixelRatio||1;e.width=a.width*t,e.height=a.height*t,s.scale(t,t),s.strokeStyle="#1e293b",s.lineWidth=2,s.lineCap="round",s.lineJoin="round",s.globalCompositeOperation="source-over",s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height),b(!0)},[]),N=C.useCallback(e=>{const s=c.current;if(!s)return{x:0,y:0};const a=s.getBoundingClientRect();let t,r;if("touches"in e&&e.touches.length>0)t=e.touches[0].clientX,r=e.touches[0].clientY;else{if(!("clientX"in e))return{x:0,y:0};t=e.clientX,r=e.clientY}return{x:t-a.left,y:r-a.top}},[]),j=C.useCallback(e=>{if(s)return;e.preventDefault();const a=c.current,t=a?.getContext("2d");if(!a||!t)return;u(!0);const{x:r,y:i}=N(e);t.beginPath(),t.moveTo(r,i);const o={points:[{x:r,y:i}],timestamp:Date.now()};v(e=>[...e,o])},[s,N]),k=C.useCallback(e=>{if(!m||s)return;e.preventDefault();const a=c.current,t=a?.getContext("2d");if(!a||!t)return;const{x:r,y:i}=N(e);t.lineTo(r,i),t.stroke(),v(e=>{if(0===e.length)return e;const s=[...e];return s[s.length-1].points.push({x:r,y:i}),s})},[m,s,N]),S=C.useCallback(()=>{m&&(u(!1),p(!0))},[m]),_=C.useCallback(()=>{if(s)return;const a=c.current,t=a?.getContext("2d");if(!a||!t)return;const r=((e,s=Ue)=>(e instanceof Date?e:new Date(e)).toLocaleString("en-ZA",{timeZone:s,year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}))(new Date,Ue),i=a.getBoundingClientRect();t.save(),t.font="10px Arial, sans-serif",t.fillStyle="#64748b",t.textAlign="right",t.textBaseline="bottom",t.fillText(r,i.width-8,i.height-8),t.restore();const o=a.toDataURL("image/png");g(!0),p(!1),e(o)},[s,e]),D=C.useCallback(()=>{if(s)return;const a=c.current,t=a?.getContext("2d");a&&t&&(t.fillStyle="#ffffff",t.fillRect(0,0,a.width,a.height),g(!1),p(!1),v([]),e(null))},[s,e]);return C.useEffect(()=>{if(!f||s)return;const e=c.current;if(!e)return;const a=e=>j(e),t=e=>k(e),r=()=>S(),i=()=>S(),o=e=>j(e),l=e=>k(e),n=()=>S();return e.addEventListener("mousedown",a,{passive:!1}),e.addEventListener("mousemove",t,{passive:!1}),e.addEventListener("mouseup",r),e.addEventListener("mouseleave",i),e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("touchmove",l,{passive:!1}),e.addEventListener("touchend",n),d.current=()=>{e.removeEventListener("mousedown",a),e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",r),e.removeEventListener("mouseleave",i),e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",l),e.removeEventListener("touchend",n)},d.current},[f,s,j,k,S]),C.useEffect(()=>{w()},[w]),C.useEffect(()=>{if(i&&f){const e=c.current,s=e?.getContext("2d");if(!e||!s)return;const a=new Image;a.onload=()=>{const t=e.getBoundingClientRect();s.clearRect(0,0,e.width,e.height),s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height),s.drawImage(a,0,0,t.width,t.height),g(!0)},a.onerror=()=>{console.error("Failed to load signature image")},a.src=i}},[i,f]),C.useEffect(()=>()=>{d.current&&d.current()},[]),y.length>=1&&(y.some(e=>e.points.length>=5)||y.length),a.jsxs("div",{className:`space-y-3 ${o}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:t}),a.jsxs("div",{className:"flex items-center gap-2",children:[h&&a.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[a.jsx(ie,{className:"w-3 h-3"}),a.jsx("span",{children:"Saved"})]}),x&&!h&&a.jsxs("button",{type:"button",onClick:_,disabled:s,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-white bg-green-600 hover:bg-green-700 rounded disabled:opacity-50",children:[a.jsx(ie,{className:"w-3 h-3"}),"Save Signature"]}),a.jsxs("button",{type:"button",onClick:D,disabled:s||!h&&!x,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-red-600 disabled:opacity-50",children:[a.jsx(oe,{className:"w-3 h-3"}),"Clear"]})]})]}),a.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg bg-white\n        ${s?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}\n        ${h?"border-green-300 bg-green-50":""}\n      `,children:[a.jsx("canvas",{ref:c,width:l,height:n,className:`\n            block w-full h-full cursor-crosshair rounded-lg\n            ${s?"cursor-not-allowed":""}\n          `,style:{width:`${l}px`,height:`${n}px`}}),!h&&!s&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[a.jsx(ae,{className:"w-4 h-4"}),a.jsx("span",{children:r})]})})]})]})},Oe=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],He={en:{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},af:{counselling:"Beradingsessie",verbal:"Mondelinge Waarskuwing",first_written:"Eerste Geskrewe Waarskuwing",second_written:"Tweede Geskrewe Waarskuwing",final_written:"Finale Geskrewe Waarskuwing"},zu:{counselling:"Iseshini Yokweluleka",verbal:"Isexwayiso Ngomlomo",first_written:"Isexwayiso Sokuqala Esibhaliwe",second_written:"Isexwayiso Sesibili Esibhaliwe",final_written:"Isexwayiso Sokugcina Esibhaliwe"},xh:{counselling:"Iseshoni Yokucebisa",verbal:"Isilumkiso Ngomlomo",first_written:"Isilumkiso Sokuqala Esibhaliweyo",second_written:"Isilumkiso Sesibini Esibhaliweyo",final_written:"Isilumkiso Sokugqibela Esibhaliweyo"},st:{counselling:"Seboka sa Keletso",verbal:"Temoso ya Molomo",first_written:"Temoso ya Pele e Ngotsweng",second_written:"Temoso ya Bobedi e Ngotsweng",final_written:"Temoso ya ho Qetela e Ngotsweng"},ts:{counselling:"Nkarhi wo Tivonela",verbal:"Xilumkiso xa Marito",first_written:"Xilumkiso xa Sinthoma xa Ku Tsariwa",second_written:"Xilumkiso xa Vumbirhi xa Ku Tsariwa",final_written:"Xilumkiso xa Makumu xa Ku Tsariwa"},ve:{counselling:"Tshikhala tsha Themendelo",verbal:"Tivhiso ya Ipfi",first_written:"Tivhiso ya u Thoma yo á¹„walwaho",second_written:"Tivhiso ya vhuvhili yo á¹„walwaho",final_written:"Tivhiso ya u Fhedzisela yo á¹„walwaho"},ss:{counselling:"Seshoni Sekululeleka",verbal:"Sixwayiso Ngemlomo",first_written:"Sixwayiso Sekucala Lesibhaliwe",second_written:"Sixwayiso Sesibili Lesibhaliwe",final_written:"Sixwayiso Sekugcina Lesibhaliwe"},tn:{counselling:"Khuduthamaga ya Kgakololo",verbal:"Temoso ya Molomo",first_written:"Temoso ya Ntlha e e Kwadilweng",second_written:"Temoso ya Bobedi e e Kwadilweng",final_written:"Temoso ya Bofelo e e Kwadilweng"},nr:{counselling:"Iseshini Yokululeleka",verbal:"Isixwayiso Ngomlomo",first_written:"Isixwayiso Sokuqala Esibhaliwe",second_written:"Isixwayiso Sesibili Esibhaliwe",final_written:"Isixwayiso Sokugcina Esibhaliwe"},ns:{counselling:"Kopano ya KeletÅ¡o",verbal:"TemoÅ¡o ya Molomo",first_written:"TemoÅ¡o ya Pele yeo e Ngwadilwego",second_written:"TemoÅ¡o ya Bobedi yeo e Ngwadilwego",final_written:"TemoÅ¡o ya Mafelelo yeo e Ngwadilwego"}},Be={en:{greeting:(e,s)=>`${e}, this meeting is to formalize the written warning for the workplace incident we discussed.`,incident:(e,s)=>`Charge: ${e}. Details: ${s}. This behavior violates our workplace policies and must stop immediately.`,warningExplanation:(e,s)=>`This is a ${e}. It remains on your record for ${s} months. You must demonstrate immediate and sustained improvement.`,rights:()=>"Your rights under the Labour Relations Act:",rightsList:()=>["Appeal: You may appeal this warning in writing to HR within 48 hours if you believe it is unfair or procedurally incorrect.","Progressive Discipline: Similar conduct during this warning's validity period may result in further disciplinary action, up to dismissal.","Confidentiality: This information is confidential and shared only with relevant management and HR."],witnessOption:()=>"Your signature confirms you understand this warning and your rights - not that you agree with it. If you refuse to sign, a witness will confirm the warning was explained. The warning is valid either way.",questions:()=>"Do you have any questions about this warning or your rights?",closing:()=>"We will now collect signatures. Immediate improvement is required."},af:{greeting:(e,s)=>`${e}, hierdie vergadering is om die skriftelike waarskuwing te formaliseer vir die werkplek incident wat ons bespreek het.`,incident:(e,s)=>`Aanklag: ${e}. Besonderhede: ${s}. Hierdie gedrag oortree ons werkplek beleide en moet onmiddellik stop.`,warningExplanation:(e,s)=>`Dit is 'n ${e}. Dit bly op jou rekord vir ${s} maande. Jy moet onmiddellike en volgehoue verbetering toon.`,rights:()=>"Jou regte onder die Wet op Arbeidsverhoudinge:",rightsList:()=>["AppÃ¨l: Jy mag hierdie waarskuwing binne 48 uur skriftelik by HR appelieer as jy glo dit is onregverdig of prosedureel verkeerd.","Progressiewe Dissipline: Soortgelyke gedrag gedurende hierdie waarskuwing se geldigheidsperiode kan lei tot verdere dissiplinÃªre aksie, tot en met ontslag.","Vertroulikheid: Hierdie inligting is vertroulik en word slegs met relevante bestuur en HR gedeel."],witnessOption:()=>"Jou handtekening bevestig dat jy hierdie waarskuwing en jou regte verstaan - nie dat jy daarmee saamstem nie. As jy weier om te teken, sal 'n getuie bevestig dat die waarskuwing verduidelik is. Die waarskuwing is beide kante geldig.",questions:()=>"Het jy enige vrae oor hierdie waarskuwing of jou regte?",closing:()=>"Ons sal nou handtekeninge versamel. Onmiddellike verbetering word vereis."},zu:{greeting:(e,s)=>`${e}, le mihlangano iwukuqinisa isixwayiso esibhaliwe ngesigameko somsebenzi esasixoxayo.`,incident:(e,s)=>`Icala: ${e}. Imininingwane: ${s}. Lokhu kuziphatha kuphula izinqubomgomo zethu zomsebenzi futhi kumele kume masinyane.`,warningExplanation:(e,s)=>`Lesi isixwayiso se-${e}. Sihlala kumarekhodi akho izinyanga ezingu-${s}. Kumele ubonise ukuthuthuka okusheshayo nokuqhubekayo.`,rights:()=>"Amalungelo akho ngaphansi koMthetho Wobudlelwano Basebenzi:",rightsList:()=>["Ukuphikisa: Ungaphikisa lesi sixwayiso ngokubhaliwe ku-HR ngamahora angu-48 uma ukholelwa ukuthi asilungile noma asenziwa kabi.","Ukuqeqesha Okuqhubekayo: Ukuziphatha okufanayo ngesikhathi lesi sixwayiso kungase kuholele esinyweni esinye sokuqeqesha, kuya ekuxoshweni.","Ubumfihlo: Lolu lwazi luyimfihlo futhi lubelane kuphela nabaphathi abadingekayo kanye ne-HR."],witnessOption:()=>"Ukusayina kwakho kuqinisekisa ukuthi uyaqonda lesi sixwayiso namalungelo akho - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, ufakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela.",questions:()=>"Ingabe unemibuzo ngalesi sixwayiso noma amalungelo akho?",closing:()=>"Manje sizoqoqa izimo zokusayina. Ukuthuthuka okusheshayo kuyadingeka."},xh:{greeting:(e,s)=>`${e}, le ntlanganiso ikuqinisekisa isilumkiso esibhaliweyo ngesiganeko emsebenzini esasixoxayo.`,incident:(e,s)=>`Ityala: ${e}. Iinkcukacha: ${s}. Oku kuziphatha kuphula imigaqo-nkqubo yethu yomsebenzi kwaye kufuneka kuyeke ngokukhawuleza.`,warningExplanation:(e,s)=>`Esi yisilumkiso se-${e}. Sihlala kwiirekhodi zakho iinyanga ezingu-${s}. Kufuneka ubonise uphuculo olukhawulezayo noluqhubekayo.`,rights:()=>"Amalungelo akho phantsi koMthetho woBudlelwane baBasebenzi:",rightsList:()=>["Isibheno: Ungabhena esi silumkiso ngokubhaliwe kwi-HR kwiiyure ezingama-48 ukuba ukholelwa ukuba asifanelekanga okanye senziwa kakubi.","Ukulungisa Okuqhubekayo: Ukuziphatha okufanayo ngeli xesha lesi silumkiso kunokukhokelela kwelinye inyathelo lokulungisa, kuya ekugxothweni.","Ubumfihlo: Olu lwazi luyimfihlo kwaye lwabiwe kuphela kubaphathi abafanelekileyo nakwi-HR."],witnessOption:()=>"Utyikityo lwakho luqinisekisa ukuba uyaqonda esi silumkiso namalungelo akho - hayi ukuba uyavuma. Ukuba ukhaba ukusayina, ingqina iya kuqinisekisa ukuba isilumkiso sichaziwe. Isilumkiso sisebenza ngazo zombini iindlela.",questions:()=>"Ingaba unemibuzo ngesi silumkiso okanye amalungelo akho?",closing:()=>"Ngoku siya kuqokelela iityikityo. Uphuculo olukhawulezayo luyafuneka."},st:{greeting:(e,s)=>`${e}, kopano ena ke ho tiisa temoso e ngotsoeng ka ketsahalo ea mosebetsi eo re e buisaneng.`,incident:(e,s)=>`Lengolo: ${e}. Lintlha: ${s}. Boitshwaro bona bo senya dipholisi tsa rona tsa mosebetsi 'me bo tlameha ho ema hang-hang.`,warningExplanation:(e,s)=>`Ena ke temoso ea ${e}. E lula lirekoting tsa hao likhoeli tse ${s}. O tlameha ho bonts'a ntlafatso e potlakileng le e tsoelang pele.`,rights:()=>"Litokelo tsa hao ka tlasa Molao oa Likamano tsa Basebetsi:",rightsList:()=>["Ho Ipeela: O ka ipeela temoso ena ka ho ngola ho HR ka mora dihora tse 48 haeba o lumela hore ha e nepahale kapa e etsoa hambe.","Kgetho e Tsoelang Pele: Boitshwaro bo tÅ¡oanang nakong ea temoso ena bo ka hlahisa khato e 'ngoe ea kgetho, ho fihla tlÅsong.","Lekunutu: Tlhahisoleseding ena e lekunutu 'me e arolelane feela le bataoli ba hlokahalang le HR."],witnessOption:()=>"Saeno ea hao e tiisa hore o utloisisa temoso ena le litokelo tsa hao - eseng hore o lumela. Haeba o hana ho saena, paki e tla tiisa hore temoso e hlalositsoe. Temoso e sebetsa ka tsela ka bobeli.",questions:()=>"Na o na le lipotso ka temoso ena kapa litokelo tsa hao?",closing:()=>"Joale re tla bokella mesaeno. Ntlafatso e potlakileng e hlokahala."},ts:{greeting:(e,s)=>`${e}, nhlanganiso lowu i ku tiyisa xilumkiso lexi tsariweke xa xivangelo xa ntirho lexi hi xi burisaneke.`,incident:(e,s)=>`Nyungulo: ${e}. Swileriso: ${s}. Mavanyiselo lawa ma tyela tipholisi ta hina ta ntirho naswona ma fanele ku yima hi ku hatlisa.`,warningExplanation:(e,s)=>`Lexi i xilumkiso xa ${e}. Xi tshama eka rhekhodo ya wena tin'hweti ta ${s}. U fanele ku kombisa ku antswisa loku hatlisaka ni loku ya emahlweni.`,rights:()=>"Timfanelo ta wena hi ka tlhelo ka Nawu wa Vuhlanganisi bya Vatirhi:",rightsList:()=>["Ku Appila: U nga appila xilumkiso lexi hi ku tsala eka HR hi nkarhi wa tawa ta 48 loko u tshemba leswaku a xi lulamanga kumbe xi endliwile hambi.","Ndzulavulo wo ya Emahlweni: Mavanyiselo yo fana eka nkarhi wa ku tirhisa wa xilumkiso lexi swi nga endla ku va goza rin'wana ra ndzulavulo, ku ya eka ku herisiwa.","Swihlayiselo: Rungula leri i swihlayiselo naswona ri avelaniwa ntsena na vafambisi lava lavekaka ni HR."],witnessOption:()=>"Vusayini bya wena byi tiyisisa leswaku u twisisa xilumkiso lexi ni timfanelo ta wena - ku nga ri leswaku u pfumela. Loko u vavisa ku sayini, nhlamulo a nga tiyisisa leswaku xilumkiso xi hlamuseriwile. Xilumkiso xi tirhaka hi tindlela hinkwato.",questions:()=>"Xana u na swivutiso hi xilumkiso lexi kumbe timfanelo ta wena?",closing:()=>"Sweswi hi ta hlengeleta vusayini. Ku antswisa loku hatlisaka ku laveka."},ve:{greeting:(e,s)=>`${e}, iyi meetingi ndi ya u tiyisedza tivhiso yo á¹…walwaho nga ha zwithu zwa mushumo zwine ra zwi amba.`,incident:(e,s)=>`Mulandu: ${e}. Vhubvo: ${s}. Maitele aya a tyela mipholisi yashu ya mushumo nahone a tea u ima zwino-zwino.`,warningExplanation:(e,s)=>`Iyi ndi tivhiso ya ${e}. I dzula kha rekhodho yavho minwedzi ya ${s}. No tea u kombedza u khwinisa ha u tavhanya na u fhiraho phaná¸“a.`,rights:()=>"Pfanelo dzavho kha fhasi ha Mulayo wa Vhushaka ha Vhashumi:",rightsList:()=>["U Appela: No nga appela iyi tivhiso hu tshi á¹…walwa kha HR nga tshifhinga tsha awara dza 48 arali no tenda uri a i kha fhasi ha vhulungana kana yo itiwa zwi si zwone.","Mulandu wo Fhiraho Phaná¸“a: Maitele a tshi tou fana nga tshifhinga tsha u shuma ha iyi tivhiso zwi nga khwinisa kha magato mafhelo a mulandu, u swika kha u thithiswa.","Swihlayiselo: Mafhungo othe ndi swihlayiselo nahone o abelaniwa fhedzi na vhaá¹±hohi vhane vha tea na vhashumi vha HR."],witnessOption:()=>"U saena havho zwi tiyisedza uri no pfesesa iyi tivhiso na pfanelo dzavho - zwi si uri no tendelana. Arali no nanga u si saini, muhumbeli o do tiyisedza uri tivhiso yo talutshedzelwa. Tivhiso i shuma nga ndila dzoá¹±he.",questions:()=>"Vho na mbudziso nga ha iyi tivhiso kana pfanelo dzavho?",closing:()=>"Zwino ro do kuvhanganya masaena. U khwinisa ha u tavhanya hu a tea."},ss:{greeting:(e,s)=>`${e}, loluhlangano ngalokucinisekisa sixwayiso lesibhaliwe ngesehlo lemsebenzi lesakhulumako.`,incident:(e,s)=>`Licala: ${e}. Tincukacha: ${s}. Loku kutiphatsa kuhlubuka nephalisinkomba yaletfu yemsebenzi futhi kumele kume masinyane.`,warningExplanation:(e,s)=>`Lesi yisixwayiso se-${e}. Sihlala emarekhodini akho etinyanga letingu-${s}. Kumele ubonise kuntfula lokushesha nekucondzaphambili.`,rights:()=>"Emalungelo akho ngansi kweMtsetfo weTinhlangano teTisebenzi:",rightsList:()=>["Kuphikisana: Ungaphikisana nalesi sixwayiso ngekubhalwa ku-HR ngetikhatsi tetinshintfu tange-48 uma ukholwa kutsi asifanele noma senziwa hambi.","Kulajiswa Lokucondzaphambili: Kutiphatsa lekufanako ngelesikhatsi sekuphila salesixwayiso kungase kuholele kusinyatselo sesinye sekulajiswa, kuya ekuxoshwa.","Buyimfihlo: Lwati luyimfihlo futhi lutsatfwe kubaphati labadzingekako kuphela ne-HR."],witnessOption:()=>"Kusayina kwakho kucincisekisa kutsi uyatizwa lesixwayiso nemalungelo akho - kusho nje kutsi uyavuma. Uma ukhetsa kungasayini, umfakazi utawucincisekisa kutsi sixwayiso sichaziwe. Sixwayiso sisebenta ngatindzlela tonkhe.",questions:()=>"Ingabe unemibuto ngalesi sixwayiso noma emalungelo akho?",closing:()=>"Manje sitawutfola kusayina. Kuntfula lokushesha kuyadingeka."},tn:{greeting:(e,s)=>`${e}, kopano eno ke go tiisa temoso e e kwadilweng ka kgang ya tiro e re neng re buisana ka yone.`,incident:(e,s)=>`Molato: ${e}. Dintlha: ${s}. Boitshwaro jono bo tlola dipholisi tsa rona tsa tiro mme bo tshwanetse go ema ka bonako.`,warningExplanation:(e,s)=>`Eno ke temoso ya ${e}. E nna mo rekotong ya gago dikgwedi tse ${s}. O tshwanetse go bontsha tokafatso e e bonalang le e e tswelelang.`,rights:()=>"Ditshwanelo tsa gago ka fa tlase ga Molao wa Dikamano tsa Badiri:",rightsList:()=>["Go Boipiletsa: O ka boipiletsa temoso eno ka go kwala go HR mo diureng tse 48 fa o dumela gore ga e siame kgotsa e dirwa ka phoso.","Kgalemelo e e Tswelelang: Boitshwaro jo bo tshwanang ka nako ya go bereka ya temoso eno go ka felela ka kgato e nngwe ya kgalemelo, go fitlha kwa go tlosiwa tiro.","Sephiri: Tshedimosetso yotlhe e sephiri mme e abelane fela le batsamaisi ba ba tlhokegang le HR."],witnessOption:()=>"Go saena ga gago go netefatsa gore o tlhaloganya temoso eno le ditshwanelo tsa gago - ga go reye gore o dumelana. Fa o tlhopha go sa saena, paki e tla netefatsa gore temoso e tlhalosetse. Temoso e bereka ka ditsela tsotlhe.",questions:()=>"A o na le dipotso ka temoso eno kgotsa ditshwanelo tsa gago?",closing:()=>"Jaanong re tla kokoanya mesaeno. Tokafatso e e bonalang e a tlhokega."},nr:{greeting:(e,s)=>`${e}, leli hlangano ngolokuqinisekisa isixwayiso esibhaliwe ngodaba lomsebenzi esasixoxako.`,incident:(e,s)=>`Icala: ${e}. Imininingwane: ${s}. Lokhu kuziphatha kuphula izinqubomgomo zethu zomsebenzi futhi kumele kume masinyane.`,warningExplanation:(e,s)=>`Lesi yisixwayiso se-${e}. Sihlala emarekhodi akho izinyanga ezingu-${s}. Kumele ubonise ukuthuthuka okusheshayo nokuqhubekayo.`,rights:()=>"Amalungelo akho ngaphansi koMthetho weBudlelwano Basebenzi:",rightsList:()=>["Ukubhena: Ungabhena lesi sixwayiso ngokubhaliwe ku-HR ngamahora angama-48 uma ukholelwa ukuthi asilungile noma asenziwa kabi.","Ukuqeqesha Okuqhubekayo: Ukuziphatha okufanayo ngesikhathi lesi sixwayiso kungase kuholele esinyweni esinye sokuqeqesha, kuya ekuxoshweni.","Ubumfihlo: Lonke ulwazi luyimfihlo futhi lubelane kuphela nabaphathi abadingekayo ne-HR."],witnessOption:()=>"Ukusayina kwakho kuqinisekisa ukuthi uqonda lesi sixwayiso namalungelo akho - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, umfakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela.",questions:()=>"Ingabe unemibuzo ngalesi sixwayiso noma amalungelo akho?",closing:()=>"Manje sizoqoqa izimo zokusayina. Ukuthuthuka okusheshayo kuyadingeka."},ns:{greeting:(e,s)=>`${e}, kopano ye ke go tiiÅ¡etÅ¡a temoÅ¡o ye e ngwadilwego ya tiragalo ya moÅ¡omo yeo re bolediÅ¡anego ka yona.`,incident:(e,s)=>`Molato: ${e}. Dintlha: ${s}. Boitshwaro bjo bo thuba dipholisi tÅ¡a rena tÅ¡a moÅ¡omo gomme bo swanetÅ¡e go ema ka pela.`,warningExplanation:(e,s)=>`Ye ke ${e}. E dula go direkoto tÅ¡a gago dikgwedi tÅ¡e ${s}. O swanetÅ¡e go bontÅ¡ha kaonafatÅ¡o ye e lebelelago le ye e tÅ¡welelago.`,rights:()=>"Ditokelo tÅ¡a gago ka fase ga Molao wa Dikamano tÅ¡a BaÅ¡omi:",rightsList:()=>["BoipiletÅ¡o: O ka boipiletÅ¡a temoÅ¡o ye ka go ngwala go HR ka gare ga diiri tÅ¡e 48 ge o dumela gore ga e nepagetÅ¡ego goba e dirwa ka phoÅ¡o.","Kgalemo ye e TÅ¡welago Pele: Boitshwaro bjo bjo swanago ka nako ya go Å¡oma ya temoÅ¡o ye bo ka fela ka kgato ye nngwe ya kgalemo, go fihla go tloÅ¡weng moÅ¡omo.","Sephiri: TshedimoÅ¡o ye ke sephiri gomme e abelanwa feela le balaodi le HR."],witnessOption:()=>"Go saena ga gago go netefatÅ¡a gore o kweÅ¡iÅ¡a temoÅ¡o ye le ditokelo tÅ¡a gago - e sego gore o dumelelana le yona. Ge o gana go saena, paki e tlago netefatÅ¡a gore temoÅ¡o e hlaloÅ¡itÅ¡we. TemoÅ¡o e Å¡oma ka ditsela tÅ¡e ka bobedi.",questions:()=>"Na o na le dipotÅ¡iÅ¡o ka temoÅ¡o ye goba ditokelo tÅ¡a gago?",closing:()=>"Bjale re tlago kgoboketÅ¡a mesaeno. KaonafatÅ¡o ye e lebelelago e a nyakega."}},Ve=({employeeName:e,managerName:s,categoryName:t,incidentDescription:r,warningLevel:i,validityPeriod:o,onScriptRead:l,disabled:n=!1})=>{const[c,d]=C.useState("en"),[m,u]=C.useState(!1),[h,g]=C.useState(!1),x=Be[c]||Be.en,p=Oe.find(e=>e.code===c)||Oe[0],y=((e,s)=>{const a=e.toLowerCase().replace(/ /g,"_");return He[s][a]||e})(i,c);return a.jsx("div",{className:"space-y-2",children:a.jsx("div",{className:"border rounded-lg p-3",style:{background:"linear-gradient(to right, var(--color-alert-warning-bg), var(--color-alert-warning-bg))",borderColor:"var(--color-alert-warning-border)"},children:m?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between pb-3 border-b",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(le,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸ“– Employee Warning Script"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(ne,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:c,onChange:e=>d(e.target.value),disabled:h||n,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Oe.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:a.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Opening"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:x.greeting(e,s)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Incident Details"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:x.incident(t,r)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Warning Level & Validity"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:x.warningExplanation(y,o)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Your Rights"}),a.jsx("p",{className:"text-xs leading-relaxed mb-2",style:{color:"var(--color-text-secondary)"},children:x.rights()}),a.jsx("ul",{className:"space-y-1 text-xs",style:{color:"var(--color-text-secondary)"},children:x.rightsList().map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx(ie,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--color-success)"}}),e]},s))})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-secondary)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"5. Signature Explanation"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:x.witnessOption()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"6. Questions & Closing"}),a.jsx("p",{className:"text-xs leading-relaxed mb-2",style:{color:"var(--color-text-secondary)"},children:x.questions()}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:x.closing()})]})]})}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(ce,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsxs("span",{children:["Read this complete script aloud to ",e]})]}),h?a.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[a.jsx(ie,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):a.jsxs("button",{onClick:()=>{g(!0),l()},disabled:n,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:[a.jsx(ie,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]}),a.jsx("div",{className:"border rounded-lg p-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(J,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-info)"}}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-info-text)"},children:[a.jsx("p",{className:"font-medium mb-0.5",children:"Legal Compliance Notice"}),a.jsx("p",{children:"This script ensures compliance with the Labour Relations Act (LRA) requirements for procedural fairness in disciplinary proceedings. All employee rights have been comprehensively covered in their preferred language."})]})]})})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(le,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Employee Warning Script"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Complete script covering all employee rights"})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(ne,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:c,onChange:e=>d(e.target.value),disabled:h||n,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Oe.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-1 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-warning-text)"},children:["Script available in ",a.jsx("strong",{children:p.nativeName})," â€¢ Ready to read aloud"]}),a.jsxs("button",{onClick:()=>u(!0),disabled:n,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-medium",style:{backgroundColor:"var(--color-warning)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-warning)",e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-warning)",e.currentTarget.style.opacity="1"},children:[a.jsx(J,{className:"w-3 h-3"}),"View Full Script"]})]})]})})})},Ge=(e,s="Unknown")=>null==e?s:"string"==typeof e?e:"object"==typeof e&&e.name?String(e.name):String(e),Ye=({lraRecommendation:e,selectedEmployee:s,selectedCategory:t,formData:l,currentManagerName:n,onSignaturesComplete:c,isAnalyzing:m=!1,signaturesFinalized:u=!1,currentSignatures:h,warningId:g,audioUploadStatus:x,onLevelOverride:p})=>{const[y,v]=C.useState(!1),[f,b]=C.useState(!1),[w,N]=C.useState(!1),[j,k]=C.useState(!1),[S,_]=C.useState(h||{manager:null,employee:null}),[D,I]=C.useState(null),[E,R]=C.useState(!1),[T,z]=C.useState("employee");C.useEffect(()=>{h&&_(h)},[h]),C.useEffect(()=>{f&&k(!0)},[f]),C.useEffect(()=>{p&&p(D)},[D,p]),C.useEffect(()=>{u&&setTimeout(()=>{const e=document.querySelector(".warning-success-alert");e&&e.scrollIntoView({behavior:"smooth",block:"center"})},300)},[u]);const L=!(!S.manager||!S.employee);C.useCallback(()=>{N(!0),setTimeout(()=>{b(!0),N(!1)},1500)},[]);const A=C.useCallback(e=>{_(s=>({...s,manager:e}))},[]),M=C.useCallback(e=>new Promise((s,a)=>{const t=new Image;t.onload=()=>{const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");if(!r)return void a(new Error("Failed to get canvas context"));r.drawImage(t,0,0),r.save(),r.translate(e.width/2,e.height/2),r.rotate(-Math.PI/6);const i=Math.max(48,e.width/8);r.font=`bold ${i}px Arial`,r.textAlign="center",r.textBaseline="middle",r.strokeStyle="rgba(220, 38, 38, 0.8)",r.lineWidth=i/16,r.strokeText("WITNESS",0,0),r.fillStyle="rgba(220, 38, 38, 0.55)",r.fillText("WITNESS",0,0),r.restore(),s(e.toDataURL("image/png"))},t.onerror=()=>a(new Error("Failed to load signature image")),t.src=e}),[]),$=C.useCallback(async e=>{if(e&&"witness"===T)try{const s=await M(e);_(e=>({...e,employee:s}))}catch(s){console.error("Failed to apply witness watermark:",s),_(s=>({...s,employee:e}))}else _(s=>({...s,employee:e}))},[T,M]),F=C.useCallback(()=>{if(!L||u)return;const e={...S,timestamp:(new Date).toISOString(),managerName:n,employeeName:s?`${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`:"Unknown Employee"};c(e,!0)},[S,L,u,n,s,c]);return m?a.jsxs(i,{padding:"xl",className:"text-center",children:[a.jsx(de,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"var(--color-primary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Analyzing legal requirements..."})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsxs(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(J,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),a.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"ðŸ“‹ Review & Prepare for Warning Meeting"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(B,{className:"w-3 h-3"}),a.jsx("span",{children:"Takes 5-10 minutes to review"})]})]}),a.jsxs(i,{padding:"md",className:"border",style:{borderColor:"var(--color-primary-light)",backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsx("h3",{className:"text-sm font-bold mb-3",style:{color:"var(--color-text)"},children:"What You'll Do Next:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:"1ï¸âƒ£"}),a.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[a.jsx("strong",{children:"Review the system recommendation"})," below (legal analysis)"]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:"2ï¸âƒ£"}),a.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[a.jsx("strong",{children:"Read the employee warning script"})," thoroughly"]})]}),a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-base",children:"3ï¸âƒ£"}),a.jsxs("span",{className:"text-sm",style:{color:"var(--color-text)"},children:[a.jsx("strong",{children:"Collect both signatures"})," (yours and employee's)"]})]})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs(r,{variant:"warning",size:"lg",className:"font-semibold",children:["âš ï¸ ",Ge(e?.recommendedLevel)," â€¢ ",e?.isEscalation?"Escalated":"First Offense"]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Y,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸŽ¯ System Recommendation"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e?.isEscalation?"Escalation recommended based on history":"Start with "+Ge(e?.recommendedLevel).toLowerCase()})]})]}),a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>v(!y),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[y?"Hide":"Details",y?a.jsx(H,{className:"w-3 h-3"}):a.jsx(q,{className:"w-3 h-3"})]})]}),a.jsxs(i,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>R(!E),className:"transition-all hover:opacity-80 active:scale-95",disabled:u,children:a.jsx(r,{variant:"primary",size:"sm",className:"font-semibold cursor-pointer",children:D?"counselling"===D?"Counselling Session":"verbal"===D?"Verbal Warning":"first_written"===D?"First Written Warning":"final_written"===D?"Final Written Warning":D:Ge(e?.recommendedLevel)})}),e?.isEscalation&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(K,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-warning)"},children:"Escalation"})]}),a.jsxs("button",{onClick:()=>R(!E),className:"flex items-center gap-1 text-xs hover:opacity-80 active:scale-95 transition-all",style:{color:"var(--color-text-secondary)"},disabled:u,children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-primary)"},children:e?.categoryWarningCount??0}),a.jsx("span",{children:"in category"})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-success)"},children:"Analyzed"})]})]}),a.jsx("div",{className:"mt-2 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:e?.isEscalation?`This employee has ${e.categoryWarningCount??0} previous warning(s) in this category. We're escalating to ${Ge(e.recommendedLevel).toLowerCase()} to follow proper progressive discipline procedures.`:`Since this is a first offense in this category, we recommend starting with ${Ge(e.recommendedLevel).toLowerCase()} rather than a formal written warning. This follows best practice progressive discipline.`})})]})]}),y&&a.jsx(i,{padding:"sm",className:"border",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(V,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Analysis Summary"})]}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:Ge(e?.explanation||e?.reason,"Progressive discipline assessment completed based on employee warning history and incident severity.")})]}),e?.legalRequirements&&e.legalRequirements.length>0&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Y,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Legal Compliance"})]}),a.jsxs("div",{className:"space-y-1",children:[e.legalRequirements.slice(0,2).map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5",style:{backgroundColor:"var(--color-info)"}}),a.jsx("span",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:e})]},s)),e.legalRequirements.length>2&&a.jsxs("p",{className:"text-xs ml-3.5",style:{color:"var(--color-info)"},children:["+ ",e.legalRequirements.length-2," more requirements"]})]})]}),a.jsxs("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-card-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(B,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-text)"},children:"Warning History (This Category)"})]}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Employee has ",a.jsx("strong",{children:e?.categoryWarningCount??0})," active warning(s) in this category.",e?.activeWarnings&&e.activeWarnings.length>0&&a.jsxs("span",{className:"ml-1",children:["Most recent warning was issued ",a.jsx("strong",{children:"0 days ago"}),"."]})]})]})]})}),E&&a.jsx(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-warning-light)",backgroundColor:"var(--color-alert-warning-bg)"},children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[a.jsx(me,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-bold text-sm mb-1",style:{color:"var(--color-text)"},children:"âš–ï¸ Override Recommendation"}),a.jsxs("p",{className:"text-xs leading-relaxed mb-3",style:{color:"var(--color-text-secondary)"},children:["The system recommends ",a.jsx("strong",{style:{color:"var(--color-text)"},children:Ge(e?.recommendedLevel)}),". You may override this to escalate faster or re-issue the same level if circumstances warrant it."]})]})]}),a.jsx("button",{onClick:()=>R(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",disabled:u,children:a.jsx(O,{className:"w-4 h-4"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Warning Level:"}),a.jsxs("select",{value:D||e?.suggestedLevel||"",onChange:s=>{const a=s.target.value===(e?.suggestedLevel||"")?null:s.target.value;I(a)},className:"w-full px-3 py-2 text-sm rounded-lg border-2 transition-colors",style:{borderColor:D?"var(--color-warning)":"var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)"},disabled:u,children:[a.jsx("option",{value:"",children:"-- Use System Recommendation --"}),e?.escalationPath?.map(s=>a.jsxs("option",{value:s,children:[{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",final_written:"Final Written Warning"}[s]||s,s===e.suggestedLevel?" (Recommended)":""]},s))]})]}),D&&a.jsxs(d,{variant:"warning",className:"text-xs",children:[a.jsx("strong",{children:"Override Active:"})," This warning will be issued as ",a.jsx("strong",{children:"counselling"===D?"Counselling Session":"verbal"===D?"Verbal Warning":"first_written"===D?"First Written Warning":"final_written"===D?"Final Written Warning":D})," instead of the recommended level. Future warnings will consider this custom escalation path."]})]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(J,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸ“– Employee Warning Script"})]}),a.jsxs(i,{padding:"sm",className:"border",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Read this script before your meeting."})," It ensures you cover all legal requirements and communicate clearly with the employee."]}),a.jsx(Ve,{employeeName:s?`${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`:"Unknown Employee",managerName:n,categoryName:t?.name||"General Misconduct",incidentDescription:l.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:D||e?.recommendedLevel||"verbal",validityPeriod:l.validityPeriod,onScriptRead:()=>b(!0),disabled:f})]})]}),x&&"complete"!==x&&a.jsxs("div",{className:"mb-3 p-3 rounded-lg border flex items-center gap-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:[a.jsx(de,{className:"w-5 h-5 animate-spin",style:{color:"var(--color-info)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["stopping"===x&&"ðŸŽ¤ Stopping recording...","uploading"===x&&"â˜ï¸ Uploading audio to Firebase..."]}),a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-tertiary)"},children:"Please wait while we save your warning"})]})]}),j&&a.jsx(d,{variant:"info",className:"border-l-4",style:{borderLeftColor:"var(--color-info)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(me,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"var(--color-info)"}}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-bold text-sm mb-2",style:{color:"var(--color-text)"},children:"â„¹ï¸ What Happens After Signatures?"}),a.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--color-text-secondary)"},children:[a.jsx("p",{children:"â€¢ âœ… Warning is officially recorded in the system"}),a.jsx("p",{children:"â€¢ ðŸ“§ Employee receives their copy (email/WhatsApp/print)"}),a.jsx("p",{children:"â€¢ ðŸ”” HR is notified automatically"})]})]})]})}),j&&a.jsxs(i,{padding:"sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ce,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"âœï¸ Collect Signatures"})]}),a.jsx("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:a.jsx("span",{children:L?"Complete":"Pending"})})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(U,{className:"w-3.5 h-3.5",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Manager"}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:n})]}),S.manager&&a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),a.jsx(qe,{onSignatureComplete:A,disabled:u,label:"Manager Signature",placeholder:"Manager signature",initialSignature:S.manager,width:300,height:80})]}),a.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-success-bg)",opacity:S.manager?1:.6},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(U,{className:"w-3.5 h-3.5",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"employee"===T?"Employee":"Witness"}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:s?`${s.profile?.firstName||"Unknown"} ${s.profile?.lastName||"Employee"}`:"Unknown Employee"})]}),S.employee&&a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),!S.manager&&!u&&a.jsx("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-warning)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(X,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-alert-warning-text)"},children:"Manager must save their signature first"})]})}),!u&&S.manager&&a.jsxs("div",{className:"mb-3 p-2 rounded border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border-light)"},children:[a.jsx("div",{className:"text-xs font-medium mb-2",style:{color:"var(--color-text)"},children:"Signature Type:"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"signatureType",value:"employee",checked:"employee"===T,onChange:e=>z(e.target.value),className:"w-4 h-4",style:{accentColor:"var(--color-success)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text)"},children:"Employee Signature"})]}),a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"signatureType",value:"witness",checked:"witness"===T,onChange:e=>z(e.target.value),className:"w-4 h-4",style:{accentColor:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text)"},children:"Witness Signature"})]})]}),a.jsx("div",{className:"mt-2 text-xs",style:{color:"var(--color-text-secondary)"},children:"employee"===T?"Employee signs to acknowledge notification":"Witness confirms this warning was explained to the employee"})]}),a.jsx(qe,{onSignatureComplete:$,disabled:u||!S.manager,label:"employee"===T?"Employee Signature":"Witness Signature",placeholder:"employee"===T?"Employee signature":"Witness signature",initialSignature:S.employee,width:300,height:80})]})]}),L&&!u&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"hidden md:block mt-3 p-2 rounded-lg flex items-center justify-between",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Ready to finalize"})]}),a.jsxs(o,{onClick:F,size:"sm",className:"px-3 py-1.5",children:[a.jsx(ue,{className:"w-3 h-3 mr-1"}),"Finalize & Save Warning"]})]}),a.jsx("div",{className:"md:hidden fixed bottom-0 left-0 right-0 p-4 bg-white border-t-2 shadow-lg z-50",style:{borderColor:"var(--color-success)"},children:a.jsxs(o,{onClick:F,className:"w-full h-12 text-base font-semibold",children:[a.jsx(ue,{className:"w-4 h-4 mr-2"}),"Finalize & Save Warning"]})})]}),u&&a.jsx("div",{className:"warning-success-alert mt-4",children:a.jsx(d,{variant:"success",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(Q,{className:"w-6 h-6",style:{color:"var(--color-success)"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-bold text-base mb-2",style:{color:"var(--color-text)"},children:"âœ… Warning Officially Recorded"}),a.jsxs("div",{className:"text-sm space-y-1",style:{color:"var(--color-text-secondary)"},children:[a.jsx("p",{children:"â€¢ Signatures captured and saved"}),a.jsx("p",{children:"â€¢ Audio recording uploaded to Firebase"}),g&&a.jsxs("p",{children:["â€¢ Warning ",a.jsxs("span",{className:"font-mono font-semibold",children:["#",g.slice(-8)]})," created in database"]}),a.jsx("p",{className:"text-xs mt-3 pt-2 border-t",style:{borderColor:"var(--color-border)",color:"var(--color-text-tertiary)"},children:'ðŸŽ¯ Click "Next" to set up delivery for HR team'})]})]})]})})})]})]})},Ke=e=>{if(!e)return"Counselling Session";return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"}[e]||e},Xe=({selectedEmployee:s,selectedCategory:t,formData:l,lraRecommendation:n,signatures:c,organizationName:h,currentManagerName:g,audioRecording:x,onComplete:p,onWarningCreated:y,warningId:v,onFinalizeReady:f})=>{const{user:b}=m(),{organization:w}=u();C.useEffect(()=>{s&&(s.profile,s.profile)},[s,t,l]);const[N,j]=C.useState("email"),[k,S]=C.useState(!1),[_,D]=C.useState(!1),[I,E]=C.useState(!1),[R,T]=C.useState(null),[z,L]=C.useState(!1),[A,M]=C.useState(null),[$,F]=C.useState(!1),[P,W]=C.useState(null),[q,O]=C.useState(!1),H=[{id:"email",name:"Email",icon:he,description:"Receive warning document via email",available:!!s?.email},{id:"whatsapp",name:"WhatsApp",icon:ge,description:"Receive warning document via WhatsApp",available:!!s?.phone},{id:"printed",name:"Printed Copy",icon:xe,description:"Receive a printed physical copy",available:!0}],B=C.useCallback(async()=>{try{S(!0)}catch(s){e.error("âŒ Error opening PDF preview:",s),T("Failed to generate PDF preview")}},[]),V=C.useCallback(async(a,t)=>{if(s&&w&&b&&v)try{D(!0),T(null);try{F(!0);const a=await ze.createDeliveryNotification({warningId:v,organizationId:w.id,employeeId:s.id,employeeName:`${s.profile?.firstName||s.firstName||"Unknown"} ${s.profile?.lastName||s.lastName||"Employee"}`,employeeEmail:s.profile?.email||s.email||"",employeePhone:s.profile?.phoneNumber||s.phone||"",warningLevel:n?.suggestedLevel||l.level||"counselling",warningCategory:n?.category||l.category||"General",incidentDate:l.incidentDate,employeeRequestedDeliveryMethod:N,createdBy:b.id,createdByName:g});W(a),e.success(9578),L(!0)}catch(r){e.error("âŒ Failed to create delivery notification:",r),T(r.message||"Failed to notify HR about delivery")}finally{F(!1)}e.success(10016)}catch(i){e.error("âŒ Error creating HR notification:",i),T(i.message||"Failed to create HR notification")}finally{D(!1)}else T("Missing required data for HR notification")},[s,w,b,v,N,n,l,g]),G=C.useCallback(async()=>V(),[V]),Y=C.useMemo(()=>!(!v||!N||_||P),[v,N,_,P]);return H.find(e=>e.id===N),C.useEffect(()=>{f?.({canFinalize:Y,finalizeHandler:G})},[Y,G,f]),C.useEffect(()=>{if(z&&P){const e=setTimeout(()=>{p()},2e3);return()=>clearTimeout(e)}},[z,P,p]),z?a.jsx(i,{padding:"xl",className:"max-w-2xl mx-auto text-center",children:a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(Q,{className:"w-8 h-8 sm:w-10 sm:h-10",style:{color:"var(--color-success)"}})}),a.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",style:{color:"var(--color-text)"},children:"Warning Issued Successfully!"}),a.jsxs("p",{style:{color:"var(--color-text-secondary)"},children:["Warning ",A?`#${A.slice(-8)}`:""," has been created."]}),a.jsxs("p",{className:"font-medium mt-2",style:{color:"var(--color-primary)"},children:["ðŸ“¬ HR has been notified to deliver via ",N]}),x?.audioUrl&&!R&&a.jsx(d,{variant:"success",className:"mt-4 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(pe,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Audio recording saved successfully"})]})}),P&&a.jsxs(d,{variant:"info",className:"mt-4 text-center",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ue,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"HR Team Notified"})]}),a.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:["Delivery notification #",P.slice(-8)," created for HR team"]})]}),a.jsx("div",{className:"mt-6",children:a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>O(!q),className:"text-sm font-medium underline min-h-[40px]",children:[q?"Hide":"View"," Delivery Instructions for HR"]})}),q&&a.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[a.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text)"},children:Le.getDeliveryInstructions(N).title}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Steps to Follow:"}),a.jsx("ol",{className:"text-sm list-decimal list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Le.getDeliveryInstructions(N).steps.map((e,s)=>a.jsx("li",{children:e},s))})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Requirements:"}),a.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Le.getDeliveryInstructions(N).requirements.map((e,s)=>a.jsx("li",{children:e},s))})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Documentation Needed:"}),a.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Le.getDeliveryInstructions(N).documentation.map((e,s)=>a.jsx("li",{children:e},s))})]})]})]}),R&&a.jsxs("div",{className:"mt-4 p-3 rounded-lg border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",style:{color:"var(--color-alert-warning-text)"},children:[a.jsx(X,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Warning created, but audio upload had issues"})]}),a.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-alert-warning-text)"},children:R})]})]})}):a.jsxs("div",{className:"space-y-3",children:[a.jsx(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-success)"},children:a.jsx(Q,{className:"w-6 h-6 text-white"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"Warning Successfully Recorded"}),a.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Warning #",v?.slice(-8)," â€¢ Signatures captured â€¢ Audio uploaded"]})]})]})}),a.jsx(i,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-base font-bold",style:{color:"var(--color-text)"},children:"Ready to Hand Off to HR"}),a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:"Choose delivery method and notify your HR team"})]})]})}),a.jsx(i,{padding:"sm",className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-text-secondary)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee"}),a.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[s?.profile?.firstName," ",s?.profile?.lastName]})]})]}),a.jsx(r,{variant:"success",size:"sm",className:"font-semibold",children:Ke(l.level)||"Counselling Session"})]})}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("h3",{className:"font-semibold text-sm flex items-center gap-2",style:{color:"var(--color-text)"},children:[a.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),"How would the employee like to receive this warning?"]}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Ask the employee their preference. HR can adjust this later if needed."}),a.jsx("div",{className:"grid grid-cols-1 gap-2",children:H.map(e=>{const s=e.icon;return a.jsx(i,{padding:"sm",hover:e.available,className:"cursor-pointer transition-all border-l-4 "+(e.available?"":"opacity-50 cursor-not-allowed"),style:{borderLeftColor:N===e.id?"var(--color-primary)":"transparent",backgroundColor:N===e.id?"var(--color-alert-info-bg)":"transparent"},onClick:()=>e.available&&j(e.id),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(s,{className:"w-4 h-4",style:{color:"var(--color-text)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),!e.available&&"whatsapp"===e.id&&a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-error)"},children:"No phone number available"})]})]}),N===e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-primary)"},children:"Selected"})]}),a.jsx("input",{type:"radio",name:"deliveryMethod",value:e.id,checked:N===e.id,onChange:()=>{},disabled:!e.available,className:"sr-only"})]})},e.id)})})]}),!P&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:B,className:"w-full py-3 px-4 rounded-lg border transition-all hover:shadow-sm",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)"},children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ye,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Preview Document (Optional)"})]})}),a.jsx("div",{className:"text-xs text-center px-4",style:{color:"var(--color-text-secondary)"},children:"Your HR team will handle delivery and proof of receipt"})]}),R&&a.jsx(d,{variant:"error",children:a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[a.jsx(X,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",children:"Error"}),a.jsx("p",{className:"text-xs mt-1",children:R})]})]}),a.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>{T(null),G()},className:"flex items-center gap-1",children:[a.jsx(oe,{className:"w-3 h-3"}),"Retry"]})]})}),I&&a.jsx(d,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Uploading audio..."})]})}),$&&a.jsx(d,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Notifying HR..."})]})}),k&&a.jsx(Re,{isOpen:k,onClose:()=>S(!1),warningData:{selectedEmployee:s,selectedCategory:t,formData:l,lraRecommendation:n,signatures:c,deliveryChoice:{method:N,timestamp:new Date,chosenBy:g},organizationName:h,currentManagerName:g,employee:s,organization:w},onPDFGenerated:(e,s)=>{},isCompleted:!1})]})},Je=({size:e="medium",color:s="#3b82f6"})=>{const t={small:"1.5rem",medium:"3rem",large:"5rem"};return a.jsx("div",{style:{width:t[e],height:t[e],border:"4px solid #e2e8f0",borderTop:`4px solid ${s}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})};if("undefined"!=typeof document){const e=document.createElement("style");e.innerHTML="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n\n  @keyframes shimmer {\n    0% { background-position: -1000px 0; }\n    100% { background-position: 1000px 0; }\n  }\n\n  .skeleton-card {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .skeleton-line {\n    height: 1rem;\n    margin-bottom: 0.5rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n  }\n\n  .skeleton-header {\n    height: 1.5rem;\n    margin-bottom: 1rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n    width: 40%;\n  }\n\n  .skeleton-circle {\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 50%;\n  }\n\n  .skeleton-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n",document.head.appendChild(e)}const Ze={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},Qe=({onPermissionGranted:s,onPermissionDenied:t,organizationName:r,managerName:i})=>{const[o,l]=C.useState("requesting"),[n,c]=C.useState("");C.useRef(Math.random().toString(36).substr(2,9)),C.useEffect(()=>(Ze.callbacks.push(s),Ze.errorCallbacks.push(t),Ze.isGranted?(l("granted"),void setTimeout(s,100)):(Ze.isRequesting||(Ze.isRequesting=!0,d()),()=>{const e=Ze.callbacks.indexOf(s);e>-1&&Ze.callbacks.splice(e,1);const a=Ze.errorCallbacks.indexOf(t);a>-1&&Ze.errorCallbacks.splice(a,1)})),[]);const d=async()=>{try{if(l("requesting"),c(""),!navigator.mediaDevices?.getUserMedia)return l("not-supported"),void c("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(e=>e.stop()),l("granted"),Ze.isGranted||(Ze.isGranted=!0,Ze.isRequesting=!1,Ze.callbacks.forEach(e=>{setTimeout(e,1e3)}))}catch(s){e.error("Microphone permission error:",s),Ze.isRequesting=!1,"NotAllowedError"===s.name?(l("denied"),c("Microphone access was denied. Please allow microphone access and try again.")):"NotFoundError"===s.name?(l("error"),c("No microphone was found on your device.")):"NotReadableError"===s.name?(l("error"),c("Your microphone is being used by another application.")):(l("error"),c("An error occurred while accessing your microphone.")),Ze.errorCallbacks.forEach(e=>{e()})}},m=(()=>{switch(o){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:n};case"not-supported":return{title:"Browser Not Supported",message:n};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"max-w-sm w-full",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:(()=>{switch(o){case"requesting":return a.jsx(Je,{size:"medium",color:"#3b82f6"});case"granted":return a.jsx(Je,{size:"medium",color:"#16a34a"});case"denied":return a.jsx(ve,{className:"w-6 h-6 text-red-600"});case"error":return a.jsx(fe,{className:"w-6 h-6 text-red-600"});case"not-supported":return a.jsx(ve,{className:"w-6 h-6 text-gray-600"});default:return a.jsx(pe,{className:"w-6 h-6 text-gray-600"})}})()}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m.title}),a.jsx("p",{className:"text-sm text-gray-600",children:m.message})]}),("denied"===o||"error"===o)&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"}),a.jsx("div",{className:"text-xs text-gray-500",children:a.jsx("p",{children:'Look for the microphone icon in your browser\'s address bar and click "Allow"'})})]})]}),a.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:a.jsx("p",{children:r})})]})})},es="audio/webm;codecs=opus",ss=16e3,as=8e3,ts=1,rs=3e5,is=819200,os=24e4,ls=!0,ns=!0,cs=!0;class ds{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return ds.instance||(ds.instance=new ds),ds.instance}canStart(){const e=Date.now();return!this.isRecording&&!this.isStarting&&(!(this.startedAt>0&&e-this.startedAt<1e3)&&(!(this.allActiveStreams.size>0||this.allActiveTracks.size>0)||(this.allActiveStreams.size,this.allActiveTracks.size,!1)))}tryReserve(){return!!this.canStart()&&(this.isStarting=!0,this.startedAt=Date.now(),!0)}startRecording(){this.isRecording=!0}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{try{e.stop()}catch(s){}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null)}setStream(e){return this.mediaStream||this.allActiveStreams.size>0?(this.allActiveStreams.size,e.getTracks().forEach(e=>e.stop()),!1):(this.allActiveStreams.add(e),e.getTracks().forEach(e=>{this.allActiveTracks.add(e),e.addEventListener("ended",()=>{this.allActiveTracks.delete(e)})}),this.mediaStream=e,this.isStarting=!1,this.allActiveStreams.size,!0)}stopAllStreams(){this.allActiveStreams.size,this.allActiveTracks.size,this.allActiveStreams.forEach(e=>{e.getTracks().forEach(e=>{try{e.stop()}catch(s){}})}),this.allActiveTracks.forEach(e=>{try{"live"===e.readyState&&e.stop()}catch(s){}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0}}const ms=ds.getInstance(),us=_.memo(({employees:t,categories:r,currentManagerName:i,organizationName:o,onComplete:l,onCancel:n,preSelectedEmployeeId:c,preSelectedCategoryId:d,isFullScreen:p})=>{C.useRef(Math.random().toString(36).substr(2,9));const{user:y}=m(),{organization:v}=u(),f=(()=>{const[s,a]=C.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),t=C.useRef(null),r=C.useRef([]),i=C.useRef(null),o=C.useRef(0),l=C.useRef(null),n=C.useRef(!1),c=C.useRef(!1),d=C.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),m=C.useCallback(e=>e<1024?`${e}B`:e<1048576?`${(e/1024).toFixed(1)}KB`:`${(e/1048576).toFixed(1)}MB`,[]),u=C.useCallback(()=>`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),g=C.useCallback(()=>{if(!o.current)return;if(!s.isRecording)return void(l.current&&(clearInterval(l.current),l.current=null));const e=(Date.now()-o.current)/1e3,r=Date.now()-o.current;if(a(s=>s.isRecording?{...s,duration:e}:s),r>=rs)return l.current&&(clearInterval(l.current),l.current=null),void setTimeout(()=>{t.current&&"recording"===t.current.state&&t.current.stop()},0);r>=os&&!n.current&&(n.current=!0)},[]),x=C.useCallback(()=>{try{if(t.current){try{"recording"===t.current.state&&t.current.stop()}catch(s){}t.current=null}[i.current,ms.mediaStream].filter(Boolean).forEach(e=>{e&&e.getTracks().forEach(e=>{try{e.stop()}catch(s){}})}),i.current=null,ms.stopAllStreams(),l.current&&(clearInterval(l.current),l.current=null),r.current=[],n.current=!1,o.current=0,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(s){e.error("âŒ Error during force cleanup:",s)}},[]),p=C.useCallback(async()=>{if(ms.tryReserve())try{if(c.current=!1,(i.current||t.current||ms.mediaStream)&&(x(),await new Promise(e=>setTimeout(e,100))),a(e=>({...e,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const s=await navigator.mediaDevices.getUserMedia({audio:{channelCount:ts,sampleRate:as,echoCancellation:ls,noiseSuppression:ns,autoGainControl:cs}});if(!ms.setStream(s))return void a(e=>({...e,isProcessing:!1,error:"Another recording is already active"}));i.current=s,r.current=[];const d=new MediaRecorder(s,{mimeType:es,audioBitsPerSecond:ss});t.current=d,d.ondataavailable=s=>{if(!c.current&&s.data.size>0){r.current.push(s.data);const o=r.current.reduce((e,s)=>e+s.size,0);if(a(e=>({...e,size:o})),o>=is&&"recording"===t.current?.state){m(o),c.current=!0;try{t.current.stop()}catch(i){e.error("âŒ Error stopping MediaRecorder:",i)}}}},d.onstop=()=>{i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null)},d.start(1e3),o.current=Date.now(),n.current=!1,ms.startRecording(),l.current=setInterval(g,100);const h=u();a(e=>({...e,isRecording:!0,isProcessing:!1,recordingId:h,duration:0,size:0}))}catch(s){e.error("âŒ Error starting recording:",s),ms.stopRecording(),a(e=>({...e,isRecording:!1,isProcessing:!1,error:s.message||"Failed to start recording"}))}},[g,u]),y=C.useCallback(async()=>{try{return t.current&&s.isRecording?(a(e=>({...e,isProcessing:!0})),l.current&&(clearInterval(l.current),l.current=null),new Promise(s=>{const i=t.current;i.onstop=()=>{try{const e=new Blob(r.current,{type:es}),t=URL.createObjectURL(e);a(s=>({...s,isRecording:!1,isProcessing:!1,audioUrl:t,size:e.size})),m(e.size),c.current=!1,s(t)}catch(t){e.error("âŒ Error processing recording:",t),a(e=>({...e,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),c.current=!1,s(null)}},i.stop(),a(e=>({...e,isRecording:!1}))})):(c.current=!1,null)}catch(i){return e.error("âŒ Error stopping recording:",i),a(e=>({...e,isRecording:!1,isProcessing:!1,error:i.message||"Failed to stop recording"})),c.current=!1,null}},[s.isRecording,m]),v=C.useCallback(()=>{t.current&&s.isRecording&&(t.current.pause(),l.current&&(clearInterval(l.current),l.current=null))},[s.isRecording]),f=C.useCallback(()=>{t.current&&s.isRecording&&(t.current.resume(),o.current=Date.now()-1e3*s.duration,l.current=setInterval(g,100))},[s.isRecording,s.duration,g]),b=C.useCallback(()=>{try{t.current&&t.current.stop(),i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null),l.current&&(clearInterval(l.current),l.current=null),s.audioUrl&&URL.revokeObjectURL(s.audioUrl),r.current=[],n.current=!1,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(o){e.error("âŒ Error cancelling recording:",o)}},[s.audioUrl]),w=C.useCallback(async(t,r)=>{try{if(!s.audioUrl||!s.recordingId)throw new Error("No recording available to upload");a(e=>({...e,isProcessing:!0}));const i=await fetch(s.audioUrl),o=await i.blob(),l=`warnings/${t}/${r}/audio/${s.recordingId}.webm`,n=L(h,l),c={contentType:es,customMetadata:{warningId:r,organizationId:t,duration:s.duration.toString(),size:s.size.toString(),recordingId:s.recordingId,createdAt:(new Date).toISOString()}};await A(n,o,c);const d=await M(n);return a(e=>({...e,isProcessing:!1})),e.success(13735),d}catch(i){return e.error("âŒ Error uploading audio:",i),a(e=>({...e,isProcessing:!1,error:i.message||"Failed to upload audio"})),null}},[s.audioUrl,s.recordingId,s.duration,s.size]),N=C.useCallback(async(t,r,i,o)=>{try{if(!t||!r)throw new Error("No recording data provided for upload");a(e=>({...e,isProcessing:!0}));const l=await fetch(t),n=await l.blob(),c=L(h,`warnings/${i}/${o}/audio/${r}.webm`),d={contentType:es,customMetadata:{warningId:o,organizationId:i,duration:s.duration.toString(),size:n.size.toString(),recordingId:r,createdAt:(new Date).toISOString()}};await A(c,n,d);const m=await M(c);return a(e=>({...e,isProcessing:!1})),e.success(15712),m}catch(l){return e.error("âŒ Error uploading audio from URL:",l),a(e=>({...e,isProcessing:!1,error:l.message||"Failed to upload audio"})),null}},[s.duration]);C.useEffect(()=>()=>{if(l.current&&(clearInterval(l.current),l.current=null),i.current&&(i.current.getTracks().forEach(e=>{e.stop()}),i.current=null),t.current){try{"recording"===t.current.state&&t.current.stop()}catch(e){}t.current=null}r.current=[],n.current=!1,o.current=0,ms.stopAllStreams()},[]);const j=s.duration>=os/1e3,k=!s.isRecording&&!s.isProcessing;return{...s,startRecording:p,stopRecording:y,pauseRecording:v,resumeRecording:f,cancelRecording:b,forceCleanup:x,uploadToFirebase:w,uploadToFirebaseFromUrl:N,formatDuration:d,formatSize:m,isNearLimit:j,canRecord:k}})(),b=C.useCallback(async()=>{S(!0),D(!1)},[]),w=C.useCallback(()=>{S(!1)},[]);C.useEffect(()=>{const e=e=>{if("undefined"!=typeof window)if(e){const e=window.scrollY;document.documentElement.style.setProperty("--scroll-y",`-${e}px`),document.body.classList.add("modal-open")}else{document.body.classList.remove("modal-open");const e=document.documentElement.style.getPropertyValue("--scroll-y");document.documentElement.style.removeProperty("--scroll-y"),e&&window.scrollTo(0,-1*parseInt(e.replace("px","")))}};return e(!0),()=>e(!1)},[]),C.useEffect(()=>{const e=setTimeout(()=>{alert("â±ï¸ Session Timeout\n\nThis warning session has been open for 30 minutes and will now close. Please start a new warning if needed."),f&&f.forceCleanup(),n()},18e5);return()=>{clearTimeout(e)}},[]);const[N,j]=C.useState(0),[k,S]=C.useState(!1),[_,D]=C.useState(!0),[I,E]=C.useState(new Set),[R,$]=C.useState(!1),[F,P]=C.useState(!1),[W]=C.useState(()=>g()),[U,q]=C.useState({employeeId:c||null,categoryId:d||null,incidentDate:(new Date).toISOString().split("T")[0],incidentTime:(new Date).toTimeString().split(" ")[0].substring(0,5),incidentLocation:"",incidentDescription:"",additionalNotes:"",issueDate:(new Date).toISOString().split("T")[0],validityPeriod:6}),[H,B]=C.useState(!1),[V,G]=C.useState([]),[K,Z]=C.useState(null),[ee,se]=C.useState(null),[ae,te]=C.useState(null);C.useEffect(()=>{const e=ae||K?.suggestedLevel||"counselling";U.level!==e&&q(s=>({...s,level:e,wasOverridden:!!ae}))},[ae,K?.suggestedLevel,U.level]);const[oe,le]=C.useState(!1),[ne,ce]=C.useState(null),[de,me]=C.useState(null),[he,ge]=C.useState(!1),[xe,pe]=C.useState(null),[ye,ve]=C.useState({manager:null,employee:null}),[fe,we]=C.useState(!1),[Ne,je]=C.useState(null),ke=(({sessionId:e,stepName:s,autoStart:a=!0,enableRealTimeValidation:t=!0})=>{const[r,i]=C.useState(e||""),[o,l]=C.useState([]),[n,c]=C.useState([]),[d,m]=C.useState(null),u=C.useRef(!1),h=C.useRef(!1);C.useEffect(()=>{if(!a||u.current||e)e&&(i(e),u.current=!0);else{const e=Me.startWizardSession();i(e),u.current=!0}},[a,e]),C.useEffect(()=>{if(!r)return;const e=()=>{const e=Me.getSessionLogs(r),s=Me.getSessionIssues(r),a=Me.getSessionSummary(r);l(e),c(s),m(a)};e();const s=s=>{(s.metadata?.sessionId===r||o.some(e=>e.id===s.id))&&e()};Me.addListener(s);const a=setInterval(e,2e3);return()=>{Me.removeListener(s),clearInterval(a)}},[r]);const g=C.useCallback(()=>{if(!u.current){const e=Me.startWizardSession();return i(e),u.current=!0,e}return r},[r]),x=C.useCallback(e=>{r&&(h.current&&(Me.exitStep(r,s,void 0,"completed"===e),h.current=!1),Me.endWizardSession(r,e),u.current=!1)},[r,s]),p=C.useCallback(e=>{r&&!h.current&&(Me.enterStep(r,s,e),h.current=!0)},[r,s]),y=C.useCallback((e,a=!0)=>{r&&h.current&&(Me.exitStep(r,s,e,a),h.current=!1)},[r,s]),v=C.useCallback((e,a,t)=>{r&&Me.trackDataChange(r,s,e,a,t)},[r,s]),f=C.useCallback(e=>{r&&Me.trackFormSubmission(r,s,e)},[r,s]),b=C.useCallback((e,a,t,i)=>{r&&Me.trackAPICall(r,s,e,a,t,i)},[r,s]),w=C.useCallback((e,a)=>{r&&Me.trackError(r,s,e,a)},[r,s]),N=C.useCallback((e,a)=>{r&&Me.trackSuccess(r,s,e,a)},[r,s]),j=C.useCallback((e,a)=>{r&&Me.trackWarning(r,s,e,a)},[r,s]),k=C.useCallback(e=>r&&t&&Me.validateStepData?.(r,s,e,"MANUAL_VALIDATION")||{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},[r,s,t]),S=C.useCallback(()=>r?Me.exportSessionData(r):"",[r]);return C.useEffect(()=>{r&&a&&!h.current&&p()},[r,a,p]),C.useEffect(()=>()=>{r&&h.current&&y(void 0,!1)},[r,y]),{sessionId:r,startSession:g,endSession:x,enterStep:p,exitStep:y,trackChange:v,trackFormSubmit:f,trackAPI:b,trackError:w,trackSuccess:N,trackWarning:j,validateData:k,logs:o,issues:n,summary:d,exportSession:S}})({stepName:`STEP_${N||1}`,autoStart:!0,enableRealTimeValidation:!1}),Se=C.useRef(0);C.useRef(U),C.useRef(new Set);const Ce=C.useRef(!1),_e=C.useMemo(()=>t.find(e=>e.id===U.employeeId),[t,U.employeeId]),De=C.useMemo(()=>r.find(e=>e.id===U.categoryId),[r,U.categoryId]),Ie=C.useMemo(()=>v?.id,[v?.id]);C.useCallback(()=>{N>0&&!he&&j(N-1)},[N,he]),C.useCallback(()=>{N<3&&!he&&j(N+1)},[N,he]),C.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"});const e=document.querySelector(".modal-content__scrollable");e&&e.scrollTo({top:0,behavior:"smooth"});const s=document.querySelector(".modal-system");s&&s.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{window.scrollTo({top:0,behavior:"instant"}),e&&e.scrollTop>0&&(e.scrollTop=0)},500)},[N]),C.useEffect(()=>{Se.current!==N&&(ke.trackSuccess("STEP_CHANGED",{from:Se.current,to:N,stepName:0===N?"Incident Details":1===N?"Legal Review":"Delivery Completion"}),Se.current=N)},[N,ke]),f.isRecording;const Ee=C.useCallback(async e=>{if(e&&Ie){ke.trackAPI("loadWarningHistory",{employeeId:e,organizationId:Ie}),B(!0);try{const s=await x.warnings.getAll(Ie,{employeeId:e});G(s),ke.trackAPI("loadWarningHistory",{employeeId:e,organizationId:Ie},{count:s.length})}catch(s){ke.trackError(s,{employeeId:e,organizationId:Ie}),G([])}finally{B(!1)}}},[Ie,ke]),Re=C.useRef(null);C.useEffect(()=>{_e&&!H&&Re.current!==_e.id&&(Re.current=_e.id,Ee(_e.id))},[_e?.id,H,Ee]);const Te=C.useCallback(async(s,a)=>{if(!(s&&a&&Ie&&U.incidentDescription)){const e={employeeId:!!s,categoryId:!!a,organizationId:!!Ie,incidentDescription:!!U.incidentDescription};return void ke.trackError(new Error("Cannot generate LRA - missing data"),e)}let i;$(!0),ke.trackAPI("generateLRARecommendation",{employeeId:s,categoryId:a});try{i=await x.warnings.getActiveWarnings(s,Ie),i.length}catch(o){e.error("âŒ Failed to fetch active warnings:",o),ke.trackError(o,{employeeId:s,categoryId:a,context:"final_warning_verification_failed"});const i=t.find(e=>e.id===s),l=r.find(e=>e.id===a);return le(!0),ce({employeeName:i?`${i.firstName} ${i.lastName}`:"Employee",categoryName:l?.name||"Category",warningDate:"cannot_verify_escalation"}),void $(!1)}if(i.some(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===a)){const e=i.find(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===a),o=t.find(e=>e.id===s),l=r.find(e=>e.id===a);return le(!0),ce({employeeName:o?`${o.firstName} ${o.lastName}`:"Employee",categoryName:l?.name||"Category",warningDate:e?.issueDate||(new Date).toISOString()}),void $(!1)}try{const e=await x.warnings.getEscalationRecommendation(s,a,v?.id||"default");Z(e),ke.trackAPI("generateLRARecommendation",{employeeId:s,categoryId:a},e)}catch(l){ke.trackError(l,{employeeId:s,categoryId:a,formData:U,context:"lra_generation_failed"});const e=De?.escalationPath||["counselling","verbal","first_written","final_written"],t={suggestedLevel:e[0]||"counselling",recommendedLevel:"counselling"===e[0]?"Counselling Session":"verbal"===e[0]?"Verbal Warning":"first_written"===e[0]?"First Written Warning":"Counselling Session",reason:"Fallback recommendation due to analysis error. Manual review required.",activeWarnings:i,escalationPath:e,isEscalation:!1,category:De?.name||"General Misconduct",categoryId:a,legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure procedural fairness","Document thoroughly"],warningCount:i.length,nextExpiryDate:null,examples:["Review case manually","Consult HR if needed"],explanation:"Unable to analyze history - system error occurred",previousWarnings:[],confidence:60};Z(t),ke.trackWarning("Using fallback LRA recommendation",t)}finally{$(!1)}},[Ie,U.incidentDescription,De,ke,t,r]),ze=C.useCallback(e=>{const s=["employeeId","categoryId","incidentLocation"];Object.keys(e).some(a=>s.includes(a)&&e[a]!==U[a])&&ke.trackSuccess("SIGNIFICANT_FORM_UPDATE",e),q(s=>({...s,...e}))},[U,ke]),Le=C.useCallback(()=>{ke.trackSuccess("WIZARD_COMPLETED",{sessionDuration:Date.now()-new Date(ke.summary?.startTime||Date.now()).getTime(),totalSteps:I.size,totalIssues:ke.issues.length,finalWarningId:ee}),ke.endSession("completed"),l()},[l,ke,I.size,ee]),Ae=C.useCallback(()=>{ke.trackWarning("WIZARD_CANCELLED",{currentStep:N,completedSteps:Array.from(I)}),f.forceCleanup(),document.body.classList.remove("modal-open"),ke.endSession("cancelled"),n()},[n,ke,N,I,f]);C.useEffect(()=>{if(Ce.current||!k||f.isRecording||f.audioUrl)return;return(async()=>{try{Ce.current=!0,await f.startRecording(),ke.trackSuccess("AUDIO_RECORDING_STARTED",{duration:f.duration,size:f.size})}catch(e){ke.trackError(e,{context:"AUDIO_RECORDING_START"}),Ce.current=!1}})(),()=>{Ce.current=!1}},[k]),C.useEffect(()=>{xe&&!R&&K&&(ke.trackSuccess("LRA_ANALYSIS_COMPLETE_PROCEEDING",{pendingStep:xe,hasRecommendation:!!K}),j(xe),pe(null),ge(!1)),oe&&xe&&(pe(null),ge(!1))},[xe,R,K,oe,ke]);const $e=C.useCallback(async()=>{if(ke.trackSuccess("NEXT_STEP_REQUESTED",{currentStep:N,hasLRA:!!K}),2===N)return void(de?.canFinalize&&de?.finalizeHandler&&(ke.trackSuccess("FINALIZING_WARNING",{}),de.finalizeHandler()));const e=N+1;if(E(e=>new Set([...e,N])),0===N&&1===e)return U.employeeId&&U.categoryId&&U.incidentDescription?K&&!R?(ke.trackSuccess("PROCEEDING_TO_STEP_2",{hasLRA:!0}),void j(e)):(ke.trackSuccess("TRIGGERING_LRA_GENERATION",U),ge(!0),pe(e),void(await Te(U.employeeId,U.categoryId))):void ke.trackError(new Error("Missing required data for step 2"),{employeeId:!!U.employeeId,categoryId:!!U.categoryId,incidentDescription:!!U.incidentDescription});ke.trackSuccess("STEP_NAVIGATION_COMPLETE",{from:N,to:e}),j(e)},[N,U.employeeId,U.categoryId,U.incidentDescription,K,R,Te,ke,de]),Fe=C.useCallback(()=>{N>0&&(ke.trackSuccess("PREVIOUS_STEP",{from:N,to:N-1}),j(N-1),he&&(ge(!1),pe(null),ke.trackWarning("NAVIGATION_CANCELLED_BY_BACK",{currentStep:N})))},[N,he,ke]),Pe=C.useCallback(async(a,t=!1)=>{if(ke.trackSuccess("SIGNATURES_COMPLETED",{hasManager:!!a.manager,hasEmployee:!!a.employee,finalized:t,timestamp:a.timestamp}),ve(a),t){we(!0);try{let t=null;if(f?.isRecording&&(je("stopping"),ke.trackSuccess("AUDIO_AUTO_STOP_BEFORE_SAVE",{duration:f.duration,size:f.size}),t=await f.stopRecording(),e.success(21068),t||e.warn("âš ï¸ Audio URL not returned from stopRecording. Will create warning with placeholder.")),!_e||!De||!v)throw new Error("Missing required data for warning creation");const o={employeeId:_e.id,categoryId:De.id,organizationId:v.id,employeeName:_e.profile?.firstName||"Unknown",employeeLastName:_e.profile?.lastName||"Employee",employeeNumber:_e.profile?.employeeNumber||"Unknown",employeeDepartment:_e.profile?.department||"Unknown",employeePosition:_e.profile?.position||"Unknown",categoryName:De.name||"Unknown",level:ae||K?.suggestedLevel||"counselling",wasOverridden:!!ae,originalRecommendedLevel:K?.suggestedLevel,incidentDate:U.incidentDate,incidentTime:U.incidentTime,incidentLocation:U.incidentLocation,incidentDescription:U.incidentDescription,additionalNotes:U.additionalNotes,issueDate:U.issueDate,validityPeriod:U.validityPeriod,signatures:a};t?(o.audioRecording={url:t,duration:f?.duration||0,size:f?.size||0,recordingId:f?.recordingId,uploadToFirebase:!0,status:"ready",processingStatus:"pending"},e.success(23340)):(e.error("âŒ Audio recording is mandatory for all warnings"),ke.trackError(new Error("Audio recording missing"),{warningData:U,audioState:{isRecording:f?.isRecording,hasDirectUrl:!!t,hasStateUrl:!!f?.audioUrl,duration:f?.duration}}),o.audioRecording={status:"missing",processingStatus:"required",error:"Audio recording is mandatory but was not captured",duration:f?.duration||0,size:f?.size||0,uploadToFirebase:!1,requiresAttention:!0});const l=await x.warnings.create(o);if(e.success(24554),se(l),t&&f?.uploadToFirebaseFromUrl&&f?.recordingId&&l)try{je("uploading");const a=await f.uploadToFirebaseFromUrl(t,f.recordingId,v.id,l);if(a){e.success(25382);const t=T(s,"organizations",v.id,"warnings",l);await z(t,{"audioRecording.url":a,"audioRecording.storageePath":`warnings/${v.id}/${l}/audio/${f.recordingId}.webm`,"audioRecording.processingStatus":"complete","audioRecording.uploadedAt":new Date,updatedAt:new Date}),e.success(26224),ke.trackSuccess("AUDIO_UPLOADED_AND_UPDATED",{warningId:l,firebaseUrl:a,duration:f.duration,size:f.size}),je("complete"),f.forceCleanup()}else e.warn("âš ï¸ Audio upload returned null URL"),ke.trackWarning("AUDIO_UPLOAD_NULL_URL",{warningId:l})}catch(r){e.error("âŒ Audio upload failed:",r),ke.trackError(r,{context:"AUDIO_UPLOAD_STEP2",warningId:l,duration:f?.duration,size:f?.size});try{const e=T(s,"organizations",v.id,"warnings",l);await z(e,{"audioRecording.processingStatus":"failed","audioRecording.error":r.message||"Upload failed in Step 2","audioRecording.failedAt":new Date,updatedAt:new Date})}catch(i){e.error("âŒ Failed to update warning with audio error:",i),ke.trackError(i,{context:"AUDIO_ERROR_UPDATE"})}f.forceCleanup()}ke.trackSuccess("WARNING_FULLY_CREATED_STEP2",{warningId:l})}catch(o){e.error("âŒ Error creating warning:",o),ke.trackError(o,{context:"WARNING_CREATION_ON_SIGNATURE_COMPLETE"})}E(e=>new Set([...e,N])),ke.trackSuccess("SIGNATURES_FINALIZED_NEXT_ENABLED",{currentStep:N})}},[N,ke,f,_e,De,v,U,K,x]),Ue=C.useMemo(()=>({0:{title:"Incident Details",subtitle:"Step 1 of 3",description:"Select employee, choose violation category, and document the incident with all relevant details.",icon:J},1:{title:"Review & Sign",subtitle:"Step 2 of 3",description:"Review escalation recommendation, read warning script, and collect required signatures.",icon:Y},2:{title:"Delivery Setup",subtitle:"Step 3 of 3 - Administrative",description:"âœ… Warning saved. Choose how HR will deliver to employee.",icon:ue}}),[]),qe=C.useMemo(()=>{switch(N){case 0:return!!(U.employeeId&&U.categoryId&&U.incidentDate&&U.incidentTime&&U.incidentLocation&&U.incidentDescription&&U.incidentDescription.length>=20);case 1:return!!(K&&!R&&ye.manager&&ye.employee&&fe);case 2:return!0;default:return!1}},[N,U,K,R,ye,fe]),Oe=C.useCallback(()=>{switch(N){case 0:if(oe&&ne){const e="cannot_verify_escalation"===ne.warningDate;return a.jsxs("div",{className:"p-6 space-y-5",children:[a.jsx("div",{className:"p-5 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)",borderLeft:"4px solid var(--color-error)"},children:a.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[a.jsx(X,{className:"w-6 h-6 flex-shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-base font-bold mb-1",style:{color:"var(--color-error)"},children:e?"HR Approval Required":"Cannot Issue Warning"}),a.jsxs("p",{className:"text-sm mb-2",style:{color:"var(--color-alert-error-text)"},children:[a.jsx("strong",{children:ne.employeeName})," has a Final Written Warning on file."]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)",opacity:.9},children:e?"Cannot verify warning history. Contact HR to approve further escalation.":"This is the final step before termination. HR must handle any further escalation."})]})]})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs("button",{onClick:async()=>{alert("HR Notification feature coming soon!\n\nFor now, please contact your HR Manager directly via phone or email.")},className:"flex-1 px-4 py-3 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[a.jsx(ue,{className:"w-4 h-4 inline mr-2"}),"Notify HR Manager"]}),a.jsxs("button",{onClick:()=>{le(!1),ce(null),n()},className:"px-4 py-3 rounded-lg font-medium text-sm transition-colors",style:{backgroundColor:"var(--color-error)",color:"var(--color-text-inverse)"},children:[a.jsx(O,{className:"w-4 h-4 inline mr-2"}),"Close"]})]})]})}return a.jsx(We,{employees:t,categories:r,formData:U,updateFormData:ze,selectedEmployee:_e,selectedCategory:De,warningHistory:V,isLoadingWarningHistory:H,loadWarningHistory:Ee,lraRecommendation:K,isAnalyzing:R});case 1:return a.jsx(Ye,{lraRecommendation:K,selectedEmployee:_e,selectedCategory:De,formData:U,currentManagerName:i,onSignaturesComplete:Pe,isAnalyzing:R,signaturesFinalized:fe,currentSignatures:ye,warningId:ee,audioUploadStatus:Ne,onLevelOverride:te});case 2:return a.jsx(Xe,{selectedEmployee:_e,selectedCategory:De,formData:U,lraRecommendation:K,signatures:ye,organizationName:o,currentManagerName:i,audioRecording:f,onComplete:Le,onWarningCreated:se,warningId:ee,onFinalizeReady:me});default:return a.jsxs("div",{className:"p-8 text-center text-red-600",children:["Unknown step: ",N]})}},[N,o,i,t,r,U,ze,_e,De,V,H,Ee,K,R,Pe,ye,f,Le,oe,ne,n]),He=(()=>{if(oe)return{show:!1,disabled:!0,loading:!1,text:""};if(2===N)return{show:!0,disabled:!de?.canFinalize,loading:!1,text:"Finalize"};if(0===N&&!qe){const e=[];if(U.employeeId)if(U.categoryId){if(!U.incidentLocation||U.incidentLocation.length<3)e.push("Add location");else if(!U.incidentDescription||U.incidentDescription.length<20){const s=U.incidentDescription?.trim().split(/\s+/).filter(e=>e.length>0)||[],a=Math.max(0,20-s.length);e.push(`Add ${a} more word${1===a?"":"s"}`)}}else e.push("Choose category");else e.push("Select employee");return{show:!0,disabled:!0,loading:!1,text:e.length>0?`Next - ${e[0]}`:"Next"}}return 0===N&&qe&&(he||R)?{show:!0,disabled:!0,loading:!0,text:"Analyzing..."}:{show:!0,disabled:!qe,loading:!1,text:"Next"}})();return C.useMemo(()=>({formData:U,signatures:ye,lraRecommendation:K,selectedEmployee:_e,selectedCategory:De,organizationId:v?.id,currentStep:N,isStepValid:qe,isAnalyzing:R,warningHistory:V,finalWarningId:ee}),[U,ye,K,_e,De,v?.id,N,qe,R,V,ee]),C.useEffect(()=>()=>{f.forceCleanup(),document.body.classList.remove("modal-open")},[]),_&&!k?a.jsx(Qe,{onPermissionGranted:b,onPermissionDenied:w,organizationName:o,managerName:i}):a.jsx("div",{className:`\n    modal-system\n    ${p?"modal-system--fullscreen":""}\n    ${W.isLegacyDevice?"legacy-device":""}\n    ${W.hasGoodPerformance?"perf-high":"perf-low"}\n    ${W.hasModernCSS?"css-modern":"css-legacy"}\n  `,children:a.jsxs("div",{className:`\n      modal-container\n      ${p?"modal-container--fullscreen":""}\n      ${W.browserInfo.isAndroid4x?"android-4x":""}\n      ${W.browserInfo.isIOS6to7?"ios-6-7":""}\n    `,children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Issue Warning"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document disciplinary action and intervention"})]})}),a.jsx("button",{onClick:Ae,className:"modal-header__close-button",title:"Cancel and close wizard",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"modal-header__center",children:[a.jsx("div",{className:"modal-header__progress-mobile md:hidden",children:a.jsxs("div",{className:"mobile-step-indicator",children:[a.jsxs("div",{className:"mobile-step-dots",children:[Object.entries(Ue).map(([e,s])=>{const t=parseInt(e),r=t===N,i=I.has(t);return a.jsx("div",{className:`mobile-step-dot ${r?"mobile-step-dot--active":""} ${i?"mobile-step-dot--completed":""} ${r||i?"":"mobile-step-dot--inactive"}`,title:s.title,children:i?a.jsx(ie,{className:"w-3 h-3"}):t+1},e)}),f.isRecording&&a.jsx("div",{className:"mobile-recording-indicator",children:a.jsx("div",{className:"mobile-recording-dot-pulse"})})]}),a.jsx("div",{className:"mobile-step-info",children:a.jsx("div",{className:"mobile-step-title",children:Ue[N]?.title||"Loading..."})})]})}),a.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Object.entries(Ue).map(([e,s])=>{const t=parseInt(e),r=t===N,i=I.has(t);return a.jsxs("div",{className:"step-container",children:[a.jsx("div",{className:`\n                step-dot\n                ${r?"step-dot--active":""}\n                ${i?"step-dot--completed":""}\n                ${r||i?"":"step-dot--inactive"}\n              `,title:s.title,children:i?a.jsx(ie,{className:"w-3 h-3"}):t+1}),t<Math.max(...Object.keys(Ue).map(Number))&&a.jsx("div",{className:`\n                step-connector\n                ${i?"step-connector--completed":"step-connector--inactive"}\n              `})]},e)})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable step-transition",children:Oe()},N)}),a.jsx("div",{className:"modal-footer",children:!oe&&a.jsx("div",{className:"modal-footer__nav",children:2===N&&ee?a.jsxs("button",{onClick:Le,className:"modal-footer__button modal-footer__button--primary w-full",children:[a.jsx(Q,{className:"w-4 h-4"}),"Close"]}):a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:Fe,disabled:0===N||he,className:`\n                    modal-footer__button modal-footer__button--secondary\n                    ${0===N||he?"opacity-50":""}\n                  `,children:[a.jsx(be,{className:"w-4 h-4"}),"Previous"]}),He.show&&a.jsx("button",{onClick:$e,disabled:He.disabled,className:`\n                      modal-footer__button modal-footer__button--primary\n                      ${He.loading?"modal-footer__button--loading":""}\n                    `,children:!He.loading&&a.jsxs(a.Fragment,{children:[He.text,a.jsx(re,{className:"w-4 h-4"})]})})]})})})]})})},(e,s)=>e.currentManagerName===s.currentManagerName&&e.organizationName===s.organizationName&&e.preSelectedEmployeeId===s.preSelectedEmployeeId&&e.preSelectedCategoryId===s.preSelectedCategoryId&&e.isFullScreen===s.isFullScreen&&(e.employees.length===s.employees.length&&e.categories.length===s.categories.length)),hs=Object.freeze(Object.defineProperty({__proto__:null,EnhancedWarningWizard:us},Symbol.toStringTag,{value:"Module"})),gs=({employees:e,selectedEmployeeId:s,onEmployeeSelect:t,disabled:r=!1,className:i="",title:o="Employee Selection",subtitle:l="Choose the employee for this action"})=>{const[n,c]=C.useState(""),[d,m]=C.useState(!1),[u,h]=C.useState(!1),g=C.useMemo(()=>{if(!n.trim())return e;const s=n.toLowerCase();return e.filter(e=>{const a=`${e.firstName} ${e.lastName}`.toLowerCase(),t=e.department?.toLowerCase()||"";return a.includes(s)||t.includes(s)})},[e,n]),x=C.useMemo(()=>e.find(e=>e.id===s),[e,s]),p=C.useCallback(e=>{t(e),m(!1),h(!1),c("")},[t]),y=C.useCallback(()=>{if(r)return;window.innerWidth<768?h(!0):m(!d)},[r,d]),v=C.useCallback(()=>{h(!1),c("")},[]);return a.jsxs("div",{className:`form-section ${i}`,children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(U,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:o}),a.jsx("p",{className:"unified-section-header__subtitle",children:l})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border "+(r?"opacity-50 cursor-not-allowed":"hover:border-primary"),style:{backgroundColor:"var(--color-input-background)",borderColor:d?"var(--color-primary)":"var(--color-input-border)",boxShadow:d?"0 0 0 2px var(--color-primary-light)":void 0},onClick:y,children:x?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[x.firstName?.charAt(0),x.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[x.firstName," ",x.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[x.position," â€¢ ",x.department]})]})]}),a.jsx(q,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(d?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(U,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(q,{className:"w-4 h-4 transition-transform "+(d?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),d&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[a.jsx("div",{className:"p-3",style:{borderBottom:"1px solid var(--color-border)"},children:a.jsxs("div",{className:"relative",children:[a.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:n,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-3 py-2 rounded border text-sm focus:ring-2",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)","--ring-color":"var(--color-primary)"}})]})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:g.length>0?a.jsx("div",{className:"py-2",children:g.map(e=>a.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left px-3 py-2 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:[e.firstName," ",e.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[e.position," â€¢ ",e.department]})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center",children:[a.jsx(U,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:n?`No employees found matching "${n}"`:"No employees available"})]})})]})]})}),u&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:v}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Employee"}),a.jsx("button",{onClick:v,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(O,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(we,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:n,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-3 py-2 rounded border",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)"}})]})}),a.jsx("div",{className:"mobile-category-list",children:g.length>0?a.jsx("div",{children:g.map(e=>a.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left px-4 py-3 transition-colors",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-sm",style:{color:"var(--color-primary)"},children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-medium text-base",style:{color:"var(--color-text)"},children:[e.firstName," ",e.lastName]}),a.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[e.position," â€¢ ",e.department]})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center",children:[a.jsx(U,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:n?`No employees found matching "${n}"`:"No employees available"})]})})]})]})]})},xs=[{id:"training",label:"Training & Development",description:"Skills training, knowledge sharing, and competency development",icon:"ðŸ“š",color:"blue"},{id:"coaching",label:"Performance Coaching",description:"Performance improvement, goal setting, and mentoring",icon:"ðŸŽ¯",color:"green"},{id:"behavioral",label:"Behavioral Discussion",description:"Conduct, attitude, and workplace behavior guidance",icon:"ðŸ¤",color:"purple"}],ps=({isOpen:e,onClose:s})=>{const{user:t}=m(),{organization:r}=u(),[i,o]=C.useState(null),[l,n]=C.useState(null),[c,d]=C.useState("coaching"),[h,g]=C.useState(""),[y,v]=C.useState(""),[f,b]=C.useState(!1),[w,N]=C.useState(null),[j,k]=C.useState(!1),[S,_]=C.useState(!0),[D,I]=C.useState([]),[E,R]=C.useState([]);C.useEffect(()=>{if(r?.id&&t?.id&&e){(async()=>{try{_(!0),N(null);const e=(await x.employees.getByManager(t?.id||"",r.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",email:e.profile?.email||e.contact?.email||e.email||"",phone:e.profile?.phone||e.contact?.phone||e.phone||"",deliveryPreference:e.deliveryPreference||"email",...e}));I(e);let s=await x.organizations.getCategories(r.id);s&&0!==s.length||(s=[{id:"attendance_punctuality",name:"Attendance & Punctuality",severity:"minor"},{id:"performance_issues",name:"Performance Issues",severity:"moderate"},{id:"safety_violations",name:"Safety Violations",severity:"serious"},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",severity:"serious"},{id:"policy_violations",name:"Policy Violations",severity:"serious"},{id:"dishonesty_theft",name:"Dishonesty & Theft",severity:"gross_misconduct"},{id:"substance_abuse",name:"Substance Abuse",severity:"gross_misconduct"},{id:"harassment_discrimination",name:"Harassment & Discrimination",severity:"gross_misconduct"}]),R(s)}catch(e){N("Failed to load data. Please try again."),I([]),R([])}finally{_(!1)}})()}else e||_(!1)},[t?.id,r?.id,e]);return e?S?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Loading Counselling Data"}),a.jsx("p",{className:"modal-header__subtitle",children:"Preparing counselling session data"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[a.jsx("div",{className:"animate-spin mx-auto h-16 w-16 border-4 border-gray-200 border-t-primary rounded-full"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading counselling data..."})]})})})]})}):j?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Counselling Session Recorded"}),a.jsx("p",{className:"modal-header__subtitle",children:"Successfully documented and available for HR review"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Session Successfully Recorded"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The corrective counselling session with ",a.jsxs("strong",{children:[i?.firstName," ",i?.lastName]})," has been successfully documented and will be available to HR for review."]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting automatically in a few seconds..."})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:s,className:"modal-footer__button modal-footer__button--primary",children:"Return to Dashboard"})})})]})}):a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container modal-container--xl",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Corrective Counselling Session"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document training, coaching, and discussions"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[w&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),a.jsx(gs,{employees:D,selectedEmployeeId:i?.id||null,onEmployeeSelect:e=>{const s=D.find(s=>s.id===e);o(s||null)},title:"Employee Selection",subtitle:"Choose the employee involved in this counselling session",disabled:S}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2 unified-field-required",children:"Related Category"}),a.jsxs("select",{value:l?.id||"",onChange:e=>{const s=E.find(s=>s.id===e.target.value);n(s||null)},className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",required:!0,children:[a.jsx("option",{value:"",children:"Choose a category..."}),E.map(e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.severity]},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(Ne,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Counselling Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the appropriate type of counselling session"})]})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:xs.map(e=>a.jsx("div",{className:"category-card cursor-pointer "+(c===e.id?"category-card--selected":""),onClick:()=>d(e.id),children:a.jsxs("div",{className:"category-card__content",children:[a.jsx("span",{className:"category-card__icon",children:e.icon}),a.jsxs("div",{className:"category-card__details",children:[a.jsx("div",{className:"category-card__title",children:e.label}),a.jsx("p",{className:"category-card__description",children:e.description})]})]})},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(J,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Issue/Topic Description"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the issue or topic that prompted this counselling session"})]})]}),a.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Describe the issue, topic, or area for improvement that prompted this counselling session...",rows:4,minLength:20,maxLength:500,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),a.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[h.length,"/500 characters (minimum 20)"]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(Q,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Intervention Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Document what was discussed and addressed during the session"})]})]}),a.jsx("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"Describe what was discussed, taught, or addressed during the counselling session...",rows:4,minLength:30,maxLength:1e3,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),a.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[y.length,"/1000 characters (minimum 30)"]})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:s,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(t&&i&&l&&t.organizationId)try{b(!0),N(null);const e={organizationId:t.organizationId,managerId:t.id,managerName:`${t.firstName} ${t.lastName}`,employeeId:i.id,employeeName:`${i.firstName} ${i.lastName}`,employeeNumber:i.employeeNumber||"",department:i.department||"",category:l.name,categoryId:l.id,counsellingType:c,issueDescription:h.trim(),interventionDetails:y.trim(),trainingProvided:"",resourcesProvided:[],promisesToPerform:[],improvementTimeline:"",followUpDate:"",managerSignature:"",employeeAcknowledged:!1,employeeComments:"",status:"completed",improvementNoted:!1,followUpCompleted:!1,escalationRequired:!1,dateCreated:(new Date).toISOString(),lastUpdated:(new Date).toISOString(),createdBy:t.id,documentVersion:1};await p.createDocument(r.id,"reports",e),k(!0),setTimeout(()=>{s()},3e3)}catch(e){N("Failed to submit counselling record. Please try again.")}finally{b(!1)}},disabled:!(i&&l&&h.trim().length>=20&&y.trim().length>=30)||f,className:"modal-footer__button modal-footer__button--primary",children:f?"Submitting...":"Submit Counselling Session"})]})})]})}):null},ys=({onSignatureChange:e,label:s,required:t=!1,role:r="manager",personName:i})=>{const o=C.useRef(null),[l,n]=C.useState(!1),[c,d]=C.useState(!1),m=C.useCallback(e=>{const s=o.current;if(!s)return;const a=s.getBoundingClientRect(),t=s.getContext("2d");t&&(n(!0),t.beginPath(),t.moveTo(e.clientX-a.left,e.clientY-a.top))},[]),u=C.useCallback(e=>{if(!l)return;const s=o.current;if(!s)return;const a=s.getBoundingClientRect(),t=s.getContext("2d");t&&(t.lineTo(e.clientX-a.left,e.clientY-a.top),t.stroke(),d(!0))},[l]),h=C.useCallback(()=>{if(l&&o.current){n(!1);const s=o.current.toDataURL();e(s)}},[l,e]),g=C.useCallback(()=>{const s=o.current;if(!s)return;const a=s.getContext("2d");a&&(a.clearRect(0,0,s.width,s.height),d(!1),e(""))},[e]),x=C.useCallback(()=>{const e=o.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const a=e.getBoundingClientRect();e.width=a.width,e.height=a.height,s.strokeStyle="var(--color-text)",s.lineWidth=2,s.lineCap="round",s.lineJoin="round"},[]);return C.useEffect(()=>{x();const e=()=>{setTimeout(x,100)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[x]),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("label",{className:"unified-field-label",children:[s," ",t&&a.jsx("span",{className:"unified-field-required"})]}),a.jsx("p",{className:"unified-section-header__subtitle",children:"manager"===r?"Please sign below to confirm this meeting request":`${i}, please sign below if you agree to this meeting`})]}),a.jsx("div",{className:"flex items-center gap-2",children:c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[a.jsx(Q,{className:"w-4 h-4"}),a.jsx("span",{children:"Signed"})]}):a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(fe,{className:"w-4 h-4"}),a.jsx("span",{children:"Pending"})]})})]}),a.jsxs("div",{className:"border-2 border-dashed rounded p-4",style:{borderColor:"var(--color-border)"},children:[a.jsx("canvas",{ref:o,className:"w-full h-32 cursor-crosshair rounded",onMouseDown:m,onMouseMove:u,onMouseUp:h,onMouseLeave:h}),a.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:c?"Signature captured":"Click and drag to sign above"}),a.jsxs("button",{onClick:g,disabled:!c,className:"px-3 py-1 text-sm rounded flex items-center gap-1",style:{color:"var(--color-text-secondary)",backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[a.jsx(Se,{className:"w-4 h-4"}),"Clear"]})]})]})]})},vs=({isOpen:s,onClose:t})=>{const{user:r}=m(),{organization:i}=u(),[o,l]=C.useState(null),[n,c]=C.useState(""),[d,h]=C.useState(""),[g,v]=C.useState(""),[f,b]=C.useState(null),[w,N]=C.useState(!1),[j,k]=C.useState(!1),[S,_]=C.useState(null),[D,I]=C.useState(!1),[E,R]=C.useState([]);C.useEffect(()=>{s&&(async()=>{if(r?.id&&i?.id)try{const e=(await x.employees.getByManager(r.id,i.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",email:e.profile?.email||e.contact?.email||e.email||"",...e}));R(e)}catch(s){e.error("Failed to load employees:",s),_("Failed to load employees")}})()},[r?.id,i?.id,s]);const T=()=>o&&n.trim().length>=20&&d.trim(),z=e=>{b(e),e?N(!0):(N(!1),v(""))};return C.useEffect(()=>{s||(l(null),c(""),h(""),v(""),b(null),N(!1),_(null),I(!1))},[s]),D?s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Meeting Request Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"HR will be notified and will schedule the meeting"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Meeting Request Submitted"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["Your meeting request for ",o?.firstName," ",o?.lastName," has been successfully submitted to HR. They will review the request and schedule the meeting accordingly."]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:[a.jsx(ee,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"You will receive notification once the meeting is scheduled"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Book HR Meeting"}),a.jsx("p",{className:"modal-header__subtitle",children:"Schedule intervention meeting with HR"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-header__center",children:a.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:a.jsx("div",{className:"mobile-step-indicator",children:a.jsx("div",{className:"mobile-step-dots",children:a.jsx("div",{className:"mobile-step-dot mobile-step-dot--active",children:"1"})})})})}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[S&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:S})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(gs,{employees:E,selectedEmployeeId:o?.id||null,onEmployeeSelect:e=>{const s=E.find(s=>s.id===e);l(s||null)},title:"Select Employee",subtitle:"Choose the team member for this HR meeting"}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(J,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Meeting Context"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the situation that requires HR intervention"})]})]}),a.jsx("textarea",{value:n,onChange:e=>c(e.target.value),placeholder:"Describe the situation that requires HR intervention...",className:"unified-field-input",rows:4,minLength:20,maxLength:1e3}),a.jsxs("div",{className:"unified-field-hint",children:[n.length,"/1000 characters (minimum 20)"]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(je,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Manager Confirmation"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Please sign to confirm this meeting request"})]})]}),a.jsx(ys,{onSignatureChange:e=>{h(e)},label:"Manager Signature",role:"manager",required:!0})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(ke,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Employee Acknowledgment"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional signature from the employee (can be done later)"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:a.jsx("div",{className:"flex-1",children:a.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Note:"})," Employee signature is optional. You can proceed without it and have them sign later."]})})}),w?a.jsxs("div",{className:"space-y-4",children:[a.jsx(ys,{onSignatureChange:e=>{v(e)},label:"Employee Signature",role:"employee",personName:`${o?.firstName} ${o?.lastName}`}),a.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 rounded",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Back to Options"})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"font-medium",style:{color:"var(--color-text)"},children:"Does the employee want to sign now?"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs("button",{onClick:()=>z(!0),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)"},children:[a.jsx(je,{className:"w-4 h-4"}),"Yes, employee will sign now"]}),a.jsxs("button",{onClick:()=>z(!1),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:[a.jsx(ke,{className:"w-4 h-4"}),"Skip for now"]})]})]})]})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(r&&o&&i?.id&&T())try{k(!0),_(null);const e={organizationId:i.id,managerId:r.id,managerName:`${r.firstName} ${r.lastName}`,employeeId:o.id,employeeName:`${o.firstName} ${o.lastName}`,context:n.trim(),managerSignature:d,...f&&g&&{employeeSignature:g},employeeConsent:f||!1,status:"pending",requestDate:y.getServerTimestamp(),createdAt:y.getServerTimestamp(),updatedAt:y.getServerTimestamp()};await p.createDocument(i.id,"meetings",e),I(!0),setTimeout(()=>{t()},3e3)}catch(s){e.error("Failed to submit meeting request:",s),_("Failed to submit meeting request. Please try again.")}finally{k(!1)}},disabled:!T()||j,className:"modal-footer__button modal-footer__button--primary "+(j?"modal-footer__button--loading":""),children:"Submit Meeting Request"})]})})]})}):null},fs=Object.freeze(Object.defineProperty({__proto__:null,UnifiedBookHRMeeting:vs},Symbol.toStringTag,{value:"Module"})),bs=[{id:"full-day",label:"Full Day Absence",icon:"ðŸ ",payrollImpact:!0,description:"Employee absent for entire work day"},{id:"half-day",label:"Half Day Absence",icon:"ðŸ•",payrollImpact:!0,description:"Employee absent for half of work day"},{id:"late-arrival",label:"Late Arrival",icon:"â°",payrollImpact:!1,description:"Employee arrived late to work"},{id:"early-departure",label:"Early Departure",icon:"ðŸšª",payrollImpact:!1,description:"Employee left work early"},{id:"sick-leave",label:"Sick Leave",icon:"ðŸ¤’",payrollImpact:!0,description:"Employee absent due to illness"},{id:"personal-leave",label:"Personal Leave",icon:"ðŸ‘¤",payrollImpact:!0,description:"Employee absent for personal reasons"}],ws=({isOpen:s,onClose:t})=>{const{user:r}=m(),{organization:i}=u(),[o,l]=C.useState(null),[n,c]=C.useState((new Date).toISOString().split("T")[0]),[d,h]=C.useState(""),[g,v]=C.useState(""),[f,b]=C.useState(!1),[w,N]=C.useState(null),[j,k]=C.useState(!1),[S,_]=C.useState([]),[D,I]=C.useState(!1),[E,R]=C.useState(!1);C.useEffect(()=>{s&&(async()=>{if(r?.id&&i?.id)try{const e=(await x.employees.getByManager(r.id,i.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",employeeNumber:e.employeeNumber||e.profile?.employeeNumber||"",...e}));_(e)}catch(s){e.error("Failed to load employees:",s),N("Failed to load employees")}})()},[r?.id,i?.id,s]);const T=C.useMemo(()=>bs.find(e=>e.id===d),[d]),z=C.useCallback(e=>{h(e),I(!1),R(!1)},[]),L=C.useCallback(()=>{window.innerWidth<768?R(!0):I(!D)},[D]),A=C.useCallback(()=>{R(!1)},[]),M=()=>o&&n&&d;C.useEffect(()=>{s||(l(null),c((new Date).toISOString().split("T")[0]),h(""),v(""),N(null),k(!1),I(!1),R(!1))},[s]);const $=bs.find(e=>e.id===d);return j?s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"Absence report has been successfully submitted"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Report Submitted Successfully"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The absence report for ",o?.firstName," ",o?.lastName," has been submitted and will be reviewed by HR."]}),$?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(Ce,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"This absence may impact payroll calculations"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Employee Absence"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document unscheduled employee absence"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(O,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[w&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(ke,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select employee and specify absence information"})]})]}),a.jsx(gs,{employees:S,selectedEmployeeId:o?.id||null,onEmployeeSelect:e=>{const s=S.find(s=>s.id===e);l(s||null)},title:"Employee Selection",subtitle:"Choose the employee for this absence report"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(Ee,{type:"date",label:"Absence Date",value:n,onChange:e=>c(e),icon:ee,required:!0}),a.jsxs("div",{children:[a.jsx("label",{className:"unified-field-label",children:"Reported Date"}),a.jsx("input",{type:"text",value:(new Date).toLocaleDateString(),readOnly:!0,className:"unified-field-input opacity-75"})]})]})})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(B,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the type of absence that occurred"})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border hover:border-primary",style:{backgroundColor:"var(--color-input-background)",borderColor:D?"var(--color-primary)":"var(--color-input-border)",boxShadow:D?"0 0 0 2px var(--color-primary-light)":void 0},onClick:L,children:T?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg",children:T.icon}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:T.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:T.description}),T.payrollImpact&&a.jsx("span",{className:"category-card__badge category-card__badge--warning",children:a.jsx(Ce,{className:"w-3 h-3"})})]})]})]}),a.jsx(q,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(D?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(B,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select absence type..."})]}),a.jsx(q,{className:"w-4 h-4 transition-transform "+(D?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),D&&a.jsx("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:a.jsx("div",{className:"max-h-60 overflow-y-auto",children:a.jsx("div",{className:"py-2",children:bs.map(e=>a.jsx("button",{onClick:()=>z(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg flex-shrink-0",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs",style:{color:"var(--color-warning)"},children:"$ Payroll"})]})]})]})},e.id))})})})]})}),E&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:A}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Absence Type"}),a.jsx("button",{onClick:A,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(O,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:a.jsx("div",{children:bs.map(e=>a.jsxs("button",{onClick:()=>z(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("span",{className:"text-xl flex-shrink-0 mt-0.5",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("div",{className:"text-sm text-left",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs px-2 py-1 rounded flex-shrink-0",style:{backgroundColor:"var(--color-warning-bg)",color:"var(--color-warning)"},children:"$ Payroll"})]})]})]},e.id))})})]})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(J,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Additional Notes"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional context or details about the absence"})]})]}),a.jsx("textarea",{value:g,onChange:e=>v(e.target.value),placeholder:"Optional additional context or details about the absence...",className:"unified-field-input",rows:3,maxLength:500}),a.jsxs("div",{className:"unified-field-hint",children:[g.length,"/500 characters"]})]}),$?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(Ce,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:"Payroll Impact Notice"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"This absence type may affect the employee's pay. HR will review and make appropriate adjustments."})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(r&&o&&i?.id&&M())try{b(!0),N(null);const e=bs.find(e=>e.id===d),s={organizationId:i.id,managerId:r.id,managerName:`${r.firstName} ${r.lastName}`,employeeId:o.id,employeeName:`${o.firstName} ${o.lastName}`,employeeNumber:o.employeeNumber||"",absenceDate:n,absenceType:d,reason:g.trim()||void 0,reportedDate:y.getServerTimestamp(),payrollImpact:e?.payrollImpact||!1,hrReviewed:!1,createdAt:y.getServerTimestamp(),updatedAt:y.getServerTimestamp()},a=Object.fromEntries(Object.entries(s).filter(([e,s])=>void 0!==s));await p.createDocument(i.id,"reports",a),k(!0),setTimeout(()=>{t()},2e3)}catch(s){e.error("Failed to submit absence report:",s),N("Failed to submit absence report. Please try again.")}finally{b(!1)}},disabled:!M()||f,className:"modal-footer__button modal-footer__button--primary "+(f?"modal-footer__button--loading":""),children:"Submit Report"})]})})]})}):null},Ns=Object.freeze(Object.defineProperty({__proto__:null,UnifiedReportAbsence:ws},Symbol.toStringTag,{value:"Module"})),js="corrective_counselling",ks="counselling_followups",Ss="notifications";class Cs{static async getActiveCounsellingForEmployee(a,t){try{const r=$(R(s,js),F("organizationId","==",t),F("employeeId","==",a),F("status","in",["completed","follow_up_pending"]),P("dateCreated","desc")),i=await W(r),o=[];return i.forEach(e=>{const s=e.data(),a={id:e.id,...s};if(a.followUpDate){const e=new Date(a.followUpDate),s=new Date,t=Math.ceil((e.getTime()-s.getTime())/864e5);t>=-30&&t<=30&&!a.followUpCompleted&&o.push(a)}}),e.success(2097),o}catch(r){return e.error("âŒ Error getting active counselling:",r),[]}}static async getDueFollowUps(a,t){try{const r=$(R(s,js),F("organizationId","==",t),F("managerId","==",a),F("followUpCompleted","==",!1),P("followUpDate","asc")),i=await W(r),o=[],l=new Date;return i.forEach(e=>{const s=e.data(),a={id:e.id,...s};if(a.followUpDate){const e=new Date(a.followUpDate);Math.ceil((e.getTime()-l.getTime())/864e5)<=7&&o.push(a)}}),e.success(3568),o}catch(r){return e.error("âŒ Error getting due follow-ups:",r),[]}}static async createFollowUp(s,a){try{e.success(3983);const t={...a,counsellingId:s,createdDate:y.getServerTimestamp()},r=await v.createDocument(ks,t);return await v.updateDocument(js,s,{followUpCompleted:!0,improvementNoted:a.improvementObserved,lastUpdated:y.getServerTimestamp()}),e.success(4709),r}catch(t){throw e.error("âŒ Error creating follow-up:",t),t}}static async getEmployeeCounsellingSummary(a,t){try{const r=$(R(s,js),F("organizationId","==",t),F("employeeId","==",a),P("dateCreated","desc")),i=await W(r);if(i.empty)return null;const o=[];i.forEach(e=>{const s=e.data();o.push({id:e.id,...s})});const l=o[0],n=o.filter(e=>!e.followUpCompleted&&e.followUpDate).length,c=[...new Set(o.map(e=>e.category))];let d="no_data";if(o.length>=2){const e=o.slice(0,3).filter(e=>e.improvementNoted).length;d=e>=2?"improving":1===e?"stable":"declining"}let m="low";o.length>=5?m="high":o.length>=3&&(m="medium");const u={employeeId:a,employeeName:l.employeeName,totalSessions:o.length,lastSessionDate:l.dateCreated,pendingFollowUps:n,improvementTrend:d,commonCategories:c,escalationRisk:m};return e.success(7051),u}catch(r){return e.error("âŒ Error getting counselling summary:",r),null}}static async createFollowUpNotification(s,a,t){try{const e={userId:s,organizationId:a,type:"counselling_followup_due",title:"Counselling Follow-up Due",message:`Follow-up required for ${t.employeeName} regarding ${t.category}`,data:{counsellingId:t.id,employeeId:t.employeeId,employeeName:t.employeeName,followUpDate:t.followUpDate},read:!1,createdAt:y.getServerTimestamp()};await v.createDocument(Ss,e)}catch(r){e.error("âŒ Error creating follow-up notification:",r)}}static async getFollowUpRecords(a){try{const e=$(R(s,ks),F("counsellingId","==",a),P("createdDate","desc")),t=await W(e),r=[];return t.forEach(e=>{const s=e.data();r.push({id:e.id,...s})}),r}catch(t){return e.error("âŒ Error getting follow-up records:",t),[]}}}const _s=({onSignatureChange:e,label:s,required:t=!1})=>{const r=C.useRef(null),[i,o]=C.useState(!1),[l,n]=C.useState(!1),c=()=>{if(i&&r.current){o(!1);const s=r.current.toDataURL();e(s)}};return _.useEffect(()=>{const e=r.current;if(!e)return;const s=e.getContext("2d");s&&(e.width=e.offsetWidth,e.height=e.offsetHeight,s.strokeStyle="#000",s.lineWidth=2,s.lineCap="round")},[]),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[s," ",t&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-white",children:[a.jsx("canvas",{ref:r,className:"w-full h-24 border border-dashed border-gray-400 rounded cursor-crosshair bg-gray-50",onMouseDown:e=>{const s=r.current;if(!s)return;const a=s.getBoundingClientRect(),t=s.getContext("2d");t&&(o(!0),t.beginPath(),t.moveTo(e.clientX-a.left,e.clientY-a.top))},onMouseMove:e=>{if(!i)return;const s=r.current;if(!s)return;const a=s.getBoundingClientRect(),t=s.getContext("2d");t&&(t.lineTo(e.clientX-a.left,e.clientY-a.top),t.stroke(),n(!0))},onMouseUp:c,onMouseLeave:c}),a.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[a.jsx("p",{className:"text-sm text-gray-500",children:l?"Signature captured":"Click and drag to sign above"}),a.jsxs("button",{type:"button",onClick:()=>{const s=r.current;if(!s)return;const a=s.getContext("2d");a&&(a.clearRect(0,0,s.width,s.height),n(!1),e(""))},className:"text-sm text-red-600 hover:text-red-800 flex items-center gap-1",disabled:!l,children:[a.jsx(Se,{className:"w-4 h-4"}),"Clear"]})]})]})]})},Ds=({counsellingSession:s,onClose:t,onComplete:r})=>{D();const{user:i}=m(),{organization:o}=u(),[l,n]=C.useState(null),[c,d]=C.useState(""),[h,g]=C.useState(""),[x,p]=C.useState("continue_monitoring"),[y,v]=C.useState(""),[f,b]=C.useState(""),[w,N]=C.useState(""),[j,k]=C.useState(""),[S,_]=C.useState(""),[I,E]=C.useState(null),[R,T]=C.useState(!1),[z,L]=C.useState(!1),[A,M]=C.useState(null),[$,F]=C.useState("review"),P=e=>{k(e),e&&F("employee-decision")},W=e=>{E(e),e?T(!0):H()},q=e=>{_(e),e&&H()},H=async()=>{if(i&&i.organizationId)try{L(!0),M(null);const e={followUpDate:(new Date).toISOString(),improvementObserved:l||!1,improvementDetails:c.trim(),additionalConcerns:h.trim(),nextAction:x,nextActionDate:y||void 0,managerNotes:f.trim(),employeeFeedback:w.trim(),createdBy:i.id};await Cs.createFollowUp(s.id,e),F("complete"),setTimeout(()=>{r()},3e3)}catch(a){e.error("âŒ Error submitting follow-up:",a),M("Failed to submit follow-up. Please try again.")}finally{L(!1)}};return"review"===$?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(ee,{className:"w-8 h-8 text-green-600"}),"Counselling Follow-up Review"]}),a.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:a.jsx(O,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Review progress and document outcomes"})]}),A&&a.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-lg flex items-center gap-2",children:[a.jsx(fe,{className:"w-5 h-5 text-red-500"}),a.jsx("p",{className:"text-red-700",children:A})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsxs("h3",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[a.jsx(Ne,{className:"w-5 h-5"}),"Original Counselling Session"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Employee:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:s.employeeName})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Date:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:new Date(s.dateCreated).toLocaleDateString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Category:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:s.category})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Type:"}),a.jsx("span",{className:"ml-2 text-blue-600 capitalize",children:s.counsellingType})]})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Issue:"}),a.jsx("p",{className:"text-blue-600 text-sm mt-1",children:s.issueDescription})]}),s.promisesToPerform.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Promises to Perform:"}),a.jsx("ul",{className:"text-blue-600 text-sm mt-1 space-y-1",children:s.promisesToPerform.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-blue-500",children:"â€¢"}),a.jsxs("span",{children:[e.description," (Due: ",new Date(e.targetDate).toLocaleDateString(),")"]})]},s))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Has the employee shown improvement? *"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{type:"button",onClick:()=>n(!0),className:"px-6 py-3 rounded-lg border-2 transition-all "+(!0===l?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(Q,{className:"w-5 h-5 mx-auto mb-1"}),"Yes, Improvement Noted"]}),a.jsxs("button",{type:"button",onClick:()=>n(!1),className:"px-6 py-3 rounded-lg border-2 transition-all "+(!1===l?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(fe,{className:"w-5 h-5 mx-auto mb-1"}),"No, Concerns Remain"]})]})]}),null!==l&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l?"Improvement Details *":"Ongoing Concerns *"}),a.jsx("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:l?"Describe the specific improvements observed...":"Describe the ongoing concerns or lack of improvement...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/500 characters (minimum 10)"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Concerns or Notes"}),a.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Any additional concerns, observations, or context...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Recommended Next Action *"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>p("continue_monitoring"),className:"p-3 rounded-lg border-2 text-left transition-all "+("continue_monitoring"===x?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(B,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Continue Monitoring"}),a.jsx("div",{className:"text-sm opacity-70",children:"Keep observing progress"})]}),a.jsxs("button",{type:"button",onClick:()=>p("additional_training"),className:"p-3 rounded-lg border-2 text-left transition-all "+("additional_training"===x?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(Ne,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Additional Training"}),a.jsx("div",{className:"text-sm opacity-70",children:"Provide more support"})]}),a.jsxs("button",{type:"button",onClick:()=>p("formal_warning"),className:"p-3 rounded-lg border-2 text-left transition-all "+("formal_warning"===x?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(fe,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Escalate to Formal Warning"}),a.jsx("div",{className:"text-sm opacity-70",children:"Begin formal discipline"})]}),a.jsxs("button",{type:"button",onClick:()=>p("no_further_action"),className:"p-3 rounded-lg border-2 text-left transition-all "+("no_further_action"===x?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(Q,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Close Successfully"}),a.jsx("div",{className:"text-sm opacity-70",children:"Issue resolved"})]})]})]}),"no_further_action"!==x&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Next Review Date *"}),a.jsx("input",{type:"date",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:(new Date).toISOString().split("T")[0],required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Notes *"}),a.jsx("textarea",{value:f,onChange:e=>b(e.target.value),placeholder:"Document your overall assessment and any specific observations...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[f.length,"/500 characters (minimum 10)"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee Feedback"}),a.jsx("textarea",{value:w,onChange:e=>N(e.target.value),placeholder:"Optional feedback from the employee during this review...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[a.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(_e,{className:"w-4 h-4"}),"Cancel"]}),a.jsxs("button",{type:"button",onClick:()=>F("manager-sign"),disabled:!(null!==l&&f.trim().length>=10&&(!1!==l||c.trim().length>=10)&&("no_further_action"===x||y)),className:"px-8 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continue to Signatures",a.jsx(Q,{className:"w-4 h-4"})]})]})]})]})}):"manager-sign"===$?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[a.jsx(je,{className:"w-8 h-8 text-green-600"}),"Manager Signature Required"]}),a.jsx("div",{className:"mb-6",children:a.jsxs("p",{className:"text-gray-700 mb-4",children:["Please sign to confirm this follow-up review with"," ",a.jsx("strong",{children:s.employeeName}),"."]})}),a.jsx(_s,{onSignatureChange:P,label:"Manager Signature",required:!0}),a.jsx("div",{className:"flex justify-between mt-6",children:a.jsx("button",{type:"button",onClick:()=>F("review"),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Review"})})]})})}):"employee-decision"===$?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(U,{className:"w-8 h-8 text-green-600"}),"Employee Acknowledgment"]}),a.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:a.jsx(O,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("p",{className:"text-gray-700 mb-4",children:["Please ask ",a.jsx("strong",{children:s.employeeName})," if they acknowledge this follow-up review and would like to provide their signature."]}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:a.jsxs("p",{className:"text-green-800 text-sm",children:[a.jsx("strong",{children:"Note:"})," Employee signature confirms they participated in this follow-up review."]})})]}),R?a.jsxs("div",{children:[a.jsx(_s,{onSignatureChange:q,label:"Employee Signature"}),a.jsxs("div",{className:"flex justify-between mt-6",children:[a.jsx("button",{type:"button",onClick:()=>T(!1),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Decision"}),a.jsx("button",{type:"button",onClick:()=>H(),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Skip Signature & Submit"})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-gray-700 font-medium",children:"Does the employee consent to sign?"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{onClick:()=>W(!0),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2",children:[a.jsx(je,{className:"w-4 h-4"}),"Yes, employee will sign"]}),a.jsxs("button",{onClick:()=>W(!1),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center gap-2",children:[a.jsx(O,{className:"w-4 h-4"}),"No, proceed without signature"]})]})]})]})})}):"complete"===$?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:a.jsxs("div",{className:"p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6",children:a.jsx(Q,{className:"h-8 w-8 text-green-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Follow-up Review Completed"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["The follow-up review for ",s.employeeName," has been successfully documented and is available to HR for review."]}),a.jsx("button",{onClick:r,className:"w-full px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Return to Dashboard"}),a.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Redirecting automatically..."})]})})}):null},Is=C.memo(({className:s=""})=>{const t=D(),{user:l}=m(),{organization:n,loading:c}=u(),{canCreateWarnings:h,canManageEmployees:g}=f(),{categories:p,employees:y,followUps:v,loading:_,isReady:I}=b({role:"hod"}),E={total:v?.length||0,overdue:v?.filter(e=>new Date(e.dueDate)<new Date).length||0,dueSoon:v?.filter(e=>{const s=new Date(e.dueDate),a=new Date,t=new Date(a.getTime()+2592e5);return s>=a&&s<=t}).length||0};(e=>{const[s,a]=C.useState(window.innerWidth>e),t=C.useCallback(()=>a(window.innerWidth>e),[e]);C.useEffect(()=>(window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)),[t])})(768);const[R,T]=C.useState(!1),[z,L]=C.useState(!1),[A,M]=C.useState(!1),[$,F]=C.useState(!1),[P,W]=C.useState(!1),[U,O]=C.useState(!1),[H,B]=C.useState(null),[V,G]=C.useState([]),[Y,J]=C.useState(!1),[Z,Q]=C.useState(!1),se=y||[],ae=p||[],te=C.useMemo(()=>`${l?.firstName||""} ${l?.lastName||""}`.trim()||"Manager",[l?.firstName,l?.lastName]),ie=C.useMemo(()=>n?.name||"Your Organization",[n?.name]);C.useMemo(()=>0===se.length||0===ae.length?null:{employees:se,categories:ae,currentManagerName:te,organizationName:ie,key:`wizard-${n?.id}-${se.length}-${ae.length}`},[se.length,ae.length,te,ie,n?.id]),C.useEffect(()=>{!c&&p&&p.length>0&&(p.length,se.length)},[c,p,n,se]);const oe=C.useCallback(async()=>{if(h()){if(I&&!_.overall)return 0===ae.length?(e.error("âŒ No warning categories configured"),void alert("Cannot issue warning: No warning categories are configured for this organization.")):0===se.length?(e.warn("âš ï¸ No team members assigned"),void alert("You have no team members assigned to you as a manager.\n\nAs a Department Manager, you can only issue warnings to employees who report directly to you.\n\nPlease contact HR to have employees assigned to your team, or switch to the HR Dashboard view if you have HR permissions.")):void T(!0);e.warn("âš ï¸ Please wait for data to load...")}},[h,I,se.length,ae.length,_]),le=C.useCallback(()=>{T(!1)},[]),ne=C.useCallback(()=>{T(!1)},[]),de=C.useCallback(()=>{L(!0)},[]),me=C.useCallback(()=>{L(!1)},[]),ue=C.useCallback(()=>{M(!0)},[]),he=C.useCallback(()=>{M(!1)},[]),ge=C.useCallback(()=>{F(!0)},[]),xe=C.useCallback(()=>{F(!1)},[]),ye=C.useCallback(e=>{e.id,B(e),O(!0)},[]),ve=C.useCallback(()=>{O(!1),B(null)},[]),fe=C.useCallback(()=>{O(!1),B(null)},[]),be=C.useCallback(async()=>{if(n?.id&&!Y){J(!0);try{let e;if(w()&&N()){e=(await j.getActiveWarningsIndex(n.id,100)).filter(e=>"high"===e.priority).map(e=>({...e.metadata,id:e.id,employeeId:e.employeeId,level:e.metadata.level,employeeName:e.metadata.employeeName}))}else if(w()&&k()){e=(await j.getOrganizationWarnings(n.id,{level:"final_written"},{pageSize:100,orderField:"issueDate",orderDirection:"desc"})).warnings}else e=await x.warnings.getAll(n.id);const s=await x.employees.getAll(n.id),a=e.filter(e=>"final_written"===e.level).map(e=>{const a=s.find(s=>s.id===e.employeeId);return{...e,employeeName:a?.name||`${a?.profile?.firstName||""} ${a?.profile?.lastName||""}`.trim()||"Unknown",employee:a}});a.sort((e,s)=>new Date(s.issueDate).getTime()-new Date(e.issueDate).getTime()),G(a)}catch(s){e.error("Failed to fetch final warning employees:",s)}finally{J(!1)}}},[n?.id]);C.useEffect(()=>{I&&se.length>0&&be()},[I,se.length,n?.id]);const we=[{id:"create-warning",title:"Issue Warning",icon:X,color:"orange",action:oe,enabled:h(),hasAudioRecording:!0},{id:"book-hr-meeting",title:"HR Meeting",icon:De,color:"purple",action:ue,enabled:!0,hasAudioRecording:!1},{id:"report-absence",title:"Report Absence",icon:ke,color:"red",action:ge,enabled:!0,hasAudioRecording:!1},{id:"corrective-counselling",title:"Counselling",icon:Ne,color:"blue",action:de,enabled:!0,hasAudioRecording:!1}].filter(e=>e.enabled);return[{id:"team-performance",title:"Team Performance",description:"Review department performance metrics",icon:K,color:"green",action:()=>t("/team/performance"),enabled:g()},{id:"schedule-review",title:"Schedule Reviews",description:"Plan performance reviews for team members",icon:ee,color:"blue",action:()=>t("/reviews/schedule"),enabled:g()},{id:"team-goals",title:"Team Goals",description:"Set and track overall department objectives",icon:Ie,color:"indigo",action:()=>t("/goals"),enabled:g()}].filter(e=>e.enabled),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:`space-y-4 ${s}`,children:[a.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 mb-3",children:we.map(e=>a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all duration-200 active:scale-95",onClick:e.action,style:{opacity:(_.overall||_.employees)&&"create-warning"===e.id?.5:1,background:"orange"===e.color?"linear-gradient(135deg, var(--color-warning), var(--color-warning))":"purple"===e.color?"linear-gradient(135deg, var(--color-accent), var(--color-accent))":"red"===e.color?"linear-gradient(135deg, var(--color-error), var(--color-error))":(e.color,"linear-gradient(135deg, var(--color-primary), var(--color-primary))"),color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:a.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(e.icon,{className:"w-5 h-5"}),e.hasAudioRecording&&a.jsx(pe,{className:"w-3.5 h-3.5 opacity-80"})]}),a.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:e.title}),(_.overall||_.employees)&&"create-warning"===e.id&&a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"})]})},e.id))}),a.jsx(i,{hover:!0,padding:"none",className:"mb-3 cursor-pointer transition-all duration-200 overflow-hidden active:scale-[0.98]",onClick:()=>W(!0),style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"64px",willChange:"transform"},children:a.jsxs("div",{className:"flex items-center justify-between p-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ce,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium text-sm",children:"Team Members"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[_.employees?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):a.jsx("span",{className:"text-2xl font-bold",children:se.length}),a.jsx(re,{className:"w-4 h-4 opacity-60"})]})]})}),E.total>0&&a.jsxs(i,{padding:"sm",children:[a.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),"Follow-ups Due (",E.due,")"]}),a.jsx("div",{className:"space-y-1",children:v.slice(0,3).map(e=>a.jsxs(o,{variant:"ghost",onClick:()=>ye(e),className:"w-full text-left p-2 text-sm",children:[a.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.employeeName}),a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.sessionType})]},e.id))})]}),V.length>0&&a.jsxs(d,{variant:"error",className:"border-2",children:[a.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>Q(!Z),children:[a.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[a.jsx(X,{className:"w-4 h-4"}),"Final Warnings Watch List (",V.length,")",a.jsx(r,{variant:"error",size:"sm",className:"animate-pulse hidden sm:inline-block",children:"MONITOR CLOSELY"})]}),a.jsx(q,{className:"w-4 h-4 transition-transform "+(Z?"rotate-180":""),style:{color:"var(--color-alert-error-text)"}})]}),Z&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"space-y-1.5 mt-3",children:V.map(e=>{let s,t;s=e.issueDate?.toDate?e.issueDate.toDate():e.issueDate?.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),t=e.expiryDate?.toDate?e.expiryDate.toDate():e.expiryDate?.seconds?new Date(1e3*e.expiryDate.seconds):new Date(e.expiryDate);const r=Math.floor((Date.now()-s.getTime())/864e5),o=Math.floor((t.getTime()-Date.now())/864e5);return a.jsx(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-alert-error-border)"},children:a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",style:{color:"var(--color-alert-error-text)"},children:e.employeeName}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)",opacity:.8},children:[e.category," â€¢ ",r," days ago"]}),a.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-alert-error-text)"},children:["âš ï¸ Next offense requires HR intervention â€¢ Expires in ",o," days"]})]})})},e.id||`${e.employeeId}-${e.categoryId||e.category}-${s.getTime()}`)})}),a.jsx(i,{padding:"sm",className:"mt-3",style:{backgroundColor:"var(--color-alert-error-bg)",opacity:.7},children:a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)"},children:["ðŸ’¡ ",a.jsx("strong",{children:"Tip:"})," Monitor these employees closely. Any new offenses will trigger urgent HR intervention alerts."]})})]})]}),Y&&a.jsx(i,{padding:"md",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:"var(--color-primary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Loading final warnings watch list..."})]})})]}),R&&a.jsx(us,{employees:se,categories:ae,currentManagerName:te,organizationName:ie,onComplete:le,onCancel:ne},"enhanced-warning-wizard"),z&&a.jsx(ps,{isOpen:z,onClose:me}),A&&a.jsx(vs,{isOpen:A,onClose:he}),$&&a.jsx(ws,{isOpen:$,onClose:xe}),U&&H&&a.jsx(Ds,{counsellingSession:H,onClose:ve,onComplete:fe}),P&&a.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:a.jsxs(i,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[a.jsxs("div",{className:"flex items-center justify-between p-6",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Team Management"}),a.jsx(o,{variant:"ghost",size:"sm",onClick:()=>W(!1),children:"Ã—"})]}),a.jsx("div",{className:"overflow-y-auto",children:a.jsx(S,{})})]})})]})});Is.displayName="HODDashboardSection";export{Ds as C,ze as D,hs as E,Is as H,fs as U,xs as a,Ns as b};
