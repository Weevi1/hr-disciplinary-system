import{u as e,j as s,L as r,y as a,x as l}from"./business-owner-dashboard-DdURFj3a.js";import{u as t,r as d}from"./react-vendor-CWjEGAcE.js";import{ah as o,R as n,X as i,o as c,F as x,N as m,at as h,K as g,s as p,U as b,S as u,a0 as j}from"./ui-vendor-ywXYq-A-.js";import"./pdf-vendor-tUwojRr6.js";import"./firebase-vendor-joTZaqfO.js";const y="absence_reports",v=[{id:"full-day",label:"Full Day Absence",icon:"ðŸ ",payrollImpact:!0,color:"red"},{id:"half-day",label:"Half Day Absence",icon:"â°",payrollImpact:!0,color:"orange"},{id:"late-arrival",label:"Late Arrival",icon:"ðŸ•",payrollImpact:!1,color:"yellow"},{id:"early-departure",label:"Early Departure",icon:"ðŸšª",payrollImpact:!1,color:"yellow"},{id:"sick-leave",label:"Sick Leave",icon:"ðŸ¤’",payrollImpact:!0,color:"red"},{id:"personal-leave",label:"Personal Leave",icon:"ðŸ‘¤",payrollImpact:!0,color:"purple"}],N=()=>{const N=t(),{user:f}=e(),[w,R]=d.useState([]),[P,D]=d.useState([]),[k,I]=d.useState(!0),[S,C]=d.useState(null),[A,L]=d.useState(null),[T,z]=d.useState(!1),[F,E]=d.useState(""),[H,M]=d.useState("all"),[U,W]=d.useState("all"),[$,q]=d.useState("all"),[B,K]=d.useState({hrReviewed:!1,hrNotes:"",payrollProcessed:!1}),[O,Y]=d.useState(!1);d.useEffect(()=>{(async()=>{if(f?.organizationId)try{I(!0),C(null),f.organizationId;const e=await a.queryDocuments(y,[{field:"organizationId",operator:"==",value:f.organizationId}],"absenceDate",100);r.success(4088),R(e.reverse()),D(e.reverse())}catch(e){r.error("âŒ Error loading absence reports:",e),C("Failed to load absence reports. Please try again."),R([]),D([])}finally{I(!1)}else I(!1)})()},[f?.organizationId]),d.useEffect(()=>{let e=w;if(F){const s=F.toLowerCase();e=e.filter(e=>e.employeeName.toLowerCase().includes(s)||e.managerName.toLowerCase().includes(s)||e.reason&&e.reason.toLowerCase().includes(s)||e.employeeNumber&&e.employeeNumber.toLowerCase().includes(s))}"all"!==H&&(e=e.filter(e=>e.absenceType===H)),"all"!==U&&("reviewed"===U?e=e.filter(e=>e.hrReviewed):"pending"===U&&(e=e.filter(e=>!e.hrReviewed))),"all"!==$&&("impact"===$?e=e.filter(e=>e.payrollImpact):"no-impact"===$&&(e=e.filter(e=>!e.payrollImpact))),D(e)},[w,F,H,U,$]);const _={total:w.length,unreviewed:w.filter(e=>!e.hrReviewed).length,payrollImpact:w.filter(e=>e.payrollImpact).length,thisWeek:w.filter(e=>{const s=new Date(e.absenceDate),r=new Date;return r.setDate(r.getDate()-7),s>=r}).length};return k?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Absence Reports..."}),s.jsx("p",{className:"text-gray-600",children:"Preparing HR review interface..."})]})}):f?.organizationId?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 p-4",children:s.jsxs("div",{className:"max-w-6xl mx-auto",children:[s.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-700 rounded-2xl p-6 text-white shadow-xl mb-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(o,{className:"w-8 h-8"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Absence Report Review"}),s.jsx("p",{className:"text-orange-100",children:"Review and process employee absences"})]})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",title:"Refresh",children:s.jsx(n,{className:"w-6 h-6"})}),s.jsx("button",{onClick:()=>N("/dashboard"),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",children:s.jsx(i,{className:"w-6 h-6"})})]})]})}),S&&s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(c,{className:"w-5 h-5 text-red-600"}),s.jsx("span",{className:"text-red-800 font-medium",children:"Error"})]}),s.jsx("p",{className:"text-red-700 text-sm mt-1",children:S})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[s.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Reports"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:_.total})]}),s.jsx(x,{className:"w-8 h-8 text-orange-500"})]})}),s.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Pending Review"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:_.unreviewed})]}),s.jsx(m,{className:"w-8 h-8 text-red-500"})]})}),s.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Payroll Impact"}),s.jsx("p",{className:"text-2xl font-bold text-purple-600",children:_.payrollImpact})]}),s.jsx(h,{className:"w-8 h-8 text-purple-500"})]})}),s.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:"This Week"}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:_.thisWeek})]}),s.jsx(g,{className:"w-8 h-8 text-blue-500"})]})})]}),s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsxs("div",{className:"relative",children:[s.jsx(p,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search by employee, manager, or reason...",value:F,onChange:e=>E(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]})}),s.jsx("div",{children:s.jsxs("select",{value:H,onChange:e=>M(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[s.jsx("option",{value:"all",children:"All Types"}),v.map(e=>s.jsxs("option",{value:e.id,children:[e.icon," ",e.label]},e.id))]})}),s.jsx("div",{children:s.jsxs("select",{value:U,onChange:e=>W(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"pending",children:"â³ Pending Review"}),s.jsx("option",{value:"reviewed",children:"âœ… Reviewed"})]})})]})}),s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[s.jsx("div",{className:"p-6 border-b border-gray-200",children:s.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[s.jsx(x,{className:"w-5 h-5 text-orange-600"}),"Absence Reports (",P.length,")"]})}),0===P.length?s.jsxs("div",{className:"p-12 text-center",children:[s.jsx(o,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:0===w.length?"No Absence Reports":"No Matching Reports"}),s.jsx("p",{className:"text-gray-600",children:0===w.length?"No managers have submitted absence reports yet.":"Try adjusting your search or filter criteria."})]}):s.jsx("div",{className:"divide-y divide-gray-200",children:P.map(e=>{const r=v.find(s=>s.id===e.absenceType),a=(e=>{const s=v.find(s=>s.id===e);if(!s)return{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200"};const r={red:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200"},orange:{bg:"bg-orange-100",text:"text-orange-800",border:"border-orange-200"},yellow:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200"},purple:{bg:"bg-purple-100",text:"text-purple-800",border:"border-purple-200"}};return r[s.color]||r.yellow})(e.absenceType);return s.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{className:"w-5 h-5 text-gray-400"}),s.jsx("span",{className:"font-semibold text-gray-900",children:e.employeeName}),e.employeeNumber&&s.jsxs("span",{className:"text-sm text-gray-500",children:["#",e.employeeNumber]})]}),s.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium border ${a.bg} ${a.text} ${a.border}`,children:[r?.icon," ",r?.label]}),e.payrollImpact&&s.jsxs("div",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium flex items-center gap-1",children:[s.jsx(h,{className:"w-3 h-3"}),"Payroll Impact"]}),s.jsx("div",{className:"px-2 py-1 rounded-full text-xs font-medium "+(e.hrReviewed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.hrReviewed?"âœ… Reviewed":"â³ Pending"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-4",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Absence Date:"})," ",new Date(e.absenceDate).toLocaleDateString()]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Reported by:"})," ",e.managerName]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Reported on:"})," ",new Date(e.reportedDate).toLocaleDateString()]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Payroll:"}),s.jsx("span",{className:e.payrollProcessed?"text-green-600":"text-orange-600",children:e.payrollProcessed?" âœ… Processed":" â³ Pending"})]})]}),e.reason&&s.jsxs("div",{className:"mb-4",children:[s.jsx("span",{className:"font-medium text-gray-700",children:"Reason:"}),s.jsxs("p",{className:"text-gray-600 mt-1",children:['"',e.reason,'"']})]}),e.hrNotes&&s.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[s.jsx("span",{className:"font-medium text-gray-700",children:"HR Notes:"}),s.jsx("p",{className:"text-gray-600 mt-1",children:e.hrNotes}),e.hrReviewedAt&&s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Reviewed on ",new Date(e.hrReviewedAt).toLocaleDateString()]})]})]}),s.jsx("div",{className:"flex items-center gap-2 ml-4",children:s.jsxs("button",{onClick:()=>(e=>{L(e),K({hrReviewed:e.hrReviewed,hrNotes:e.hrNotes||"",payrollProcessed:e.payrollProcessed||!1}),z(!0)})(e),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2",children:[s.jsx(u,{className:"w-4 h-4"}),e.hrReviewed?"Update":"Review"]})})]})},e.id)})})]}),T&&A&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>z(!1)}),s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[s.jsx("div",{className:"p-6 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Review Absence Report"}),s.jsx("button",{onClick:()=>z(!1),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:s.jsx(i,{className:"w-5 h-5"})})]})}),s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-semibold text-orange-900 mb-3",children:"Absence Report Details"}),s.jsxs("div",{className:"text-sm text-orange-700 space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Employee:"})," ",A.employeeName]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Manager:"})," ",A.managerName]})]}),s.jsxs("div",{children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Date:"})," ",new Date(A.absenceDate).toLocaleDateString()]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Type:"})," ",v.find(e=>e.id===A.absenceType)?.label]})]})]}),A.reason&&s.jsxs("p",{children:[s.jsx("strong",{children:"Reason:"}),' "',A.reason,'"']}),s.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsx("span",{className:A.payrollImpact?"text-red-700":"text-green-700",children:A.payrollImpact?"Affects payroll calculation":"No payroll impact"})]})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"hrReviewed",checked:B.hrReviewed,onChange:e=>K(s=>({...s,hrReviewed:e.target.checked})),className:"w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),s.jsx("label",{htmlFor:"hrReviewed",className:"text-sm font-medium text-gray-700",children:"Mark as HR Reviewed"})]}),A.payrollImpact&&s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("input",{type:"checkbox",id:"payrollProcessed",checked:B.payrollProcessed,onChange:e=>K(s=>({...s,payrollProcessed:e.target.checked})),className:"w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),s.jsx("label",{htmlFor:"payrollProcessed",className:"text-sm font-medium text-gray-700",children:"Mark as Payroll Processed"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Notes"}),s.jsx("textarea",{value:B.hrNotes,onChange:e=>K(s=>({...s,hrNotes:e.target.value})),placeholder:"Add any HR notes or payroll instructions...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none",rows:4})]})]}),s.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end gap-3",children:[s.jsx("button",{onClick:()=>z(!1),className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(A&&f)try{Y(!0),C(null);const e={hrReviewed:B.hrReviewed,hrNotes:B.hrNotes.trim()||void 0,payrollProcessed:B.payrollProcessed,hrReviewedBy:B.hrReviewed?f.id:void 0,hrReviewedAt:B.hrReviewed?l.getServerTimestamp():void 0,payrollProcessedAt:B.payrollProcessed?l.getServerTimestamp():void 0,updatedAt:l.getServerTimestamp()};await a.updateDocument(y,A.id,e),R(s=>s.map(s=>s.id===A.id?{...s,...e}:s)),z(!1),L(null),r.success(7561)}catch(e){r.error("âŒ Error updating absence report:",e),C("Failed to update absence report. Please try again.")}finally{Y(!1)}},disabled:O,className:"px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2 "+(O?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-600 text-white hover:bg-orange-700"),children:O?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):s.jsxs(s.Fragment,{children:[s.jsx(j,{className:"w-4 h-4"}),"Update Report"]})})]})]})})]})]})}):s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center max-w-md",children:[s.jsx("div",{className:"text-6xl mb-4",children:"âš ï¸"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Organization Not Found"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"You don't seem to be associated with an organization."}),s.jsx("button",{onClick:()=>N("/dashboard"),className:"bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors",children:"Return to Dashboard"})]})})};export{N as AbsenceReportReview};
