const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PDFGenerationService-CdmFA2Eb.js","assets/pdf-vendor-tUwojRr6.js","assets/business-owner-dashboard-SKPFtfOP.js","assets/react-vendor-CWjEGAcE.js","assets/firebase-vendor-BQc9GSQK.js","assets/ui-vendor-CbYg3h9k.js"])))=>i.map(i=>d[i]);
import{h as e,c as s,L as a,j as t,Z as l,J as r,i,f as n,u as d,t as o,w as c,N as m,A as x}from"./business-owner-dashboard-SKPFtfOP.js";import{r as p}from"./react-vendor-CWjEGAcE.js";import{a as g}from"./pdf-vendor-tUwojRr6.js";import{t as u,E as h}from"./hr-dashboard-BLjPd_cf.js";import{a4 as b,a0 as y,M as f,X as v,D as j,L as N,Z as w,a as D,_ as C,b as k,aG as S,z as A,aH as P,a1 as F,aI as E,aJ as I,w as W,a6 as R,F as L,U,I as _,x as O,ae as $,B as M,aj as T,aK as q,i as z,aL as B,at as G,R as H,k as V,A as Y,h as J,N as Z,e as K,s as Q,t as X,g as ee}from"./ui-vendor-CbYg3h9k.js";import{D as se}from"./hod-dashboard-BDIua1PT.js";import"./firebase-vendor-BQc9GSQK.js";import"./warning-components-CctW0ZFw.js";const ae={email:{icon:f,name:"Email",color:"blue",requiresProof:!0,instructions:["Send the warning document via email","Take a screenshot of the sent email","Include timestamp and recipient email visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Chrome: Press Ctrl + Shift + Alt + 3"]},whatsapp:{icon:y,name:"WhatsApp Business",color:"green",requiresProof:!0,instructions:["Send the warning document via WhatsApp Business","Wait for delivery confirmation (double blue ticks)","Take a screenshot showing the sent message","Include timestamp and delivery status visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Phone: Use screenshot function (varies by device)"]},printed:{icon:b,name:"Print & Hand Delivery",color:"purple",requiresProof:!1,instructions:["Print the warning document","Hand deliver to the employee","Get employee acknowledgment signature on physical copy","File the signed copy in employee records","Confirm delivery completion below"]}},te=({isOpen:r,onClose:i,warningId:n,employeeName:d,employeeEmail:o,deliveryMethod:c,warningData:m,onDeliveryConfirmed:x})=>{const{organization:h}=e(),[b,y]=p.useState(null),[E,I]=p.useState(null),[W,R]=p.useState(!1),[L,U]=p.useState(!1),[_,O]=p.useState(null),[$,M]=p.useState(!1),T=p.useRef(null);s(r);const q=ae[c],z=`Warning Notice - ${m?.category||"Disciplinary Action"}`,B=`Dear ${d},\n\nPlease find attached your formal warning notice regarding ${m?.category||"the recent incident"}.\n\nThis document outlines:\n- The incident details and circumstances\n- The warning level issued\n- Your rights and the next steps\n- The validity period of this warning\n\nPlease review the attached PDF carefully. If you have any questions or wish to discuss this matter, please contact your HR department.\n\nThis is an official HR document and should be kept for your records.\n\nBest regards,\n${h?.companyName||"HR Department"}`,G=o?`mailto:${o}?subject=${encodeURIComponent(z)}&body=${encodeURIComponent(B)}`:"#",H=p.useCallback(e=>{const s=e.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/"))return void O("Please select an image file (PNG, JPG, etc.)");if(s.size>5242880)return void O("Image must be less than 5MB");O(null),y(s);const a=new FileReader;a.onload=e=>{I(e.target?.result)},a.readAsDataURL(s)},[]),V=p.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),Y=p.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=e.dataTransfer.files;if(s.length>0){const e=s[0];if(e.type.startsWith("image/")){H({target:{files:[e]}})}}},[H]),J=p.useCallback(async()=>{if(!q.requiresProof||b){R(!0),O(null);try{await x({warningId:n,deliveryMethod:c,deliveredAt:new Date,proofImage:b||void 0})}catch(e){O(e instanceof Error?e.message:"Failed to confirm delivery")}finally{R(!1)}}else O("Please upload proof of delivery screenshot")},[q.requiresProof,b,x,n,c]),Z=p.useCallback(()=>{y(null),I(null),T.current&&(T.current.value="")},[]),K=p.useCallback(async()=>{try{await navigator.clipboard.writeText(B),M(!0),setTimeout(()=>M(!1),2e3)}catch(e){a.error("Failed to copy to clipboard:",e)}},[B]),Q=p.useCallback(async()=>{if(m&&h){U(!0),O(null);try{const e={firstName:m.employeeName?.split(" ")[0]||"Unknown",lastName:m.employeeName?.split(" ").slice(1).join(" ")||"Employee",employeeNumber:m.employeeNumber||"N/A",department:m.department||"Unknown",position:m.position||"Unknown",email:o||""},s=u(m,e,h);s.warningId,s.employee.firstName,s.employee.lastName,s.category;const{PDFGenerationService:t}=await g(async()=>{const{PDFGenerationService:e}=await import("./PDFGenerationService-CdmFA2Eb.js");return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5])),l=await t.generateWarningPDF(s),r=(new Date).toISOString().split("T")[0],i=`Warning_${(m.category||"Document").replace(/\s+/g,"_")}_${d.replace(/\s+/g,"_")}_${r}.pdf`,n=URL.createObjectURL(l),c=document.createElement("a");c.href=n,c.download=i,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(n),a.success("âœ… PDF downloaded:",i)}catch(e){a.error("âŒ PDF download failed:",e),O(e instanceof Error?e.message:"Failed to download PDF")}finally{U(!1)}}else O("Missing warning data or organization information")},[m,h,n,d,o]);if(!r)return null;const X=q.icon;return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:l.modalNested1},children:t.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[t.jsx("div",{className:`bg-gradient-to-r from-${q.color}-600 to-${q.color}-700 p-6 text-white`,children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:t.jsx(X,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold",children:"Confirm Delivery"}),t.jsxs("p",{className:"text-sm opacity-90",children:[q.name," delivery for ",d]})]})]}),t.jsx("button",{onClick:i,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:t.jsx(v,{className:"w-5 h-5"})})]})}),t.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"ðŸ“‹ Step-by-Step Instructions"}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:t.jsxs("ol",{className:"space-y-2",children:[t.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:"1"}),t.jsx("span",{className:"text-gray-700",children:"Download the warning PDF document using the button below"})]}),t.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:"2"}),t.jsx("span",{className:"text-gray-700",children:"Copy the email message text below"})]}),t.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:"3"}),t.jsx("span",{className:"text-gray-700",children:'Click "Open Email" to launch your email client with pre-filled message'})]}),t.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:"4"}),t.jsx("span",{className:"text-gray-700",children:"Attach the downloaded PDF to your email and send"})]}),t.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:"5"}),t.jsx("span",{className:"text-gray-700",children:"Take a screenshot of the sent email (timestamp and recipient visible)"})]}),t.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[t.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:"6"}),t.jsx("span",{className:"text-gray-700",children:"Upload the screenshot as proof of delivery below"})]})]})})]}),"email"===c&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(j,{className:"w-4 h-4 text-blue-600"}),"Step 1: Download Warning PDF"]}),t.jsx("button",{onClick:Q,disabled:L,className:"w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:L?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"w-5 h-5 animate-spin"}),"Generating PDF..."]}):t.jsxs(t.Fragment,{children:[t.jsx(j,{className:"w-5 h-5"}),"Download Warning PDF"]})})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(w,{className:"w-4 h-4 text-blue-600"}),"Step 2: Copy Email Message"]}),t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[t.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[t.jsx("span",{className:"text-xs font-semibold text-gray-600",children:"EMAIL SUBJECT:"}),t.jsx("button",{onClick:K,className:"text-xs flex items-center gap-1 text-blue-600 hover:text-blue-700 font-medium",children:$?t.jsxs(t.Fragment,{children:[t.jsx(D,{className:"w-3 h-3"}),"Copied!"]}):t.jsxs(t.Fragment,{children:[t.jsx(w,{className:"w-3 h-3"}),"Copy Message"]})})]}),t.jsx("div",{className:"bg-white border border-gray-300 rounded p-2 mb-3",children:t.jsx("p",{className:"text-sm font-medium text-gray-900",children:z})}),t.jsx("span",{className:"text-xs font-semibold text-gray-600 block mb-2",children:"EMAIL BODY:"}),t.jsx("div",{className:"bg-white border border-gray-300 rounded p-3 max-h-48 overflow-y-auto",children:t.jsx("pre",{className:"text-sm text-gray-700 whitespace-pre-wrap font-sans",children:B})})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(C,{className:"w-4 h-4 text-blue-600"}),"Step 3: Open Your Email Client"]}),o?t.jsxs("a",{href:G,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-6 py-3 rounded-lg font-semibold transition-all",children:[t.jsx(f,{className:"w-5 h-5"}),"Open Email to ",o]}):t.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-center gap-2 text-amber-700",children:[t.jsx(k,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:"Employee email not available. Please send email manually."})]})})]})]}),q.requiresProof&&"email"===c&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(S,{className:"w-4 h-4 text-gray-600"}),"Step 5: Screenshot Instructions"]}),t.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:q.screenshotTips?.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[t.jsx("kbd",{className:"bg-gray-200 px-2 py-1 rounded text-xs font-mono",children:e.split(": ")[1]}),t.jsx("span",{className:"text-xs",children:e.split(": ")[0]})]},s))})})]}),q.requiresProof&&t.jsxs("div",{className:"mb-6",children:[t.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(A,{className:"w-4 h-4 text-blue-600"}),"email"===c?"Step 6: Upload Proof of Delivery":"Upload Proof of Delivery"]}),b?t.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-4",children:[E&&t.jsx("img",{src:E,alt:"Proof of delivery",className:"w-24 h-24 object-cover rounded-lg border"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900",children:b.name}),t.jsxs("p",{className:"text-sm text-gray-500",children:[(b.size/1024).toFixed(1)," KB"]})]}),t.jsx("button",{onClick:Z,className:"text-red-600 hover:text-red-700 p-1",children:t.jsx(v,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[t.jsx(D,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm text-green-700",children:"Ready to upload"})]})]})]})}):t.jsxs("div",{onDragOver:V,onDrop:Y,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onClick:()=>T.current?.click(),children:[t.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-600 mb-2",children:"Drop screenshot here or click to browse"}),t.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG up to 5MB"}),t.jsx("input",{ref:T,type:"file",accept:"image/*",onChange:H,className:"hidden"})]})]}),_&&t.jsx("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[t.jsx(k,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:_})]})}),t.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[t.jsx("button",{onClick:i,disabled:W,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:J,disabled:W||q.requiresProof&&!b,className:`flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-${q.color}-600 to-${q.color}-700 hover:from-${q.color}-700 hover:to-${q.color}-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:W?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"w-4 h-4 animate-spin"}),"Confirming..."]}):t.jsxs(t.Fragment,{children:[t.jsx(F,{className:"w-4 h-4"}),"Confirm Delivery"]})})]})]})]})})},le=({isOpen:e,onClose:a,onMethodSelected:d,employeeRequestedMethod:o,employeeName:c,employeeEmail:m,employeePhone:x})=>{const[g,u]=p.useState(null);s(e);const{containerRef:h,ariaProps:j}=r({isOpen:e,onClose:a,titleId:"delivery-method-title",descriptionId:"delivery-method-description"}),N=[{id:"email",name:"Email",icon:f,description:"Send PDF via email client",available:!!m,unavailableReason:m?void 0:"No email address on file",colorClass:"text-blue-600",bgClass:"bg-blue-50"},{id:"whatsapp",name:"WhatsApp",icon:y,description:"Send via WhatsApp Web",available:!!x,unavailableReason:x?void 0:"No phone number on file",colorClass:"text-green-600",bgClass:"bg-green-50"},{id:"printed",name:"Print & Deliver",icon:b,description:"Print and hand deliver",available:!0,colorClass:"text-purple-600",bgClass:"bg-purple-50"}],w=()=>{u(null),a()},C=e=>{if(!e)return"Not specified";return{email:"Email",whatsapp:"WhatsApp",printed:"Print & Deliver"}[e]};return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:l.modalNested1},children:t.jsxs("div",{ref:h,...j,className:"bg-white rounded-2xl max-w-3xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[t.jsx("div",{className:"p-6 border-b flex-shrink-0",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{id:"delivery-method-title",className:"text-2xl font-bold text-gray-900 mb-1",children:"Select Delivery Method"}),t.jsxs("p",{id:"delivery-method-description",className:"text-sm text-gray-600",children:["Choose how to deliver the warning to ",t.jsx("span",{className:"font-semibold",children:c})]})]}),t.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close delivery method selection modal",children:t.jsx(v,{className:"w-5 h-5 text-gray-500"})})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 min-h-0",children:[o&&t.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-xl p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:t.jsx(E,{className:"w-5 h-5 text-blue-600 fill-blue-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h3",{className:"text-sm font-bold text-gray-900",children:"Employee's Preference"}),t.jsx(i,{variant:"info",size:"xs",children:"REQUESTED"})]}),t.jsxs("p",{className:"text-sm text-gray-700",children:["The employee asked to receive this warning via"," ",t.jsx("span",{className:"font-bold text-blue-700",children:C(o)})]}),t.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"You can choose a different method if their contact details are missing or incorrect"})]})]})}),t.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-200",children:[t.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Employee Contact Details"}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(I,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-gray-600 min-w-[60px]",children:"Email:"}),m?t.jsx("span",{className:"font-medium text-gray-900",children:m}):t.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[t.jsx(k,{className:"w-3 h-3"}),"Not available"]})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx(W,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-gray-600 min-w-[60px]",children:"Phone:"}),x?t.jsx("span",{className:"font-medium text-gray-900",children:x}):t.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[t.jsx(k,{className:"w-3 h-3"}),"Not available"]})]})]})]}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"Choose Delivery Method"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:N.map(e=>{const s=e.icon,a=g===e.id,l=o===e.id;return t.jsx("button",{onClick:()=>{return e.available&&(s=e.id,void u(s));var s},disabled:!e.available,className:`\n                      relative p-4 rounded-xl border-2 transition-all text-left\n                      ${a?"border-blue-500 bg-blue-50 shadow-md":e.available?"border-gray-200 bg-white hover:border-gray-300 hover:shadow-sm":"border-gray-200 bg-gray-100 cursor-not-allowed"}\n                    `,children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:`p-3 rounded-lg ${e.bgClass} flex-shrink-0`,children:t.jsx(s,{className:`w-6 h-6 ${e.available?e.colorClass:"text-gray-400"}`})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h4",{className:"font-semibold text-base "+(e.available?"text-gray-900":"text-gray-500"),children:e.name}),l&&t.jsx(i,{variant:"success",size:"xs",children:"REQUESTED"})]}),t.jsx("p",{className:"text-sm "+(e.available?"text-gray-600":"text-gray-500"),children:e.description}),!e.available&&e.unavailableReason&&t.jsxs("div",{className:"mt-2 flex items-center gap-1.5 text-xs text-red-600",children:[t.jsx(k,{className:"w-3 h-3"}),t.jsx("span",{children:e.unavailableReason})]})]}),a&&t.jsx("div",{className:"flex-shrink-0",children:t.jsx(D,{className:"w-6 h-6 text-blue-600 fill-blue-50"})})]})},e.id)})})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:t.jsxs("p",{className:"text-xs text-blue-800",children:[t.jsx("strong",{children:"Note:"})," After selecting a method, you'll be guided through a step-by-step delivery process with pre-written templates."]})})]}),t.jsx("div",{className:"p-6 border-t bg-gray-50 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsx(n,{variant:"secondary",onClick:w,size:"lg",children:"Cancel"}),t.jsx(n,{variant:"primary",onClick:()=>{g&&d(g)},disabled:!g,size:"lg",className:"flex items-center gap-2",children:g?t.jsxs(t.Fragment,{children:["Proceed with ",C(g),t.jsx(R,{className:"w-4 h-4"})]}):"Select a method to continue"})]})})]})}):null},re=[{value:"procedural_unfair",label:"Procedural Unfairness",description:"The disciplinary process was not followed correctly"},{value:"substantive_unfair",label:"Substantive Unfairness",description:"The warning was not justified by the facts"},{value:"bias_prejudice",label:"Bias or Prejudice",description:"The decision was influenced by bias or unfair treatment"},{value:"insufficient_evidence",label:"Insufficient Evidence",description:"Not enough evidence to support the warning"},{value:"inconsistent_treatment",label:"Inconsistent Treatment",description:"Others were treated differently for similar conduct"},{value:"other",label:"Other Grounds",description:"Different reason (explain in details below)"}],ie=({isOpen:e,onClose:a,warning:i,onAppealSubmit:n})=>{const[d,o]=p.useState(""),[c,m]=p.useState(""),[x,g]=p.useState(""),[u,h]=p.useState(!1),[b,y]=p.useState(null);s(e);const{containerRef:f,ariaProps:j}=r({isOpen:e,onClose:a,titleId:"appeal-modal-title",descriptionId:"appeal-modal-description"}),w=i.issueDate?.seconds?new Date(1e3*i.issueDate.seconds):new Date(i.issueDate),C=new Date(w);C.setDate(C.getDate()+30);const S=p.useCallback(async()=>{if(d)if(c.trim())if(x.trim()){h(!0),y(null);try{await n({warningId:i.id,grounds:d,additionalDetails:c.trim(),requestedOutcome:x.trim()})}catch(e){y(e instanceof Error?e.message:"Failed to submit appeal")}finally{h(!1)}}else y("Please specify what outcome you are requesting");else y("Please provide details explaining your appeal");else y("Please select grounds for your appeal")},[d,c,x,n,i.id]);return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:l.modal},children:t.jsxs("div",{ref:f,...j,className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[t.jsx("div",{className:"bg-gradient-to-r from-amber-600 to-orange-700 p-6 text-white flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:t.jsx(L,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h2",{id:"appeal-modal-title",className:"text-xl font-bold",children:"Appeal Disciplinary Warning"}),t.jsx("p",{id:"appeal-modal-description",className:"text-sm opacity-90",children:"Submit formal appeal as per Labour Relations Act"})]})]}),t.jsx("button",{onClick:a,disabled:u,className:"p-2 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50","aria-label":"Close appeal modal",children:t.jsx(v,{className:"w-5 h-5"})})]})}),t.jsxs("div",{className:"p-6 flex-1 overflow-y-auto min-h-0",children:[t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[t.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(U,{className:"w-4 h-4"}),"Warning Details"]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Employee:"}),t.jsx("div",{className:"font-medium",children:i.employeeName})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Warning Level:"}),t.jsx("div",{className:"font-medium capitalize",children:i.level.replace("_"," ")})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Category:"}),t.jsx("div",{className:"font-medium",children:i.category})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),t.jsx("div",{className:"font-medium",children:w.toLocaleDateString()})]})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("span",{className:"text-gray-600 text-sm",children:"Description:"}),t.jsx("div",{className:"text-sm mt-1 p-2 bg-white rounded border",children:i.description})]})]}),t.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(_,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"text-sm",children:[t.jsx("p",{className:"text-blue-800 font-medium mb-2",children:"Your Appeal Rights"}),t.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs",children:[t.jsxs("li",{children:["â€¢ Appeals must be submitted within ",t.jsx("strong",{children:"30 days"})," of the warning (deadline: ",C.toLocaleDateString(),")"]}),t.jsx("li",{children:"â€¢ You have the right to fair treatment under the Labour Relations Act"}),t.jsx("li",{children:"â€¢ All internal procedures must be exhausted before CCMA referral"}),t.jsx("li",{children:"â€¢ You may be assisted by a shop steward or fellow employee"})]})]})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Grounds for Appeal *"}),t.jsx("div",{className:"space-y-2",children:re.map(e=>t.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[t.jsx("input",{type:"radio",name:"appealGrounds",value:e.value,checked:d===e.value,onChange:e=>o(e.target.value),className:"mt-1"}),t.jsxs("div",{children:[t.jsx("div",{className:"font-medium text-sm text-gray-900",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600",children:e.description})]})]},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Appeal Details *"}),t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Explain in detail why you believe the warning is unfair and what evidence supports your appeal."}),t.jsx("textarea",{value:c,onChange:e=>m(e.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"Provide specific facts, dates, witnesses, and any other relevant information that supports your appeal..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Requested Outcome *"}),t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Specify what you would like to happen if your appeal is successful."}),t.jsx("textarea",{value:x,onChange:e=>g(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"E.g., 'Remove warning from my record', 'Reduce warning level', 'Replace with verbal counselling', etc."})]})]}),b&&t.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[t.jsx(k,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm font-medium",children:b})]})})]}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[t.jsx(O,{className:"w-4 h-4"}),t.jsxs("span",{children:["Appeal deadline: ",C.toLocaleDateString()]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:a,disabled:u,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),t.jsx("button",{onClick:S,disabled:u||!d||!c.trim()||!x.trim(),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-600 to-orange-700 hover:from-amber-700 hover:to-orange-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:u?t.jsxs(t.Fragment,{children:[t.jsx(N,{className:"w-4 h-4 animate-spin"}),"Submitting Appeal..."]}):t.jsxs(t.Fragment,{children:[t.jsx(D,{className:"w-4 h-4"}),"Submit Appeal"]})})]})]})]})}):null},ne=[{value:"upheld",label:"Uphold Warning",icon:z,color:"text-green-600",bgColor:"bg-green-50",description:"Warning is justified and remains unchanged"},{value:"reduced",label:"Reduce Warning Level",icon:B,color:"text-orange-600",bgColor:"bg-orange-50",description:"Warning is justified but level should be reduced"},{value:"modified",label:"Modify Warning",icon:G,color:"text-blue-600",bgColor:"bg-blue-50",description:"Warning content needs modification"},{value:"overturned",label:"Overturn Warning",icon:H,color:"text-red-600",bgColor:"bg-red-50",description:"Warning is not justified and should be removed"}],de=[{value:"counselling",label:"Counselling",severity:1},{value:"verbal",label:"Verbal Warning",severity:2},{value:"first_written",label:"First Written Warning",severity:3},{value:"second_written",label:"Second Written Warning",severity:4},{value:"final_written",label:"Final Written Warning",severity:5}],oe={procedural_unfair:"Procedural Unfairness",substantive_unfair:"Substantive Unfairness",bias_prejudice:"Bias or Prejudice",insufficient_evidence:"Insufficient Evidence",inconsistent_treatment:"Inconsistent Treatment",other:"Other Grounds"},ce=({isOpen:e,onClose:i,warning:n,onDecisionSubmit:d})=>{const[o,c]=p.useState(""),[m,x]=p.useState(""),[g,u]=p.useState(""),[h,b]=p.useState(n.level),[y,f]=p.useState(n.description),[j,N]=p.useState(!1),[w,D]=p.useState(""),[C,k]=p.useState(!1);s(e);const{containerRef:S,ariaProps:A}=r({isOpen:e,onClose:i,titleId:"appeal-review-title",descriptionId:"appeal-review-description"}),P=e=>{if(!e)return"Unknown";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})},F=p.useCallback(async()=>{if(o&&m.trim()){k(!0);try{await d({warningId:n.id,decision:o,reasoning:m.trim(),newLevel:"reduced"===o||"modified"===o?h:void 0,newDescription:"modified"===o?y:void 0,hrNotes:g.trim(),followUpRequired:j,followUpDate:j&&w?new Date(w):void 0}),i()}catch(e){a.error("Failed to submit appeal decision:",e),alert("Failed to submit decision. Please try again.")}finally{k(!1)}}else alert("Please select a decision and provide reasoning.")},[o,m,g,h,y,j,w,n.id,d,i]),E=de.find(e=>e.value===n.level)?.severity||0,I=de.filter(e=>e.severity<E);return e?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:l.modal},children:t.jsxs("div",{ref:S,...A,className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:t.jsx($,{className:"w-6 h-6 text-purple-600"})}),t.jsxs("div",{children:[t.jsx("h2",{id:"appeal-review-title",className:"text-xl font-semibold text-gray-900",children:"Appeal Review"}),t.jsx("p",{id:"appeal-review-description",className:"text-sm text-gray-600",children:"Review and decide on employee appeal"})]})]}),t.jsx("button",{onClick:i,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close appeal review modal",children:t.jsx(v,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 min-h-0",children:[t.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(L,{className:"w-5 h-5 text-gray-600"}),"Original Warning Details"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(U,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium",children:"Employee:"}),t.jsxs("span",{className:"text-sm",children:[n.employeeName," (",n.employeeNumber,")"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(M,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium",children:"Department:"}),t.jsx("span",{className:"text-sm",children:n.department})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(O,{className:"w-4 h-4 text-gray-500"}),t.jsx("span",{className:"text-sm font-medium",children:"Issue Date:"}),t.jsx("span",{className:"text-sm",children:P(n.issueDate)})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium",children:"Category:"}),t.jsx("span",{className:"text-sm ml-2",children:n.category})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium",children:"Level:"}),t.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full "+("final_written"===n.level?"bg-red-100 text-red-800":"second_written"===n.level?"bg-orange-100 text-orange-800":"first_written"===n.level?"bg-yellow-100 text-yellow-800":"verbal"===n.level?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:de.find(e=>e.value===n.level)?.label||n.level})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium",children:"Description:"}),t.jsx("p",{className:"text-sm mt-1 text-gray-700",children:n.description})]})]})]})]}),n.appealDetails&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[t.jsx(T,{className:"w-5 h-5 text-blue-600"}),"Employee's Appeal"]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Appeal Grounds:"}),t.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:oe[n.appealDetails.grounds]||n.appealDetails.grounds})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee's Statement:"}),t.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:n.appealDetails.additionalDetails})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Outcome:"}),t.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:n.appealDetails.requestedOutcome})]}),t.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[t.jsxs("span",{children:["Submitted: ",P(n.appealDetails.submittedDate)]}),t.jsxs("span",{children:["By: ",n.appealDetails.submittedBy]})]})]})]}),t.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[t.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[t.jsx(q,{className:"w-5 h-5 text-gray-600"}),"HR Decision"]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:ne.map(e=>{const s=e.icon;return t.jsx("button",{onClick:()=>c(e.value),className:"p-4 rounded-lg border-2 transition-all "+(o===e.value?`border-purple-500 ${e.bgColor}`:"border-gray-200 hover:border-gray-300"),children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(s,{className:`w-5 h-5 ${e.color}`}),t.jsxs("div",{className:"text-left",children:[t.jsx("div",{className:"font-medium text-sm",children:e.label}),t.jsx("div",{className:"text-xs text-gray-600",children:e.description})]})]})},e.value)})}),("reduced"===o||"modified"===o)&&t.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"reduced"===o?"Reduce to Level:":"New Warning Level:"}),t.jsx("select",{value:h,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:"reduced"===o?I.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value)):de.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),"modified"===o&&t.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modified Warning Description:"}),t.jsx("textarea",{value:y,onChange:e=>f(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Enter the modified warning description..."})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t.jsx("span",{className:"text-red-500",children:"*"})," Decision Reasoning (Legal Documentation)"]}),t.jsx("textarea",{value:m,onChange:e=>x(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Provide detailed reasoning for your decision. This will be part of the legal record and may be reviewed by labor courts or CCMA...",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Internal Notes (Optional)"}),t.jsx("textarea",{value:g,onChange:e=>u(e.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Internal notes for HR records (not shared with employee)..."})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:j,onChange:e=>N(e.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),t.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Follow-up Required"})]}),j&&t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date:"}),t.jsx("input",{type:"date",value:w,onChange:e=>D(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]})]}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[t.jsx(_,{className:"w-4 h-4"}),t.jsx("span",{children:"This decision will be automatically documented and employee will be notified"})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),t.jsx("button",{onClick:F,disabled:!o||!m.trim()||C,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors flex items-center gap-2",children:C?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(V,{className:"w-4 h-4"}),"Submit Decision"]})})]})]})]})}):null},me=(e,s="Unknown")=>null==e?s:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":e instanceof Date?e.toLocaleDateString():"object"==typeof e?e.name?String(e.name):e.title?String(e.title):e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:s:String(e),xe=e=>e?e instanceof Date?e:e.seconds?new Date(1e3*e.seconds):new Date(e):new Date,pe=e=>{if(!e.issueDate)return!1;const s=xe(e.issueDate),a=new Date(s);a.setDate(a.getDate()+30);return new Date<=a},ge=({organizationId:e,onClose:s,PDFGenerationService:l,DataService:r,canTakeAction:i=!1,userRole:n="viewer",initialEmployeeFilter:g,selectedWarning:u,showDetails:b,onViewDetails:y,onCloseDetails:f,onWarningUpdated:j})=>{const{user:N,organization:w}=d(),C=e||w?.id,[S,A]=p.useState([]),[P,F]=p.useState([]),[E,I]=p.useState([]),[W,R]=p.useState(!0),[U,_]=p.useState(null),[O,M]=p.useState(1),[T,q]=p.useState(g?.name||""),[B,G]=p.useState("all"),[V,ae]=p.useState("all"),[re,ne]=p.useState("all"),[de,oe]=p.useState("date"),[ge,ue]=p.useState("desc"),[he,be]=p.useState(null),[ye,fe]=p.useState(!1),[ve,je]=p.useState(!1),[Ne,we]=p.useState(!1),[De,Ce]=p.useState(null),[ke,Se]=p.useState(!1),[Ae,Pe]=p.useState(null),[Fe,Ee]=p.useState(!1),[Ie,We]=p.useState({}),[Re,Le]=p.useState(!1),[Ue,_e]=p.useState(null),[Oe,$e]=p.useState(!1),[Me,Te]=p.useState(null),[qe,ze]=p.useState("warnings"),Be=p.useCallback(async()=>{if(!C)return a.warn("No organization ID available for loading warnings"),void R(!1);try{let e;if(R(!0),_(null),o())if(c()){e=(await m.getOrganizationWarnings(C,{},{pageSize:500,orderField:"issueDate",orderDirection:"desc"})).warnings,e.length}else e=await x.warnings.getAll(C);else e=await x.warnings.getAll(C),e.length,e.map(e=>`${e.employeeName}: id="${e.id}"`);const s=e.filter(e=>!e.isArchived&&"expired"!==e.status&&"overturned"!==e.status),t=e.filter(e=>"expired"===e.status||"overturned"===e.status),l=s.sort((e,s)=>new Date(s.createdAt||0).getTime()-new Date(e.createdAt||0).getTime()),r=t.sort((e,s)=>new Date(s.appealDecisionDate||s.updatedAt||0).getTime()-new Date(e.appealDecisionDate||e.updatedAt||0).getTime());l.length,r.length,l.map(e=>`${e.employeeName}: id="${e.id}"`),A(l),F(l),I(r),a.success(`ðŸ“Š Loaded ${l.length} active warnings, ${r.length} archived (${o()?"NESTED":"SHARDED"} structure)`)}catch(e){a.error("âŒ Failed to load warnings:",e);const s=e instanceof Error?e.message:"Unknown error";_(`Failed to load warnings: ${s}`)}finally{R(!1)}},[C]);p.useEffect(()=>{C?Be():R(!1)},[C,Be]),p.useEffect(()=>{let e=[...S];if(T){const s=T.toLowerCase();e=e.filter(e=>e.employeeName?.toLowerCase().includes(s)||e.employeeNumber?.toLowerCase().includes(s)||e.category?.toLowerCase().includes(s)||e.description?.toLowerCase().includes(s))}"all"!==B&&(e=e.filter(e=>e.status===B)),"all"!==V&&(e=e.filter(e=>e.level===V)),"all"!==re&&(e=e.filter(e=>e.department===re)),e.sort((e,s)=>{let a,t;switch(de){case"employee":a=e.employeeName,t=s.employeeName;break;case"level":a=e.level,t=s.level;break;case"status":a=e.status||"",t=s.status||"";break;default:a=new Date(e.createdAt||0).getTime(),t=new Date(s.createdAt||0).getTime()}return a<t?"asc"===ge?-1:1:a>t?"asc"===ge?1:-1:0}),F(e),M(1)},[S,T,B,V,re,de,ge]);const Ge=p.useMemo(()=>{const e=new Set(S.map(e=>e.department).filter(e=>e));return Array.from(e).sort()},[S]),He=p.useMemo(()=>{const e=10*(O-1),s=e+10,a=P.slice(e,s);return a.map(e=>`${e.employeeName}: id="${e.id}"`),a},[P,O]),Ve=Math.ceil(P.length/10),Ye=p.useCallback(e=>{e.id,y?y(e):(be(e),fe(!0))},[y]);p.useCallback(()=>{f?f():(fe(!1),be(null))},[f]);const Je=p.useCallback(async e=>{try{if(R(!0),!e.warningId)throw new Error("Warning ID is missing. Please try again.");if(!C)throw new Error("Organization ID is missing. Please try again.");e.warningId,await x.warnings.update(e.warningId,{appealSubmitted:!0,appealDate:new Date,status:"appealed",appealDetails:{grounds:e.grounds,details:e.additionalDetails,requestedOutcome:e.requestedOutcome,submittedAt:new Date,submittedBy:N?.email||"Employee"}},C),a.success(`Legal appeal submitted for warning ${e.warningId}`),await Be(),Le(!1),_e(null),alert("Appeal submitted successfully. HR will review your appeal within 5 working days as per company policy.")}catch(s){throw a.error("Failed to submit appeal:",s),new Error("Failed to submit appeal. Please try again.")}finally{R(!1)}},[Be,N]);p.useCallback(async(e,s)=>{try{R(!0),await x.warnings.update(e,{status:"overturned"===s?"expired":"acknowledged",appealOutcome:s,appealDate:new Date},C),a.success(`Appeal ${s} for warning ${e}`),await Be()}catch(t){a.error("Failed to process appeal:",t),_("Failed to process appeal")}finally{R(!1)}},[Be]);const Ze=p.useCallback(async e=>{try{R(!0);let s="acknowledged";"overturned"===e.decision&&(s="overturned");const t={status:s,appealOutcome:e.decision,appealDecisionDate:new Date,appealReasoning:e.reasoning,hrNotes:e.hrNotes,followUpRequired:e.followUpRequired,followUpDate:e.followUpDate};"reduced"!==e.decision&&"modified"!==e.decision||(e.newLevel&&(t.level=e.newLevel),e.newDescription&&(t.description=e.newDescription)),await x.warnings.update(e.warningId,t,C),"overturned"===e.decision?(await x.warnings.archive(e.warningId,C,"overturned"),a.success("Warning overturned and archived")):e.decision,await Be(),a.success("Appeal decision recorded successfully")}catch(s){throw a.error("Failed to record appeal decision:",s),new Error("Failed to record appeal decision. Please try again.")}finally{R(!1)}},[Be]);p.useCallback(e=>{e.id,setSelectedWarning(e),setShowDetails(!0)},[]);const Ke=p.useCallback(async e=>{try{confirm("Are you sure you want to archive this warning? It will be moved to the archive.")&&(R(!0),await x.warnings.archive(e,C,"manual"),a.success("Warning archived successfully"),await Be())}catch(s){a.error("Failed to archive warning:",s),_("Failed to archive warning")}finally{R(!1)}},[C,Be]);return W?t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[t.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mb-3"}),t.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Loading Warnings"}),t.jsx("p",{className:"text-sm text-gray-600",children:"Please wait..."})]})}):U?t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[t.jsx(k,{className:"w-8 h-8 text-red-500 mb-3"}),t.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Error Loading Warnings"}),t.jsx("p",{className:"text-sm text-red-600 mb-3",children:U}),t.jsxs("button",{onClick:Be,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 text-sm",children:[t.jsx(H,{className:"w-4 h-4"}),"Retry Loading"]})]})}):t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Warning Management"}),t.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[S.length," active"]}),E.length>0&&t.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 bg-orange-100 px-2 py-1 rounded-full",children:[E.length," archived"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>ze("archive"===qe?"warnings":"archive"),className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-colors text-sm "+("archive"===qe?"bg-blue-600 hover:bg-blue-700 text-white":"bg-orange-600 hover:bg-orange-700 text-white"),children:[t.jsx(Y,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"archive"===qe?"Active Warnings":"Archive"})]}),t.jsx("button",{onClick:Be,disabled:W,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(H,{className:"w-4 h-4 "+(W?"animate-spin":"")})}),s&&t.jsx("button",{onClick:s,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:t.jsx(v,{className:"w-4 h-4"})})]})]}),"archive"===qe?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[t.jsx(Y,{className:"w-5 h-5 text-gray-600"}),"Warning Archive"]}),t.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View expired and overturned warnings with appeal decision history"})]}),t.jsxs("button",{onClick:()=>ze("warnings"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2",children:[t.jsx(J,{className:"w-4 h-4 rotate-90"}),"Back to Active Warnings"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Y,{className:"w-8 h-8 text-gray-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:E.length}),t.jsx("div",{className:"text-sm text-gray-600",children:"Total Archived"})]})]})}),t.jsx("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(H,{className:"w-8 h-8 text-orange-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold text-orange-900",children:E.filter(e=>"overturned"===e.status).length}),t.jsx("div",{className:"text-sm text-orange-700",children:"Overturned Appeals"})]})]})}),t.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(Z,{className:"w-8 h-8 text-blue-600"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-2xl font-bold text-blue-900",children:E.filter(e=>"expired"===e.status).length}),t.jsx("div",{className:"text-sm text-blue-700",children:"Naturally Expired"})]})]})})]}),0===E.length?t.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[t.jsx(Y,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),t.jsx("p",{className:"text-gray-500 font-medium",children:"No archived warnings"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Expired and overturned warnings will appear here"})]}):t.jsx("div",{className:"space-y-3",children:E.map((e,s)=>t.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow",children:t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("h4",{className:"font-semibold text-gray-900",children:me(e.employeeName)}),t.jsxs("span",{className:"text-xs text-gray-500",children:[me(e.employeeNumber)," â€¢ ",me(e.department)]})]}),t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Warning Level"}),t.jsx("p",{className:"text-sm font-medium text-gray-900",children:"counselling"===e.level?"Counselling":"verbal"===e.level?"Verbal":"first_written"===e.level?"First Written":"second_written"===e.level?"Second Written":"final_written"===e.level?"Final Written":me(e.level,"Unknown")})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),t.jsx("p",{className:"text-sm font-medium text-gray-900",children:me(e.category)})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Issue Date"}),t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.issueDate?new Date(e.issueDate.seconds?1e3*e.issueDate.seconds:e.issueDate).toLocaleDateString():"N/A"})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Status"}),t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("overturned"===e.status?"bg-orange-100 text-orange-800":"expired"===e.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"overturned"===e.status?"Overturned":"expired"===e.status?"Expired":me(e.status,"Archived")})]})]}),"overturned"===e.status&&e.appealDecisionDate&&t.jsx("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-200 mt-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx($,{className:"w-4 h-4 text-orange-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-xs font-medium text-orange-900 mb-1",children:"Appeal Decision"}),t.jsxs("p",{className:"text-xs text-orange-800 mb-2",children:[t.jsx("strong",{children:"Outcome:"})," ","overturned"===e.appealOutcome?"Warning Overturned":me(e.appealOutcome)]}),e.appealReasoning&&t.jsxs("p",{className:"text-xs text-orange-800 mb-2",children:[t.jsx("strong",{children:"Reasoning:"})," ",me(e.appealReasoning)]}),e.hrNotes&&t.jsxs("p",{className:"text-xs text-orange-800 mb-2",children:[t.jsx("strong",{children:"HR Notes:"})," ",me(e.hrNotes)]}),t.jsxs("p",{className:"text-xs text-orange-700",children:[t.jsx("strong",{children:"Decision Date:"})," ",new Date(e.appealDecisionDate).toLocaleDateString()]})]})]})}),"expired"===e.status&&t.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200 mt-3",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx(Z,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium text-blue-900 mb-1",children:"Natural Expiry"}),t.jsx("p",{className:"text-xs text-blue-800",children:"This warning expired after its validity period completed without further incidents."}),e.expiryDate&&t.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[t.jsx("strong",{children:"Expired On:"})," ",new Date(e.expiryDate).toLocaleDateString()]})]})]})})]}),t.jsxs("button",{onClick:()=>Ye(e),className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors flex items-center gap-1",children:[t.jsx(K,{className:"w-4 h-4"}),"View"]})]})},e.id||`archived-${s}`))})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[t.jsx("div",{className:"flex-1",children:t.jsxs("div",{className:"relative",children:[t.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx("input",{type:"text",placeholder:"Search warnings...",value:T,onChange:e=>q(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs("select",{value:B,onChange:e=>G(e.target.value),className:"flex-1 sm:flex-initial px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"issued",children:"Issued"}),t.jsx("option",{value:"acknowledged",children:"Acknowledged"}),t.jsx("option",{value:"appealed",children:"Under Appeal"}),t.jsx("option",{value:"expired",children:"Expired"})]}),t.jsxs("select",{value:V,onChange:e=>ae(e.target.value),className:"flex-1 sm:flex-initial px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Levels"}),t.jsx("option",{value:"counselling",children:"Counselling"}),t.jsx("option",{value:"verbal",children:"Verbal"}),t.jsx("option",{value:"first_written",children:"First Written"}),t.jsx("option",{value:"second_written",children:"Second Written"}),t.jsx("option",{value:"final_written",children:"Final Written"}),t.jsx("option",{value:"written",children:"Written (Legacy)"}),t.jsx("option",{value:"final",children:"Final (Legacy)"}),t.jsx("option",{value:"dismissal",children:"Dismissal (Legacy)"})]}),t.jsxs("button",{onClick:()=>je(!ve),className:"px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors text-sm items-center gap-2 sm:flex hidden",children:[t.jsx(X,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden lg:inline",children:"More"}),ve?t.jsx(ee,{className:"w-4 h-4"}):t.jsx(J,{className:"w-4 h-4"})]})]})]}),ve&&t.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[t.jsxs("select",{value:re,onChange:e=>ne(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"all",children:"All Departments"}),Ge.map(e=>t.jsx("option",{value:e,children:e},e))]}),t.jsxs("select",{value:`${de}-${ge}`,onChange:e=>{const[s,a]=e.target.value.split("-");oe(s),ue(a)},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:"date-desc",children:"Newest First"}),t.jsx("option",{value:"date-asc",children:"Oldest First"}),t.jsx("option",{value:"employee-asc",children:"Employee A-Z"}),t.jsx("option",{value:"employee-desc",children:"Employee Z-A"}),t.jsx("option",{value:"level-asc",children:"Level (Low to High)"}),t.jsx("option",{value:"level-desc",children:"Level (High to Low)"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),t.jsxs("select",{value:10,onChange:e=>setItemsPerPage(Number(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[t.jsx("option",{value:10,children:"10"}),t.jsx("option",{value:25,children:"25"}),t.jsx("option",{value:50,children:"50"}),t.jsx("option",{value:100,children:"100"})]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[t.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-600 text-xs font-medium",children:"Total"}),t.jsx("p",{className:"text-lg font-bold text-gray-900",children:S.length})]}),t.jsx(L,{className:"w-5 h-5 text-gray-500"})]})}),t.jsx("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-green-600 text-xs font-medium",children:"Active"}),t.jsx("p",{className:"text-lg font-bold text-green-900",children:S.filter(e=>e.isActive).length})]}),t.jsx(D,{className:"w-5 h-5 text-green-500"})]})}),t.jsx("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-orange-600 text-xs font-medium",children:"Undelivered"}),t.jsx("p",{className:"text-lg font-bold text-orange-900",children:S.filter(e=>"delivered"!==e.deliveryStatus).length})]}),t.jsx(Z,{className:"w-5 h-5 text-orange-500"})]})}),t.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-red-600 text-xs font-medium",children:"Critical"}),t.jsx("p",{className:"text-lg font-bold text-red-900",children:S.filter(e=>"final"===e.level||"dismissal"===e.level).length})]}),t.jsx(k,{className:"w-5 h-5 text-red-500"})]})})]}),t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsxs("p",{className:"text-sm text-gray-600",children:[P.length," warnings ",P.length!==S.length&&`(filtered from ${S.length})`]}),t.jsx("div",{className:"flex items-center gap-4",children:t.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",O," of ",Ve]})})]}),t.jsx("div",{className:"md:hidden space-y-3 mb-4",children:He.map((e,s)=>t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:me(e.employeeName)}),t.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[me(e.employeeNumber)," â€¢ ",me(e.department)]})]}),t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("issued"===e.status?"bg-blue-100 text-blue-800":"acknowledged"===e.status?"bg-green-100 text-green-800":"appealed"===e.status?"bg-orange-100 text-orange-800":"expired"===e.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"issued"===e.status?"Issued":"acknowledged"===e.status?"Acknowledged":"appealed"===e.status?"Under Appeal":"expired"===e.status?"Expired":me(e.status,"Pending")})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Level"}),t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full mt-1 "+("counselling"===e.level?"bg-green-100 text-green-800":"verbal"===e.level?"bg-blue-100 text-blue-800":"first_written"===e.level?"bg-yellow-100 text-yellow-800":"second_written"===e.level?"bg-orange-100 text-orange-800":"final_written"===e.level?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"counselling"===e.level?"Counselling":"verbal"===e.level?"Verbal":"first_written"===e.level?"1st Written":"second_written"===e.level?"2nd Written":"final_written"===e.level?"Final":me(e.level,"Unknown")})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),t.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:me(e.category)})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[t.jsx("p",{className:"text-xs text-gray-500",children:e.issueDate?new Date(e.issueDate.seconds?1e3*e.issueDate.seconds:e.issueDate).toLocaleDateString():"N/A"}),t.jsx("button",{onClick:()=>Ye(e),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1.5 hover:bg-blue-50 rounded transition-colors",children:"View Details"})]})]},e.id||`warning-${s}`))}),t.jsx("div",{className:"hidden md:block bg-white rounded-lg border border-gray-200 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Employee"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Warning"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Category"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Date"}),t.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Status"}),t.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Actions"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:He.map((e,s)=>t.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[t.jsx("td",{className:"px-4 py-3",children:t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:me(e.employeeName)}),t.jsxs("div",{className:"text-xs text-gray-500",children:[me(e.employeeNumber)," â€¢ ",me(e.department)]})]})}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("counselling"===e.level?"bg-green-100 text-green-800":"verbal"===e.level?"bg-blue-100 text-blue-800":"first_written"===e.level?"bg-yellow-100 text-yellow-800":"second_written"===e.level?"bg-orange-100 text-orange-800":"final_written"===e.level?"bg-red-100 text-red-800":"written"===e.level?"bg-yellow-100 text-yellow-800":"final"===e.level||"dismissal"===e.level?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"counselling"===e.level?"Counselling":"verbal"===e.level?"Verbal":"first_written"===e.level?"First Written":"second_written"===e.level?"Second Written":"final_written"===e.level?"Final Written":"written"===e.level?"Written":"final"===e.level?"Final":"dismissal"===e.level?"Dismissal":me(e.level,"Unknown")})}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:me(e.category)}),t.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:e.issueDate?new Date(e.issueDate.seconds?1e3*e.issueDate.seconds:e.issueDate).toLocaleDateString():"N/A"}),t.jsx("td",{className:"px-4 py-3",children:t.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("issued"===e.status?"bg-blue-100 text-blue-800":"acknowledged"===e.status?"bg-green-100 text-green-800":"appealed"===e.status?"bg-orange-100 text-orange-800":"expired"===e.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"issued"===e.status?"Issued":"acknowledged"===e.status?"Acknowledged":"appealed"===e.status?"Under Appeal":"expired"===e.status?"Expired":me(e.status,"Pending")})}),t.jsx("td",{className:"px-4 py-3 text-right",children:t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{onClick:()=>Ye(e),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"View"}),"appealed"===e.status&&t.jsxs("button",{onClick:()=>{Te(e),$e(!0)},className:"text-purple-600 hover:text-purple-800 text-xs px-2 py-1 hover:bg-purple-50 rounded transition-colors flex items-center gap-1",title:"Review Appeal with Enhanced Decision Options",children:[t.jsx($,{className:"w-3 h-3"}),"Review Appeal"]}),"delivered"!==e.deliveryStatus&&"appealed"!==e.status&&t.jsx("button",{onClick:async()=>{try{e.id,Ce(e),e.employeeId;const s=await x.employees.getById(e.employeeId,C);s?(We({email:s.profile.email,phone:s.profile.phoneNumber||s.profile.whatsappNumber}),s.profile.email,s.profile.phoneNumber):(a.warn("âš ï¸ Employee not found:",e.employeeId),We({})),Se(!0)}catch(s){a.error("âŒ Failed to fetch employee contact details:",s),We({}),Se(!0)}},className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 hover:bg-orange-50 rounded transition-colors",children:"Deliver"}),"appealed"!==e.status&&pe(e)&&t.jsx("button",{onClick:()=>{e.id,e.employeeName,_e(e),Le(!0)},className:"text-amber-600 hover:text-amber-800 text-xs px-2 py-1 hover:bg-amber-50 rounded transition-colors",title:(()=>{const s=e.issueDate.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),a=new Date(s);return a.setDate(a.getDate()+30),`Appeal this warning (deadline: ${a.toLocaleDateString()})`})(),children:"Appeal"}),"appealed"!==e.status&&!pe(e)&&t.jsx("span",{className:"text-gray-500 text-xs px-2 py-1",title:"Appeal period has expired",children:"Appeal Expired"}),("acknowledged"===e.status||"expired"===e.status||!pe(e))&&t.jsx("button",{onClick:()=>Ke(e.id),className:"text-gray-600 hover:text-gray-800 text-xs px-2 py-1 hover:bg-gray-50 rounded transition-colors",title:"Archive this warning",children:t.jsx(Y,{className:"w-3 h-3"})})]})})]},e.id||`warning-${s}`))})]})})}),0===P.length&&!W&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx(z,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),t.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"No warnings found"}),t.jsx("p",{className:"text-sm text-gray-600 mb-3",children:T||"all"!==B||"all"!==V||"all"!==re?"Try adjusting your search criteria or filters.":"No warnings have been created yet."}),(T||"all"!==B||"all"!==V||"all"!==re)&&t.jsx("button",{onClick:()=>{q(""),G("all"),ae("all"),ne("all")},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear all filters"})]}),Ve>1&&t.jsxs("div",{className:"flex items-center justify-center mt-4 gap-2",children:[t.jsx("button",{onClick:()=>M(Math.max(1,O-1)),disabled:1===O,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),t.jsxs("span",{className:"px-3 py-2 text-sm text-gray-600 bg-gray-50 rounded-lg",children:[O," of ",Ve]}),t.jsx("button",{onClick:()=>M(Math.min(Ve,O+1)),disabled:O===Ve,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]}),ke&&De&&t.jsx(le,{isOpen:ke,onClose:()=>{Se(!1),Pe(null),We({})},onMethodSelected:async e=>{try{C&&De.deliveryNotificationId&&await se.updateDeliveryMethod(C,De.deliveryNotificationId,e),Pe(e),Se(!1),Ee(!0)}catch(s){a.error("Failed to update delivery method:",s),alert("Failed to update delivery method. Please try again.")}},employeeRequestedMethod:De.employeeRequestedDeliveryMethod,employeeName:De.employeeName||"Unknown",employeeEmail:Ie.email,employeePhone:Ie.phone}),Fe&&De&&Ae&&t.jsx(h,{isOpen:Fe,notification:{id:De.deliveryNotificationId||De.id,warningId:De.id,employeeName:De.employeeName||"Unknown",employeeEmail:Ie.email,employeePhone:Ie.phone,warningLevel:De.level||"counselling",warningCategory:De.category||"General",deliveryMethod:Ae,priority:"normal",status:"in_progress",createdAt:xe(De.issueDate),createdByName:De.createdByName||"Manager",pdfUrl:De.pdfUrl,contactDetails:{email:Ie.email,phone:Ie.phone}},onDeliveryComplete:async(e,s)=>{try{await x.warnings.update(De.id,{status:"delivered",deliveredAt:s.deliveredAt,deliveryMethod:s.deliveryMethod,proofImage:s.proofImage},w?.id),await Be(),j?.(),Ee(!1),Ce(null),Pe(null),We({})}catch(t){throw a.error("Failed to complete delivery:",t),t}},onClose:()=>{Ee(!1),Ce(null),Pe(null),We({})}}),De&&t.jsx(te,{isOpen:Ne,onClose:()=>{we(!1),Ce(null),We({})},warningId:De.id||"",employeeName:De.employeeName||"Unknown",employeeEmail:Ie.email,deliveryMethod:De.deliveryMethod||"email",warningData:De,onDeliveryConfirmed:async e=>{try{await x.warnings.updateDeliveryStatus(e.warningId,{status:"delivered",deliveredAt:e.deliveredAt,deliveryMethod:e.deliveryMethod,proofImage:e.proofImage}),await Be(),we(!1),Ce(null),We({})}catch(s){throw a.error("Failed to confirm delivery:",s),s}}}),Re&&Ue&&t.jsx(ie,{isOpen:Re,onClose:()=>{Le(!1),_e(null)},warning:{id:Ue.id,employeeName:Ue.employeeName,category:Ue.category,level:Ue.level,issueDate:Ue.issueDate,description:Ue.description||"No description provided"},onAppealSubmit:Je}),Oe&&Me&&t.jsx(ce,{isOpen:Oe,onClose:()=>{$e(!1),Te(null)},warning:{id:Me.id,employeeName:Me.employeeName,employeeNumber:Me.employeeNumber,category:Me.category,level:Me.level,issueDate:Me.issueDate,description:Me.description||"No description provided",appealDetails:Me.appealDetails},onDecisionSubmit:Ze})]})]})};export{ge as WarningsReviewDashboard,ge as default};
