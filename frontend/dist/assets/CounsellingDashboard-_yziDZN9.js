import{u as e,g as s,j as a,d as t,L as l}from"./business-owner-dashboard-DVkajjzD.js";import{u as r,r as o}from"./react-vendor-CWjEGAcE.js";import{q as n,l as i,w as d,t as c,m}from"./firebase-vendor-Cc210LOb.js";import{C as x,a as p}from"./hod-dashboard-BwEgLMNF.js";import{ac as u,X as g,m as h,r as f,s as j,U as b,e as y,w,am as N}from"./ui-vendor-DTBvTbg1.js";import"./pdf-vendor-tUwojRr6.js";import"./hr-dashboard-CoTtHVCM.js";import"./warning-components-SgVVfTDH.js";const v=({onClose:v})=>{const C=r(),{user:D}=e(),{organization:S}=s(),[U,T]=o.useState([]),[k,L]=o.useState([]),[F,z]=o.useState(!0),[E,P]=o.useState(null),[A,M]=o.useState(""),[_,B]=o.useState("all"),[q,I]=o.useState(null),[O,V]=o.useState(!1);o.useEffect(()=>{(async()=>{if(D?.id&&S?.id)try{z(!0),P(null);const e=n(i(t,"corrective_counselling"),d("organizationId","==",S.id),d("createdBy","==",D.id),c("dateCreated","desc")),s=await m(e),a=[];s.forEach(e=>{const s=e.data();a.push({id:e.id,...s})}),T(a),L(a)}catch(e){l.error("❌ Error loading counselling sessions:",e),P("Failed to load counselling sessions")}finally{z(!1)}})()},[D?.id,S?.id]),o.useEffect(()=>{let e=U;if(A){const s=A.toLowerCase();e=e.filter(e=>e.employeeName.toLowerCase().includes(s)||e.category.toLowerCase().includes(s)||e.issueDescription.toLowerCase().includes(s))}"all"!==_&&(e=e.filter(e=>{switch(_){case"active":return!e.followUpCompleted&&e.followUpDate;case"pending_followup":if(!e.followUpDate||e.followUpCompleted)return!1;const s=new Date(e.followUpDate);return Math.ceil((s.getTime()-(new Date).getTime())/864e5)<=7;case"completed":return e.followUpCompleted;default:return!0}})),L(e)},[U,A,_]);const Y=e=>{if(e.followUpCompleted)return a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"Completed"});if(!e.followUpDate)return a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium",children:"No Follow-up"});const s=new Date(e.followUpDate),t=Math.ceil((s.getTime()-(new Date).getTime())/864e5);return t<0?a.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium",children:"Overdue"}):t<=3?a.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-medium",children:"Due Soon"}):a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:"Active"})};return F?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsx("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading counselling dashboard..."})]})})}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(u,{className:"w-8 h-8 text-blue-600"}),"Counselling Dashboard"]}),a.jsx("button",{onClick:v||(()=>C("/dashboard")),className:"text-gray-500 hover:text-gray-700",children:a.jsx(g,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Manage all your counselling sessions and follow-ups"})]}),E&&a.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-lg flex items-center gap-2",children:[a.jsx(h,{className:"w-5 h-5 text-red-500"}),a.jsx("p",{className:"text-red-700",children:E})]}),a.jsx("div",{className:"p-6 border-b bg-gray-50",children:a.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[a.jsx("div",{className:"flex-1 min-w-64",children:a.jsxs("div",{className:"relative",children:[a.jsx(f,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),a.jsx("input",{type:"text",value:A,onChange:e=>M(e.target.value),placeholder:"Search by employee, category, or description...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(j,{className:"w-4 h-4 text-gray-500"}),a.jsxs("select",{value:_,onChange:e=>B(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"All Sessions"}),a.jsx("option",{value:"active",children:"Active"}),a.jsx("option",{value:"pending_followup",children:"Follow-up Due"}),a.jsx("option",{value:"completed",children:"Completed"})]})]}),a.jsxs("div",{className:"text-sm text-gray-600 bg-white px-3 py-2 rounded-lg border",children:["Showing ",k.length," of ",U.length," sessions"]})]})}),a.jsx("div",{className:"p-6",children:0===k.length?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(u,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No counselling sessions found"}),a.jsx("p",{className:"text-gray-500",children:A||"all"!==_?"Try adjusting your search or filter criteria":"You haven't created any counselling sessions yet"})]}):a.jsx("div",{className:"space-y-4",children:k.map(e=>{const s=(t=e.counsellingType,p.find(e=>e.id===t)||p[0]);var t;const l=e.followUpDate?new Date(e.followUpDate):null,r=l&&!e.followUpCompleted;return a.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(b,{className:"w-5 h-5 text-gray-500"}),a.jsx("span",{className:"font-semibold text-gray-900",children:e.employeeName})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-lg",children:s.icon}),a.jsx("span",{className:"text-sm text-gray-600",children:s.label})]})]}),a.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:e.category}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Created: ",new Date(e.dateCreated).toLocaleDateString()]}),l&&a.jsxs("span",{className:"text-sm text-gray-500",children:["Follow-up: ",l.toLocaleDateString()]})]}),a.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:e.issueDescription}),e.promisesToPerform&&e.promisesToPerform.length>0&&a.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[e.promisesToPerform.length," promise",1!==e.promisesToPerform.length?"s":""," to perform"]})]}),a.jsxs("div",{className:"flex items-start gap-3 ml-4",children:[Y(e),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"View Details",children:a.jsx(y,{className:"w-4 h-4"})}),r&&a.jsxs("button",{onClick:()=>(e=>{I(e),V(!0)})(e),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-1",children:[a.jsx(w,{className:"w-3 h-3"}),"Follow-up"]})]})]})]})},e.id)})})}),a.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t px-6 py-4",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("button",{onClick:v||(()=>C("/dashboard")),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[a.jsx(N,{className:"w-4 h-4"}),"Back to Dashboard"]}),a.jsxs("div",{className:"text-sm text-gray-500",children:[U.filter(e=>!e.followUpCompleted&&e.followUpDate).length," sessions need follow-up"]})]})})]})}),O&&q&&a.jsx(x,{counsellingSession:q,onClose:()=>{V(!1),I(null)},onComplete:()=>{V(!1),I(null),window.location.reload()}})]})};export{v as CounsellingDashboard};
