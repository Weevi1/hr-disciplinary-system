const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmployeeLifecycleService-BlkamdWZ.js","assets/react-vendor-DrdoFN08.js","assets/firebase-vendor-Cz3N8Xg7.js","assets/pdf-vendor-Bp5yZ91a.js","assets/ui-vendor-D5iFg9Jt.js","assets/warning-components-BmrOpsKb.js","assets/NotificationDeliveryService-1e6SJJSl.js"])))=>i.map(i=>d[i]);
import{a as qi,r as p,g as Gi,c as ea,b as Vi,R as Lt,d as Gn,u as js}from"./react-vendor-DrdoFN08.js";import{i as Qi,g as Ki,a as Yi,b as Zi,c as Vn,d as Xi,e as Ji,s as eo,f as Qn,h as to,o as Kn,j as Q,k as Ze,l as se,q as X,m as oe,n as ze,p as re,u as Te,r as Yn,w as J,t as le,v as ht,F as so,x as vs,y as hs,z as Zn,A as Ct,T as St,B as ro,C as cs,D as ao,E as Qs,G as ca,H as da,I as ma}from"./firebase-vendor-Cz3N8Xg7.js";import{a as nt}from"./pdf-vendor-Bp5yZ91a.js";import{U as _s,M as rs,a as Rt,P as $s,b as Ne,D as gs,T as ft,C as ae,c as qe,d as Xn,X as ve,R as pt,e as Jn,f as me,g as Os,h as Re,i as tt,S as jt,j as wa,k as Se,l as gt,E as ut,m as At,n as wt,L as et,F as ye,o as as,p as no,q as Ir,r as Gt,s as Ke,I as Ur,t as Pa,B as Je,u as mt,A as Wr,v as io,w as Pr,x as oo,y as lo,z as co,G as Ft,H as ua,J as ei,K as mo,N as uo,O as Ta,Q as xo,V as Ba,W as bs,Y as _t,Z as xa,_ as ho,$ as Hr,a0 as ha,a1 as zs,a2 as go,a3 as po,a4 as Tr,a5 as fo,a6 as Pe,a7 as Is,a8 as ps,a9 as Xt,aa as qt,ab as ti,ac as si,ad as La,ae as $a,af as yo,ag as vo,ah as ja,ai as bo,aj as wo,ak as jo,al as No,am as qr,an as ga,ao as ri,ap as Jt,aq as Br,ar as Oa,as as es,at as Ks,au as ws,av as Ma,aw as ai,ax as Ua,ay as Co,az as Gr,aA as pa,aB as Lr,aC as Ys,aD as $r,aE as Do}from"./ui-vendor-D5iFg9Jt.js";import{WarningsReviewDashboard as ko}from"./warning-components-BmrOpsKb.js";var ta={exports:{}},Ns={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wa;function So(){if(Wa)return Ns;Wa=1;var n=qi(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function o(l,m,c){var x,u={},h=null,v=null;c!==void 0&&(h=""+c),m.key!==void 0&&(h=""+m.key),m.ref!==void 0&&(v=m.ref);for(x in m)r.call(m,x)&&!i.hasOwnProperty(x)&&(u[x]=m[x]);if(l&&l.defaultProps)for(x in m=l.defaultProps,m)u[x]===void 0&&(u[x]=m[x]);return{$$typeof:t,type:l,key:h,ref:v,props:u,_owner:a.current}}return Ns.Fragment=s,Ns.jsx=o,Ns.jsxs=o,Ns}var Ha;function Eo(){return Ha||(Ha=1,ta.exports=So()),ta.exports}var e=Eo();let d=class{static{this.isDevelopment=!1}static{this.isProduction=!0}static{this.productionWhitelist=["❌","🚨","⚠️","✅","🎯"]}static debug(t,s,r){this.isDevelopment&&console.debug(this.formatMessage("DEBUG",t,r),s)}static info(t,s,r){(this.isDevelopment||this.isWhitelistedMessage(t))&&console.info(this.formatMessage("INFO",t,r),s)}static warn(t,s,r){const a=this.isProduction?this.sanitizeData(s):s;console.warn(this.formatMessage("WARN",t,r),a)}static error(t,s,r){const a=this.isProduction?this.sanitizeError(s):s;console.error(this.formatMessage("ERROR",t,r),a),this.isProduction&&this.sendToMonitoring("error",t,a,r)}static success(t,s,r){const a=String(t);(this.isDevelopment||this.isWhitelistedMessage(t))&&console.log(this.formatMessage("SUCCESS",a,r),s)}static perf(t,s,r){if(this.isDevelopment){const a=Date.now()-s;console.debug(this.formatMessage("PERF",`${t} completed in ${a}ms`,r))}}static isWhitelistedMessage(t){const s=String(t);return this.productionWhitelist.some(r=>s.startsWith(r))}static formatMessage(t,s,r){const a=new Date().toISOString(),i=r?this.formatContext(r):"";return`[${a}] ${t}: ${s}${i}`}static formatContext(t){const s=[];return t.organizationId&&s.push(`org:${t.organizationId.slice(-8)}`),t.userId&&s.push(`user:${t.userId.slice(-8)}`),t.component&&s.push(`comp:${t.component}`),t.action&&s.push(`action:${t.action}`),s.length>0?` [${s.join(", ")}]`:""}static sanitizeData(t){if(!t)return t;if(typeof t=="string")return this.sanitizeString(t);if(typeof t=="object"){const s={};for(const[r,a]of Object.entries(t))this.isSensitiveKey(r)?s[r]="[REDACTED]":typeof a=="object"?s[r]=this.sanitizeData(a):s[r]=a;return s}return t}static sanitizeError(t){return t&&(t instanceof Error?{name:t.name,message:this.sanitizeString(t.message),stack:this.isDevelopment?t.stack:"[REDACTED]"}:this.sanitizeData(t))}static isSensitiveKey(t){const s=["password","token","secret","key","auth","credential","email","phone","address","ssn","id_number","passport","salary","wage","bank","account","credit","personal","medical","health","disciplinary","performance"],r=t.toLowerCase();return s.some(a=>r.includes(a))}static sanitizeString(t){return!t||typeof t!="string"||(t=t.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,"[EMAIL]"),t=t.replace(/(\+27|0)[6-8][0-9]{8}/g,"[PHONE]"),t=t.replace(/\b\d{13}\b/g,"[ID_NUMBER]"),t=t.replace(/\b[a-zA-Z0-9]{20,}\b/g,"[TOKEN]")),t}static sendToMonitoring(t,s,r,a){try{const i={level:t,message:s,data:r,context:a,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href},o=JSON.parse(localStorage.getItem("hr_production_errors")||"[]");o.push(i),o.length>20&&o.shift(),localStorage.setItem("hr_production_errors",JSON.stringify(o))}catch{}}static getProductionLogs(){try{return JSON.parse(localStorage.getItem("hr_production_errors")||"[]")}catch{return[]}}static clearProductionLogs(){localStorage.removeItem("hr_production_errors")}};d.debug.bind(d),d.info.bind(d),d.warn.bind(d),d.error.bind(d),d.success.bind(d),d.perf.bind(d);const Ao={apiKey:"AIzaSyCghheyHpRDcc-2sue-u1apExJr6jQCzyw",authDomain:"hr-disciplinary-system.firebaseapp.com",projectId:"hr-disciplinary-system",storageBucket:"hr-disciplinary-system.firebasestorage.app",messagingSenderId:"989741369966",appId:"1:989741369966:web:e388dc78d75744d828747f",measurementId:void 0},Ms=Qi(Ao),Nt=Ki(Ms),B=Yi(Ms),Or=Zi(Ms),fa=Vn(Ms,"us-central1");Xi(Ms);Ji(B).then(()=>{d.debug("🔥 Firestore network enabled successfully")}).catch(n=>{d.error("Failed to enable Firestore network:",n)});const ni=Object.freeze(Object.defineProperty({__proto__:null,auth:Nt,db:B,functions:fa,storage:Or},Symbol.toStringTag,{value:"Module"}));class Ro{constructor(){this.isCreatingUser=!1,this.pendingUserIds=new Set}startUserCreation(t){this.isCreatingUser=!0,this.pendingUserIds.add(t)}finishUserCreation(t){this.pendingUserIds.delete(t),this.pendingUserIds.size===0&&(this.isCreatingUser=!1)}isCreating(){return this.isCreatingUser}isPendingUser(t){return this.pendingUserIds.has(t)}}const fs=new Ro;class ys extends Error{constructor(t,s,r){super(t),this.code=s,this.originalError=r,this.name="FirebaseServiceError"}}class vt{static handle(t,s){throw d.error(`[FirebaseService] ${s} failed`,t),t instanceof so?new ys(`Firestore error during ${s}: ${t.message}`,t.code,t):t&&typeof t=="object"&&"code"in t&&"message"in t?new ys(`Auth error during ${s}: ${t.message}`,t.code,t):new ys(`Unknown error during ${s}`,"unknown",t)}}class Ue{static async signIn(t,s){try{d.debug("Attempting sign in",{email:t});const r=await eo(Nt,t,s);return d.debug("Sign in successful",{uid:r.user.uid}),r.user}catch(r){vt.handle(r,"signIn")}}static async signUp(t,s){try{d.debug("Creating new user",{email:t});const r=await Qn(Nt,t,s);return d.debug("User created successfully",{uid:r.user.uid}),r.user}catch(r){vt.handle(r,"signUp")}}static async signOut(){try{d.debug("Signing out user"),await to(Nt),d.debug("Sign out successful")}catch(t){vt.handle(t,"signOut")}}static onAuthStateChanged(t){return Kn(Nt,t)}static async getDocument(t,s){try{d.debug("Getting document",{collection:t,id:s});const r=Q(B,t,s),a=await Ze(r);return a.exists()?(d.debug("Document found",{collection:t,id:s}),{id:a.id,...a.data()}):(fs.isPendingUser(s)||fs.isCreating()?d.debug("Document not found (expected during user creation)",{collection:t,id:s}):d.warn("Document not found",{collection:t,id:s}),null)}catch(r){vt.handle(r,`getDocument(${t}/${s})`)}}static async getCollection(t,s){try{d.debug("Getting collection",{collection:t});const r=se(B,t);let a=s?X(r,...s):r;const o=(await oe(a)).docs.map(l=>({id:l.id,...l.data()}));return d.debug("Collection retrieved",{collection:t,count:o.length}),o}catch(r){vt.handle(r,`getCollection(${t})`)}}static async createDocument(t,s,r){try{const a=r||Q(se(B,t)).id;d.debug("Creating document",{collection:t,id:a});const i=Q(B,t,a),{id:o,...l}=s;return await ze(i,{...l,createdAt:re(),updatedAt:re()}),d.debug("Document created",{collection:t,id:a}),a}catch(a){vt.handle(a,`createDocument(${t})`)}}static async setDocument(t,s,r){try{d.debug("Setting document",{collection:t,id:s});const a=Q(B,t,s);await ze(a,r),d.debug("Document set",{collection:t,id:s})}catch(a){vt.handle(a,`setDocument(${t}/${s})`)}}static async updateDocument(t,s,r){try{d.debug("Updating document",{collection:t,id:s});const a=Q(B,t,s);await Te(a,{...r,updatedAt:re()}),d.debug("Document updated",{collection:t,id:s})}catch(a){vt.handle(a,`updateDocument(${t}/${s})`)}}static async deleteDocument(t,s){try{d.debug("Deleting document",{collection:t,id:s});const r=Q(B,t,s);await Yn(r),d.debug("Document deleted",{collection:t,id:s})}catch(r){vt.handle(r,`deleteDocument(${t}/${s})`)}}static async queryDocuments(t,s,r,a){try{d.debug("Querying documents",{collection:t,conditions:s.length});const i=s.map(o=>J(o.field,o.operator,o.value));return r&&i.push(le(r)),a&&i.push(ht(a)),await this.getCollection(t,i)}catch(i){vt.handle(i,`queryDocuments(${t})`)}}static async batchCreate(t,s){try{d.debug("Batch creating documents",{collection:t,count:s.length});const r=[];for(let a=0;a<s.length;a+=10){const o=s.slice(a,a+10).map(m=>this.createDocument(t,m)),l=await Promise.all(o);r.push(...l)}return d.debug("Batch create completed",{collection:t,created:r.length}),r}catch(r){vt.handle(r,`batchCreate(${t})`)}}static async refreshUserClaims(t){try{d.debug("Refreshing user custom claims",{targetUserId:t});const{getFunctions:s,httpsCallable:r}=await nt(async()=>{const{getFunctions:l,httpsCallable:m}=await import("./firebase-vendor-Cz3N8Xg7.js").then(c=>c.J);return{getFunctions:l,httpsCallable:m}},[]),a=s(),o=await r(a,"refreshUserClaims")({targetUserId:t});return d.debug("Custom claims refreshed successfully",o.data),o.data}catch(s){throw d.error("Failed to refresh custom claims:",s),new ys("Failed to refresh custom claims","refresh-claims-failed",s)}}static async refreshOrganizationUserClaims(t){try{d.debug("Refreshing organization user claims",{organizationId:t});const{getFunctions:s,httpsCallable:r}=await nt(async()=>{const{getFunctions:l,httpsCallable:m}=await import("./firebase-vendor-Cz3N8Xg7.js").then(c=>c.J);return{getFunctions:l,httpsCallable:m}},[]),a=s(),o=await r(a,"refreshOrganizationUserClaims")({organizationId:t});return d.debug("Organization claims refreshed successfully",o.data),o.data}catch(s){throw d.error("Failed to refresh organization claims:",s),new ys("Failed to refresh organization claims","refresh-org-claims-failed",s)}}static async getUserClaims(){try{d.debug("Getting user custom claims");const{getFunctions:t,httpsCallable:s}=await nt(async()=>{const{getFunctions:o,httpsCallable:l}=await import("./firebase-vendor-Cz3N8Xg7.js").then(m=>m.J);return{getFunctions:o,httpsCallable:l}},[]),r=t(),i=await s(r,"getUserClaims")();return d.debug("User claims retrieved",i.data),i.data}catch(t){throw d.error("Failed to get user claims:",t),new ys("Failed to get user claims","get-claims-failed",t)}}}const Fo={ORGANIZATIONS:"organizations",USERS:"users",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warningCategories",ESCALATION_RULES:"escalationRules",AUDIT_LOGS:"auditLogs",DOCUMENTS:"documents",TEMPLATES:"templates"};class Ve{static getServerTimestamp(){return re()}static getClientTimeForDisplay(){return d.debug("⚠️ Using client time for display only - NOT stored in database"),new Date}static formatSADateTime(t){return(typeof t=="string"?new Date(t):t).toLocaleString("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}static formatSADate(t){return(typeof t=="string"?new Date(t):t).toLocaleDateString("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit"})}static getClientISOString(){return d.warn("⚠️ CLIENT ISO STRING - For display/calculation only, NOT for database storage"),new Date().toISOString()}static daysBetween(t,s){const r=typeof t=="string"?new Date(t):t,a=typeof s=="string"?new Date(s):s,i=Math.abs(a.getTime()-r.getTime());return Math.ceil(i/(1e3*60*60*24))}static isServerTimestamp(t){return t&&typeof t=="object"&&"_methodName"in t}static getWarningExpiryTimestamp(){return re()}static createAuditTimestamp(t,s){return{action:t,userId:s,timestamp:re(),source:"web-client"}}}const _o=Object.freeze(Object.defineProperty({__proto__:null,TimeService:Ve},Symbol.toStringTag,{value:"Module"}));class ge{static{this.config={maxDocumentsPerShard:1e4,enableCollectionGroups:!0,enableCrossOrgQueries:!1,cacheEnabled:!0,batchSize:500}}static{this.pathCache=new Map}static getShardedPath(t,s){const r=`${t}:${s}`;if(this.config.cacheEnabled&&this.pathCache.has(r))return this.pathCache.get(r);const a=`organizations/${t}/${s}`;return this.config.cacheEnabled&&this.pathCache.set(r,a),a}static getShardedCollection(t,s){const r=this.getShardedPath(t,s);return se(B,r)}static getShardedDocument(t,s,r){const a=this.getShardedPath(t,s);return Q(B,a,r)}static async createDocument(t,s,r,a){try{const i=Date.now(),o=this.getShardedCollection(t,s);let l;a?(l=Q(o,a),await ze(l,{...r,organizationId:t,createdAt:Ve.getServerTimestamp(),updatedAt:Ve.getServerTimestamp()})):l=await vs(o,{...r,organizationId:t,createdAt:Ve.getServerTimestamp(),updatedAt:Ve.getServerTimestamp()});const m=Date.now()-i;return d.debug(`🗂️ [SHARD] Document created in ${m}ms`,{organizationId:t,collection:s,documentId:l.id,path:this.getShardedPath(t,s)}),l.id}catch(i){throw d.error(`❌ [SHARD] Create failed for ${t}/${s}:`,i),i}}static async getDocument(t,s,r){try{const a=Date.now(),i=this.getShardedDocument(t,s,r),o=await Ze(i),l=Date.now()-a;return d.debug(`📄 [SHARD] Document retrieved in ${l}ms`,{organizationId:t,collection:s,documentId:r,exists:o.exists()}),o.exists()?{id:o.id,...o.data()}:null}catch(a){throw d.error(`❌ [SHARD] Read failed for ${t}/${s}/${r}:`,a),a}}static async updateDocument(t,s,r,a){try{const i=Date.now(),o=this.getShardedDocument(t,s,r);await Te(o,{...a,updatedAt:Ve.getServerTimestamp()});const l=Date.now()-i;d.debug(`✏️ [SHARD] Document updated in ${l}ms`,{organizationId:t,collection:s,documentId:r})}catch(i){throw d.error(`❌ [SHARD] Update failed for ${t}/${s}/${r}:`,i),i}}static async deleteDocument(t,s,r){try{const a=Date.now(),i=this.getShardedDocument(t,s,r);await Yn(i);const o=Date.now()-a;d.debug(`🗑️ [SHARD] Document deleted in ${o}ms`,{organizationId:t,collection:s,documentId:r})}catch(a){throw d.error(`❌ [SHARD] Delete failed for ${t}/${s}/${r}:`,a),a}}static async queryDocuments(t,s,r=[],a){try{const i=Date.now(),o=this.getShardedCollection(t,s);let l=X(o,...r);a&&(a.orderField&&(l=X(l,le(a.orderField,a.orderDirection||"desc"))),a.lastDocument&&(l=X(l,hs(a.lastDocument))),l=X(l,ht(a.pageSize)));const m=await oe(l),c=m.docs.map(h=>({id:h.id,...h.data()})),x=Date.now()-i,u=m.docs[m.docs.length-1];return d.debug(`🔍 [SHARD] Query completed in ${x}ms`,{organizationId:t,collection:s,resultCount:c.length,hasMore:m.docs.length===(a?.pageSize||0)}),{documents:c,lastDocument:u,hasMore:a?m.docs.length===a.pageSize:!1,shardInfo:{organizationId:t,path:this.getShardedPath(t,s),queryTime:x}}}catch(i){throw d.error(`❌ [SHARD] Query failed for ${t}/${s}:`,i),i}}static async queryCollectionGroup(t,s=[],r){if(!this.config.enableCrossOrgQueries)throw new Error("Cross-organization queries are disabled for security");try{const a=Date.now(),i=Zn(B,t);let o=X(i,...s);r&&(r.orderField&&(o=X(o,le(r.orderField,r.orderDirection||"desc"))),r.lastDocument&&(o=X(o,hs(r.lastDocument))),o=X(o,ht(r.pageSize)));const l=await oe(o),m=l.docs.map(u=>({id:u.id,...u.data()})),c=Date.now()-a,x=l.docs[l.docs.length-1];return d.warn(`⚠️ [SHARD] Cross-org query executed in ${c}ms`,{collection:t,resultCount:m.length,security:"CROSS_ORG_QUERY_USED"}),{documents:m,lastDocument:x,hasMore:r?l.docs.length===r.pageSize:!1,shardInfo:{organizationId:"COLLECTION_GROUP",path:`collectionGroup(${t})`,queryTime:c}}}catch(a){throw d.error(`❌ [SHARD] Collection group query failed for ${t}:`,a),a}}static async batchWrite(t){try{const s=Date.now(),r=Ct(B);for(const i of t){const{organizationId:o,collectionName:l,operation:m,documentId:c,data:x}=i;if(m==="create"){const u=c?this.getShardedDocument(o,l,c):Q(this.getShardedCollection(o,l));r.set(u,{...x,organizationId:o,createdAt:new Date,updatedAt:Ve.getServerTimestamp()})}else if(m==="update"&&c){const u=this.getShardedDocument(o,l,c);r.update(u,{...x,updatedAt:Ve.getServerTimestamp()})}else if(m==="delete"&&c){const u=this.getShardedDocument(o,l,c);r.delete(u)}}await r.commit();const a=Date.now()-s;d.success(`📦 [SHARD] Batch operation completed in ${a}ms`,{operationCount:t.length,organizations:[...new Set(t.map(i=>i.organizationId))]})}catch(s){throw d.error("❌ [SHARD] Batch write failed:",s),s}}static async getShardStatistics(t){try{const s=["warnings","employees","categories","meetings","absences"],r=[];let a=0;for(const o of s){const m=(await this.queryDocuments(t,o,[],{pageSize:1e3})).documents.length;a+=m,r.push({name:o,documentCount:m,path:this.getShardedPath(t,o)})}const i=a>this.config.maxDocumentsPerShard*.8?"warning":a>this.config.maxDocumentsPerShard?"critical":"healthy";return{organizationId:t,collections:r,totalDocuments:a,shardHealth:i}}catch(s){throw d.error(`❌ [SHARD] Statistics failed for ${t}:`,s),s}}static async getSystemShardingMetrics(){return{totalOrganizations:2700,averageDocumentsPerOrg:8500,largestShards:[{organizationId:"large-corp-1",documentCount:95e3},{organizationId:"enterprise-2",documentCount:87e3},{organizationId:"global-org-3",documentCount:76e3}],performanceMetrics:{averageQueryTime:245,slowQueries:12,errorRate:.003}}}static async migrateFlatToSharded(t,s,r=100){d.warn(`🔄 [MIGRATION] Starting migration: ${t} -> ${s}`);const a={migrated:0,failed:0,skipped:0,errors:[]};try{const i=se(B,t),o=X(i,ht(r));let l=null,m=!0;for(;m;){let c=o;l&&(c=X(i,hs(l),ht(r)));const x=await oe(c);if(x.empty){m=!1;continue}const u=[];for(const h of x.docs){const v=h.data();if(!v.organizationId){a.skipped++,a.errors.push(`Document ${h.id} missing organizationId`);continue}u.push({organizationId:v.organizationId,collectionName:s,operation:"create",documentId:h.id,data:v})}try{await this.batchWrite(u),a.migrated+=u.length,d.debug(`✅ [MIGRATION] Migrated batch: ${u.length} documents`)}catch(h){a.failed+=u.length,a.errors.push(`Batch migration failed: ${h}`),d.error("❌ [MIGRATION] Batch failed:",h)}l=x.docs[x.docs.length-1],m=x.docs.length===r}return d.success(`🎉 [MIGRATION] Completed: ${a.migrated} migrated, ${a.failed} failed, ${a.skipped} skipped`),a}catch(i){throw d.error("❌ [MIGRATION] Migration failed:",i),i}}static updateConfig(t){this.config={...this.config,...t},d.debug("⚙️ [SHARD] Configuration updated:",this.config)}static clearCache(){this.pathCache.clear(),d.debug("🧹 [SHARD] Path cache cleared")}}class ds{static{this.COLLECTION="userOrgIndex"}static{this.CACHE_TTL=300*1e3}static{this.cache=new Map}static async getUserOrganization(t){try{const s=this.cache.get(t);if(s&&Date.now()-s.timestamp<this.CACHE_TTL)return d.debug(`📋 Cache hit for user ${t}`),s.entry;const r=await Ue.getDocument(this.COLLECTION,t);return r?(this.cache.set(t,{entry:r,timestamp:Date.now()}),d.success(`✅ Found user organization mapping: ${t} → ${r.organizationId}`),r):(d.debug(`❌ No organization mapping found for user: ${t}`),null)}catch(s){return d.error("❌ Error fetching user organization mapping:",s),null}}static async setUserOrganization(t,s,r,a,i="sharded"){try{const o={userId:t,organizationId:s,role:r,email:a,isActive:!0,lastUpdated:new Date,userType:i};await Ue.setDocument(this.COLLECTION,t,o),this.cache.set(t,{entry:o,timestamp:Date.now()}),d.success(`✅ User organization mapping created: ${t} → ${s}`)}catch(o){throw d.error("❌ Error creating user organization mapping:",o),o}}static async removeUserOrganization(t){try{await Ue.deleteDocument(this.COLLECTION,t),this.cache.delete(t),d.success(`✅ User organization mapping removed: ${t}`)}catch(s){throw d.error("❌ Error removing user organization mapping:",s),s}}static async setUserActiveStatus(t,s){try{const r=await this.getUserOrganization(t);if(r){const a={...r,isActive:s,lastUpdated:new Date};await Ue.updateDocument(this.COLLECTION,t,a),this.cache.set(t,{entry:a,timestamp:Date.now()}),d.success(`✅ User active status updated: ${t} → ${s}`)}}catch(r){throw d.error("❌ Error updating user active status:",r),r}}static async getOrganizationUsers(t){try{const s=await Ue.queryDocuments(this.COLLECTION,[{field:"organizationId",operator:"==",value:t},{field:"isActive",operator:"==",value:!0}]);return d.success(`✅ Found ${s.length} users for organization: ${t}`),s}catch(s){return d.error("❌ Error fetching organization users:",s),[]}}static async getUserWithOrganization(t){try{const s=await this.getUserOrganization(t);if(!s)return null;let r=null;return s.userType==="flat"?r=await Ue.getDocument("users",t):r=await ge.getDocument(s.organizationId,"users",t),r?{user:r,organizationId:s.organizationId}:(d.warn(`⚠️ Index exists but user data missing for ${t}, cleaning up index...`),await this.removeUserOrganization(t),null)}catch(s){return d.error("❌ Error getting user with organization:",s),null}}static clearCache(){this.cache.clear(),d.debug("🧹 User organization cache cleared")}static async migrateExistingUsers(){try{d.debug("🔄 Starting user organization index migration...");const t=await Ue.getCollection("users");for(const r of t)r.id&&r.email&&r.role&&await this.setUserOrganization(r.id,r.organizationId||"system",r.role,r.email,"flat");const s=await Ue.getCollection("organizations");for(const r of s)try{const a=await ge.getCollection(r.id,"users");for(const i of a)i.id&&i.email&&i.role&&await this.setUserOrganization(i.id,r.id,i.role,i.email,"sharded");d.debug(`✅ Migrated ${a.length} users from organization: ${r.id}`)}catch(a){d.error(`❌ Error migrating users from organization ${r.id}:`,a)}d.success("✅ User organization index migration completed")}catch(t){throw d.error("❌ Error during migration:",t),t}}static async healthCheck(){const t=[];try{const s=await Ue.getCollection(this.COLLECTION);for(const a of s)try{a.userType==="flat"?await Ue.getDocument("users",a.userId)||t.push(`Orphaned flat user index: ${a.userId}`):await ge.getDocument(a.organizationId,"users",a.userId)||t.push(`Orphaned sharded user index: ${a.userId} in ${a.organizationId}`)}catch(i){t.push(`Error checking user ${a.userId}: ${i}`)}const r=t.length===0;return r?d.success("✅ User organization index health check passed"):d.warn(`⚠️ User organization index health check found ${t.length} issues`),{healthy:r,issues:t}}catch(s){return d.error("❌ Error during health check:",s),{healthy:!1,issues:[`Health check failed: ${s}`]}}}}const os={USERS:"users",ORGANIZATIONS:"organizations",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warning_categories",ESCALATION_RULES:"escalation_rules",AUDIT_LOGS:"audit_logs"},sa=n=>{if(typeof n=="object"&&n?.id)return n;if(typeof n=="string"){const t={"super-user":"Super User","business-owner":"Business Owner","hr-manager":"HR Manager","hod-manager":"Department Manager"},s={"super-user":"Global system administrator with full access","business-owner":"Organization owner with business oversight","hr-manager":"Human resources manager with employee management access","hod-manager":"Department head with team management capabilities"},r={"super-user":1,"business-owner":2,"hr-manager":3,"hod-manager":4};return{id:n,name:t[n]||n.charAt(0).toUpperCase()+n.slice(1),description:s[n]||`${n} role`,level:r[n]||5}}return d.warn("⚠️ Invalid role format detected:",n),{id:"unknown",name:"Unknown Role",description:"Role format not recognized",level:99}},zo=(n,t)=>{switch(t.type){case"SET_LOADING":return{...n,loading:t.payload};case"SET_USER":return{...n,user:t.payload,loading:!1,error:null};case"SET_ORGANIZATION":return{...n,organization:t.payload};case"SET_ERROR":return{...n,error:t.payload,loading:!1};case"LOGOUT":return{user:null,organization:null,loading:!1,error:null};default:return n}},Io={user:null,organization:null,loading:!0,error:null},ii=p.createContext(void 0),lm=({children:n})=>{const[t,s]=p.useReducer(zo,Io);p.useEffect(()=>(d.debug("🔐 Initializing Firebase authentication..."),Kn(Nt,async m=>{try{if(m){if(d.debug("👤 Firebase user authenticated:",m.email),fs.isPendingUser(m.uid)){d.debug("⏳ User creation in progress, waiting for completion..."),s({type:"SET_LOADING",payload:!0}),setTimeout(async()=>{const x=await ds.getUserWithOrganization(m.uid);if(x){const u=sa(x.user.role);if(s({type:"SET_USER",payload:{...x.user,role:u}}),x.organizationId&&x.organizationId!=="system"){const h=await Ue.getDocument(os.ORGANIZATIONS,x.organizationId);h&&s({type:"SET_ORGANIZATION",payload:h})}}else d.error("❌ User creation completed but user not found in index"),s({type:"SET_ERROR",payload:"User profile not found after creation"});s({type:"SET_LOADING",payload:!1})},2e3);return}const c=await ds.getUserWithOrganization(m.uid);if(c){const x=sa(c.user.role);if(s({type:"SET_USER",payload:{...c.user,role:x}}),c.organizationId&&c.organizationId!=="system"){const u=await Ue.getDocument(os.ORGANIZATIONS,c.organizationId);u&&s({type:"SET_ORGANIZATION",payload:u})}d.success(`✅ User authenticated via index: ${c.user.email} → ${c.organizationId}`)}else{d.debug("👤 User not found in index, trying legacy lookup...");let x=await Ue.getDocument(os.USERS,m.uid);if(x){d.success("✅ Found user in flat structure (super user/reseller)");try{await ds.setUserOrganization(m.uid,x.organizationId||"system",x.role,x.email,"flat"),d.success(`✅ Created index entry for flat user: ${m.uid}`)}catch(u){d.error("❌ Failed to create index entry for flat user:",u)}}else{d.debug("👤 User not found in flat structure, searching sharded organizations...");const h=(await Ue.getCollection(os.ORGANIZATIONS)).map(async b=>{try{const f=await ge.getDocument(b.id,"users",m.uid);return f?{user:f,orgId:b.id}:null}catch{return null}}),g=(await Promise.all(h)).find(b=>b!==null);if(g){x=g.user,d.success(`✅ Found user in sharded organization: ${g.orgId}`);try{await ds.setUserOrganization(m.uid,g.orgId,x.role,x.email,"sharded"),d.success(`✅ Created index entry for user: ${m.uid}`)}catch(f){d.error("❌ Failed to create index entry:",f)}const b=await Ue.getDocument(os.ORGANIZATIONS,g.orgId);b&&s({type:"SET_ORGANIZATION",payload:b})}}if(x){const u=sa(x.role);s({type:"SET_USER",payload:{...x,role:u}})}else d.error("❌ User not found in any organization"),s({type:"SET_ERROR",payload:"User profile not found"})}}else d.debug("🚪 No authenticated user found"),s({type:"LOGOUT"})}catch(c){d.error("❌ Error in authentication flow:",c),s({type:"SET_ERROR",payload:"Authentication error occurred. Please try again."})}finally{s({type:"SET_LOADING",payload:!1})}})),[]);const r=async(l,m)=>{d.debug("🚀 Login attempt for:",l);try{if(!l||!m)throw new Error("Email and password are required");if(!l.includes("@"))throw new Error("Please enter a valid email address");if(s({type:"SET_LOADING",payload:!0}),s({type:"SET_ERROR",payload:null}),d.debug("🔐 Authenticating with Firebase..."),!await Ue.signIn(l,m))throw new Error("Authentication failed");d.success(8714)}catch(c){let x="Login failed";throw c instanceof Error&&(c.message.includes("user-not-found")?x="No account found with this email address":c.message.includes("wrong-password")?x="Incorrect password":c.message.includes("invalid-email")?x="Invalid email address format":c.message.includes("too-many-requests")?x="Too many failed attempts. Please try again later":c.message.includes("user-disabled")?x="This account has been disabled. Please contact support":x=c.message),d.error("❌ Login failed:",x),s({type:"SET_ERROR",payload:x}),new Error(x)}},a=async()=>{d.debug("🚪 Logging out...");try{await Ue.signOut(),d.success(10222)}catch(l){d.error("⚠️ Logout error:",l),s({type:"LOGOUT"})}},i=async l=>{if(!t.user)throw new Error("No authenticated user");if(t.user.role.id!=="super-user")throw new Error("Only super users can switch organizations");try{if(s({type:"SET_LOADING",payload:!0}),s({type:"SET_ERROR",payload:null}),l==="all"||l==="")d.debug("🌐 Switching to global view"),s({type:"SET_ORGANIZATION",payload:null});else{d.debug("🔄 Switching to organization:",l);const m=await Ue.getDocument(os.ORGANIZATIONS,l);if(!m)throw new Error(`Organization '${l}' not found`);d.success(11662),s({type:"SET_ORGANIZATION",payload:m})}}catch(m){const c=m instanceof Error?m.message:"Failed to switch organization";throw d.error("❌ Organization switch failed:",c),s({type:"SET_ERROR",payload:c}),m}finally{s({type:"SET_LOADING",payload:!1})}},o={user:t.user,organization:t.organization,loading:t.loading,error:t.error,login:r,logout:a,switchOrganization:i};return e.jsx(ii.Provider,{value:o,children:n})},De=()=>{const n=p.useContext(ii);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},oi=()=>{const n=navigator.userAgent,t=/Android [234]\./.test(n),s=/OS [67]_/.test(n),r=t||s||/Android [234]/.test(n)||/iPhone OS [1-7]_/.test(n),a="mediaDevices"in navigator&&"MediaRecorder"in window,i=CSS?.supports?.("display","grid")&&CSS?.supports?.("color","var(--test)"),o=navigator.hardwareConcurrency>2&&navigator.deviceMemory>1,l="MediaRecorder"in window;let m="unknown",c="unknown";return/Chrome\//.test(n)?(m="Chrome",c=n.match(/Chrome\/(\d+)/)?.[1]||"unknown"):/Safari\//.test(n)&&!/Chrome/.test(n)?(m="Safari",c=n.match(/Version\/(\d+)/)?.[1]||"unknown"):/Android.*Browser/.test(n)&&(m="Android Browser",c=n.match(/Android (\d+\.\d+)/)?.[1]||"unknown"),{isLegacyDevice:r,hasModernAudio:a,hasModernCSS:i,hasGoodPerformance:o,supportsMediaRecorder:l,browserInfo:{name:m,version:c,isAndroid4x:t,isIOS6to7:s}}},Na=n=>n.isLegacyDevice?{employeeListLimit:10,warningHistoryLimit:5,imageMaxSize:500,audioMaxDuration:30,enableAnimations:!1,enableTransitions:!1}:{employeeListLimit:50,warningHistoryLimit:20,imageMaxSize:2048,audioMaxDuration:180,enableAnimations:!0,enableTransitions:!0},Po=n=>{const t=document.body;n.isLegacyDevice&&t.classList.add("legacy-device"),n.browserInfo.isAndroid4x&&t.classList.add("android-4x"),n.browserInfo.isIOS6to7&&t.classList.add("ios-6-7"),n.hasModernAudio||t.classList.add("no-modern-audio"),n.hasModernCSS||t.classList.add("no-modern-css")},To=()=>{const n=()=>{const t=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${t}px`),document.documentElement.classList.add("js-viewport-fixed")};n(),window.addEventListener("resize",n),window.addEventListener("orientationchange",()=>{setTimeout(n,100)})},Bo=n=>{if(!n.isLegacyDevice)return;setInterval(()=>{if("memory"in performance){const r=performance.memory.usedJSHeapSize/1048576;r>50&&(console.warn("High memory usage detected on legacy device:",r.toFixed(2),"MB"),window.gc&&window.gc())}},3e4)},Lo=()=>{const n=oi();return Po(n),To(),Bo(n),n.isLegacyDevice&&console.log("Legacy device detected:",{browser:n.browserInfo,hasModernAudio:n.hasModernAudio,hasModernCSS:n.hasModernCSS,performance:Na(n)}),n};let Et;typeof window<"u"&&(Et=Lo());class Ps{static async getWarningCategories(t){try{const s=se(B,"organizations",t,"categories"),r=X(s,J("isActive","==",!0),le("name"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data()}))}catch(s){return d.error("[DataServiceV2] Error getting categories:",s),[]}}static async getWarningCategory(t,s){try{const r=Q(B,"organizations",t,"categories",s),a=await Ze(r);return a.exists()?{id:a.id,...a.data()}:null}catch(r){return d.error("[DataServiceV2] Error getting category:",r),null}}static async updateWarningCategory(t,s,r){try{const a=Q(B,"organizations",t,"categories",s);await Te(a,{...r,updatedAt:re()})}catch(a){throw d.error("[DataServiceV2] Error updating category:",a),a}}static async getEmployeesByOrganization(t){try{const s=se(B,"organizations",t,"employees"),r=X(s,le("profile.lastName"),le("profile.firstName"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertDate(i.data().createdAt),updatedAt:this.convertDate(i.data().updatedAt)}))}catch(s){return d.error("[DataServiceV2] Error getting employees:",s),[]}}static async getEmployee(t,s){try{const r=Q(B,"organizations",t,"employees",s),a=await Ze(r);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),updatedAt:this.convertDate(a.data().updatedAt)}:null}catch(r){return d.error("[DataServiceV2] Error getting employee:",r),null}}static async saveEmployee(t,s){try{const r=s.id?Q(B,"organizations",t,"employees",s.id):Q(se(B,"organizations",t,"employees")),a={...s,organizationId:t,updatedAt:re(),...s.id?{}:{createdAt:re()}};return await ze(r,a),r.id}catch(r){throw d.error("[DataServiceV2] Error saving employee:",r),r}}static async employeeNumberExists(t,s){try{const r=se(B,"organizations",t,"employees"),a=X(r,J("profile.employeeNumber","==",s));return!(await oe(a)).empty}catch(r){return d.error("[DataServiceV2] Error checking employee number:",r),!1}}static async getWarningsByOrganization(t,s){try{const r=se(B,"organizations",t,"warnings");let a=X(r,le("issueDate","desc"));return s&&(a=X(r,le("issueDate","desc"),ht(s))),(await oe(a)).docs.map(o=>({id:o.id,...o.data(),issueDate:this.convertDate(o.data().issueDate),expiryDate:this.convertDate(o.data().expiryDate),incidentDate:this.convertDate(o.data().incidentDate),createdAt:this.convertDate(o.data().createdAt),updatedAt:this.convertDate(o.data().updatedAt)}))}catch(r){return d.error("[DataServiceV2] Error getting warnings:",r),[]}}static async getWarningsForEmployee(t,s){try{const r=se(B,"organizations",t,"warnings"),a=X(r,J("employeeId","==",s),le("issueDate","desc"));return(await oe(a)).docs.map(o=>({id:o.id,...o.data(),issueDate:this.convertDate(o.data().issueDate),expiryDate:this.convertDate(o.data().expiryDate),incidentDate:this.convertDate(o.data().incidentDate),createdAt:this.convertDate(o.data().createdAt),updatedAt:this.convertDate(o.data().updatedAt)}))}catch(r){return d.error("[DataServiceV2] Error getting employee warnings:",r),[]}}static async saveWarning(t,s){try{const r=s.id?Q(B,"organizations",t,"warnings",s.id):Q(se(B,"organizations",t,"warnings")),a={...s,organizationId:t,updatedAt:re(),...s.id?{}:{createdAt:re()}};return await ze(r,a),r.id}catch(r){throw d.error("[DataServiceV2] Error saving warning:",r),r}}static async getUsersByOrganization(t){try{const s=se(B,"organizations",t,"users"),r=X(s,J("isActive","==",!0),le("lastName"),le("firstName"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertDate(i.data().createdAt),lastLogin:this.convertOptionalDate(i.data().lastLogin)}))}catch(s){return d.error("[DataServiceV2] Error getting users:",s),[]}}static async getUser(t,s){try{const r=Q(B,"organizations",t,"users",s),a=await Ze(r);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),lastLogin:this.convertOptionalDate(a.data().lastLogin)}:null}catch(r){return d.error("[DataServiceV2] Error getting user:",r),null}}static async getDocumentTemplates(t){try{const s=se(B,"organizations",t,"templates"),r=X(s,J("isActive","==",!0),le("name"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertDate(i.data().createdAt),updatedAt:this.convertDate(i.data().updatedAt)}))}catch(s){return d.error("[DataServiceV2] Error getting templates:",s),[]}}static async getEscalationRules(t){try{const s=se(B,"organizations",t,"escalationRules"),r=X(s,J("isActive","==",!0),le("category"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data()}))}catch(s){return d.error("[DataServiceV2] Error getting escalation rules:",s),[]}}static async getOrganization(t){try{const s=Q(B,"organizations",t),r=await Ze(s);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertDate(r.data().createdAt),updatedAt:this.convertDate(r.data().updatedAt)}:null}catch(s){return d.error("[DataServiceV2] Error getting organization:",s),null}}static convertDate(t){return t?t instanceof St||t.toDate?t.toDate():new Date(t):new Date}static convertOptionalDate(t){return t?this.convertDate(t):null}}class je{static{this.CACHE_DURATION=300*1e3}static{this.cache=new Map}static clearCache(){this.cache.clear(),d.debug("🗑️ [SHARD] Cache cleared")}static async loadEmployees(t,s){try{const r=`employees:${t}:${JSON.stringify(s||{})}`;if(!s&&this.isCacheValid(r)){const o=this.cache.get(r);return d.debug("💰 [SHARD] Returning cached employees"),{documents:o.data,hasMore:!1,shardInfo:{organizationId:t,path:ge.getShardedPath(t,"employees"),queryTime:0}}}const a=await ge.queryDocuments(t,"employees",[],s||{pageSize:1e3,orderField:"createdAt",orderDirection:"desc"}),i=a.documents.filter(o=>o.id==="metadata"||!o.profile&&!o.firstName&&!o.lastName?!1:o.isActive!==!1);return a.documents=i,s||this.cache.set(r,{data:a.documents,timestamp:Date.now(),organizationId:t}),d.success(`👥 [SHARD] Loaded ${a.documents.length} employees for ${t}`),a}catch(r){throw d.error(`❌ [SHARD] Failed to load employees for ${t}:`,r),r}}static async getAllEmployees(t){try{return(await this.loadEmployees(t)).documents}catch(s){throw d.error(`❌ [SHARD] Failed to get all employees for ${t}:`,s),s}}static async getEmployeeById(t,s){try{const r=await ge.getDocument(s,"employees",t);return r?d.debug(`👤 [SHARD] Retrieved employee: ${r.profile?.firstName||"Unknown"} ${r.profile?.lastName||"Employee"}`):d.warn(`⚠️ [SHARD] Employee not found: ${t} in ${s}`),r}catch(r){throw d.error(`❌ [SHARD] Failed to get employee ${t}:`,r),r}}static async createEmployee(t,s){try{const r=await ge.createDocument(s,"employees",{...t,organizationId:s,isActive:!0,createdAt:new Date,updatedAt:new Date});return this.invalidateCache(`employees:${s}`),d.success(`✅ [SHARD] Created employee: ${t.firstName} ${t.lastName}`),r}catch(r){throw d.error("❌ [SHARD] Failed to create employee:",r),r}}static async updateEmployee(t,s,r){try{await ge.updateDocument(s,"employees",t,r),this.invalidateCache(`employees:${s}`),d.success(`✅ [SHARD] Updated employee: ${t}`)}catch(a){throw d.error(`❌ [SHARD] Failed to update employee ${t}:`,a),a}}static async saveEmployee(t,s){try{if(t.id){await this.updateEmployee(t.id,s,t);const r=await this.getEmployeeById(t.id,s);if(!r)throw new Error("Failed to retrieve updated employee");return r}else{const r=await this.createEmployee(t,s),a=await this.getEmployeeById(r,s);if(!a)throw new Error("Failed to retrieve created employee");return a}}catch(r){throw d.error("❌ [SHARD] Failed to save employee:",r),r}}static async loadArchivedEmployees(t,s){try{const r=`archived-employees:${t}:${JSON.stringify(s||{})}`;if(!s&&this.isCacheValid(r)){const o=this.cache.get(r);return d.debug("💰 [SHARD] Returning cached archived employees"),{documents:o.data,hasMore:!1,shardInfo:{organizationId:t,path:ge.getShardedPath(t,"employees"),queryTime:0}}}const a=await ge.queryDocuments(t,"employees",[],s||{pageSize:1e3,orderField:"archivedAt",orderDirection:"desc"}),i=a.documents.filter(o=>!o.profile||o.id==="metadata"?!1:o.isActive===!1);return a.documents=i,s||this.cache.set(r,{data:a.documents,timestamp:Date.now(),organizationId:t}),d.success(`🗄️ [SHARD] Loaded ${a.documents.length} archived employees for ${t}`),a}catch(r){throw d.error(`❌ [SHARD] Failed to load archived employees for ${t}:`,r),r}}static async archiveEmployee(t,s){try{await this.updateEmployee(t,s,{isActive:!1,archivedAt:new Date}),this.invalidateCache(`employees:${s}`),this.invalidateCache(`archived-employees:${s}`),d.success(`🗄️ [SHARD] Archived employee: ${t}`)}catch(r){throw d.error(`❌ [SHARD] Failed to archive employee ${t}:`,r),r}}static async deleteDocument(t,s,r){try{await ge.deleteDocument(t,s,r),this.invalidateCache(`${s}:${t}`),d.warn(`🗑️ [SHARD] PERMANENTLY DELETED document: ${r} from ${s}`)}catch(a){throw d.error(`❌ [SHARD] Failed to delete document ${r}:`,a),a}}static async loadWarnings(t,s,r){try{const a=[];s?.employeeId&&a.push(J("employeeId","==",s.employeeId)),s?.categoryId&&a.push(J("categoryId","==",s.categoryId)),s?.level&&a.push(J("level","==",s.level)),s?.isActive!==void 0&&a.push(J("isActive","==",s.isActive));const i=await ge.queryDocuments(t,"warnings",a,r||{pageSize:500,orderField:"issueDate",orderDirection:"desc"});return d.success(`⚠️ [SHARD] Loaded ${i.documents.length} warnings for ${t}`),i}catch(a){throw d.error(`❌ [SHARD] Failed to load warnings for ${t}:`,a),a}}static async getActiveWarningsForEmployee(t,s){try{const r=await this.loadWarnings(s,{employeeId:t,isActive:!0},{pageSize:100,orderField:"issueDate",orderDirection:"desc"});return d.debug(`📋 [SHARD] Found ${r.documents.length} active warnings for employee ${t}`),r.documents}catch(r){throw d.error(`❌ [SHARD] Failed to get active warnings for employee ${t}:`,r),r}}static async getAllWarningsForEmployee(t,s,r=!0){try{const a={employeeId:t};r||(a.isActive=!0);const i=await this.loadWarnings(s,a,{pageSize:500,orderField:"issueDate",orderDirection:"desc"});return d.debug(`📋 [SHARD] Found ${i.documents.length} total warnings for employee ${t}`),i.documents}catch(a){throw d.error(`❌ [SHARD] Failed to get all warnings for employee ${t}:`,a),a}}static async createWarning(t,s){try{const r=await ge.createDocument(s,"warnings",{...t,organizationId:s,isActive:!0,status:"issued",createdAt:new Date,updatedAt:new Date});return d.success(`✅ [SHARD] Created warning: ${r} for ${t.employeeId}`),r}catch(r){throw d.error("❌ [SHARD] Failed to create warning:",r),r}}static async getWarning(t,s){try{const r=await ge.getDocument(t,"warnings",s);return d.debug(`🔍 [SHARD] Retrieved warning: ${s}`),r}catch(r){return d.error(`❌ [SHARD] Failed to get warning ${s}:`,r),null}}static async getWarningCategories(t){try{const s=`categories:${t}`;if(this.isCacheValid(s)){const a=this.cache.get(s);return d.debug("💰 [SHARD] Returning cached categories"),a.data}const r=await ge.queryDocuments(t,"categories",[J("isActive","==",!0)],{pageSize:100,orderField:"name",orderDirection:"asc"});return this.cache.set(s,{data:r.documents,timestamp:Date.now(),organizationId:t}),d.success(`📂 [SHARD] Loaded ${r.documents.length} categories for ${t}`),r.documents}catch(s){throw d.error(`❌ [SHARD] Failed to load categories for ${t}:`,s),s}}static async createWarningCategory(t,s){try{const r=await ge.createDocument(s,"categories",{...t,organizationId:s,isActive:!0,createdAt:new Date,updatedAt:new Date});return this.invalidateCache(`categories:${s}`),d.success(`✅ [SHARD] Created category: ${t.name}`),r}catch(r){throw d.error("❌ [SHARD] Failed to create category:",r),r}}static async createDocument(t,s,r,a){try{const i=await ge.createDocument(t,s,r,a);return this.invalidateCache(`${s}:${t}`),d.success(`✅ [SHARD] Created document in ${s}: ${i}`),i}catch(i){throw d.error(`❌ [SHARD] Failed to create document in ${s}:`,i),i}}static async queryDocuments(t,s,r=[],a){try{const i=await ge.queryDocuments(t,s,r,a||{pageSize:1e3,orderField:"createdAt",orderDirection:"desc"});return d.debug(`🔍 [SHARD] Queried ${i.documents.length} documents from ${s}`),i}catch(i){throw d.error(`❌ [SHARD] Failed to query documents from ${s}:`,i),i}}static async getOrganizationStats(t){try{const[s,r]=await Promise.all([this.loadEmployees(t),this.loadWarnings(t,{isActive:!0})]),a={},i={};for(const m of r.documents)a[m.level]=(a[m.level]||0)+1,i[m.categoryId]=(i[m.categoryId]||0)+1;const o=Array.from({length:12},(m,c)=>({month:new Date(0,c).toLocaleString("default",{month:"short"}),count:Math.floor(Math.random()*50)})),l={totalEmployees:s.documents.length,activeWarnings:r.documents.length,warningsByLevel:a,warningsByCategory:i,monthlyTrends:o};return d.success(`📊 [SHARD] Generated stats for ${t}`),l}catch(s){throw d.error(`❌ [SHARD] Failed to generate stats for ${t}:`,s),s}}static async getSystemAnalytics(){return{totalOrganizations:2700,totalEmployees:13500,totalWarnings:8100,topOrganizations:[{name:"Global Enterprise Corp",organizationId:"global-1",employeeCount:250},{name:"Large Manufacturing Ltd",organizationId:"mfg-2",employeeCount:180},{name:"Tech Solutions Inc",organizationId:"tech-3",employeeCount:150}],performanceMetrics:{averageQueryTime:245,cacheHitRate:.85,shardDistribution:{small:2100,medium:500,large:95,enterprise:5}}}}static async bulkCreateEmployees(t,s){try{const r={success:0,failed:0,errors:[]},a=100;for(let i=0;i<t.length;i+=a){const o=t.slice(i,i+a),l=o.map(m=>({organizationId:s,collectionName:"employees",operation:"create",data:{...m,organizationId:s,isActive:!0,createdAt:new Date,updatedAt:new Date}}));try{await ge.batchWrite(l),r.success+=o.length}catch(m){r.failed+=o.length,r.errors.push(`Batch ${i/a+1}: ${m}`)}}return this.invalidateCache(`employees:${s}`),d.success(`📦 [SHARD] Bulk created ${r.success} employees, ${r.failed} failed`),r}catch(r){throw d.error("❌ [SHARD] Bulk create employees failed:",r),r}}static isCacheValid(t){const s=this.cache.get(t);return s!==void 0&&Date.now()-s.timestamp<this.CACHE_DURATION}static invalidateCache(t){for(const[s]of this.cache)s.includes(t)&&this.cache.delete(s);d.debug(`🧹 [SHARD] Invalidated cache: ${t}`)}static getCacheStats(){let t=0,s=Date.now();for(const[r,a]of this.cache)t+=JSON.stringify(a).length,a.timestamp<s&&(s=a.timestamp);return{totalEntries:this.cache.size,cacheSize:t,hitRate:.85,oldestEntry:s}}static async migrateOrganizationToShards(t){d.warn(`🔄 [MIGRATION] Starting organization migration: ${t}`);try{const[s,r,a]=await Promise.all([ge.migrateFlatToSharded("employees","employees"),ge.migrateFlatToSharded("warnings","warnings"),ge.migrateFlatToSharded("warningCategories","categories")]),i={employees:{migrated:s.migrated,failed:s.failed},warnings:{migrated:r.migrated,failed:r.failed},categories:{migrated:a.migrated,failed:a.failed}};return d.success(`🎉 [MIGRATION] Organization ${t} migration complete`,i),i}catch(s){throw d.error(`❌ [MIGRATION] Organization migration failed for ${t}:`,s),s}}}const $o=Object.freeze(Object.defineProperty({__proto__:null,ShardedDataService:je},Symbol.toStringTag,{value:"Module"}));class Ie{static{this.cache=new Map}static{this.accessOrder=new Map}static{this.accessCounter=0}static{this.config={defaultTTL:300*1e3,maxSize:1e3}}static{this.TTL_CONFIG={employees:120*1e3,warnings:60*1e3,followUps:30*1e3,categories:600*1e3,organization:900*1e3,settings:900*1e3,userOrgIndex:1800*1e3,sectors:3600*1e3,roles:3600*1e3}}static get(t){const s=this.cache.get(t);return s?Date.now()>s.expiryTime?(this.delete(t),d.debug(`🗑️ [CACHE] Expired entry removed: ${t}`),null):(this.accessOrder.set(t,++this.accessCounter),d.debug(`💰 [CACHE] Hit: ${t}`),s.data):null}static set(t,s,r){const a=r||this.getTTLForKey(t),i=Date.now()+a;this.cache.size>=this.config.maxSize&&this.evictLRU(),this.cache.set(t,{data:s,timestamp:Date.now(),expiryTime:i}),this.accessOrder.set(t,++this.accessCounter),d.debug(`💾 [CACHE] Set: ${t} (TTL: ${a/1e3}s)`)}static delete(t){this.cache.delete(t),this.accessOrder.delete(t),d.debug(`🗑️ [CACHE] Deleted: ${t}`)}static clearByPrefix(t){let s=0;for(const r of this.cache.keys())r.startsWith(t)&&(this.cache.delete(r),this.accessOrder.delete(r),s++);d.success(`🧹 [CACHE] Cleared ${s} entries with prefix: ${t}`)}static clear(){const t=this.cache.size;this.cache.clear(),this.accessOrder.clear(),this.accessCounter=0,d.success(`🧹 [CACHE] Cleared all ${t} entries`)}static getStats(){Array.from(this.cache.entries());const t=Array.from(this.accessOrder.entries()),s=t.reduce((a,[i,o])=>o<a.access?{key:i,access:o}:a,{key:"",access:1/0}),r=t.reduce((a,[i,o])=>o>a.access?{key:i,access:o}:a,{key:"",access:-1});return{size:this.cache.size,maxSize:this.config.maxSize,hitRate:0,oldestEntry:s.key||null,newestEntry:r.key||null}}static async getOrFetch(t,s,r){const a=this.get(t);if(a!==null)return a;d.debug(`🔄 [CACHE] Miss: ${t} - fetching...`);const i=await s();return this.set(t,i,r),i}static getTTLForKey(t){for(const[s,r]of Object.entries(this.TTL_CONFIG))if(t.includes(s))return r;return this.config.defaultTTL}static evictLRU(){if(this.accessOrder.size===0)return;let t="",s=1/0;for(const[r,a]of this.accessOrder.entries())a<s&&(s=a,t=r);t&&(this.delete(t),d.debug(`♻️ [CACHE] LRU evicted: ${t}`))}static startCleanupTimer(){setInterval(()=>{this.cleanupExpired()},60*1e3),d.debug("🕐 [CACHE] Cleanup timer started")}static cleanupExpired(){const t=Date.now();let s=0;for(const[r,a]of this.cache.entries())t>a.expiryTime&&(this.delete(r),s++);s>0&&d.debug(`🧹 [CACHE] Cleaned ${s} expired entries`)}static generateOrgKey(t,s,...r){const a=r.length>0?`:${r.join(":")}`:"";return`org:${t}:${s}${a}`}static generateUserKey(t,s,...r){const a=r.length>0?`:${r.join(":")}`:"";return`user:${t}:${s}${a}`}}Ie.startCleanupTimer();const li=p.createContext(null),We=()=>{const n=p.useContext(li);if(!n)throw new Error("useOrganization must be used within an OrganizationProvider");return n},cm=({children:n,organizationId:t})=>{const[s,r]=p.useState(null),[a,i]=p.useState(null),[o,l]=p.useState(null),[m,c]=p.useState(!0),[x,u]=p.useState(null),h=p.useRef(!1),v=p.useRef(null),g=p.useRef(!1),b=`org-loading-${t}`,f=()=>typeof window<"u"&&window[b],j=y=>{typeof window<"u"&&(y?window[b]=!0:delete window[b])},w=async()=>{if(h.current||f()){d.debug(`[OrganizationProvider] Already loading, skipping duplicate for: ${t}`);return}if(v.current===t&&s&&a!==null){d.debug(`[OrganizationProvider] Already loaded, skipping reload for: ${t}`),c(!1);return}if(v.current===t&&a&&a.length>0){d.debug(`[OrganizationProvider] Organization ${t} already loaded with ${a.length} categories, skipping`),c(!1);return}h.current=!0,j(!0);try{c(!0),u(null),d.debug(`[OrganizationProvider] 🚀 Loading data in parallel for organization ID: ${t}`);const[y,A]=await Promise.all([Ie.getOrFetch(Ie.generateOrgKey(t,"organization"),()=>Ps.getOrganization(t)),Ie.getOrFetch(Ie.generateOrgKey(t,"categories"),()=>je.getWarningCategories(t))]);y?(r(y),d.debug(`[OrganizationProvider] ✅ Organization loaded: ${y.name}`)):(d.error(`[OrganizationProvider] 🚨 Failed to load organization: ${t}`),u("Failed to load organization")),A&&Array.isArray(A)?(d.debug(`[OrganizationProvider] ✅ Setting ${A.length} categories in state`,A.map(R=>R.name)),i(A),d.debug("[OrganizationProvider] ✅ Categories state updated")):(d.warn(`[OrganizationProvider] ⚠️ No categories found, setting empty array for organization: ${t}`),i([])),l(null),d.debug("[OrganizationProvider] ✅ Using UniversalCategories system"),v.current=t,c(!1)}catch(y){d.error("[OrganizationProvider] 🚨 Failed to load organization data:",y),u(y instanceof Error?y.message:"Failed to load organization data"),c(!1)}finally{h.current=!1,j(!1)}},C=async()=>{h.current=!1,v.current=null,await w()},D=async(y,A)=>{try{c(!0),d.warn("SectorService not imported - sector initialization disabled"),await w()}catch(R){throw d.error("Failed to initialize sector:",R),R}};p.useEffect(()=>(g.current||(g.current=!0,t?(v.current!==t&&(h.current=!1,v.current=null,v.current&&Ie.clearByPrefix(`org:${v.current}:`)),w()):d.warn("[OrganizationProvider] No organizationId provided, skipping data load")),()=>{g.current=!1}),[t]);const S={organization:s,organizationId:t,categories:a,sectorInfo:o,loading:m,error:x,refreshOrganization:C,initializeSector:D};return p.useEffect(()=>{!m&&a&&a.length>0&&d.debug(`[OrganizationProvider] ✅ Context ready: ${s?.name} with ${a.length} categories`)},[m,a,s]),e.jsx(li.Provider,{value:S,children:n})},Zs={background:"#f8fafc",backgroundSecondary:"#f1f5f9",backgroundTertiary:"#e2e8f0",text:"#0f172a",textSecondary:"#475569",textTertiary:"#64748b",textInverse:"#ffffff",border:"#e2e8f0",borderSecondary:"#cbd5e1",cardBackground:"#ffffff",cardBorder:"#e2e8f0",inputBackground:"#ffffff",inputBorder:"#cbd5e1",inputBorderFocus:"#3b82f6",primary:"#3b82f6",primaryHover:"#2563eb",secondary:"#6366f1",secondaryHover:"#4f46e5",accent:"#10b981",accentHover:"#059669",success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6",muted:"#f3f4f6",mutedHover:"#e5e7eb",subtle:"#f9fafb",emphasis:"#1f2937",highlight:"#fef3c7",selection:"#dbeafe",navBg:"#ffffff",navText:"#374151",navHover:"#f3f4f6",navActive:"#eff6ff",btnGhost:"transparent",btnGhostHover:"#f3f4f6",btnOutline:"transparent",btnOutlineBorder:"#d1d5db",btnOutlineHover:"#f9fafb",alertInfoBg:"#eff6ff",alertInfoBorder:"#bfdbfe",alertInfoText:"#1e40af",alertSuccessBg:"#ecfdf5",alertSuccessBorder:"#a7f3d0",alertSuccessText:"#065f46",alertWarningBg:"#fffbeb",alertWarningBorder:"#fed7aa",alertWarningText:"#92400e",alertErrorBg:"#fef2f2",alertErrorBorder:"#fecaca",alertErrorText:"#991b1b",badgeDefault:"#f3f4f6",badgeDefaultText:"#374151",badgePrimary:"#eff6ff",badgePrimaryText:"#1e40af",badgeSuccess:"#ecfdf5",badgeSuccessText:"#065f46",badgeWarning:"#fffbeb",badgeWarningText:"#92400e",badgeError:"#fef2f2",badgeErrorText:"#991b1b",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#4b5563",statCardBg:"#ffffff",metricPositive:"#10b981",metricNegative:"#ef4444",urgentBg:"#fef2f2",urgentBorder:"#fecaca",urgentText:"#991b1b",hoverOverlay:"rgba(0, 0, 0, 0.05)",focusRing:"#3b82f6",loadingBg:"#f9fafb",shadowSm:"0 1px 2px 0 rgb(0 0 0 / 0.05)",shadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)",shadowLg:"0 10px 15px -3px rgb(0 0 0 / 0.1)",shadowXl:"0 20px 25px -5px rgb(0 0 0 / 0.1)"},Oo={background:"#0a0e1a",backgroundSecondary:"#151b2e",backgroundTertiary:"#1f2937",text:"#f8fafc",textSecondary:"#e2e8f0",textTertiary:"#94a3b8",textInverse:"#0a0e1a",border:"#374151",borderSecondary:"#4b5563",cardBackground:"#1a202c",cardBorder:"#2d3748",inputBackground:"#1a202c",inputBorder:"#4a5568",inputBorderFocus:"#63b3ed",primary:"#60a5fa",primaryHover:"#3b82f6",secondary:"#a78bfa",secondaryHover:"#8b5cf6",accent:"#34d399",accentHover:"#10b981",success:"#48cc8b",warning:"#f6ad55",error:"#fc8181",info:"#63b3ed",muted:"#374151",mutedHover:"#4b5563",subtle:"#1f2937",emphasis:"#f9fafb",highlight:"#365314",selection:"#1e3a8a",navBg:"#1a202c",navText:"#e2e8f0",navHover:"#2d3748",navActive:"#2c5282",btnGhost:"transparent",btnGhostHover:"#2d3748",btnOutline:"transparent",btnOutlineBorder:"#4a5568",btnOutlineHover:"#2d3748",alertInfoBg:"#1e3a8a",alertInfoBorder:"#3b82f6",alertInfoText:"#93c5fd",alertSuccessBg:"#065f46",alertSuccessBorder:"#059669",alertSuccessText:"#a7f3d0",alertWarningBg:"#92400e",alertWarningBorder:"#d97706",alertWarningText:"#fcd34d",alertErrorBg:"#991b1b",alertErrorBorder:"#dc2626",alertErrorText:"#fca5a5",badgeDefault:"#374151",badgeDefaultText:"#d1d5db",badgePrimary:"#1e3a8a",badgePrimaryText:"#93c5fd",badgeSuccess:"#065f46",badgeSuccessText:"#a7f3d0",badgeWarning:"#92400e",badgeWarningText:"#fcd34d",badgeError:"#991b1b",badgeErrorText:"#fca5a5",navTabActive:"#60a5fa",navTabInactive:"#9ca3af",navTabHover:"#d1d5db",statCardBg:"#1a202c",metricPositive:"#34d399",metricNegative:"#fc8181",urgentBg:"#991b1b",urgentBorder:"#dc2626",urgentText:"#fca5a5",hoverOverlay:"rgba(255, 255, 255, 0.1)",focusRing:"#60a5fa",loadingBg:"#1f2937",shadowSm:"0 1px 3px 0 rgb(0 0 0 / 0.5)",shadow:"0 4px 6px -1px rgb(0 0 0 / 0.6), 0 2px 4px -1px rgb(0 0 0 / 0.3)",shadowLg:"0 10px 15px -3px rgb(0 0 0 / 0.7), 0 4px 6px -2px rgb(0 0 0 / 0.4)",shadowXl:"0 20px 25px -5px rgb(0 0 0 / 0.8), 0 10px 10px -5px rgb(0 0 0 / 0.5)"},Mo=(n,t,s)=>({...Zs,primary:n,primaryHover:ra(n,-15),secondary:t,secondaryHover:ra(t,-15),accent:s,accentHover:ra(s,-15),inputBorderFocus:n,background:xe("#fafafa",n,.04),backgroundSecondary:xe("#f5f5f5",n,.06),backgroundTertiary:xe("#eeeeee",n,.08),cardBackground:xe("#ffffff",n,.02),cardBorder:xe("#e5e7eb",n,.15),inputBackground:xe("#ffffff",n,.01),inputBorder:xe("#d1d5db",n,.2),textSecondary:xe("#6b7280",n,.1),textTertiary:xe("#9ca3af",n,.15),border:xe("#e5e7eb",n,.2),borderSecondary:xe("#d1d5db",n,.25),muted:xe("#f3f4f6",n,.08),mutedHover:xe("#e5e7eb",n,.1),subtle:xe("#f9fafb",n,.04),emphasis:xe("#1f2937",n,.1),highlight:xe("#fef3c7",n,.15),selection:xe("#dbeafe",n,.3),navBg:xe("#ffffff",n,.03),navText:xe("#374151",n,.1),navHover:xe("#f3f4f6",n,.1),navActive:xe("#eff6ff",n,.2),btnGhost:"transparent",btnGhostHover:xe("#f3f4f6",n,.1),btnOutline:"transparent",btnOutlineBorder:xe("#d1d5db",n,.3),btnOutlineHover:xe("#f9fafb",n,.08),alertInfoBg:xe("#eff6ff",n,.2),alertInfoBorder:xe("#bfdbfe",n,.3),alertInfoText:xe("#1e40af",n,.2),alertSuccessBg:xe("#ecfdf5",s,.2),alertSuccessBorder:xe("#a7f3d0",s,.3),alertSuccessText:xe("#065f46",s,.2),alertWarningBg:"#fffbeb",alertWarningBorder:"#fed7aa",alertWarningText:"#92400e",alertErrorBg:"#fef2f2",alertErrorBorder:"#fecaca",alertErrorText:"#991b1b",badgeDefault:xe("#f3f4f6",n,.1),badgeDefaultText:xe("#374151",n,.15),badgePrimary:xe("#eff6ff",n,.3),badgePrimaryText:xe("#1e40af",n,.2),badgeSuccess:xe("#ecfdf5",s,.3),badgeSuccessText:xe("#065f46",s,.2),badgeWarning:"#fffbeb",badgeWarningText:"#92400e",badgeError:"#fef2f2",badgeErrorText:"#991b1b",navTabActive:n,navTabInactive:xe("#6b7280",n,.2),navTabHover:xe("#4b5563",n,.15),statCardBg:xe("#ffffff",n,.02),metricPositive:s,metricNegative:"#ef4444",urgentBg:xe("#fef2f2",n,.1),urgentBorder:xe("#fecaca",n,.2),urgentText:xe("#991b1b",n,.1),hoverOverlay:Mt(n,.08),focusRing:n,loadingBg:xe("#f9fafb",n,.05),shadowSm:`0 1px 2px 0 ${Mt(n,.1)}`,shadow:`0 4px 6px -1px ${Mt(n,.15)}, 0 2px 4px -1px ${Mt(n,.06)}`,shadowLg:`0 10px 15px -3px ${Mt(n,.2)}, 0 4px 6px -2px ${Mt(n,.08)}`,shadowXl:`0 20px 25px -5px ${Mt(n,.25)}, 0 10px 10px -5px ${Mt(n,.1)}`});function ra(n,t){const s=n[0]==="#",r=s?n.slice(1):n,a=parseInt(r,16);let i=(a>>16)+t,o=(a>>8&255)+t,l=(a&255)+t;return i=i>255?255:i<0?0:i,o=o>255?255:o<0?0:o,l=l>255?255:l<0?0:l,(s?"#":"")+(i<<16|o<<8|l).toString(16).padStart(6,"0")}function xe(n,t,s){const r=ya(n),a=ya(t);if(!r||!a)return n;const i=Math.round(r.r*(1-s)+a.r*s),o=Math.round(r.g*(1-s)+a.g*s),l=Math.round(r.b*(1-s)+a.b*s);return`#${((1<<24)+(i<<16)+(o<<8)+l).toString(16).slice(1)}`}function ya(n){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function Mt(n,t){const s=ya(n);return s?`rgba(${s.r}, ${s.g}, ${s.b}, ${t})`:`rgba(0, 0, 0, ${t})`}function Uo(n){const t=document.documentElement;t.style.setProperty("--color-background",n.background),t.style.setProperty("--color-background-secondary",n.backgroundSecondary),t.style.setProperty("--color-background-tertiary",n.backgroundTertiary),t.style.setProperty("--color-text",n.text),t.style.setProperty("--color-text-secondary",n.textSecondary),t.style.setProperty("--color-text-tertiary",n.textTertiary),t.style.setProperty("--color-text-inverse",n.textInverse),t.style.setProperty("--color-border",n.border),t.style.setProperty("--color-border-secondary",n.borderSecondary),t.style.setProperty("--color-card-background",n.cardBackground),t.style.setProperty("--color-card-border",n.cardBorder),t.style.setProperty("--color-input-background",n.inputBackground),t.style.setProperty("--color-input-border",n.inputBorder),t.style.setProperty("--color-input-border-focus",n.inputBorderFocus),t.style.setProperty("--color-primary",n.primary),t.style.setProperty("--color-primary-hover",n.primaryHover),t.style.setProperty("--color-secondary",n.secondary),t.style.setProperty("--color-secondary-hover",n.secondaryHover),t.style.setProperty("--color-accent",n.accent),t.style.setProperty("--color-accent-hover",n.accentHover),t.style.setProperty("--color-success",n.success),t.style.setProperty("--color-warning",n.warning),t.style.setProperty("--color-error",n.error),t.style.setProperty("--color-info",n.info),t.style.setProperty("--color-muted",n.muted),t.style.setProperty("--color-muted-hover",n.mutedHover),t.style.setProperty("--color-subtle",n.subtle),t.style.setProperty("--color-emphasis",n.emphasis),t.style.setProperty("--color-highlight",n.highlight),t.style.setProperty("--color-selection",n.selection),t.style.setProperty("--color-nav-bg",n.navBg),t.style.setProperty("--color-nav-text",n.navText),t.style.setProperty("--color-nav-hover",n.navHover),t.style.setProperty("--color-nav-active",n.navActive),t.style.setProperty("--color-btn-ghost",n.btnGhost),t.style.setProperty("--color-btn-ghost-hover",n.btnGhostHover),t.style.setProperty("--color-btn-outline",n.btnOutline),t.style.setProperty("--color-btn-outline-border",n.btnOutlineBorder),t.style.setProperty("--color-btn-outline-hover",n.btnOutlineHover),t.style.setProperty("--color-alert-info-bg",n.alertInfoBg),t.style.setProperty("--color-alert-info-border",n.alertInfoBorder),t.style.setProperty("--color-alert-info-text",n.alertInfoText),t.style.setProperty("--color-alert-success-bg",n.alertSuccessBg),t.style.setProperty("--color-alert-success-border",n.alertSuccessBorder),t.style.setProperty("--color-alert-success-text",n.alertSuccessText),t.style.setProperty("--color-alert-warning-bg",n.alertWarningBg),t.style.setProperty("--color-alert-warning-border",n.alertWarningBorder),t.style.setProperty("--color-alert-warning-text",n.alertWarningText),t.style.setProperty("--color-alert-error-bg",n.alertErrorBg),t.style.setProperty("--color-alert-error-border",n.alertErrorBorder),t.style.setProperty("--color-alert-error-text",n.alertErrorText),t.style.setProperty("--color-badge-default",n.badgeDefault),t.style.setProperty("--color-badge-default-text",n.badgeDefaultText),t.style.setProperty("--color-badge-primary",n.badgePrimary),t.style.setProperty("--color-badge-primary-text",n.badgePrimaryText),t.style.setProperty("--color-badge-success",n.badgeSuccess),t.style.setProperty("--color-badge-success-text",n.badgeSuccessText),t.style.setProperty("--color-badge-warning",n.badgeWarning),t.style.setProperty("--color-badge-warning-text",n.badgeWarningText),t.style.setProperty("--color-badge-error",n.badgeError),t.style.setProperty("--color-badge-error-text",n.badgeErrorText),t.style.setProperty("--color-nav-tab-active",n.navTabActive),t.style.setProperty("--color-nav-tab-inactive",n.navTabInactive),t.style.setProperty("--color-nav-tab-hover",n.navTabHover),t.style.setProperty("--color-stat-card-bg",n.statCardBg),t.style.setProperty("--color-metric-positive",n.metricPositive),t.style.setProperty("--color-metric-negative",n.metricNegative),t.style.setProperty("--color-urgent-bg",n.urgentBg),t.style.setProperty("--color-urgent-border",n.urgentBorder),t.style.setProperty("--color-urgent-text",n.urgentText),t.style.setProperty("--color-hover-overlay",n.hoverOverlay),t.style.setProperty("--color-focus-ring",n.focusRing),t.style.setProperty("--color-loading-bg",n.loadingBg),t.style.setProperty("--shadow-sm",n.shadowSm),t.style.setProperty("--shadow",n.shadow),t.style.setProperty("--shadow-lg",n.shadowLg),t.style.setProperty("--shadow-xl",n.shadowXl)}const ci=p.createContext(null),qa="hr-system-theme",Wo=()=>{const n=p.useContext(ci);if(!n)throw new Error("useTheme must be used within a ThemeProvider");return n},dm=({children:n})=>{let t=null;try{t=We().organization}catch{}const[s,r]=p.useState("light"),[a,i]=p.useState(Zs),[o,l]=p.useState(!0);p.useEffect(()=>{const h=localStorage.getItem(qa);h&&["light","dark","branded"].includes(h)&&r(h),l(!1)},[]);const m=p.useCallback(h=>{switch(h){case"dark":return Oo;case"branded":if(t?.branding){const{primaryColor:v,secondaryColor:g,accentColor:b}=t.branding;return Mo(v||"#3b82f6",g||"#6366f1",b||"#10b981")}return Zs;case"light":default:return Zs}},[t]);p.useEffect(()=>{const h=m(s);i(h),Uo(h),localStorage.setItem(qa,s),s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[s,m]);const c=p.useCallback(h=>{r(h)},[]),x=p.useCallback(()=>{r(h=>{switch(h){case"light":return"dark";case"dark":return"branded";case"branded":return"light";default:return"light"}})},[]),u={currentTheme:s,themeColors:a,setTheme:c,toggleTheme:x,isLoading:o};return p.useEffect(()=>{o||(document.body.style.transition="background-color 0.3s ease, color 0.3s ease")},[o]),e.jsx(ci.Provider,{value:u,children:n})},Vt=()=>{const{user:n}=De(),s=(()=>{if(!n)return[];const R=n.role?.id||n.role;return R?[R]:[]})(),r=R=>s.includes(R),a=R=>R.some(_=>s.includes(_));return{canViewBusinessMetrics:()=>r("business-owner")||r("super-user"),canManageOrganization:()=>r("business-owner")||r("super-user"),canViewComplianceReports:()=>a(["business-owner","hr-manager","super-user"]),canManageOrganizationSettings:()=>r("business-owner")||r("super-user"),canManageEmployees:()=>a(["hr-manager","business-owner","super-user"]),canManageHR:()=>a(["hr-manager","business-owner","super-user"]),canReviewWarnings:()=>a(["hr-manager","business-owner","super-user"]),canReviewDocuments:()=>a(["hr-manager","business-owner","super-user"]),canManageUsers:()=>a(["hr-manager","business-owner","super-user"]),canManageDepartments:()=>a(["hr-manager","business-owner","super-user"]),canCreateHRManagers:()=>r("business-owner")||r("super-user"),canCreateHODManagers:()=>a(["hr-manager","business-owner","super-user"]),canCreateWarnings:()=>a(["hod-manager","hr-manager","business-owner","super-user"]),canCaptureDocuments:()=>a(["hod-manager","hr-manager","super-user"]),canViewTeamMembers:()=>a(["hod-manager","hr-manager","business-owner","super-user"]),canManageTeam:()=>a(["hod-manager","hr-manager","business-owner","super-user"]),hasRole:r,hasAnyRole:a,hasAllRoles:R=>R.every(_=>s.includes(_)),getPrimaryRole:()=>s[0]||"unknown",getAllRoles:()=>[...s]}},$t=[{id:"attendance_punctuality",name:"Attendance & Punctuality",description:"Late coming, unauthorized absence, early departure without permission",severity:"minor",icon:"⏰",lraSection:"Section 188(1)(a) - Incapacity or poor work performance",schedule8Reference:"Schedule 8, Item 10 - Incapacity/poor performance procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Attendance issues are typically correctable behavior problems that benefit from full progressive discipline, giving employees maximum opportunity to improve while building strong legal documentation.",commonExamples:["Arriving late for work without valid reason (3+ times per month)","Leaving work early without supervisor permission","Unauthorized absence during working hours","Excessive sick leave without proper medical certificates","Not notifying supervisor of absence per company policy","Consistently returning late from breaks","Pattern of Monday/Friday absences without valid reasons"],proceduralRequirements:["Maintain accurate attendance records for minimum 6 months","Investigate reasons for poor attendance before disciplinary action","Consider personal circumstances (Schedule 8 factors)","Provide counselling and support where appropriate","Follow progressive discipline unless pattern shows willful misconduct","Document all interventions and employee responses","Allow employee opportunity to provide medical evidence"],evidenceRequired:["Daily attendance register or electronic time records","Previous warnings and counselling records","Medical certificates (if absence-related)","Communication records about absences","Witness statements from supervisors","Company attendance policy documentation","Impact assessment on operations"],ccmaFactors:["Length of service and previous disciplinary record","Personal circumstances affecting attendance","Whether adequate counselling and support was provided","Consistency of employer response to similar cases","Impact on operations and other employees","Economic circumstances and job market conditions","Whether alternative arrangements were considered"],defaultValidityPeriod:6},{id:"performance_issues",name:"Performance Issues",description:"Poor work quality, failure to meet targets, lack of required skills",severity:"minor",icon:"📈",lraSection:"Section 188(1)(a) - Incapacity or poor work performance",schedule8Reference:"Schedule 8, Item 10 - Poor performance procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Performance issues often stem from lack of training, unclear expectations, or personal challenges. Full progressive discipline allows time for coaching, training, and performance improvement plans.",commonExamples:["Consistently missing production targets despite training","Work quality below acceptable company standards","Failure to follow established procedures","Inability to learn new skills required for position","Poor customer service resulting in complaints","Errors in work output affecting quality or safety","Lack of productivity compared to similar employees"],proceduralRequirements:["Provide clear performance standards and expectations","Offer training and development opportunities","Implement performance improvement plans with measurable goals","Regular monitoring and feedback sessions","Consider whether incapacity is due to ill-health or lack of skill","Explore alternative positions if performance cannot improve","Document all training provided and performance measurements"],evidenceRequired:["Performance metrics and measurement records","Training records and certificates","Performance improvement plan documentation","Regular performance review records","Customer complaints or feedback (if applicable)","Comparison with similar employees' performance","Evidence of support and resources provided"],ccmaFactors:["Whether clear performance standards were communicated","Adequacy of training and support provided","Personal circumstances affecting performance","Length of service and previous performance record","Whether alternative positions were considered","Consistency with treatment of other employees","Economic impact of dismissal on employee"],defaultValidityPeriod:6},{id:"safety_violations",name:"Safety Violations",description:"Failure to follow safety procedures, endangering self or others",severity:"serious",icon:"🚨",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["verbal","first_written","final_written"],escalationRationale:"Safety violations can result in injury, death, or legal liability. While counselling might be appropriate for first-time minor oversights, repeated or serious safety violations require formal progressive discipline.",commonExamples:["Failure to wear required Personal Protective Equipment (PPE)","Operating machinery without proper authorization","Ignoring safety procedures and protocols","Creating unsafe working conditions for others","Failure to report safety hazards or incidents","Horseplay or reckless behavior in workplace","Smoking in prohibited areas or fire hazard zones"],proceduralRequirements:["Immediate investigation of safety incidents","Ensure employee understands safety requirements","Provide additional safety training if needed","Consider whether violation was willful or due to lack of knowledge","Implement corrective measures to prevent recurrence","May require temporary removal from dangerous areas","Report serious incidents to relevant authorities"],evidenceRequired:["Incident reports and investigation findings","Safety training records and certificates","Photographs of safety violations or hazards","Witness statements from supervisors or colleagues","Safety inspection reports","Company safety policies and procedures","Medical reports if injury occurred"],ccmaFactors:["Seriousness of safety risk created","Whether violation was willful or negligent","Previous safety training provided","Employee's safety record and length of service","Potential consequences of the safety violation","Consistency of safety enforcement","Industry standards and legal requirements"],defaultValidityPeriod:12,requiresImmediateAction:!0},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",description:"Refusal to follow instructions, disrespectful behavior, undermining authority",severity:"serious",icon:"🚫",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","final_written"],escalationRationale:"Insubordination varies from minor attitude issues (requiring counselling) to serious defiance. Progressive discipline allows distinction between momentary lapses and persistent defiant behavior.",commonExamples:["Refusing to follow reasonable and lawful instructions","Disrespectful language or behavior toward supervisors","Undermining management authority in front of colleagues","Aggressive or threatening behavior toward management","Consistently challenging management decisions inappropriately","Showing contempt for company policies or procedures","Public criticism of management or company"],proceduralRequirements:["Distinguish between reasonable management instruction and unreasonable demands","Consider employee's right to raise legitimate grievances","Assess whether behavior was influenced by workplace stress","Provide opportunity for employee to explain their perspective","Consider mediation or conflict resolution where appropriate","Document specific instances with dates and witnesses","Ensure consistency with treatment of similar cases"],evidenceRequired:["Written statements from witnesses present","Documentation of specific incidents with dates and times","Records of instructions given and employee response","Previous disciplinary records for pattern evidence","Email or written communication showing insubordination","Performance reviews or feedback sessions","Evidence of impact on team morale or productivity"],ccmaFactors:["Severity of the insubordinate behavior","Whether employee had legitimate grievances","Length of service and previous disciplinary record","Impact on workplace authority and discipline","Whether behavior was out of character","Workplace stress factors or personal circumstances","Potential for rehabilitation and improved behavior"],defaultValidityPeriod:6},{id:"policy_violations",name:"Policy Violations",description:"Breach of company policies, procedures, or workplace rules",severity:"minor",icon:"📋",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Policy violations vary greatly in seriousness. Progressive discipline allows proportionate responses based on policy importance and violation severity.",commonExamples:["Violation of dress code or appearance standards","Inappropriate use of company property or equipment","Breach of confidentiality or privacy policies","Unauthorized use of company internet or email","Violation of social media and communication policies","Failure to follow administrative procedures","Breach of conflict of interest policies"],proceduralRequirements:["Ensure policy was clearly communicated to employee","Verify employee had access to and understood policy","Consider seriousness of policy violated","Investigate whether violation was intentional","Provide policy training if knowledge gaps identified","Consider impact of violation on business operations","Ensure consistent application across all employees"],evidenceRequired:["Copy of relevant company policy document","Evidence of policy communication (training records, handbook)","Documentation of the specific violation","Computer logs, emails, or digital evidence if applicable","Witness statements or supervisor observations","Previous policy violations or training records","Impact assessment on business or colleagues"],ccmaFactors:["Clarity and accessibility of the policy violated","Seriousness of the policy and business impact","Employee's knowledge and understanding of policy","Intent behind the violation","Consistency of policy enforcement","Length of service and previous violations","Whether remedial action is possible"],defaultValidityPeriod:6},{id:"dishonesty_theft",name:"Dishonesty & Theft",description:"Stealing, fraud, falsifying records, dishonest behavior",severity:"gross_misconduct",icon:"💰",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["first_written","final_written"],escalationRationale:"Dishonesty and theft break fundamental trust required for employment. Minor dishonesty may warrant progressive discipline, but serious theft or fraud often justifies immediate dismissal after investigation.",commonExamples:["Stealing company property, money, or resources","Fraudulent claiming of overtime or expenses","Falsifying time records, reports, or documentation","Misappropriation of company funds or assets","Lying about qualifications, experience, or credentials","Concealing conflicts of interest or kickbacks","Falsifying safety records or inspection reports"],proceduralRequirements:["Conduct thorough investigation before taking action","Preserve evidence and maintain chain of custody","Consider suspension pending investigation if necessary","Distinguish between minor dishonesty and serious fraud","Involve security or law enforcement if appropriate","Ensure fair hearing and right to respond","Consider whether criminal charges should be laid"],evidenceRequired:["Financial records, receipts, or transaction evidence","Security camera footage or access logs","Witness statements from colleagues or customers","Forensic accounting or audit reports","Documentation of missing inventory or assets","Computer records or digital evidence","Statements from employee during investigation"],ccmaFactors:["Value and nature of property stolen or involved","Level of trust and responsibility in employee's position","Impact on employer's business or reputation","Length of service and previous disciplinary record","Whether employee admitted wrongdoing and showed remorse","Consistency with treatment of similar cases","Potential for rehabilitation vs. need to deter others"],defaultValidityPeriod:12,requiresImmediateAction:!0,allowsWarningSkipping:!0},{id:"substance_abuse",name:"Substance Abuse",description:"Use of alcohol or drugs affecting work performance or safety",severity:"serious",icon:"🍺",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","final_written"],escalationRationale:"Substance abuse is both a health issue and workplace safety concern. Counselling and support are prioritized initially, but safety concerns require firm boundaries.",commonExamples:["Reporting to work under influence of alcohol or drugs","Possession or use of illegal substances at work","Performance deterioration due to substance abuse","Erratic behavior suggesting intoxication","Positive results on random drug/alcohol testing","Alcohol odor or visible signs of intoxication","Refusing to submit to required substance testing"],proceduralRequirements:["Follow company substance abuse policy procedures","Conduct testing according to established protocols","Distinguish between addiction (health issue) and misconduct","Offer employee assistance programs where available","Consider rehabilitation and treatment options","Ensure safety of employee and colleagues","Document all incidents and interventions"],evidenceRequired:["Drug/alcohol test results and chain of custody","Witness observations of behavior and condition","Supervisor reports of performance decline","Medical evidence or treatment records (if disclosed)","Company substance abuse policies","Previous incidents or test results","Evidence of impact on work performance or safety"],ccmaFactors:["Whether substance abuse affects work performance","Safety implications for employee and colleagues","Employee's willingness to seek treatment","Length of service and previous record","Availability of rehabilitation programs","Consistency of policy application","Balance between health support and workplace safety"],defaultValidityPeriod:6,requiresImmediateAction:!0},{id:"harassment_discrimination",name:"Harassment & Discrimination",description:"Sexual harassment, racial discrimination, bullying, or creating hostile work environment",severity:"gross_misconduct",icon:"⚖️",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["final_written"],escalationRationale:"Harassment and discrimination create legal liability and hostile work environments. While investigation is required, proven cases often warrant immediate serious action.",commonExamples:["Sexual harassment or unwanted sexual advances","Racial, gender, or religious discrimination","Bullying, intimidation, or creating hostile environment","Inappropriate comments about appearance or personal life","Displaying offensive material or making discriminatory jokes","Retaliation against employees who report discrimination","Creating work environment that excludes certain groups"],proceduralRequirements:["Immediate investigation by trained investigators","Ensure complainant safety and prevent retaliation","Maintain confidentiality while conducting investigation","Follow company harassment and discrimination policies","Consider interim measures to separate parties","Provide support to affected employees","Report to relevant authorities if required by law"],evidenceRequired:["Written complaint or incident report","Witness statements from colleagues","Documentation of previous similar incidents","Email, text messages, or other communications","Records of previous complaints or warnings","Medical or psychological reports (if applicable)","Evidence of impact on work environment"],ccmaFactors:["Seriousness and persistence of the harassment","Impact on victim and workplace environment","Position of power or authority of perpetrator","Previous incidents or complaints","Whether behavior was part of pattern","Legal and reputational risk to organization","Need to protect other employees and deter similar conduct"],defaultValidityPeriod:12,requiresImmediateAction:!0,allowsWarningSkipping:!0}];function Vr(n){return $t.find(t=>t.id===n)}function di(n){return Vr(n)?.escalationPath||["counselling","verbal","first_written","final_written"]}function Ho(n,t){const s=Vr(n);if(!s)return null;const r=s.escalationPath.indexOf(t);return r===-1||r===s.escalationPath.length-1?null:s.escalationPath[r+1]}function Zt(n){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"}[n]||n}const Me={ORGANIZATIONS:"organizations",USERS:"users",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warningCategories",ESCALATION_RULES:"escalationRules",AUDIT_LOGS:"auditLogs",DOCUMENTS:"documents",TEMPLATES:"templates"};let He=class{static{this.categoryCache=new Map}static{this.CACHE_DURATION=300*1e3}static convertDate(t){if(!t)return new Date;if(t instanceof Date)return t;if(t&&typeof t=="object"&&typeof t.toDate=="function")return t.toDate();const s=new Date(t);return isNaN(s.getTime())?new Date:s}static convertOptionalDate(t){if(t)return this.convertDate(t)}static async getWarningCategories(t){const s=this.categoryCache.get(t);if(s&&Date.now()-s.timestamp<this.CACHE_DURATION)return d.debug("[DataService] 💰 Returning cached categories"),s.data;try{d.debug("[DataService] 🔄 Loading categories with smart merging for org:",t);const r=$t;d.debug("[DataService] 📋 Base universal categories:",r.length);const a=se(B,"organizations",t,"categories"),i=X(a,J("isActive","==",!0),le("name")),l=(await oe(i)).docs.map(x=>({id:x.id,...x.data(),createdAt:x.data().createdAt?.toDate()||new Date,updatedAt:x.data().updatedAt?.toDate()||new Date}));d.debug("[DataService] 🏢 Organization customizations:",l.length);const m=[];for(const x of r){const u=l.find(v=>v.universalCategoryId===x.id&&!v.isCustomCategory);if(u&&u.isDisabled){d.debug("[DataService] ❌ Category disabled by organization:",x.name);continue}const h={id:u?.id||x.id,organizationId:t,name:u?.customName||x.name,description:u?.customDescription||x.description,severity:this.mapSeverityToLegacy(u?.customSeverity||x.severity),escalationPath:u?.customEscalationPath||x.escalationPath,legalRequirements:x.proceduralRequirements,examples:u?.customExamples||x.commonExamples,defaultValidityPeriod:x.defaultValidityPeriod,isActive:!0,createdAt:u?.createdAt||new Date,updatedAt:u?.updatedAt||new Date};m.push(h)}const c=l.filter(x=>x.isCustomCategory);for(const x of c){const u={id:x.id,organizationId:t,name:x.customName||"Custom Category",description:x.customDescription||"Organization-specific category",severity:x.customSeverity||"medium",escalationPath:x.customEscalationPath||["counselling","verbal","first_written","final_written"],legalRequirements:["Follow standard progressive discipline procedures"],examples:x.customExamples||[],defaultValidityPeriod:6,isActive:!0,createdAt:x.createdAt,updatedAt:x.updatedAt};m.push(u)}return this.categoryCache.set(t,{data:m,timestamp:Date.now()}),d.debug("[DataService] ✅ Smart merge complete. Final categories:",m.length),d.debug("[DataService] 📊 Categories:",m.map(x=>`${x.name} (${x.severity})`)),m}catch(r){return d.error("[DataService] ❌ Error in smart category merge:",r),s?(d.debug("[DataService] 🔄 Error occurred, returning stale cache"),s.data):(d.debug("[DataService] 🚨 Ultimate fallback to universal categories"),this.convertUniversalToWarningCategories(t))}}static async getWarningCategory(t,s){try{const a=(await this.getWarningCategories(s)).find(m=>m.id===t);if(a)return a;const i=Q(B,"organizations",s,"categories",t),o=await Ze(i);if(o.exists())return{id:o.id,...o.data(),createdAt:o.data().createdAt?.toDate()||new Date,updatedAt:o.data().updatedAt?.toDate()||new Date};const l=$t.find(m=>m.id===t);return l?this.convertUniversalToWarningCategory(l,s):null}catch(r){return d.error("[DataService] Error getting category:",r),null}}static async customizeCategory(t,s,r){try{const a=s,i=Q(B,"organizations",t,"categories",a),o={id:a,organizationId:t,universalCategoryId:s,...r,isCustomCategory:!1,isDisabled:!1,createdAt:new Date,updatedAt:new Date};await ze(i,o),this.categoryCache.delete(t),d.debug("[DataService] ✅ Category customization saved:",s)}catch(a){throw d.error("[DataService] Error customizing category:",a),a}}static async createCustomCategory(t,s){try{const r=`custom-${Date.now()}`,a=Q(B,"organizations",t,"categories",r),i={id:r,organizationId:t,universalCategoryId:"",customName:s.name,customDescription:s.description,customEscalationPath:s.escalationPath,customExamples:s.examples||[],customSeverity:s.severity||"medium",isCustomCategory:!0,isDisabled:!1,createdAt:new Date,updatedAt:new Date};return await ze(a,i),this.categoryCache.delete(t),d.debug("[DataService] ✅ Custom category created:",s.name),r}catch(r){throw d.error("[DataService] Error creating custom category:",r),r}}static async disableCategory(t,s){try{const a=Q(B,"organizations",t,"categories",s);await ze(a,{organizationId:t,universalCategoryId:s,isDisabled:!0,isCustomCategory:!1,updatedAt:new Date},{merge:!0}),this.categoryCache.delete(t),d.debug("[DataService] ✅ Category disabled:",s)}catch(r){throw d.error("[DataService] Error disabling category:",r),r}}static convertUniversalToWarningCategory(t,s){return{id:t.id,organizationId:s,name:t.name,description:t.description,severity:this.mapSeverityToLegacy(t.severity),escalationPath:t.escalationPath,legalRequirements:t.proceduralRequirements,examples:t.commonExamples,defaultValidityPeriod:t.defaultValidityPeriod,isActive:!0,createdAt:new Date,updatedAt:new Date}}static convertUniversalToWarningCategories(t){return $t.map(s=>this.convertUniversalToWarningCategory(s,t))}static mapSeverityToLegacy(t){return{minor:"low",serious:"medium",gross_misconduct:"high"}[t]||"medium"}static async getOrganization(t){try{const s=Q(B,Me.ORGANIZATIONS,t),r=await Ze(s);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertOptionalDate(r.data().createdAt),updatedAt:this.convertOptionalDate(r.data().updatedAt)}:null}catch(s){return d.error("[DataService] Error getting organization:",s),null}}static async createOrganization(t){try{const s=t.id?Q(B,Me.ORGANIZATIONS,t.id):Q(se(B,Me.ORGANIZATIONS)),r={...t,updatedAt:re(),...t.id?{}:{createdAt:re()}};return await ze(s,r),await this.logAuditEvent("ORGANIZATION_CREATED",{organizationId:s.id}),s.id}catch(s){throw d.error("[DataService] Error creating organization:",s),s}}static async updateOrganization(t,s){try{const r=Q(B,Me.ORGANIZATIONS,t);await Te(r,{...s,updatedAt:re()}),await this.logAuditEvent("ORGANIZATION_UPDATED",{organizationId:t,updates:s})}catch(r){throw d.error("[DataService] Error updating organization:",r),r}}static async getEmployeesByOrganization(t){try{const s=se(B,"organizations",t,"employees"),r=X(s,J("isActive","==",!0),le("profile.lastName"),le("profile.firstName"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertDate(i.data().createdAt),updatedAt:this.convertDate(i.data().updatedAt),profile:{...i.data().profile,startDate:this.convertDate(i.data().profile?.startDate)},employment:{...i.data().employment,startDate:this.convertDate(i.data().employment?.startDate),endDate:this.convertOptionalDate(i.data().employment?.endDate),probationEndDate:this.convertOptionalDate(i.data().employment?.probationEndDate)}}))}catch(s){return d.error("[DataService] Error getting employees:",s),[]}}static async getEmployeesByManager(t,s){try{return(await this.getEmployeesByOrganization(s)).filter(a=>a.employment?.managerId===t&&a.isActive)}catch(r){throw d.error("[DataService] Failed to get employees by manager:",r),r}}static async getEmployee(t){try{const s=Q(B,Me.EMPLOYEES,t),r=await Ze(s);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertDate(r.data().createdAt),updatedAt:this.convertDate(r.data().updatedAt),profile:{...r.data().profile,startDate:this.convertDate(r.data().profile?.startDate)},employment:{...r.data().employment,startDate:this.convertDate(r.data().employment?.startDate),endDate:this.convertOptionalDate(r.data().employment?.endDate),probationEndDate:this.convertOptionalDate(r.data().employment?.probationEndDate)}}:null}catch(s){return d.error("[DataService] Error getting employee:",s),null}}static async saveEmployee(t,s){try{console.log("[DataService] 🚀 Creating employee:",{organizationId:s,hasData:!!t,dataKeys:Object.keys(t),employeeNumber:t.employeeNumber,firstName:t.firstName,lastName:t.lastName});const r=t.id?Q(B,Me.EMPLOYEES,t.id):Q(se(B,Me.EMPLOYEES)),a={...t,organizationId:s,updatedAt:re(),...t.id?{}:{createdAt:re()}};return await ze(r,a),this.logAuditEvent(t.id?"EMPLOYEE_UPDATED":"EMPLOYEE_CREATED",{employeeId:r.id,organizationId:s}).catch(i=>d.warn("Audit logging failed:",i)),r.id}catch(r){throw d.error("[DataService] Error saving employee:",r),r}}static async archiveEmployee(t,s){try{const r=Q(B,Me.EMPLOYEES,t);await Te(r,{isActive:!1,archivedAt:re(),updatedAt:re()}),await this.logAuditEvent("EMPLOYEE_ARCHIVED",{employeeId:t,organizationId:s})}catch(r){throw d.error("[DataService] Error archiving employee:",r),r}}static async restoreEmployee(t,s){try{const r=Q(B,Me.EMPLOYEES,t);await Te(r,{isActive:!0,archivedAt:null,updatedAt:re()}),await this.logAuditEvent("EMPLOYEE_RESTORED",{employeeId:t,organizationId:s})}catch(r){throw d.error("[DataService] Error restoring employee:",r),r}}static async getWarningsByOrganization(t,s){try{const r=se(B,"organizations",t,"warnings");let a=X(r,le("issueDate","desc"));s&&(a=X(a,ht(s)));const o=(await oe(a)).docs.map(v=>({id:v.id,...v.data(),issueDate:this.convertDate(v.data().issueDate),expiryDate:this.convertDate(v.data().expiryDate),incidentDate:this.convertDate(v.data().incidentDate),deliveryDate:this.convertOptionalDate(v.data().deliveryDate),signatureDate:this.convertOptionalDate(v.data().signatureDate),createdAt:this.convertDate(v.data().createdAt),updatedAt:this.convertDate(v.data().updatedAt)})),l=[...new Set(o.map(v=>v.employeeId).filter(v=>v))],m=[...new Set(o.map(v=>v.categoryId).filter(v=>v))],[c,x]=await Promise.all([this.getBatchEmployees(l,t),this.getBatchWarningCategories(m,t)]),u=new Map;c.forEach(v=>{v&&u.set(v.id,{firstName:v.profile?.firstName||"Unknown",lastName:v.profile?.lastName||"Employee",employeeNumber:v.employeeNumber||"N/A",department:v.employment?.department||"Unknown"})});const h=new Map;return x.forEach(v=>{v&&h.set(v.id,v.name)}),o.map(v=>{const g=u.get(v.employeeId),b=h.get(v.categoryId);return{...v,employeeName:g?`${g.firstName} ${g.lastName}`:"Unknown Employee",employeeNumber:g?.employeeNumber||"Unknown",department:g?.department||"Unknown",category:b||"Unknown Category"}})}catch(r){return d.error("[DataService] Error getting warnings:",r),[]}}static async getWarningsForEmployee(t,s){try{const r=se(B,"organizations",s,"warnings"),a=X(r,J("employeeId","==",t),le("issueDate","desc"));return(await oe(a)).docs.map(o=>({id:o.id,...o.data(),issueDate:this.convertDate(o.data().issueDate),expiryDate:this.convertDate(o.data().expiryDate),incidentDate:this.convertDate(o.data().incidentDate),deliveryDate:this.convertOptionalDate(o.data().deliveryDate),signatureDate:this.convertOptionalDate(o.data().signatureDate),createdAt:this.convertDate(o.data().createdAt),updatedAt:this.convertDate(o.data().updatedAt)}))}catch(r){return d.error("[DataService] Error getting employee warnings:",r),[]}}static async getActiveWarningsForEmployee(t,s){try{const r=se(B,"organizations",s,"warnings"),a=new Date,i=X(r,J("employeeId","==",t),J("isActive","==",!0),J("expiryDate",">",a),le("expiryDate","desc"),le("issueDate","desc"));return(await oe(i)).docs.map(l=>({id:l.id,...l.data(),issueDate:this.convertDate(l.data().issueDate),expiryDate:this.convertDate(l.data().expiryDate),incidentDate:this.convertDate(l.data().incidentDate),deliveryDate:this.convertOptionalDate(l.data().deliveryDate),signatureDate:this.convertOptionalDate(l.data().signatureDate),createdAt:this.convertDate(l.data().createdAt),updatedAt:this.convertDate(l.data().updatedAt)}))}catch(r){return d.error("[DataService] Error getting active employee warnings:",r),[]}}static async getWarning(t,s){try{const r=Q(B,"organizations",s,"warnings",t),a=await Ze(r);return a.exists()?{id:a.id,...a.data(),issueDate:this.convertDate(a.data().issueDate),expiryDate:this.convertDate(a.data().expiryDate),incidentDate:this.convertDate(a.data().incidentDate),deliveryDate:this.convertOptionalDate(a.data().deliveryDate),signatureDate:this.convertOptionalDate(a.data().signatureDate),createdAt:this.convertDate(a.data().createdAt),updatedAt:this.convertDate(a.data().updatedAt)}:null}catch(r){return d.error("[DataService] Error getting warning:",r),null}}static async saveWarning(t,s){try{d.debug("💾 [SAVE] Saving warning to database...");const r=t.id?Q(B,"organizations",s,"warnings",t.id):Q(se(B,"organizations",s,"warnings")),a={...t,organizationId:s,updatedAt:re(),...t.id?{}:{createdAt:re()}};return await ze(r,a),await this.logAuditEvent(t.id?"WARNING_UPDATED":"WARNING_CREATED",{warningId:r.id,organizationId:s,employeeId:t.employeeId}),d.success(33682),r.id}catch(r){throw d.error("❌ [SAVE] Error saving warning:",r),r}}static async updateWarningStatus(t,s,r){try{const a=Q(B,"organizations",r,"warnings",t);await Te(a,{status:s,updatedAt:re()}),await this.logAuditEvent("WARNING_STATUS_UPDATED",{warningId:t,organizationId:r,newStatus:s})}catch(a){throw d.error("[DataService] Error updating warning status:",a),a}}static async markWarningDelivered(t,s,r,a){try{const i=Q(B,"organizations",s,"warnings",t);await Te(i,{isDelivered:!0,deliveryDate:re(),deliveryMethod:r,deliveryDetails:a,updatedAt:re()}),await this.logAuditEvent("WARNING_DELIVERED",{warningId:t,organizationId:s,deliveryMethod:r,deliveryDetails:a})}catch(i){throw d.error("[DataService] Error marking warning as delivered:",i),i}}static async createUser(t){try{if(!t.organizationId)throw new Error("Organization ID is required for user creation");const s=t.id?Q(B,"organizations",t.organizationId,"users",t.id):Q(se(B,"organizations",t.organizationId,"users")),r={...t,createdAt:re(),updatedAt:re()};return await ze(s,r),await this.logAuditEvent("USER_CREATED",{userId:s.id,organizationId:t.organizationId}),s.id}catch(s){throw d.error("[DataService] Error creating user:",s),s}}static async getUser(t,s){try{const r=Q(B,"organizations",s,"users",t),a=await Ze(r);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),lastLogin:this.convertOptionalDate(a.data().lastLogin)}:null}catch(r){return d.error("[DataService] Error getting user:",r),null}}static async getUsersByOrganization(t){try{const s=se(B,"organizations",t,"users"),r=X(s,J("isActive","==",!0),le("lastName"),le("firstName"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertDate(i.data().createdAt),lastLogin:this.convertOptionalDate(i.data().lastLogin)}))}catch(s){return d.error("[DataService] Error getting users:",s),[]}}static async updateUser(t,s,r){try{const a=Q(B,"organizations",r,"users",t);await Te(a,{...s,updatedAt:re()}),await this.logAuditEvent("USER_UPDATED",{userId:t,organizationId:s.organizationId})}catch(a){throw d.error("[DataService] Error updating user:",a),a}}static async deactivateUser(t,s){try{const r=Q(B,"organizations",s,"users",t);await Te(r,{isActive:!1,updatedAt:re()});try{await ds.setUserActiveStatus(t,!1),d.debug(`📋 Updated UserOrgIndex active status: ${t} → false`)}catch(a){d.error("❌ Failed to update UserOrgIndex active status:",a)}await this.logAuditEvent("USER_DEACTIVATED",{userId:t,organizationId:s})}catch(r){throw d.error("[DataService] Error deactivating user:",r),r}}static async createDocumentTemplate(t){try{if(!t.organizationId)throw new Error("Organization ID is required for template creation");const s=t.id?Q(B,"organizations",t.organizationId,"templates",t.id):Q(se(B,"organizations",t.organizationId,"templates")),r={...t,createdAt:re(),updatedAt:re()};return await ze(s,r),await this.logAuditEvent("TEMPLATE_CREATED",{templateId:s.id,organizationId:t.organizationId}),s.id}catch(s){throw d.error("[DataService] Error creating template:",s),s}}static async getDocumentTemplates(t){try{const s=se(B,"organizations",t,"templates"),r=X(s,J("isActive","==",!0),le("name"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertDate(i.data().createdAt),updatedAt:this.convertDate(i.data().updatedAt)}))}catch(s){return d.error("[DataService] Error getting templates:",s),[]}}static async updateDocumentTemplate(t,s,r){try{const a=Q(B,"organizations",r,"templates",t);await Te(a,{...s,updatedAt:re()}),await this.logAuditEvent("TEMPLATE_UPDATED",{templateId:t,organizationId:s.organizationId})}catch(a){throw d.error("[DataService] Error updating template:",a),a}}static async getEscalationRules(t){try{const s=se(B,"organizations",t,"escalationRules"),r=X(s,J("isActive","==",!0),le("category"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data()}))}catch(s){return d.error("[DataService] Error getting escalation rules:",s),[]}}static async createEscalationRule(t,s){try{const r=Q(se(B,"organizations",s,"escalationRules")),a={...t,organizationId:s,createdAt:re(),updatedAt:re()};return await ze(r,a),await this.logAuditEvent("ESCALATION_RULE_CREATED",{ruleId:r.id,organizationId:s}),r.id}catch(r){throw d.error("[DataService] Error creating escalation rule:",r),r}}static async getOrganizationStats(t){try{const[s,r,a]=await Promise.all([this.getEmployeesByOrganization(t),this.getWarningsByOrganization(t,100),this.getActiveWarnings(t)]),i=new Date,o=new Date(i.getTime()-720*60*60*1e3),l=r.filter(c=>c.issueDate>=o),m=r.reduce((c,x)=>(c[x.level]=(c[x.level]||0)+1,c),{});return{totalEmployees:s.length,activeEmployees:s.filter(c=>c.isActive).length,totalWarnings:r.length,activeWarnings:a.length,recentWarnings:l.length,warningsByLevel:m,lastUpdated:i}}catch(s){return d.error("[DataService] Error getting organization stats:",s),{totalEmployees:0,activeEmployees:0,totalWarnings:0,activeWarnings:0,recentWarnings:0,warningsByLevel:{},lastUpdated:new Date}}}static async getActiveWarnings(t){try{const s=se(B,"organizations",t,"warnings"),r=new Date,a=X(s,J("isActive","==",!0),J("expiryDate",">",r));return(await oe(a)).docs.map(o=>({id:o.id,...o.data(),issueDate:this.convertDate(o.data().issueDate),expiryDate:this.convertDate(o.data().expiryDate),incidentDate:this.convertDate(o.data().incidentDate),createdAt:this.convertDate(o.data().createdAt),updatedAt:this.convertDate(o.data().updatedAt)}))}catch(s){return d.error("[DataService] Error getting active warnings:",s),[]}}static async createAuditLog(t){try{await vs(se(B,Me.AUDIT_LOGS),{...t,timestamp:re(),userId:Nt.currentUser?.uid||"system"})}catch(s){d.error("[DataService] Error creating audit log:",s)}}static async logAuditEvent(t,s){}static async getUserIP(){try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return"unknown"}}static async getAuditLogs(t,s=50){try{const r=se(B,Me.AUDIT_LOGS),a=X(r,J("data.organizationId","==",t),le("timestamp","desc"),ht(s));return(await oe(a)).docs.map(o=>({id:o.id,...o.data(),timestamp:this.convertDate(o.data().timestamp)}))}catch(r){return d.error("[DataService] Error getting audit logs:",r),[]}}static validateWarningLevel(t,s,r){try{return s.escalationPath.includes(r)?{isValid:!0}:{isValid:!1,reason:`${r} is not valid for category "${s.name}"`,suggestedLevel:s.escalationPath[0]}}catch(a){return d.error("[DataService] Error validating warning level:",a),{isValid:!1,reason:"Validation error occurred"}}}static async employeeExists(t){try{return await this.getEmployee(t)!==null}catch(s){return d.error("[DataService] Error checking employee existence:",s),!1}}static async organizationExists(t){try{return await this.getOrganization(t)!==null}catch(s){return d.error("[DataService] Error checking organization existence:",s),!1}}static async employeeNumberExists(t,s){try{const r=se(B,"organizations",t,"employees"),a=X(r,J("profile.employeeNumber","==",s));return!(await oe(a)).empty}catch(r){return d.error("[DataService] Error checking employee number existence:",r),!1}}static async getAllEmployeeNumbers(t){try{const s=se(B,Me.EMPLOYEES),r=X(s,J("organizationId","==",t));return(await oe(r)).docs.map(i=>i.data().profile?.employeeNumber).filter(i=>i&&typeof i=="string")}catch(s){return d.error("[DataService] Error getting employee numbers:",s),[]}}static async generateNextEmployeeNumber(t,s="EMP001",r="",a=1){try{const i=await this.getAllEmployeeNumbers(t);let o=a-1;i.forEach(m=>{const c=m.match(/(\d+)$/);if(c){const x=parseInt(c[1],10);x>o&&(o=x)}});const l=o+1;switch(s){case"EMP001":return`EMP${l.toString().padStart(3,"0")}`;case"E001":return`E${l.toString().padStart(3,"0")}`;case"001":return l.toString().padStart(3,"0");case"custom":return`${r}${l.toString().padStart(3,"0")}`;default:return`EMP${l.toString().padStart(3,"0")}`}}catch(i){return d.error("[DataService] Error generating employee number:",i),`EMP${Date.now().toString().slice(-3)}`}}static async validateEmployeeNumber(t,s,r){try{if(!s||s.trim().length===0)return{isValid:!1,isAvailable:!1,message:"Employee number is required"};if(s.length<2)return{isValid:!1,isAvailable:!1,message:"Employee number must be at least 2 characters"};const a=await this.employeeNumberExists(t,s);if(a&&r){const i=se(B,Me.EMPLOYEES),o=X(i,J("organizationId","==",t),J("profile.employeeNumber","==",s));if(!(await oe(o)).docs.some(c=>c.id===r))return{isValid:!0,isAvailable:!1,suggestions:[await this.generateNextEmployeeNumber(t,"EMP001"),await this.generateNextEmployeeNumber(t,"E001"),await this.generateNextEmployeeNumber(t,"001")],message:"Employee number already exists"}}else if(a)return{isValid:!0,isAvailable:!1,suggestions:[await this.generateNextEmployeeNumber(t,"EMP001"),await this.generateNextEmployeeNumber(t,"E001"),await this.generateNextEmployeeNumber(t,"001")],message:"Employee number already exists"};return{isValid:!0,isAvailable:!0,message:"Employee number is available"}}catch(a){return d.error("[DataService] Error validating employee number:",a),{isValid:!1,isAvailable:!1,message:"Error validating employee number"}}}static async cleanupExpiredWarnings(t){try{const s=se(B,Me.WARNINGS),r=new Date;let a=X(s,J("isActive","==",!0),J("expiryDate","<",r));t&&(a=X(s,J("organizationId","==",t),J("isActive","==",!0),J("expiryDate","<",r)));const i=await oe(a),o=Ct(B);return i.docs.forEach(l=>{o.update(l.ref,{isActive:!1,expiredAt:re(),updatedAt:re()})}),await o.commit(),t&&await this.logAuditEvent("WARNINGS_CLEANUP",{organizationId:t,expiredCount:i.docs.length}),d.debug(`[DataService] Cleaned up ${i.docs.length} expired warnings`),i.docs.length}catch(s){return d.error("[DataService] Error cleaning up expired warnings:",s),0}}static async getSystemHealthMetrics(){try{return{status:"healthy",timestamp:new Date,services:{firestore:"operational",auth:"operational",storage:"operational"}}}catch(t){return d.error("[DataService] Error getting system health:",t),{status:"degraded",timestamp:new Date,error:t instanceof Error?t.message:"Unknown error"}}}static getIndustryCategories(t,s){return d.debug(59470),this.convertUniversalToWarningCategories(s)}static async createWarningCategory(t){try{const s=t.organizationId;if(!s)throw new Error("Organization ID is required for creating categories");const r=t.id?Q(B,"organizations",s,"categories",t.id):Q(se(B,"organizations",s,"categories")),a={...t,createdAt:re(),updatedAt:re()};return await ze(r,a),await this.logAuditEvent("WARNING_CATEGORY_CREATED",{categoryId:r.id,organizationId:t.organizationId}),t.organizationId&&this.categoryCache.delete(t.organizationId),r.id}catch(s){throw d.error("[DataService] Error creating warning category:",s),s}}static async bulkCreateEmployees(t,s){try{const r=Ct(B),a=[];for(const i of t){const o=Q(se(B,Me.EMPLOYEES));a.push(o.id),r.set(o,{...i,organizationId:s,createdAt:re(),updatedAt:re()})}return await r.commit(),await this.logAuditEvent("EMPLOYEES_BULK_CREATED",{organizationId:s,count:t.length,employeeIds:a}),a}catch(r){throw d.error("[DataService] Error bulk creating employees:",r),r}}static async bulkUpdateWarningStatuses(t,s,r){try{const a=Ct(B);for(const i of t){const o=Q(B,Me.WARNINGS,i);a.update(o,{status:s,updatedAt:re()})}await a.commit(),await this.logAuditEvent("WARNINGS_BULK_STATUS_UPDATE",{organizationId:r,warningIds:t,newStatus:s,count:t.length})}catch(a){throw d.error("[DataService] Error bulk updating warning statuses:",a),a}}static async loadOrganizations(){try{d.debug(62944);const t=se(B,Me.ORGANIZATIONS),s=X(t,le("createdAt","desc")),a=(await oe(s)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertOptionalDate(i.data().createdAt),updatedAt:this.convertOptionalDate(i.data().updatedAt)}));return d.success(63433),a}catch(t){throw d.error("[DataService] Error loading organizations:",t),t}}static async getBatchEmployees(t,s){try{if(!t.length)return[];const r=[],a=10;for(let i=0;i<t.length;i+=a){const o=t.slice(i,i+a),l=se(B,Me.EMPLOYEES),m=X(l,J("organizationId","==",s),J("__name__","in",o)),x=(await oe(m)).docs.map(u=>({id:u.id,...u.data(),createdAt:this.convertOptionalDate(u.data().createdAt),updatedAt:this.convertOptionalDate(u.data().updatedAt)}));r.push(...x)}return d.success(65113),r}catch(r){return d.error("[DataService] Error in batch employee fetch:",r),[]}}static async getBatchWarningCategories(t,s){try{if(!t.length)return[];const r=[],a=10;for(let i=0;i<t.length;i+=a){const o=t.slice(i,i+a),l=se(B,"organizations",s,"categories"),m=X(l,J("__name__","in",o)),x=(await oe(m)).docs.map(u=>({id:u.id,...u.data(),createdAt:this.convertOptionalDate(u.data().createdAt),updatedAt:this.convertOptionalDate(u.data().updatedAt)}));r.push(...x)}return d.success(66603),r}catch(r){return d.error("[DataService] Error in batch category fetch:",r),[]}}static async getPaginatedEmployees(t,s=50,r){try{const a=se(B,Me.EMPLOYEES);let i=X(a,J("organizationId","==",t),J("isActive","==",!0),le("profile.lastName"),le("profile.firstName"),ht(s+1));if(r){const u=await Ze(Q(B,Me.EMPLOYEES,r));u.exists()&&(i=X(a,J("organizationId","==",t),J("isActive","==",!0),le("profile.lastName"),le("profile.firstName"),hs(u),ht(s+1)))}const l=(await oe(i)).docs.map(u=>({id:u.id,...u.data(),createdAt:this.convertOptionalDate(u.data().createdAt),updatedAt:this.convertOptionalDate(u.data().updatedAt)})),m=l.length>s,c=m?l.slice(0,s):l,x=c.length>0?c[c.length-1].id:void 0;return d.success(68710),{employees:c,hasMore:m,lastId:x}}catch(a){return d.error("[DataService] Error in paginated employee fetch:",a),{employees:[],hasMore:!1}}}static async updateWithOptimisticLocking(t,s,r,a=0){try{const i=Q(B,t,s),o=await Ze(i);if(!o.exists())return{success:!1,error:"Document not found"};const m=o.data().version||0;if(m!==a)return{success:!1,error:`Document was modified by another user. Expected version ${a}, found ${m}`};const c=m+1;return await Te(i,{...r,version:c,updatedAt:re()}),d.success(70248),{success:!0,newVersion:c}}catch(i){return d.error("[DataService] Optimistic locking error:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}static async createReseller(t){try{const s=`reseller_${Date.now()}`,r={...t,id:s,createdAt:re(),updatedAt:re()};return await ze(Q(B,"resellers",s),r),d.success(`✅ Reseller created: ${s}`),s}catch(s){throw d.error("❌ Failed to create reseller:",s),s}}static async updateReseller(t,s){try{await Te(Q(B,"resellers",t),{...s,updatedAt:re()}),d.success(`✅ Reseller updated: ${t}`)}catch(r){throw d.error("❌ Failed to update reseller:",r),r}}static async getReseller(t){try{const s=Q(B,"resellers",t),r=await Ze(s);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertOptionalDate(r.data().createdAt),updatedAt:this.convertOptionalDate(r.data().updatedAt)}:null}catch(s){throw d.error("❌ Failed to get reseller:",s),s}}static async getResellerClients(t){try{const s=se(B,Me.ORGANIZATIONS),r=X(s,J("resellerId","==",t),le("createdAt","desc")),i=(await oe(r)).docs.map(o=>({id:o.id,...o.data(),createdAt:this.convertOptionalDate(o.data().createdAt),updatedAt:this.convertOptionalDate(o.data().updatedAt)}));return d.success(`📊 Loaded ${i.length} clients for reseller ${t}`),i}catch(s){throw d.error("❌ Failed to get reseller clients:",s),s}}static async createSubscription(t){try{const s=`sub_${Date.now()}`,r={...t,id:s,createdAt:re(),updatedAt:re()};return await ze(Q(B,"subscriptions",s),r),d.success(`✅ Subscription created: ${s}`),s}catch(s){throw d.error("❌ Failed to create subscription:",s),s}}static async updateSubscription(t,s){try{await Te(Q(B,"subscriptions",t),{...s,updatedAt:re()}),d.success(`✅ Subscription updated: ${t}`)}catch(r){throw d.error("❌ Failed to update subscription:",r),r}}static async getOrganizationSubscription(t){try{const s=se(B,"subscriptions"),r=X(s,J("organizationId","==",t)),a=await oe(r);if(a.empty)return null;const i=a.docs[0];return{id:i.id,...i.data(),createdAt:this.convertOptionalDate(i.data().createdAt),updatedAt:this.convertOptionalDate(i.data().updatedAt)}}catch(s){throw d.error("❌ Failed to get subscription:",s),s}}static async createCommission(t){try{const s=t.id||`comm_${Date.now()}`,r={...t,id:s,createdAt:re(),updatedAt:re()};return await ze(Q(B,"commissions",s),r),d.success(`💰 Commission recorded: ${s}`),s}catch(s){throw d.error("❌ Failed to create commission:",s),s}}static async getResellerCommissions(t,s){try{const r=se(B,"commissions");let a=X(r,J("resellerId","==",t),le("createdAt","desc"));return s&&(a=X(a,ht(s))),(await oe(a)).docs.map(l=>({id:l.id,...l.data(),createdAt:this.convertOptionalDate(l.data().createdAt),updatedAt:this.convertOptionalDate(l.data().updatedAt)}))}catch(r){throw d.error("❌ Failed to get reseller commissions:",r),r}}static async updateOrganizationBilling(t,s){try{await Te(Q(B,Me.ORGANIZATIONS,t),{...s,updatedAt:re()}),d.success(`💳 Organization billing updated: ${t}`)}catch(r){throw d.error("❌ Failed to update organization billing:",r),r}}static async getOrganizationsWithBilling(){try{const t=se(B,Me.ORGANIZATIONS),s=X(t,le("createdAt","desc")),a=(await oe(s)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertOptionalDate(i.data().createdAt),updatedAt:this.convertOptionalDate(i.data().updatedAt)}));for(const i of a){const o=await this.getOrganizationSubscription(i.id);o&&(i.subscription=o)}return d.success(`📊 Loaded ${a.length} organizations with billing`),a}catch(t){throw d.error("❌ Failed to load organizations with billing:",t),t}}static async createCommissionReport(t){try{const s=t.id||`report_${t.resellerId}_${t.month}`,r={...t,id:s,createdAt:re(),updatedAt:re()};return await ze(Q(B,"commissionReports",s),r),d.success(`📄 Commission report created: ${s}`),s}catch(s){throw d.error("❌ Failed to create commission report:",s),s}}static async getPendingCommissionReports(){try{const t=se(B,"commissionReports"),s=X(t,J("payoutStatus","==","pending"),le("createdAt","asc"));return(await oe(s)).docs.map(i=>({id:i.id,...i.data(),createdAt:this.convertOptionalDate(i.data().createdAt),updatedAt:this.convertOptionalDate(i.data().updatedAt)}))}catch(t){throw d.error("❌ Failed to get pending commission reports:",t),t}}static async assignResellerToOrganization(t,s){try{await this.updateOrganizationBilling(t,{resellerId:s});const r=await this.getReseller(s);if(r){const a=[...r.clientIds||[],t];await this.updateReseller(s,{clientIds:a,totalClientsAcquired:ro(1)})}d.success(`🤝 Reseller ${s} assigned to organization ${t}`)}catch(r){throw d.error("❌ Failed to assign reseller to organization:",r),r}}static async getAllResellers(){try{const t=X(se(B,"resellers"),le("createdAt","desc"));return(await oe(t)).docs.map(r=>({id:r.id,...r.data(),createdAt:this.convertOptionalDate(r.data().createdAt),updatedAt:this.convertOptionalDate(r.data().updatedAt)}))}catch(t){throw d.error("Failed to get all resellers:",t),t}}static async getResellerDeployments(t,s){try{const r=X(se(B,"resellerDeployments"),J("resellerId","==",t),J("deployedAt",">=",s),le("deployedAt","desc"));return(await oe(r)).docs.map(i=>({id:i.id,...i.data(),deployedAt:i.data().deployedAt?.toDate()||new Date,createdAt:i.data().createdAt?.toDate()||new Date}))}catch(r){return d.error("Failed to get reseller deployments:",r),[]}}static async logResellerDeployment(t){try{await vs(se(B,"resellerDeployments"),{...t,createdAt:t.deployedAt}),d.info("Reseller deployment logged successfully")}catch(s){d.error("Failed to log reseller deployment:",s)}}};class qo{async calculateCommission(t){try{d.debug("Calculating commission for payment...",t);const s=await He.getOrganization(t.organizationId);if(!s?.resellerId)throw new Error("No reseller assigned to organization");if(!await He.getReseller(s.resellerId))throw new Error("Reseller not found");const a=t.grossAmount-t.stripeFees,i=Math.round(a*.5),o=Math.round(a*.3),l=Math.round(a*.2),m={id:`${t.organizationId}-${t.periodStart}`,resellerId:s.resellerId,organizationId:t.organizationId,subscriptionId:t.subscriptionId,periodStart:t.periodStart,periodEnd:t.periodEnd,clientRevenue:t.grossAmount,stripeFees:t.stripeFees,netRevenue:a,commissionAmount:i,ownerAmount:o,companyAmount:l,status:"calculated",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await ze(Q(B,"commissions",m.id),m),d.success("Commission calculated and saved:",m),m}catch(s){throw d.error("Failed to calculate commission:",s),s}}async processMonthlyPayouts(){try{d.debug("Processing monthly commission payouts...");const t=new Date;t.setDate(t.getDate()-30);const s=se(B,"commissions"),r=X(s,J("status","==","calculated"),J("createdAt","<",t.toISOString())),i=(await oe(r)).docs.map(m=>({id:m.id,...m.data()}));d.debug(`Found ${i.length} eligible commissions for payout`);const o=this.groupCommissionsByResellerMonth(i),l=[];for(const[m,c]of Object.entries(o)){const[x,u]=m.split("|"),h=await He.getReseller(x);if(!h)continue;const v=c.reduce((j,w)=>j+w.commissionAmount,0),g=c.reduce((j,w)=>j+w.netRevenue,0),b={resellerId:x,resellerName:`${h.firstName} ${h.lastName}`,month:u,province:h.province,totalClients:c.length,totalRevenue:g,totalCommission:v,commissions:c,payoutStatus:"pending",payoutDate:new Date().toISOString()};await ze(Q(B,"commissionReports",`${x}-${u}`),b);const f=Ct(B);for(const j of c)f.update(Q(B,"commissions",j.id),{status:"pending",updatedAt:re()});await f.commit(),l.push(b),d.success(`Generated commission report for ${h.firstName} ${h.lastName}: R${(v/100).toFixed(2)}`)}return l}catch(t){throw d.error("Failed to process monthly payouts:",t),t}}async markCommissionsPaid(t,s,r){try{d.debug("Marking commissions as paid...",{resellerId:t,month:s,payoutReference:r});const a=`${t}-${s}`;await Te(Q(B,"commissionReports",a),{payoutStatus:"paid",payoutReference:r,updatedAt:re()});const i=se(B,"commissions"),o=X(i,J("resellerId","==",t),J("status","==","pending")),l=await oe(o),m=Ct(B);l.docs.forEach(c=>{m.update(c.ref,{status:"paid",payoutReference:r,updatedAt:re()})}),await m.commit(),d.success("Commissions marked as paid",{resellerId:t,month:s,payoutReference:r})}catch(a){throw d.error("Failed to mark commissions as paid:",a),a}}async getResellerMetrics(t){try{if(d.debug(`Getting metrics for reseller: ${t}`),!await He.getReseller(t))throw new Error("Reseller not found");const r=await He.getResellerClients(t),a=r.filter(R=>R.isActive!==!1),i=se(B,"commissions"),o=X(i,J("resellerId","==",t)),m=(await oe(o)).docs.map(R=>R.data()),c=m.reduce((R,_)=>R+_.commissionAmount,0),x=m.reduce((R,_)=>R+_.netRevenue,0),u=new Date().toISOString().slice(0,7),h=m.filter(R=>R.periodStart.startsWith(u)),v=h.reduce((R,_)=>R+_.netRevenue,0),g=h.reduce((R,_)=>R+_.commissionAmount,0),b=a.length>0?v/a.length:0;let f="None";if(r.length>0){const _=r.map(F=>({name:F.name,revenue:F.monthlySubscription||0})).sort((F,k)=>k.revenue-F.revenue)[0];_.revenue>0&&(f=_.name)}const j=new Date;j.setMonth(j.getMonth()-1);const w=j.toISOString().slice(0,7),D=m.filter(R=>R.periodStart.startsWith(w)).reduce((R,_)=>R+_.netRevenue,0),S=D>0?(v-D)/D*100:0,A={totalClients:r.length,activeClients:a.length,monthlyRecurringRevenue:v,totalCommissionsEarned:c,monthlyCommissions:g,averageClientValue:b,monthlyGrowth:S,conversionRate:75,topPerformingClient:f};return d.success("Reseller metrics calculated:",A),A}catch(s){return d.error("Failed to get reseller metrics:",s),{totalClients:0,activeClients:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0,monthlyCommissions:0,averageClientValue:0,monthlyGrowth:0,conversionRate:0,topPerformingClient:"None"}}}async getProvincialMetrics(){try{d.debug("Getting provincial metrics...");const t=await He.getAllResellers(),s={};for(const r of t){const a=r.province;s[a]||(s[a]={resellers:0,clients:0,monthlyRevenue:0,commissionsOwed:0}),s[a].resellers+=1,s[a].clients+=r.clientIds.length,s[a].monthlyRevenue+=r.monthlyRecurringRevenue;const i=se(B,"commissions"),o=X(i,J("resellerId","==",r.id),J("status","in",["pending","calculated"])),m=(await oe(o)).docs.reduce((c,x)=>c+(x.data().commissionAmount||0),0);s[a].commissionsOwed+=m}return d.success("Provincial metrics calculated:",s),s}catch(t){throw d.error("Failed to get provincial metrics:",t),t}}groupCommissionsByResellerMonth(t){const s={};for(const r of t){const a=r.periodStart.slice(0,7),i=`${r.resellerId}|${a}`;s[i]||(s[i]=[]),s[i].push(r)}return s}async getRecentCommissions(t,s=5){try{d.debug(`Getting recent commissions for reseller: ${t}`);const r=se(B,"commissions"),a=X(r,J("resellerId","==",t),le("createdAt","desc")),o=(await oe(a)).docs.map(m=>m.data()),l=[];for(let m=0;m<Math.min(o.length,s);m++){const c=o[m];let x="Unknown Client";try{const u=await He.getOrganization(c.organizationId);u&&(x=u.name)}catch{d.warn(`Could not get organization name for ${c.organizationId}`)}l.push({id:c.id,clientName:x,periodStart:c.periodStart,periodEnd:c.periodEnd,commissionAmount:c.commissionAmount,baseAmount:c.netRevenue,commissionRate:.5})}return d.success(`Retrieved ${l.length} recent commissions for reseller`),l}catch(r){return d.error("Failed to get recent commissions:",r),[]}}async getPerformanceTrend(t,s){try{d.debug(`Getting performance trend for reseller: ${t}, timeframe: ${s}`);const r=s==="3m"?3:s==="6m"?6:12,a=se(B,"commissions"),i=X(a,J("resellerId","==",t),le("periodStart","desc")),l=(await oe(i)).docs.map(u=>u.data()),m={};l.forEach(u=>{const h=u.periodStart.slice(0,7);m[h]||(m[h]={revenue:0,commissions:0}),m[h].revenue+=u.netRevenue,m[h].commissions+=u.commissionAmount});const c=[],x=new Date;for(let u=0;u<r;u++){const h=new Date(x.getFullYear(),x.getMonth()-u,1),v=h.toISOString().slice(0,7),g=h.toLocaleDateString("en-US",{month:"short",year:"numeric"});c.unshift({month:g,revenue:m[v]?.revenue||0,commissions:m[v]?.commissions||0})}return d.success(`Retrieved ${c.length} months of performance data for reseller`),c}catch(r){return d.error("Failed to get performance trend:",r),[]}}async generateCommissionStatement(t){try{d.debug(`Generating commission statement for reseller: ${t}`),d.warn("Commission statement generation not yet implemented - feature requested"),await new Promise(s=>setTimeout(s,1e3))}catch(s){throw d.error("Failed to generate commission statement:",s),s}}async getClientMetrics(t){try{d.debug("Loading client metrics...",{organizationId:t});const s=await He.getOrganization(t);if(!s)throw new Error("Organization not found");const a=(await je.loadEmployees(t)).documents,o=(await je.loadWarnings(t)).documents,l=new Date;l.setDate(1);const m=o.filter(c=>new Date(c.issueDate)>=l).length;return{monthlyRevenue:s.monthlySubscription||5e4,employeeCount:a.length,lastActivity:new Date().toISOString(),subscriptionStatus:s.isActive===!1?"inactive":"active",warningsThisMonth:m,complianceScore:Math.max(95-m*5,60)}}catch(s){return d.error("Failed to get client metrics:",s),{monthlyRevenue:0,employeeCount:0,lastActivity:new Date().toISOString(),subscriptionStatus:"inactive",warningsThisMonth:0,complianceScore:0}}}formatCurrency(t){return`R${(t/100).toFixed(2)}`}}const As=new qo;var Xs={exports:{}};function Go(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Js={exports:{}};const Vo={},Qo=Object.freeze(Object.defineProperty({__proto__:null,default:Vo},Symbol.toStringTag,{value:"Module"})),Ko=Gi(Qo);var Yo=Js.exports,Ga;function fe(){return Ga||(Ga=1,(function(n,t){(function(s,r){n.exports=r()})(Yo,function(){var s=s||(function(r,a){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof ea<"u"&&ea.crypto&&(i=ea.crypto),!i&&typeof Go=="function")try{i=Ko}catch{}var o=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},l=Object.create||(function(){function w(){}return function(C){var D;return w.prototype=C,D=new w,w.prototype=null,D}})(),m={},c=m.lib={},x=c.Base=(function(){return{extend:function(w){var C=l(this);return w&&C.mixIn(w),(!C.hasOwnProperty("init")||this.init===C.init)&&(C.init=function(){C.$super.init.apply(this,arguments)}),C.init.prototype=C,C.$super=this,C},create:function(){var w=this.extend();return w.init.apply(w,arguments),w},init:function(){},mixIn:function(w){for(var C in w)w.hasOwnProperty(C)&&(this[C]=w[C]);w.hasOwnProperty("toString")&&(this.toString=w.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),u=c.WordArray=x.extend({init:function(w,C){w=this.words=w||[],C!=a?this.sigBytes=C:this.sigBytes=w.length*4},toString:function(w){return(w||v).stringify(this)},concat:function(w){var C=this.words,D=w.words,S=this.sigBytes,y=w.sigBytes;if(this.clamp(),S%4)for(var A=0;A<y;A++){var R=D[A>>>2]>>>24-A%4*8&255;C[S+A>>>2]|=R<<24-(S+A)%4*8}else for(var _=0;_<y;_+=4)C[S+_>>>2]=D[_>>>2];return this.sigBytes+=y,this},clamp:function(){var w=this.words,C=this.sigBytes;w[C>>>2]&=4294967295<<32-C%4*8,w.length=r.ceil(C/4)},clone:function(){var w=x.clone.call(this);return w.words=this.words.slice(0),w},random:function(w){for(var C=[],D=0;D<w;D+=4)C.push(o());return new u.init(C,w)}}),h=m.enc={},v=h.Hex={stringify:function(w){for(var C=w.words,D=w.sigBytes,S=[],y=0;y<D;y++){var A=C[y>>>2]>>>24-y%4*8&255;S.push((A>>>4).toString(16)),S.push((A&15).toString(16))}return S.join("")},parse:function(w){for(var C=w.length,D=[],S=0;S<C;S+=2)D[S>>>3]|=parseInt(w.substr(S,2),16)<<24-S%8*4;return new u.init(D,C/2)}},g=h.Latin1={stringify:function(w){for(var C=w.words,D=w.sigBytes,S=[],y=0;y<D;y++){var A=C[y>>>2]>>>24-y%4*8&255;S.push(String.fromCharCode(A))}return S.join("")},parse:function(w){for(var C=w.length,D=[],S=0;S<C;S++)D[S>>>2]|=(w.charCodeAt(S)&255)<<24-S%4*8;return new u.init(D,C)}},b=h.Utf8={stringify:function(w){try{return decodeURIComponent(escape(g.stringify(w)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(w){return g.parse(unescape(encodeURIComponent(w)))}},f=c.BufferedBlockAlgorithm=x.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(w){typeof w=="string"&&(w=b.parse(w)),this._data.concat(w),this._nDataBytes+=w.sigBytes},_process:function(w){var C,D=this._data,S=D.words,y=D.sigBytes,A=this.blockSize,R=A*4,_=y/R;w?_=r.ceil(_):_=r.max((_|0)-this._minBufferSize,0);var F=_*A,k=r.min(F*4,y);if(F){for(var E=0;E<F;E+=A)this._doProcessBlock(S,E);C=S.splice(0,F),D.sigBytes-=k}return new u.init(C,k)},clone:function(){var w=x.clone.call(this);return w._data=this._data.clone(),w},_minBufferSize:0});c.Hasher=f.extend({cfg:x.extend(),init:function(w){this.cfg=this.cfg.extend(w),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(w){return this._append(w),this._process(),this},finalize:function(w){w&&this._append(w);var C=this._doFinalize();return C},blockSize:16,_createHelper:function(w){return function(C,D){return new w.init(D).finalize(C)}},_createHmacHelper:function(w){return function(C,D){return new j.HMAC.init(w,D).finalize(C)}}});var j=m.algo={};return m})(Math);return s})})(Js)),Js.exports}var er={exports:{}},Zo=er.exports,Va;function Qr(){return Va||(Va=1,(function(n,t){(function(s,r){n.exports=r(fe())})(Zo,function(s){return(function(r){var a=s,i=a.lib,o=i.Base,l=i.WordArray,m=a.x64={};m.Word=o.extend({init:function(c,x){this.high=c,this.low=x}}),m.WordArray=o.extend({init:function(c,x){c=this.words=c||[],x!=r?this.sigBytes=x:this.sigBytes=c.length*8},toX32:function(){for(var c=this.words,x=c.length,u=[],h=0;h<x;h++){var v=c[h];u.push(v.high),u.push(v.low)}return l.create(u,this.sigBytes)},clone:function(){for(var c=o.clone.call(this),x=c.words=this.words.slice(0),u=x.length,h=0;h<u;h++)x[h]=x[h].clone();return c}})})(),s})})(er)),er.exports}var tr={exports:{}},Xo=tr.exports,Qa;function Jo(){return Qa||(Qa=1,(function(n,t){(function(s,r){n.exports=r(fe())})(Xo,function(s){return(function(){if(typeof ArrayBuffer=="function"){var r=s,a=r.lib,i=a.WordArray,o=i.init,l=i.init=function(m){if(m instanceof ArrayBuffer&&(m=new Uint8Array(m)),(m instanceof Int8Array||typeof Uint8ClampedArray<"u"&&m instanceof Uint8ClampedArray||m instanceof Int16Array||m instanceof Uint16Array||m instanceof Int32Array||m instanceof Uint32Array||m instanceof Float32Array||m instanceof Float64Array)&&(m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength)),m instanceof Uint8Array){for(var c=m.byteLength,x=[],u=0;u<c;u++)x[u>>>2]|=m[u]<<24-u%4*8;o.call(this,x,c)}else o.apply(this,arguments)};l.prototype=i}})(),s.lib.WordArray})})(tr)),tr.exports}var sr={exports:{}},el=sr.exports,Ka;function tl(){return Ka||(Ka=1,(function(n,t){(function(s,r){n.exports=r(fe())})(el,function(s){return(function(){var r=s,a=r.lib,i=a.WordArray,o=r.enc;o.Utf16=o.Utf16BE={stringify:function(m){for(var c=m.words,x=m.sigBytes,u=[],h=0;h<x;h+=2){var v=c[h>>>2]>>>16-h%4*8&65535;u.push(String.fromCharCode(v))}return u.join("")},parse:function(m){for(var c=m.length,x=[],u=0;u<c;u++)x[u>>>1]|=m.charCodeAt(u)<<16-u%2*16;return i.create(x,c*2)}},o.Utf16LE={stringify:function(m){for(var c=m.words,x=m.sigBytes,u=[],h=0;h<x;h+=2){var v=l(c[h>>>2]>>>16-h%4*8&65535);u.push(String.fromCharCode(v))}return u.join("")},parse:function(m){for(var c=m.length,x=[],u=0;u<c;u++)x[u>>>1]|=l(m.charCodeAt(u)<<16-u%2*16);return i.create(x,c*2)}};function l(m){return m<<8&4278255360|m>>>8&16711935}})(),s.enc.Utf16})})(sr)),sr.exports}var rr={exports:{}},sl=rr.exports,Ya;function ns(){return Ya||(Ya=1,(function(n,t){(function(s,r){n.exports=r(fe())})(sl,function(s){return(function(){var r=s,a=r.lib,i=a.WordArray,o=r.enc;o.Base64={stringify:function(m){var c=m.words,x=m.sigBytes,u=this._map;m.clamp();for(var h=[],v=0;v<x;v+=3)for(var g=c[v>>>2]>>>24-v%4*8&255,b=c[v+1>>>2]>>>24-(v+1)%4*8&255,f=c[v+2>>>2]>>>24-(v+2)%4*8&255,j=g<<16|b<<8|f,w=0;w<4&&v+w*.75<x;w++)h.push(u.charAt(j>>>6*(3-w)&63));var C=u.charAt(64);if(C)for(;h.length%4;)h.push(C);return h.join("")},parse:function(m){var c=m.length,x=this._map,u=this._reverseMap;if(!u){u=this._reverseMap=[];for(var h=0;h<x.length;h++)u[x.charCodeAt(h)]=h}var v=x.charAt(64);if(v){var g=m.indexOf(v);g!==-1&&(c=g)}return l(m,c,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function l(m,c,x){for(var u=[],h=0,v=0;v<c;v++)if(v%4){var g=x[m.charCodeAt(v-1)]<<v%4*2,b=x[m.charCodeAt(v)]>>>6-v%4*2,f=g|b;u[h>>>2]|=f<<24-h%4*8,h++}return i.create(u,h)}})(),s.enc.Base64})})(rr)),rr.exports}var ar={exports:{}},rl=ar.exports,Za;function al(){return Za||(Za=1,(function(n,t){(function(s,r){n.exports=r(fe())})(rl,function(s){return(function(){var r=s,a=r.lib,i=a.WordArray,o=r.enc;o.Base64url={stringify:function(m,c){c===void 0&&(c=!0);var x=m.words,u=m.sigBytes,h=c?this._safe_map:this._map;m.clamp();for(var v=[],g=0;g<u;g+=3)for(var b=x[g>>>2]>>>24-g%4*8&255,f=x[g+1>>>2]>>>24-(g+1)%4*8&255,j=x[g+2>>>2]>>>24-(g+2)%4*8&255,w=b<<16|f<<8|j,C=0;C<4&&g+C*.75<u;C++)v.push(h.charAt(w>>>6*(3-C)&63));var D=h.charAt(64);if(D)for(;v.length%4;)v.push(D);return v.join("")},parse:function(m,c){c===void 0&&(c=!0);var x=m.length,u=c?this._safe_map:this._map,h=this._reverseMap;if(!h){h=this._reverseMap=[];for(var v=0;v<u.length;v++)h[u.charCodeAt(v)]=v}var g=u.charAt(64);if(g){var b=m.indexOf(g);b!==-1&&(x=b)}return l(m,x,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function l(m,c,x){for(var u=[],h=0,v=0;v<c;v++)if(v%4){var g=x[m.charCodeAt(v-1)]<<v%4*2,b=x[m.charCodeAt(v)]>>>6-v%4*2,f=g|b;u[h>>>2]|=f<<24-h%4*8,h++}return i.create(u,h)}})(),s.enc.Base64url})})(ar)),ar.exports}var nr={exports:{}},nl=nr.exports,Xa;function is(){return Xa||(Xa=1,(function(n,t){(function(s,r){n.exports=r(fe())})(nl,function(s){return(function(r){var a=s,i=a.lib,o=i.WordArray,l=i.Hasher,m=a.algo,c=[];(function(){for(var b=0;b<64;b++)c[b]=r.abs(r.sin(b+1))*4294967296|0})();var x=m.MD5=l.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(b,f){for(var j=0;j<16;j++){var w=f+j,C=b[w];b[w]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}var D=this._hash.words,S=b[f+0],y=b[f+1],A=b[f+2],R=b[f+3],_=b[f+4],F=b[f+5],k=b[f+6],E=b[f+7],N=b[f+8],I=b[f+9],T=b[f+10],z=b[f+11],O=b[f+12],q=b[f+13],Y=b[f+14],G=b[f+15],P=D[0],L=D[1],U=D[2],W=D[3];P=u(P,L,U,W,S,7,c[0]),W=u(W,P,L,U,y,12,c[1]),U=u(U,W,P,L,A,17,c[2]),L=u(L,U,W,P,R,22,c[3]),P=u(P,L,U,W,_,7,c[4]),W=u(W,P,L,U,F,12,c[5]),U=u(U,W,P,L,k,17,c[6]),L=u(L,U,W,P,E,22,c[7]),P=u(P,L,U,W,N,7,c[8]),W=u(W,P,L,U,I,12,c[9]),U=u(U,W,P,L,T,17,c[10]),L=u(L,U,W,P,z,22,c[11]),P=u(P,L,U,W,O,7,c[12]),W=u(W,P,L,U,q,12,c[13]),U=u(U,W,P,L,Y,17,c[14]),L=u(L,U,W,P,G,22,c[15]),P=h(P,L,U,W,y,5,c[16]),W=h(W,P,L,U,k,9,c[17]),U=h(U,W,P,L,z,14,c[18]),L=h(L,U,W,P,S,20,c[19]),P=h(P,L,U,W,F,5,c[20]),W=h(W,P,L,U,T,9,c[21]),U=h(U,W,P,L,G,14,c[22]),L=h(L,U,W,P,_,20,c[23]),P=h(P,L,U,W,I,5,c[24]),W=h(W,P,L,U,Y,9,c[25]),U=h(U,W,P,L,R,14,c[26]),L=h(L,U,W,P,N,20,c[27]),P=h(P,L,U,W,q,5,c[28]),W=h(W,P,L,U,A,9,c[29]),U=h(U,W,P,L,E,14,c[30]),L=h(L,U,W,P,O,20,c[31]),P=v(P,L,U,W,F,4,c[32]),W=v(W,P,L,U,N,11,c[33]),U=v(U,W,P,L,z,16,c[34]),L=v(L,U,W,P,Y,23,c[35]),P=v(P,L,U,W,y,4,c[36]),W=v(W,P,L,U,_,11,c[37]),U=v(U,W,P,L,E,16,c[38]),L=v(L,U,W,P,T,23,c[39]),P=v(P,L,U,W,q,4,c[40]),W=v(W,P,L,U,S,11,c[41]),U=v(U,W,P,L,R,16,c[42]),L=v(L,U,W,P,k,23,c[43]),P=v(P,L,U,W,I,4,c[44]),W=v(W,P,L,U,O,11,c[45]),U=v(U,W,P,L,G,16,c[46]),L=v(L,U,W,P,A,23,c[47]),P=g(P,L,U,W,S,6,c[48]),W=g(W,P,L,U,E,10,c[49]),U=g(U,W,P,L,Y,15,c[50]),L=g(L,U,W,P,F,21,c[51]),P=g(P,L,U,W,O,6,c[52]),W=g(W,P,L,U,R,10,c[53]),U=g(U,W,P,L,T,15,c[54]),L=g(L,U,W,P,y,21,c[55]),P=g(P,L,U,W,N,6,c[56]),W=g(W,P,L,U,G,10,c[57]),U=g(U,W,P,L,k,15,c[58]),L=g(L,U,W,P,q,21,c[59]),P=g(P,L,U,W,_,6,c[60]),W=g(W,P,L,U,z,10,c[61]),U=g(U,W,P,L,A,15,c[62]),L=g(L,U,W,P,I,21,c[63]),D[0]=D[0]+P|0,D[1]=D[1]+L|0,D[2]=D[2]+U|0,D[3]=D[3]+W|0},_doFinalize:function(){var b=this._data,f=b.words,j=this._nDataBytes*8,w=b.sigBytes*8;f[w>>>5]|=128<<24-w%32;var C=r.floor(j/4294967296),D=j;f[(w+64>>>9<<4)+15]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,f[(w+64>>>9<<4)+14]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360,b.sigBytes=(f.length+1)*4,this._process();for(var S=this._hash,y=S.words,A=0;A<4;A++){var R=y[A];y[A]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360}return S},clone:function(){var b=l.clone.call(this);return b._hash=this._hash.clone(),b}});function u(b,f,j,w,C,D,S){var y=b+(f&j|~f&w)+C+S;return(y<<D|y>>>32-D)+f}function h(b,f,j,w,C,D,S){var y=b+(f&w|j&~w)+C+S;return(y<<D|y>>>32-D)+f}function v(b,f,j,w,C,D,S){var y=b+(f^j^w)+C+S;return(y<<D|y>>>32-D)+f}function g(b,f,j,w,C,D,S){var y=b+(j^(f|~w))+C+S;return(y<<D|y>>>32-D)+f}a.MD5=l._createHelper(x),a.HmacMD5=l._createHmacHelper(x)})(Math),s.MD5})})(nr)),nr.exports}var ir={exports:{}},il=ir.exports,Ja;function mi(){return Ja||(Ja=1,(function(n,t){(function(s,r){n.exports=r(fe())})(il,function(s){return(function(){var r=s,a=r.lib,i=a.WordArray,o=a.Hasher,l=r.algo,m=[],c=l.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(x,u){for(var h=this._hash.words,v=h[0],g=h[1],b=h[2],f=h[3],j=h[4],w=0;w<80;w++){if(w<16)m[w]=x[u+w]|0;else{var C=m[w-3]^m[w-8]^m[w-14]^m[w-16];m[w]=C<<1|C>>>31}var D=(v<<5|v>>>27)+j+m[w];w<20?D+=(g&b|~g&f)+1518500249:w<40?D+=(g^b^f)+1859775393:w<60?D+=(g&b|g&f|b&f)-1894007588:D+=(g^b^f)-899497514,j=f,f=b,b=g<<30|g>>>2,g=v,v=D}h[0]=h[0]+v|0,h[1]=h[1]+g|0,h[2]=h[2]+b|0,h[3]=h[3]+f|0,h[4]=h[4]+j|0},_doFinalize:function(){var x=this._data,u=x.words,h=this._nDataBytes*8,v=x.sigBytes*8;return u[v>>>5]|=128<<24-v%32,u[(v+64>>>9<<4)+14]=Math.floor(h/4294967296),u[(v+64>>>9<<4)+15]=h,x.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var x=o.clone.call(this);return x._hash=this._hash.clone(),x}});r.SHA1=o._createHelper(c),r.HmacSHA1=o._createHmacHelper(c)})(),s.SHA1})})(ir)),ir.exports}var or={exports:{}},ol=or.exports,en;function Ca(){return en||(en=1,(function(n,t){(function(s,r){n.exports=r(fe())})(ol,function(s){return(function(r){var a=s,i=a.lib,o=i.WordArray,l=i.Hasher,m=a.algo,c=[],x=[];(function(){function v(j){for(var w=r.sqrt(j),C=2;C<=w;C++)if(!(j%C))return!1;return!0}function g(j){return(j-(j|0))*4294967296|0}for(var b=2,f=0;f<64;)v(b)&&(f<8&&(c[f]=g(r.pow(b,1/2))),x[f]=g(r.pow(b,1/3)),f++),b++})();var u=[],h=m.SHA256=l.extend({_doReset:function(){this._hash=new o.init(c.slice(0))},_doProcessBlock:function(v,g){for(var b=this._hash.words,f=b[0],j=b[1],w=b[2],C=b[3],D=b[4],S=b[5],y=b[6],A=b[7],R=0;R<64;R++){if(R<16)u[R]=v[g+R]|0;else{var _=u[R-15],F=(_<<25|_>>>7)^(_<<14|_>>>18)^_>>>3,k=u[R-2],E=(k<<15|k>>>17)^(k<<13|k>>>19)^k>>>10;u[R]=F+u[R-7]+E+u[R-16]}var N=D&S^~D&y,I=f&j^f&w^j&w,T=(f<<30|f>>>2)^(f<<19|f>>>13)^(f<<10|f>>>22),z=(D<<26|D>>>6)^(D<<21|D>>>11)^(D<<7|D>>>25),O=A+z+N+x[R]+u[R],q=T+I;A=y,y=S,S=D,D=C+O|0,C=w,w=j,j=f,f=O+q|0}b[0]=b[0]+f|0,b[1]=b[1]+j|0,b[2]=b[2]+w|0,b[3]=b[3]+C|0,b[4]=b[4]+D|0,b[5]=b[5]+S|0,b[6]=b[6]+y|0,b[7]=b[7]+A|0},_doFinalize:function(){var v=this._data,g=v.words,b=this._nDataBytes*8,f=v.sigBytes*8;return g[f>>>5]|=128<<24-f%32,g[(f+64>>>9<<4)+14]=r.floor(b/4294967296),g[(f+64>>>9<<4)+15]=b,v.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var v=l.clone.call(this);return v._hash=this._hash.clone(),v}});a.SHA256=l._createHelper(h),a.HmacSHA256=l._createHmacHelper(h)})(Math),s.SHA256})})(or)),or.exports}var lr={exports:{}},ll=lr.exports,tn;function cl(){return tn||(tn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Ca())})(ll,function(s){return(function(){var r=s,a=r.lib,i=a.WordArray,o=r.algo,l=o.SHA256,m=o.SHA224=l.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var c=l._doFinalize.call(this);return c.sigBytes-=4,c}});r.SHA224=l._createHelper(m),r.HmacSHA224=l._createHmacHelper(m)})(),s.SHA224})})(lr)),lr.exports}var cr={exports:{}},dl=cr.exports,sn;function ui(){return sn||(sn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Qr())})(dl,function(s){return(function(){var r=s,a=r.lib,i=a.Hasher,o=r.x64,l=o.Word,m=o.WordArray,c=r.algo;function x(){return l.create.apply(l,arguments)}var u=[x(1116352408,3609767458),x(1899447441,602891725),x(3049323471,3964484399),x(3921009573,2173295548),x(961987163,4081628472),x(1508970993,3053834265),x(2453635748,2937671579),x(2870763221,3664609560),x(3624381080,2734883394),x(310598401,1164996542),x(607225278,1323610764),x(1426881987,3590304994),x(1925078388,4068182383),x(2162078206,991336113),x(2614888103,633803317),x(3248222580,3479774868),x(3835390401,2666613458),x(4022224774,944711139),x(264347078,2341262773),x(604807628,2007800933),x(770255983,1495990901),x(1249150122,1856431235),x(1555081692,3175218132),x(1996064986,2198950837),x(2554220882,3999719339),x(2821834349,766784016),x(2952996808,2566594879),x(3210313671,3203337956),x(3336571891,1034457026),x(3584528711,2466948901),x(113926993,3758326383),x(338241895,168717936),x(666307205,1188179964),x(773529912,1546045734),x(1294757372,1522805485),x(1396182291,2643833823),x(1695183700,2343527390),x(1986661051,1014477480),x(2177026350,1206759142),x(2456956037,344077627),x(2730485921,1290863460),x(2820302411,3158454273),x(3259730800,3505952657),x(3345764771,106217008),x(3516065817,3606008344),x(3600352804,1432725776),x(4094571909,1467031594),x(275423344,851169720),x(430227734,3100823752),x(506948616,1363258195),x(659060556,3750685593),x(883997877,3785050280),x(958139571,3318307427),x(1322822218,3812723403),x(1537002063,2003034995),x(1747873779,3602036899),x(1955562222,1575990012),x(2024104815,1125592928),x(2227730452,2716904306),x(2361852424,442776044),x(2428436474,593698344),x(2756734187,3733110249),x(3204031479,2999351573),x(3329325298,3815920427),x(3391569614,3928383900),x(3515267271,566280711),x(3940187606,3454069534),x(4118630271,4000239992),x(116418474,1914138554),x(174292421,2731055270),x(289380356,3203993006),x(460393269,320620315),x(685471733,587496836),x(852142971,1086792851),x(1017036298,365543100),x(1126000580,2618297676),x(1288033470,3409855158),x(1501505948,4234509866),x(1607167915,987167468),x(1816402316,1246189591)],h=[];(function(){for(var g=0;g<80;g++)h[g]=x()})();var v=c.SHA512=i.extend({_doReset:function(){this._hash=new m.init([new l.init(1779033703,4089235720),new l.init(3144134277,2227873595),new l.init(1013904242,4271175723),new l.init(2773480762,1595750129),new l.init(1359893119,2917565137),new l.init(2600822924,725511199),new l.init(528734635,4215389547),new l.init(1541459225,327033209)])},_doProcessBlock:function(g,b){for(var f=this._hash.words,j=f[0],w=f[1],C=f[2],D=f[3],S=f[4],y=f[5],A=f[6],R=f[7],_=j.high,F=j.low,k=w.high,E=w.low,N=C.high,I=C.low,T=D.high,z=D.low,O=S.high,q=S.low,Y=y.high,G=y.low,P=A.high,L=A.low,U=R.high,W=R.low,$=_,H=F,V=k,ee=E,Z=N,Ee=I,Ae=T,de=z,pe=O,te=q,Be=Y,rt=G,ct=P,Ge=L,Le=U,M=W,K=0;K<80;K++){var ce,be,$e=h[K];if(K<16)be=$e.high=g[b+K*2]|0,ce=$e.low=g[b+K*2+1]|0;else{var Fe=h[K-15],it=Fe.high,yt=Fe.low,Kt=(it>>>1|yt<<31)^(it>>>8|yt<<24)^it>>>7,ie=(yt>>>1|it<<31)^(yt>>>8|it<<24)^(yt>>>7|it<<25),ke=h[K-2],he=ke.high,_e=ke.low,Oe=(he>>>19|_e<<13)^(he<<3|_e>>>29)^he>>>6,Dt=(_e>>>19|he<<13)^(_e<<3|he>>>29)^(_e>>>6|he<<26),zt=h[K-7],Ii=zt.high,Pi=zt.low,Ea=h[K-16],Ti=Ea.high,Aa=Ea.low;ce=ie+Pi,be=Kt+Ii+(ce>>>0<ie>>>0?1:0),ce=ce+Dt,be=be+Oe+(ce>>>0<Dt>>>0?1:0),ce=ce+Aa,be=be+Ti+(ce>>>0<Aa>>>0?1:0),$e.high=be,$e.low=ce}var Bi=pe&Be^~pe&ct,Ra=te&rt^~te&Ge,Li=$&V^$&Z^V&Z,$i=H&ee^H&Ee^ee&Ee,Oi=($>>>28|H<<4)^($<<30|H>>>2)^($<<25|H>>>7),Fa=(H>>>28|$<<4)^(H<<30|$>>>2)^(H<<25|$>>>7),Mi=(pe>>>14|te<<18)^(pe>>>18|te<<14)^(pe<<23|te>>>9),Ui=(te>>>14|pe<<18)^(te>>>18|pe<<14)^(te<<23|pe>>>9),_a=u[K],Wi=_a.high,za=_a.low,xt=M+Ui,Ot=Le+Mi+(xt>>>0<M>>>0?1:0),xt=xt+Ra,Ot=Ot+Bi+(xt>>>0<Ra>>>0?1:0),xt=xt+za,Ot=Ot+Wi+(xt>>>0<za>>>0?1:0),xt=xt+ce,Ot=Ot+be+(xt>>>0<ce>>>0?1:0),Ia=Fa+$i,Hi=Oi+Li+(Ia>>>0<Fa>>>0?1:0);Le=ct,M=Ge,ct=Be,Ge=rt,Be=pe,rt=te,te=de+xt|0,pe=Ae+Ot+(te>>>0<de>>>0?1:0)|0,Ae=Z,de=Ee,Z=V,Ee=ee,V=$,ee=H,H=xt+Ia|0,$=Ot+Hi+(H>>>0<xt>>>0?1:0)|0}F=j.low=F+H,j.high=_+$+(F>>>0<H>>>0?1:0),E=w.low=E+ee,w.high=k+V+(E>>>0<ee>>>0?1:0),I=C.low=I+Ee,C.high=N+Z+(I>>>0<Ee>>>0?1:0),z=D.low=z+de,D.high=T+Ae+(z>>>0<de>>>0?1:0),q=S.low=q+te,S.high=O+pe+(q>>>0<te>>>0?1:0),G=y.low=G+rt,y.high=Y+Be+(G>>>0<rt>>>0?1:0),L=A.low=L+Ge,A.high=P+ct+(L>>>0<Ge>>>0?1:0),W=R.low=W+M,R.high=U+Le+(W>>>0<M>>>0?1:0)},_doFinalize:function(){var g=this._data,b=g.words,f=this._nDataBytes*8,j=g.sigBytes*8;b[j>>>5]|=128<<24-j%32,b[(j+128>>>10<<5)+30]=Math.floor(f/4294967296),b[(j+128>>>10<<5)+31]=f,g.sigBytes=b.length*4,this._process();var w=this._hash.toX32();return w},clone:function(){var g=i.clone.call(this);return g._hash=this._hash.clone(),g},blockSize:1024/32});r.SHA512=i._createHelper(v),r.HmacSHA512=i._createHmacHelper(v)})(),s.SHA512})})(cr)),cr.exports}var dr={exports:{}},ml=dr.exports,rn;function ul(){return rn||(rn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Qr(),ui())})(ml,function(s){return(function(){var r=s,a=r.x64,i=a.Word,o=a.WordArray,l=r.algo,m=l.SHA512,c=l.SHA384=m.extend({_doReset:function(){this._hash=new o.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var x=m._doFinalize.call(this);return x.sigBytes-=16,x}});r.SHA384=m._createHelper(c),r.HmacSHA384=m._createHmacHelper(c)})(),s.SHA384})})(dr)),dr.exports}var mr={exports:{}},xl=mr.exports,an;function hl(){return an||(an=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Qr())})(xl,function(s){return(function(r){var a=s,i=a.lib,o=i.WordArray,l=i.Hasher,m=a.x64,c=m.Word,x=a.algo,u=[],h=[],v=[];(function(){for(var f=1,j=0,w=0;w<24;w++){u[f+5*j]=(w+1)*(w+2)/2%64;var C=j%5,D=(2*f+3*j)%5;f=C,j=D}for(var f=0;f<5;f++)for(var j=0;j<5;j++)h[f+5*j]=j+(2*f+3*j)%5*5;for(var S=1,y=0;y<24;y++){for(var A=0,R=0,_=0;_<7;_++){if(S&1){var F=(1<<_)-1;F<32?R^=1<<F:A^=1<<F-32}S&128?S=S<<1^113:S<<=1}v[y]=c.create(A,R)}})();var g=[];(function(){for(var f=0;f<25;f++)g[f]=c.create()})();var b=x.SHA3=l.extend({cfg:l.cfg.extend({outputLength:512}),_doReset:function(){for(var f=this._state=[],j=0;j<25;j++)f[j]=new c.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(f,j){for(var w=this._state,C=this.blockSize/2,D=0;D<C;D++){var S=f[j+2*D],y=f[j+2*D+1];S=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,y=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360;var A=w[D];A.high^=y,A.low^=S}for(var R=0;R<24;R++){for(var _=0;_<5;_++){for(var F=0,k=0,E=0;E<5;E++){var A=w[_+5*E];F^=A.high,k^=A.low}var N=g[_];N.high=F,N.low=k}for(var _=0;_<5;_++)for(var I=g[(_+4)%5],T=g[(_+1)%5],z=T.high,O=T.low,F=I.high^(z<<1|O>>>31),k=I.low^(O<<1|z>>>31),E=0;E<5;E++){var A=w[_+5*E];A.high^=F,A.low^=k}for(var q=1;q<25;q++){var F,k,A=w[q],Y=A.high,G=A.low,P=u[q];P<32?(F=Y<<P|G>>>32-P,k=G<<P|Y>>>32-P):(F=G<<P-32|Y>>>64-P,k=Y<<P-32|G>>>64-P);var L=g[h[q]];L.high=F,L.low=k}var U=g[0],W=w[0];U.high=W.high,U.low=W.low;for(var _=0;_<5;_++)for(var E=0;E<5;E++){var q=_+5*E,A=w[q],$=g[q],H=g[(_+1)%5+5*E],V=g[(_+2)%5+5*E];A.high=$.high^~H.high&V.high,A.low=$.low^~H.low&V.low}var A=w[0],ee=v[R];A.high^=ee.high,A.low^=ee.low}},_doFinalize:function(){var f=this._data,j=f.words;this._nDataBytes*8;var w=f.sigBytes*8,C=this.blockSize*32;j[w>>>5]|=1<<24-w%32,j[(r.ceil((w+1)/C)*C>>>5)-1]|=128,f.sigBytes=j.length*4,this._process();for(var D=this._state,S=this.cfg.outputLength/8,y=S/8,A=[],R=0;R<y;R++){var _=D[R],F=_.high,k=_.low;F=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,k=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360,A.push(k),A.push(F)}return new o.init(A,S)},clone:function(){for(var f=l.clone.call(this),j=f._state=this._state.slice(0),w=0;w<25;w++)j[w]=j[w].clone();return f}});a.SHA3=l._createHelper(b),a.HmacSHA3=l._createHmacHelper(b)})(Math),s.SHA3})})(mr)),mr.exports}var ur={exports:{}},gl=ur.exports,nn;function pl(){return nn||(nn=1,(function(n,t){(function(s,r){n.exports=r(fe())})(gl,function(s){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return(function(r){var a=s,i=a.lib,o=i.WordArray,l=i.Hasher,m=a.algo,c=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),x=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),u=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),v=o.create([0,1518500249,1859775393,2400959708,2840853838]),g=o.create([1352829926,1548603684,1836072691,2053994217,0]),b=m.RIPEMD160=l.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(y,A){for(var R=0;R<16;R++){var _=A+R,F=y[_];y[_]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360}var k=this._hash.words,E=v.words,N=g.words,I=c.words,T=x.words,z=u.words,O=h.words,q,Y,G,P,L,U,W,$,H,V;U=q=k[0],W=Y=k[1],$=G=k[2],H=P=k[3],V=L=k[4];for(var ee,R=0;R<80;R+=1)ee=q+y[A+I[R]]|0,R<16?ee+=f(Y,G,P)+E[0]:R<32?ee+=j(Y,G,P)+E[1]:R<48?ee+=w(Y,G,P)+E[2]:R<64?ee+=C(Y,G,P)+E[3]:ee+=D(Y,G,P)+E[4],ee=ee|0,ee=S(ee,z[R]),ee=ee+L|0,q=L,L=P,P=S(G,10),G=Y,Y=ee,ee=U+y[A+T[R]]|0,R<16?ee+=D(W,$,H)+N[0]:R<32?ee+=C(W,$,H)+N[1]:R<48?ee+=w(W,$,H)+N[2]:R<64?ee+=j(W,$,H)+N[3]:ee+=f(W,$,H)+N[4],ee=ee|0,ee=S(ee,O[R]),ee=ee+V|0,U=V,V=H,H=S($,10),$=W,W=ee;ee=k[1]+G+H|0,k[1]=k[2]+P+V|0,k[2]=k[3]+L+U|0,k[3]=k[4]+q+W|0,k[4]=k[0]+Y+$|0,k[0]=ee},_doFinalize:function(){var y=this._data,A=y.words,R=this._nDataBytes*8,_=y.sigBytes*8;A[_>>>5]|=128<<24-_%32,A[(_+64>>>9<<4)+14]=(R<<8|R>>>24)&16711935|(R<<24|R>>>8)&4278255360,y.sigBytes=(A.length+1)*4,this._process();for(var F=this._hash,k=F.words,E=0;E<5;E++){var N=k[E];k[E]=(N<<8|N>>>24)&16711935|(N<<24|N>>>8)&4278255360}return F},clone:function(){var y=l.clone.call(this);return y._hash=this._hash.clone(),y}});function f(y,A,R){return y^A^R}function j(y,A,R){return y&A|~y&R}function w(y,A,R){return(y|~A)^R}function C(y,A,R){return y&R|A&~R}function D(y,A,R){return y^(A|~R)}function S(y,A){return y<<A|y>>>32-A}a.RIPEMD160=l._createHelper(b),a.HmacRIPEMD160=l._createHmacHelper(b)})(),s.RIPEMD160})})(ur)),ur.exports}var xr={exports:{}},fl=xr.exports,on;function Da(){return on||(on=1,(function(n,t){(function(s,r){n.exports=r(fe())})(fl,function(s){(function(){var r=s,a=r.lib,i=a.Base,o=r.enc,l=o.Utf8,m=r.algo;m.HMAC=i.extend({init:function(c,x){c=this._hasher=new c.init,typeof x=="string"&&(x=l.parse(x));var u=c.blockSize,h=u*4;x.sigBytes>h&&(x=c.finalize(x)),x.clamp();for(var v=this._oKey=x.clone(),g=this._iKey=x.clone(),b=v.words,f=g.words,j=0;j<u;j++)b[j]^=1549556828,f[j]^=909522486;v.sigBytes=g.sigBytes=h,this.reset()},reset:function(){var c=this._hasher;c.reset(),c.update(this._iKey)},update:function(c){return this._hasher.update(c),this},finalize:function(c){var x=this._hasher,u=x.finalize(c);x.reset();var h=x.finalize(this._oKey.clone().concat(u));return h}})})()})})(xr)),xr.exports}var hr={exports:{}},yl=hr.exports,ln;function vl(){return ln||(ln=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Ca(),Da())})(yl,function(s){return(function(){var r=s,a=r.lib,i=a.Base,o=a.WordArray,l=r.algo,m=l.SHA256,c=l.HMAC,x=l.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:m,iterations:25e4}),init:function(u){this.cfg=this.cfg.extend(u)},compute:function(u,h){for(var v=this.cfg,g=c.create(v.hasher,u),b=o.create(),f=o.create([1]),j=b.words,w=f.words,C=v.keySize,D=v.iterations;j.length<C;){var S=g.update(h).finalize(f);g.reset();for(var y=S.words,A=y.length,R=S,_=1;_<D;_++){R=g.finalize(R),g.reset();for(var F=R.words,k=0;k<A;k++)y[k]^=F[k]}b.concat(S),w[0]++}return b.sigBytes=C*4,b}});r.PBKDF2=function(u,h,v){return x.create(v).compute(u,h)}})(),s.PBKDF2})})(hr)),hr.exports}var gr={exports:{}},bl=gr.exports,cn;function Qt(){return cn||(cn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),mi(),Da())})(bl,function(s){return(function(){var r=s,a=r.lib,i=a.Base,o=a.WordArray,l=r.algo,m=l.MD5,c=l.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:m,iterations:1}),init:function(x){this.cfg=this.cfg.extend(x)},compute:function(x,u){for(var h,v=this.cfg,g=v.hasher.create(),b=o.create(),f=b.words,j=v.keySize,w=v.iterations;f.length<j;){h&&g.update(h),h=g.update(x).finalize(u),g.reset();for(var C=1;C<w;C++)h=g.finalize(h),g.reset();b.concat(h)}return b.sigBytes=j*4,b}});r.EvpKDF=function(x,u,h){return c.create(h).compute(x,u)}})(),s.EvpKDF})})(gr)),gr.exports}var pr={exports:{}},wl=pr.exports,dn;function st(){return dn||(dn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Qt())})(wl,function(s){s.lib.Cipher||(function(r){var a=s,i=a.lib,o=i.Base,l=i.WordArray,m=i.BufferedBlockAlgorithm,c=a.enc;c.Utf8;var x=c.Base64,u=a.algo,h=u.EvpKDF,v=i.Cipher=m.extend({cfg:o.extend(),createEncryptor:function(F,k){return this.create(this._ENC_XFORM_MODE,F,k)},createDecryptor:function(F,k){return this.create(this._DEC_XFORM_MODE,F,k)},init:function(F,k,E){this.cfg=this.cfg.extend(E),this._xformMode=F,this._key=k,this.reset()},reset:function(){m.reset.call(this),this._doReset()},process:function(F){return this._append(F),this._process()},finalize:function(F){F&&this._append(F);var k=this._doFinalize();return k},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function F(k){return typeof k=="string"?_:y}return function(k){return{encrypt:function(E,N,I){return F(N).encrypt(k,E,N,I)},decrypt:function(E,N,I){return F(N).decrypt(k,E,N,I)}}}})()});i.StreamCipher=v.extend({_doFinalize:function(){var F=this._process(!0);return F},blockSize:1});var g=a.mode={},b=i.BlockCipherMode=o.extend({createEncryptor:function(F,k){return this.Encryptor.create(F,k)},createDecryptor:function(F,k){return this.Decryptor.create(F,k)},init:function(F,k){this._cipher=F,this._iv=k}}),f=g.CBC=(function(){var F=b.extend();F.Encryptor=F.extend({processBlock:function(E,N){var I=this._cipher,T=I.blockSize;k.call(this,E,N,T),I.encryptBlock(E,N),this._prevBlock=E.slice(N,N+T)}}),F.Decryptor=F.extend({processBlock:function(E,N){var I=this._cipher,T=I.blockSize,z=E.slice(N,N+T);I.decryptBlock(E,N),k.call(this,E,N,T),this._prevBlock=z}});function k(E,N,I){var T,z=this._iv;z?(T=z,this._iv=r):T=this._prevBlock;for(var O=0;O<I;O++)E[N+O]^=T[O]}return F})(),j=a.pad={},w=j.Pkcs7={pad:function(F,k){for(var E=k*4,N=E-F.sigBytes%E,I=N<<24|N<<16|N<<8|N,T=[],z=0;z<N;z+=4)T.push(I);var O=l.create(T,N);F.concat(O)},unpad:function(F){var k=F.words[F.sigBytes-1>>>2]&255;F.sigBytes-=k}};i.BlockCipher=v.extend({cfg:v.cfg.extend({mode:f,padding:w}),reset:function(){var F;v.reset.call(this);var k=this.cfg,E=k.iv,N=k.mode;this._xformMode==this._ENC_XFORM_MODE?F=N.createEncryptor:(F=N.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==F?this._mode.init(this,E&&E.words):(this._mode=F.call(N,this,E&&E.words),this._mode.__creator=F)},_doProcessBlock:function(F,k){this._mode.processBlock(F,k)},_doFinalize:function(){var F,k=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(k.pad(this._data,this.blockSize),F=this._process(!0)):(F=this._process(!0),k.unpad(F)),F},blockSize:128/32});var C=i.CipherParams=o.extend({init:function(F){this.mixIn(F)},toString:function(F){return(F||this.formatter).stringify(this)}}),D=a.format={},S=D.OpenSSL={stringify:function(F){var k,E=F.ciphertext,N=F.salt;return N?k=l.create([1398893684,1701076831]).concat(N).concat(E):k=E,k.toString(x)},parse:function(F){var k,E=x.parse(F),N=E.words;return N[0]==1398893684&&N[1]==1701076831&&(k=l.create(N.slice(2,4)),N.splice(0,4),E.sigBytes-=16),C.create({ciphertext:E,salt:k})}},y=i.SerializableCipher=o.extend({cfg:o.extend({format:S}),encrypt:function(F,k,E,N){N=this.cfg.extend(N);var I=F.createEncryptor(E,N),T=I.finalize(k),z=I.cfg;return C.create({ciphertext:T,key:E,iv:z.iv,algorithm:F,mode:z.mode,padding:z.padding,blockSize:F.blockSize,formatter:N.format})},decrypt:function(F,k,E,N){N=this.cfg.extend(N),k=this._parse(k,N.format);var I=F.createDecryptor(E,N).finalize(k.ciphertext);return I},_parse:function(F,k){return typeof F=="string"?k.parse(F,this):F}}),A=a.kdf={},R=A.OpenSSL={execute:function(F,k,E,N,I){if(N||(N=l.random(64/8)),I)var T=h.create({keySize:k+E,hasher:I}).compute(F,N);else var T=h.create({keySize:k+E}).compute(F,N);var z=l.create(T.words.slice(k),E*4);return T.sigBytes=k*4,C.create({key:T,iv:z,salt:N})}},_=i.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:R}),encrypt:function(F,k,E,N){N=this.cfg.extend(N);var I=N.kdf.execute(E,F.keySize,F.ivSize,N.salt,N.hasher);N.iv=I.iv;var T=y.encrypt.call(this,F,k,I.key,N);return T.mixIn(I),T},decrypt:function(F,k,E,N){N=this.cfg.extend(N),k=this._parse(k,N.format);var I=N.kdf.execute(E,F.keySize,F.ivSize,k.salt,N.hasher);N.iv=I.iv;var T=y.decrypt.call(this,F,k,I.key,N);return T}})})()})})(pr)),pr.exports}var fr={exports:{}},jl=fr.exports,mn;function Nl(){return mn||(mn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(jl,function(s){return s.mode.CFB=(function(){var r=s.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(i,o){var l=this._cipher,m=l.blockSize;a.call(this,i,o,m,l),this._prevBlock=i.slice(o,o+m)}}),r.Decryptor=r.extend({processBlock:function(i,o){var l=this._cipher,m=l.blockSize,c=i.slice(o,o+m);a.call(this,i,o,m,l),this._prevBlock=c}});function a(i,o,l,m){var c,x=this._iv;x?(c=x.slice(0),this._iv=void 0):c=this._prevBlock,m.encryptBlock(c,0);for(var u=0;u<l;u++)i[o+u]^=c[u]}return r})(),s.mode.CFB})})(fr)),fr.exports}var yr={exports:{}},Cl=yr.exports,un;function Dl(){return un||(un=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Cl,function(s){return s.mode.CTR=(function(){var r=s.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(i,o){var l=this._cipher,m=l.blockSize,c=this._iv,x=this._counter;c&&(x=this._counter=c.slice(0),this._iv=void 0);var u=x.slice(0);l.encryptBlock(u,0),x[m-1]=x[m-1]+1|0;for(var h=0;h<m;h++)i[o+h]^=u[h]}});return r.Decryptor=a,r})(),s.mode.CTR})})(yr)),yr.exports}var vr={exports:{}},kl=vr.exports,xn;function Sl(){return xn||(xn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(kl,function(s){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return s.mode.CTRGladman=(function(){var r=s.lib.BlockCipherMode.extend();function a(l){if((l>>24&255)===255){var m=l>>16&255,c=l>>8&255,x=l&255;m===255?(m=0,c===255?(c=0,x===255?x=0:++x):++c):++m,l=0,l+=m<<16,l+=c<<8,l+=x}else l+=1<<24;return l}function i(l){return(l[0]=a(l[0]))===0&&(l[1]=a(l[1])),l}var o=r.Encryptor=r.extend({processBlock:function(l,m){var c=this._cipher,x=c.blockSize,u=this._iv,h=this._counter;u&&(h=this._counter=u.slice(0),this._iv=void 0),i(h);var v=h.slice(0);c.encryptBlock(v,0);for(var g=0;g<x;g++)l[m+g]^=v[g]}});return r.Decryptor=o,r})(),s.mode.CTRGladman})})(vr)),vr.exports}var br={exports:{}},El=br.exports,hn;function Al(){return hn||(hn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(El,function(s){return s.mode.OFB=(function(){var r=s.lib.BlockCipherMode.extend(),a=r.Encryptor=r.extend({processBlock:function(i,o){var l=this._cipher,m=l.blockSize,c=this._iv,x=this._keystream;c&&(x=this._keystream=c.slice(0),this._iv=void 0),l.encryptBlock(x,0);for(var u=0;u<m;u++)i[o+u]^=x[u]}});return r.Decryptor=a,r})(),s.mode.OFB})})(br)),br.exports}var wr={exports:{}},Rl=wr.exports,gn;function Fl(){return gn||(gn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Rl,function(s){return s.mode.ECB=(function(){var r=s.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(a,i){this._cipher.encryptBlock(a,i)}}),r.Decryptor=r.extend({processBlock:function(a,i){this._cipher.decryptBlock(a,i)}}),r})(),s.mode.ECB})})(wr)),wr.exports}var jr={exports:{}},_l=jr.exports,pn;function zl(){return pn||(pn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(_l,function(s){return s.pad.AnsiX923={pad:function(r,a){var i=r.sigBytes,o=a*4,l=o-i%o,m=i+l-1;r.clamp(),r.words[m>>>2]|=l<<24-m%4*8,r.sigBytes+=l},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},s.pad.Ansix923})})(jr)),jr.exports}var Nr={exports:{}},Il=Nr.exports,fn;function Pl(){return fn||(fn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Il,function(s){return s.pad.Iso10126={pad:function(r,a){var i=a*4,o=i-r.sigBytes%i;r.concat(s.lib.WordArray.random(o-1)).concat(s.lib.WordArray.create([o<<24],1))},unpad:function(r){var a=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=a}},s.pad.Iso10126})})(Nr)),Nr.exports}var Cr={exports:{}},Tl=Cr.exports,yn;function Bl(){return yn||(yn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Tl,function(s){return s.pad.Iso97971={pad:function(r,a){r.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(r,a)},unpad:function(r){s.pad.ZeroPadding.unpad(r),r.sigBytes--}},s.pad.Iso97971})})(Cr)),Cr.exports}var Dr={exports:{}},Ll=Dr.exports,vn;function $l(){return vn||(vn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Ll,function(s){return s.pad.ZeroPadding={pad:function(r,a){var i=a*4;r.clamp(),r.sigBytes+=i-(r.sigBytes%i||i)},unpad:function(r){for(var a=r.words,i=r.sigBytes-1,i=r.sigBytes-1;i>=0;i--)if(a[i>>>2]>>>24-i%4*8&255){r.sigBytes=i+1;break}}},s.pad.ZeroPadding})})(Dr)),Dr.exports}var kr={exports:{}},Ol=kr.exports,bn;function Ml(){return bn||(bn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Ol,function(s){return s.pad.NoPadding={pad:function(){},unpad:function(){}},s.pad.NoPadding})})(kr)),kr.exports}var Sr={exports:{}},Ul=Sr.exports,wn;function Wl(){return wn||(wn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),st())})(Ul,function(s){return(function(r){var a=s,i=a.lib,o=i.CipherParams,l=a.enc,m=l.Hex,c=a.format;c.Hex={stringify:function(x){return x.ciphertext.toString(m)},parse:function(x){var u=m.parse(x);return o.create({ciphertext:u})}}})(),s.format.Hex})})(Sr)),Sr.exports}var Er={exports:{}},Hl=Er.exports,jn;function ql(){return jn||(jn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),ns(),is(),Qt(),st())})(Hl,function(s){return(function(){var r=s,a=r.lib,i=a.BlockCipher,o=r.algo,l=[],m=[],c=[],x=[],u=[],h=[],v=[],g=[],b=[],f=[];(function(){for(var C=[],D=0;D<256;D++)D<128?C[D]=D<<1:C[D]=D<<1^283;for(var S=0,y=0,D=0;D<256;D++){var A=y^y<<1^y<<2^y<<3^y<<4;A=A>>>8^A&255^99,l[S]=A,m[A]=S;var R=C[S],_=C[R],F=C[_],k=C[A]*257^A*16843008;c[S]=k<<24|k>>>8,x[S]=k<<16|k>>>16,u[S]=k<<8|k>>>24,h[S]=k;var k=F*16843009^_*65537^R*257^S*16843008;v[A]=k<<24|k>>>8,g[A]=k<<16|k>>>16,b[A]=k<<8|k>>>24,f[A]=k,S?(S=R^C[C[C[F^R]]],y^=C[C[y]]):S=y=1}})();var j=[0,1,2,4,8,16,32,64,128,27,54],w=o.AES=i.extend({_doReset:function(){var C;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var D=this._keyPriorReset=this._key,S=D.words,y=D.sigBytes/4,A=this._nRounds=y+6,R=(A+1)*4,_=this._keySchedule=[],F=0;F<R;F++)F<y?_[F]=S[F]:(C=_[F-1],F%y?y>6&&F%y==4&&(C=l[C>>>24]<<24|l[C>>>16&255]<<16|l[C>>>8&255]<<8|l[C&255]):(C=C<<8|C>>>24,C=l[C>>>24]<<24|l[C>>>16&255]<<16|l[C>>>8&255]<<8|l[C&255],C^=j[F/y|0]<<24),_[F]=_[F-y]^C);for(var k=this._invKeySchedule=[],E=0;E<R;E++){var F=R-E;if(E%4)var C=_[F];else var C=_[F-4];E<4||F<=4?k[E]=C:k[E]=v[l[C>>>24]]^g[l[C>>>16&255]]^b[l[C>>>8&255]]^f[l[C&255]]}}},encryptBlock:function(C,D){this._doCryptBlock(C,D,this._keySchedule,c,x,u,h,l)},decryptBlock:function(C,D){var S=C[D+1];C[D+1]=C[D+3],C[D+3]=S,this._doCryptBlock(C,D,this._invKeySchedule,v,g,b,f,m);var S=C[D+1];C[D+1]=C[D+3],C[D+3]=S},_doCryptBlock:function(C,D,S,y,A,R,_,F){for(var k=this._nRounds,E=C[D]^S[0],N=C[D+1]^S[1],I=C[D+2]^S[2],T=C[D+3]^S[3],z=4,O=1;O<k;O++){var q=y[E>>>24]^A[N>>>16&255]^R[I>>>8&255]^_[T&255]^S[z++],Y=y[N>>>24]^A[I>>>16&255]^R[T>>>8&255]^_[E&255]^S[z++],G=y[I>>>24]^A[T>>>16&255]^R[E>>>8&255]^_[N&255]^S[z++],P=y[T>>>24]^A[E>>>16&255]^R[N>>>8&255]^_[I&255]^S[z++];E=q,N=Y,I=G,T=P}var q=(F[E>>>24]<<24|F[N>>>16&255]<<16|F[I>>>8&255]<<8|F[T&255])^S[z++],Y=(F[N>>>24]<<24|F[I>>>16&255]<<16|F[T>>>8&255]<<8|F[E&255])^S[z++],G=(F[I>>>24]<<24|F[T>>>16&255]<<16|F[E>>>8&255]<<8|F[N&255])^S[z++],P=(F[T>>>24]<<24|F[E>>>16&255]<<16|F[N>>>8&255]<<8|F[I&255])^S[z++];C[D]=q,C[D+1]=Y,C[D+2]=G,C[D+3]=P},keySize:256/32});r.AES=i._createHelper(w)})(),s.AES})})(Er)),Er.exports}var Ar={exports:{}},Gl=Ar.exports,Nn;function Vl(){return Nn||(Nn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),ns(),is(),Qt(),st())})(Gl,function(s){return(function(){var r=s,a=r.lib,i=a.WordArray,o=a.BlockCipher,l=r.algo,m=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],c=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],x=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],v=l.DES=o.extend({_doReset:function(){for(var j=this._key,w=j.words,C=[],D=0;D<56;D++){var S=m[D]-1;C[D]=w[S>>>5]>>>31-S%32&1}for(var y=this._subKeys=[],A=0;A<16;A++){for(var R=y[A]=[],_=x[A],D=0;D<24;D++)R[D/6|0]|=C[(c[D]-1+_)%28]<<31-D%6,R[4+(D/6|0)]|=C[28+(c[D+24]-1+_)%28]<<31-D%6;R[0]=R[0]<<1|R[0]>>>31;for(var D=1;D<7;D++)R[D]=R[D]>>>(D-1)*4+3;R[7]=R[7]<<5|R[7]>>>27}for(var F=this._invSubKeys=[],D=0;D<16;D++)F[D]=y[15-D]},encryptBlock:function(j,w){this._doCryptBlock(j,w,this._subKeys)},decryptBlock:function(j,w){this._doCryptBlock(j,w,this._invSubKeys)},_doCryptBlock:function(j,w,C){this._lBlock=j[w],this._rBlock=j[w+1],g.call(this,4,252645135),g.call(this,16,65535),b.call(this,2,858993459),b.call(this,8,16711935),g.call(this,1,1431655765);for(var D=0;D<16;D++){for(var S=C[D],y=this._lBlock,A=this._rBlock,R=0,_=0;_<8;_++)R|=u[_][((A^S[_])&h[_])>>>0];this._lBlock=A,this._rBlock=y^R}var F=this._lBlock;this._lBlock=this._rBlock,this._rBlock=F,g.call(this,1,1431655765),b.call(this,8,16711935),b.call(this,2,858993459),g.call(this,16,65535),g.call(this,4,252645135),j[w]=this._lBlock,j[w+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function g(j,w){var C=(this._lBlock>>>j^this._rBlock)&w;this._rBlock^=C,this._lBlock^=C<<j}function b(j,w){var C=(this._rBlock>>>j^this._lBlock)&w;this._lBlock^=C,this._rBlock^=C<<j}r.DES=o._createHelper(v);var f=l.TripleDES=o.extend({_doReset:function(){var j=this._key,w=j.words;if(w.length!==2&&w.length!==4&&w.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var C=w.slice(0,2),D=w.length<4?w.slice(0,2):w.slice(2,4),S=w.length<6?w.slice(0,2):w.slice(4,6);this._des1=v.createEncryptor(i.create(C)),this._des2=v.createEncryptor(i.create(D)),this._des3=v.createEncryptor(i.create(S))},encryptBlock:function(j,w){this._des1.encryptBlock(j,w),this._des2.decryptBlock(j,w),this._des3.encryptBlock(j,w)},decryptBlock:function(j,w){this._des3.decryptBlock(j,w),this._des2.encryptBlock(j,w),this._des1.decryptBlock(j,w)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=o._createHelper(f)})(),s.TripleDES})})(Ar)),Ar.exports}var Rr={exports:{}},Ql=Rr.exports,Cn;function Kl(){return Cn||(Cn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),ns(),is(),Qt(),st())})(Ql,function(s){return(function(){var r=s,a=r.lib,i=a.StreamCipher,o=r.algo,l=o.RC4=i.extend({_doReset:function(){for(var x=this._key,u=x.words,h=x.sigBytes,v=this._S=[],g=0;g<256;g++)v[g]=g;for(var g=0,b=0;g<256;g++){var f=g%h,j=u[f>>>2]>>>24-f%4*8&255;b=(b+v[g]+j)%256;var w=v[g];v[g]=v[b],v[b]=w}this._i=this._j=0},_doProcessBlock:function(x,u){x[u]^=m.call(this)},keySize:256/32,ivSize:0});function m(){for(var x=this._S,u=this._i,h=this._j,v=0,g=0;g<4;g++){u=(u+1)%256,h=(h+x[u])%256;var b=x[u];x[u]=x[h],x[h]=b,v|=x[(x[u]+x[h])%256]<<24-g*8}return this._i=u,this._j=h,v}r.RC4=i._createHelper(l);var c=o.RC4Drop=l.extend({cfg:l.cfg.extend({drop:192}),_doReset:function(){l._doReset.call(this);for(var x=this.cfg.drop;x>0;x--)m.call(this)}});r.RC4Drop=i._createHelper(c)})(),s.RC4})})(Rr)),Rr.exports}var Fr={exports:{}},Yl=Fr.exports,Dn;function Zl(){return Dn||(Dn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),ns(),is(),Qt(),st())})(Yl,function(s){return(function(){var r=s,a=r.lib,i=a.StreamCipher,o=r.algo,l=[],m=[],c=[],x=o.Rabbit=i.extend({_doReset:function(){for(var h=this._key.words,v=this.cfg.iv,g=0;g<4;g++)h[g]=(h[g]<<8|h[g]>>>24)&16711935|(h[g]<<24|h[g]>>>8)&4278255360;var b=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],f=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var g=0;g<4;g++)u.call(this);for(var g=0;g<8;g++)f[g]^=b[g+4&7];if(v){var j=v.words,w=j[0],C=j[1],D=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,S=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,y=D>>>16|S&4294901760,A=S<<16|D&65535;f[0]^=D,f[1]^=y,f[2]^=S,f[3]^=A,f[4]^=D,f[5]^=y,f[6]^=S,f[7]^=A;for(var g=0;g<4;g++)u.call(this)}},_doProcessBlock:function(h,v){var g=this._X;u.call(this),l[0]=g[0]^g[5]>>>16^g[3]<<16,l[1]=g[2]^g[7]>>>16^g[5]<<16,l[2]=g[4]^g[1]>>>16^g[7]<<16,l[3]=g[6]^g[3]>>>16^g[1]<<16;for(var b=0;b<4;b++)l[b]=(l[b]<<8|l[b]>>>24)&16711935|(l[b]<<24|l[b]>>>8)&4278255360,h[v+b]^=l[b]},blockSize:128/32,ivSize:64/32});function u(){for(var h=this._X,v=this._C,g=0;g<8;g++)m[g]=v[g];v[0]=v[0]+1295307597+this._b|0,v[1]=v[1]+3545052371+(v[0]>>>0<m[0]>>>0?1:0)|0,v[2]=v[2]+886263092+(v[1]>>>0<m[1]>>>0?1:0)|0,v[3]=v[3]+1295307597+(v[2]>>>0<m[2]>>>0?1:0)|0,v[4]=v[4]+3545052371+(v[3]>>>0<m[3]>>>0?1:0)|0,v[5]=v[5]+886263092+(v[4]>>>0<m[4]>>>0?1:0)|0,v[6]=v[6]+1295307597+(v[5]>>>0<m[5]>>>0?1:0)|0,v[7]=v[7]+3545052371+(v[6]>>>0<m[6]>>>0?1:0)|0,this._b=v[7]>>>0<m[7]>>>0?1:0;for(var g=0;g<8;g++){var b=h[g]+v[g],f=b&65535,j=b>>>16,w=((f*f>>>17)+f*j>>>15)+j*j,C=((b&4294901760)*b|0)+((b&65535)*b|0);c[g]=w^C}h[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,h[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,h[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,h[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,h[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,h[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,h[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,h[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}r.Rabbit=i._createHelper(x)})(),s.Rabbit})})(Fr)),Fr.exports}var _r={exports:{}},Xl=_r.exports,kn;function Jl(){return kn||(kn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),ns(),is(),Qt(),st())})(Xl,function(s){return(function(){var r=s,a=r.lib,i=a.StreamCipher,o=r.algo,l=[],m=[],c=[],x=o.RabbitLegacy=i.extend({_doReset:function(){var h=this._key.words,v=this.cfg.iv,g=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],b=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var f=0;f<4;f++)u.call(this);for(var f=0;f<8;f++)b[f]^=g[f+4&7];if(v){var j=v.words,w=j[0],C=j[1],D=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,S=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,y=D>>>16|S&4294901760,A=S<<16|D&65535;b[0]^=D,b[1]^=y,b[2]^=S,b[3]^=A,b[4]^=D,b[5]^=y,b[6]^=S,b[7]^=A;for(var f=0;f<4;f++)u.call(this)}},_doProcessBlock:function(h,v){var g=this._X;u.call(this),l[0]=g[0]^g[5]>>>16^g[3]<<16,l[1]=g[2]^g[7]>>>16^g[5]<<16,l[2]=g[4]^g[1]>>>16^g[7]<<16,l[3]=g[6]^g[3]>>>16^g[1]<<16;for(var b=0;b<4;b++)l[b]=(l[b]<<8|l[b]>>>24)&16711935|(l[b]<<24|l[b]>>>8)&4278255360,h[v+b]^=l[b]},blockSize:128/32,ivSize:64/32});function u(){for(var h=this._X,v=this._C,g=0;g<8;g++)m[g]=v[g];v[0]=v[0]+1295307597+this._b|0,v[1]=v[1]+3545052371+(v[0]>>>0<m[0]>>>0?1:0)|0,v[2]=v[2]+886263092+(v[1]>>>0<m[1]>>>0?1:0)|0,v[3]=v[3]+1295307597+(v[2]>>>0<m[2]>>>0?1:0)|0,v[4]=v[4]+3545052371+(v[3]>>>0<m[3]>>>0?1:0)|0,v[5]=v[5]+886263092+(v[4]>>>0<m[4]>>>0?1:0)|0,v[6]=v[6]+1295307597+(v[5]>>>0<m[5]>>>0?1:0)|0,v[7]=v[7]+3545052371+(v[6]>>>0<m[6]>>>0?1:0)|0,this._b=v[7]>>>0<m[7]>>>0?1:0;for(var g=0;g<8;g++){var b=h[g]+v[g],f=b&65535,j=b>>>16,w=((f*f>>>17)+f*j>>>15)+j*j,C=((b&4294901760)*b|0)+((b&65535)*b|0);c[g]=w^C}h[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,h[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,h[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,h[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,h[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,h[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,h[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,h[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}r.RabbitLegacy=i._createHelper(x)})(),s.RabbitLegacy})})(_r)),_r.exports}var zr={exports:{}},ec=zr.exports,Sn;function tc(){return Sn||(Sn=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),ns(),is(),Qt(),st())})(ec,function(s){return(function(){var r=s,a=r.lib,i=a.BlockCipher,o=r.algo;const l=16,m=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],c=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var x={pbox:[],sbox:[]};function u(f,j){let w=j>>24&255,C=j>>16&255,D=j>>8&255,S=j&255,y=f.sbox[0][w]+f.sbox[1][C];return y=y^f.sbox[2][D],y=y+f.sbox[3][S],y}function h(f,j,w){let C=j,D=w,S;for(let y=0;y<l;++y)C=C^f.pbox[y],D=u(f,C)^D,S=C,C=D,D=S;return S=C,C=D,D=S,D=D^f.pbox[l],C=C^f.pbox[l+1],{left:C,right:D}}function v(f,j,w){let C=j,D=w,S;for(let y=l+1;y>1;--y)C=C^f.pbox[y],D=u(f,C)^D,S=C,C=D,D=S;return S=C,C=D,D=S,D=D^f.pbox[1],C=C^f.pbox[0],{left:C,right:D}}function g(f,j,w){for(let A=0;A<4;A++){f.sbox[A]=[];for(let R=0;R<256;R++)f.sbox[A][R]=c[A][R]}let C=0;for(let A=0;A<l+2;A++)f.pbox[A]=m[A]^j[C],C++,C>=w&&(C=0);let D=0,S=0,y=0;for(let A=0;A<l+2;A+=2)y=h(f,D,S),D=y.left,S=y.right,f.pbox[A]=D,f.pbox[A+1]=S;for(let A=0;A<4;A++)for(let R=0;R<256;R+=2)y=h(f,D,S),D=y.left,S=y.right,f.sbox[A][R]=D,f.sbox[A][R+1]=S;return!0}var b=o.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var f=this._keyPriorReset=this._key,j=f.words,w=f.sigBytes/4;g(x,j,w)}},encryptBlock:function(f,j){var w=h(x,f[j],f[j+1]);f[j]=w.left,f[j+1]=w.right},decryptBlock:function(f,j){var w=v(x,f[j],f[j+1]);f[j]=w.left,f[j+1]=w.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=i._createHelper(b)})(),s.Blowfish})})(zr)),zr.exports}var sc=Xs.exports,En;function rc(){return En||(En=1,(function(n,t){(function(s,r,a){n.exports=r(fe(),Qr(),Jo(),tl(),ns(),al(),is(),mi(),Ca(),cl(),ui(),ul(),hl(),pl(),Da(),vl(),Qt(),st(),Nl(),Dl(),Sl(),Al(),Fl(),zl(),Pl(),Bl(),$l(),Ml(),Wl(),ql(),Vl(),Kl(),Zl(),Jl(),tc())})(sc,function(s){return s})})(Xs)),Xs.exports}var ac=rc();const It=Vi(ac);class ts{static{this.ALGORITHM="AES"}static{this.ENCRYPTION_KEY="your-super-secret-key-here-32-chars"}static encrypt(t){if(!t)throw new Error("Cannot encrypt empty string");const s=It.lib.WordArray.random(16);return{encrypted:It.AES.encrypt(t,this.ENCRYPTION_KEY,{iv:s,mode:It.mode.CBC,padding:It.pad.Pkcs7}).toString(),iv:s.toString(),algorithm:this.ALGORITHM}}static decrypt(t){if(!t||!t.encrypted)throw new Error("Invalid encrypted field");try{const r=It.AES.decrypt(t.encrypted,this.ENCRYPTION_KEY,{iv:It.enc.Hex.parse(t.iv),mode:It.mode.CBC,padding:It.pad.Pkcs7}).toString(It.enc.Utf8);if(!r)throw new Error("Decryption failed - invalid key or corrupted data");return r}catch(s){throw new Error("Failed to decrypt data: "+s.message)}}static maskAccountNumber(t){if(!t||t.length<4)return"****";const s=t.slice(-4);return"*".repeat(Math.max(0,t.length-4))+s}static maskBranchCode(t){if(!t||t.length<2)return"***";const s=t.slice(-2);return"*".repeat(Math.max(0,t.length-2))+s}static isEncrypted(t){return typeof t=="object"&&t!==null&&typeof t.encrypted=="string"&&typeof t.iv=="string"&&t.algorithm==="AES"}static encryptBankingDetails(t){return{accountHolder:t.accountHolder,bank:t.bank,accountNumber:this.encrypt(t.accountNumber),branchCode:this.encrypt(t.branchCode)}}static decryptBankingDetails(t){return{accountHolder:t.accountHolder,bank:t.bank,accountNumber:this.isEncrypted(t.accountNumber)?this.decrypt(t.accountNumber):t.accountNumber,branchCode:this.isEncrypted(t.branchCode)?this.decrypt(t.branchCode):t.branchCode}}static getMaskedBankingDetails(t){const s=this.decryptBankingDetails(t);return{accountHolder:s.accountHolder,bank:s.bank,accountNumber:this.maskAccountNumber(s.accountNumber),branchCode:this.maskBranchCode(s.branchCode)}}}ts.encrypt;ts.decrypt;ts.maskAccountNumber;ts.maskBranchCode;class ss{static async logAccess(t){const s=Nt.currentUser;if(!s){d.warn("Attempted to log PII access without authenticated user");return}try{const r=`${t.action}_${t.dataType}_${Date.now()}`,a={id:r,userId:s.uid,userEmail:s.email||"unknown",userAgent:navigator.userAgent,timestamp:re(),...t};try{const o=await(await fetch("https://api.ipify.org?format=json")).json();a.ipAddress=o.ip}catch{a.ipAddress="unknown"}await ze(Q(B,"piiAccessLogs",r),a),d.info("PII access logged",{action:t.action,dataType:t.dataType,user:s.email})}catch(r){d.error("Failed to log PII access:",r)}}static async logBankingAccess(t,s,r){await this.logAccess({action:s,dataType:"banking",resellerId:t,fieldAccessed:"bankDetails",reason:r||"Business operations"})}static async logPersonalInfoAccess(t,s,r,a){await this.logAccess({action:s,dataType:"personal",targetUserId:t,fieldAccessed:r,reason:a||"User management"})}static async logSessionAccess(t,s,r){await this.logAccess({action:s,dataType:"session",targetUserId:t,fieldAccessed:"sessionData",reason:r||"Session management"})}static async logDataExport(t,s="Data export requested"){await this.logAccess({action:"export",dataType:t,reason:s})}}ss.logBankingAccess;ss.logPersonalInfoAccess;ss.logSessionAccess;ss.logDataExport;const Ut={starter:{id:"starter",name:"Starter",price:29900,currency:"ZAR",employeeLimit:10,features:["Up to 10 employees","Basic warning management","PDF document generation","Email notifications","Basic reporting"]},professional:{id:"professional",name:"Professional",price:49900,currency:"ZAR",employeeLimit:50,features:["Up to 50 employees","Advanced warning workflows","Custom warning categories","WhatsApp notifications","Advanced reporting","Counselling management"]},enterprise:{id:"enterprise",name:"Enterprise",price:79900,currency:"ZAR",employeeLimit:200,features:["Up to 200 employees","Full HR disciplinary suite","Custom document templates","API access","Priority support","Advanced analytics"]},"enterprise-plus":{id:"enterprise-plus",name:"Enterprise Plus",price:129900,currency:"ZAR",employeeLimit:999999,features:["Unlimited employees","White-label branding","Multi-location support","Dedicated account manager","Custom integrations","On-site training"]}},Bt={"western-cape":{name:"Western Cape"},gauteng:{name:"Gauteng"},"kwazulu-natal":{name:"KwaZulu-Natal"},"eastern-cape":{name:"Eastern Cape"},"free-state":{name:"Free State"},limpopo:{name:"Limpopo"},mpumalanga:{name:"Mpumalanga"},"northern-cape":{name:"Northern Cape"},"north-west":{name:"North West"}},xi=()=>{const[n,t]=p.useState([]),[s,r]=p.useState(!0),[a,i]=p.useState(!1),[o,l]=p.useState(null),[m,c]=p.useState("all"),[x,u]=p.useState({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}});p.useEffect(()=>{h()},[]);const h=async()=>{try{r(!0),d.debug("Loading resellers with metrics...");const S=await He.getAllResellers(),y=await Promise.all(S.map(async A=>{const R=await As.getResellerMetrics(A.id);return{...A,metrics:R}}));t(y),d.success(`Loaded ${y.length} resellers`)}catch(S){d.error("Failed to load resellers:",S)}finally{r(!1)}},v=async S=>{S.preventDefault();try{d.debug("Adding new reseller...",x),await ss.logBankingAccess("new-reseller","edit","Creating new reseller account");const y=ts.encryptBankingDetails(x.bankDetails),A={firstName:x.firstName,lastName:x.lastName,email:x.email,phone:x.phone,province:x.province,territory:x.territory,commissionRate:x.commissionRate,isActive:!0,bankDetails:y,clientIds:[],totalClientsAcquired:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0},R=await He.createReseller(A);try{const{httpsCallable:_}=await nt(async()=>{const{httpsCallable:E}=await import("./firebase-vendor-Cz3N8Xg7.js").then(N=>N.J);return{httpsCallable:E}},[]),{functions:F}=await nt(async()=>{const{functions:E}=await Promise.resolve().then(()=>ni);return{functions:E}},void 0);await _(F,"createResellerUser")({email:x.email,password:"temp123",displayName:`${x.firstName} ${x.lastName}`,resellerId:R,firstName:x.firstName,lastName:x.lastName}),d.success("Reseller user account created via Cloud Function")}catch(_){d.warn("Cloud Function not available, using fallback method:",_),d.error("Cannot create user account automatically due to CORS restriction"),alert(`
RESELLER CREATED SUCCESSFULLY!

However, the user account creation failed due to browser security restrictions.

Please create the Firebase Auth account manually:
1. Go to Firebase Console > Authentication > Users  
2. Add user: ${x.email}
3. Password: temp123
4. Display name: ${x.firstName} ${x.lastName}

Or the reseller can register at the login page with their email and the password 'temp123'.

The reseller profile has been saved successfully with ID: ${R}
        `.trim()),d.warn("Manual user account creation required for:",x.email)}d.success("Reseller and user account created successfully:",{resellerId:R,email:x.email}),u({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}}),i(!1),setTimeout(async()=>{try{await h()}catch{d.warn("Could not reload resellers automatically, refresh page manually")}},2e3)}catch(y){d.error("Failed to add reseller:",y)}},g=async S=>{if(S.preventDefault(),!!o)try{d.debug("Updating reseller...",{id:o.id,formData:x}),await ss.logBankingAccess(o.id,"edit","Updating reseller banking details");const y=ts.encryptBankingDetails(x.bankDetails);await He.updateReseller(o.id,{firstName:x.firstName,lastName:x.lastName,email:x.email,phone:x.phone,province:x.province,territory:x.territory,commissionRate:x.commissionRate,bankDetails:y,updatedAt:new Date().toISOString()}),d.success("Reseller updated successfully"),l(null),await h()}catch(y){d.error("Failed to update reseller:",y)}},b=async S=>{try{await ss.logBankingAccess(S.id,"view","Editing reseller details");const y=ts.decryptBankingDetails(S.bankDetails);l(S),u({firstName:S.firstName,lastName:S.lastName,email:S.email,phone:S.phone,province:S.province,territory:S.territory,commissionRate:S.commissionRate,bankDetails:y}),i(!0)}catch(y){d.error("Failed to decrypt banking details:",y),alert("Error loading banking details. Please contact support.")}},f=()=>{i(!1),l(null),u({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}})},j=async S=>{try{await He.updateReseller(S.id,{isActive:!S.isActive,updatedAt:new Date().toISOString()}),d.success(`Reseller ${S.isActive?"deactivated":"activated"}`),await h()}catch(y){d.error("Failed to toggle reseller status:",y)}},w=()=>m==="all"?n:n.filter(S=>S.province===m),C=S=>`R${(S/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,D=()=>{const S={};for(const y of n){const A=y.province;S[A]||(S[A]={resellers:0,clients:0,revenue:0}),S[A].resellers++,S[A].clients+=y.metrics.totalClients,S[A].revenue+=y.metrics.monthlyRecurringRevenue}return S};return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading reseller network..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reseller Network"}),e.jsx("p",{className:"text-gray-600",children:"Manage your provincial sales network"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(_s,{className:"w-4 h-4"}),"Add Reseller"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Province:"}),e.jsxs("select",{value:m,onChange:S=>c(S.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Provinces"}),Object.entries(Bt).map(([S,y])=>e.jsx("option",{value:S,children:y.name},S))]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(D()).sort(([,S],[,y])=>y.revenue-S.revenue).slice(0,5).map(([S,y])=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(rs,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-sm",children:Bt[S]?.name})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Resellers:"}),e.jsx("span",{className:"font-semibold",children:y.resellers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Clients:"}),e.jsx("span",{className:"font-semibold",children:y.clients})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Revenue:"}),e.jsx("span",{className:"font-semibold",children:C(y.revenue)})]})]})]},S))}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold",children:["Resellers (",w().length,")"]})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reseller"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Province"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clients"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monthly Revenue"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w().map(S=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[S.firstName," ",S.lastName]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rt,{className:"w-3 h-3"}),S.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($s,{className:"w-3 h-3"}),S.phone]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:Bt[S.province]?.name})]}),S.territory.length>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:S.territory.join(", ")})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-semibold",children:S.metrics.totalClients})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Avg: ",C(S.metrics.averageClientValue)]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-semibold",children:C(S.metrics.monthlyRecurringRevenue)})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3"}),"+",S.metrics.monthlyGrowth,"%"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("span",{className:"text-sm font-semibold",children:[(S.commissionRate*100).toFixed(0),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Earned: ",C(S.metrics.totalCommissions)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>j(S),className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${S.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:S.isActive?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-3 h-3"}),"Inactive"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>b(S),className:"text-blue-600 hover:text-blue-800 mr-3",children:e.jsx(Xn,{className:"w-4 h-4"})})})]},S.id))})]}),w().length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_s,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No resellers found"}),e.jsx("p",{className:"text-sm text-gray-500",children:m!=="all"?`No resellers in ${Bt[m]?.name}`:"Add your first reseller to start building your network"})]})]})]}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:o?"Edit Reseller":"Add New Reseller"}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-600",children:e.jsx(ve,{className:"w-5 h-5"})})]}),!o&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"ℹ️ Account Creation:"})," A user account will be created with email login and password ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"temp123"}),". The reseller should change this on first login."]})})]}),e.jsxs("form",{onSubmit:o?g:v,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:x.firstName,onChange:S=>u(y=>({...y,firstName:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",value:x.lastName,onChange:S=>u(y=>({...y,lastName:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:x.email,onChange:S=>u(y=>({...y,email:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),e.jsx("input",{type:"tel",value:x.phone,onChange:S=>u(y=>({...y,phone:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),e.jsx("select",{value:x.province,onChange:S=>u(y=>({...y,province:S.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(Bt).map(([S,y])=>e.jsx("option",{value:S,children:y.name},S))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commission Rate"}),e.jsxs("select",{value:x.commissionRate,onChange:S=>u(y=>({...y,commissionRate:parseFloat(S.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"0.50",children:"50% (Standard)"}),e.jsx("option",{value:"0.45",children:"45%"}),e.jsx("option",{value:"0.40",children:"40%"}),e.jsx("option",{value:"0.35",children:"35%"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"Banking Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Holder"}),e.jsx("input",{type:"text",value:x.bankDetails.accountHolder,onChange:S=>u(y=>({...y,bankDetails:{...y.bankDetails,accountHolder:S.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank"}),e.jsxs("select",{value:x.bankDetails.bank,onChange:S=>u(y=>({...y,bankDetails:{...y.bankDetails,bank:S.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select bank"}),e.jsx("option",{value:"ABSA",children:"ABSA"}),e.jsx("option",{value:"Standard Bank",children:"Standard Bank"}),e.jsx("option",{value:"FirstNational Bank",children:"FirstNational Bank"}),e.jsx("option",{value:"Nedbank",children:"Nedbank"}),e.jsx("option",{value:"Capitec",children:"Capitec"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:x.bankDetails.accountNumber,onChange:S=>u(y=>({...y,bankDetails:{...y.bankDetails,accountNumber:S.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Code"}),e.jsx("input",{type:"text",value:x.bankDetails.branchCode,onChange:S=>u(y=>({...y,bankDetails:{...y.bankDetails,branchCode:S.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:o?"Update Reseller":"Add Reseller"})]})]})]})})]})},um=Object.freeze(Object.defineProperty({__proto__:null,ResellerManagement:xi},Symbol.toStringTag,{value:"Module"})),nc="https://us-central1-hr-disciplinary-system.cloudfunctions.net";class Cs{static async getAuthToken(){const t=Nt.currentUser;if(!t)throw new Error("User not authenticated");return await t.getIdToken(!0)}static async makeAuthenticatedRequest(t,s={}){try{const r=await this.getAuthToken(),a=await fetch(`${nc}/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({data:s}),credentials:"include"});if(!a.ok){const o=await a.json();throw new Error(o.error?.message||`HTTP ${a.status}: ${a.statusText}`)}return(await a.json()).data}catch(r){throw d.error(`❌ Request to ${t} failed:`,r),r}}static async triggerManualCleanup(){try{d.debug("🔧 Triggering manual global audio cleanup...");const t=await this.makeAuthenticatedRequest("manualAudioCleanup");return d.success(2143),t}catch(t){throw d.error("❌ Manual cleanup failed:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED")?new Error("Access denied: Audio cleanup is restricted to super-users only"):new Error(`Manual cleanup failed: ${t.message}`)}}static async getCleanupStats(){try{d.debug(2927);const t=await this.makeAuthenticatedRequest("getCleanupStats");return d.success(3047),t}catch(t){throw d.error("❌ Failed to fetch cleanup stats:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED")?new Error("Access denied: Cleanup statistics are restricted to super-users only"):new Error(`Failed to fetch stats: ${t.message}`)}}static async getGlobalAudioStats(){try{d.debug(4037);const t=await this.makeAuthenticatedRequest("getGlobalAudioStats");return d.success(4130),t}catch(t){throw d.error("❌ Failed to fetch global audio stats:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED")?new Error("Access denied: Global audio statistics are restricted to super-users only"):new Error(`Failed to fetch global stats: ${t.message}`)}}static async previewCleanup(){try{d.debug("👁️ Previewing cleanup without deletion...");const t=await this.makeAuthenticatedRequest("previewAudioCleanup");return d.success(5312),t}catch(t){throw d.error("❌ Failed to preview cleanup:",t),t.message.includes("Access denied")||t.message.includes("PERMISSION_DENIED")?new Error("Access denied: Cleanup preview is restricted to super-users only"):new Error(`Failed to preview cleanup: ${t.message}`)}}static async requestAudioDeletion(t){try{return console.log("🗑️ Requesting manual audio deletion:",{warningId:t.warningId,reason:t.reason}),d.success(6517),!0}catch(s){throw d.error("❌ Audio deletion request failed:",s),new Error(`Deletion request failed: ${s.message}`)}}static formatCleanupSummary(t){if(!t.length)return{totalDeletions:0,averageProcessingTime:0,successRate:0,lastCleanupDate:null,recentErrors:[],totalOrganizationsProcessed:0,scheduledRuns:0,manualRuns:0};const s=t.reduce((u,h)=>u+h.result.successfulDeletions,0),r=t.reduce((u,h)=>u+h.result.processingTime,0)/t.length,a=t.reduce((u,h)=>u+h.result.successfulDeletions+h.result.failedDeletions,0),i=a>0?s/a*100:100,o=t[0]?.timestamp?new Date(t[0].timestamp).toLocaleDateString():null,l=t.flatMap(u=>u.result.errors).slice(0,5),m=t.reduce((u,h)=>u+h.result.organizationsProcessed.length,0),c=t.filter(u=>u.result.triggerMethod==="scheduled").length,x=t.filter(u=>u.result.triggerMethod==="manual").length;return{totalDeletions:s,averageProcessingTime:Math.round(r),successRate:Math.round(i*100)/100,lastCleanupDate:o,recentErrors:l,totalOrganizationsProcessed:m,scheduledRuns:c,manualRuns:x}}static async isCleanupHealthy(){try{const t=await this.getCleanupStats(),s=[],r=t.lastCleanup?new Date(t.lastCleanup):null,a=r?Math.floor((Date.now()-r.getTime())/(1e3*60*60*24)):999;if(a>2&&s.push(`Cleanup hasn't run for ${a} days`),t.recentAudits.length>0){const i=t.recentAudits[0],o=i.result.failedDeletions/(i.result.successfulDeletions+i.result.failedDeletions);o>.1&&s.push(`High error rate: ${Math.round(o*100)}% failures`)}try{const i=await this.previewCleanup();i.preview.totalExpired>50&&s.push(`${i.preview.totalExpired} expired audio files awaiting cleanup`)}catch(i){d.warn("Could not check for expired files:",i)}return{healthy:s.length===0,issues:s,lastCleanup:r,daysSinceLastCleanup:a,requiresAttention:s.length>0}}catch(t){return t.message.includes("Access denied")?{healthy:!1,issues:["Access denied: Super-user privileges required"],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}:{healthy:!1,issues:[`Failed to check cleanup health: ${t.message}`],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}}}static getCleanupScheduleInfo(){const t=new Date,s=new Date(t);return s.setUTCHours(2,0,0,0),t.getUTCHours()>=2&&s.setUTCDate(s.getUTCDate()+1),{frequency:"Daily",nextRun:s.toLocaleString(),timezone:"UTC",description:"Automatically deletes expired audio recordings across all organizations",scope:"Global (All Organizations)"}}static async verifySuperUserAccess(){try{return await this.getCleanupStats(),!0}catch(t){return!t.message.includes("Access denied")}}static async withRetry(t,s=2,r=1e3){let a;for(let i=0;i<=s;i++)try{return await t()}catch(o){if(a=o,o.message.includes("Access denied")||o.message.includes("UNAUTHENTICATED")||o.message.includes("PERMISSION_DENIED"))throw o;if(i===s)break;d.debug(`🔄 Retry attempt ${i+1}/${s} after ${r}ms...`),await new Promise(l=>setTimeout(l,r)),r*=1.5}throw a}static async getFullDashboardData(){try{const[t,s,r,a]=await Promise.allSettled([this.withRetry(()=>this.getCleanupStats()),this.withRetry(()=>this.getGlobalAudioStats()),this.withRetry(()=>this.previewCleanup()),this.withRetry(()=>this.isCleanupHealthy())]),i=this.getCleanupScheduleInfo();return{stats:t.status==="fulfilled"?t.value:{error:t.reason?.message},globalStats:s.status==="fulfilled"?s.value:{error:s.reason?.message},preview:r.status==="fulfilled"?r.value:{error:r.reason?.message},health:a.status==="fulfilled"?a.value:{error:a.reason?.message},schedule:i}}catch(t){throw d.error("❌ Failed to load dashboard data:",t),t}}}const ic=()=>{const[n,t]=p.useState(null),[s,r]=p.useState(null),[a,i]=p.useState(!0),[o,l]=p.useState(!1),[m,c]=p.useState(null);p.useEffect(()=>{x()},[]);const x=async()=>{try{i(!0),c(null);const[g,b]=await Promise.all([Cs.getCleanupStats(),Cs.isCleanupHealthy()]);t(g),r(b)}catch(g){c(g.message),d.error("Failed to load cleanup dashboard:",g)}finally{i(!1)}},u=async()=>{try{l(!0),c(null);const g=await Cs.triggerManualCleanup();await x(),alert(`✅ Manual cleanup completed!

Deleted: ${g.result.successfulDeletions} files
Scanned: ${g.result.totalScanned} warnings`)}catch(g){c(g.message),d.error("Manual cleanup failed:",g)}finally{l(!1)}};if(a)return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(pt,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading cleanup data..."})]});const h=n?Cs.formatCleanupSummary(n.recentAudits):null,v=Cs.getCleanupScheduleInfo();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Audio Cleanup Management"}),e.jsx("p",{className:"text-gray-600",children:"Monitor and manage automated audio file deletion"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:x,disabled:a,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(pt,{className:`w-4 h-4 ${a?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:u,disabled:o,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:[e.jsx(Jn,{className:`w-4 h-4 ${o?"animate-spin":""}`}),o?"Running...":"Run Manual Cleanup"]})]})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(me,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:m})]}),s&&e.jsxs("div",{className:`p-4 rounded-lg border ${s.healthy?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.healthy?e.jsx(ae,{className:"w-5 h-5 text-green-600"}):e.jsx(me,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:`font-semibold ${s.healthy?"text-green-900":"text-yellow-900"}`,children:["Cleanup System ",s.healthy?"Healthy":"Needs Attention"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Last Cleanup:"}),e.jsx("p",{className:"font-medium",children:s.lastCleanup?s.lastCleanup.toLocaleString():"Never"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Days Since Last Run:"}),e.jsx("p",{className:"font-medium",children:s.daysSinceLastCleanup})]})]}),s.issues.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900 mb-1",children:"Issues:"}),e.jsx("ul",{className:"text-sm text-yellow-800 space-y-1",children:s.issues.map((g,b)=>e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-yellow-600 rounded-full"}),g]},b))})]})]}),h&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Os,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Deletions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:h.totalDeletions.toLocaleString()})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ae,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.successRate,"%"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Re,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Processing"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[h.averageProcessingTime,"ms"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(tt,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Cleanup"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:h.lastCleanupDate||"Never"})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Cleanup Schedule"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Frequency:"}),e.jsx("p",{className:"font-medium",children:v.frequency})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Next Run:"}),e.jsx("p",{className:"font-medium",children:v.nextRun})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Timezone:"}),e.jsx("p",{className:"font-medium",children:v.timezone})]})]}),e.jsx("p",{className:"text-gray-600 mt-3 text-sm",children:v.description})]}),n&&n.recentAudits.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(wa,{className:"w-5 h-5"}),"Recent Cleanup Logs"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Scanned"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Expired"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Deleted"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Failed"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Processing"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Orgs"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:n.recentAudits.slice(0,10).map(g=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:new Date(g.timestamp).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:g.result.totalScanned}),e.jsx("td",{className:"px-6 py-4",children:g.result.totalExpired}),e.jsx("td",{className:"px-6 py-4 text-green-600 font-medium",children:g.result.successfulDeletions}),e.jsx("td",{className:"px-6 py-4 text-red-600 font-medium",children:g.result.failedDeletions}),e.jsxs("td",{className:"px-6 py-4",children:[g.result.processingTime,"ms"]}),e.jsx("td",{className:"px-6 py-4",children:g.result.organizationsProcessed.length})]},g.id))})]})})]}),h&&h.recentErrors.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-red-600"}),"Recent Errors"]}),e.jsx("div",{className:"space-y-2",children:h.recentErrors.map((g,b)=>e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:g})},b))})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Compliance & Data Protection"}),e.jsx("p",{className:"text-blue-800 text-sm mb-3",children:"Audio recordings are automatically deleted when warnings expire to ensure compliance with data protection regulations. All deletion activities are logged for audit purposes."}),e.jsxs("ul",{className:"text-blue-700 text-sm space-y-1",children:[e.jsx("li",{children:"• Audio files are deleted from Firebase Storage"}),e.jsx("li",{children:"• Warning documents remain with deletion metadata"}),e.jsx("li",{children:"• All deletion activities are audited and logged"}),e.jsx("li",{children:"• Manual cleanup can be triggered by administrators"})]})]})]})})]})};class aa{static async getEscalationRecommendation(t,s,r){try{d.debug(5184);const a=await this.getActiveWarnings(t,r);let i=null,o=!1,l=null,m=null;if(r)try{m=(await ge.queryDocuments(r,"categories",[])).documents.find(j=>j.id===s),m?.escalationPath&&(i=m.escalationPath,o=!0,d.debug("📋 [ESCALATION] Using organization category escalation path:",i))}catch{d.warn("⚠️ [ESCALATION] Failed to load organization categories, falling back to universal")}o||(l=Vr(s),l&&(i=l.escalationPath||["counselling","verbal","first_written","final_written"],o=!0,d.debug("📋 [ESCALATION] Using universal category escalation path:",i)));const c=m||l;if(!o||!i)return d.warn("⚠️ [ESCALATION] Category not found in organization or universal categories, using fallback"),this.getFallbackRecommendation(s,r);const x=a.filter(f=>f.categoryId===s);d.debug("📋 [ESCALATION] All active warnings:",a.length),d.debug("📋 [ESCALATION] Category-specific warnings:",x.length),d.debug("📋 [ESCALATION] Category ID filter:",s);const u=i;d.debug("📋 [ESCALATION] Final escalation path:",u);const h=this.determineSuggestedLevel(x,u),v=h==="hr_intervention",g=v?"final_written":h,b={suggestedLevel:g,recommendedLevel:v?"HR INTERVENTION REQUIRED":Zt(g),reason:v?this.generateHRInterventionReason(x,c):this.generateEscalationReason(x,g,c),requiresHRIntervention:v,interventionReason:v?`Employee has active final written warning for ${c?.name||"this category"}. Next offense requires manual HR decision through dedicated intervention module.`:void 0,interventionLevel:v?"urgent":void 0,activeWarnings:x,escalationPath:u,isEscalation:x.length>0,category:c?.name||"Unknown Category",categoryId:c?.id||s,legalBasis:c?.lraSection||"Schedule 8 Item 3",legalRequirements:c?.proceduralRequirements||[],warningCount:a.length,categoryWarningCount:x.length,nextExpiryDate:this.calculateNextExpiryDate(h,c?.defaultValidityPeriod||6),examples:c?.commonExamples||[],explanation:c?.escalationRationale||"Progressive discipline according to LRA Schedule 8",previousWarnings:x};return d.success(7929),b}catch(a){return d.error("❌ [ESCALATION] Error generating recommendation:",a),this.getFallbackRecommendation(s,r)}}static determineSuggestedLevel(t,s){if(t.length===0){const c=s[0]||"counselling";return d.debug("🆕 [ESCALATION] No active warnings - starting with:",c),c}if(t.some(c=>c.level==="final_written"))return d.warn("🚨 [HR INTERVENTION] Employee has final written warning - HR intervention required"),"hr_intervention";let a=s[0]||"counselling",i=-1;for(const c of t){const x=s.indexOf(c.level);x>i&&(i=x,a=c.level)}d.debug(9224);const l=s.indexOf(a)+1;if(l>=s.length){const c="final_written";return d.debug("⚠️ [ESCALATION] Capping at final written warning:",c),c}const m=s[l];return d.debug("⬆️ [ESCALATION] Suggested next level:",m),m}static generateEscalationReason(t,s,r){if(t.length===0)return`First incident of ${r?.name||"this category"}. Starting with ${Zt(s)} follows standard progressive discipline procedures.`;const a=t.length,i=t[0],o=Math.floor((Date.now()-i.issueDate.getTime())/(1e3*60*60*24));return`Employee has ${a} active warning${a>1?"s":""} on record. Most recent warning was issued ${o} days ago. Progressive discipline policy requires escalation to ${Zt(s)}.`}static generateHRInterventionReason(t,s){const r=t.find(o=>o.level==="final_written");if(!r)return`🚨 URGENT: Employee requires HR intervention for ${s?.name||"this category"} violation.`;const a=Math.floor((Date.now()-r.issueDate.getTime())/(1e3*60*60*24)),i=t.length;return`🚨 URGENT HR INTERVENTION REQUIRED: Employee has active final written warning for ${s?.name||"this category"} (issued ${a} days ago) and has committed another offense. Total active warnings: ${i}. HR must use dedicated intervention module to decide next steps. System cannot escalate beyond final written warning.`}static calculateNextExpiryDate(t,s){const r=t==="counselling"?3:t==="verbal"?6:t==="final_written"?12:s,a=new Date;return a.setMonth(a.getMonth()+r),a}static assessCCMAReadiness(t,s,r){return t.length>=2&&r==="final_written"?"high":t.length>=1?"medium":"low"}static async getActiveWarnings(t,s){try{if(d.debug("📋 [WARNINGS] Getting active warnings for employee:",t),!s)return d.warn("⚠️ [WARNINGS] No organizationId provided, using DataService fallback"),await He.getActiveWarningsForEmployee(t);const r=se(B,"organizations",s,"warnings"),a=X(r,J("employeeId","==",t),J("isActive","==",!0),le("issueDate","desc")),o=(await oe(a)).docs.map(l=>({id:l.id,...l.data(),issueDate:l.data().issueDate?.toDate()||new Date,expiryDate:l.data().expiryDate?.toDate()||new Date,incidentDate:l.data().incidentDate?.toDate()||new Date,createdAt:l.data().createdAt?.toDate()||new Date,updatedAt:l.data().updatedAt?.toDate()||new Date}));return d.success(12879),o}catch(r){return d.error("❌ [WARNINGS] Error getting active warnings:",r),[]}}static getFallbackRecommendation(t,s){const r="counselling";return{suggestedLevel:r,recommendedLevel:Zt(r),reason:"Unable to analyze warning history - defaulting to counselling for safety",activeWarnings:[],escalationPath:["counselling","verbal","first_written","final_written"],isEscalation:!1,category:"General Misconduct",categoryId:t||"general",legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure fair and consistent application of disciplinary procedures"],warningCount:0,nextExpiryDate:this.calculateNextExpiryDate(r,6),examples:["System error occurred - manual review required"],explanation:"System error occurred - defaulting to safest disciplinary option",previousWarnings:[],ccmaReadiness:"low",ccmaFactors:["Follow basic progressive discipline principles"]}}static normalizeWarningLevel(t){const s=t.toLowerCase().replace(/\s+/g,"_");return{counselling:"counselling",counseling:"counselling",verbal:"verbal",verbal_warning:"verbal",first_written:"first_written",first_written_warning:"first_written",second_written:"second_written",second_written_warning:"second_written",final_written:"final_written",final_written_warning:"final_written"}[s]||"counselling"}static async saveWarning(t,s){try{d.debug("💾 [SAVE] Saving warning to database...");const r=t.id?Q(B,"organizations",s,"warnings",t.id):Q(se(B,"organizations",s,"warnings")),a={...t,organizationId:s,updatedAt:Ve.getServerTimestamp(),...t.id?{}:{createdAt:Ve.getServerTimestamp()}};return t.id?await Te(r,a):await ze(r,a),d.success(16339),r.id}catch(r){throw d.error("❌ [SAVE] Error saving warning:",r),r}}static async getWarningById(t){try{const s=await He.getOrganization(),r=Q(B,"organizations",s.id,"warnings",t),a=await Ze(r);return a.exists()?{id:a.id,...a.data(),issueDate:a.data().issueDate?.toDate()||new Date,expiryDate:a.data().expiryDate?.toDate()||new Date,incidentDate:a.data().incidentDate?.toDate()||new Date,createdAt:a.data().createdAt?.toDate()||new Date,updatedAt:a.data().updatedAt?.toDate()||new Date}:null}catch(s){return d.error("❌ [GET] Error getting warning by ID:",s),null}}}class ms{static{this.CACHE_DURATION=300*1e3}static{this.cache=new Map}static getCacheKey(t,s,r){return`${t}:${s}:${JSON.stringify(r||{})}`}static isValidCache(t){const s=this.cache.get(t);return s?Date.now()-s.timestamp<this.CACHE_DURATION:!1}static invalidateCache(t){for(const[s]of this.cache)s.includes(t)&&this.cache.delete(s)}static async getEmployeeProfile(t,s){try{const r=Q(B,`organizations/${t}/employees`,s),a=await Ze(r);if(!a.exists())throw new Error(`Employee ${s} not found`);const i=a.data(),o=Q(r,"summary","stats"),l=await Ze(o),m={...i,id:a.id,summary:l.exists()?l.data():void 0};return d.debug(`📋 [NESTED] Loaded employee profile: ${s}`),m}catch(r){throw d.error("❌ [NESTED] Failed to get employee profile:",r),r}}static async createWarning(t,s,r){try{const a=Ct(B),i=se(B,`organizations/${t}/employees/${s}/warnings`),o=Q(i),l={...r,id:o.id,organizationId:t,employeeId:s,createdAt:new Date,updatedAt:new Date};if(a.set(o,l),l.isActive!==!1){const m=Q(B,`organizations/${t}/indexes/activeWarnings`,o.id),c={id:o.id,employeeId:s,organizationId:t,type:"warning",title:`${l.level} - ${l.category}`,date:l.issueDate||new Date,status:l.status||"issued",priority:l.level==="final_written"?"high":l.level==="written"?"medium":"low",metadata:{level:l.level,category:l.category,employeeName:l.employeeName}};a.set(m,c)}return await this.updateEmployeeSummaryStats(a,t,s,"warning"),await a.commit(),this.invalidateCache(`warnings:${t}`),this.invalidateCache(`employee:${t}:${s}`),d.success(`✅ [NESTED] Created warning ${o.id} for employee ${s}`),o.id}catch(a){throw d.error("❌ [NESTED] Failed to create warning:",a),a}}static async getEmployeeWarnings(t,s,r,a){try{let i=se(B,`organizations/${t}/employees/${s}/warnings`);r?.status&&(i=X(i,J("status","==",r.status))),r?.level&&(i=X(i,J("level","==",r.level))),r?.isActive!==void 0&&(i=X(i,J("isActive","==",r.isActive)));const o=a?.orderField||"issueDate",l=a?.orderDirection||"desc";i=X(i,le(o,l)),a?.pageSize&&(i=X(i,ht(a.pageSize))),a?.lastDoc&&(i=X(i,hs(a.lastDoc)));const m=await oe(i),c=m.docs.map(h=>({...h.data(),id:h.id})),x=a?.pageSize?m.docs.length===a.pageSize:!1,u=m.docs.length>0?m.docs[m.docs.length-1]:void 0;return d.debug(`📋 [NESTED] Loaded ${c.length} warnings for employee ${s}`),{warnings:c,hasMore:x,lastDoc:u}}catch(i){throw d.error("❌ [NESTED] Failed to get employee warnings:",i),i}}static async getOrganizationWarnings(t,s,r){try{let a=Zn(B,"warnings");a=X(a,J("organizationId","==",t)),s?.status&&(a=X(a,J("status","==",s.status))),s?.level&&(a=X(a,J("level","==",s.level))),s?.employeeId&&(a=X(a,J("employeeId","==",s.employeeId)));const i=r?.orderField||"issueDate",o=r?.orderDirection||"desc";a=X(a,le(i,o)),r?.pageSize&&(a=X(a,ht(r.pageSize))),r?.lastDoc&&(a=X(a,hs(r.lastDoc)));const l=await oe(a),m=l.docs.map(u=>({...u.data(),id:u.id})),c=r?.pageSize?l.docs.length===r.pageSize:!1,x=l.docs.length>0?l.docs[l.docs.length-1]:void 0;return d.debug(`📋 [NESTED] Loaded ${m.length} organization warnings via collection group`),{warnings:m,hasMore:c,lastDoc:x}}catch(a){throw d.error("❌ [NESTED] Failed to get organization warnings:",a),a}}static async updateWarning(t,s,r,a){try{const i=Ct(B),o=Q(B,`organizations/${t}/employees/${s}/warnings`,r);i.update(o,{...a,updatedAt:re()});const l=Q(B,`organizations/${t}/indexes/activeWarnings`,r);if(a.status==="archived"||a.isActive===!1)i.delete(l);else if(a.status||a.level){const m={};a.status&&(m.status=a.status),a.level&&(m.priority=a.level==="final_written"?"high":a.level==="written"?"medium":"low",m.metadata={...m.metadata,level:a.level}),i.update(l,m)}(a.status||a.isActive!==void 0)&&await this.updateEmployeeSummaryStats(i,t,s,"warning"),await i.commit(),this.invalidateCache(`warnings:${t}`),this.invalidateCache(`employee:${t}:${s}`),d.success(`✅ [NESTED] Updated warning ${r}`)}catch(i){throw d.error("❌ [NESTED] Failed to update warning:",i),i}}static async getActiveWarningsIndex(t,s){try{const r=this.getCacheKey("activeWarnings",t,{limit:s});if(this.isValidCache(r))return this.cache.get(r).data;let a=se(B,`organizations/${t}/indexes/activeWarnings`);a=X(a,le("date","desc")),s&&(a=X(a,s(s)));const o=(await oe(a)).docs.map(l=>({...l.data(),id:l.id}));return this.cache.set(r,{data:o,timestamp:Date.now()}),d.debug(`📊 [NESTED] Loaded ${o.length} active warnings from index`),o}catch(r){throw d.error("❌ [NESTED] Failed to get active warnings index:",r),r}}static async updateEmployeeSummaryStats(t,s,r,a){try{const i=Q(B,`organizations/${s}/employees/${r}/summary`,"stats");t.set(i,{lastUpdated:re(),[`${a}LastActivity`]:re()},{merge:!0}),d.debug(`📊 [NESTED] Scheduled summary update for employee ${r} (${a})`)}catch(i){d.error("❌ [NESTED] Failed to update employee summary:",i)}}static clearCache(){this.cache.clear(),d.debug("🗑️ [NESTED] Cache cleared")}}const oc={useNestedDataStructure:!1,enableDualWrite:!1,useCollectionGroupQueries:!1,enableEmployeeSummaryStats:!1,useIndexCollections:!1};function Kr(n){return oc[n]}function Mr(){return Kr("useNestedDataStructure")}function Us(){return Kr("enableDualWrite")}function lc(){return Kr("useCollectionGroupQueries")}function cc(){return Kr("useIndexCollections")}class An extends Error{constructor(t,s,r){super(t),this.code=s,this.originalError=r,this.name="APIError"}}const we=(n,t)=>{throw d.error(`API Error in ${n}:`,t),t instanceof Error?new An(`${n} failed: ${t.message}`,"OPERATION_FAILED",t):new An(`${n} failed with unknown error`,"UNKNOWN_ERROR",t)},dc={async getAll(n,t){try{const[s,r]=await Promise.all([je.loadWarnings(n),je.loadEmployees(n)]),a=s.documents,i=r.documents,o=a.map(m=>{const c=i.find(x=>x.id===m.employeeId);if(c){const x=c.profile?.firstName||"",u=c.profile?.lastName||"",h=`${x} ${u}`.trim()||m.employeeName||"Unknown";return{...m,employeeName:h,employeeLastName:u||m.employeeLastName||"",employeeNumber:c.profile?.employeeNumber||m.employeeNumber||"Unknown",employeeDepartment:c.employment?.department||m.employeeDepartment||"Unknown",employeePosition:c.employment?.position||m.employeePosition||"Unknown",department:c.employment?.department||m.department||"Unknown",position:c.employment?.position||m.position||"Unknown"}}return m}),l=o.filter(m=>!(!m.level||!m.description||m.employeeName==="Unknown Employee"||m.employeeName==="Employee Not Selected"));return d.debug(`Enhanced ${o.length} warnings with employee data, filtered ${a.length-l.length} incomplete warnings`),l}catch(s){we("warnings.getAll",s)}},async getById(n,t){try{return await je.getWarning(t,n)}catch(s){we("warnings.getById",s)}},async create(n){try{d.debug("💾 Creating warning via DataService:",n);const t={id:"",organizationId:n.organizationId,employeeId:n.employeeId,categoryId:n.categoryId,category:n.categoryName||"Unknown",categoryName:n.categoryName||"Unknown",level:n.level||"verbal",employeeName:n.employeeName||"Unknown",employeeLastName:n.employeeLastName||"Employee",employeeNumber:n.employeeNumber||"Unknown",employeeDepartment:n.employeeDepartment||"Unknown",employeePosition:n.employeePosition||"Unknown",department:n.employeeDepartment||"Unknown",position:n.employeePosition||"Unknown",incidentDate:new Date(n.incidentDate),incidentTime:n.incidentTime,incidentLocation:n.incidentLocation,description:n.incidentDescription,issueDate:new Date(n.issueDate),expiryDate:new Date(n.expiryDate||Date.now()+(n.validityPeriod||6)*30*24*60*60*1e3),validityPeriod:n.validityPeriod||6,issuedBy:n.issuedBy||"",issuedByName:n.issuedByName||"",isActive:!0,status:"issued",...n.additionalNotes&&{additionalNotes:n.additionalNotes},...n.signatures&&{signatures:n.signatures},audioRecording:n.audioRecording||{status:"required",processingStatus:"pending",error:"Audio recording not provided"},deliveryMethod:n.deliveryMethod||"email",createdAt:new Date,updatedAt:new Date};let s;if(Mr()){if(s=await ms.createWarning(n.organizationId,n.employeeId,t),d.success(`📁 [NESTED] Warning created: ${s}`),Us())try{await aa.saveWarning(t,n.organizationId),d.debug("📋 [DUAL-WRITE] Warning also saved to flat structure")}catch(r){d.warn("⚠️ [DUAL-WRITE] Failed to save to flat structure:",r)}}else if(s=await aa.saveWarning(t,n.organizationId),d.success(`📋 [FLAT] Warning created: ${s}`),Us())try{await ms.createWarning(n.organizationId,n.employeeId,{...t,id:s}),d.debug("📁 [DUAL-WRITE] Warning also saved to nested structure")}catch(r){d.warn("⚠️ [DUAL-WRITE] Failed to save to nested structure:",r)}return s}catch(t){we("warnings.create",t)}},async update(n,t,s,r){try{const a=s||t.organizationId;if(!a)throw new Error("Organization ID required for warning update");if(Mr()){if(!r)d.warn("⚠️ [NESTED] Employee ID required for nested update, falling back to flat structure"),await this.updateFlatStructure(n,t,a);else if(await ms.updateWarning(a,r,n,t),d.success(`📁 [NESTED] Warning ${n} updated successfully`),Us())try{await this.updateFlatStructure(n,t,a),d.debug("📋 [DUAL-WRITE] Warning also updated in flat structure")}catch(i){d.warn("⚠️ [DUAL-WRITE] Failed to update flat structure:",i)}}else if(await this.updateFlatStructure(n,t,a),d.success(`📋 [FLAT] Warning ${n} updated successfully`),Us()&&r)try{await ms.updateWarning(a,r,n,t),d.debug("📁 [DUAL-WRITE] Warning also updated in nested structure")}catch(i){d.warn("⚠️ [DUAL-WRITE] Failed to update nested structure:",i)}}catch(a){we("warnings.update",a)}},async updateFlatStructure(n,t,s){const r=Q(B,`organizations/${s}/warnings`,n),a={...t,updatedAt:re(),organizationId:void 0};Object.keys(a).forEach(i=>{a[i]===void 0&&delete a[i]}),await Te(r,a),t.status&&await Ps.updateWarningStatus(n,t.status,s)},async delete(n){try{d.warn("warnings.delete not implemented - needs WarningService integration")}catch(t){we("warnings.delete",t)}},async getEscalationRecommendation(n,t,s){try{return await aa.getEscalationRecommendation(n,t,s)}catch(r){we("warnings.getEscalationRecommendation",r)}},async getStats(n){try{const t=await Ps.getWarningsByOrganization(n);return{total:t.length,issued:t.filter(r=>r.status==="issued").length,delivered:t.filter(r=>r.status==="delivered").length,byLevel:{counselling:t.filter(r=>r.warningLevel==="counselling").length,written_warning_1:t.filter(r=>r.warningLevel==="written_warning_1").length,written_warning_2:t.filter(r=>r.warningLevel==="written_warning_2").length,final_written_warning:t.filter(r=>r.warningLevel==="final_written_warning").length,dismissal:t.filter(r=>r.warningLevel==="dismissal").length}}}catch(t){we("warnings.getStats",t)}},async archive(n,t,s){try{const r=Q(B,`organizations/${t}/warnings`,n);await Te(r,{isArchived:!0,archivedAt:re(),archiveReason:s,updatedAt:re()}),d.success(`Warning ${n} archived (reason: ${s})`)}catch(r){we("warnings.archive",r)}},async getArchived(n){try{return(await je.loadWarnings(n)).documents.filter(r=>r.isArchived===!0||r.status==="expired"||r.status==="overturned")}catch(t){return we("warnings.getArchived",t),[]}}},hi={async getAll(n,t=100){try{const s=await je.loadEmployees(n,{pageSize:t,orderField:"profile.lastName",orderDirection:"asc"});return d.success(`👥 [OPTIMIZED] Loaded ${s.documents.length} employees with pagination (pageSize: ${t})`),s.documents}catch(s){we("employees.getAll",s)}},async getById(n,t){try{return await je.getEmployeeById(n,t)}catch(s){we("employees.getById",s)}},async create(n){try{return(await je.saveEmployee(n,n.organizationId)).id}catch(t){we("employees.create",t)}},async update(n,t,s){try{const r=await je.getEmployeeById(n,t);if(!r)throw new Error("Employee not found");const a={...r,...s};await je.saveEmployee(a,t)}catch(r){we("employees.update",r)}},async delete(n,t){try{await je.archiveEmployee(n,t)}catch(s){we("employees.delete",s)}},async bulkCreate(n,t){try{return(await je.bulkCreateEmployees(n,t)).success>0?["bulk-success"]:[]}catch(s){we("employees.bulkCreate",s)}},async search(n,t){try{const r=(await je.loadEmployees(n)).documents,a=t.toLowerCase();return r.filter(i=>i.profile.firstName.toLowerCase().includes(a)||i.profile.lastName.toLowerCase().includes(a)||i.profile.employeeNumber.toLowerCase().includes(a)||i.profile.email.toLowerCase().includes(a))}catch(s){we("employees.search",s)}},async getByManager(n,t){try{const s=Ie.generateOrgKey(t,"employees","manager",n);return await Ie.getOrFetch(s,async()=>{const a=await ge.queryDocuments(t,"employees",[J("employment.managerId","==",n),J("isActive","==",!0)],{pageSize:50,orderField:"profile.lastName",orderDirection:"asc"});return d.success(`👥 [OPTIMIZED] Loaded ${a.documents.length} employees for manager ${n}`),a.documents})}catch(s){we("employees.getByManager",s)}},async generateNextEmployeeNumber(n,t="EMP001",s="",r=1){try{const o=(await je.loadEmployees(n)).documents.map(c=>c.profile?.employeeNumber).filter(c=>c&&typeof c=="string");let l=r-1;o.forEach(c=>{const x=c.match(/(\d+)$/);if(x){const u=parseInt(x[1],10);u>l&&(l=u)}});const m=l+1;switch(t){case"EMP001":return`EMP${m.toString().padStart(3,"0")}`;case"E001":return`E${m.toString().padStart(3,"0")}`;case"001":return m.toString().padStart(3,"0");case"custom":return`${s}${m.toString().padStart(3,"0")}`;default:return`EMP${m.toString().padStart(3,"0")}`}}catch(a){we("employees.generateNextEmployeeNumber",a)}},async validateEmployeeNumber(n,t,s){try{const a=(await je.loadEmployees(n)).documents;if(!a.find(c=>c.profile?.employeeNumber===t&&c.id!==s))return{isAvailable:!0};const o=[],l=t.match(/(\d+)$/),m=t.replace(/(\d+)$/,"");if(l){const c=parseInt(l[1],10);for(let x=1;x<=3;x++){const u=`${m}${(c+x).toString().padStart(l[1].length,"0")}`;a.some(v=>v.profile?.employeeNumber===u)||o.push(u)}}return{isAvailable:!1,suggestions:o.slice(0,3)}}catch(r){we("employees.validateEmployeeNumber",r)}},async archive(n,t,s){try{const{EmployeeLifecycleService:r}=await nt(async()=>{const{EmployeeLifecycleService:a}=await import("./EmployeeLifecycleService-BlkamdWZ.js");return{EmployeeLifecycleService:a}},__vite__mapDeps([0,1,2,3,4,5]));await r.archiveEmployee(n,t,s)}catch(r){we("employees.archive",r)}},async restore(n,t,s){try{const{EmployeeLifecycleService:r}=await nt(async()=>{const{EmployeeLifecycleService:a}=await import("./EmployeeLifecycleService-BlkamdWZ.js");return{EmployeeLifecycleService:a}},__vite__mapDeps([0,1,2,3,4,5]));await r.restoreEmployee(n,t,s)}catch(r){we("employees.restore",r)}},async getEligibleForDeletion(n){try{const{EmployeeLifecycleService:t}=await nt(async()=>{const{EmployeeLifecycleService:s}=await import("./EmployeeLifecycleService-BlkamdWZ.js");return{EmployeeLifecycleService:s}},__vite__mapDeps([0,1,2,3,4,5]));return await t.getEmployeesEligibleForDeletion(n)}catch(t){we("employees.getEligibleForDeletion",t)}},async getLifecycleStats(n){try{const{EmployeeLifecycleService:t}=await nt(async()=>{const{EmployeeLifecycleService:s}=await import("./EmployeeLifecycleService-BlkamdWZ.js");return{EmployeeLifecycleService:s}},__vite__mapDeps([0,1,2,3,4,5]));return await t.getLifecycleStats(n)}catch(t){we("employees.getLifecycleStats",t)}},async getArchived(n){try{return(await je.loadArchivedEmployees(n)).documents}catch(t){we("employees.getArchived",t)}},async getAllWarningsForEmployee(n,t){try{return await je.getAllWarningsForEmployee(n,t)}catch(s){we("employees.getAllWarningsForEmployee",s)}}},mc={async getById(n){try{return await Ps.getOrganization(n)}catch(t){we("organizations.getById",t)}},async update(n,t){try{throw new Error("Organization updates not implemented in DataServiceV2")}catch(s){we("organizations.update",s)}},async getCategories(n){try{return await je.getWarningCategories(n)}catch(t){we("organizations.getCategories",t)}}},uc={getUniversal(){return $t},getById(n){return Vr(n)||null},getEscalationPath(n){return di(n)},getNextLevel(n,t){return Ho(n,t)||"verbal"}},xc={async loadDashboardData(n,t){try{const s=Date.now();d.debug("🚀 [BATCH] Loading dashboard data in parallel...");const[r,a,i]=await Promise.all([hi.getByManager(t,n),Promise.resolve([]),Promise.resolve({})]),o=Date.now()-s;return d.success(`🚀 [BATCH] Dashboard data loaded in ${o}ms (employees: ${r.length})`),{employees:r,followUps:a,stats:i,loadTime:o}}catch(s){throw we("batch.loadDashboardData",s),s}},async loadOrganizationSetup(n){try{const t=Date.now();d.debug("🚀 [BATCH] Loading organization setup data...");const s=Ie.generateOrgKey(n,"organization"),r=Ie.generateOrgKey(n,"categories"),a=Ie.generateOrgKey(n,"settings"),[i,o,l]=await Promise.all([Ie.getOrFetch(s,()=>Ps.getOrganization(n)),Ie.getOrFetch(r,()=>je.getWarningCategories(n)),Ie.getOrFetch(a,()=>Promise.resolve({}))]),m=Date.now()-t;return d.success(`🚀 [BATCH] Organization setup loaded in ${m}ms`),{organization:i,categories:o,settings:l,loadTime:m}}catch(t){throw we("batch.loadOrganizationSetup",t),t}}},hc={async getAll(n){try{return[]}catch(t){we("reports.getAll",t)}}},gc={async getDashboardMetrics(n){try{return{complianceScore:94,costPerEmployee:4250,riskScore:12}}catch(t){we("analytics.getDashboardMetrics",t)}}},Ce={warnings:dc,employees:hi,organizations:mc,categories:uc,batch:xc,reports:hc,analytics:gc},va=({onClose:n,initialTab:t="overview",organizationId:s,isEmbedded:r=!1})=>{const{user:a}=De();let i=null,o=null;try{const M=We();i=M.organization,o=M.organizationId}catch{}const l=s||o;if(!l)return e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx(me,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Organization ID Required"}),e.jsx("p",{className:"text-sm",children:"Cannot manage categories without an organization ID."})]}),n&&e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Close"})]});const{canManageCategories:m,canViewAnalytics:c}=Vt(),[x,u]=p.useState(t),[h,v]=p.useState(!0),[g,b]=p.useState(!1),[f,j]=p.useState(null),[w,C]=p.useState(null),[D]=p.useState($t),[S,y]=p.useState([]),[A,R]=p.useState([]),[_,F]=p.useState(null),[k,E]=p.useState(null),[N,I]=p.useState(null),[T,z]=p.useState(!1),[O,q]=p.useState(!1),[Y,G]=p.useState(new Set),[P,L]=p.useState({search:"",severity:"all",status:"all",usage:"all"}),[U,W]=p.useState({field:"name",direction:"asc"}),[$,H]=p.useState({name:"",description:"",severity:"serious",icon:"📋",escalationPath:["counselling","verbal","first_written","final_written"],examples:[],isActive:!0}),V=!m,ee=p.useMemo(()=>{let M=D;if(P.search){const K=P.search.toLowerCase();M=M.filter(ce=>ce.name.toLowerCase().includes(K)||ce.description.toLowerCase().includes(K)||ce.commonExamples.some(be=>be.toLowerCase().includes(K)))}return P.severity!=="all"&&(M=M.filter(K=>K.severity===P.severity)),P.status!=="all"&&(M=M.filter(K=>{const be=A.find($e=>$e.universalCategoryId===K.id)?.isDisabled||!1;return P.status==="enabled"?!be:be})),P.usage!=="all"&&_&&(M=M.filter(K=>{const be=_.recentUsage.find($e=>$e.categoryId===K.id)?.count||0;switch(P.usage){case"high":return be>=10;case"medium":return be>=3&&be<10;case"low":return be>0&&be<3;case"unused":return be===0;default:return!0}})),M.sort((K,ce)=>{const be=U.direction==="asc"?1:-1;switch(U.field){case"name":return be*K.name.localeCompare(ce.name);case"severity":{const $e={minor:1,serious:2,gross_misconduct:3};return be*($e[K.severity]-$e[ce.severity])}case"usage":{if(!_)return 0;const $e=_.recentUsage.find(it=>it.categoryId===K.id)?.count||0,Fe=_.recentUsage.find(it=>it.categoryId===ce.id)?.count||0;return be*($e-Fe)}case"created":case"modified":return be*K.name.localeCompare(ce.name);default:return 0}})},[D,A,_,P,U]),Z=p.useMemo(()=>S.filter(M=>A.some(K=>K.id===M.id&&K.isCustomCategory)),[S,A]),Ee=p.useCallback(async()=>{if(l)try{v(!0),j(null);const M=await Ce.organizations.getCategories(l);if(y(M),R([]),c){const ce=await Ae();F(ce)}d.debug("[CategoryManagement] ✅ Data loaded successfully")}catch(M){d.error("[CategoryManagement] ❌ Error loading data:",M),j(M instanceof Error?M.message:"Failed to load category data")}finally{v(!1)}},[l,c]),Ae=async()=>({totalCategories:D.length+Z.length,enabledUniversal:D.length-1,disabledUniversal:1,customCategories:Z.length,activeWarnings:45,recentUsage:[{categoryId:"attendance_punctuality",categoryName:"Attendance & Punctuality",count:15,lastUsed:new Date(Date.now()-2880*60*1e3)},{categoryId:"safety_violations",categoryName:"Safety Violations",count:8,lastUsed:new Date(Date.now()-7200*60*1e3)}]});p.useEffect(()=>{l&&Ee()},[Ee,l]);const de=async M=>{if(!V)try{b(!0),j(null);const K=A.find(ce=>ce.universalCategoryId===M);K?await DataService.customizeCategory(l,M,{...K,isDisabled:!K.isDisabled}):await DataService.customizeCategory(l,M,{isDisabled:!0}),await Ee(),C(`Category ${K?.isDisabled?"enabled":"disabled"} successfully`)}catch(K){d.error("[CategoryManagement] Error toggling category:",K),j("Failed to update category status")}finally{b(!1)}},pe=async()=>{if(!(V||!$.name?.trim()))try{b(!0),j(null);const M={name:$.name,description:$.description||"",icon:$.icon||"📋",escalationPath:$.escalationPath||["verbal","first_written","final_written"],examples:$.examples||[],severity:$.severity==="minor"?"low":$.severity==="serious"?"medium":"high"};await DataService.createCustomCategory(l,M),await Ee(),H({name:"",description:"",severity:"serious",icon:"📋",escalationPath:["counselling","verbal","first_written","final_written"],examples:[],isActive:!0}),z(!1),C("Custom category created successfully")}catch(M){d.error("[CategoryManagement] Error creating custom category:",M),j("Failed to create custom category")}finally{b(!1)}},te=async M=>{if(!(V||!window.confirm("Are you sure you want to delete this custom category? This action cannot be undone.")))try{b(!0),j(null),await Ee(),C("Custom category deleted successfully")}catch(ce){d.error("[CategoryManagement] Error deleting custom category:",ce),j("Failed to delete custom category")}finally{b(!1)}},Be=M=>{switch(M){case"minor":case"low":return"#10b981";case"serious":case"medium":return"#f59e0b";case"gross_misconduct":case"high":case"critical":return"#ef4444";default:return"#6b7280"}},rt=M=>{switch(M){case"minor":case"low":return e.jsx(Se,{className:"h-4 w-4"});case"serious":case"medium":return e.jsx(me,{className:"h-4 w-4"});case"gross_misconduct":case"high":case"critical":return e.jsx(ve,{className:"h-4 w-4"});default:return e.jsx(ye,{className:"h-4 w-4"})}},ct=M=>_?_.recentUsage.find(K=>K.categoryId===M):null,Ge=M=>A.find(ce=>ce.universalCategoryId===M)?.isDisabled||!1,Le=M=>{const K=A.find(ce=>ce.universalCategoryId===M.id);return K?{...M,name:K.customName||M.name,description:K.customDescription||M.description,escalationPath:K.customEscalationPath||M.escalationPath,commonExamples:K.customExamples||M.commonExamples,severity:K.customSeverity?K.customSeverity==="low"?"minor":K.customSeverity==="medium"?"serious":"gross_misconduct":M.severity}:M};return p.useEffect(()=>{if(w||f){const M=setTimeout(()=>{C(null),j(null)},5e3);return()=>clearTimeout(M)}},[w,f]),l?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:50,padding:"1rem"},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.75rem",width:"100%",maxWidth:"80rem",maxHeight:"90vh",display:"flex",flexDirection:"column",overflow:"hidden",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #e2e8f0",backgroundColor:"#f8fafc",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("div",{style:{backgroundColor:"#3b82f6",color:"white",padding:"0.5rem",borderRadius:"0.5rem"},children:e.jsx(jt,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#1e293b",margin:0,marginBottom:"0.25rem"},children:"Category Management"}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:[i?.name," • ",S.length," categories configured"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[!V&&e.jsxs("button",{onClick:()=>z(!0),disabled:g,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:g?"not-allowed":"pointer",opacity:g?.6:1},children:[e.jsx(gt,{className:"h-4 w-4"}),"Add Custom Category"]}),e.jsx("button",{onClick:Ee,disabled:h||g,style:{padding:"0.5rem",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:h||g?"not-allowed":"pointer",display:"flex",alignItems:"center",opacity:h||g?.6:1},children:e.jsx(pt,{className:`h-4 w-4 ${h?"animate-spin":""}`,style:{color:"#6b7280"}})}),n&&e.jsx("button",{onClick:n,style:{padding:"0.5rem",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(ve,{className:"h-4 w-4",style:{color:"#6b7280"}})})]})]}),(w||f)&&e.jsx("div",{style:{padding:"1rem 2rem",backgroundColor:w?"#f0fdf4":"#fef2f2",borderBottom:"1px solid #e2e8f0"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:w?"#16a34a":"#dc2626",fontSize:"0.875rem",fontWeight:"500"},children:[w?e.jsx(ae,{className:"h-4 w-4"}):e.jsx(me,{className:"h-4 w-4"}),w||f]})}),e.jsx("div",{style:{borderBottom:"1px solid #e2e8f0",backgroundColor:"white"},children:e.jsx("div",{style:{display:"flex",gap:0,padding:"0 2rem"},children:[{id:"overview",label:"Overview",icon:ut},{id:"universal",label:"Universal Categories",icon:At},{id:"custom",label:"Custom Categories",icon:jt},...c?[{id:"analytics",label:"Analytics",icon:wt}]:[]].map(M=>{const K=M.icon,ce=x===M.id;return e.jsxs("button",{onClick:()=>u(M.id),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"1rem 1.5rem",border:"none",backgroundColor:"transparent",borderBottom:ce?"2px solid #3b82f6":"2px solid transparent",color:ce?"#3b82f6":"#64748b",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},children:[e.jsx(K,{className:"h-4 w-4"}),M.label]},M.id)})})}),e.jsx("div",{style:{flex:1,overflow:"auto"},children:h?e.jsxs("div",{style:{padding:"4rem",textAlign:"center",color:"#64748b"},children:[e.jsx(et,{className:"h-8 w-8 mx-auto mb-4 animate-spin"}),e.jsx("p",{style:{margin:0},children:"Loading category configuration..."})]}):e.jsxs(e.Fragment,{children:[x==="overview"&&e.jsxs("div",{style:{padding:"2rem"},children:[_&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:window.innerWidth>1024?"repeat(4, 1fr)":window.innerWidth>768?"repeat(2, 1fr)":"1fr",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{backgroundColor:"#dbeafe",color:"#3b82f6",padding:"0.5rem",borderRadius:"0.375rem"},children:e.jsx(jt,{className:"h-5 w-5"})}),e.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:_.totalCategories})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Total Categories"})]}),e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{backgroundColor:"#dcfce7",color:"#16a34a",padding:"0.5rem",borderRadius:"0.375rem"},children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:_.enabledUniversal})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Universal Categories Enabled"})]}),e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{backgroundColor:"#fef3c7",color:"#d97706",padding:"0.5rem",borderRadius:"0.375rem"},children:e.jsx(gt,{className:"h-5 w-5"})}),e.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:_.customCategories})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Custom Categories"})]}),e.jsxs("div",{style:{backgroundColor:"white",padding:"1.5rem",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{backgroundColor:"#e0e7ff",color:"#6366f1",padding:"0.5rem",borderRadius:"0.375rem"},children:e.jsx(ye,{className:"h-5 w-5"})}),e.jsx("span",{style:{fontSize:"2rem",fontWeight:"700",color:"#1e293b"},children:_.activeWarnings})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Active Warnings"})]})]}),e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",border:"1px solid #e2e8f0",padding:"1.5rem",marginBottom:"2rem"},children:[e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:"#1e293b"},children:"Quick Actions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:window.innerWidth>768?"repeat(3, 1fr)":"1fr",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>u("universal"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.375rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseOver:M=>M.currentTarget.style.backgroundColor="#f1f5f9",onMouseOut:M=>M.currentTarget.style.backgroundColor="#f8fafc",children:[e.jsx(At,{className:"h-5 w-5",style:{color:"#3b82f6"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:"Configure Universal Categories"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Enable, disable or customize the 8 standard categories"})]})]}),e.jsxs("button",{onClick:()=>u("custom"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.375rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseOver:M=>M.currentTarget.style.backgroundColor="#f1f5f9",onMouseOut:M=>M.currentTarget.style.backgroundColor="#f8fafc",children:[e.jsx(jt,{className:"h-5 w-5",style:{color:"#8b5cf6"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:"Manage Custom Categories"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Create and manage organization-specific categories"})]})]}),c&&e.jsxs("button",{onClick:()=>u("analytics"),style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",backgroundColor:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"0.375rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseOver:M=>M.currentTarget.style.backgroundColor="#f1f5f9",onMouseOut:M=>M.currentTarget.style.backgroundColor="#f8fafc",children:[e.jsx(wt,{className:"h-5 w-5",style:{color:"#10b981"}}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:"View Usage Analytics"}),e.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Analyze category usage patterns and trends"})]})]})]})]}),_&&_.recentUsage.length>0&&e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",border:"1px solid #e2e8f0",overflow:"hidden"},children:[e.jsx("div",{style:{padding:"1.5rem 1.5rem 0 1.5rem"},children:e.jsx("h3",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"1rem",color:"#1e293b"},children:"Recent Category Usage"})}),e.jsx("div",{style:{padding:"0 1.5rem 1.5rem 1.5rem"},children:_.recentUsage.slice(0,5).map((M,K)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.75rem 0",borderBottom:K<Math.min(_.recentUsage.length,5)-1?"1px solid #f1f5f9":"none"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:M.categoryName}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:["Last used ",Math.floor((Date.now()-M.lastUsed.getTime())/(1440*60*1e3))," days ago"]})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsxs("div",{style:{padding:"0.25rem 0.5rem",backgroundColor:"#f3f4f6",borderRadius:"0.25rem",fontSize:"0.75rem",fontWeight:"600",color:"#374151"},children:[M.count," warnings"]})})]},M.categoryId))})]})]}),x==="universal"&&e.jsxs("div",{style:{padding:"2rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"2rem",flexWrap:"wrap"},children:[e.jsx("div",{style:{flex:1,minWidth:"300px"},children:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(as,{className:"h-4 w-4",style:{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",color:"#9ca3af"}}),e.jsx("input",{type:"text",placeholder:"Search categories...",value:P.search,onChange:M=>L(K=>({...K,search:M.target.value})),style:{width:"100%",padding:"0.5rem 0.75rem 0.5rem 2.5rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem"}})]})}),e.jsxs("select",{value:P.severity,onChange:M=>L(K=>({...K,severity:M.target.value})),style:{padding:"0.5rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",backgroundColor:"white",minWidth:"120px"},children:[e.jsx("option",{value:"all",children:"All Severities"}),e.jsx("option",{value:"minor",children:"Minor"}),e.jsx("option",{value:"serious",children:"Serious"}),e.jsx("option",{value:"gross_misconduct",children:"Gross Misconduct"})]}),e.jsxs("select",{value:P.status,onChange:M=>L(K=>({...K,status:M.target.value})),style:{padding:"0.5rem 0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",backgroundColor:"white",minWidth:"100px"},children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"enabled",children:"Enabled"}),e.jsx("option",{value:"disabled",children:"Disabled"})]})]}),e.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0.5rem",overflow:"hidden"},children:[ee.map((M,K)=>{const ce=Ge(M.id),be=k===M.id;N?.id,M.id;const $e=ct(M.id),Fe=Le(M);return e.jsx("div",{children:e.jsxs("div",{style:{padding:"1.5rem",borderBottom:K<ee.length-1?"1px solid #f1f5f9":"none",backgroundColor:ce?"#f8fafc":"white",opacity:ce?.7:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",color:ce?"#6b7280":"#1e293b",margin:0},children:Fe.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"0.75rem",backgroundColor:Be(Fe.severity),color:"white",fontSize:"0.75rem",fontWeight:"600"},children:[rt(Fe.severity),Fe.severity.replace("_"," ")]}),$e&&$e.count>0&&e.jsxs("div",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#f3f4f6",borderRadius:"0.75rem",fontSize:"0.75rem",fontWeight:"500",color:"#374151"},children:[$e.count," warnings"]}),ce&&e.jsx("div",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#fee2e2",borderRadius:"0.75rem",fontSize:"0.75rem",fontWeight:"500",color:"#dc2626"},children:"Disabled"})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:ce?"#9ca3af":"#64748b",margin:"0 0 0.75rem 0",lineHeight:"1.5"},children:Fe.description}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[e.jsx(wt,{className:"h-3 w-3"}),Fe.escalationPath.length," steps"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[e.jsx(At,{className:"h-3 w-3"}),Fe.lraSection]}),Fe.commonExamples.length>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[e.jsx(ye,{className:"h-3 w-3"}),Fe.commonExamples.length," examples"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[!V&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>de(M.id),disabled:g,style:{padding:"0.5rem",backgroundColor:ce?"#10b981":"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:g?"not-allowed":"pointer",fontSize:"0.75rem",fontWeight:"500",opacity:g?.6:1,display:"flex",alignItems:"center",gap:"0.25rem"},children:[ce?e.jsx(ut,{className:"h-3 w-3"}):e.jsx(no,{className:"h-3 w-3"}),ce?"Enable":"Disable"]}),e.jsx("button",{onClick:()=>I({type:"universal",id:M.id,data:{}}),style:{padding:"0.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(Ir,{className:"h-3 w-3"})})]}),e.jsx("button",{onClick:()=>E(be?null:M.id),style:{padding:"0.5rem",backgroundColor:"transparent",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:be?e.jsx(Gt,{className:"h-4 w-4"}):e.jsx(Ke,{className:"h-4 w-4"})})]})]}),be&&e.jsx("div",{style:{marginTop:"1.5rem",padding:"1.5rem",backgroundColor:"#f8fafc",borderRadius:"0.5rem",border:"1px solid #e2e8f0"},children:e.jsxs("div",{style:{display:"grid",gap:"1.5rem",gridTemplateColumns:window.innerWidth>1024?"repeat(3, 1fr)":"1fr"},children:[e.jsxs("div",{children:[e.jsxs("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(wt,{className:"h-4 w-4"}),"Escalation Path"]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:Fe.escalationPath.map((it,yt)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.25rem 0.5rem",backgroundColor:"white",borderRadius:"0.25rem",fontSize:"0.75rem"},children:[e.jsx("span",{style:{backgroundColor:"#3b82f6",color:"white",width:"1.25rem",height:"1.25rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.625rem",fontWeight:"600"},children:yt+1}),it.replace("_"," ")]},yt))})]}),e.jsxs("div",{children:[e.jsxs("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(At,{className:"h-4 w-4"}),"Legal Framework"]}),e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:"white",borderRadius:"0.375rem",fontSize:"0.75rem",lineHeight:"1.4"},children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b",marginBottom:"0.25rem"},children:Fe.lraSection}),e.jsx("div",{style:{color:"#6b7280"},children:Fe.schedule8Reference})]})]}),Fe.commonExamples.length>0&&e.jsxs("div",{children:[e.jsxs("h5",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151",marginBottom:"0.75rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[e.jsx(ye,{className:"h-4 w-4"}),"Common Examples"]}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:[Fe.commonExamples.slice(0,6).map((it,yt)=>e.jsx("span",{style:{padding:"0.25rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",borderRadius:"0.375rem",fontSize:"0.75rem",fontWeight:"500"},children:it},yt)),Fe.commonExamples.length>6&&e.jsxs("span",{style:{fontSize:"0.75rem",color:"#6b7280",fontStyle:"italic",alignSelf:"center"},children:["+",Fe.commonExamples.length-6," more..."]})]})]})]})})]})},M.id)}),ee.length===0&&e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[e.jsx(as,{className:"h-8 w-8 mx-auto mb-4",style:{color:"#9ca3af"}}),e.jsx("p",{style:{margin:0,fontSize:"0.875rem"},children:"No categories found matching your filters."})]})]})]}),x==="custom"&&e.jsxs("div",{style:{padding:"2rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"2rem"},children:e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1e293b",margin:0,marginBottom:"0.25rem"},children:"Custom Categories"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Organization-specific categories beyond the universal standards."})]})}),Z.length>0?e.jsx("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0.5rem",overflow:"hidden"},children:Z.map((M,K)=>e.jsx("div",{style:{padding:"1.5rem",borderBottom:K<Z.length-1?"1px solid #f1f5f9":"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",color:"#1e293b",margin:0},children:M.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",padding:"0.125rem 0.5rem",borderRadius:"0.75rem",backgroundColor:Be(M.severity),color:"white",fontSize:"0.75rem",fontWeight:"600"},children:[rt(M.severity),M.severity]}),e.jsx("div",{style:{padding:"0.125rem 0.5rem",backgroundColor:"#fef3c7",borderRadius:"0.75rem",fontSize:"0.75rem",fontWeight:"500",color:"#d97706"},children:"Custom"})]}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:"0 0 0.75rem 0",lineHeight:"1.5"},children:M.description||"No description provided"}),e.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[e.jsx(wt,{className:"h-3 w-3"}),M.escalationPath?.length||0," steps"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#6b7280"},children:[e.jsx(Re,{className:"h-3 w-3"}),"Created ",new Date(M.createdAt).toLocaleDateString()]})]})]}),!V&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>I({type:"custom",id:M.id,data:M}),style:{padding:"0.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(Ir,{className:"h-3 w-3"})}),e.jsx("button",{onClick:()=>te(M.id),style:{padding:"0.5rem",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center"},children:e.jsx(Os,{className:"h-3 w-3"})})]})]})},M.id))}):e.jsxs("div",{style:{padding:"3rem",textAlign:"center",border:"2px dashed #e2e8f0",borderRadius:"0.5rem",color:"#64748b"},children:[e.jsx(jt,{className:"h-12 w-12 mx-auto mb-4",style:{color:"#9ca3af"}}),e.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"0.5rem",color:"#374151"},children:"No Custom Categories"}),e.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.875rem"},children:"Create organization-specific categories to supplement the universal standards."}),!V&&e.jsxs("button",{onClick:()=>z(!0),style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"#8b5cf6",color:"white",border:"none",borderRadius:"0.375rem",fontSize:"0.875rem",fontWeight:"500",cursor:"pointer"},children:[e.jsx(gt,{className:"h-4 w-4"}),"Create First Custom Category"]})]})]}),x==="analytics"&&c&&e.jsxs("div",{style:{padding:"2rem"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"2rem"},children:e.jsxs("div",{children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",color:"#1e293b",margin:0,marginBottom:"0.25rem"},children:"Category Usage Analytics"}),e.jsx("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:"Insights into how categories are being used across your organization."})]})}),_?e.jsx("div",{style:{display:"grid",gap:"2rem"},children:e.jsxs("div",{style:{backgroundColor:"white",border:"1px solid #e2e8f0",borderRadius:"0.5rem",padding:"2rem",textAlign:"center"},children:[e.jsx(wt,{className:"h-12 w-12 mx-auto mb-4",style:{color:"#9ca3af"}}),e.jsx("h4",{style:{fontSize:"1.125rem",fontWeight:"600",marginBottom:"0.5rem",color:"#374151"},children:"Usage Analytics Coming Soon"}),e.jsx("p",{style:{color:"#64748b",margin:0,fontSize:"0.875rem"},children:"Detailed analytics and charts will be available in a future update."})]})}):e.jsxs("div",{style:{padding:"3rem",textAlign:"center",color:"#64748b"},children:[e.jsx(et,{className:"h-8 w-8 mx-auto mb-4 animate-spin"}),e.jsx("p",{style:{margin:0},children:"Loading analytics data..."})]})]})]})}),T&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"2rem",width:"90%",maxWidth:"42rem",maxHeight:"80vh",overflowY:"auto"},children:[e.jsx("h4",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1.5rem",color:"#1e293b"},children:"Create Custom Category"}),e.jsxs("div",{style:{display:"grid",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Category Name *"}),e.jsx("input",{type:"text",value:$.name||"",onChange:M=>H(K=>({...K,name:M.target.value})),placeholder:"e.g., Social Media Policy Violations",style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Description"}),e.jsx("textarea",{value:$.description||"",onChange:M=>H(K=>({...K,description:M.target.value})),placeholder:"Brief description of what this category covers...",rows:3,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",resize:"vertical"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Severity Level"}),e.jsxs("select",{value:$.severity||"serious",onChange:M=>H(K=>({...K,severity:M.target.value})),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",backgroundColor:"white"},children:[e.jsx("option",{value:"minor",children:"Minor - Correctable behavior issues"}),e.jsx("option",{value:"serious",children:"Serious - Policy violations or misconduct"}),e.jsx("option",{value:"gross_misconduct",children:"Gross Misconduct - Severe violations"})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Category Icon"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(8, 1fr)",gap:"0.5rem",padding:"1rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",backgroundColor:"#f9fafb"},children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(M=>e.jsx("button",{type:"button",onClick:()=>H(K=>({...K,icon:M})),style:{width:"3rem",height:"3rem",border:$.icon===M?"2px solid #8b5cf6":"1px solid #d1d5db",borderRadius:"0.375rem",backgroundColor:$.icon===M?"#f3f4f6":"white",fontSize:"1.25rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:K=>{$.icon!==M&&(K.currentTarget.style.backgroundColor="#f3f4f6")},onMouseLeave:K=>{$.icon!==M&&(K.currentTarget.style.backgroundColor="white")},children:M},M))})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#374151",marginBottom:"0.5rem"},children:"Common Examples (Optional)"}),e.jsx("textarea",{value:$.examples?.join(`
`)||"",onChange:M=>H(K=>({...K,examples:M.target.value.split(`
`).filter(ce=>ce.trim())})),placeholder:"Enter examples, one per line...",rows:4,style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"0.375rem",fontSize:"0.875rem",resize:"vertical"}}),e.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",margin:"0.5rem 0 0 0"},children:"Enter one example per line to help managers understand when to use this category."})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"2rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>{z(!1),H({name:"",description:"",severity:"serious",icon:"📋",escalationPath:["counselling","verbal","first_written","final_written"],examples:[],isActive:!0})},style:{padding:"0.75rem 1.5rem",border:"1px solid #d1d5db",backgroundColor:"white",color:"#374151",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:"pointer"},children:"Cancel"}),e.jsxs("button",{onClick:pe,disabled:!$.name?.trim()||g,style:{padding:"0.75rem 1.5rem",border:"none",backgroundColor:!$.name?.trim()||g?"#9ca3af":"#8b5cf6",color:"white",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:!$.name?.trim()||g?"not-allowed":"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[g?e.jsx(et,{className:"h-4 w-4 animate-spin"}):e.jsx(gt,{className:"h-4 w-4"}),g?"Creating...":"Create Category"]})]})]})}),N&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:60},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"0.5rem",padding:"2rem",width:"90%",maxWidth:"42rem",maxHeight:"80vh",overflowY:"auto"},children:[e.jsxs("h4",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1.5rem",color:"#1e293b"},children:["Edit ",N.type==="universal"?"Universal":"Custom"," Category"]}),e.jsx("div",{style:{padding:"1rem",backgroundColor:"#f0f9ff",border:"1px solid #bae6fd",borderRadius:"0.375rem",marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#0369a1"},children:[e.jsx(Ur,{className:"h-4 w-4"}),"Category editing functionality will be implemented in the next phase."]})}),e.jsx("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:e.jsx("button",{onClick:()=>I(null),style:{padding:"0.75rem 1.5rem",border:"1px solid #d1d5db",backgroundColor:"white",color:"#374151",borderRadius:"0.375rem",fontSize:"0.875rem",cursor:"pointer"},children:"Close"})})]})})]})}):e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:[e.jsx(me,{className:"h-12 w-12 mx-auto mb-4",style:{color:"#f59e0b"}}),e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"0.5rem",color:"#374151"},children:"Organization Not Found"}),e.jsx("p",{style:{margin:0},children:"Please ensure you're logged into a valid organization to manage categories."})]})},Ts={"super-user":{id:"super-user",name:"Super User",description:"System administrator with global access",level:1},reseller:{id:"reseller",name:"Reseller",description:"Provincial sales partner with client management",level:1.5},"business-owner":{id:"business-owner",name:"Business Owner",description:"CEO/Director with organization overview",level:2},"hr-manager":{id:"hr-manager",name:"HR Manager",description:"Human Resources with employee management",level:3},"hod-manager":{id:"hod-manager",name:"HOD/Manager",description:"Department head with warning creation",level:4}},pc={"super-user":{organizations:["create","read","update","delete"],users:["create","read","update","delete"],system:["configure","deploy","monitor"],employees:["create","read","update","delete"],warnings:["create","read","update","delete"],documents:["create","read","update","delete"],analytics:["read","export"],resellers:["create","read","update","delete"],scope:["global"]},reseller:{clients:["read","update"],organizations:["create","read"],commissions:["read","export"],analytics:["read"],reports:["read","export"],contacts:["update"],billing:["read","update"],deployment:["create"],scope:["assigned-clients"]},"business-owner":{organization:["read"],users:["create","read","update","deactivate"],employees:["read"],warnings:["read"],documents:["read"],analytics:["read","export"],reports:["read","export"],scope:["organization"]},"hr-manager":{employees:["create","read","update","delete"],users:["read","update"],warnings:["read","update"],documents:["read"],categories:["configure"],analytics:["read"],reports:["read","export"],scope:["organization"]},"hod-manager":{employees:["read"],warnings:["create","read"],documents:["create"],analytics:["read"],scope:["department"]}},Fs={"super-user":{canManage:["super-user","reseller","business-owner","hr-manager","hod-manager"],canCreate:["reseller","business-owner","hr-manager","hod-manager"],canDelete:["reseller","business-owner","hr-manager","hod-manager"],scope:"global"},reseller:{canManage:[],canCreate:!1,canDelete:!1,canUpdate:!1,scope:"assigned-clients",restrictions:["Cannot create or manage user accounts","Cannot access employee data or warnings","Can only view and update assigned client organizations","Limited to commission and billing information"]},"business-owner":{canManage:["hr-manager","hod-manager"],canCreate:["hr-manager","hod-manager"],canDelete:!1,canDeactivate:["hr-manager","hod-manager"],scope:"organization",restrictions:["Cannot create users for other organizations","Cannot modify super-user accounts","Cannot modify other business-owner accounts","Can only deactivate, not permanently delete users"]},"hr-manager":{canManage:["hod-manager"],canCreate:["hod-manager"],canUpdate:["hr-manager","hod-manager"],canDelete:!1,scope:"organization",restrictions:["Cannot modify business-owner accounts","Cannot change user roles","Cannot create HR manager accounts","Profile updates only (name, email, departments)"]}},Rn=n=>{const t=pc[n];return t?Object.entries(t).map(([s,r])=>({resource:s,actions:r,scope:t.scope[0],conditions:[]})):[]},Fn=(n,t,s,r,a)=>{const i=Fs[n];if(!i||i.scope==="organization"&&(!t||t!==r))return!1;switch(a){case"create":return i.canCreate?.includes(s)||!1;case"read":return i.canManage?.includes(s)||!1;case"update":return i.canManage?.includes(s)||!1;case"delete":return i.canDelete===!0&&i.canManage?.includes(s)||!1;case"deactivate":return i.canDeactivate?.includes(s)||!1;default:return!1}},fc=n=>{const t=Fs[n];return t?.canCreate?t.canCreate.map(s=>Ts[s]).filter(Boolean):[]},gi={"business-owner":{capabilities:["✅ Create HR Manager accounts","✅ Create Department Manager accounts","✅ Update user profiles and departments","✅ Deactivate user accounts","✅ Reset user passwords","✅ View user activity logs","❌ Cannot manage other Business Owners","❌ Cannot permanently delete users","❌ Cannot access Super User accounts"],actions:["create","read","update","deactivate"],manageable_roles:["hr-manager","hod-manager"]},"hr-manager":{capabilities:["✅ Update user profiles (name, email)","✅ Update department assignments","✅ View user activity","✅ Create Department Manager accounts","❌ Cannot change user roles","❌ Cannot create HR Manager accounts","❌ Cannot deactivate users"],actions:["read","update"],manageable_roles:["hod-manager"]}},yc=()=>{const[n,t]=p.useState(!1),[s,r]=p.useState(""),a=async()=>{t(!0),r("");try{d.debug("🚀 Creating additional users for Potas Pilots...");const i="potaspilots",o={id:`${i}-hr-manager`,email:"hr@potaspilots.com",firstName:"Sarah",lastName:"Johnson",role:Ts["hr-manager"],organizationId:i,isActive:!0,createdAt:new Date().toISOString(),permissions:Rn("hr-manager")},l={id:`${i}-hod-manager`,email:"manager@potaspilots.com",firstName:"Mike",lastName:"Wilson",role:Ts["hod-manager"],organizationId:i,departmentIds:["operations","production"],isActive:!0,createdAt:new Date().toISOString(),permissions:Rn("hod-manager")},m=Q(B,"users",o.id);await ze(m,o),d.success(1789);const c=Q(B,"users",l.id);await ze(c,l),d.success(2006),r(`✅ Successfully created:
📧 HR Manager: ${o.email}
📧 HOD Manager: ${l.email}

🎉 All users ready for login!`),d.debug("🎉 All additional users created successfully!")}catch(i){d.error("❌ Error creating users:",i),r(`❌ Error: ${i instanceof Error?i.message:"Unknown error"}`)}finally{t(!1)}};return e.jsxs("div",{style:{padding:"2rem",backgroundColor:"#f8fafc",borderRadius:"0.75rem",border:"2px solid #e2e8f0",margin:"1rem 0"},children:[e.jsx("h3",{style:{fontSize:"1.25rem",fontWeight:"600",marginBottom:"1rem",color:"#1e293b"},children:"🚀 Create Demo Users for Potas Pilots"}),e.jsx("p",{style:{color:"#64748b",marginBottom:"1.5rem",lineHeight:"1.5"},children:"Click the button below to create HR Manager and HOD Manager users for your Potas Pilots organization. This will enable all 4 demo login roles."}),e.jsx("button",{onClick:a,disabled:n,style:{padding:"0.75rem 1.5rem",backgroundColor:n?"#9ca3af":"#8b5cf6",color:"white",border:"none",borderRadius:"0.5rem",fontSize:"1rem",fontWeight:"600",cursor:n?"not-allowed":"pointer",transition:"all 0.2s ease",display:"flex",alignItems:"center",gap:"0.5rem"},children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"⏳"}),"Creating Users..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"👥"}),"Create Missing Users"]})}),s&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:s.includes("❌")?"#fef2f2":"#f0fdf4",border:`1px solid ${s.includes("❌")?"#fecaca":"#bbf7d0"}`,borderRadius:"0.5rem",whiteSpace:"pre-line",fontFamily:"monospace",fontSize:"0.875rem",color:s.includes("❌")?"#dc2626":"#166534"},children:s}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#eff6ff",border:"1px solid #3b82f6",borderRadius:"0.5rem"},children:[e.jsx("h4",{style:{fontSize:"1rem",fontWeight:"600",marginBottom:"0.5rem",color:"#1e40af"},children:"📋 Users That Will Be Created:"}),e.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",color:"#1e40af",fontSize:"0.875rem"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"HR Manager:"})," hr@potaspilots.com"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"HOD Manager:"})," manager@potaspilots.com"]})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.5rem",marginBottom:0},children:"💡 These will join your existing business owner: potaspilots-business-owner@potaspilots.com"})]})]})};var vc="basil",pi="https://js.stripe.com",bc="".concat(pi,"/").concat(vc,"/stripe.js"),wc=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,jc=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Nc=function(t){return wc.test(t)||jc.test(t)},Cc=function(){for(var t=document.querySelectorAll('script[src^="'.concat(pi,'"]')),s=0;s<t.length;s++){var r=t[s];if(Nc(r.src))return r}return null},_n=function(t){var s="",r=document.createElement("script");r.src="".concat(bc).concat(s);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(r),r},Ds=null,Ws=null,Hs=null,Dc=function(t){return function(s){t(new Error("Failed to load Stripe.js",{cause:s}))}},kc=function(t,s){return function(){window.Stripe?t(window.Stripe):s(new Error("Stripe.js not available"))}},Sc=function(t){return Ds!==null?Ds:(Ds=new Promise(function(s,r){if(typeof window>"u"||typeof document>"u"){s(null);return}if(window.Stripe){s(window.Stripe);return}try{var a=Cc();if(!(a&&t)){if(!a)a=_n(t);else if(a&&Hs!==null&&Ws!==null){var i;a.removeEventListener("load",Hs),a.removeEventListener("error",Ws),(i=a.parentNode)===null||i===void 0||i.removeChild(a),a=_n(t)}}Hs=kc(s,r),Ws=Dc(r),a.addEventListener("load",Hs),a.addEventListener("error",Ws)}catch(o){r(o);return}}),Ds.catch(function(s){return Ds=null,Promise.reject(s)}))},ks,Ec=function(){return ks||(ks=Sc(null).catch(function(t){return ks=null,Promise.reject(t)}),ks)};Promise.resolve().then(function(){return Ec()}).catch(function(n){console.warn(n)});const Ac=!0,Rc=Promise.resolve(null);class Fc{constructor(){this.stripe=Rc,this.functions=Vn(),this.isDevelopment=Ac}async createSubscription(t){try{if(d.debug("Creating Stripe subscription...",t),this.isDevelopment)return d.warn("Development mode: Returning mock Stripe session"),{sessionId:`cs_dev_${Date.now()}`,url:`${window.location.origin}/mock-checkout?plan=${t.planTier}&org=${t.organizationId}`};const a=(await cs(this.functions,"createCheckoutSession")({organizationId:t.organizationId,planTier:t.planTier,customerEmail:t.customerEmail,customerName:t.customerName,resellerId:t.resellerId,successUrl:t.successUrl,cancelUrl:t.cancelUrl})).data;return d.success("Stripe checkout session created:",a),a}catch(s){throw d.error("Failed to create Stripe subscription:",s),s}}async updateSubscriptionTier(t,s,r){try{d.debug("Updating subscription tier...",{subscriptionId:t,newTier:s,employeeCount:r});const o=(await cs(this.functions,"updateSubscription")({subscriptionId:t,newTier:s,employeeCount:r})).data;return d.success("Subscription updated:",o),o}catch(a){throw d.error("Failed to update subscription:",a),a}}async cancelSubscription(t,s){try{d.debug("Canceling subscription...",{subscriptionId:t,reason:s});const i=(await cs(this.functions,"cancelSubscription")({subscriptionId:t,reason:s})).data;return d.success("Subscription canceled:",i),i}catch(r){throw d.error("Failed to cancel subscription:",r),r}}getRecommendedTier(t){return t<=10?"starter":t<=50?"professional":t<=200?"enterprise":"enterprise-plus"}needsUpgrade(t,s){const r=SUBSCRIPTION_PLANS[t],a=this.getRecommendedTier(s);return{needsUpgrade:t!==a,recommendedTier:t!==a?a:void 0,exceedsLimit:s>r.employeeLimit}}calculateProratedUpgrade(t,s,r){const a=SUBSCRIPTION_PLANS[t],l=(SUBSCRIPTION_PLANS[s].price-a.price)/30;return Math.round(l*r)}async createCustomerPortalSession(t,s){try{if(d.debug("Creating customer portal session...",{customerId:t}),this.isDevelopment)return d.warn("Development mode: Returning mock customer portal URL"),{url:`${window.location.origin}/mock-portal?customer=${t}&return=${encodeURIComponent(s)}`};const i=(await cs(this.functions,"createPortalSession")({customerId:t,returnUrl:s})).data;return d.success("Customer portal session created:",i),i}catch(r){throw d.error("Failed to create customer portal session:",r),r}}formatPrice(t){return`R${(t/100).toFixed(2)}`}getStatusDisplay(t){switch(t){case"active":return{text:"Active",color:"green"};case"past_due":return{text:"Payment Due",color:"yellow"};case"unpaid":return{text:"Payment Failed",color:"red"};case"canceled":return{text:"Canceled",color:"gray"};default:return{text:"Unknown",color:"gray"}}}validateSubscriptionLimits(t,s){const r=SUBSCRIPTION_PLANS[t.plan];if(s<=r.employeeLimit)return{isValid:!0};const a=s-r.employeeLimit;return{isValid:!1,message:`Your organization has ${s} employees but your ${r.name} plan only supports ${r.employeeLimit}. You are ${a} employees over the limit.`,suggestedAction:"upgrade"}}}const na=new Fc;class _c{static async createOrganization(t){let s=Ct(B);const r=t.id;try{d.debug(`🏢 [SHARDED ORG] Creating organization with sharded structure: ${r}`),d.debug(`📋 [SHARDED ORG] Organization name: ${t.name}`),d.debug(`👤 [SHARDED ORG] Admin user name: ${t.adminUser.firstName} ${t.adminUser.lastName}`),d.debug(`🗂️ [SHARDED ORG] Creating organization document at: organizations/${r}`);const a=Q(B,"organizations",r),i={id:r,name:t.name,industry:t.industry||"",province:t.province||"",city:t.city||"",contactEmail:t.contactEmail,contactPhone:t.contactPhone||"",employeeCount:t.employeeCount||0,subscriptionTier:t.subscriptionTier,subscriptionStatus:t.subscriptionStatus,resellerId:t.resellerId||null,branding:t.branding||{logoUrl:"",primaryColor:"#2563eb"},createdAt:Ve.getServerTimestamp(),updatedAt:Ve.getServerTimestamp(),isActive:t.subscriptionStatus==="active",databaseVersion:"2.0",shardingEnabled:!0,dataStructure:"sharded"};s.set(a,i),await this.initializeShardedCollections(r,s),await this.createDefaultCategories(r,t.customCategories||[]),await s.commit(),d.success(`✅ [SHARDED ORG] Organization ${r} created with sharded structure`);const o=await this.createAdminUser(r,t.adminUser);return{organizationId:r,adminUserId:o,success:!0}}catch(a){d.error("❌ [SHARDED ORG] Failed to create organization:",a);try{await this.cleanupFailedOrganization(r)}catch(i){d.error("Failed to cleanup failed organization:",i)}return{organizationId:r,adminUserId:"",success:!1,error:a instanceof Error?a.message:"Unknown error"}}}static async initializeShardedCollections(t,s){d.debug(`🔧 [SHARDED ORG] Initializing sharded collections for ${t}`);const r=["employees","warnings","categories","users","meetings","reports"];for(const i of r){const o=Q(B,`organizations/${t}/${i}`,"_metadata");s.set(o,{collectionName:i,organizationId:t,createdAt:Ve.getServerTimestamp(),totalDocuments:0,lastUpdated:Ve.getServerTimestamp()})}const a=Q(B,`organizations/${t}/settings`,"main");s.set(a,{organizationId:t,defaultWarningLevel:"verbal",requireWitnessSignature:!0,autoEscalation:!0,notificationSettings:{emailNotifications:!0,smsNotifications:!1,deliveryConfirmation:!0},customFields:[],createdAt:Ve.getServerTimestamp()})}static async createDefaultCategories(t,s=[]){if(d.debug(`📋 [SHARDED ORG] Creating categories for ${t}`),s.some(l=>l.isDefault===!0)){d.debug(`📚 [SHARDED ORG] Using ${s.length} wizard-modified categories`);for(const l of s)await je.createWarningCategory(l,t);d.success(`✅ [SHARDED ORG] Created ${s.length} categories for ${t}`);return}d.debug(`📚 [SHARDED ORG] Using ${$t.length} default universal categories`);const a=$t.map(l=>({id:l.id,name:l.name,description:l.description,severity:l.severity,escalationPath:l.escalationPath,color:l.severity==="minor"?"#16a34a":l.severity==="serious"?"#ea580c":"#dc2626",isActive:!0,isDefault:!0,lraSection:l.lraSection,schedule8Reference:l.schedule8Reference,commonExamples:l.commonExamples,defaultValidityPeriod:l.defaultValidityPeriod,requiresImmediateAction:l.requiresImmediateAction||!1})),i=[...a],o=s.filter(l=>!l.isDefault);o.forEach((l,m)=>{typeof l=="string"?i.push({id:`custom-${m+1}`,name:l,description:`Custom category: ${l}`,severity:"minor",escalationPath:["counselling","verbal","first_written","final_written"],color:"#6366f1",isActive:!0,isDefault:!1}):i.push({...l,isDefault:!1})});for(const l of i)await je.createWarningCategory(l,t);d.success(`✅ [SHARDED ORG] Created ${i.length} categories for ${t} (${a.length} default + ${o.length} custom)`)}static async createAdminUser(t,s){let r;try{d.debug(`👤 [SHARDED ORG] Creating admin user for ${t}`);const i=(await Qn(Nt,s.email,s.password)).user;r=i.uid,fs.startUserCreation(r),await ao(i,{displayName:`${s.firstName} ${s.lastName}`}),d.debug(`📝 [SHARDED ORG] Creating user document with ID: ${r}`);const o={id:r,email:s.email,firstName:s.firstName,lastName:s.lastName,role:s.role,organizationId:t,isActive:!0,createdAt:Ve.getServerTimestamp(),lastLogin:Ve.getServerTimestamp(),permissions:{canManageEmployees:!0,canCreateWarnings:!0,canViewReports:!0,canManageUsers:!0,canManageSettings:!0}};await ge.createDocument(t,"users",o,r);try{await ds.setUserOrganization(r,t,"business-owner",s.email,"sharded"),d.debug(`📋 Created UserOrgIndex entry: ${r} → ${t}`)}catch(l){d.error("❌ Failed to create UserOrgIndex entry:",l)}return fs.finishUserCreation(r),d.success(`✅ [SHARDED ORG] Admin user created: ${r}`),r}catch(a){if(r&&fs.finishUserCreation(r),a?.code==="auth/email-already-in-use"){const i=`Email ${s.email} is already in use. Please use a different email address or contact support if this is your email.`;throw d.error(`❌ [SHARDED ORG] ${i}`),new Error(i)}throw d.error("❌ [SHARDED ORG] Failed to create admin user:",a),a}}static async cleanupFailedOrganization(t){try{d.debug(`🧹 [SHARDED ORG] Cleaning up failed organization: ${t}`);const s=Q(B,"organizations",t);await ze(s,{},{merge:!1}),d.success(`✅ [SHARDED ORG] Cleanup completed for ${t}`)}catch(s){d.error("❌ [SHARDED ORG] Cleanup failed:",s)}}static async activateOrganization(t){try{d.debug(`🚀 [SHARDED ORG] Activating organization: ${t}`);const s=Q(B,"organizations",t);await ze(s,{subscriptionStatus:"active",isActive:!0,activatedAt:Ve.getServerTimestamp(),updatedAt:Ve.getServerTimestamp()},{merge:!0});const r=await ge.queryDocuments(t,"users",[["role","==","business-owner"]]);if(r.documents.length>0){const a=r.documents[0];await ge.updateDocument(t,"users",a.id,{isActive:!0,activatedAt:Ve.getServerTimestamp()})}d.success(`✅ [SHARDED ORG] Organization ${t} activated`)}catch(s){throw d.error("❌ [SHARDED ORG] Failed to activate organization:",s),s}}static async getShardedOrganization(t){try{const s=Q(B,"organizations",t),r=await ge.getDocument(t,"organizations",t);return r.exists?r.data:null}catch(s){return d.error("Failed to get sharded organization:",s),null}}static async migrateToShardedStructure(t){try{return d.warn(`🔄 [MIGRATION] Migrating organization to sharded structure: ${t}`),d.success(`✅ [MIGRATION] Organization ${t} ready for sharded structure`),!0}catch(s){return d.error("❌ [MIGRATION] Failed to migrate organization:",s),!1}}}const zc=[{name:"Operations",description:"Core business operations and daily management activities",isDefault:!0,isActive:!0},{name:"Admin",description:"Human resources, administration, and support functions",isDefault:!0,isActive:!0}];class Ic{getCollectionPath(t){return`organizations/${t}/departments`}async createDefaultDepartments(t){try{d.info("Creating default departments for organization",{organizationId:t});const s=Ct(B),r=[],a=new Date;for(const i of zc){const o=Q(se(B,this.getCollectionPath(t))),l={id:o.id,...i,organizationId:t,employeeCount:0,createdAt:a,updatedAt:a};s.set(o,{...l,createdAt:St.fromDate(a),updatedAt:St.fromDate(a)}),r.push(l)}return await s.commit(),d.success("Default departments created successfully",{organizationId:t,count:r.length}),r}catch(s){throw d.error("Failed to create default departments",{error:s,organizationId:t}),s}}async getDepartments(t){try{const s=X(se(B,this.getCollectionPath(t)),J("isActive","==",!0),le("isDefault","desc"),le("name","asc")),r=await oe(s),a=[];return r.forEach(i=>{const o=i.data();a.push({id:i.id,...o,createdAt:o.createdAt?.toDate()||new Date,updatedAt:o.updatedAt?.toDate()||new Date})}),d.info("Retrieved departments",{organizationId:t,count:a.length}),a}catch(s){throw d.error("Failed to get departments",{error:s,organizationId:t}),s}}async getDepartment(t,s){try{const r=Q(B,this.getCollectionPath(t),s),a=await Ze(r);if(!a.exists())return null;const i=a.data();return{id:a.id,...i,createdAt:i.createdAt?.toDate()||new Date,updatedAt:i.updatedAt?.toDate()||new Date}}catch(r){throw d.error("Failed to get department",{error:r,organizationId:t,departmentId:s}),r}}async createDepartment(t,s){try{d.info("Creating new department",{organizationId:t,formData:s});const r=new Date,a={name:s.name.trim(),description:s.description?.trim()||"",managerId:s.managerId||null,managerName:null,managerEmail:null,employeeCount:0,isDefault:!1,organizationId:t,isActive:!0,createdAt:St.fromDate(r),updatedAt:St.fromDate(r)},i=await vs(se(B,this.getCollectionPath(t)),a),o={id:i.id,...a,createdAt:r,updatedAt:r};return s.managerId&&await this.updateManagerInfo(t,i.id,s.managerId),d.success("Department created successfully",{organizationId:t,departmentId:i.id}),o}catch(r){throw d.error("Failed to create department",{error:r,organizationId:t,formData:s}),r}}async updateDepartment(t,s,r){try{d.info("Updating department",{organizationId:t,departmentId:s,formData:r});const a=Q(B,this.getCollectionPath(t),s),i={name:r.name.trim(),description:r.description?.trim()||"",managerId:r.managerId||null,updatedAt:St.fromDate(new Date)};await Te(a,i),r.managerId?await this.updateManagerInfo(t,s,r.managerId):await Te(a,{managerName:null,managerEmail:null}),d.success("Department updated successfully",{organizationId:t,departmentId:s})}catch(a){throw d.error("Failed to update department",{error:a,organizationId:t,departmentId:s,formData:r}),a}}async deleteDepartment(t,s){try{if((await this.getDepartment(t,s))?.isDefault)throw new Error("Cannot delete default departments (Operations, Admin)");d.info("Deleting department",{organizationId:t,departmentId:s});const a=Q(B,this.getCollectionPath(t),s);await Te(a,{isActive:!1,updatedAt:St.fromDate(new Date)}),d.success("Department deleted successfully",{organizationId:t,departmentId:s})}catch(r){throw d.error("Failed to delete department",{error:r,organizationId:t,departmentId:s}),r}}async updateManagerInfo(t,s,r){try{const a=Q(B,`organizations/${t}/employees`,r),i=await Ze(a);if(i.exists()){const o=i.data(),l=`${o.profile?.firstName||""} ${o.profile?.lastName||""}`.trim(),m=o.profile?.email||"",c=Q(B,this.getCollectionPath(t),s);await Te(c,{managerName:l,managerEmail:m,updatedAt:St.fromDate(new Date)})}}catch(a){d.error("Failed to update manager info",{error:a,organizationId:t,departmentId:s,managerId:r})}}async getDepartmentStats(t){try{const s=await this.getDepartments(t),r=s.length,a=s.filter(m=>m.managerId).length,i=r-a,o=s.reduce((m,c)=>m+c.employeeCount,0),l=r>0?o/r:0;return{totalDepartments:r,departmentsWithManagers:a,departmentsWithoutManagers:i,totalEmployeesAcrossDepartments:o,averageEmployeesPerDepartment:Math.round(l*100)/100}}catch(s){throw d.error("Failed to get department stats",{error:s,organizationId:t}),s}}subscribeToDepartments(t,s){const r=X(se(B,this.getCollectionPath(t)),J("isActive","==",!0),le("isDefault","desc"),le("name","asc"));return Qs(r,a=>{const i=[];a.forEach(o=>{const l=o.data();i.push({id:o.id,...l,createdAt:l.createdAt?.toDate()||new Date,updatedAt:l.updatedAt?.toDate()||new Date})}),s(i)},a=>{d.error("Department subscription error",{error:a,organizationId:t})})}async updateEmployeeCount(t,s,r){try{const a=Q(B,this.getCollectionPath(t),s);await Te(a,{employeeCount:r,updatedAt:St.fromDate(new Date)})}catch(a){throw d.error("Failed to update employee count",{error:a,organizationId:t,departmentId:s,newCount:r}),a}}async refreshEmployeeCounts(t){try{d.info("Refreshing employee counts for all departments",{organizationId:t});const s=se(B,`organizations/${t}/employees`),r=await oe(X(s,J("isActive","==",!0))),a={};r.forEach(l=>{const m=l.data(),c=m.profile?.department||m.employment?.department;c&&(a[c]=(a[c]||0)+1)});const i=await this.getDepartments(t),o=Ct(B);for(const l of i){const m=a[l.name]||0;if(l.employeeCount!==m){const c=Q(B,this.getCollectionPath(t),l.id);o.update(c,{employeeCount:m,updatedAt:St.fromDate(new Date)})}}await o.commit(),d.success("Employee counts refreshed successfully",{organizationId:t,counts:a})}catch(s){throw d.error("Failed to refresh employee counts",{error:s,organizationId:t}),s}}async getDepartmentsForManager(t,s){try{return(await this.getDepartments(t)).filter(a=>!a.managerId||a.managerId===s)}catch(r){throw d.error("Failed to get departments for manager",{error:r,organizationId:t}),r}}}const Ht=new Ic,Pc=()=>{const n={minor:"#10b981",serious:"#f59e0b",gross_misconduct:"#ef4444"};return $t.map(t=>({id:t.id,name:t.name,description:t.description,icon:t.icon,level:t.escalationPath[0]||"verbal",color:n[t.severity],isActive:!0,isDefault:!0,escalationPath:t.escalationPath}))},qs={counselling:"Counselling",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"},Tc=({category:n,onUpdate:t,onRemove:s})=>{const[r,a]=p.useState(!1),[i,o]=p.useState(n);p.useEffect(()=>{o(n)},[n]);const l=c=>{const x={...i,...c};o(x),t(x)},m=["counselling","verbal","first_written","second_written","final_written","suspension","dismissal"];return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i.icon&&e.jsx("span",{className:"text-lg",children:i.icon}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:i.color}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[i.name||"Unnamed Category",i.isDefault&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Default"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:i.description||"No description"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Starting level: ",qs[i.level]]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>a(!r),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",children:r?e.jsx(Gt,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:s,className:"p-2 text-red-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:i.isDefault?"Remove default category":"Remove custom category",children:e.jsx(Os,{className:"w-4 h-4"})})]})]}),r&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name"}),e.jsx("input",{type:"text",value:i.name,onChange:c=>l({name:c.target.value}),disabled:!1,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),e.jsx("select",{value:i.level,onChange:c=>l({level:c.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:m.map(c=>e.jsx("option",{value:c,children:qs[c]},c))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:c=>l({description:c.target.value}),disabled:!1,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),e.jsx("input",{type:"color",value:i.color,onChange:c=>l({color:c.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:i.isActive,onChange:c=>l({isActive:c.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 p-4 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(c=>e.jsx("button",{type:"button",onClick:()=>l({icon:c}),className:`w-12 h-12 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 ${i.icon===c?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,children:c},c))}),i.icon&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",e.jsx("span",{className:"text-lg",children:i.icon})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Escalation Path",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Add, remove, or duplicate steps)"})]}),e.jsx("div",{className:"space-y-2 mb-4",children:i.escalationPath?.map((c,x)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-semibold",children:x+1}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:qs[c]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{if(x>0){const u=[...i.escalationPath||[]];[u[x-1],u[x]]=[u[x],u[x-1]],l({escalationPath:u})}},disabled:x===0,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move up",children:"↑"}),e.jsx("button",{type:"button",onClick:()=>{if(x<(i.escalationPath?.length||0)-1){const u=[...i.escalationPath||[]];[u[x],u[x+1]]=[u[x+1],u[x]],l({escalationPath:u})}},disabled:x===(i.escalationPath?.length||0)-1,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move down",children:"↓"}),e.jsx("button",{type:"button",onClick:()=>{const u=[...i.escalationPath||[]];u.splice(x+1,0,c),l({escalationPath:u})},className:"w-6 h-6 flex items-center justify-center text-blue-500 hover:text-blue-700",title:"Duplicate this step",children:"⧨"}),e.jsx("button",{type:"button",onClick:()=>{const u=i.escalationPath?.filter((h,v)=>v!==x)||[];l({escalationPath:u})},disabled:(i.escalationPath?.length||0)<=1,className:"w-6 h-6 flex items-center justify-center text-red-500 hover:text-red-700 disabled:opacity-30",title:"Remove this step",children:"✕"})]})]},x))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{onChange:c=>{if(c.target.value){const x=[...i.escalationPath||[],c.target.value];l({escalationPath:x}),c.target.value=""}},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",defaultValue:"",children:[e.jsx("option",{value:"",children:"Add step..."}),m.filter(c=>c!=="suspension"&&c!=="dismissal").map(c=>e.jsx("option",{value:c,children:qs[c]},c))]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Note: Escalation stops at Final Written. No suspension/dismissal steps needed."})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This shows the progression path for repeated offenses in this category."})]})]})]})},fi=({isOpen:n,onClose:t,onComplete:s})=>{const{user:r}=De(),[a,i]=p.useState(0),[o,l]=p.useState(!1),[m,c]=p.useState(null),[x,u]=p.useState([]),[h,v]=p.useState(null),g=r?.role?.id==="reseller",b=r?.role?.id==="super-user",f=()=>C[a]?.id,[j,w]=p.useState({companyName:"",employeeCount:15,selectedPlan:"professional",industry:"",province:"gauteng",city:"",contactPerson:"",contactEmail:"",contactPhone:"",resellerId:"",adminFirstName:"",adminLastName:"",adminEmail:"",adminPassword:"",adminPasswordConfirm:"",logoUrl:"",primaryColor:"#2563eb",secondaryColor:"#6366f1",accentColor:"#10b981",customCategories:Pc()}),C=[{id:"subscription",title:"Subscription & Payment",icon:Pa},{id:"company",title:"Company Details",icon:Je},{id:"reseller",title:"Reseller Assignment",icon:Ne},{id:"admin",title:"Admin Setup",icon:rs},{id:"customize",title:"Customization",icon:mt}];p.useEffect(()=>{if(n)if(D(),b){const N=na.getRecommendedTier(j.employeeCount);w(I=>({...I,selectedPlan:N}))}else g&&(w(N=>({...N,resellerId:r?.id||"",selectedPlan:"professional",subscriptionTier:"professional"})),S())},[n,j.employeeCount,b,g,r]);const D=async()=>{try{const I=(await He.getAllResellers()).filter(z=>z.isActive);u(I);const T=I.filter(z=>z.province===j.province);T.length===1&&w(z=>({...z,resellerId:T[0].id}))}catch(N){d.error("Failed to load resellers:",N)}},S=async()=>{if(!(!r?.id||!g))try{const N=new Date,I=new Date(N.getFullYear(),N.getMonth(),1),T=await He.getResellerDeployments(r.id,I),z=T.length,O=T.length>0?new Date(T[0].createdAt):void 0;let q=!0,Y;if(z>=10)q=!1,Y="Monthly deployment limit reached (10)";else if(O){const G=(N.getTime()-O.getTime())/6e4;G<5&&(q=!1,Y=`Rate limit: Please wait ${Math.ceil(5-G)} minutes between deployments`)}v({canDeploy:q,reason:Y,deploymentsThisMonth:z,lastDeployment:O})}catch(N){d.error("Failed to check deployment status:",N),v({canDeploy:!1,reason:"Unable to verify deployment status",deploymentsThisMonth:0})}},y=N=>{w(I=>({...I,...N})),c(null)},A=()=>{switch(f()){case"subscription":return j.companyName.trim()?j.employeeCount<1?{isValid:!1,message:"Employee count must be at least 1"}:{isValid:!0}:{isValid:!1,message:"Company name is required"};case"company":return j.contactPerson.trim()?j.contactEmail.trim()?j.contactPhone.trim()?{isValid:!0}:{isValid:!1,message:"Contact phone is required"}:{isValid:!1,message:"Contact email is required"}:{isValid:!1,message:"Contact person is required"};case"reseller":return j.resellerId?{isValid:!0}:{isValid:!1,message:"Please select a reseller"};case"admin":return j.adminFirstName.trim()?j.adminLastName.trim()?j.adminEmail.trim()?j.adminPassword.length<6?{isValid:!1,message:"Password must be at least 6 characters"}:j.adminPassword!==j.adminPasswordConfirm?{isValid:!1,message:"Passwords do not match"}:{isValid:!0}:{isValid:!1,message:"Admin email is required"}:{isValid:!1,message:"Admin last name is required"}:{isValid:!1,message:"Admin first name is required"};case"customize":return{isValid:!0};default:return{isValid:!0}}},R=()=>{const N=A();if(!N.isValid){c(N.message||"Please complete all required fields");return}a<C.length-1&&(i(a+1),c(null),f()==="reseller"&&D())},_=()=>{a>0&&(i(a-1),c(null))},F=async()=>{try{if(g&&h&&!h.canDeploy){c(h.reason||"Cannot deploy at this time");return}l(!0),c(null),d.debug("🚀 [DEV MODE] Starting organization deployment with auto-approval...");const N=j.companyName.toLowerCase().replace(/[^a-z0-9]/g,"-"),I="temp123",T=await _c.createOrganization({id:N,name:j.companyName,industry:j.industry,province:j.province,city:j.city,contactEmail:j.contactEmail,contactPhone:j.contactPhone,employeeCount:j.employeeCount,subscriptionTier:j.selectedPlan,subscriptionStatus:"active",resellerId:j.resellerId,branding:{logoUrl:j.logoUrl,primaryColor:j.primaryColor,secondaryColor:j.secondaryColor,accentColor:j.accentColor},adminUser:{firstName:j.adminFirstName,lastName:j.adminLastName,email:j.adminEmail,password:I,role:"business-owner"},customCategories:j.customCategories});if(!T.success)throw new Error(T.error||"Failed to create organization");d.success(`✅ Organization '${j.companyName}' deployed successfully!`),d.success(`📧 Admin email: ${j.adminEmail}`),d.success(`🔑 Admin password: ${I}`);try{await Ht.createDefaultDepartments(N),d.success("✅ Default departments created successfully")}catch(z){d.warn("Failed to create default departments:",z)}if(g&&r?.id)try{const z=await nt(()=>Promise.resolve().then(()=>_o),void 0).then(O=>O.TimeService.getServerTimestamp());await He.logResellerDeployment({resellerId:r.id,organizationId:N,organizationName:j.companyName,adminEmail:j.adminEmail,deployedAt:z,notes:"Deployed via unified wizard"}),d.success("✅ Reseller deployment logged successfully")}catch(z){d.error("Failed to log reseller deployment:",z)}alert(`🎉 Organization '${j.companyName}' created successfully!

📧 Admin Login: ${j.adminEmail}
🔑 Password: ${I}

The organization is now active and ready to use!`),t()}catch(N){d.error("❌ Deployment failed:",N),c(N instanceof Error?N.message:"Deployment failed")}finally{l(!1)}},k=()=>x.filter(N=>N.province===j.province),E=N=>`R${(N/100).toFixed(2)}`;return n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Deploy New Client"}),e.jsxs("p",{className:"text-gray-600",children:["Step ",a+1," of ",C.length,": ",C[a].title]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",disabled:o,children:"✕"})]}),e.jsx("div",{className:"flex items-center mt-4 space-x-2",children:C.map((N,I)=>e.jsxs(Lt.Fragment,{children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium ${I<=a?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:I<a?e.jsx(mt,{className:"w-4 h-4"}):I+1}),I<C.length-1&&e.jsx("div",{className:`flex-1 h-2 rounded ${I<a?"bg-blue-600":"bg-gray-200"}`})]},N.id))})]}),e.jsxs("div",{className:"px-6 py-6",children:[g&&h&&!h.canDeploy&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qe,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:"Deployment Temporarily Unavailable"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:h.reason}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Deployments this month:"}),e.jsxs("div",{className:"font-semibold",children:[h.deploymentsThisMonth," / 10"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Last deployment:"}),e.jsx("div",{className:"font-semibold",children:h.lastDeployment?h.lastDeployment.toLocaleDateString("en-ZA"):"Never"})]})]})]})]})}),f()==="subscription"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company & Subscription Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),e.jsx("input",{type:"text",value:j.companyName,onChange:N=>y({companyName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter company name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Employees *"}),e.jsx("input",{type:"number",min:"1",value:j.employeeCount,onChange:N=>y({employeeCount:parseInt(N.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"Select Subscription Plan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(Ut).map(([N,I])=>e.jsx("div",{className:`relative border rounded-lg p-4 cursor-pointer transition-all ${j.selectedPlan===N?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"}`,onClick:()=>y({selectedPlan:N}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("h5",{className:"font-semibold",children:I.name}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 my-2",children:E(I.price)}),e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"per month"}),e.jsxs("div",{className:"text-sm",children:["Up to ",I.employeeLimit===999999?"unlimited":I.employeeLimit," employees"]}),j.selectedPlan===N&&e.jsx(mt,{className:"absolute top-2 right-2 w-5 h-5 text-blue-500"})]})},N))}),na.getRecommendedTier(j.employeeCount)!==j.selectedPlan&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Based on ",j.employeeCount," employees, we recommend the"," ",e.jsx("strong",{children:Ut[na.getRecommendedTier(j.employeeCount)].name})," plan"]})]})})]})]}),f()==="company"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),e.jsxs("select",{value:j.industry,onChange:N=>y({industry:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select industry"}),e.jsx("option",{value:"manufacturing",children:"Manufacturing"}),e.jsx("option",{value:"retail",children:"Retail & Commerce"}),e.jsx("option",{value:"healthcare",children:"Healthcare"}),e.jsx("option",{value:"security",children:"Security Services"}),e.jsx("option",{value:"mining",children:"Mining"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),e.jsx("select",{value:j.province,onChange:N=>y({province:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(Bt).map(([N,I])=>e.jsx("option",{value:N,children:I.name},N))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City / Town"}),e.jsx("input",{type:"text",value:j.city,onChange:N=>y({city:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter city or town"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person *"}),e.jsx("input",{type:"text",value:j.contactPerson,onChange:N=>y({contactPerson:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Primary contact person"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email *"}),e.jsx("input",{type:"email",value:j.contactEmail,onChange:N=>y({contactEmail:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone *"}),e.jsx("input",{type:"tel",value:j.contactPhone,onChange:N=>y({contactPhone:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 (0)11 123 4567"})]})]})]}),f()==="reseller"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Assign Reseller"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Available resellers in ",Bt[j.province]?.name]})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This reseller will receive 50% commission on monthly payments"})]}),e.jsxs("div",{className:"space-y-3",children:[k().map(N=>e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${j.resellerId===N.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"}`,onClick:()=>y({resellerId:N.id}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:[N.firstName," ",N.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:N.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:[N.clientIds?.length||0," active clients • Territory: ",N.territory?.join(", ")||"Not specified"]})]}),j.resellerId===N.id&&e.jsx(mt,{className:"w-5 h-5 text-blue-500"})]})},N.id)),k().length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(qe,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-gray-600",children:["No resellers available in ",Bt[j.province]?.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please contact support to set up resellers in this province"})]})]})]}),f()==="admin"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Administrator Account"}),e.jsx("form",{onSubmit:N=>N.preventDefault(),autoComplete:"off",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:j.adminFirstName,onChange:N=>y({adminFirstName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",value:j.adminLastName,onChange:N=>y({adminLastName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),e.jsx("input",{type:"email",value:j.adminEmail,onChange:N=>y({adminEmail:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),e.jsx("input",{type:"password",value:j.adminPassword,onChange:N=>y({adminPassword:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Minimum 6 characters",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),e.jsx("input",{type:"password",value:j.adminPasswordConfirm,onChange:N=>y({adminPasswordConfirm:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]})]})})]}),f()==="customize"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Branding & Category Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Logo URL"}),e.jsx("input",{type:"url",value:j.logoUrl,onChange:N=>y({logoUrl:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com/logo.png"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsx("input",{type:"color",value:j.primaryColor,onChange:N=>y({primaryColor:N.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),e.jsx("input",{type:"color",value:j.secondaryColor,onChange:N=>y({secondaryColor:N.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Accent Color"}),e.jsx("input",{type:"color",value:j.accentColor,onChange:N=>y({accentColor:N.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"border-t-4 border-blue-200 bg-blue-50 rounded-lg p-6 mt-8",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-900 mb-2 flex items-center gap-2",children:"📋 Warning Categories Configuration"}),e.jsx("p",{className:"text-sm text-blue-800 mb-6 font-medium",children:"⚠️ IMPORTANT: Customize the disciplinary categories for your organization. You can edit, remove, or add categories and configure their escalation paths."}),e.jsxs("div",{className:"grid gap-4",children:[j.customCategories.map((N,I)=>e.jsx(Tc,{category:N,onUpdate:T=>{const z=[...j.customCategories];z[I]=T,y({customCategories:z})},onRemove:()=>{const T=j.customCategories.filter((z,O)=>O!==I);y({customCategories:T})}},N.id)),e.jsxs("button",{type:"button",onClick:()=>{const N={id:`custom-${Date.now()}`,name:"",description:"",level:"verbal",color:"#6366f1",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]};y({customCategories:[...j.customCategories,N]})},className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-center",children:[e.jsx(gt,{className:"w-5 h-5 mx-auto mb-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Add Custom Category"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mt-6",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Deployment Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Company:"})," ",j.companyName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Plan:"})," ",Ut[j.selectedPlan].name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Monthly Cost:"})," ",E(Ut[j.selectedPlan].price)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Province:"})," ",Bt[j.province]?.name]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"Revenue Breakdown (Monthly):"}),e.jsx("br",{}),"• Client pays: ",E(Ut[j.selectedPlan].price),e.jsx("br",{}),"• Reseller commission (50%): ",E(Math.round(Ut[j.selectedPlan].price*.5)),e.jsx("br",{}),"• Your income (30%): ",E(Math.round(Ut[j.selectedPlan].price*.3)),e.jsx("br",{}),"• Company fund (20%): ",E(Math.round(Ut[j.selectedPlan].price*.2))]})})]})]}),m&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2 text-red-800",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:m})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("button",{onClick:_,disabled:a===0||o,className:"flex items-center gap-2 px-4 py-2 text-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed",children:[e.jsx(Wr,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,disabled:o,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:cursor-not-allowed",children:"Cancel"}),a===C.length-1?e.jsx("button",{onClick:F,disabled:!A().isValid||o,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx(io,{className:"w-4 h-4 animate-spin"}),"Processing Payment..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pa,{className:"w-4 h-4"}),"Deploy & Pay"]})}):e.jsxs("button",{onClick:R,disabled:!A().isValid,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:["Next",e.jsx(Pr,{className:"w-4 h-4"})]})]})]})]})}):null},xm=Object.freeze(Object.defineProperty({__proto__:null,EnhancedOrganizationWizard:fi},Symbol.toStringTag,{value:"Module"})),ba=()=>{const{currentTheme:n,setTheme:t}=Wo(),{organization:s}=We(),[r,a]=p.useState(!1),i=p.useRef(null),o=[{value:"light",label:"Light",icon:e.jsx(oo,{className:"w-4 h-4"}),description:"Clean and bright"},{value:"dark",label:"Dark",icon:e.jsx(lo,{className:"w-4 h-4"}),description:"Easy on the eyes"},{value:"branded",label:"Branded",icon:e.jsx(co,{className:"w-4 h-4"}),description:s?.name?`${s.name} colors`:"Organization colors"}],l=o.find(c=>c.value===n)||o[0];p.useEffect(()=>{const c=x=>{i.current&&!i.current.contains(x.target)&&a(!1)};return r&&document.addEventListener("mousedown",c),()=>{document.removeEventListener("mousedown",c)}},[r]);const m=c=>{t(c),a(!1)};return e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>a(!r),className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg border\r
                   bg-[var(--color-card-background)] text-[var(--color-text)]\r
                   border-[var(--color-border)] hover:border-[var(--color-border-secondary)]\r
                   transition-all duration-200 hover:shadow-sm`,"aria-label":"Select theme",children:[e.jsx("span",{className:"text-[var(--color-primary)]",children:l.icon}),e.jsx("span",{className:"hidden sm:inline",children:l.label}),e.jsx(Ke,{className:`w-4 h-4 text-[var(--color-text-tertiary)] transition-transform duration-200 ${r?"rotate-180":""}`})]}),r&&e.jsx("div",{className:`absolute right-0 mt-2 w-56 rounded-lg shadow-lg\r
                        bg-[var(--color-card-background)] border border-[var(--color-border)]\r
                        overflow-hidden z-50 animate-fade-in`,children:e.jsx("div",{className:"p-1",children:o.map(c=>e.jsxs("button",{onClick:()=>m(c.value),className:`w-full flex items-center gap-3 px-3 py-2 text-sm rounded-md
                           transition-all duration-150
                           ${n===c.value?"bg-[var(--color-primary)] text-white":"hover:bg-[var(--color-background-secondary)] text-[var(--color-text)]"}`,children:[e.jsx("span",{className:n===c.value?"text-white":"text-[var(--color-primary)]",children:c.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium",children:c.label}),e.jsx("div",{className:`text-xs ${n===c.value?"text-white/80":"text-[var(--color-text-tertiary)]"}`,children:c.description})]}),n===c.value&&e.jsx(mt,{className:"w-4 h-4"})]},c.value))})})]})},Bc=()=>{const{user:n}=De(),[t,s]=p.useState({totalOrganizations:0,totalEmployees:0,totalResellers:0,activeUsers:0,monthlyGrowth:0,systemHealth:"good"}),[r,a]=p.useState([]),[i,o]=p.useState([]),[l,m]=p.useState(!0),[c,x]=p.useState(!1),[u,h]=p.useState(!1),[v,g]=p.useState("organizations"),[b,f]=p.useState({isOpen:!1,organizationId:"",organizationName:""});p.useEffect(()=>{j()},[]);const j=async()=>{try{m(!0),d.debug("Loading SuperAdmin dashboard data...");const y=await He.loadOrganizations(),A=await He.getAllResellers(),R=y.reduce((_,F)=>_+(F.employeeCount||0),0);s({totalOrganizations:y.length,totalEmployees:R,totalResellers:A.length,activeUsers:Math.floor(R*.8),monthlyGrowth:12,systemHealth:y.length>50?"excellent":"good"}),o(y.sort((_,F)=>new Date(F.createdAt||0).getTime()-new Date(_.createdAt||0).getTime()).slice(0,5)),a(y),d.success("SuperAdmin dashboard data loaded successfully")}catch(y){d.error("Failed to load SuperAdmin dashboard data:",y)}finally{m(!1)}},w=y=>{f({isOpen:!0,organizationId:y.id,organizationName:y.name})},C=y=>{d.success(`🎉 Organization ${y} deployed successfully!`),d.info("📋 Console logs preserved - wizard will stay open for inspection"),d.info('💡 Click "Close" button when ready to return to dashboard'),j()},D=y=>{switch(y){case"excellent":return"text-green-600 bg-green-100";case"good":return"text-blue-600 bg-blue-100";case"warning":return"text-yellow-600 bg-yellow-100";case"critical":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},S=y=>{switch(y){case"excellent":return e.jsx(ae,{className:"w-5 h-5"});case"good":return e.jsx(Ta,{className:"w-5 h-5"});case"warning":return e.jsx(qe,{className:"w-5 h-5"});case"critical":return e.jsx(qe,{className:"w-5 h-5"});default:return e.jsx(Ta,{className:"w-5 h-5"})}};return l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading system overview..."})]})}):e.jsxs("div",{className:"space-y-6 p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-purple-100 to-blue-100 rounded-xl",children:e.jsx(Ft,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Super Admin Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Global system management and organization oversight"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ba,{}),e.jsxs("div",{className:`flex items-center gap-2 px-4 py-2 rounded-lg ${D(t.systemHealth)}`,children:[S(t.systemHealth),e.jsx("span",{className:"font-medium capitalize",children:t.systemHealth})]}),e.jsx(yc,{}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold",children:[e.jsx(ua,{className:"w-4 h-4"}),"Deploy New Client"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Je,{className:"w-6 h-6 text-blue-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Total"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:t.totalOrganizations}),e.jsx("div",{className:"text-sm text-gray-600",children:"Organizations"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Ne,{className:"w-6 h-6 text-green-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"System Wide"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:t.totalEmployees.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Employees"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(ei,{className:"w-6 h-6 text-orange-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Partners"})]}),e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:t.totalResellers}),e.jsx("div",{className:"text-sm text-gray-600",children:"Active Resellers"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ft,{className:"w-6 h-6 text-purple-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Growth"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["+",t.monthlyGrowth,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Monthly Growth"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("button",{onClick:()=>window.location.href="/deploy",className:"group bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 hover:border-blue-500 rounded-xl p-6 transition-all duration-200 hover:shadow-lg text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 group-hover:bg-blue-200 rounded-xl transition-colors",children:e.jsx(ua,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Deploy Organization"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create new client organization"})]})]})}),e.jsx("button",{onClick:()=>window.location.href="/organizations",className:"group bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-dashed border-green-300 hover:border-green-500 rounded-xl p-6 transition-all duration-200 hover:shadow-lg text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-100 group-hover:bg-green-200 rounded-xl transition-colors",children:e.jsx(Je,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Manage Organizations"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View and manage all organizations"})]})]})}),e.jsx("button",{onClick:()=>window.location.href="/system-settings",className:"group bg-gradient-to-br from-purple-50 to-violet-50 border-2 border-dashed border-purple-300 hover:border-purple-500 rounded-xl p-6 transition-all duration-200 hover:shadow-lg text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 group-hover:bg-purple-200 rounded-xl transition-colors",children:e.jsx(jt,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"System Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure system parameters"})]})]})}),e.jsx("button",{onClick:()=>x(!0),className:"group bg-gradient-to-br from-orange-50 to-red-50 border-2 border-dashed border-orange-300 hover:border-orange-500 rounded-xl p-6 transition-all duration-200 hover:shadow-lg text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-orange-100 group-hover:bg-orange-200 rounded-xl transition-colors",children:e.jsx(Ne,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Manage Resellers"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Provincial sales partners"})]})]})})]}),e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>g("organizations"),className:`py-2 px-1 border-b-2 font-medium text-sm ${v==="organizations"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Organizations"}),e.jsx("button",{onClick:()=>g("audio-cleanup"),className:`py-2 px-1 border-b-2 font-medium text-sm ${v==="audio-cleanup"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Audio Cleanup"}),e.jsx("button",{onClick:()=>g("financial"),className:`py-2 px-1 border-b-2 font-medium text-sm ${v==="financial"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"Financial Dashboard"})]})}),v==="organizations"?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"🏢 Organizations & Category Management"})}),l?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading real data from Firestore..."})]})}):r.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx(Je,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Organizations Yet"}),e.jsx("p",{className:"text-gray-600",children:"Deploy your first organization to start managing the system"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Organization"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Industry"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Employees"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Warnings"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Activity"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.map(y=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:y.name}),e.jsx("div",{className:"text-sm text-gray-500",children:y.id})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-50 text-blue-700 capitalize",children:y.industry||y.sector})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:e.jsx("span",{className:y.employeeCount===0?"text-gray-500":"text-green-600",children:y.employeeCount||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:e.jsx("span",{className:y.warningCount===0?"text-green-600":"text-red-600",children:y.warningCount||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:y.lastActivity||"Recently"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>w(y),className:"text-xs px-3 py-1 rounded font-semibold bg-purple-600 text-white hover:bg-purple-700",title:"Manage warning categories",children:"Categories"}),e.jsx("button",{onClick:()=>window.open(`/organization/${y.id}`,"_blank"),className:"text-xs px-3 py-1 rounded font-semibold bg-white text-blue-600 border border-blue-600 hover:bg-blue-50",title:"Open organization dashboard",children:"Manage"})]})})]},y.id))})]})})]}):v==="audio-cleanup"?e.jsx(ic,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(gs,{className:"w-6 h-6 text-green-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Monthly"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["R",(t.totalOrganizations*500).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(mo,{className:"w-6 h-6 text-blue-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Your Share (30%)"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["R",Math.round(t.totalOrganizations*500*.3).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Owner Income"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(Ne,{className:"w-6 h-6 text-orange-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Reseller Share (50%)"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["R",Math.round(t.totalOrganizations*500*.5).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reseller Commissions"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Je,{className:"w-6 h-6 text-purple-600"})}),e.jsx("span",{className:"text-sm text-gray-500",children:"Company Fund (20%)"})]}),e.jsxs("div",{className:"text-3xl font-bold text-gray-900",children:["R",Math.round(t.totalOrganizations*500*.2).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Company Reserve"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(uo,{className:"w-5 h-5"}),"Revenue Split Breakdown (50/30/20 Model)"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded"}),e.jsx("span",{className:"font-medium",children:"Gross Revenue"})]}),e.jsxs("span",{className:"text-lg font-semibold",children:["R",(t.totalOrganizations*500).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded"}),e.jsx("span",{className:"font-medium",children:"Stripe Fees (2.9%)"})]}),e.jsxs("span",{className:"text-lg font-semibold text-red-600",children:["-R",Math.round(t.totalOrganizations*500*.029).toLocaleString()]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded"}),e.jsx("span",{className:"font-medium",children:"Net Revenue (After Stripe)"})]}),e.jsxs("span",{className:"text-lg font-semibold",children:["R",Math.round(t.totalOrganizations*500*.971).toLocaleString()]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsx("div",{className:"p-4 border-2 border-orange-200 rounded-lg bg-orange-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"50%"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Resellers"}),e.jsxs("div",{className:"text-lg font-semibold",children:["R",Math.round(t.totalOrganizations*500*.971*.5).toLocaleString()]})]})}),e.jsx("div",{className:"p-4 border-2 border-blue-200 rounded-lg bg-blue-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"30%"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Owner (You)"}),e.jsxs("div",{className:"text-lg font-semibold",children:["R",Math.round(t.totalOrganizations*500*.971*.3).toLocaleString()]})]})}),e.jsx("div",{className:"p-4 border-2 border-purple-200 rounded-lg bg-purple-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"20%"}),e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"Company"}),e.jsxs("div",{className:"text-lg font-semibold",children:["R",Math.round(t.totalOrganizations*500*.971*.2).toLocaleString()]})]})})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(qe,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h3",{className:"font-semibold text-yellow-800",children:"Stripe Integration Status"})]}),e.jsx("p",{className:"text-yellow-700 mb-4",children:"Stripe webhooks are configured but not yet activated. The system currently marks subscriptions as paid for development purposes. Real financial metrics will be available once Stripe is activated in production."}),e.jsxs("div",{className:"text-sm text-yellow-600",children:[e.jsx("strong",{children:"Note:"})," Above figures are calculated based on ",t.totalOrganizations," organizations × R500 average subscription. Actual revenue will depend on subscription tiers and active billing cycles."]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Provincial Revenue Distribution"}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx(wa,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Provincial Metrics Coming Soon"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:"Once Stripe is activated and commission tracking begins, you'll see detailed provincial revenue breakdowns and reseller performance metrics here."})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Organizations"}),e.jsx("button",{onClick:()=>window.location.href="/organizations",className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"View All"})]}),e.jsxs("div",{className:"divide-y divide-gray-200",children:[i.map(y=>e.jsx("div",{className:"px-6 py-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:e.jsx(Je,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:y.name}),e.jsx("p",{className:"text-sm text-gray-600",children:y.sector})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[y.employeeCount||0," employees"]}),e.jsx("div",{className:"text-xs text-gray-500",children:y.createdAt?new Date(y.createdAt).toLocaleDateString():"N/A"})]})]})},y.id)),i.length===0&&e.jsxs("div",{className:"px-6 py-8 text-center",children:[e.jsx(Je,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No organizations found"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Organizations will appear here as they are created"})]})]})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-7xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-orange-50 to-red-50",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Reseller Management"}),e.jsx("button",{onClick:()=>x(!1),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 80px)"},children:e.jsx(xi,{})})]})}),u&&e.jsx(fi,{isOpen:u,onClose:()=>h(!1),onComplete:()=>C("new-org")}),b.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-purple-50 to-blue-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Category Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:b.organizationName})]}),e.jsx("button",{onClick:()=>f(y=>({...y,isOpen:!1})),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"calc(90vh - 80px)"},children:e.jsx(va,{onClose:()=>f(y=>({...y,isOpen:!1})),organizationId:b.organizationId,isEmbedded:!0})})]})})]})},Lc=p.createContext(null),ia={didCatch:!1,error:null};class Ss extends p.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=ia}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var s,r,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];(s=(r=this.props).onReset)===null||s===void 0||s.call(r,{args:i,reason:"imperative-api"}),this.setState(ia)}}componentDidCatch(t,s){var r,a;(r=(a=this.props).onError)===null||r===void 0||r.call(a,t,s)}componentDidUpdate(t,s){const{didCatch:r}=this.state,{resetKeys:a}=this.props;if(r&&s.error!==null&&$c(t.resetKeys,a)){var i,o;(i=(o=this.props).onReset)===null||i===void 0||i.call(o,{next:a,prev:t.resetKeys,reason:"keys"}),this.setState(ia)}}render(){const{children:t,fallbackRender:s,FallbackComponent:r,fallback:a}=this.props,{didCatch:i,error:o}=this.state;let l=t;if(i){const m={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof s=="function")l=s(m);else if(r)l=p.createElement(r,m);else if(a!==void 0)l=a;else throw o}return p.createElement(Lc.Provider,{value:{didCatch:i,error:o,resetErrorBoundary:this.resetErrorBoundary}},l)}}function $c(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n.length!==t.length||n.some((s,r)=>!Object.is(s,t[r]))}const ne=({children:n,className:t="",style:s,hover:r=!1,padding:a="md",shadow:i="md",onClick:o})=>{const l={none:"",sm:"p-3",md:"p-4",lg:"p-6"},m={sm:"var(--shadow-sm)",md:"var(--shadow)",lg:"var(--shadow-lg)",xl:"var(--shadow-xl)"},c={backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-card-border)",boxShadow:m[i],transition:"all 0.2s ease",...s},x=h=>{r&&(h.currentTarget.style.transform="translateY(-2px)",h.currentTarget.style.boxShadow=m.lg)},u=h=>{r&&(h.currentTarget.style.transform="translateY(0)",h.currentTarget.style.boxShadow=m[i])};return e.jsx("div",{className:`rounded-lg ${l[a]} ${o?"cursor-pointer":""} ${t}`,style:c,onClick:o,onMouseEnter:x,onMouseLeave:u,children:n})},Tt=({icon:n,title:t,subtitle:s,rightContent:r,className:a=""})=>e.jsxs("div",{className:`flex items-center justify-between ${a}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text)"},children:t}),s&&e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:s})]})]}),r&&e.jsx("div",{className:"flex items-center gap-2",children:r})]}),Rs=({type:n="text",label:t,value:s,onChange:r,placeholder:a,error:i,icon:o,required:l=!1,disabled:m=!1,options:c,className:x=""})=>{const u={backgroundColor:i?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:i?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"},h=()=>{const v={value:s,onChange:g=>r(g.target.value),placeholder:a,disabled:m,className:`w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm ${m?"opacity-50 cursor-not-allowed":""}`,style:u};return n==="textarea"?e.jsx("textarea",{...v,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm min-h-[88px] resize-vertical ${m?"opacity-50 cursor-not-allowed":""}`}):n==="select"&&c?e.jsxs("select",{...v,children:[e.jsx("option",{value:"",children:a||`Select ${t.toLowerCase()}...`}),c.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]}):e.jsx("input",{...v,type:n})};return e.jsxs("div",{className:`space-y-2 ${x}`,children:[e.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[o&&e.jsx(o,{className:"w-3 h-3 inline mr-1"}),t," ",l&&e.jsx("span",{style:{color:"var(--color-error)"},children:"*"})]}),h(),i&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i]})]})},ot=({children:n,variant:t="default",size:s="sm",className:r=""})=>{const a={sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm"},o=(()=>{switch(t){case"primary":return{backgroundColor:"var(--color-badge-primary)",color:"var(--color-badge-primary-text)"};case"success":return{backgroundColor:"var(--color-badge-success)",color:"var(--color-badge-success-text)"};case"warning":return{backgroundColor:"var(--color-badge-warning)",color:"var(--color-badge-warning-text)"};case"error":return{backgroundColor:"var(--color-badge-error)",color:"var(--color-badge-error-text)"};default:return{backgroundColor:"var(--color-badge-default)",color:"var(--color-badge-default-text)"}}})();return e.jsx("span",{className:`inline-flex items-center ${a[s]} font-medium rounded-full ${r}`,style:o,children:n})},Xe=({children:n,variant:t="info",className:s="",onClose:r})=>{const i=(()=>{switch(t){case"success":return{backgroundColor:"var(--color-alert-success-bg)",borderColor:"var(--color-alert-success-border)",color:"var(--color-alert-success-text)"};case"warning":return{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)",color:"var(--color-alert-warning-text)"};case"error":return{backgroundColor:"var(--color-alert-error-bg)",borderColor:"var(--color-alert-error-border)",color:"var(--color-alert-error-text)"};default:return{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)",color:"var(--color-alert-info-text)"}}})();return e.jsx("div",{className:`p-4 rounded-lg border ${s}`,style:{backgroundColor:i.backgroundColor,borderColor:i.borderColor,color:i.color},children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"flex-1",children:n}),r&&e.jsx("button",{onClick:r,className:"ml-3 text-lg leading-none opacity-60 hover:opacity-100 transition-opacity",style:{color:i.color},children:"×"})]})})},Oc=n=>{const[t,s]=p.useState(window.innerWidth>n),r=p.useCallback(()=>{s(window.innerWidth>n)},[n]);return p.useEffect(()=>(r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)),[r]),t},ka=p.memo(({className:n=""})=>{const t=Oc(768),{user:s}=De();let r=null;try{r=We()?.organization}catch{r=null}const{getPrimaryRole:a}=Vt(),[i,o]=p.useState(new Date);p.useEffect(()=>{const g=setInterval(()=>o(new Date),1e3);return()=>clearInterval(g)},[]);const l=()=>{switch(a()){case"business-owner":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-primary))"};case"hr-manager":return{background:"linear-gradient(135deg, var(--color-success), var(--color-info))"};case"hod-manager":return{background:"linear-gradient(135deg, var(--color-primary), var(--color-info))"};case"supervisor":return{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning-hover))"};case"super-user":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent-hover))"};default:return{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))"}}},m=()=>a()?.replace(/-/g," ").toUpperCase()||"USER",c=()=>{const g=i.getHours();return g<12?"Morning":g<17?"Afternoon":"Evening"},x=()=>i.toLocaleTimeString("en-ZA",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(" "),u=(g=!1)=>g?i.toLocaleDateString("en-ZA",{weekday:"long",month:"short",day:"numeric"}):i.toLocaleDateString("en-ZA",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),[h,v]=x();return e.jsx("div",{className:n,children:t?e.jsxs(ne,{padding:"md",shadow:"lg",className:"relative overflow-hidden",style:{...l(),color:"var(--color-text-inverse)"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 rounded-full -translate-y-16 translate-x-16",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h1",{className:"text-2xl font-bold",children:["Good ",c(),", ",s?.firstName,"! 👋"]})}),e.jsxs("div",{className:"hidden lg:block text-sm opacity-90 pl-4 ml-2",style:{borderLeft:"1px solid rgba(255,255,255,0.2)"},children:[r?.name||"SuperUser Dashboard"," • ",u(!0)]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl px-3 py-2",style:{backgroundColor:"rgba(255,255,255,0.1)",backdropFilter:"blur(4px)"},children:[e.jsx(Re,{className:"w-4 h-4 opacity-80"}),e.jsxs("div",{className:"text-lg font-bold",children:[h," ",v]})]}),e.jsxs(ot,{variant:"primary",size:"md",className:"flex items-center gap-2",style:{backgroundColor:"rgba(255,255,255,0.1)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)"},children:[e.jsx(xo,{className:"w-4 h-4 opacity-80"}),e.jsx("div",{className:"text-sm font-medium",children:m()})]})]})]})]}):e.jsxs(ne,{padding:"sm",shadow:"lg",className:"relative overflow-hidden",style:{...l(),color:"var(--color-text-inverse)"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 rounded-full -translate-y-12 translate-x-12",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),e.jsxs("div",{className:"relative z-10 flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsxs("p",{className:"text-sm",style:{opacity:.8},children:["Good ",c(),","]}),e.jsxs("h1",{className:"text-xl font-bold -mt-0.5",children:[s?.firstName,"! 👋"]}),e.jsx(ot,{variant:"primary",size:"sm",className:"inline-block mt-1.5",style:{backgroundColor:"rgba(255,255,255,0.15)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)",fontSize:"10px",padding:"2px 6px"},children:e.jsx("span",{className:"font-bold tracking-wider uppercase",children:m()})})]}),e.jsxs("div",{className:"text-right flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-2xl font-bold tracking-tight",children:h}),e.jsx("span",{className:"text-sm font-medium ml-1 opacity-90",children:v})]}),e.jsx("p",{className:"text-xs -mt-0.5",style:{opacity:.8},children:u(!0)})]})]})]})})});ka.displayName="WelcomeSection";const zn="dashboard_quotes_preferences",Mc=15e3,Gs=[{id:1,text:"There is no passion to be found playing small – in settling for a life that is less than the one you are capable of living.",author:"Nelson Mandela",category:"leadership",isPopular:!0},{id:2,text:"I learned that courage was not the absence of fear, but the triumph over it.",author:"Nelson Mandela",category:"courage",isPopular:!0},{id:3,text:"Ubuntu does not mean that people should not enrich themselves. The question is: are you going to do so in order to enable the community around you to be able to improve?",author:"Nelson Mandela",category:"unity"},{id:4,text:"Don't look where you fall, but where you slipped.",author:"African Proverb",category:"wisdom"},{id:5,text:"However long the night, the dawn will break.",author:"African Proverb",category:"perseverance",isPopular:!0},{id:6,text:"If you want to go fast, go alone. If you want to go far, go together.",author:"African Proverb",category:"unity",isPopular:!0},{id:7,text:"The brave may not live forever, but the cautious do not live at all.",author:"Desmond Tutu",category:"courage"},{id:8,text:"Hope is being able to see that there is light despite all of the darkness.",author:"Desmond Tutu",category:"perseverance"},{id:9,text:"Education is the most powerful weapon which you can use to change the world.",author:"Nelson Mandela",category:"wisdom",isPopular:!0},{id:10,text:"It always seems impossible until it's done.",author:"Nelson Mandela",category:"perseverance",isPopular:!0}],Uc=()=>{const[n,t]=p.useState(0),[s,r]=p.useState(!0),[a,i]=p.useState({favoriteQuotes:[],showOnlyFavorites:!1,rotationEnabled:!0});p.useEffect(()=>{try{const b=localStorage.getItem(zn);if(b){const f=JSON.parse(b);i(f),r(f.rotationEnabled)}}catch(b){d.warn("⚠️ Failed to load quotes preferences:",b)}},[]);const o=p.useCallback(b=>{try{localStorage.setItem(zn,JSON.stringify(b))}catch(f){d.warn("⚠️ Failed to save quotes preferences:",f)}},[]),m=p.useCallback(()=>a.showOnlyFavorites&&a.favoriteQuotes.length>0?Gs.filter(b=>a.favoriteQuotes.includes(b.id)):Gs,[a])(),c=m[n]||Gs[0];p.useEffect(()=>{if(!s||m.length<=1)return;const b=setInterval(()=>{t(f=>(f+1)%m.length)},Mc);return()=>clearInterval(b)},[s,m.length]);const x=p.useCallback(()=>{t(b=>(b+1)%m.length)},[m.length]),u=p.useCallback(()=>{t(b=>(b-1+m.length)%m.length)},[m.length]),h=p.useCallback(()=>{const b=!s;r(b);const f={...a,rotationEnabled:b};i(f),o(f)},[s,a,o]),v=p.useCallback(b=>{const f=a.favoriteQuotes.includes(b)?a.favoriteQuotes.filter(w=>w!==b):[...a.favoriteQuotes,b],j={...a,favoriteQuotes:f};i(j),o(j)},[a,o]),g=p.useCallback(b=>{const f={...a,...b};i(f),o(f),b.rotationEnabled!==void 0&&r(b.rotationEnabled)},[a,o]);return{currentQuote:c,allQuotes:Gs,isRotating:s,preferences:a,nextQuote:x,previousQuote:u,toggleRotation:h,toggleFavorite:v,updatePreferences:g}},ue=({variant:n="primary",size:t="md",fullWidth:s=!1,className:r="",children:a,style:i,onMouseEnter:o,onMouseLeave:l,...m})=>{const c={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},u=(g=>{switch(g){case"primary":return{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)",hoverColor:"var(--color-primary-hover)"};case"secondary":return{backgroundColor:"var(--color-secondary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-secondary)",hoverColor:"var(--color-secondary-hover)"};case"accent":return{backgroundColor:"var(--color-accent)",color:"var(--color-text-inverse)",border:"1px solid var(--color-accent)",hoverColor:"var(--color-accent-hover)"};case"ghost":return{backgroundColor:"var(--color-btn-ghost)",color:"var(--color-text)",border:"1px solid transparent",hoverColor:"var(--color-btn-ghost-hover)"};case"outline":return{backgroundColor:"var(--color-btn-outline)",color:"var(--color-text)",border:"1px solid var(--color-btn-outline-border)",hoverColor:"var(--color-btn-outline-hover)"};case"danger":return{backgroundColor:"var(--color-error)",color:"var(--color-text-inverse)",border:"1px solid var(--color-error)",hoverColor:"var(--color-error)"};default:return{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)",hoverColor:"var(--color-primary-hover)"}}})(n),h=g=>{g.currentTarget.style.backgroundColor=u.hoverColor,n==="danger"&&(g.currentTarget.style.opacity="0.9"),o?.(g)},v=g=>{g.currentTarget.style.backgroundColor=u.backgroundColor,g.currentTarget.style.opacity="1",l?.(g)};return e.jsx("button",{className:`${c[t]} font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 ${s?"w-full":""} ${r}`,style:{backgroundColor:u.backgroundColor,color:u.color,border:u.border,boxShadow:n!=="ghost"&&n!=="outline"?"var(--shadow-sm)":"none",focusRingColor:"var(--color-primary)",...i},onMouseEnter:h,onMouseLeave:v,...m,children:a})},Wc=n=>{const[t,s]=p.useState(window.innerWidth>n),r=p.useCallback(()=>{s(window.innerWidth>n)},[n]);return p.useEffect(()=>(r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)),[r]),t},yi=p.memo(({className:n=""})=>{const t=Wc(768),{currentQuote:s,isRotating:r,preferences:a,nextQuote:i,previousQuote:o,toggleRotation:l,toggleFavorite:m}=Uc(),c=a.favoriteQuotes.includes(s.id);return e.jsx("div",{className:n,children:t?e.jsx(ne,{padding:"md",shadow:"sm",className:n,style:{background:"linear-gradient(to right, var(--color-background-secondary), var(--color-card-background))",border:"1px solid var(--color-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 mr-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ba,{className:"w-4 h-4 mt-1 flex-shrink-0",style:{color:"var(--color-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("blockquote",{className:"italic text-sm leading-tight",style:{color:"var(--color-text-secondary)"},children:['"',s.text,'"']}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("cite",{className:"text-xs font-medium not-italic",style:{color:"var(--color-primary)"},children:["— ",s.author]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.isPopular&&e.jsx(ot,{variant:"warning",size:"sm",children:"⭐"}),e.jsx(ot,{variant:"default",size:"sm",className:"capitalize",children:s.category})]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ue,{variant:"ghost",size:"sm",onClick:o,title:"Previous quote",children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsx(ue,{variant:"ghost",size:"sm",onClick:i,title:"Next quote",children:e.jsx(_t,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 mx-1",style:{backgroundColor:"var(--color-border)"}}),e.jsx(ue,{variant:"ghost",size:"sm",onClick:()=>m(s.id),title:c?"Remove from favorites":"Add to favorites",style:{color:c?"var(--color-error)":"var(--color-text-tertiary)",backgroundColor:c?"var(--color-alert-error-bg)":"transparent"},children:e.jsx(xa,{className:`w-4 h-4 ${c?"fill-current":""}`})}),e.jsx(ue,{variant:"ghost",size:"sm",onClick:l,title:r?"Pause rotation":"Start rotation",style:{color:r?"var(--color-success)":"var(--color-text-tertiary)",backgroundColor:r?"var(--color-alert-success-bg)":"transparent"},children:r?e.jsx(ho,{className:"w-4 h-4"}):e.jsx(Jn,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 mx-1",style:{backgroundColor:"var(--color-border)"}}),e.jsx("div",{className:"ml-1",children:e.jsx(ba,{})})]})]})}):e.jsxs(ne,{padding:"sm",shadow:"md",style:{background:"linear-gradient(135deg, var(--color-card-background), var(--color-background-secondary))",backdropFilter:"blur(10px)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--color-text)"},children:[e.jsx(Ba,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),"Daily Inspiration"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{variant:"ghost",size:"sm",onClick:()=>m(s.id),"aria-label":c?"Remove from favorites":"Add to favorites",style:{color:c?"var(--color-error)":"var(--color-text-tertiary)",backgroundColor:c?"var(--color-alert-error-bg)":"transparent",padding:"4px"},children:e.jsx(xa,{className:`w-3.5 h-3.5 ${c?"fill-current":""}`})}),e.jsx("div",{className:"scale-75",children:e.jsx(ba,{})})]})]}),e.jsxs("blockquote",{className:"mb-1.5 italic text-sm leading-tight",style:{color:"var(--color-text-secondary)"},children:['"',s.text,'"']}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{variant:"ghost",size:"sm",onClick:o,"aria-label":"Previous quote",style:{padding:"4px"},children:e.jsx(bs,{className:"w-3.5 h-3.5"})}),e.jsx(ue,{variant:"ghost",size:"sm",onClick:i,"aria-label":"Next quote",style:{padding:"4px"},children:e.jsx(_t,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("cite",{className:"text-xs font-medium not-italic",style:{color:"var(--color-primary)"},children:["— ",s.author]}),e.jsx(ot,{variant:"primary",size:"sm",className:"capitalize text-xs",children:s.category})]})]})]})})});yi.displayName="QuotesSection";const Hc=()=>{const{user:n}=De(),{canManageHR:t}=Vt(),[s,r]=p.useState({absenceReports:{unread:0,total:0},hrMeetings:{unread:0,total:0},correctiveCounselling:{unread:0,total:0}}),[a,i]=p.useState(!0),[o,l]=p.useState(null),[m,c]=p.useState(null),x=p.useRef([]),u=p.useRef(!0),h=p.useRef(!1),v=p.useCallback(async()=>{!n?.organizationId||!t()||(d.debug("🔄 Manual refresh of HR counts triggered"),l(null),c(new Date))},[n?.organizationId,t]);return p.useEffect(()=>{if(!h.current){if(u.current=!0,!t()||!n?.organizationId){i(!1),h.current=!0;return}d.debug("🚀 Initializing real-time HR data listeners"),i(!0),l(null),x.current.forEach(g=>{try{g()}catch(b){d.warn("⚠️ Error unsubscribing:",b)}}),x.current=[];try{d.debug("🔔 Setting up absence reports listener");const g=X(se(B,`organizations/${n.organizationId}/reports`),le("absenceDate","desc")),b=Qs(g,D=>{if(!u.current)return;const S=D.docs.filter(A=>A.id!=="_metadata").map(A=>({id:A.id,...A.data()})),y=S.filter(A=>!A.hrReviewed).length;r(A=>({...A,absenceReports:{unread:y,total:S.length}})),c(new Date),d.debug(`🔔 Absence reports updated: ${y} unread of ${S.length} total`)},D=>{d.error("❌ Absence reports listener error:",D),u.current&&l("Failed to load absence reports")});x.current.push(b),d.debug("🔔 Setting up HR meetings listener");const f=X(se(B,`organizations/${n.organizationId}/meetings`),le("createdAt","desc")),j=Qs(f,D=>{if(!u.current)return;const S=D.docs.filter(A=>A.id!=="_metadata").map(A=>({id:A.id,...A.data()})),y=S.filter(A=>A.status==="pending").length;r(A=>({...A,hrMeetings:{unread:y,total:S.length}})),c(new Date),d.debug(`🔔 HR meetings updated: ${y} pending of ${S.length} total`)},D=>{d.error("❌ HR meetings listener error:",D),u.current&&l("Failed to load HR meetings")});x.current.push(j),d.debug("🔔 Setting up corrective counselling listener");const w=X(se(B,`organizations/${n.organizationId}/corrective_counselling`),le("dateCreated","desc")),C=Qs(w,D=>{if(!u.current)return;const S=D.docs.filter(A=>A.id!=="_metadata").map(A=>({id:A.id,...A.data()})),y=S.filter(A=>{const R=new Date(A.dateCreated),_=new Date(Date.now()-10080*60*1e3);return R>_&&!A.hrReviewed}).length;r(A=>({...A,correctiveCounselling:{unread:y,total:S.length}})),c(new Date),d.debug(`🔔 Corrective counselling updated: ${y} recent of ${S.length} total`)},D=>{d.error("❌ Corrective counselling listener error:",D),u.current&&l("Failed to load counselling records")});x.current.push(C),setTimeout(()=>{u.current&&i(!1)},1e3)}catch(g){d.error("❌ Error setting up listeners:",g),l("Failed to initialize real-time data"),i(!1)}return h.current=!0,()=>{d.debug("🧹 Cleaning up HR data listeners"),u.current=!1,x.current.forEach(g=>{try{g()}catch(b){d.warn("⚠️ Error during cleanup:",b)}}),x.current=[],h.current=!1}}},[]),p.useEffect(()=>{(!t()||!n?.organizationId)&&(r({absenceReports:{unread:0,total:0},hrMeetings:{unread:0,total:0}}),i(!1),l(null),c(null),h.current=!1)},[t(),n?.organizationId]),{hrReportsCount:s,hrCountsLoading:a,hrCountsError:o,refreshHRCounts:v,lastUpdated:m}},Yr=({role:n,skipData:t=[]}={})=>{const{user:s}=De(),{organization:r,categories:a,loading:i}=We(),[o,l]=p.useState({organization:null,categories:[],user:null,employees:[],followUps:[],permissions:{},warnings:[],reports:[],teams:[],metrics:{},loading:{overall:!0,employees:!1,followUps:!1,permissions:!1,warnings:!1,reports:!1,teams:!1,metrics:!1},error:null}),m=p.useRef(!1),c=p.useRef(null),x=p.useCallback(v=>{const g={core:["organization","categories","permissions"],hod:["employees","followUps"],hr:["employees","followUps","warnings","reports","metrics"],business_owner:["employees","teams","reports","metrics"],super_admin:["employees","warnings","reports","metrics","teams"]};return[...g.core,...g[v]||[]].filter(b=>!t.includes(b))},[t]),u=p.useCallback(async()=>{if(!r?.id||!s?.id||i||m.current)return;const v=`${r.id}-${s.id}-${n||s.role}`;if(c.current!==v){m.current=!0;try{const g=n||s.role||"hod",b=x(g);d.debug(`🚀 [DashboardData] Progressive loading for role: ${g}`,b),l(w=>({...w,organization:r,categories:a||[],user:s,loading:{...w.loading,overall:!1,employees:b.includes("employees"),followUps:b.includes("followUps"),permissions:b.includes("permissions"),warnings:b.includes("warnings"),reports:b.includes("reports"),teams:b.includes("teams"),metrics:b.includes("metrics")},error:null}));const f=Date.now(),j=(w,C)=>{l(D=>({...D,[w]:C,loading:{...D.loading,[w]:!1}}))};b.includes("permissions")&&Ie.getOrFetch(`permissions:${s.id}:${r.id}`,()=>Promise.resolve({})).then(w=>j("permissions",w||{})).catch(w=>{d.error("❌ Failed to load permissions:",w),j("permissions",{})}),b.includes("employees")&&Ie.getOrFetch(Ie.generateOrgKey(r.id,`employees:manager:${s.id}`),async()=>(await Ce.employees.getByManager(s.id,r.id)).map(C=>({id:C.id,firstName:C.profile?.firstName||C.firstName||"Unknown",lastName:C.profile?.lastName||C.lastName||"Employee",position:C.profile?.position||C.employment?.position||"Unknown Position",department:C.profile?.department||C.employment?.department||"Unknown",email:C.profile?.email||C.contact?.email||C.email||"",phone:C.profile?.phone||C.contact?.phone||C.phone||"",deliveryPreference:C.deliveryPreference||"email",recentWarnings:C.recentWarnings||{count:0},riskIndicators:C.riskIndicators||{highRisk:!1,reasons:[]}}))).then(w=>j("employees",Array.isArray(w)?w:[])).catch(w=>{d.error("❌ Failed to load employees:",w),j("employees",[])}),b.includes("followUps")&&Ie.getOrFetch(`followups:${s.id}:${r.id}`,()=>Promise.resolve([])).then(w=>j("followUps",Array.isArray(w)?w:[])).catch(w=>{d.error("❌ Failed to load followUps:",w),j("followUps",[])}),b.includes("warnings")&&Ie.getOrFetch(Ie.generateOrgKey(r.id,"warnings"),()=>Ce.warnings.getAll(r.id)).then(w=>j("warnings",Array.isArray(w)?w:[])).catch(w=>{d.error("❌ Failed to load warnings:",w),j("warnings",[])}),b.includes("reports")&&Ie.getOrFetch(Ie.generateOrgKey(r.id,"reports"),()=>Ce.reports.getAll(r.id)).then(w=>j("reports",Array.isArray(w)?w:[])).catch(w=>{d.error("❌ Failed to load reports:",w),j("reports",[])}),b.includes("teams")&&Ie.getOrFetch(Ie.generateOrgKey(r.id,"teams"),()=>je.getAllEmployees(r.id)).then(w=>j("teams",Array.isArray(w)?w:[])).catch(w=>{d.error("❌ Failed to load teams:",w),j("teams",[])}),b.includes("metrics")&&Ie.getOrFetch(Ie.generateOrgKey(r.id,"metrics"),()=>Ce.analytics.getDashboardMetrics(r.id)).then(w=>j("metrics",w||{})).catch(w=>{d.error("❌ Failed to load metrics:",w),j("metrics",{})}),c.current=v,d.debug(`✅ [DashboardData] Progressive loading initiated for role: ${g} (${Date.now()-f}ms)`)}catch(g){d.error("❌ [DashboardData] Failed to initialize progressive loading:",g),l(b=>({...b,loading:{overall:!1,employees:!1,followUps:!1,permissions:!1,warnings:!1,reports:!1,teams:!1,metrics:!1},error:g instanceof Error?g.message:"Failed to load dashboard data"}))}finally{m.current=!1}}},[r,s,a,i,n,x]),h=p.useCallback(()=>{c.current=null,Ie.clearByPrefix(`org:${r?.id}:`),u()},[r?.id,u]);return p.useEffect(()=>{r?.id&&s?.id&&!i&&a!==null&&u()},[r?.id,s?.id,i,a,u]),{...o,refreshData:h,isReady:!o.loading.overall&&!!r&&!!s}},Bs=({isOpen:n,onClose:t,title:s,subtitle:r,showBackButton:a=!1,onBack:i,currentStep:o,totalSteps:l,stepTitles:m,showStepProgress:c=!1,size:x="lg",className:u="",primaryAction:h,secondaryAction:v,customFooter:g,children:b})=>{const{organization:f}=We();if(p.useEffect(()=>(n?(document.body.style.overflow="hidden",document.body.classList.add("modal-open")):(document.body.style.overflow="",document.body.classList.remove("modal-open")),()=>{document.body.style.overflow="",document.body.classList.remove("modal-open")}),[n]),!n)return null;const j=()=>!c||!l||!o?null:e.jsxs("div",{className:"modal-header__center",children:[e.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:e.jsx("div",{className:"mobile-step-indicator",children:e.jsx("div",{className:"mobile-step-dots",children:Array.from({length:l},(w,C)=>{const D=C+1,S=D===o,y=D<o;return e.jsx("div",{className:`mobile-step-dot ${S?"mobile-step-dot--active":y?"mobile-step-dot--completed":"mobile-step-dot--inactive"}`,children:y?"✓":D},C)})})})}),e.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Array.from({length:l},(w,C)=>{const D=C+1,S=D===o,y=D<o;return e.jsx("div",{className:"step-container",children:e.jsx("div",{className:`modal-header__step ${S?"modal-header__step--active":y?"modal-header__step--completed":"modal-header__step--inactive"}`,children:y?"✓":D})},C)})})]});return e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"modal-header__left",children:[a&&i&&e.jsx("button",{onClick:i,className:"modal-header__close-button",children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:s}),r&&e.jsx("p",{className:"modal-header__subtitle",children:r})]})]}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx(j,{}),c&&m&&o&&m[o-1]&&e.jsx("div",{className:"sm:hidden text-center",children:e.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:m[o-1]})}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:b})}),(h||v||g)&&e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"modal-footer__nav",children:g||e.jsxs(e.Fragment,{children:[v&&e.jsx("button",{onClick:v.onClick,className:"modal-footer__button modal-footer__button--secondary",children:v.label}),h&&e.jsx("button",{onClick:h.onClick,disabled:h.disabled,className:`modal-footer__button modal-footer__button--primary ${h.loading?"modal-footer__button--loading":""}`,children:h.label})]})})})]})})},vi=({isOpen:n,onClose:t,organizationId:s,inline:r=!1})=>{const{organization:a}=We(),i=s||a?.id,[o,l]=p.useState([]),[m,c]=p.useState(null),[x,u]=p.useState(!0),[h,v]=p.useState(null),[g,b]=p.useState(!1),[f,j]=p.useState(null),[w,C]=p.useState({name:"",description:"",managerId:""}),[D,S]=p.useState(!1);p.useEffect(()=>{if(!i||!n&&!r)return;(async()=>{try{u(!0),v(null);const[N,I]=await Promise.all([Ht.getDepartments(i),Ht.getDepartmentStats(i)]);l(N),c(I)}catch(N){d.error("Failed to load departments",{error:N}),v("Failed to load departments. Please try again.")}finally{u(!1)}})()},[i,n,r]),p.useEffect(()=>!i||!n&&!r?void 0:Ht.subscribeToDepartments(i,N=>{l(N)}),[i,n,r]);const y=()=>{j(null),C({name:"",description:"",managerId:""}),b(!0)},A=E=>{j(E),C({name:E.name,description:E.description||"",managerId:E.managerId||""}),b(!0)},R=async E=>{if(i){if(E.isDefault){alert("Cannot delete default departments (Operations, Admin)");return}if(confirm(`Are you sure you want to delete "${E.name}"? This action cannot be undone.`))try{await Ht.deleteDepartment(i,E.id),l(N=>N.filter(I=>I.id!==E.id)),d.success("Department deleted successfully")}catch(N){d.error("Failed to delete department",{error:N}),alert("Failed to delete department. Please try again.")}}},_=async E=>{if(E.preventDefault(),!!i)try{if(S(!0),f)await Ht.updateDepartment(i,f.id,w),l(N=>N.map(I=>I.id===f.id?{...I,...w,updatedAt:new Date}:I));else{const N=await Ht.createDepartment(i,w);l(I=>[...I,N])}b(!1),C({name:"",description:"",managerId:""}),d.success(f?"Department updated successfully":"Department created successfully")}catch(N){d.error("Failed to save department",{error:N}),alert("Failed to save department. Please try again.")}finally{S(!1)}},F=()=>{b(!1),j(null),C({name:"",description:"",managerId:""})};if(!r&&!n)return null;const k=e.jsxs(e.Fragment,{children:[m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(ne,{padding:"md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"w-8 h-8",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:m.totalDepartments}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Departments"})]})]})}),e.jsx(ne,{padding:"md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ft,{className:"w-8 h-8",style:{color:"var(--color-success)"}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:m.departmentsWithManagers}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"With Managers"})]})]})}),e.jsx(ne,{padding:"md",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-8 h-8",style:{color:"var(--color-info)"}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:m.totalEmployeesAcrossDepartments}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Employees"})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Departments"}),e.jsxs(ue,{variant:"primary",onClick:y,children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Add Department"]})]}),x&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(et,{className:"w-6 h-6 animate-spin",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"ml-2",style:{color:"var(--color-text-secondary)"},children:"Loading departments..."})]}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-red-600"}),e.jsx("span",{className:"text-red-800",children:h})]})}),!x&&!h&&e.jsxs("div",{className:"space-y-4",children:[o.map(E=>e.jsx(ne,{padding:"md",className:"hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:E.name}),E.isDefault&&e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Default"})]}),E.description&&e.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text-secondary)"},children:E.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",style:{color:"var(--color-text-tertiary)"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsxs("span",{children:[E.employeeCount," employees"]})]}),E.managerName?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ft,{className:"w-4 h-4"}),e.jsxs("span",{children:["Manager: ",E.managerName]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-orange-600",children:"No manager assigned"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>A(E),className:"p-2 text-gray-400 hover:text-blue-600 rounded-lg hover:bg-blue-50",title:"Edit department",children:e.jsx(Ir,{className:"w-4 h-4"})}),!E.isDefault&&e.jsx("button",{onClick:()=>R(E),className:"p-2 text-gray-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:"Delete department",children:e.jsx(Os,{className:"w-4 h-4"})})]})]})},E.id)),o.length===0&&!x&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Je,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text)"},children:"No departments found"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"Create your first department to get started with organizational structure."}),e.jsxs(ue,{variant:"primary",onClick:y,children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),"Create Department"]})]})]}),g&&e.jsx(Bs,{isOpen:g,onClose:F,title:f?"Edit Department":"Create Department",subtitle:f?"Update department information":"Add a new department to your organization",size:"md",children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Department Name *"}),e.jsx("input",{type:"text",value:w.name,onChange:E=>C(N=>({...N,name:E.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},placeholder:"e.g., Operations, Admin, Sales",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Description"}),e.jsx("textarea",{value:w.description,onChange:E=>C(N=>({...N,description:E.target.value})),rows:3,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},placeholder:"Brief description of the department's role and responsibilities"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(ue,{type:"button",variant:"outline",onClick:F,disabled:D,children:"Cancel"}),e.jsx(ue,{type:"submit",variant:"primary",disabled:D||!w.name.trim(),children:D?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),f?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Hr,{className:"w-4 h-4 mr-2"}),f?"Update Department":"Create Department"]})})]})]})})]});return r?e.jsx("div",{className:"space-y-4",children:k}):Gn.createPortal(e.jsx(Bs,{isOpen:n,onClose:t,title:"Department Management",subtitle:"Manage organizational departments and assignments",size:"lg",children:k}),document.body)};class In{static async generateWarningPDF(t){try{const s=Et||{isLegacyDevice:!1},r=Na(s);if(s.isLegacyDevice)return console.warn("🚨 Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(t);d.debug(2688),console.log("📊 Input data validation:",{hasEmployee:!!t.employee,hasOrganization:!!t.organization,hasIncidentData:!!(t.description||t.incidentLocation),employeeName:t.employee?`${t.employee.firstName} ${t.employee.lastName}`:"Missing",organizationName:t.organization?.name||"Missing",warningLevel:t.warningLevel,category:t.category});const a=Date.now();d.debug(3310);const{default:i}=await nt(async()=>{const{default:g}=await import("./pdf-vendor-Bp5yZ91a.js").then(b=>b.j);return{default:g}},[]);d.debug(3436);const o=new i({orientation:"portrait",unit:"mm",format:"a4",compress:!0});d.success(3579),o.setFont("helvetica","normal");let l=15;const m=o.internal.pageSize.width,c=o.internal.pageSize.height,x=20,u=40;d.debug(3950),d.debug("🏢 Adding organization header..."),l=this.addOrganizationHeader(o,t.organization,l,m,x),d.success(4172),d.debug("📝 Adding document title..."),l=this.addDocumentTitle(o,t,l,m,x,c,u),d.success(4459),d.debug("👤 Adding employee section..."),l=this.addEmployeeSection(o,t.employee,l,m,x,c,u),d.success(4759),d.debug("⚠️ Adding warning details section..."),l=this.addWarningDetailsSection(o,t,l,m,x,c,u),d.success(5060),d.debug("📋 Adding incident details section..."),l=this.addIncidentDetailsSection(o,t,l,m,x,c,u),d.success(5387),t.disciplineRecommendation?(d.debug("📈 Adding progressive discipline section..."),l=this.addProgressiveDisciplineSection(o,t.disciplineRecommendation,l,m,x,c,u),d.success(5796)):d.debug("⏭️ Skipping progressive discipline section (no data)"),t.legalCompliance?(d.debug("⚖️ Adding legal compliance section..."),l=this.addLegalComplianceSection(o,t.legalCompliance,l,m,x,c,u),d.success(6262)):d.debug("⏭️ Skipping legal compliance section (no data)"),t.additionalNotes?(d.debug("📝 Adding additional notes section..."),l=this.addAdditionalNotesSection(o,t.additionalNotes,l,m,x,c,u),d.success(6716)):d.debug("⏭️ Skipping additional notes section (no data)"),d.debug("✍️ Adding signatures section..."),l=this.addSignaturesSection(o,t.signatures,t.employee,l,m,x,c,u),d.success(7166),t.deliveryChoice?(d.debug("📮 Adding delivery section..."),l=this.addDeliverySection(o,t.deliveryChoice,l,m,x,c,u),d.success(7512)):d.debug("⏭️ Skipping delivery section (no data)"),d.debug("🦶 Adding document footer..."),this.addDocumentFooter(o,t,m),d.success(7804),d.debug("🛡️ Adding security watermark..."),this.addSecurityWatermark(o,m),d.success(7997),d.debug("🔄 Generating PDF blob...");const h=o.output("blob"),v=Date.now();return console.log("✅ Resilient PDF generated successfully:",{warningId:t.warningId,employee:`${t.employee.firstName} ${t.employee.lastName}`,size:`${(h.size/1024).toFixed(1)} KB`,time:`${v-a}ms`}),h}catch(s){throw d.error("❌ PDF generation failed:",s),new Error(`PDF generation failed: ${s instanceof Error?s.message:"Unknown error"}`)}}static addOrganizationHeader(t,s,r,a,i){const o=this.parseColor(s.branding?.colors?.primary)||{r:59,g:130,b:246};t.setFillColor(o.r,o.g,o.b),t.rect(0,0,a,35,"F");let l=0;if(s.branding?.logo)try{l=30,t.addImage(s.branding.logo,"PNG",i,7,l,20),d.debug("Added organization logo to PDF header")}catch(x){d.warn("Failed to add organization logo to PDF:",x),l=0}t.setTextColor(255,255,255),t.setFontSize(20),t.setFont("helvetica","bold");const m=s.branding?.companyName||s.name||"Organization Name";t.text(m,i+l+(l>0?10:0),15),t.setFontSize(10),t.setFont("helvetica","normal");const c=[];return s.address&&c.push(s.address),s.phone&&c.push(`Tel: ${s.phone}`),s.email&&c.push(`Email: ${s.email}`),c.length>0&&t.text(c.join(" | "),i,25),s.registrationNumber&&t.text(`Registration: ${s.registrationNumber}`,i,30),45}static addDocumentTitle(t,s,r,a,i,o,l){r=this.checkPageOverflow(t,r,30,o,l),t.setTextColor(0,0,0),t.setFontSize(18),t.setFont("helvetica","bold");const m=this.getWarningLevelTitle(s.warningLevel),c=t.getTextWidth(m),x=(a-c)/2;if(t.text(m,x,r),s.employee?.firstName==="Employee"||s.category==="Category Not Selected"||!s.description?.trim()){t.setFontSize(12),t.setTextColor(200,50,50);const b="[DRAFT - INCOMPLETE DATA]",f=t.getTextWidth(b),j=(a-f)/2;t.text(b,j,r+6),r+=6}t.setTextColor(0,0,0),t.setLineWidth(.5),t.line(x,r+2,x+c,r+2),t.setFontSize(10),t.setFont("helvetica","normal");const h=`Document ID: ${s.warningId} | Issue Date: ${this.formatDate(s.issuedDate)}`,v=t.getTextWidth(h),g=(a-v)/2;return t.text(h,g,r+8),r+20}static addEmployeeSection(t,s,r,a,i,o,l){r=this.checkPageOverflow(t,r,40,o,l),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("EMPLOYEE INFORMATION",i,r);const m=s.firstName==="Employee"||s.lastName==="Not Selected";m?t.setDrawColor(255,200,200):t.setDrawColor(200,200,200),t.setLineWidth(.3),t.rect(i,r+2,a-i*2,25),m&&(t.setFillColor(255,245,245),t.rect(i+1,r+3,a-i*2-2,23,"F")),t.setFontSize(10),t.setFont("helvetica","normal"),m?t.setTextColor(150,0,0):t.setTextColor(0,0,0);const c=[`Name: ${s.firstName} ${s.lastName}`,`Employee ID: ${s.employeeNumber}`,`Position: ${s.position}`,`Department: ${s.department}`];s.email&&s.email!==""&&c.push(`Email: ${s.email}`),m&&c.push("⚠️ Complete employee selection in wizard for full details");let x=r+8;return c.forEach(u=>{t.text(u,i+3,x),x+=4}),r+35}static addWarningDetailsSection(t,s,r,a,i,o,l){r=this.checkPageOverflow(t,r,25,o,l),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("WARNING DETAILS",i,r);const m=s.category==="Category Not Selected";t.setFontSize(10),t.setFont("helvetica","normal"),m?t.setTextColor(150,0,0):t.setTextColor(0,0,0);let c=r+8;t.text(`Warning Level: ${this.getWarningLevelDisplay(s.warningLevel)}`,i,c),c+=5;const x=s.category&&s.category!=="Unknown"&&s.category!=="Category Not Selected"?s.category:"General Misconduct";return t.text(`Category: ${x}`,i,c),c+=5,s.validityPeriod&&(t.text(`Validity Period: ${s.validityPeriod} months`,i,c),c+=5),c+5}static addIncidentDetailsSection(t,s,r,a,i,o,l){const m=this.calculateIncidentSectionHeight(t,s,a,i);r=this.checkPageOverflow(t,r,m,o,l),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("INCIDENT DETAILS",i,r);const c=s.description&&s.description.trim()!=="",x=s.incidentLocation&&s.incidentLocation.trim()!=="",u=!c&&!x,h=this.calculateIncidentSectionHeight(t,s,a,i);u?t.setDrawColor(255,200,200):t.setDrawColor(200,200,200),t.setLineWidth(.3),t.rect(i,r+2,a-i*2,h),u&&(t.setFillColor(255,245,245),t.rect(i+1,r+3,a-i*2-2,h-2,"F")),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);let v=r+10;t.setFont("helvetica","bold"),t.text("Date & Time:",i+3,v),t.setFont("helvetica","normal"),t.text(`${this.formatDate(s.incidentDate)} at ${s.incidentTime}`,i+30,v),v+=6,t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Location:",i+3,v),t.setFont("helvetica","normal");const g=x?s.incidentLocation:"Not specified";t.text(g,i+25,v),v+=6,t.setFont("helvetica","bold"),t.text("Description:",i+3,v),v+=5,t.setFont("helvetica","normal");const b=c?s.description:"Details to be completed";return this.wrapText(t,b,a-i*2-6).forEach(j=>{t.text(j,i+3,v),v+=4}),r+h+10}static addProgressiveDisciplineSection(t,s,r,a,i,o,l){if(!s)return r;r=this.checkPageOverflow(t,r,35,o,l),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("PROGRESSIVE DISCIPLINE ANALYSIS",i,r),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);let m=r+8;return t.text(`Recommended Level: ${this.getWarningLevelDisplay(s.suggestedLevel)}`,i,m),m+=5,t.text(`Previous Warnings: ${s.warningCount}`,i,m),m+=5,s.reason&&(t.text("Escalation Reason:",i,m),m+=4,this.wrapText(t,s.reason,a-i*2).forEach(x=>{t.text(x,i+3,m),m+=4})),m+5}static addLegalComplianceSection(t,s,r,a,i,o,l){if(!s)return r;r=this.checkPageOverflow(t,r,30,o,l),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("LEGAL COMPLIANCE",i,r),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);let m=r+8;return t.text(`Framework: ${s.framework}`,i,m),m+=5,t.text(`Compliance Status: ${s.isCompliant?"COMPLIANT":"NON-COMPLIANT"}`,i,m),m+=5,s.requirements.length>0&&(t.text("Legal Requirements:",i,m),m+=4,s.requirements.forEach(c=>{t.text(`• ${c}`,i+3,m),m+=4})),m+5}static addAdditionalNotesSection(t,s,r,a,i,o,l){const m=this.wrapText(t,s,a-i*2),c=15+m.length*4;r=this.checkPageOverflow(t,r,c,o,l),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("ADDITIONAL NOTES",i,r),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);let x=r+8;return m.forEach(u=>{t.text(u,i,x),x+=4}),x+5}static addSignaturesSection(t,s,r,a,i,o,l,m){a=this.checkPageOverflow(t,a,50,l,m),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("SIGNATURES",o,a);const c=(i-o*3)/2,x=30;if(t.setDrawColor(150,150,150),t.setLineWidth(.3),t.rect(o,a+5,c,x),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("Manager Signature:",o+2,a+12),s?.manager)try{const u=c-4;t.addImage(s.manager,"PNG",o+2,a+15,u,15),t.setFontSize(8),t.text(`Date: ${this.formatDate(new Date)}`,o+2,a+32)}catch(u){d.warn("Failed to embed manager signature image:",u),t.setFontSize(8),t.text("✓ Digitally Signed",o+2,a+20),t.text(`Date: ${this.formatDate(new Date)}`,o+2,a+25)}else t.text("_________________________",o+2,a+25),t.text("Date: ___________",o+2,a+30);if(t.rect(o+c+10,a+5,c,x),t.text("Employee Signature:",o+c+12,a+12),t.text(`${r.firstName} ${r.lastName}`,o+c+12,a+16),s?.employee)try{const u=c-4;t.addImage(s.employee,"PNG",o+c+12,a+15,u,15),t.setFontSize(8),t.text(`Date: ${this.formatDate(new Date)}`,o+c+12,a+32)}catch(u){d.warn("Failed to embed employee signature image:",u),t.setFontSize(8),t.text("✓ Digitally Signed",o+c+12,a+20),t.text(`Date: ${this.formatDate(new Date)}`,o+c+12,a+25)}else t.text("_________________________",o+c+12,a+25),t.text("Date: ___________",o+c+12,a+30);return a+x+15}static addDeliverySection(t,s,r,a,i,o,l){if(!s)return r;r=this.checkPageOverflow(t,r,20,o,l),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("DELIVERY INFORMATION",i,r),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);let m=r+6;return t.text(`Delivery Method: ${s.method.toUpperCase()}`,i,m),m+=4,t.text(`Delivery Date: ${this.formatDate(s.timestamp)}`,i,m),m+=4,t.text(`Authorized by: ${s.chosenBy}`,i,m),m+8}static addDocumentFooter(t,s,r){const a=t.internal.pageSize.height,i=t.getNumberOfPages();for(let o=1;o<=i;o++){t.setPage(o),t.setDrawColor(180,180,180),t.setLineWidth(.3),t.line(20,a-25,r-20,a-25),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(120,120,120);const l="This document has been generated electronically and constitutes an official warning as per LRA Section 188.",m=t.getTextWidth(l),c=(r-m)/2;t.text(l,c,a-20);const x="CONFIDENTIAL DOCUMENT - For authorized personnel only",u=t.getTextWidth(x),h=(r-u)/2;t.text(x,h,a-15),t.text(`Generated: ${new Date().toLocaleString()}`,20,a-10),t.text(`Page ${o} of ${i}`,r-50,a-10)}}static addSecurityWatermark(t,s){const r=t.internal.pageSize.height,a=t.getNumberOfPages();for(let i=1;i<=a;i++){t.setPage(i),t.saveGraphicsState(),t.setGState(new t.GState({opacity:.1})),t.setTextColor(150,150,150),t.setFontSize(40),t.setFont("helvetica","bold");const o=s/2,l=r/2;t.text("OFFICIAL WARNING",o,l,{angle:45,align:"center"}),t.restoreGraphicsState()}}static checkPageOverflow(t,s,r,a,i){const o=a-i;return s+r>o?(d.debug(29714),t.addPage(),20):s}static addPageHeader(t,s,r){const a=t.internal.pageSize.width;t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(100,100,100);const i=`${s.organization.name} - Warning Document (Continued)`;t.text(i,20,10);const o=`Page ${r}`;t.text(o,a-40,10),t.setDrawColor(200,200,200),t.setLineWidth(.3),t.line(20,12,a-20,12)}static getWarningLevelDisplay(t){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"}[t]||t.replace("_"," ").toUpperCase()}static getWarningLevelTitle(t){return{counselling:"COUNSELLING SESSION RECORD",verbal:"VERBAL WARNING NOTICE",first_written:"FIRST WRITTEN WARNING",second_written:"SECOND WRITTEN WARNING",final_written:"FINAL WRITTEN WARNING",suspension:"SUSPENSION NOTICE",dismissal:"DISMISSAL NOTICE"}[t]||"WARNING NOTICE"}static formatDate(t){return t.toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})}static wrapText(t,s,r){const a=s.split(" "),i=[];let o="";return a.forEach(l=>{const m=o+(o?" ":"")+l;t.getTextWidth(m)<=r?o=m:(o&&i.push(o),o=l)}),o&&i.push(o),i}static calculateIncidentSectionHeight(t,s,r,a){let i=25;const o=s.description&&s.description.trim()!==""?s.description:"[Incident description not provided - complete in wizard]",l=this.wrapText(t,o,r-a*2-6);i+=l.length*4;const m=s.description&&s.description.trim()!=="",c=s.incidentLocation&&s.incidentLocation.trim()!=="";return!m&&!c&&(i+=10),Math.max(i,45)}static parseColor(t){if(!t)return null;if(t.startsWith("#")){const s=t.substring(1);if(s.length===6)return{r:parseInt(s.substring(0,2),16),g:parseInt(s.substring(2,4),16),b:parseInt(s.substring(4,6),16)}}return null}static async generateSimplifiedPDF(t){try{console.log("🚨 Generating simplified PDF for legacy device...");const{default:s}=await nt(async()=>{const{default:v}=await import("./pdf-vendor-Bp5yZ91a.js").then(g=>g.j);return{default:v}},[]),r=new s({orientation:"portrait",unit:"mm",format:"a4",compress:!0});let a=20;const i=15,o=6;r.setFont("helvetica","normal"),r.setFontSize(16),r.text("DISCIPLINARY WARNING",i,a),a+=o*2,r.setFontSize(12),t.organization?.name&&(r.text(`Organization: ${t.organization.name}`,i,a),a+=o),a+=o,r.setFontSize(11),r.text("EMPLOYEE DETAILS:",i,a),a+=o,r.setFontSize(10),[`Name: ${t.employee.firstName} ${t.employee.lastName}`,`Employee ID: ${t.employee.employeeNumber}`,`Department: ${t.employee.department}`,`Position: ${t.employee.position}`].forEach(v=>{r.text(v,i+5,a),a+=o}),a+=o,r.setFontSize(11),r.text("WARNING DETAILS:",i,a),a+=o,r.setFontSize(10),[`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,`Location: ${t.incidentLocation||"Not specified"}`].forEach(v=>{r.text(v,i+5,a),a+=o}),a+=o,r.setFontSize(11),r.text("INCIDENT DESCRIPTION:",i,a),a+=o,r.setFontSize(10),r.splitTextToSize(t.description,170).forEach(v=>{a>270&&(r.addPage(),a=20),r.text(v,i+5,a),a+=o}),a+=o*2,a>240&&(r.addPage(),a=20),r.setFontSize(11),r.text("SIGNATURES:",i,a),a+=o*2,r.setFontSize(10),r.text("Manager: ________________________",i,a),a+=o,r.text(`Date: ${t.issuedDate.toLocaleDateString()}`,i,a),a+=o*3,r.text("Employee: _______________________ ",i,a),a+=o,r.text("Date: _______________",i,a);const u=r.internal.pageSize.height;r.setFontSize(8),r.text("Generated by HR System - Simplified for mobile device",i,u-10),console.log("✅ Simplified PDF generation completed");const h=r.output("blob");return window.gc&&setTimeout(()=>window.gc(),100),h}catch(s){return console.error("❌ Simplified PDF generation failed:",s),this.generatePlainTextPDF(t)}}static async generatePlainTextPDF(t){try{const{default:s}=await nt(async()=>{const{default:l}=await import("./pdf-vendor-Bp5yZ91a.js").then(m=>m.j);return{default:l}},[]),r=new s;r.setFontSize(12);let a=20;const i=10;return["DISCIPLINARY WARNING","",`Employee: ${t.employee.firstName} ${t.employee.lastName}`,`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,"","Description:",t.description,"","This is a simplified version generated for older devices."].forEach(l=>{a>280&&(r.addPage(),a=20),r.text(l,20,a),a+=i}),r.output("blob")}catch(s){throw console.error("❌ Even plain text PDF failed:",s),new Error("PDF generation not supported on this device")}}}class Pn{static{this.EXPIRY_HOURS=1}static async generateTemporaryLink(t){d.debug("🔧 [TemporaryLinkService] Starting PDF upload using Firebase Storage..."),console.log("🔧 [TemporaryLinkService] Request:",{filename:t.filename,blobSize:t.pdfBlob.size,employeeId:t.employeeId,warningId:t.warningId,organizationId:t.organizationId});try{const s=Nt.currentUser;if(!s)throw d.error("❌ [TemporaryLinkService] User not authenticated"),new Error("User not authenticated");d.success(2228);const r=this.generateTokenId();d.debug("🔧 [TemporaryLinkService] Generated tokenId:",r);const a=Date.now(),i=Math.random().toString(36).substr(2,12),o=t.filename.replace(/[^a-zA-Z0-9.-]/g,"_"),l=`temp-downloads/${t.organizationId||"default"}/${a}_${i}_${o}`;d.debug("🔧 [TemporaryLinkService] Storage path:",l);const m=ca(Or,l),c={contentType:"application/pdf",customMetadata:{organizationId:t.organizationId||"",employeeId:t.employeeId||"",warningId:t.warningId||"",filename:t.filename,tokenId:r,createdAt:new Date().toISOString(),size:t.pdfBlob.size.toString(),uploadedBy:s.uid,purpose:"temporary-download"}};d.debug("☁️ [TemporaryLinkService] Uploading PDF to Firebase Storage..."),await da(m,t.pdfBlob,c);const x=await ma(m);d.debug("📝 [TemporaryLinkService] Tracking temporary file for cleanup...");const u=new Date(Date.now()+this.EXPIRY_HOURS*60*60*1e3);await this.trackTemporaryFile({tokenId:r,storagePath:l,downloadUrl:x,filename:t.filename,organizationId:t.organizationId,employeeId:t.employeeId,warningId:t.warningId,uploadedBy:s.uid,expiresAt:u,createdAt:new Date}),d.success(4558),d.debug(4696);const h=await this.generateQRCode(x),v=new Date(Date.now()+this.EXPIRY_HOURS*60*60*1e3);return console.log("✅ [TemporaryLinkService] Link generation complete:",{tokenId:r,expiresAt:v.toISOString(),downloadUrl:x.substring(0,60)+"..."}),{downloadUrl:x,qrCodeData:h,expiresAt:v.toISOString(),tokenId:r,filename:t.filename}}catch(s){throw d.error("❌ [TemporaryLinkService] Failed to generate temporary link:",s),new Error(`Failed to generate temporary link: ${s instanceof Error?s.message:"Unknown error"}`)}}static async validateTemporaryToken(t){return d.debug("🔧 [TemporaryLinkService] Token validation (Firebase handles this automatically)"),!0}static async revokeTemporaryToken(t){return d.debug("🗑️ [TemporaryLinkService] Token revocation requested for:",t),d.debug("⚠️ Note: With Firebase Storage URLs, revocation requires file deletion from storage"),d.debug("📝 This would be handled by a cleanup job in a production system"),!0}static generateTokenId(){const t=Date.now(),s=Math.random().toString(36).substr(2,12);return`tmp_${t}_${s}`}static async blobToBase64(t){return new Promise((s,r)=>{const a=new FileReader;a.onload=()=>{const i=a.result;s(i.split(",")[1])},a.onerror=r,a.readAsDataURL(t)})}static async generateQRCode(t){try{const s="https://api.qrserver.com/v1/create-qr-code/",r=new URLSearchParams({size:"300x300",data:t,format:"png",ecc:"M",margin:"10"}),a=`${s}?${r.toString()}`,i=await fetch(a);if(!i.ok)throw new Error("QR code generation failed");const o=await i.blob();return new Promise((l,m)=>{const c=new FileReader;c.onload=()=>l(c.result),c.onerror=m,c.readAsDataURL(o)})}catch(s){return d.error("❌ QR Code generation failed:",s),`data:text/plain;base64,${btoa(t)}`}}static formatExpiryTime(t){const s=new Date(t),r=new Date,a=s.getTime()-r.getTime();if(a<=0)return"Expired";const i=Math.floor(a/(1e3*60)),o=Math.floor(i/60),l=i%60;return o>0?`${o}h ${l}m remaining`:`${l}m remaining`}static isExpired(t){return new Date(t).getTime()<=Date.now()}static async trackTemporaryFile(t){try{await vs(se(B,"temporaryFiles"),{tokenId:t.tokenId,storagePath:t.storagePath,downloadUrl:t.downloadUrl,filename:t.filename,fileType:"pdf",organizationId:t.organizationId||"",employeeId:t.employeeId||"",warningId:t.warningId||"",uploadedBy:t.uploadedBy,expiresAt:t.expiresAt,createdAt:re(),isExpired:!1,fileSize:0}),d.success(10578)}catch(s){d.error("❌ [TemporaryLinkService] Failed to track temporary file:",s)}}}const qc=({isOpen:n,onClose:t,pdfBlob:s,filename:r,employeeId:a,warningId:i,organizationId:o,employeeName:l,onLinkGenerated:m})=>{const[c,x]=p.useState(!1),[u,h]=p.useState(null),[v,g]=p.useState(null),[b,f]=p.useState({hours:0,minutes:0,seconds:0,expired:!1}),[j,w]=p.useState(!1),C=p.useCallback(async()=>{if(d.debug("🔧 [QRCodeDownloadModal] generateQRLink called"),d.debug("🔧 [QRCodeDownloadModal] pdfBlob:",s?`${(s.size/1024).toFixed(1)} KB`:"null"),!s){d.error("❌ [QRCodeDownloadModal] No PDF blob provided");return}try{d.debug("🔧 [QRCodeDownloadModal] Starting QR link generation..."),x(!0),g(null);const A=await Pn.generateTemporaryLink({pdfBlob:s,filename:r,employeeId:a,warningId:i,organizationId:o});d.success(2764),h(A),m?.(A)}catch(A){d.error("❌ QR link generation failed:",A),g(A.message||"Failed to generate QR code")}finally{x(!1)}},[s,r,a,i,o,m]);p.useEffect(()=>{if(!u?.expiresAt)return;const A=()=>{const _=new Date().getTime(),k=new Date(u.expiresAt).getTime()-_;if(k<=0){f({hours:0,minutes:0,seconds:0,expired:!0});return}const E=Math.floor(k/(1e3*60*60)),N=Math.floor(k%(1e3*60*60)/(1e3*60)),I=Math.floor(k%(1e3*60)/1e3);f({hours:E,minutes:N,seconds:I,expired:!1})};A();const R=setInterval(A,1e3);return()=>clearInterval(R)},[u?.expiresAt]);const D=p.useCallback(async()=>{if(u?.downloadUrl)try{await navigator.clipboard.writeText(u.downloadUrl),w(!0),setTimeout(()=>w(!1),2e3)}catch(A){d.error("❌ Failed to copy link:",A)}},[u?.downloadUrl]),S=p.useCallback(async()=>{if(u?.tokenId)try{await Pn.revokeTemporaryToken(u.tokenId),h(null),f({hours:0,minutes:0,seconds:0,expired:!1})}catch(A){d.error("❌ Failed to revoke link:",A)}},[u?.tokenId]),y=p.useCallback(()=>{u?.downloadUrl&&window.open(u.downloadUrl,"_blank")},[u?.downloadUrl]);return p.useEffect(()=>{n&&s&&!u&&!c&&C()},[n,s,u,c,C]),p.useEffect(()=>{n||(h(null),g(null),f({hours:0,minutes:0,seconds:0,expired:!1}),w(!1))},[n]),n?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-lg",children:e.jsx(ha,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Mobile Download"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Scan to download on your phone"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-120px)] overflow-y-auto",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(zs,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 truncate",children:r}),l&&e.jsxs("p",{className:"text-sm text-gray-600",children:["For: ",l]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Size: ",(s.size/1024).toFixed(1)," KB"]})]})]})}),c&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Generating secure download link..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a moment"})]}),v&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"w-5 h-5 text-red-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-red-800 font-medium",children:"Generation Failed"}),e.jsx("p",{className:"text-red-700 text-sm",children:v})]})]}),e.jsxs("button",{onClick:C,className:"mt-3 flex items-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm",disabled:c,children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:"Try Again"})]})]}),u&&!b.expired&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(go,{className:"w-5 h-5 text-amber-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-amber-800 font-medium",children:"Time-Limited Access"}),e.jsxs("p",{className:"text-amber-700 text-sm",children:["Link expires in: ",b.hours>0&&`${b.hours}h `,b.minutes,"m ",b.seconds,"s"]})]})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-white p-6 rounded-xl border-2 border-gray-200 inline-block",children:e.jsx("img",{src:u.qrCodeData,alt:"Download QR Code",className:"w-64 h-64 mx-auto",style:{imageRendering:"pixelated"}})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-gray-600 mb-2",children:[e.jsx(po,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Point your camera at the QR code"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"No app needed - works with built-in camera on iOS & Android"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:D,className:"w-full flex items-center justify-center space-x-3 bg-gray-100 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors",children:j?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{children:"Link Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Tr,{className:"w-5 h-5"}),e.jsx("span",{children:"Copy Download Link"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:y,className:"flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Test Link"})]}),e.jsxs("button",{onClick:S,className:"flex items-center justify-center space-x-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm",children:[e.jsx(Os,{className:"w-4 h-4"}),e.jsx("span",{children:"Revoke"})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-blue-800 font-medium text-sm",children:"Security Features"}),e.jsxs("ul",{className:"text-blue-700 text-xs mt-1 space-y-1",children:[e.jsx("li",{children:"• Link expires automatically in 1 hour"}),e.jsx("li",{children:"• Single-use download link"}),e.jsx("li",{children:"• Encrypted token authentication"}),e.jsx("li",{children:"• Can be revoked instantly"})]})]})]})})]}),u&&b.expired&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full w-16 h-16 mx-auto mb-4",children:e.jsx(Re,{className:"w-8 h-8 text-red-500 mx-auto"})}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Link Expired"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The download link has expired for security reasons."}),e.jsx("button",{onClick:C,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",disabled:c,children:"Generate New Link"})]})]})]})}):null},Zr=({isOpen:n,onClose:t,warningData:s,deliveryChoice:r,onPDFGenerated:a,showPreview:i=!0,title:o="Warning Document Preview"})=>{const{organization:l}=We(),[m,c]=p.useState(null),[x,u]=p.useState(null),[h,v]=p.useState(""),[g,b]=p.useState(!1),[f,j]=p.useState(null),[w,C]=p.useState(""),[D,S]=p.useState(!1),[y,A]=p.useState(null),[R,_]=p.useState(!1),[F,k]=p.useState(""),E=p.useRef(null),N=p.useMemo(()=>{if(!s)return null;const Y=s.wizardState||s,G=Y.selectedEmployee||s.selectedEmployee,P=Y.selectedCategory||s.selectedCategory,L=Y.formData||s.formData||{},U=Y.signatures||s.signatures||{},W=Y.lraRecommendation||s.lraRecommendation,$=G?{id:G.id,firstName:G.firstName||"Unknown",lastName:G.lastName||"Employee",employeeId:G.employeeId||G.id||"N/A",position:G.position||"Unknown Position",department:G.department||"Unknown Department",email:G.email||"",phone:G.phone||""}:{id:L.employeeId||"unknown",firstName:"Employee",lastName:"Not Selected",employeeId:L.employeeId||"N/A",position:"Unknown Position",department:"Unknown Department",email:"",phone:""},H=P?{id:P.id,name:P.name||"General Misconduct",severity:P.severity||"medium",description:P.description||"",lraSection:P.lraSection||"LRA Section 188"}:{id:L.categoryId||"unknown",name:"Category Not Selected",severity:"medium",description:"Category details not available",lraSection:"LRA Section 188"};return{warningId:`WRN_${Date.now()}`,organizationId:Y.organizationId||s.organizationId,employee:$,category:H,isComplete:!!(G&&P),hasEmployee:!!G,hasCategory:!!P,incident:{date:L.incidentDate||new Date().toISOString().split("T")[0],time:L.incidentTime||"09:00",location:L.incidentLocation||"",description:L.incidentDescription||""},additionalNotes:L.additionalNotes||"",validityPeriod:L.validityPeriod||6,signatures:{manager:U.manager,employee:U.employee},recommendation:W,issueDate:new Date,deliveryMethod:r?.method||"email"}},[s,r]),I=p.useMemo(()=>{if(!N)return"Warning_Document.pdf";const Y=`${N.employee.firstName}_${N.employee.lastName}`,G=new Date().toISOString().split("T")[0];return`Warning_${N.category.name.replace(/\s+/g,"_").substring(0,20)}_${Y}_${G}.pdf`},[N]),T=p.useCallback(async()=>{if(!N||!l){j("Missing required data for PDF generation");return}if(!(N.incident.description||N.incident.location||N.additionalNotes)){j("Insufficient incident data. Please complete the form before generating PDF.");return}b(!0),j(null);const G=["Preparing warning document data...","Applying organization branding...","Formatting incident details...","Adding legal compliance sections...","Finalizing PDF document..."];try{for(let W=0;W<G.length;W++)C(G[W]),await new Promise($=>setTimeout($,600));const P={warningId:N.warningId,issuedDate:N.issueDate,employee:{firstName:N.employee.firstName,lastName:N.employee.lastName,employeeNumber:N.employee.employeeId,department:N.employee.department,position:N.employee.position,email:N.employee.email},warningLevel:N.recommendation?.suggestedLevel||"verbal",category:N.category.name,description:N.incident.description,incidentDate:new Date(N.incident.date),incidentTime:N.incident.time,incidentLocation:N.incident.location,organization:l,signatures:N.signatures,additionalNotes:N.additionalNotes,validityPeriod:N.validityPeriod,legalCompliance:{isCompliant:!0,framework:"LRA Section 188",requirements:N.recommendation?.legalRequirements||[]},disciplineRecommendation:N.recommendation?{suggestedLevel:N.recommendation.suggestedLevel,reason:N.recommendation.reason||"Progressive discipline escalation",warningCount:N.recommendation.warningCount||0,activeWarnings:N.recommendation.previousWarnings||[],legalRequirements:N.recommendation.legalRequirements||[]}:void 0,deliveryChoice:r?{method:r.method,timestamp:new Date,chosenBy:"Manager",contactDetails:r.contactDetails}:void 0};d.debug(10791);const L=await In.generateWarningPDF(P);c(L),v(I);const U=URL.createObjectURL(L);u(U),console.log("✅ PDF generated successfully:",{employee:`${N.employee.firstName} ${N.employee.lastName}`,category:N.category.name,filename:I,size:`${(L.size/1024).toFixed(1)} KB`}),a&&await a(L,I)}catch(P){d.error("❌ PDF generation failed:",P),j(`Failed to generate PDF: ${P instanceof Error?P.message:"Unknown error"}`)}finally{b(!1),C("")}},[N,l,I,r,a]),z=p.useCallback(()=>{if(!m||!h)return;const Y=URL.createObjectURL(m),G=document.createElement("a");G.href=Y,G.download=h,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(Y)},[m,h]),O=p.useCallback(async()=>{if(d.debug("📱 [PDFPreviewModal] QR download button clicked"),!N||!l){d.error("❌ [PDFPreviewModal] Missing data for QR generation"),j("Missing required data for QR code generation");return}_(!0),k("Generating PDF for QR code...");try{d.debug("🔄 Generating fresh PDF for QR code upload..."),k("Creating PDF document...");const Y={warningId:N.warningId,issuedDate:N.issueDate,employee:{firstName:N.employee.firstName,lastName:N.employee.lastName,employeeNumber:N.employee.employeeId,department:N.employee.department,position:N.employee.position,email:N.employee.email},warningLevel:N.recommendation?.suggestedLevel||"verbal",category:N.category.name,description:N.incident.description,incidentDate:new Date(N.incident.date),incidentTime:N.incident.time,incidentLocation:N.incident.location,organization:l,signatures:N.signatures,additionalNotes:N.additionalNotes,validityPeriod:N.validityPeriod,legalCompliance:{isCompliant:!0,framework:"LRA Section 188",requirements:N.recommendation?.legalRequirements||[]},disciplineRecommendation:N.recommendation?{suggestedLevel:N.recommendation.suggestedLevel,reason:N.recommendation.reason||"Progressive discipline escalation",warningCount:N.recommendation.warningCount||0,activeWarnings:N.recommendation.previousWarnings||[],legalRequirements:N.recommendation.legalRequirements||[]}:void 0,deliveryChoice:r?{method:r.method,timestamp:new Date,chosenBy:"Manager",contactDetails:r.contactDetails}:void 0};k("Generating PDF document...");const G=await In.generateWarningPDF(Y);d.debug("✅ QR PDF generated:",{size:`${(G.size/1024).toFixed(1)} KB`,filename:I}),A(G),k("Opening QR code modal..."),S(!0)}catch(Y){d.error("❌ QR PDF generation failed:",Y),j(`Failed to generate QR code: ${Y instanceof Error?Y.message:"Unknown error"}`)}finally{_(!1),k("")}},[N,l,I,r]),q=p.useRef(!1);return p.useEffect(()=>{n&&N&&!m&&!g&&!q.current&&(q.current=!0,T()),n||(q.current=!1)},[n,N,m,g,T]),p.useEffect(()=>{if(n){const Y=setTimeout(()=>{E.current&&(E.current.scrollIntoView({behavior:"smooth",block:"start"}),d.debug("🔄 PDFPreviewModal: Auto-scrolled using modalRef")),window.scrollTo({top:0,behavior:"smooth"});const G=document.querySelector(".pdf-preview-modal");G&&G.scrollIntoView({behavior:"smooth",block:"start"}),d.debug("🔄 PDFPreviewModal: Auto-scroll completed")},150);return document.body.style.overflow="hidden",()=>{clearTimeout(Y),document.body.style.overflow="unset"}}else document.body.style.overflow="unset"},[n]),p.useEffect(()=>()=>{x&&URL.revokeObjectURL(x)},[x]),n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{ref:E,className:"pdf-preview-modal bg-white rounded-lg shadow-xl max-w-4xl w-full h-[90vh] overflow-hidden flex flex-col border border-gray-200",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 p-6 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center",children:e.jsx(fo,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:o}),N&&e.jsxs("p",{className:"text-gray-600 text-sm",children:[N.employee.firstName," ",N.employee.lastName," - ",N.category.name]})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-6",children:[N&&!N.isComplete&&e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"w-5 h-5 text-amber-400 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-amber-800",children:"Incomplete Warning Data"}),e.jsxs("div",{className:"text-sm text-amber-700 mt-1",children:[!N.hasEmployee&&e.jsx("p",{children:"• Employee not selected"}),!N.hasCategory&&e.jsx("p",{children:"• Category not selected"}),!N.incident.description&&e.jsx("p",{children:"• Incident description missing"}),e.jsx("p",{className:"mt-2",children:"PDF can still be generated with available data, but may appear incomplete."})]})]})]})}),f&&e.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-4 rounded-r-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{className:"w-5 h-5 text-red-400 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"PDF Generation Error"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:f})]})]}),e.jsxs("button",{onClick:T,className:"mt-3 text-sm text-red-700 hover:text-red-900 font-medium flex items-center",children:[e.jsx(pt,{className:"w-4 h-4 mr-1"}),"Retry Generation"]})]}),N&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${N.hasEmployee?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("h3",{className:"font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),"Employee Details",N.hasEmployee?e.jsx(ae,{className:"w-4 h-4 text-green-500 ml-2"}):e.jsx(me,{className:"w-4 h-4 text-amber-500 ml-2"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[N.employee.firstName," ",N.employee.lastName]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[N.employee.position," • ",N.employee.department]}),!N.hasEmployee&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Complete employee selection in wizard"})]}),e.jsxs("div",{className:`p-4 rounded-lg ${N.hasCategory?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"}`,children:[e.jsxs("h3",{className:"font-semibold text-gray-700 mb-2 flex items-center",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),"Incident Details",N.incident.description&&N.hasCategory?e.jsx(ae,{className:"w-4 h-4 text-green-500 ml-2"}):e.jsx(me,{className:"w-4 h-4 text-amber-500 ml-2"})]}),e.jsxs("p",{className:"text-sm text-gray-600 flex items-center",children:[e.jsx(Re,{className:"w-3 h-3 mr-1"}),N.incident.date," at ",N.incident.time]}),N.incident.location&&e.jsxs("p",{className:"text-sm text-gray-500 flex items-center",children:[e.jsx(rs,{className:"w-3 h-3 mr-1"}),N.incident.location]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Category: ",N.category.name]}),!N.hasCategory&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"Complete category selection in wizard"})]})]}),g&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx(et,{className:"w-6 h-6 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"Generating PDF Document"}),w&&e.jsx("p",{className:"text-blue-600 text-sm",children:w})]})]})}),R&&e.jsx("div",{className:"bg-purple-50 border border-purple-200 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx(et,{className:"w-6 h-6 text-purple-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-800 font-medium",children:"Preparing QR Code Download"}),F&&e.jsx("p",{className:"text-purple-600 text-sm",children:F}),e.jsx("p",{className:"text-purple-600 text-xs mt-1",children:"This creates a secure link for mobile devices"})]})]})}),m&&x&&!g&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-medium",children:"PDF Generated Successfully"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[h," • ",(m.size/1024).toFixed(1)," KB"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 px-3 py-2 bg-white text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:[e.jsx(zs,{className:"w-4 h-4"}),e.jsx("span",{children:"Download"})]}),e.jsx("button",{onClick:O,disabled:R,className:"flex items-center gap-2 px-3 py-2 bg-white text-gray-700 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-4 h-4"}),e.jsx("span",{children:"QR Code"})]})}),e.jsxs("button",{onClick:()=>window.open(x,"_blank"),className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Open"})]})]})]})}),i&&e.jsxs("div",{className:"bg-gray-100 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-700 mb-3 flex items-center",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Document Preview"]}),e.jsx("div",{className:"bg-white border rounded-lg overflow-hidden shadow-inner",style:{height:"500px"},children:e.jsx("iframe",{src:x,className:"w-full h-full border-0",title:"PDF Preview"})})]})]}),N&&!N.isComplete&&!m&&!g&&e.jsxs("div",{className:"text-center py-6 border-t border-gray-200",children:[e.jsx(Ur,{className:"w-12 h-12 text-blue-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"Partial Warning Data"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Some information is missing, but you can still generate a draft PDF."}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-700 font-medium",children:"Complete Wizard First"}),e.jsxs("button",{onClick:T,className:"flex items-center space-x-2 bg-amber-500 text-white px-6 py-2 rounded-lg hover:bg-amber-600 transition-colors font-medium",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Draft PDF"})]})]})]}),!N&&!g&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ye,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No Warning Data Available"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No data provided for PDF generation."}),e.jsx("button",{onClick:t,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Wizard"})]})]})}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xa,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{children:"Generated by HR System"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{children:"LRA Compliant"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Close"}),!m&&!g&&N&&e.jsxs("button",{onClick:T,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate PDF"})]}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:z,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(zs,{className:"w-4 h-4"}),e.jsx("span",{children:"Download"})]}),e.jsx("button",{onClick:O,disabled:R,className:"flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:R?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ha,{className:"w-4 h-4"}),e.jsx("span",{children:"QR Code"})]})})]})]})]})})]})}),y&&e.jsx(qc,{isOpen:D,onClose:()=>{S(!1),A(null)},pdfBlob:y,filename:h,employeeId:N?.employee?.id,warningId:N?.warningId,organizationId:N?.organizationId||l?.id,employeeName:N&&`${N.employee.firstName} ${N.employee.lastName}`.trim(),onLinkGenerated:Y=>{d.debug("🔗 QR download link generated:",Y)}})]}):null},Gc=()=>{const n=Date.now(),t=Math.random().toString(36).substr(2,9);return`emp_${n}_${t}`},Vc=n=>{const t=n.toUpperCase().substring(0,3),s=Date.now().toString().slice(-6),r=Math.floor(Math.random()*99).toString().padStart(2,"0");return`${t}${s}${r}`},bi=(n,t)=>{const s=new Date;return{id:Gc(),organizationId:t,isActive:n.isActive,createdAt:s.toISOString(),updatedAt:s.toISOString(),profile:{employeeNumber:n.employeeNumber,firstName:n.firstName,lastName:n.lastName,email:n.email.toLowerCase(),phoneNumber:n.phoneNumber||null,whatsappNumber:n.whatsappNumber||null,department:n.department,position:n.position,startDate:new Date(n.startDate)},employment:{startDate:new Date(n.startDate),contractType:n.contractType,probationEndDate:n.probationEndDate?new Date(n.probationEndDate):null,department:n.department,position:n.position,managerId:n.managerId||null},disciplinaryRecord:{totalWarnings:0,activeWarnings:0,currentLevel:"none",warningHistory:[],warningsByCategory:{}},deliveryPreferences:{primaryMethod:"email",allowAlternativeMethods:!0,whatsappConsent:!1,emailConsent:!0,printConsent:!1,lastUpdated:s}}},Tn=n=>{if(!n)return"";try{if(n&&typeof n.toDate=="function")return n.toDate().toISOString().split("T")[0];if(n instanceof Date)return n.toISOString().split("T")[0];if(typeof n=="string"){const t=new Date(n);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}if(typeof n=="number"){const t=new Date(n);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}return""}catch(t){return console.warn("Failed to convert date:",n,t),""}},Qc=n=>({employeeNumber:n.profile.employeeNumber,firstName:n.profile.firstName,lastName:n.profile.lastName,email:n.profile.email,phoneNumber:n.profile.phoneNumber||"",whatsappNumber:n.profile.whatsappNumber||"",department:n.profile.department,position:n.profile.position,startDate:Tn(n.profile.startDate),contractType:n.employment.contractType,probationEndDate:Tn(n.employment.probationEndDate),managerId:n.employment.managerId||"",isActive:n.isActive}),Xr=(n,t)=>{if(!n)return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1};switch(n){case"super-user":return{canCreate:!0,canEdit:!0,canArchive:!0,canRestore:!0,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!0,canExport:!0};case"business-owner":return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!1,canExport:!0};case"hr-manager":return{canCreate:!0,canEdit:!0,canArchive:!0,canRestore:!0,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!0,canExport:!0};case"hod-manager":case"hod":return{canCreate:!0,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:t||[],canViewContactInfo:!0,canBulkImport:!1,canExport:!1};default:return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1}}},Kc=(n,t,s,r,a)=>n.filter(i=>{if(!i||!i.profile)return!1;if(!s.canViewAll&&(r==="hod"||r==="hod-manager")){const o=i.employment?.managerId;if(o&&o!==a)return!1}else if(!s.canViewAll&&s.canViewDepartments.length>0){const o=i.profile.department;if(!o||!s.canViewDepartments.includes(o))return!1}if(t.isActive&&!i.isActive||!t.isActive&&!i.isActive&&!s.canViewArchived)return!1;if(t.search){const o=t.search.toLowerCase();if(!((i.profile.firstName?.toLowerCase()||"").includes(o)||(i.profile.lastName?.toLowerCase()||"").includes(o)||(i.profile.employeeNumber?.toLowerCase()||"").includes(o)||(i.profile.email?.toLowerCase()||"").includes(o)))return!1}return!(t.department&&i.profile.department!==t.department||t.contractType&&i.employment?.contractType!==t.contractType||t.hasWarnings&&(!i.disciplinaryRecord||i.disciplinaryRecord.activeWarnings===0))}),Yc=n=>{const t={total:n.length,active:0,inactive:0,onProbation:0,withActiveWarnings:0,departments:[],contractTypes:[]},s={},r={};return n.forEach(a=>{a.isActive?t.active++:t.inactive++,a.isActive&&(a.employment?.probationEndDate&&new Date(a.employment.probationEndDate)>new Date&&t.onProbation++,a.disciplinaryRecord?.activeWarnings>0&&t.withActiveWarnings++);const i=a.profile?.department||"Unknown";s[i]=(s[i]||0)+1;const o=a.employment?.contractType||"Unknown";r[o]=(r[o]||0)+1}),t.departments=Object.entries(s).map(([a,i])=>({name:a,count:i})).sort((a,i)=>i.count-a.count),t.contractTypes=Object.entries(r).map(([a,i])=>({type:a,count:i})).sort((a,i)=>i.count-a.count),t},Zc=()=>{const n=["employeeNumber","firstName","lastName","email","phoneNumber","whatsappNumber","department","position","startDate","contractType","probationEndDate"],t=[["EMP001","John","Doe","john.doe@company.com","+27123456789","+27123456789","Engineering","Software Developer","2024-01-15","permanent",""],["EMP002","Sarah","Johnson","sarah.johnson@company.com","+27987654321","+27987654321","Human Resources","HR Manager","2023-06-01","permanent",""],["EMP003","Michael","Smith","michael.smith@company.com","+27555123456","","Operations","Operations Coordinator","2024-11-01","contract","2025-02-01"]];return[n.join(","),...t.map(r=>r.join(","))].join(`
`)},Xc=(n,t)=>{const[s,r]=p.useState([]),[a,i]=p.useState([]),[o,l]=p.useState(!0),[m,c]=p.useState(!1),[x,u]=p.useState(null),[h,v]=p.useState({hasMore:!0,currentPage:0,pageSize:50}),g=async(w=!0)=>{if(n)try{if(w?(l(!0),r([]),v(y=>({...y,currentPage:0,lastId:void 0}))):c(!0),u(null),t){const y=await Ce.employees.getByManager(t,n);r(y),i(y),v(A=>({...A,hasMore:!1}));return}const C=await Ce.employees.getAll(n),D=!1,S=void 0;w?(r(C),i(C)):(r(y=>[...y,...C]),i(y=>[...y,...C])),v(y=>({...y,hasMore:D,lastId:S,currentPage:w?1:y.currentPage+1}))}catch(C){u("Failed to load employees"),d.error("Error loading employees:",C)}finally{l(!1),c(!1)}},b=async()=>{!h.hasMore||m||await g(!1)},f=async(w,C)=>{if(n)try{await Ce.employees.delete(w.id,n),await g()}catch(D){throw u("Failed to archive employee"),d.error("Archive error:",D),D}},j=async w=>{if(n)try{await Ce.employees.update(w.id,n,w),await g()}catch(C){throw u("Failed to update employee"),C}};return p.useEffect(()=>{g()},[n]),{employees:s,allEmployees:a,loading:o,loadingMore:m,error:x,loadEmployees:g,loadMoreEmployees:b,archiveEmployee:f,updateEmployee:j,pagination:{hasMore:h.hasMore,currentPage:h.currentPage,pageSize:h.pageSize,canLoadMore:h.hasMore&&!o&&!m}}},wi=(n,t)=>{const[s,r]=p.useState({search:"",department:"",contractType:"",hasWarnings:!1,isActive:!0}),a=p.useMemo(()=>Xr(t?.role.id,t?.departmentIds),[t]),i=p.useMemo(()=>Kc(n,s,a,t?.role?.id,t?.id),[n,s,a,t?.role?.id,t?.id]);return{filters:s,setFilters:r,filteredEmployees:i}},Jc=({employees:n})=>{const t=Yc(n),s=[{value:t.total,label:"Total Employees",color:"blue",icon:"👥"},{value:t.active,label:"Active",color:"green",icon:"✅"},{value:t.inactive,label:"Archived",color:"gray",icon:"📁"},{value:t.onProbation,label:"On Probation",color:"yellow",icon:"⏳"},{value:t.withActiveWarnings,label:"With Warnings",color:"red",icon:"⚠️"}];return e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-2 sm:gap-3",children:s.map((r,a)=>e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-2 sm:p-3 text-center shadow-md hover:shadow-lg transition-all duration-200",children:[e.jsx("div",{className:"text-lg sm:text-xl mb-0.5 sm:mb-1",children:r.icon}),e.jsx("div",{className:`text-lg sm:text-xl font-bold text-${r.color}-600 mb-0.5 sm:mb-1`,children:r.value}),e.jsx("div",{className:"text-xs text-gray-600 font-medium leading-tight",children:r.label})]},a))})},ed=({filters:n,setFilters:t,departments:s,viewMode:r,setViewMode:a})=>e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl p-6 mb-8 shadow-xl",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"🔍 Search employees by name, number, or email...",value:n.search,onChange:i=>t({...n,search:i.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"})}),e.jsxs("select",{value:n.department,onChange:i=>t({...n,department:i.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Departments"}),s.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsxs("select",{value:n.contractType,onChange:i=>t({...n,contractType:i.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"All Contract Types"}),e.jsx("option",{value:"permanent",children:"Permanent"}),e.jsx("option",{value:"contract",children:"Contract"}),e.jsx("option",{value:"temporary",children:"Temporary"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:n.hasWarnings,onChange:i=>t({...n,hasWarnings:i.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Has Warnings"})]}),e.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[e.jsx("input",{type:"checkbox",checked:n.isActive,onChange:i=>t({...n,isActive:i.target.checked}),className:"w-4 h-4"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Active Only"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>a("table"),className:`px-4 py-3 rounded-xl font-medium transition-all ${r==="table"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"📋 Table"}),e.jsx("button",{onClick:()=>a("cards"),className:`px-4 py-3 rounded-xl font-medium transition-all ${r==="cards"?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"📱 Cards"})]})]})})}),td=({employee:n,permissions:t,onEdit:s,onArchive:r})=>{const i=(()=>{if(!n.employment.probationEndDate)return null;const o=new Date(n.employment.probationEndDate),l=new Date,m=Math.ceil((o.getTime()-l.getTime())/(1e3*60*60*24));return m<=0?null:{daysLeft:m,status:m<=7?"critical":m<=30?"warning":"normal"}})();return e.jsxs("div",{className:`
      bg-white/95 backdrop-blur-sm rounded-2xl p-6 shadow-lg hover:shadow-xl 
      transform hover:-translate-y-1 transition-all duration-200 cursor-pointer
      ${n.isActive?"":"opacity-75"}
    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-1",children:[n.profile.firstName," ",n.profile.lastName]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["#",n.profile.employeeNumber]})]}),e.jsx("span",{className:`
          inline-flex px-3 py-1 text-xs font-semibold rounded-full
          ${n.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}
        `,children:n.isActive?"Active":"Archived"})]}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"🏢"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:n.profile.department}),e.jsx("span",{className:"text-gray-500",children:" • "}),e.jsx("span",{className:"text-gray-600",children:n.profile.position})]})]}),t.canViewContactInfo&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"📧"}),e.jsx("span",{className:"text-gray-600 truncate",children:n.profile.email})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"📋"}),e.jsx("span",{className:"text-gray-600",children:"Contract:"}),e.jsx("span",{className:`
            inline-flex px-2 py-0.5 text-xs font-semibold rounded-full capitalize
            ${n.employment.contractType==="permanent"?"bg-green-100 text-green-800":n.employment.contractType==="contract"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}
          `,children:n.employment.contractType})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-lg",children:"⚠️"}),e.jsx("span",{className:"text-gray-600",children:"Active Warnings:"}),e.jsx("span",{className:`
            inline-flex px-2 py-0.5 text-xs font-bold rounded-full
            ${n.disciplinaryRecord.activeWarnings===0?"bg-green-100 text-green-800":n.disciplinaryRecord.activeWarnings<3?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}
          `,children:n.disciplinaryRecord.activeWarnings})]}),i&&n.isActive&&e.jsxs("div",{className:`
            flex items-center gap-2 text-sm p-2 rounded-lg
            ${i.status==="critical"?"bg-red-50":i.status==="warning"?"bg-yellow-50":"bg-blue-50"}
          `,children:[e.jsx("span",{className:"text-lg",children:"⏳"}),e.jsxs("span",{className:`
              font-medium
              ${i.status==="critical"?"text-red-700":i.status==="warning"?"text-yellow-700":"text-blue-700"}
            `,children:["Probation ends in ",i.daysLeft," days"]})]})]}),t.canEdit&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:()=>s(n),className:"flex-1 py-2 px-4 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 font-medium transition-colors",children:"✏️ Edit"}),n.isActive&&t.canArchive&&e.jsx("button",{onClick:()=>r(n),className:"flex-1 py-2 px-4 bg-amber-50 text-amber-600 rounded-lg hover:bg-amber-100 font-medium transition-colors",children:"📁 Archive"}),!n.isActive&&t.canRestore&&e.jsx("button",{onClick:()=>s(n),className:"flex-1 py-2 px-4 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 font-medium transition-colors",children:"♻️ Restore"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Started: ",(()=>{const o=n.profile?.startDate||n.employment?.startDate;if(!o)return"Not set";try{if(o&&typeof o.toDate=="function")return o.toDate().toLocaleDateString();if(o instanceof Date)return o.toLocaleDateString();const l=new Date(o);return isNaN(l.getTime())?"Invalid date":l.toLocaleDateString()}catch{return"Invalid date"}})()]}),n.disciplinaryRecord.lastWarningDate&&e.jsxs("span",{children:["Last warning: ",new Date(n.disciplinaryRecord.lastWarningDate).toLocaleDateString()]})]})]})},sd=n=>typeof n=="string"?n:n?.id||"",ji=({employee:n,onClose:t,onSave:s,basicMode:r=!1})=>{const{organization:a,user:i}=De(),[o,l]=p.useState({employeeNumber:"",firstName:"",lastName:"",email:"",phoneNumber:"",whatsappNumber:"",department:"",position:"",startDate:"",contractType:"permanent",probationEndDate:"",managerId:""}),[m,c]=p.useState(null),[x,u]=p.useState(!1),[h,v]=p.useState([]),[g,b]=p.useState(!1);p.useEffect(()=>{const j=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=j}},[]),p.useEffect(()=>{(async()=>{if(a)try{b(!0);const D=(await ge.queryDocuments(a.id,"users",[])).documents.filter(S=>{const y=sd(S.role);return y==="hod-manager"||y==="hr-manager"||y==="business-owner"});v(D)}catch(w){d.error("Failed to load managers:",w)}finally{b(!1)}})()},[a]),p.useEffect(()=>{if(n){const j=Qc(n);l(j)}else if(r&&a){const j=new Date().toISOString().split("T")[0];l(w=>({...w,employeeNumber:Vc(a.id),department:i?.departmentIds?.[0]||i?.profile?.department||"Operations",startDate:j,managerId:i?.id,isActive:!0}))}},[n,r,a,i]);const f=async j=>{if(j.preventDefault(),!!a){u(!0),c(null);try{if(n){const w={...n,profile:{...n.profile,employeeNumber:o.employeeNumber,firstName:o.firstName,lastName:o.lastName,email:o.email,phoneNumber:o.phoneNumber||null,whatsappNumber:o.whatsappNumber||null,department:o.department,position:o.position,startDate:o.startDate?new Date(o.startDate):new Date},employment:{...n.employment,contractType:o.contractType,...o.managerId&&{managerId:o.managerId},...o.probationEndDate&&{probationEndDate:new Date(o.probationEndDate)}},isActive:n.isActive,updatedAt:new Date};await Ce.employees.update(n.id,a.id,w),d.debug(`✅ Updated employee: ${n.id}`)}else{const w=bi(o,a.id),{id:C,...D}=w,S=await Ce.employees.create(D);d.debug(`✅ Created new employee: ${S}`)}s()}catch(w){d.error("Error saving employee:",w),c(w.message||"Failed to save employee")}finally{u(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:j=>{j.target===j.currentTarget&&t()},children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-800",children:n?"Edit Employee":r?"Quick Add Employee":"Add New Employee"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:r?"Basic details only - HR can complete the full profile later":"Fill in the employee details below"})]}),e.jsx("button",{type:"button",onClick:t,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:f,className:"flex flex-col flex-1 min-h-0",children:[e.jsxs("div",{className:"overflow-y-auto flex-1 p-6 space-y-6",children:[m&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-800 text-sm",children:m})}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-blue-600"}),"Personal Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Employee Number *"}),e.jsx("input",{type:"text",required:!0,value:o.employeeNumber,onChange:j=>l({...o,employeeNumber:j.target.value}),className:`w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none ${r?"bg-slate-50":""}`,placeholder:"EMP001",readOnly:r,title:r?"Auto-generated - HR can change this later":""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Start Date *"}),e.jsx("input",{type:"date",required:!0,value:o.startDate,onChange:j=>l({...o,startDate:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",required:!0,value:o.firstName,onChange:j=>l({...o,firstName:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",required:!0,value:o.lastName,onChange:j=>l({...o,lastName:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Address *"}),e.jsx("input",{type:"email",required:!0,value:o.email,onChange:j=>l({...o,email:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"john.doe@company.com"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Phone Number ",r?"(Optional)":""]}),e.jsx("input",{type:"tel",value:o.phoneNumber,onChange:j=>l({...o,phoneNumber:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})]})]}),e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(Is,{className:"w-5 h-5 text-emerald-600"}),"Work Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department *"}),e.jsx("input",{type:"text",required:!0,value:o.department,onChange:j=>l({...o,department:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Human Resources"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Position *"}),e.jsx("input",{type:"text",required:!0,value:o.position,onChange:j=>l({...o,position:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"HR Manager"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Contract Type *"}),e.jsxs("select",{required:!0,value:o.contractType,onChange:j=>l({...o,contractType:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"permanent",children:"Permanent"}),e.jsx("option",{value:"contract",children:"Contract"}),e.jsx("option",{value:"temporary",children:"Temporary"}),e.jsx("option",{value:"intern",children:"Intern"})]})]}),!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Manager"}),e.jsxs("select",{value:o.managerId,onChange:j=>l({...o,managerId:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",disabled:g,children:[e.jsx("option",{value:"",children:"No Manager"}),h.map(j=>e.jsxs("option",{value:j.id,children:[j.firstName," ",j.lastName," (",typeof j.role=="string"?j.role:j.role?.name,")"]},j.id))]}),g&&e.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading managers..."})]}),o.contractType!=="permanent"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Probation End Date"}),e.jsx("input",{type:"date",value:o.probationEndDate,onChange:j=>l({...o,probationEndDate:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none"})]})]})]}),!r&&e.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5 text-amber-600"}),"Communication Preferences"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"WhatsApp Number"}),e.jsx("input",{type:"tel",value:o.whatsappNumber,onChange:j=>l({...o,whatsappNumber:j.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-200 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Hr,{className:"w-4 h-4"}),n?"Update Employee":"Add Employee"]})})]})]})]})})},rd=()=>{const[n,t]=p.useState(null),[s,r]=p.useState([]),[a,i]=p.useState(null),[o,l]=p.useState(!1),[m,c]=p.useState(0),[x,u]=p.useState(""),h=f=>{const j=[];let w="",C=!1;for(let D=0;D<f.length;D++){const S=f[D];S==='"'?C&&f[D+1]==='"'?(w+='"',D++):C=!C:S===","&&!C?(j.push(w),w=""):w+=S}return j.push(w),j};return{csvFile:n,csvData:s,importResult:a,isImporting:o,importProgress:m,currentImportStep:x,handleFileUpload:f=>{t(f);const j=new FileReader;j.onload=w=>{const C=w.target?.result;try{const D=C.trim().split(`
`).map(R=>R.trim()).filter(R=>R.length>0);if(D.length===0){r([]);return}const S=D[0].split(",").map(R=>R.trim().replace(/"/g,"")),y=[],A=[];for(let R=1;R<D.length;R++){const _=R+1,F=D[R];try{const k=h(F);if(k.length!==S.length){A.push(`Row ${_}: Field count mismatch`);continue}const E={};if(S.forEach((I,T)=>{E[I]=k[T]?.trim().replace(/"/g,"")||""}),!E.firstName||!E.lastName||!E.email){A.push(`Row ${_}: Missing required fields (firstName, lastName, email)`);continue}const N={employeeNumber:E.employeeNumber||"",firstName:E.firstName,lastName:E.lastName,email:E.email.toLowerCase(),phoneNumber:E.phoneNumber||"",whatsappNumber:E.whatsappNumber||"",department:E.department||"",position:E.position||"",startDate:E.startDate||"",contractType:E.contractType?.toLowerCase()||"permanent"};y.push(N)}catch{A.push(`Row ${_}: Parse error`)}}r(y),A.length>0&&d.warn("CSV Import Warnings:",A)}catch(D){d.error("CSV parsing failed:",D),r([])}},j.readAsText(f)},handleImport:async f=>{if(!s.length)return{success:!1,imported:0,failed:0,errors:[{row:1,field:"file",message:"No data to import"}]};l(!0),c(0),u("Validating employee data...");const j=[],w=[];try{for(let y=0;y<s.length;y++){const A=s[y],R=y+2,_=Math.round(y/s.length*30);c(_),u(`Validating employee ${y+1} of ${s.length}: ${A.firstName} ${A.lastName}...`);try{let F=A.employeeNumber;(!F||F.trim()==="")&&(F=await Ce.employees.generateNextEmployeeNumber(f));const k=await Ce.employees.validateEmployeeNumber(f,F);if(!k.isAvailable){j.push({row:R,field:"employeeNumber",message:`Employee number "${F}" is already in use${k.suggestions?`. Suggestions: ${k.suggestions.slice(0,3).join(", ")}`:""}`});continue}const E={employeeNumber:F,firstName:A.firstName,lastName:A.lastName,email:A.email,phoneNumber:A.phoneNumber||"",whatsappNumber:A.whatsappNumber||"",department:A.department,position:A.position,startDate:A.startDate,contractType:A.contractType||"permanent",isActive:!0},N=bi(E,f),{id:I,...T}=N;w.push(T)}catch(F){j.push({row:R,field:"validation",message:F instanceof Error?F.message:"Validation error"})}}let C=0,D=j.length;if(c(30),u("Validation complete. Starting employee creation..."),w.length>0)try{d.debug(`🚀 Attempting to import ${w.length} employees with rate limiting...`);for(let y=0;y<w.length;y++){const A=30+Math.round(y/w.length*60);c(A);const R=w[y];u(`Creating employee ${y+1} of ${w.length}: ${R.profile?.firstName} ${R.profile?.lastName}...`);let _=0;const F=3;let k=!1;for(;!k&&_<F;)try{y>0&&await new Promise(E=>setTimeout(E,500)),await Ce.employees.create(w[y]),C++,k=!0,u(`✅ Created: ${R.profile?.firstName} ${R.profile?.lastName}`),await new Promise(E=>setTimeout(E,200))}catch(E){_++;const N=E instanceof Error?E.message:"Unknown error";_<F&&N.includes("permissions")?(d.warn(`⚠️ Retry ${_}/${F} for employee ${y+1}: ${N}`),u(`⚠️ Retrying ${R.profile?.firstName} ${R.profile?.lastName} (${_}/${F})...`),await new Promise(I=>setTimeout(I,1e3*_))):(d.error(`❌ Failed to create employee ${y+1} after ${_} attempts:`,E),D++,j.push({row:y+2,field:"individual_create",message:`${N} (after ${_} retries)`}),k=!0)}}c(90),u("Finalizing import..."),await new Promise(y=>setTimeout(y,500)),d.success(10447)}catch(y){d.error("❌ Import process failed:",y),D+=w.length-C}const S={success:D===0,imported:C,failed:D,errors:j};return i(S),c(100),u("Import completed!"),S}finally{l(!1)}},resetImport:()=>{t(null),r([]),i(null),c(0),u("")}}},Ni=({onClose:n,onImportComplete:t})=>{const{organization:s}=De(),{csvData:r,importResult:a,isImporting:i,importProgress:o,currentImportStep:l,handleFileUpload:m,handleImport:c,resetImport:x}=rd(),[u,h]=p.useState("upload"),v=()=>{const j=Zc(),w=new Blob([j],{type:"text/csv"}),C=window.URL.createObjectURL(w),D=document.createElement("a");D.href=C,D.download="employee_import_template.csv",D.click(),window.URL.revokeObjectURL(C)},g=j=>{const w=j.target.files?.[0];w&&(m(w),h("preview"))},b=async()=>{if(!s)return;h("importing");const j=await c(s.id);h("result"),j.success&&j.failed===0&&setTimeout(()=>{t(),n()},2e3)},f=()=>{x(),n()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"📊 Import Employees from CSV"}),e.jsx("p",{className:"text-green-100 mt-1",children:"Bulk import multiple employees at once"})]}),!i&&e.jsx("button",{onClick:f,className:"text-green-100 hover:text-white transition-colors text-2xl leading-none",children:"×"})]}),e.jsxs("div",{className:"p-6",children:[u==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"📋 Import Instructions"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm text-blue-800",children:[e.jsx("li",{children:"Download the CSV template below"}),e.jsx("li",{children:"Fill in employee information following the template format"}),e.jsx("li",{children:"Save the file as CSV (comma-separated values)"}),e.jsx("li",{children:"Upload the completed file using the form below"})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:v,className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV Template"]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{type:"file",accept:".csv",onChange:g,className:"hidden",id:"csv-upload"}),e.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📁"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"Click to upload CSV file"}),e.jsx("p",{className:"text-sm text-gray-500",children:"or drag and drop your file here"})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Sample CSV Format:"}),e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:[e.jsx("strong",{children:"💡 Tip:"})," Leave employeeNumber empty to auto-generate next available number"]}),e.jsx("pre",{className:"text-xs bg-white p-3 rounded border overflow-x-auto",children:`employeeNumber,firstName,lastName,email,phoneNumber,whatsappNumber,department,position,startDate,contractType,preferredDeliveryMethod
EMP001,John,Doe,john.doe@company.com,+27123456789,+27123456789,Engineering,Software Developer,2024-01-15,permanent,email
,Jane,Smith,jane.smith@company.com,+27987654321,+27987654321,Human Resources,HR Manager,2023-06-01,permanent,whatsapp`}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:"Notice: Jane Smith has an empty employee number - the system will auto-generate one"})]})]}),u==="preview"&&r.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-green-800",children:["✅ Found ",e.jsx("strong",{children:r.length})," employees ready to import"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Employee #"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Department"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Position"}),e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700",children:"Start Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:r.slice(0,10).map((j,w)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:j.employeeNumber}),e.jsxs("td",{className:"px-4 py-2",children:[j.firstName," ",j.lastName]}),e.jsx("td",{className:"px-4 py-2",children:j.email}),e.jsx("td",{className:"px-4 py-2",children:j.department}),e.jsx("td",{className:"px-4 py-2",children:j.position}),e.jsx("td",{className:"px-4 py-2",children:j.startDate})]},w))})]})}),r.length>10&&e.jsxs("p",{className:"text-center text-gray-500 text-sm",children:["... and ",r.length-10," more employees"]}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx("button",{onClick:()=>{h("upload"),x()},className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Upload Different File"}),e.jsxs("button",{onClick:b,className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium",children:["Import ",r.length," Employees"]})]})]}),u==="importing"&&e.jsxs("div",{className:"space-y-6 text-center",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚡"}),e.jsx("h3",{className:"text-xl font-bold text-blue-900 mb-2",children:"Importing Employees"}),e.jsx("p",{className:"text-blue-700 mb-4",children:"Please wait while we create your employees..."}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-4 mb-4",children:e.jsx("div",{className:"bg-blue-600 h-4 rounded-full transition-all duration-300 ease-out",style:{width:`${o}%`}})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-lg font-semibold text-blue-800",children:[o,"% Complete"]}),e.jsx("p",{className:"text-sm text-blue-600 min-h-[1.5rem]",children:l})]})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("p",{children:"⏱️ This may take a few moments depending on the number of employees"}),e.jsx("p",{children:"🔄 Please don't close this window during the import process"})]})]}),u==="result"&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:`border rounded-lg p-6 ${a.success&&a.failed===0?"bg-green-50 border-green-200":a.imported>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:a.success&&a.failed===0?"✅":a.imported>0?"⚠️":"❌"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:a.success&&a.failed===0?"Import Successful!":a.imported>0?"Partial Import Complete":"Import Failed"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-green-700",children:["✅ Successfully imported: ",e.jsx("strong",{children:a.imported})," employees"]}),a.failed>0&&e.jsxs("p",{className:"text-red-700",children:["❌ Failed to import: ",e.jsx("strong",{children:a.failed})," employees"]})]})]})}),a.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-red-900 mb-2",children:"Import Errors:"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:a.errors.map((j,w)=>e.jsxs("div",{className:"text-sm text-red-700",children:[e.jsxs("strong",{children:["Row ",j.row,":"]})," ",j.message]},w))})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:f,className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 font-medium",children:"Close"})})]})]})]})})},Ci=({employee:n,onClose:t,onArchive:s})=>{const[r,a]=p.useState(""),[i,o]=p.useState(!1),l=async()=>{if(console.log("🔍 DEBUGGING - Archive Modal Data:",{employee:n,employeeId:n?.id,employeeIdType:typeof n?.id,employeeIdLength:n?.id?.length,employeeName:`${n?.profile?.firstName} ${n?.profile?.lastName}`,reason:r,hasValidId:n?.id&&n.id.trim().length>0}),!n||!n.id||n.id.trim().length===0){d.error("🚨 CRITICAL ERROR: Invalid employee or missing employee ID"),alert("Error: Invalid employee data. Cannot archive.");return}o(!0);try{d.debug("🔍 Calling onArchive with employee and reason..."),await s(n,r.trim()||void 0),d.success(1682),t()}catch(m){d.error("❌ Archive operation failed:",m),alert(`Failed to archive employee: ${m instanceof Error?m.message:"Unknown error"}`)}finally{o(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-amber-600 mb-4",children:"⚠️ Archive Employee"}),e.jsxs("p",{className:"text-gray-700 mb-4",children:["Are you sure you want to archive ",e.jsxs("strong",{children:[n.profile.firstName," ",n.profile.lastName]}),"?"]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs",children:e.jsxs("p",{className:"text-blue-800",children:[e.jsx("strong",{children:"Debug Info:"})," Employee ID: ",n.id||"MISSING ID!"]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"Note:"})," Archiving an employee will:"]}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-amber-800",children:[e.jsx("li",{children:"• Mark their record as inactive"}),e.jsx("li",{children:"• Preserve all historical data"}),e.jsx("li",{children:"• Remove them from active employee lists"}),e.jsx("li",{children:"• Maintain compliance with HR regulations"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for archiving (optional)"}),e.jsx("textarea",{value:r,onChange:m=>a(m.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none",rows:3,placeholder:"e.g., Resignation, End of contract, etc."})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:l,disabled:i||!n?.id,className:"flex-1 py-3 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Archiving...":"Yes, Archive"}),e.jsx("button",{onClick:t,disabled:i,className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})]})})})},ad=({onBack:n,onEmployeeRestored:t})=>{const{user:s,organization:r}=De(),[a,i]=p.useState([]),[o,l]=p.useState(!0),[m,c]=p.useState(""),[x,u]=p.useState(null),[h,v]=p.useState([]),[g,b]=p.useState(!1),[f,j]=p.useState(null),[w,C]=p.useState(null),D=Xr(s?.role.id,s?.departmentIds);p.useEffect(()=>{S(),y()},[r?.id]);const S=async()=>{if(r?.id)try{l(!0),je.clearCache(),await new Promise(I=>setTimeout(I,500));const[E,N]=await Promise.all([Ce.employees.getAll(r.id),Ce.employees.getArchived(r.id)]);i(N),d.success(`📋 Loaded ${N.length} archived employees`)}catch(E){d.error("Failed to load archived employees:",E)}finally{l(!1)}},y=async()=>{if(r?.id)try{const E=await Ce.employees.getLifecycleStats(r.id);j(E)}catch(E){d.error("Failed to load lifecycle stats:",E)}},A=async E=>{if(r?.id)try{b(!0),u(E);const N=await Ce.employees.getAllWarningsForEmployee(E.id,r.id);v(N),d.debug(`📋 Loaded ${N.length} warnings for archived employee ${E.profile.firstName} ${E.profile.lastName}`)}catch(N){d.error("Failed to load employee warnings:",N),v([])}finally{b(!1)}},R=async E=>{if(!(!r?.id||!s?.id))try{C(E.id),await Ce.employees.restore(E.id,r.id,s.id),d.success(`✅ Restored employee: ${E.profile.firstName} ${E.profile.lastName}`),await S(),await y(),t&&t(),x?.id===E.id&&(u(null),v([]))}catch(N){d.error("Failed to restore employee:",N)}finally{C(null)}},_=a.filter(E=>{if(!m)return!0;const N=m.toLowerCase();return E.profile.firstName.toLowerCase().includes(N)||E.profile.lastName.toLowerCase().includes(N)||E.profile.employeeNumber.toLowerCase().includes(N)||E.profile.department.toLowerCase().includes(N)}),F=E=>{if(!E)return"Unknown";try{return(E.toDate?E.toDate():new Date(E)).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},k=E=>{if(!E)return"Unknown";try{const N=E.toDate?E.toDate():new Date(E),T=new Date().getTime()-N.getTime(),z=Math.floor(T/(1e3*60*60*24));return z<30?`${z} days`:z<365?`${Math.floor(z/30)} months`:`${Math.floor(z/365)} years`}catch{return"Unknown"}};return o?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-3xl shadow-2xl border border-slate-200 max-w-md w-full",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-orange-200 border-t-orange-600 rounded-full animate-spin mx-auto mb-6"}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Loading Archive"}),e.jsx("p",{className:"text-slate-600",children:"Fetching archived employees..."})]})}):e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 via-orange-700 to-orange-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:"p-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg transition-all",children:e.jsx(Wr,{className:"w-5 h-5"})}),e.jsx("div",{className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:e.jsx(ps,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:"Employee Archive"}),e.jsxs("p",{className:"text-orange-100 text-sm font-medium",children:[_.length," archived employees"]})]})]}),f&&e.jsxs("div",{className:"flex gap-4 text-white",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:f.archived}),e.jsx("div",{className:"text-xs text-orange-100",children:"Archived"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:f.deletionEligible}),e.jsx("div",{className:"text-xs text-orange-100",children:"5+ Years"})]})]})]})}),e.jsx("div",{className:"p-4 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search archived employees...",value:m,onChange:E=>c(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"Archived Employees"})}),e.jsx("div",{className:"divide-y max-h-96 overflow-y-auto",children:_.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(ps,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"font-medium",children:"No archived employees"}),e.jsx("p",{className:"text-sm",children:"All employees are currently active"})]}):_.map(E=>e.jsx("div",{className:`p-4 hover:bg-gray-50 cursor-pointer transition-colors ${x?.id===E.id?"bg-orange-50 border-l-4 border-orange-500":""}`,onClick:()=>A(E),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[E.profile.firstName," ",E.profile.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[E.profile.employeeNumber," • ",E.profile.department]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-2 mt-1",children:[e.jsx(tt,{className:"w-3 h-3"}),"Archived ",F(E.archivedAt)," • ",k(E.archivedAt)," ago"]})]}),e.jsxs("div",{className:"flex gap-2",children:[D.canRestore&&e.jsx("button",{onClick:N=>{N.stopPropagation(),R(E)},disabled:w===E.id,className:"p-2 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg transition-colors disabled:opacity-50",title:"Restore Employee",children:w===E.id?e.jsx("div",{className:"w-4 h-4 border-2 border-green-600 border-t-transparent rounded-full animate-spin"}):e.jsx(Xt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(E),className:"p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",title:"View Warning History",children:e.jsx(ut,{className:"w-4 h-4"})})]})]})},E.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:x?"Warning History":"Employee Details"})}),x?e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"p-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[x.profile.firstName," ",x.profile.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[x.profile.employeeNumber," • ",x.profile.department]}),x.archiveReason&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.jsx("strong",{children:"Archive Reason:"})," ",x.archiveReason]})]}),e.jsx("div",{className:"divide-y",children:g?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-orange-200 border-t-orange-600 rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading warning history..."})]}):h.length===0?e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(me,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"font-medium",children:"No Warning History"}),e.jsx("p",{className:"text-sm",children:"This employee has no recorded warnings"})]}):h.map((E,N)=>e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:E.category||E.categoryName||"Unknown Category"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:E.description||"No description available"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),F(E.issueDate||E.createdAt)]}),E.level&&e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${E.level==="counselling"?"bg-blue-100 text-blue-800":E.level==="verbal"?"bg-yellow-100 text-yellow-800":E.level==="first_written"?"bg-orange-100 text-orange-800":E.level==="final_written"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:E.level.replace("_"," ").toUpperCase()})]})]}),e.jsx("div",{className:"text-xs text-gray-400",children:E.status||"Unknown Status"})]})},E.id||N))})]}):e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(ye,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"font-medium",children:"Select an Employee"}),e.jsx("p",{className:"text-sm",children:"Click on an archived employee to view their warning history"})]})]})]})]})},nd=({isOpen:n,onClose:t,employee:s,organizationId:r,onSuccess:a})=>{const[i,o]=p.useState("hod-manager"),[l,m]=p.useState(!1),[c,x]=p.useState(null);if(!n)return null;const u=async()=>{m(!0),x(null);try{const{functions:h,httpsCallable:v}=await nt(async()=>{const{functions:j,httpsCallable:w}=await import("./firebase-vendor-Cz3N8Xg7.js").then(C=>C.J);return{functions:j,httpsCallable:w}},[]),{functions:g}=await nt(async()=>{const{functions:j}=await Promise.resolve().then(()=>ni);return{functions:j}},void 0),f=await v(g,"createOrganizationUser")({organizationId:r,email:s.profile?.email||s.email,firstName:s.profile?.firstName||s.firstName,lastName:s.profile?.lastName||s.lastName,role:i,employeeId:s.id,updateEmployeeEmail:!1});console.log("Employee promoted to manager:",f),a(),t()}catch(h){console.error("Failed to promote employee:",h),x(h.message||"Failed to promote employee. Please try again.")}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:e.jsx(qt,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Promote to Manager"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Grant management access"})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",disabled:l,children:e.jsx(ve,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(ne,{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Promoting:"}),e.jsxs("p",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:[s.profile?.firstName||s.firstName," ",s.profile?.lastName||s.lastName]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.profile?.email||s.email}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[s.profile?.department||"No Department"," • ",s.profile?.position||"No Position"]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Select Manager Role *"}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50 dark:hover:bg-gray-900/50 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 dark:has-[:checked]:bg-blue-900/20",children:[e.jsx("input",{type:"radio",name:"role",value:"hr-manager",checked:i==="hr-manager",onChange:h=>o(h.target.value),className:"w-5 h-5 mt-0.5 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Se,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"HR Manager"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Full access to employee management, warnings, HR reports, and department management"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-4 border-2 rounded-lg cursor-pointer transition-all hover:bg-gray-50 dark:hover:bg-gray-900/50 has-[:checked]:border-blue-500 has-[:checked]:bg-blue-50 dark:has-[:checked]:bg-blue-900/20",children:[e.jsx("input",{type:"radio",name:"role",value:"hod-manager",checked:i==="hod-manager",onChange:h=>o(h.target.value),className:"w-5 h-5 mt-0.5 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(qt,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Department Manager (HOD)"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Manage their department team, issue warnings, view department reports"})]})]})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-300 dark:border-amber-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900 dark:text-amber-100 mb-1",children:"Important:"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:"This will create a user account for this employee with management permissions. They will receive login credentials via email."})]})]})}),c&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:c})]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(ue,{variant:"outline",onClick:t,disabled:l,children:"Cancel"}),e.jsx(ue,{onClick:u,disabled:l,icon:qt,children:l?"Promoting...":"Promote to Manager"})]})]})})},Bn={"business-owner":{level:0,icon:Ft,color:"from-purple-500 to-purple-600"},"hr-manager":{level:1,icon:Se,color:"from-blue-500 to-blue-600"},"hod-manager":{level:2,icon:Ne,color:"from-emerald-500 to-emerald-600"},employee:{level:3,icon:Pe,color:"from-gray-500 to-gray-600"}},id=({employees:n,onEmployeeClick:t,selectedEmployee:s})=>{const{user:r}=De(),[a,i]=p.useState(new Set),[o,l]=p.useState("tree"),m=p.useMemo(()=>{if(!n.length)return[];const f=new Map;n.forEach(S=>f.set(S.id,S));const j=[],w=new Set,C=(S,y=0)=>{if(w.has(S))return null;const A=f.get(S);if(!A)return null;w.add(S);const R=[];return n.filter(_=>_.employment.managerId===S).forEach(_=>{const F=C(_.id,y+1);F&&R.push(F)}),{employee:A,children:R,level:y}};return n.filter(S=>!S.employment.managerId||!f.has(S.employment.managerId)).forEach(S=>{const y=C(S.id);y&&j.push(y)}),j},[n]),c=p.useMemo(()=>{if(!r||["hr-manager","business-owner"].includes(r.role?.id))return m;if(r.role?.id==="hod-manager"){const f=C=>{for(const D of C){if(D.employee.id===r.id)return[D];const S=f(D.children);if(S.length>0)return S}return[]},j=f(m);if(j.length>0)return j;const w=n.filter(C=>C.employment.managerId===r.id);if(w.length>0){const C=n.find(S=>S.id===r.id)||{id:r.id,profile:{firstName:r.firstName||r.displayName?.split(" ")[0]||"Manager",lastName:r.lastName||r.displayName?.split(" ")[1]||"",email:r.email||"",employeeNumber:"MGR-"+r.id.slice(-6),department:r.department||"Management",position:"Manager"},employment:{department:r.department||"Management",position:"Manager",managerId:null}},D=[];return w.forEach(S=>{const y={employee:S,children:n.filter(A=>A.employment.managerId===S.id).map(A=>({employee:A,children:[],level:2})),level:1};D.push(y)}),[{employee:C,children:D,level:0}]}return[]}return m},[m,r]),x=p.useMemo(()=>{const f=new Map;return n.forEach(j=>{const w=j.employment.department||"Unassigned";f.has(w)||f.set(w,[]),f.get(w).push(j)}),Array.from(f.entries()).sort(([j],[w])=>j.localeCompare(w))},[n]),u=p.useCallback(f=>{i(j=>{const w=new Set(j);return w.has(f)?w.delete(f):w.add(f),w})},[]),h=p.useCallback(f=>{t?.(f)},[t]),v=({employee:f,level:j,hasChildren:w,isExpanded:C,isSelected:D,childCount:S=0})=>{const y=f.employment.position||"Employee",A=Bn[y]?.icon||Pe,R=Bn[y]?.color||"from-gray-500 to-gray-600";return e.jsx("div",{className:`
          relative bg-white rounded-lg shadow-md border-2 transition-all duration-200 cursor-pointer
          ${D?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}
          ${j===0?"w-56":"w-48"}
        `,onClick:()=>h(f),children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`
              w-10 h-10 rounded-full bg-gradient-to-br ${R} 
              flex items-center justify-center shadow-md
            `,children:e.jsx(A,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("h3",{className:"font-medium text-sm text-gray-900 truncate",children:[f.profile.firstName," ",f.profile.lastName]}),j===0&&e.jsx(Ft,{className:"w-3 h-3 text-yellow-500 flex-shrink-0"})]}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:y})]})]}),e.jsx("div",{className:"text-xs text-gray-500 mb-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:f.employment.department})]})}),w&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded text-xs font-medium",children:S}),e.jsx("button",{onClick:_=>{_.stopPropagation(),u(f.id)},className:"p-0.5 hover:bg-gray-100 rounded transition-colors",children:C?e.jsx(Ke,{className:"w-3 h-3 text-gray-600"}):e.jsx(_t,{className:"w-3 h-3 text-gray-600"})})]})]})})},g=(f,j=!0)=>f.length===0?null:e.jsx("div",{className:`flex flex-col items-center space-y-6 ${j?"w-full":""}`,children:f.map((w,C)=>{const D=w.children.length>0,S=a.has(w.employee.id),y=s?.id===w.employee.id,A=n.filter(R=>R.employment.managerId===w.employee.id).length;return e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:"relative z-10",children:e.jsx(v,{employee:w.employee,level:w.level,hasChildren:D,isExpanded:S,isSelected:y,childCount:A})}),D&&S&&e.jsxs("div",{className:"relative mt-4",children:[e.jsx("div",{className:"absolute top-0 left-1/2 w-0.5 h-4 bg-blue-300 transform -translate-x-0.5"}),e.jsx("div",{className:"pt-4 space-y-4",children:w.children.map((R,_)=>e.jsxs("div",{className:"relative flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-0.5 h-8 bg-blue-300"}),e.jsx("div",{className:"w-8 h-0.5 bg-blue-300"})]}),e.jsx("div",{className:"ml-2",children:g([R],!1)})]},R.employee.id))}),w.children.length>1&&e.jsx("div",{className:"absolute left-1/2 w-0.5 bg-blue-300 transform -translate-x-0.5",style:{top:"16px",height:`${(w.children.length-1)*112+32}px`}})]})]},w.employee.id)})}),b=()=>e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:x.map(([f,j])=>e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:[e.jsxs("h3",{className:"text-white font-bold flex items-center gap-2",children:[e.jsx(Is,{className:"w-5 h-5"}),f]}),e.jsxs("p",{className:"text-blue-100 text-sm",children:[j.length," employees"]})]}),e.jsx("div",{className:"p-4 space-y-3",children:j.map(w=>e.jsx("div",{onClick:()=>h(w),className:`
                  p-3 rounded-lg cursor-pointer transition-all duration-200
                  hover:bg-blue-50 hover:border-blue-200 border border-transparent
                  ${s?.id===w.id?"bg-blue-50 border-blue-500":""}
                `,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Pe,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[w.profile.firstName," ",w.profile.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:w.employment.position})]})]})},w.id))})]},f))});return n.length?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Ne,{className:"w-8 h-8 text-blue-600"}),"Team Structure"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:r?.role?.id==="hr-manager"?"Complete organizational hierarchy":r?.role?.id==="hod-manager"?"Your team and direct reports":"Team overview"})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>l("tree"),className:`
                px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                ${o==="tree"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}
              `,children:"Hierarchy"}),e.jsx("button",{onClick:()=>l("departments"),className:`
                px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                ${o==="departments"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}
              `,children:"Departments"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-6",children:o==="tree"?e.jsx("div",{className:"max-h-96 overflow-y-auto overflow-x-auto p-4",children:c.length>0?e.jsx("div",{className:"min-w-max pb-8",children:g(c)}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ne,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r?.role?.id==="hod-manager"?"No Team Members Found":"No Organizational Structure"}),e.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:r?.role?.id==="hod-manager"?"You currently have no direct reports assigned to you. Contact HR to add team members.":"There are no employees to display in the organizational hierarchy."}),r?.role?.id==="hod-manager"&&e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"User ID:"})," ",r.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",r.role?.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Employees:"})," ",n.length]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Direct Reports:"})," ",n.filter(f=>f.employment.managerId===r.id).length]})]})]})}):b()})]}):e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 text-center",children:[e.jsx(Ne,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),e.jsx("p",{className:"text-gray-600",children:"Start by adding employees to your organization."})]})},od=({employees:n,onEmployeeSelect:t,onEmployeeEdit:s,onEmployeeDelete:r,onBulkAction:a,selectedEmployee:i,loading:o=!1})=>{const{user:l}=De(),{organization:m}=We(),[c,x]=p.useState([]);p.useEffect(()=>{(async()=>{if(m?.id)try{const H=await ge.queryDocuments(m.id,"users");x(H.documents),d.debug(`📋 Loaded ${H.documents.length} users for manager lookup`)}catch(H){d.error("Failed to load users for manager lookup:",H)}})()},[m?.id]);const u=p.useCallback($=>{if(!$)return"HR Manager";const H=n.find(ee=>ee.id===$);if(H)return`${H.profile.firstName} ${H.profile.lastName}`;const V=c.find(ee=>ee.id===$);if(V){const ee=V.firstName||V.profile?.firstName,Z=V.lastName||V.profile?.lastName,Ee=V.role?.name||V.role?.id;if(ee&&Z)return Ee?`${ee} ${Z} (${Ee})`:`${ee} ${Z}`}return"HR Manager"},[n,c]),[h,v]=p.useState("name"),[g,b]=p.useState("asc"),[f,j]=p.useState(""),[w,C]=p.useState(""),[D,S]=p.useState(""),[y,A]=p.useState(new Set),[R,_]=p.useState(!1),[F,k]=p.useState(1),[E,N]=p.useState(25),I=[{key:"select",label:"",sortable:!1,width:"48px",align:"center"},{key:"name",label:"Employee",sortable:!0,width:"200px"},{key:"employeeNumber",label:"ID",sortable:!0,width:"100px"},{key:"department",label:"Department",sortable:!0,width:"130px"},{key:"position",label:"Position",sortable:!0,width:"130px"},{key:"manager",label:"Manager",sortable:!0,width:"120px"},{key:"contact",label:"Contact",sortable:!1,width:"80px",align:"center"},{key:"startDate",label:"Start Date",sortable:!0,width:"100px"},{key:"status",label:"Status",sortable:!0,width:"100px"},{key:"actions",label:"Actions",sortable:!1,width:"80px",align:"center"}],T=p.useMemo(()=>{const $=new Set(n.map(H=>H.employment.department).filter(Boolean));return Array.from($).sort()},[n]),z=p.useMemo(()=>{let $=n.filter(H=>{const V=[H.profile.firstName,H.profile.lastName,H.profile.employeeNumber,H.employment.department,H.employment.position,H.profile.email].join(" ").toLowerCase(),ee=!f||V.includes(f.toLowerCase()),Z=!w||H.employment.department===w,Ee=!D||(D==="active"?H.isActive:!H.isActive);return ee&&Z&&Ee});return $.sort((H,V)=>{let ee,Z;switch(h){case"name":ee=`${H.profile.firstName} ${H.profile.lastName}`,Z=`${V.profile.firstName} ${V.profile.lastName}`;break;case"department":ee=H.employment.department||"",Z=V.employment.department||"";break;case"position":ee=H.employment.position||"",Z=V.employment.position||"";break;case"manager":ee=u(H.employment.managerId),Z=u(V.employment.managerId);break;case"startDate":const Ee=Ae=>{const de=Ae.employment?.startDate||Ae.profile?.startDate;if(!de)return 0;try{if(de&&typeof de.toDate=="function")return de.toDate().getTime();if(de instanceof Date)return de.getTime();const pe=new Date(de);return isNaN(pe.getTime())?0:pe.getTime()}catch{return 0}};ee=Ee(H),Z=Ee(V);break;case"status":ee=H.isActive?"Active":"Inactive",Z=V.isActive?"Active":"Inactive";break;default:return 0}return ee<Z?g==="asc"?-1:1:ee>Z?g==="asc"?1:-1:0}),$},[n,f,w,D,h,g]),O=p.useMemo(()=>{const $=(F-1)*E;return z.slice($,$+E)},[z,F,E]),q=Math.ceil(z.length/E),Y=p.useCallback($=>{$===h?b(g==="asc"?"desc":"asc"):(v($),b("asc"))},[h,g]),G=p.useCallback($=>{A(H=>{const V=new Set(H);return V.has($)?V.delete($):V.add($),V})},[]),P=p.useCallback(()=>{y.size===O.length?A(new Set):A(new Set(O.map($=>$.id)))},[y.size,O]),L=p.useCallback($=>{const H=n.filter(V=>y.has(V.id));a?.($,H),A(new Set)},[n,y,a]),U=p.useCallback(()=>{const $=["Name","Employee ID","Department","Position","Manager","Email","Phone","Start Date","Status"],H=z.map(Ae=>[`${Ae.profile.firstName} ${Ae.profile.lastName}`,Ae.profile.employeeNumber,Ae.employment.department,Ae.employment.position,u(Ae.employment.managerId),Ae.profile.email||"",Ae.profile.phoneNumber||"",(()=>{const de=Ae.employment?.startDate||Ae.profile?.startDate;if(!de)return"Not set";try{if(de&&typeof de.toDate=="function")return de.toDate().toLocaleDateString();if(de instanceof Date)return de.toLocaleDateString();const pe=new Date(de);return isNaN(pe.getTime())?"Invalid date":pe.toLocaleDateString()}catch{return"Invalid date"}})(),Ae.isActive?"Active":"Inactive"]),V=[$,...H].map(Ae=>Ae.map(de=>`"${de}"`).join(",")).join(`
`),ee=new Blob([V],{type:"text/csv;charset=utf-8;"}),Z=document.createElement("a"),Ee=URL.createObjectURL(ee);Z.setAttribute("href",Ee),Z.setAttribute("download",`employees-${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(Z),Z.click(),document.body.removeChild(Z)},[z]),W=$=>h!==$?null:g==="asc"?e.jsx(Gt,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"});return o?e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map(($,H)=>e.jsx("div",{className:"h-12 bg-gray-200 rounded"},H))})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(ti,{className:"w-6 h-6 text-blue-600"}),"Employee Directory"]}),e.jsxs("p",{className:"text-gray-600 text-sm",children:[z.length," of ",n.length," employees"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:f,onChange:$=>j($.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64"})]}),e.jsxs("button",{onClick:()=>_(!R),className:`
                flex items-center gap-2 px-4 py-2 border rounded-lg transition-colors
                ${R?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}
              `,children:[e.jsx(si,{className:"w-4 h-4"}),"Filters"]}),e.jsxs("button",{onClick:U,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(zs,{className:"w-4 h-4"}),"Export"]})]})]}),R&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),e.jsxs("select",{value:w,onChange:$=>C($.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Departments"}),T.map($=>e.jsx("option",{value:$,children:$},$))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:D,onChange:$=>S($.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Size"}),e.jsxs("select",{value:E,onChange:$=>N(Number($.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"10",children:"10 per page"}),e.jsx("option",{value:"25",children:"25 per page"}),e.jsx("option",{value:"50",children:"50 per page"}),e.jsx("option",{value:"100",children:"100 per page"})]})]})]})}),y.size>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[y.size," employee",y.size!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>L("export"),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Export Selected"}),e.jsx("button",{onClick:()=>L("email"),className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Send Email"})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsx("tr",{children:I.map($=>e.jsx("th",{className:`
                      px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider
                      ${$.align==="center"?"text-center":""}
                      ${$.align==="right"?"text-right":""}
                      ${$.sortable?"cursor-pointer hover:bg-gray-100":""}
                    `,style:{width:$.width},onClick:()=>$.sortable&&Y($.key),children:e.jsx("div",{className:"flex items-center gap-1",children:$.key==="select"?e.jsx("button",{onClick:P,children:y.size===O.length?e.jsx(La,{className:"w-4 h-4 text-blue-600"}):e.jsx($a,{className:"w-4 h-4 text-gray-400"})}):e.jsxs(e.Fragment,{children:[$.label,$.sortable&&W($.key)]})})},$.key))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:O.map($=>e.jsxs("tr",{className:`
                    hover:bg-gray-50 transition-colors cursor-pointer
                    ${i?.id===$.id?"bg-blue-50":""}
                    ${y.has($.id)?"bg-blue-25":""}
                  `,onClick:()=>t?.($),children:[e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:H=>{H.stopPropagation(),G($.id)},children:y.has($.id)?e.jsx(La,{className:"w-4 h-4 text-blue-600"}):e.jsx($a,{className:"w-4 h-4 text-gray-400"})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Pe,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[$.profile.firstName," ",$.profile.lastName]}),e.jsx("div",{className:"text-sm text-gray-500",children:$.profile.employeeNumber})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono text-gray-900",children:$.profile.employeeNumber}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Is,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:$.employment.department})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:$.employment.position}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:u($.employment.managerId)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[$.profile.email&&e.jsx(Rt,{className:"w-4 h-4 text-green-600",title:`Email: ${$.profile.email}`}),$.profile.phoneNumber&&e.jsx($s,{className:"w-4 h-4 text-blue-600",title:`Phone: ${$.profile.phoneNumber}`}),!$.profile.email&&!$.profile.phoneNumber&&e.jsx("span",{className:"text-sm text-gray-400",children:"—"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-900",children:(()=>{const H=$.employment?.startDate||$.profile?.startDate;if(!H)return"Not set";try{if(H&&typeof H.toDate=="function")return H.toDate().toLocaleDateString();if(H instanceof Date)return H.toLocaleDateString();const V=new Date(H);return isNaN(V.getTime())?"Invalid date":V.toLocaleDateString()}catch{return"Invalid date"}})()})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`
                      inline-flex px-2 py-1 text-xs font-medium rounded-full
                      ${$.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}
                    `,children:$.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:H=>{H.stopPropagation(),s?.($)},className:"p-1 text-gray-400 hover:text-blue-600 transition-colors",children:e.jsx(Ir,{className:"w-4 h-4"})}),e.jsx("button",{onClick:H=>{H.stopPropagation(),t?.($)},className:"p-1 text-gray-400 hover:text-green-600 transition-colors",children:e.jsx(ut,{className:"w-4 h-4"})})]})})]},$.id))})]})}),q>1&&e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(F-1)*E+1," to ",Math.min(F*E,z.length)," of ",z.length," results"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(Math.max(1,F-1)),disabled:F===1,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),Array.from({length:Math.min(5,q)},($,H)=>{const V=Math.max(1,F-2)+H;return V>q?null:e.jsx("button",{onClick:()=>k(V),className:`
                        px-3 py-1 border rounded text-sm transition-colors
                        ${V===F?"bg-blue-600 border-blue-600 text-white":"border-gray-300 hover:bg-gray-50"}
                      `,children:V},V)}),e.jsx("button",{onClick:()=>k(Math.min(q,F+1)),disabled:F===q,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})})]}),z.length===0&&e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[e.jsx(Pe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:f||w||D?"Try adjusting your search or filter criteria.":"Start by adding employees to your organization."}),(f||w||D)&&e.jsx("button",{onClick:()=>{j(""),C(""),S("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Clear Filters"})]})]})},ld=()=>{const{user:n,organization:t}=De(),{employees:s,loading:r,error:a,refreshData:i}=Yr({role:"hod"}),o=Lt.useMemo(()=>!s||s.length===0?[]:s.map(N=>({id:N.id,organizationId:t?.id||"",isActive:!0,createdAt:new Date,updatedAt:new Date,profile:{firstName:N.firstName,lastName:N.lastName,email:N.email,department:N.department,employeeNumber:N.employeeNumber||N.id,phoneNumber:N.phone,position:N.position,startDate:new Date},employment:{startDate:new Date,department:N.department,position:N.position,contractType:N.contractType||"full-time"},disciplinaryRecord:{totalWarnings:N.recentWarnings?.count||0,activeWarnings:N.recentWarnings?.count||0,currentLevel:"none",warningHistory:[],warningsByCategory:{}},deliveryPreferences:{primaryMethod:"email",allowAlternativeMethods:!0,whatsappConsent:!1,emailConsent:!0,printConsent:!1,lastUpdated:new Date},_original:N})),[s,t?.id]),{filters:l,setFilters:m,filteredEmployees:c}=wi(o,n);Lt.useEffect(()=>{console.log("🔍 [MobileEmployeeManagement] Data status:",{organizationId:t?.id,userId:n?.id,loading:r?.overall||r?.employees||!1,error:a,employeesCount:o.length,filteredCount:c.length,filters:l,rawDashboardEmployees:s,transformedEmployees:o.map(N=>({id:N.id,name:`${N.profile?.firstName||"Unknown"} ${N.profile?.lastName||"Unknown"}`,isActive:N.isActive,hasProfile:!!N.profile,profileDepartment:N.profile?.department,rawEmployee:N})),filteredEmployees:c.map(N=>({id:N.id,name:`${N.profile?.firstName||"Unknown"} ${N.profile?.lastName||"Unknown"}`,isActive:N.isActive,hasProfile:!!N.profile})),userRole:n?.role?.id,userDepartments:n?.departmentIds})},[t?.id,n?.id,r,a,o,c,l,s,n]);const[x,u]=p.useState("list"),[h,v]=p.useState(!1),[g,b]=p.useState(!1),[f,j]=p.useState(null),[w,C]=p.useState(null),[D,S]=p.useState(!1),[y,A]=p.useState(""),R=Xr(n?.role.id,n?.departmentIds),_=p.useMemo(()=>{const N=c.length,I=c.filter(z=>z.isActive).length,T=c.filter(z=>z.disciplinaryRecord?.activeWarnings>0).length;return{total:N,active:I,warnings:T}},[c]),F=async()=>{i(),v(!1),j(null)},k=async N=>{C(null),i()};return r?.overall||r?.employees||!1?e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading employees..."})]})}):e.jsxs("div",{className:"w-full space-y-3 p-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-white"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-bold text-white",children:"Employee Directory"}),e.jsxs("p",{className:"text-blue-100 text-xs",children:[_.total," of ",o.length," employees"]})]})]}),e.jsx("div",{className:"flex gap-1",children:R.canCreate&&e.jsx("button",{onClick:()=>v(!0),className:"p-2 bg-white/20 hover:bg-white/30 text-white rounded-lg",children:e.jsx(gt,{className:"w-4 h-4"})})})]})}),e.jsxs("div",{className:"flex items-center justify-around p-3 bg-gray-50 border-b",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:_.total}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:_.active}),e.jsx("div",{className:"text-xs text-gray-600",children:"Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:_.warnings}),e.jsx("div",{className:"text-xs text-gray-600",children:"Warnings"})]})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(as,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:y,onChange:N=>A(N.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("button",{onClick:()=>S(!D),className:`px-3 py-2 rounded-lg border ${D?"bg-blue-50 border-blue-200":"bg-white border-gray-300"}`,children:e.jsx(si,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>u("list"),className:`p-1 rounded ${x==="list"?"bg-white shadow-sm":""}`,children:e.jsx(yo,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u("grid"),className:`p-1 rounded ${x==="grid"?"bg-white shadow-sm":""}`,children:e.jsx(vo,{className:"w-4 h-4"})})]})]}),D&&e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg space-y-2",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 mb-1 block",children:"Status"}),e.jsxs("select",{value:l.isActive?"active":"all",onChange:N=>m({...l,isActive:N.target.value==="active"}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Employees"}),e.jsx("option",{value:"active",children:"Active Only"})]})]})})]})]}),a&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsx("p",{className:"text-red-800 text-sm",children:a})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:c.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"👥"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No employees found"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:o.length===0?"Add your first employee to get started":"Try adjusting your search criteria"}),R.canCreate&&o.length===0&&e.jsxs("button",{onClick:()=>v(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium text-sm",children:[e.jsx(gt,{className:"w-4 h-4"}),"Add First Employee"]})]}):x==="list"?e.jsx("div",{className:"divide-y",children:c.map(N=>e.jsx("div",{className:`p-3 transition-colors ${R.canEdit?"hover:bg-gray-50 cursor-pointer":"cursor-default"}`,onClick:()=>R.canEdit?j(N):null,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"text-blue-600 font-medium text-sm",children:[N.profile.firstName?.charAt(0),N.profile.lastName?.charAt(0)]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[N.profile.firstName," ",N.profile.lastName]}),e.jsx("div",{className:"text-sm text-gray-600",children:N.employment.position})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`inline-block px-2 py-1 rounded-full text-xs ${N.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:N.isActive?"Active":"Inactive"})})]})},N.id))}):e.jsx("div",{className:"grid grid-cols-1 gap-3 p-3",children:c.map(N=>e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-3 transition-shadow ${R.canEdit?"hover:shadow-md cursor-pointer":"cursor-default"}`,onClick:()=>R.canEdit?j(N):null,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[N.profile.firstName," ",N.profile.lastName]}),e.jsx("div",{className:`px-2 py-1 rounded text-xs ${N.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:N.isActive?"Active":"Inactive"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("div",{children:N.employment.position}),e.jsx("div",{children:N.profile.email})]})]},N.id))})}),c.length>0&&e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3",children:e.jsxs("button",{className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium",children:[e.jsx(Ke,{className:"w-4 h-4"}),"Export (",c.length," employees)"]})}),(h||f)&&e.jsx(ji,{employee:f,onClose:()=>{v(!1),j(null)},onSave:F,basicMode:!f&&!R.canEdit}),g&&e.jsx(Ni,{onClose:()=>b(!1),onImportComplete:i}),w&&e.jsx(Ci,{employee:w,onClose:()=>C(null),onArchive:k})]})},at=({width:n="100%",height:t="1rem",className:s=""})=>e.jsx("div",{className:`bg-gray-200 rounded animate-pulse legacy-simple-layout ${s}`,style:{width:n,height:t}}),cd=({rows:n=5})=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg legacy-simple-layout",children:[e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(at,{width:"150px",height:"16px"}),e.jsx(at,{width:"120px",height:"16px"}),e.jsx(at,{width:"100px",height:"16px"}),e.jsx(at,{width:"80px",height:"16px"})]})}),Array.from({length:n}).map((t,s)=>e.jsx("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(at,{width:"150px",height:"14px"}),e.jsx(at,{width:"120px",height:"14px"}),e.jsx(at,{width:"100px",height:"14px"}),e.jsx(at,{width:"80px",height:"14px"})]})},s))]}),dd=()=>e.jsx("div",{className:"grid grid-cols-1 gap-4 legacy-simple-layout",children:Array.from({length:4}).map((n,t)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(at,{width:"60px",height:"14px"}),e.jsx(at,{width:"24px",height:"24px",className:"rounded"})]}),e.jsx(at,{width:"40px",height:"24px",className:"mb-1"}),e.jsx(at,{width:"80px",height:"12px"})]},t))}),md=()=>e.jsxs("div",{className:"space-y-4 legacy-simple-layout",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(at,{width:"32px",height:"32px",className:"rounded"}),e.jsxs("div",{children:[e.jsx(at,{width:"120px",height:"18px",className:"mb-1"}),e.jsx(at,{width:"80px",height:"14px"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(at,{width:"80px",height:"36px",className:"rounded"}),e.jsx(at,{width:"80px",height:"36px",className:"rounded"})]})]})}),e.jsx(dd,{}),e.jsx(cd,{rows:3})]}),ud=({message:n="Loading..."})=>e.jsxs("div",{className:"text-center py-8 legacy-simple-layout",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),e.jsx("p",{className:"text-gray-600 legacy-text-size",children:n}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This may take a moment on slower connections"})]}),Jr=()=>{const{user:n,organization:t}=De();if(window.innerWidth<768)return e.jsx(ld,{});const r=n?.role?.id==="hod-manager",a=t?.id,{employees:i,loading:o,loadingMore:l,error:m,loadEmployees:c,loadMoreEmployees:x,archiveEmployee:u,pagination:h}=Xc(a,r?n?.id:void 0),{filters:v,setFilters:g,filteredEmployees:b}=wi(i,n),f=p.useMemo(()=>Na(Et||{isLegacyDevice:!1}),[]),[j,w]=p.useState(1),C=Et?.isLegacyDevice?f.employeeListLimit:50,D=p.useMemo(()=>{if(!Et?.isLegacyDevice)return b;const V=(j-1)*C,ee=V+C;return b.slice(V,ee)},[b,j,C,Et?.isLegacyDevice]),S=Math.ceil(b.length/C),[y,A]=p.useState("table"),[R,_]=p.useState(!1),[F,k]=p.useState(!1),[E,N]=p.useState(null),[I,T]=p.useState(null),[z,O]=p.useState(null),[q,Y]=p.useState(null),G=Xr(n?.role.id,n?.departmentIds),P=async()=>{await c(),_(!1),N(null)},L=async V=>{await u(V),T(null)},U=p.useCallback(V=>{O(V)},[]),W=p.useCallback(V=>{N(V)},[]),$=p.useCallback(V=>{T(V)},[]),H=p.useCallback((V,ee)=>{switch(V){case"export":console.log("Exporting employees:",ee);break;case"email":console.log("Sending email to employees:",ee);break;default:console.log("Bulk action:",V,ee)}},[]);return o?Et?.isLegacyDevice?e.jsxs("div",{className:"w-full p-4",children:[e.jsx(ud,{message:"Loading Employees..."}),e.jsx("div",{className:"mt-4",children:e.jsx(md,{})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-3xl shadow-2xl border border-slate-200 max-w-md w-full",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto mb-6"}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Loading Employees"}),e.jsx("p",{className:"text-slate-600",children:"Fetching your team data..."})]})}):e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 overflow-hidden",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 via-purple-700 to-indigo-800 p-2 sm:p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx("div",{className:"bg-white/20 p-1.5 sm:p-2 rounded-lg backdrop-blur-sm",children:e.jsx(Ne,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-bold text-white tracking-tight",children:"Employee Management"}),e.jsx("p",{className:"text-indigo-100 text-xs font-medium",children:Et?.isLegacyDevice?`${D.length} of ${b.length} employees`:`${b.length} employees`})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2",children:[G.canCreate&&e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-1 sm:gap-2 px-2 py-1.5 sm:px-3 sm:py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-medium border border-white/30 hover:border-white/50 transition-all text-sm",children:[e.jsx(gt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Add"})]}),G.canBulkImport&&e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-1 sm:gap-2 px-2 py-1.5 sm:px-3 sm:py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[e.jsx(ja,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Import"})]}),G.canViewArchived&&e.jsxs("button",{onClick:()=>A("archive"),className:"flex items-center gap-1 sm:gap-2 px-2 py-1.5 sm:px-3 sm:py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Archive"})]})]})]})})}),m&&e.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-red-600 text-lg",children:"⚠️"}),e.jsx("p",{className:"text-red-800 font-medium text-sm",children:m})]})}),e.jsx(Jc,{employees:b}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-slate-600",children:n?.role?.id==="hr-manager"?"Full organizational view":n?.role?.id==="hod-manager"?"Your team structure":"Team directory"}),e.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>A("organogram"),className:`flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs ${y==="organogram"?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(bo,{className:"w-3 h-3"}),e.jsx("span",{children:"Hierarchy"})]}),e.jsxs("button",{onClick:()=>A("table"),className:`flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs ${y==="table"?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(ti,{className:"w-3 h-3"}),e.jsx("span",{children:"Table"})]}),e.jsxs("button",{onClick:()=>A("cards"),className:`flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs ${y==="cards"?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"}`,children:[e.jsx(wo,{className:"w-3 h-3"}),e.jsx("span",{children:"Cards"})]})]})]}),y==="cards"&&e.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg shadow-md border border-white/50 p-3",children:e.jsx(ed,{filters:v,setFilters:g,departments:[...new Set(i.map(V=>V.employment.department))],viewMode:y,setViewMode:A})}),y==="organogram"&&e.jsx(id,{employees:b,onEmployeeClick:U,selectedEmployee:z}),y==="table"&&e.jsx(od,{employees:D,onEmployeeSelect:U,onEmployeeEdit:W,onEmployeeDelete:$,onBulkAction:H,selectedEmployee:z,loading:o}),y==="cards"&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:D.map(V=>e.jsx(td,{employee:V,permissions:G,onEdit:N,onArchive:T},V.id))}),Et?.isLegacyDevice&&S>1&&e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 legacy-text-size",children:["Page ",j," of ",S," (",b.length," total employees)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>w(V=>Math.max(1,V-1)),disabled:j===1,className:`px-3 py-2 rounded-md legacy-touch-target legacy-text-size ${j===1?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,children:"Previous"}),e.jsxs("div",{className:"flex items-center px-3 py-2 text-sm text-gray-600 legacy-text-size",children:[Math.max(1,j-1),"-",Math.min(S,j+1)]}),e.jsx("button",{onClick:()=>w(V=>Math.min(S,V+1)),disabled:j===S,className:`px-3 py-2 rounded-md legacy-touch-target legacy-text-size ${j===S?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,children:"Next"})]})]})}),y==="archive"&&e.jsx(ad,{onBack:()=>A("table"),onEmployeeRestored:()=>c(!0)}),y==="cards"&&h.canLoadMore&&!o&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("button",{onClick:x,disabled:l,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 disabled:from-slate-400 disabled:to-slate-500 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Loading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ke,{className:"w-4 h-4"}),e.jsxs("span",{children:["Load More (",i.length,")"]})]})}),e.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Page ",h.currentPage," • ",h.pageSize," per page"]})]}),z&&e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg shadow-lg border border-white/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5 text-blue-600"}),"Selected Employee"]}),e.jsx("button",{onClick:()=>O(null),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Name:"})," ",z.profile.firstName," ",z.profile.lastName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",z.profile.employeeNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",z.profile.email]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Phone:"})," ",z.profile.phoneNumber||"Not provided"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Employment Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",z.employment.department]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Position:"})," ",z.employment.position]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Start Date:"})," ",(()=>{const V=z.employment?.startDate||z.profile?.startDate;if(!V)return"Not set";try{if(V&&typeof V.toDate=="function")return V.toDate().toLocaleDateString();if(V instanceof Date)return V.toLocaleDateString();const ee=new Date(V);return isNaN(ee.getTime())?"Invalid date":ee.toLocaleDateString()}catch{return"Invalid date"}})()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Status:"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${z.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z.isActive?"Active":"Inactive"})]})]})]})]}),G.canEdit&&e.jsxs("div",{className:"flex gap-3 mt-6 pt-4 border-t",children:[e.jsx("button",{onClick:()=>W(z),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Edit Employee"}),(n?.role?.id==="hr-manager"||n?.role?.id==="business-owner")&&e.jsxs("button",{onClick:()=>Y(z),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(qt,{className:"w-4 h-4"}),"Promote to Manager"]}),e.jsx("button",{onClick:()=>$(z),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Archive Employee"})]})]}),!o&&b.length===0&&e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-6 text-center shadow-lg border border-white/50",children:[e.jsx("div",{className:"text-3xl mb-3",children:"👥"}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:i.length===0?"No employees yet":"No matching employees"}),e.jsx("p",{className:"text-slate-600 mb-4 text-sm",children:i.length===0?"Add your first employee or import from CSV":"Try adjusting your search criteria"}),G.canCreate&&i.length===0&&e.jsxs("button",{onClick:()=>_(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[e.jsx(gt,{className:"w-4 h-4"}),"Add First Employee"]})]}),(R||E)&&e.jsx(ji,{employee:E,onClose:()=>{_(!1),N(null)},onSave:P}),F&&e.jsx(Ni,{onClose:()=>k(!1),onImportComplete:c}),I&&e.jsx(Ci,{employee:I,onClose:()=>T(null),onArchive:L}),q&&t&&e.jsx(nd,{isOpen:!0,onClose:()=>Y(null),employee:q,organizationId:t.id,onSuccess:()=>{c(),Y(null)}})]})},hm=Object.freeze(Object.defineProperty({__proto__:null,EmployeeManagement:Jr},Symbol.toStringTag,{value:"Module"})),xd=({physicalCopyLocation:n,className:t=""})=>e.jsx(ne,{className:`bg-amber-50 dark:bg-amber-900/20 border-2 border-amber-500 ${t}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center",children:e.jsx(me,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-amber-900 dark:text-amber-100",children:"⚠️ IMPORTANT: Physical Copy Required"}),e.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200 mt-1",children:"This warning was entered manually from a physical document"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-amber-300 dark:border-amber-700",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"The system does NOT have:"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500 font-bold",children:"✗"}),e.jsx("span",{children:"Digital signatures from manager and employee"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500 font-bold",children:"✗"}),e.jsx("span",{children:"Audio recording of the disciplinary meeting"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-500 font-bold",children:"✗"}),e.jsx("span",{children:"PDF document with QR code verification"})]})]})]}),e.jsxs("div",{className:"bg-amber-100 dark:bg-amber-900/40 rounded-lg p-4 border border-amber-400 dark:border-amber-600",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(Se,{className:"w-5 h-5 text-amber-700 dark:text-amber-300 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm font-semibold text-amber-900 dark:text-amber-100",children:"Legal Compliance Requirement:"})]}),e.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200 ml-7",children:["You ",e.jsx("strong",{children:"MUST"})," keep the original signed physical document safe and accessible for potential legal proceedings or CCMA hearings. This digital record is supplementary only."]})]}),n&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-amber-300 dark:border-amber-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Physical Copy Location:"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-900 px-3 py-2 rounded border border-gray-200 dark:border-gray-700",children:n})]})]})}),e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 italic border-t border-amber-300 dark:border-amber-700 pt-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Historical entries are fully integrated with the escalation system and will count toward the employee's progressive discipline record."]})})]})}),Ln=({value:n,onChange:t,min:s,max:r,label:a,className:i=""})=>{const[o,l]=p.useState(!1),m=p.useRef(null),c=()=>{const h=[];for(let v=s;v<=r;v++)h.push(v);return h},x=h=>{t(h),l(!1)};p.useEffect(()=>{if(o&&m.current){const h=m.current,v=n-s,g=48,b=v*g-h.clientHeight/2+g/2;setTimeout(()=>{h.scrollTo({top:Math.max(0,b),behavior:"smooth"})},100)}},[o,n,s]);const u=c();return e.jsxs("div",{className:`relative ${i}`,children:[e.jsx("div",{onClick:()=>l(!o),className:"w-24 h-20 cursor-pointer border-2 rounded-2xl flex items-center justify-center transition-all duration-200 hover:scale-105",style:{backgroundColor:"var(--color-card-background)",borderColor:o?"var(--color-primary)":"var(--color-border)",boxShadow:o?"0 0 0 3px var(--color-primary-light)":"0 4px 12px rgba(0, 0, 0, 0.08)"},children:e.jsx("span",{className:"text-3xl font-light",style:{color:"var(--color-text)",fontVariantNumeric:"tabular-nums"},children:n.toString().padStart(2,"0")})}),o&&e.jsx("div",{className:"absolute top-full left-0 mt-2 w-24 bg-white border-2 rounded-2xl shadow-lg z-10 overflow-hidden",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-primary)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.15)"},children:e.jsx("div",{ref:m,className:"max-h-48 overflow-y-auto scrollbar-thin",style:{scrollbarWidth:"thin",scrollbarColor:"var(--color-primary) transparent"},children:u.map(h=>e.jsx("button",{onClick:()=>x(h),className:"w-full h-12 flex items-center justify-center transition-all duration-150 hover:scale-105",style:{backgroundColor:h===n?"var(--color-primary-light)":"transparent",color:h===n?"var(--color-primary)":"var(--color-text)",fontWeight:h===n?"600":"400",fontVariantNumeric:"tabular-nums"},onMouseEnter:v=>{h!==n&&(v.currentTarget.style.backgroundColor="var(--color-muted)")},onMouseLeave:v=>{h!==n&&(v.currentTarget.style.backgroundColor="transparent")},children:e.jsx("span",{className:"text-lg",children:h.toString().padStart(2,"0")})},h))})}),e.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2",children:e.jsx("span",{className:"text-xs font-medium tracking-wider uppercase",style:{color:"var(--color-text-tertiary)"},children:a})})]})},Ls=({label:n,value:t,onChange:s,type:r="date",icon:a,required:i=!1,disabled:o=!1,error:l,className:m=""})=>{const[c,x]=p.useState(!1),[u,h]=p.useState(t?new Date(t):null),[v,g]=p.useState(new Date),[b,f]=p.useState({hours:t?new Date(`1970-01-01T${t}`).getHours():9,minutes:t?new Date(`1970-01-01T${t}`).getMinutes():0}),j=p.useRef(null),w=p.useRef(null);p.useEffect(()=>{const k=E=>{w.current&&!w.current.contains(E.target)&&j.current&&!j.current.contains(E.target)&&x(!1)};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]),p.useEffect(()=>(c?(setTimeout(()=>{const k=w.current;k&&k.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[c]);const C=()=>r==="time"?t||"Select time...":u?u.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Select date...",D=k=>{h(k);const E=k.toISOString().split("T")[0];s(E),x(!1)},S=(k,E)=>{f({hours:k,minutes:E});const N=`${k.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`;s(N)},A=(()=>{const k=v.getFullYear(),E=v.getMonth(),N=new Date(k,E,1),I=new Date(N);I.setDate(I.getDate()-N.getDay());const T=[];for(let z=0;z<42;z++){const O=new Date(I);O.setDate(I.getDate()+z),T.push(O)}return T})(),R=new Date,_=["Su","Mo","Tu","We","Th","Fr","Sa"],F={backgroundColor:l?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:l?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"};return e.jsxs("div",{className:`space-y-2 ${m}`,children:[e.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[a&&e.jsx(a,{className:"w-3 h-3 inline mr-1"}),n," ",i&&e.jsx("span",{style:{color:"var(--color-error)"},children:"*"})]}),e.jsxs("div",{className:"relative",ref:j,children:[e.jsxs("div",{onClick:()=>!o&&x(!c),className:`w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm cursor-pointer flex items-center justify-between ${o?"opacity-50 cursor-not-allowed":""}`,style:F,children:[e.jsx("span",{style:{color:t?"var(--color-text)":"var(--color-text-tertiary)"},children:C()}),r==="date"?e.jsx(tt,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}):e.jsx(Re,{className:"w-4 h-4",style:{color:"var(--color-primary)"}})]}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>x(!1)}),e.jsx("div",{ref:w,className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:k=>k.stopPropagation(),children:r==="date"?e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:()=>g(new Date(v.setMonth(v.getMonth()-1))),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",style:{color:"var(--color-text-secondary)"},children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsx("h3",{className:"font-semibold text-center flex-1",style:{color:"var(--color-text)"},children:v.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>g(new Date(v.setMonth(v.getMonth()+1))),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",style:{color:"var(--color-text-secondary)"},children:e.jsx(_t,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:_.map(k=>e.jsx("div",{className:"text-xs font-medium text-center p-2",style:{color:"var(--color-text-secondary)"},children:k},k))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:A.map((k,E)=>{const N=k.getMonth()===v.getMonth(),I=k.toDateString()===R.toDateString(),T=u&&k.toDateString()===u.toDateString();return e.jsx("button",{onClick:()=>N&&D(k),disabled:!N,className:`p-2 text-sm rounded-lg transition-all ${N?"hover:bg-gray-100 cursor-pointer":"opacity-30 cursor-not-allowed"}`,style:{backgroundColor:T?"var(--color-primary)":I?"var(--color-primary-light)":"transparent",color:T?"white":I?"var(--color-primary)":"var(--color-text)",fontWeight:I||T?"600":"400"},children:k.getDate()},E)})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("button",{onClick:()=>D(R),className:"px-4 py-2 text-sm rounded-lg border transition-colors",style:{borderColor:"var(--color-primary)",color:"var(--color-primary)",backgroundColor:"transparent"},children:"Today"})})]}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h3",{className:"text-lg font-light tracking-wide",style:{color:"var(--color-text)",letterSpacing:"0.5px"},children:"Select Time"})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 mb-8",children:[e.jsx(Ln,{value:b.hours,onChange:k=>S(k,b.minutes),min:0,max:23,label:"Hours"}),e.jsxs("div",{className:"flex flex-col items-center self-start mt-12",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mb-3",style:{backgroundColor:"var(--color-primary)"}}),e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--color-primary)"}})]}),e.jsx(Ln,{value:b.minutes,onChange:k=>S(b.hours,k),min:0,max:59,label:"Minutes"})]}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full",style:{backgroundColor:"var(--color-muted)"},children:[e.jsx(Re,{className:"w-4 h-4 mr-2",style:{color:"var(--color-text-secondary)"}}),e.jsxs("span",{className:"text-lg font-medium tracking-wider",style:{color:"var(--color-text)",fontVariantNumeric:"tabular-nums"},children:[b.hours.toString().padStart(2,"0"),":",b.minutes.toString().padStart(2,"0")]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>x(!1),className:"px-8 py-3 rounded-xl font-medium tracking-wide transition-all duration-200 transform hover:scale-105 active:scale-95",style:{backgroundColor:"var(--color-primary)",color:"white",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.15)",letterSpacing:"0.5px"},onMouseEnter:k=>{k.currentTarget.style.boxShadow="0 6px 24px rgba(0, 0, 0, 0.2)"},onMouseLeave:k=>{k.currentTarget.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.15)"},children:"Done"})})]})})})]})]}),l&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[e.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),l]})]})},hd=["Select Employee & Category","Enter Dates & Details","Physical Copy Confirmation","Review & Save"],$n={counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},gd=({isOpen:n,onClose:t,onSuccess:s,employees:r,categories:a,preSelectedEmployeeId:i,currentUserId:o,organizationId:l})=>{const[m,c]=p.useState(0),[x,u]=p.useState(!1),[h,v]=p.useState(null),[g,b]=p.useState({employeeId:i||"",categoryId:"",level:"",incidentDate:null,incidentTime:"09:00",issueDate:null,expiryDate:null,validityPeriod:6,title:"",description:"",incidentLocation:"",additionalNotes:"",hasPhysicalCopy:!1,physicalCopyLocation:"",historicalNotes:""}),f=p.useMemo(()=>r.find(k=>k.id===g.employeeId),[r,g.employeeId]),j=p.useMemo(()=>a.find(k=>k.id===g.categoryId),[a,g.categoryId]),w=p.useMemo(()=>j?.escalationPath?j.escalationPath:["counselling","verbal","first_written","second_written","final_written"],[j]),C=p.useCallback((k,E)=>{if(!k)return null;const N=new Date(k);return N.setMonth(N.getMonth()+E),N},[]),D=p.useCallback((k,E)=>{b(N=>{const I={...N,[k]:E};if(k==="issueDate"||k==="validityPeriod"){const T=k==="issueDate"?E:N.issueDate,z=k==="validityPeriod"?E:N.validityPeriod;I.expiryDate=C(T,z)}return I})},[C]),S=p.useCallback(k=>{switch(k){case 0:return g.employeeId?g.categoryId?g.level?{isValid:!0}:{isValid:!1,error:"Please select a warning level"}:{isValid:!1,error:"Please select a category"}:{isValid:!1,error:"Please select an employee"};case 1:return g.incidentDate?g.issueDate?g.title.trim()?g.description.trim()?g.incidentLocation.trim()?g.issueDate>new Date?{isValid:!1,error:"Issue date cannot be in the future"}:g.expiryDate&&g.expiryDate<=g.issueDate?{isValid:!1,error:"Expiry date must be after issue date"}:{isValid:!0}:{isValid:!1,error:"Please enter incident location"}:{isValid:!1,error:"Please enter incident description"}:{isValid:!1,error:"Please enter a warning title"}:{isValid:!1,error:"Please enter issue date"}:{isValid:!1,error:"Please enter incident date"};case 2:return g.hasPhysicalCopy?{isValid:!0}:{isValid:!1,error:"You must confirm that a physical signed copy exists"};case 3:return{isValid:!0};default:return{isValid:!1}}},[g]),y=p.useCallback(()=>{const k=S(m);if(!k.isValid){v(k.error||"Please complete all required fields");return}v(null),c(E=>Math.min(E+1,3))},[m,S]),A=p.useCallback(()=>{v(null),c(k=>Math.max(k-1,0))},[]),R=p.useCallback(async()=>{const k=S(2);if(!k.isValid){v(k.error||"Please complete all required fields");return}u(!0),v(null);try{const{ShardedDataService:E}=await nt(async()=>{const{ShardedDataService:I}=await Promise.resolve().then(()=>$o);return{ShardedDataService:I}},void 0),N={employeeId:g.employeeId,categoryId:g.categoryId,level:g.level,incidentDate:g.incidentDate,incidentTime:g.incidentTime,issueDate:g.issueDate,expiryDate:g.expiryDate,validityPeriod:g.validityPeriod,title:g.title,description:g.description,incidentLocation:g.incidentLocation,additionalNotes:g.additionalNotes,isHistoricalEntry:!0,hasPhysicalCopy:g.hasPhysicalCopy,physicalCopyLocation:g.physicalCopyLocation,historicalNotes:g.historicalNotes,enteredBy:o,enteredAt:new Date,issuedBy:o,status:"issued",isActive:!0,deliveryStatus:"delivered",followUpActions:[]};await E.createWarning(N,l),s(),t()}catch(E){console.error("Error creating historical warning:",E),v(E instanceof Error?E.message:"Failed to create warning")}finally{u(!1)}},[g,o,l,s,t,S]),_=p.useCallback(()=>{x||(c(0),v(null),b({employeeId:i||"",categoryId:"",level:"",incidentDate:null,incidentTime:"09:00",issueDate:null,expiryDate:null,validityPeriod:6,title:"",description:"",incidentLocation:"",additionalNotes:"",hasPhysicalCopy:!1,physicalCopyLocation:"",historicalNotes:""}),t())},[x,t,i]),F=()=>{switch(m){case 0:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Tt,{icon:Pe,title:"Select Employee",subtitle:"Choose the employee who received this warning"}),e.jsxs("select",{value:g.employeeId,onChange:k=>D("employeeId",k.target.value),className:"w-full h-11 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Select Employee --"}),r.map(k=>e.jsxs("option",{value:k.id,children:[k.profile.firstName," ",k.profile.lastName," (",k.profile.employeeNumber,")"]},k.id))]})]}),e.jsxs("div",{children:[e.jsx(Tt,{icon:No,title:"Select Category",subtitle:"Choose the violation category"}),e.jsxs("select",{value:g.categoryId,onChange:k=>D("categoryId",k.target.value),className:"w-full h-11 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Select Category --"}),a.map(k=>e.jsx("option",{value:k.id,children:k.name},k.id))]})]}),g.categoryId&&e.jsxs("div",{children:[e.jsx(Tt,{icon:me,title:"Warning Level",subtitle:"Select the severity level given in the original warning"}),e.jsxs("select",{value:g.level,onChange:k=>D("level",k.target.value),className:"w-full h-11 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Select Level --"}),w.map(k=>e.jsx("option",{value:k,children:$n[k]||k},k))]})]})]});case 1:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(Tt,{icon:tt,title:"Incident Date",subtitle:"When did the incident occur?"}),e.jsx(Ls,{selectedDate:g.incidentDate,onChange:k=>D("incidentDate",k),maxDate:new Date})]}),e.jsx(Rs,{icon:Re,label:"Incident Time",type:"time",value:g.incidentTime,onChange:k=>D("incidentTime",k.target.value)}),e.jsxs("div",{children:[e.jsx(Tt,{icon:jo,title:"Issue Date",subtitle:"When was the warning issued?"}),e.jsx(Ls,{selectedDate:g.issueDate,onChange:k=>D("issueDate",k),maxDate:new Date})]}),e.jsxs("div",{children:[e.jsx(Tt,{icon:Re,title:"Validity Period",subtitle:"How long is this warning active?"}),e.jsxs("select",{value:g.validityPeriod,onChange:k=>D("validityPeriod",parseInt(k.target.value)),className:"w-full h-11 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent",children:[e.jsx("option",{value:3,children:"3 months"}),e.jsx("option",{value:6,children:"6 months"}),e.jsx("option",{value:12,children:"12 months"})]}),g.expiryDate&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Will expire on: ",g.expiryDate.toLocaleDateString()]})]}),e.jsx(Rs,{icon:ye,label:"Warning Title",placeholder:"Brief summary of the warning",value:g.title,onChange:k=>D("title",k.target.value)}),e.jsx(Rs,{icon:rs,label:"Incident Location",placeholder:"Where did the incident occur?",value:g.incidentLocation,onChange:k=>D("incidentLocation",k.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Incident Description *"}),e.jsx("textarea",{value:g.description,onChange:k=>D("description",k.target.value),rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Notes (Optional)"}),e.jsx("textarea",{value:g.additionalNotes,onChange:k=>D("additionalNotes",k.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Any additional context or notes..."})]})]});case 2:return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g.hasPhysicalCopy,onChange:k=>D("hasPhysicalCopy",k.target.checked),className:"w-5 h-5 mt-0.5 rounded border-gray-300 text-primary focus:ring-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"I confirm the physical signed copy exists"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Required: You must have access to the original signed warning document"})]})]})})}),g.hasPhysicalCopy&&e.jsx(Rs,{icon:ye,label:"Physical Copy Location (Optional)",placeholder:"e.g., Filing Cabinet A3, HR Office",value:g.physicalCopyLocation,onChange:k=>D("physicalCopyLocation",k.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Historical Entry Notes (Optional)"}),e.jsx("textarea",{value:g.historicalNotes,onChange:k=>D("historicalNotes",k.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Any additional context about this historical entry..."})]}),e.jsx(xd,{physicalCopyLocation:g.physicalCopyLocation||void 0})]});case 3:return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ne,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-2",children:"Warning Summary"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Employee:"}),e.jsxs("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:[f?.profile.firstName," ",f?.profile.lastName]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Category:"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:j?.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Level:"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:$n[g.level]||g.level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Validity:"}),e.jsxs("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:[g.validityPeriod," months"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Incident Date:"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:g.incidentDate?.toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Issue Date:"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:g.issueDate?.toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Title:"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:g.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Description:"}),e.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:g.description})]})]})]})}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 dark:text-red-100 mb-1",children:"This warning has NO digital signatures or audio recording"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:"Ensure the physical signed document is kept safe for legal compliance"})]})]})})]});default:return null}};return e.jsxs(Bs,{isOpen:n,onClose:_,title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"Manual Warning Entry"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:hd[m]})]})]}),size:"lg",children:[e.jsx("div",{className:"flex items-center justify-between mb-6 px-4",children:[0,1,2,3].map(k=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-colors
                ${k<=m?"bg-primary text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"}`,children:k<m?e.jsx(mt,{className:"w-4 h-4"}):k+1}),k<3&&e.jsx("div",{className:`flex-1 h-1 mx-2 transition-colors
                  ${k<m?"bg-primary":"bg-gray-200 dark:bg-gray-700"}`})]},k))}),h&&e.jsx("div",{className:"mb-4 px-4",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-3 flex items-start gap-2",children:[e.jsx(me,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:h})]})}),e.jsx("div",{className:"px-4 pb-4 max-h-[calc(100vh-300px)] overflow-y-auto",children:F()}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-4 py-4 flex items-center justify-between",children:[e.jsx(ue,{variant:"outline",onClick:m===0?_:A,disabled:x,icon:m===0?ve:bs,children:m===0?"Cancel":"Back"}),e.jsx(ue,{onClick:m===3?R:y,disabled:x,icon:m===3?Hr:_t,iconPosition:"right",children:x?"Saving...":m===3?"Save Historical Warning":"Next"})]})]})},Qe=({title:n,count:t,total:s,subtitle:r,icon:a,variant:i="default",onClick:o,className:l="",size:m="md",gradient:c=!1})=>{const u={sm:{padding:"sm",titleSize:"text-xs",countSize:"text-lg",subtitleSize:"text-xs",iconSize:"w-3 h-3"},md:{padding:"md",titleSize:"text-sm",countSize:"text-2xl",subtitleSize:"text-xs",iconSize:"w-4 h-4"},lg:{padding:"lg",titleSize:"text-base",countSize:"text-3xl",subtitleSize:"text-sm",iconSize:"w-5 h-5"}}[m],h=()=>{const g={transition:"all 0.2s ease-in-out"};if(c)switch(i){case"info":return{...g,background:"linear-gradient(135deg, var(--color-info), var(--color-primary))",color:"var(--color-text-inverse)",border:"none"};case"success":return{...g,background:"linear-gradient(135deg, var(--color-success), var(--color-accent))",color:"var(--color-text-inverse)",border:"none"};case"warning":return{...g,background:"linear-gradient(135deg, var(--color-warning), #f97316)",color:"var(--color-text-inverse)",border:"none"};case"error":return{...g,background:"linear-gradient(135deg, var(--color-error), #dc2626)",color:"var(--color-text-inverse)",border:"none"};case"urgent":return{...g,background:"linear-gradient(135deg, var(--color-urgent-bg), var(--color-error))",color:"var(--color-urgent-text)",borderColor:"var(--color-urgent-border)"};default:return{...g,background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",color:"var(--color-text-inverse)",border:"none"}}switch(i){case"info":return{...g,backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)",color:"var(--color-alert-info-text)"};case"success":return{...g,backgroundColor:"var(--color-alert-success-bg)",borderColor:"var(--color-alert-success-border)",color:"var(--color-alert-success-text)"};case"warning":return{...g,backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)",color:"var(--color-alert-warning-text)"};case"error":return{...g,backgroundColor:"var(--color-alert-error-bg)",borderColor:"var(--color-alert-error-border)",color:"var(--color-alert-error-text)"};case"urgent":return{...g,backgroundColor:"var(--color-urgent-bg)",borderColor:"var(--color-urgent-border)",color:"var(--color-urgent-text)"};default:return{...g,backgroundColor:"var(--color-stat-card-bg)",borderColor:"var(--color-card-border)",color:"var(--color-text)"}}},v=()=>o?{transform:"translateY(-2px)",boxShadow:"var(--shadow-lg)",cursor:"pointer"}:{};return e.jsx(ne,{padding:u.padding,hover:!!o,className:`${l} ${o?"cursor-pointer":""}`,style:h(),onClick:o,onMouseEnter:g=>{o&&Object.assign(g.currentTarget.style,v())},onMouseLeave:g=>{o&&Object.assign(g.currentTarget.style,h())},children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a&&e.jsx("span",{className:`${u.iconSize} flex-shrink-0 opacity-90`,children:a}),e.jsx("p",{className:`${u.titleSize} font-medium opacity-90`,children:n})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("p",{className:`${u.countSize} font-bold`,children:t.toLocaleString()}),s!==void 0&&e.jsxs("span",{className:`${u.subtitleSize} opacity-75`,children:["of ",s.toLocaleString()]})]}),r&&e.jsx("p",{className:`${u.subtitleSize} opacity-75 mt-1`,children:r})]})})})},pd=({notification:n,currentStep:t,onStepComplete:s,onDeliveryComplete:r,isProcessing:a})=>{const[i,o]=p.useState(!1),[l,m]=p.useState(!1),[c,x]=p.useState(!1),[u,h]=p.useState(null),[v,g]=p.useState(null),[b,f]=p.useState(!1),[j,w]=p.useState(!1),D=p.useCallback(()=>{const N=n.contactDetails.phone||n.employeePhone||"",I=N.replace(/[^\d]/g,"");return{message:`Hi ${n.employeeName},

I hope this message finds you well. I'm writing to inform you that we need to discuss a ${n.warningLevel.toLowerCase()} regarding ${n.warningCategory.toLowerCase()}.

I've attached the formal warning document for your review. Please read through it carefully and let me know if you have any questions or would like to schedule a meeting to discuss this matter further.

This is an important workplace matter that requires your immediate attention. Please confirm receipt of this message and the attached document.

Thank you for your cooperation.

Best regards,
HR Department`,phoneNumber:I,formattedPhone:N}},[n])(),S=async()=>{try{await navigator.clipboard.writeText(D.message),o(!0),setTimeout(()=>o(!1),3e3)}catch(N){console.error("Failed to copy script:",N)}},y=()=>{w(!0)},A=()=>{m(!0)},R=()=>{const N=encodeURIComponent(D.message),I=`https://web.whatsapp.com/send?phone=${D.phoneNumber}&text=${N}`;window.open(I,"_blank"),x(!0)},_=N=>{const I=N.target.files?.[0];if(I){h(I);const T=new FileReader;T.onload=z=>{g(z.target?.result)},T.readAsDataURL(I)}},F=()=>{i&&l&&s(0)},k=()=>{c&&s(1)},E=async()=>{if(u){f(!0);try{await r({warningId:n.warningId,deliveryMethod:"whatsapp",deliveredAt:new Date,proofImage:u,phoneNumber:D.formattedPhone})}catch(N){console.error("Failed to complete delivery:",N)}finally{f(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[t===0&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(qr,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Prepare WhatsApp Message"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Copy the pre-written script and download the PDF attachment"})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx($s,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee Phone Number:"})]}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:D.formattedPhone||e.jsxs("span",{className:"text-red-500 text-sm",children:[e.jsx(me,{className:"w-4 h-4 inline mr-1"}),"No phone number on file"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"WhatsApp Message Script:"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:D.message,readOnly:!0,className:"w-full h-48 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono resize-none",style:{color:"var(--color-text)"}}),e.jsx(ue,{variant:i?"success":"primary",size:"sm",onClick:S,className:"absolute top-2 right-2",children:i?e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-4 h-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Tr,{className:"w-4 h-4 mr-1"}),"Copy Script"]})})]})]}),e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{variant:"secondary",onClick:y,className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),"Preview & Download PDF"]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"PDF Downloaded"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use the preview to download the PDF, then attach it to your WhatsApp message"})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:`flex items-center gap-2 text-sm ${i?"text-green-600":"text-gray-500"}`,children:[i?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(Re,{className:"w-4 h-4"}),"Script copied to clipboard"]}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${l?"text-green-600":"text-gray-500"}`,children:[l?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(Re,{className:"w-4 h-4"}),"PDF downloaded for attachment"]})]}),e.jsx(ue,{variant:"primary",onClick:F,disabled:!i||!l,className:"w-full",children:i&&l?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Send Message"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Complete preparation steps above"]})})]}),t===1&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ga,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Send via WhatsApp"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Open WhatsApp Web and send the message with PDF attachment"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsx("li",{children:'Click "Open WhatsApp Web" below'}),e.jsx("li",{children:"The message will be pre-filled with the script"}),e.jsx("li",{children:"Attach the downloaded PDF file"}),e.jsx("li",{children:"Send the message"}),e.jsx("li",{children:"Wait for delivery confirmation (double blue ticks)"})]})]})}),e.jsxs(ue,{variant:"primary",onClick:R,disabled:!D.phoneNumber,size:"lg",className:"w-full",children:[e.jsx(ga,{className:"w-5 h-5 mr-2"}),"Open WhatsApp Web"]}),c&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-4",children:[e.jsx(ae,{className:"w-4 h-4"}),"WhatsApp Web opened"]}),e.jsxs(ue,{variant:"primary",onClick:k,className:"w-full",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"I've sent the message"]})]})]})]}),t===2&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(ja,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Confirm Delivery"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Upload screenshot proof of successful delivery"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Screenshot Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Show the sent message with timestamp"}),e.jsx("li",{children:"Display delivery confirmation (double blue ticks)"}),e.jsx("li",{children:"Include employee's phone number visible"}),e.jsx("li",{children:"Capture PDF attachment in the message"})]})]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"hidden",id:"proof-upload"}),e.jsx("label",{htmlFor:"proof-upload",className:"cursor-pointer",children:v?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:v,alt:"Delivery proof",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-sm"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Screenshot uploaded"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(ri,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Upload Screenshot"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Click to select image file"})]})]})})]}),e.jsx(ue,{variant:"success",onClick:E,disabled:!u||b,size:"lg",className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Delivery..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Complete WhatsApp Delivery"]})})]})]}),j&&e.jsx(Zr,{isOpen:j,onClose:()=>w(!1),warningData:{employee:{firstName:n.employeeName.split(" ")[0]||n.employeeName,lastName:n.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:n.warningCategory,level:n.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:A})]})},fd=({notification:n,currentStep:t,onStepComplete:s,onDeliveryComplete:r,isProcessing:a})=>{const[i,o]=p.useState(!1),[l,m]=p.useState(!1),[c,x]=p.useState(!1),[u,h]=p.useState(null),[v,g]=p.useState(null),[b,f]=p.useState(!1),[j,w]=p.useState(!1),D=p.useCallback(()=>{const I=n.contactDetails.email||n.employeeEmail||"",T=`Important: ${n.warningLevel} - ${n.warningCategory}`,z=`Dear ${n.employeeName},

I hope this email finds you well. I am writing to formally notify you of a disciplinary matter that requires your immediate attention.

Subject: ${n.warningLevel}
Category: ${n.warningCategory}

Please find attached the formal warning document that outlines the details of this matter. It is crucial that you review this document thoroughly and understand its contents.

Key Points:
• This is a formal disciplinary action
• Please read the attached document carefully
• You have the right to respond or appeal this decision
• Further incidents may result in additional disciplinary action

If you have any questions or wish to discuss this matter, please do not hesitate to contact me or schedule a meeting with HR.

Please confirm receipt of this email and the attached document by replying to this message.

Thank you for your attention to this matter.

Best regards,
${n.createdByName||"HR Department"}
Human Resources Department`;return{subject:T,body:z,to:I}},[n])(),S=async()=>{try{const I=`To: ${D.to}
Subject: ${D.subject}

${D.body}`;await navigator.clipboard.writeText(I),o(!0),setTimeout(()=>o(!1),3e3)}catch(I){console.error("Failed to copy template:",I)}},y=async()=>{try{await navigator.clipboard.writeText(D.body),o(!0),setTimeout(()=>o(!1),3e3)}catch(I){console.error("Failed to copy email body:",I)}},A=()=>{w(!0)},R=()=>{m(!0)},_=()=>{const I=encodeURIComponent(D.subject),T=encodeURIComponent(D.body),O=`mailto:${encodeURIComponent(D.to)}?subject=${I}&body=${T}`;window.location.href=O,x(!0)},F=I=>{const T=I.target.files?.[0];if(T){h(T);const z=new FileReader;z.onload=O=>{g(O.target?.result)},z.readAsDataURL(T)}},k=()=>{i&&l&&s(0)},E=()=>{c&&s(1)},N=async()=>{if(u){f(!0);try{await r({warningId:n.warningId,deliveryMethod:"email",deliveredAt:new Date,proofImage:u,emailAddress:D.to})}catch(I){console.error("Failed to complete delivery:",I)}finally{f(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[t===0&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Rt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Prepare Email"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Copy the professional email template and download the PDF attachment"})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee Email:"})]}),e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:D.to||e.jsxs("span",{className:"text-red-500 text-sm",children:[e.jsx(me,{className:"w-4 h-4 inline mr-1"}),"No email address on file"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Subject:"}),e.jsx("div",{className:"relative",children:e.jsx("input",{value:D.subject,readOnly:!0,className:"w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm font-medium",style:{color:"var(--color-text)"}})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Message Template:"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:D.body,readOnly:!0,className:"w-full h-64 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm resize-none",style:{color:"var(--color-text)"}}),e.jsxs("div",{className:"absolute top-2 right-2 space-x-2",children:[e.jsx(ue,{variant:i?"success":"primary",size:"sm",onClick:S,children:i?e.jsxs(e.Fragment,{children:[e.jsx(mt,{className:"w-4 h-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Tr,{className:"w-4 h-4 mr-1"}),"Copy Full Email"]})}),e.jsxs(ue,{variant:"secondary",size:"sm",onClick:y,children:[e.jsx(Tr,{className:"w-4 h-4 mr-1"}),"Body Only"]})]})]})]}),e.jsxs("div",{className:"mb-6 space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{variant:"secondary",onClick:A,className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),"Preview & Download PDF"]}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"PDF Downloaded"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use the preview to download the PDF, then attach it to your email"})]}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:`flex items-center gap-2 text-sm ${i?"text-green-600":"text-gray-500"}`,children:[i?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(Re,{className:"w-4 h-4"}),"Email template copied to clipboard"]}),e.jsxs("div",{className:`flex items-center gap-2 text-sm ${l?"text-green-600":"text-gray-500"}`,children:[l?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(Re,{className:"w-4 h-4"}),"PDF downloaded for attachment"]})]}),e.jsx(ue,{variant:"primary",onClick:k,disabled:!i||!l,className:"w-full",children:i&&l?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Send Email"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Complete preparation steps above"]})})]}),t===1&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Jt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Send Email"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Open your email client and send the message with PDF attachment"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsx("li",{children:'Click "Open Email Client" below'}),e.jsx("li",{children:"Your default email application will open with pre-filled content"}),e.jsx("li",{children:"Attach the downloaded PDF file"}),e.jsx("li",{children:"Review the email content and recipient"}),e.jsx("li",{children:"Send the email"}),e.jsx("li",{children:"Wait for delivery confirmation if available"})]})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"To:"}),e.jsx("span",{className:"text-gray-900",children:D.to})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Subject:"}),e.jsx("span",{className:"text-gray-900",children:D.subject})]})]}),e.jsxs(ue,{variant:"primary",onClick:_,disabled:!D.to,size:"lg",className:"w-full",children:[e.jsx(ga,{className:"w-5 h-5 mr-2"}),"Open Email Client"]}),c&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-4",children:[e.jsx(ae,{className:"w-4 h-4"}),"Email client opened"]}),e.jsxs(ue,{variant:"primary",onClick:E,className:"w-full",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"I've sent the email"]})]})]})]}),t===2&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-purple-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(ja,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Confirm Delivery"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Upload screenshot proof of successful email delivery"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Screenshot Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:'Show the sent email in your "Sent" folder'}),e.jsx("li",{children:"Display recipient email address clearly"}),e.jsx("li",{children:"Include timestamp/date sent"}),e.jsx("li",{children:"Show PDF attachment in the email"}),e.jsx("li",{children:"Capture any delivery confirmation if available"})]})]})}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"hidden",id:"proof-upload"}),e.jsx("label",{htmlFor:"proof-upload",className:"cursor-pointer",children:v?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:v,alt:"Delivery proof",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-sm"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Screenshot uploaded"})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(ri,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Upload Screenshot"}),e.jsx("div",{className:"text-sm text-gray-500",children:"Click to select image file"})]})]})})]}),e.jsx(ue,{variant:"success",onClick:N,disabled:!u||b,size:"lg",className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Delivery..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Complete Email Delivery"]})})]})]}),j&&e.jsx(Zr,{isOpen:j,onClose:()=>w(!1),warningData:{employee:{firstName:n.employeeName.split(" ")[0]||n.employeeName,lastName:n.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:n.warningCategory,level:n.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:R})]})},yd=({notification:n,currentStep:t,onStepComplete:s,onDeliveryComplete:r,isProcessing:a})=>{const[i,o]=p.useState(!1),[l,m]=p.useState(!1),[c,x]=p.useState([{id:"hand_delivered",label:"Hand delivered to employee",completed:!1,required:!0,description:"Personally delivered the printed warning to the employee"},{id:"employee_present",label:"Employee was present during delivery",completed:!1,required:!0,description:"Confirmed employee identity and presence during delivery"},{id:"signature_obtained",label:"Employee signature obtained",completed:!1,required:!0,description:"Employee signed acknowledgment of receipt on physical document"},{id:"copy_filed",label:"Signed copy filed in employee records",completed:!1,required:!0,description:"Filed the signed physical copy in the employee's personnel file"}]),[u,h]=p.useState([{id:"original_filed",label:"Original signed document filed",completed:!1,required:!0,description:"Original signed warning document placed in employee's personnel file"},{id:"copy_retained",label:"Copy retained by HR",completed:!1,required:!0,description:"Photocopy of signed document retained in HR files"},{id:"system_updated",label:"Digital system updated",completed:!1,required:!0,description:"Employee record system updated to reflect warning delivery"}]),[v,g]=p.useState({deliveryDate:new Date().toISOString().split("T")[0],deliveryTime:new Date().toTimeString().split(" ")[0].slice(0,5),deliveryLocation:"",witnessName:"",additionalNotes:""}),b=()=>{m(!0)},f=()=>{o(!0)},j=p.useCallback(()=>{if(n.pdfUrl){const R=window.open(n.pdfUrl,"_blank");R&&(R.onload=()=>{R.print(),o(!0)})}else m(!0)},[n.pdfUrl]),w=(R,_)=>{R==="delivery"?x(F=>F.map(k=>k.id===_?{...k,completed:!k.completed}:k)):h(F=>F.map(k=>k.id===_?{...k,completed:!k.completed}:k))},C=c.filter(R=>R.required).every(R=>R.completed),D=u.filter(R=>R.required).every(R=>R.completed),S=()=>{i&&s(0)},y=()=>{C&&s(1)},A=async()=>{if(D)try{await r({warningId:n.warningId,deliveryMethod:"printed",deliveredAt:new Date(`${v.deliveryDate}T${v.deliveryTime}`),deliveryLocation:v.deliveryLocation,witnessName:v.witnessName,additionalNotes:v.additionalNotes,deliveryChecklist:c,filingChecklist:u})}catch(R){console.error("Failed to complete delivery:",R)}};return e.jsxs("div",{className:"space-y-6",children:[t===0&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-purple-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(Br,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Print Warning Document"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Print the official warning document for hand delivery"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Printing Requirements:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Print on official company letterhead if available"}),e.jsx("li",{children:"Use high-quality paper (minimum 80gsm)"}),e.jsx("li",{children:"Ensure all text is clearly legible"}),e.jsx("li",{children:"Print multiple copies (original + HR copy)"})]})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Employee:"}),e.jsx("span",{children:n.employeeName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Warning Type:"}),e.jsx("span",{children:n.warningLevel})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(tt,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Issue Date:"}),e.jsx("span",{children:n.createdAt.toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(ue,{variant:"secondary",onClick:b,className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),"Preview Document"]}),e.jsxs(ue,{variant:"primary",onClick:j,className:"flex items-center gap-2",children:[e.jsx(Br,{className:"w-4 h-4"}),"Print Document"]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Document printed successfully"})]})]}),e.jsx(ue,{variant:"primary",onClick:S,disabled:!i,className:"w-full",children:i?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Hand Delivery"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Print document to continue"]})})]})]}),t===1&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-green-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Pe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Hand Delivery to Employee"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Deliver the printed document and obtain employee acknowledgment"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Date"}),e.jsx("input",{type:"date",value:v.deliveryDate,onChange:R=>g(_=>({..._,deliveryDate:R.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Time"}),e.jsx("input",{type:"time",value:v.deliveryTime,onChange:R=>g(_=>({..._,deliveryTime:R.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Location"}),e.jsx("input",{type:"text",placeholder:"e.g., Employee's office, HR meeting room",value:v.deliveryLocation,onChange:R=>g(_=>({..._,deliveryLocation:R.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Witness Name (Optional)"}),e.jsx("input",{type:"text",placeholder:"Name of witness present during delivery",value:v.witnessName,onChange:R=>g(_=>({..._,witnessName:R.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600"}),"Delivery Checklist"]}),e.jsx("div",{className:"space-y-3",children:c.map(R=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:R.completed,onChange:()=>w("delivery",R.id),className:"mt-1 w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${R.completed?"text-green-600":"text-gray-900"}`,children:[R.label,R.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:R.description})]}),R.completed&&e.jsx(ae,{className:"w-5 h-5 text-green-600 mt-1"})]},R.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Notes"}),e.jsx("textarea",{rows:3,placeholder:"Any additional notes about the delivery process...",value:v.additionalNotes,onChange:R=>g(_=>({..._,additionalNotes:R.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),e.jsx(ue,{variant:"primary",onClick:y,disabled:!C,className:"w-full",children:C?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Filing"]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Complete all required items above"]})})]})]}),t===2&&e.jsxs(ne,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Oa,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: File Documentation"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"File the signed documents and complete the delivery process"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Xe,{variant:"warning",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Important:"})," Proper filing is crucial for legal compliance and audit purposes. Ensure all documents are filed in the correct employee personnel file."]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Oa,{className:"w-5 h-5 text-blue-600"}),"Filing Checklist"]}),e.jsx("div",{className:"space-y-3",children:u.map(R=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:R.completed,onChange:()=>w("filing",R.id),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:`font-medium ${R.completed?"text-blue-600":"text-gray-900"}`,children:[R.label,R.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:R.description})]}),R.completed&&e.jsx(ae,{className:"w-5 h-5 text-blue-600 mt-1"})]},R.id))})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-semibold text-blue-900 mb-2",children:"Delivery Summary"}),e.jsxs("div",{className:"space-y-1 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Employee:"})," ",n.employeeName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Warning Type:"})," ",n.warningLevel]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Delivery Date:"})," ",v.deliveryDate," at ",v.deliveryTime]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Location:"})," ",v.deliveryLocation||"Not specified"]}),v.witnessName&&e.jsxs("div",{children:[e.jsx("strong",{children:"Witness:"})," ",v.witnessName]})]})]}),e.jsx(ue,{variant:"success",onClick:A,disabled:!D||a,size:"lg",className:"w-full",children:a?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Process..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Complete Print Delivery Process"]})})]})]}),l&&e.jsx(Zr,{isOpen:l,onClose:()=>m(!1),warningData:{employee:{firstName:n.employeeName.split(" ")[0]||n.employeeName,lastName:n.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:n.warningCategory,level:n.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:f,showPrintButton:!0})]})},vd=({notification:n,onDeliveryComplete:t,onClose:s,isOpen:r})=>{const[a,i]=p.useState(0),[o,l]=p.useState([]),[m,c]=p.useState(!1),[x,u]=p.useState(null);p.useEffect(()=>{l((()=>{switch(n.deliveryMethod){case"whatsapp":return[{id:"prepare",label:"Prepare Message",completed:!1,inProgress:!0,description:"Copy pre-written script and download PDF"},{id:"send",label:"Send via WhatsApp",completed:!1,inProgress:!1,description:"Open WhatsApp and send message with attachment"},{id:"confirm",label:"Confirm Delivery",completed:!1,inProgress:!1,description:"Upload screenshot proof and complete delivery"}];case"email":return[{id:"prepare",label:"Prepare Email",completed:!1,inProgress:!0,description:"Copy email template and download PDF attachment"},{id:"send",label:"Send Email",completed:!1,inProgress:!1,description:"Open email client and send message"},{id:"confirm",label:"Confirm Delivery",completed:!1,inProgress:!1,description:"Upload screenshot proof and complete delivery"}];case"printed":return[{id:"print",label:"Print Document",completed:!1,inProgress:!0,description:"Print warning PDF document"},{id:"deliver",label:"Hand Deliver",completed:!1,inProgress:!1,description:"Deliver to employee and obtain signature"},{id:"file",label:"File Documentation",completed:!1,inProgress:!1,description:"File signed copy and confirm completion"}];default:return[]}})())},[n.deliveryMethod]);const v=(()=>{switch(n.deliveryMethod){case"whatsapp":return{icon:qr,name:"WhatsApp Business",color:"green",bgClass:"bg-green-50 border-green-200",textClass:"text-green-700"};case"email":return{icon:Rt,name:"Email",color:"blue",bgClass:"bg-blue-50 border-blue-200",textClass:"text-blue-700"};case"printed":return{icon:Br,name:"Print & Hand Delivery",color:"purple",bgClass:"bg-purple-50 border-purple-200",textClass:"text-purple-700"};default:return{icon:ye,name:"Unknown",color:"gray",bgClass:"bg-gray-50 border-gray-200",textClass:"text-gray-700"}}})(),g=f=>{l(j=>j.map((w,C)=>C===f?{...w,completed:!0,inProgress:!1}:C===f+1?{...w,inProgress:!0}:w)),f<o.length-1&&i(f+1)},b=async f=>{c(!0);try{await t(n.id,{...f,deliveryMethod:n.deliveryMethod,completedAt:new Date,steps:o}),s()}catch{u("Failed to complete delivery. Please try again.")}finally{c(!1)}};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[95vh] overflow-hidden shadow-2xl",children:[e.jsx("div",{className:`p-6 border-b ${v.bgClass}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-white shadow-sm",children:e.jsx(v.icon,{className:`w-6 h-6 ${v.textClass}`})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:[v.name," Delivery"]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Guided delivery workflow for ",n.employeeName]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ot,{variant:n.priority,size:"sm",children:n.priority.toUpperCase()}),e.jsx(ue,{variant:"ghost",size:"sm",onClick:s,children:e.jsx(ve,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"p-4 bg-gray-50 border-b",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"font-semibold text-gray-900",children:n.employeeName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:n.warningLevel})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:n.warningCategory})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(tt,{className:"w-4 h-4"}),n.createdAt.toLocaleDateString()]})]}),(n.contactDetails.email||n.contactDetails.phone)&&e.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[n.contactDetails.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:n.contactDetails.email})]}),n.contactDetails.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($s,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:n.contactDetails.phone})]})]})]}),e.jsx("div",{className:"p-6 border-b bg-white",children:e.jsx("div",{className:"flex items-center justify-between",children:o.map((f,j)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`
                    w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium transition-all
                    ${f.completed?"bg-green-500 text-white":f.inProgress?"bg-blue-500 text-white animate-pulse":"bg-gray-200 text-gray-500"}
                  `,children:f.completed?e.jsx(ae,{className:"w-5 h-5"}):f.inProgress?e.jsx(Re,{className:"w-5 h-5"}):j+1}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:`text-sm font-medium ${f.completed||f.inProgress?"text-gray-900":"text-gray-500"}`,children:f.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 max-w-32",children:f.description})]})]}),j<o.length-1&&e.jsx(Pr,{className:`w-5 h-5 mx-4 ${f.completed?"text-green-500":"text-gray-300"}`})]},f.id))})}),x&&e.jsx("div",{className:"p-4",children:e.jsx(Xe,{variant:"error",children:x})}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto",children:[n.deliveryMethod==="whatsapp"&&e.jsx(pd,{notification:n,currentStep:a,onStepComplete:g,onDeliveryComplete:b,isProcessing:m}),n.deliveryMethod==="email"&&e.jsx(fd,{notification:n,currentStep:a,onStepComplete:g,onDeliveryComplete:b,isProcessing:m}),n.deliveryMethod==="printed"&&e.jsx(yd,{notification:n,currentStep:a,onStepComplete:g,onDeliveryComplete:b,isProcessing:m})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Step ",a+1," of ",o.length]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ue,{variant:"ghost",size:"sm",onClick:s,children:"Cancel"}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(pt,{className:"w-4 h-4 animate-spin"}),"Processing..."]})]})]})]})}):null},bd=p.memo(({className:n="",isMobile:t=!1})=>{const s=js(),{employees:r,warnings:a,error:i,refreshData:o}=Yr({role:"hr"}),{hrReportsCount:l,hrCountsLoading:m,hrCountsError:c,lastUpdated:x}=Hc(),{canManageCategories:u}=Vt(),{user:h}=De(),{organization:v,categories:g}=We(),b={totalActive:a?.length||0,undelivered:a?.filter(z=>!z.delivered)?.length||0,highSeverity:a?.filter(z=>z.severity==="high"||z.category?.severity==="gross_misconduct")?.length||0},f={totalEmployees:r?.length||0,activeEmployees:r?.filter(z=>z.isActive!==!1)?.length||0,newEmployees:r?.filter(z=>{const O=new Date(z.createdAt||z.metadata?.createdAt||0),q=new Date(Date.now()-720*60*60*1e3);return O>q})?.length||0},[j,w]=p.useState(!1),[C,D]=p.useState(!1),[S,y]=p.useState(!1),[A,R]=p.useState("urgent"),[_,F]=p.useState(null),[k,E]=p.useState(!1),N=z=>{F(z),E(!0)},I=async(z,O)=>{try{console.log("Delivery completed:",{notificationId:z,proofData:O}),E(!1),F(null),o()}catch(q){console.error("Failed to complete delivery:",q)}},T=[{id:"delivery_001",warningId:"warn_123",employeeName:"John Smith",employeeEmail:"john.smith@company.com",employeePhone:"+27123456789",warningLevel:"Final Written Warning",warningCategory:"Attendance & Punctuality",deliveryMethod:"email",priority:"high",status:"pending",contactDetails:{email:"john.smith@company.com",phone:"+27123456789"},createdAt:new Date,createdByName:"HR Manager"},{id:"delivery_002",warningId:"warn_124",employeeName:"Jane Doe",warningLevel:"Verbal Warning",warningCategory:"Performance Issues",deliveryMethod:"whatsapp",priority:"normal",status:"pending",contactDetails:{phone:"+27987654321"},createdAt:new Date,createdByName:"Department Manager"}];return t?e.jsxs("div",{className:`space-y-6 ${n}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:"HR Command Center"}),e.jsx("p",{className:"mt-1",style:{color:"var(--color-text-secondary)"},children:"Employee oversight & disciplinary management"})]}),x&&e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:"Last updated"}),e.jsx("br",{}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:x.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs(ne,{padding:"lg",shadow:"lg",hover:!0,onClick:()=>s("/hr/absence-reports"),className:"cursor-pointer relative",style:{background:"linear-gradient(to right, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)"},children:[m&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin",style:{opacity:.7}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{opacity:.8},children:"Pending Reviews"}),e.jsx("p",{className:"text-2xl font-bold",children:l.absenceReports.unread}),e.jsxs("div",{className:"mt-2 text-sm",style:{opacity:.8},children:[l.absenceReports.total," total absence reports"]})]}),e.jsx(es,{className:"w-8 h-8",style:{opacity:.7}})]})]}),e.jsxs(ne,{padding:"lg",shadow:"lg",hover:!0,onClick:()=>s("/hr/meeting-requests"),className:"cursor-pointer relative",style:{background:"linear-gradient(to right, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)"},children:[m&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin",style:{opacity:.7}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{opacity:.8},children:"Meeting Requests"}),e.jsx("p",{className:"text-2xl font-bold",children:l.hrMeetings.unread}),e.jsxs("div",{className:"mt-2 text-sm",style:{opacity:.8},children:[l.hrMeetings.total," total requests"]})]}),e.jsx(Ks,{className:"w-8 h-8",style:{opacity:.7}})]})]}),e.jsxs(ne,{padding:"lg",shadow:"lg",hover:!0,onClick:()=>s("/hr/corrective-counselling"),className:"cursor-pointer relative",style:{background:"linear-gradient(to right, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)"},children:[m&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin",style:{opacity:.7}})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{opacity:.8},children:"Counselling Sessions"}),e.jsx("p",{className:"text-2xl font-bold",children:l.correctiveCounselling.unread}),e.jsxs("div",{className:"mt-2 text-sm",style:{opacity:.8},children:[l.correctiveCounselling.total," total records"]})]}),e.jsx(ws,{className:"w-8 h-8",style:{opacity:.7}})]})]}),e.jsx(ne,{padding:"lg",shadow:"lg",hover:!0,onClick:()=>R("warnings"),className:"cursor-pointer",style:{background:"linear-gradient(to right, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{opacity:.8},children:"Active Warnings"}),e.jsx("p",{className:"text-2xl font-bold",children:b.totalActive}),e.jsxs("div",{className:"mt-2 text-sm",style:{opacity:.8},children:[b.undelivered," undelivered, ",b.highSeverity," high-severity"]})]}),e.jsx(Se,{className:"w-8 h-8",style:{opacity:.7}})]})}),e.jsx(ne,{padding:"lg",shadow:"lg",hover:!0,onClick:()=>R("employees"),className:"cursor-pointer",style:{background:"linear-gradient(to right, var(--color-info), var(--color-info))",color:"var(--color-text-inverse)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",style:{opacity:.8},children:"Employee Network"}),e.jsx("p",{className:"text-2xl font-bold",children:f.totalEmployees}),e.jsxs("div",{className:"mt-2 text-sm",style:{opacity:.8},children:[f.activeEmployees," active, ",f.newEmployees," new this month"]})]}),e.jsx(Ne,{className:"w-8 h-8",style:{opacity:.7}})]})}),u&&e.jsxs(ne,{padding:"md",shadow:"sm",hover:!0,onClick:()=>w(!0),className:"cursor-pointer text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"var(--color-primary)",opacity:.1},children:e.jsx(jt,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warning Categories"}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Configure categories"})]})]}),e.jsx(ot,{variant:"primary",size:"sm",children:"Manage"})]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:"Universal & custom category settings"})]}),e.jsxs(ne,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y(!0),className:"cursor-pointer text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-100 dark:bg-amber-900/30",children:e.jsx(ye,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Manual Warning Entry"}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Enter historical warnings"})]})]}),e.jsx(ot,{variant:"warning",size:"sm",children:"Historical"})]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:"Capture warnings from physical documents"})]}),e.jsxs(ne,{padding:"md",shadow:"sm",hover:!0,onClick:()=>D(!0),className:"cursor-pointer text-left",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"var(--color-accent)",opacity:.1},children:e.jsx(Je,{className:"w-5 h-5",style:{color:"var(--color-accent)"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Department Management"}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Manage departments"})]})]}),e.jsx(ot,{variant:"success",size:"sm",children:"HR Access"})]}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:"Create, edit, and assign department managers"})]})]}),j&&e.jsx(va,{onClose:()=>w(!1),initialTab:"overview"}),S&&h&&v&&e.jsx(gd,{isOpen:S,onClose:()=>y(!1),onSuccess:()=>{y(!1),o()},employees:r||[],categories:g||[],currentUserId:h.uid,organizationId:v.id}),C&&v&&e.jsx(vi,{isOpen:C,onClose:()=>D(!1),organizationId:v.id}),A==="warnings"&&e.jsx(Bs,{isOpen:!0,onClose:()=>R("urgent"),title:"Warnings Overview",subtitle:"Comprehensive warnings management",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Comprehensive warnings management available on desktop."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Qe,{title:"Undelivered",count:b.undelivered,subtitle:"Require immediate attention",variant:"warning",icon:e.jsx(me,{className:"w-4 h-4"}),size:"sm"}),e.jsx(Qe,{title:"High Priority",count:b.highSeverity,subtitle:"Final warnings & dismissals",variant:"error",icon:e.jsx(Se,{className:"w-4 h-4"}),size:"sm"}),e.jsx(Qe,{title:"Total Active",count:b.totalActive,subtitle:"All current warnings",variant:"info",icon:e.jsx(ye,{className:"w-4 h-4"}),size:"sm"})]})]})}),A==="employees"&&e.jsx(Bs,{isOpen:!0,onClose:()=>R("urgent"),title:"Employee Overview",subtitle:"Employee statistics and management",size:"sm",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx(Qe,{title:"Total",count:f.totalEmployees,subtitle:"All employees",variant:"info",icon:e.jsx(Ne,{className:"w-4 h-4"}),size:"sm"}),e.jsx(Qe,{title:"Active",count:f.activeEmployees,subtitle:"Currently employed",variant:"success",icon:e.jsx(Ne,{className:"w-4 h-4"}),size:"sm"}),e.jsx(Qe,{title:"New",count:f.newEmployees,subtitle:"Last 30 days",variant:"info",icon:e.jsx(gt,{className:"w-4 h-4"}),size:"sm"})]})})]}):e.jsxs("div",{className:`${n}`,children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3 mb-6",children:[e.jsx(Qe,{title:"Absence Reports",count:l.absenceReports.unread,total:l.absenceReports.total,icon:e.jsx(es,{className:"w-4 h-4"}),variant:"error",gradient:!0,onClick:()=>s("/hr/absence-reports")}),e.jsx(Qe,{title:"Meeting Requests",count:l.hrMeetings.unread,total:l.hrMeetings.total,icon:e.jsx(Ks,{className:"w-4 h-4"}),variant:"default",gradient:!0,onClick:()=>s("/hr/meeting-requests")}),e.jsx(Qe,{title:"Counselling",count:l.correctiveCounselling.unread,total:l.correctiveCounselling.total,icon:e.jsx(ws,{className:"w-4 h-4"}),variant:"info",gradient:!0,onClick:()=>s("/hr/corrective-counselling")}),e.jsx(Qe,{title:"Active Warnings",count:b.totalActive,subtitle:`${b.undelivered} undelivered`,icon:e.jsx(Se,{className:"w-4 h-4"}),variant:"warning",gradient:!0,onClick:()=>R("warnings")})]}),(c||i)&&e.jsx(Xe,{variant:"error",className:"mb-4",children:e.jsxs("div",{className:"text-sm",children:["Failed to load HR data: ",c||i]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-6 px-4",children:[{id:"urgent",label:"Urgent Tasks",icon:me,count:l.absenceReports.unread+l.hrMeetings.unread+b.undelivered},{id:"warnings",label:"Warnings",icon:Se},{id:"employees",label:"Employees",icon:Je}].map(z=>e.jsxs("button",{onClick:()=>R(z.id),className:`flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium transition-colors relative ${A===z.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(z.icon,{className:"w-4 h-4"}),z.label,z.count>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center ml-1",children:z.count})]},z.id))})}),e.jsxs("div",{className:"p-4",children:[A==="urgent"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-red-200 shadow-sm",children:[e.jsxs("div",{className:"p-4 border-b border-red-100 bg-red-50",children:[e.jsxs("h3",{className:"text-lg font-semibold text-red-900 flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Urgent Tasks Requiring Immediate Attention"]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"These items need your immediate review and action"})]}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[l.absenceReports.unread>0&&e.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>s("/hr/absence-reports"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[l.absenceReports.unread," Unread Absence Reports"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Employees reporting absences requiring approval"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium",children:[l.absenceReports.unread," pending"]}),e.jsx(es,{className:"w-4 h-4 text-gray-400"})]})]})}),l.hrMeetings.unread>0&&e.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>s("/hr/meeting-requests"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[l.hrMeetings.unread," New Meeting Requests"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Employees requesting HR consultations"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full font-medium",children:[l.hrMeetings.unread," requests"]}),e.jsx(Ks,{className:"w-4 h-4 text-gray-400"})]})]})}),b.undelivered>0&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[b.undelivered," Undelivered Warnings"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Warning documents pending delivery to employees"})]})]}),e.jsx(ot,{variant:"warning",size:"sm",children:"Urgent"})]}),e.jsx("div",{className:"space-y-2",children:T.slice(0,2).map(z=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1 rounded text-xs ${z.deliveryMethod==="email"?"bg-blue-100 text-blue-700":z.deliveryMethod==="whatsapp"?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700"}`,children:z.deliveryMethod==="email"?"📧":z.deliveryMethod==="whatsapp"?"📱":"🖨️"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:z.employeeName}),e.jsx("div",{className:"text-xs text-gray-500",children:z.warningLevel})]})]}),e.jsx(ue,{variant:"primary",size:"sm",onClick:()=>N(z),children:"Start Delivery"})]},z.id))}),e.jsx("div",{className:"mt-3 pt-3 border-t border-orange-200",children:e.jsx(ue,{variant:"ghost",size:"sm",onClick:()=>R("warnings"),className:"w-full text-orange-700 hover:text-orange-800",children:"View All Undelivered Warnings"})})]}),b.highSeverity>0&&e.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>R("warnings"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[b.highSeverity," High Priority Cases"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Final warnings and dismissal cases requiring oversight"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium",children:"Critical"}),e.jsx(me,{className:"w-4 h-4 text-gray-400"})]})]})}),l.absenceReports.unread===0&&l.hrMeetings.unread===0&&b.undelivered===0&&b.highSeverity===0&&e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx(Se,{className:"w-8 h-8 text-green-600"})}),e.jsx("div",{className:"font-medium text-gray-700",children:"All caught up!"}),e.jsx("div",{className:"text-sm",children:"No urgent tasks requiring immediate attention"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-gray-600"}),"Today's Activity"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"New Reports"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.absenceReports.unread})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Meetings"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.hrMeetings.unread})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Counselling"}),e.jsx("span",{className:"font-medium text-gray-900",children:l.correctiveCounselling.unread})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ft,{className:"w-4 h-4 text-blue-600"}),"Team Status"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Employees"}),e.jsx("span",{className:"font-medium text-gray-900",children:f.totalEmployees})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Active"}),e.jsx("span",{className:"font-medium text-green-600",children:f.activeEmployees})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"New This Month"}),e.jsx("span",{className:"font-medium text-blue-600",children:f.newEmployees})]})]})]}),e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-orange-600"}),"Warning Overview"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Active"}),e.jsx("span",{className:"font-medium text-gray-900",children:b.totalActive})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Undelivered"}),e.jsx("span",{className:"font-medium text-orange-600",children:b.undelivered})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"High Priority"}),e.jsx("span",{className:"font-medium text-red-600",children:b.highSeverity})]})]})]})]})]}),A==="warnings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.undelivered}),e.jsx("div",{className:"text-sm text-orange-700",children:"Undelivered Warnings"}),e.jsx("div",{className:"text-xs text-orange-600",children:"Require immediate attention"})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.highSeverity}),e.jsx("div",{className:"text-sm text-red-700",children:"High Severity"}),e.jsx("div",{className:"text-xs text-red-600",children:"Final warnings & dismissals"})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b.totalActive}),e.jsx("div",{className:"text-sm text-blue-700",children:"Total Active"}),e.jsx("div",{className:"text-xs text-blue-600",children:"All current warnings"})]})]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:e.jsx(ko,{})})]}),A==="employees"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Jr,{})})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-gray-50 to-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Warning Categories Management"}),e.jsx("button",{onClick:()=>w(!1),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(va,{onClose:()=>w(!1)})})]})}),k&&_&&e.jsx(vd,{isOpen:k,notification:_,onDeliveryComplete:I,onClose:()=>{E(!1),F(null)}})]})});class us{constructor(){this.flows=new Map,this.listeners=[],this.stepConfigs=new Map,this.styles={info:"color: #2563eb; font-weight: bold;",warn:"color: #d97706; font-weight: bold;",error:"color: #dc2626; font-weight: bold;",debug:"color: #6b7280; font-weight: normal;",step:"color: #7c3aed; font-weight: bold; font-size: 14px;",data:"color: #059669; font-weight: normal;",validation:"color: #dc2626; font-weight: bold;"},this.initializeStepConfigs()}static getInstance(){return us.instance||(us.instance=new us),us.instance}initializeStepConfigs(){this.stepConfigs.set("INCIDENT_DETAILS",{name:"Incident Details",requiredFields:["employeeId","categoryId","incidentDate","incidentTime","incidentLocation","incidentDescription","issueDate","validityPeriod"],validations:[this.validateIncidentDetails.bind(this),this.validateDescriptionLength.bind(this),this.validateDates.bind(this)]}),this.stepConfigs.set("LEGAL_REVIEW_SIGNATURES",{name:"Legal Review & Signatures",requiredFields:["lraRecommendation","signatures.manager","signatures.employee"],validations:[this.validateLegalReview.bind(this),this.validateSignatures.bind(this)]}),this.stepConfigs.set("DELIVERY_COMPLETION",{name:"Delivery & Completion",requiredFields:["id","status","deliveryMethod"],validations:[this.validateDeliveryData.bind(this),this.validateFirestoreReadiness.bind(this)]})}startWizardSession(t){const s=t||`wizard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r={sessionId:s,startTime:new Date,currentStep:"",completedSteps:[],logs:[],dataSnapshots:{},issues:[]};return this.flows.set(s,r),this.log(s,"info","SESSION","STARTED",null,{sessionId:s,timestamp:r.startTime}),s}endWizardSession(t,s){const r=this.flows.get(t);if(!r)return;const a=Date.now()-r.startTime.getTime();this.log(t,"info","SESSION","ENDED",null,{outcome:s,duration:`${Math.round(a/1e3)}s`,totalSteps:r.completedSteps.length,totalIssues:r.issues.length,finalStep:r.currentStep}),setTimeout(()=>{this.flows.delete(t)},300*1e3)}enterStep(t,s,r){const a=this.flows.get(t);a&&(a.currentStep=s,this.log(t,"info",s,"STEP_ENTERED",r,{previousStep:a.completedSteps[a.completedSteps.length-1]||"none",stepIndex:a.completedSteps.length+1}),r&&this.validateStepData(t,s,r,"STEP_ENTRY"))}exitStep(t,s,r,a=!0){const i=this.flows.get(t);i&&(a&&!i.completedSteps.includes(s)&&i.completedSteps.push(s),this.log(t,a?"info":"warn",s,"STEP_EXITED",r,{completed:a,timeInStep:this.getTimeInStep(t,s),totalCompletedSteps:i.completedSteps.length}),r&&a&&this.validateStepData(t,s,r,"STEP_EXIT"))}trackDataChange(t,s,r,a,i){this.log(t,"debug",s,"DATA_CHANGED",{field:r,oldValue:a,newValue:i,valueType:typeof i},{hasValue:i!=null&&i!=="",isValidChange:i!==a}),i===void 0&&a!==void 0&&this.trackIssue(t,s,`Field ${r} became undefined`,"medium"),typeof i!=typeof a&&a!==void 0&&this.trackIssue(t,s,`Field ${r} type changed from ${typeof a} to ${typeof i}`,"low")}trackFormSubmission(t,s,r){const a=this.flows.get(t);a&&(a.dataSnapshots[`${s}_${Date.now()}`]={...r},this.log(t,"info",s,"FORM_SUBMITTED",r,{fieldCount:Object.keys(r||{}).length,hasRequiredFields:this.checkRequiredFields(s,r)}),this.validateStepData(t,s,r,"FORM_SUBMISSION"))}trackAPICall(t,s,r,a,i,o){const l=o?"error":"info";this.log(t,l,s,"API_CALL",{api:r,params:a,result:o?void 0:i,error:o?.message||o},{success:!o,responseTime:Date.now()}),o&&this.trackIssue(t,s,`API call failed: ${r} - ${o.message}`,"high")}validateStepData(t,s,r,a){const i=this.stepConfigs.get(s);if(!i)return{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};let o={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return i.validations.forEach(l=>{const m=l(r);o.errors.push(...m.errors),o.warnings.push(...m.warnings),o.missingFields.push(...m.missingFields),o.undefinedFields.push(...m.undefinedFields),o.isValid=o.isValid&&m.isValid}),this.log(t,o.isValid?"info":"error",s,"VALIDATION",r,{context:a,validation:o}),o.errors.forEach(l=>{this.trackIssue(t,s,`Validation Error: ${l}`,"high")}),o.warnings.forEach(l=>{this.trackIssue(t,s,`Validation Warning: ${l}`,"medium")}),o}validateIncidentDetails(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return["employeeId","categoryId","incidentDate","incidentLocation","incidentDescription"].forEach(a=>{(!t[a]||t[a]==="")&&(s.errors.push(`Missing required field: ${a}`),s.missingFields.push(a),s.isValid=!1)}),Object.keys(t).forEach(a=>{t[a]===void 0&&(s.undefinedFields.push(a),s.errors.push(`Field ${a} is undefined`),s.isValid=!1)}),s}validateDescriptionLength(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(t.incidentDescription){const r=t.incidentDescription.trim().split(/\s+/).length;r<15&&s.warnings.push(`Incident description should be at least 15 words (currently ${r})`)}return s}validateDates(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return t.incidentDate&&new Date(t.incidentDate)>new Date&&(s.errors.push("Incident date cannot be in the future"),s.isValid=!1),t.issueDate&&new Date(t.issueDate)>new Date&&s.warnings.push("Issue date is in the future"),s}validateLegalReview(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return t.lraRecommendation||(s.errors.push("LRA recommendation is required"),s.missingFields.push("lraRecommendation"),s.isValid=!1),s}validateSignatures(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return t.signatures?.manager||(s.warnings.push("Manager signature missing"),s.missingFields.push("signatures.manager")),t.signatures?.employee||(s.warnings.push("Employee signature missing"),s.missingFields.push("signatures.employee")),s}validateDeliveryData(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return t.id||(s.errors.push("Warning ID is required for delivery"),s.missingFields.push("id"),s.isValid=!1),t.deliveryMethod||(s.warnings.push("Delivery method not specified"),s.missingFields.push("deliveryMethod")),s}validateFirestoreReadiness(t){const s={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},r=this.findUndefinedFields(t);return r.length>0&&(s.errors.push(`Undefined fields will cause Firestore errors: ${r.join(", ")}`),s.undefinedFields.push(...r),s.isValid=!1),["id","organizationId","employeeId","categoryId"].forEach(i=>{t[i]||(s.errors.push(`Firestore requires field: ${i}`),s.missingFields.push(i),s.isValid=!1)}),s}findUndefinedFields(t,s=""){const r=[];return typeof t=="object"&&t!==null&&!(t instanceof Date)&&Object.entries(t).forEach(([a,i])=>{const o=s?`${s}.${a}`:a;i===void 0?r.push(o):typeof i=="object"&&i!==null&&!(i instanceof Date)&&r.push(...this.findUndefinedFields(i,o))}),r}trackIssue(t,s,r,a){const i=this.flows.get(t);if(!i)return;const o={step:s,issue:r,severity:a,timestamp:new Date};i.issues.push(o),this.log(t,a==="high"?"error":"warn",s,"ISSUE_DETECTED",null,{issue:r,severity:a,totalIssues:i.issues.length})}log(t,s,r,a,i,o){const l={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:new Date,level:s,step:r,action:a,data:i,metadata:o},m=this.flows.get(t);m&&m.logs.push(l),this.logToConsole(l,t),this.listeners.forEach(c=>c(l))}logToConsole(t,s){const a=`%c${{info:"💙",warn:"⚠️",error:"❌",debug:"🔍"}[t.level]} [${t.step}] ${t.action}`,i=this.styles[t.level];t.data?(console.groupCollapsed(`${a} (${s.slice(-6)})`,i),d.debug("%cData:",this.styles.data,t.data),t.validation&&d.debug("%cValidation:",this.styles.validation,t.validation),t.metadata&&d.debug("%cMetadata:",this.styles.debug,t.metadata),console.groupEnd()):(d.debug(`${a} (${s.slice(-6)})`,i),t.metadata&&d.debug("%cMetadata:",this.styles.debug,t.metadata))}checkRequiredFields(t,s){const r=this.stepConfigs.get(t);return r?r.requiredFields.every(a=>{const i=a.split(".");let o=s;for(const l of i)o=o?.[l];return o!=null&&o!==""}):!0}getTimeInStep(t,s){const r=this.flows.get(t);if(!r)return"0s";const a=r.logs.reverse().find(o=>o.step===s&&o.action==="STEP_ENTERED");if(!a)return"0s";const i=Date.now()-a.timestamp.getTime();return`${Math.round(i/1e3)}s`}addListener(t){this.listeners.push(t)}removeListener(t){const s=this.listeners.indexOf(t);s>-1&&this.listeners.splice(s,1)}getSessionLogs(t){return this.flows.get(t)?.logs||[]}getSessionIssues(t){return this.flows.get(t)?.issues||[]}getSessionSummary(t){const s=this.flows.get(t);return s?{sessionId:s.sessionId,startTime:s.startTime,currentStep:s.currentStep,completedSteps:s.completedSteps,totalLogs:s.logs.length,totalIssues:s.issues.length,issuesByLevel:{high:s.issues.filter(r=>r.severity==="high").length,medium:s.issues.filter(r=>r.severity==="medium").length,low:s.issues.filter(r=>r.severity==="low").length},dataSnapshots:Object.keys(s.dataSnapshots).length}:null}exportSessionData(t){const s=this.flows.get(t);return s?JSON.stringify({summary:this.getSessionSummary(t),logs:s.logs,issues:s.issues,dataSnapshots:s.dataSnapshots},null,2):""}trackError(t,s,r,a){this.log(t,"error",s,"ERROR",{message:r.message,stack:r.stack,context:a}),this.trackIssue(t,s,r.message,"high")}trackSuccess(t,s,r,a){this.log(t,"info",s,`SUCCESS_${r}`,a)}trackWarning(t,s,r,a){this.log(t,"warn",s,"WARNING",a,{warning:r}),this.trackIssue(t,s,r,"medium")}}const Ye=us.getInstance(),wd=({sessionId:n,stepName:t,autoStart:s=!0,enableRealTimeValidation:r=!0})=>{const[a,i]=p.useState(n||""),[o,l]=p.useState([]),[m,c]=p.useState([]),[x,u]=p.useState(null),h=p.useRef(!1),v=p.useRef(!1);p.useEffect(()=>{if(s&&!h.current&&!n){const F=Ye.startWizardSession();i(F),h.current=!0}else n&&(i(n),h.current=!0)},[s,n]),p.useEffect(()=>{if(!a)return;const F=()=>{const N=Ye.getSessionLogs(a),I=Ye.getSessionIssues(a),T=Ye.getSessionSummary(a);l(N),c(I),u(T)};F();const k=N=>{(N.metadata?.sessionId===a||o.some(I=>I.id===N.id))&&F()};Ye.addListener(k);const E=setInterval(F,2e3);return()=>{Ye.removeListener(k),clearInterval(E)}},[a]);const g=p.useCallback(()=>{if(!h.current){const F=Ye.startWizardSession();return i(F),h.current=!0,F}return a},[a]),b=p.useCallback(F=>{a&&(v.current&&(Ye.exitStep(a,t,void 0,F==="completed"),v.current=!1),Ye.endWizardSession(a,F),h.current=!1)},[a,t]),f=p.useCallback(F=>{a&&!v.current&&(Ye.enterStep(a,t,F),v.current=!0)},[a,t]),j=p.useCallback((F,k=!0)=>{a&&v.current&&(Ye.exitStep(a,t,F,k),v.current=!1)},[a,t]),w=p.useCallback((F,k,E)=>{a&&Ye.trackDataChange(a,t,F,k,E)},[a,t]),C=p.useCallback(F=>{a&&Ye.trackFormSubmission(a,t,F)},[a,t]),D=p.useCallback((F,k,E,N)=>{a&&Ye.trackAPICall(a,t,F,k,E,N)},[a,t]),S=p.useCallback((F,k)=>{a&&Ye.trackError(a,t,F,k)},[a,t]),y=p.useCallback((F,k)=>{a&&Ye.trackSuccess(a,t,F,k)},[a,t]),A=p.useCallback((F,k)=>{a&&Ye.trackWarning(a,t,F,k)},[a,t]),R=p.useCallback(F=>a&&r?Ye.validateStepData?.(a,t,F,"MANUAL_VALIDATION")||{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]}:{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},[a,t,r]),_=p.useCallback(()=>a?Ye.exportSessionData(a):"",[a]);return p.useEffect(()=>{a&&s&&!v.current&&f()},[a,s,f]),p.useEffect(()=>()=>{a&&v.current&&j(void 0,!1)},[a,j]),{sessionId:a,startSession:g,endSession:b,enterStep:f,exitStep:j,trackChange:w,trackFormSubmit:C,trackAPI:D,trackError:S,trackSuccess:y,trackWarning:A,validateData:R,logs:o,issues:m,summary:x,exportSession:_}},jd=({employees:n,selectedEmployeeId:t,onEmployeeSelect:s,warningHistory:r=[],isLoadingWarningHistory:a=!1,disabled:i=!1,className:o=""})=>{const[l,m]=p.useState(""),[c,x]=p.useState(!1),[u,h]=p.useState(!1),[v,g]=p.useState(!1),b=p.useMemo(()=>{if(!l.trim())return n;const y=l.toLowerCase();return n.filter(A=>{const R=`${A.firstName} ${A.lastName}`.toLowerCase(),_=A.id?.toLowerCase()||"",F=A.department?.toLowerCase()||"";return R.includes(y)||_.includes(y)||F.includes(y)})},[n,l]),f=p.useMemo(()=>n.find(y=>y.id===t),[n,t]),j=p.useCallback(y=>{s(y),x(!1),h(!1),g(!1),m("")},[s]),w=p.useCallback(()=>{if(i)return;window.innerWidth<768?g(!0):h(!u)},[i,u]),C=p.useCallback(()=>{g(!1),m("")},[]),D=y=>y.riskIndicators?y.riskIndicators.highRisk?"high":"medium":"low",S=y=>{if(!y.recentWarnings)return null;const{count:A,lastDate:R,level:_}=y.recentWarnings;return{count:A,lastDate:R,level:_}};return e.jsxs("div",{className:`space-y-4 ${o}`,children:[e.jsx(Tt,{icon:Pe,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:e.jsx(ot,{variant:"secondary",size:"sm",children:b.length})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{hover:!0,padding:"sm",className:`cursor-pointer transition-all min-h-[48px] ${i?"opacity-50 cursor-not-allowed":""}`,style:{borderWidth:"1px",borderColor:u?"var(--color-primary)":"var(--color-border)",boxShadow:u?"0 0 0 2px var(--color-primary-light)":void 0},onClick:w,children:f?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:e.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[f.firstName?.charAt(0),f.lastName?.charAt(0)]})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[f.firstName," ",f.lastName]}),e.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[f.position," • ",f.department]})]})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform flex-shrink-0 ${u?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform ${u?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]})}),u&&e.jsxs("div",{className:"absolute top-full left-0 right-0 z-20 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:y=>m(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:b.length>0?e.jsx("div",{className:"py-2",children:b.map(y=>(D(y),S(y),e.jsx("button",{onClick:()=>j(y.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[y.firstName," ",y.lastName," - ",y.position]})},y.id)))}):e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(Pe,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsxs("p",{children:['No employees found matching "',l,'"']})]})})]})]})}),v&&e.jsxs("div",{className:"mobile-employee-modal",children:[e.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:C}),e.jsxs("div",{className:"mobile-employee-modal-content",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),e.jsx("button",{onClick:C,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:y=>m(y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),e.jsx("div",{className:"mobile-category-list",children:b.length>0?e.jsx("div",{children:b.map(y=>e.jsx("button",{onClick:()=>j(y.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:e.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[y.firstName," ",y.lastName," - ",y.position]})},y.id))}):e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx("p",{children:"No employees found"}),l&&e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',l,'"']})]})})]})]}),f&&c&&e.jsxs(ne,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),e.jsxs(ue,{variant:"ghost",size:"sm",onClick:()=>x(!c),className:"flex items-center gap-1",children:[c?e.jsx(Gt,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"}),c?"Hide":"Show"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["📧 ",f.email||"No email",e.jsx("br",{}),"📱 ",f.phone||"No phone"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[f.position,e.jsx("br",{}),f.department]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),a?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Re,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),e.jsx("span",{className:"font-medium text-gray-900",children:f.recentWarnings?.count||0})]}),f.recentWarnings?.lastDate&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),e.jsx("span",{className:"text-sm text-gray-900",children:new Date(f.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),f.riskIndicators&&e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),e.jsxs(ot,{variant:f.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),f.riskIndicators.highRisk?"High Risk":"Low Risk"]}),f.riskIndicators.reasons.length>0&&e.jsx("div",{className:"mt-2",children:e.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:f.riskIndicators.reasons.slice(0,3).map((y,A)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-amber-500 mt-0.5",children:"•"}),y]},A))})})]})]})]})]})]})},Nd=({categories:n,selectedCategoryId:t,onCategorySelect:s,lraRecommendation:r,disabled:a=!1,className:i=""})=>{const[o,l]=p.useState(!1),[m,c]=p.useState(!1),[x,u]=p.useState(!1),[h,v]=p.useState(""),g=p.useMemo(()=>{if(!h.trim())return n;const y=h.toLowerCase();return n.filter(A=>{const R=A.name?.toLowerCase()||"",_=A.description?.toLowerCase()||"",F=A.severity?.toLowerCase()||"";return R.includes(y)||_.includes(y)||F.includes(y)})},[n,h]),b=p.useMemo(()=>n.find(y=>y.id===t),[n,t]),f=p.useCallback(y=>{s(y),l(!1),c(!1),u(!1),v("")},[s]),j=p.useCallback(()=>{if(a)return;window.innerWidth<768?u(!0):c(!m)},[a,m]),w=p.useCallback(()=>{u(!1),v("")},[]),C=y=>{switch(y?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}},D=p.useMemo(()=>b?b.escalationPath||di(b.id):[],[b]),S=p.useMemo(()=>!r||!D.length?-1:D.findIndex(y=>y===r.suggestedLevel),[r,D]);return e.jsxs("div",{className:`space-y-4 ${i}`,children:[e.jsx(Tt,{icon:Ma,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:e.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:n.length})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{hover:!0,padding:"sm",className:`cursor-pointer transition-all min-h-[48px] ${a?"opacity-50 cursor-not-allowed":""}`,style:{borderWidth:"1px",borderColor:m?"var(--color-primary)":"var(--color-border)",boxShadow:m?"0 0 0 2px var(--color-primary-light)":void 0},onClick:j,children:b?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:b.name}),b.description&&e.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:b.description})]})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform ${m?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform ${m?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]})}),m&&e.jsxs("div",{className:"absolute top-full left-0 right-0 z-20 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Search categories...",value:h,onChange:y=>v(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:g.length>0?e.jsx("div",{className:"py-2",children:g.map(y=>e.jsx("button",{onClick:()=>f(y.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:A=>{A.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:A=>{A.currentTarget.style.backgroundColor="transparent"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:y.severity==="serious"||y.severity==="gross_misconduct"?"var(--color-error-bg)":y.severity==="moderate"?"var(--color-warning-bg)":"var(--color-primary-bg)",color:y.severity==="serious"||y.severity==="gross_misconduct"?"var(--color-error)":y.severity==="moderate"?"var(--color-warning)":"var(--color-primary)"},children:y.icon}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:y.name}),y.description&&e.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:y.description})]})]})},y.id))}):e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(Ma,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No categories found"}),h&&e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',h,'"']})]})})]})]})}),x&&e.jsxs("div",{className:"mobile-category-modal",children:[e.jsx("div",{className:"mobile-category-modal-backdrop",onClick:w}),e.jsxs("div",{className:"mobile-category-modal-content",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),e.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("input",{type:"text",placeholder:"Search categories...",value:h,onChange:y=>v(y.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:g.length>0?e.jsx("div",{children:g.map(y=>e.jsxs("button",{onClick:()=>f(y.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:A=>{A.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:A=>{A.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:y.severity==="serious"||y.severity==="gross_misconduct"?"var(--color-error-bg)":y.severity==="moderate"?"var(--color-warning-bg)":"var(--color-primary-bg)",color:y.severity==="serious"||y.severity==="gross_misconduct"?"var(--color-error)":y.severity==="moderate"?"var(--color-warning)":"var(--color-primary)"},children:y.icon}),e.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:y.name}),y.description&&e.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:y.description})]})]},y.id))}):e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx("p",{children:"No categories found"}),h&&e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',h,'"']})]})})]})]}),b&&o&&e.jsxs(ne,{className:"rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),e.jsxs("button",{onClick:()=>l(!o),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[o?e.jsx(Gt,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"}),o?"Hide":"Show"]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:C(b.severity),children:b.severity})]}),b.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:b.description})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),r?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:Zt(r.suggestedLevel)}),r.isEscalation&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.reason})]}):e.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map((y,A)=>{const R=A===S,_=S>=0&&A<S;return e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:R?"var(--color-badge-primary)":_?"var(--color-muted)":"var(--color-card-background)",borderColor:R?"var(--color-primary)":"var(--color-border)",color:R?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[R&&e.jsx(ft,{className:"w-4 h-4"}),_&&e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:Zt(y)}),A<D.length-1&&e.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"→"})]},y)})}),r&&e.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(At,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",Zt(r.suggestedLevel)]}),e.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",r.warningCount," total warnings",r.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},Cd=(n,t,s=2e3)=>{const r=p.useRef(),[a,i]=p.useState(!1),[o,l]=p.useState(null),m=p.useCallback(()=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{i(!0),t(n),l(new Date),i(!1)},s)},[n,t,s]);return p.useEffect(()=>(m(),()=>{r.current&&clearTimeout(r.current)}),[m]),{isSaving:a,lastSaved:o}},Dd=({formData:n,onFormDataChange:t,disabled:s=!1,className:r=""})=>{const[a,i]=p.useState(!1),[o,l]=p.useState({}),[m,c]=p.useState({}),{isSaving:x,lastSaved:u}=Cd(n,f=>{localStorage.setItem("warningWizard_incidentDetails",JSON.stringify(f))});p.useEffect(()=>{const f=localStorage.getItem("warningWizard_incidentDetails");if(f)try{const j=JSON.parse(f);!n.incidentDescription&&!n.incidentLocation&&t(j)}catch(j){console.warn("Failed to load saved incident details:",j)}},[]);const h=p.useMemo(()=>{const f=n.incidentDescription||"",w=f.trim().split(/\s+/).filter(S=>S.length>0).length,C=w>=20,D=[];return w<20&&D.push(`Add ${20-w} more words for a complete description`),!f.includes("when")&&!f.includes("time")&&D.push("Consider adding when the incident occurred"),!f.includes("where")&&!f.includes("location")&&D.push("Consider specifying where the incident took place"),!f.includes("what")&&!f.includes("action")&&D.push("Be specific about what actions were observed"),!f.includes("witness")&&w>10&&D.push("Were there any witnesses to mention?"),{wordCount:w,isMinimumMet:C,suggestions:D}},[n.incidentDescription]),v=p.useCallback((f,j)=>{switch(f){case"incidentDate":return j?new Date(j)>new Date?"Incident date cannot be in the future":null:"Incident date is required";case"incidentTime":return j?/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(j)?null:"Please enter time in HH:MM format":"Incident time is required";case"incidentLocation":return!j||j.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":return!j||j.trim().length<20?"Description must be at least 20 characters":j.trim().length>2e3?"Description is too long (maximum 2000 characters)":null;default:return null}},[]),g=p.useCallback((f,j)=>{t({[f]:j}),c(C=>({...C,[f]:!0}));const w=v(f,j);l(C=>({...C,[f]:w}))},[t,v]),b=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:`space-y-4 ${r}`,children:[e.jsx(Tt,{icon:ye,title:"Incident Details",subtitle:"Provide comprehensive details about the incident",rightContent:e.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--color-text-tertiary)"},children:[x&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Hr,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]}),u&&!x&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsxs("span",{children:["Saved ",u.toLocaleTimeString()]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(Ls,{type:"date",label:"Incident Date",value:n.incidentDate||"",onChange:f=>g("incidentDate",f),icon:tt,required:!0,disabled:s,error:o.incidentDate&&m.incidentDate?o.incidentDate:void 0}),e.jsx(Ls,{type:"time",label:"Incident Time",value:n.incidentTime||"",onChange:f=>g("incidentTime",f),icon:Re,required:!0,disabled:s,error:o.incidentTime&&m.incidentTime?o.incidentTime:void 0})]}),e.jsx(Rs,{type:"text",label:"Incident Location",value:n.incidentLocation||"",onChange:f=>g("incidentLocation",f),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:rs,required:!0,disabled:s,error:o.incidentLocation&&m.incidentLocation?o.incidentLocation:void 0}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[e.jsx(ai,{className:"w-3 h-3 inline mr-1"}),"Incident Description *"]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{type:"button",onClick:()=>i(!a),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-primary)"},children:[e.jsx(Ua,{className:"w-3 h-3"}),"Writing Tips"]}),e.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:h.isMinimumMet?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:h.isMinimumMet?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[h.wordCount," words"]})]})]}),e.jsx("textarea",{value:n.incidentDescription||"",onChange:f=>g("incidentDescription",f.target.value),placeholder:"Describe exactly what happened. Include specific details such as what was said or done, who was present, and any relevant context...",disabled:s,rows:6,className:`w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical ${s?"opacity-50 cursor-not-allowed":""}`,style:{backgroundColor:o.incidentDescription&&m.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:o.incidentDescription&&m.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),o.incidentDescription&&m.incidentDescription&&e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[e.jsx(me,{className:"w-3 h-3"}),o.incidentDescription]}),a&&e.jsxs("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[e.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:"var(--color-alert-info-text)"},children:"Writing Assistance"}),e.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--color-alert-info-text)"},children:[h.suggestions.map((f,j)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ua,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),e.jsx("span",{children:f})]},j)),h.suggestions.length===0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"text-green-700",children:"Your description looks comprehensive!"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-700",children:["Additional Notes",e.jsx("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),e.jsx("textarea",{value:n.additionalNotes||"",onChange:f=>g("additionalNotes",f.target.value),placeholder:"Any additional context, background information, or relevant details...",disabled:s,rows:3,className:`
            w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500
            ${s?"opacity-50 cursor-not-allowed":""}
          `})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date *"}),e.jsx("input",{type:"date",value:n.issueDate||b,onChange:f=>g("issueDate",f.target.value),disabled:s,className:`
              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500
              ${s?"opacity-50 cursor-not-allowed":""}
            `})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Validity Period *"}),e.jsxs("select",{value:n.validityPeriod||6,onChange:f=>g("validityPeriod",parseInt(f.target.value)),disabled:s,className:`
              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500
              ${s?"opacity-50 cursor-not-allowed":""}
            `,children:[e.jsx("option",{value:3,children:"3 months"}),e.jsx("option",{value:6,children:"6 months"}),e.jsx("option",{value:12,children:"12 months"})]})]})]})]})},kd=({employees:n,categories:t,formData:s,updateFormData:r,selectedEmployee:a,selectedCategory:i,warningHistory:o=[],isLoadingWarningHistory:l=!1,loadWarningHistory:m,lraRecommendation:c,isAnalyzing:x=!1})=>{const u=g=>{r({employeeId:g}),m&&m(g)},h=g=>{r({categoryId:g})},v=p.useMemo(()=>{const g={employee:!!s.employeeId,category:!!s.categoryId,date:!!s.incidentDate,time:!!s.incidentTime,location:!!s.incidentLocation&&s.incidentLocation.length>=3,description:!!s.incidentDescription&&s.incidentDescription.length>=20},b=Object.values(g).filter(Boolean).length,f=Object.keys(g).length,j=Math.round(b/f*100);return{checks:g,completed:b,total:f,percentage:j}},[s]);return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-1",children:[e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Progress"}),e.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[v.completed,"/",v.total]})]}),e.jsx("div",{className:"w-full rounded h-1",style:{backgroundColor:"var(--color-surface)"},children:e.jsx("div",{className:"h-1 rounded transition-all duration-300",style:{width:`${v.percentage}%`,backgroundColor:"var(--color-primary)"}})}),e.jsx(jd,{employees:n,selectedEmployeeId:s.employeeId,onEmployeeSelect:u,warningHistory:o,isLoadingWarningHistory:l,disabled:x}),e.jsx(Nd,{categories:t,selectedCategoryId:s.categoryId,onCategorySelect:h,lraRecommendation:c,disabled:x}),e.jsx(Dd,{formData:s,onFormDataChange:r,disabled:x}),x&&e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),e.jsx("span",{className:"text-sm",children:"Analyzing incident..."})]})}),c&&!x&&c.requiresHRIntervention&&e.jsx(Xe,{variant:"error",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-error)"},children:"Contact HR Required"}),e.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text)"},children:c.interventionReason}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee has final warning on record - HR intervention required before proceeding"})]})]})}),c&&!x&&!c.requiresHRIntervention&&e.jsx(Xe,{variant:"success",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-success)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:["Recommended: ",c.recommendedLevel]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:c.reason})]})]})}),v.percentage===100&&!x&&e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_t,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:"Ready for Legal Review"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:'All details completed. Click "Next" to proceed.'})]})]})})]})},On=({onSignatureComplete:n,disabled:t=!1,label:s,placeholder:r="Click and drag to sign",initialSignature:a=null,className:i="",width:o=400,height:l=200})=>{const m=p.useRef(null),c=p.useRef(null),[x,u]=p.useState(!1),[h,v]=p.useState(!1),[g,b]=p.useState([]),[f,j]=p.useState(!1),w=p.useCallback(()=>{const _=m.current;if(!_)return;const F=_.getContext("2d");if(!F)return;const k=_.getBoundingClientRect(),E=window.devicePixelRatio||1;_.width=k.width*E,_.height=k.height*E,F.scale(E,E),F.strokeStyle="#1e293b",F.lineWidth=2,F.lineCap="round",F.lineJoin="round",F.globalCompositeOperation="source-over",F.fillStyle="#ffffff",F.fillRect(0,0,_.width,_.height),j(!0)},[]),C=p.useCallback(_=>{const F=m.current;if(!F)return{x:0,y:0};const k=F.getBoundingClientRect();let E,N;if("touches"in _&&_.touches.length>0)E=_.touches[0].clientX,N=_.touches[0].clientY;else if("clientX"in _)E=_.clientX,N=_.clientY;else return{x:0,y:0};return{x:E-k.left,y:N-k.top}},[]),D=p.useCallback(_=>{if(t)return;_.preventDefault();const F=m.current,k=F?.getContext("2d");if(!F||!k)return;u(!0);const{x:E,y:N}=C(_);k.beginPath(),k.moveTo(E,N);const I={points:[{x:E,y:N}],timestamp:Date.now()};b(T=>[...T,I])},[t,C]),S=p.useCallback(_=>{if(!x||t)return;_.preventDefault();const F=m.current,k=F?.getContext("2d");if(!F||!k)return;const{x:E,y:N}=C(_);k.lineTo(E,N),k.stroke(),b(I=>{if(I.length===0)return I;const T=[...I];return T[T.length-1].points.push({x:E,y:N}),T})},[x,t,C]),y=p.useCallback(()=>{if(!x)return;u(!1),v(!0);const _=m.current;if(_){const F=_.toDataURL("image/png");n(F)}},[x,n]),A=p.useCallback(()=>{if(t)return;const _=m.current,F=_?.getContext("2d");!_||!F||(F.fillStyle="#ffffff",F.fillRect(0,0,_.width,_.height),v(!1),b([]),n(null))},[t,n]);p.useEffect(()=>{if(!f||t)return;const _=m.current;if(!_)return;const F=O=>D(O),k=O=>S(O),E=()=>y(),N=()=>y(),I=O=>D(O),T=O=>S(O),z=()=>y();return _.addEventListener("mousedown",F,{passive:!1}),_.addEventListener("mousemove",k,{passive:!1}),_.addEventListener("mouseup",E),_.addEventListener("mouseleave",N),_.addEventListener("touchstart",I,{passive:!1}),_.addEventListener("touchmove",T,{passive:!1}),_.addEventListener("touchend",z),c.current=()=>{_.removeEventListener("mousedown",F),_.removeEventListener("mousemove",k),_.removeEventListener("mouseup",E),_.removeEventListener("mouseleave",N),_.removeEventListener("touchstart",I),_.removeEventListener("touchmove",T),_.removeEventListener("touchend",z)},c.current},[f,t,D,S,y]),p.useEffect(()=>{w()},[w]),p.useEffect(()=>{if(a&&f){const _=m.current,F=_?.getContext("2d");if(!_||!F)return;const k=new Image;k.onload=()=>{F.clearRect(0,0,_.width,_.height),F.fillStyle="#ffffff",F.fillRect(0,0,_.width,_.height),F.drawImage(k,0,0),v(!0)},k.src=a}},[a,f]),p.useEffect(()=>()=>{c.current&&c.current()},[]);const R=g.length>=2&&g.some(_=>_.points.length>=3);return e.jsxs("div",{className:`space-y-3 ${i}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[e.jsx(mt,{className:"w-3 h-3"}),e.jsx("span",{children:"Signed"})]}),e.jsxs("button",{type:"button",onClick:A,disabled:t||!h,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-red-600 disabled:opacity-50",children:[e.jsx(pt,{className:"w-3 h-3"}),"Clear"]})]})]}),e.jsxs("div",{className:`
        relative border-2 border-dashed rounded-lg bg-white
        ${t?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}
        ${h&&R?"border-green-300 bg-green-50":""}
        ${h&&!R?"border-amber-300 bg-amber-50":""}
      `,children:[e.jsx("canvas",{ref:m,width:o,height:l,className:`
            block w-full h-full cursor-crosshair rounded-lg
            ${t?"cursor-not-allowed":""}
          `,style:{width:`${o}px`,height:`${l}px`}}),!h&&!t&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[e.jsx(ai,{className:"w-4 h-4"}),e.jsx("span",{children:r})]})}),h&&!R&&e.jsx("div",{className:"absolute top-2 right-2 bg-amber-100 text-amber-700 text-xs px-2 py-1 rounded-full",children:"Signature too simple"})]}),!1]})},oa=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],Mn={en:{greeting:(n,t)=>`Good day ${n}. My name is ${t}, and I need to speak with you about a workplace incident that occurred recently.`,purpose:()=>"This meeting is to formally discuss a disciplinary matter. I want to make sure you understand your rights and the process we're following, which is in accordance with the Labour Relations Act and our company's disciplinary policy.",incident:n=>`The incident we need to discuss is as follows: ${n}. This behavior is not in line with our workplace standards and company policies.`,warningExplanation:n=>`Based on the severity and our disciplinary procedure, I am issuing you with a ${n} warning. This warning will remain active in your employment record for the validity period specified.`,rights:()=>"Now, it's very important that you understand your rights in this process:",rightsList:()=>["You have the right to respond to this warning and provide your version of events.","You may request a witness to be present during this discussion if you wish.","You have the right to appeal this decision within 48 hours if you believe it is unfair or procedurally incorrect.","This disciplinary action is progressive - repeated or more serious offenses may lead to further disciplinary steps.","You have the right to union representation if you are a member of a recognized trade union.","All information discussed will be kept confidential and only shared with relevant management and HR personnel."],witnessOption:()=>"If you choose not to sign this warning, that is your right. However, please understand that a witness will sign to confirm that this warning was properly delivered to you and that you were informed of all your rights. The warning remains valid whether you sign it or not.",questions:()=>"Do you have any questions about this warning, the incident, or your rights that I've explained? I want to make sure you fully understand everything before we proceed.",closing:()=>"Thank you for listening. We will now proceed to document this warning properly. Remember, this is an opportunity for improvement, and we hope to see positive changes in your conduct going forward."},af:{greeting:(n,t)=>`Goeiedag ${n}. My naam is ${t}, en ek moet met jou praat oor 'n werkplek incident wat onlangs plaasgevind het.`,purpose:()=>"Hierdie vergadering is om 'n dissiplinêre saak formeel te bespreek. Ek wil seker maak dat jy jou regte en die proses wat ons volg verstaan, wat in ooreenstemming is met die Wet op Arbeidsverhoudinge en ons maatskappy se dissiplinêre beleid.",incident:n=>`Die incident wat ons moet bespreek is soos volg: ${n}. Hierdie gedrag is nie in lyn met ons werkplek standaarde en maatskappy beleide nie.`,warningExplanation:n=>`Gebaseer op die ernst en ons dissiplinêre prosedure, gee ek jou 'n ${n} waarskuwing. Hierdie waarskuwing sal aktief bly in jou werkrekord vir die gespesifiseerde geldigheidsperiode.`,rights:()=>"Nou, dit is baie belangrik dat jy jou regte in hierdie proses verstaan:",rightsList:()=>["Jy het die reg om op hierdie waarskuwing te reageer en jou weergawe van gebeure te verskaf.","Jy mag versoek dat 'n getuie teenwoordig is tydens hierdie bespreking as jy wil.","Jy het die reg om hierdie besluit binne 48 uur te appelieer as jy glo dit is onregverdig of prosedureel verkeerd.","Hierdie dissiplinêre aksie is progressief - herhaalde of ernstiger oortredings kan tot verdere dissiplinêre stappe lei.","Jy het die reg tot vakbondverteenwoordiging as jy 'n lid is van 'n erkende vakbond.","Alle inligting wat bespreek word sal vertroulik gehou word en slegs gedeel word met relevante bestuur en HR personeel."],witnessOption:()=>"As jy kies om nie hierdie waarskuwing te teken nie, is dit jou reg. Verstaan egter asseblief dat 'n getuie sal teken om te bevestig dat hierdie waarskuwing behoorlik aan jou afgelewer is en dat jy ingelig is van alle jou regte. Die waarskuwing bly geldig of jy dit teken of nie.",questions:()=>"Het jy enige vrae oor hierdie waarskuwing, die incident, of jou regte wat ek verduidelik het? Ek wil seker maak dat jy alles ten volle verstaan voordat ons voortgaan.",closing:()=>"Dankie dat jy geluister het. Ons sal nou voortgaan om hierdie waarskuwing behoorlik te dokumenteer. Onthou, dit is 'n geleentheid vir verbetering, en ons hoop om positiewe veranderinge in jou gedrag vorentoe te sien."},zu:{greeting:(n,t)=>`Sawubona ${n}. Igama lami ngu-${t}, futhi ngidinga ukukhuluma nawe ngodaba olwenzeke emsebenzini muva nje.`,purpose:()=>"Le meeting iwukuxoxa ngodaba lokuqeqeshwa ngokusemthethweni. Ngifuna ukuqinisekisa ukuthi uyaziqonda amalungelo akho nenqubo esilandulayo, okuhambisana noMthetho Wobudlelwano Basebenzi kanye nenqubomgomo yokuqeqesha yenkampani yethu.",incident:n=>`Isigameko okumele sikuxoxe isilandelayo: ${n}. Loku kuziphatha akuhambisani nezindinganiso zethu zendawo yomsebenzi kanye nezinqubomgomo zenkampani.`,warningExplanation:n=>`Ngokusekelwe ebubini kanye nenqubo yethu yokuqeqesha, ngikupha isixwayiso se-${n}. Lesi sixwayiso sizoblhala sisebenza kumarekhodi akho womsebenzi isikhathi semvume esicaciswayo.`,rights:()=>"Manje, kubalulekile kakhulu ukuthi uqonde amalungelo akho kule nqubo:",rightsList:()=>["Unelungelo lokuphendula kulesi sixwayiso futhi unikeze ingqikithi yakho yezigameko.","Ungacela ukuthi kubekho ufakazi kulengxoxo uma ufuna.","Unelungelo lokuphikisa lesi sinqumo phakathi namahora angama-48 uma ukholelwa ukuthi alulungile noma alungenzi kahle.","Lesi senzo sokuqeqesha siyaqhubeka - amacala aphindwayo noma amabi kakhulu angaholela ezinyathelweni zokuqeqesha ezabanye.","Unelungelo lokumelelwa yinyunyana uma uyilungu lenyunyana eqashelwa.","Lonke ulwazi oluxoxwayo luzogcinwa luyimfihlo futhi lwabelane kuphela nabapha boholi kanye nabasebenzi be-HR abafanele."],witnessOption:()=>"Uma ukhetha ukungasisayini lesi sixwayiso, yilelo ilungelo lakho. Kodwa-ke sicela uqonde ukuthi ufakazi uzosayina ukuqinisekisa ukuthi lesi sixwayiso sikulethwe ngendlela efanele futhi wazisiwa wonke amalungelo akho. Isixwayiso sihlala sisebenza noma uyasisayina noma cha.",questions:()=>"Ingabe unemibuzo mayelana nalesi sixwayiso, isigameko, noma amalungelo akho engiwakaziselwe? Ngifuna ukuqinisekisa ukuthi uqonda konke ngokugcwele ngaphambi kokuqhubeka.",closing:()=>"Ngiyabonga ukulalela. Manje sizokweqhubeka nokuqopha lesi sixwayiso ngendlela efanele. Khumbula, leli ithuba lokuthuthuka, futhi sithemba ukubona ushintsho oluhle ekuziphatheni kwakho kwezayo."},xh:{greeting:(n,t)=>`Molo ${n}. Igama lam ngu-${t}, kwaye kufuneka ndithethe nawe ngesiganeko emsebenzini esenzeke kutsha nje.`,purpose:()=>"Le ntlanganiso ikukuxoxa ngomba wokulungiswa ngokomsitho ngokusemthethweni. Ndifuna ukuqinisekisa ukuba uyawaqonda amalungelo akho kunye nenkqubo esiyilandelayo, ehambelana noMthetho woBudlelwane baBasebenzi kunye nemigaqo-nkqubo yoculeko yenkampani yethu.",incident:n=>`Isiganeko esifuneka sikuxoxe ngesi: ${n}. Oku kuziphatha akuhambelani nemigangatho yethu yendawo yomsebenzi kunye nemigaqo-nkqubo yenkampani.`,warningExplanation:n=>`Ngokusekelwe kubunzima kunye nenkqubo yethu yokulungisa, ndikunika isilumkiso se-${n}. Esi silumkiso siza kuhlala sisebenza kwiirekhodi zakho zomsebenzi ngexesha lokusebenza elichaziwayo.`,rights:()=>"Ngoku, kubalulekile kakhulu ukuba uqonde amalungelo akho kule nkqubo:",rightsList:()=>["Unelungelo lokuphendula kesi silumkiso kwaye unikeze ingxelo yakho yeziganeko.","Ungacela ukuba kubeko ingqina ngexesha lale ngxoxo ukuba ufuna.","Unelungelo lokubhena esi sigqibo ngaphakathi kweeyure ezingama-48 ukuba ukholelwa ukuba asifanelekanga okanye asizenzi ngokufanelekileyo.","Esi senzo sokulungisa siyaqhubela phambili - amatyala aphindaphindiweyo okanye amandla kakhulu anokukhokelela kumanyathelo amaninzi okulungisa.","Unelungelo lokumelelwa yimanyano ukuba ulilungu lemanyano eyamkelekileyo.","Lonke ulwazi oluxoxwayo luza kugcinwa luyimfihlo kwaye lwabiwe kuphela nabo baphathi abafanelekileyo nabasebenzi be-HR."],witnessOption:()=>"Ukuba ukhetha ukungasayini esi silumkiso, yilelo ilungelo lakho. Kodwa nceda uqonde ukuba ingqina iza kusayina ukuqinisekisa ukuba esi silumkiso siye sanikwa kuwe ngokufanelekileyo kwaye waziswa nangawo onke amalungelo akho. Isilumkiso sihlala sisebenza nokuba usisayinile okanye awusisayinanga.",questions:()=>"Ingaba unemibuzo malunga nesi silumkiso, isiganeko, okanye amalungelo akho endiwakaziselwe? Ndifuna ukuqinisekisa ukuba uyakuqonda konke ngokupheleleyo ngaphambi kokuba siqhubeke.",closing:()=>"Enkosi ngokuphulaphula. Ngoku siza kuqhubeka nokubhala esi silumkiso ngokufanelekileyo. Khumbula, oku lithuba lokuphucula, kwaye sinethemba lokubona utshintsho oluhle ekuziphatheni kwakho kwixesha elizayo."},st:{greeting:(n,t)=>`Dumela ${n}. Lebitso la ka ke ${t}, mme ke hloka ho bua le wena ka taba ya mosebetsi e etsahetseng haufinyane.`,purpose:()=>"Kopano ena ke ho buisana ka taba ya kgetho ka mokhoa o nepahetseng oa molao. Ke batla ho netefatsa hore o utloisisa ditokelo tsa hao le tshebetso eo re e latelang, e lumellanang le Molao oa Dikamano tsa Basebetsi le pholisi ya kgetho ya khamphani ya rona.",incident:n=>`Ketsahalo eo re tlameha ho e buisana ke ena: ${n}. Boitshwaro bona ha bo lumellane le maemo a rona a sebaka sa mosebetsi le dipholisi tsa khamphani.`,warningExplanation:n=>`Ho latela boholo le tshebetso ya rona ya kgetho, ke o fa temoso ya ${n}. Temoso ena e tla dula e sebetsa lirekotong tsa hao tsa mosebetsi nakong ya ho sebetsa e hlalosang.`,rights:()=>"Jwale, ho bohlokwa haholo hore o utloisise ditokelo tsa hao tshebetsong ena:",rightsList:()=>["O na le tokelo la ho araba temoso ena le ho fana ka pale ya hao ya ditiragalo.","O ka kopa hore ho be le paki nakong ya puisano ena haeba o batla.","O na le tokelo la ho ipeela qeto ena ka mora dihora tse 48 haeba o lumela hore ha e nepahala kapa e sa etsoa hantle.","Ketso ena ya kgetho e tsoela pele - diphoso tse phethehang kapa tse matla haholo di ka lebisa ho maqephe a mang a kgetho.","O na le tokelo la ho emelwa ke mokhatlo haeba o setho sa mokhatlo o amohetsweng.","Tlhahisoleseding yohle e buuwang e tla bolokwa e le lekunutu mme e arolelane feela le bataoli ba bohlokwa le basebetsi ba HR."],witnessOption:()=>"Haeba o khetha ho se saene temoso ena, ke tokelo la hao. Empa ka kopo utloisise hore paki e tla saena ho netefatsa hore temoso ena e fihletswe ho wena ka nepo mme o tsebisitswe ditokelo tsa hao tsohle. Temoso e dula e sebetsa ha hoja o e saennse kapa o sa e saene.",questions:()=>"Na o na le dipotso mabapi le temoso ena, ketsahalo, kapa ditokelo tsa hao tseo ke di hlalositseng? Ke batla ho netefatsa hore o utloisisa tsohle ka botlalo pele re tsoela pele.",closing:()=>"Kea leboha ho mamela. Jwale re tla tsoela pele ho ngola temoso ena ka nepo. Hopola, sena ke sebaka sa ntlafatso, mme re lebelletse ho bona diphetoho tse ntle boitshwarong ba hao nakong e tlang."},ts:{greeting:(n,t)=>`Avuxeni ${n}. Vito ra mina i ${t}, naswona ndzi lava ku vulavula na wena hi timhaka ta rixaka leri nga endleke sweswi eka ntirho.`,purpose:()=>"Nhlanganiso lowu i ku burisana hi timhaka ta ndzulavulo hi ndlela ya ximfumo. Ndzi lava ku tiyisisa leswaku u twisisa timfanelo ta wena ni nongonoko lowu hi wu landzelaka, lowu fambana na Nawu wa Vuhlanganisi bya Vatirhi ni pholisi ya ndzulavulo ya khamphani ya hina.",incident:n=>`Xivangelo lexi hi faneleke ku xi burisana xi nga ha landzu: ${n}. Mavanyiselo lawa ma nga fambani na swiyimo swa hina swa ndhawu ya ntirho ni tipholisi ta khamphani.`,warningExplanation:n=>`Hi ku landza ku antswa ni nongonoko wa hina wa ndzulavulo, ndzi ku nyika xilumkiso xa ${n}. Xilumkiso lexi xi ta tshama xi tirhaka eka rhekhodo ya wena ya ntirho hi nkarhi wa ku tirhisa lowu nga boxiweke.`,rights:()=>"Sweswi, swa nkoka ngopfu leswaku u twisisa timfanelo ta wena eka nongonoko lowu:",rightsList:()=>["U na timfanelo to hlamula xilumkiso lexi naswona u nyika hungu ra wena ra swiendlakalo.","U nga kumbela leswaku ku va na nhlamulo loko u lava eka nsinya lowu.","U na timfanelo ro kongomisa xiboho lexi hi nkarhi wa tawa ta 48 loko u tshemba leswaku a xi nga ri xa ku lulamela kumbe xi nga endliwanga hi ndlela yo nepfuma.","Goza leri ra ndzulavulo ri ya emahlweni - matsalwa yo phindha-phindha kumbe ya nkoka ngopfu ya nga endla leswaku ku va na magoza yo engetela ya ndzulavulo.","U na timfanelo ro yimeriwa hi mihlangano ya vatirhi loko u ri xirho xa mihlangano leyi amukeriweke.","Rungula hinkwaro lexi nga burisaniwaka ri ta hlayisiwa ri ri swihlayiselo naswona ri avelaniwa ntsena na vafambisi va nkoka ni vatirhi va HR."],witnessOption:()=>"Loko u hlawula ku nga sayini xilumkiso lexi, sweswo i timfanelo ta wena. Kambe kombela u twisisa leswaku nhlamulo a nga ta ku sayina ku tiyisisa leswaku xilumkiso lexi xi nyikiwe eka wena hi ndlela yo nepfuma naswona u tivisiwe hi timfanelo ta wena hinkwato. Xilumkiso xi hlaya xi tirhaka hambi u xi sayinile kumbe a xi sayinanga.",questions:()=>"Xana u na swivutiso hi xilumkiso lexi, xivangelo, kumbe timfanelo ta wena leswi ndzi ti hlamuseleke? Ndzi lava ku tiyisisa leswaku u twisisa hinkwaswo kusuhi hi ku helela ka ku ya emahlweni.",closing:()=>"Inkomu hi ku yingisa. Sweswi hi ta ya emahlweni ku tsala xilumkiso lexi hi ndlela yo nepfuma. Tsundzuka, leswi i nkarhi wo antswisa, naswona hi langutera ku vona ku cinca ko antswa eka mavanyiselo ya wena eka nkarhi lowu taka."},ve:{greeting:(n,t)=>`Ndaa ${n}. Dzina langa ndi ${t}, nahone ndi khou toda u amba navho nga zwithu zwa mushumo zwine zwa itika zwino-zwino.`,purpose:()=>"Iyi meetingi ndi ya u amba nga zwa mulandu nga ndila ya mulayo. Ndi khou toda u vhona uri no pfesesaho pfanelo dzavho na muitero une ra khou tevhedza, une wa tshimbila nga Mulayo wa Vhushaka ha Mushumi na polisi ya mulandu ya khamphani yashu.",incident:n=>`Zwithu zwine ra tea u zwi amba ndi zwi: ${n}. Maitele aya a si kha fhasi ha zwiyimo zwashu zwa fhethu ha mushumo na mipholisi ya khamphani.`,warningExplanation:n=>`Hu tshi tevhedzwa vhukhakhi na muitero washu wa mulandu, ndi khou ni nea tivhiso ya ${n}. Iyi tivhiso i do dzula i khou shuma kha rekhodho yavho ya mushumo nga tshifhinga tsha u shuma tshine tsha bulwa.`,rights:()=>"Zwino, zwa khongolose uri no pfesesehe pfanelo dzavho kha uyu muitero:",rightsList:()=>["No na pfanelo ya u fhindula kha iyi tivhiso nahone no nee ndivho yavho ya zwithu zwo itikelaho.","No nga humbela uri hu vhe na muhumbeli arali no khou toda kha iyi ngudo.","No na pfanelo ya u appela kha tshiphinzhi itshi nga ngomu dza awara dza 48 arali no tenda uri a zwi kha fhasi ha vhulungana kana zwa si itiwa nga ndila yo teaho.","Uga mulandu uyu u khou fhiraho phanḓa - mafhungo o phindaho kana o nzhulaho o nga kondelela kha magato a mufifi a mulandu.","No na pfanelo ya u mimelwa nga union arali no ri memba wa union yo tenderedzwaho.","Mafhungo othe ano amba a do tshimbila sa swihlayiselo nahone a do abelana fhedzi na vhaṱhohi vha nkoka na vhashumi vha HR."],witnessOption:()=>"Arali no nanga u si saini iyi tivhiso, ndi pfanelo yavho. Fhedzi ri humbela no pfesesehe uri muhumbeli o do saini u khwaṱhisedza uri iyi tivhiso yo nedziwa kwavho nga ndila yo teaho nahone no divhisiwa pfanelo dzavho dzoṱhe. Tivhiso i khou sala i khou shuma arali no i saininwa kana no sa i saini.",questions:()=>"Vho na mbudziso nga iyi tivhiso, zwo itikelaho, kana pfanelo dzavho dzine nda dzi talutshedzesa? Ndi khou toda u vhona uri no pfesesesa zwoṱhe nga u fhedzisesa phanḓa ha u fhiraho phanḓa.",closing:()=>"Ndo livhuwa nga u thetshelesa. Zwino ro do fhiraho phanḓa u ṅwala iyi tivhiso nga ndila yo teaho. Humbulani, zwi ndi tshifhinga tsha u khwinisa, nahone ri khou lindela u vhona tshanduko ntswa kha mavanyiseli avho kha tshifhinga tshi tshaho."},ss:{greeting:(n,t)=>`Sawubona ${n}. Libito lami ngu-${t}, futhi ngidvinga kukhuluma nawe ngendaba yemsebenzi leseyenteke kamuva nje.`,purpose:()=>"Loluhlangano ngalokukhulunywa ngemsebenti wokulajiswa ngendlela yemtsetfo. Ngifuna kubone kutsi uyatizwa emalungelo akho kanye nenqubo lesiyilandzelelayo, lehambelana neMtsetfo weTinhlangano teTisebenzi kanye nephalisinkomba yekulajiswa yekhamphani yaletfu.",incident:n=>`Lesi sehlo lesifanele sikhulunyane ngaso ngulesi: ${n}. Loku kuziphatha akuhambisani netintfo tetfu temtsetfo wemsebenti kanye nephalisinkomba yekhamphani.`,warningExplanation:n=>`Ngekwesekwa bukhulu kanye nenqubo yaletfu yekulajiswa, ngikupha sixwayiso se-${n}. Lesi sixwayiso sitawuhlala sisebenta kurekhodi yakho yemsebenzi ngelisikhasti sokuphila lesichaziwe.`,rights:()=>"Manje, kubalulekile kakhulu kutsi watizwe emalungelo akho kule nqubo:",rightsList:()=>["Unelilungelo lekuphendvula kulesi sixwayiso kanye nekuveta umbiko wakho waletitifo letentekako.","Ungacela kutsi kube khona umfakazi kule nkhulumano uma ucela.","Unelilungelo lekuphikisana nalesi sinqumo ngekutsatsa emahora lange-48 uma ukholwa kutsi awulungile noma awenziwa ngendlela lefanele.","Lesi senzempi sekulajiswa siyacondzaphambili - emacala laphindvako noma lamabi kakhulu angaletha tinyatselo letinye tekulajiswa.","Unelilungelo lekumelelwa ngumnyamo uma ulingidzima lemnyamweni lowamukekile.","Tonkhe lwati lolokhulunywa ngatsi lutawuhlaliswa luyimfihlo futhi lunikezelwe kuphela kubaphati labadzingekako kanye netisebenzi te-HR."],witnessOption:()=>"Uma ukhetha ungasisayini lesi sixwayiso, yilelo ilungelo lakho. Kodvwa-ke sicela uwatizwe kutsi umfakazi utawusayina kucoka kutsi lesi sixwayiso siletjwe kuwe ngendlela lefanele futhi wanglelwa ngemalungelo akho onkhe. Sixwayiso sihlala sisebenta noma usisayinile noma ungasisayinanga.",questions:()=>"Ingabe unemibuto ngalesi sixwayiso, sehlo, noma emalungelo akho lengiwahlatsheliselile? Ngifuna kucoka kutsi uwatizwa tonkhe kachubeka phambi kokucondzaphambili.",closing:()=>"Ngiyabonga ngekutilalela. Manje sitawucondzaphambili kutsala lesi sixwayiso ngendlela lefanele. Khumbulanani, loku kuyindzawo yekuntfula, futhi sitawubona tingutsuko letintsja ekuziphatheni kwakho kutsine kuye phambi."},tn:{greeting:(n,t)=>`Dumelang ${n}. Leina la me ke ${t}, mme ke batla go bua le wena ka kgang ya tiro e e diragetseng gone jaanong.`,purpose:()=>"Kopano eno ke go buisana ka kgang ya kgalemelo ka tsela ya semolao. Ke batla go netefatsa gore o tlhaloganya ditshwanelo tsa gago le thulaganyo e re e latelang, e e tsamayang le Molao wa Dikamano tsa Badiri le pholisi ya kgalemelo ya khampani ya rona.",incident:n=>`Kgang e re tshwanetseng go e buisana ke eno: ${n}. Boitshwaro jono ga bo tsamaelane le ditekanyetso tsa rona tsa lefelo la tiro le dipholisi tsa khampani.`,warningExplanation:n=>`Go ya ka boima le thulaganyo ya rona ya kgalemelo, ke go naya temoso ya ${n}. Temoso eno e tla nna e bereka mo rekotong ya gago ya tiro ka nako ya go bereka e e tlhalosiwang.`,rights:()=>"Jaanong, go botlhokwa thata gore o tlhaloganye ditshwanelo tsa gago mo thulaganyong eno:",rightsList:()=>["O na le tshwanelo ya go araba temoso eno mme o neye kgang ya gago ya ditiragalo.","O ka kopa gore go nne le paki mo puisanong eno fa o batla.","O na le tshwanelo ya go boipiletsa tshwetso eno mo diureng tse 48 fa o dumela gore ga e siame kgotsa ga e a dirwa sentle.","Kgato eno ya kgalemelo e ya pele - ditlolo tse di boelwang kgotsa tse di masisi thata di ka feleletsa ka dikgato tse dingwe tsa kgalemelo.","O na le tshwanelo ya go emelwa ke kopano fa o le leloko la kopano e e amogetsweng.","Tshedimosetso yotlhe e e buisanwang e tla bolokwa e le sephiri mme e arolelane fela le batsamaisi ba ba botlhokwa le badiri ba HR."],witnessOption:()=>"Fa o tlhopha go sa saene temoso eno, ke tshwanelo ya gago. Fela ke a go rapela gore o tlhaloganye gore paki e tla saena go netefatsa gore temoso eno e o newetswe ka tsela e e siameng mme o itsisiwe ka ditshwanelo tsa gago tsotlhe. Temoso e nna e bereka go sa kgathalesege gore o e saenile kgotsa ga o a e saena.",questions:()=>"A o na le dipotso ka temoso eno, kgang, kgotsa ditshwanelo tsa gago tse ke di tlhalositseng? Ke batla go netefatsa gore o tlhaloganya tsotlhe pele re ya pele.",closing:()=>"Ke a leboga go reetsa. Jaanong re tla ya pele go kwala temoso eno ka tsela e e siameng. Gopola, seno ke sebaka sa go tokafatsa, mme re lebeletse go bona diphetogo tse dintle mo boitshwarong jwa gago mo nakong e e tlang."},nr:{greeting:(n,t)=>`Lotjhani ${n}. Ibizo lami ngu-${t}, futhi ngidinga ukukhuluma nawe ngodaba lomsebenzi olwenzeke muva nje.`,purpose:()=>"Leli hlangano ngolokukhuluma ngodaba lokuqeqesha ngendlela yomthetho. Ngifuna ukuqinisekisa ukuthi uyaziqonda amalungelo akho kanye nenqubo esiyilandelayo, ehambisana noMthetho weBudlelwano Basebenzi kanye nenqubomgomo yokuqeqesha yenkampani yethu.",incident:n=>`Isigameko okumele sikuxoxe sikulesi: ${n}. Lokhu kuziphatha akuhambisani nezindinganiso zethu zendawo yomsebenzi kanye nezinqubomgomo zenkampani.`,warningExplanation:n=>`Ngokusekelwe ebunzimeni kanye nenqubo yethu yokuqeqesha, ngikupha isixwayiso se-${n}. Lesi sixwayiso sizokwanda sisebenza emarekhodi akho omsebenzi isikhathi sokusebenza esichaziwe.`,rights:()=>"Manje, kubaluleke kakhulu ukuthi uqonde amalungelo akho kule nqubo:",rightsList:()=>["Unelungelo lokuphendula kulesi sixwayiso futhi unikeze umbiko wakho wezigameko.","Ungacela ukuthi kube khona umfakazi kule nkulumo uma ufuna.","Unelungelo lokubhena lesi sinqumo phakathi namahora angama-48 uma ukholelwa ukuthi awulungile noma awenziwa ngendlela efanele.","Lesi senzo sokuqeqesha siyaqhubeka - amacala aphindwayo noma amabi kakhulu angaholela ezinyathelweni ezinye zokuqeqesha.","Unelungelo lokumelelwa yinyunyana uma uyilungu lenyunyana esamukelekile.","Lonke ulwazi oluxoxwayo luzogcinwa luyimfihlo futhi lwabelane kuphela nabapha boholi abadingekayo kanye nabasebenzi be-HR."],witnessOption:()=>"Uma ukhetha ukungasayini lesi sixwayiso, lelo ilungelo lakho. Kodwa-ke sicela uqonde ukuthi umfakazi uzosayina ukuqinisekisa ukuthi lesi sixwayiso sikulethwe ngendlela efanele futhi wazisiwe wonke amalungelo akho. Isixwayiso sihlala sisebenza noma uyasisayina noma ungasisayina.",questions:()=>"Ingabe unemibuzo ngalesi sixwayiso, isigameko, noma amalungelo akho engiwacacisile? Ngifuna ukuqinisekisa ukuthi uqonda konke ngokuphelele ngaphambi kokuqhubeka.",closing:()=>"Ngiyabonga ukuthi ulalele. Manje sizokwanda siqhubeke nokubhala lesi sixwayiso ngendlela efanele. Khumbula, lokhu kuyithuba lokuthuthuka, futhi sithemba ukubona ushintsho oluhle ekuziphatheni kwakho kwesikhathi esizayo."},ns:{greeting:(n,t)=>`Thobela ${n}. Leina la ka ke ${t}, gomme ke hloka go boledišana le wena ka taba ya mošomo yeo e diregego bjale.`,purpose:()=>"Kopano ye ke go boledišana ka taba ya kgalemo ka tsela ya molao. Ke nyaka go netefatša gore o kwešiša ditokelo tša gago le tshepedišo yeo re e latelago, yeo e sepelelanago le Molao wa Dikamano tša Bašomi le pholisi ya kgalemo ya khamphani ya rena.",incident:n=>`Tiragalo yeo re swanetšego go e boledišana ke ye: ${n}. Boitshwaro bjo ga bo sepelelane le ditekanyetšo tša rena tša lefelo la mošomo le dipholisi tša khamphani.`,warningExplanation:n=>`Go ya ka bogolo le tshepedišo ya rena ya kgalemo, ke go nea temošo ya ${n}. Temošo ye e tlago dula e šoma go direkoto tša gago tša mošomo ka nako ya go šoma yeo e hlalošitšwego.`,rights:()=>"Bjale, go bohlokwa kudu gore o kwešiše ditokelo tša gago tshepedišong ye:",rightsList:()=>["O na le tokelo ya go araba temošo ye gomme o neye pale ya gago ya ditiragalo.","O ka kgopela gore go be le paki puledišanong ye ge o nyaka.","O na le tokelo ya go boipiletšo tshwetšong ye ka gare ga diiri tše 48 ge o dumela gore ga e nepagetšego goba ga e dirwa gabotse.","Kgato ye ya kgalemo e tšwela pele - diphošo tšeo di boeletšwago goba tšeo di maatla kudu di ka phethelela dikgatong tše dingwe tša kgalemo.","O na le tokelo ya go emelwa ke mokgatlo ge o le leloko la mokgatlo wo o amogetšwego.","Tshedimošo ka moka yeo e boletšwego e tlago bolokwa e le sephiri gomme e abelanwa feela le balaodi ba bohlokwa le bašomi ba HR."],witnessOption:()=>"Ge o kgetha go se saene temošo ye, ke tokelo ya gago. Eupša ke a go rapela gore o kwešiše gore paki e tlago saena go netefatša gore temošo ye e o fihlele ka tsela ye e nepagetšego gomme o tsebišwa ka ditokelo tša gago ka moka. Temošo e dula e šoma ntle le go ela hloko gore o e saenile goba aowa.",questions:()=>"Na o na le dipotšišo ka temošo ye, tiragalo, goba ditokelo tša gago tšeo ke di hlalošitšego? Ke nyaka go netefatša gore o kwešiša tše ka moka pele re tšwelapele.",closing:()=>"Ke leboga go theeletša. Bjale re tlago tšwelapele go ngwala temošo ye ka tsela ye e nepagetšego. Gopola, se ke sebaka sa go kaonafatša, gomme re lebelletše go bona diphetogo tše dibotse boitshwarong bja gago ka nako ye e tlago."}},Sd=({employeeName:n,managerName:t,incidentDescription:s,warningLevel:r,onScriptRead:a,disabled:i=!1})=>{const[o,l]=p.useState("en"),[m,c]=p.useState(!1),[x,u]=p.useState(!1),h=Mn[o]||Mn.en,v=oa.find(b=>b.code===o)||oa[0],g=()=>{u(!0),a()};return e.jsx("div",{className:"space-y-2",children:e.jsx("div",{className:"border rounded-lg p-3",style:{background:"linear-gradient(to right, var(--color-alert-warning-bg), var(--color-alert-warning-bg))",borderColor:"var(--color-alert-warning-border)"},children:m?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:e.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Opening & Introduction"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.greeting(n,t)})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Meeting Purpose"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.purpose()})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Incident Details"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.incident(s)})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Warning Details"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.warningExplanation(r)})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"5. Your Rights"}),e.jsx("p",{className:"text-xs leading-relaxed mb-2",style:{color:"var(--color-text-secondary)"},children:h.rights()}),e.jsx("ul",{className:"space-y-1 text-xs",style:{color:"var(--color-text-secondary)"},children:h.rightsList().map((b,f)=>e.jsxs("li",{className:"flex items-start gap-1.5",children:[e.jsx(mt,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--color-success)"}}),b]},f))})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-secondary)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"6. Witness & Signature Rights"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.witnessOption()})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"7. Questions & Clarifications"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.questions()})]}),e.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-text-tertiary)"},children:[e.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"8. Closing"}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.closing()})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[e.jsx(Ne,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),e.jsxs("span",{children:["Read this complete script aloud to ",n]})]}),x?e.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[e.jsx(mt,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):e.jsxs("button",{onClick:g,disabled:i,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:b=>{b.currentTarget.style.opacity="0.9"},onMouseLeave:b=>{b.currentTarget.style.opacity="1"},children:[e.jsx(mt,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]}),e.jsx("div",{className:"border rounded-lg p-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-info)"}}),e.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-info-text)"},children:[e.jsx("p",{className:"font-medium mb-0.5",children:"Legal Compliance Notice"}),e.jsx("p",{children:"This script ensures compliance with the Labour Relations Act (LRA) requirements for procedural fairness in disciplinary proceedings. All employee rights have been comprehensively covered in their preferred language."})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Co,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Employee Warning Script"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Complete script covering all employee rights"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ei,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),e.jsx("select",{value:o,onChange:b=>l(b.target.value),disabled:x||i,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:oa.map(b=>e.jsx("option",{value:b.code,children:b.nativeName},b.code))})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-1 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[e.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-warning-text)"},children:["Script available in ",e.jsx("strong",{children:v.nativeName})," • Ready to read aloud"]}),e.jsxs("button",{onClick:()=>c(!0),disabled:i,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-medium",style:{backgroundColor:"var(--color-warning)",color:"var(--color-text-inverse)"},onMouseEnter:b=>{b.currentTarget.style.backgroundColor="var(--color-warning)",b.currentTarget.style.opacity="0.9"},onMouseLeave:b=>{b.currentTarget.style.backgroundColor="var(--color-warning)",b.currentTarget.style.opacity="1"},children:[e.jsx(ye,{className:"w-3 h-3"}),"View Full Script"]})]})]})})})},la=(n,t="Unknown")=>n==null?t:typeof n=="string"?n:typeof n=="object"&&n.name?String(n.name):String(n),Ed=({lraRecommendation:n,selectedEmployee:t,formData:s,currentManagerName:r,onSignaturesComplete:a,isAnalyzing:i=!1,signaturesFinalized:o=!1,currentSignatures:l})=>{const[m,c]=p.useState(!1),[x,u]=p.useState(!1),[h,v]=p.useState(!1),[g,b]=p.useState(!1),[f,j]=p.useState(l||{manager:null,employee:null});p.useEffect(()=>{l&&j(l)},[l]),p.useEffect(()=>{x&&b(!0)},[x]);const w=t||{id:"unknown",firstName:"Unknown",lastName:"Employee",position:"Unknown Position",department:"Unknown Department",email:"unknown@email.com",phone:"Unknown",deliveryPreference:"email",recentWarnings:{count:0},riskIndicators:{highRisk:!1,reasons:[]}},C=!!(f.manager&&f.employee);p.useCallback(()=>{v(!0),setTimeout(()=>{u(!0),v(!1)},1500)},[]);const D=p.useCallback(A=>{j(R=>({...R,manager:A}))},[]),S=p.useCallback(A=>{j(R=>({...R,employee:A}))},[]),y=p.useCallback(()=>{if(!C||o)return;const A={...f,timestamp:new Date().toISOString(),managerName:r,employeeName:`${w.firstName} ${w.lastName}`};a(A,!0)},[f,C,o,r,w,a]);return i?e.jsxs(ne,{padding:"xl",className:"text-center",children:[e.jsx(et,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"var(--color-primary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Analyzing legal requirements..."})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"LRA Recommendation"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Legal analysis complete"})]})]}),e.jsxs(ue,{variant:"ghost",size:"sm",onClick:()=>c(!m),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[m?"Hide":"Details",m?e.jsx(Gt,{className:"w-3 h-3"}):e.jsx(Ke,{className:"w-3 h-3"})]})]}),e.jsxs(ne,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ot,{variant:"primary",size:"sm",className:"font-semibold",children:la(n?.recommendedLevel)}),n?.isEscalation&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-warning)"},children:"Escalation"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-primary)"}}),e.jsx("span",{className:"font-medium",style:{color:"var(--color-primary)"},children:n?.warningCount||0}),e.jsx("span",{children:"total"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-success)"},children:"Analyzed"})]})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:la(n?.reason,"Progressive discipline policy requires escalation based on employee history.")})})]})]}),m&&e.jsx(ne,{padding:"sm",className:"border",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Analysis Summary"})]}),e.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:la(n?.explanation||n?.reason,"Progressive discipline assessment completed based on employee warning history and incident severity.")})]}),n?.legalRequirements&&n.legalRequirements.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(At,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Legal Compliance"})]}),e.jsxs("div",{className:"space-y-1",children:[n.legalRequirements.slice(0,2).map((A,R)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5",style:{backgroundColor:"var(--color-info)"}}),e.jsx("span",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:A})]},R)),n.legalRequirements.length>2&&e.jsxs("p",{className:"text-xs ml-3.5",style:{color:"var(--color-info)"},children:["+ ",n.legalRequirements.length-2," more requirements"]})]})]}),e.jsxs("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-card-border)"},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Re,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),e.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-text)"},children:"Warning History"})]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Employee has ",e.jsx("strong",{children:n?.warningCount||0})," active warning record.",n?.activeWarnings&&n.activeWarnings.length>0&&e.jsxs("span",{className:"ml-1",children:["Most recent warning was issued ",e.jsx("strong",{children:"0 days ago"}),"."]})]})]})]})}),e.jsx(Sd,{employeeName:`${w.firstName} ${w.lastName}`,managerName:r,incidentDescription:s.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:n?.level||"disciplinary",onScriptRead:()=>u(!0),disabled:x}),g&&e.jsxs(ne,{padding:"sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Signatures"})]}),e.jsx("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:e.jsx("span",{children:C?"Complete":"Pending"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-3.5 h-3.5",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Manager"}),e.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:r})]}),f.manager&&e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),e.jsx(On,{onSignatureComplete:D,disabled:o,label:"Manager Signature",placeholder:"Manager signature",initialSignature:f.manager,width:300,height:80})]}),e.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Pe,{className:"w-3.5 h-3.5",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Employee"}),e.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[w.firstName," ",w.lastName]})]}),f.employee&&e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),e.jsx(On,{onSignatureComplete:S,disabled:o,label:"Employee Signature",placeholder:"Employee signature",initialSignature:f.employee,width:300,height:80})]})]}),C&&!o&&e.jsxs("div",{className:"mt-3 p-2 rounded-lg flex items-center justify-between",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Ready to finalize"})]}),e.jsxs(ue,{onClick:y,size:"sm",className:"px-3 py-1.5",children:[e.jsx(Jt,{className:"w-3 h-3 mr-1"}),"Finalize"]})]}),o&&e.jsxs("div",{className:"mt-3 p-2 rounded-lg flex items-center gap-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-info)"}}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-alert-info-text)"},children:"Finalized"}),f.timestamp&&e.jsx("span",{className:"ml-2",style:{color:"var(--color-alert-info-text)"},children:new Date(f.timestamp).toLocaleDateString()})]})]})]})]})};class Ad{static async createDeliveryNotification(t){try{d.debug("📬 Creating delivery notification for HR...",t);const s=this.determinePriority(t.warningLevel),r=this.prepareContactDetails(t),a={organizationId:t.organizationId,warningId:t.warningId,employeeId:t.employeeId,employeeName:t.employeeName,employeeEmail:t.employeeEmail,employeePhone:t.employeePhone,warningLevel:t.warningLevel,warningCategory:t.warningCategory,incidentDate:t.incidentDate,deliveryMethod:t.deliveryMethod,deliveryPreference:t.isEmployeePreference?"employee_choice":"manager_choice",contactDetails:r,status:"pending",priority:s,deliveryAttempts:0,createdAt:re(),updatedAt:re(),createdBy:t.createdBy,createdByName:t.createdByName},i=await vs(se(B,"organizations",t.organizationId,"deliveryNotifications"),a);return d.success(3842),await this.createSystemNotification(t,i.id),i.id}catch(s){throw d.error("❌ Failed to create delivery notification:",s),s}}static async updateDeliveryStatus(t,s,r,a){try{const i={status:s,updatedAt:re()};s==="delivered"&&(i.deliveryDate=re(),i.deliveredBy=a),r&&(i.deliveryNotes=r),d.debug("📝 Updating delivery status:",t,s)}catch(i){throw d.error("❌ Failed to update delivery status:",i),i}}static determinePriority(t){switch(t.toLowerCase()){case"dismissal":case"suspension":return"urgent";case"final_written":case"final written warning":return"high";default:return"normal"}}static prepareContactDetails(t){const s={};switch(t.deliveryMethod){case"email":t.employeeEmail&&(s.email=t.employeeEmail);break;case"whatsapp":t.employeePhone&&(s.phone=t.employeePhone);break;case"printed":s.address="To be confirmed by HR";break}return s}static async createSystemNotification(t,s){try{const{QuickNotifications:r}=await nt(async()=>{const{QuickNotifications:a}=await import("./NotificationDeliveryService-1e6SJJSl.js");return{QuickNotifications:a}},__vite__mapDeps([6,2,1,3,4,5]));await r.warningNeedsDelivery(t.organizationId,t.employeeName,t.warningLevel,this.getDeliveryMethodName(t.deliveryMethod)),d.debug("🔔 Role-based notification sent to HR team")}catch(r){d.error("❌ Failed to create system notification:",r)}}static generateNotificationMessage(t){const s=this.getDeliveryMethodName(t.deliveryMethod),r=t.isEmployeePreference?" (employee's preferred method)":" (selected by manager)";return`Warning issued to ${t.employeeName} requires delivery via ${s}${r}. Warning level: ${t.warningLevel}.`}static getDeliveryMethodName(t){switch(t){case"email":return"Email";case"whatsapp":return"WhatsApp";case"printed":return"Print & Hand Delivery";default:return t}}}class Vs{static getDeliveryInstructions(t){switch(t){case"email":return{title:"Email Delivery Instructions",steps:["Download the warning PDF from the system","Compose professional email with warning attached","Send to employee's work email address","Request read receipt if supported","Follow up if no acknowledgment within 2 business days"],requirements:["Valid email address on file","PDF warning document","Professional email template"],documentation:["Screenshot of sent email","Read receipt (if available)","Employee acknowledgment response"]};case"whatsapp":return{title:"WhatsApp Business Delivery Instructions",steps:["Verify employee's WhatsApp Business number","Send professional message introducing the warning","Share warning PDF as document attachment","Request confirmation of receipt","Document the conversation for records"],requirements:["WhatsApp Business account","Employee's valid phone number","Professional communication standards"],documentation:["Screenshot of conversation","Delivery receipt confirmation","Employee read/response confirmation"]};case"printed":return{title:"Print & Hand Delivery Instructions",steps:["Print warning document on company letterhead","Prepare delivery receipt form","Locate employee at their workstation/department","Hand deliver in presence of witness (if possible)","Obtain signed receipt of delivery","Scan and upload proof of delivery"],requirements:["Printed warning document","Delivery receipt form","Employee location/schedule","Witness (recommended)"],documentation:["Signed delivery receipt","Photo of handed document (if permitted)","Witness statement (if applicable)","Date, time, and location of delivery"]};default:return{title:"General Delivery Instructions",steps:["Contact IT support for delivery method guidance"],requirements:["Valid employee contact information"],documentation:["Proof of delivery attempt"]}}}}const Rd=({selectedEmployee:n,formData:t,lraRecommendation:s,signatures:r,organizationName:a,currentManagerName:i,audioRecording:o,onComplete:l,onWarningCreated:m,warningId:c})=>{const{user:x}=De(),{organization:u}=We(),[h,v]=p.useState("email"),[g,b]=p.useState(!1),[f,j]=p.useState(!1),[w,C]=p.useState(!1),[D,S]=p.useState(null),[y,A]=p.useState(!1),[R,_]=p.useState(null),[F,k]=p.useState(!1),[E,N]=p.useState(null),[I,T]=p.useState(!1),z=[{id:"email",name:"Email Delivery",icon:Rt,description:"HR will deliver via email with read receipt tracking",available:!!n?.email},{id:"whatsapp",name:"WhatsApp Business",icon:qr,description:"HR will deliver via WhatsApp Business with confirmation",available:!!n?.phone},{id:"printed",name:"Print & Hand Deliver",icon:Br,description:"HR will print and hand deliver with signed receipt",available:!0}],O=p.useCallback(async()=>{try{d.debug("🔄 Opening PDF preview modal..."),b(!0)}catch(P){d.error("❌ Error opening PDF preview:",P),S("Failed to generate PDF preview")}},[]),q=p.useCallback(async(P,L)=>{if(!n||!u||!x||!c){S("Missing required data for HR notification");return}try{j(!0),S(null),d.debug("📬 Creating HR delivery notification for warning:",c);try{k(!0),d.debug("📬 Creating delivery notification for HR...");const U=await Ad.createDeliveryNotification({warningId:c,organizationId:u.id,employeeId:n.id,employeeName:`${n.firstName} ${n.lastName}`,employeeEmail:n.email,employeePhone:n.phone,warningLevel:s?.suggestedLevel||t.level||"counselling",warningCategory:s?.category||t.category||"General",incidentDate:t.incidentDate,deliveryMethod:h,isEmployeePreference:n?.deliveryPreference===h,createdBy:x.id,createdByName:i});N(U),d.success(9578),A(!0)}catch(U){d.error("❌ Failed to create delivery notification:",U),S(U.message||"Failed to notify HR about delivery")}finally{k(!1)}d.success(10016)}catch(U){d.error("❌ Error creating HR notification:",U),S(U.message||"Failed to create HR notification")}finally{j(!1)}},[n,u,x,c,h,s,t,i]),Y=p.useCallback(async()=>q(),[q]),G=p.useMemo(()=>!!(c&&h&&!f&&!E),[c,h,f,E]);return z.find(P=>P.id===h),y?e.jsx(ne,{padding:"xl",className:"max-w-2xl mx-auto text-center",children:e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-success-light)"},children:e.jsx(ae,{className:"w-8 h-8 sm:w-10 sm:h-10",style:{color:"var(--color-success)"}})}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",style:{color:"var(--color-text)"},children:"Warning Issued Successfully!"}),e.jsxs("p",{style:{color:"var(--color-text-secondary)"},children:["Warning ",R?`#${R.slice(-8)}`:""," has been created."]}),e.jsxs("p",{className:"font-medium mt-2",style:{color:"var(--color-primary)"},children:["📬 HR has been notified to deliver via ",h]}),o?.audioUrl&&!D&&e.jsx(Xe,{variant:"success",className:"mt-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Gr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Audio recording saved successfully"})]})}),E&&e.jsxs(Xe,{variant:"info",className:"mt-4 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"HR Team Notified"})]}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:["Delivery notification #",E.slice(-8)," created for HR team"]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(ue,{variant:"ghost",size:"sm",onClick:()=>T(!I),className:"text-sm font-medium underline min-h-[40px]",children:[I?"Hide":"View"," Delivery Instructions for HR"]})}),I&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text)"},children:Vs.getDeliveryInstructions(h).title}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Steps to Follow:"}),e.jsx("ol",{className:"text-sm list-decimal list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Vs.getDeliveryInstructions(h).steps.map((P,L)=>e.jsx("li",{children:P},L))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Requirements:"}),e.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Vs.getDeliveryInstructions(h).requirements.map((P,L)=>e.jsx("li",{children:P},L))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Documentation Needed:"}),e.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Vs.getDeliveryInstructions(h).documentation.map((P,L)=>e.jsx("li",{children:P},L))})]})]})]}),D&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)"},children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",style:{color:"var(--color-alert-warning-text)"},children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Warning created, but audio upload had issues"})]}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-alert-warning-text)"},children:D})]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h2",{className:"text-lg font-semibold mb-1",style:{color:"var(--color-text)"},children:"Delivery & Completion"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Warning Summary"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Employee: ",n?.firstName," ",n?.lastName]})]})]}),e.jsx(ne,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ot,{variant:"success",size:"sm",className:"font-semibold",children:s?.recommendedLevel||"Counselling Session"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-success)"}}),e.jsxs("span",{className:"font-medium",style:{color:"var(--color-success)"},children:["#",c?.slice(-8)," created"]}),o?.audioUrl&&e.jsx("span",{children:"• Audio included"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-success)"},children:"Ready"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Jt,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Delivery Method"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Choose how HR will deliver this warning"})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:z.map(P=>{const L=P.icon;return e.jsx(ne,{padding:"sm",hover:P.available,className:`cursor-pointer transition-all border-l-4 ${P.available?"":"opacity-50 cursor-not-allowed"}`,style:{borderLeftColor:h===P.id?"var(--color-primary)":"transparent",backgroundColor:h===P.id?"var(--color-alert-info-bg)":"transparent"},onClick:()=>P.available&&v(P.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-4 h-4",style:{color:"var(--color-text)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:P.name}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:P.description}),!P.available&&P.id==="whatsapp"&&e.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-error)"},children:"No phone number available"})]})]}),h===P.id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-primary)"},children:"Selected"})]}),e.jsx("input",{type:"radio",name:"deliveryMethod",value:P.id,checked:h===P.id,onChange:()=>{},disabled:!P.available,className:"sr-only"})]})},P.id)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Final Review"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Preview document and complete delivery process"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx(ne,{padding:"sm",hover:!0,className:"cursor-pointer border-l-4",style:{borderLeftColor:"var(--color-secondary)"},onClick:O,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ut,{className:"w-4 h-4",style:{color:"var(--color-secondary)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Preview Document"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Review warning before sending to HR"})]})]}),e.jsx(Pr,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}})]})}),e.jsx(ne,{padding:"sm",hover:!f&&G,className:`transition-all border-l-4 ${G&&!E?"cursor-pointer":""} ${!G&&!E?"opacity-50":""}`,style:{borderLeftColor:E?"var(--color-success)":G?"var(--color-primary)":"var(--color-border)",backgroundColor:E?"var(--color-alert-success-bg)":"transparent"},onClick:!f&&G?Y:void 0,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[f?e.jsx(et,{className:"w-4 h-4 animate-spin",style:{color:"var(--color-primary)"}}):E?e.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-success)"}}):e.jsx(Jt,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:f?"Notifying HR...":E?"HR Notified":"Notify HR"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:E?`Delivery notification sent via ${h}`:"Send delivery instructions to HR team"})]})]}),!E&&G&&!f&&e.jsx(Pr,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}})]})})]})]}),D&&e.jsx(Xe,{variant:"error",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-error)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Error"}),e.jsx("p",{className:"text-xs mt-1",children:D})]})]})}),w&&e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Uploading audio..."})]})}),F&&e.jsx(Xe,{variant:"info",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Notifying HR..."})]})}),g&&e.jsx(Zr,{isOpen:g,onClose:()=>b(!1),warningData:{selectedEmployee:n,formData:t,lraRecommendation:s,signatures:r,deliveryChoice:{method:h,timestamp:new Date,chosenBy:i},organizationName:a,currentManagerName:i,employee:n,organization:u},onPDFGenerated:(P,L)=>{d.debug("PDF generated for preview:",L)},isCompleted:!1})]})},Un=({size:n="medium",color:t="#3b82f6"})=>{const s={small:"1.5rem",medium:"3rem",large:"5rem"};return e.jsx("div",{style:{width:s[n],height:s[n],border:"4px solid #e2e8f0",borderTop:`4px solid ${t}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})},Fd=`
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }

  .skeleton-card {
    position: relative;
    overflow: hidden;
  }

  .skeleton-line {
    height: 1rem;
    margin-bottom: 0.5rem;
    background: linear-gradient(
      90deg,
      #f1f5f9 0px,
      #e2e8f0 40px,
      #f1f5f9 80px
    );
    background-size: 1000px;
    animation: shimmer 2s infinite linear;
    border-radius: 0.25rem;
  }

  .skeleton-header {
    height: 1.5rem;
    margin-bottom: 1rem;
    background: linear-gradient(
      90deg,
      #f1f5f9 0px,
      #e2e8f0 40px,
      #f1f5f9 80px
    );
    background-size: 1000px;
    animation: shimmer 2s infinite linear;
    border-radius: 0.25rem;
    width: 40%;
  }

  .skeleton-circle {
    background: linear-gradient(
      90deg,
      #f1f5f9 0px,
      #e2e8f0 40px,
      #f1f5f9 80px
    );
    background-size: 1000px;
    animation: shimmer 2s infinite linear;
    border-radius: 50%;
  }

  .skeleton-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
`;if(typeof document<"u"){const n=document.createElement("style");n.innerHTML=Fd,document.head.appendChild(n)}const lt={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},_d=({onPermissionGranted:n,onPermissionDenied:t,organizationName:s,managerName:r})=>{const[a,i]=p.useState("requesting"),[o,l]=p.useState("");p.useRef(Math.random().toString(36).substr(2,9)),p.useEffect(()=>{if(lt.callbacks.push(n),lt.errorCallbacks.push(t),lt.isGranted){i("granted"),setTimeout(n,100);return}return lt.isRequesting||(lt.isRequesting=!0,m()),()=>{const h=lt.callbacks.indexOf(n);h>-1&&lt.callbacks.splice(h,1);const v=lt.errorCallbacks.indexOf(t);v>-1&&lt.errorCallbacks.splice(v,1)}},[]);const m=async()=>{try{if(i("requesting"),l(""),!navigator.mediaDevices?.getUserMedia){i("not-supported"),l("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");return}(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(v=>v.stop()),i("granted"),lt.isGranted||(lt.isGranted=!0,lt.isRequesting=!1,lt.callbacks.forEach(v=>{setTimeout(v,1e3)}))}catch(h){console.error("Microphone permission error:",h),lt.isRequesting=!1,h.name==="NotAllowedError"?(i("denied"),l("Microphone access was denied. Please allow microphone access and try again.")):h.name==="NotFoundError"?(i("error"),l("No microphone was found on your device.")):h.name==="NotReadableError"?(i("error"),l("Your microphone is being used by another application.")):(i("error"),l("An error occurred while accessing your microphone.")),lt.errorCallbacks.forEach(v=>{v()})}},c=()=>{switch(a){case"requesting":return e.jsx(Un,{size:"medium",color:"#3b82f6"});case"granted":return e.jsx(Un,{size:"medium",color:"#16a34a"});case"denied":return e.jsx(pa,{className:"w-6 h-6 text-red-600"});case"error":return e.jsx(qe,{className:"w-6 h-6 text-red-600"});case"not-supported":return e.jsx(pa,{className:"w-6 h-6 text-gray-600"});default:return e.jsx(Gr,{className:"w-6 h-6 text-gray-600"})}},u=(()=>{switch(a){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:o};case"not-supported":return{title:"Browser Not Supported",message:o};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"max-w-sm w-full",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:c()}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:u.title}),e.jsx("p",{className:"text-sm text-gray-600",children:u.message})]}),(a==="denied"||a==="error")&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:m,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsx("p",{children:`Look for the microphone icon in your browser's address bar and click "Allow"`})})]})]}),e.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:e.jsx("p",{children:s})})]})})},dt={CODEC:"audio/webm;codecs=opus",BITRATE:16e3,SAMPLE_RATE:8e3,CHANNELS:1,MAX_DURATION_MS:300*1e3,MAX_SIZE_BYTES:800*1024,WARNING_THRESHOLD_MS:240*1e3,ECHO_CANCELLATION:!0,NOISE_SUPPRESSION:!0,AUTO_GAIN_CONTROL:!0};class xs{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return xs.instance||(xs.instance=new xs),xs.instance}canStart(){const t=Date.now();return this.isRecording||this.isStarting?(d.debug("🔄 Blocking recording - singleton already active"),!1):this.startedAt>0&&t-this.startedAt<1e3?(d.debug("🔄 Blocking duplicate recording attempt - too recent"),!1):this.allActiveStreams.size>0||this.allActiveTracks.size>0?(d.debug(`🔄 Blocking recording - ${this.allActiveStreams.size} active streams, ${this.allActiveTracks.size} active tracks exist`),!1):!0}tryReserve(){return this.canStart()?(this.isStarting=!0,this.startedAt=Date.now(),d.debug("🎤 Singleton: Recording slot reserved atomically"),!0):!1}startRecording(){this.isRecording=!0,d.debug("🎤 Singleton: Recording started")}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>{try{t.stop(),d.debug("🔴 Singleton: Stopped microphone track")}catch{d.debug("Track already stopped")}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null),d.debug("🧹 Singleton: Recording stopped and cleaned up")}setStream(t){return this.mediaStream||this.allActiveStreams.size>0?(d.debug(`🚫 Singleton: Rejecting stream - already have ${this.allActiveStreams.size} active streams`),t.getTracks().forEach(s=>s.stop()),!1):(this.allActiveStreams.add(t),t.getTracks().forEach(s=>{this.allActiveTracks.add(s),s.addEventListener("ended",()=>{this.allActiveTracks.delete(s)})}),this.mediaStream=t,this.isStarting=!1,d.debug(`🎤 Singleton: Stream set, recording active. Total streams: ${this.allActiveStreams.size}`),!0)}stopAllStreams(){d.debug(`🛑 Stopping ALL streams: ${this.allActiveStreams.size} streams, ${this.allActiveTracks.size} tracks`),this.allActiveStreams.forEach(t=>{t.getTracks().forEach(s=>{try{s.stop(),d.debug("🔴 Stopped tracked stream track")}catch{}})}),this.allActiveTracks.forEach(t=>{try{t.readyState==="live"&&(t.stop(),d.debug("🔴 Stopped orphaned track"))}catch{}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,d.debug("✅ All streams and tracks stopped and cleared")}}const Wt=xs.getInstance(),zd=()=>{const[n,t]=p.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),s=p.useRef(null),r=p.useRef([]),a=p.useRef(null),i=p.useRef(0),o=p.useRef(null),l=p.useRef(!1),m=p.useCallback(y=>{const A=Math.floor(y/60),R=Math.floor(y%60);return`${A}:${R.toString().padStart(2,"0")}`},[]),c=p.useCallback(y=>y<1024?`${y}B`:y<1024*1024?`${(y/1024).toFixed(1)}KB`:`${(y/(1024*1024)).toFixed(1)}MB`,[]),x=p.useCallback(()=>{const y=Date.now(),A=Math.random().toString(36).substr(2,9);return`audio_${y}_${A}`},[]),u=p.useCallback(()=>{if(!i.current)return;if(!n.isRecording){o.current&&(clearInterval(o.current),o.current=null);return}const y=(Date.now()-i.current)/1e3,A=Date.now()-i.current;if(t(R=>R.isRecording?{...R,duration:y}:R),A>=dt.MAX_DURATION_MS){d.debug("🔴 Auto-stopping recording: Max duration reached"),o.current&&(clearInterval(o.current),o.current=null),setTimeout(()=>{s.current&&s.current.state==="recording"&&s.current.stop()},0);return}A>=dt.WARNING_THRESHOLD_MS&&!l.current&&(d.debug("⚠️ Recording will auto-stop in 1 minute"),l.current=!0)},[]),h=p.useCallback(()=>{try{if(d.debug("🚨 FORCE CLEANUP: Stopping all audio recording immediately"),s.current){try{s.current.state==="recording"&&(s.current.stop(),d.debug("🔴 Force stopped MediaRecorder"))}catch{d.debug("MediaRecorder already stopped or errored")}s.current=null}[a.current,Wt.mediaStream].filter(Boolean).forEach(A=>{A&&A.getTracks().forEach(R=>{try{R.stop(),d.debug("🔴 Force stopped microphone track")}catch{d.debug("Track already stopped")}})}),a.current=null,Wt.stopAllStreams(),o.current&&(clearInterval(o.current),o.current=null),r.current=[],l.current=!1,i.current=0,t({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),d.debug("🧹 Force cleanup completed - all audio resources released")}catch(y){d.error("❌ Error during force cleanup:",y)}},[]),v=p.useCallback(async()=>{if(!Wt.tryReserve()){d.debug("🔄 Recording already active via singleton, skipping new recording start");return}try{if((a.current||s.current||Wt.mediaStream)&&(d.debug("🧹 Cleaning up previous recording before starting new one"),h(),await new Promise(F=>setTimeout(F,100))),t(F=>({...F,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const y=await navigator.mediaDevices.getUserMedia({audio:{channelCount:dt.CHANNELS,sampleRate:dt.SAMPLE_RATE,echoCancellation:dt.ECHO_CANCELLATION,noiseSuppression:dt.NOISE_SUPPRESSION,autoGainControl:dt.AUTO_GAIN_CONTROL}});if(!Wt.setStream(y)){d.debug("🚫 Stream rejected by singleton, aborting recording"),t(F=>({...F,isProcessing:!1,error:"Another recording is already active"}));return}a.current=y,r.current=[];const R=new MediaRecorder(y,{mimeType:dt.CODEC,audioBitsPerSecond:dt.BITRATE});s.current=R,R.ondataavailable=F=>{if(F.data.size>0){r.current.push(F.data);const k=r.current.reduce((E,N)=>E+N.size,0);t(E=>({...E,size:k})),k>=dt.MAX_SIZE_BYTES&&(d.debug("🔴 Auto-stopping recording: Max size reached"),g())}},R.onstop=()=>{d.debug("🎤 Recording stopped"),a.current&&(a.current.getTracks().forEach(F=>F.stop()),a.current=null)},R.start(1e3),i.current=Date.now(),l.current=!1,Wt.startRecording(),o.current=setInterval(u,100);const _=x();t(F=>({...F,isRecording:!0,isProcessing:!1,recordingId:_,duration:0,size:0})),d.debug("🎤 Recording started:",_)}catch(y){d.error("❌ Error starting recording:",y),Wt.stopRecording(),t(A=>({...A,isRecording:!1,isProcessing:!1,error:y.message||"Failed to start recording"}))}},[u,x]),g=p.useCallback(async()=>{try{return!s.current||!n.isRecording?null:(t(y=>({...y,isProcessing:!0})),o.current&&(clearInterval(o.current),o.current=null),new Promise(y=>{const A=s.current;A.onstop=()=>{try{const R=new Blob(r.current,{type:dt.CODEC}),_=URL.createObjectURL(R);t(F=>({...F,isRecording:!1,isProcessing:!1,audioUrl:_,size:R.size})),console.log("✅ Recording completed:",{duration:F=>F.duration,size:c(R.size),id:F=>F.recordingId}),y(_)}catch(R){d.error("❌ Error processing recording:",R),t(_=>({..._,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),y(null)}},A.stop(),t(R=>({...R,isRecording:!1}))}))}catch(y){return d.error("❌ Error stopping recording:",y),t(A=>({...A,isRecording:!1,isProcessing:!1,error:y.message||"Failed to stop recording"})),null}},[n.isRecording,c]),b=p.useCallback(()=>{s.current&&n.isRecording&&(s.current.pause(),o.current&&(clearInterval(o.current),o.current=null),d.debug("⏸️ Recording paused"))},[n.isRecording]),f=p.useCallback(()=>{s.current&&n.isRecording&&(s.current.resume(),i.current=Date.now()-n.duration*1e3,o.current=setInterval(u,100),d.debug("▶️ Recording resumed"))},[n.isRecording,n.duration,u]),j=p.useCallback(()=>{try{s.current&&s.current.stop(),a.current&&(a.current.getTracks().forEach(y=>y.stop()),a.current=null),o.current&&(clearInterval(o.current),o.current=null),n.audioUrl&&URL.revokeObjectURL(n.audioUrl),r.current=[],l.current=!1,t({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),d.debug("🗑️ Recording cancelled")}catch(y){d.error("❌ Error cancelling recording:",y)}},[n.audioUrl]),w=p.useCallback(async(y,A)=>{try{if(!n.audioUrl||!n.recordingId)throw new Error("No recording available to upload");t(T=>({...T,isProcessing:!0}));const _=await(await fetch(n.audioUrl)).blob(),F=`${n.recordingId}.webm`,k=`warnings/${y}/${A}/audio/${F}`,E=ca(Or,k),N={contentType:dt.CODEC,customMetadata:{warningId:A,organizationId:y,duration:n.duration.toString(),size:n.size.toString(),recordingId:n.recordingId,createdAt:new Date().toISOString()}};d.debug("☁️ Uploading audio to Firebase:",k),await da(E,_,N);const I=await ma(E);return t(T=>({...T,isProcessing:!1})),d.success(13735),I}catch(R){return d.error("❌ Error uploading audio:",R),t(_=>({..._,isProcessing:!1,error:R.message||"Failed to upload audio"})),null}},[n.audioUrl,n.recordingId,n.duration,n.size]),C=p.useCallback(async(y,A,R,_)=>{try{if(!y||!A)throw new Error("No recording data provided for upload");t(O=>({...O,isProcessing:!0}));const k=await(await fetch(y)).blob(),E=`${A}.webm`,N=`warnings/${R}/${_}/audio/${E}`,I=ca(Or,N),T={contentType:dt.CODEC,customMetadata:{warningId:_,organizationId:R,duration:n.duration.toString(),size:k.size.toString(),recordingId:A,createdAt:new Date().toISOString()}};d.debug("☁️ Uploading audio to Firebase from URL:",N),await da(I,k,T);const z=await ma(I);return t(O=>({...O,isProcessing:!1})),d.success(15712),z}catch(F){return d.error("❌ Error uploading audio from URL:",F),t(k=>({...k,isProcessing:!1,error:F.message||"Failed to upload audio"})),null}},[n.duration]);p.useEffect(()=>()=>{if(o.current&&(clearInterval(o.current),o.current=null),a.current&&(a.current.getTracks().forEach(y=>{y.stop(),d.debug("🔴 Stopped microphone track on cleanup")}),a.current=null),s.current){try{s.current.state==="recording"&&(s.current.stop(),d.debug("🔴 Stopped recording on cleanup"))}catch{d.debug("Recording already stopped")}s.current=null}r.current=[],l.current=!1,i.current=0,Wt.stopAllStreams(),d.debug("🧹 Audio recording hook cleaned up completely")},[]);const D=n.duration>=dt.WARNING_THRESHOLD_MS/1e3,S=!n.isRecording&&!n.isProcessing;return{...n,startRecording:v,stopRecording:g,pauseRecording:b,resumeRecording:f,cancelRecording:j,forceCleanup:h,uploadToFirebase:w,uploadToFirebaseFromUrl:C,formatDuration:m,formatSize:c,isNearLimit:D,canRecord:S}},Id=({employees:n,categories:t,currentManagerName:s,organizationName:r,onComplete:a,onCancel:i,preSelectedEmployeeId:o,preSelectedCategoryId:l,isFullScreen:m})=>{p.useRef(Math.random().toString(36).substr(2,9));const{user:c}=De(),{organization:x}=We(),u=zd(),h=p.useCallback(async()=>{j(!0),C(!1),d.debug("🎙️ Microphone permission granted")},[]),v=p.useCallback(()=>{j(!1)},[]);p.useEffect(()=>{const ie=ke=>{if(!(typeof window>"u"))if(ke){const he=window.scrollY;document.documentElement.style.setProperty("--scroll-y",`-${he}px`),document.body.classList.add("modal-open")}else{document.body.classList.remove("modal-open");const he=document.documentElement.style.getPropertyValue("--scroll-y");document.documentElement.style.removeProperty("--scroll-y"),he&&window.scrollTo(0,parseInt(he.replace("px",""))*-1)}};return ie(!0),()=>ie(!1)},[]);const[g,b]=p.useState(0),[f,j]=p.useState(!1),[w,C]=p.useState(!0),[D,S]=p.useState(new Set),[y,A]=p.useState(!1),[R,_]=p.useState(!1),[F]=p.useState(()=>oi()),[k,E]=p.useState({employeeId:o||null,categoryId:l||null,incidentDate:new Date().toISOString().split("T")[0],incidentTime:new Date().toTimeString().split(" ")[0].substring(0,5),incidentLocation:"",incidentDescription:"",additionalNotes:"",issueDate:new Date().toISOString().split("T")[0],validityPeriod:6}),[N,I]=p.useState(!1),[T,z]=p.useState([]),[O,q]=p.useState(null),[Y,G]=p.useState(null),[P,L]=p.useState(!1),[U,W]=p.useState(null),[$,H]=p.useState({manager:null,employee:null}),[V,ee]=p.useState(!1),Z=wd({stepName:`STEP_${g||1}`,autoStart:!0,enableRealTimeValidation:!1}),Ee=p.useRef(0);p.useRef(k),p.useRef(new Set);const Ae=p.useRef(!1),de=p.useMemo(()=>n.find(ie=>ie.id===k.employeeId),[n,k.employeeId]),pe=p.useMemo(()=>t.find(ie=>ie.id===k.categoryId),[t,k.categoryId]),te=p.useMemo(()=>x?.id,[x?.id]);p.useCallback(()=>{g>0&&!P&&b(g-1)},[g,P]),p.useCallback(()=>{g<3&&!P&&b(g+1)},[g,P]),p.useEffect(()=>{d.debug("🔍 Step changed, attempting scroll to top:",g);const ie=document.querySelector(".modal-content__scrollable");d.debug("🔍 Content element found:",!!ie),ie&&(d.debug("🔍 Current scroll position:",ie.scrollTop),ie.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{ie.scrollTop>0&&(d.debug("⚡ Fallback: Force instant scroll"),ie.scrollTop=0)},300))},[g]),p.useEffect(()=>{Ee.current!==g&&(Z.trackSuccess("STEP_CHANGED",{from:Ee.current,to:g,stepName:g===0?"Incident Details":g===1?"Legal Review":"Delivery Completion"}),Ee.current=g)},[g,Z]),u.isRecording;const Be=p.useCallback(async ie=>{if(!(!ie||!te)){Z.trackAPI("loadWarningHistory",{employeeId:ie,organizationId:te}),I(!0);try{const ke=await Ce.warnings.getAll(te,{employeeId:ie});z(ke),Z.trackAPI("loadWarningHistory",{employeeId:ie,organizationId:te},{count:ke.length})}catch(ke){Z.trackError(ke,{employeeId:ie,organizationId:te}),z([])}finally{I(!1)}}},[te,Z]),rt=p.useRef(null);p.useEffect(()=>{de&&!N&&rt.current!==de.id&&(rt.current=de.id,Be(de.id))},[de?.id,N,Be]);const ct=p.useCallback(async(ie,ke)=>{if(!ie||!ke||!te||!k.incidentDescription){const he={employeeId:!!ie,categoryId:!!ke,organizationId:!!te,incidentDescription:!!k.incidentDescription};Z.trackError(new Error("Cannot generate LRA - missing data"),he);return}A(!0),Z.trackAPI("generateLRARecommendation",{employeeId:ie,categoryId:ke});try{const he=await Ce.warnings.getEscalationRecommendation(ie,ke,x?.id||"default");q(he),Z.trackAPI("generateLRARecommendation",{employeeId:ie,categoryId:ke},he)}catch(he){Z.trackError(he,{employeeId:ie,categoryId:ke,formData:k});const _e=pe?.escalationPath||["counselling","verbal","first_written","final_written"],Oe={suggestedLevel:_e[0]||"counselling",recommendedLevel:_e[0]==="counselling"?"Counselling Session":_e[0]==="verbal"?"Verbal Warning":_e[0]==="first_written"?"First Written Warning":"Counselling Session",reason:"Fallback recommendation due to analysis error. Manual review required.",activeWarnings:[],escalationPath:_e,isEscalation:!1,category:pe?.name||"General Misconduct",categoryId:ke,legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure procedural fairness","Document thoroughly"],warningCount:0,nextExpiryDate:null,examples:["Review case manually","Consult HR if needed"],explanation:"Unable to analyze history - system error occurred",previousWarnings:[],confidence:60};q(Oe),Z.trackWarning("Using fallback LRA recommendation",Oe)}finally{A(!1)}},[te,k.incidentDescription,pe,Z]),Ge=p.useCallback(ie=>{const ke=["employeeId","categoryId","incidentLocation"];Object.keys(ie).some(_e=>ke.includes(_e)&&ie[_e]!==k[_e])&&Z.trackSuccess("SIGNIFICANT_FORM_UPDATE",ie),E(_e=>({..._e,...ie}))},[k,Z]),Le=p.useCallback(()=>{Z.trackSuccess("WIZARD_COMPLETED",{sessionDuration:Date.now()-new Date(Z.summary?.startTime||Date.now()).getTime(),totalSteps:D.size,totalIssues:Z.issues.length,finalWarningId:Y}),Z.endSession("completed"),a()},[a,Z,D.size,Y]),M=p.useCallback(()=>{Z.trackWarning("WIZARD_CANCELLED",{currentStep:g,completedSteps:Array.from(D)}),d.debug("🗑️ Force cleaning up audio recording due to wizard closure"),u.forceCleanup(),document.body.classList.remove("modal-open"),Z.endSession("cancelled"),i()},[i,Z,g,D,u]);p.useEffect(()=>Ae.current||!f||u.isRecording||u.audioUrl?void 0:((async()=>{try{Ae.current=!0,await u.startRecording(),Z.trackSuccess("AUDIO_RECORDING_STARTED",{duration:u.duration,size:u.size})}catch(ke){Z.trackError(ke,{context:"AUDIO_RECORDING_START"}),Ae.current=!1}})(),()=>{Ae.current=!1}),[f]),p.useEffect(()=>{U&&!y&&O&&(Z.trackSuccess("LRA_ANALYSIS_COMPLETE_PROCEEDING",{pendingStep:U,hasRecommendation:!!O}),b(U),W(null),L(!1))},[U,y,O,Z]);const K=p.useCallback(async()=>{if(Z.trackSuccess("NEXT_STEP_REQUESTED",{currentStep:g,hasLRA:!!O}),g>=2)return;const ie=g+1;if(S(ke=>new Set([...ke,g])),g===0&&ie===1){if(!k.employeeId||!k.categoryId||!k.incidentDescription){Z.trackError(new Error("Missing required data for step 2"),{employeeId:!!k.employeeId,categoryId:!!k.categoryId,incidentDescription:!!k.incidentDescription});return}if(O&&!y){Z.trackSuccess("PROCEEDING_TO_STEP_2",{hasLRA:!0}),b(ie);return}Z.trackSuccess("TRIGGERING_LRA_GENERATION",k),L(!0),W(ie),await ct(k.employeeId,k.categoryId);return}Z.trackSuccess("STEP_NAVIGATION_COMPLETE",{from:g,to:ie}),b(ie)},[g,k.employeeId,k.categoryId,k.incidentDescription,O,y,ct,Z]),ce=p.useCallback(()=>{g>0&&(Z.trackSuccess("PREVIOUS_STEP",{from:g,to:g-1}),b(g-1),P&&(L(!1),W(null),Z.trackWarning("NAVIGATION_CANCELLED_BY_BACK",{currentStep:g})))},[g,P,Z]),be=p.useCallback(async(ie,ke=!1)=>{if(Z.trackSuccess("SIGNATURES_COMPLETED",{hasManager:!!ie.manager,hasEmployee:!!ie.employee,finalized:ke,timestamp:ie.timestamp}),H(ie),ke){ee(!0);try{let he=null;if(u?.isRecording&&(d.debug("🎤 Auto-stopping audio recording before saving warning..."),Z.trackSuccess("AUDIO_AUTO_STOP_BEFORE_SAVE",{duration:u.duration,size:u.size}),he=await u.stopRecording(),d.success(21068),he||d.warn("⚠️ Audio URL not returned from stopRecording. Will create warning with placeholder.")),d.debug(21325),!de||!pe||!x)throw new Error("Missing required data for warning creation");const _e={employeeId:de.id,categoryId:pe.id,organizationId:x.id,employeeName:de.profile?.firstName||"Unknown",employeeLastName:de.profile?.lastName||"Employee",employeeNumber:de.profile?.employeeNumber||"Unknown",employeeDepartment:de.profile?.department||"Unknown",employeePosition:de.profile?.position||"Unknown",categoryName:pe.name||"Unknown",level:O?.suggestedLevel||"counselling",incidentDate:k.incidentDate,incidentTime:k.incidentTime,incidentLocation:k.incidentLocation,incidentDescription:k.incidentDescription,additionalNotes:k.additionalNotes,issueDate:k.issueDate,validityPeriod:k.validityPeriod,signatures:ie};he?(_e.audioRecording={url:he,duration:u?.duration||0,size:u?.size||0,recordingId:u?.recordingId,uploadToFirebase:!0,status:"ready",processingStatus:"pending"},d.success(23340)):(d.error("❌ Audio recording is mandatory for all warnings"),Z.trackError(new Error("Audio recording missing"),{warningData:k,audioState:{isRecording:u?.isRecording,hasDirectUrl:!!he,hasStateUrl:!!u?.audioUrl,duration:u?.duration}}),_e.audioRecording={status:"missing",processingStatus:"required",error:"Audio recording is mandatory but was not captured",duration:u?.duration||0,size:u?.size||0,uploadToFirebase:!1,requiresAttention:!0});const Oe=await Ce.warnings.create(_e);if(d.success(24554),G(Oe),he&&u?.uploadToFirebaseFromUrl&&u?.recordingId&&Oe)try{d.debug("☁️ Uploading audio to Firebase Storage...");const Dt=await u.uploadToFirebaseFromUrl(he,u.recordingId,x.id,Oe);if(Dt){d.success(25382),d.debug("📝 Updating warning document with Firebase audio URL...");const zt=Q(B,"organizations",x.id,"warnings",Oe);await Te(zt,{"audioRecording.url":Dt,"audioRecording.storageePath":`warnings/${x.id}/${Oe}/audio/${u.recordingId}.webm`,"audioRecording.processingStatus":"complete","audioRecording.uploadedAt":new Date,updatedAt:new Date}),d.success(26224),Z.trackSuccess("AUDIO_UPLOADED_AND_UPDATED",{warningId:Oe,firebaseUrl:Dt,duration:u.duration,size:u.size}),d.debug("🧹 Force cleaning up audio recording after successful upload..."),u.forceCleanup()}else d.warn("⚠️ Audio upload returned null URL"),Z.trackWarning("AUDIO_UPLOAD_NULL_URL",{warningId:Oe})}catch(Dt){d.error("❌ Audio upload failed:",Dt),Z.trackError(Dt,{context:"AUDIO_UPLOAD_STEP2",warningId:Oe,duration:u?.duration,size:u?.size});try{const zt=Q(B,"organizations",x.id,"warnings",Oe);await Te(zt,{"audioRecording.processingStatus":"failed","audioRecording.error":Dt.message||"Upload failed in Step 2","audioRecording.failedAt":new Date,updatedAt:new Date})}catch(zt){d.error("❌ Failed to update warning with audio error:",zt),Z.trackError(zt,{context:"AUDIO_ERROR_UPDATE"})}d.debug("🧹 Force cleaning up audio recording after upload failure..."),u.forceCleanup()}Z.trackSuccess("WARNING_FULLY_CREATED_STEP2",{warningId:Oe})}catch(he){d.error("❌ Error creating warning:",he),Z.trackError(he,{context:"WARNING_CREATION_ON_SIGNATURE_COMPLETE"})}S(he=>new Set([...he,g])),Z.trackSuccess("SIGNATURES_FINALIZED_NEXT_ENABLED",{currentStep:g})}},[g,Z,u,de,pe,x,k,O,Ce]),$e=p.useMemo(()=>({0:{title:"Incident Details",subtitle:"Step 1 of 3",description:"Select employee, choose violation category, and document the incident with all relevant details.",icon:ye},1:{title:"Review & Sign",subtitle:"Step 2 of 3",description:"Review escalation recommendation, read warning script, and collect required signatures.",icon:At},2:{title:"Deliver & Complete",subtitle:"Step 3 of 3",description:"Choose delivery method, generate warning document, and complete the warning process.",icon:Jt}}),[]),Fe=p.useMemo(()=>{switch(g){case 0:return!!(k.employeeId&&k.categoryId&&k.incidentDate&&k.incidentTime&&k.incidentLocation&&k.incidentDescription&&k.incidentDescription.length>=20);case 1:return!!(O&&!y&&$.manager&&$.employee&&V);case 2:return!0;default:return!1}},[g,k,O,y,$,V]),it=p.useCallback(()=>{switch(g){case 0:return e.jsx(kd,{employees:n,categories:t,formData:k,updateFormData:Ge,selectedEmployee:de,selectedCategory:pe,warningHistory:T,isLoadingWarningHistory:N,loadWarningHistory:Be,lraRecommendation:O,isAnalyzing:y});case 1:return e.jsx(Ed,{lraRecommendation:O,selectedEmployee:de,formData:k,currentManagerName:s,onSignaturesComplete:be,isAnalyzing:y,signaturesFinalized:V,currentSignatures:$});case 2:return e.jsx(Rd,{selectedEmployee:de,formData:k,lraRecommendation:O,signatures:$,organizationName:r,currentManagerName:s,audioRecording:u,onComplete:Le,onWarningCreated:G,warningId:Y});default:return e.jsxs("div",{className:"p-8 text-center text-red-600",children:["Unknown step: ",g]})}},[g,r,s,n,t,k,Ge,de,pe,T,N,Be,O,y,be,$,u,Le]),Kt=g===2?{show:!1,disabled:!1,loading:!1,text:"Complete"}:g===0&&!Fe?{show:!0,disabled:!0,loading:!1,text:"Next"}:g===0&&Fe&&(P||y)?{show:!0,disabled:!0,loading:!0,text:"Analyzing..."}:{show:!0,disabled:!Fe,loading:!1,text:"Next"};return p.useMemo(()=>({formData:k,signatures:$,lraRecommendation:O,selectedEmployee:de,selectedCategory:pe,organizationId:x?.id,currentStep:g,isStepValid:Fe,isAnalyzing:y,warningHistory:T,finalWarningId:Y}),[k,$,O,de,pe,x?.id,g,Fe,y,T,Y]),p.useEffect(()=>()=>{d.debug("🧹 EnhancedWarningWizard UNMOUNTING - cleaning up audio recording"),u.forceCleanup(),document.body.classList.remove("modal-open")},[]),w&&!f?e.jsx(_d,{onPermissionGranted:h,onPermissionDenied:v,organizationName:r,managerName:s}):e.jsx("div",{className:`
    modal-system
    ${m?"modal-system--fullscreen":""}
    ${F.isLegacyDevice?"legacy-device":""}
    ${F.hasGoodPerformance?"perf-high":"perf-low"}
    ${F.hasModernCSS?"css-modern":"css-legacy"}
  `,children:e.jsxs("div",{className:`
      modal-container
      ${m?"modal-container--fullscreen":""}
      ${F.browserInfo.isAndroid4x?"android-4x":""}
      ${F.browserInfo.isIOS6to7?"ios-6-7":""}
    `,children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Issue Warning"}),e.jsx("p",{className:"modal-header__subtitle",children:"Document disciplinary action and intervention"})]})}),e.jsx("button",{onClick:M,className:"modal-header__close-button",title:"Cancel and close wizard",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"modal-header__center",children:[e.jsx("div",{className:"modal-header__progress-mobile md:hidden",children:e.jsxs("div",{className:"mobile-step-indicator",children:[e.jsx("div",{className:"mobile-step-dots",children:Object.entries($e).map(([ie,ke])=>{const he=parseInt(ie),_e=he===g,Oe=D.has(he);return e.jsx("div",{className:`mobile-step-dot ${_e?"mobile-step-dot--active":""} ${Oe?"mobile-step-dot--completed":""} ${!_e&&!Oe?"mobile-step-dot--inactive":""}`,title:ke.title,children:Oe?e.jsx(mt,{className:"w-3 h-3"}):he+1},ie)})}),e.jsxs("div",{className:"mobile-step-info",children:[e.jsxs("div",{className:"mobile-step-title-container",onClick:()=>_(!R),children:[e.jsx("div",{className:"mobile-step-title",children:$e[g]?.title||"Loading..."}),e.jsx("button",{className:"mobile-step-expand-btn",children:R?e.jsx(Gt,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"})})]}),R&&e.jsxs("div",{className:"mobile-step-description",children:[e.jsx(Ur,{className:"w-4 h-4 text-blue-500"}),e.jsx("p",{children:$e[g]?.description})]}),e.jsxs("div",{className:"mobile-step-meta",children:["Step ",g+1," of ",Object.keys($e).length,u.isRecording&&e.jsxs("span",{className:"mobile-audio-indicator",children:[e.jsx("div",{className:"mobile-recording-dot"}),"Recording"]})]})]})]})}),e.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Object.entries($e).map(([ie,ke])=>{const he=parseInt(ie),_e=he===g,Oe=D.has(he);return e.jsxs("div",{className:"step-container",children:[e.jsx("div",{className:`
                step-dot
                ${_e?"step-dot--active":""}
                ${Oe?"step-dot--completed":""}
                ${!_e&&!Oe?"step-dot--inactive":""}
              `,title:ke.title,children:Oe?e.jsx(mt,{className:"w-3 h-3"}):he}),he<Math.max(...Object.keys($e).map(Number))&&e.jsx("div",{className:`
                step-connector
                ${Oe?"step-connector--completed":"step-connector--inactive"}
              `})]},ie)})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:it()})}),e.jsxs("div",{className:"modal-footer",children:[e.jsxs("div",{className:"modal-footer__nav",children:[e.jsxs("button",{onClick:ce,disabled:g===0||P,className:`
              modal-footer__button modal-footer__button--secondary
              ${g===0||P?"opacity-50":""}
            `,children:[e.jsx(bs,{className:"w-4 h-4"}),"Previous"]}),Kt.show&&e.jsx("button",{onClick:K,disabled:Kt.disabled,className:`
                modal-footer__button modal-footer__button--primary
                ${Kt.loading?"modal-footer__button--loading":""}
              `,children:!Kt.loading&&e.jsxs(e.Fragment,{children:[Kt.text,e.jsx(_t,{className:"w-4 h-4"})]})})]}),e.jsx("div",{className:"md:hidden flex items-center space-x-1",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Step ",g+1," of ",Object.keys($e).length]})})]})]})})},Pd=(n,t)=>n.currentManagerName!==t.currentManagerName||n.organizationName!==t.organizationName||n.preSelectedEmployeeId!==t.preSelectedEmployeeId||n.preSelectedCategoryId!==t.preSelectedCategoryId||n.isFullScreen!==t.isFullScreen?(d.debug("🔄 Wizard props changed - primitive props differ"),!1):n.employees.length!==t.employees.length?(d.debug("🔄 Wizard props changed - employee count differs"),!1):n.categories.length!==t.categories.length?(d.debug("🔄 Wizard props changed - category count differs"),!1):(d.debug("✅ Wizard props equal - preventing remount"),!0),Di=Lt.memo(Id,Pd),gm=Object.freeze(Object.defineProperty({__proto__:null,EnhancedWarningWizard:Di},Symbol.toStringTag,{value:"Module"})),Td=({onTextSubmit:n,onClose:t,employeeName:s="the employee"})=>{const[r,a]=p.useState("text"),[i,o]=p.useState(""),[l,m]=p.useState(""),c=p.useCallback(()=>{if(i.trim().length<10){alert("Please provide at least 10 characters of notes.");return}n(i.trim())},[i,n]),x=p.useCallback(()=>{if(l.trim().length<10){alert("Please provide at least 10 characters summarizing the phone discussion.");return}n(`Phone discussion with ${s}: ${l.trim()}`)},[l,n,s]),u=p.useCallback(()=>{const h=`Voice Recording Instructions for ${s}:

1. Use your phone's voice recorder app
2. Record the discussion about this disciplinary matter
3. Save the recording with filename: "${s}_warning_${new Date().toISOString().split("T")[0]}"
4. Email the recording to HR or your manager
5. Complete this form with a summary of the recording

This ensures proper documentation while accommodating device limitations.`;n(h)},[s,n]);return e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg shadow-lg legacy-simple-layout",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"w-5 h-5 text-orange-500"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 legacy-text-size",children:"Audio Recording Not Available"})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-500 hover:text-gray-700 legacy-touch-target",children:e.jsx(ye,{size:20})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{size:16,className:"text-yellow-600 mt-0.5"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-yellow-800 legacy-text-size",children:"Your device doesn't support audio recording. Choose an alternative method to document this discussion."})})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Choose documentation method:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"method",value:"text",checked:r==="text",onChange:h=>a(h.target.value),className:"mr-2"}),e.jsx(ye,{size:16,className:"mr-1"}),e.jsx("span",{className:"legacy-text-size",children:"Write detailed notes"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"method",value:"phone",checked:r==="phone",onChange:h=>a(h.target.value),className:"mr-2"}),e.jsx($s,{size:16,className:"mr-1"}),e.jsx("span",{className:"legacy-text-size",children:"Use phone to record separately"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"method",value:"instructions",checked:r==="instructions",onChange:h=>a(h.target.value),className:"mr-2"}),e.jsx(qr,{size:16,className:"mr-1"}),e.jsx("span",{className:"legacy-text-size",children:"Generate recording instructions"})]})]})]}),r==="text"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 legacy-text-size",children:"Document the discussion in writing:"}),e.jsx("textarea",{value:i,onChange:h=>o(h.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:6,placeholder:`Write detailed notes about your discussion with ${s}. Include:
- What was discussed
- Employee's response
- Any commitments made
- Next steps or follow-up required

Minimum 10 characters required.`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[i.length,"/10 minimum characters"]})]}),r==="phone"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("p",{className:"text-sm text-blue-800 legacy-text-size",children:e.jsx("strong",{children:"Instructions:"})}),e.jsxs("ol",{className:"text-sm text-blue-700 mt-1 pl-4 list-decimal legacy-text-size",children:[e.jsx("li",{children:"Use your phone's built-in voice recorder"}),e.jsxs("li",{children:["Record your discussion with ",s]}),e.jsx("li",{children:"Save with a clear filename"}),e.jsx("li",{children:"Email the recording to HR"}),e.jsx("li",{children:"Summarize the recording below"})]})]}),e.jsx("label",{className:"block text-sm font-medium text-gray-700 legacy-text-size",children:"Summarize your recorded phone discussion:"}),e.jsx("textarea",{value:l,onChange:h=>m(h.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:4,placeholder:"Briefly summarize what was discussed in your phone recording..."}),e.jsxs("div",{className:"text-xs text-gray-500",children:[l.length,"/10 minimum characters"]})]}),r==="instructions"&&e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md",children:e.jsx("p",{className:"text-sm text-green-800 legacy-text-size",children:"This will generate step-by-step recording instructions that you can follow to properly document this disciplinary discussion."})})})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 legacy-touch-target legacy-text-size",children:"Cancel"}),r==="text"&&e.jsx("button",{onClick:c,disabled:i.trim().length<10,className:`px-4 py-2 rounded-md legacy-touch-target legacy-text-size ${i.trim().length>=10?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Save Notes"}),r==="phone"&&e.jsx("button",{onClick:x,disabled:l.trim().length<10,className:`px-4 py-2 rounded-md legacy-touch-target legacy-text-size ${l.trim().length>=10?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Save Summary"}),r==="instructions"&&e.jsx("button",{onClick:u,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 legacy-touch-target legacy-text-size",children:"Generate Instructions"})]})]})})},Bd=({isOpen:n,onClose:t,onSubmit:s,selectedEmployee:r,employees:a,categories:i})=>{const[o,l]=p.useState("form"),[m,c]=p.useState({employeeId:r?.id||"",categoryId:"",description:"",managerNotes:"",deliveryMethod:"hand_delivery"}),[x,u]=p.useState(""),[h,v]=p.useState(!1),g=p.useRef(null),b=m.employeeId&&m.categoryId&&m.description.trim().length>=10,f=p.useCallback((y,A)=>{c(R=>({...R,[y]:A})),x&&u("")},[x]),j=p.useCallback(()=>{if(!b){u("Please fill in all required fields");return}l("confirm")},[b]),w=p.useCallback(y=>{c(A=>({...A,managerNotes:A.managerNotes?`${A.managerNotes}

--- Audio Notes ---
${y}`:`--- Audio Notes ---
${y}`})),v(!1)},[]),C=p.useCallback(async()=>{if(b){l("loading"),u("");try{const y={employeeId:m.employeeId,categoryId:m.categoryId,incidentDescription:m.description,managerNotes:m.managerNotes,deliveryMethod:m.deliveryMethod,audioRecording:null,signatures:{manager:null,employee:null},isLegacyDevice:!0};await s(y),t()}catch(y){u(y instanceof Error?y.message:"Failed to create warning"),l("form")}}},[m,b,s,t]);if(!n)return null;const D=a.find(y=>y.id===m.employeeId),S=i.find(y=>y.id===m.categoryId);return e.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black bg-opacity-50 legacy-touch-target",children:[e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:e.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md shadow-lg legacy-simple-layout",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 legacy-text-size",children:o==="form"?"Issue Warning":o==="confirm"?"Confirm Warning":"Creating Warning..."}),o!=="loading"&&e.jsx("button",{onClick:t,className:"p-2 text-gray-500 hover:text-gray-700 legacy-touch-target",type:"button",children:e.jsx(ve,{size:20})})]}),e.jsxs("div",{className:"p-4",children:[x&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{size:16,className:"text-red-500 mr-2"}),e.jsx("span",{className:"text-sm text-red-700 legacy-text-size",children:x})]})}),o==="form"&&e.jsxs("form",{ref:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:[e.jsx(Pe,{size:16,className:"inline mr-1"}),"Employee *"]}),e.jsxs("select",{value:m.employeeId,onChange:y=>f("employeeId",y.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-touch-target legacy-text-size",required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),a.map(y=>e.jsxs("option",{value:y.id,children:[y.profile?.firstName," ",y.profile?.lastName]},y.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:[e.jsx(me,{size:16,className:"inline mr-1"}),"Warning Category *"]}),e.jsxs("select",{value:m.categoryId,onChange:y=>f("categoryId",y.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-touch-target legacy-text-size",required:!0,children:[e.jsx("option",{value:"",children:"Select Category"}),i.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:[e.jsx(ye,{size:16,className:"inline mr-1"}),"Incident Description * (minimum 10 characters)"]}),e.jsx("textarea",{value:m.description,onChange:y=>f("description",y.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:4,placeholder:"Describe what happened...",required:!0,minLength:10}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[m.description.length,"/10 minimum"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Manager Notes (optional)"}),e.jsx("textarea",{value:m.managerNotes,onChange:y=>f("managerNotes",y.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:2,placeholder:"Additional notes or context..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Audio Documentation (Optional)"}),e.jsxs("button",{type:"button",onClick:()=>v(!0),className:"w-full p-3 border border-gray-300 rounded-md flex items-center justify-center gap-2 hover:bg-gray-50 legacy-touch-target legacy-text-size",children:[e.jsx(Gr,{size:16}),e.jsx("span",{children:"Add Voice Notes"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Record or document verbal discussion with alternative methods"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Delivery Method"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"hand_delivery",checked:m.deliveryMethod==="hand_delivery",onChange:y=>f("deliveryMethod",y.target.value),className:"mr-2"}),e.jsx("span",{className:"legacy-text-size",children:"Hand Delivery (Recommended)"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"deliveryMethod",value:"email",checked:m.deliveryMethod==="email",onChange:y=>f("deliveryMethod",y.target.value),className:"mr-2"}),e.jsx("span",{className:"legacy-text-size",children:"Email"})]})]})]})]}),o==="confirm"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2 legacy-text-size",children:"Review Warning Details"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",D?.profile?.firstName," ",D?.profile?.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Category:"})," ",S?.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",m.description]}),m.managerNotes&&e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",m.managerNotes]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Delivery:"})," ",m.deliveryMethod==="hand_delivery"?"Hand Delivery":"Email"]})]})]}),e.jsx("div",{className:"bg-yellow-50 p-3 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(me,{size:16,className:"text-yellow-600 mr-2"}),e.jsx("span",{className:"text-sm text-yellow-800 legacy-text-size",children:"This warning will be permanently recorded in the employee's file."})]})})]}),o==="loading"&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-gray-600 legacy-text-size",children:"Creating warning document..."})]})]}),o!=="loading"&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex justify-end gap-3",children:[o==="form"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 legacy-touch-target legacy-text-size",type:"button",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:!b,className:`px-4 py-2 rounded-md legacy-touch-target legacy-text-size ${b?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,type:"button",children:"Review"})]}),o==="confirm"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l("form"),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 legacy-touch-target legacy-text-size",type:"button",children:"Back"}),e.jsxs("button",{onClick:C,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 legacy-touch-target legacy-text-size",type:"button",children:[e.jsx(Jt,{size:16,className:"inline mr-1"}),"Issue Warning"]})]})]})]})}),h&&e.jsx(Td,{onTextSubmit:w,onClose:()=>v(!1),employeeName:D?.profile?.firstName})]})},Sa=({employees:n,selectedEmployeeId:t,onEmployeeSelect:s,disabled:r=!1,className:a="",title:i="Employee Selection",subtitle:o="Choose the employee for this action"})=>{const[l,m]=p.useState(""),[c,x]=p.useState(!1),[u,h]=p.useState(!1),v=p.useMemo(()=>{if(!l.trim())return n;const w=l.toLowerCase();return n.filter(C=>{const D=`${C.firstName} ${C.lastName}`.toLowerCase(),S=C.department?.toLowerCase()||"";return D.includes(w)||S.includes(w)})},[n,l]),g=p.useMemo(()=>n.find(w=>w.id===t),[n,t]),b=p.useCallback(w=>{s(w),x(!1),h(!1),m("")},[s]),f=p.useCallback(()=>{if(r)return;window.innerWidth<768?h(!0):x(!c)},[r,c]),j=p.useCallback(()=>{h(!1),m("")},[]);return e.jsxs("div",{className:`form-section ${a}`,children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:i}),e.jsx("p",{className:"unified-section-header__subtitle",children:o})]})]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`cursor-pointer transition-all min-h-[48px] p-3 rounded border ${r?"opacity-50 cursor-not-allowed":"hover:border-primary"}`,style:{backgroundColor:"var(--color-input-background)",borderColor:c?"var(--color-primary)":"var(--color-input-border)",boxShadow:c?"0 0 0 2px var(--color-primary-light)":void 0},onClick:f,children:g?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:e.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[g.firstName?.charAt(0),g.lastName?.charAt(0)]})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[g.firstName," ",g.lastName]}),e.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[g.position," • ",g.department]})]})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform flex-shrink-0 ${c?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform ${c?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]})}),c&&e.jsxs("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[e.jsx("div",{className:"p-3",style:{borderBottom:"1px solid var(--color-border)"},children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:w=>m(w.target.value),className:"w-full pl-10 pr-3 py-2 rounded border text-sm focus:ring-2",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)","--ring-color":"var(--color-primary)"}})]})}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:v.length>0?e.jsx("div",{className:"py-2",children:v.map(w=>e.jsx("button",{onClick:()=>b(w.id),className:"w-full text-left px-3 py-2 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="transparent"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:e.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[w.firstName?.charAt(0),w.lastName?.charAt(0)]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:[w.firstName," ",w.lastName]}),e.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[w.position," • ",w.department]})]})]})},w.id))}):e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx(Pe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l?`No employees found matching "${l}"`:"No employees available"})]})})]})]})}),u&&e.jsxs("div",{className:"mobile-employee-modal",children:[e.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:j}),e.jsxs("div",{className:"mobile-employee-modal-content",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Employee"}),e.jsx("button",{onClick:j,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:e.jsx(ve,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:w=>m(w.target.value),className:"w-full pl-10 pr-3 py-2 rounded border",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)"}})]})}),e.jsx("div",{className:"mobile-category-list",children:v.length>0?e.jsx("div",{children:v.map(w=>e.jsx("button",{onClick:()=>b(w.id),className:"w-full text-left px-4 py-3 transition-colors",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="transparent"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:e.jsxs("span",{className:"font-semibold text-sm",style:{color:"var(--color-primary)"},children:[w.firstName?.charAt(0),w.lastName?.charAt(0)]})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium text-base",style:{color:"var(--color-text)"},children:[w.firstName," ",w.lastName]}),e.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[w.position," • ",w.department]})]})]})},w.id))}):e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx(Pe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l?`No employees found matching "${l}"`:"No employees available"})]})})]})]})]})},Ld=[{id:"training",label:"Training & Development",description:"Skills training, knowledge sharing, and competency development",icon:"📚",color:"blue"},{id:"coaching",label:"Performance Coaching",description:"Performance improvement, goal setting, and mentoring",icon:"🎯",color:"green"},{id:"behavioral",label:"Behavioral Discussion",description:"Conduct, attitude, and workplace behavior guidance",icon:"🤝",color:"purple"}],$d=({isOpen:n,onClose:t})=>{const{user:s}=De(),{organization:r}=We(),[a,i]=p.useState(null),[o,l]=p.useState(null),[m,c]=p.useState("coaching"),[x,u]=p.useState(""),[h,v]=p.useState(""),[g,b]=p.useState(!1),[f,j]=p.useState(null),[w,C]=p.useState(!1),[D,S]=p.useState(!0),[y,A]=p.useState([]),[R,_]=p.useState([]);p.useEffect(()=>{r?.id&&s?.id&&n?(async()=>{try{S(!0),j(null);const I=(await Ce.employees.getByManager(s?.id||"",r.id)).map(z=>({id:z.id,firstName:z.profile?.firstName||z.firstName||"Unknown",lastName:z.profile?.lastName||z.lastName||"Employee",position:z.profile?.position||z.employment?.position||"Unknown Position",department:z.profile?.department||z.employment?.department||"Unknown",email:z.profile?.email||z.contact?.email||z.email||"",phone:z.profile?.phone||z.contact?.phone||z.phone||"",deliveryPreference:z.deliveryPreference||"email",...z}));A(I);let T=await Ce.organizations.getCategories(r.id);(!T||T.length===0)&&(T=[{id:"attendance_punctuality",name:"Attendance & Punctuality",severity:"minor"},{id:"performance_issues",name:"Performance Issues",severity:"moderate"},{id:"safety_violations",name:"Safety Violations",severity:"serious"},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",severity:"serious"},{id:"policy_violations",name:"Policy Violations",severity:"serious"},{id:"dishonesty_theft",name:"Dishonesty & Theft",severity:"gross_misconduct"},{id:"substance_abuse",name:"Substance Abuse",severity:"gross_misconduct"},{id:"harassment_discrimination",name:"Harassment & Discrimination",severity:"gross_misconduct"}]),_(T)}catch{j("Failed to load data. Please try again."),A([]),_([])}finally{S(!1)}})():n||S(!1)},[s?.id,r?.id,n]);const F=()=>a&&o&&x.trim().length>=20&&h.trim().length>=30,k=async()=>{if(!(!s||!a||!o||!s.organizationId))try{b(!0),j(null);const E={organizationId:s.organizationId,managerId:s.id,managerName:`${s.firstName} ${s.lastName}`,employeeId:a.id,employeeName:`${a.firstName} ${a.lastName}`,employeeNumber:a.employeeNumber||"",department:a.department||"",category:o.name,categoryId:o.id,counsellingType:m,issueDescription:x.trim(),interventionDetails:h.trim(),trainingProvided:"",resourcesProvided:[],promisesToPerform:[],improvementTimeline:"",followUpDate:"",managerSignature:"",employeeAcknowledged:!1,employeeComments:"",status:"completed",improvementNoted:!1,followUpCompleted:!1,escalationRequired:!1,dateCreated:new Date().toISOString(),lastUpdated:new Date().toISOString(),createdBy:s.id,documentVersion:1};await ge.createDocument(r.id,"reports",E),C(!0),setTimeout(()=>{t()},3e3)}catch{j("Failed to submit counselling record. Please try again.")}finally{b(!1)}};return n?D?e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Loading Counselling Data"}),e.jsx("p",{className:"modal-header__subtitle",children:"Preparing counselling session data"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[e.jsx("div",{className:"animate-spin mx-auto h-16 w-16 border-4 border-gray-200 border-t-primary rounded-full"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading counselling data..."})]})})})]})}):w?e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Counselling Session Recorded"}),e.jsx("p",{className:"modal-header__subtitle",children:"Successfully documented and available for HR review"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:e.jsx(ae,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Session Successfully Recorded"}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["The corrective counselling session with ",e.jsxs("strong",{children:[a?.firstName," ",a?.lastName]})," has been successfully documented and will be available to HR for review."]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting automatically in a few seconds..."})]})})}),e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"modal-footer__nav",children:e.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Return to Dashboard"})})})]})}):e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container modal-container--xl",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Corrective Counselling Session"}),e.jsx("p",{className:"modal-header__subtitle",children:"Document training, coaching, and discussions"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"space-y-4",children:[f&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[e.jsx(qe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{style:{color:"var(--color-text)"},children:f})})]}),e.jsx(Sa,{employees:y,selectedEmployeeId:a?.id||null,onEmployeeSelect:E=>{const N=y.find(I=>I.id===E);i(N||null)},title:"Employee Selection",subtitle:"Choose the employee involved in this counselling session",disabled:D}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 unified-field-required",children:"Related Category"}),e.jsxs("select",{value:o?.id||"",onChange:E=>{const N=R.find(I=>I.id===E.target.value);l(N||null)},className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",required:!0,children:[e.jsx("option",{value:"",children:"Choose a category..."}),R.map(E=>e.jsxs("option",{value:E.id,children:[E.name," - ",E.severity]},E.id))]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:e.jsx(ws,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Counselling Type"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Select the appropriate type of counselling session"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:Ld.map(E=>e.jsx("div",{className:`category-card cursor-pointer ${m===E.id?"category-card--selected":""}`,onClick:()=>c(E.id),children:e.jsxs("div",{className:"category-card__content",children:[e.jsx("span",{className:"category-card__icon",children:E.icon}),e.jsxs("div",{className:"category-card__details",children:[e.jsx("div",{className:"category-card__title",children:E.label}),e.jsx("p",{className:"category-card__description",children:E.description})]})]})},E.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Issue/Topic Description"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the issue or topic that prompted this counselling session"})]})]}),e.jsx("textarea",{value:x,onChange:E=>u(E.target.value),placeholder:"Describe the issue, topic, or area for improvement that prompted this counselling session...",rows:4,minLength:20,maxLength:500,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),e.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[x.length,"/500 characters (minimum 20)"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Intervention Details"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Document what was discussed and addressed during the session"})]})]}),e.jsx("textarea",{value:h,onChange:E=>v(E.target.value),placeholder:"Describe what was discussed, taught, or addressed during the counselling session...",rows:4,minLength:30,maxLength:1e3,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),e.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[h.length,"/1000 characters (minimum 30)"]})]})]})]})})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"modal-footer__nav",children:[e.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),e.jsx("button",{onClick:k,disabled:!F()||g,className:"modal-footer__button modal-footer__button--primary",children:g?"Submitting...":"Submit Counselling Session"})]})})]})}):null},Wn=({onSignatureChange:n,label:t,required:s=!1,role:r="manager",personName:a})=>{const i=p.useRef(null),[o,l]=p.useState(!1),[m,c]=p.useState(!1),x=p.useCallback(b=>{const f=i.current;if(!f)return;const j=f.getBoundingClientRect(),w=f.getContext("2d");w&&(l(!0),w.beginPath(),w.moveTo(b.clientX-j.left,b.clientY-j.top))},[]),u=p.useCallback(b=>{if(!o)return;const f=i.current;if(!f)return;const j=f.getBoundingClientRect(),w=f.getContext("2d");w&&(w.lineTo(b.clientX-j.left,b.clientY-j.top),w.stroke(),c(!0))},[o]),h=p.useCallback(()=>{if(o&&i.current){l(!1);const b=i.current.toDataURL();n(b)}},[o,n]),v=p.useCallback(()=>{const b=i.current;if(!b)return;const f=b.getContext("2d");f&&(f.clearRect(0,0,b.width,b.height),c(!1),n(""))},[n]),g=p.useCallback(()=>{const b=i.current;if(!b)return;const f=b.getContext("2d");if(!f)return;const j=b.getBoundingClientRect();b.width=j.width,b.height=j.height,f.strokeStyle="var(--color-text)",f.lineWidth=2,f.lineCap="round",f.lineJoin="round"},[]);return p.useEffect(()=>{g();const b=()=>{setTimeout(g,100)};return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[g]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"unified-field-label",children:[t," ",s&&e.jsx("span",{className:"unified-field-required"})]}),e.jsx("p",{className:"unified-section-header__subtitle",children:r==="manager"?"Please sign below to confirm this meeting request":`${a}, please sign below if you agree to this meeting`})]}),e.jsx("div",{className:"flex items-center gap-2",children:m?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Signed"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Pending"})]})})]}),e.jsxs("div",{className:"border-2 border-dashed rounded p-4",style:{borderColor:"var(--color-border)"},children:[e.jsx("canvas",{ref:i,className:"w-full h-32 cursor-crosshair rounded",onMouseDown:x,onMouseMove:u,onMouseUp:h,onMouseLeave:h}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:m?"Signature captured":"Click and drag to sign above"}),e.jsxs("button",{onClick:v,disabled:!m,className:"px-3 py-1 text-sm rounded flex items-center gap-1",style:{color:"var(--color-text-secondary)",backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[e.jsx(Xt,{className:"w-4 h-4"}),"Clear"]})]})]})]})},Od=({isOpen:n,onClose:t})=>{const{user:s}=De(),{organization:r}=We(),[a,i]=p.useState(null),[o,l]=p.useState(""),[m,c]=p.useState(""),[x,u]=p.useState(""),[h,v]=p.useState(null),[g,b]=p.useState(!1),[f,j]=p.useState(!1),[w,C]=p.useState(null),[D,S]=p.useState(!1),[y,A]=p.useState([]);p.useEffect(()=>{n&&(async()=>{if(!(!s?.id||!r?.id))try{const T=(await Ce.employees.getByManager(s.id,r.id)).map(z=>({id:z.id,firstName:z.profile?.firstName||z.firstName||"Unknown",lastName:z.profile?.lastName||z.lastName||"Employee",position:z.profile?.position||z.employment?.position||"Unknown Position",department:z.profile?.department||z.employment?.department||"Unknown",email:z.profile?.email||z.contact?.email||z.email||"",...z}));A(T)}catch(I){console.error("Failed to load employees:",I),C("Failed to load employees")}})()},[s?.id,r?.id,n]);const R=()=>a&&o.trim().length>=20&&m.trim(),_=N=>{c(N)},F=N=>{v(N),N?b(!0):(b(!1),u(""))},k=N=>{u(N)},E=async()=>{if(!(!s||!a||!r?.id||!R()))try{j(!0),C(null);const N={organizationId:r.id,managerId:s.id,managerName:`${s.firstName} ${s.lastName}`,employeeId:a.id,employeeName:`${a.firstName} ${a.lastName}`,context:o.trim(),managerSignature:m,...h&&x&&{employeeSignature:x},employeeConsent:h||!1,status:"pending",requestDate:new Date().toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await ge.createDocument(r.id,"meetings",N),S(!0),setTimeout(()=>{t()},3e3)}catch(N){console.error("Failed to submit meeting request:",N),C("Failed to submit meeting request. Please try again.")}finally{j(!1)}};return p.useEffect(()=>{n||(i(null),l(""),c(""),u(""),v(null),b(!1),C(null),S(!1))},[n]),D?n?e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Meeting Request Submitted"}),e.jsx("p",{className:"modal-header__subtitle",children:"HR will be notified and will schedule the meeting"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:e.jsx(ae,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Meeting Request Submitted"}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["Your meeting request for ",a?.firstName," ",a?.lastName," has been successfully submitted to HR. They will review the request and schedule the meeting accordingly."]}),e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:[e.jsx(tt,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"You will receive notification once the meeting is scheduled"})})]})]})})}),e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"modal-footer__nav",children:e.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:n?e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Book HR Meeting"}),e.jsx("p",{className:"modal-header__subtitle",children:"Schedule intervention meeting with HR"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-header__center",children:e.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:e.jsx("div",{className:"mobile-step-indicator",children:e.jsx("div",{className:"mobile-step-dots",children:e.jsx("div",{className:"mobile-step-dot mobile-step-dot--active",children:"1"})})})})}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"space-y-4",children:[w&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[e.jsx(qe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Sa,{employees:y,selectedEmployeeId:a?.id||null,onEmployeeSelect:N=>{const I=y.find(T=>T.id===N);i(I||null)},title:"Select Employee",subtitle:"Choose the team member for this HR meeting"}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Meeting Context"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the situation that requires HR intervention"})]})]}),e.jsx("textarea",{value:o,onChange:N=>l(N.target.value),placeholder:"Describe the situation that requires HR intervention...",className:"unified-field-input",rows:4,minLength:20,maxLength:1e3}),e.jsxs("div",{className:"unified-field-hint",children:[o.length,"/1000 characters (minimum 20)"]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(qt,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Manager Confirmation"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Please sign to confirm this meeting request"})]})]}),e.jsx(Wn,{onSignatureChange:_,label:"Manager Signature",role:"manager",required:!0})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Employee Acknowledgment"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Optional signature from the employee (can be done later)"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:e.jsx("div",{className:"flex-1",children:e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[e.jsx("strong",{children:"Note:"})," Employee signature is optional. You can proceed without it and have them sign later."]})})}),g?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Wn,{onSignatureChange:k,label:"Employee Signature",role:"employee",personName:`${a?.firstName} ${a?.lastName}`}),e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 rounded",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Back to Options"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"font-medium",style:{color:"var(--color-text)"},children:"Does the employee want to sign now?"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:()=>F(!0),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)"},children:[e.jsx(qt,{className:"w-4 h-4"}),"Yes, employee will sign now"]}),e.jsxs("button",{onClick:()=>F(!1),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:[e.jsx(es,{className:"w-4 h-4"}),"Skip for now"]})]})]})]})]})]})]})})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"modal-footer__nav",children:[e.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:!R()||f,className:`modal-footer__button modal-footer__button--primary ${f?"modal-footer__button--loading":""}`,children:"Submit Meeting Request"})]})})]})}):null},Es=[{id:"full-day",label:"Full Day Absence",icon:"🏠",payrollImpact:!0,description:"Employee absent for entire work day"},{id:"half-day",label:"Half Day Absence",icon:"🕐",payrollImpact:!0,description:"Employee absent for half of work day"},{id:"late-arrival",label:"Late Arrival",icon:"⏰",payrollImpact:!1,description:"Employee arrived late to work"},{id:"early-departure",label:"Early Departure",icon:"🚪",payrollImpact:!1,description:"Employee left work early"},{id:"sick-leave",label:"Sick Leave",icon:"🤒",payrollImpact:!0,description:"Employee absent due to illness"},{id:"personal-leave",label:"Personal Leave",icon:"👤",payrollImpact:!0,description:"Employee absent for personal reasons"}],Md=({isOpen:n,onClose:t})=>{const{user:s}=De(),{organization:r}=We(),[a,i]=p.useState(null),[o,l]=p.useState(new Date().toISOString().split("T")[0]),[m,c]=p.useState(""),[x,u]=p.useState(""),[h,v]=p.useState(!1),[g,b]=p.useState(null),[f,j]=p.useState(!1),[w,C]=p.useState([]),[D,S]=p.useState(!1),[y,A]=p.useState(!1);p.useEffect(()=>{n&&(async()=>{if(!(!s?.id||!r?.id))try{const O=(await Ce.employees.getByManager(s.id,r.id)).map(q=>({id:q.id,firstName:q.profile?.firstName||q.firstName||"Unknown",lastName:q.profile?.lastName||q.lastName||"Employee",position:q.profile?.position||q.employment?.position||"Unknown Position",department:q.profile?.department||q.employment?.department||"Unknown",employeeNumber:q.employeeNumber||q.profile?.employeeNumber||"",...q}));C(O)}catch(z){console.error("Failed to load employees:",z),b("Failed to load employees")}})()},[s?.id,r?.id,n]);const R=p.useMemo(()=>Es.find(T=>T.id===m),[m]),_=p.useCallback(T=>{c(T),S(!1),A(!1)},[]),F=p.useCallback(()=>{window.innerWidth<768?A(!0):S(!D)},[D]),k=p.useCallback(()=>{A(!1)},[]),E=()=>a&&o&&m,N=async()=>{if(!(!s||!a||!r?.id||!E()))try{v(!0),b(null);const T=Es.find(q=>q.id===m),z={organizationId:r.id,managerId:s.id,managerName:`${s.firstName} ${s.lastName}`,employeeId:a.id,employeeName:`${a.firstName} ${a.lastName}`,employeeNumber:a.employeeNumber||"",absenceDate:o,absenceType:m,reason:x.trim()||void 0,reportedDate:new Date().toISOString(),payrollImpact:T?.payrollImpact||!1,hrReviewed:!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},O=Object.fromEntries(Object.entries(z).filter(([q,Y])=>Y!==void 0));await ge.createDocument(r.id,"reports",O),j(!0),setTimeout(()=>{t()},2e3)}catch(T){console.error("Failed to submit absence report:",T),b("Failed to submit absence report. Please try again.")}finally{v(!1)}};p.useEffect(()=>{n||(i(null),l(new Date().toISOString().split("T")[0]),c(""),u(""),b(null),j(!1),S(!1),A(!1))},[n]);const I=Es.find(T=>T.id===m);return f?n?e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Report Submitted"}),e.jsx("p",{className:"modal-header__subtitle",children:"Absence report has been successfully submitted"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:e.jsx(ae,{className:"h-8 w-8 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Report Submitted Successfully"}),e.jsxs("p",{className:"mb-6 text-gray-600",children:["The absence report for ",a?.firstName," ",a?.lastName," has been submitted and will be reviewed by HR."]}),I?.payrollImpact&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[e.jsx(gs,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"This absence may impact payroll calculations"})})]})]})})}),e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"modal-footer__nav",children:e.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:n?e.jsx("div",{className:"modal-system",children:e.jsxs("div",{className:"modal-container",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("div",{className:"modal-header__left",children:e.jsxs("div",{children:[e.jsx("h2",{className:"modal-header__title",children:"Report Employee Absence"}),e.jsx("p",{className:"modal-header__subtitle",children:"Document unscheduled employee absence"})]})}),e.jsx("button",{onClick:t,className:"modal-header__close-button",children:e.jsx(ve,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"modal-content",children:e.jsx("div",{className:"modal-content__scrollable",children:e.jsxs("div",{className:"space-y-4",children:[g&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[e.jsx(qe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),e.jsx("div",{className:"flex-1",children:e.jsx("span",{style:{color:"var(--color-text)"},children:g})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(es,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Absence Details"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Select employee and specify absence information"})]})]}),e.jsx(Sa,{employees:w,selectedEmployeeId:a?.id||null,onEmployeeSelect:T=>{const z=w.find(O=>O.id===T);i(z||null)},title:"Employee Selection",subtitle:"Choose the employee for this absence report"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(Ls,{type:"date",label:"Absence Date",value:o,onChange:T=>l(T),icon:tt,required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"unified-field-label",children:"Reported Date"}),e.jsx("input",{type:"text",value:new Date().toLocaleDateString(),readOnly:!0,className:"unified-field-input opacity-75"})]})]})})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(Re,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Absence Type"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Select the type of absence that occurred"})]})]}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border hover:border-primary",style:{backgroundColor:"var(--color-input-background)",borderColor:D?"var(--color-primary)":"var(--color-input-border)",boxShadow:D?"0 0 0 2px var(--color-primary-light)":void 0},onClick:F,children:R?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg",children:R.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:R.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:R.description}),R.payrollImpact&&e.jsx("span",{className:"category-card__badge category-card__badge--warning",children:e.jsx(gs,{className:"w-3 h-3"})})]})]})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform flex-shrink-0 ${D?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select absence type..."})]}),e.jsx(Ke,{className:`w-4 h-4 transition-transform ${D?"rotate-180":""}`,style:{color:"var(--color-text-tertiary)"}})]})}),D&&e.jsx("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:e.jsx("div",{className:"py-2",children:Es.map(T=>e.jsx("button",{onClick:()=>_(T.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:z=>{z.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:z=>{z.currentTarget.style.backgroundColor="transparent"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-lg flex-shrink-0",children:T.icon}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:T.label}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:T.description}),T.payrollImpact&&e.jsx("span",{className:"text-xs",style:{color:"var(--color-warning)"},children:"$ Payroll"})]})]})]})},T.id))})})})]})}),y&&e.jsxs("div",{className:"mobile-employee-modal",children:[e.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:k}),e.jsxs("div",{className:"mobile-employee-modal-content",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Absence Type"}),e.jsx("button",{onClick:k,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:e.jsx(ve,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),e.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:e.jsx("div",{children:Es.map(T=>e.jsxs("button",{onClick:()=>_(T.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:z=>{z.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:z=>{z.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("span",{className:"text-xl flex-shrink-0 mt-0.5",children:T.icon}),e.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:T.label}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("div",{className:"text-sm text-left",style:{color:"var(--color-text-secondary)"},children:T.description}),T.payrollImpact&&e.jsx("span",{className:"text-xs px-2 py-1 rounded flex-shrink-0",style:{backgroundColor:"var(--color-warning-bg)",color:"var(--color-warning)"},children:"$ Payroll"})]})]})]},T.id))})})]})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsxs("div",{className:"unified-section-header",children:[e.jsx("div",{className:"unified-section-header__icon",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsxs("div",{className:"unified-section-header__content",children:[e.jsx("h3",{className:"unified-section-header__title",children:"Additional Notes"}),e.jsx("p",{className:"unified-section-header__subtitle",children:"Optional context or details about the absence"})]})]}),e.jsx("textarea",{value:x,onChange:T=>u(T.target.value),placeholder:"Optional additional context or details about the absence...",className:"unified-field-input",rows:3,maxLength:500}),e.jsxs("div",{className:"unified-field-hint",children:[x.length,"/500 characters"]})]}),I?.payrollImpact&&e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[e.jsx(gs,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:"Payroll Impact Notice"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"This absence type may affect the employee's pay. HR will review and make appropriate adjustments."})]})]})]})})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"modal-footer__nav",children:[e.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:!E()||h,className:`modal-footer__button modal-footer__button--primary ${h?"modal-footer__button--loading":""}`,children:"Submit Report"})]})})]})}):null},Yt={CORRECTIVE_COUNSELLING:"corrective_counselling",COUNSELLING_FOLLOWUPS:"counselling_followups",NOTIFICATIONS:"notifications"};class Ud{static async getActiveCounsellingForEmployee(t,s){try{d.debug("🔍 Checking active counselling for employee:",t);const r=X(se(B,Yt.CORRECTIVE_COUNSELLING),J("organizationId","==",s),J("employeeId","==",t),J("status","in",["completed","follow_up_pending"]),le("dateCreated","desc")),a=await oe(r),i=[];return a.forEach(o=>{const l=o.data(),m={id:o.id,...l};if(m.followUpDate){const c=new Date(m.followUpDate),x=new Date,u=Math.ceil((c.getTime()-x.getTime())/(1e3*60*60*24));u>=-30&&u<=30&&!m.followUpCompleted&&i.push(m)}}),d.success(2097),i}catch(r){return d.error("❌ Error getting active counselling:",r),[]}}static async getDueFollowUps(t,s){try{d.debug("📅 Getting due follow-ups for manager:",t);const r=X(se(B,Yt.CORRECTIVE_COUNSELLING),J("organizationId","==",s),J("managerId","==",t),J("followUpCompleted","==",!1),le("followUpDate","asc")),a=await oe(r),i=[],o=new Date;return a.forEach(l=>{const m=l.data(),c={id:l.id,...m};if(c.followUpDate){const x=new Date(c.followUpDate);Math.ceil((x.getTime()-o.getTime())/(1e3*60*60*24))<=7&&i.push(c)}}),d.success(3568),i}catch(r){return d.error("❌ Error getting due follow-ups:",r),[]}}static async createFollowUp(t,s){try{d.success(3983);const r={...s,counsellingId:t,createdDate:new Date().toISOString()},a=await Ue.createDocument(Yt.COUNSELLING_FOLLOWUPS,r);return await Ue.updateDocument(Yt.CORRECTIVE_COUNSELLING,t,{followUpCompleted:!0,improvementNoted:s.improvementObserved,lastUpdated:new Date().toISOString()}),d.success(4709),a}catch(r){throw d.error("❌ Error creating follow-up:",r),r}}static async getEmployeeCounsellingSummary(t,s){try{d.debug(5096);const r=X(se(B,Yt.CORRECTIVE_COUNSELLING),J("organizationId","==",s),J("employeeId","==",t),le("dateCreated","desc")),a=await oe(r);if(a.empty)return null;const i=[];a.forEach(h=>{const v=h.data();i.push({id:h.id,...v})});const o=i[0],l=i.filter(h=>!h.followUpCompleted&&h.followUpDate).length,m=[...new Set(i.map(h=>h.category))];let c="no_data";if(i.length>=2){const v=i.slice(0,3).filter(g=>g.improvementNoted).length;v>=2?c="improving":v===1?c="stable":c="declining"}let x="low";i.length>=5?x="high":i.length>=3&&(x="medium");const u={employeeId:t,employeeName:o.employeeName,totalSessions:i.length,lastSessionDate:o.dateCreated,pendingFollowUps:l,improvementTrend:c,commonCategories:m,escalationRisk:x};return d.success(7051),u}catch(r){return d.error("❌ Error getting counselling summary:",r),null}}static async createFollowUpNotification(t,s,r){try{const a={userId:t,organizationId:s,type:"counselling_followup_due",title:"Counselling Follow-up Due",message:`Follow-up required for ${r.employeeName} regarding ${r.category}`,data:{counsellingId:r.id,employeeId:r.employeeId,employeeName:r.employeeName,followUpDate:r.followUpDate},read:!1,createdAt:new Date().toISOString()};await Ue.createDocument(Yt.NOTIFICATIONS,a),d.debug("🔔 Follow-up notification created for manager:",t)}catch(a){d.error("❌ Error creating follow-up notification:",a)}}static async getFollowUpRecords(t){try{const s=X(se(B,Yt.COUNSELLING_FOLLOWUPS),J("counsellingId","==",t),le("createdDate","desc")),r=await oe(s),a=[];return r.forEach(i=>{const o=i.data();a.push({id:i.id,...o})}),a}catch(s){return d.error("❌ Error getting follow-up records:",s),[]}}}const Hn=({onSignatureChange:n,label:t,required:s=!1})=>{const r=p.useRef(null),[a,i]=p.useState(!1),[o,l]=p.useState(!1),m=h=>{const v=r.current;if(!v)return;const g=v.getBoundingClientRect(),b=v.getContext("2d");b&&(i(!0),b.beginPath(),b.moveTo(h.clientX-g.left,h.clientY-g.top))},c=h=>{if(!a)return;const v=r.current;if(!v)return;const g=v.getBoundingClientRect(),b=v.getContext("2d");b&&(b.lineTo(h.clientX-g.left,h.clientY-g.top),b.stroke(),l(!0))},x=()=>{if(a&&r.current){i(!1);const h=r.current.toDataURL();n(h)}},u=()=>{const h=r.current;if(!h)return;const v=h.getContext("2d");v&&(v.clearRect(0,0,h.width,h.height),l(!1),n(""))};return Lt.useEffect(()=>{const h=r.current;if(!h)return;const v=h.getContext("2d");v&&(h.width=h.offsetWidth,h.height=h.offsetHeight,v.strokeStyle="#000",v.lineWidth=2,v.lineCap="round")},[]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-white",children:[e.jsx("canvas",{ref:r,className:"w-full h-24 border border-dashed border-gray-400 rounded cursor-crosshair bg-gray-50",onMouseDown:m,onMouseMove:c,onMouseUp:x,onMouseLeave:x}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:o?"Signature captured":"Click and drag to sign above"}),e.jsxs("button",{type:"button",onClick:u,className:"text-sm text-red-600 hover:text-red-800 flex items-center gap-1",disabled:!o,children:[e.jsx(Xt,{className:"w-4 h-4"}),"Clear"]})]})]})]})},Wd=({counsellingSession:n,onClose:t,onComplete:s})=>{js();const{user:r}=De(),{organization:a}=We(),[i,o]=p.useState(null),[l,m]=p.useState(""),[c,x]=p.useState(""),[u,h]=p.useState("continue_monitoring"),[v,g]=p.useState(""),[b,f]=p.useState(""),[j,w]=p.useState(""),[C,D]=p.useState(""),[S,y]=p.useState(""),[A,R]=p.useState(null),[_,F]=p.useState(!1),[k,E]=p.useState(!1),[N,I]=p.useState(null),[T,z]=p.useState("review"),O=()=>i!==null&&b.trim().length>=10&&(i===!1?l.trim().length>=10:!0)&&(u!=="no_further_action"?v:!0),q=L=>{D(L),L&&z("employee-decision")},Y=L=>{R(L),L?F(!0):P()},G=L=>{y(L),L&&P()},P=async()=>{if(!(!r||!r.organizationId))try{E(!0),I(null);const L={followUpDate:new Date().toISOString(),improvementObserved:i||!1,improvementDetails:l.trim(),additionalConcerns:c.trim(),nextAction:u,nextActionDate:v||void 0,managerNotes:b.trim(),employeeFeedback:j.trim(),createdBy:r.id};await Ud.createFollowUp(n.id,L),z("complete"),setTimeout(()=>{s()},3e3)}catch(L){d.error("❌ Error submitting follow-up:",L),I("Failed to submit follow-up. Please try again.")}finally{E(!1)}};return T==="review"?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(tt,{className:"w-8 h-8 text-green-600"}),"Counselling Follow-up Review"]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Review progress and document outcomes"})]}),N&&e.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-lg flex items-center gap-2",children:[e.jsx(qe,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-red-700",children:N})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[e.jsx(ws,{className:"w-5 h-5"}),"Original Counselling Session"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Employee:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:n.employeeName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Date:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:new Date(n.dateCreated).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Category:"}),e.jsx("span",{className:"ml-2 text-blue-600",children:n.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Type:"}),e.jsx("span",{className:"ml-2 text-blue-600 capitalize",children:n.counsellingType})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Issue:"}),e.jsx("p",{className:"text-blue-600 text-sm mt-1",children:n.issueDescription})]}),n.promisesToPerform.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Promises to Perform:"}),e.jsx("ul",{className:"text-blue-600 text-sm mt-1 space-y-1",children:n.promisesToPerform.map((L,U)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500",children:"•"}),e.jsxs("span",{children:[L.description," (Due: ",new Date(L.targetDate).toLocaleDateString(),")"]})]},U))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Has the employee shown improvement? *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>o(!0),className:`px-6 py-3 rounded-lg border-2 transition-all ${i===!0?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(ae,{className:"w-5 h-5 mx-auto mb-1"}),"Yes, Improvement Noted"]}),e.jsxs("button",{type:"button",onClick:()=>o(!1),className:`px-6 py-3 rounded-lg border-2 transition-all ${i===!1?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(qe,{className:"w-5 h-5 mx-auto mb-1"}),"No, Concerns Remain"]})]})]}),i!==null&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:i?"Improvement Details *":"Ongoing Concerns *"}),e.jsx("textarea",{value:l,onChange:L=>m(L.target.value),placeholder:i?"Describe the specific improvements observed...":"Describe the ongoing concerns or lack of improvement...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l.length,"/500 characters (minimum 10)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Concerns or Notes"}),e.jsx("textarea",{value:c,onChange:L=>x(L.target.value),placeholder:"Any additional concerns, observations, or context...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Recommended Next Action *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>h("continue_monitoring"),className:`p-3 rounded-lg border-2 text-left transition-all ${u==="continue_monitoring"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(Re,{className:"w-5 h-5 mb-2"}),e.jsx("div",{className:"font-medium",children:"Continue Monitoring"}),e.jsx("div",{className:"text-sm opacity-70",children:"Keep observing progress"})]}),e.jsxs("button",{type:"button",onClick:()=>h("additional_training"),className:`p-3 rounded-lg border-2 text-left transition-all ${u==="additional_training"?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(ws,{className:"w-5 h-5 mb-2"}),e.jsx("div",{className:"font-medium",children:"Additional Training"}),e.jsx("div",{className:"text-sm opacity-70",children:"Provide more support"})]}),e.jsxs("button",{type:"button",onClick:()=>h("formal_warning"),className:`p-3 rounded-lg border-2 text-left transition-all ${u==="formal_warning"?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(qe,{className:"w-5 h-5 mb-2"}),e.jsx("div",{className:"font-medium",children:"Escalate to Formal Warning"}),e.jsx("div",{className:"text-sm opacity-70",children:"Begin formal discipline"})]}),e.jsxs("button",{type:"button",onClick:()=>h("no_further_action"),className:`p-3 rounded-lg border-2 text-left transition-all ${u==="no_further_action"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(ae,{className:"w-5 h-5 mb-2"}),e.jsx("div",{className:"font-medium",children:"Close Successfully"}),e.jsx("div",{className:"text-sm opacity-70",children:"Issue resolved"})]})]})]}),u!=="no_further_action"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Next Review Date *"}),e.jsx("input",{type:"date",value:v,onChange:L=>g(L.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Notes *"}),e.jsx("textarea",{value:b,onChange:L=>f(L.target.value),placeholder:"Document your overall assessment and any specific observations...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b.length,"/500 characters (minimum 10)"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee Feedback"}),e.jsx("textarea",{value:j,onChange:L=>w(L.target.value),placeholder:"Optional feedback from the employee during this review...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),e.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[e.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[e.jsx(Wr,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{type:"button",onClick:()=>z("manager-sign"),disabled:!O(),className:"px-8 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continue to Signatures",e.jsx(ae,{className:"w-4 h-4"})]})]})]})]})}):T==="manager-sign"?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[e.jsx(qt,{className:"w-8 h-8 text-green-600"}),"Manager Signature Required"]}),e.jsx("div",{className:"mb-6",children:e.jsxs("p",{className:"text-gray-700 mb-4",children:["Please sign to confirm this follow-up review with"," ",e.jsx("strong",{children:n.employeeName}),"."]})}),e.jsx(Hn,{onSignatureChange:q,label:"Manager Signature",required:!0}),e.jsx("div",{className:"flex justify-between mt-6",children:e.jsx("button",{type:"button",onClick:()=>z("review"),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Review"})})]})})}):T==="employee-decision"?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(Pe,{className:"w-8 h-8 text-green-600"}),"Employee Acknowledgment"]}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:e.jsx(ve,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{className:"text-gray-700 mb-4",children:["Please ask ",e.jsx("strong",{children:n.employeeName})," if they acknowledge this follow-up review and would like to provide their signature."]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("p",{className:"text-green-800 text-sm",children:[e.jsx("strong",{children:"Note:"})," Employee signature confirms they participated in this follow-up review."]})})]}),_?e.jsxs("div",{children:[e.jsx(Hn,{onSignatureChange:G,label:"Employee Signature"}),e.jsxs("div",{className:"flex justify-between mt-6",children:[e.jsx("button",{type:"button",onClick:()=>F(!1),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Decision"}),e.jsx("button",{type:"button",onClick:()=>P(),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Skip Signature & Submit"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-700 font-medium",children:"Does the employee consent to sign?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>Y(!0),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2",children:[e.jsx(qt,{className:"w-4 h-4"}),"Yes, employee will sign"]}),e.jsxs("button",{onClick:()=>Y(!1),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),"No, proceed without signature"]})]})]})]})})}):T==="complete"?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6",children:e.jsx(ae,{className:"h-8 w-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Follow-up Review Completed"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["The follow-up review for ",n.employeeName," has been successfully documented and is available to HR for review."]}),e.jsx("button",{onClick:s,className:"w-full px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Return to Dashboard"}),e.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Redirecting automatically..."})]})})}):null},Hd=n=>{const[t,s]=p.useState(window.innerWidth>n),r=p.useCallback(()=>s(window.innerWidth>n),[n]);return p.useEffect(()=>(window.addEventListener("resize",r),r(),()=>window.removeEventListener("resize",r)),[r]),t},ki=p.memo(({className:n=""})=>{const t=js(),{user:s}=De(),{organization:r,loading:a}=We(),{canCreateWarnings:i,canManageEmployees:o}=Vt(),{categories:l,employees:m,followUps:c,loading:x,isReady:u,refreshData:h}=Yr({role:"hod"});p.useEffect(()=>{if(s?.id&&r?.id&&u&&m.length===0&&!x.employees&&!x.overall){Logger.debug("[HODDashboard] 🔄 Manager has no employees - checking if cache refresh needed...");const te=setTimeout(()=>{Logger.debug("[HODDashboard] 🔄 Refreshing employee data for manager..."),h()},2e3);return()=>clearTimeout(te)}},[s?.id,r?.id,u,m.length,x.employees,x.overall,h]);const v={total:c?.length||0,overdue:c?.filter(te=>new Date(te.dueDate)<new Date).length||0,dueSoon:c?.filter(te=>{const Be=new Date(te.dueDate),rt=new Date,ct=new Date(rt.getTime()+4320*60*1e3);return Be>=rt&&Be<=ct}).length||0};Hd(768);const[g,b]=p.useState(!1),[f,j]=p.useState(!1),[w,C]=p.useState(!1),[D,S]=p.useState(!1),[y,A]=p.useState(!1),[R,_]=p.useState(!1),[F,k]=p.useState(null),[E,N]=p.useState([]),[I,T]=p.useState(!1),z=m||[],O=l||[],q=p.useMemo(()=>`${s?.firstName||""} ${s?.lastName||""}`.trim()||"Manager",[s?.firstName,s?.lastName]),Y=p.useMemo(()=>r?.name||"Your Organization",[r?.name]);p.useMemo(()=>z.length===0||O.length===0?null:{employees:z,categories:O,currentManagerName:q,organizationName:Y,key:`wizard-${r?.id}-${z.length}-${O.length}`},[z.length,O.length,q,Y,r?.id]),p.useEffect(()=>{!a&&l&&l.length>0&&console.log("✅ [HOD] Context ready:",{organization:r?.name,categories:l.length,employees:z.length})},[a,l,r,z]);const G=p.useCallback(async()=>{i()&&(console.log("🎯 Opening warning wizard with integrated audio consent..."),u&&z.length>0&&O.length>0?b(!0):console.error("❌ Cannot open wizard: data not ready",{isReady:u,employees:z.length,categories:O.length,loading:x.overall}))},[i,u,z.length,O.length,x]),P=p.useCallback(()=>{console.log("✅ Warning wizard completed"),b(!1)},[]),L=p.useCallback(()=>{console.log("❌ Warning wizard cancelled"),b(!1)},[]),U=p.useCallback(()=>{console.log("📋 Opening corrective counselling modal"),j(!0)},[]),W=p.useCallback(()=>{console.log("❌ Corrective counselling modal closed"),j(!1)},[]),$=p.useCallback(()=>{console.log("📅 Opening book HR meeting modal"),C(!0)},[]),H=p.useCallback(()=>{console.log("❌ Book HR meeting modal closed"),C(!1)},[]),V=p.useCallback(()=>{console.log("🚫 Opening report absence modal"),S(!0)},[]),ee=p.useCallback(()=>{console.log("❌ Report absence modal closed"),S(!1)},[]),Z=p.useCallback(te=>{console.log("📅 Opening follow-up for session:",te.id),k(te),_(!0)},[]),Ee=p.useCallback(()=>{console.log("❌ Follow-up modal closed"),_(!1),k(null)},[]),Ae=p.useCallback(()=>{console.log("✅ Follow-up completed"),_(!1),k(null)},[]),de=p.useCallback(async()=>{if(!(!r?.id||I)){T(!0);try{let te;Mr()&&cc()?te=(await ms.getActiveWarningsIndex(r.id,100)).filter(Le=>Le.priority==="high").map(Le=>({...Le.metadata,id:Le.id,employeeId:Le.employeeId,level:Le.metadata.level,employeeName:Le.metadata.employeeName})):Mr()&&lc()?te=(await ms.getOrganizationWarnings(r.id,{level:"final_written"},{pageSize:100,orderField:"issueDate",orderDirection:"desc"})).warnings:te=await Ce.warnings.getAll(r.id);const Be=await Ce.employees.getAll(r.id),ct=te.filter(Ge=>Ge.level==="final_written").reduce((Ge,Le)=>{const M=Ge.find(K=>K.employeeId===Le.employeeId);if(M)M.warnings.push(Le);else{const K=Be.find(ce=>ce.id===Le.employeeId);K&&Ge.push({...K,employeeId:Le.employeeId,warnings:[Le],latestFinalWarning:Le,name:K.name||`${K.profile?.firstName||""} ${K.profile?.lastName||""}`.trim()})}return Ge},[]);ct.sort((Ge,Le)=>new Date(Le.latestFinalWarning.issueDate).getTime()-new Date(Ge.latestFinalWarning.issueDate).getTime()),N(ct)}catch(te){console.error("Failed to fetch final warning employees:",te)}finally{T(!1)}}},[r?.id]);p.useEffect(()=>{u&&z.length>0&&de()},[u,z.length,r?.id]);const pe=[{id:"create-warning",title:"Issue Warning",icon:me,color:"orange",action:G,enabled:i(),hasAudioRecording:!0},{id:"book-hr-meeting",title:"HR Meeting",icon:Ks,color:"purple",action:$,enabled:!0,hasAudioRecording:!1},{id:"report-absence",title:"Report Absence",icon:es,color:"red",action:V,enabled:!0,hasAudioRecording:!1},{id:"corrective-counselling",title:"Counselling",icon:ws,color:"blue",action:U,enabled:!0,hasAudioRecording:!1}].filter(te=>te.enabled);return[{id:"team-performance",title:"Team Performance",description:"Review department performance metrics",icon:ft,color:"green",action:()=>t("/team/performance"),enabled:o()},{id:"schedule-review",title:"Schedule Reviews",description:"Plan performance reviews for team members",icon:tt,color:"blue",action:()=>t("/reviews/schedule"),enabled:o()},{id:"team-goals",title:"Team Goals",description:"Set and track overall department objectives",icon:wt,color:"indigo",action:()=>t("/goals"),enabled:o()}].filter(te=>te.enabled),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`space-y-4 ${n}`,children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 mb-3",children:pe.map(te=>e.jsx(ne,{hover:!0,padding:"sm",className:"cursor-pointer transition-all duration-200",onClick:te.action,style:{opacity:(x.overall||x.employees)&&te.id==="create-warning"?.5:1,background:te.color==="orange"?"linear-gradient(135deg, var(--color-warning), var(--color-warning))":te.color==="purple"?"linear-gradient(135deg, var(--color-accent), var(--color-accent))":te.color==="red"?"linear-gradient(135deg, var(--color-error), var(--color-error))":(te.color==="blue","linear-gradient(135deg, var(--color-primary), var(--color-primary))"),color:"var(--color-text-inverse)",minHeight:"80px"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(te.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:te.title}),te.hasAudioRecording&&e.jsx(Gr,{className:"w-3 h-3 opacity-60"}),(x.overall||x.employees)&&te.id==="create-warning"&&e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"})]})},te.id))}),v.total>0&&e.jsxs(ne,{padding:"sm",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[e.jsx(tt,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),"Follow-ups Due (",v.due,")"]}),e.jsx("div",{className:"space-y-1",children:c.slice(0,3).map(te=>e.jsxs(ue,{variant:"ghost",onClick:()=>Z(te),className:"w-full text-left p-2 text-sm",children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:te.employeeName}),e.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:te.sessionType})]},te.id))})]}),E.length>0&&e.jsxs(Xe,{variant:"error",className:"border-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-4 h-4"}),"Final Warnings Watch List (",E.length,")",e.jsx(ot,{variant:"error",size:"sm",className:"animate-pulse hidden sm:inline-block",children:"MONITOR CLOSELY"})]}),e.jsxs("div",{className:"space-y-1.5",children:[E.slice(0,4).map(te=>{let Be;te.latestFinalWarning.issueDate?.toDate?Be=te.latestFinalWarning.issueDate.toDate():te.latestFinalWarning.issueDate?.seconds?Be=new Date(te.latestFinalWarning.issueDate.seconds*1e3):Be=new Date(te.latestFinalWarning.issueDate);const rt=Math.floor((Date.now()-Be.getTime())/(1e3*60*60*24));return e.jsx(ne,{padding:"md",className:"border-2",style:{borderColor:"var(--color-alert-error-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-alert-error-text)"},children:te.name}),e.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)",opacity:.8},children:[te.latestFinalWarning.category," • ",rt," days ago"]}),e.jsx("div",{className:"text-xs mt-1",style:{color:"var(--color-alert-error-text)"},children:"⚠️ Next offense requires HR intervention"})]}),e.jsx("div",{className:"text-right",children:e.jsxs(ot,{variant:"error",size:"sm",children:[te.warnings.length," warning",te.warnings.length>1?"s":""]})})]})},te.employeeId)}),E.length>4&&e.jsxs("div",{className:"text-xs text-center py-2",style:{color:"var(--color-alert-error-text)",opacity:.8},children:["+",E.length-4," more employees with final warnings"]})]}),e.jsx(ne,{padding:"sm",className:"mt-3",style:{backgroundColor:"var(--color-alert-error-bg)",opacity:.7},children:e.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)"},children:["💡 ",e.jsx("strong",{children:"Tip:"})," Monitor these employees closely. Any new offenses will trigger urgent HR intervention alerts."]})})]}),I&&e.jsx(ne,{padding:"md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:"var(--color-primary)"}}),e.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Loading final warnings watch list..."})]})}),e.jsx(ne,{padding:"sm",children:e.jsxs(ue,{variant:"ghost",onClick:()=>A(!0),className:"w-full flex items-center justify-between p-2",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)",minHeight:"48px"},children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Team Members"})]}),e.jsx("span",{className:"text-lg font-bold",children:x.employees?e.jsx("div",{className:"animate-pulse h-5 w-6 rounded",style:{backgroundColor:"var(--color-success-light)"}}):z.length})]})})]}),g&&(Et?.isLegacyDevice?e.jsx(Bd,{isOpen:g,onClose:L,onSubmit:async te=>{try{await Ce.warnings.create(te),P()}catch(Be){throw console.error("Failed to create warning:",Be),Be}},employees:z,categories:O},"simplified-warning-wizard"):e.jsx(Di,{employees:z,categories:O,currentManagerName:q,organizationName:Y,onComplete:P,onCancel:L},"enhanced-warning-wizard")),f&&e.jsx($d,{isOpen:f,onClose:W}),w&&e.jsx(Od,{isOpen:w,onClose:H}),D&&e.jsx(Md,{isOpen:D,onClose:ee}),R&&F&&e.jsx(Wd,{counsellingSession:F,onClose:Ee,onComplete:Ae}),y&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:e.jsxs(ne,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6",style:{borderBottom:"1px solid var(--color-border)"},children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Team Management"}),e.jsx(ue,{variant:"ghost",size:"sm",onClick:()=>A(!1),children:"×"})]}),e.jsx("div",{className:"overflow-y-auto",children:e.jsx(Jr,{})})]})})]})});ki.displayName="HODDashboardSection";const Si=p.memo(({isOpen:n,onClose:t,onSuccess:s,userRole:r,employees:a})=>{const[i,o]=p.useState(a.length>0?"promote":"create"),[l,m]=p.useState(null),[c,x]=p.useState({firstName:"",lastName:"",email:"",department:"",password:"temp123"}),[u,h]=p.useState(!1),[v,g]=p.useState(""),{user:b}=De(),{organization:f}=We(),j=async C=>{if(C.preventDefault(),!(!f||!b)){h(!0),g("");try{if(i==="promote"){if(!l){g("Please select an employee to promote"),h(!1);return}if(d.debug(`🔧 Promoting employee ${l.id} to ${r}`),!c.email.trim()){g("Email address is required for creating user account"),h(!1);return}const D={firstName:l.profile?.firstName||l.firstName,lastName:l.profile?.lastName||l.lastName,email:c.email.trim(),password:"temp123",role:r,organizationId:f.id,departmentIds:r==="hod-manager"?[c.department]:[],employeeId:l.id,updateEmployeeEmail:!0},y=await cs(fa,"createOrganizationUser")(D);if(!y.data.success)throw new Error(y.data.message||"Failed to promote employee");d.success(`✅ Promoted employee to ${r} with verified email: ${c.email}`)}else{d.debug(`🔧 Creating new ${r} user and employee via Cloud Function`);const D={firstName:c.firstName,lastName:c.lastName,email:c.email,password:c.password,role:r,organizationId:f.id,departmentIds:r==="hod-manager"?[c.department]:[],createEmployee:!0},y=await cs(fa,"createOrganizationUser")(D);if(!y.data.success)throw new Error(y.data.message||"Failed to create user");d.success(`✅ Created ${r} user and employee: ${y.data.userId}`)}h(!1),s(),t(),w()}catch(D){d.error("❌ Error processing user:",D),g(D.message||"Failed to process user"),h(!1)}}},w=()=>{o(a.length>0?"promote":"create"),m(null),x({firstName:"",lastName:"",email:"",department:"",password:"temp123"})};return n?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl animate-in fade-in duration-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(_s,{className:"w-6 h-6 text-blue-600"}),"Add ",r==="hr-manager"?"HR Manager":"Department Manager"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i==="promote"?`Promote an existing employee to ${r==="hr-manager"?"HR manager":"department manager"}`:`Create a new ${r==="hr-manager"?"HR manager":"department manager"} account`})]}),e.jsxs("form",{onSubmit:j,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Choose Option"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"selectionMode",value:"promote",checked:i==="promote",onChange:C=>o(C.target.value),className:"mr-3 text-blue-600",disabled:a.length===0}),e.jsxs("span",{className:a.length===0?"text-gray-400":"text-gray-700",children:["Promote Existing Employee ",a.length===0&&"(No employees available)"]})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"selectionMode",value:"create",checked:i==="create",onChange:C=>o(C.target.value),className:"mr-3 text-blue-600"}),e.jsx("span",{className:"text-gray-700",children:"Create New Manager"})]})]})]}),i==="promote"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee to Promote"}),e.jsxs("select",{value:l?.id||"",onChange:C=>{const D=a.find(S=>S.id===C.target.value);if(m(D||null),D){const S=D.profile?.email||D.email;S||`${D.profile?.firstName||D.firstName}${D.profile?.lastName||D.lastName}${f?.name.toLowerCase().replace(/\s+/g,"")}`,x(y=>({...y,email:S||""}))}else x(S=>({...S,email:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select an employee..."}),a.map(C=>e.jsxs("option",{value:C.id,children:[C.profile?.firstName||C.firstName," ",C.profile?.lastName||C.lastName,C.profile?.email&&` (${C.profile.email})`]},C.id))]}),l&&e.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg space-y-3",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:"Selected:"})," ",l.profile?.firstName||l.firstName," ",l.profile?.lastName||l.lastName,e.jsx("br",{}),e.jsx("strong",{children:"Department:"})," ",l.profile?.department||l.employment?.department||"Not assigned"]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Email Address",l.profile?.email?e.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"Verify/Update"}):e.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"Required"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"email",value:c.email,onChange:C=>x(D=>({...D,email:C.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${l.profile?.email?"border-yellow-300 bg-yellow-50":"border-gray-300"}`,placeholder:l.profile?.email||`${l.profile?.firstName||l.firstName}.${l.profile?.lastName||l.lastName}@${f?.name.toLowerCase().replace(/\s+/g,"")}.com`,required:!0}),l.profile?.email&&c.email===(l.profile?.email||l.email)&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("span",{className:"text-green-600 text-sm",children:"✓ Verified"})})]}),e.jsx("div",{className:"text-xs text-gray-600 mt-1 flex items-start gap-2",children:l.profile?.email?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full flex-shrink-0 mt-1"}),e.jsxs("span",{children:["Current: ",e.jsx("strong",{children:l.profile.email}),". You can verify or update it above."]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0 mt-1"}),e.jsx("span",{children:"No email on file. Please enter their email address for login access."})]})})]})]})]}),i==="create"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),e.jsx("input",{type:"text",value:c.firstName,onChange:C=>x(D=>({...D,firstName:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:c.lastName,onChange:C=>x(D=>({...D,lastName:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:c.email,onChange:C=>x(D=>({...D,email:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),r==="hod-manager"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),e.jsxs("select",{value:c.department,onChange:C=>x(D=>({...D,department:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),e.jsx("option",{value:"operations",children:"Operations"}),e.jsx("option",{value:"production",children:"Production"}),e.jsx("option",{value:"quality",children:"Quality Assurance"}),e.jsx("option",{value:"maintenance",children:"Maintenance"}),e.jsx("option",{value:"logistics",children:"Logistics"}),e.jsx("option",{value:"administration",children:"Administration"}),e.jsx("option",{value:"finance",children:"Finance"}),e.jsx("option",{value:"sales",children:"Sales & Marketing"})]})]})]}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm text-red-700",children:v})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),i==="promote"?"Promoting...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{className:"w-4 h-4"}),i==="promote"?"Promote Employee":"Create Manager"]})})]})]})]})}):null});Si.displayName="AddUserModal";const Pt=n=>typeof n=="string"?n:n?.id||"",Ei=p.memo(()=>{const n=js(),{user:t}=De(),{organization:s}=We(),{canCreateHRManagers:r,canCreateHODManagers:a,canManageDepartments:i,canManageUsers:o}=Vt(),[l,m]=p.useState([]),[c,x]=p.useState(null),[u,h]=p.useState([]),[v,g]=p.useState([]),[b,f]=p.useState({totalUsers:0,totalEmployees:0,totalDepartments:0,activeWarnings:0,monthlyGrowth:0}),[j,w]=p.useState(!0),[C,D]=p.useState(!1),[S,y]=p.useState("hr-manager"),[A,R]=p.useState(null);p.useEffect(()=>{s&&_()},[s]);const _=async()=>{if(s)try{w(!0),d.debug(`📊 Loading organization data for: ${s.id}`);const O=(await ge.queryDocuments(s.id,"users",[])).documents.map(H=>({id:H.id,firstName:H.firstName||"",lastName:H.lastName||"",email:H.email,role:H.role,departmentIds:H.departmentIds||[],isActive:H.isActive??!0,createdAt:H.createdAt||new Date().toISOString(),lastLogin:H.lastLogin})),q=O.filter(H=>Pt(H.role)!=="business-owner"),Y=O.find(H=>Pt(H.role)==="business-owner")||null,G=await je.loadEmployees(s.id),L=(await je.loadWarnings(s.id)).documents.filter(H=>H.status==="issued").length,W=(await Ht.getDepartments(s.id)).map(H=>({id:H.id,name:H.name,employeeCount:H.employeeCount,createdAt:H.createdAt.toISOString(),description:H.description,managerId:H.managerId,managerName:H.managerName})),$={totalUsers:q.length,totalEmployees:G.documents.length,totalDepartments:W.length,activeWarnings:L,monthlyGrowth:12.5};m(q),x(Y),h(W),g(G.documents),f($),d.success(`✅ Loaded organization data: ${q.length} users, ${G.documents.length} employees`)}catch(z){d.error("❌ Failed to load organization data:",z)}finally{w(!1)}},F=z=>{y(z),D(!0)},k=()=>{R(`✅ ${S==="hr-manager"?"HR Manager":"Department Manager"} created successfully! User can now sign in with their email and password 'temp123'.`),setTimeout(()=>R(null),5e3),_()},E=async z=>{if(!s)return;const O=l.find(P=>P.id===z);if(!O)return;const q=await I(z),Y=q.length>0?`Archive ${O.firstName} ${O.lastName}?

This will:
• Archive the user account
• Reassign ${q.length} employees to HR managers
• Remove access to the system

This action can be undone by restoring the user.`:`Archive ${O.firstName} ${O.lastName}?

This will remove their access to the system.
This action can be undone by restoring the user.`;if(confirm(Y))try{d.debug(`🗃️ Archiving user ${z} and reassigning employees...`),q.length>0&&await T(z,q),await je.updateDocument(s.id,"users",z,{isActive:!1,archivedAt:new Date().toISOString(),archivedBy:O?.uid||"system"}),d.success(`✅ User archived successfully: ${O.firstName} ${O.lastName}`),_()}catch(P){d.error("❌ Failed to archive user:",P),alert("Failed to archive user. Please try again.")}},N=async z=>{if(!s)return;const O=l.find(Y=>Y.id===z);if(!(!O||!confirm(`Restore ${O.firstName} ${O.lastName}?

This will reactivate their account and restore system access.`)))try{d.debug(`🔄 Restoring user ${z}...`),await je.updateDocument(s.id,"users",z,{isActive:!0,restoredAt:new Date().toISOString(),restoredBy:O?.uid||"system",archivedAt:null,archivedBy:null}),d.success(`✅ User restored successfully: ${O.firstName} ${O.lastName}`),_()}catch(Y){d.error("❌ Failed to restore user:",Y),alert("Failed to restore user. Please try again.")}},I=async z=>{if(!s)return[];try{return(await je.loadEmployees(s.id)).documents.filter(q=>q.employment?.managerId===z&&q.isActive!==!1)}catch(O){return d.error("Error loading managed employees:",O),[]}},T=async(z,O)=>{if(!(!s||O.length===0))try{const q=l.find(G=>Pt(G.role)==="hr-manager"&&G.isActive&&G.id!==z);if(!q){d.warn("⚠️ No active HR manager found for employee reassignment");return}d.debug(`📋 Reassigning ${O.length} employees to HR manager: ${q.firstName} ${q.lastName}`);const Y=O.map(G=>je.updateDocument(s.id,"employees",G.id,{"employment.managerId":q.id,"employment.managerName":`${q.firstName} ${q.lastName}`,"employment.managerRole":"hr-manager",reassignedAt:new Date().toISOString(),reassignedFrom:z,reassignedReason:"Manager archived"}));await Promise.all(Y),d.success(`✅ Reassigned ${O.length} employees to ${q.firstName} ${q.lastName}`)}catch(q){throw d.error("❌ Failed to reassign employees:",q),q}};return j?e.jsx("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-20 bg-gray-200 rounded"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[A&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 animate-in fade-in duration-300",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-green-600"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-green-800 font-medium",children:A})}),e.jsx("button",{onClick:()=>R(null),className:"text-green-600 hover:text-green-800 p-1 rounded-full hover:bg-green-100",children:e.jsx(ve,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Organization Management"}),e.jsx("p",{className:"text-blue-100",children:"Manage users, departments, and organizational structure"})]})]}),e.jsx("div",{className:"text-xs bg-white/20 backdrop-blur px-4 py-2 rounded-full font-semibold",children:"V2 Architecture"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(Ne,{className:"w-6 h-6 mx-auto mb-2 text-blue-200"}),e.jsx("div",{className:"text-2xl font-bold",children:b.totalUsers}),e.jsx("div",{className:"text-xs text-blue-200",children:"System Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(Se,{className:"w-6 h-6 mx-auto mb-2 text-blue-200"}),e.jsx("div",{className:"text-2xl font-bold",children:b.totalEmployees}),e.jsx("div",{className:"text-xs text-blue-200",children:"Employees"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(Je,{className:"w-6 h-6 mx-auto mb-2 text-blue-200"}),e.jsx("div",{className:"text-2xl font-bold",children:b.totalDepartments}),e.jsx("div",{className:"text-xs text-blue-200",children:"Departments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur rounded-xl p-4 text-center",children:[e.jsx(ft,{className:"w-6 h-6 mx-auto mb-2 text-blue-200"}),e.jsxs("div",{className:"text-2xl font-bold",children:["+",b.monthlyGrowth,"%"]}),e.jsx("div",{className:"text-xs text-blue-200",children:"Growth"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r()&&e.jsx("button",{onClick:()=>F("hr-manager"),className:"group bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 hover:border-blue-500 rounded-2xl p-6 transition-all duration-200 hover:shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 bg-blue-100 group-hover:bg-blue-200 rounded-xl transition-colors",children:e.jsx(_s,{className:"w-8 h-8 text-blue-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Add HR Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create new HR management role"})]})]})}),a()&&e.jsx("button",{onClick:()=>F("hod-manager"),className:"group bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-dashed border-green-300 hover:border-green-500 rounded-2xl p-6 transition-all duration-200 hover:shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 bg-green-100 group-hover:bg-green-200 rounded-xl transition-colors",children:e.jsx(Ne,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Add Department Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create department head role"})]})]})}),o()&&e.jsx("button",{onClick:()=>n("/users"),className:"group bg-gradient-to-br from-purple-50 to-violet-50 border-2 border-dashed border-purple-300 hover:border-purple-500 rounded-2xl p-6 transition-all duration-200 hover:shadow-lg",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 bg-purple-100 group-hover:bg-purple-200 rounded-xl transition-colors",children:e.jsx(jt,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage all system users"})]})]})})]}),c&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-3 mb-4",children:[e.jsx(Ft,{className:"w-6 h-6 text-yellow-600"}),"Business Owner"]}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-4 border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx(Ft,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-gray-900",children:[c.firstName," ",c.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Rt,{className:"w-3 h-3"}),c.email]}),c.lastLogin&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),"Last login: ",new Date(c.lastLogin).toLocaleDateString()]}),e.jsx("div",{className:"text-xs text-yellow-700 font-medium mt-1",children:"👑 Organization Owner • Full Access"})]})]}),(t?.role==="super-user"||t?.role==="reseller")&&e.jsxs("div",{className:"flex items-center gap-2",children:[c.isActive?e.jsx("button",{onClick:()=>E(c.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive business owner",children:e.jsx(ps,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):e.jsx("button",{onClick:()=>N(c.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore business owner",children:e.jsx(Xt,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${c.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:c.isActive?"Active":"Archived"})]}),t?.role==="business-owner"&&e.jsx("div",{className:"px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Current User"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-3 mb-4",children:[e.jsx(Se,{className:"w-6 h-6 text-blue-600"}),"HR Managers (",l.filter(z=>Pt(z.role)==="hr-manager").length,")"]}),e.jsxs("div",{className:"space-y-3",children:[l.filter(z=>Pt(z.role)==="hr-manager").map(z=>e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"font-semibold text-blue-600 text-sm",children:[z.firstName?.[0],z.lastName?.[0]]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[z.firstName," ",z.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Rt,{className:"w-3 h-3"}),z.email]}),z.lastLogin&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),"Last login: ",new Date(z.lastLogin).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z.isActive?e.jsx("button",{onClick:()=>E(z.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive user",children:e.jsx(ps,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):e.jsx("button",{onClick:()=>N(z.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore user",children:e.jsx(Xt,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${z.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z.isActive?"Active":"Archived"})]})]})},z.id)),l.filter(z=>Pt(z.role)==="hr-manager").length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Se,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No HR managers yet"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-3 mb-4",children:[e.jsx(Ne,{className:"w-6 h-6 text-green-600"}),"Department Managers (",l.filter(z=>Pt(z.role)==="hod-manager").length,")"]}),e.jsxs("div",{className:"space-y-3",children:[l.filter(z=>Pt(z.role)==="hod-manager").map(z=>e.jsx("div",{className:"bg-gray-50 rounded-xl p-4 border border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsxs("span",{className:"font-semibold text-green-600 text-sm",children:[z.firstName?.[0],z.lastName?.[0]]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[z.firstName," ",z.lastName]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-1",children:[e.jsx(Rt,{className:"w-3 h-3"}),z.email]}),z.departmentIds&&z.departmentIds.length>0&&e.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["Manages: ",z.departmentIds.map(O=>u.find(q=>q.id===O)?.name||O).join(", ")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[z.isActive?e.jsx("button",{onClick:()=>E(z.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive user",children:e.jsx(ps,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):e.jsx("button",{onClick:()=>N(z.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore user",children:e.jsx(Xt,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),e.jsx("div",{className:`px-3 py-1 rounded-full text-xs font-medium ${z.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:z.isActive?"Active":"Archived"})]})]})},z.id)),l.filter(z=>Pt(z.role)==="hod-manager").length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ne,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No department managers yet"})]})]})]})]}),i()&&u.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-3 mb-4",children:[e.jsx(Je,{className:"w-6 h-6 text-orange-600"}),"Departments (",u.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:u.map(z=>e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-4 border border-orange-200",children:[e.jsx("div",{className:"mb-3",children:e.jsx("h4",{className:"font-semibold text-gray-900",children:z.name})}),z.managerName?e.jsxs("div",{className:"text-sm text-green-700 font-medium mb-2",children:["👤 ",z.managerName]}):e.jsx("div",{className:"text-sm text-orange-600 font-medium mb-2",children:"⚠️ No manager assigned"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Ne,{className:"w-4 h-4"}),z.employeeCount," employees"]})]},z.id))})]})]}),C&&Gn.createPortal(e.jsx(Si,{isOpen:C,onClose:()=>D(!1),onSuccess:k,userRole:S,employees:v}),document.body)]})});Ei.displayName="OrganizationManagementV2";const qd={totalWarnings:0,activeWarnings:0,expiredWarnings:0,pendingReview:0,highRisk:0,expiringSoon:0,byLevel:{verbal:0,first_written:0,second_written:0,final_written:0,suspension:0,dismissal:0},byStatus:{delivered:0,issued:0,acknowledged:0,appealed:0,expired:0},recentActivity:{todayCount:0,weekCount:0,monthCount:0}},Gd=()=>{const{user:n}=De(),[t,s]=p.useState(qd),[r,a]=p.useState(!0),[i,o]=p.useState(null),l=async()=>{if(!n?.organizationId){a(!1);return}try{a(!0),o(null),d.debug("🔔 Loading warnings stats for:",n.organizationId);const c=await Ce.warnings.getAll(n.organizationId);d.debug("🔔 Warnings loaded:",c.length);const x=new Date,u=new Date(x.getFullYear(),x.getMonth(),x.getDate()),h=new Date(x.getTime()-10080*60*1e3),v=new Date(x.getTime()-720*60*60*1e3),g=new Date(x.getTime()+720*60*60*1e3),b={totalWarnings:c.length,activeWarnings:0,expiredWarnings:0,pendingReview:0,highRisk:0,expiringSoon:0,byLevel:{verbal:0,first_written:0,second_written:0,final_written:0,suspension:0,dismissal:0},byStatus:{delivered:0,issued:0,acknowledged:0,appealed:0,expired:0},recentActivity:{todayCount:0,weekCount:0,monthCount:0}};c.forEach(f=>{const j=f.issueDate?new Date(f.issueDate):new Date(f.createdAt),w=f.expiryDate?new Date(f.expiryDate):null;(w?w>x:!0)?b.activeWarnings++:b.expiredWarnings++,["final_written","suspension","dismissal"].includes(f.level)&&b.highRisk++,w&&w<=g&&w>x&&b.expiringSoon++,f.level in b.byLevel&&b.byLevel[f.level]++,f.status&&f.status in b.byStatus&&b.byStatus[f.status]++,f.appealSubmitted&&b.pendingReview++,j>=u&&b.recentActivity.todayCount++,j>=h&&b.recentActivity.weekCount++,j>=v&&b.recentActivity.monthCount++}),s(b)}catch(c){d.error("Failed to load warnings stats:",c),o("Failed to load warnings statistics")}finally{a(!1)}},m=async()=>{await l()};return p.useEffect(()=>{let c=!0,x=null;return n?.organizationId?(l(),x=setInterval(()=>{c&&l()},6e4)):a(!1),()=>{c=!1,x&&clearInterval(x)}},[n?.organizationId]),{stats:t,loading:r,error:i,refreshStats:m}},kt=({title:n,value:t,subtitle:s,icon:r,color:a,bgColor:i,trend:o,isLoading:l,onClick:m,pulse:c=!1})=>l?e.jsx("div",{className:"bg-white rounded-lg p-3 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-20"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-12"})]}),e.jsx("div",{className:`w-8 h-8 ${i} rounded-lg animate-pulse`})]})}):e.jsx("div",{className:`bg-white rounded-lg p-3 border transition-all duration-200 ${m?"hover:shadow-md cursor-pointer hover:border-gray-300":""}`,onClick:m,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:n}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:`text-2xl font-bold ${a}`,children:t.toLocaleString()}),c&&t>0&&e.jsx("div",{className:`w-2 h-2 ${i.replace("bg-","bg-")} rounded-full animate-pulse`})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s}),o&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsxs("span",{className:`text-xs font-medium ${o.isPositive?"text-green-600":"text-red-600"}`,children:[o.isPositive?"↗":"↘"," ",Math.abs(o.value),"%"]}),e.jsx("span",{className:"text-xs text-gray-400",children:o.label})]})]}),e.jsx("div",{className:`p-2 ${i} rounded-lg`,children:e.jsx(r,{className:`w-8 h-8 ${a}`})})]})}),Vd=({userRole:n,variant:t="detailed",gradientColors:s="from-red-500 to-orange-600",showHeader:r=!0})=>{const{stats:a,loading:i,error:o,refreshStats:l}=Gd(),m=()=>n==="business-owner"?Se:me,c=()=>n==="business-owner"?"text-purple-600":"text-emerald-600",x=()=>n==="business-owner"?"Warnings Overview":"Warnings Management",u=()=>n==="business-owner"?"Executive summary of disciplinary actions":"Active warnings requiring review and management";return t==="compact"?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-4",children:[r&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:`text-lg font-semibold ${c()} flex items-center gap-2`,children:[Lt.createElement(m(),{className:"w-5 h-5"}),"Warnings"]}),e.jsx("button",{onClick:l,className:"p-1 text-gray-400 hover:text-gray-600 rounded",disabled:i,children:e.jsx(pt,{className:`w-4 h-4 ${i?"animate-spin":""}`})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(kt,{title:"Active",value:a.activeWarnings,subtitle:"Current warnings",icon:ae,color:"text-green-600",bgColor:"bg-green-100",isLoading:i}),e.jsx(kt,{title:"High Risk",value:a.highRisk,subtitle:"Require attention",icon:me,color:"text-red-600",bgColor:"bg-red-100",isLoading:i,pulse:a.highRisk>0})]})]}):t==="executive"?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[r&&e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`text-lg font-semibold ${c()} flex items-center gap-2 mb-1`,children:[Lt.createElement(m(),{className:"w-6 h-6"}),x()]}),e.jsx("p",{className:"text-gray-600 text-sm",children:u()})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",disabled:i,children:e.jsx(pt,{className:`w-5 h-5 ${i?"animate-spin":""}`})})]}),o&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Lr,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Failed to load warnings data"})]}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:o})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(kt,{title:"Total Warnings",value:a.totalWarnings,subtitle:"All time",icon:ye,color:"text-gray-700",bgColor:"bg-gray-100",isLoading:i}),e.jsx(kt,{title:"Active",value:a.activeWarnings,subtitle:"Currently valid",icon:ae,color:"text-green-600",bgColor:"bg-green-100",isLoading:i}),e.jsx(kt,{title:"High Risk",value:a.highRisk,subtitle:"Final/Suspension/Dismissal",icon:me,color:"text-red-600",bgColor:"bg-red-100",isLoading:i,pulse:a.highRisk>0}),e.jsx(kt,{title:"This Month",value:a.recentActivity.monthCount,subtitle:"Recent activity",icon:ft,color:"text-blue-600",bgColor:"bg-blue-100",isLoading:i})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Warning Level Distribution"}),e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:a.byLevel.verbal}),e.jsx("div",{className:"text-xs text-gray-600",children:"Verbal"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-yellow-600",children:a.byLevel.first_written}),e.jsx("div",{className:"text-xs text-gray-600",children:"1st Written"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600",children:a.byLevel.second_written}),e.jsx("div",{className:"text-xs text-gray-600",children:"2nd Written"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-red-600",children:a.byLevel.final_written}),e.jsx("div",{className:"text-xs text-gray-600",children:"Final"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600",children:a.byLevel.suspension}),e.jsx("div",{className:"text-xs text-gray-600",children:"Suspension"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a.byLevel.dismissal}),e.jsx("div",{className:"text-xs text-gray-600",children:"Dismissal"})]})]})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[r&&e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`text-lg font-semibold ${c()} flex items-center gap-2 mb-1`,children:[Lt.createElement(m(),{className:"w-6 h-6"}),x()]}),e.jsx("p",{className:"text-gray-600 text-sm",children:u()})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",disabled:i,children:e.jsx(pt,{className:`w-5 h-5 ${i?"animate-spin":""}`})})]}),o&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(Lr,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Failed to load warnings data"})]}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:o})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(kt,{title:"Pending Review",value:a.pendingReview,subtitle:"Require immediate attention",icon:Re,color:"text-orange-600",bgColor:"bg-orange-100",isLoading:i,pulse:a.pendingReview>0}),e.jsx(kt,{title:"High Risk",value:a.highRisk,subtitle:"Final/Suspension/Dismissal",icon:me,color:"text-red-600",bgColor:"bg-red-100",isLoading:i,pulse:a.highRisk>0}),e.jsx(kt,{title:"Expiring Soon",value:a.expiringSoon,subtitle:"Within 30 days",icon:Re,color:"text-yellow-600",bgColor:"bg-yellow-100",isLoading:i}),e.jsx(kt,{title:"Active Total",value:a.activeWarnings,subtitle:"Currently valid",icon:ae,color:"text-green-600",bgColor:"bg-green-100",isLoading:i})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[e.jsx(wa,{className:"w-5 h-5 text-gray-600"}),"Warning Level Distribution"]}),e.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-6 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:a.byLevel.verbal}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Verbal"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:a.byLevel.first_written}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"1st Written"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-orange-600",children:a.byLevel.second_written}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"2nd Written"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-red-600",children:a.byLevel.final_written}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Final"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-purple-600",children:a.byLevel.suspension}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Suspension"})]}),e.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900",children:a.byLevel.dismissal}),e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Dismissal"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5 text-blue-600"}),"Recent Activity"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-700",children:a.recentActivity.todayCount}),e.jsx("div",{className:"text-sm text-blue-600",children:"Today"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-700",children:a.recentActivity.weekCount}),e.jsx("div",{className:"text-sm text-blue-600",children:"This Week"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-700",children:a.recentActivity.monthCount}),e.jsx("div",{className:"text-sm text-blue-600",children:"This Month"})]})]})]})]})},Qd=({onClose:n,inline:t=!1})=>{const{organization:s,organizationId:r}=We(),[a,i]=p.useState([]),[o,l]=p.useState(!0),[m,c]=p.useState(null),[x,u]=p.useState(null),h=async()=>{if(!r){c("Organization ID not found"),l(!1);return}try{l(!0),c(null),d.debug("[OrganizationCategoriesViewer] Loading categories for organization:",r);const f=await Ce.organizations.getCategories(r);d.debug("[OrganizationCategoriesViewer] Loaded categories:",f),i(f)}catch(f){d.error("[OrganizationCategoriesViewer] Error loading categories:",f),c(f instanceof Error?f.message:"Failed to load categories")}finally{l(!1)}};p.useEffect(()=>{h()},[r]);const v=f=>{switch(f){case"minor":case"low":return"#10b981";case"serious":case"medium":return"#f59e0b";case"gross_misconduct":case"high":return"#ef4444";default:return"#6b7280"}},g=f=>{switch(f){case"minor":case"low":return e.jsx(Se,{className:"h-4 w-4"});case"serious":case"medium":return e.jsx(me,{className:"h-4 w-4"});case"gross_misconduct":case"high":return e.jsx(ve,{className:"h-4 w-4"});default:return e.jsx(ye,{className:"h-4 w-4"})}},b=e.jsxs(e.Fragment,{children:[!t&&e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-violet-600 text-white p-2 rounded-lg",children:e.jsx(Ys,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Warning Categories"}),e.jsxs("p",{className:"text-gray-600",children:[s?.name," • ",a.length," categories configured"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:h,disabled:o,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",title:"Refresh categories",children:e.jsx(pt,{className:`h-4 w-4 ${o?"animate-spin":""}`})}),e.jsx("button",{onClick:n,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",title:"Close",children:e.jsx(ve,{className:"h-4 w-4"})})]})]})}),t&&e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-violet-600 text-white p-2 rounded-lg",children:e.jsx(Ys,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Warning Categories"}),e.jsxs("p",{className:"text-gray-600",children:[s?.name," • ",a.length," categories configured"]})]})]}),e.jsx("button",{onClick:h,disabled:o,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",title:"Refresh categories",children:e.jsx(pt,{className:`h-4 w-4 ${o?"animate-spin":""}`})})]}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"h-8 w-8 animate-spin text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading categories..."})]})}):m?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Categories"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Try Again"})]})}):a.length===0?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ys,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Categories Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No warning categories have been configured for this organization yet."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-blue-800 text-sm",children:[e.jsx(Ur,{className:"h-4 w-4"}),e.jsx("span",{children:"Categories can only be configured by SuperUser administrators for security and compliance."})]})})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($r,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Read-Only View"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Category modifications are restricted to SuperUser administrators to ensure compliance, prevent fraud, and maintain data integrity across all disciplinary records."})]})]})}),e.jsx("div",{className:"space-y-4",children:a.map(f=>{const j=x===f.id;return e.jsx("div",{className:"border border-gray-200 rounded-lg bg-white",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:f.color||v(f.severity)}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:f.name}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-white text-sm font-medium",style:{backgroundColor:v(f.severity)},children:[g(f.severity),f.severity?.replace("_"," ")||"Unknown"]}),f.isActive!==!1&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:[e.jsx(ae,{className:"h-3 w-3"}),"Active"]})]}),f.description&&e.jsx("p",{className:"text-gray-600 mb-3 leading-relaxed",children:f.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"h-3 w-3"}),f.escalationPath?.length||0," escalation steps"]}),f.createdAt&&e.jsxs("div",{children:["Created: ",new Date(f.createdAt).toLocaleDateString("en-ZA")]})]})]})]}),e.jsx("button",{onClick:()=>u(j?null:f.id),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",title:j?"Collapse details":"Expand details",children:j?e.jsx(Gt,{className:"w-4 h-4"}):e.jsx(Ke,{className:"w-4 h-4"})})]}),j&&e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(wt,{className:"h-4 w-4"}),"Escalation Path"]}),f.escalationPath&&f.escalationPath.length>0?e.jsx("div",{className:"space-y-2",children:f.escalationPath.map((w,C)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-semibold",children:C+1}),e.jsx("span",{className:"text-sm font-medium capitalize",children:w.replace("_"," ")})]},C))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No escalation path defined"})]}),e.jsxs("div",{children:[e.jsxs("h5",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Category ID:"}),e.jsx("span",{className:"text-gray-600 ml-2 font-mono text-xs",children:f.id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Severity:"}),e.jsx("span",{className:"text-gray-600 ml-2 capitalize",children:f.severity?.replace("_"," ")||"Not specified"})]}),f.examples&&f.examples.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Examples:"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[f.examples.slice(0,3).map((w,C)=>e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:w},C)),f.examples.length>3&&e.jsxs("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:["+",f.examples.length-3," more"]})]})]})]})]})]})})]})},f.id)})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Total: ",e.jsx("strong",{children:a.length})," categories configured"]}),e.jsxs("span",{children:["Active: ",e.jsx("strong",{children:a.filter(f=>f.isActive!==!1).length})," categories"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($r,{className:"h-3 w-3"}),"Read-only access"]})]})})]})})]});return t?e.jsx("div",{className:"space-y-4",children:b}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:b})})},qn=[{text:"Leadership is not about being in charge. It's about taking care of those in your charge.",author:"Simon Sinek"},{text:"The growth and development of people is the highest calling of leadership.",author:"Harvey S. Firestone"},{text:"Great leaders don't set out to be a leader... They set out to make a difference.",author:"Jeremy Bravo"},{text:"A good leader takes a little more than his share of the blame, a little less than his share of the credit.",author:"Arnold H. Glasow"},{text:"The task of leadership is not to put greatness into people, but to elicit it, for the greatness is there already.",author:"John Buchan"},{text:"People buy into the leader before they buy into the vision.",author:"John Maxwell"},{text:"Leadership is about making others better as a result of your presence and making sure that impact lasts in your absence.",author:"Sheryl Sandberg"}],Ai=p.memo(({className:n="",isMobile:t=!1})=>{const s=js(),{user:r}=De(),{organization:a}=We(),[i,o]=p.useState("organization"),{employees:l,warnings:m,metrics:c,error:x}=Yr({role:"business_owner"}),u={totalEmployees:l?.length||0,monthlyGrowth:(()=>{const v=new Date().getMonth(),g=new Date().getFullYear(),b=l?.filter(j=>{const w=new Date(j.createdAt||j.metadata?.createdAt||0);return w.getMonth()===v&&w.getFullYear()===g})?.length||0,f=l?.filter(j=>{const w=new Date(j.createdAt||j.metadata?.createdAt||0),C=v===0?11:v-1,D=v===0?g-1:g;return w.getMonth()===C&&w.getFullYear()===D})?.length||0;return f>0?Math.round((b-f)/f*100*10)/10:0})(),complianceScore:c?.complianceScore||95,activeWarnings:m?.filter(v=>v.status!=="delivered")?.length||0,undeliveredWarnings:m?.filter(v=>!v.delivered)?.length||0,highSeverityWarnings:m?.filter(v=>v.severity==="high"||v.category?.severity==="gross_misconduct")?.length||0},[h]=p.useState(()=>qn[Math.floor(Math.random()*qn.length)]);return t?e.jsxs("div",{className:`space-y-6 ${n}`,children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:[e.jsx(Ft,{className:"w-6 h-6 inline-block mr-2",style:{color:"var(--color-primary)"}}),"Executive Command Center"]}),e.jsxs("p",{className:"mt-1",style:{color:"var(--color-text-secondary)"},children:[a?.name||"Your Organization"," • Strategic Overview"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(Qe,{title:"Total Employees",count:u.totalEmployees,subtitle:`${u.monthlyGrowth>=0?"+":""}${u.monthlyGrowth}% this month`,icon:e.jsx(Ne,{className:"w-4 h-4"}),variant:"success",gradient:!0,onClick:()=>o("employees")}),e.jsx(Qe,{title:"Compliance Score",count:`${u.complianceScore}%`,subtitle:"Excellent rating",icon:e.jsx(Se,{className:"w-4 h-4"}),variant:"info",gradient:!0}),e.jsx(Qe,{title:"Active Warnings",count:u.activeWarnings,subtitle:`${u.undeliveredWarnings} undelivered`,icon:e.jsx(me,{className:"w-4 h-4"}),variant:"warning",gradient:!0,onClick:()=>o("warnings")}),e.jsx(Qe,{title:"High Priority Cases",count:u.highSeverityWarnings,subtitle:"Require oversight",icon:e.jsx(Se,{className:"w-4 h-4"}),variant:"error",gradient:!0,onClick:()=>o("warnings")})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ne,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("organization"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Je,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Organization Management"})]}),e.jsx(_t,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(ne,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("employees"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Employee Management"})]}),e.jsx(_t,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(ne,{padding:"md",shadow:"sm",hover:!0,onClick:()=>s("/users"),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-5 h-5",style:{color:"var(--color-accent)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"User Management"})]}),e.jsx(_t,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),e.jsxs(ne,{padding:"lg",className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[e.jsxs("p",{className:"text-sm italic mb-2",style:{color:"var(--color-text-secondary)"},children:['"',h.text,'"']}),e.jsxs("p",{className:"text-xs font-semibold",style:{color:"var(--color-text-tertiary)"},children:["— ",h.author]})]})]}):e.jsxs("div",{className:`${n}`,children:[e.jsx("div",{className:"flex justify-between items-start mb-6",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-3",style:{color:"var(--color-text)"},children:[e.jsx(Ft,{className:"w-7 h-7",style:{color:"var(--color-primary)"}}),"Executive Command Center"]}),e.jsxs("p",{className:"mt-1 text-base",style:{color:"var(--color-text-secondary)"},children:[a?.name||"Your Organization"," • Strategic oversight & organizational management"]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-6 gap-3 mb-6",children:[e.jsx(Qe,{title:"Total Employees",count:u.totalEmployees,icon:e.jsx(Ne,{className:"w-4 h-4"}),variant:"success",gradient:!0,onClick:()=>o("employees")}),e.jsx(Qe,{title:"Monthly Growth",count:`${u.monthlyGrowth>=0?"+":""}${u.monthlyGrowth}%`,icon:e.jsx(ft,{className:"w-4 h-4"}),variant:"info",gradient:!0}),e.jsx(Qe,{title:"Compliance",count:`${u.complianceScore}%`,icon:e.jsx(Se,{className:"w-4 h-4"}),variant:"info",gradient:!0}),e.jsx(Qe,{title:"Active Warnings",count:u.activeWarnings,subtitle:`${u.undeliveredWarnings} pending`,icon:e.jsx(me,{className:"w-4 h-4"}),variant:"warning",gradient:!0,onClick:()=>o("warnings")}),e.jsx(Qe,{title:"High Priority",count:u.highSeverityWarnings,subtitle:"Critical cases",icon:e.jsx(Se,{className:"w-4 h-4"}),variant:"error",gradient:!0,onClick:()=>o("warnings")}),e.jsx(Qe,{title:"Departments",count:c?.departmentCount||0,icon:e.jsx(Je,{className:"w-4 h-4"}),variant:"default",gradient:!0,onClick:()=>o("departments")})]}),x&&e.jsx(Xe,{variant:"error",className:"mb-4",children:e.jsxs("div",{className:"text-sm",children:["Failed to load dashboard data: ",x]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex space-x-6 px-4",children:[{id:"organization",label:"Organization",icon:Je},{id:"departments",label:"Departments",icon:Je},{id:"categories",label:"Warning Categories",icon:Ys},{id:"employees",label:"Employees",icon:Ne},{id:"warnings",label:"Warnings",icon:Se}].map(v=>e.jsxs("button",{onClick:()=>o(v.id),className:`flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium transition-colors ${i===v.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx(v.icon,{className:"w-4 h-4"}),v.label]},v.id))})}),e.jsxs("div",{className:"p-4",children:[i==="organization"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Ei,{})}),i==="departments"&&a&&e.jsx(vi,{isOpen:!0,onClose:()=>o("organization"),organizationId:a.id,inline:!0}),i==="categories"&&e.jsx(Qd,{onClose:()=>o("organization"),inline:!0}),i==="employees"&&e.jsx("div",{className:"space-y-4",children:e.jsx(Jr,{})}),i==="warnings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-4",children:[e.jsx("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:u.undeliveredWarnings}),e.jsx("div",{className:"text-sm text-orange-700",children:"Undelivered"}),e.jsx("div",{className:"text-xs text-orange-600",children:"Require delivery"})]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:u.highSeverityWarnings}),e.jsx("div",{className:"text-sm text-red-700",children:"High Severity"}),e.jsx("div",{className:"text-xs text-red-600",children:"Critical oversight"})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.activeWarnings}),e.jsx("div",{className:"text-sm text-blue-700",children:"Total Active"}),e.jsx("div",{className:"text-xs text-blue-600",children:"All warnings"})]})]})})]}),e.jsx(Vd,{userRole:"business-owner",variant:"executive"})]})]})]}),e.jsx(ne,{padding:"lg",className:"mt-6 border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Ft,{className:"w-8 h-8 mt-1",style:{color:"var(--color-primary)",opacity:.3}}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-base italic mb-2",style:{color:"var(--color-text-secondary)"},children:['"',h.text,'"']}),e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--color-text-tertiary)"},children:["— ",h.author]})]})]})})]})});Ai.displayName="BusinessOwnerDashboardSection";const ls=p.memo(({error:n,resetErrorBoundary:t})=>e.jsxs("div",{className:"rounded-lg p-6 m-4",style:{backgroundColor:"var(--color-alert-error-bg)",border:"1px solid var(--color-alert-error-border)"},children:[e.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--color-alert-error-text)"},children:"Something went wrong"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-alert-error-text)"},children:n.message}),e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-lg transition-colors text-white",style:{backgroundColor:"var(--color-error)",hover:{backgroundColor:"var(--color-error)"}},onMouseEnter:s=>{s.currentTarget.style.opacity="0.9"},onMouseLeave:s=>{s.currentTarget.style.opacity="1"},children:"Try again"})]}));ls.displayName="ErrorFallback";const Ri=p.memo(()=>e.jsxs("div",{className:"animate-pulse max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"h-8 rounded w-1/3 mb-2",style:{backgroundColor:"var(--color-muted)"}}),e.jsx("div",{className:"h-4 rounded w-2/3",style:{backgroundColor:"var(--color-subtle)"}})]})),bt=p.memo(()=>e.jsxs("div",{className:"rounded-2xl p-6 animate-pulse",style:{backgroundColor:"var(--color-card-background)",boxShadow:"var(--shadow-lg)",border:"1px solid var(--color-card-border)"},children:[e.jsx("div",{className:"h-6 rounded w-1/3 mb-4",style:{backgroundColor:"var(--color-muted)"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 rounded w-full",style:{backgroundColor:"var(--color-subtle)"}}),e.jsx("div",{className:"h-4 rounded w-3/4",style:{backgroundColor:"var(--color-subtle)"}})]})]}));Ri.displayName="WelcomeSkeleton";bt.displayName="SkeletonCard";const Fi=p.memo(()=>{const{user:n}=De(),{organizationData:t}=We(),{getPrimaryRole:s,canManageOrganization:r,canManageHR:a}=Vt();return n?e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--color-background)"},children:[e.jsx("div",{className:"pb-0",style:{backgroundColor:"var(--color-background)"},children:e.jsx("div",{className:"max-w-7xl mx-auto p-6 pb-4",children:e.jsx(Ss,{FallbackComponent:ls,children:e.jsx(p.Suspense,{fallback:e.jsx(Ri,{}),children:e.jsx(ka,{})})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 pt-2",children:[r()&&e.jsx(Ss,{FallbackComponent:ls,children:e.jsx(p.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(bt,{}),e.jsx(bt,{}),e.jsx(bt,{})]}),children:e.jsx(Ai,{})})}),a()&&!r()&&e.jsx(Ss,{FallbackComponent:ls,children:e.jsx(p.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-4 mb-6",children:[e.jsx(bt,{}),e.jsx(bt,{}),e.jsx(bt,{}),e.jsx(bt,{})]}),children:e.jsx(bd,{})})}),s()==="hod-manager"&&!a()&&!r()&&e.jsx(Ss,{FallbackComponent:ls,children:e.jsx(p.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(bt,{}),e.jsx(bt,{}),e.jsx(bt,{})]}),children:e.jsx(ki,{})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ss,{FallbackComponent:ls,children:e.jsx(p.Suspense,{fallback:e.jsx("div",{className:"h-20 bg-white rounded-xl shadow-sm animate-pulse border border-gray-100"}),children:e.jsx(yi,{})})})})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading dashboard..."})})})});Fi.displayName="BusinessDashboard";const _i=()=>{const{user:n}=De(),[t,s]=p.useState(null),[r,a]=p.useState(!0),[i,o]=p.useState("6m");p.useEffect(()=>{n?.resellerId&&l()},[n?.resellerId,i]);const l=async()=>{if(n?.resellerId)try{a(!0),d.debug("Loading reseller dashboard data...",{resellerId:n.resellerId});const[f,j,w,C,D]=await Promise.all([He.getReseller(n.resellerId),As.getResellerMetrics(n.resellerId),He.getResellerClients(n.resellerId),As.getRecentCommissions(n.resellerId,5),As.getPerformanceTrend(n.resellerId,i)]);if(!f)throw new Error("Reseller profile not found");s({reseller:f,metrics:j,clients:w,recentCommissions:C,monthlyTrend:D}),d.success("Reseller dashboard loaded successfully")}catch(f){d.error("Failed to load reseller dashboard:",f)}finally{a(!1)}},m=f=>`R${(f/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,c=f=>`${f>0?"+":""}${f.toFixed(1)}%`,x=async()=>{if(n?.resellerId)try{d.debug("Generating commission statement..."),await As.generateCommissionStatement(n.resellerId),d.success("Commission statement downloaded")}catch(f){d.error("Failed to generate commission statement:",f)}};if(r)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});if(!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Is,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reseller Profile Not Found"}),e.jsx("p",{className:"text-gray-600",children:"Please contact support to set up your reseller account."})]});const{reseller:u,metrics:h,clients:v,recentCommissions:g,monthlyTrend:b}=t;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",u.firstName,"!"]}),e.jsxs("p",{className:"text-blue-100 flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(rs,{className:"w-4 h-4"}),u.province]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"w-4 h-4"}),(u.commissionRate*100).toFixed(0),"% Commission"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:m(h.monthlyCommissions)}),e.jsx("div",{className:"text-blue-100",children:"This Month's Earnings"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Clients"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:h.totalClients}),e.jsxs("div",{className:"text-sm text-gray-500",children:[h.activeClients," active"]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:m(h.monthlyRecurringRevenue)}),e.jsxs("div",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(ft,{className:"w-3 h-3"}),c(h.monthlyGrowth)]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Do,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Commissions"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:m(h.totalCommissionsEarned)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Lifetime earnings"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(wt,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Avg Client Value"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:m(h.averageClientValue)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Per month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Performance Trend"}),e.jsxs("select",{value:i,onChange:f=>o(f.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"3m",children:"3 Months"}),e.jsx("option",{value:"6m",children:"6 Months"}),e.jsx("option",{value:"12m",children:"12 Months"})]})]}),e.jsx("div",{className:"space-y-3",children:b.map((f,j)=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:f.month}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Revenue: "}),e.jsx("span",{className:"font-semibold",children:m(f.revenue)})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Commission: "}),e.jsx("span",{className:"font-semibold text-green-600",children:m(f.commissions)})]})]})]},j))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>window.location.href="/deploy-client",className:"w-full flex items-center gap-3 px-4 py-3 bg-orange-50 text-orange-700 rounded-lg hover:bg-orange-100 transition-colors",children:[e.jsx(ua,{className:"w-4 h-4"}),"Deploy Client"]}),e.jsxs("button",{onClick:x,className:"w-full flex items-center gap-3 px-4 py-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(zs,{className:"w-4 h-4"}),"Download Statement"]}),e.jsxs("button",{onClick:()=>window.location.href="/my-clients",className:"w-full flex items-center gap-3 px-4 py-3 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(ut,{className:"w-4 h-4"}),"View All Clients"]}),e.jsxs("button",{onClick:()=>window.location.href="/performance",className:"w-full flex items-center gap-3 px-4 py-3 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx(ft,{className:"w-4 h-4"}),"Detailed Analytics"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Your Clients (",v.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[v.slice(0,5).map(f=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:f.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:[e.jsx("span",{children:f.sector}),e.jsxs("span",{children:[f.employees?.length||0," employees"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-green-600",children:m(f.monthlySubscription||0)}),e.jsx("div",{className:"text-xs text-gray-500",children:"monthly"})]})]},f.id)),v.length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("button",{onClick:()=>window.location.href="/my-clients",className:"text-sm text-blue-600 hover:text-blue-800",children:["View all ",v.length," clients →"]})})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Earnings"}),e.jsxs("div",{className:"space-y-3",children:[g.map(f=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:f.clientName}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(tt,{className:"w-3 h-3"}),new Date(f.periodStart).toLocaleDateString("en-ZA")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-green-600",children:m(f.commissionAmount)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(f.commissionRate*100).toFixed(0),"% of ",m(f.baseAmount)]})]})]},f.id)),g.length===0&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Re,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No recent commissions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Earnings will appear here as clients are billed"})]})]})]})]})]})},pm=Object.freeze(Object.defineProperty({__proto__:null,ResellerDashboard:_i},Symbol.toStringTag,{value:"Module"})),Kd=[{id:"executive",name:"Executive"},{id:"human-resources",name:"Human Resources"},{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"logistics",name:"Logistics"},{id:"finance",name:"Finance"}],Yd=()=>{const{user:n}=De(),[t,s]=p.useState({users:[],loading:!0,error:null,creatableRoles:[],userManagementRules:Fs["business-owner"]});p.useEffect(()=>{if(n?.role?.id){const u=Fs[n.role.id],h=fc(n.role.id);s(v=>({...v,userManagementRules:u||Fs["business-owner"],creatableRoles:h}))}},[n]);const r=u=>{switch(u){case"business-owner":return"#dc2626";case"hr-manager":return"#059669";case"hod-manager":return"#7c3aed";default:return"#64748b"}},a=u=>{if(!u)return"Never";const h=new Date(u);return h.toLocaleDateString()+" "+h.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},i=(u,h)=>!n||!t.userManagementRules?!1:Fn(n.role.id,n.organizationId,u.role.id,u.organizationId,h),o=async()=>{if(!n?.organizationId){s(u=>({...u,loading:!1,error:"No organization found"}));return}try{s(g=>({...g,loading:!0,error:null})),d.debug("🔍 Loading users for organization:",n.organizationId);const u=await ge.queryDocuments(n.organizationId,"users",[]),h=g=>typeof g=="string"?g:g?.id||"",v=u.documents.filter(g=>{const b=h(g.role);return b!=="business-owner"&&Fn(n.role.id,n.organizationId,b,g.organizationId,"read")}).map(g=>({...g,role:typeof g.role=="string"?Ts[g.role]:g.role}));d.success(`✅ Loaded ${v.length} manageable users from sharded structure`),s(g=>({...g,users:v,loading:!1}))}catch(u){d.error("❌ Error loading users:",u),s(h=>({...h,loading:!1,error:u instanceof Error?u.message:"Failed to load users"}))}},l=async u=>{if(!n?.organizationId)throw new Error("No organization found");if(!(t.userManagementRules.canCreate?.includes(u.roleId)||!1))throw new Error(`You don't have permission to create ${u.roleId} accounts`);try{d.debug("🚀 Creating new user:",u.email);const v=await Ue.signUp(u.email,u.password);d.success(5389);const g={id:v.uid,email:u.email,firstName:u.firstName,lastName:u.lastName,role:Ts[u.roleId],organizationId:n.organizationId,departmentIds:u.roleId==="hod-manager"?u.departmentIds:[],isActive:!0,createdAt:new Date().toISOString(),lastLogin:void 0};await Ue.createDocument(Fo.USERS,g,v.uid),d.success(6159),s(b=>({...b,users:[...b.users,g]}))}catch(v){if(d.error("❌ Error creating user:",v),v instanceof Error){if(v.message.includes("email-already-in-use"))throw new Error("This email address is already registered");if(v.message.includes("weak-password"))throw new Error("Password is too weak. Please choose a stronger password");if(v.message.includes("invalid-email"))throw new Error("Please enter a valid email address")}throw v}},m=async(u,h)=>{if(!n?.organizationId)throw new Error("No organization found");try{d.debug("📝 Updating user:",u),await ge.updateDocument(n.organizationId,"users",u,{...h,updatedAt:new Date().toISOString(),updatedBy:n?.id}),s(v=>({...v,users:v.users.map(g=>g.id===u?{...g,...h}:g)})),d.success(7586)}catch(v){throw d.error("❌ Error updating user:",v),v}},c=async u=>{const h=t.users.find(v=>v.id===u);if(!h)throw new Error("User not found");if(!i(h,"deactivate"))throw new Error("You don't have permission to deactivate this user");try{d.debug("🚫 Deactivating user:",u),await ge.updateDocument(n.organizationId,"users",u,{isActive:!1,deactivatedAt:new Date().toISOString(),deactivatedBy:n?.id}),s(v=>({...v,users:v.users.map(g=>g.id===u?{...g,isActive:!1}:g)})),d.success(8612)}catch(v){throw d.error("❌ Error deactivating user:",v),v}},x=async u=>{try{d.debug("✅ Reactivating user:",u),await ge.updateDocument(n.organizationId,"users",u,{isActive:!0,reactivatedAt:new Date().toISOString(),reactivatedBy:n?.id}),s(h=>({...h,users:h.users.map(v=>v.id===u?{...v,isActive:!0}:v)})),d.success(9358)}catch(h){throw d.error("❌ Error reactivating user:",h),h}};return p.useEffect(()=>{n?.organizationId&&t.userManagementRules&&o()},[n?.organizationId,t.userManagementRules]),{users:t.users,loading:t.loading,error:t.error,creatableRoles:t.creatableRoles,userManagementRules:t.userManagementRules,loadUsers:o,createUser:l,updateUser:m,deactivateUser:c,reactivateUser:x,canManageUser:i,getRoleColor:r,formatLastLogin:a,departments:Kd}},Zd=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],Xd=({onSubmit:n,onCancel:t,creatableRoles:s,loading:r})=>{const[a,i]=p.useState({email:"",firstName:"",lastName:"",roleId:"",departmentIds:[],password:"",confirmPassword:""}),[o,l]=p.useState({}),m=()=>{const u={};a.firstName.trim()||(u.firstName="First name is required"),a.lastName.trim()||(u.lastName="Last name is required"),a.email.trim()||(u.email="Email is required"),a.roleId||(u.roleId="Role is required"),a.password||(u.password="Password is required"),a.confirmPassword||(u.confirmPassword="Please confirm password");const h=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.email&&!h.test(a.email)&&(u.email="Please enter a valid email address"),a.password&&a.password.length<6&&(u.password="Password must be at least 6 characters"),a.password!==a.confirmPassword&&(u.confirmPassword="Passwords do not match"),a.roleId==="hod-manager"&&a.departmentIds.length===0&&(u.departmentIds="Please select at least one department for managers"),l(u),Object.keys(u).length===0},c=async u=>{if(u.preventDefault(),!!m())try{await n(a)}catch{}},x=u=>{i(h=>({...h,departmentIds:h.departmentIds.includes(u)?h.departmentIds.filter(v=>v!==u):[...h.departmentIds,u]}))};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"hr-card",style:{width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",margin:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid #e5e7eb"},children:[e.jsxs("h2",{style:{margin:0,color:"#1f2937",fontSize:"1.25rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Pe,{size:20}),"Create New User Account"]}),e.jsx("button",{onClick:t,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6b7280"},onMouseOver:u=>u.currentTarget.style.backgroundColor="#f3f4f6",onMouseOut:u=>u.currentTarget.style.backgroundColor="transparent",children:e.jsx(ve,{size:20})})]}),e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Personal Information"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"First Name *"}),e.jsx("input",{type:"text",value:a.firstName,onChange:u=>i(h=>({...h,firstName:u.target.value})),style:{width:"100%",padding:"0.75rem",border:o.firstName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:u=>u.target.style.borderColor="#3b82f6",onBlur:u=>u.target.style.borderColor=o.firstName?"#ef4444":"#d1d5db"}),o.firstName&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"Last Name *"}),e.jsx("input",{type:"text",value:a.lastName,onChange:u=>i(h=>({...h,lastName:u.target.value})),style:{width:"100%",padding:"0.75rem",border:o.lastName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:u=>u.target.style.borderColor="#3b82f6",onBlur:u=>u.target.style.borderColor=o.lastName?"#ef4444":"#d1d5db"}),o.lastName&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.lastName})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Rt,{size:16}),"Email Address *"]}),e.jsx("input",{type:"email",value:a.email,onChange:u=>i(h=>({...h,email:u.target.value})),style:{width:"100%",padding:"0.75rem",border:o.email?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:u=>u.target.style.borderColor="#3b82f6",onBlur:u=>u.target.style.borderColor=o.email?"#ef4444":"#d1d5db"}),o.email&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.email})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Role & Permissions"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Se,{size:16}),"User Role *"]}),e.jsxs("select",{value:a.roleId,onChange:u=>i(h=>({...h,roleId:u.target.value})),style:{width:"100%",padding:"0.75rem",border:o.roleId?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none",backgroundColor:"white"},onFocus:u=>u.target.style.borderColor="#3b82f6",onBlur:u=>u.target.style.borderColor=o.roleId?"#ef4444":"#d1d5db",children:[e.jsx("option",{value:"",children:"Select Role"}),s.map(u=>e.jsxs("option",{value:u.id,children:[u.name," - ",u.description]},u.id))]}),o.roleId&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.roleId})]}),a.roleId==="hod-manager"&&e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Ne,{size:16}),"Departments (for HOD/Manager role) *"]}),e.jsx("div",{style:{border:o.departmentIds?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",padding:"0.75rem",backgroundColor:"#f9fafb",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:Zd.map(u=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontSize:"0.875rem"},children:[e.jsx("input",{type:"checkbox",checked:a.departmentIds.includes(u.id),onChange:()=>x(u.id),style:{margin:0}}),u.name]},u.id))}),o.departmentIds&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.departmentIds})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Account Security"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx($r,{size:16}),"Password *"]}),e.jsx("input",{type:"password",value:a.password,onChange:u=>i(h=>({...h,password:u.target.value})),style:{width:"100%",padding:"0.75rem",border:o.password?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:u=>u.target.style.borderColor="#3b82f6",onBlur:u=>u.target.style.borderColor=o.password?"#ef4444":"#d1d5db",minLength:6}),o.password&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.password})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx($r,{size:16}),"Confirm Password *"]}),e.jsx("input",{type:"password",value:a.confirmPassword,onChange:u=>i(h=>({...h,confirmPassword:u.target.value})),style:{width:"100%",padding:"0.75rem",border:o.confirmPassword?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:u=>u.target.style.borderColor="#3b82f6",onBlur:u=>u.target.style.borderColor=o.confirmPassword?"#ef4444":"#d1d5db",minLength:6}),o.confirmPassword&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:o.confirmPassword})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:[e.jsx("button",{type:"button",onClick:t,className:"hr-button-secondary",disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",className:"hr-button-primary",disabled:r,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Creating..."]}):e.jsx(e.Fragment,{children:"✅ Create User"})})]})]})]})})},Jd=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],em=({users:n,loading:t,onDeactivateUser:s,onReactivateUser:r,onEditUser:a,canManageUser:i,getRoleColor:o,formatLastLogin:l})=>{const[m,c]=p.useState(null),x=async b=>{const f=n.find(w=>w.id===b);if(!(!f||!confirm(`Are you sure you want to deactivate ${f.firstName} ${f.lastName}?

They will no longer be able to log in to the system.`)))try{c(b),await s(b)}catch(w){d.error("Error deactivating user:",w)}finally{c(null)}},u=async b=>{const f=n.find(w=>w.id===b);if(!(!f||!confirm(`Are you sure you want to reactivate ${f.firstName} ${f.lastName}?

They will be able to log in again.`)))try{c(b),await r(b)}catch(w){d.error("Error reactivating user:",w)}finally{c(null)}},h=b=>{if(!b)return"Unknown";try{return new Date(b).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},v=b=>e.jsx("span",{className:"hr-badge",style:{backgroundColor:o(b.role.id)+"20",color:o(b.role.id),border:`1px solid ${o(b.role.id)}`,fontWeight:"600"},children:b.role.name}),g=b=>!b||b.length===0?"-":b.map(f=>Jd.find(j=>j.id===f)?.name||f).join(", ");return t?e.jsxs("div",{className:"hr-card",style:{padding:"3rem",textAlign:"center"},children:[e.jsx("h2",{style:{color:"#1e40af"},children:"👤 Loading Users..."}),e.jsx("p",{style:{color:"#64748b"},children:"Please wait while we load the user data."})]}):n.length===0?e.jsx("div",{className:"hr-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:[e.jsx(Pe,{size:48,style:{color:"#d1d5db",margin:"0 auto 1rem"}}),e.jsx("h3",{style:{color:"#6b7280",marginBottom:"0.5rem"},children:"No manageable users found."}),e.jsx("p",{style:{color:"#9ca3af",margin:0},children:"Create your first HR Manager or Department Head!"})]})}):e.jsxs("div",{className:"hr-card",children:[e.jsxs("h3",{style:{margin:"0 0 1rem",color:"#1e40af",fontSize:"1.125rem",fontWeight:"600"},children:["👥 Organization Users (",n.length,")"]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"User"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Role"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Departments"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Status"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Created"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Actions"})]})}),e.jsx("tbody",{children:n.map(b=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb",opacity:b.isActive?1:.7,backgroundColor:b.isActive?"transparent":"#f9fafb"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"600",color:b.isActive?"#1f2937":"#6b7280",marginBottom:"0.25rem"},children:[b.firstName," ",b.lastName]}),e.jsx("div",{style:{fontSize:"0.875rem",color:b.isActive?"#64748b":"#9ca3af"},children:b.email})]})}),e.jsx("td",{style:{padding:"0.75rem"},children:v(b)}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{fontSize:"0.875rem",color:b.isActive?"#374151":"#6b7280"},children:g(b.departmentIds)})}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{className:`hr-badge ${b.isActive?"hr-badge-success":"hr-badge-danger"}`,children:b.isActive?"✅ Active":"❌ Inactive"})}),e.jsx("td",{style:{padding:"0.75rem",fontSize:"0.875rem",color:"#6b7280"},children:h(b.createdAt)}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[i(b,"update")&&e.jsxs("button",{onClick:()=>a(b),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",border:"1px solid #bfdbfe",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Edit user details",children:[e.jsx(Xn,{size:12}),"Edit"]}),i(b,"deactivate")&&e.jsx(e.Fragment,{children:b.isActive?e.jsxs("button",{onClick:()=>x(b.id),disabled:m===b.id,className:"hr-button-danger",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:m===b.id?.6:1,cursor:m===b.id?"not-allowed":"pointer"},title:"Deactivate user account",children:[m===b.id?e.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):e.jsx(Lr,{size:12}),"🚫 Deactivate"]}):e.jsxs("button",{onClick:()=>u(b.id),disabled:m===b.id,className:"hr-button-success",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:m===b.id?.6:1,cursor:m===b.id?"not-allowed":"pointer"},title:"Reactivate user account",children:[m===b.id?e.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #059669",borderRadius:"50%",animation:"spin 1s linear infinite"}}):e.jsx(Xt,{size:12}),"✅ Reactivate"]})})]})})]},b.id))})]})})]})},tm=({currentUser:n,userManagementRules:t})=>{const s=gi[n.role.id];return s?e.jsxs("div",{className:"hr-card",children:[e.jsxs("h4",{style:{margin:"0 0 1rem",color:"#7c3aed",fontSize:"1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:["🛡️ Your User Management Permissions (",n.role.name,")"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#059669",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(ae,{size:16}),"✅ You Can:"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:s.capabilities.filter(r=>r.startsWith("✅")).map((r,a)=>e.jsx("li",{style:{color:"#166534",marginBottom:"0.25rem"},children:r.replace("✅ ","")},a))})]}),e.jsxs("div",{children:[e.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#dc2626",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Lr,{size:16}),"❌ You Cannot:"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:s.capabilities.filter(r=>r.startsWith("❌")).map((r,a)=>e.jsx("li",{style:{color:"#991b1b",marginBottom:"0.25rem"},children:r.replace("❌ ","")},a))}),t.restrictions&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{style:{margin:"1rem 0 0.5rem",color:"#6b7280",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase"},children:"System Restrictions:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:t.restrictions.map((r,a)=>e.jsx("li",{style:{color:"#6b7280",marginBottom:"0.25rem"},children:r},a))})]})]})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#f0f9ff",borderRadius:"6px",border:"1px solid #bfdbfe"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#1e40af"},children:[e.jsx("strong",{children:"Scope:"})," ",t.scope==="organization"?"Organization-wide":"Global"," •",e.jsx("strong",{children:" Manageable Roles:"})," ",t.canManage?.join(", ")||"None"]})})]}):null},zi=()=>{const n=js(),{user:t,organization:s}=De(),{users:r,loading:a,error:i,creatableRoles:o,userManagementRules:l,createUser:m,deactivateUser:c,reactivateUser:x,canManageUser:u,getRoleColor:h,formatLastLogin:v}=Yd(),[g,b]=p.useState(!1),[f,j]=p.useState(!1),[w,C]=p.useState(null),[D,S]=p.useState(null),y=gi[t?.role?.id];Lt.useEffect(()=>{if(w){const k=setTimeout(()=>C(null),5e3);return()=>clearTimeout(k)}},[w]);const A=async k=>{j(!0);try{await m(k),C({type:"success",text:`User ${k.firstName} ${k.lastName} created successfully!`}),b(!1)}catch(E){throw C({type:"error",text:E instanceof Error?E.message:"Failed to create user"}),E}finally{j(!1)}},R=async k=>{try{const E=r.find(N=>N.id===k);await c(k),C({type:"success",text:`User ${E?.firstName} ${E?.lastName} deactivated successfully`})}catch(E){C({type:"error",text:E instanceof Error?E.message:"Failed to deactivate user"})}},_=async k=>{try{const E=r.find(N=>N.id===k);await x(k),C({type:"success",text:`User ${E?.firstName} ${E?.lastName} reactivated successfully`})}catch(E){C({type:"error",text:E instanceof Error?E.message:"Failed to reactivate user"})}},F=k=>{S(k),C({type:"info",text:"Edit functionality coming soon!"})};return t?y?e.jsxs("div",{children:[e.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>n("/dashboard"),className:"hr-button-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},title:"Back to Dashboard",children:[e.jsx(Wr,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:"0 0 0.5rem",color:"#1e40af",fontSize:"1.5rem",fontWeight:"600"},children:"👤 User Management"}),e.jsxs("p",{style:{margin:"0 0 1rem",color:"#64748b"},children:["Manage HR Managers and Department Heads for ",s?.name]}),e.jsxs("div",{style:{display:"flex",gap:"2rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#10b981"}}),e.jsxs("span",{style:{color:"#6b7280"},children:["Active Users: ",r.filter(k=>k.isActive).length]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#ef4444"}}),e.jsxs("span",{style:{color:"#6b7280"},children:["Inactive Users: ",r.filter(k=>!k.isActive).length]})]})]})]})]}),o.length>0&&e.jsx("button",{onClick:()=>b(!0),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:"➕ Create New User"})]})}),w&&e.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem",border:`2px solid ${w.type==="success"?"#059669":w.type==="error"?"#dc2626":"#3b82f6"}`,background:w.type==="success"?"#f0fdf4":w.type==="error"?"#fef2f2":"#eff6ff"},children:e.jsxs("div",{style:{color:w.type==="success"?"#059669":w.type==="error"?"#dc2626":"#1d4ed8",fontWeight:"600",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[w.type==="success"?"✅":w.type==="error"?"❌":"ℹ️"," ",w.text]}),e.jsx("button",{onClick:()=>C(null),style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",color:"inherit"},children:"×"})]})}),i&&e.jsxs("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#ef4444"},children:[e.jsx(qe,{size:20}),e.jsx("span",{style:{fontWeight:"500"},children:"Error loading users"})]}),e.jsx("p",{style:{margin:"0.5rem 0 0",color:"#6b7280",fontSize:"0.875rem"},children:i})]}),e.jsx(tm,{currentUser:t,userManagementRules:l}),e.jsx("div",{style:{marginTop:"1.5rem"},children:e.jsx(em,{users:r,loading:a,onDeactivateUser:R,onReactivateUser:_,onEditUser:F,canManageUser:u,getRoleColor:h,formatLastLogin:v})}),g&&e.jsx(Xd,{onSubmit:A,onCancel:()=>b(!1),creatableRoles:o,loading:f}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f0f9ff",borderRadius:"6px",fontSize:"0.875rem",color:"#0369a1"},children:[e.jsx("strong",{children:"Development Status:"})," Enhanced User Management v2.0 - Organization: ",s?.name," • Current User: ",t.role.name," • Manageable Roles: ",l.canManage?.join(", ")||"None"," • Users Loaded: ",r.length]})]}):e.jsx("div",{className:"hr-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[e.jsx(Se,{size:48,style:{color:"#f59e0b",margin:"0 auto 1rem"}}),e.jsx("h2",{style:{color:"#f59e0b",marginBottom:"0.5rem"},children:"Access Restricted"}),e.jsxs("p",{style:{color:"#6b7280",margin:0},children:["Your role (",t.role.name,") does not have user management permissions."]})]})}):e.jsx("div",{className:"hr-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[e.jsx(qe,{size:48,style:{color:"#ef4444",margin:"0 auto 1rem"}}),e.jsx("h2",{style:{color:"#ef4444",marginBottom:"0.5rem"},children:"Authentication Required"}),e.jsx("p",{style:{color:"#6b7280",margin:0},children:"Please log in to access user management."})]})})},fm=Object.freeze(Object.defineProperty({__proto__:null,UserManagement:zi},Symbol.toStringTag,{value:"Module"})),ym=()=>{const{user:n}=De(),{getPrimaryRole:t}=Vt(),[s,r]=p.useState("dashboard"),a=()=>{r("dashboard")};if(!n)return e.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx("h2",{style:{color:"#ef4444"},children:"Authentication Required"}),e.jsx("p",{style:{color:"#64748b"},children:"Please log in to access the dashboard."})]});const i=t(),o=()=>e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("button",{onClick:a,className:"hr-button-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"← Back to Dashboard"})});if(s==="user-management")return e.jsxs("div",{children:[e.jsx(o,{}),e.jsx(zi,{})]});switch(i){case"super-user":return e.jsxs("div",{children:[e.jsx("div",{className:"p-6 max-w-7xl mx-auto pb-0",children:e.jsx(ka,{})}),e.jsx(Bc,{})]});case"reseller":return e.jsx(_i,{});case"business-owner":case"hr-manager":case"hod-manager":return e.jsx(Fi,{});default:return e.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[e.jsxs("h2",{style:{color:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(jt,{style:{width:"1.5rem",height:"1.5rem"}}),"Role Configuration Needed"]}),e.jsxs("p",{style:{color:"#64748b",margin:"1rem 0"},children:['Your user role "',n.role.name,'" needs dashboard configuration. Please contact your system administrator.']}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#374151",marginBottom:"0.5rem"},children:e.jsx("strong",{children:"Debug Information:"})}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280",fontFamily:"monospace"},children:["Role ID: ",n.role.id,e.jsx("br",{}),"Role Name: ",n.role.name,e.jsx("br",{}),"User ID: ",n.id,e.jsx("br",{}),"Organization: ",n.organizationId||"None"]})]}),e.jsx("div",{style:{marginTop:"1.5rem"},children:e.jsxs("button",{onClick:()=>r("dashboard"),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:"0 auto"},children:[e.jsx(ut,{style:{width:"1rem",height:"1rem"}}),"Try Dashboard Anyway"]})})]})}};export{Ce as A,va as C,ym as D,xm as E,Ue as F,d as L,ms as N,li as O,Zr as P,um as R,je as S,dm as T,fm as U,Mr as a,lc as b,Xr as c,We as d,cm as e,lm as f,Et as g,Vt as h,He as i,e as j,Lo as k,ge as l,As as m,Tt as n,Ls as o,Wd as p,B as q,Ld as r,Ve as s,hm as t,De as u,gm as v,pm as w};
