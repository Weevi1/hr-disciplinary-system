const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/business-owner-dashboard-C_-CP9x1.js","assets/react-vendor-CWjEGAcE.js","assets/pdf-vendor-tUwojRr6.js","assets/firebase-vendor-sscTfFPd.js","assets/ui-vendor-ywXYq-A-.js"])))=>i.map(i=>d[i]);
import{L as e,g as t,a,u as s,b as r,d as n,D as i,c as l,e as o,f as c,j as d,Z as m,T as g,h as x,i as u,A as p,k as h,U as y,l as f,m as v,n as b,o as N,p as j,E as w,q as D,F as S}from"./business-owner-dashboard-C_-CP9x1.js";import{r as C,b as k,u as E}from"./react-vendor-CWjEGAcE.js";import{q as F,l as T,t as P,C as _,j as I,k as A,n as R,m as L,L as M,E as z,_ as O,G as $,H as W,I as U,J as V,K as q,M as B,N as H,O as G,P as Y,c as K,D as J,g as Q,T as Z}from"./firebase-vendor-sscTfFPd.js";import{WarningsReviewDashboard as X}from"./warning-components-CCdzJGSb.js";import{a as ee}from"./pdf-vendor-tUwojRr6.js";import{X as te,b as ae,R as se,L as re,F as ne,a as ie,Q as le,V as oe,Y as ce,w as de,Z as me,_ as ge,e as xe,N as ue,y as pe,$ as he,M as ye,U as fe,a0 as ve,a1 as be,x as Ne,a2 as je,i as we,a3 as De,a4 as Se,a5 as Ce,a6 as ke,a7 as Ee,a8 as Fe,D as Te,I as Pe,f as _e,J as Ie,a9 as Ae,aa as Re,ab as Le,ac as Me,ad as ze,C as Oe,q as $e,k as We,ae as Ue,af as Ve,l as qe,n as Be,K as He,S as Ge,ag as Ye,A as Ke,G as Je,s as Qe,o as Ze,ah as Xe,ai as et,aj as tt}from"./ui-vendor-ywXYq-A-.js";class at{static replacePlaceholders(e,t){if(!e)return"";let a=e;const s=e.matchAll(/\{\{([^}]+)\}\}/g);for(const r of s){const e=r[1].trim(),s=this.getValueFromPath(e,t);a=a.replace(r[0],s||`[${e}]`)}return a}static getValueFromPath(e,t){const a=e.split(".");try{if("employee"===a[0])switch(a[1]){case"firstName":return t.employee?.firstName||"";case"lastName":return t.employee?.lastName||"";case"employeeNumber":return t.employee?.employeeNumber||"";case"email":return t.employee?.email||"";case"phoneNumber":case"phone":return t.employee?.phone||"";case"department":return t.employee?.department||"";case"position":return t.employee?.position||"";default:return""}if("warning"===a[0])switch(a[1]){case"level":return this.formatWarningLevel(t.warningLevel);case"issueDate":return this.formatDate(t.issuedDate);case"incidentDate":return this.formatDate(t.incidentDate);case"category":return t.category||"";case"description":return t.description||"";case"nextLevel":return this.getNextEscalationLevel(t.warningLevel);default:return""}if("organization"===a[0])switch(a[1]){case"name":return t.organization?.name||"";case"industry":return this.formatIndustry(t.organization);default:return""}if("manager"===a[0])switch(a[1]){case"name":return t.issuedByName||"Management";case"position":return"Manager";default:return""}return""}catch(s){return console.warn(`Failed to resolve placeholder: ${e}`,s),""}}static formatWarningLevel(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"}[e]||e}static getNextEscalationLevel(e){return{counselling:"Verbal Warning",verbal:"First Written Warning",first_written:"Second Written Warning",second_written:"Final Written Warning",final_written:"Suspension or Dismissal",suspension:"Dismissal",dismissal:"Termination"}[e]||"Further Disciplinary Action"}static formatDate(e){if(!e)return"";try{const t="string"==typeof e?new Date(e):e,a=t.getDate(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()];return`${a} ${s} ${t.getFullYear()}`}catch(t){return console.warn("Failed to format date:",e,t),""}}static formatIndustry(e){if(!e)return"";const t=e.branding?.industry||e.industry;return{manufacturing:"Manufacturing",retail:"Retail",healthcare:"Healthcare",security:"Security Services",mining:"Mining"}[t]||t||""}static replacePlaceholdersInArray(e,t){return e.map(e=>this.replacePlaceholders(e,t))}static hasUnresolvedPlaceholders(e){return/\{\{[^}]+\}\}/.test(e)}static extractPlaceholders(e){return Array.from(e.matchAll(/\{\{([^}]+)\}\}/g)).map(e=>e[1].trim())}}const st="1.2.0";class rt{static async generateWarningPDF(t,a,s){const r=a||st;switch(t.warningId,r){case"1.0.0":return this.generateWarningPDF_v1_0_0(t);case"1.1.0":return this.generateWarningPDF_v1_1_0(t,s);case"1.2.0":return this.generateWarningPDF_v1_2_0(t,s);default:return e.warn(`âš ï¸ Unsupported PDF generator version: ${r}, falling back to current`),this.generateWarningPDF_v1_2_0(t,s)}}static async generateWarningPDF_v1_0_0(s){try{const r=t||{isLegacyDevice:!1};a(r);if(r.isLegacyDevice)return e.warn("ðŸš¨ Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(s);Date.now();const{default:n}=await ee(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),i=new n({orientation:"portrait",unit:"mm",format:"a4",compress:!0});i.setFont("helvetica","normal");let l=15;const o=i.internal.pageSize.width,c=i.internal.pageSize.height,d=20,m=40;l=this.addOrganizationHeader(i,s.organization,l,o,d),l=this.addDocumentTitle(i,s,l,o,d,c,m),l=this.addEmployeeSection(i,s.employee,l,o,d,c,m),l=this.addWarningDetailsSection(i,s,l,o,d,c,m),l=this.addIncidentDetailsSection(i,s,l,o,d,c,m),s.disciplineRecommendation&&(l=this.addPreviousDisciplinaryActionSection_v1_0_0(i,s.disciplineRecommendation,l,o,d,c,m),l=this.addConsequencesSection(i,s,l,o,d,c,m)),s.legalCompliance&&(l=this.addLegalComplianceSection(i,s.legalCompliance,l,o,d,c,m)),s.additionalNotes&&(l=this.addAdditionalNotesSection(i,s.additionalNotes,l,o,d,c,m)),l=this.addEmployeeRightsSection(i,s,l,o,d,c,m),l=this.addSignaturesSection(i,s.signatures,s.employee,l,o,d,c,m,s.issuedDate,s.issuedByName),s.deliveryChoice&&(l=this.addDeliverySection(i,s.deliveryChoice,l,o,d,c,m)),(s.appealDetails||s.appealOutcome)&&(l=this.addAppealHistorySection(i,s,l,o,d,c,m)),this.addDocumentFooter(i,s,o),this.addSecurityWatermark(i,o),"overturned"===s.status&&this.addOverturnedWatermark(i,o);const g=i.output("blob");Date.now();return s.warningId,(g.size/1024).toFixed(1),g}catch(r){throw e.error("âŒ v1.0.0 PDF generation failed:",r),new Error(`PDF generation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}static async generateWarningPDF_v1_1_0(s,r){try{const n=t||{isLegacyDevice:!1};a(n);if(n.isLegacyDevice)return e.warn("ðŸš¨ Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(s);const i={styling:{headerBackground:"#3B82F6",sectionHeaderColor:"#333333",bodyTextColor:"#000000",borderColor:"#C8C8C8",fontSize:11,fontFamily:"helvetica",lineHeight:1.4,pageSize:"A4",margins:{top:20,bottom:20,left:20,right:20}},content:{showWatermark:!0,watermarkText:"CONFIDENTIAL",watermarkOpacity:.1,footerText:"Confidential & Privileged",showPageNumbers:!0}},l=r?{styling:{...i.styling,...r.styling||{}},content:{...i.content,...r.content||{}}}:i;r&&(s.organization,l.styling.headerBackground,l.styling.fontSize,l.content.watermarkText),s.employee,s.organization,!s.description&&s.incidentLocation,s.employee&&(s.employee.firstName,s.employee.lastName),s.organization,s.warningLevel,s.category;Date.now();const{default:o}=await ee(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),c=new o({orientation:"portrait",unit:"mm",format:l.styling.pageSize.toLowerCase(),compress:!0});e.success(3579),c.setFont(l.styling.fontFamily,"normal");let d=l.styling.margins.top;const m=c.internal.pageSize.width,g=c.internal.pageSize.height,x=l.styling.margins.left,u=l.styling.margins.bottom+20;d=this.addOrganizationHeader(c,s.organization,d,m,x),e.success(4172),d=this.addDocumentTitle(c,s,d,m,x,g,u),e.success(4459),d=this.addEmployeeSection(c,s.employee,d,m,x,g,u),e.success(4759),d=this.addWarningDetailsSection(c,s,d,m,x,g,u),e.success(5060),d=this.addIncidentDetailsSection(c,s,d,m,x,g,u),e.success(5387),s.disciplineRecommendation&&(d=this.addPreviousDisciplinaryActionSection(c,s.disciplineRecommendation,d,m,x,g,u),e.success("âœ… Previous disciplinary action section added"),d=this.addConsequencesSection(c,s,d,m,x,g,u),e.success("âœ… Consequences section added")),s.legalCompliance&&(d=this.addLegalComplianceSection(c,s.legalCompliance,d,m,x,g,u),e.success(6262)),s.additionalNotes&&(d=this.addAdditionalNotesSection(c,s.additionalNotes,d,m,x,g,u),e.success(6716)),d=this.addEmployeeRightsSection(c,s,d,m,x,g,u),e.success("âœ… Employee rights section added"),d=this.addSignaturesSection(c,s.signatures,s.employee,d,m,x,g,u,s.issuedDate,s.issuedByName),e.success(7166),s.deliveryChoice&&(d=this.addDeliverySection(c,s.deliveryChoice,d,m,x,g,u),e.success(7512)),(s.appealDetails||s.appealOutcome)&&(d=this.addAppealHistorySection(c,s,d,m,x,g,u),e.success("âœ… Appeal history section added")),this.addDocumentFooter(c,s,m),e.success(7804),this.addSecurityWatermark(c,m),e.success(7997),"overturned"===s.status&&(this.addOverturnedWatermark(c,m),e.success("âœ… OVERTURNED watermark added to all pages"));const p=c.output("blob");Date.now();return s.warningId,s.employee.firstName,s.employee.lastName,(p.size/1024).toFixed(1),p}catch(n){throw e.error("âŒ PDF generation failed:",n),new Error(`PDF generation failed: ${n instanceof Error?n.message:"Unknown error"}`)}}static replacePlaceholders(e,t){let a=e;return t.validityPeriod&&(a=a.replace(/\{\{validityPeriod\}\}/g,t.validityPeriod.toString())),t.employee&&(a=a.replace(/\{\{employee\.firstName\}\}/g,t.employee.firstName||""),a=a.replace(/\{\{employee\.lastName\}\}/g,t.employee.lastName||"")),t.issuedDate&&(a=a.replace(/\{\{issuedDate\}\}/g,this.formatDate(t.issuedDate))),a}static async generateWarningPDF_v1_2_0(a,s){try{if((t||{isLegacyDevice:!1}).isLegacyDevice)return e.warn("ðŸš¨ Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(a);const r={styling:{headerBackground:"#3B82F6",sectionHeaderColor:"#333333",bodyTextColor:"#000000",borderColor:"#C8C8C8",fontSize:11,fontFamily:"helvetica",lineHeight:1.4,pageSize:"A4",margins:{top:20,bottom:20,left:20,right:20}},content:{showWatermark:!0,watermarkText:"CONFIDENTIAL",watermarkOpacity:.1,footerText:"Confidential & Privileged",showPageNumbers:!0},sections:[]},n=s?{styling:{...r.styling,...s.styling||{}},content:{...r.content,...s.content||{}},sections:s.sections||r.sections}:r;n.sections,a.organization;const i=Date.now(),{default:l}=await ee(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),o=new l({orientation:"portrait",unit:"mm",format:n.styling.pageSize.toLowerCase(),compress:!0});o.setFont(n.styling.fontFamily,"normal");let c=n.styling.margins.top;const d=o.internal.pageSize.width,m=o.internal.pageSize.height,g=n.styling.margins.left,x=n.styling.margins.bottom+20;if(c=this.addOrganizationHeader(o,a.organization,c,d,g),c=this.addDocumentTitle(o,a,c,d,g,m,x),c=this.addEmployeeSection(o,a.employee,c,d,g,m,x),c=this.addWarningDetailsSection(o,a,c,d,g,m,x),c=this.addIncidentDetailsSection(o,a,c,d,g,m,x),n.sections&&n.sections.length>0){n.sections.length;const t=[...n.sections].sort((e,t)=>(e.order||0)-(t.order||0));for(const s of t)if(s.enabled){if("signatures"!==s.id)if("standard"===s.type)switch(s.name,s.id){case"previous-disciplinary-actions":a.disciplineRecommendation&&(c=this.addPreviousDisciplinaryActionSection(o,a.disciplineRecommendation,c,d,g,m,x,s));break;case"consequences-section":c=this.addConsequencesSection(o,a,c,d,g,m,x,s);break;case"employee-rights-lra":c=this.addEmployeeRightsSection(o,a,c,d,g,m,x,s);break;case"appeal-history":(a.appealDetails||a.appealOutcome)&&(c=this.addAppealHistorySection(o,a,c,d,g,m,x));break;default:e.warn(`Unknown standard section: ${s.id}, using dynamic renderer`),c=this.renderDynamicSection(o,s,a,c,d,g,m,x,n)}else s.name,c=this.renderDynamicSection(o,s,a,c,d,g,m,x,n)}else s.name;e.success("âœ… All sections rendered successfully")}else e.warn("âš ï¸ No sections configured, using fallback rendering"),a.disciplineRecommendation&&(c=this.addPreviousDisciplinaryActionSection(o,a.disciplineRecommendation,c,d,g,m,x),c=this.addConsequencesSection(o,a,c,d,g,m,x)),a.legalCompliance&&(c=this.addLegalComplianceSection(o,a.legalCompliance,c,d,g,m,x)),a.additionalNotes&&(c=this.addAdditionalNotesSection(o,a.additionalNotes,c,d,g,m,x)),c=this.addEmployeeRightsSection(o,a,c,d,g,m,x);c=this.addSignaturesSection(o,a,c,d,g,m,x),a.appealDetails&&await this.addAppealReportSection(o,a,c,d,g,m,x),this.addDocumentFooter(o,a,d),n.content.showWatermark&&this.addSecurityWatermark(o,d),"overturned"===a.status&&this.addOverturnedWatermark(o,d);const u=o.output("blob"),p=Date.now();return e.success("âœ… v1.2.0 PDF generated successfully:",{warningId:a.warningId,employee:`${a.employee.firstName} ${a.employee.lastName}`,sectionsRendered:n.sections?.filter(e=>e.enabled).length||0,size:`${(u.size/1024).toFixed(1)} KB`,time:p-i+"ms"}),u}catch(r){throw e.error("âŒ v1.2.0 PDF generation failed:",r),new Error(`PDF generation failed: ${r instanceof Error?r.message:"Unknown error"}`)}}static addOrganizationHeader(t,a,s,r,n){const i=this.parseColor(a.branding?.colors?.primary)||{r:59,g:130,b:246};t.setFillColor(i.r,i.g,i.b),t.rect(0,0,r,35,"F");let l=0;if(a.branding?.logo)try{const e=20;l=30,t.addImage(a.branding.logo,"PNG",n,7,l,e)}catch(d){e.warn("Failed to add organization logo to PDF:",d),l=0}t.setTextColor(255,255,255),t.setFontSize(20),t.setFont("helvetica","bold");const o=a.branding?.companyName||a.name||"Organization Name";t.text(o,n+l+(l>0?10:0),15),t.setFontSize(10),t.setFont("helvetica","normal");const c=[];return a.address&&c.push(a.address),a.phone&&c.push(`Tel: ${a.phone}`),a.email&&c.push(`Email: ${a.email}`),c.length>0&&t.text(c.join(" | "),n,25),a.registrationNumber&&t.text(`Registration: ${a.registrationNumber}`,n,30),45}static addDocumentTitle(e,t,a,s,r,n,i){a=this.checkPageOverflow(e,a,30,n,i),e.setTextColor(0,0,0),e.setFontSize(18),e.setFont("helvetica","bold");const l=this.getWarningLevelTitle(t.warningLevel),o=e.getTextWidth(l),c=(s-o)/2;e.text(l,c,a);if("Employee"===t.employee?.firstName||"Category Not Selected"===t.category||!t.description?.trim()){e.setFontSize(12),e.setTextColor(200,50,50);const t="[DRAFT - INCOMPLETE DATA]",r=(s-e.getTextWidth(t))/2;e.text(t,r,a+6),a+=6}e.setTextColor(0,0,0),e.setLineWidth(.5),e.line(c,a+2,c+o,a+2),e.setFontSize(10),e.setFont("helvetica","normal");const d=`Document ID: ${t.warningId} | Issue Date: ${this.formatDate(t.issuedDate)}`,m=(s-e.getTextWidth(d))/2;return e.text(d,m,a+8),a+20}static addEmployeeSection(e,t,a,s,r,n,i){a=this.checkPageOverflow(e,a,40,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("EMPLOYEE INFORMATION",r,a);const l="Employee"===t.firstName||"Not Selected"===t.lastName;l?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(r,a+2,s-2*r,25),l&&(e.setFillColor(255,245,245),e.rect(r+1,a+3,s-2*r-2,23,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),l?e.setTextColor(150,0,0):e.setTextColor(0,0,0);const o=[`Name: ${t.firstName} ${t.lastName}`,`Employee ID: ${t.employeeNumber}`,`Position: ${t.position}`,`Department: ${t.department}`];t.email&&""!==t.email&&o.push(`Email: ${t.email}`),l&&o.push("âš ï¸ Complete employee selection in wizard for full details");let c=a+8;return o.forEach(t=>{e.text(t,r+3,c),c+=4}),a+35}static addWarningDetailsSection(e,t,a,s,r,n,i){a=this.checkPageOverflow(e,a,25,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("WARNING DETAILS",r,a);const l="Category Not Selected"===t.category;e.setFontSize(10),e.setFont("helvetica","normal"),l?e.setTextColor(150,0,0):e.setTextColor(0,0,0);let o=a+8;e.text(`Warning Level: ${this.getWarningLevelDisplay(t.warningLevel)}`,r,o),o+=5;const c=t.category&&"Unknown"!==t.category&&"Category Not Selected"!==t.category?t.category:"General Misconduct";return e.text(`Category: ${c}`,r,o),o+=5,t.validityPeriod&&(e.text(`Validity Period: ${t.validityPeriod} months`,r,o),o+=5),o+5}static addIncidentDetailsSection(e,t,a,s,r,n,i){const l=this.calculateIncidentSectionHeight(e,t,s,r);a=this.checkPageOverflow(e,a,l,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("INCIDENT DETAILS",r,a);const o=t.description&&""!==t.description.trim(),c=t.incidentLocation&&""!==t.incidentLocation.trim(),d=!o&&!c,m=this.calculateIncidentSectionHeight(e,t,s,r);d?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(r,a+2,s-2*r,m),d&&(e.setFillColor(255,245,245),e.rect(r+1,a+3,s-2*r-2,m-2,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let g=a+10;e.setFont("helvetica","bold"),e.text("Date & Time:",r+3,g),e.setFont("helvetica","normal"),e.text(`${this.formatDate(t.incidentDate)} at ${t.incidentTime}`,r+30,g),g+=6,e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Location:",r+3,g),e.setFont("helvetica","normal");const x=c?t.incidentLocation:"Not specified";e.text(x,r+25,g),g+=6,e.setFont("helvetica","bold"),e.text("Description:",r+3,g),g+=5,e.setFont("helvetica","normal");const u=o?t.description:"Details to be completed";return this.wrapText(e,u,s-2*r-6).forEach(t=>{e.text(t,r+3,g),g+=4}),a+m+10}static addPreviousDisciplinaryActionSection(t,a,s,r,n,i,l,o){if(!a)return e.warn("âš ï¸ No recommendation data provided to addPreviousDisciplinaryActionSection"),s;const c=a.activeWarnings||a.previousWarnings||[],d=c.length,m=d>0?6*d+20:20,g=28+m;s=this.checkPageOverflow(t,s,g,i,l);const x=o?.content?.heading||"PREVIOUS DISCIPLINARY ACTION (Still Valid on File)";t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text(x,n,s),t.setDrawColor(200,200,200),t.setFillColor(248,248,248),t.setLineWidth(.3),t.rect(n,s+4,r-2*n,m,"FD"),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);let u=s+12;return c&&c.length>0?c.forEach((e,a)=>{const s=this.formatDate(e.issuedDate||e.issueDate||new Date),r=e.description||e.incidentDescription||"No description available",i=this.getWarningLevelDisplay(e.level||e.warningLevel||"verbal"),l=`${a+1}) Date: ${s} | Incident: ${r.length>60?r.substring(0,57)+"...":r} | Level: ${i}`;t.text(l,n+5,u),u+=6}):t.text("No previous disciplinary action on file",n+5,u),s+m+12}static addPreviousDisciplinaryActionSection_v1_0_0(e,t,a,s,r,n,i){if(!t)return a;const l=t.activeWarnings?.length||0,o=l>0?6*l+20:20,c=28+o;a=this.checkPageOverflow(e,a,c,n,i),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("PREVIOUS DISCIPLINARY ACTION (Still Valid on File)",r,a),e.setDrawColor(200,200,200),e.setFillColor(248,248,248),e.setLineWidth(.3),e.rect(r,a+4,s-2*r,o,"FD"),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let d=a+12;return t.activeWarnings&&t.activeWarnings.length>0?t.activeWarnings.forEach((t,a)=>{const s=`${a+1}) Date: ${this.formatDate(t.issuedDate||t.issueDate||new Date)} | Offense: ${t.category||t.categoryName||"General Misconduct"} | Level: ${this.getWarningLevelDisplay(t.level||t.warningLevel||"verbal")}`;e.text(s,r+5,d),d+=6}):e.text("No previous disciplinary action on file",r+5,d),a+o+12}static addConsequencesSection(t,a,s,r,n,i,l,o){if(!o?.content)return e.warn("âš ï¸ No section config provided for Consequences section, skipping"),s;if(!(o.content.body||o.content.bulletPoints&&o.content.bulletPoints.length>0))return e.warn("âš ï¸ Consequences section config has no body or bulletPoints, skipping"),s;s=this.checkPageOverflow(t,s,40,i,l);const c=o.content.heading||"WARNING: CONSEQUENCES IF EMPLOYEE\nDOES NOT CHANGE BEHAVIOUR";t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51);const d=c.split("\n");d.forEach((e,a)=>{t.text(e,n,s+5*a)});const m=5*d.length;t.setFillColor(254,226,226),t.setDrawColor(239,68,68),t.setLineWidth(.5),t.rect(n,s+m+3,r-2*n,30,"FD"),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(127,29,29);let g=s+m+11;if(o.content.body){const e=this.replacePlaceholders(o.content.body,a);this.wrapText(t,e,r-2*n-15).forEach(e=>{t.text(e,n+5,g),g+=5})}return o.content.bulletPoints&&o.content.bulletPoints.length>0&&o.content.bulletPoints.forEach(e=>{const s=this.replacePlaceholders(e,a);this.wrapText(t,s,r-2*n-15).forEach(e=>{t.text(e,n+5,g),g+=5})}),s+m+30+15}static addLegalComplianceSection(e,t,a,s,r,n,i){if(!t)return a;a=this.checkPageOverflow(e,a,30,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("LEGAL COMPLIANCE",r,a),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let l=a+8;return e.text(`Framework: ${t.framework}`,r,l),l+=5,e.text("Compliance Status: "+(t.isCompliant?"COMPLIANT":"NON-COMPLIANT"),r,l),l+=5,t.requirements.length>0&&(e.text("Legal Requirements:",r,l),l+=4,t.requirements.forEach(t=>{e.text(`â€¢ ${t}`,r+3,l),l+=4})),l+5}static addAdditionalNotesSection(e,t,a,s,r,n,i){const l=this.wrapText(e,t,s-2*r),o=15+4*l.length;a=this.checkPageOverflow(e,a,o,n,i),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("ADDITIONAL NOTES",r,a),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=a+8;return l.forEach(t=>{e.text(t,r,c),c+=4}),c+5}static addEmployeeRightsSection(t,a,s,r,n,i,l,o){if(!o?.content?.subsections||0===o.content.subsections.length)return e.warn("âš ï¸ No subsections in Employee Rights config, skipping"),s;s=this.checkPageOverflow(t,s,110,i,l);const c=o.content.heading||"EMPLOYEE RIGHTS AND NEXT STEPS";t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text(c,n,s);const d=r-2*n;t.setFillColor(239,246,255),t.setDrawColor(59,130,246),t.setLineWidth(.5),t.rect(n,s+4,d,102,"FD");let m=s+14;const g=n+8;return o.content.subsections.forEach((e,s)=>{if(t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(37,99,235),t.text(e.title,g,m),t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0),m+=7,Array.isArray(e.content))e.content.forEach(e=>{const s=this.replacePlaceholders(e,a);this.wrapText(t,s,d-20).forEach(e=>{t.text(e,g,m),m+=5}),m+=2.5});else{const s=this.replacePlaceholders(e.content,a);this.wrapText(t,s,d-20).forEach(e=>{t.text(e,g,m),m+=5})}s<o.content.subsections.length-1&&(m+=3.5)}),m+=8,s+102+35}static addSignaturesSection(t,a,s,r,n,i,l,o,c,d){r=this.checkPageOverflow(t,r,65,l,o),t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(51,51,51),t.text("SIGNATURES",i,r),r+=7;const m=(n-3*i)/2,g=45;if(t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(80,80,80),t.text("Manager Signature:",i,r),t.setDrawColor(150,150,150),t.setLineWidth(.3),t.setTextColor(0,0,0),t.rect(i,r+3,m,g),a?.manager)try{const e=m-16,s=35,n=t.getImageProperties(a.manager),l=n.width,o=l/n.height;let x=e,u=e/o;u>s&&(u=s,x=s*o);const p=(m-x)/2,h=5;t.addImage(a.manager,"PNG",i+p,r+3+h,x,u),t.setFontSize(7),t.setFont("helvetica","normal");const y=d||"_____________________";t.text(`Manager Name: ${y}`,i+2,r+g+7),t.text(`Date: ${this.formatDate(c||new Date)}`,i+2,r+g+11)}catch(u){e.warn("Failed to embed manager signature image:",u),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("âœ“ Digitally Signed",i+5,r+25);const a=d||"_____________________";t.text(`Manager Name: ${a}`,i+2,r+g+7),t.text(`Date: ${this.formatDate(c||new Date)}`,i+2,r+g+11)}else{t.setFontSize(8),t.setFont("helvetica","normal"),t.text("_____________________",i+5,r+30);const e=d||"_____________________";t.text(`Manager Name: ${e}`,i+2,r+g+7),t.text("Date: ___________",i+2,r+g+11)}const x=i+m+10;if(t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(80,80,80),t.text("Employee Signature:",x,r),t.setDrawColor(150,150,150),t.setLineWidth(.3),t.setTextColor(0,0,0),t.rect(x,r+3,m,g),a?.employee)try{const e=m-16,n=35,i=t.getImageProperties(a.employee),l=i.width,o=l/i.height;let d=e,u=e/o;u>n&&(u=n,d=n*o);const p=(m-d)/2,h=5;t.addImage(a.employee,"PNG",x+p,r+3+h,d,u),t.setFontSize(7),t.setFont("helvetica","normal"),t.text(`${s.firstName} ${s.lastName}`,x+2,r+g+7),t.text(`Date: ${this.formatDate(c||new Date)}`,x+2,r+g+11)}catch(u){e.warn("Failed to embed employee signature image:",u),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("âœ“ Digitally Signed",x+5,r+25),t.text(`${s.firstName} ${s.lastName}`,x+2,r+g+7),t.text(`Date: ${this.formatDate(c||new Date)}`,x+2,r+g+11)}else t.setFontSize(8),t.setFont("helvetica","normal"),t.text("_____________________",x+5,r+30),t.text(`${s.firstName} ${s.lastName}`,x+2,r+g+7),t.text("Date: ___________",x+2,r+g+11);return r+g+12}static addDeliverySection(e,t,a,s,r,n,i){if(!t)return a;a=this.checkPageOverflow(e,a,20,n,i),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("DELIVERY INFORMATION",r,a),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let l=a+6;return e.text(`Delivery Method: ${t.method.toUpperCase()}`,r,l),l+=4,e.text(`Delivery Date: ${this.formatDate(t.timestamp)}`,r,l),l+=4,e.text(`Authorized by: ${t.chosenBy}`,r,l),l+8}static addAppealHistorySection(e,t,a,s,r,n,i){a=this.checkPageOverflow(e,a,40,n,i),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(102,45,145),e.text("APPEAL HISTORY",r,a);let l=a+6;if(t.appealDetails){if(e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Employee Appeal Submission",r,l),l+=5,e.setFont("helvetica","normal"),e.setFontSize(9),t.appealDetails.submittedAt&&(e.text(`Submitted: ${this.formatDate(t.appealDetails.submittedAt)}`,r,l),l+=4),t.appealDetails.submittedBy&&(e.text(`Submitted by: ${t.appealDetails.submittedBy}`,r,l),l+=4),t.appealDetails.grounds){e.setFont("helvetica","bold"),e.text("Grounds for Appeal:",r,l),l+=4,e.setFont("helvetica","normal");const a=e.splitTextToSize(t.appealDetails.grounds,s-2*r-5);e.text(a,r+5,l),l+=4*a.length+2}if(t.appealDetails.details){e.setFont("helvetica","bold"),e.text("Additional Details:",r,l),l+=4,e.setFont("helvetica","normal");const a=e.splitTextToSize(t.appealDetails.details,s-2*r-5);e.text(a,r+5,l),l+=4*a.length+2}if(t.appealDetails.requestedOutcome){e.setFont("helvetica","bold"),e.text("Requested Outcome:",r,l),l+=4,e.setFont("helvetica","normal");const a=e.splitTextToSize(t.appealDetails.requestedOutcome,s-2*r-5);e.text(a,r+5,l),l+=4*a.length+4}}if(t.appealOutcome){l=this.checkPageOverflow(e,l,30,n,i),e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("HR Decision",r,l),l+=5,e.setFont("helvetica","normal"),e.setFontSize(9),t.appealDecisionDate&&(e.text(`Decision Date: ${this.formatDate(t.appealDecisionDate)}`,r,l),l+=4),e.setFont("helvetica","bold"),e.text("Outcome: ",r,l);const a="overturned"===t.appealOutcome?"WARNING OVERTURNED":"upheld"===t.appealOutcome?"APPEAL DENIED - WARNING STANDS":"modified"===t.appealOutcome?"WARNING MODIFIED":"reduced"===t.appealOutcome?"WARNING REDUCED":t.appealOutcome.toUpperCase();if("overturned"===t.appealOutcome?e.setTextColor(34,139,34):"upheld"===t.appealOutcome?e.setTextColor(178,34,34):e.setTextColor(255,140,0),e.text(a,r+20,l),e.setTextColor(0,0,0),l+=5,t.appealReasoning){e.setFont("helvetica","bold"),e.text("HR Reasoning:",r,l),l+=4,e.setFont("helvetica","normal");const a=e.splitTextToSize(t.appealReasoning,s-2*r-5);e.text(a,r+5,l),l+=4*a.length+2}if(t.hrNotes){e.setFont("helvetica","bold"),e.text("HR Notes:",r,l),l+=4,e.setFont("helvetica","normal");const a=e.splitTextToSize(t.hrNotes,s-2*r-5);e.text(a,r+5,l),l+=4*a.length+2}if(t.followUpRequired){e.setDrawColor(255,193,7),e.setFillColor(255,248,220),e.roundedRect(r,l,s-2*r,10,2,2,"FD"),e.setFont("helvetica","bold"),e.setTextColor(139,69,19);const a=t.followUpDate?`âš  Follow-up Required by ${this.formatDate(t.followUpDate)}`:"âš  Follow-up Required";e.text(a,r+2,l+6),e.setTextColor(0,0,0),l+=12}}return l+8}static addDocumentFooter(e,t,a){const s=e.internal.pageSize.height,r=e.getNumberOfPages();for(let n=1;n<=r;n++){e.setPage(n),e.setDrawColor(180,180,180),e.setLineWidth(.3),e.line(20,s-25,a-20,s-25),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(120,120,120);const t="This document has been generated electronically and constitutes an official warning as per LRA Section 188.",i=(a-e.getTextWidth(t))/2;e.text(t,i,s-20);const l="CONFIDENTIAL DOCUMENT - For authorized personnel only",o=(a-e.getTextWidth(l))/2;e.text(l,o,s-15),e.text(`Generated: ${(new Date).toLocaleString()}`,20,s-10),e.text(`Page ${n} of ${r}`,a-50,s-10)}}static addSecurityWatermark(e,t){const a=e.internal.pageSize.height,s=e.getNumberOfPages();for(let r=1;r<=s;r++){e.setPage(r),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.1})),e.setTextColor(150,150,150),e.setFontSize(40),e.setFont("helvetica","bold");const s=t/2,n=a/2;e.text("OFFICIAL WARNING",s,n,{angle:45,align:"center"}),e.restoreGraphicsState()}}static addOverturnedWatermark(e,t){const a=e.internal.pageSize.height,s=e.getNumberOfPages();for(let r=1;r<=s;r++){e.setPage(r),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.35})),e.setTextColor(255,0,0),e.setFontSize(60),e.setFont("helvetica","bold");const s=t/2,n=a/2;e.text("OVERTURNED",s,n,{angle:45,align:"center"}),e.restoreGraphicsState()}}static async generateAppealReportPDF(t){try{const{default:a}=await ee(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),s=new a({orientation:"portrait",unit:"mm",format:"a4"}),r=s.internal.pageSize.width,n=s.internal.pageSize.height,i=20;let l=20;if(s.setFillColor(37,99,235),s.rect(0,0,r,40,"F"),s.setTextColor(255,255,255),s.setFontSize(22),s.setFont("helvetica","bold"),s.text("APPEAL DECISION REPORT",r/2,18,{align:"center"}),s.setFontSize(11),s.setFont("helvetica","normal"),s.text(t.organization.name,r/2,28,{align:"center"}),l=50,s.setDrawColor(200,200,200),s.setFillColor(248,248,248),s.roundedRect(i,l,r-2*i,35,3,3,"FD"),s.setTextColor(0,0,0),s.setFontSize(10),s.setFont("helvetica","bold"),s.text("Warning Reference",i+5,l+7),s.setFont("helvetica","normal"),s.setFontSize(9),s.text(`Warning ID: ${t.warningId}`,i+5,l+13),s.text(`Employee: ${t.employee.firstName} ${t.employee.lastName} (${t.employee.employeeNumber})`,i+5,l+18),s.text(`Department: ${t.employee.department}`,i+5,l+23),s.text(`Warning Level: ${t.warningLevel}`,i+5,l+28),s.text(`Original Issue Date: ${this.formatDate(t.issueDate)}`,r-i-60,l+13),s.text(`Category: ${t.category}`,r-i-60,l+18),l+=43,t.appealDetails){if(s.setFontSize(14),s.setFont("helvetica","bold"),s.setTextColor(102,45,145),s.text("1. APPEAL SUBMISSION",i,l),l+=8,s.setFillColor(245,243,255),s.setDrawColor(167,139,250),s.roundedRect(i,l,r-2*i,12,2,2,"FD"),s.setTextColor(0,0,0),s.setFontSize(9),s.setFont("helvetica","bold"),s.text(`Submitted: ${t.appealDetails.submittedAt?this.formatDate(t.appealDetails.submittedAt):"N/A"}`,i+5,l+5),s.text(`By: ${t.appealDetails.submittedBy||"Employee"}`,i+5,l+9),l+=15,t.appealDetails.grounds){s.setFont("helvetica","bold"),s.setFontSize(10),s.text("Grounds for Appeal:",i,l),l+=5,s.setFont("helvetica","normal"),s.setFontSize(9);const e=s.splitTextToSize(t.appealDetails.grounds,r-2*i-10);s.text(e,i+5,l),l+=4*e.length+5}if(t.appealDetails.details){s.setFont("helvetica","bold"),s.setFontSize(10),s.text("Additional Details:",i,l),l+=5,s.setFont("helvetica","normal"),s.setFontSize(9);const e=s.splitTextToSize(t.appealDetails.details,r-2*i-10);s.text(e,i+5,l),l+=4*e.length+5}if(t.appealDetails.requestedOutcome){s.setFont("helvetica","bold"),s.setFontSize(10),s.text("Requested Outcome:",i,l),l+=5,s.setFont("helvetica","normal"),s.setFontSize(9);const e=s.splitTextToSize(t.appealDetails.requestedOutcome,r-2*i-10);s.text(e,i+5,l),l+=4*e.length+8}}if(t.appealOutcome){l>n-100&&(s.addPage(),l=20),s.setFontSize(14),s.setFont("helvetica","bold"),s.setTextColor(102,45,145),s.text("2. HR DECISION",i,l),l+=8,s.setFillColor(245,243,255),s.setDrawColor(167,139,250),s.roundedRect(i,l,r-2*i,8,2,2,"FD"),s.setTextColor(0,0,0),s.setFontSize(9),s.setFont("helvetica","bold"),s.text(`Decision Date: ${t.appealDecisionDate?this.formatDate(t.appealDecisionDate):"Pending"}`,i+5,l+5),l+=12;const e="overturned"===t.appealOutcome?"APPEAL APPROVED - WARNING OVERTURNED":"upheld"===t.appealOutcome?"APPEAL DENIED - WARNING STANDS":"modified"===t.appealOutcome?"APPEAL PARTIALLY APPROVED - WARNING MODIFIED":"reduced"===t.appealOutcome?"APPEAL PARTIALLY APPROVED - WARNING REDUCED":t.appealOutcome.toUpperCase();if("overturned"===t.appealOutcome?s.setFillColor(34,197,94):"upheld"===t.appealOutcome?s.setFillColor(239,68,68):s.setFillColor(251,146,60),s.roundedRect(i,l,r-2*i,15,3,3,"F"),s.setTextColor(255,255,255),s.setFontSize(12),s.setFont("helvetica","bold"),s.text(e,r/2,l+10,{align:"center"}),l+=20,t.appealReasoning){s.setTextColor(0,0,0),s.setFont("helvetica","bold"),s.setFontSize(10),s.text("HR Reasoning:",i,l),l+=5,s.setFont("helvetica","normal"),s.setFontSize(9);const e=s.splitTextToSize(t.appealReasoning,r-2*i-10);s.text(e,i+5,l),l+=4*e.length+5}if(t.hrNotes){s.setFont("helvetica","bold"),s.setFontSize(10),s.text("HR Notes:",i,l),l+=5,s.setFont("helvetica","normal"),s.setFontSize(9);const e=s.splitTextToSize(t.hrNotes,r-2*i-10);s.text(e,i+5,l),l+=4*e.length+5}if(t.followUpRequired){s.setDrawColor(251,191,36),s.setFillColor(254,252,232),s.roundedRect(i,l,r-2*i,12,2,2,"FD"),s.setTextColor(146,64,14),s.setFontSize(10),s.setFont("helvetica","bold");const e=t.followUpDate?`âš  FOLLOW-UP REQUIRED BY: ${this.formatDate(t.followUpDate)}`:"âš  FOLLOW-UP REQUIRED";s.text(e,i+5,l+7),l+=15}}l<n-80?l=n-75:(s.addPage(),l=20),s.setFontSize(10),s.setFont("helvetica","bold"),s.setTextColor(0,0,0),s.text("HR Authorization:",i,l),l+=10,s.setDrawColor(0,0,0),s.line(i,l,i+70,l),s.setFontSize(8),s.setFont("helvetica","normal"),s.text("HR Manager Signature",i,l+5),s.line(r-i-70,l,r-i,l),s.text("Date",r-i-35,l+5);const o=s.getNumberOfPages(),c=n-25;for(let e=1;e<=o;e++){s.setPage(e),s.setDrawColor(180,180,180),s.setLineWidth(.3),s.line(i,c,r-i,c),s.setFontSize(8),s.setFont("helvetica","normal"),s.setTextColor(120,120,120);const t="Official Appeal Decision Report - Confidential HR Document";s.text(t,r/2,c+5,{align:"center"}),s.text(`Generated: ${(new Date).toLocaleString()}`,i,c+10),s.text(`Page ${e} of ${o}`,r-i-20,c+10)}return e.success("âœ… Appeal Report PDF generated"),s.output("blob")}catch(a){throw e.error("âŒ Failed to generate appeal report:",a),console.error("Appeal report generation error details:",a),console.error("Stack trace:",a instanceof Error?a.stack:"No stack trace"),a instanceof Error?a:new Error("Failed to generate appeal report PDF")}}static checkPageOverflow(e,t,a,s,r){return t+a>s-r?(e.addPage(),20):t}static addPageHeader(e,t,a){const s=e.internal.pageSize.width;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const r=`${t.organization.name} - Warning Document (Continued)`;e.text(r,20,10);const n=`Page ${a}`;e.text(n,s-40,10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(20,12,s-20,12)}static renderDynamicSection(e,t,a,s,r,n,i,l,o){if(!t.enabled)return s;const c=30+7*(t.content.bulletPoints?.length||0);s=this.checkPageOverflow(e,s,c,i,l);const d=t.styling?.headingFontSize||o.styling.fontSize+1||12,m=t.styling?.headingColor||o.styling.sectionHeaderColor||"#333333";e.setFontSize(d),e.setFont("helvetica","bold");const g=this.hexToRGB(m);e.setTextColor(g.r,g.g,g.b);const x=at.replacePlaceholders(t.content.heading,a);e.text(x,n,s);let u=s+(t.styling?.spacingBefore||8);if(t.content.body){const s=t.styling?.bodyFontSize||o.styling.fontSize||11,c=t.styling?.bodyColor||o.styling.bodyTextColor||"#000000";e.setFontSize(s),e.setFont("helvetica","normal");const d=this.hexToRGB(c);e.setTextColor(d.r,d.g,d.b);const m=at.replacePlaceholders(t.content.body,a),g=r-2*n-(t.styling?.indent||0);this.wrapText(e,m,g).forEach(a=>{u=this.checkPageOverflow(e,u,6,i,l),e.text(a,n+(t.styling?.indent||0),u),u+=5}),u+=3}if(t.content.bulletPoints&&t.content.bulletPoints.length>0){const s=t.styling?.bodyFontSize||o.styling.fontSize||11;e.setFontSize(s),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);at.replacePlaceholdersInArray(t.content.bulletPoints,a).forEach(a=>{u=this.checkPageOverflow(e,u,10,i,l);const s=`â€¢ ${a}`,o=r-2*n-(t.styling?.indent||0)-5;this.wrapText(e,s,o).forEach((a,s)=>{u=this.checkPageOverflow(e,u,5,i,l);const r=0===s?0:5;e.text(a,n+(t.styling?.indent||0)+r,u),u+=5}),u+=1}),u+=2}return t.content.tableData&&(u=this.renderTableSection(e,t.content.tableData,a,u,r,n,i,l,t.styling)),u+=t.styling?.spacingAfter||5,u}static renderTableSection(e,t,a,s,r,n,i,l,o){let c=s;const d=(r-2*n)/t.headers.length;return e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),t.headers.forEach((t,a)=>{const s=n+a*d;e.text(t,s,c)}),c+=6,e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(n,c,r-n,c),c+=4,e.setFont("helvetica","normal"),t.rows.forEach(t=>{c=this.checkPageOverflow(e,c,8,i,l),t.forEach((t,s)=>{const r=n+s*d,i=at.replacePlaceholders(t,a);e.text(i,r,c)}),c+=6}),c+3}static hexToRGB(e){e=e.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}static getWarningLevelDisplay(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"}[e]||e.replace("_"," ").toUpperCase()}static getWarningLevelTitle(e){return{counselling:"COUNSELLING SESSION RECORD",verbal:"VERBAL WARNING NOTICE",first_written:"FIRST WRITTEN WARNING",second_written:"SECOND WRITTEN WARNING",final_written:"FINAL WRITTEN WARNING",suspension:"SUSPENSION NOTICE",dismissal:"DISMISSAL NOTICE"}[e]||"WARNING NOTICE"}static formatDate(e){let t;return t=e?void 0!==e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:"string"==typeof e||"number"==typeof e?new Date(e):new Date:new Date,t.toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})}static wrapText(e,t,a){const s=t.split(" "),r=[];let n="";return s.forEach(t=>{const s=n+(n?" ":"")+t;e.getTextWidth(s)<=a?n=s:(n&&r.push(n),n=t)}),n&&r.push(n),r}static calculateIncidentSectionHeight(e,t,a,s){let r=25;const n=t.description&&""!==t.description.trim()?t.description:"[Incident description not provided - complete in wizard]";r+=4*this.wrapText(e,n,a-2*s-6).length;const i=t.description&&""!==t.description.trim(),l=t.incidentLocation&&""!==t.incidentLocation.trim();return!i&&!l&&(r+=10),Math.max(r,45)}static parseColor(e){if(!e)return null;if(e.startsWith("#")){const t=e.substring(1);if(6===t.length)return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}return null}static async generateSimplifiedPDF(t){try{const{default:e}=await ee(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),a=new e({orientation:"portrait",unit:"mm",format:"a4",compress:!0});let s=20;const r=15,n=6;a.setFont("helvetica","normal"),a.setFontSize(16),a.text("DISCIPLINARY WARNING",r,s),s+=2*n,a.setFontSize(12),t.organization?.name&&(a.text(`Organization: ${t.organization.name}`,r,s),s+=n),s+=n,a.setFontSize(11),a.text("EMPLOYEE DETAILS:",r,s),s+=n,a.setFontSize(10);[`Name: ${t.employee.firstName} ${t.employee.lastName}`,`Employee ID: ${t.employee.employeeNumber}`,`Department: ${t.employee.department}`,`Position: ${t.employee.position}`].forEach(e=>{a.text(e,r+5,s),s+=n}),s+=n,a.setFontSize(11),a.text("WARNING DETAILS:",r,s),s+=n,a.setFontSize(10);[`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,`Location: ${t.incidentLocation||"Not specified"}`].forEach(e=>{a.text(e,r+5,s),s+=n}),s+=n,a.setFontSize(11),a.text("INCIDENT DESCRIPTION:",r,s),s+=n,a.setFontSize(10);const i=170;a.splitTextToSize(t.description,i).forEach(e=>{s>270&&(a.addPage(),s=20),a.text(e,r+5,s),s+=n}),s+=2*n,s>240&&(a.addPage(),s=20),a.setFontSize(11),a.text("SIGNATURES:",r,s),s+=2*n,a.setFontSize(10),a.text("Manager: ________________________",r,s),s+=n,a.text(`Date: ${t.issuedDate.toLocaleDateString()}`,r,s),s+=3*n,a.text("Employee: _______________________ ",r,s),s+=n,a.text("Date: _______________",r,s);const l=a.internal.pageSize.height;a.setFontSize(8),a.text("Generated by HR System - Simplified for mobile device",r,l-10);const o=a.output("blob");return window.gc&&setTimeout(()=>window.gc(),100),o}catch(a){return e.error("âŒ Simplified PDF generation failed:",a),this.generatePlainTextPDF(t)}}static async generatePlainTextPDF(t){try{const{default:e}=await ee(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),a=new e;a.setFontSize(12);let s=20;const r=10;return["DISCIPLINARY WARNING","",`Employee: ${t.employee.firstName} ${t.employee.lastName}`,`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,"","Description:",t.description,"","This is a simplified version generated for older devices."].forEach(e=>{s>280&&(a.addPage(),s=20),a.text(e,20,s),s+=r}),a.output("blob")}catch(a){throw e.error("âŒ Even plain text PDF failed:",a),new Error("PDF generation not supported on this device")}}}const nt=Object.freeze(Object.defineProperty({__proto__:null,PDFGenerationService:rt,PDF_GENERATOR_VERSION:st},Symbol.toStringTag,{value:"Module"}));class it{static async saveTemplateVersion(t,a,s,r){try{const e=I(n,"organizations",t,"pdfTemplateVersions",a);if((await A(e)).exists())return;const i={version:a,settings:s,activatedAt:new Date,activatedBy:r.activatedBy,reason:r.reason||"Template version saved",...r.previousVersion?{previousVersion:r.previousVersion}:{}};await R(e,i)}catch(i){throw e.error("Failed to save template version:",i),new Error("Failed to save PDF template version")}}static async getTemplateVersion(t,a){try{const s=I(n,"organizations",t,"pdfTemplateVersions",a),r=await A(s);return r.exists()?r.data():(e.warn(`âš ï¸ Template version ${a} not found for ${t}`),null)}catch(s){throw e.error(`Failed to retrieve template version ${a}:`,s),new Error("Failed to retrieve PDF template version")}}static async getCurrentTemplateVersion(t){try{const a=I(n,"organizations",t),s=await A(a);if(!s.exists())return e.error(`Organization ${t} not found`),null;const r=s.data(),i=r.pdfSettings?.generatorVersion;return i?this.getTemplateVersion(t,i):(e.warn(`No current template version found for ${t}`),null)}catch(a){throw e.error("Failed to get current template version:",a),new Error("Failed to retrieve current PDF template version")}}static async ensureTemplateVersionExists(e,t,a){const s=t.generatorVersion||"1.0.0";return await this.saveTemplateVersion(e,s,t,{activatedBy:a,reason:"Template version saved during warning creation"}),s}static async getAllTemplateVersions(t){try{const e=T(n,"organizations",t,"pdfTemplateVersions"),a=F(e,P("activatedAt","desc"));return(await L(a)).docs.map(e=>e.data())}catch(a){throw e.error("Failed to get all template versions:",a),new Error("Failed to retrieve PDF template versions")}}}const lt=t=>{if(!t)return e.warn("âš ï¸ Null timestamp provided to convertFirestoreTimestamp, using current date"),new Date;if(void 0!==t.seconds)return new Date(1e3*t.seconds);if(void 0!==t._seconds)return new Date(1e3*t._seconds);if(t instanceof Date)return t;if("string"==typeof t||"number"==typeof t){const e=new Date(t);if(!isNaN(e.getTime()))return e}return e.warn("âš ï¸ Invalid timestamp format, using current date:",t),new Date},ot=e=>{if(!e)return e;if(Array.isArray(e))return e.map(e=>ot(e));if("object"==typeof e&&!(e instanceof Date)){if(void 0!==e.seconds||void 0!==e._seconds)return lt(e);const t={};for(const a in e)e.hasOwnProperty(a)&&(t[a]=ot(e[a]));return t}return e},ct=t=>t?t.profile||t.employment?{firstName:t.profile?.firstName||t.firstName||"Unknown",lastName:t.profile?.lastName||t.lastName||"Employee",employeeNumber:t.employment?.employeeNumber||t.employeeNumber||t.id||"N/A",department:t.employment?.department||t.profile?.department||t.department||"Unknown",position:t.employment?.position||t.position||"Unknown",email:t.profile?.email||t.email||"",phone:t.profile?.phoneNumber||t.profile?.phone||t.phone||""}:{firstName:t.firstName||"Unknown",lastName:t.lastName||"Employee",employeeNumber:t.employeeNumber||t.employeeId||t.id||"N/A",department:t.department||"Unknown",position:t.position||"Unknown",email:t.email||"",phone:t.phone||t.phoneNumber||""}:(e.warn("âš ï¸ Null employee provided to flattenEmployeeData"),{firstName:"Unknown",lastName:"Employee",employeeNumber:"N/A",department:"Unknown",position:"Unknown"}),dt=async(t,a,s)=>{if(!t)throw new Error("Cannot transform null warning data for PDF");if(!s)throw new Error("Cannot transform warning data without organization data");const r=ct(a),n=lt(t.issueDate||t.issuedDate||t.createdAt),i=lt(t.incidentDate||t.issueDate||t.createdAt);let l;if(t.pdfTemplateVersion&&s.id)try{const a=await it.getTemplateVersion(s.id,t.pdfTemplateVersion);a?(l=a.settings,t.pdfTemplateVersion):(e.warn(`âš ï¸ Template version ${t.pdfTemplateVersion} not found, using current org settings`),l=s.pdfSettings)}catch(c){e.error("âŒ Failed to fetch template version:",c),l=s.pdfSettings}else l=t.pdfSettings||s.pdfSettings||void 0,t.pdfSettings;const o={warningId:t.id||t.warningId||`WRN_${Date.now()}`,organizationId:t.organizationId||s.id,status:t.status||"issued",pdfGeneratorVersion:t.pdfGeneratorVersion||st,pdfSettings:l,issuedByName:t.signatures?.managerName||t.issuedByName||"",issuedDate:n,incidentDate:i,employee:r,warningLevel:t.level||t.warningLevel||"counselling",category:t.category||t.categoryName||"General Misconduct",description:t.description||t.incidentDescription||"",incidentTime:t.incidentTime||"09:00",incidentLocation:t.incidentLocation||"",organization:s,signatures:t.signatures||{},additionalNotes:t.additionalNotes||"",validityPeriod:t.validityPeriod||6,disciplineRecommendation:(()=>{const e=t.disciplineRecommendation||t.lraRecommendation;return ot(e)})(),legalCompliance:t.legalCompliance,deliveryChoice:t.deliveryChoice,appealDetails:t.appealDetails,appealOutcome:t.appealOutcome,appealDecisionDate:t.appealDecisionDate?lt(t.appealDecisionDate):void 0,appealReasoning:t.appealReasoning,hrNotes:t.hrNotes,followUpRequired:t.followUpRequired,followUpDate:t.followUpDate?lt(t.followUpDate):void 0};return o.employee.firstName,o.employee.lastName,o},mt=Object.freeze(Object.defineProperty({__proto__:null,convertAllTimestamps:ot,convertFirestoreTimestamp:lt,flattenEmployeeData:ct,transformWarningDataForPDF:dt},Symbol.toStringTag,{value:"Module"}));var gt,xt,ut=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},pt=function(e){if("loading"===document.readyState)return"loading";var t=ut();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},ht=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},yt=function(e,t){var a="";try{for(;e&&9!==e.nodeType;){var s=e,r=s.id?"#"+s.id:ht(s)+(s.classList&&s.classList.value&&s.classList.value.trim()&&s.classList.value.trim().length?"."+s.classList.value.trim().replace(/\s+/g,"."):"");if(a.length+r.length>(t||100)-1)return a||r;if(a=a?r+">"+a:r,s.id)break;e=s.parentNode}}catch(e){}return a},ft=-1,vt=function(e){addEventListener("pageshow",function(t){t.persisted&&(ft=t.timeStamp,e(t))},!0)},bt=function(){var e=ut();return e&&e.activationStart||0},Nt=function(e,t){var a=ut(),s="navigate";return ft>=0?s="back-forward-cache":a&&(document.prerendering||bt()>0?s="prerender":document.wasDiscarded?s="restore":a.type&&(s=a.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:s}},jt=function(e,t,a){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var s=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})});return s.observe(Object.assign({type:e,buffered:!0},a||{})),s}}catch(e){}},wt=function(e,t,a,s){var r,n;return function(i){t.value>=0&&(i||s)&&((n=t.value-(r||0))||void 0===r)&&(r=t.value,t.delta=n,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,a),e(t))}},Dt=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},St=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},Ct=function(e){var t=!1;return function(){t||(e(),t=!0)}},kt=-1,Et=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},Ft=function(e){"hidden"===document.visibilityState&&kt>-1&&(kt="visibilitychange"===e.type?e.timeStamp:0,Pt())},Tt=function(){addEventListener("visibilitychange",Ft,!0),addEventListener("prerenderingchange",Ft,!0)},Pt=function(){removeEventListener("visibilitychange",Ft,!0),removeEventListener("prerenderingchange",Ft,!0)},_t=function(){return kt<0&&(kt=Et(),Tt(),vt(function(){setTimeout(function(){kt=Et(),Tt()},0)})),{get firstHiddenTime(){return kt}}},It=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},At=[1800,3e3],Rt=[.1,.25],Lt=function(e,t){!function(e,t){t=t||{},function(e,t){t=t||{},It(function(){var a,s=_t(),r=Nt("FCP"),n=jt("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(n.disconnect(),e.startTime<s.firstHiddenTime&&(r.value=Math.max(e.startTime-bt(),0),r.entries.push(e),a(!0)))})});n&&(a=wt(e,r,At,t.reportAllChanges),vt(function(s){r=Nt("FCP"),a=wt(e,r,At,t.reportAllChanges),Dt(function(){r.value=performance.now()-s.timeStamp,a(!0)})}))})}(Ct(function(){var a,s=Nt("CLS",0),r=0,n=[],i=function(e){e.forEach(function(e){if(!e.hadRecentInput){var t=n[0],a=n[n.length-1];r&&e.startTime-a.startTime<1e3&&e.startTime-t.startTime<5e3?(r+=e.value,n.push(e)):(r=e.value,n=[e])}}),r>s.value&&(s.value=r,s.entries=n,a())},l=jt("layout-shift",i);l&&(a=wt(e,s,Rt,t.reportAllChanges),St(function(){i(l.takeRecords()),a(!0)}),vt(function(){r=0,s=Nt("CLS",0),a=wt(e,s,Rt,t.reportAllChanges),Dt(function(){return a()})}),setTimeout(a,0))}))}(function(t){var a=function(e){var t,a={};if(e.entries.length){var s=e.entries.reduce(function(e,t){return e&&e.value>t.value?e:t});if(s&&s.sources&&s.sources.length){var r=(t=s.sources).find(function(e){return e.node&&1===e.node.nodeType})||t[0];r&&(a={largestShiftTarget:yt(r.node),largestShiftTime:s.startTime,largestShiftValue:s.value,largestShiftSource:r,largestShiftEntry:s,loadState:pt(s.startTime)})}}return Object.assign(e,{attribution:a})}(t);e(a)},t)},Mt=0,zt=1/0,Ot=0,$t=function(e){e.forEach(function(e){e.interactionId&&(zt=Math.min(zt,e.interactionId),Ot=Math.max(Ot,e.interactionId),Mt=Ot?(Ot-zt)/7+1:0)})},Wt=function(){return gt?Mt:performance.interactionCount||0},Ut=function(){"interactionCount"in performance||gt||(gt=jt("event",$t,{type:"event",buffered:!0,durationThreshold:0}))},Vt=[],qt=new Map,Bt=0,Ht=[],Gt=function(e){if(Ht.forEach(function(t){return t(e)}),e.interactionId||"first-input"===e.entryType){var t=Vt[Vt.length-1],a=qt.get(e.interactionId);if(a||Vt.length<10||e.duration>t.latency){if(a)e.duration>a.latency?(a.entries=[e],a.latency=e.duration):e.duration===a.latency&&e.startTime===a.entries[0].startTime&&a.entries.push(e);else{var s={id:e.interactionId,latency:e.duration,entries:[e]};qt.set(s.id,s),Vt.push(s)}Vt.sort(function(e,t){return t.latency-e.latency}),Vt.length>10&&Vt.splice(10).forEach(function(e){return qt.delete(e.id)})}}},Yt=function(e){var t=self.requestIdleCallback||self.setTimeout,a=-1;return e=Ct(e),"hidden"===document.visibilityState?e():(a=t(e),St(e)),a},Kt=[200,500],Jt=function(e,t){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(t=t||{},It(function(){var a;Ut();var s,r=Nt("INP"),n=function(e){Yt(function(){e.forEach(Gt);var t=function(){var e=Math.min(Vt.length-1,Math.floor((Wt()-Bt)/50));return Vt[e]}();t&&t.latency!==r.value&&(r.value=t.latency,r.entries=t.entries,s())})},i=jt("event",n,{durationThreshold:null!==(a=t.durationThreshold)&&void 0!==a?a:40});s=wt(e,r,Kt,t.reportAllChanges),i&&(i.observe({type:"first-input",buffered:!0}),St(function(){n(i.takeRecords()),s(!0)}),vt(function(){Bt=Wt(),Vt.length=0,qt.clear(),r=Nt("INP"),s=wt(e,r,Kt,t.reportAllChanges)}))}))},Qt=[],Zt=[],Xt=0,ea=new WeakMap,ta=new Map,aa=-1,sa=function(e){Qt=Qt.concat(e),ra()},ra=function(){aa<0&&(aa=Yt(na))},na=function(){ta.size>10&&ta.forEach(function(e,t){qt.has(t)||ta.delete(t)});var e=Vt.map(function(e){return ea.get(e.entries[0])}),t=Zt.length-50;Zt=Zt.filter(function(a,s){return s>=t||e.includes(a)});for(var a=new Set,s=0;s<Zt.length;s++){var r=Zt[s];ia(r.startTime,r.processingEnd).forEach(function(e){a.add(e)})}var n=Qt.length-1-50;Qt=Qt.filter(function(e,t){return e.startTime>Xt&&t>n||a.has(e)}),aa=-1};Ht.push(function(e){e.interactionId&&e.target&&!ta.has(e.interactionId)&&ta.set(e.interactionId,e.target)},function(e){var t,a=e.startTime+e.duration;Xt=Math.max(Xt,e.processingEnd);for(var s=Zt.length-1;s>=0;s--){var r=Zt[s];if(Math.abs(a-r.renderTime)<=8){(t=r).startTime=Math.min(e.startTime,t.startTime),t.processingStart=Math.min(e.processingStart,t.processingStart),t.processingEnd=Math.max(e.processingEnd,t.processingEnd),t.entries.push(e);break}}t||(t={startTime:e.startTime,processingStart:e.processingStart,processingEnd:e.processingEnd,renderTime:a,entries:[e]},Zt.push(t)),(e.interactionId||"first-input"===e.entryType)&&ea.set(e,t),ra()});var ia=function(e,t){for(var a,s=[],r=0;a=Qt[r];r++)if(!(a.startTime+a.duration<e)){if(a.startTime>t)break;s.push(a)}return s},la=function(e,t){xt||(xt=jt("long-animation-frame",sa)),Jt(function(t){var a=function(e){var t=e.entries[0],a=ea.get(t),s=t.processingStart,r=a.processingEnd,n=a.entries.sort(function(e,t){return e.processingStart-t.processingStart}),i=ia(t.startTime,r),l=e.entries.find(function(e){return e.target}),o=l&&l.target||ta.get(t.interactionId),c=[t.startTime+t.duration,r].concat(i.map(function(e){return e.startTime+e.duration})),d=Math.max.apply(Math,c),m={interactionTarget:yt(o),interactionTargetElement:o,interactionType:t.name.startsWith("key")?"keyboard":"pointer",interactionTime:t.startTime,nextPaintTime:d,processedEventEntries:n,longAnimationFrameEntries:i,inputDelay:s-t.startTime,processingDuration:r-s,presentationDelay:Math.max(d-r,0),loadState:pt(t.startTime)};return Object.assign(e,{attribution:m})}(t);e(a)},t)},oa=[2500,4e3],ca={},da=function(e,t){!function(e,t){t=t||{},It(function(){var a,s=_t(),r=Nt("LCP"),n=function(e){t.reportAllChanges||(e=e.slice(-1)),e.forEach(function(e){e.startTime<s.firstHiddenTime&&(r.value=Math.max(e.startTime-bt(),0),r.entries=[e],a())})},i=jt("largest-contentful-paint",n);if(i){a=wt(e,r,oa,t.reportAllChanges);var l=Ct(function(){ca[r.id]||(n(i.takeRecords()),i.disconnect(),ca[r.id]=!0,a(!0))});["keydown","click"].forEach(function(e){addEventListener(e,function(){return Yt(l)},{once:!0,capture:!0})}),St(l),vt(function(s){r=Nt("LCP"),a=wt(e,r,oa,t.reportAllChanges),Dt(function(){r.value=performance.now()-s.timeStamp,ca[r.id]=!0,a(!0)})})}})}(function(t){var a=function(e){var t={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:e.value};if(e.entries.length){var a=ut();if(a){var s=a.activationStart||0,r=e.entries[e.entries.length-1],n=r.url&&performance.getEntriesByType("resource").filter(function(e){return e.name===r.url})[0],i=Math.max(0,a.responseStart-s),l=Math.max(i,n?(n.requestStart||n.startTime)-s:0),o=Math.max(l,n?n.responseEnd-s:0),c=Math.max(o,r.startTime-s);t={element:yt(r.element),timeToFirstByte:i,resourceLoadDelay:l-i,resourceLoadDuration:o-l,elementRenderDelay:c-o,navigationEntry:a,lcpEntry:r},r.url&&(t.url=r.url),n&&(t.lcpResourceEntry=n)}}return Object.assign(e,{attribution:t})}(t);e(a)},t)};const ma="@firebase/performance",ga="0.7.7",xa=ga,ua="FB-PERF-TRACE-MEASURE",pa="_wt_",ha="_fcp",ya="_fid",fa="_lcp",va="_inp",ba="_cls",Na="@firebase/performance/config",ja="@firebase/performance/configexpire",wa="Performance",Da=new U("performance",wa,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),Sa=new M(wa);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let Ca,ka,Ea,Fa;Sa.logLevel=z.INFO;class Ta{constructor(e){if(this.window=e,!e)throw Da.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay),this.onLCP=da,this.onINP=la,this.onCLS=Lt}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,a){this.performance&&this.performance.measure&&this.performance.measure(e,t,a)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&q()?!!B()||(Sa.info("IndexedDB is not supported by current browser"),!1):(Sa.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(e=>{for(const a of e.getEntries())t(a)}).observe({entryTypes:[e]})}static getInstance(){return void 0===Ca&&(Ca=new Ta(ka)),Ca}}function Pa(){return Ea}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function _a(e,t){const a=e.length-t.length;if(a<0||a>1)throw Da.create("invalid String merger input");const s=[];for(let r=0;r<e.length;r++)s.push(e.charAt(r)),t.length>r&&s.push(t.charAt(r));return s.join("")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ia{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=_a("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=_a("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===Fa&&(Fa=new Ia),Fa}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Aa;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(Aa||(Aa={}));const Ra=["firebase_","google_","ga_"],La=new RegExp("^[a-zA-Z]\\w*$");function Ma(){const e=Ta.getInstance().navigator;return(null==e?void 0:e.serviceWorker)?e.serviceWorker.controller?2:3:1}function za(){switch(Ta.getInstance().document.visibilityState){case"visible":return Aa.VISIBLE;case"hidden":return Aa.HIDDEN;default:return Aa.UNKNOWN}}function Oa(){const e=Ta.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $a(e){var t;const a=null===(t=e.options)||void 0===t?void 0:t.appId;if(!a)throw Da.create("no app id");return a}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Wa="0.0.1",Ua={loggingEnabled:!0},Va="FIREBASE_INSTALLATIONS_AUTH";function qa(e,t){const a=function(){const e=Ta.getInstance().localStorage;if(!e)return;const t=e.getItem(ja);if(!(t&&(a=t,Number(a)>Date.now())))return;var a;const s=e.getItem(Na);if(!s)return;try{return JSON.parse(s)}catch(r){return}}();return a?(Ha(a),Promise.resolve()):function(e,t){return function(e){const t=e.getToken();return t.then(e=>{}),t}(e.installations).then(a=>{const s=function(e){var t;const a=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!a)throw Da.create("no project id");return a}(e.app),r=function(e){var t;const a=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!a)throw Da.create("no api key");return a}(e.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${s}/namespaces/fireperf:fetch?key=${r}`,{method:"POST",headers:{Authorization:`${Va} ${a}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:a,app_id:$a(e.app),app_version:xa,sdk_version:Wa})});return fetch(n).then(e=>{if(e.ok)return e.json();throw Da.create("RC response not ok")})}).catch(()=>{Sa.info(Ba)})}(e,t).then(Ha).then(e=>function(e){const t=Ta.getInstance().localStorage;if(!e||!t)return;t.setItem(Na,JSON.stringify(e)),t.setItem(ja,String(Date.now()+60*Ia.getInstance().configTimeToLive*60*1e3))}(e),()=>{})}const Ba="Could not fetch config, will use default configs";function Ha(e){if(!e)return e;const t=Ia.getInstance(),a=e.entries||{};return void 0!==a.fpr_enabled?t.loggingEnabled="true"===String(a.fpr_enabled):t.loggingEnabled=Ua.loggingEnabled,a.fpr_log_source?t.logSource=Number(a.fpr_log_source):Ua.logSource&&(t.logSource=Ua.logSource),a.fpr_log_endpoint_url?t.logEndPointUrl=a.fpr_log_endpoint_url:Ua.logEndPointUrl&&(t.logEndPointUrl=Ua.logEndPointUrl),a.fpr_log_transport_key?t.transportKey=a.fpr_log_transport_key:Ua.transportKey&&(t.transportKey=Ua.transportKey),void 0!==a.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(a.fpr_vc_network_request_sampling_rate):void 0!==Ua.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=Ua.networkRequestsSamplingRate),void 0!==a.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(a.fpr_vc_trace_sampling_rate):void 0!==Ua.tracesSamplingRate&&(t.tracesSamplingRate=Ua.tracesSamplingRate),t.logTraceAfterSampling=Ga(t.tracesSamplingRate),t.logNetworkAfterSampling=Ga(t.networkRequestsSamplingRate),e}function Ga(e){return Math.random()<=e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ya,Ka=1;function Ja(e){return Ka=2,Ya=Ya||function(e){return function(){const e=Ta.getInstance().document;return new Promise(t=>{if(e&&"complete"!==e.readyState){const a=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",a),t())};e.addEventListener("readystatechange",a)}else t()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{Ea=e}),t}(e.installations)).then(t=>qa(e,t)).then(()=>Qa(),()=>Qa())}(e),Ya}function Qa(){Ka=3}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Za,Xa=3,es=[],ts=!1;function as(e){setTimeout(()=>{Xa<=0||(es.length>0&&ss(),as(1e4))},e)}function ss(){const e=es.splice(0,1e3),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)}));(function(e){const t=Ia.getInstance().getFlTransportFullUrl(),a=JSON.stringify(e);return navigator.sendBeacon&&navigator.sendBeacon(t,a)?Promise.resolve():fetch(t,{method:"POST",body:a,keepalive:!0}).then()})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Ia.getInstance().logSource,log_event:t}).then(()=>{Xa=3}).catch(()=>{es=[...e,...es],Xa--,Sa.info(`Tries left: ${Xa}.`),as(1e4)})}function rs(e){return(...t)=>{!function(e){if(!e.eventTime||!e.message)throw Da.create("invalid cc log");es=[...es,e]}({message:e(...t),eventTime:Date.now()})}}function ns(){for(;es.length>0;)ss()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function is(e,t){Za||(Za={send:rs(cs),flush:ns}),Za.send(e,t)}function ls(e){const t=Ia.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&Ta.getInstance().requiredApisAvailable()&&(3===Ka?os(e):Ja(e.performanceController).then(()=>os(e),()=>os(e)))}function os(e){if(!Pa())return;const t=Ia.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&is(e,1)}function cs(e,t){return 0===t?function(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},a={application_info:ds(e.performanceController.app),network_request_metric:t};return JSON.stringify(a)}(e):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const a=e.getAttributes();0!==Object.keys(a).length&&(t.custom_attributes=a);const s={application_info:ds(e.performanceController.app),trace_metric:t};return JSON.stringify(s)}(e)}function ds(e){return{google_app_id:$a(e),app_instance_id:Pa(),web_app_info:{sdk_version:xa,page_url:Ta.getInstance().getUrl(),service_worker_status:Ma(),visibility_state:za(),effective_connection_type:Oa()},application_process_state:0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ms(e,t){const a=t;if(!a||void 0===a.responseStart)return;const s=Ta.getInstance().getTimeOrigin(),r=Math.floor(1e3*(a.startTime+s)),n=a.responseStart?Math.floor(1e3*(a.responseStart-a.startTime)):void 0,i=Math.floor(1e3*(a.responseEnd-a.startTime));!function(e){const t=Ia.getInstance();if(!t.instrumentationEnabled)return;const a=e.url,s=t.logEndPointUrl.split("?")[0],r=t.flTransportEndpointUrl.split("?")[0];a!==s&&a!==r&&t.loggingEnabled&&t.logNetworkAfterSampling&&is(e,0)}({performanceController:e,url:a.name&&a.name.split("?")[0],responsePayloadBytes:a.transferSize,startTimeUs:r,timeToResponseInitiatedUs:n,timeToResponseCompletedUs:i})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gs=["_fp",ha,ya,fa,ba,va];
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class xs{constructor(e,t,a=!1,s){this.performanceController=e,this.name=t,this.isAuto=a,this.state=1,this.customAttributes={},this.counters={},this.api=Ta.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=s||`${ua}-${this.randomId}-${this.name}`,s&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw Da.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw Da.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),ls(this)}record(e,t,a){if(e<=0)throw Da.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Da.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),a&&a.attributes&&(this.customAttributes=Object.assign({},a.attributes)),a&&a.metrics)for(const s of Object.keys(a.metrics))isNaN(Number(a.metrics[s]))||(this.counters[s]=Math.floor(Number(a.metrics[s])));ls(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(!function(e,t){return!(0===e.length||e.length>100)&&(t&&t.startsWith(pa)&&gs.indexOf(e)>-1||!e.startsWith("_"))}(e,this.name))throw Da.create("invalid custom metric name",{customMetricName:e});this.counters[e]=function(e){const t=Math.floor(e);return t<e&&Sa.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}(null!=t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const a=function(e){return!(0===e.length||e.length>40)&&(!Ra.some(t=>e.startsWith(t))&&!!e.match(La))}(e),s=function(e){return 0!==e.length&&e.length<=100}(t);if(a&&s)this.customAttributes[e]=t;else{if(!a)throw Da.create("invalid attribute name",{attributeName:e});if(!s)throw Da.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,a,s,r){const n=Ta.getInstance().getUrl();if(!n)return;const i=new xs(e,pa+n,!0),l=Math.floor(1e3*Ta.getInstance().getTimeOrigin());i.setStartTime(l),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));if(a){const e=a.find(e=>"first-paint"===e.name);e&&e.startTime&&i.putMetric("_fp",Math.floor(1e3*e.startTime));const t=a.find(e=>"first-contentful-paint"===e.name);t&&t.startTime&&i.putMetric(ha,Math.floor(1e3*t.startTime)),r&&i.putMetric(ya,Math.floor(1e3*r))}this.addWebVitalMetric(i,fa,"lcp_element",s.lcp),this.addWebVitalMetric(i,ba,"cls_largestShiftTarget",s.cls),this.addWebVitalMetric(i,va,"inp_interactionTarget",s.inp),ls(i),Za&&Za.flush()}static addWebVitalMetric(e,t,a,s){s&&(e.putMetric(t,Math.floor(1e3*s.value)),s.elementAttribution&&e.putAttribute(a,s.elementAttribution))}static createUserTimingTrace(e,t){ls(new xs(e,t,!1,t))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let us,ps={},hs=!1;function ys(e){Pa()&&(setTimeout(()=>function(e){const t=Ta.getInstance();"onpagehide"in window?t.document.addEventListener("pagehide",()=>vs(e)):t.document.addEventListener("unload",()=>vs(e));t.document.addEventListener("visibilitychange",()=>{"hidden"===t.document.visibilityState&&vs(e)}),t.onFirstInputDelay&&t.onFirstInputDelay(e=>{us=e});t.onLCP(e=>{var t;ps.lcp={value:e.value,elementAttribution:null===(t=e.attribution)||void 0===t?void 0:t.element}}),t.onCLS(e=>{var t;ps.cls={value:e.value,elementAttribution:null===(t=e.attribution)||void 0===t?void 0:t.largestShiftTarget}}),t.onINP(e=>{var t;ps.inp={value:e.value,elementAttribution:null===(t=e.attribution)||void 0===t?void 0:t.interactionTarget}})}(e),0),setTimeout(()=>function(e){const t=Ta.getInstance(),a=t.getEntriesByType("resource");for(const s of a)ms(e,s);t.setupObserver("resource",t=>ms(e,t))}(e),0),setTimeout(()=>function(e){const t=Ta.getInstance(),a=t.getEntriesByType("measure");for(const s of a)fs(e,s);t.setupObserver("measure",t=>fs(e,t))}(e),0))}function fs(e,t){const a=t.name;a.substring(0,21)!==ua&&xs.createUserTimingTrace(e,a)}function vs(e){if(!hs){hs=!0;const t=Ta.getInstance(),a=t.getEntriesByType("navigation"),s=t.getEntriesByType("paint");setTimeout(()=>{xs.createOobTrace(e,a,s,ps,us)},0)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Ta.getInstance().requiredApisAvailable()?V().then(e=>{e&&(ts||(as(5500),ts=!0),Ja(this).then(()=>ys(this),()=>ys(this)),this.initialized=!0)}).catch(e=>{Sa.info(`Environment doesn't support IndexedDB: ${e}`)}):Sa.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){Ia.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return Ia.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){Ia.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return Ia.getInstance().dataCollectionEnabled}}const Ns=(e,{options:t})=>{const a=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==a.name)throw Da.create("FB not default");if("undefined"==typeof window)throw Da.create("no window");!function(e){ka=e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(window);const r=new bs(a,s);return r._init(t),r};O(new $("performance",Ns,"PUBLIC")),W(ma,ga),W(ma,ga,"esm2017");let js=null,ws=!1;function Ds(){try{js=function(e=H()){return e=G(e),Y(e,"performance").getImmediate()}(l),ws=!0}catch(t){e.error("âŒ [PERFORMANCE] Failed to initialize:",t)}}function Ss(e){return ws&&js?function(e,t){return e=G(e),new xs(e,t)}(js,e):{start:()=>{},stop:()=>{},putAttribute:()=>{},putMetric:()=>{},incrementMetric:()=>{},getAttribute:()=>null,getMetric:()=>0}}const Cs="generate_warning_pdf",ks=({isOpen:t,onClose:a,warningData:s,deliveryChoice:r,onPDFGenerated:n,showPreview:i=!0,title:l="Warning Document"})=>{const{organization:g}=o();c(t);const[x,u]=C.useState(null),[p,h]=C.useState(null),[y,f]=C.useState(""),[v,b]=C.useState(!1),[N,j]=C.useState(null),[w,D]=C.useState(""),[S,k]=C.useState(!1);C.useEffect(()=>{const e=()=>k(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const E=C.useMemo(()=>{if(!s||!g)return null;const e=s.wizardState||s,t=e.selectedEmployee||s.selectedEmployee||s.employee,a=e.selectedCategory||s.selectedCategory,r=e.formData||s.formData||{};return{wizardState:e,selectedEmployee:t,selectedCategory:a,formData:r,signatures:e.signatures||s.signatures||{},lraRecommendation:e.lraRecommendation||s.lraRecommendation,employee:{firstName:t?.profile?.firstName||t?.firstName||"Unknown",lastName:t?.profile?.lastName||t?.lastName||"Employee"},category:a?.name||r.category||"General Misconduct",description:r.incidentDescription||r.description||"",incidentLocation:r.incidentLocation||"",additionalNotes:r.additionalNotes||"",isComplete:!(!t||!a||!r.incidentDescription&&!r.description)}},[s,r,g]),F=C.useMemo(()=>{if(!E)return"Warning_Document.pdf";const e=`${E.employee.firstName}_${E.employee.lastName}`,t=(new Date).toISOString().split("T")[0];return`Warning_${(E.category||"Warning").replace(/\s+/g,"_").substring(0,20)}_${e}_${t}.pdf`},[E]),T=C.useCallback(async()=>{if(!E||!g)return void j("Missing required data for PDF generation");if(!(E.description||E.incidentLocation||E.additionalNotes))return void j("Insufficient incident data. Please complete the form first.");b(!0),j(null);const t=["Preparing document...","Applying branding...","Formatting content...","Finalizing PDF..."];try{for(let e=0;e<t.length;e++)D(t[e]),await new Promise(e=>setTimeout(e,400));const a={id:E.formData.id||E.formData.warningId||`WRN_${Date.now()}`,organizationId:E.wizardState.organizationId||s.organizationId,level:E.formData.level||E.lraRecommendation?.suggestedLevel||"counselling",category:E.selectedCategory?.name||E.formData.category||"General Misconduct",description:E.formData.incidentDescription||E.formData.description||"",incidentDate:E.formData.incidentDate,incidentTime:E.formData.incidentTime||"09:00",incidentLocation:E.formData.incidentLocation||"",issueDate:E.formData.issueDate||E.formData.issuedDate,validityPeriod:E.formData.validityPeriod||6,signatures:E.signatures,additionalNotes:E.formData.additionalNotes||"",status:E.formData.status,disciplineRecommendation:E.lraRecommendation,pdfTemplateVersion:E.formData.pdfTemplateVersion||s.pdfTemplateVersion,pdfGeneratorVersion:E.formData.pdfGeneratorVersion||s.pdfGeneratorVersion,legalCompliance:{isCompliant:!0,framework:"LRA Section 188",requirements:E.lraRecommendation?.legalRequirements||[]},deliveryChoice:r?{method:r.method,timestamp:new Date,chosenBy:"Manager",contactDetails:r.contactDetails}:void 0},i=await dt(a,E.selectedEmployee,g),{PDFGenerationService:l}=await ee(async()=>{const{PDFGenerationService:e}=await Promise.resolve().then(()=>nt);return{PDFGenerationService:e}},void 0),o=await async function(e,t,a){const s=Ss(e);try{s.start(),a&&Object.entries(a).forEach(([e,t])=>{s.putAttribute(e,t)});const e=await t();return s.stop(),e}catch(N){throw s.putAttribute("error","true"),s.stop(),N}}(Cs,()=>l.generateWarningPDF(i,i.pdfGeneratorVersion,i.pdfSettings),{employee:`${i.employee.firstName} ${i.employee.lastName}`,category:i.category,pdfGeneratorVersion:i.pdfGeneratorVersion});u(o),f(F);const c=URL.createObjectURL(o);h(c),e.success("âœ… PDF generated:",{employee:`${i.employee.firstName} ${i.employee.lastName}`,size:`${(o.size/1024).toFixed(1)} KB`}),n&&await n(o,F)}catch(a){e.error("âŒ PDF generation failed:",a),j(`Failed to generate PDF: ${a instanceof Error?a.message:"Unknown error"}`)}finally{b(!1),D("")}},[E,g,F,r,n,s]);C.useCallback(()=>{if(!x||!y)return;const t=URL.createObjectURL(x),a=document.createElement("a");a.href=t,a.download=y,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),e.success("ðŸ“¥ PDF downloaded successfully")},[x,y]);const P=C.useCallback(()=>{p&&window.open(p,"_blank")},[p]),_=C.useRef(!1);return C.useEffect(()=>{t&&E&&E.isComplete&&!x&&!v&&!_.current&&(_.current=!0,T()),t||(_.current=!1)},[t,E,x,v,T]),C.useEffect(()=>{t&&window.scrollTo({top:0,behavior:"smooth"})},[t]),C.useEffect(()=>()=>{p&&URL.revokeObjectURL(p)},[p]),t?S?d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:m.modal},onClick:a,children:d.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[d.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between flex-shrink-0",children:[d.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:l}),d.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:d.jsx(te,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[N&&d.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded-r-lg",children:[d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(ae,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),d.jsx("p",{className:"text-sm text-red-700 mt-1",children:N})]})]}),d.jsxs("button",{onClick:T,className:"mt-2 text-sm text-red-700 hover:text-red-900 font-medium flex items-center gap-1",children:[d.jsx(se,{className:"w-4 h-4"}),"Retry"]})]}),v&&d.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(re,{className:"w-6 h-6 text-blue-600 animate-spin"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-blue-800 font-medium",children:"Generating PDF"}),w&&d.jsx("p",{className:"text-blue-600 text-sm",children:w})]})]})}),E&&!E.isComplete&&!v&&d.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(ae,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-sm font-semibold text-amber-800 mb-2",children:"Incomplete Warning Data"}),d.jsxs("div",{className:"text-sm text-amber-700 space-y-1",children:[!E.hasEmployee&&d.jsx("p",{children:"â€¢ Employee not selected"}),!E.hasCategory&&d.jsx("p",{children:"â€¢ Category not selected"}),!E.description&&d.jsx("p",{children:"â€¢ Incident description missing"})]}),d.jsx("p",{className:"text-sm text-amber-800 mt-3 font-medium",children:"Please complete the warning wizard before generating the PDF."})]})]}),d.jsx("button",{onClick:a,className:"mt-3 w-full bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors font-medium",children:"Return to Wizard"})]}),x&&!v&&E&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0",children:d.jsx(ne,{className:"w-5 h-5 text-green-600"})}),d.jsxs("div",{className:"flex-1 min-w-0",children:[d.jsxs("h3",{className:"font-semibold text-gray-900 text-base mb-1",children:[E.employee.firstName," ",E.employee.lastName]}),d.jsx("p",{className:"text-sm text-gray-600 mb-2",children:E.category}),d.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[d.jsx(ne,{className:"w-3 h-3"}),d.jsx("span",{className:"truncate",children:y})]}),d.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(x.size/1024).toFixed(1)," KB"]})]}),d.jsx(ie,{className:"w-6 h-6 text-green-600 flex-shrink-0"})]})}),d.jsx("div",{className:"space-y-3",children:d.jsxs("button",{onClick:P,className:"w-full flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium",style:{minHeight:"48px"},children:[d.jsx(le,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm",children:"Open in New Tab"})]})})]}),!E&&!v&&d.jsxs("div",{className:"text-center py-8",children:[d.jsx(ne,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No Data Available"}),d.jsx("p",{className:"text-gray-500 mb-4",children:"Complete the warning wizard first."}),d.jsx("button",{onClick:a,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Wizard"})]})]})]})})}):d.jsx(d.Fragment,{children:d.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:m.modal},children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full h-[90vh] overflow-hidden flex",children:[d.jsxs("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[d.jsxs("div",{className:"p-6 border-b border-gray-200",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[d.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center",children:d.jsx(oe,{className:"w-5 h-5 text-white"})}),d.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:l})]}),E&&d.jsxs("div",{className:"mt-3",children:[d.jsxs("p",{className:"font-medium text-gray-900 text-base",children:[E.employee.firstName," ",E.employee.lastName]}),d.jsx("p",{className:"text-sm text-gray-600",children:E.category})]})]}),d.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[N&&d.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded-r-lg",children:[d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(ae,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),d.jsx("p",{className:"text-xs text-red-700 mt-1",children:N})]})]}),d.jsxs("button",{onClick:T,className:"mt-2 text-sm text-red-700 hover:text-red-900 font-medium flex items-center gap-1",children:[d.jsx(se,{className:"w-4 h-4"}),"Retry"]})]}),v&&d.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(re,{className:"w-5 h-5 text-blue-600 animate-spin flex-shrink-0 mt-0.5"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-blue-800 font-medium text-sm",children:"Generating PDF"}),w&&d.jsx("p",{className:"text-blue-600 text-xs mt-1",children:w})]})]})}),E&&!E.isComplete&&!v&&d.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-3 rounded-r-lg",children:d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(ae,{className:"w-5 h-5 text-amber-400 flex-shrink-0"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-sm font-semibold text-amber-800 mb-2",children:"Incomplete Data"}),d.jsxs("div",{className:"text-xs text-amber-700 space-y-1",children:[!E.hasEmployee&&d.jsx("p",{children:"â€¢ No employee selected"}),!E.hasCategory&&d.jsx("p",{children:"â€¢ No category selected"}),!E.description&&d.jsx("p",{children:"â€¢ No incident description"})]}),d.jsx("p",{className:"text-xs text-amber-800 mt-2 font-medium",children:"Complete the wizard first."})]})]})}),x&&!v&&d.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[d.jsx(ie,{className:"w-5 h-5 text-green-600"}),d.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:"Ready to Download"})]}),d.jsxs("div",{className:"space-y-1",children:[d.jsx("p",{className:"text-xs text-gray-600 truncate",title:y,children:y}),d.jsxs("p",{className:"text-xs text-gray-500",children:[(x.size/1024).toFixed(1)," KB"]})]})]}),x&&!v&&d.jsx("div",{className:"space-y-3 pt-2",children:d.jsxs("button",{onClick:P,className:"w-full flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[d.jsx(le,{className:"w-4 h-4"}),d.jsx("span",{children:"Open in New Tab"})]})})]}),d.jsx("div",{className:"p-6 border-t border-gray-200",children:d.jsx("button",{onClick:a,className:"w-full px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Close"})})]}),d.jsxs("div",{className:"flex-1 bg-gray-50 flex flex-col",children:[d.jsx("div",{className:"p-4 flex justify-end",children:d.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5"})})}),d.jsx("div",{className:"flex-1 p-6 pt-0",children:p&&i?d.jsx("div",{className:"h-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:d.jsx("iframe",{src:p,className:"w-full h-full border-0",title:"PDF Preview"})}):v?d.jsx("div",{className:"h-full flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx(re,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600",children:"Generating preview..."})]})}):d.jsx("div",{className:"h-full flex items-center justify-center",children:d.jsxs("div",{className:"text-center",children:[d.jsx(ne,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-500",children:"No preview available"})]})})})]})]})})}):null},Es=({notification:t,currentStep:a,onStepComplete:s,onDeliveryComplete:r,isProcessing:n})=>{const[i,l]=C.useState(!1),[o,c]=C.useState(!1),[m,p]=C.useState(!1),[h,y]=C.useState(null),[f,v]=C.useState(null),[b,N]=C.useState(!1),[j,w]=C.useState(!1),D=C.useCallback(()=>{const e=t.contactDetails.phone||t.employeePhone||"",a=e.replace(/[^\d]/g,"");return{message:`Hi ${t.employeeName},\n\nI hope this message finds you well. I'm writing to inform you that we need to discuss a ${t.warningLevel.toLowerCase()} regarding ${t.warningCategory.toLowerCase()}.\n\nI've attached the formal warning document for your review. Please read through it carefully and let me know if you have any questions or would like to schedule a meeting to discuss this matter further.\n\nThis is an important workplace matter that requires your immediate attention. Please confirm receipt of this message and the attached document.\n\nThank you for your cooperation.\n\nBest regards,\nHR Department`,phoneNumber:a,formattedPhone:e}},[t])();return d.jsxs("div",{className:"space-y-6",children:[0===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-green-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:d.jsx(ce,{className:"w-5 h-5 text-green-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Prepare WhatsApp Message"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Copy the pre-written script and download the PDF attachment"})]})]}),d.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx(de,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee Phone Number:"})]}),d.jsx("div",{className:"text-lg font-semibold text-gray-900",children:D.formattedPhone||d.jsxs("span",{className:"text-red-500 text-sm",children:[d.jsx(ae,{className:"w-4 h-4 inline mr-1"}),"No phone number on file"]})})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"WhatsApp Message Script:"}),d.jsxs("div",{className:"relative",children:[d.jsx("textarea",{value:D.message,readOnly:!0,className:"w-full h-48 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono resize-none",style:{color:"var(--color-text)"}}),d.jsx(x,{variant:i?"success":"primary",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(D.message),l(!0),setTimeout(()=>l(!1),3e3)}catch(t){e.error("Failed to copy script:",t)}},className:"absolute top-2 right-2",children:i?d.jsxs(d.Fragment,{children:[d.jsx(me,{className:"w-4 h-4 mr-1"}),"Copied!"]}):d.jsxs(d.Fragment,{children:[d.jsx(ge,{className:"w-4 h-4 mr-1"}),"Copy Script"]})})]})]}),d.jsxs("div",{className:"mb-6 space-y-3",children:[d.jsxs("div",{className:"flex gap-3",children:[d.jsxs(x,{variant:"secondary",onClick:()=>{w(!0)},className:"flex items-center gap-2",children:[d.jsx(xe,{className:"w-4 h-4"}),"Preview & Download PDF"]}),o&&d.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[d.jsx(ie,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:"PDF Downloaded"})]})]}),d.jsx("p",{className:"text-xs text-gray-500",children:"Use the preview to download the PDF, then attach it to your WhatsApp message"})]}),d.jsxs("div",{className:"space-y-2 mb-6",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm "+(i?"text-green-600":"text-gray-500"),children:[i?d.jsx(ie,{className:"w-4 h-4"}):d.jsx(ue,{className:"w-4 h-4"}),"Script copied to clipboard"]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm "+(o?"text-green-600":"text-gray-500"),children:[o?d.jsx(ie,{className:"w-4 h-4"}):d.jsx(ue,{className:"w-4 h-4"}),"PDF downloaded for attachment"]})]}),d.jsx(x,{variant:"primary",onClick:()=>{i&&o&&s(0)},disabled:!i||!o,className:"w-full",children:i&&o?d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Continue to Send Message"]}):d.jsxs(d.Fragment,{children:[d.jsx(ue,{className:"w-4 h-4 mr-2"}),"Complete preparation steps above"]})})]}),1===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:d.jsx(le,{className:"w-5 h-5 text-blue-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Send via WhatsApp"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Open WhatsApp Web and send the message with PDF attachment"})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(u,{variant:"info",children:d.jsxs("div",{className:"text-sm",children:[d.jsx("strong",{children:"Instructions:"}),d.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[d.jsx("li",{children:'Click "Open WhatsApp Web" below'}),d.jsx("li",{children:"The message will be pre-filled with the script"}),d.jsx("li",{children:"Attach the downloaded PDF file"}),d.jsx("li",{children:"Send the message"}),d.jsx("li",{children:"Wait for delivery confirmation (double blue ticks)"})]})]})}),d.jsxs(x,{variant:"primary",onClick:()=>{const e=encodeURIComponent(D.message),t=`https://web.whatsapp.com/send?phone=${D.phoneNumber}&text=${e}`;window.open(t,"_blank"),p(!0)},disabled:!D.phoneNumber,size:"lg",className:"w-full",children:[d.jsx(le,{className:"w-5 h-5 mr-2"}),"Open WhatsApp Web"]}),m&&d.jsxs("div",{className:"mt-4",children:[d.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-4",children:[d.jsx(ie,{className:"w-4 h-4"}),"WhatsApp Web opened"]}),d.jsxs(x,{variant:"primary",onClick:()=>{m&&s(1)},className:"w-full",children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"I've sent the message"]})]})]})]}),2===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-green-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:d.jsx(pe,{className:"w-5 h-5 text-green-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Confirm Delivery"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Upload screenshot proof of successful delivery"})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(u,{variant:"info",children:d.jsxs("div",{className:"text-sm",children:[d.jsx("strong",{children:"Screenshot Requirements:"}),d.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[d.jsx("li",{children:"Show the sent message with timestamp"}),d.jsx("li",{children:"Display delivery confirmation (double blue ticks)"}),d.jsx("li",{children:"Include employee's phone number visible"}),d.jsx("li",{children:"Capture PDF attachment in the message"})]})]})}),d.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[d.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){y(t);const e=new FileReader;e.onload=e=>{v(e.target?.result)},e.readAsDataURL(t)}},className:"hidden",id:"proof-upload"}),d.jsx("label",{htmlFor:"proof-upload",className:"cursor-pointer",children:f?d.jsxs("div",{className:"space-y-3",children:[d.jsx("img",{src:f,alt:"Delivery proof",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-sm"}),d.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[d.jsx(ie,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:"Screenshot uploaded"})]})]}):d.jsxs("div",{className:"space-y-3",children:[d.jsx(he,{className:"w-12 h-12 mx-auto text-gray-400"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Upload Screenshot"}),d.jsx("div",{className:"text-sm text-gray-500",children:"Click to select image file"})]})]})})]}),d.jsx(x,{variant:"success",onClick:async()=>{if(h){N(!0);try{await r({warningId:t.warningId,deliveryMethod:"whatsapp",deliveredAt:new Date,proofImage:h,phoneNumber:D.formattedPhone})}catch(a){e.error("Failed to complete delivery:",a)}finally{N(!1)}}},disabled:!h||b,size:"lg",className:"w-full",children:b?d.jsxs(d.Fragment,{children:[d.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Delivery..."]}):d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Complete WhatsApp Delivery"]})})]})]}),j&&d.jsx(ks,{isOpen:j,onClose:()=>w(!1),warningData:{employee:{firstName:t.employeeName.split(" ")[0]||t.employeeName,lastName:t.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:t.warningCategory,level:t.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:()=>{c(!0)}})]})},Fs=({notification:t,currentStep:a,onStepComplete:s,onDeliveryComplete:r,isProcessing:n})=>{const[i,l]=C.useState(!1),[o,c]=C.useState(!1),[m,p]=C.useState(!1),[h,y]=C.useState(null),[f,v]=C.useState(null),[b,N]=C.useState(!1),[j,w]=C.useState(!1),D=C.useCallback(()=>{const e=t.contactDetails.email||t.employeeEmail||"";return{subject:`Important: ${t.warningLevel} - ${t.warningCategory}`,body:`Dear ${t.employeeName},\n\nI hope this email finds you well. I am writing to formally notify you of a disciplinary matter that requires your immediate attention.\n\nSubject: ${t.warningLevel}\nCategory: ${t.warningCategory}\n\nPlease find attached the formal warning document that outlines the details of this matter. It is crucial that you review this document thoroughly and understand its contents.\n\nKey Points:\nâ€¢ This is a formal disciplinary action\nâ€¢ Please read the attached document carefully\nâ€¢ You have the right to respond or appeal this decision\nâ€¢ Further incidents may result in additional disciplinary action\n\nIf you have any questions or wish to discuss this matter, please do not hesitate to contact me or schedule a meeting with HR.\n\nPlease confirm receipt of this email and the attached document by replying to this message.\n\nThank you for your attention to this matter.\n\nBest regards,\n${t.createdByName||"HR Department"}\nHuman Resources Department`,to:e}},[t])();return d.jsxs("div",{className:"space-y-6",children:[0===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:d.jsx(ye,{className:"w-5 h-5 text-blue-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Prepare Email"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Copy the professional email template and download the PDF attachment"})]})]}),d.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[d.jsx(fe,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee Email:"})]}),d.jsx("div",{className:"text-lg font-semibold text-gray-900",children:D.to||d.jsxs("span",{className:"text-red-500 text-sm",children:[d.jsx(ae,{className:"w-4 h-4 inline mr-1"}),"No email address on file"]})})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Subject:"}),d.jsx("div",{className:"relative",children:d.jsx("input",{value:D.subject,readOnly:!0,className:"w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm font-medium",style:{color:"var(--color-text)"}})})]}),d.jsxs("div",{className:"mb-4",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Message Template:"}),d.jsxs("div",{className:"relative",children:[d.jsx("textarea",{value:D.body,readOnly:!0,className:"w-full h-64 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm resize-none",style:{color:"var(--color-text)"}}),d.jsxs("div",{className:"absolute top-2 right-2 space-x-2",children:[d.jsx(x,{variant:i?"success":"primary",size:"sm",onClick:async()=>{try{const e=`To: ${D.to}\nSubject: ${D.subject}\n\n${D.body}`;await navigator.clipboard.writeText(e),l(!0),setTimeout(()=>l(!1),3e3)}catch(t){e.error("Failed to copy template:",t)}},children:i?d.jsxs(d.Fragment,{children:[d.jsx(me,{className:"w-4 h-4 mr-1"}),"Copied!"]}):d.jsxs(d.Fragment,{children:[d.jsx(ge,{className:"w-4 h-4 mr-1"}),"Copy Full Email"]})}),d.jsxs(x,{variant:"secondary",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(D.body),l(!0),setTimeout(()=>l(!1),3e3)}catch(t){e.error("Failed to copy email body:",t)}},children:[d.jsx(ge,{className:"w-4 h-4 mr-1"}),"Body Only"]})]})]})]}),d.jsxs("div",{className:"mb-6 space-y-3",children:[d.jsxs("div",{className:"flex gap-3",children:[d.jsxs(x,{variant:"secondary",onClick:()=>{w(!0)},className:"flex items-center gap-2",children:[d.jsx(xe,{className:"w-4 h-4"}),"Preview & Download PDF"]}),o&&d.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[d.jsx(ie,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:"PDF Downloaded"})]})]}),d.jsx("p",{className:"text-xs text-gray-500",children:"Use the preview to download the PDF, then attach it to your email"})]}),d.jsxs("div",{className:"space-y-2 mb-6",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm "+(i?"text-green-600":"text-gray-500"),children:[i?d.jsx(ie,{className:"w-4 h-4"}):d.jsx(ue,{className:"w-4 h-4"}),"Email template copied to clipboard"]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm "+(o?"text-green-600":"text-gray-500"),children:[o?d.jsx(ie,{className:"w-4 h-4"}):d.jsx(ue,{className:"w-4 h-4"}),"PDF downloaded for attachment"]})]}),d.jsx(x,{variant:"primary",onClick:()=>{i&&o&&s(0)},disabled:!i||!o,className:"w-full",children:i&&o?d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Continue to Send Email"]}):d.jsxs(d.Fragment,{children:[d.jsx(ue,{className:"w-4 h-4 mr-2"}),"Complete preparation steps above"]})})]}),1===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-green-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:d.jsx(ve,{className:"w-5 h-5 text-green-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Send Email"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Open your email client and send the message with PDF attachment"})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(u,{variant:"info",children:d.jsxs("div",{className:"text-sm",children:[d.jsx("strong",{children:"Instructions:"}),d.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[d.jsx("li",{children:'Click "Open Email Client" below'}),d.jsx("li",{children:"Your default email application will open with pre-filled content"}),d.jsx("li",{children:"Attach the downloaded PDF file"}),d.jsx("li",{children:"Review the email content and recipient"}),d.jsx("li",{children:"Send the email"}),d.jsx("li",{children:"Wait for delivery confirmation if available"})]})]})}),d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[d.jsxs("div",{className:"flex gap-2",children:[d.jsx("span",{className:"font-medium text-gray-700",children:"To:"}),d.jsx("span",{className:"text-gray-900",children:D.to})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Subject:"}),d.jsx("span",{className:"text-gray-900",children:D.subject})]})]}),d.jsxs(x,{variant:"primary",onClick:()=>{const e=encodeURIComponent(D.subject),t=encodeURIComponent(D.body),a=`mailto:${encodeURIComponent(D.to)}?subject=${e}&body=${t}`;window.location.href=a,p(!0)},disabled:!D.to,size:"lg",className:"w-full",children:[d.jsx(le,{className:"w-5 h-5 mr-2"}),"Open Email Client"]}),m&&d.jsxs("div",{className:"mt-4",children:[d.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-4",children:[d.jsx(ie,{className:"w-4 h-4"}),"Email client opened"]}),d.jsxs(x,{variant:"primary",onClick:()=>{m&&s(1)},className:"w-full",children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"I've sent the email"]})]})]})]}),2===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-purple-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:d.jsx(pe,{className:"w-5 h-5 text-purple-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Confirm Delivery"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Upload screenshot proof of successful email delivery"})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(u,{variant:"info",children:d.jsxs("div",{className:"text-sm",children:[d.jsx("strong",{children:"Screenshot Requirements:"}),d.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[d.jsx("li",{children:'Show the sent email in your "Sent" folder'}),d.jsx("li",{children:"Display recipient email address clearly"}),d.jsx("li",{children:"Include timestamp/date sent"}),d.jsx("li",{children:"Show PDF attachment in the email"}),d.jsx("li",{children:"Capture any delivery confirmation if available"})]})]})}),d.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[d.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){y(t);const e=new FileReader;e.onload=e=>{v(e.target?.result)},e.readAsDataURL(t)}},className:"hidden",id:"proof-upload"}),d.jsx("label",{htmlFor:"proof-upload",className:"cursor-pointer",children:f?d.jsxs("div",{className:"space-y-3",children:[d.jsx("img",{src:f,alt:"Delivery proof",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-sm"}),d.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[d.jsx(ie,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:"Screenshot uploaded"})]})]}):d.jsxs("div",{className:"space-y-3",children:[d.jsx(he,{className:"w-12 h-12 mx-auto text-gray-400"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Upload Screenshot"}),d.jsx("div",{className:"text-sm text-gray-500",children:"Click to select image file"})]})]})})]}),d.jsx(x,{variant:"success",onClick:async()=>{if(h){N(!0);try{await r({warningId:t.warningId,deliveryMethod:"email",deliveredAt:new Date,proofImage:h,emailAddress:D.to})}catch(a){e.error("Failed to complete delivery:",a)}finally{N(!1)}}},disabled:!h||b,size:"lg",className:"w-full",children:b?d.jsxs(d.Fragment,{children:[d.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Delivery..."]}):d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Complete Email Delivery"]})})]})]}),j&&d.jsx(ks,{isOpen:j,onClose:()=>w(!1),warningData:{employee:{firstName:t.employeeName.split(" ")[0]||t.employeeName,lastName:t.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:t.warningCategory,level:t.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:()=>{c(!0)}})]})},Ts=({notification:t,currentStep:a,onStepComplete:r,onDeliveryComplete:n,isProcessing:i})=>{const{organization:l}=s(),[o,c]=C.useState(!1),[m,h]=C.useState(!1),[y,f]=C.useState([{id:"hand_delivered",label:"Hand delivered to employee",completed:!1,required:!0,description:"Personally delivered the printed warning to the employee"}]),[v,b]=C.useState([{id:"delivery_complete",label:"Delivery process completed",completed:!1,required:!0,description:"Confirm warning has been delivered to employee"}]),[N,j]=C.useState({deliveryDate:(new Date).toISOString().split("T")[0],deliveryTime:(new Date).toTimeString().split(" ")[0].slice(0,5),deliveryLocation:"",witnessName:"",additionalNotes:""}),w=C.useCallback(async()=>{if(!l)return alert("Organization data not loaded"),null;try{h(!0),t.warningId;const a=await p.warnings.getById(t.warningId,l.id);if(!a)throw new Error("Warning data not found");const s=await p.employees.getById(a.employeeId,l.id);if(!s)throw new Error("Employee data not found");const r=dt(a,s,l);r.warningId,r.pdfGeneratorVersion,r.employee.firstName,r.employee.lastName;const{PDFGenerationService:n}=await ee(async()=>{const{PDFGenerationService:e}=await Promise.resolve().then(()=>nt);return{PDFGenerationService:e}},void 0),i=await n.generateWarningPDF(r,r.pdfGeneratorVersion,r.pdfSettings);return e.success("âœ… PDF generated successfully"),i}catch(a){return e.error("âŒ Failed to generate PDF:",a),alert("Failed to generate PDF. Please try again."),null}finally{h(!1)}},[t.warningId,l]),D=C.useCallback(async()=>{if(t.pdfUrl){const e=window.open(t.pdfUrl,"_blank");return void(e&&(e.onload=()=>{e.print(),c(!0)}))}const e=await w();if(e){const t=URL.createObjectURL(e),a=window.open(t,"_blank");a&&(a.onload=()=>{a.print(),c(!0)})}},[t.pdfUrl,w]),S=(e,t)=>{"delivery"===e?f(e=>e.map(e=>e.id===t?{...e,completed:!e.completed}:e)):b(e=>e.map(e=>e.id===t?{...e,completed:!e.completed}:e))},k=y.filter(e=>e.required).every(e=>e.completed),E=v.filter(e=>e.required).every(e=>e.completed);return d.jsxs("div",{className:"space-y-6",children:[0===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-purple-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:d.jsx(be,{className:"w-5 h-5 text-purple-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Print Warning Document"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Print the official warning document for hand delivery"})]})]}),d.jsxs("div",{className:"space-y-4",children:[d.jsx(u,{variant:"info",children:d.jsxs("div",{className:"text-sm",children:[d.jsx("strong",{children:"Printing Requirements:"}),d.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[d.jsx("li",{children:"Use high-quality paper (minimum 80gsm)"}),d.jsx("li",{children:"Ensure all text is clearly legible"}),d.jsx("li",{children:"Print multiple copies (original + HR copy)"})]})]})}),d.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(fe,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"font-medium",children:"Employee:"}),d.jsx("span",{children:t.employeeName})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(ne,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"font-medium",children:"Warning Type:"}),d.jsx("span",{children:t.warningLevel})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(Ne,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"font-medium",children:"Issue Date:"}),d.jsx("span",{children:t.createdAt.toLocaleDateString()})]})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{className:"flex gap-3",children:[d.jsx(x,{variant:"secondary",onClick:async()=>{if(t.pdfUrl)return void window.open(t.pdfUrl,"_blank");const e=await w();if(e){const t=URL.createObjectURL(e);window.open(t,"_blank")}},disabled:m,className:"flex items-center gap-2",children:m?d.jsxs(d.Fragment,{children:[d.jsx(re,{className:"w-4 h-4 animate-spin"}),"Generating PDF..."]}):d.jsxs(d.Fragment,{children:[d.jsx(xe,{className:"w-4 h-4"}),"Preview Document"]})}),d.jsx(x,{variant:"primary",onClick:D,disabled:m,className:"flex items-center gap-2",children:m?d.jsxs(d.Fragment,{children:[d.jsx(re,{className:"w-4 h-4 animate-spin"}),"Generating PDF..."]}):d.jsxs(d.Fragment,{children:[d.jsx(be,{className:"w-4 h-4"}),"Print Document"]})})]}),o&&d.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[d.jsx(ie,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:"Document printed successfully"})]})]}),d.jsx(x,{variant:"primary",onClick:()=>{o&&r(0)},disabled:!o,className:"w-full",children:o?d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Continue to Hand Delivery"]}):d.jsxs(d.Fragment,{children:[d.jsx(ue,{className:"w-4 h-4 mr-2"}),"Print document to continue"]})})]})]}),1===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-green-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:d.jsx(fe,{className:"w-5 h-5 text-green-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Hand Delivery to Employee"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Deliver the printed document and obtain employee acknowledgment"})]})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Date"}),d.jsx("input",{type:"date",value:N.deliveryDate,onChange:e=>j(t=>({...t,deliveryDate:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Time"}),d.jsx("input",{type:"time",value:N.deliveryTime,onChange:e=>j(t=>({...t,deliveryTime:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),d.jsxs("div",{className:"md:col-span-2",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Location"}),d.jsx("input",{type:"text",placeholder:"e.g., Employee's office, HR meeting room",value:N.deliveryLocation,onChange:e=>j(t=>({...t,deliveryLocation:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]})]}),d.jsxs("div",{children:[d.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(ie,{className:"w-5 h-5 text-green-600"}),"Delivery Checklist"]}),d.jsx("div",{className:"space-y-3",children:y.map(e=>d.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[d.jsx("input",{type:"checkbox",checked:e.completed,onChange:()=>S("delivery",e.id),className:"mt-1 w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"font-medium "+(e.completed?"text-green-600":"text-gray-900"),children:[e.label,e.required&&d.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),d.jsx("div",{className:"text-sm text-gray-600",children:e.description})]}),e.completed&&d.jsx(ie,{className:"w-5 h-5 text-green-600 mt-1"})]},e.id))})]}),d.jsx(x,{variant:"primary",onClick:()=>{k&&r(1)},disabled:!k,className:"w-full",children:k?d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Continue to Filing"]}):d.jsxs(d.Fragment,{children:[d.jsx(ue,{className:"w-4 h-4 mr-2"}),"Complete all required items above"]})})]})]}),2===a&&d.jsxs(g,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[d.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[d.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:d.jsx(je,{className:"w-5 h-5 text-blue-600"})}),d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Finalize Delivery"}),d.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Confirm delivery completion"})]})]}),d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{children:d.jsx("div",{className:"space-y-3",children:v.map(e=>d.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[d.jsx("input",{type:"checkbox",checked:e.completed,onChange:()=>S("filing",e.id),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"font-medium "+(e.completed?"text-blue-600":"text-gray-900"),children:[e.label,e.required&&d.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),d.jsx("div",{className:"text-sm text-gray-600",children:e.description})]}),e.completed&&d.jsx(ie,{className:"w-5 h-5 text-blue-600 mt-1"})]},e.id))})}),d.jsx(x,{variant:"success",onClick:async()=>{if(E)try{await n({warningId:t.warningId,deliveryMethod:"printed",deliveredAt:new Date(`${N.deliveryDate}T${N.deliveryTime}`),deliveryLocation:N.deliveryLocation,witnessName:N.witnessName,additionalNotes:N.additionalNotes,deliveryChecklist:y,filingChecklist:v})}catch(a){e.error("Failed to complete delivery:",a)}},disabled:!E||i,size:"lg",className:"w-full",children:i?d.jsxs(d.Fragment,{children:[d.jsx(re,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Process..."]}):d.jsxs(d.Fragment,{children:[d.jsx(ie,{className:"w-4 h-4 mr-2"}),"Complete Delivery"]})})]})]})]})},Ps=({notification:e,onDeliveryComplete:t,onClose:a,isOpen:s})=>{const[r,n]=C.useState(0),[i,l]=C.useState([]),[o,c]=C.useState(!1),[m,g]=C.useState(null);C.useEffect(()=>{l((()=>{switch(e.deliveryMethod){case"whatsapp":return[{id:"prepare",label:"Prepare Message",completed:!1,inProgress:!0,description:"Copy pre-written script and download PDF"},{id:"send",label:"Send via WhatsApp",completed:!1,inProgress:!1,description:"Open WhatsApp and send message with attachment"},{id:"confirm",label:"Confirm Delivery",completed:!1,inProgress:!1,description:"Upload screenshot proof and complete delivery"}];case"email":return[{id:"prepare",label:"Prepare Email",completed:!1,inProgress:!0,description:"Copy email template and download PDF attachment"},{id:"send",label:"Send Email",completed:!1,inProgress:!1,description:"Open email client and send message"},{id:"confirm",label:"Confirm Delivery",completed:!1,inProgress:!1,description:"Upload screenshot proof and complete delivery"}];case"printed":return[{id:"print",label:"Print Document",completed:!1,inProgress:!0,description:"Print warning PDF document"},{id:"deliver",label:"Hand Deliver",completed:!1,inProgress:!1,description:"Deliver to employee and obtain signature"},{id:"file",label:"File Documentation",completed:!1,inProgress:!1,description:"File signed copy and confirm completion"}];default:return[]}})())},[e.deliveryMethod]);const p=(()=>{switch(e.deliveryMethod){case"whatsapp":return{icon:ce,name:"WhatsApp Business",color:"green",bgClass:"bg-green-50 border-green-200",textClass:"text-green-700"};case"email":return{icon:ye,name:"Email",color:"blue",bgClass:"bg-blue-50 border-blue-200",textClass:"text-blue-700"};case"printed":return{icon:be,name:"Print & Hand Delivery",color:"purple",bgClass:"bg-purple-50 border-purple-200",textClass:"text-purple-700"};default:return{icon:ne,name:"Unknown",color:"gray",bgClass:"bg-gray-50 border-gray-200",textClass:"text-gray-700"}}})(),y=e=>{l(t=>t.map((t,a)=>a===e?{...t,completed:!0,inProgress:!1}:a===e+1?{...t,inProgress:!0}:t)),e<i.length-1&&n(e+1)},f=async s=>{c(!0);try{await t(e.id,{...s,deliveryMethod:e.deliveryMethod,completedAt:new Date,steps:i}),a()}catch(r){g("Failed to complete delivery. Please try again.")}finally{c(!1)}};return s?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:d.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[95vh] flex flex-col shadow-2xl",children:[d.jsx("div",{className:`p-6 border-b flex-shrink-0 ${p.bgClass}`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("div",{className:"p-3 rounded-xl bg-white shadow-sm",children:d.jsx(p.icon,{className:`w-6 h-6 ${p.textClass}`})}),d.jsxs("div",{children:[d.jsxs("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:[p.name," Delivery"]}),d.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Guided delivery workflow for ",e.employeeName]})]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(h,{variant:e.priority,size:"sm",children:e.priority.toUpperCase()}),d.jsx(x,{variant:"ghost",size:"sm",onClick:a,children:d.jsx(te,{className:"w-4 h-4"})})]})]})}),d.jsxs("div",{className:"p-4 bg-gray-50 border-b flex-shrink-0",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(fe,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"font-semibold text-gray-900",children:e.employeeName})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(we,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm text-gray-600",children:e.warningLevel})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(ne,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm text-gray-600",children:e.warningCategory})]})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[d.jsx(Ne,{className:"w-4 h-4"}),e.createdAt.toLocaleDateString()]})]}),(e.contactDetails.email||e.contactDetails.phone)&&d.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.contactDetails.email&&d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(ye,{className:"w-4 h-4 text-gray-400"}),d.jsx("span",{className:"text-gray-600",children:e.contactDetails.email})]}),e.contactDetails.phone&&d.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[d.jsx(de,{className:"w-4 h-4 text-gray-400"}),d.jsx("span",{className:"text-gray-600",children:e.contactDetails.phone})]})]})]}),d.jsx("div",{className:"p-6 border-b bg-white flex-shrink-0",children:d.jsx("div",{className:"flex items-center justify-between",children:i.map((e,t)=>d.jsxs("div",{className:"flex items-center",children:[d.jsxs("div",{className:"flex flex-col items-center",children:[d.jsx("div",{className:`\n                    w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium transition-all\n                    ${e.completed?"bg-green-500 text-white":e.inProgress?"bg-blue-500 text-white animate-pulse":"bg-gray-200 text-gray-500"}\n                  `,children:e.completed?d.jsx(ie,{className:"w-5 h-5"}):e.inProgress?d.jsx(ue,{className:"w-5 h-5"}):t+1}),d.jsxs("div",{className:"mt-2 text-center",children:[d.jsx("div",{className:"text-sm font-medium "+(e.completed||e.inProgress?"text-gray-900":"text-gray-500"),children:e.label}),d.jsx("div",{className:"text-xs text-gray-500 mt-1 max-w-32",children:e.description})]})]}),t<i.length-1&&d.jsx(De,{className:"w-5 h-5 mx-4 "+(e.completed?"text-green-500":"text-gray-300")})]},e.id))})}),m&&d.jsx("div",{className:"p-4 flex-shrink-0",children:d.jsx(u,{variant:"error",children:m})}),d.jsxs("div",{className:"p-6 flex-1 overflow-y-auto min-h-0",children:["whatsapp"===e.deliveryMethod&&d.jsx(Es,{notification:e,currentStep:r,onStepComplete:y,onDeliveryComplete:f,isProcessing:o}),"email"===e.deliveryMethod&&d.jsx(Fs,{notification:e,currentStep:r,onStepComplete:y,onDeliveryComplete:f,isProcessing:o}),"printed"===e.deliveryMethod&&d.jsx(Ts,{notification:e,currentStep:r,onStepComplete:y,onDeliveryComplete:f,isProcessing:o})]}),d.jsxs("div",{className:"p-4 border-t bg-gray-50 flex items-center justify-between flex-shrink-0",children:[d.jsxs("div",{className:"text-sm text-gray-500",children:["Step ",r+1," of ",i.length]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(x,{variant:"ghost",size:"sm",onClick:a,children:"Cancel"}),o&&d.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[d.jsx(se,{className:"w-4 h-4 animate-spin"}),"Processing..."]})]})]})]})}):null},_s=e=>e?e.deleted?{status:"deleted",message:"This audio recording has been permanently deleted.",canPlay:!1}:e.autoDeleteDate&&new Date>new Date(e.autoDeleteDate)?{status:"expired",message:"This audio recording has expired and is no longer available.",canPlay:!1}:"processing"===e.processingStatus?{status:"processing",message:"Audio is still being processed. Please try again in a moment.",canPlay:!1}:"failed"===e.processingStatus?{status:"failed",message:"Audio processing failed. The recording may be corrupted.",canPlay:!1}:e.storageUrl||e.url?{status:"available",message:"Audio recording is ready to play.",canPlay:!0}:{status:"unavailable",message:"Audio URL is not available. The recording may not have been uploaded properly.",canPlay:!1}:{status:"not-available",message:"Audio recording not available.",canPlay:!1},Is=({audioRecording:t,warningId:a,showDownload:s=!0,showMetadata:r=!0,showTranscript:n=!1,compact:i=!1,autoPlay:l=!1,className:o=""})=>{if(!t)return d.jsx("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 ${o}`,children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:d.jsx(Se,{className:"w-5 h-5 text-gray-400"})}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"No audio recording available"}),d.jsx("p",{className:"text-xs text-gray-500",children:"Audio recording not found or not provided"})]})]})});const c=C.useRef(null),m=C.useRef(null),[g,x]=C.useState({isLoading:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,error:null,buffered:0}),u=_s(t),p=(e=>_s(e).canPlay)(t),h=(e=>"deleted"===_s(e).status)(t),y=(e=>"expired"===_s(e).status)(t),f=t?.storageUrl||t?.url;C.useEffect(()=>{const t=c.current;if(!t||!p||!f)return void x(e=>({...e,isLoading:!1,error:p?"No audio URL available":u.message}));t.src=f;const a=()=>{x(e=>({...e,isLoading:!0,error:null}))},s=()=>{x(e=>({...e,duration:t.duration||0,isLoading:!1}))},r=()=>{x(e=>({...e,currentTime:t.currentTime||0}))},n=()=>{x(e=>({...e,isPlaying:!0}))},i=()=>{x(e=>({...e,isPlaying:!1}))},l=()=>{x(e=>({...e,isPlaying:!1,currentTime:0})),t&&(t.currentTime=0)},o=t=>{e.error("Audio loading error:",t),x(e=>({...e,isLoading:!1,isPlaying:!1,error:"Failed to load audio recording. The file may be corrupted or unavailable."}))},d=()=>{if(t.buffered.length>0){const e=t.buffered.end(t.buffered.length-1),a=t.duration||0;x(t=>({...t,buffered:a?e/a*100:0}))}};return t.addEventListener("loadstart",a),t.addEventListener("loadedmetadata",s),t.addEventListener("timeupdate",r),t.addEventListener("play",n),t.addEventListener("pause",i),t.addEventListener("ended",l),t.addEventListener("error",o),t.addEventListener("progress",d),t.load(),()=>{t.removeEventListener("loadstart",a),t.removeEventListener("loadedmetadata",s),t.removeEventListener("timeupdate",r),t.removeEventListener("play",n),t.removeEventListener("pause",i),t.removeEventListener("ended",l),t.removeEventListener("error",o),t.removeEventListener("progress",d)}},[p,f,u.message]),C.useEffect(()=>{l&&c.current&&!g.isLoading&&!g.error&&p&&c.current.play().catch(t=>e.warn("Audio autoplay failed",t))},[l,g.isLoading,g.error,p]);const v=C.useCallback(async()=>{const t=c.current;if(t&&p)try{g.isPlaying?t.pause():await t.play()}catch(a){e.error("Playback error:",a),x(e=>({...e,error:"Playback failed. Please try again."}))}},[g.isPlaying,p]),b=C.useCallback(e=>{const t=c.current;t&&p&&(t.currentTime=e)},[p]),N=C.useCallback(e=>{const t=c.current;t&&(t.volume=e,x(t=>({...t,volume:e,isMuted:0===e})))},[]),j=C.useCallback(()=>{const e=c.current;if(e){const t=!g.isMuted;e.muted=t,x(e=>({...e,isMuted:t}))}},[g.isMuted]),w=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`};return d.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${o}`,children:[p&&f&&d.jsx("audio",{ref:c,preload:"metadata"}),h?d.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[d.jsx(_e,{className:"w-5 h-5 text-red-600"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-red-800 font-medium",children:"Audio Recording Deleted"}),d.jsx("p",{className:"text-red-600 text-sm",children:u.message})]})]}):y?d.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[d.jsx(ae,{className:"w-5 h-5 text-yellow-600"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-yellow-800 font-medium",children:"Audio Recording Expired"}),d.jsx("p",{className:"text-yellow-600 text-sm",children:u.message})]})]}):"processing"===u.status?d.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[d.jsx(re,{className:"w-5 h-5 text-blue-600 animate-spin"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-blue-800 font-medium",children:"Processing Audio"}),d.jsx("p",{className:"text-blue-600 text-sm",children:u.message})]})]}):"failed"===u.status||"unavailable"===u.status?d.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[d.jsx(Ie,{className:"w-5 h-5 text-red-600"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-red-800 font-medium",children:"Audio Unavailable"}),d.jsx("p",{className:"text-red-600 text-sm",children:u.message})]})]}):null,p&&!g.error&&d.jsx("div",{className:"p-4",children:d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsx("button",{onClick:v,disabled:g.isLoading,className:"flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",title:g.isPlaying?"Pause":"Play",children:g.isLoading?d.jsx(re,{className:"w-5 h-5 animate-spin"}):g.isPlaying?d.jsx(Ce,{className:"w-5 h-5"}):d.jsx(ke,{className:"w-5 h-5 ml-1"})}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{ref:m,className:"relative h-2 bg-gray-200 rounded-full cursor-pointer",onClick:e=>{if(m.current&&g.duration){const t=m.current.getBoundingClientRect(),a=(e.clientX-t.left)/t.width;b(a*g.duration)}},children:[d.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 rounded-full",style:{width:`${g.buffered}%`}}),d.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full",style:{width:g.duration?g.currentTime/g.duration*100+"%":"0%"}})]}),d.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[d.jsx("span",{children:w(g.currentTime)}),d.jsx("span",{children:w(g.duration)})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("button",{onClick:j,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:g.isMuted?"Unmute":"Mute",children:g.isMuted?d.jsx(Ee,{className:"w-4 h-4"}):d.jsx(Fe,{className:"w-4 h-4"})}),d.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:g.isMuted?0:g.volume,onChange:e=>N(parseFloat(e.target.value)),className:"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Volume"})]}),s&&f&&d.jsx("button",{onClick:()=>{const e=document.createElement("a");e.href=f,e.download=`warning-audio-${t.recordingId||"recording"}.webm`,e.click()},className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Download Audio",children:d.jsx(Te,{className:"w-4 h-4"})})]})}),r&&!i&&p&&!g.error&&d.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[d.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[d.jsx(ue,{className:"w-3 h-3"}),"Duration"]}),d.jsx("p",{className:"font-medium",children:w(t.duration||0)})]}),d.jsxs("div",{children:[d.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[d.jsx(Se,{className:"w-3 h-3"}),"Quality"]}),d.jsx("p",{className:"font-medium",children:(D=t.bitrate,D?D>=32e3?"High":D>=16e3?"Standard":"Basic":"Unknown")})]}),d.jsxs("div",{children:[d.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[d.jsx(fe,{className:"w-3 h-3"}),"Recorded By"]}),d.jsx("p",{className:"font-medium",children:t.recordedByName||"Manager"})]}),d.jsxs("div",{children:[d.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[d.jsx(Ne,{className:"w-3 h-3"}),"Recorded"]}),d.jsx("p",{className:"font-medium",children:t.startTime?new Date(t.startTime).toLocaleDateString():"Unknown"})]})]}),t.consentGiven&&d.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-green-700 bg-green-50 px-3 py-2 rounded-lg",children:[d.jsx(we,{className:"w-3 h-3"}),d.jsx("span",{children:"Recording consent was obtained from all participants"})]}),t.autoDeleteDate&&d.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-lg",children:[d.jsx(Pe,{className:"w-3 h-3"}),d.jsxs("span",{children:["This recording will be automatically deleted on"," ",new Date(t.autoDeleteDate).toLocaleDateString()]})]})]}),g.error&&d.jsx("div",{className:"border-t border-gray-200 p-4",children:d.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[d.jsx(ae,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm",children:g.error})]})})]});var D},As=({signature:t,title:a,subtitle:s,isOpen:r,onClose:n,allowDownload:i=!0})=>{const l=C.useCallback(()=>{try{const e=atob(t.split(",")[1]),s=new Array(e.length);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);const r=new Uint8Array(s),n=new Blob([r],{type:"image/png"}),i=URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`${a.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}catch(s){e.error("Signature download failed:",s)}},[t,a]),o=C.useCallback(async()=>{try{await navigator.clipboard.writeText(t)}catch(a){e.error("Failed to copy signature:",a)}},[t]);return r?d.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:d.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a}),s&&d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s})]}),d.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5 text-gray-500"})})]}),d.jsx("div",{className:"p-6",children:d.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:d.jsx("img",{src:t,alt:a,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),d.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[d.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature â€¢ PNG format â€¢ Legally binding"}),d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:o,className:"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[d.jsx(ge,{className:"w-4 h-4"}),"Copy Data"]}),i&&d.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[d.jsx(Te,{className:"w-4 h-4"}),"Download"]})]})]})]})}):null},Rs=({signatures:e,warningId:t,showTimestamps:a=!0,compact:s=!1,showVerification:r=!0,allowDownload:n=!0,className:i=""})=>{const[l,o]=C.useState(null),c=e=>{if(!e)return!1;try{return e.startsWith("data:image/")&&e.includes("base64,")}catch{return!1}},m=c(e.manager),g=c(e.employee),x=m&&g,u=C.useCallback((e,t,a)=>{o({signature:e,title:t,subtitle:a})},[]),p=C.useCallback(()=>{o(null)},[]),h=e=>{if(!e)return"Not signed";try{return new Date(e).toLocaleString()}catch{return"Invalid timestamp"}},y=x?{status:"complete",message:"Document fully signed",color:"text-green-600 bg-green-50 border-green-200",icon:ie}:m||g?{status:"partial",message:"Signatures pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:ue}:{status:"missing",message:"No signatures collected",color:"text-gray-600 bg-gray-50 border-gray-200",icon:ae},f=y.icon;return s?d.jsxs("div",{className:`inline-flex items-center gap-2 ${i}`,children:[d.jsx(f,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm text-gray-600",children:x?"âœ“ Signed":"â³ Pending"}),x&&d.jsx("button",{onClick:()=>u(e.manager,"Digital Signatures","Manager and Employee"),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View"})]}):d.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${i}`,children:[d.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-4 py-3 border-b border-gray-200",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:d.jsx(Ae,{className:"w-4 h-4 text-white"})}),d.jsxs("div",{children:[d.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Digital Signatures"}),d.jsx("p",{className:"text-xs text-gray-600",children:"Electronic authorization and acknowledgment"})]})]}),r&&d.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${y.color}`,children:[d.jsx(f,{className:"w-4 h-4"}),d.jsx("span",{className:"text-sm font-medium",children:y.message})]})]})}),d.jsx("div",{className:"p-4",children:d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[d.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(fe,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Manager"}),m&&d.jsx(ie,{className:"w-4 h-4 text-green-500"})]}),m&&d.jsx("button",{onClick:()=>u(e.manager,"Manager Signature",e.managerName||"Warning Issuer"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:d.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),m?d.jsxs("div",{className:"space-y-3",children:[d.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:d.jsx("img",{src:e.manager,alt:"Manager Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),d.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Le,{className:"w-3 h-3"}),d.jsx("span",{children:e.managerName||"Manager"})]}),a&&e.managerTimestamp&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Ne,{className:"w-3 h-3"}),d.jsx("span",{children:h(e.managerTimestamp)})]})]})]}):d.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[d.jsx(fe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),d.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting manager signature"})]})]}),d.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Le,{className:"w-4 h-4 text-gray-500"}),d.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Employee"}),g&&d.jsx(ie,{className:"w-4 h-4 text-green-500"})]}),g&&d.jsx("button",{onClick:()=>u(e.employee,"Employee Signature",e.employeeName||"Warning Recipient"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:d.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),g?d.jsxs("div",{className:"space-y-3",children:[d.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:d.jsx("img",{src:e.employee,alt:"Employee Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),d.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Le,{className:"w-3 h-3"}),d.jsx("span",{children:e.employeeName||"Employee"})]}),a&&e.employeeTimestamp&&d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx(Ne,{className:"w-3 h-3"}),d.jsx("span",{children:h(e.employeeTimestamp)})]})]})]}):d.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[d.jsx(Le,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),d.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting employee acknowledgment"})]})]})]})}),x&&d.jsx("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(we,{className:"w-5 h-5 text-green-600"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"text-sm font-medium text-green-800",children:"Document Digitally Signed & Verified"}),d.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["These digital signatures are legally binding and comply with electronic signature regulations.",t&&` Document ID: ${t}`]})]}),n&&d.jsx("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download signatures",children:d.jsx(Te,{className:"w-4 h-4"})})]})}),!x&&(m||g)&&d.jsx("div",{className:"bg-yellow-50 border-t border-yellow-200 px-4 py-3",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(Pe,{className:"w-5 h-5 text-yellow-600"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Signature Collection In Progress"}),d.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Document requires signatures from both manager and employee to be legally complete."})]})]})}),l&&d.jsx(As,{signature:l.signature,title:l.title,subtitle:l.subtitle,isOpen:!0,onClose:p,allowDownload:n})]})},Ls=(e,t="Not specified")=>null==e?t:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":t,Ms=(e,t="Not set")=>{if(!e)return t;try{let a;return a=void 0!==e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:new Date(e),isNaN(a.getTime())?t:a.toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return t}},zs=(e,t)=>{const a=Ms(e,"");return a&&"Not set"!==a?t?`${a} at ${t}`:a:"Not specified"},Os=e=>{if(!e)return(new Date).toISOString().split("T")[0];try{let t;if(void 0!==e.seconds)t=new Date(1e3*e.seconds);else if(e instanceof Date)t=e;else{if("string"!=typeof e)return(new Date).toISOString().split("T")[0];t=new Date(e)}return isNaN(t.getTime())?(new Date).toISOString().split("T")[0]:t.toISOString().split("T")[0]}catch{return(new Date).toISOString().split("T")[0]}},$s=(e,t)=>{const a={verbal:{primary:"bg-blue-600",secondary:"bg-blue-50",accent:"text-blue-600",background:"bg-blue-50",text:"text-blue-800",border:"border-blue-200"},written:{primary:"bg-yellow-600",secondary:"bg-yellow-50",accent:"text-yellow-600",background:"bg-yellow-50",text:"text-yellow-800",border:"border-amber-200"},final:{primary:"bg-red-600",secondary:"bg-red-50",accent:"text-red-600",background:"bg-red-50",text:"text-red-800",border:"border-red-200"},dismissal:{primary:"bg-red-700",secondary:"bg-red-50",accent:"text-red-700",background:"bg-red-50",text:"text-red-900",border:"border-red-300"}};return a[e]||a.verbal},Ws=({warning:t,isOpen:a,onClose:s,canTakeAction:r=!1,userRole:n="viewer",className:i="",onApprove:l,onReject:g,onAppealOutcome:x,canManageAppeals:u=!1})=>{const[p,h]=C.useState("overview"),[y,f]=C.useState(new Set(["summary"])),[v,b]=C.useState({type:null,loading:!1}),[N,j]=C.useState(!1),[w,D]=C.useState(""),[S,k]=C.useState(!1),[E,F]=C.useState(!1),[T,P]=C.useState(!1),[_,I]=C.useState(!1),[A,R]=C.useState(!1),[L,M]=C.useState(null),[z,O]=C.useState(!1),[$,W]=C.useState(null),[U,V]=C.useState(""),[q,B]=C.useState(!1),H=C.useRef(null),G=C.useRef(null);c(a);const{organization:Y}=o(),K=C.useMemo(()=>t?{id:t.id||"",employeeName:Ls(t.employeeName),employeeNumber:Ls(t.employeeNumber),department:Ls(t.department),position:Ls(t.position),category:Ls(t.category),level:t.level||"verbal",status:t.status||"issued",incidentDate:Ms(t.incidentDate),incidentTime:Ls(t.incidentTime),incidentDateTime:zs(t.incidentDate,t.incidentTime),incidentLocation:Ls(t.incidentLocation),description:Ls(t.description),issueDate:Ms(t.issueDate),expiryDate:Ms(t.expiryDate),issuedByName:Ls(t.issuedByName),deliveryMethod:Ls(t.deliveryMethod),additionalNotes:Ls(t.additionalNotes),hasAudio:Boolean(t.audioRecording?.url),audioRecording:t.audioRecording||null,hasPDF:Boolean(t.pdfGenerated||t.pdfFilename),hasSignatures:Boolean(t.signatures&&Object.keys(t.signatures).length>0),signatures:t.signatures||{manager:null,employee:null},validityPeriod:t.validityPeriod||6,escalationReason:Ls(t.escalationReason),acknowledgedAt:t.acknowledgedAt?Ms(t.acknowledgedAt):null,acknowledgedBy:Ls(t.acknowledgedBy),appealSubmitted:Boolean(t.appealSubmitted),appealDate:t.appealDate?Ms(t.appealDate):null,appealDetails:t.appealDetails||null,appealOutcome:t.appealOutcome||null,appealDecisionDate:t.appealDecisionDate?Ms(t.appealDecisionDate):null,appealReasoning:Ls(t.appealReasoning,""),hrNotes:Ls(t.hrNotes,""),followUpRequired:Boolean(t.followUpRequired),followUpDate:t.followUpDate?Ms(t.followUpDate):null,createdAt:Ms(t.createdAt),updatedAt:Ms(t.updatedAt)}:null,[t]),J=C.useMemo(()=>K?$s(K.level,K.status):$s("verbal"),[K]),Q=C.useCallback(()=>{k(!0),setTimeout(()=>{s(),k(!1),h("overview"),f(new Set(["summary"])),b({type:null,loading:!1}),j(!1),D(""),P(!1),I(!1),R(!1),M(null)},300)},[s]);C.useCallback(e=>{f(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),C.useCallback(async()=>{if(l&&K?.id){b({type:"approve",loading:!0});try{await l(K.id),setTimeout(Q,1e3)}catch(t){e.error("Failed to approve warning:",t),b({type:null,loading:!1})}}},[l,K?.id,Q]),C.useCallback(async()=>{if(g&&K?.id){b({type:"reject",loading:!0});try{await g(K.id,w),setTimeout(Q,1e3)}catch(t){e.error("Failed to reject warning:",t),b({type:null,loading:!1})}}},[g,K?.id,w,Q]),C.useCallback(()=>{j(!0)},[]);const Z=C.useCallback(()=>{K?.hasAudio&&R(!0)},[K?.hasAudio]),X=C.useCallback(()=>{P(!0)},[]),ae=C.useCallback(async()=>{if(K)try{const{PDFGenerationService:a}=await ee(async()=>{const{PDFGenerationService:e}=await Promise.resolve().then(()=>nt);return{PDFGenerationService:e}},void 0),s=await a.generateAppealReportPDF({warningId:t.id||"N/A",employee:{firstName:K.employeeName.split(" ")[0]||"Unknown",lastName:K.employeeName.split(" ").slice(1).join(" ")||"Employee",employeeNumber:K.employeeNumber,department:K.department,position:K.position},category:K.category,warningLevel:K.level,issueDate:t.issueDate?.seconds?new Date(1e3*t.issueDate.seconds):new Date,organization:{name:Y?.name||"Organization",branding:Y?.branding},appealDetails:K.appealDetails?{grounds:K.appealDetails.grounds,details:K.appealDetails.details,requestedOutcome:K.appealDetails.requestedOutcome,submittedAt:K.appealDetails.submittedAt?new Date(K.appealDetails.submittedAt):void 0,submittedBy:K.appealDetails.submittedBy}:void 0,appealOutcome:K.appealOutcome,appealDecisionDate:t.appealDecisionDate?.seconds?new Date(1e3*t.appealDecisionDate.seconds):void 0,appealReasoning:K.appealReasoning,hrNotes:K.hrNotes,followUpRequired:K.followUpRequired,followUpDate:t.followUpDate?.seconds?new Date(1e3*t.followUpDate.seconds):void 0}),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download=`Appeal_Report_${t.id||"Unknown"}_${(new Date).toISOString().split("T")[0]}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),e.success("âœ… Appeal report downloaded")}catch(a){e.error("âŒ Failed to generate appeal report:",a),console.error("Full error details:",a),console.error("Warning data:",K),console.error("Organization:",Y),alert(`Failed to generate appeal report: ${a instanceof Error?a.message:"Unknown error"}`)}},[K,t,Y]),se=C.useCallback(()=>{K?.hasSignatures&&I(!0)},[K?.hasSignatures]),re=C.useCallback(e=>{if(!K?.signatures)return;const t=K.signatures[e];t&&(M({signature:t,title:`${e.charAt(0).toUpperCase()+e.slice(1)} Signature`,subtitle:`Warning ID: ${K.id} â€¢ ${K.employeeName}`}),I(!0))},[K]);return a&&K?d.jsxs(d.Fragment,{children:[d.jsx("div",{ref:G,className:`\n          fixed inset-0 flex items-center justify-center p-4\n          bg-black/60 backdrop-blur-xl\n          transition-all duration-500 ease-out\n          ${S?"opacity-0":"opacity-100"}\n          ${i}\n        `,style:{zIndex:m.modal},onClick:e=>e.target===G.current&&Q(),children:d.jsxs("div",{ref:H,className:`\n            relative w-full max-w-4xl max-h-[90vh] \n            bg-white rounded-lg shadow-xl border border-gray-200\n            overflow-hidden\n            transition-all duration-300 ease-out\n            ${S?"scale-95 opacity-0":"scale-100 opacity-100"}\n          `,children:[d.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:`\n                w-10 h-10 rounded-lg ${J.primary}\n                flex items-center justify-center\n              `,children:d.jsx(we,{className:"w-5 h-5 text-white"})}),d.jsxs("div",{children:[d.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),d.jsxs("p",{className:"text-sm text-gray-600",children:[K.employeeName," â€¢ ",K.category]})]})]}),d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium rounded-full "+("verbal"===K.level?"bg-blue-100 text-blue-800":"written"===K.level?"bg-yellow-100 text-yellow-800":"final"===K.level?"bg-red-100 text-red-800":"dismissal"===K.level?"bg-red-200 text-red-900":"bg-gray-100 text-gray-800"),children:"verbal"===K.level?"Verbal Warning":"written"===K.level?"Written Warning":"final"===K.level?"Final Warning":"dismissal"===K.level?"Dismissal":"Warning"}),d.jsx("button",{onClick:Q,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5"})})]})]}),d.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:d.jsxs("div",{className:"p-6 space-y-6",children:[d.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[d.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Incident Summary"}),d.jsxs("div",{className:"space-y-3",children:[d.jsxs("div",{children:[d.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description:"}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:K.description})]}),d.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),d.jsx("span",{className:"ml-2 text-gray-600",children:K.incidentDate})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Location:"}),d.jsx("span",{className:"ml-2 text-gray-600",children:K.incidentLocation})]})]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(fe,{className:"w-4 h-4 text-gray-600"}),"Employee Details"]}),d.jsxs("div",{className:"space-y-2 text-sm",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Name:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.employeeName})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"ID:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.employeeNumber})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Position:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.position})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Department:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.department})]})]})]}),d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(ue,{className:"w-4 h-4 text-gray-600"}),"Warning Timeline"]}),d.jsxs("div",{className:"space-y-2 text-sm",children:[d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.issueDate})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.expiryDate})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Issued By:"}),d.jsx("span",{className:"font-medium text-gray-900",children:K.issuedByName})]}),d.jsxs("div",{className:"flex justify-between",children:[d.jsx("span",{className:"text-gray-600",children:"Status:"}),d.jsx("span",{className:"font-medium "+("delivered"===K.deliveryStatus?"text-green-600":"text-orange-600"),children:"delivered"===K.deliveryStatus?"Delivered":"Pending Delivery"})]})]})]})]}),(K.appealSubmitted||K.appealOutcome)&&d.jsxs("div",{className:"mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(Me,{className:"w-4 h-4 text-purple-600"}),"Appeal History"]}),K.appealSubmitted&&K.appealDetails&&d.jsxs("div",{className:"mb-4 p-3 bg-white rounded-lg border border-purple-100",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:"text-xs font-semibold text-purple-900 uppercase",children:"Employee Appeal"}),d.jsx("span",{className:"text-xs text-gray-600",children:K.appealDate})]}),d.jsxs("div",{className:"space-y-2 text-sm",children:[K.appealDetails.grounds&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Grounds:"}),d.jsx("p",{className:"text-gray-600 mt-1",children:K.appealDetails.grounds})]}),K.appealDetails.details&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Additional Details:"}),d.jsx("p",{className:"text-gray-600 mt-1",children:K.appealDetails.details})]}),K.appealDetails.requestedOutcome&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Requested Outcome:"}),d.jsx("p",{className:"text-gray-600 mt-1",children:K.appealDetails.requestedOutcome})]}),K.appealDetails.submittedBy&&d.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Submitted by: ",K.appealDetails.submittedBy]})]})]}),K.appealOutcome&&d.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-100",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:"text-xs font-semibold text-purple-900 uppercase",children:"HR Decision"}),d.jsx("span",{className:"text-xs text-gray-600",children:K.appealDecisionDate||"Pending"})]}),d.jsxs("div",{className:"space-y-2 text-sm",children:[d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsx("span",{className:"font-medium text-gray-700",children:"Outcome:"}),d.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("overturned"===K.appealOutcome?"bg-green-100 text-green-800":"upheld"===K.appealOutcome?"bg-red-100 text-red-800":"modified"===K.appealOutcome?"bg-blue-100 text-blue-800":"reduced"===K.appealOutcome?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"overturned"===K.appealOutcome?"Warning Overturned":"upheld"===K.appealOutcome?"Appeal Upheld - Warning Stands":"modified"===K.appealOutcome?"Warning Modified":"reduced"===K.appealOutcome?"Warning Reduced":K.appealOutcome})]}),K.appealReasoning&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"HR Reasoning:"}),d.jsx("p",{className:"text-gray-600 mt-1",children:K.appealReasoning})]}),K.hrNotes&&d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700",children:"HR Notes:"}),d.jsx("p",{className:"text-gray-600 mt-1",children:K.hrNotes})]}),K.followUpRequired&&d.jsx("div",{className:"mt-2 p-2 bg-yellow-50 rounded border border-yellow-200",children:d.jsxs("span",{className:"text-xs font-medium text-yellow-800",children:["âš ï¸ Follow-up required",K.followUpDate?` by ${K.followUpDate}`:""]})})]})]})]}),d.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:d.jsxs("div",{className:"flex items-center gap-3",children:[K.hasAudio&&d.jsxs("button",{onClick:Z,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",children:[d.jsx(ze,{className:"w-4 h-4"}),"Audio Recording"]}),d.jsxs("button",{onClick:X,className:"flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium",children:[d.jsx(ne,{className:"w-4 h-4"}),K.appealSubmitted||K.appealOutcome?"View PDF (with Appeal)":"View PDF"]}),K.hasSignatures&&d.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-3 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm",children:[d.jsx(Ae,{className:"w-4 h-4"}),"Signatures"]}),(K.appealSubmitted||K.appealOutcome)&&d.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[d.jsx(Me,{className:"w-4 h-4"}),"Print Appeal Report"]})]})})]})})]})}),A&&K?.hasAudio&&d.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{zIndex:m.modalNested1},children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),d.jsx("button",{onClick:()=>R(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5"})})]}),d.jsx("div",{className:"p-6",children:d.jsx(Is,{audioData:K.audioRecording,compact:!1})})]})}),_&&d.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{zIndex:m.modalNested1},children:d.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),d.jsx("button",{onClick:()=>I(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5"})})]}),d.jsx("div",{className:"p-6",children:K?.hasSignatures?d.jsxs("div",{className:"space-y-4",children:[K.signatures?.manager&&d.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[d.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Manager Signature"}),d.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:d.jsx("img",{src:K.signatures.manager,alt:"Manager Signature",className:"max-w-full h-20 mx-auto"})})]}),K.signatures?.employee&&d.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[d.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Employee Signature"}),d.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:d.jsx("img",{src:K.signatures.employee,alt:"Employee Signature",className:"max-w-full h-20 mx-auto"})})]})]}):d.jsxs("div",{className:"text-center py-8",children:[d.jsx(Ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),d.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),T&&d.jsx(ks,{isOpen:T,onClose:()=>P(!1),warningData:{selectedEmployee:{id:t.employeeId||"",firstName:t.employeeName||"Unknown",lastName:t.employeeLastName||"Employee",employeeId:t.employeeNumber||"",employeeNumber:t.employeeNumber||"",department:t.employeeDepartment||t.department||"",position:t.employeePosition||t.position||"",email:t.employeeEmail||""},selectedCategory:{id:t.categoryId||"",name:t.categoryName||t.category||"General",severity:"medium",description:t.categoryName||t.category||"General"},formData:{incidentDate:Os(t.incidentDate),incidentTime:t.incidentTime||"12:00",incidentLocation:t.incidentLocation||"",incidentDescription:t.incidentDescription||t.description||"",additionalNotes:t.additionalNotes||"",validityPeriod:t.validityPeriod||6,issueDate:Os(t.issueDate),status:t.status,pdfGeneratorVersion:t.pdfGeneratorVersion,pdfTemplateVersion:t.pdfTemplateVersion,pdfSettings:t.pdfSettings},signatures:t.signatures||{manager:null,employee:null},lraRecommendation:t.disciplineRecommendation||{category:t.categoryName||t.category||"General",recommendedLevel:t.level||"Counselling Session",suggestedLevel:t.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],activeWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:t.organizationId||""},onPDFGenerated:(e,a)=>{t.categoryName,t.category,t.signatures}}),A&&K?.hasAudio&&d.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:m.modalNested1},children:d.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),d.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",K.id," â€¢ ",K.employeeName]})]}),d.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5 text-gray-500"})})]}),d.jsx("div",{className:"p-6",children:d.jsx(Is,{audioRecording:K.audioRecording,warningId:K.id,showDownload:!0,showMetadata:!0,className:"w-full"})})]})}),_&&d.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:m.modalNested1},children:d.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),d.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",K.id," â€¢ ",K.employeeName]})]}),d.jsx("button",{onClick:()=>I(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5 text-gray-500"})})]}),d.jsx("div",{className:"p-6",children:K?.hasSignatures?d.jsxs(d.Fragment,{children:[d.jsx(Rs,{signatures:K.signatures,warningId:K.id,showTimestamps:!0,showVerification:!0,allowDownload:!0,className:"w-full mb-4"}),d.jsxs("div",{className:"flex gap-3",children:[K.signatures.manager&&d.jsxs("button",{onClick:()=>re("manager"),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[d.jsx(le,{className:"w-4 h-4 text-blue-600"}),d.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"View Manager Signature"})]}),K.signatures.employee&&d.jsxs("button",{onClick:()=>re("employee"),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[d.jsx(le,{className:"w-4 h-4 text-green-600"}),d.jsx("span",{className:"text-sm text-green-700 font-medium",children:"View Employee Signature"})]})]})]}):d.jsxs("div",{className:"text-center py-12",children:[d.jsx(Ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),d.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),d.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),L&&d.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:m.modalNested2},children:d.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:L.title}),L.subtitle&&d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:L.subtitle})]}),d.jsx("button",{onClick:()=>M(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:d.jsx(te,{className:"w-5 h-5 text-gray-500"})})]}),d.jsx("div",{className:"p-6",children:d.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:d.jsx("img",{src:L.signature,alt:L.title,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),d.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[d.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature â€¢ PNG format â€¢ Legally binding"}),d.jsxs("button",{onClick:()=>{const e=document.createElement("a");e.href=L.signature,e.download=`${L.title.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[d.jsx(Te,{className:"w-4 h-4"}),"Download PNG"]})]})]})})]}):null},Us=({physicalCopyLocation:e,className:t=""})=>d.jsx(g,{className:`bg-amber-50 dark:bg-amber-900/20 border-2 border-amber-500 ${t}`,children:d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center",children:d.jsx(ae,{className:"w-6 h-6 text-white"})}),d.jsxs("div",{className:"flex-1",children:[d.jsx("h3",{className:"text-base font-semibold text-amber-900 dark:text-amber-100",children:"âš ï¸ IMPORTANT: Physical Copy Required"}),d.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200 mt-1",children:"This warning was entered manually from a physical document"})]})]}),d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-amber-300 dark:border-amber-700",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"The system does NOT have:"}),d.jsxs("ul",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[d.jsxs("li",{className:"flex items-start gap-2",children:[d.jsx("span",{className:"text-red-500 font-bold",children:"âœ—"}),d.jsx("span",{children:"Digital signatures from manager and employee"})]}),d.jsxs("li",{className:"flex items-start gap-2",children:[d.jsx("span",{className:"text-red-500 font-bold",children:"âœ—"}),d.jsx("span",{children:"Audio recording of the disciplinary meeting"})]}),d.jsxs("li",{className:"flex items-start gap-2",children:[d.jsx("span",{className:"text-red-500 font-bold",children:"âœ—"}),d.jsx("span",{children:"PDF document with QR code verification"})]})]})]}),d.jsxs("div",{className:"bg-amber-100 dark:bg-amber-900/40 rounded-lg p-4 border border-amber-400 dark:border-amber-600",children:[d.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[d.jsx(we,{className:"w-5 h-5 text-amber-700 dark:text-amber-300 flex-shrink-0 mt-0.5"}),d.jsx("p",{className:"text-sm font-semibold text-amber-900 dark:text-amber-100",children:"Legal Compliance Requirement:"})]}),d.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200 ml-7",children:["You ",d.jsx("strong",{children:"MUST"})," keep the original signed physical document safe and accessible for potential legal proceedings or CCMA hearings. This digital record is supplementary only."]})]}),e&&d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-amber-300 dark:border-amber-700",children:d.jsxs("div",{className:"flex items-start gap-2",children:[d.jsx(ne,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Physical Copy Location:"}),d.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-900 px-3 py-2 rounded border border-gray-200 dark:border-gray-700",children:e})]})]})}),d.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 italic border-t border-amber-300 dark:border-amber-700 pt-3",children:d.jsxs("p",{children:[d.jsx("strong",{children:"Note:"})," Historical entries are fully integrated with the escalation system and will count toward the employee's progressive discipline record."]})})]})}),Vs=({value:e,onChange:t,min:a,max:s,label:r,className:n=""})=>{const[i,l]=C.useState(!1),o=C.useRef(null);C.useEffect(()=>{if(i&&o.current){const t=o.current,s=48,r=(e-a)*s-t.clientHeight/2+s/2;setTimeout(()=>{t.scrollTo({top:Math.max(0,r),behavior:"smooth"})},100)}},[i,e,a]);const c=(()=>{const e=[];for(let t=a;t<=s;t++)e.push(t);return e})();return d.jsxs("div",{className:`relative ${n}`,children:[d.jsx("div",{onClick:()=>l(!i),className:"w-24 h-20 cursor-pointer border-2 rounded-2xl flex items-center justify-center transition-all duration-200 hover:scale-105",style:{backgroundColor:"var(--color-card-background)",borderColor:i?"var(--color-primary)":"var(--color-border)",boxShadow:i?"0 0 0 3px var(--color-primary-light)":"0 4px 12px rgba(0, 0, 0, 0.08)"},children:d.jsx("span",{className:"text-3xl font-light",style:{color:"var(--color-text)",fontVariantNumeric:"tabular-nums"},children:e.toString().padStart(2,"0")})}),i&&d.jsx("div",{className:"absolute top-full left-0 mt-2 w-24 bg-white border-2 rounded-2xl shadow-lg z-10 overflow-hidden",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-primary)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.15)"},children:d.jsx("div",{ref:o,className:"max-h-48 overflow-y-auto scrollbar-thin",style:{scrollbarWidth:"thin",scrollbarColor:"var(--color-primary) transparent"},children:c.map(a=>d.jsx("button",{onClick:()=>(t(a),void l(!1)),className:"w-full h-12 flex items-center justify-center transition-all duration-150 hover:scale-105",style:{backgroundColor:a===e?"var(--color-primary-light)":"transparent",color:a===e?"var(--color-primary)":"var(--color-text)",fontWeight:a===e?"600":"400",fontVariantNumeric:"tabular-nums"},onMouseEnter:t=>{a!==e&&(t.currentTarget.style.backgroundColor="var(--color-muted)")},onMouseLeave:t=>{a!==e&&(t.currentTarget.style.backgroundColor="transparent")},children:d.jsx("span",{className:"text-lg",children:a.toString().padStart(2,"0")})},a))})}),d.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2",children:d.jsx("span",{className:"text-xs font-medium tracking-wider uppercase",style:{color:"var(--color-text-tertiary)"},children:r})})]})},qs=({label:e,value:t,onChange:a,type:s="date",icon:r,required:n=!1,disabled:i=!1,error:l,className:o=""})=>{const[c,m]=C.useState(!1),[g,x]=C.useState(t?new Date(t):null),[u,p]=C.useState(new Date),[h,y]=C.useState({hours:t?new Date(`1970-01-01T${t}`).getHours():9,minutes:t?new Date(`1970-01-01T${t}`).getMinutes():0}),f=C.useRef(null),v=C.useRef(null);C.useEffect(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&f.current&&!f.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),C.useEffect(()=>(c?(setTimeout(()=>{const e=v.current;e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[c]);const b=e=>{x(e);const t=e.toISOString().split("T")[0];a(t),m(!1)},N=(e,t)=>{y({hours:e,minutes:t});const s=`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;a(s)},j=(()=>{const e=u.getFullYear(),t=u.getMonth(),a=new Date(e,t,1),s=new Date(a);s.setDate(s.getDate()-a.getDay());const r=[];for(let n=0;n<42;n++){const e=new Date(s);e.setDate(s.getDate()+n),r.push(e)}return r})(),w=new Date,D={backgroundColor:l?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:l?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"};return d.jsxs("div",{className:`space-y-2 ${o}`,children:[d.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[r&&d.jsx(r,{className:"w-3 h-3 inline mr-1"}),e," ",n&&d.jsx("span",{style:{color:"var(--color-error)"},children:"*"})]}),d.jsxs("div",{className:"relative",ref:f,children:[d.jsxs("div",{onClick:()=>!i&&m(!c),className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm cursor-pointer flex items-center justify-between "+(i?"opacity-50 cursor-not-allowed":""),style:D,children:[d.jsx("span",{style:{color:t?"var(--color-text)":"var(--color-text-tertiary)"},children:"time"===s?t||"Select time...":g?g.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Select date..."}),"date"===s?d.jsx(Ne,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}):d.jsx(ue,{className:"w-4 h-4",style:{color:"var(--color-primary)"}})]}),c&&"undefined"!=typeof document&&k.createPortal(d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[10000]",onClick:()=>m(!1)}),d.jsx("div",{ref:v,className:"fixed inset-0 z-[10001] flex items-center justify-center p-4",children:d.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:e=>e.stopPropagation(),children:"date"===s?d.jsxs("div",{className:"p-4",children:[d.jsxs("div",{className:"flex items-center justify-between mb-4",children:[d.jsx("button",{onClick:()=>p(new Date(u.setMonth(u.getMonth()-1))),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",style:{color:"var(--color-text-secondary)"},children:d.jsx(Oe,{className:"w-4 h-4"})}),d.jsx("h3",{className:"font-semibold text-center flex-1",style:{color:"var(--color-text)"},children:u.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),d.jsx("button",{onClick:()=>p(new Date(u.setMonth(u.getMonth()+1))),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",style:{color:"var(--color-text-secondary)"},children:d.jsx($e,{className:"w-4 h-4"})})]}),d.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>d.jsx("div",{className:"text-xs font-medium text-center p-2",style:{color:"var(--color-text-secondary)"},children:e},e))}),d.jsx("div",{className:"grid grid-cols-7 gap-1",children:j.map((e,t)=>{const a=e.getMonth()===u.getMonth(),s=e.toDateString()===w.toDateString(),r=g&&e.toDateString()===g.toDateString();return d.jsx("button",{onClick:()=>a&&b(e),disabled:!a,className:"p-2 text-sm rounded-lg transition-all "+(a?"hover:bg-gray-100 cursor-pointer":"opacity-30 cursor-not-allowed"),style:{backgroundColor:r?"var(--color-primary)":s?"var(--color-primary-light)":"transparent",color:r?"white":s?"var(--color-primary)":"var(--color-text)",fontWeight:s||r?"600":"400"},children:e.getDate()},t)})}),d.jsx("div",{className:"mt-4 flex justify-center",children:d.jsx("button",{onClick:()=>b(w),className:"px-4 py-2 text-sm rounded-lg border transition-colors",style:{borderColor:"var(--color-primary)",color:"var(--color-primary)",backgroundColor:"transparent"},children:"Today"})})]}):d.jsxs("div",{className:"p-6",children:[d.jsx("div",{className:"text-center mb-6",children:d.jsx("h3",{className:"text-lg font-light tracking-wide",style:{color:"var(--color-text)",letterSpacing:"0.5px"},children:"Select Time"})}),d.jsxs("div",{className:"flex items-center justify-center gap-6 mb-8",children:[d.jsx(Vs,{value:h.hours,onChange:e=>N(e,h.minutes),min:0,max:23,label:"Hours"}),d.jsxs("div",{className:"flex flex-col items-center self-start mt-12",children:[d.jsx("div",{className:"w-3 h-3 rounded-full mb-3",style:{backgroundColor:"var(--color-primary)"}}),d.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--color-primary)"}})]}),d.jsx(Vs,{value:h.minutes,onChange:e=>N(h.hours,e),min:0,max:59,label:"Minutes"})]}),d.jsx("div",{className:"text-center mb-6",children:d.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full",style:{backgroundColor:"var(--color-muted)"},children:[d.jsx(ue,{className:"w-4 h-4 mr-2",style:{color:"var(--color-text-secondary)"}}),d.jsxs("span",{className:"text-lg font-medium tracking-wider",style:{color:"var(--color-text)",fontVariantNumeric:"tabular-nums"},children:[h.hours.toString().padStart(2,"0"),":",h.minutes.toString().padStart(2,"0")]})]})}),d.jsx("div",{className:"flex justify-center",children:d.jsx("button",{onClick:()=>m(!1),className:"px-8 py-3 rounded-xl font-medium tracking-wide transition-all duration-200 transform hover:scale-105 active:scale-95",style:{backgroundColor:"var(--color-primary)",color:"white",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.15)",letterSpacing:"0.5px"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 6px 24px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.15)"},children:"Done"})})]})})})]}),document.body)]}),l&&d.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[d.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:d.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),l]})]})},Bs=["Select Employee & Category","Enter Dates & Details","Physical Copy Confirmation","Review & Save"],Hs={counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},Gs=({isOpen:t,onClose:a,onSuccess:s,employees:r,categories:n,preSelectedEmployeeId:i,currentUserId:l,organizationId:o})=>{const[c,m]=C.useState(0),[u,p]=C.useState(!1),[h,b]=C.useState(null),[N,j]=C.useState({employeeId:i||"",categoryId:"",level:"",incidentDate:null,incidentTime:"09:00",issueDate:null,expiryDate:null,validityPeriod:6,title:"",description:"",incidentLocation:"",additionalNotes:"",hasPhysicalCopy:!1,physicalCopyLocation:"",historicalNotes:""}),w=C.useMemo(()=>r.find(e=>e.id===N.employeeId),[r,N.employeeId]),D=C.useMemo(()=>n.find(e=>e.id===N.categoryId),[n,N.categoryId]),S=C.useMemo(()=>D?.escalationPath?D.escalationPath:["counselling","verbal","first_written","second_written","final_written"],[D]),k=C.useCallback((e,t)=>{if(!e)return null;const a=new Date(e);return a.setMonth(a.getMonth()+t),a},[]),E=C.useCallback((e,t)=>{j(a=>{const s={...a,[e]:t};if("issueDate"===e||"validityPeriod"===e){const r="issueDate"===e?t:a.issueDate,n="validityPeriod"===e?t:a.validityPeriod;s.expiryDate=k(r,n)}return s})},[k]),F=C.useCallback(e=>{switch(e){case 0:return N.employeeId?N.categoryId?N.level?{isValid:!0}:{isValid:!1,error:"Please select a warning level"}:{isValid:!1,error:"Please select a category"}:{isValid:!1,error:"Please select an employee"};case 1:return N.incidentDate?N.issueDate?N.title.trim()?N.description.trim()?N.incidentLocation.trim()?N.issueDate>new Date?{isValid:!1,error:"Issue date cannot be in the future"}:N.expiryDate&&N.expiryDate<=N.issueDate?{isValid:!1,error:"Expiry date must be after issue date"}:{isValid:!0}:{isValid:!1,error:"Please enter incident location"}:{isValid:!1,error:"Please enter incident description"}:{isValid:!1,error:"Please enter a warning title"}:{isValid:!1,error:"Please enter issue date"}:{isValid:!1,error:"Please enter incident date"};case 2:return N.hasPhysicalCopy?{isValid:!0}:{isValid:!1,error:"You must confirm that a physical signed copy exists"};case 3:return{isValid:!0};default:return{isValid:!1}}},[N]),T=C.useCallback(()=>{const e=F(c);e.isValid?(b(null),m(e=>Math.min(e+1,3))):b(e.error||"Please complete all required fields")},[c,F]),P=C.useCallback(()=>{b(null),m(e=>Math.max(e-1,0))},[]),_=C.useCallback(async()=>{const t=F(2);if(t.isValid){p(!0),b(null);try{const{ShardedDataService:e}=await ee(async()=>{const{ShardedDataService:e}=await import("./business-owner-dashboard-C_-CP9x1.js").then(e=>e._);return{ShardedDataService:e}},__vite__mapDeps([0,1,2,3,4])),t={employeeId:N.employeeId,categoryId:N.categoryId,level:N.level,incidentDate:N.incidentDate,incidentTime:N.incidentTime,issueDate:N.issueDate,expiryDate:N.expiryDate,validityPeriod:N.validityPeriod,title:N.title,description:N.description,incidentLocation:N.incidentLocation,additionalNotes:N.additionalNotes,isHistoricalEntry:!0,hasPhysicalCopy:N.hasPhysicalCopy,physicalCopyLocation:N.physicalCopyLocation,historicalNotes:N.historicalNotes,enteredBy:l,enteredAt:new Date,issuedBy:l,status:"issued",isActive:!0,deliveryStatus:"delivered",followUpActions:[]};await e.createWarning(t,o),s(),a()}catch(r){e.error("Error creating historical warning:",r),b(r instanceof Error?r.message:"Failed to create warning")}finally{p(!1)}}else b(t.error||"Please complete all required fields")},[N,l,o,s,a,F]),I=C.useCallback(()=>{u||(m(0),b(null),j({employeeId:i||"",categoryId:"",level:"",incidentDate:null,incidentTime:"09:00",issueDate:null,expiryDate:null,validityPeriod:6,title:"",description:"",incidentLocation:"",additionalNotes:"",hasPhysicalCopy:!1,physicalCopyLocation:"",historicalNotes:""}),a())},[u,a,i]);return d.jsxs(y,{isOpen:t,onClose:I,title:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-amber-100 to-amber-50 dark:from-amber-900/40 dark:to-amber-900/20 flex items-center justify-center shadow-sm",children:d.jsx(ne,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),d.jsxs("div",{children:[d.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Manual Warning Entry"}),d.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:Bs[c]})]})]}),size:"lg",children:[d.jsx("div",{className:"flex items-center justify-between mb-4 px-4",children:[0,1,2,3].map(e=>d.jsxs("div",{className:"flex items-center flex-1",children:[d.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-xs font-semibold transition-all duration-200\n                "+(e<=c?"bg-blue-600 text-white shadow-sm":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"),children:e<c?d.jsx(me,{className:"w-3.5 h-3.5"}):e+1}),e<3&&d.jsx("div",{className:"flex-1 h-0.5 mx-2 transition-all duration-200\n                  "+(e<c?"bg-blue-600":"bg-gray-200 dark:bg-gray-700")})]},e))}),h&&d.jsx("div",{className:"mb-4 px-4",children:d.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-3 flex items-start gap-2",children:[d.jsx(ae,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),d.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:h})]})}),d.jsx("div",{className:"px-4 pb-4 max-h-[calc(100vh-300px)] overflow-y-auto",children:(()=>{switch(c){case 0:return d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx(v,{icon:fe,title:"Select Employee",subtitle:"Choose the employee who received this warning"}),d.jsxs("select",{value:N.employeeId,onChange:e=>E("employeeId",e.target.value),className:"mt-2 w-full h-11 px-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 hover:border-gray-300 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[d.jsx("option",{value:"",children:"Select an employee..."}),r.map(e=>d.jsxs("option",{value:e.id,children:[e.profile.firstName," ",e.profile.lastName," (",e.profile.employeeNumber,")"]},e.id))]})]}),d.jsxs("div",{children:[d.jsx(v,{icon:Ve,title:"Select Category",subtitle:"Choose the violation category"}),d.jsxs("select",{value:N.categoryId,onChange:e=>E("categoryId",e.target.value),className:"mt-2 w-full h-11 px-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 hover:border-gray-300 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[d.jsx("option",{value:"",children:"Select a category..."}),n.map(e=>d.jsx("option",{value:e.id,children:e.name},e.id))]})]}),N.categoryId&&d.jsxs("div",{children:[d.jsx(v,{icon:ae,title:"Warning Level",subtitle:"Select the severity level given in the original warning"}),d.jsxs("select",{value:N.level,onChange:e=>E("level",e.target.value),className:"mt-2 w-full h-11 px-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 hover:border-gray-300 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[d.jsx("option",{value:"",children:"Select warning level..."}),S.map(e=>d.jsx("option",{value:e,children:Hs[e]||e},e))]})]})]});case 1:return d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{children:[d.jsx(qs,{label:"Incident Date",value:N.incidentDate?N.incidentDate.toISOString().split("T")[0]:"",onChange:e=>E("incidentDate",e?new Date(e):null),icon:Ne,required:!0}),d.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"When did the incident occur?"})]}),d.jsx(f,{icon:ue,label:"Incident Time",type:"time",value:N.incidentTime,onChange:e=>E("incidentTime",e)}),d.jsxs("div",{children:[d.jsx(qs,{label:"Issue Date",value:N.issueDate?N.issueDate.toISOString().split("T")[0]:"",onChange:e=>E("issueDate",e?new Date(e):null),icon:Ae,required:!0}),d.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"When was the warning issued?"})]}),d.jsxs("div",{children:[d.jsx(v,{icon:ue,title:"Validity Period",subtitle:"How long is this warning active?"}),d.jsxs("select",{value:N.validityPeriod,onChange:e=>E("validityPeriod",parseInt(e.target.value)),className:"w-full h-11 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent",children:[d.jsx("option",{value:3,children:"3 months"}),d.jsx("option",{value:6,children:"6 months"}),d.jsx("option",{value:12,children:"12 months"})]}),N.expiryDate&&d.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Will expire on: ",N.expiryDate.toLocaleDateString()]})]}),d.jsx(f,{icon:ne,label:"Warning Title",placeholder:"Brief summary of the warning",value:N.title,onChange:e=>E("title",e)}),d.jsx(f,{icon:Ue,label:"Incident Location",placeholder:"Where did the incident occur?",value:N.incidentLocation,onChange:e=>E("incidentLocation",e)}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Incident Description *"}),d.jsx("textarea",{value:N.description,onChange:e=>E("description",e.target.value),rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Describe what happened in detail..."})]}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Notes (Optional)"}),d.jsx("textarea",{value:N.additionalNotes,onChange:e=>E("additionalNotes",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Any additional context or notes..."})]})]});case 2:return d.jsxs("div",{className:"space-y-4",children:[d.jsx(g,{children:d.jsx("div",{className:"space-y-4",children:d.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:N.hasPhysicalCopy,onChange:e=>E("hasPhysicalCopy",e.target.checked),className:"w-5 h-5 mt-0.5 rounded border-gray-300 text-primary focus:ring-primary"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"I confirm the physical signed copy exists"}),d.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Required: You must have access to the original signed warning document"})]})]})})}),N.hasPhysicalCopy&&d.jsx(f,{icon:ne,label:"Physical Copy Location (Optional)",placeholder:"e.g., Filing Cabinet A3, HR Office",value:N.physicalCopyLocation,onChange:e=>E("physicalCopyLocation",e)}),d.jsxs("div",{children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Historical Entry Notes (Optional)"}),d.jsx("textarea",{value:N.historicalNotes,onChange:e=>E("historicalNotes",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Any additional context about this historical entry..."})]}),d.jsx(Us,{physicalCopyLocation:N.physicalCopyLocation||void 0})]});case 3:return d.jsxs("div",{className:"space-y-4",children:[d.jsx(g,{children:d.jsxs("div",{className:"space-y-4",children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-2",children:"Warning Summary"}),d.jsxs("div",{className:"space-y-3 text-sm",children:[d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Employee:"}),d.jsxs("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:[w?.profile.firstName," ",w?.profile.lastName]})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Category:"}),d.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:D?.name})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Level:"}),d.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:Hs[N.level]||N.level})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Validity:"}),d.jsxs("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:[N.validityPeriod," months"]})]})]}),d.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Incident Date:"}),d.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:N.incidentDate?.toLocaleDateString()})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Issue Date:"}),d.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:N.issueDate?.toLocaleDateString()})]})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Title:"}),d.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:N.title})]}),d.jsxs("div",{children:[d.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Description:"}),d.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:N.description})]})]})]})}),d.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(ae,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("p",{className:"text-sm font-semibold text-red-900 dark:text-red-100 mb-1",children:"This warning has NO digital signatures or audio recording"}),d.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:"Ensure the physical signed document is kept safe for legal compliance"})]})]})})]});default:return null}})()}),d.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-4 py-4 flex items-center justify-between",children:[d.jsx(x,{variant:"outline",onClick:0===c?I:P,disabled:u,icon:0===c?te:Oe,children:0===c?"Cancel":"Back"}),d.jsx(x,{onClick:3===c?_:T,disabled:u,className:"flex items-center justify-center gap-2",children:u?"Saving...":3===c?d.jsxs(d.Fragment,{children:["Save Historical Warning ",d.jsx(We,{className:"w-4 h-4"})]}):d.jsxs(d.Fragment,{children:["Next ",d.jsx($e,{className:"w-4 h-4"})]})})]})]})};const Ys=new class{async getManagers(t){try{const a=(await i.queryDocuments(t,"users")).documents.filter(e=>"hr-manager"===e.role?.id||"hod-manager"===e.role?.id).map(e=>({id:e.id,uid:e.uid||e.id,firstName:e.firstName||e.profile?.firstName||"Unknown",lastName:e.lastName||e.profile?.lastName||"User",email:e.email,role:e.role,departmentIds:e.departmentIds||[],organizationId:e.organizationId||t,isActive:!1!==e.isActive,createdAt:e.createdAt||new Date,updatedAt:e.updatedAt}));return e.success(`âœ… Loaded ${a.length} managers`),a}catch(a){throw e.error("Failed to fetch managers:",a),new Error("Failed to load managers. Please try again.")}}async getManagerById(t,a){try{const e=await i.getDocument(t,"users",a);if(!e)return null;if("hr-manager"!==e.role?.id&&"hod-manager"!==e.role?.id)throw new Error("User is not a manager");return{id:e.id,uid:e.uid||e.id,firstName:e.firstName||e.profile?.firstName||"Unknown",lastName:e.lastName||e.profile?.lastName||"User",email:e.email,role:e.role,departmentIds:e.departmentIds||[],organizationId:e.organizationId||t,isActive:!1!==e.isActive,createdAt:e.createdAt||new Date,updatedAt:e.updatedAt}}catch(s){throw e.error("Failed to fetch manager:",s),s}}async getManagerEmployees(t,a){try{const s=(await i.queryDocuments(t,"employees")).documents.filter(e=>{const t=b(e.employment),s=t.includes(a)&&!1!==e.isActive;return e.id,e.profile,e.profile,t.includes(a),e.isActive,s});return e.success(`âœ… Found ${s.length} employees for manager ${a}`),s}catch(s){throw e.error("Failed to fetch manager employees:",s),new Error("Failed to load manager employees. Please try again.")}}async getManagerEmployeeCounts(t,a){try{const e=(await i.queryDocuments(t,"employees")).documents.filter(e=>!1!==e.isActive),s=new Map;return a.forEach(e=>s.set(e.id,0)),e.forEach(e=>{b(e.employment).forEach(e=>{s.has(e)&&s.set(e,(s.get(e)||0)+1)})}),s}catch(s){return e.error("Failed to get employee counts:",s),new Map}}async getManagerStats(t){try{const e=await this.getManagers(t),a=await this.getManagerEmployeeCounts(t,e),s=e.filter(e=>"hr-manager"===e.role.id).length,r=e.filter(e=>"hod-manager"===e.role.id).length,n=e.filter(e=>e.departmentIds&&e.departmentIds.length>0).length,i=Array.from(a.values()).reduce((e,t)=>e+t,0),l=e.length>0?Math.round(i/e.length):0;return{totalManagers:e.length,hrManagers:s,hodManagers:r,managersWithDepartments:n,managersWithoutDepartments:e.length-n,totalEmployeesUnderManagement:i,averageEmployeesPerManager:l}}catch(a){throw e.error("Failed to calculate manager stats:",a),a}}async promoteEmployeeToManager(t,a,s,r){try{const n=K(),l=J(n,"createOrganizationUser"),o=await i.getDocument(t,"employees",a);if(!o)throw new Error("Employee not found");if(!o.profile||!o.profile.email)throw new Error("Employee must have a valid email address");if(!o.profile.firstName||!o.profile.lastName)throw new Error("Employee must have first name and last name");const c="temp123";if(await l({organizationId:t,email:o.profile.email,password:c,role:s,firstName:o.profile.firstName,lastName:o.profile.lastName,departmentIds:r||[],employeeId:a,updateEmployeeEmail:!0}),r&&r.length>0){const e=`${o.profile.firstName} ${o.profile.lastName}`.trim(),s=o.profile.email;await new Promise(e=>setTimeout(e,1e3));const n=await i.getDocument(t,"users",a);if(n){const l=n.id||a;for(const a of r)await i.updateDocument(t,"departments",a,{managerId:l,managerName:e,managerEmail:s})}}e.success(`âœ… Employee ${a} promoted to ${s}`)}catch(n){throw e.error("Failed to promote employee:",n),new Error(n.message||"Failed to promote employee. Please try again.")}}async demoteManagerToEmployee(t,a,s){try{const r=await i.getDocument(t,"users",a),n=r&&r.departmentIds||[];if(s){const e=await this.getManagerEmployees(t,a);for(const r of e){const e=b(r.employment).filter(e=>e!==a).concat(s);await i.updateDocument(t,"employees",r.id,{"employment.managerIds":e})}e.length}for(const e of n)await i.updateDocument(t,"departments",e,{managerId:null,managerName:null,managerEmail:null});await i.updateDocument(t,"users",a,{role:{id:"employee",name:"Employee",description:"Regular employee",level:0},departmentIds:[]}),e.warn("âš ï¸ Auth custom claims not updated - requires backend function"),e.success(`âœ… Manager ${a} demoted to employee`)}catch(r){throw e.error("Failed to demote manager:",r),new Error(r.message||"Failed to demote manager. Please try again.")}}async updateManagerDepartments(t,a,s){try{const r=await i.getDocument(t,"users",a);if(!r)throw new Error("Manager not found");const n=`${r.firstName||""} ${r.lastName||""}`.trim(),l=r.email,o=r.departmentIds||[];await i.updateDocument(t,"users",a,{departmentIds:s});const c=(await i.queryDocuments(t,"departments")).documents,d=s.filter(e=>!o.includes(e)),m=o.filter(e=>!s.includes(e));for(const e of m){const s=c.find(t=>t.id===e);s&&s.managerId===a&&await i.updateDocument(t,"departments",e,{managerId:null,managerName:null,managerEmail:null})}for(const e of d)await i.updateDocument(t,"departments",e,{managerId:a,managerName:n,managerEmail:l});e.success(`âœ… Updated department assignments for manager ${a}`)}catch(r){throw e.error("Failed to update manager departments:",r),new Error(r.message||"Failed to update departments. Please try again.")}}async archiveManager(t,a,s,r){try{const n=await i.getDocument(t,"users",a),l=n&&n.departmentIds||[];if(r){const e=await this.getManagerEmployees(t,a);for(const s of e){const e=b(s.employment).filter(e=>e!==a).concat(r);await i.updateDocument(t,"employees",s.id,{"employment.managerIds":e})}}for(const e of l)await i.updateDocument(t,"departments",e,{managerId:null,managerName:null,managerEmail:null});const o=Q().currentUser;await i.updateDocument(t,"users",a,{isActive:!1,archivedAt:Z.now(),archivedBy:o?.uid||"system",archiveReason:s}),e.success(`âœ… Manager ${a} archived successfully`)}catch(n){throw e.error("Failed to archive manager:",n),new Error(n.message||"Failed to archive manager. Please try again.")}}async restoreManager(t,a){try{const s=Q().currentUser;await i.updateDocument(t,"users",a,{isActive:!0,restoredAt:Z.now(),restoredBy:s?.uid||"system"}),e.success(`âœ… Manager ${a} restored successfully`)}catch(s){throw e.error("Failed to restore manager:",s),new Error(s.message||"Failed to restore manager. Please try again.")}}};const Ks=({stats:e,loading:t})=>{if(t)return d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[...Array(4)].map((e,t)=>d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 animate-pulse",children:[d.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-2"}),d.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"})]},t))});if(!e)return null;const a=[{label:"Total Managers",value:e.totalManagers,icon:qe,color:"blue",bgColor:"bg-blue-50",textColor:"text-blue-700",iconColor:"text-blue-600"},{label:"HR Managers",value:e.hrManagers,icon:Le,color:"green",bgColor:"bg-green-50",textColor:"text-green-700",iconColor:"text-green-600"},{label:"HOD Managers",value:e.hodManagers,icon:Be,color:"purple",bgColor:"bg-purple-50",textColor:"text-purple-700",iconColor:"text-purple-600"},{label:"Employees Under Management",value:e.totalEmployeesUnderManagement,icon:He,color:"orange",bgColor:"bg-orange-50",textColor:"text-orange-700",iconColor:"text-orange-600"}];return d.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:a.map((e,t)=>d.jsx("div",{className:`${e.bgColor} border border-${e.color}-200 rounded-lg p-4`,children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("p",{className:`text-sm font-medium ${e.textColor}`,children:e.label}),d.jsx("p",{className:`text-2xl font-bold ${e.textColor} mt-1`,children:e.value})]}),d.jsx(e.icon,{className:`w-8 h-8 ${e.iconColor} opacity-70`})]})},t))})},Js=({managers:e,onViewDetails:t,onEdit:a,onDemote:s,onArchive:r})=>{const[n,i]=C.useState("lastName"),[l,o]=C.useState("asc"),c=e=>{n===e?o("asc"===l?"desc":"asc"):(i(e),o("asc"))},m=[...e].sort((e,t)=>{const a=e[n],s=t[n];return void 0===a||void 0===s?0:"string"==typeof a&&"string"==typeof s?"asc"===l?a.localeCompare(s):s.localeCompare(a):"number"==typeof a&&"number"==typeof s?"asc"===l?a-s:s-a:0});return 0===e.length?d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[d.jsx(qe,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),d.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Managers Found"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"There are currently no managers in your organization."}),d.jsx("p",{className:"text-sm text-gray-500",children:'Use the "Promote Employee" button to create managers.'})]}):d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[d.jsx("div",{className:"hidden md:block overflow-x-auto",children:d.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[d.jsx("thead",{className:"bg-gray-50",children:d.jsxs("tr",{children:[d.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>c("lastName"),children:d.jsxs("div",{className:"flex items-center gap-2",children:["Name","lastName"===n&&d.jsx("span",{children:"asc"===l?"â†‘":"â†“"})]})}),d.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),d.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>c("role"),children:d.jsxs("div",{className:"flex items-center gap-2",children:["Role","role"===n&&d.jsx("span",{children:"asc"===l?"â†‘":"â†“"})]})}),d.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departments"}),d.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>c("employeeCount"),children:d.jsxs("div",{className:"flex items-center gap-2",children:["Direct Reports","employeeCount"===n&&d.jsx("span",{children:"asc"===l?"â†‘":"â†“"})]})}),d.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),d.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(e=>d.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[d.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:d.jsxs("div",{className:"flex items-center",children:[d.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold text-sm",children:[e.firstName.charAt(0),e.lastName.charAt(0)]}),d.jsx("div",{className:"ml-3",children:d.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]})})]})}),d.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:d.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[d.jsx(ye,{className:"w-3 h-3"}),e.email]})}),d.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:d.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("hr-manager"===e.role.id?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:e.role.name})}),d.jsx("td",{className:"px-4 py-3",children:d.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[d.jsx(Be,{className:"w-3 h-3"}),e.departmentNames&&e.departmentNames.length>0?d.jsx("span",{children:e.departmentNames.join(", ")}):d.jsx("span",{className:"text-gray-400 italic",children:"No departments"})]})}),d.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:d.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-900 font-medium",children:[d.jsx(qe,{className:"w-3 h-3"}),e.employeeCount||0]})}),d.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:d.jsxs("div",{className:"flex items-center justify-end gap-2",children:[d.jsx("button",{onClick:()=>t(e),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"View Details",children:d.jsx(xe,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>a(e),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50",title:"Edit Manager",children:d.jsx(Ge,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>s(e),className:"text-orange-600 hover:text-orange-900 p-1 rounded hover:bg-orange-50",title:"Demote to Employee",children:d.jsx(Ye,{className:"w-4 h-4"})}),d.jsx("button",{onClick:()=>r(e),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Archive Manager",children:d.jsx(Ke,{className:"w-4 h-4"})})]})})]},e.id))})]})}),d.jsx("div",{className:"md:hidden divide-y divide-gray-200",children:m.map(e=>d.jsxs("div",{className:"p-4 hover:bg-gray-50",children:[d.jsxs("div",{className:"flex items-start justify-between mb-3",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold",children:[e.firstName.charAt(0),e.lastName.charAt(0)]}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),d.jsx("div",{className:"text-sm text-gray-600",children:e.email})]})]}),d.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("hr-manager"===e.role.id?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:e.role.name})]}),d.jsxs("div",{className:"space-y-2 mb-3",children:[d.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[d.jsx(Be,{className:"w-4 h-4"}),d.jsx("span",{children:e.departmentNames&&e.departmentNames.length>0?e.departmentNames.join(", "):"No departments"})]}),d.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[d.jsx(qe,{className:"w-4 h-4"}),d.jsxs("span",{children:[e.employeeCount||0," Direct Reports"]})]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:()=>t(e),className:"flex-1 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100",children:"View"}),d.jsx("button",{onClick:()=>a(e),className:"flex-1 px-3 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-medium hover:bg-green-100",children:"Edit"}),d.jsx("button",{onClick:()=>s(e),className:"flex-1 px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-sm font-medium hover:bg-orange-100",children:"Demote"}),d.jsx("button",{onClick:()=>r(e),className:"px-3 py-2 bg-red-50 text-red-700 rounded-lg text-sm font-medium hover:bg-red-100",children:d.jsx(Ke,{className:"w-4 h-4"})})]})]},e.id))})]})},Qs=({isOpen:t,onClose:a,manager:s,onUpdate:r})=>{const[n,l]=C.useState([]),[o,c]=C.useState([]),[m,g]=C.useState(s.departmentIds||[]),[x,u]=C.useState(!1),[p,h]=C.useState(!1),[f,v]=C.useState(!1),[j,w]=C.useState(null),[D,S]=C.useState(!1),[k,E]=C.useState([]),[F,T]=C.useState(""),[P,_]=C.useState(""),[I,A]=C.useState(!1);C.useEffect(()=>{(async()=>{if(s&&t){v(!0);try{const[e,t]=await Promise.all([Ys.getManagerEmployees(s.organizationId,s.id),N.getDepartments(s.organizationId)]);l(e),c(t),e.length,t.length}catch(a){e.error("Failed to load manager data:",a)}finally{v(!1)}}})()},[s,t]),C.useEffect(()=>{g(s.departmentIds||[]),u(!1)},[s]),C.useEffect(()=>{D&&R()},[D]);const R=async()=>{if(s&&t)try{const e=(await i.queryDocuments(s.organizationId,"employees")).documents.filter(e=>{const t=b(e.employment);return!1!==e.isActive&&!t.includes(s.id)});E(e)}catch(a){e.error("Failed to load available employees:",a)}},L=k.filter(e=>{if(!e.profile)return!1;const t=F.toLowerCase(),a=`${e.profile.firstName||""} ${e.profile.lastName||""}`.toLowerCase(),s=e.profile.employeeNumber?.toLowerCase()||"",r=e.profile.email?.toLowerCase()||"",n=e.profile.position?.toLowerCase()||"";return a.includes(t)||s.includes(t)||r.includes(t)||n.includes(t)});return d.jsx(y,{isOpen:t,onClose:a,title:"Manager Details",subtitle:`${s.firstName} ${s.lastName}`,size:"lg",children:d.jsx("div",{className:"p-6",children:f?d.jsx("div",{className:"flex items-center justify-center py-12",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):d.jsxs("div",{className:"space-y-6",children:[d.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-start gap-4",children:[d.jsxs("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-xl",children:[s.firstName.charAt(0),s.lastName.charAt(0)]}),d.jsxs("div",{className:"flex-1",children:[d.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:[s.firstName," ",s.lastName]}),d.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[d.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("hr-manager"===s.role.id?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:s.role.name}),s.isActive&&d.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"})]})]})]})}),d.jsxs("div",{children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(ye,{className:"w-4 h-4"}),"Contact Information"]}),d.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-2",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Email"}),d.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.email})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"User ID"}),d.jsx("span",{className:"text-sm font-mono text-gray-900",children:s.id})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600",children:"Created"}),d.jsx("span",{className:"text-sm text-gray-900",children:(e=>{if(!e)return"N/A";try{return e.toDate&&"function"==typeof e.toDate?e.toDate().toLocaleDateString():e instanceof Date?e.toLocaleDateString():new Date(e).toLocaleDateString()}catch{return"N/A"}})(s.createdAt)})]})]})]}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[d.jsx(Be,{className:"w-4 h-4"}),"Department Assignments"]}),x?d.jsxs("div",{className:"flex gap-2",children:[d.jsxs("button",{onClick:()=>{g(s.departmentIds||[]),u(!1),w(null)},disabled:p,className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:[d.jsx(te,{className:"w-3 h-3"}),"Cancel"]}),d.jsxs("button",{onClick:async()=>{h(!0),w(null);try{await r(s.id,m),u(!1)}catch(t){e.error("Failed to update departments:",t),w(t.message||"Failed to update departments. Please try again.")}finally{h(!1)}},disabled:p,className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[d.jsx(We,{className:"w-3 h-3"}),p?"Saving...":"Save"]})]}):d.jsxs("button",{onClick:()=>u(!0),className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100",children:[d.jsx(Ge,{className:"w-3 h-3"}),"Edit"]})]}),x?d.jsx("div",{className:"border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:0===o.length?d.jsx("p",{className:"text-sm text-gray-500",children:"No departments available"}):d.jsx("div",{className:"space-y-2",children:o.map(e=>d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[d.jsx("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>{return t=e.id,void g(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),d.jsxs("div",{className:"flex-1",children:[d.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&d.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.id))})}):d.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:s.departmentNames&&s.departmentNames.length>0?d.jsx("div",{className:"flex flex-wrap gap-2",children:s.departmentNames.map((e,t)=>d.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-medium bg-blue-100 text-blue-800",children:e},t))}):d.jsx("p",{className:"text-sm text-gray-500 italic",children:"No departments assigned"})}),j&&d.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:d.jsx("p",{className:"text-sm text-red-800",children:j})})]}),d.jsxs("div",{children:[d.jsxs("div",{className:"flex items-center justify-between mb-3",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[d.jsx(qe,{className:"w-4 h-4"}),"Direct Reports (",n.length,")"]}),!D&&d.jsxs("button",{onClick:()=>S(!0),className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100",children:[d.jsx(Je,{className:"w-3 h-3"}),"Add Employee"]})]}),D&&d.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[d.jsxs("div",{className:"flex items-center justify-between mb-2",children:[d.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Assign Employee to Manager"}),d.jsx("button",{onClick:()=>{S(!1),_(""),T("")},className:"text-gray-400 hover:text-gray-600",children:d.jsx(te,{className:"w-4 h-4"})})]}),d.jsxs("div",{className:"relative mb-2",children:[d.jsx(Qe,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),d.jsx("input",{type:"text",placeholder:"Search employees by name, number, position...",value:F,onChange:e=>T(e.target.value),className:"w-full pl-7 pr-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),d.jsxs("div",{className:"mb-2",children:[d.jsxs("select",{value:P,onChange:e=>_(e.target.value),className:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",size:5,children:[d.jsx("option",{value:"",children:"Select an employee..."}),L.map(e=>d.jsxs("option",{value:e.id,children:[e.profile?.firstName||"Unknown"," ",e.profile?.lastName||"Employee"," (",e.profile?.employeeNumber||"N/A",") - ",e.profile?.position||"No Position"]},e.id))]}),d.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[L.length," available employee",1!==L.length?"s":""]})]}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("button",{onClick:async()=>{if(P&&s){A(!0),w(null);try{const t=await i.getDocument(s.organizationId,"employees",P);if(t){const e=b(t.employment),a=[...new Set([...e,s.id])];await i.updateDocument(s.organizationId,"employees",P,{"employment.managerIds":a})}const a=await Ys.getManagerEmployees(s.organizationId,s.id);l(a),await R(),S(!1),_(""),T(""),e.success("Employee assigned successfully")}catch(t){e.error("Failed to assign employee:",t),w(t.message||"Failed to assign employee. Please try again.")}finally{A(!1)}}},disabled:!P||I,className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:I?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Assigning..."]}):d.jsxs(d.Fragment,{children:[d.jsx(Je,{className:"w-3 h-3"}),"Assign Employee"]})}),d.jsx("button",{onClick:()=>{S(!1),_(""),T("")},disabled:I,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),d.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg max-h-64 overflow-y-auto",children:0===n.length?d.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No employees currently assigned to this manager"}):d.jsx("div",{className:"divide-y divide-gray-200",children:n.map(t=>{const a=t.profile?.firstName||"Unknown",r=t.profile?.lastName||"Employee",n=t.profile?.position||"No Position",o=t.profile?.department||"No Department",c=t.profile?.employeeNumber||"N/A";return d.jsx("div",{className:"p-3 hover:bg-gray-100 transition-colors",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-semibold text-xs",children:[a.charAt(0),r.charAt(0)]}),d.jsxs("div",{children:[d.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[a," ",r]}),d.jsxs("div",{className:"text-xs text-gray-600",children:[n," â€¢ ",o]})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("div",{className:"text-xs text-gray-500",children:c}),d.jsx("button",{onClick:()=>(async t=>{if(s)try{const a=await i.getDocument(s.organizationId,"employees",t);if(a){const r=b(a.employment).filter(e=>e!==s.id);await i.updateDocument(s.organizationId,"employees",t,{"employment.managerIds":r});const n=await Ys.getManagerEmployees(s.organizationId,s.id);l(n),e.success("Manager removed from employee")}}catch(a){e.error("Failed to remove manager:",a),w(a.message||"Failed to remove manager. Please try again.")}})(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Remove manager from employee",children:d.jsx(Ye,{className:"w-4 h-4"})})]})]})},t.id)})})})]})]})})})},Zs=({isOpen:t,onClose:a,onPromote:s})=>{const{organization:r}=o(),[n,l]=C.useState([]),[c,m]=C.useState([]),[g,x]=C.useState(""),[u,p]=C.useState("hod-manager"),[h,f]=C.useState([]),[v,b]=C.useState(""),[j,w]=C.useState(!1),[D,S]=C.useState(!1),[k,E]=C.useState(null);C.useEffect(()=>{(async()=>{if(r?.id&&t){S(!0),E(null);try{const t=await i.queryDocuments(r.id,"employees"),a=(await i.queryDocuments(r.id,"users")).documents.filter(e=>"hr-manager"===e.role?.id||"hod-manager"===e.role?.id).map(e=>e.id),s=t.documents.filter(t=>!1!==t.isActive&&!a.includes(t.id)&&(!!(t.profile&&t.profile.email&&t.profile.firstName&&t.profile.lastName)||(e.warn(`Skipping employee ${t.id} - missing required profile data`),!1)));l(s);const n=await N.getDepartments(r.id);m(n),s.length,n.length}catch(a){e.error("Failed to load data:",a),E("Failed to load employees. Please try again.")}finally{S(!1)}}})()},[r?.id,t]);const F=n.filter(e=>{if(!e.profile)return!1;return`${e.profile.firstName||""} ${e.profile.lastName||""} ${e.profile.email||""} ${e.profile.employeeNumber||""}`.toLowerCase().includes(v.toLowerCase())}),T=n.find(e=>e.id===g);return d.jsx(y,{isOpen:t,onClose:a,title:"Promote Employee to Manager",subtitle:"Select an employee and assign manager role",size:"lg",children:d.jsx("div",{className:"p-6",children:D?d.jsx("div",{className:"flex items-center justify-center py-12",children:d.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee *"}),d.jsx("input",{type:"text",placeholder:"Search by name, email, or employee number...",value:v,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg mb-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),d.jsxs("select",{value:g,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"-- Select an employee --"}),F.map(e=>d.jsxs("option",{value:e.id,children:[e.profile?.firstName||"Unknown"," ",e.profile?.lastName||"Employee"," (",e.profile?.employeeNumber||"N/A",") - ",e.profile?.department||"No Department"]},e.id))]}),0===F.length&&v&&d.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:['No employees found matching "',v,'"']})]}),T&&T.profile&&d.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(Je,{className:"w-5 h-5 text-blue-600 mt-0.5"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-blue-900",children:"Selected Employee"}),d.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[T.profile.firstName||"Unknown"," ",T.profile.lastName||"Employee"]}),d.jsxs("p",{className:"text-xs text-blue-600 mt-0.5",children:[T.profile.email||"No Email"," â€¢ ",T.profile.department||"No Department"]})]})]})}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Role *"}),d.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[d.jsxs("button",{type:"button",onClick:()=>p("hod-manager"),className:"p-4 border-2 rounded-lg transition-all "+("hod-manager"===u?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:[d.jsx("div",{className:"font-medium text-gray-900",children:"HOD Manager"}),d.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Department head with team oversight"})]}),d.jsxs("button",{type:"button",onClick:()=>p("hr-manager"),className:"p-4 border-2 rounded-lg transition-all "+("hr-manager"===u?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:[d.jsx("div",{className:"font-medium text-gray-900",children:"HR Manager"}),d.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Full HR access across all departments"})]})]})]}),d.jsxs("div",{className:"mb-6",children:[d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assign Departments (Optional)"}),d.jsx("div",{className:"border border-gray-200 rounded-lg p-3 max-h-40 overflow-y-auto",children:0===c.length?d.jsx("p",{className:"text-sm text-gray-500",children:"No departments available"}):d.jsx("div",{className:"space-y-2",children:c.map(e=>d.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[d.jsx("input",{type:"checkbox",checked:h.includes(e.id),onChange:()=>{return t=e.id,void f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),d.jsx("span",{className:"text-sm text-gray-900",children:e.name}),e.description&&d.jsxs("span",{className:"text-xs text-gray-500",children:["- ",e.description]})]},e.id))})})]}),T&&T.profile&&d.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(ie,{className:"w-5 h-5 text-green-600 mt-0.5"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-green-900",children:"Ready to Promote"}),d.jsxs("p",{className:"text-sm text-green-700 mt-1",children:[d.jsxs("strong",{children:[T.profile.firstName||"Unknown"," ",T.profile.lastName||"Employee"]})," ","will be promoted to ",d.jsx("strong",{children:"hr-manager"===u?"HR Manager":"HOD Manager"}),h.length>0&&d.jsxs(d.Fragment,{children:[" with access to"," ",d.jsx("strong",{children:h.map(e=>c.find(t=>t.id===e)?.name).filter(Boolean).join(", ")})]}),"."]})]})]})}),k&&d.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(Ze,{className:"w-5 h-5 text-red-600 mt-0.5"}),d.jsx("p",{className:"text-sm text-red-800",children:k})]})}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:a,disabled:j,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),d.jsx("button",{onClick:async()=>{if(g){w(!0),E(null);try{await s(g,u,h.length>0?h:void 0),x(""),p("hod-manager"),f([]),b(""),a()}catch(t){e.error("Failed to promote employee:",t),E(t.message||"Failed to promote employee. Please try again.")}finally{w(!1)}}else E("Please select an employee to promote")},disabled:!g||j,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:j?"Promoting...":"Promote to Manager"})]})]})})})},Xs=({isOpen:t,onClose:a,manager:s,onDemote:r,availableManagers:n})=>{const[i,l]=C.useState([]),[o,c]=C.useState(!1),[m,g]=C.useState(""),[x,u]=C.useState(!1),[p,h]=C.useState(null);C.useEffect(()=>{(async()=>{if(s&&t){c(!0);try{const e=await Ys.getManagerEmployees(s.organizationId,s.id);l(e),e.length,s.id}catch(a){e.error("Failed to load manager employees:",a)}finally{c(!1)}}})()},[s,t]);const f=n.find(e=>e.id===m);return d.jsx(y,{isOpen:t,onClose:a,title:"Demote Manager to Employee",subtitle:`Remove manager privileges from ${s.firstName} ${s.lastName}`,size:"md",children:d.jsxs("div",{className:"p-6",children:[d.jsx("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(ae,{className:"w-5 h-5 text-orange-600 mt-0.5"}),d.jsxs("div",{children:[d.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Permanent Action"}),d.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"This will remove all manager privileges and access rights. This action cannot be undone."})]})]})}),d.jsx("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsxs("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold",children:[s.firstName.charAt(0),s.lastName.charAt(0)]}),d.jsxs("div",{children:[d.jsxs("p",{className:"font-medium text-gray-900",children:[s.firstName," ",s.lastName]}),d.jsx("p",{className:"text-sm text-gray-600",children:s.email}),d.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current Role: ",d.jsx("span",{className:"font-medium",children:s.role.name})]})]})]})}),o?d.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:d.jsxs("div",{className:"flex items-center justify-center py-4",children:[d.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-600"}),d.jsx("span",{className:"ml-3 text-sm text-gray-600",children:"Loading assigned employees..."})]})}):i.length>0?d.jsxs("div",{className:"mb-6",children:[d.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg mb-4",children:d.jsxs("div",{className:"flex items-start gap-3",children:[d.jsx(qe,{className:"w-5 h-5 text-blue-600 mt-0.5"}),d.jsxs("div",{children:[d.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[i.length," Direct Report",1!==i.length?"s":""," Assigned"]}),d.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"These employees will need a new manager assigned"}),d.jsxs("div",{className:"mt-2 space-y-1",children:[i.slice(0,5).map(e=>d.jsxs("div",{className:"text-xs text-blue-600",children:["â€¢ ",e.profile.firstName," ",e.profile.lastName," (",e.profile.department,")"]},e.id)),i.length>5&&d.jsxs("div",{className:"text-xs text-blue-600 italic",children:["+ ",i.length-5," more..."]})]})]})]})}),d.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Replacement Manager *"}),d.jsxs("select",{value:m,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"",children:"-- Select a manager --"}),n.filter(e=>e.id!==s.id&&e.isActive).map(e=>d.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.role.name,")",e.employeeCount?` - Currently managing ${e.employeeCount}`:""]},e.id))]}),f&&d.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:d.jsxs("p",{className:"text-xs text-green-700",children:["âœ“ ",i.length," employee",1!==i.length?"s":""," will be reassigned to"," ",d.jsxs("strong",{children:[f.firstName," ",f.lastName]})]})})]}):d.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:d.jsx("p",{className:"text-sm text-green-700",children:"âœ“ This manager has no direct reports. Safe to demote without reassignment."})}),p&&d.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:d.jsx("p",{className:"text-sm text-red-800",children:p})}),d.jsxs("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[d.jsxs("p",{className:"text-sm text-gray-700",children:[d.jsx(Ye,{className:"w-4 h-4 inline mr-2 text-gray-600"}),"After demotion, ",d.jsxs("strong",{children:[s.firstName," ",s.lastName]})," will:"]}),d.jsxs("ul",{className:"mt-2 ml-6 text-sm text-gray-600 space-y-1",children:[d.jsx("li",{children:"â€¢ Lose all manager privileges and access rights"}),d.jsx("li",{children:"â€¢ No longer have department assignments"}),d.jsx("li",{children:"â€¢ Be converted to a regular employee account"}),i.length>0&&d.jsxs("li",{children:["â€¢ Their ",i.length," direct report",1!==i.length?"s":""," will be reassigned"]})]})]}),d.jsxs("div",{className:"flex gap-3",children:[d.jsx("button",{onClick:a,disabled:x,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),d.jsx("button",{onClick:async()=>{if(i.length>0&&!m)h("Please select a replacement manager for the assigned employees");else{u(!0),h(null);try{await r(s.id,i.length>0?m:void 0),a()}catch(t){e.error("Failed to demote manager:",t),h(t.message||"Failed to demote manager. Please try again.")}finally{u(!1)}}},disabled:x||i.length>0&&!m,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Demoting...":"Confirm Demotion"})]})]})})},er=()=>{const{organization:t}=o(),{managers:a,stats:s,loading:r,error:n,promoteEmployee:i,demoteManager:l,updateManagerDepartments:c,archiveManager:m}=function(t){const[a,s]=C.useState([]),[r,n]=C.useState(null),[i,l]=C.useState(!0),[o,c]=C.useState(null),d=C.useCallback(async()=>{if(!t)return s([]),n(null),void l(!1);try{l(!0),c(null);const a=await Ys.getManagers(t),r=await Ys.getManagerEmployeeCounts(t,a),i=await N.getDepartments(t),o=new Map(i.map(e=>[e.id,e.name])),d=a.map(e=>({...e,employeeCount:r.get(e.id)||0,departmentNames:e.departmentIds?.map(e=>o.get(e)).filter(Boolean)||[]})),m=await Ys.getManagerStats(t);s(d),n(m),e.success("âœ… Managers loaded successfully",{count:d.length,hrManagers:m.hrManagers,hodManagers:m.hodManagers})}catch(a){e.error("Failed to load managers:",a),c(a.message||"Failed to load managers")}finally{l(!1)}},[t]),m=C.useCallback(async()=>{await d()},[d]),g=C.useCallback(async(a,s,r)=>{if(!t)throw new Error("Organization ID is required");try{await Ys.promoteEmployeeToManager(t,a,s,r),await m()}catch(n){throw e.error("Failed to promote employee:",n),n}},[t,m]),x=C.useCallback(async(a,s)=>{if(!t)throw new Error("Organization ID is required");try{await Ys.demoteManagerToEmployee(t,a,s),await m()}catch(r){throw e.error("Failed to demote manager:",r),r}},[t,m]),u=C.useCallback(async(a,s)=>{if(!t)throw new Error("Organization ID is required");try{await Ys.updateManagerDepartments(t,a,s),await m()}catch(r){throw e.error("Failed to update manager departments:",r),r}},[t,m]),p=C.useCallback(async(a,s,r)=>{if(!t)throw new Error("Organization ID is required");try{await Ys.archiveManager(t,a,s,r),await m()}catch(n){throw e.error("Failed to archive manager:",n),n}},[t,m]),h=C.useCallback(async a=>{if(!t)throw new Error("Organization ID is required");try{await Ys.restoreManager(t,a),await m()}catch(s){throw e.error("Failed to restore manager:",s),s}},[t,m]);return C.useEffect(()=>{d()},[d]),{managers:a,stats:r,loading:i,error:o,loadManagers:d,refreshManagers:m,promoteEmployee:g,demoteManager:x,updateManagerDepartments:u,archiveManager:p,restoreManager:h}}(t?.id),[g,x]=C.useState(!1),[u,p]=C.useState(!1),[h,y]=C.useState(!1),[f,v]=C.useState(null),[b,j]=C.useState(""),[w,D]=C.useState("all"),S=a.filter(e=>{const t=`${e.firstName} ${e.lastName} ${e.email}`.toLowerCase().includes(b.toLowerCase()),a="all"===w||e.role.id===w;return t&&a});return r&&0===a.length?d.jsx("div",{className:"flex items-center justify-center py-12",children:d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),d.jsx("p",{className:"text-gray-600",children:"Loading managers..."})]})}):d.jsxs("div",{className:"space-y-4",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[d.jsxs("div",{children:[d.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manager Management"}),d.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage manager roles, departments, and employee assignments"})]}),d.jsxs("button",{onClick:()=>x(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[d.jsx(Je,{className:"w-4 h-4"}),"Promote Employee"]})]}),n&&d.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[d.jsx(ae,{className:"w-5 h-5"}),d.jsx("span",{className:"font-medium",children:n})]})}),d.jsx(Ks,{stats:s,loading:r}),d.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[d.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[d.jsxs("div",{className:"flex-1 relative",children:[d.jsx(Qe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),d.jsx("input",{type:"text",placeholder:"Search managers by name or email...",value:b,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),d.jsxs("select",{value:w,onChange:e=>D(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"all",children:"All Roles"}),d.jsx("option",{value:"hr-manager",children:"HR Managers"}),d.jsx("option",{value:"hod-manager",children:"HOD Managers"})]})]}),b||"all"!==w?d.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Showing ",S.length," of ",a.length," managers"]}):null]}),d.jsx(Js,{managers:S,onViewDetails:e=>{v(e),p(!0)},onEdit:e=>{v(e),p(!0)},onDemote:e=>{v(e),y(!0)},onArchive:async t=>{if(confirm(`Are you sure you want to archive ${t.firstName} ${t.lastName}? This will deactivate their account.`))try{const a=prompt("Please provide a reason for archiving this manager:");if(!a)return;await m(t.id,a),e.success("Manager archived successfully")}catch(a){e.error("Failed to archive manager:",a),alert("Failed to archive manager. Please try again.")}}}),g&&d.jsx(Zs,{isOpen:g,onClose:()=>x(!1),onPromote:async(t,a,s)=>{try{await i(t,a,s),e.success('âœ… Employee promoted to manager successfully! They can now log in using their email and the "Forgot Password" link to set up their password.')}catch(r){throw e.error("Failed to promote employee:",r),r}}}),u&&f&&d.jsx(Qs,{isOpen:u,onClose:()=>{p(!1),v(null)},manager:f,onUpdate:async(a,s)=>{try{if(await c(a,s),t?.id){const e=await Ys.getManagerById(t.id,a);if(e){const a=await N.getDepartments(t.id),s=new Map(a.map(e=>[e.id,e.name])),r={...e,departmentNames:e.departmentIds?.map(e=>s.get(e)).filter(Boolean)||[]};v(r)}}e.success("Manager departments updated successfully")}catch(r){throw e.error("Failed to update departments:",r),r}}}),h&&f&&d.jsx(Xs,{isOpen:h,onClose:()=>{y(!1),v(null)},manager:f,onDemote:async(t,a)=>{try{await l(t,a),e.success("Manager demoted successfully")}catch(s){throw e.error("Failed to demote manager:",s),s}},availableManagers:a.filter(e=>e.id!==f.id)})]})},tr=C.memo(({className:t=""})=>{const a=E(),{user:l}=s(),{organization:c,categories:m}=o(),p=(e=>{const[t,a]=C.useState(window.innerWidth>e),s=C.useCallback(()=>a(window.innerWidth>e),[e]);return C.useEffect(()=>(window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)),[s]),t})(768),[h,y]=C.useState(null),[f,v]=C.useState(null),[b,N]=C.useState(null),[k,I]=C.useState(!1),{employees:A,warnings:R,error:L,refreshData:M}=j({role:"hr"}),{hrReportsCount:z,hrCountsLoading:O,hrCountsError:$}=(()=>{const{user:t}=s(),{canManageHR:a}=r(),[i,l]=C.useState({absenceReports:{unread:0,total:0},hrMeetings:{unread:0,total:0},correctiveCounselling:{unread:0,total:0}}),[o,c]=C.useState(!0),[d,m]=C.useState(null),[g,x]=C.useState(null),u=C.useRef([]),p=C.useRef(!0),h=C.useRef(!1),y=C.useCallback(async()=>{t?.organizationId&&a()&&(m(null),x(new Date))},[t?.organizationId,a]);return C.useEffect(()=>{if(!h.current){if(p.current=!0,!a()||!t?.organizationId)return c(!1),void(h.current=!0);c(!0),m(null),u.current.forEach(t=>{try{t()}catch(a){e.warn("âš ï¸ Error unsubscribing:",a)}}),u.current=[];try{const a=F(T(n,`organizations/${t.organizationId}/reports`),P("absenceDate","desc")),s=_(a,e=>{if(!p.current)return;const t=e.docs.filter(e=>"_metadata"!==e.id).map(e=>({id:e.id,...e.data()})),a=t.filter(e=>!e.hrReviewed).length;l(e=>({...e,absenceReports:{unread:a,total:t.length}})),x(new Date),t.length},t=>{e.error("âŒ Absence reports listener error:",t),p.current&&m("Failed to load absence reports")});u.current.push(s);const r=F(T(n,`organizations/${t.organizationId}/meetings`),P("createdAt","desc")),i=_(r,e=>{if(!p.current)return;const t=e.docs.filter(e=>"_metadata"!==e.id).map(e=>({id:e.id,...e.data()})),a=t.filter(e=>"pending"===e.status).length;l(e=>({...e,hrMeetings:{unread:a,total:t.length}})),x(new Date),t.length},t=>{e.error("âŒ HR meetings listener error:",t),p.current&&m("Failed to load HR meetings")});u.current.push(i);const o=F(T(n,`organizations/${t.organizationId}/corrective_counselling`),P("dateCreated","desc")),d=_(o,e=>{if(!p.current)return;const t=e.docs.filter(e=>"_metadata"!==e.id).map(e=>({id:e.id,...e.data()})),a=t.filter(e=>new Date(e.dateCreated)>new Date(Date.now()-6048e5)&&!e.hrReviewed).length;l(e=>({...e,correctiveCounselling:{unread:a,total:t.length}})),x(new Date),t.length},t=>{e.error("âŒ Corrective counselling listener error:",t),p.current&&m("Failed to load counselling records")});u.current.push(d),setTimeout(()=>{p.current&&c(!1)},1e3)}catch(s){e.error("âŒ Error setting up listeners:",s),m("Failed to initialize real-time data"),c(!1)}return h.current=!0,()=>{p.current=!1,u.current.forEach(t=>{try{t()}catch(s){e.warn("âš ï¸ Error during cleanup:",s)}}),u.current=[],h.current=!1}}},[]),C.useEffect(()=>{a()&&t?.organizationId||(l({absenceReports:{unread:0,total:0},hrMeetings:{unread:0,total:0}}),c(!1),m(null),x(null),h.current=!1)},[a(),t?.organizationId]),{hrReportsCount:i,hrCountsLoading:o,hrCountsError:d,refreshHRCounts:y,lastUpdated:g}})(),[W,U]=C.useState(!1),[V,q]=C.useState(!1),[B,H]=C.useState(null),[G,Y]=C.useState(!1),K=((t,a,s)=>{const[r,n]=C.useState(!0),[l,o]=C.useState(null),[c,d]=C.useState(null);C.useEffect(()=>{(async()=>{if(t&&a)try{n(!0);const r=await i.getDocument(a,"users",t);if(!r)return e.error("User document not found for countdown feature"),void n(!1);const l=r?.features?.historicalWarningEntry;if(l?.firstAccessedAt){const e=l.firstAccessedAt.toDate?l.firstAccessedAt.toDate():new Date(l.firstAccessedAt),t=l.expiresAt.toDate?l.expiresAt.toDate():new Date(l.expiresAt);o({firstAccessedAt:e,expiresAt:t}),Math.ceil((t.getTime()-Date.now())/864e5)}else if(s){const e=new Date,s=new Date(e.getTime()+5184e6),r={"features.historicalWarningEntry":{firstAccessedAt:e,expiresAt:s}};await i.updateDocument(a,"users",t,r),o({firstAccessedAt:e,expiresAt:s})}}catch(r){e.error("Failed to initialize historical warning countdown:",r)}finally{n(!1)}else n(!1)})()},[t,a,s]),C.useEffect(()=>{if(!l)return void d(null);const e=()=>{const e=Date.now(),t=l.expiresAt.getTime()-e,a=Math.floor(t/864e5);d(Math.max(0,a))};e();const t=setInterval(e,36e5);return()=>clearInterval(t)},[l]);const{level:m,text:g}=null!==c&&l?0===c?{level:"urgent",text:"Enter Historical Warning (Last day!)"}:1===c?{level:"urgent",text:"Enter Historical Warning (1 day left!)"}:c<=7?{level:"warning",text:`Enter Historical Warning (${c} days left - Hurry!)`}:c<=14?{level:"warning",text:`Enter Historical Warning (${c} days left)`}:{level:"normal",text:`Enter Historical Warning (${c} days left)`}:{level:"normal",text:"Enter Historical Warning"},x=null!==c&&c<=0;return{daysRemaining:c,isExpired:x,isActive:!x&&null!==l,loading:r,urgencyLevel:m,displayText:g}})(l?.uid,c?.id,"warnings"===h),J=R?.filter(e=>"expired"!==e.status&&"overturned"!==e.status)||[],Q={totalActive:J.length,undelivered:J.filter(e=>"delivered"!==e.status).length,highSeverity:J.filter(e=>"high"===e.severity||"gross_misconduct"===e.category?.severity).length},Z={totalEmployees:A?.length||0,activeEmployees:A?.filter(e=>!1!==e.isActive)?.length||0,newEmployees:A?.filter(e=>new Date(e.createdAt||e.metadata?.createdAt||0)>new Date(Date.now()-2592e6))?.length||0};return C.useEffect(()=>{const e=e=>{const{employeeId:t}=e.detail,a=localStorage.getItem("warningFilterEmployeeName");t&&a&&(v({id:t,name:a}),y("warnings"),localStorage.removeItem("warningFilterEmployeeId"),localStorage.removeItem("warningFilterEmployeeName"))};return window.addEventListener("navigateToWarnings",e),()=>{window.removeEventListener("navigateToWarnings",e)}},[]),p?d.jsxs("div",{className:`${t}`,children:[d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("/hr/absence-reports"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(Xe,{className:"w-8 h-8",style:{opacity:.7}}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Absence Reports"}),d.jsx("div",{className:"text-2xl font-bold",children:z.absenceReports.unread}),d.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[z.absenceReports.total," total"]})]})]})}),d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("/hr/meeting-requests"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(et,{className:"w-8 h-8",style:{opacity:.7}}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Meeting Requests"}),d.jsx("div",{className:"text-2xl font-bold",children:z.hrMeetings.unread}),d.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[z.hrMeetings.total," total"]})]})]})}),d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("/hr/corrective-counselling"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(tt,{className:"w-8 h-8",style:{opacity:.7}}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Counselling"}),d.jsx("div",{className:"text-2xl font-bold",children:z.correctiveCounselling.unread}),d.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[z.correctiveCounselling.total," total"]})]})]})}),d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>y("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(we,{className:"w-8 h-8",style:{opacity:.7}}),d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Active Warnings"}),d.jsx("div",{className:"text-2xl font-bold",children:Q.totalActive}),d.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[Q.undelivered," undelivered"]})]})]})})]}),(L||$)&&d.jsx(u,{variant:"error",className:"mb-4",children:d.jsxs("div",{className:"text-sm",children:["Failed to load dashboard data: ",L||$]})}),d.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[d.jsx("div",{className:"border-b border-gray-200",children:d.jsx("nav",{className:"flex space-x-6 px-4",children:[{id:"urgent",label:"Urgent Tasks",icon:ae,count:z.absenceReports.unread+z.hrMeetings.unread+Q.undelivered},{id:"warnings",label:"Warnings",icon:we},{id:"employees",label:"Employees",icon:Be},{id:"departments",label:"Departments",icon:Be},{id:"managers",label:"Managers",icon:qe}].map(e=>d.jsxs("button",{onClick:()=>y(e.id),className:"flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium transition-colors relative "+(h===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[d.jsx(e.icon,{className:"w-4 h-4"}),e.label,(e.count??0)>0&&d.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center ml-1",children:e.count})]},e.id))})}),d.jsxs("div",{className:"p-4",children:["urgent"===h&&d.jsxs("div",{className:"hidden lg:block space-y-4",children:[d.jsxs("div",{className:"bg-white rounded-lg border border-red-200 shadow-sm",children:[d.jsxs("div",{className:"p-4 border-b border-red-100 bg-red-50",children:[d.jsxs("h3",{className:"text-lg font-semibold text-red-900 flex items-center gap-2",children:[d.jsx(ae,{className:"w-5 h-5"}),"Urgent Tasks Requiring Immediate Attention"]}),d.jsx("p",{className:"text-sm text-red-700 mt-1",children:"These items need your immediate review and action"})]}),d.jsxs("div",{className:"divide-y divide-gray-100",children:[z.absenceReports.unread>0&&d.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>a("/hr/absence-reports"),children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-semibold text-gray-900",children:[z.absenceReports.unread," Unread Absence Reports"]}),d.jsx("div",{className:"text-sm text-gray-600",children:"Employees reporting absences requiring approval"})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium",children:[z.absenceReports.unread," pending"]}),d.jsx(Xe,{className:"w-4 h-4 text-gray-400"})]})]})}),z.hrMeetings.unread>0&&d.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>a("/hr/meeting-requests"),children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-semibold text-gray-900",children:[z.hrMeetings.unread," New Meeting Requests"]}),d.jsx("div",{className:"text-sm text-gray-600",children:"Employees requesting HR consultations"})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsxs("span",{className:"bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full font-medium",children:[z.hrMeetings.unread," requests"]}),d.jsx(et,{className:"w-4 h-4 text-gray-400"})]})]})}),Q.undelivered>0&&d.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>y("warnings"),children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-semibold text-gray-900",children:[Q.undelivered," Undelivered Warnings"]}),d.jsx("div",{className:"text-sm text-gray-600",children:"Warning documents pending delivery to employees"})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:"Urgent"}),d.jsx(ae,{className:"w-4 h-4 text-gray-400"})]})]})}),Q.highSeverity>0&&d.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>y("warnings"),children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full"}),d.jsxs("div",{children:[d.jsxs("div",{className:"font-semibold text-gray-900",children:[Q.highSeverity," High Priority Cases"]}),d.jsx("div",{className:"text-sm text-gray-600",children:"Final warnings and dismissal cases requiring oversight"})]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium",children:"Critical"}),d.jsx(ae,{className:"w-4 h-4 text-gray-400"})]})]})}),0===z.absenceReports.unread&&0===z.hrMeetings.unread&&0===Q.undelivered&&0===Q.highSeverity&&d.jsxs("div",{className:"p-8 text-center text-gray-500",children:[d.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:d.jsx(we,{className:"w-8 h-8 text-green-600"})}),d.jsx("div",{className:"font-medium text-gray-700",children:"All caught up!"}),d.jsx("div",{className:"text-sm",children:"No urgent tasks requiring immediate attention"})]})]})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[d.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(ue,{className:"w-4 h-4 text-gray-600"}),"Today's Activity"]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"New Reports"}),d.jsx("span",{className:"font-medium text-gray-900",children:z.absenceReports.unread})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Meetings"}),d.jsx("span",{className:"font-medium text-gray-900",children:z.hrMeetings.unread})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Counselling"}),d.jsx("span",{className:"font-medium text-gray-900",children:z.correctiveCounselling.unread})]})]})]}),d.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(He,{className:"w-4 h-4 text-blue-600"}),"Team Status"]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Total Employees"}),d.jsx("span",{className:"font-medium text-gray-900",children:Z.totalEmployees})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Active"}),d.jsx("span",{className:"font-medium text-green-600",children:Z.activeEmployees})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"New This Month"}),d.jsx("span",{className:"font-medium text-blue-600",children:Z.newEmployees})]})]})]}),d.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[d.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[d.jsx(we,{className:"w-4 h-4 text-orange-600"}),"Warning Overview"]}),d.jsxs("div",{className:"space-y-2",children:[d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Active"}),d.jsx("span",{className:"font-medium text-gray-900",children:Q.totalActive})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"Undelivered"}),d.jsx("span",{className:"font-medium text-orange-600",children:Q.undelivered})]}),d.jsxs("div",{className:"flex justify-between text-sm",children:[d.jsx("span",{className:"text-gray-600",children:"High Priority"}),d.jsx("span",{className:"font-medium text-red-600",children:Q.highSeverity})]})]})]})]})]}),"warnings"===h&&d.jsxs("div",{className:"hidden lg:block space-y-4",children:[!K.isExpired&&d.jsxs("div",{className:"flex justify-between items-center",children:[d.jsxs("div",{children:[d.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warnings Management"}),d.jsx("p",{className:"text-sm text-gray-600",children:"Digital and historical warning records"})]}),d.jsx(x,{variant:"outline",size:"md",icon:ne,onClick:()=>U(!0),className:""+("urgent"===K.urgencyLevel?"border-red-500 text-red-700 hover:bg-red-50 font-semibold animate-pulse":"warning"===K.urgencyLevel?"border-orange-500 text-orange-700 hover:bg-orange-50 font-semibold":"border-amber-500 text-amber-700 hover:bg-amber-50"),children:K.loading?"Enter Historical Warning":K.displayText})]}),d.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[d.jsx("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(ae,{className:"w-8 h-8 text-orange-600"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Q.undelivered}),d.jsx("div",{className:"text-sm text-orange-700",children:"Undelivered Warnings"}),d.jsx("div",{className:"text-xs text-orange-600",children:"Require immediate attention"})]})]})}),d.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(we,{className:"w-8 h-8 text-red-600"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-2xl font-bold text-red-600",children:Q.highSeverity}),d.jsx("div",{className:"text-sm text-red-700",children:"High Severity"}),d.jsx("div",{className:"text-xs text-red-600",children:"Final warnings & dismissals"})]})]})}),d.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(ne,{className:"w-8 h-8 text-blue-600"}),d.jsxs("div",{children:[d.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Q.totalActive}),d.jsx("div",{className:"text-sm text-blue-700",children:"Total Active"}),d.jsx("div",{className:"text-xs text-blue-600",children:"All current warnings"})]})]})})]}),d.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:d.jsx(X,{initialEmployeeFilter:f||void 0,selectedWarning:b,showDetails:k,onViewDetails:e=>{N(e),I(!0)},onCloseDetails:()=>{N(null),I(!1)},onWarningUpdated:M})})]}),"employees"===h&&d.jsx("div",{className:"hidden lg:block space-y-4",children:d.jsx(w,{onDataChange:M})}),"departments"===h&&c&&d.jsx("div",{className:"hidden lg:block",children:d.jsx(D,{isOpen:!0,onClose:()=>y("urgent"),organizationId:c.id,inline:!0})}),"managers"===h&&d.jsx("div",{className:"hidden lg:block",children:d.jsx(er,{})})]})]}),W&&l&&c&&d.jsx(Gs,{isOpen:W,onClose:()=>U(!1),onSuccess:()=>{U(!1),M()},employees:A||[],categories:m||[],currentUserId:l.uid,organizationId:c.id}),V&&c&&d.jsx(D,{isOpen:V,onClose:()=>q(!1),organizationId:c.id}),G&&B&&d.jsx(Ps,{isOpen:G,notification:B,onDeliveryComplete:async(t,a)=>{try{Y(!1),H(null),M()}catch(s){e.error("Failed to complete delivery:",s)}},onClose:()=>{Y(!1),H(null)}}),d.jsx(Ws,{warning:b,isOpen:k,onClose:()=>{N(null),I(!1)},canTakeAction:!0,userRole:"hr"}),d.jsx(S,{className:"mt-6"})]}):d.jsxs("div",{className:`space-y-6 ${t}`,children:[d.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("/hr/absence-reports"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[d.jsx(Xe,{className:"w-5 h-5"}),d.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Absence Reports"}),O?d.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):d.jsx("span",{className:"text-lg font-bold",children:z.absenceReports.unread})]})}),d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("/hr/meeting-requests"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[d.jsx(et,{className:"w-5 h-5"}),d.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"HR Meetings"}),O?d.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):d.jsx("span",{className:"text-lg font-bold",children:z.hrMeetings.unread})]})}),d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("/hr/corrective-counselling"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[d.jsx(tt,{className:"w-5 h-5"}),d.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Counselling"}),O?d.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):d.jsx("span",{className:"text-lg font-bold",children:z.correctiveCounselling.unread})]})}),d.jsx(g,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>y("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:d.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[d.jsx(we,{className:"w-5 h-5"}),d.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Active Warnings"}),d.jsx("span",{className:"text-lg font-bold",children:Q.totalActive})]})})]}),d.jsxs("div",{className:"space-y-3",children:[d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("urgent"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(ae,{className:"w-5 h-5",style:{color:"var(--color-error)"}}),d.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Urgent Tasks"})]}),d.jsx($e,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(we,{className:"w-5 h-5",style:{color:"var(--color-warning)"}}),d.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warnings"})]}),d.jsx($e,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(Be,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),d.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Employees"})]}),d.jsx($e,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(Be,{className:"w-5 h-5",style:{color:"var(--color-info)"}}),d.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Departments"})]}),d.jsx($e,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("managers"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx(qe,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),d.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Managers"})]}),d.jsx($e,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),"urgent"===h&&d.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:d.jsxs(g,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[d.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Urgent Tasks"}),d.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"Ã—"})]}),d.jsx("div",{className:"overflow-y-auto p-4",children:d.jsxs("div",{className:"space-y-3",children:[d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>a("/hr/absence-reports"),className:"cursor-pointer",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Absence Reports"}),d.jsx("div",{className:"text-2xl font-bold",children:z.absenceReports.unread})]}),d.jsx(Xe,{className:"w-8 h-8",style:{opacity:.7}})]})}),d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>a("/hr/meeting-requests"),className:"cursor-pointer",style:{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Meeting Requests"}),d.jsx("div",{className:"text-2xl font-bold",children:z.hrMeetings.unread})]}),d.jsx(et,{className:"w-8 h-8",style:{opacity:.7}})]})}),d.jsx(g,{padding:"md",shadow:"sm",hover:!0,onClick:()=>a("/hr/corrective-counselling"),className:"cursor-pointer",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)"},children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Counselling"}),d.jsx("div",{className:"text-2xl font-bold",children:z.correctiveCounselling.unread})]}),d.jsx(tt,{className:"w-8 h-8",style:{opacity:.7}})]})})]})})]})}),"warnings"===h&&d.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:d.jsxs(g,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden",shadow:"xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 flex-shrink-0",style:{borderBottom:"1px solid var(--color-border)"},children:[d.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:f?`Warnings for ${f.name}`:"Warnings Overview"}),d.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{y(null),v(null)},children:"Ã—"})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-0",children:d.jsx(X,{initialEmployeeFilter:f||void 0,selectedWarning:b,showDetails:k,onViewDetails:e=>{N(e),I(!0)},onCloseDetails:()=>{N(null),I(!1)},onWarningUpdated:M})})]})}),"employees"===h&&d.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:d.jsxs(g,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden",shadow:"xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 flex-shrink-0",style:{borderBottom:"1px solid var(--color-border)"},children:[d.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Employees"}),d.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"Ã—"})]}),d.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:d.jsx(w,{onDataChange:M})})]})}),"departments"===h&&c&&d.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:d.jsxs(g,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[d.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Departments"}),d.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"Ã—"})]}),d.jsx("div",{className:"overflow-y-auto",children:d.jsx(D,{isOpen:!0,onClose:()=>y(null),organizationId:c.id,inline:!0})})]})}),"managers"===h&&d.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:d.jsxs(g,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden",shadow:"xl",children:[d.jsxs("div",{className:"flex items-center justify-between p-4 flex-shrink-0",style:{borderBottom:"1px solid var(--color-border)"},children:[d.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Managers"}),d.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"Ã—"})]}),d.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-0",children:d.jsx(er,{})})]})})]})});tr.displayName="HRDashboardSection";export{qs as C,Ps as E,tr as H,ks as P,it as a,st as b,rt as c,nt as d,Ds as i,mt as p,dt as t};
