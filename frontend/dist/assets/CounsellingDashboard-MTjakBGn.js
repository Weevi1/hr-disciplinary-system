import{u as P,d as I,j as e,p as _,q,L as N,r as v}from"./dashboard-components-fvKPXzEF.js";import{u as M,r as a}from"./react-vendor-DrdoFN08.js";import{q as Y,l as G,w as C,t as Q,m as R}from"./firebase-vendor-Cz3N8Xg7.js";import{au as D,X as V,c as X,o as H,ac as J,a5 as K,E as W,i as Z,A as $}from"./ui-vendor-X12rCvv3.js";import"./pdf-vendor-Bp5yZ91a.js";import"./warning-components-DfE_qdbY.js";const oe=({onClose:p})=>{const g=M(),{user:c}=P(),{organization:d}=I(),[i,S]=a.useState([]),[m,h]=a.useState([]),[U,f]=a.useState(!0),[y,w]=a.useState(null),[o,F]=a.useState(""),[n,T]=a.useState("all"),[j,x]=a.useState(null),[L,u]=a.useState(!1);a.useEffect(()=>{(async()=>{if(!(!c?.id||!d?.id))try{f(!0),w(null);const t=Y(G(q,"corrective_counselling"),C("organizationId","==",d.id),C("createdBy","==",c.id),Q("dateCreated","desc")),l=await R(t),r=[];l.forEach(b=>{const O=b.data();r.push({id:b.id,...O})}),S(r),h(r),N.debug(2790)}catch(t){N.error("❌ Error loading counselling sessions:",t),w("Failed to load counselling sessions")}finally{f(!1)}})()},[c?.id,d?.id]),a.useEffect(()=>{let s=i;if(o){const t=o.toLowerCase();s=s.filter(l=>l.employeeName.toLowerCase().includes(t)||l.category.toLowerCase().includes(t)||l.issueDescription.toLowerCase().includes(t))}n!=="all"&&(s=s.filter(t=>{switch(n){case"active":return!t.followUpCompleted&&t.followUpDate;case"pending_followup":if(!t.followUpDate||t.followUpCompleted)return!1;const l=new Date(t.followUpDate);return Math.ceil((l.getTime()-new Date().getTime())/(1e3*60*60*24))<=7;case"completed":return t.followUpCompleted;default:return!0}})),h(s)},[i,o,n]);const E=s=>{x(s),u(!0)},k=()=>{u(!1),x(null)},A=()=>{u(!1),x(null),window.location.reload()},z=s=>v.find(t=>t.id===s)||v[0],B=s=>{if(s.followUpCompleted)return e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"Completed"});if(!s.followUpDate)return e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full text-xs font-medium",children:"No Follow-up"});const t=new Date(s.followUpDate),l=Math.ceil((t.getTime()-new Date().getTime())/(1e3*60*60*24));return l<0?e.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium",children:"Overdue"}):l<=3?e.jsx("span",{className:"px-2 py-1 bg-amber-100 text-amber-800 rounded-full text-xs font-medium",children:"Due Soon"}):e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:"Active"})};return U?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading counselling dashboard..."})]})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[e.jsx(D,{className:"w-8 h-8 text-blue-600"}),"Counselling Dashboard"]}),e.jsx("button",{onClick:p||(()=>g("/dashboard")),className:"text-gray-500 hover:text-gray-700",children:e.jsx(V,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage all your counselling sessions and follow-ups"})]}),y&&e.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-lg flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-red-500"}),e.jsx("p",{className:"text-red-700",children:y})]}),e.jsx("div",{className:"p-6 border-b bg-gray-50",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"flex-1 min-w-64",children:e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:o,onChange:s=>F(s.target.value),placeholder:"Search by employee, category, or description...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:n,onChange:s=>T(s.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Sessions"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"pending_followup",children:"Follow-up Due"}),e.jsx("option",{value:"completed",children:"Completed"})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 bg-white px-3 py-2 rounded-lg border",children:["Showing ",m.length," of ",i.length," sessions"]})]})}),e.jsx("div",{className:"p-6",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-600 mb-2",children:"No counselling sessions found"}),e.jsx("p",{className:"text-gray-500",children:o||n!=="all"?"Try adjusting your search or filter criteria":"You haven't created any counselling sessions yet"})]}):e.jsx("div",{className:"space-y-4",children:m.map(s=>{const t=z(s.counsellingType),l=s.followUpDate?new Date(s.followUpDate):null,r=l&&!s.followUpCompleted;return e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s.employeeName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:t.icon}),e.jsx("span",{className:"text-sm text-gray-600",children:t.label})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s.category}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Created: ",new Date(s.dateCreated).toLocaleDateString()]}),l&&e.jsxs("span",{className:"text-sm text-gray-500",children:["Follow-up: ",l.toLocaleDateString()]})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2 mb-3",children:s.issueDescription}),s.promisesToPerform&&s.promisesToPerform.length>0&&e.jsxs("div",{className:"text-xs text-gray-500 mb-2",children:[s.promisesToPerform.length," promise",s.promisesToPerform.length!==1?"s":""," to perform"]})]}),e.jsxs("div",{className:"flex items-start gap-3 ml-4",children:[B(s),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{},className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"View Details",children:e.jsx(W,{className:"w-4 h-4"})}),r&&e.jsxs("button",{onClick:()=>E(s),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),"Follow-up"]})]})]})]})},s.id)})})}),e.jsx("div",{className:"sticky bottom-0 bg-gray-50 border-t px-6 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("button",{onClick:p||(()=>g("/dashboard")),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Back to Dashboard"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[i.filter(s=>!s.followUpCompleted&&s.followUpDate).length," sessions need follow-up"]})]})})]})}),L&&j&&e.jsx(_,{counsellingSession:j,onClose:k,onComplete:A})]})};export{oe as CounsellingDashboard};
