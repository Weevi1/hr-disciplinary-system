import{j as e,L as C,P as We,u as Ue,c as He,A as ee,a as Fe,b as Ze,N as Ye}from"./dashboard-components-fvKPXzEF.js";import{r as a}from"./react-vendor-DrdoFN08.js";import{aF as Ie,L as De,_ as Xe,e as Je,aG as Ke,ay as Qe,a0 as fe,h as Ce,a5 as ge,i as ye,k as je,I as ke,f as pe,g as es,aB as ss,ak as we,C as be,aH as Re,aa as ve,X as Z,a3 as ts,aI as as,F as Ae,an as Te,aq as rs,am as ls,a as is,aJ as ns,aK as os,u as ds,m as $e,a6 as cs,at as ms,aL as xs,aM as us,d as gs,R as Ee,a7 as ps,A as hs,a8 as Se,o as _e,M as bs,E as ys,W as fs,Y as js,ac as vs,r as Ns,s as ws}from"./ui-vendor-X12rCvv3.js";import"./firebase-vendor-Cz3N8Xg7.js";import"./pdf-vendor-Bp5yZ91a.js";import"./warning-components-DfE_qdbY.js";const Le=s=>s?s.deleted?{status:"deleted",message:"This audio recording has been permanently deleted.",canPlay:!1}:s.autoDeleteDate&&new Date>new Date(s.autoDeleteDate)?{status:"expired",message:"This audio recording has expired and is no longer available.",canPlay:!1}:s.processingStatus==="processing"?{status:"processing",message:"Audio is still being processed. Please try again in a moment.",canPlay:!1}:s.processingStatus==="failed"?{status:"failed",message:"Audio processing failed. The recording may be corrupted.",canPlay:!1}:!s.storageUrl&&!s.url?{status:"unavailable",message:"Audio URL is not available. The recording may not have been uploaded properly.",canPlay:!1}:{status:"available",message:"Audio recording is ready to play.",canPlay:!0}:{status:"not-available",message:"Audio recording not available.",canPlay:!1},Ds=s=>Le(s).canPlay,Ss=s=>Le(s).status==="deleted",Cs=s=>Le(s).status==="expired",Me=({audioRecording:s,warningId:g,showDownload:n=!0,showMetadata:M=!0,showTranscript:S=!1,compact:F=!1,autoPlay:j=!1,className:W=""})=>{if(!s)return e.jsx("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 ${W}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"No audio recording available"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Audio recording not found or not provided"})]})]})});const c=a.useRef(null),v=a.useRef(null),[d,m]=a.useState({isLoading:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,error:null,buffered:0}),N=Le(s),x=Ds(s),y=Ss(s),p=Cs(s),A=s?.storageUrl||s?.url;a.useEffect(()=>{const r=c.current;if(!r||!x||!A){m(L=>({...L,isLoading:!1,error:x?"No audio URL available":N.message}));return}r.src=A;const f=()=>{m(L=>({...L,isLoading:!0,error:null}))},O=()=>{m(L=>({...L,duration:r.duration||0,isLoading:!1}))},U=()=>{m(L=>({...L,currentTime:r.currentTime||0}))},Y=()=>{m(L=>({...L,isPlaying:!0}))},B=()=>{m(L=>({...L,isPlaying:!1}))},q=()=>{m(L=>({...L,isPlaying:!1,currentTime:0})),r&&(r.currentTime=0)},Q=L=>{C.error("Audio loading error:",L),m(K=>({...K,isLoading:!1,isPlaying:!1,error:"Failed to load audio recording. The file may be corrupted or unavailable."}))},se=()=>{if(r.buffered.length>0){const L=r.buffered.end(r.buffered.length-1),K=r.duration||0;m(te=>({...te,buffered:K?L/K*100:0}))}};return r.addEventListener("loadstart",f),r.addEventListener("loadedmetadata",O),r.addEventListener("timeupdate",U),r.addEventListener("play",Y),r.addEventListener("pause",B),r.addEventListener("ended",q),r.addEventListener("error",Q),r.addEventListener("progress",se),r.load(),()=>{r.removeEventListener("loadstart",f),r.removeEventListener("loadedmetadata",O),r.removeEventListener("timeupdate",U),r.removeEventListener("play",Y),r.removeEventListener("pause",B),r.removeEventListener("ended",q),r.removeEventListener("error",Q),r.removeEventListener("progress",se)}},[x,A,N.message]),a.useEffect(()=>{j&&c.current&&!d.isLoading&&!d.error&&x&&c.current.play().catch(console.warn)},[j,d.isLoading,d.error,x]);const h=a.useCallback(async()=>{const r=c.current;if(!(!r||!x))try{d.isPlaying?r.pause():await r.play()}catch(f){C.error("Playback error:",f),m(O=>({...O,error:"Playback failed. Please try again."}))}},[d.isPlaying,x]),I=a.useCallback(r=>{const f=c.current;f&&x&&(f.currentTime=r)},[x]),w=a.useCallback(r=>{const f=c.current;f&&(f.volume=r,m(O=>({...O,volume:r,isMuted:r===0})))},[]),_=a.useCallback(()=>{const r=c.current;if(r){const f=!d.isMuted;r.muted=f,m(O=>({...O,isMuted:f}))}},[d.isMuted]),E=r=>{if(!r||isNaN(r))return"0:00";const f=Math.floor(r/60),O=Math.floor(r%60);return`${f}:${O.toString().padStart(2,"0")}`},P=r=>r?r>=32e3?"High":r>=16e3?"Standard":"Basic":"Unknown",k=()=>y?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(es,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Audio Recording Deleted"}),e.jsx("p",{className:"text-red-600 text-sm",children:N.message})]})]}):p?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(pe,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-800 font-medium",children:"Audio Recording Expired"}),e.jsx("p",{className:"text-yellow-600 text-sm",children:N.message})]})]}):N.status==="processing"?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx(De,{className:"w-5 h-5 text-blue-600 animate-spin"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-800 font-medium",children:"Processing Audio"}),e.jsx("p",{className:"text-blue-600 text-sm",children:N.message})]})]}):N.status==="failed"||N.status==="unavailable"?e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(ss,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-800 font-medium",children:"Audio Unavailable"}),e.jsx("p",{className:"text-red-600 text-sm",children:N.message})]})]}):null;return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${W}`,children:[x&&A&&e.jsx("audio",{ref:c,preload:"metadata"}),k(),x&&!d.error&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:h,disabled:d.isLoading,className:"flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",title:d.isPlaying?"Pause":"Play",children:d.isLoading?e.jsx(De,{className:"w-5 h-5 animate-spin"}):d.isPlaying?e.jsx(Xe,{className:"w-5 h-5"}):e.jsx(Je,{className:"w-5 h-5 ml-1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{ref:v,className:"relative h-2 bg-gray-200 rounded-full cursor-pointer",onClick:r=>{if(v.current&&d.duration){const f=v.current.getBoundingClientRect(),O=(r.clientX-f.left)/f.width;I(O*d.duration)}},children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 rounded-full",style:{width:`${d.buffered}%`}}),e.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full",style:{width:d.duration?`${d.currentTime/d.duration*100}%`:"0%"}})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:E(d.currentTime)}),e.jsx("span",{children:E(d.duration)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:_,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:d.isMuted?"Unmute":"Mute",children:d.isMuted?e.jsx(Ke,{className:"w-4 h-4"}):e.jsx(Qe,{className:"w-4 h-4"})}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:d.isMuted?0:d.volume,onChange:r=>w(parseFloat(r.target.value)),className:"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Volume"})]}),n&&A&&e.jsx("button",{onClick:()=>{const r=document.createElement("a");r.href=A,r.download=`warning-audio-${s.recordingId||"recording"}.webm`,r.click()},className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Download Audio",children:e.jsx(fe,{className:"w-4 h-4"})})]})}),M&&!F&&x&&!d.error&&e.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"}),"Duration"]}),e.jsx("p",{className:"font-medium",children:E(s.duration||0)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(Ie,{className:"w-3 h-3"}),"Quality"]}),e.jsx("p",{className:"font-medium",children:P(s.bitrate)})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),"Recorded By"]}),e.jsx("p",{className:"font-medium",children:s.recordedByName||"Manager"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[e.jsx(ye,{className:"w-3 h-3"}),"Recorded"]}),e.jsx("p",{className:"font-medium",children:s.startTime?new Date(s.startTime).toLocaleDateString():"Unknown"})]})]}),s.consentGiven&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-green-700 bg-green-50 px-3 py-2 rounded-lg",children:[e.jsx(je,{className:"w-3 h-3"}),e.jsx("span",{children:"Recording consent was obtained from all participants"})]}),s.autoDeleteDate&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-lg",children:[e.jsx(ke,{className:"w-3 h-3"}),e.jsxs("span",{children:["This recording will be automatically deleted on"," ",new Date(s.autoDeleteDate).toLocaleDateString()]})]})]}),d.error&&e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:d.error})]})})]})},ks=({signature:s,title:g,subtitle:n,isOpen:M,onClose:S,allowDownload:F=!0})=>{const j=a.useCallback(()=>{try{const c=atob(s.split(",")[1]),v=new Array(c.length);for(let y=0;y<c.length;y++)v[y]=c.charCodeAt(y);const d=new Uint8Array(v),m=new Blob([d],{type:"image/png"}),N=URL.createObjectURL(m),x=document.createElement("a");x.href=N,x.download=`${g.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(N)}catch(c){C.error("Signature download failed:",c)}},[s,g]),W=a.useCallback(async()=>{try{await navigator.clipboard.writeText(s)}catch(c){C.error("Failed to copy signature:",c)}},[s]);return M?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g}),n&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:n})]}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:e.jsx("img",{src:s,alt:g,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:W,className:"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),"Copy Data"]}),F&&e.jsxs("button",{onClick:j,className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Download"]})]})]})]})}):null},As=({signatures:s,warningId:g,showTimestamps:n=!0,compact:M=!1,showVerification:S=!0,allowDownload:F=!0,className:j=""})=>{const[W,c]=a.useState(null),v=w=>{if(!w)return!1;try{return w.startsWith("data:image/")&&w.includes("base64,")}catch{return!1}},d=v(s.manager),m=v(s.employee),N=d&&m,x=a.useCallback((w,_,E)=>{c({signature:w,title:_,subtitle:E})},[]),y=a.useCallback(()=>{c(null)},[]),p=w=>{if(!w)return"Not signed";try{return new Date(w).toLocaleString()}catch{return"Invalid timestamp"}},h=N?{status:"complete",message:"Document fully signed",color:"text-green-600 bg-green-50 border-green-200",icon:be}:d||m?{status:"partial",message:"Signatures pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:Ce}:{status:"missing",message:"No signatures collected",color:"text-gray-600 bg-gray-50 border-gray-200",icon:pe},I=h.icon;return M?e.jsxs("div",{className:`inline-flex items-center gap-2 ${j}`,children:[e.jsx(I,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:N?"✓ Signed":"⏳ Pending"}),N&&e.jsx("button",{onClick:()=>x(s.manager,"Digital Signatures","Manager and Employee"),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View"})]}):e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${j}`,children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:e.jsx(we,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Electronic authorization and acknowledgment"})]})]}),S&&e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${h.color}`,children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:h.message})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Manager"}),d&&e.jsx(be,{className:"w-4 h-4 text-green-500"})]}),d&&e.jsx("button",{onClick:()=>x(s.manager,"Manager Signature",s.managerName||"Warning Issuer"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:e.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:e.jsx("img",{src:s.manager,alt:"Manager Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{children:s.managerName||"Manager"})]}),n&&s.managerTimestamp&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("span",{children:p(s.managerTimestamp)})]})]})]}):e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(ge,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting manager signature"})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Employee"}),m&&e.jsx(be,{className:"w-4 h-4 text-green-500"})]}),m&&e.jsx("button",{onClick:()=>x(s.employee,"Employee Signature",s.employeeName||"Warning Recipient"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:e.jsx(Re,{className:"w-4 h-4 text-gray-500"})})]}),m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:e.jsx("img",{src:s.employee,alt:"Employee Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{children:s.employeeName||"Employee"})]}),n&&s.employeeTimestamp&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("span",{children:p(s.employeeTimestamp)})]})]})]}):e.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(ve,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting employee acknowledgment"})]})]})]})}),N&&e.jsx("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Document Digitally Signed & Verified"}),e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["These digital signatures are legally binding and comply with electronic signature regulations.",g&&` Document ID: ${g}`]})]}),F&&e.jsx("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download signatures",children:e.jsx(fe,{className:"w-4 h-4"})})]})}),!N&&(d||m)&&e.jsx("div",{className:"bg-yellow-50 border-t border-yellow-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Signature Collection In Progress"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Document requires signatures from both manager and employee to be legally complete."})]})]})}),W&&e.jsx(ks,{signature:W.signature,title:W.title,subtitle:W.subtitle,isOpen:!0,onClose:y,allowDownload:F})]})},H=(s,g="Not specified")=>s==null?g:typeof s=="string"?s:typeof s=="number"?s.toString():typeof s=="boolean"?s?"Yes":"No":g,xe=(s,g="Not set")=>{if(!s)return g;try{return(s instanceof Date?s:new Date(s)).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return g}},Ls=(s,g)=>{const n=xe(s,"");return!n||n==="Not set"?"Not specified":g?`${n} at ${g}`:n},Oe=(s,g)=>{const n={verbal:{primary:"bg-blue-600",secondary:"bg-blue-50",accent:"text-blue-600",background:"bg-blue-50",text:"text-blue-800",border:"border-blue-200"},written:{primary:"bg-yellow-600",secondary:"bg-yellow-50",accent:"text-yellow-600",background:"bg-yellow-50",text:"text-yellow-800",border:"border-amber-200"},final:{primary:"bg-red-600",secondary:"bg-red-50",accent:"text-red-600",background:"bg-red-50",text:"text-red-800",border:"border-red-200"},dismissal:{primary:"bg-red-700",secondary:"bg-red-50",accent:"text-red-700",background:"bg-red-50",text:"text-red-900",border:"border-red-300"}};return n[s]||n.verbal},Ps=({warning:s,isOpen:g,onClose:n,canTakeAction:M=!1,userRole:S="viewer",className:F="",onApprove:j,onReject:W,onAppealOutcome:c,canManageAppeals:v=!1})=>{const[d,m]=a.useState("overview"),[N,x]=a.useState(new Set(["summary"])),[y,p]=a.useState({type:null,loading:!1}),[A,h]=a.useState(!1),[I,w]=a.useState(""),[_,E]=a.useState(!1),[P,k]=a.useState(!1),[r,f]=a.useState(!1),[O,U]=a.useState(!1),[Y,B]=a.useState(!1),[q,Q]=a.useState(null),[se,L]=a.useState(!1),[K,te]=a.useState(null),[ne,he]=a.useState(""),[ae,oe]=a.useState(!1),re=a.useRef(null),de=a.useRef(null),i=a.useMemo(()=>s?{id:s.id||"",employeeName:H(s.employeeName),employeeNumber:H(s.employeeNumber),department:H(s.department),position:H(s.position),category:H(s.category),level:s.level||"verbal",status:s.status||"issued",incidentDate:xe(s.incidentDate),incidentTime:H(s.incidentTime),incidentDateTime:Ls(s.incidentDate,s.incidentTime),incidentLocation:H(s.incidentLocation),description:H(s.description),issueDate:xe(s.issueDate),expiryDate:xe(s.expiryDate),issuedByName:H(s.issuedByName),deliveryMethod:H(s.deliveryMethod),additionalNotes:H(s.additionalNotes),hasAudio:!!s.audioRecording?.url,audioRecording:s.audioRecording||null,hasPDF:!!(s.pdfGenerated||s.pdfFilename),hasSignatures:!!(s.signatures&&Object.keys(s.signatures).length>0),signatures:s.signatures||{manager:null,employee:null},validityPeriod:s.validityPeriod||6,escalationReason:H(s.escalationReason),acknowledgedAt:s.acknowledgedAt?xe(s.acknowledgedAt):null,acknowledgedBy:H(s.acknowledgedBy),appealSubmitted:!!s.appealSubmitted,appealDate:s.appealDate?xe(s.appealDate):null,createdAt:xe(s.createdAt),updatedAt:xe(s.updatedAt)}:null,[s]),l=a.useMemo(()=>i?Oe(i.level,i.status):Oe("verbal"),[i]),o=a.useCallback(()=>{E(!0),setTimeout(()=>{n(),E(!1),m("overview"),x(new Set(["summary"])),p({type:null,loading:!1}),h(!1),w(""),f(!1),U(!1),B(!1),Q(null)},300)},[n]);a.useCallback(b=>{x(z=>{const J=new Set(z);return J.has(b)?J.delete(b):J.add(b),J})},[]);const D=a.useCallback(async()=>{if(!(!j||!i?.id)){p({type:"approve",loading:!0});try{await j(i.id),setTimeout(o,1e3)}catch(b){C.error("Failed to approve warning:",b),p({type:null,loading:!1})}}},[j,i?.id,o]),T=a.useCallback(async()=>{if(!(!W||!i?.id)){p({type:"reject",loading:!0});try{await W(i.id,I),setTimeout(o,1e3)}catch(b){C.error("Failed to reject warning:",b),p({type:null,loading:!1})}}},[W,i?.id,I,o]),R=a.useCallback(()=>{h(!0)},[]),le=a.useCallback(()=>{i?.hasAudio&&B(!0)},[i?.hasAudio]),ce=a.useCallback(()=>{f(!0)},[]),ie=a.useCallback(()=>{i?.hasSignatures&&U(!0)},[i?.hasSignatures]),X=a.useCallback(b=>{if(!i?.signatures)return;const z=i.signatures[b];z&&(Q({signature:z,title:`${b.charAt(0).toUpperCase()+b.slice(1)} Signature`,subtitle:`Warning ID: ${i.id} • ${i.employeeName}`}),U(!0))},[i]);return!g||!i?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:de,className:`
          fixed inset-0 z-40 flex items-center justify-center p-4
          bg-black/60 backdrop-blur-xl
          transition-all duration-500 ease-out
          ${_?"opacity-0":"opacity-100"}
          ${F}
        `,onClick:b=>b.target===de.current&&o(),children:e.jsxs("div",{ref:re,className:`
            relative w-full max-w-4xl max-h-[90vh] 
            bg-white rounded-lg shadow-xl border border-gray-200
            overflow-hidden
            transition-all duration-300 ease-out
            ${_?"scale-95 opacity-0":"scale-100 opacity-100"}
          `,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`
                w-10 h-10 rounded-lg ${l.primary}
                flex items-center justify-center
              `,children:e.jsx(je,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[i.employeeName," • ",i.category]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`inline-flex px-3 py-1 text-sm font-medium rounded-full ${i.level==="verbal"?"bg-blue-100 text-blue-800":i.level==="written"?"bg-yellow-100 text-yellow-800":i.level==="final"?"bg-red-100 text-red-800":i.level==="dismissal"?"bg-red-200 text-red-900":"bg-gray-100 text-gray-800"}`,children:i.level==="verbal"?"Verbal Warning":i.level==="written"?"Written Warning":i.level==="final"?"Final Warning":i.level==="dismissal"?"Dismissal":"Warning"}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[e.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Incident Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description:"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:i.incidentDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Location:"}),e.jsx("span",{className:"ml-2 text-gray-600",children:i.incidentLocation})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-600"}),"Employee Details"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.employeeName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"ID:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.employeeNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Position:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.position})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Department:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.department})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-600"}),"Warning Timeline"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.issueDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.expiryDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Issued By:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i.issuedByName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ${i.deliveryStatus==="delivered"?"text-green-600":"text-orange-600"}`,children:i.deliveryStatus==="delivered"?"Delivered":"Pending Delivery"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.hasAudio&&e.jsxs("button",{onClick:le,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",children:[e.jsx(as,{className:"w-4 h-4"}),"Audio Recording"]}),e.jsxs("button",{onClick:ce,className:"flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm",children:[e.jsx(Ae,{className:"w-4 h-4"}),"View PDF"]}),i.hasSignatures&&e.jsxs("button",{onClick:ie,className:"flex items-center gap-2 px-3 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm",children:[e.jsx(we,{className:"w-4 h-4"}),"Signatures"]})]}),M&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"Reject"}),e.jsx("button",{onClick:D,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium",children:"Approve"})]})]})]})}),A&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reject Warning"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please provide a reason for rejecting this warning:"}),e.jsx("textarea",{value:I,onChange:b=>w(b.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",placeholder:"Enter rejection reason..."}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 font-medium transition-colors text-sm",children:"Cancel"}),e.jsx("button",{onClick:T,disabled:!I.trim()||y.loading,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 font-medium transition-colors text-sm",children:y.loading?"Processing...":"Reject Warning"})]})]})})]})}),Y&&i?.hasAudio&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),e.jsx("button",{onClick:()=>B(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(Me,{audioData:i.audioRecording,compact:!1})})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsx("button",{onClick:()=>U(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:i?.hasSignatures?e.jsxs("div",{className:"space-y-4",children:[i.signatures?.manager&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Manager Signature"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:e.jsx("img",{src:i.signatures.manager,alt:"Manager Signature",className:"max-w-full h-20 mx-auto"})})]}),i.signatures?.employee&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Employee Signature"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:e.jsx("img",{src:i.signatures.employee,alt:"Employee Signature",className:"max-w-full h-20 mx-auto"})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),e.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),r&&e.jsx(We,{isOpen:r,onClose:()=>f(!1),warningData:{selectedEmployee:{id:s.employeeId||"",firstName:s.employeeName||"Unknown",lastName:s.employeeLastName||"Employee",employeeId:s.employeeNumber||"",employeeNumber:s.employeeNumber||"",department:s.employeeDepartment||s.department||"",position:s.employeePosition||s.position||"",email:s.employeeEmail||""},selectedCategory:{id:s.categoryId||"",name:s.categoryName||s.category||"General",severity:"medium",description:s.categoryName||s.category||"General"},formData:{incidentDate:s.incidentDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0],incidentTime:s.incidentTime||"12:00",incidentLocation:s.incidentLocation||"",incidentDescription:s.incidentDescription||s.description||"",additionalNotes:s.additionalNotes||"",validityPeriod:s.validityPeriod||6,issueDate:s.issueDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0]},signatures:s.signatures||{manager:null,employee:null},lraRecommendation:{category:s.categoryName||s.category||"General",recommendedLevel:s.level||"Counselling Session",suggestedLevel:s.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:s.organizationId||""},onPDFGenerated:(b,z)=>{C.debug("PDF generated:",z);const J=URL.createObjectURL(b),G=document.createElement("a");G.href=J,G.download=z,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(J)}}),r&&e.jsx(We,{isOpen:r,onClose:()=>f(!1),warningData:{selectedEmployee:{id:s.employeeId||"",firstName:s.employeeName||"Unknown",lastName:s.employeeLastName||"Employee",employeeId:s.employeeNumber||"",employeeNumber:s.employeeNumber||"",department:s.employeeDepartment||s.department||"",position:s.employeePosition||s.position||"",email:s.employeeEmail||""},selectedCategory:{id:s.categoryId||"",name:s.categoryName||s.category||"General",severity:"medium",description:s.categoryName||s.category||"General"},formData:{incidentDate:s.incidentDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0],incidentTime:s.incidentTime||"12:00",incidentLocation:s.incidentLocation||"",incidentDescription:s.incidentDescription||s.description||"",additionalNotes:s.additionalNotes||"",validityPeriod:s.validityPeriod||6,issueDate:s.issueDate?.toISOString?.()?.split("T")[0]||new Date().toISOString().split("T")[0]},signatures:s.signatures||{manager:null,employee:null},lraRecommendation:{category:s.categoryName||s.category||"General",recommendedLevel:s.level||"Counselling Session",suggestedLevel:s.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:s.organizationId||""},onPDFGenerated:(b,z)=>{C.debug("PDF generated:",z),console.log("Warning data for PDF:",{categoryName:s.categoryName,category:s.category,signatures:s.signatures});const J=URL.createObjectURL(b),G=document.createElement("a");G.href=J,G.download=z,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(J)}}),Y&&i?.hasAudio&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",i.id," • ",i.employeeName]})]}),e.jsx("button",{onClick:()=>B(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx(Me,{audioRecording:i.audioRecording,warningId:i.id,showDownload:!0,showMetadata:!0,className:"w-full"})})]})}),O&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",i.id," • ",i.employeeName]})]}),e.jsx("button",{onClick:()=>U(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:i?.hasSignatures?e.jsxs(e.Fragment,{children:[e.jsx(As,{signatures:i.signatures,warningId:i.id,showTimestamps:!0,showVerification:!0,allowDownload:!0,className:"w-full mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[i.signatures.manager&&e.jsxs("button",{onClick:()=>X("manager"),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[e.jsx(Te,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"View Manager Signature"})]}),i.signatures.employee&&e.jsxs("button",{onClick:()=>X("employee"),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[e.jsx(Te,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"View Employee Signature"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(we,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),e.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),q&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:q.title}),q.subtitle&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:q.subtitle})]}),e.jsx("button",{onClick:()=>Q(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:e.jsx("img",{src:q.signature,alt:q.title,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),e.jsxs("button",{onClick:()=>{const b=document.createElement("a");b.href=q.signature,b.download=`${q.title.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(b),b.click(),document.body.removeChild(b)},className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Download PNG"]})]})]})})]})},Es={email:{icon:is,name:"Email",color:"blue",requiresProof:!0,instructions:["Send the warning document via email","Take a screenshot of the sent email","Include timestamp and recipient email visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Chrome: Press Ctrl + Shift + Alt + 3"]},whatsapp:{icon:ls,name:"WhatsApp Business",color:"green",requiresProof:!0,instructions:["Send the warning document via WhatsApp Business","Wait for delivery confirmation (double blue ticks)","Take a screenshot showing the sent message","Include timestamp and delivery status visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Phone: Use screenshot function (varies by device)"]},printed:{icon:rs,name:"Print & Hand Delivery",color:"purple",requiresProof:!1,instructions:["Print the warning document","Hand deliver to the employee","Get employee acknowledgment signature on physical copy","File the signed copy in employee records","Confirm delivery completion below"]}},Ws=({isOpen:s,onClose:g,warningId:n,employeeName:M,deliveryMethod:S,onDeliveryConfirmed:F})=>{const[j,W]=a.useState(null),[c,v]=a.useState(null),[d,m]=a.useState(!1),[N,x]=a.useState(null),y=a.useRef(null),p=Es[S],A=a.useCallback(P=>{const k=P.target.files?.[0];if(!k)return;if(!k.type.startsWith("image/")){x("Please select an image file (PNG, JPG, etc.)");return}if(k.size>5*1024*1024){x("Image must be less than 5MB");return}x(null),W(k);const r=new FileReader;r.onload=f=>{v(f.target?.result)},r.readAsDataURL(k)},[]),h=a.useCallback(P=>{P.preventDefault(),P.stopPropagation()},[]),I=a.useCallback(P=>{P.preventDefault(),P.stopPropagation();const k=P.dataTransfer.files;if(k.length>0){const r=k[0];r.type.startsWith("image/")&&A({target:{files:[r]}})}},[A]),w=a.useCallback(async()=>{if(p.requiresProof&&!j){x("Please upload proof of delivery screenshot");return}m(!0),x(null);try{await F({warningId:n,deliveryMethod:S,deliveredAt:new Date,proofImage:j||void 0})}catch(P){x(P instanceof Error?P.message:"Failed to confirm delivery")}finally{m(!1)}},[p.requiresProof,j,F,n,S]),_=a.useCallback(()=>{W(null),v(null),y.current&&(y.current.value="")},[]);if(!s)return null;const E=p.icon;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:`bg-gradient-to-r from-${p.color}-600 to-${p.color}-700 p-6 text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(E,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Confirm Delivery"}),e.jsxs("p",{className:"text-sm opacity-90",children:[p.name," delivery for ",M]})]})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Delivery Instructions"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("ol",{className:"space-y-2",children:p.instructions.map((P,k)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[e.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:k+1}),e.jsx("span",{className:"text-gray-700",children:P})]},k))})})]}),p.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4 text-gray-600"}),"Screenshot Instructions"]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:p.screenshotTips?.map((P,k)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("kbd",{className:"bg-gray-200 px-2 py-1 rounded text-xs font-mono",children:P.split(": ")[1]}),e.jsx("span",{className:"text-xs",children:P.split(": ")[0]})]},k))})})]}),p.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Upload Proof of Delivery"}),j?e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[c&&e.jsx("img",{src:c,alt:"Proof of delivery",className:"w-24 h-24 object-cover rounded-lg border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:j.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(j.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:_,className:"text-red-600 hover:text-red-700 p-1",children:e.jsx(Z,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(be,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Ready to upload"})]})]})]})}):e.jsxs("div",{onDragOver:h,onDrop:I,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onClick:()=>y.current?.click(),children:[e.jsx(os,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Drop screenshot here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG up to 5MB"}),e.jsx("input",{ref:y,type:"file",accept:"image/*",onChange:A,className:"hidden"})]})]}),N&&e.jsx("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:N})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:g,disabled:d,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:d||p.requiresProof&&!j,className:`flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-${p.color}-600 to-${p.color}-700 hover:from-${p.color}-700 hover:to-${p.color}-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:d?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 animate-spin"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ds,{className:"w-4 h-4"}),"Confirm Delivery"]})})]})]})]})})},Fs=[{value:"procedural_unfair",label:"Procedural Unfairness",description:"The disciplinary process was not followed correctly"},{value:"substantive_unfair",label:"Substantive Unfairness",description:"The warning was not justified by the facts"},{value:"bias_prejudice",label:"Bias or Prejudice",description:"The decision was influenced by bias or unfair treatment"},{value:"insufficient_evidence",label:"Insufficient Evidence",description:"Not enough evidence to support the warning"},{value:"inconsistent_treatment",label:"Inconsistent Treatment",description:"Others were treated differently for similar conduct"},{value:"other",label:"Other Grounds",description:"Different reason (explain in details below)"}],Is=({isOpen:s,onClose:g,warning:n,onAppealSubmit:M})=>{const[S,F]=a.useState(""),[j,W]=a.useState(""),[c,v]=a.useState(""),[d,m]=a.useState(!1),[N,x]=a.useState(null),y=n.issueDate?.seconds?new Date(n.issueDate.seconds*1e3):new Date(n.issueDate),p=new Date(y);p.setDate(p.getDate()+30);const A=a.useCallback(async()=>{if(!S){x("Please select grounds for your appeal");return}if(!j.trim()){x("Please provide details explaining your appeal");return}if(!c.trim()){x("Please specify what outcome you are requesting");return}m(!0),x(null);try{await M({warningId:n.id,grounds:S,additionalDetails:j.trim(),requestedOutcome:c.trim()})}catch(h){x(h instanceof Error?h.message:"Failed to submit appeal")}finally{m(!1)}},[S,j,c,M,n.id]);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-600 to-orange-700 p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(Ae,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Appeal Disciplinary Warning"}),e.jsx("p",{className:"text-sm opacity-90",children:"Submit formal appeal as per Labour Relations Act"})]})]}),e.jsx("button",{onClick:g,disabled:d,className:"p-2 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(Z,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Employee:"}),e.jsx("div",{className:"font-medium",children:n.employeeName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Warning Level:"}),e.jsx("div",{className:"font-medium capitalize",children:n.level.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("div",{className:"font-medium",children:n.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("div",{className:"font-medium",children:y.toLocaleDateString()})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Description:"}),e.jsx("div",{className:"text-sm mt-1 p-2 bg-white rounded border",children:n.description})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ke,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-800 font-medium mb-2",children:"Your Appeal Rights"}),e.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs",children:[e.jsxs("li",{children:["• Appeals must be submitted within ",e.jsx("strong",{children:"30 days"})," of the warning (deadline: ",p.toLocaleDateString(),")"]}),e.jsx("li",{children:"• You have the right to fair treatment under the Labour Relations Act"}),e.jsx("li",{children:"• All internal procedures must be exhausted before CCMA referral"}),e.jsx("li",{children:"• You may be assisted by a shop steward or fellow employee"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Grounds for Appeal *"}),e.jsx("div",{className:"space-y-2",children:Fs.map(h=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"appealGrounds",value:h.value,checked:S===h.value,onChange:I=>F(I.target.value),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:h.label}),e.jsx("div",{className:"text-xs text-gray-600",children:h.description})]})]},h.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Appeal Details *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Explain in detail why you believe the warning is unfair and what evidence supports your appeal."}),e.jsx("textarea",{value:j,onChange:h=>W(h.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"Provide specific facts, dates, witnesses, and any other relevant information that supports your appeal..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Requested Outcome *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Specify what you would like to happen if your appeal is successful."}),e.jsx("textarea",{value:c,onChange:h=>v(h.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"E.g., 'Remove warning from my record', 'Reduce warning level', 'Replace with verbal counselling', etc."})]})]}),N&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:N})]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsxs("span",{children:["Appeal deadline: ",p.toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:g,disabled:d,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:d||!S||!j.trim()||!c.trim(),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-600 to-orange-700 hover:from-amber-700 hover:to-orange-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 animate-spin"}),"Submitting Appeal..."]}):e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"w-4 h-4"}),"Submit Appeal"]})})]})]})]})}):null},Rs=[{value:"upheld",label:"Uphold Warning",icon:je,color:"text-green-600",bgColor:"bg-green-50",description:"Warning is justified and remains unchanged"},{value:"reduced",label:"Reduce Warning Level",icon:us,color:"text-orange-600",bgColor:"bg-orange-50",description:"Warning is justified but level should be reduced"},{value:"modified",label:"Modify Warning",icon:gs,color:"text-blue-600",bgColor:"bg-blue-50",description:"Warning content needs modification"},{value:"overturned",label:"Overturn Warning",icon:Ee,color:"text-red-600",bgColor:"bg-red-50",description:"Warning is not justified and should be removed"}],Ne=[{value:"counselling",label:"Counselling",severity:1},{value:"verbal",label:"Verbal Warning",severity:2},{value:"first_written",label:"First Written Warning",severity:3},{value:"second_written",label:"Second Written Warning",severity:4},{value:"final_written",label:"Final Written Warning",severity:5}],Ts={procedural_unfair:"Procedural Unfairness",substantive_unfair:"Substantive Unfairness",bias_prejudice:"Bias or Prejudice",insufficient_evidence:"Insufficient Evidence",inconsistent_treatment:"Inconsistent Treatment",other:"Other Grounds"},Ms=({isOpen:s,onClose:g,warning:n,onDecisionSubmit:M})=>{const[S,F]=a.useState(""),[j,W]=a.useState(""),[c,v]=a.useState(""),[d,m]=a.useState(n.level),[N,x]=a.useState(n.description),[y,p]=a.useState(!1),[A,h]=a.useState(""),[I,w]=a.useState(!1),_=r=>r?(r.toDate?r.toDate():new Date(r)).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}):"Unknown",E=a.useCallback(async()=>{if(!S||!j.trim()){alert("Please select a decision and provide reasoning.");return}w(!0);try{await M({warningId:n.id,decision:S,reasoning:j.trim(),newLevel:S==="reduced"||S==="modified"?d:void 0,newDescription:S==="modified"?N:void 0,hrNotes:c.trim(),followUpRequired:y,followUpDate:y&&A?new Date(A):void 0}),g()}catch(r){console.error("Failed to submit appeal decision:",r),alert("Failed to submit decision. Please try again.")}finally{w(!1)}},[S,j,c,d,N,y,A,n.id,M,g]),P=Ne.find(r=>r.value===n.level)?.severity||0,k=Ne.filter(r=>r.severity<P);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx($e,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Appeal Review"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review and decide on employee appeal"})]})]}),e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Z,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-gray-600"}),"Original Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Employee:"}),e.jsxs("span",{className:"text-sm",children:[n.employeeName," (",n.employeeNumber,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Department:"}),e.jsx("span",{className:"text-sm",children:n.department})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Issue Date:"}),e.jsx("span",{className:"text-sm",children:_(n.issueDate)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Category:"}),e.jsx("span",{className:"text-sm ml-2",children:n.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Level:"}),e.jsx("span",{className:`ml-2 px-2 py-1 text-xs rounded-full ${n.level==="final_written"?"bg-red-100 text-red-800":n.level==="second_written"?"bg-orange-100 text-orange-800":n.level==="first_written"?"bg-yellow-100 text-yellow-800":n.level==="verbal"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:Ne.find(r=>r.value===n.level)?.label||n.level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Description:"}),e.jsx("p",{className:"text-sm mt-1 text-gray-700",children:n.description})]})]})]})]}),n.appealDetails&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ms,{className:"w-5 h-5 text-blue-600"}),"Employee's Appeal"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Appeal Grounds:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:Ts[n.appealDetails.grounds]||n.appealDetails.grounds})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee's Statement:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:n.appealDetails.additionalDetails})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Outcome:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:n.appealDetails.requestedOutcome})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[e.jsxs("span",{children:["Submitted: ",_(n.appealDetails.submittedDate)]}),e.jsxs("span",{children:["By: ",n.appealDetails.submittedBy]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(xs,{className:"w-5 h-5 text-gray-600"}),"HR Decision"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:Rs.map(r=>{const f=r.icon;return e.jsx("button",{onClick:()=>F(r.value),className:`p-4 rounded-lg border-2 transition-all ${S===r.value?`border-purple-500 ${r.bgColor}`:"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:`w-5 h-5 ${r.color}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-sm",children:r.label}),e.jsx("div",{className:"text-xs text-gray-600",children:r.description})]})]})},r.value)})}),(S==="reduced"||S==="modified")&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:S==="reduced"?"Reduce to Level:":"New Warning Level:"}),e.jsx("select",{value:d,onChange:r=>m(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:S==="reduced"?k.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value)):Ne.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),S==="modified"&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modified Warning Description:"}),e.jsx("textarea",{value:N,onChange:r=>x(r.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Enter the modified warning description..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Decision Reasoning (Legal Documentation)"]}),e.jsx("textarea",{value:j,onChange:r=>W(r.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Provide detailed reasoning for your decision. This will be part of the legal record and may be reviewed by labor courts or CCMA...",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Internal Notes (Optional)"}),e.jsx("textarea",{value:c,onChange:r=>v(r.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Internal notes for HR records (not shared with employee)..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:r=>p(r.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Follow-up Required"})]}),y&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date:"}),e.jsx("input",{type:"date",value:A,onChange:r=>h(r.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"This decision will be automatically documented and employee will be notified"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:g,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:!S||!j.trim()||I,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors flex items-center gap-2",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{className:"w-4 h-4"}),"Submit Decision"]})})]})]})]})}):null},Os=({onBack:s})=>{const{user:g,organization:n}=Ue(),[M,S]=a.useState([]),[F,j]=a.useState([]),[W,c]=a.useState(!0),[v,d]=a.useState(""),[m,N]=a.useState(null),[x,y]=a.useState(null),[p,A]=a.useState("all"),[h,I]=a.useState("all"),[w,_]=a.useState("all"),[E,P]=a.useState("all"),[k,r]=a.useState("date"),[f,O]=a.useState("desc"),[U,Y]=a.useState(1),[B]=a.useState(10),q=He(g?.role.id,g?.departmentIds);a.useEffect(()=>{Q()},[n?.id]);const Q=async()=>{if(n?.id)try{c(!0);const[l,o]=await Promise.all([ee.warnings.getArchived(n.id),ee.employees.getAll(n.id,{includeArchived:!0})]);S(l),j(o),se(l),C.success(`📋 Loaded ${l.length} archived warnings`)}catch(l){C.error("Failed to load archived warnings:",l)}finally{c(!1)}},se=l=>{const o={total:l.length,byLevel:{},byStatus:{}};let D,T;l.forEach(R=>{const le=R.level||"unknown";o.byLevel[le]=(o.byLevel[le]||0)+1;const ce=R.status||"unknown";o.byStatus[ce]=(o.byStatus[ce]||0)+1;const ie=R.issueDate?.toDate?R.issueDate.toDate():new Date(R.issueDate);(!D||ie<(D.issueDate?.toDate?D.issueDate.toDate():new Date(D.issueDate)))&&(D=R),(!T||ie>(T.issueDate?.toDate?T.issueDate.toDate():new Date(T.issueDate)))&&(T=R)}),o.oldestWarning=D,o.newestWarning=T,y(o)},L=l=>{const o=F.find(D=>D.id===l);return o?{name:`${o.profile.firstName} ${o.profile.lastName}`,department:o.profile.department,employeeNumber:o.profile.employeeNumber,isArchived:!!o.archivedAt}:{name:"Unknown Employee",department:"Unknown",employeeNumber:"N/A",isArchived:!1}},K=a.useMemo(()=>{const l=new Set(F.map(o=>o.profile.department));return Array.from(l).sort()},[F]),te=a.useMemo(()=>F.map(l=>({id:l.id,name:`${l.profile.firstName} ${l.profile.lastName}`})).sort((l,o)=>l.name.localeCompare(o.name)),[F]),ne=a.useMemo(()=>{let l=M.filter(o=>{if(v){const D=v.toLowerCase(),T=L(o.employeeId);if(!(T.name.toLowerCase().includes(D)||o.category.toLowerCase().includes(D)||o.description.toLowerCase().includes(D)||T.employeeNumber.toLowerCase().includes(D)))return!1}return!(p!=="all"&&o.status!==p||h!=="all"&&o.level!==h||w!=="all"&&L(o.employeeId).department!==w||E!=="all"&&o.employeeId!==E)});return l.sort((o,D)=>{let T=0;switch(k){case"date":const R=o.issueDate?.toDate?o.issueDate.toDate():new Date(o.issueDate),le=D.issueDate?.toDate?D.issueDate.toDate():new Date(D.issueDate);T=R.getTime()-le.getTime();break;case"employee":const ce=L(o.employeeId).name,ie=L(D.employeeId).name;T=ce.localeCompare(ie);break;case"level":const X=["counselling","verbal","first_written","final_written"],b=X.indexOf(o.level)!==-1?X.indexOf(o.level):999,z=X.indexOf(D.level)!==-1?X.indexOf(D.level):999;T=b-z;break;case"category":T=o.category.localeCompare(D.category);break}return f==="desc"?-T:T}),l},[M,v,p,h,w,E,k,f]),he=Math.ceil(ne.length/B),ae=(U-1)*B,oe=ne.slice(ae,ae+B);a.useEffect(()=>{Y(1)},[v,p,h,w,E]);const re=l=>{if(!l)return"Unknown";try{return(l.toDate?l.toDate():new Date(l)).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid Date"}},de=l=>{switch(l){case"counselling":return"bg-blue-100 text-blue-800 border-blue-200";case"verbal":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"first_written":return"bg-orange-100 text-orange-800 border-orange-200";case"final_written":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},i=l=>{switch(l){case"active":return"bg-green-100 text-green-800 border-green-200";case"expired":return"bg-gray-100 text-gray-800 border-gray-200";case"appealed":return"bg-blue-100 text-blue-800 border-blue-200";case"overturned":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return W?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-3xl shadow-2xl border border-slate-200 max-w-md w-full",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-orange-200 border-t-orange-600 rounded-full animate-spin mx-auto mb-6"}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:"Loading Archive"}),e.jsx("p",{className:"text-slate-600",children:"Fetching archived warnings..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-white/50 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 via-orange-700 to-orange-800 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:s,className:"p-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg transition-all",children:e.jsx(hs,{className:"w-5 h-5"})}),e.jsx("div",{className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:e.jsx(Se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",children:"Warning Archive"}),e.jsxs("p",{className:"text-orange-100 text-sm font-medium",children:[ne.length," archived warnings"]})]})]}),x&&e.jsxs("div",{className:"flex gap-4 text-white",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:x.total}),e.jsx("div",{className:"text-xs text-orange-100",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:Object.keys(x.byLevel).length}),e.jsx("div",{className:"text-xs text-orange-100",children:"Levels"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:te.length}),e.jsx("div",{className:"text-xs text-orange-100",children:"Employees"})]})]})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search archived warnings...",value:v,onChange:l=>d(l.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsxs("select",{value:p,onChange:l=>A(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"}),e.jsx("option",{value:"appealed",children:"Appealed"}),e.jsx("option",{value:"overturned",children:"Overturned"})]}),e.jsxs("select",{value:h,onChange:l=>I(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"counselling",children:"Counselling"}),e.jsx("option",{value:"verbal",children:"Verbal"}),e.jsx("option",{value:"first_written",children:"First Written"}),e.jsx("option",{value:"final_written",children:"Final Written"})]}),e.jsxs("select",{value:w,onChange:l=>_(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Departments"}),K.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsxs("select",{value:E,onChange:l=>P(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",children:[e.jsx("option",{value:"all",children:"All Employees"}),te.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]}),e.jsxs("select",{value:`${k}-${f}`,onChange:l=>{const[o,D]=l.target.value.split("-");r(o),O(D)},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 text-sm",children:[e.jsx("option",{value:"date-desc",children:"Latest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"employee-asc",children:"Employee A-Z"}),e.jsx("option",{value:"employee-desc",children:"Employee Z-A"}),e.jsx("option",{value:"level-desc",children:"Level: High-Low"}),e.jsx("option",{value:"level-asc",children:"Level: Low-High"}),e.jsx("option",{value:"category-asc",children:"Category A-Z"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg border overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Employee"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Category"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Level"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),e.jsx("th",{className:"text-center py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:oe.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"text-center py-12",children:[e.jsx(Se,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"font-medium text-gray-500",children:"No archived warnings found"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Try adjusting your search or filters"})]})}):oe.map(l=>{const o=L(l.employeeId);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[o.name,o.isArchived&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full",children:"Archived Employee"})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),o.employeeNumber]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"w-3 h-3"}),o.department]})]})]})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-gray-900",children:l.category}),e.jsx("div",{className:"text-sm text-gray-600 truncate max-w-48",children:l.description})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${de(l.level)}`,children:l.level?.replace("_"," ").toUpperCase()})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[e.jsx(ye,{className:"w-3 h-3"}),re(l.issueDate)]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${i(l.status)}`,children:l.status?.toUpperCase()})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:()=>N(l),className:"p-2 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",title:"View Details",children:e.jsx(ys,{className:"w-4 h-4"})}),q.canExport&&e.jsx("button",{className:"p-2 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg transition-colors",title:"Export Warning",children:e.jsx(fe,{className:"w-4 h-4"})})]})})]},l.id)})})]})}),he>1&&e.jsxs("div",{className:"px-4 py-3 bg-gray-50 border-t flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",ae+1," to ",Math.min(ae+B,ne.length)," of ",ne.length," warnings"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Y(U-1),disabled:U===1,className:"p-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(fs,{className:"w-4 h-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,he)},(l,o)=>{const D=o+1;return e.jsx("button",{onClick:()=>Y(D),className:`px-3 py-2 rounded-lg text-sm font-medium ${U===D?"bg-orange-600 text-white":"bg-white border border-gray-300 hover:bg-gray-50"}`,children:D},D)})}),e.jsx("button",{onClick:()=>Y(U+1),disabled:U===he,className:"p-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(js,{className:"w-4 h-4"})})]})]})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),e.jsx("button",{onClick:()=>N(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Employee"}),e.jsx("div",{className:"mt-1 text-gray-900",children:L(m.employeeId).name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Category"}),e.jsx("div",{className:"mt-1 text-gray-900",children:m.category})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Level"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${de(m.level)}`,children:m.level?.replace("_"," ").toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium border ${i(m.status)}`,children:m.status?.toUpperCase()})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Issue Date"}),e.jsx("div",{className:"mt-1 text-gray-900",children:re(m.issueDate)})]}),m.archivedAt&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Archived Date"}),e.jsx("div",{className:"mt-1 text-gray-900",children:re(m.archivedAt)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Description"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded-lg text-gray-900",children:m.description})]}),m.archiveReason&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Archive Reason"}),e.jsx("div",{className:"mt-1 p-3 bg-orange-50 rounded-lg text-gray-900",children:m.archiveReason})]})]})]})})]})},ue=(s,g="Unknown")=>s==null?g:typeof s=="string"?s:typeof s=="number"?s.toString():typeof s=="boolean"?s?"Yes":"No":s instanceof Date?s.toLocaleDateString():typeof s=="object"?s.name?String(s.name):s.title?String(s.title):s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:g:String(s),Pe=s=>{if(!s.issueDate)return!1;const g=s.issueDate.seconds?new Date(s.issueDate.seconds*1e3):new Date(s.issueDate),n=new Date(g);return n.setDate(n.getDate()+30),new Date<=n},qs=({organizationId:s,onClose:g,PDFGenerationService:n,DataService:M,canTakeAction:S=!1,userRole:F="viewer"})=>{const{user:j,organization:W}=Ue(),c=s||W?.id;C.debug("🔧 [WarningsReviewDashboard] Using API layer version");const[v,d]=a.useState([]),[m,N]=a.useState([]),[x,y]=a.useState(!0),[p,A]=a.useState(null),[h,I]=a.useState(1),[w,_]=a.useState(""),[E,P]=a.useState("all"),[k,r]=a.useState("all"),[f,O]=a.useState("all"),[U,Y]=a.useState("date"),[B,q]=a.useState("desc"),[Q,se]=a.useState(null),[L,K]=a.useState(!1),[te,ne]=a.useState(!1),[he,ae]=a.useState(!1),[oe,re]=a.useState(null),[de,i]=a.useState(!1),[l,o]=a.useState(null),[D,T]=a.useState(!1),[R,le]=a.useState(null),[ce,ie]=a.useState("warnings"),X=10,b=a.useCallback(async()=>{if(!c){C.warn("No organization ID available for loading warnings"),y(!1);return}try{y(!0),A(null);let t;Fe()?(C.debug("🔄 Loading warnings via NestedDataService for org:",c),Ze()?(t=(await Ye.getOrganizationWarnings(c,{},{pageSize:500,orderField:"issueDate",orderDirection:"desc"})).warnings,C.debug(`📁 [NESTED] Loaded ${t.length} warnings via collection group`)):(C.debug("📋 [FALLBACK] Collection group disabled, using flat structure"),t=await ee.warnings.getAll(c))):(C.debug("🔄 Loading warnings via API layer for org:",c),t=await ee.warnings.getAll(c));const $=t.filter(V=>!V.isArchived&&V.status!=="expired"&&V.status!=="overturned").sort((V,me)=>new Date(me.createdAt||0).getTime()-new Date(V.createdAt||0).getTime());d($),N($),C.success(`📊 Loaded ${$.length} active warnings (${Fe()?"NESTED":"FLAT"} structure)`)}catch(t){C.error("❌ Failed to load warnings:",t);const u=t instanceof Error?t.message:"Unknown error";A(`Failed to load warnings: ${u}`)}finally{y(!1)}},[c]);a.useEffect(()=>{c?b():y(!1)},[c,b]),a.useEffect(()=>{let t=[...v];w&&(t=t.filter(u=>u.employeeName.toLowerCase().includes(w.toLowerCase())||u.employeeNumber.toLowerCase().includes(w.toLowerCase())||u.category.toLowerCase().includes(w.toLowerCase())||u.description.toLowerCase().includes(w.toLowerCase()))),E!=="all"&&(t=t.filter(u=>u.status===E)),k!=="all"&&(t=t.filter(u=>u.level===k)),f!=="all"&&(t=t.filter(u=>u.department===f)),t.sort((u,$)=>{let V,me;switch(U){case"employee":V=u.employeeName,me=$.employeeName;break;case"level":V=u.level,me=$.level;break;case"status":V=u.status||"",me=$.status||"";break;default:V=new Date(u.createdAt||0).getTime(),me=new Date($.createdAt||0).getTime()}return V<me?B==="asc"?-1:1:V>me?B==="asc"?1:-1:0}),N(t),I(1)},[v,w,E,k,f,U,B]);const z=a.useMemo(()=>{const t=new Set(v.map(u=>u.department).filter(u=>u));return Array.from(t).sort()},[v]),J=a.useMemo(()=>{const t=(h-1)*X,u=t+X;return m.slice(t,u)},[m,h]),G=Math.ceil(m.length/X),Be=a.useCallback(t=>{C.debug("Opening warning details for:",t.id),se(t),K(!0)},[]),Ge=a.useCallback(()=>{C.debug("Closing warning details modal"),K(!1),se(null)},[]),Ve=a.useCallback(async t=>{try{y(!0),await ee.warnings.update(t.warningId,{appealSubmitted:!0,appealDate:new Date,status:"appealed",appealDetails:{grounds:t.grounds,details:t.additionalDetails,requestedOutcome:t.requestedOutcome,submittedAt:new Date,submittedBy:j?.email||"Employee"}},c),C.success(`Legal appeal submitted for warning ${t.warningId}`),await b(),i(!1),o(null),alert("Appeal submitted successfully. HR will review your appeal within 5 working days as per company policy.")}catch(u){throw C.error("Failed to submit appeal:",u),new Error("Failed to submit appeal. Please try again.")}finally{y(!1)}},[b,j]);a.useCallback(async(t,u)=>{try{y(!0),await ee.warnings.update(t,{status:u==="overturned"?"expired":"acknowledged",appealOutcome:u,appealDate:new Date},c),C.success(`Appeal ${u} for warning ${t}`),await b()}catch($){C.error("Failed to process appeal:",$),A("Failed to process appeal")}finally{y(!1)}},[b]);const qe=a.useCallback(async t=>{try{y(!0);let u="acknowledged";t.decision==="overturned"&&(u="overturned");const $={status:u,appealOutcome:t.decision,appealDecisionDate:new Date,appealReasoning:t.reasoning,hrNotes:t.hrNotes,followUpRequired:t.followUpRequired,followUpDate:t.followUpDate};(t.decision==="reduced"||t.decision==="modified")&&(t.newLevel&&($.level=t.newLevel),t.newDescription&&($.description=t.newDescription)),await ee.warnings.update(t.warningId,$,c),t.decision==="overturned"?(await ee.warnings.archive(t.warningId,c,"overturned"),C.success("Warning overturned and archived")):t.decision==="upheld"&&C.info("Warning upheld - remains active"),await b(),C.success("Appeal decision recorded successfully")}catch(u){throw C.error("Failed to record appeal decision:",u),new Error("Failed to record appeal decision. Please try again.")}finally{y(!1)}},[b]);a.useCallback(t=>{C.debug("Opening warning details:",t.id),se(t),K(!0)},[]);const ze=a.useCallback(async t=>{try{confirm("Are you sure you want to archive this warning? It will be moved to the archive.")&&(y(!0),await ee.warnings.archive(t,c,"manual"),C.success("Warning archived successfully"),await b())}catch(u){C.error("Failed to archive warning:",u),A("Failed to archive warning")}finally{y(!1)}},[c,b]);return x?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Loading Warnings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please wait..."})]})}):p?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(pe,{className:"w-8 h-8 text-red-500 mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Error Loading Warnings"}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:p}),e.jsxs("button",{onClick:b,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Retry Loading"]})]})}):e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warning Management"}),e.jsxs("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[v.length," total"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ie("archive"),className:"flex items-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg transition-colors text-sm",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Archive"})]}),e.jsx("button",{onClick:b,disabled:x,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Ee,{className:`w-4 h-4 ${x?"animate-spin":""}`})}),g&&e.jsx("button",{onClick:g,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})]})]}),ce==="archive"?e.jsx(Os,{onBack:()=>ie("warnings")}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search warnings...",value:w,onChange:t=>_(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsxs("select",{value:E,onChange:t=>P(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"appealed",children:"Under Appeal"}),e.jsx("option",{value:"expired",children:"Expired"})]}),e.jsxs("select",{value:k,onChange:t=>r(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"counselling",children:"Counselling"}),e.jsx("option",{value:"verbal",children:"Verbal"}),e.jsx("option",{value:"first_written",children:"First Written"}),e.jsx("option",{value:"second_written",children:"Second Written"}),e.jsx("option",{value:"final_written",children:"Final Written"}),e.jsx("option",{value:"written",children:"Written (Legacy)"}),e.jsx("option",{value:"final",children:"Final (Legacy)"}),e.jsx("option",{value:"dismissal",children:"Dismissal (Legacy)"})]}),e.jsxs("button",{onClick:()=>ne(!te),className:"px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors text-sm flex items-center gap-2",children:[e.jsx(vs,{className:"w-4 h-4"}),"More",te?e.jsx(Ns,{className:"w-4 h-4"}):e.jsx(ws,{className:"w-4 h-4"})]})]}),te&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("select",{value:f,onChange:t=>O(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Departments"}),z.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:`${U}-${B}`,onChange:t=>{const[u,$]=t.target.value.split("-");Y(u),q($)},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date-desc",children:"Newest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"employee-asc",children:"Employee A-Z"}),e.jsx("option",{value:"employee-desc",children:"Employee Z-A"}),e.jsx("option",{value:"level-asc",children:"Level (Low to High)"}),e.jsx("option",{value:"level-desc",children:"Level (High to Low)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("select",{value:X,onChange:t=>setItemsPerPage(Number(t.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-3 mb-4",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs font-medium",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:v.length})]}),e.jsx(Ae,{className:"w-5 h-5 text-gray-500"})]})}),e.jsx("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-xs font-medium",children:"Active"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:v.filter(t=>t.isActive).length})]}),e.jsx(be,{className:"w-5 h-5 text-green-500"})]})}),e.jsx("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-600 text-xs font-medium",children:"Undelivered"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:v.filter(t=>t.deliveryStatus!=="delivered").length})]}),e.jsx(Ce,{className:"w-5 h-5 text-orange-500"})]})}),e.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-xs font-medium",children:"Critical"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:v.filter(t=>t.level==="final"||t.level==="dismissal").length})]}),e.jsx(pe,{className:"w-5 h-5 text-red-500"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[m.length," warnings ",m.length!==v.length&&`(filtered from ${v.length})`]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",h," of ",G]})})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Warning"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:J.map((t,u)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:ue(t.employeeName)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[ue(t.employeeNumber)," • ",ue(t.department)]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.level==="counselling"?"bg-green-100 text-green-800":t.level==="verbal"?"bg-blue-100 text-blue-800":t.level==="first_written"?"bg-yellow-100 text-yellow-800":t.level==="second_written"?"bg-orange-100 text-orange-800":t.level==="final_written"?"bg-red-100 text-red-800":t.level==="written"?"bg-yellow-100 text-yellow-800":t.level==="final"||t.level==="dismissal"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.level==="counselling"?"Counselling":t.level==="verbal"?"Verbal":t.level==="first_written"?"First Written":t.level==="second_written"?"Second Written":t.level==="final_written"?"Final Written":t.level==="written"?"Written":t.level==="final"?"Final":t.level==="dismissal"?"Dismissal":ue(t.level,"Unknown")})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:ue(t.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:t.issueDate?new Date(t.issueDate.seconds?t.issueDate.seconds*1e3:t.issueDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${t.status==="issued"?"bg-blue-100 text-blue-800":t.status==="acknowledged"?"bg-green-100 text-green-800":t.status==="appealed"?"bg-orange-100 text-orange-800":t.status==="expired"?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"}`,children:t.status==="issued"?"Issued":t.status==="acknowledged"?"Acknowledged":t.status==="appealed"?"Under Appeal":t.status==="expired"?"Expired":ue(t.status,"Pending")})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Be(t),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"View"}),t.status==="appealed"&&e.jsxs("button",{onClick:()=>{le(t),T(!0)},className:"text-purple-600 hover:text-purple-800 text-xs px-2 py-1 hover:bg-purple-50 rounded transition-colors flex items-center gap-1",title:"Review Appeal with Enhanced Decision Options",children:[e.jsx($e,{className:"w-3 h-3"}),"Review Appeal"]}),t.deliveryStatus!=="delivered"&&t.status!=="appealed"&&e.jsx("button",{onClick:()=>{re(t),ae(!0)},className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 hover:bg-orange-50 rounded transition-colors",children:"Deliver"}),t.status!=="appealed"&&Pe(t)&&e.jsx("button",{onClick:()=>{o(t),i(!0)},className:"text-amber-600 hover:text-amber-800 text-xs px-2 py-1 hover:bg-amber-50 rounded transition-colors",title:(()=>{const $=t.issueDate.seconds?new Date(t.issueDate.seconds*1e3):new Date(t.issueDate),V=new Date($);return V.setDate(V.getDate()+30),`Appeal this warning (deadline: ${V.toLocaleDateString()})`})(),children:"Appeal"}),t.status!=="appealed"&&!Pe(t)&&e.jsx("span",{className:"text-gray-500 text-xs px-2 py-1",title:"Appeal period has expired",children:"Appeal Expired"}),(t.status==="acknowledged"||t.status==="expired"||!Pe(t))&&e.jsx("button",{onClick:()=>ze(t.id),className:"text-gray-600 hover:text-gray-800 text-xs px-2 py-1 hover:bg-gray-50 rounded transition-colors",title:"Archive this warning",children:e.jsx(Se,{className:"w-3 h-3"})})]})})]},t.id||`warning-${u}`))})]})})}),m.length===0&&!x&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"No warnings found"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:w||E!=="all"||k!=="all"||f!=="all"?"Try adjusting your search criteria or filters.":"No warnings have been created yet."}),(w||E!=="all"||k!=="all"||f!=="all")&&e.jsx("button",{onClick:()=>{_(""),P("all"),r("all"),O("all")},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear all filters"})]}),G>1&&e.jsxs("div",{className:"flex items-center justify-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>I(Math.max(1,h-1)),disabled:h===1,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm text-gray-600 bg-gray-50 rounded-lg",children:[h," of ",G]}),e.jsx("button",{onClick:()=>I(Math.min(G,h+1)),disabled:h===G,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]}),e.jsx(Ps,{warning:Q,isOpen:L,onClose:Ge,canTakeAction:S,userRole:F}),oe&&e.jsx(Ws,{isOpen:he,onClose:()=>{ae(!1),re(null)},warningId:oe.id||"",employeeName:ue(oe.employee),deliveryMethod:oe.deliveryMethod||"email",onDeliveryConfirmed:async t=>{try{await ee.warnings.updateDeliveryStatus(t.warningId,{status:"delivered",deliveredAt:t.deliveredAt,deliveryMethod:t.deliveryMethod,proofImage:t.proofImage}),await b(),ae(!1),re(null)}catch(u){throw console.error("Failed to confirm delivery:",u),u}}}),de&&l&&e.jsx(Is,{isOpen:de,onClose:()=>{i(!1),o(null)},warning:{id:l.id,employeeName:l.employeeName,category:l.category,level:l.level,issueDate:l.issueDate,description:l.description||"No description provided"},onAppealSubmit:Ve}),D&&R&&e.jsx(Ms,{isOpen:D,onClose:()=>{T(!1),le(null)},warning:{id:R.id,employeeName:R.employeeName,employeeNumber:R.employeeNumber,category:R.category,level:R.level,issueDate:R.issueDate,description:R.description||"No description provided",appealDetails:R.appealDetails},onDecisionSubmit:qe})]})]})};export{qs as WarningsReviewDashboard,qs as default};
