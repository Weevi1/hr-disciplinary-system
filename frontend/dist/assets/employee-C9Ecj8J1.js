import{L as e}from"./business-owner-dashboard-DOtdDQPt.js";const t=e=>`${e.toUpperCase().substring(0,3)}${Date.now().toString().slice(-6)}${Math.floor(99*Math.random()).toString().padStart(2,"0")}`,a=e=>e?e.managerIds&&e.managerIds.length>0?e.managerIds:e.managerId?[e.managerId]:[]:[],n=(e,t)=>{const a=new Date;return{id:`emp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,organizationId:t,isActive:e.isActive,createdAt:a.toISOString(),updatedAt:a.toISOString(),profile:{employeeNumber:e.employeeNumber,firstName:e.firstName,lastName:e.lastName,email:e.email?e.email.toLowerCase():"",phoneNumber:e.phoneNumber||null,whatsappNumber:e.whatsappNumber||null,department:e.department||"",position:e.position,startDate:new Date(e.startDate)},employment:{startDate:new Date(e.startDate),contractType:e.contractType,probationEndDate:e.probationEndDate?new Date(e.probationEndDate):null,department:e.department||"",position:e.position,managerIds:e.managerIds||[],...e.managerId&&{managerId:e.managerId},...!e.managerId&&e.managerIds?.[0]&&{managerId:e.managerIds[0]}},disciplinaryRecord:{totalWarnings:0,activeWarnings:0,currentLevel:"none",warningHistory:[],warningsByCategory:{}},deliveryPreferences:{primaryMethod:"email",allowAlternativeMethods:!0,whatsappConsent:!1,emailConsent:!0,printConsent:!1,lastUpdated:a}}},r=t=>{if(!t)return"";try{if(t&&"function"==typeof t.toDate)return t.toDate().toISOString().split("T")[0];if(t instanceof Date)return t.toISOString().split("T")[0];if("string"==typeof t){const e=new Date(t);if(!isNaN(e.getTime()))return e.toISOString().split("T")[0]}if("number"==typeof t){const e=new Date(t);if(!isNaN(e.getTime()))return e.toISOString().split("T")[0]}return""}catch(a){return e.warn("Failed to convert date:",t,a),""}},i=e=>{const t=a(e.employment);return{employeeNumber:e.profile?.employeeNumber||"",firstName:e.profile?.firstName||"",lastName:e.profile?.lastName||"",email:e.profile?.email||"",phoneNumber:e.profile?.phoneNumber||"",whatsappNumber:e.profile?.whatsappNumber||"",department:e.profile?.department||"",position:e.profile?.position||"",startDate:r(e.profile?.startDate),contractType:e.employment?.contractType||"permanent",probationEndDate:r(e.employment?.probationEndDate),managerIds:t,managerId:t[0]||"",isActive:e.isActive??!0}},o=(e,t)=>{if(!e)return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1};switch(e){case"super-user":case"hr-manager":return{canCreate:!0,canEdit:!0,canArchive:!0,canRestore:!0,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!0,canExport:!0};case"executive-management":return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!1,canExport:!0};case"hod-manager":case"hod":return{canCreate:!0,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:t||[],canViewContactInfo:!0,canBulkImport:!1,canExport:!1};default:return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1}}},c=(t,n,r,i,o)=>t.filter(t=>{if(!t)return!1;if("hod-manager"!==i||t.profile||e.warn("ðŸ” [FILTER DEBUG] Employee missing profile:",{id:t.id,hasEmployment:!!t.employment,managerId:t.employment?.managerId,currentUserId:o}),r.canViewAll||"hod"!==i&&"hod-manager"!==i){if(!r.canViewAll&&r.canViewDepartments.length>0){const e=t.profile?.department;if(!e||!r.canViewDepartments.includes(e))return!1}}else{const e=a(t.employment);if(e.length>0&&!e.includes(o||""))return!1}if(n.isActive&&!t.isActive)return!1;if(!n.isActive&&!t.isActive&&!r.canViewArchived)return!1;if(n.search){const e=n.search.toLowerCase();if(!((t.profile?.firstName?.toLowerCase()||"").includes(e)||(t.profile?.lastName?.toLowerCase()||"").includes(e)||(t.profile?.employeeNumber?.toLowerCase()||"").includes(e)||(t.profile?.email?.toLowerCase()||"").includes(e)))return!1}return(!n.department||t.profile?.department===n.department)&&((!n.contractType||t.employment?.contractType===n.contractType)&&!(n.hasWarnings&&(!t.disciplinaryRecord||0===t.disciplinaryRecord.activeWarnings)))}),s=e=>{const t={total:e.length,active:0,inactive:0,onProbation:0,withActiveWarnings:0,onProbationWithWarnings:0,departments:[],contractTypes:[]},a={},n={};return e.forEach(e=>{if(e.isActive?t.active++:t.inactive++,e.isActive){const a=e.employment?.probationEndDate&&new Date(e.employment.probationEndDate)>new Date,n=e.disciplinaryRecord?.activeWarnings>0;a&&t.onProbation++,n&&t.withActiveWarnings++,a&&n&&t.onProbationWithWarnings++}const r=e.profile?.department||"Unknown";a[r]=(a[r]||0)+1;const i=e.employment?.contractType||"Unknown";n[i]=(n[i]||0)+1}),t.departments=Object.entries(a).map(([e,t])=>({name:e,count:t})).sort((e,t)=>t.count-e.count),t.contractTypes=Object.entries(n).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count),t},p=()=>[["employeeNumber","firstName","lastName","email","phoneNumber","whatsappNumber","position","startDate"].join(","),...[["EMP001","John","Doe","john.doe@company.com","0123456789","0123456789","Software Developer","15/01/2024"],["EMP002","Sarah","Johnson","","+27987654321","+27987654321","HR Manager","01/06/2023"],["EMP003","Michael","Smith","michael.smith@company.com","0825254011","","Operations Coordinator","01/11/2024"]].map(e=>e.join(","))].join("\n");export{s as a,i as b,o as c,n as d,p as e,c as f,t as g,a as h};
