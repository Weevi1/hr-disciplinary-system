const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/NotificationDeliveryService-D_ogWXxo.js","assets/business-owner-dashboard-Cigg9BdB.js","assets/react-vendor-CWjEGAcE.js","assets/pdf-vendor-tUwojRr6.js","assets/firebase-vendor-Cc210LOb.js","assets/ui-vendor-B2Ap5xvl.js"])))=>i.map(i=>d[i]);
import{L as e,j as a,h as s,k as t,T as i,f as r,n as o,o as n,g as l,i as c,d,u as m,e as u,s as h,p as g,A as x,D as p,q as y,F as v,a as b,l as f,r as w,t as N,N as j,v as k,w as C,E as S}from"./business-owner-dashboard-Cigg9BdB.js";import{r as D,R as z,u as _}from"./react-vendor-CWjEGAcE.js";import{p as I,x as E,l as R,E as T,G as L,H as A,j as M,u as q,q as $,w as P,t as F,m as U}from"./firebase-vendor-Cc210LOb.js";import{U as O,h as W,X as H,g as B,Q as V,i as G,ah as K,a3 as Y,O as X,b as J,F as Z,k as Q,a as ee,w as ae,a1 as se,ai as te,aj as ie,p as re,a4 as oe,R as ne,ak as le,al as ce,n as de,L as me,aa as ue,M as he,a7 as ge,ab as xe,am as pe,e as ye,ad as ve,an as be,m as fe,C as we,v as Ne,r as je,ag as ke,l as Ce,ae as Se,K as De,ao as ze,ap as _e,af as Ie,d as Ee}from"./ui-vendor-B2Ap5xvl.js";import{C as Re,P as Te}from"./hr-dashboard-DZ0rxgR_.js";import{a as Le}from"./pdf-vendor-tUwojRr6.js";class Ae{constructor(){this.flows=new Map,this.listeners=[],this.stepConfigs=new Map,this.styles={info:"color: #2563eb; font-weight: bold;",warn:"color: #d97706; font-weight: bold;",error:"color: #dc2626; font-weight: bold;",debug:"color: #6b7280; font-weight: normal;",step:"color: #7c3aed; font-weight: bold; font-size: 14px;",data:"color: #059669; font-weight: normal;",validation:"color: #dc2626; font-weight: bold;"},this.initializeStepConfigs()}static getInstance(){return Ae.instance||(Ae.instance=new Ae),Ae.instance}initializeStepConfigs(){this.stepConfigs.set("INCIDENT_DETAILS",{name:"Incident Details",requiredFields:["employeeId","categoryId","incidentDate","incidentTime","incidentLocation","incidentDescription","issueDate","validityPeriod"],validations:[this.validateIncidentDetails.bind(this),this.validateDescriptionLength.bind(this),this.validateDates.bind(this)]}),this.stepConfigs.set("LEGAL_REVIEW_SIGNATURES",{name:"Legal Review & Signatures",requiredFields:["lraRecommendation","signatures.manager","signatures.employee"],validations:[this.validateLegalReview.bind(this),this.validateSignatures.bind(this)]}),this.stepConfigs.set("DELIVERY_COMPLETION",{name:"Delivery & Completion",requiredFields:["id","status","deliveryMethod"],validations:[this.validateDeliveryData.bind(this),this.validateFirestoreReadiness.bind(this)]})}startWizardSession(e){const a=e||`wizard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={sessionId:a,startTime:new Date,currentStep:"",completedSteps:[],logs:[],dataSnapshots:{},issues:[]};return this.flows.set(a,s),this.log(a,"info","SESSION","STARTED",null,{sessionId:a,timestamp:s.startTime}),a}endWizardSession(e,a){const s=this.flows.get(e);if(!s)return;const t=Date.now()-s.startTime.getTime();this.log(e,"info","SESSION","ENDED",null,{outcome:a,duration:`${Math.round(t/1e3)}s`,totalSteps:s.completedSteps.length,totalIssues:s.issues.length,finalStep:s.currentStep}),setTimeout(()=>{this.flows.delete(e)},3e5)}enterStep(e,a,s){const t=this.flows.get(e);t&&(t.currentStep=a,this.log(e,"info",a,"STEP_ENTERED",s,{previousStep:t.completedSteps[t.completedSteps.length-1]||"none",stepIndex:t.completedSteps.length+1}),s&&this.validateStepData(e,a,s,"STEP_ENTRY"))}exitStep(e,a,s,t=!0){const i=this.flows.get(e);i&&(t&&!i.completedSteps.includes(a)&&i.completedSteps.push(a),this.log(e,t?"info":"warn",a,"STEP_EXITED",s,{completed:t,timeInStep:this.getTimeInStep(e,a),totalCompletedSteps:i.completedSteps.length}),s&&t&&this.validateStepData(e,a,s,"STEP_EXIT"))}trackDataChange(e,a,s,t,i){this.log(e,"debug",a,"DATA_CHANGED",{field:s,oldValue:t,newValue:i,valueType:typeof i},{hasValue:null!=i&&""!==i,isValidChange:i!==t}),void 0===i&&void 0!==t&&this.trackIssue(e,a,`Field ${s} became undefined`,"medium"),typeof i!=typeof t&&void 0!==t&&this.trackIssue(e,a,`Field ${s} type changed from ${typeof t} to ${typeof i}`,"low")}trackFormSubmission(e,a,s){const t=this.flows.get(e);t&&(t.dataSnapshots[`${a}_${Date.now()}`]={...s},this.log(e,"info",a,"FORM_SUBMITTED",s,{fieldCount:Object.keys(s||{}).length,hasRequiredFields:this.checkRequiredFields(a,s)}),this.validateStepData(e,a,s,"FORM_SUBMISSION"))}trackAPICall(e,a,s,t,i,r){const o=r?"error":"info";this.log(e,o,a,"API_CALL",{api:s,params:t,result:r?void 0:i,error:r?.message||r},{success:!r,responseTime:Date.now()}),r&&this.trackIssue(e,a,`API call failed: ${s} - ${r.message}`,"high")}validateStepData(e,a,s,t){const i=this.stepConfigs.get(a);if(!i)return{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};let r={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return i.validations.forEach(e=>{const a=e(s);r.errors.push(...a.errors),r.warnings.push(...a.warnings),r.missingFields.push(...a.missingFields),r.undefinedFields.push(...a.undefinedFields),r.isValid=r.isValid&&a.isValid}),this.log(e,r.isValid?"info":"error",a,"VALIDATION",s,{context:t,validation:r}),r.errors.forEach(s=>{this.trackIssue(e,a,`Validation Error: ${s}`,"high")}),r.warnings.forEach(s=>{this.trackIssue(e,a,`Validation Warning: ${s}`,"medium")}),r}validateIncidentDetails(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return["employeeId","categoryId","incidentDate","incidentLocation","incidentDescription"].forEach(s=>{e[s]&&""!==e[s]||(a.errors.push(`Missing required field: ${s}`),a.missingFields.push(s),a.isValid=!1)}),Object.keys(e).forEach(s=>{void 0===e[s]&&(a.undefinedFields.push(s),a.errors.push(`Field ${s} is undefined`),a.isValid=!1)}),a}validateDescriptionLength(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDescription){const s=e.incidentDescription.trim().split(/\s+/).length;s<15&&a.warnings.push(`Incident description should be at least 15 words (currently ${s})`)}return a}validateDates(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};if(e.incidentDate){new Date(e.incidentDate)>new Date&&(a.errors.push("Incident date cannot be in the future"),a.isValid=!1)}if(e.issueDate){new Date(e.issueDate)>new Date&&a.warnings.push("Issue date is in the future")}return a}validateLegalReview(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.lraRecommendation||(a.errors.push("LRA recommendation is required"),a.missingFields.push("lraRecommendation"),a.isValid=!1),a}validateSignatures(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.signatures?.manager||(a.warnings.push("Manager signature missing"),a.missingFields.push("signatures.manager")),e.signatures?.employee||(a.warnings.push("Employee signature missing"),a.missingFields.push("signatures.employee")),a}validateDeliveryData(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]};return e.id||(a.errors.push("Warning ID is required for delivery"),a.missingFields.push("id"),a.isValid=!1),e.deliveryMethod||(a.warnings.push("Delivery method not specified"),a.missingFields.push("deliveryMethod")),a}validateFirestoreReadiness(e){const a={isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},s=this.findUndefinedFields(e);s.length>0&&(a.errors.push(`Undefined fields will cause Firestore errors: ${s.join(", ")}`),a.undefinedFields.push(...s),a.isValid=!1);return["id","organizationId","employeeId","categoryId"].forEach(s=>{e[s]||(a.errors.push(`Firestore requires field: ${s}`),a.missingFields.push(s),a.isValid=!1)}),a}findUndefinedFields(e,a=""){const s=[];return"object"!=typeof e||null===e||e instanceof Date||Object.entries(e).forEach(([e,t])=>{const i=a?`${a}.${e}`:e;void 0===t?s.push(i):"object"!=typeof t||null===t||t instanceof Date||s.push(...this.findUndefinedFields(t,i))}),s}trackIssue(e,a,s,t){const i=this.flows.get(e);if(!i)return;const r={step:a,issue:s,severity:t,timestamp:new Date};i.issues.push(r),this.log(e,"high"===t?"error":"warn",a,"ISSUE_DETECTED",null,{issue:s,severity:t,totalIssues:i.issues.length})}log(e,a,s,t,i,r){const o={id:`log_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,timestamp:new Date,level:a,step:s,action:t,data:i,metadata:r},n=this.flows.get(e);n&&n.logs.push(o),this.logToConsole(o,e),this.listeners.forEach(e=>e(o))}logToConsole(e,a){const s=`%c${{info:"💙",warn:"⚠️",error:"❌",debug:"🔍"}[e.level]} [${e.step}] ${e.action}`,t=this.styles[e.level];e.data?(console.groupCollapsed(`${s} (${a.slice(-6)})`,t),this.styles.data,e.data,e.validation&&(this.styles.validation,e.validation),e.metadata&&(this.styles.debug,e.metadata),console.groupEnd()):(a.slice(-6),e.metadata&&(this.styles.debug,e.metadata))}checkRequiredFields(e,a){const s=this.stepConfigs.get(e);return!s||s.requiredFields.every(e=>{const s=e.split(".");let t=a;for(const a of s)t=t?.[a];return null!=t&&""!==t})}getTimeInStep(e,a){const s=this.flows.get(e);if(!s)return"0s";const t=s.logs.reverse().find(e=>e.step===a&&"STEP_ENTERED"===e.action);if(!t)return"0s";const i=Date.now()-t.timestamp.getTime();return`${Math.round(i/1e3)}s`}addListener(e){this.listeners.push(e)}removeListener(e){const a=this.listeners.indexOf(e);a>-1&&this.listeners.splice(a,1)}getSessionLogs(e){return this.flows.get(e)?.logs||[]}getSessionIssues(e){return this.flows.get(e)?.issues||[]}getSessionSummary(e){const a=this.flows.get(e);return a?{sessionId:a.sessionId,startTime:a.startTime,currentStep:a.currentStep,completedSteps:a.completedSteps,totalLogs:a.logs.length,totalIssues:a.issues.length,issuesByLevel:{high:a.issues.filter(e=>"high"===e.severity).length,medium:a.issues.filter(e=>"medium"===e.severity).length,low:a.issues.filter(e=>"low"===e.severity).length},dataSnapshots:Object.keys(a.dataSnapshots).length}:null}exportSessionData(e){const a=this.flows.get(e);return a?JSON.stringify({summary:this.getSessionSummary(e),logs:a.logs,issues:a.issues,dataSnapshots:a.dataSnapshots},null,2):""}trackError(e,a,s,t){this.log(e,"error",a,"ERROR",{message:s.message,stack:s.stack,context:t}),this.trackIssue(e,a,s.message,"high")}trackSuccess(e,a,s,t){this.log(e,"info",a,`SUCCESS_${s}`,t)}trackWarning(e,a,s,t){this.log(e,"warn",a,"WARNING",t,{warning:s}),this.trackIssue(e,a,s,"medium")}}const Me=Ae.getInstance(),qe=({employees:e,selectedEmployeeId:o,onEmployeeSelect:n,warningHistory:l=[],isLoadingWarningHistory:c=!1,disabled:d=!1,className:m=""})=>{const[u,h]=D.useState(""),[g,x]=D.useState(!1),[p,y]=D.useState(!1),[v,b]=D.useState(!1),f=D.useMemo(()=>{if(!u.trim())return e;const a=u.toLowerCase();return e.filter(e=>{const s=`${e.firstName} ${e.lastName}`.toLowerCase(),t=e.id?.toLowerCase()||"",i=e.department?.toLowerCase()||"";return s.includes(a)||t.includes(a)||i.includes(a)})},[e,u]),w=D.useMemo(()=>e.find(e=>e.id===o),[e,o]),N=D.useCallback(e=>{n(e),x(!1),y(!1),b(!1),h("")},[n]),j=D.useCallback(()=>{if(d)return;window.innerWidth<768?b(!0):y(!p)},[d,p]),k=D.useCallback(()=>{b(!1),h("")},[]);return a.jsxs("div",{className:`space-y-4 ${m}`,children:[a.jsx(s,{icon:O,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:a.jsx(t,{variant:"secondary",size:"sm",children:f.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(d?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:p?"var(--color-primary)":"var(--color-border)",boxShadow:p?"0 0 0 2px var(--color-primary-light)":void 0},onClick:j,children:w?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[w.firstName?.charAt(0),w.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[w.firstName," ",w.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[w.position," • ",w.department]})]})]}),a.jsx(W,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(O,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(W,{className:"w-4 h-4 transition-transform "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),p&&a.jsxs("div",{className:"absolute top-full left-0 right-0 z-20 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:f.length>0?a.jsx("div",{className:"py-2",children:f.map(e=>((e=>{e.riskIndicators&&e.riskIndicators.highRisk})(e),(e=>{if(!e.recentWarnings)return null;const{count:a,lastDate:s,level:t}=e.recentWarnings})(e),a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:a.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[e.firstName," ",e.lastName," - ",e.position]})},e.id)))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsxs("p",{children:['No employees found matching "',u,'"']})]})})]})]})}),v&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:k}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),a.jsx("button",{onClick:k,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),a.jsx("div",{className:"mobile-category-list",children:f.length>0?a.jsx("div",{children:f.map(e=>a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:a.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[e.firstName," ",e.lastName," - ",e.position]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No employees found"}),u&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',u,'"']})]})})]})]}),w&&g&&a.jsxs(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),a.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"flex items-center gap-1",children:[g?a.jsx(B,{className:"w-4 h-4"}):a.jsx(W,{className:"w-4 h-4"}),g?"Hide":"Show"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["📧 ",w.email||"No email",a.jsx("br",{}),"📱 ",w.phone||"No phone"]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[w.position,a.jsx("br",{}),w.department]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(V,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),a.jsx("span",{className:"font-medium text-gray-900",children:w.recentWarnings?.count||0})]}),w.recentWarnings?.lastDate&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),a.jsx("span",{className:"text-sm text-gray-900",children:new Date(w.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),w.riskIndicators&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),a.jsxs(t,{variant:w.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[a.jsx(G,{className:"w-4 h-4"}),w.riskIndicators.highRisk?"High Risk":"Low Risk"]}),w.riskIndicators.reasons.length>0&&a.jsx("div",{className:"mt-2",children:a.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:w.riskIndicators.reasons.slice(0,3).map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"text-amber-500 mt-0.5",children:"•"}),e]},s))})})]})]})]})]})]})},$e=({categories:e,selectedCategoryId:t,onCategorySelect:r,lraRecommendation:l,disabled:c=!1,className:d=""})=>{const[m,u]=D.useState(!1),[h,g]=D.useState(!1),[x,p]=D.useState(!1),[y,v]=D.useState(""),b=D.useMemo(()=>{if(!y.trim())return e;const a=y.toLowerCase();return e.filter(e=>{const s=e.name?.toLowerCase()||"",t=e.description?.toLowerCase()||"",i=e.severity?.toLowerCase()||"";return s.includes(a)||t.includes(a)||i.includes(a)})},[e,y]),f=D.useMemo(()=>e.find(e=>e.id===t),[e,t]),w=D.useCallback(e=>{r(e),u(!1),g(!1),p(!1),v("")},[r]),N=D.useCallback(()=>{if(c)return;window.innerWidth<768?p(!0):g(!h)},[c,h]),j=D.useCallback(()=>{p(!1),v("")},[]),k=D.useMemo(()=>f?f.escalationPath||o(f.id):[],[f]),C=D.useMemo(()=>l&&k.length?k.findIndex(e=>e===l.suggestedLevel):-1,[l,k]);return a.jsxs("div",{className:`space-y-4 ${d}`,children:[a.jsx(s,{icon:K,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:e.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(c?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:h?"var(--color-primary)":"var(--color-border)",boxShadow:h?"0 0 0 2px var(--color-primary-light)":void 0},onClick:N,children:f?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(O,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:f.name}),f.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:f.description})]})]}),a.jsx(W,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(O,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),a.jsx(W,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),h&&a.jsxs("div",{className:"absolute top-full left-0 right-0 z-20 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:b.length>0?a.jsx("div",{className:"py-2",children:b.map(e=>a.jsx("button",{onClick:()=>w(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.description})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(K,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{children:"No categories found"}),y&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',y,'"']})]})})]})]})}),x&&a.jsxs("div",{className:"mobile-category-modal",children:[a.jsx("div",{className:"mobile-category-modal-backdrop",onClick:j}),a.jsxs("div",{className:"mobile-category-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),a.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:y,onChange:e=>v(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:b.length>0?a.jsx("div",{children:b.map(e=>a.jsxs("button",{onClick:()=>w(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:e.description})]})]},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No categories found"}),y&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',y,'"']})]})})]})]}),f&&m&&a.jsxs(i,{className:"rounded-xl p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),a.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[m?a.jsx(B,{className:"w-4 h-4"}):a.jsx(W,{className:"w-4 h-4"}),m?"Hide":"Show"]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:(e=>{switch(e?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}})(f.severity),children:f.severity})]}),f.description&&a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:f.description})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),l?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Y,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:n(l.suggestedLevel)}),l.isEscalation&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l.reason})]}):a.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:k.map((e,s)=>{const t=s===C,i=C>=0&&s<C;return a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:t?"var(--color-badge-primary)":i?"var(--color-muted)":"var(--color-card-background)",borderColor:t?"var(--color-primary)":"var(--color-border)",color:t?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[t&&a.jsx(X,{className:"w-4 h-4"}),i&&a.jsx(J,{className:"w-4 h-4"}),a.jsx("span",{children:n(e)}),s<k.length-1&&a.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"→"})]},e)})}),l&&a.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(Y,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",n(l.suggestedLevel)]}),a.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",l.warningCount," total warnings",l.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},Pe=({formData:t,onFormDataChange:i,disabled:r=!1,className:o=""})=>{const[n,c]=D.useState(!1),[d,m]=D.useState({}),[u,h]=D.useState({}),{isSaving:g,lastSaved:x}=((e,a,s=2e3)=>{const t=D.useRef(),[i,r]=D.useState(!1),[o,n]=D.useState(null),l=D.useCallback(()=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{r(!0),a(e),n(new Date),r(!1)},s)},[e,a,s]);return D.useEffect(()=>(l(),()=>{t.current&&clearTimeout(t.current)}),[l]),{isSaving:i,lastSaved:o}})(t,e=>{localStorage.setItem("warningWizard_incidentDetails",JSON.stringify(e))});D.useEffect(()=>{const a=localStorage.getItem("warningWizard_incidentDetails");if(a)try{const e=JSON.parse(a);!t.incidentDescription&&!t.incidentLocation&&i(e)}catch(s){e.warn("Failed to load saved incident details:",s)}},[]);const p=D.useMemo(()=>{const e=t.incidentDescription||"",a=e.trim().split(/\s+/).filter(e=>e.length>0).length,s=a>=20,i=[];return a<20&&i.push(`Add ${20-a} more words for a complete description`),e.includes("when")||e.includes("time")||i.push("Consider adding when the incident occurred"),e.includes("where")||e.includes("location")||i.push("Consider specifying where the incident took place"),e.includes("what")||e.includes("action")||i.push("Be specific about what actions were observed"),!e.includes("witness")&&a>10&&i.push("Were there any witnesses to mention?"),{wordCount:a,isMinimumMet:s,suggestions:i}},[t.incidentDescription]),y=D.useCallback((e,a)=>{switch(e){case"incidentDate":if(!a)return"Incident date is required";return new Date(a)>new Date?"Incident date cannot be in the future":null;case"incidentTime":if(!a)return"Incident time is required";return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(a)?null:"Please enter time in HH:MM format";case"incidentLocation":return!a||a.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":return!a||a.trim().length<20?"Description must be at least 20 characters":a.trim().length>2e3?"Description is too long (maximum 2000 characters)":null;default:return null}},[]),v=D.useCallback((e,a)=>{i({[e]:a}),h(a=>({...a,[e]:!0}));const s=y(e,a);m(a=>({...a,[e]:s}))},[i,y]),b=(new Date).toISOString().split("T")[0];return a.jsxs("div",{className:`space-y-4 ${o}`,children:[a.jsx(s,{icon:Z,title:"Incident Details",subtitle:"Provide comprehensive details about the incident",rightContent:a.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--color-text-tertiary)"},children:[g&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(Q,{className:"w-4 h-4 animate-pulse"}),a.jsx("span",{children:"Saving..."})]}),x&&!g&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsxs("span",{children:["Saved ",x.toLocaleTimeString()]})]})]})}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(Re,{type:"date",label:"Incident Date",value:t.incidentDate||"",onChange:e=>v("incidentDate",e),icon:ae,required:!0,disabled:r,error:d.incidentDate&&u.incidentDate?d.incidentDate:void 0}),a.jsx(Re,{type:"time",label:"Incident Time",value:t.incidentTime||"",onChange:e=>v("incidentTime",e),icon:V,required:!0,disabled:r,error:d.incidentTime&&u.incidentTime?d.incidentTime:void 0})]}),a.jsx(l,{type:"text",label:"Incident Location",value:t.incidentLocation||"",onChange:e=>v("incidentLocation",e),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:se,required:!0,disabled:r,error:d.incidentLocation&&u.incidentLocation?d.incidentLocation:void 0}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[a.jsx(te,{className:"w-3 h-3 inline mr-1"}),"Incident Description *"]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsxs("button",{type:"button",onClick:()=>c(!n),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-primary)"},children:[a.jsx(ie,{className:"w-3 h-3"}),"Writing Tips"]}),a.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:p.isMinimumMet?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:p.isMinimumMet?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[p.wordCount," words"]})]})]}),a.jsx("textarea",{value:t.incidentDescription||"",onChange:e=>v("incidentDescription",e.target.value),placeholder:"Describe exactly what happened. Include specific details such as what was said or done, who was present, and any relevant context...",disabled:r,rows:6,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical "+(r?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:d.incidentDescription&&u.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:d.incidentDescription&&u.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),d.incidentDescription&&u.incidentDescription&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[a.jsx(J,{className:"w-3 h-3"}),d.incidentDescription]}),n&&a.jsxs("div",{className:"rounded-lg p-4",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:[a.jsx("h4",{className:"text-sm font-medium mb-2",style:{color:"var(--color-alert-info-text)"},children:"Writing Assistance"}),a.jsxs("div",{className:"space-y-2 text-sm",style:{color:"var(--color-alert-info-text)"},children:[p.suggestions.map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(ie,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsx("span",{children:e})]},s)),0===p.suggestions.length&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-green-700",children:"Your description looks comprehensive!"})]})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"block text-xs font-medium text-gray-700",children:["Additional Notes",a.jsx("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),a.jsx("textarea",{value:t.additionalNotes||"",onChange:e=>v("additionalNotes",e.target.value),placeholder:"Any additional context, background information, or relevant details...",disabled:r,rows:3,className:`\n            w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n            ${r?"opacity-50 cursor-not-allowed":""}\n          `})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date *"}),a.jsx("input",{type:"date",value:t.issueDate||b,onChange:e=>v("issueDate",e.target.value),disabled:r,className:`\n              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n              ${r?"opacity-50 cursor-not-allowed":""}\n            `})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Validity Period *"}),a.jsxs("select",{value:t.validityPeriod||6,onChange:e=>v("validityPeriod",parseInt(e.target.value)),disabled:r,className:`\n              w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n              ${r?"opacity-50 cursor-not-allowed":""}\n            `,children:[a.jsx("option",{value:3,children:"3 months"}),a.jsx("option",{value:6,children:"6 months"}),a.jsx("option",{value:12,children:"12 months"})]})]})]})]})},Fe=({employees:e,categories:s,formData:t,updateFormData:i,selectedEmployee:r,selectedCategory:o,warningHistory:n=[],isLoadingWarningHistory:l=!1,loadWarningHistory:d,lraRecommendation:m,isAnalyzing:u=!1})=>{const h=D.useMemo(()=>{const e={employee:!!t.employeeId,category:!!t.categoryId,date:!!t.incidentDate,time:!!t.incidentTime,location:!!t.incidentLocation&&t.incidentLocation.length>=3,description:!!t.incidentDescription&&t.incidentDescription.length>=20},a=Object.values(e).filter(Boolean).length,s=Object.keys(e).length;return{checks:e,completed:a,total:s,percentage:Math.round(a/s*100)}},[t]);return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between px-1",children:[a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Progress"}),a.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[h.completed,"/",h.total]})]}),a.jsx("div",{className:"w-full rounded h-1",style:{backgroundColor:"var(--color-surface)"},children:a.jsx("div",{className:"h-1 rounded transition-all duration-300",style:{width:`${h.percentage}%`,backgroundColor:"var(--color-primary)"}})}),a.jsx(qe,{employees:e,selectedEmployeeId:t.employeeId,onEmployeeSelect:e=>{i({employeeId:e}),d&&d(e)},warningHistory:n,isLoadingWarningHistory:l,disabled:u}),a.jsx($e,{categories:s,selectedCategoryId:t.categoryId,onCategorySelect:e=>{i({categoryId:e})},lraRecommendation:m,disabled:u}),a.jsx(Pe,{formData:t,onFormDataChange:i,disabled:u}),u&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}),a.jsx("span",{className:"text-sm",children:"Analyzing incident..."})]})}),m&&!u&&m.requiresHRIntervention&&a.jsx(c,{variant:"error",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(J,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-error)"},children:"Contact HR Required"}),a.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text)"},children:m.interventionReason}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Employee has final warning on record - HR intervention required before proceeding"})]})]})}),m&&!u&&!m.requiresHRIntervention&&a.jsx(c,{variant:"success",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(ee,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:["Recommended: ",m.recommendedLevel]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:m.reason})]})]})}),100===h.percentage&&!u&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(re,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text)"},children:"Ready for Legal Review"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:'All details completed. Click "Next" to proceed.'})]})]})})]})},Ue=({onSignatureComplete:e,disabled:s=!1,label:t,placeholder:i="Click and drag to sign",initialSignature:r=null,className:o="",width:n=400,height:l=200})=>{const c=D.useRef(null),d=D.useRef(null),[m,u]=D.useState(!1),[h,g]=D.useState(!1),[x,p]=D.useState([]),[y,v]=D.useState(!1),b=D.useCallback(()=>{const e=c.current;if(!e)return;const a=e.getContext("2d");if(!a)return;const s=e.getBoundingClientRect(),t=window.devicePixelRatio||1;e.width=s.width*t,e.height=s.height*t,a.scale(t,t),a.strokeStyle="#1e293b",a.lineWidth=2,a.lineCap="round",a.lineJoin="round",a.globalCompositeOperation="source-over",a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),v(!0)},[]),f=D.useCallback(e=>{const a=c.current;if(!a)return{x:0,y:0};const s=a.getBoundingClientRect();let t,i;if("touches"in e&&e.touches.length>0)t=e.touches[0].clientX,i=e.touches[0].clientY;else{if(!("clientX"in e))return{x:0,y:0};t=e.clientX,i=e.clientY}return{x:t-s.left,y:i-s.top}},[]),w=D.useCallback(e=>{if(s)return;e.preventDefault();const a=c.current,t=a?.getContext("2d");if(!a||!t)return;u(!0);const{x:i,y:r}=f(e);t.beginPath(),t.moveTo(i,r);const o={points:[{x:i,y:r}],timestamp:Date.now()};p(e=>[...e,o])},[s,f]),N=D.useCallback(e=>{if(!m||s)return;e.preventDefault();const a=c.current,t=a?.getContext("2d");if(!a||!t)return;const{x:i,y:r}=f(e);t.lineTo(i,r),t.stroke(),p(e=>{if(0===e.length)return e;const a=[...e];return a[a.length-1].points.push({x:i,y:r}),a})},[m,s,f]),j=D.useCallback(()=>{if(!m)return;u(!1),g(!0);const a=c.current;if(a){const s=a.toDataURL("image/png");e(s)}},[m,e]),k=D.useCallback(()=>{if(s)return;const a=c.current,t=a?.getContext("2d");a&&t&&(t.fillStyle="#ffffff",t.fillRect(0,0,a.width,a.height),g(!1),p([]),e(null))},[s,e]);D.useEffect(()=>{if(!y||s)return;const e=c.current;if(!e)return;const a=e=>w(e),t=e=>N(e),i=()=>j(),r=()=>j(),o=e=>w(e),n=e=>N(e),l=()=>j();return e.addEventListener("mousedown",a,{passive:!1}),e.addEventListener("mousemove",t,{passive:!1}),e.addEventListener("mouseup",i),e.addEventListener("mouseleave",r),e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("touchmove",n,{passive:!1}),e.addEventListener("touchend",l),d.current=()=>{e.removeEventListener("mousedown",a),e.removeEventListener("mousemove",t),e.removeEventListener("mouseup",i),e.removeEventListener("mouseleave",r),e.removeEventListener("touchstart",o),e.removeEventListener("touchmove",n),e.removeEventListener("touchend",l)},d.current},[y,s,w,N,j]),D.useEffect(()=>{b()},[b]),D.useEffect(()=>{if(r&&y){const e=c.current,a=e?.getContext("2d");if(!e||!a)return;const s=new Image;s.onload=()=>{a.clearRect(0,0,e.width,e.height),a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height),a.drawImage(s,0,0),g(!0)},s.src=r}},[r,y]),D.useEffect(()=>()=>{d.current&&d.current()},[]);const C=x.length>=2&&x.some(e=>e.points.length>=3);return a.jsxs("div",{className:`space-y-3 ${o}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",children:t}),a.jsxs("div",{className:"flex items-center gap-2",children:[h&&a.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-600",children:[a.jsx(oe,{className:"w-3 h-3"}),a.jsx("span",{children:"Signed"})]}),a.jsxs("button",{type:"button",onClick:k,disabled:s||!h,className:"flex items-center gap-1 px-2 py-1 text-xs text-gray-600 hover:text-red-600 disabled:opacity-50",children:[a.jsx(ne,{className:"w-3 h-3"}),"Clear"]})]})]}),a.jsxs("div",{className:`\n        relative border-2 border-dashed rounded-lg bg-white\n        ${s?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}\n        ${h&&C?"border-green-300 bg-green-50":""}\n        ${h&&!C?"border-amber-300 bg-amber-50":""}\n      `,children:[a.jsx("canvas",{ref:c,width:n,height:l,className:`\n            block w-full h-full cursor-crosshair rounded-lg\n            ${s?"cursor-not-allowed":""}\n          `,style:{width:`${n}px`,height:`${l}px`}}),!h&&!s&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[a.jsx(te,{className:"w-4 h-4"}),a.jsx("span",{children:i})]})}),h&&!C&&a.jsx("div",{className:"absolute top-2 right-2 bg-amber-100 text-amber-700 text-xs px-2 py-1 rounded-full",children:"Signature too simple"})]}),!1]})},Oe=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],We={en:{greeting:(e,a)=>`Good day ${e}. My name is ${a}, and I need to speak with you about a workplace incident that occurred recently.`,purpose:()=>"This meeting is to formally discuss a disciplinary matter. I want to make sure you understand your rights and the process we're following, which is in accordance with the Labour Relations Act and our company's disciplinary policy.",incident:e=>`The incident we need to discuss is as follows: ${e}. This behavior is not in line with our workplace standards and company policies.`,warningExplanation:e=>`Based on the severity and our disciplinary procedure, I am issuing you with a ${e} warning. This warning will remain active in your employment record for the validity period specified.`,rights:()=>"Now, it's very important that you understand your rights in this process:",rightsList:()=>["You have the right to respond to this warning and provide your version of events.","You may request a witness to be present during this discussion if you wish.","You have the right to appeal this decision within 48 hours if you believe it is unfair or procedurally incorrect.","This disciplinary action is progressive - repeated or more serious offenses may lead to further disciplinary steps.","You have the right to union representation if you are a member of a recognized trade union.","All information discussed will be kept confidential and only shared with relevant management and HR personnel."],witnessOption:()=>"If you choose not to sign this warning, that is your right. However, please understand that a witness will sign to confirm that this warning was properly delivered to you and that you were informed of all your rights. The warning remains valid whether you sign it or not.",questions:()=>"Do you have any questions about this warning, the incident, or your rights that I've explained? I want to make sure you fully understand everything before we proceed.",closing:()=>"Thank you for listening. We will now proceed to document this warning properly. Remember, this is an opportunity for improvement, and we hope to see positive changes in your conduct going forward."},af:{greeting:(e,a)=>`Goeiedag ${e}. My naam is ${a}, en ek moet met jou praat oor 'n werkplek incident wat onlangs plaasgevind het.`,purpose:()=>"Hierdie vergadering is om 'n dissiplinêre saak formeel te bespreek. Ek wil seker maak dat jy jou regte en die proses wat ons volg verstaan, wat in ooreenstemming is met die Wet op Arbeidsverhoudinge en ons maatskappy se dissiplinêre beleid.",incident:e=>`Die incident wat ons moet bespreek is soos volg: ${e}. Hierdie gedrag is nie in lyn met ons werkplek standaarde en maatskappy beleide nie.`,warningExplanation:e=>`Gebaseer op die ernst en ons dissiplinêre prosedure, gee ek jou 'n ${e} waarskuwing. Hierdie waarskuwing sal aktief bly in jou werkrekord vir die gespesifiseerde geldigheidsperiode.`,rights:()=>"Nou, dit is baie belangrik dat jy jou regte in hierdie proses verstaan:",rightsList:()=>["Jy het die reg om op hierdie waarskuwing te reageer en jou weergawe van gebeure te verskaf.","Jy mag versoek dat 'n getuie teenwoordig is tydens hierdie bespreking as jy wil.","Jy het die reg om hierdie besluit binne 48 uur te appelieer as jy glo dit is onregverdig of prosedureel verkeerd.","Hierdie dissiplinêre aksie is progressief - herhaalde of ernstiger oortredings kan tot verdere dissiplinêre stappe lei.","Jy het die reg tot vakbondverteenwoordiging as jy 'n lid is van 'n erkende vakbond.","Alle inligting wat bespreek word sal vertroulik gehou word en slegs gedeel word met relevante bestuur en HR personeel."],witnessOption:()=>"As jy kies om nie hierdie waarskuwing te teken nie, is dit jou reg. Verstaan egter asseblief dat 'n getuie sal teken om te bevestig dat hierdie waarskuwing behoorlik aan jou afgelewer is en dat jy ingelig is van alle jou regte. Die waarskuwing bly geldig of jy dit teken of nie.",questions:()=>"Het jy enige vrae oor hierdie waarskuwing, die incident, of jou regte wat ek verduidelik het? Ek wil seker maak dat jy alles ten volle verstaan voordat ons voortgaan.",closing:()=>"Dankie dat jy geluister het. Ons sal nou voortgaan om hierdie waarskuwing behoorlik te dokumenteer. Onthou, dit is 'n geleentheid vir verbetering, en ons hoop om positiewe veranderinge in jou gedrag vorentoe te sien."},zu:{greeting:(e,a)=>`Sawubona ${e}. Igama lami ngu-${a}, futhi ngidinga ukukhuluma nawe ngodaba olwenzeke emsebenzini muva nje.`,purpose:()=>"Le meeting iwukuxoxa ngodaba lokuqeqeshwa ngokusemthethweni. Ngifuna ukuqinisekisa ukuthi uyaziqonda amalungelo akho nenqubo esilandulayo, okuhambisana noMthetho Wobudlelwano Basebenzi kanye nenqubomgomo yokuqeqesha yenkampani yethu.",incident:e=>`Isigameko okumele sikuxoxe isilandelayo: ${e}. Loku kuziphatha akuhambisani nezindinganiso zethu zendawo yomsebenzi kanye nezinqubomgomo zenkampani.`,warningExplanation:e=>`Ngokusekelwe ebubini kanye nenqubo yethu yokuqeqesha, ngikupha isixwayiso se-${e}. Lesi sixwayiso sizoblhala sisebenza kumarekhodi akho womsebenzi isikhathi semvume esicaciswayo.`,rights:()=>"Manje, kubalulekile kakhulu ukuthi uqonde amalungelo akho kule nqubo:",rightsList:()=>["Unelungelo lokuphendula kulesi sixwayiso futhi unikeze ingqikithi yakho yezigameko.","Ungacela ukuthi kubekho ufakazi kulengxoxo uma ufuna.","Unelungelo lokuphikisa lesi sinqumo phakathi namahora angama-48 uma ukholelwa ukuthi alulungile noma alungenzi kahle.","Lesi senzo sokuqeqesha siyaqhubeka - amacala aphindwayo noma amabi kakhulu angaholela ezinyathelweni zokuqeqesha ezabanye.","Unelungelo lokumelelwa yinyunyana uma uyilungu lenyunyana eqashelwa.","Lonke ulwazi oluxoxwayo luzogcinwa luyimfihlo futhi lwabelane kuphela nabapha boholi kanye nabasebenzi be-HR abafanele."],witnessOption:()=>"Uma ukhetha ukungasisayini lesi sixwayiso, yilelo ilungelo lakho. Kodwa-ke sicela uqonde ukuthi ufakazi uzosayina ukuqinisekisa ukuthi lesi sixwayiso sikulethwe ngendlela efanele futhi wazisiwa wonke amalungelo akho. Isixwayiso sihlala sisebenza noma uyasisayina noma cha.",questions:()=>"Ingabe unemibuzo mayelana nalesi sixwayiso, isigameko, noma amalungelo akho engiwakaziselwe? Ngifuna ukuqinisekisa ukuthi uqonda konke ngokugcwele ngaphambi kokuqhubeka.",closing:()=>"Ngiyabonga ukulalela. Manje sizokweqhubeka nokuqopha lesi sixwayiso ngendlela efanele. Khumbula, leli ithuba lokuthuthuka, futhi sithemba ukubona ushintsho oluhle ekuziphatheni kwakho kwezayo."},xh:{greeting:(e,a)=>`Molo ${e}. Igama lam ngu-${a}, kwaye kufuneka ndithethe nawe ngesiganeko emsebenzini esenzeke kutsha nje.`,purpose:()=>"Le ntlanganiso ikukuxoxa ngomba wokulungiswa ngokomsitho ngokusemthethweni. Ndifuna ukuqinisekisa ukuba uyawaqonda amalungelo akho kunye nenkqubo esiyilandelayo, ehambelana noMthetho woBudlelwane baBasebenzi kunye nemigaqo-nkqubo yoculeko yenkampani yethu.",incident:e=>`Isiganeko esifuneka sikuxoxe ngesi: ${e}. Oku kuziphatha akuhambelani nemigangatho yethu yendawo yomsebenzi kunye nemigaqo-nkqubo yenkampani.`,warningExplanation:e=>`Ngokusekelwe kubunzima kunye nenkqubo yethu yokulungisa, ndikunika isilumkiso se-${e}. Esi silumkiso siza kuhlala sisebenza kwiirekhodi zakho zomsebenzi ngexesha lokusebenza elichaziwayo.`,rights:()=>"Ngoku, kubalulekile kakhulu ukuba uqonde amalungelo akho kule nkqubo:",rightsList:()=>["Unelungelo lokuphendula kesi silumkiso kwaye unikeze ingxelo yakho yeziganeko.","Ungacela ukuba kubeko ingqina ngexesha lale ngxoxo ukuba ufuna.","Unelungelo lokubhena esi sigqibo ngaphakathi kweeyure ezingama-48 ukuba ukholelwa ukuba asifanelekanga okanye asizenzi ngokufanelekileyo.","Esi senzo sokulungisa siyaqhubela phambili - amatyala aphindaphindiweyo okanye amandla kakhulu anokukhokelela kumanyathelo amaninzi okulungisa.","Unelungelo lokumelelwa yimanyano ukuba ulilungu lemanyano eyamkelekileyo.","Lonke ulwazi oluxoxwayo luza kugcinwa luyimfihlo kwaye lwabiwe kuphela nabo baphathi abafanelekileyo nabasebenzi be-HR."],witnessOption:()=>"Ukuba ukhetha ukungasayini esi silumkiso, yilelo ilungelo lakho. Kodwa nceda uqonde ukuba ingqina iza kusayina ukuqinisekisa ukuba esi silumkiso siye sanikwa kuwe ngokufanelekileyo kwaye waziswa nangawo onke amalungelo akho. Isilumkiso sihlala sisebenza nokuba usisayinile okanye awusisayinanga.",questions:()=>"Ingaba unemibuzo malunga nesi silumkiso, isiganeko, okanye amalungelo akho endiwakaziselwe? Ndifuna ukuqinisekisa ukuba uyakuqonda konke ngokupheleleyo ngaphambi kokuba siqhubeke.",closing:()=>"Enkosi ngokuphulaphula. Ngoku siza kuqhubeka nokubhala esi silumkiso ngokufanelekileyo. Khumbula, oku lithuba lokuphucula, kwaye sinethemba lokubona utshintsho oluhle ekuziphatheni kwakho kwixesha elizayo."},st:{greeting:(e,a)=>`Dumela ${e}. Lebitso la ka ke ${a}, mme ke hloka ho bua le wena ka taba ya mosebetsi e etsahetseng haufinyane.`,purpose:()=>"Kopano ena ke ho buisana ka taba ya kgetho ka mokhoa o nepahetseng oa molao. Ke batla ho netefatsa hore o utloisisa ditokelo tsa hao le tshebetso eo re e latelang, e lumellanang le Molao oa Dikamano tsa Basebetsi le pholisi ya kgetho ya khamphani ya rona.",incident:e=>`Ketsahalo eo re tlameha ho e buisana ke ena: ${e}. Boitshwaro bona ha bo lumellane le maemo a rona a sebaka sa mosebetsi le dipholisi tsa khamphani.`,warningExplanation:e=>`Ho latela boholo le tshebetso ya rona ya kgetho, ke o fa temoso ya ${e}. Temoso ena e tla dula e sebetsa lirekotong tsa hao tsa mosebetsi nakong ya ho sebetsa e hlalosang.`,rights:()=>"Jwale, ho bohlokwa haholo hore o utloisise ditokelo tsa hao tshebetsong ena:",rightsList:()=>["O na le tokelo la ho araba temoso ena le ho fana ka pale ya hao ya ditiragalo.","O ka kopa hore ho be le paki nakong ya puisano ena haeba o batla.","O na le tokelo la ho ipeela qeto ena ka mora dihora tse 48 haeba o lumela hore ha e nepahala kapa e sa etsoa hantle.","Ketso ena ya kgetho e tsoela pele - diphoso tse phethehang kapa tse matla haholo di ka lebisa ho maqephe a mang a kgetho.","O na le tokelo la ho emelwa ke mokhatlo haeba o setho sa mokhatlo o amohetsweng.","Tlhahisoleseding yohle e buuwang e tla bolokwa e le lekunutu mme e arolelane feela le bataoli ba bohlokwa le basebetsi ba HR."],witnessOption:()=>"Haeba o khetha ho se saene temoso ena, ke tokelo la hao. Empa ka kopo utloisise hore paki e tla saena ho netefatsa hore temoso ena e fihletswe ho wena ka nepo mme o tsebisitswe ditokelo tsa hao tsohle. Temoso e dula e sebetsa ha hoja o e saennse kapa o sa e saene.",questions:()=>"Na o na le dipotso mabapi le temoso ena, ketsahalo, kapa ditokelo tsa hao tseo ke di hlalositseng? Ke batla ho netefatsa hore o utloisisa tsohle ka botlalo pele re tsoela pele.",closing:()=>"Kea leboha ho mamela. Jwale re tla tsoela pele ho ngola temoso ena ka nepo. Hopola, sena ke sebaka sa ntlafatso, mme re lebelletse ho bona diphetoho tse ntle boitshwarong ba hao nakong e tlang."},ts:{greeting:(e,a)=>`Avuxeni ${e}. Vito ra mina i ${a}, naswona ndzi lava ku vulavula na wena hi timhaka ta rixaka leri nga endleke sweswi eka ntirho.`,purpose:()=>"Nhlanganiso lowu i ku burisana hi timhaka ta ndzulavulo hi ndlela ya ximfumo. Ndzi lava ku tiyisisa leswaku u twisisa timfanelo ta wena ni nongonoko lowu hi wu landzelaka, lowu fambana na Nawu wa Vuhlanganisi bya Vatirhi ni pholisi ya ndzulavulo ya khamphani ya hina.",incident:e=>`Xivangelo lexi hi faneleke ku xi burisana xi nga ha landzu: ${e}. Mavanyiselo lawa ma nga fambani na swiyimo swa hina swa ndhawu ya ntirho ni tipholisi ta khamphani.`,warningExplanation:e=>`Hi ku landza ku antswa ni nongonoko wa hina wa ndzulavulo, ndzi ku nyika xilumkiso xa ${e}. Xilumkiso lexi xi ta tshama xi tirhaka eka rhekhodo ya wena ya ntirho hi nkarhi wa ku tirhisa lowu nga boxiweke.`,rights:()=>"Sweswi, swa nkoka ngopfu leswaku u twisisa timfanelo ta wena eka nongonoko lowu:",rightsList:()=>["U na timfanelo to hlamula xilumkiso lexi naswona u nyika hungu ra wena ra swiendlakalo.","U nga kumbela leswaku ku va na nhlamulo loko u lava eka nsinya lowu.","U na timfanelo ro kongomisa xiboho lexi hi nkarhi wa tawa ta 48 loko u tshemba leswaku a xi nga ri xa ku lulamela kumbe xi nga endliwanga hi ndlela yo nepfuma.","Goza leri ra ndzulavulo ri ya emahlweni - matsalwa yo phindha-phindha kumbe ya nkoka ngopfu ya nga endla leswaku ku va na magoza yo engetela ya ndzulavulo.","U na timfanelo ro yimeriwa hi mihlangano ya vatirhi loko u ri xirho xa mihlangano leyi amukeriweke.","Rungula hinkwaro lexi nga burisaniwaka ri ta hlayisiwa ri ri swihlayiselo naswona ri avelaniwa ntsena na vafambisi va nkoka ni vatirhi va HR."],witnessOption:()=>"Loko u hlawula ku nga sayini xilumkiso lexi, sweswo i timfanelo ta wena. Kambe kombela u twisisa leswaku nhlamulo a nga ta ku sayina ku tiyisisa leswaku xilumkiso lexi xi nyikiwe eka wena hi ndlela yo nepfuma naswona u tivisiwe hi timfanelo ta wena hinkwato. Xilumkiso xi hlaya xi tirhaka hambi u xi sayinile kumbe a xi sayinanga.",questions:()=>"Xana u na swivutiso hi xilumkiso lexi, xivangelo, kumbe timfanelo ta wena leswi ndzi ti hlamuseleke? Ndzi lava ku tiyisisa leswaku u twisisa hinkwaswo kusuhi hi ku helela ka ku ya emahlweni.",closing:()=>"Inkomu hi ku yingisa. Sweswi hi ta ya emahlweni ku tsala xilumkiso lexi hi ndlela yo nepfuma. Tsundzuka, leswi i nkarhi wo antswisa, naswona hi langutera ku vona ku cinca ko antswa eka mavanyiselo ya wena eka nkarhi lowu taka."},ve:{greeting:(e,a)=>`Ndaa ${e}. Dzina langa ndi ${a}, nahone ndi khou toda u amba navho nga zwithu zwa mushumo zwine zwa itika zwino-zwino.`,purpose:()=>"Iyi meetingi ndi ya u amba nga zwa mulandu nga ndila ya mulayo. Ndi khou toda u vhona uri no pfesesaho pfanelo dzavho na muitero une ra khou tevhedza, une wa tshimbila nga Mulayo wa Vhushaka ha Mushumi na polisi ya mulandu ya khamphani yashu.",incident:e=>`Zwithu zwine ra tea u zwi amba ndi zwi: ${e}. Maitele aya a si kha fhasi ha zwiyimo zwashu zwa fhethu ha mushumo na mipholisi ya khamphani.`,warningExplanation:e=>`Hu tshi tevhedzwa vhukhakhi na muitero washu wa mulandu, ndi khou ni nea tivhiso ya ${e}. Iyi tivhiso i do dzula i khou shuma kha rekhodho yavho ya mushumo nga tshifhinga tsha u shuma tshine tsha bulwa.`,rights:()=>"Zwino, zwa khongolose uri no pfesesehe pfanelo dzavho kha uyu muitero:",rightsList:()=>["No na pfanelo ya u fhindula kha iyi tivhiso nahone no nee ndivho yavho ya zwithu zwo itikelaho.","No nga humbela uri hu vhe na muhumbeli arali no khou toda kha iyi ngudo.","No na pfanelo ya u appela kha tshiphinzhi itshi nga ngomu dza awara dza 48 arali no tenda uri a zwi kha fhasi ha vhulungana kana zwa si itiwa nga ndila yo teaho.","Uga mulandu uyu u khou fhiraho phanḓa - mafhungo o phindaho kana o nzhulaho o nga kondelela kha magato a mufifi a mulandu.","No na pfanelo ya u mimelwa nga union arali no ri memba wa union yo tenderedzwaho.","Mafhungo othe ano amba a do tshimbila sa swihlayiselo nahone a do abelana fhedzi na vhaṱhohi vha nkoka na vhashumi vha HR."],witnessOption:()=>"Arali no nanga u si saini iyi tivhiso, ndi pfanelo yavho. Fhedzi ri humbela no pfesesehe uri muhumbeli o do saini u khwaṱhisedza uri iyi tivhiso yo nedziwa kwavho nga ndila yo teaho nahone no divhisiwa pfanelo dzavho dzoṱhe. Tivhiso i khou sala i khou shuma arali no i saininwa kana no sa i saini.",questions:()=>"Vho na mbudziso nga iyi tivhiso, zwo itikelaho, kana pfanelo dzavho dzine nda dzi talutshedzesa? Ndi khou toda u vhona uri no pfesesesa zwoṱhe nga u fhedzisesa phanḓa ha u fhiraho phanḓa.",closing:()=>"Ndo livhuwa nga u thetshelesa. Zwino ro do fhiraho phanḓa u ṅwala iyi tivhiso nga ndila yo teaho. Humbulani, zwi ndi tshifhinga tsha u khwinisa, nahone ri khou lindela u vhona tshanduko ntswa kha mavanyiseli avho kha tshifhinga tshi tshaho."},ss:{greeting:(e,a)=>`Sawubona ${e}. Libito lami ngu-${a}, futhi ngidvinga kukhuluma nawe ngendaba yemsebenzi leseyenteke kamuva nje.`,purpose:()=>"Loluhlangano ngalokukhulunywa ngemsebenti wokulajiswa ngendlela yemtsetfo. Ngifuna kubone kutsi uyatizwa emalungelo akho kanye nenqubo lesiyilandzelelayo, lehambelana neMtsetfo weTinhlangano teTisebenzi kanye nephalisinkomba yekulajiswa yekhamphani yaletfu.",incident:e=>`Lesi sehlo lesifanele sikhulunyane ngaso ngulesi: ${e}. Loku kuziphatha akuhambisani netintfo tetfu temtsetfo wemsebenti kanye nephalisinkomba yekhamphani.`,warningExplanation:e=>`Ngekwesekwa bukhulu kanye nenqubo yaletfu yekulajiswa, ngikupha sixwayiso se-${e}. Lesi sixwayiso sitawuhlala sisebenta kurekhodi yakho yemsebenzi ngelisikhasti sokuphila lesichaziwe.`,rights:()=>"Manje, kubalulekile kakhulu kutsi watizwe emalungelo akho kule nqubo:",rightsList:()=>["Unelilungelo lekuphendvula kulesi sixwayiso kanye nekuveta umbiko wakho waletitifo letentekako.","Ungacela kutsi kube khona umfakazi kule nkhulumano uma ucela.","Unelilungelo lekuphikisana nalesi sinqumo ngekutsatsa emahora lange-48 uma ukholwa kutsi awulungile noma awenziwa ngendlela lefanele.","Lesi senzempi sekulajiswa siyacondzaphambili - emacala laphindvako noma lamabi kakhulu angaletha tinyatselo letinye tekulajiswa.","Unelilungelo lekumelelwa ngumnyamo uma ulingidzima lemnyamweni lowamukekile.","Tonkhe lwati lolokhulunywa ngatsi lutawuhlaliswa luyimfihlo futhi lunikezelwe kuphela kubaphati labadzingekako kanye netisebenzi te-HR."],witnessOption:()=>"Uma ukhetha ungasisayini lesi sixwayiso, yilelo ilungelo lakho. Kodvwa-ke sicela uwatizwe kutsi umfakazi utawusayina kucoka kutsi lesi sixwayiso siletjwe kuwe ngendlela lefanele futhi wanglelwa ngemalungelo akho onkhe. Sixwayiso sihlala sisebenta noma usisayinile noma ungasisayinanga.",questions:()=>"Ingabe unemibuto ngalesi sixwayiso, sehlo, noma emalungelo akho lengiwahlatsheliselile? Ngifuna kucoka kutsi uwatizwa tonkhe kachubeka phambi kokucondzaphambili.",closing:()=>"Ngiyabonga ngekutilalela. Manje sitawucondzaphambili kutsala lesi sixwayiso ngendlela lefanele. Khumbulanani, loku kuyindzawo yekuntfula, futhi sitawubona tingutsuko letintsja ekuziphatheni kwakho kutsine kuye phambi."},tn:{greeting:(e,a)=>`Dumelang ${e}. Leina la me ke ${a}, mme ke batla go bua le wena ka kgang ya tiro e e diragetseng gone jaanong.`,purpose:()=>"Kopano eno ke go buisana ka kgang ya kgalemelo ka tsela ya semolao. Ke batla go netefatsa gore o tlhaloganya ditshwanelo tsa gago le thulaganyo e re e latelang, e e tsamayang le Molao wa Dikamano tsa Badiri le pholisi ya kgalemelo ya khampani ya rona.",incident:e=>`Kgang e re tshwanetseng go e buisana ke eno: ${e}. Boitshwaro jono ga bo tsamaelane le ditekanyetso tsa rona tsa lefelo la tiro le dipholisi tsa khampani.`,warningExplanation:e=>`Go ya ka boima le thulaganyo ya rona ya kgalemelo, ke go naya temoso ya ${e}. Temoso eno e tla nna e bereka mo rekotong ya gago ya tiro ka nako ya go bereka e e tlhalosiwang.`,rights:()=>"Jaanong, go botlhokwa thata gore o tlhaloganye ditshwanelo tsa gago mo thulaganyong eno:",rightsList:()=>["O na le tshwanelo ya go araba temoso eno mme o neye kgang ya gago ya ditiragalo.","O ka kopa gore go nne le paki mo puisanong eno fa o batla.","O na le tshwanelo ya go boipiletsa tshwetso eno mo diureng tse 48 fa o dumela gore ga e siame kgotsa ga e a dirwa sentle.","Kgato eno ya kgalemelo e ya pele - ditlolo tse di boelwang kgotsa tse di masisi thata di ka feleletsa ka dikgato tse dingwe tsa kgalemelo.","O na le tshwanelo ya go emelwa ke kopano fa o le leloko la kopano e e amogetsweng.","Tshedimosetso yotlhe e e buisanwang e tla bolokwa e le sephiri mme e arolelane fela le batsamaisi ba ba botlhokwa le badiri ba HR."],witnessOption:()=>"Fa o tlhopha go sa saene temoso eno, ke tshwanelo ya gago. Fela ke a go rapela gore o tlhaloganye gore paki e tla saena go netefatsa gore temoso eno e o newetswe ka tsela e e siameng mme o itsisiwe ka ditshwanelo tsa gago tsotlhe. Temoso e nna e bereka go sa kgathalesege gore o e saenile kgotsa ga o a e saena.",questions:()=>"A o na le dipotso ka temoso eno, kgang, kgotsa ditshwanelo tsa gago tse ke di tlhalositseng? Ke batla go netefatsa gore o tlhaloganya tsotlhe pele re ya pele.",closing:()=>"Ke a leboga go reetsa. Jaanong re tla ya pele go kwala temoso eno ka tsela e e siameng. Gopola, seno ke sebaka sa go tokafatsa, mme re lebeletse go bona diphetogo tse dintle mo boitshwarong jwa gago mo nakong e e tlang."},nr:{greeting:(e,a)=>`Lotjhani ${e}. Ibizo lami ngu-${a}, futhi ngidinga ukukhuluma nawe ngodaba lomsebenzi olwenzeke muva nje.`,purpose:()=>"Leli hlangano ngolokukhuluma ngodaba lokuqeqesha ngendlela yomthetho. Ngifuna ukuqinisekisa ukuthi uyaziqonda amalungelo akho kanye nenqubo esiyilandelayo, ehambisana noMthetho weBudlelwano Basebenzi kanye nenqubomgomo yokuqeqesha yenkampani yethu.",incident:e=>`Isigameko okumele sikuxoxe sikulesi: ${e}. Lokhu kuziphatha akuhambisani nezindinganiso zethu zendawo yomsebenzi kanye nezinqubomgomo zenkampani.`,warningExplanation:e=>`Ngokusekelwe ebunzimeni kanye nenqubo yethu yokuqeqesha, ngikupha isixwayiso se-${e}. Lesi sixwayiso sizokwanda sisebenza emarekhodi akho omsebenzi isikhathi sokusebenza esichaziwe.`,rights:()=>"Manje, kubaluleke kakhulu ukuthi uqonde amalungelo akho kule nqubo:",rightsList:()=>["Unelungelo lokuphendula kulesi sixwayiso futhi unikeze umbiko wakho wezigameko.","Ungacela ukuthi kube khona umfakazi kule nkulumo uma ufuna.","Unelungelo lokubhena lesi sinqumo phakathi namahora angama-48 uma ukholelwa ukuthi awulungile noma awenziwa ngendlela efanele.","Lesi senzo sokuqeqesha siyaqhubeka - amacala aphindwayo noma amabi kakhulu angaholela ezinyathelweni ezinye zokuqeqesha.","Unelungelo lokumelelwa yinyunyana uma uyilungu lenyunyana esamukelekile.","Lonke ulwazi oluxoxwayo luzogcinwa luyimfihlo futhi lwabelane kuphela nabapha boholi abadingekayo kanye nabasebenzi be-HR."],witnessOption:()=>"Uma ukhetha ukungasayini lesi sixwayiso, lelo ilungelo lakho. Kodwa-ke sicela uqonde ukuthi umfakazi uzosayina ukuqinisekisa ukuthi lesi sixwayiso sikulethwe ngendlela efanele futhi wazisiwe wonke amalungelo akho. Isixwayiso sihlala sisebenza noma uyasisayina noma ungasisayina.",questions:()=>"Ingabe unemibuzo ngalesi sixwayiso, isigameko, noma amalungelo akho engiwacacisile? Ngifuna ukuqinisekisa ukuthi uqonda konke ngokuphelele ngaphambi kokuqhubeka.",closing:()=>"Ngiyabonga ukuthi ulalele. Manje sizokwanda siqhubeke nokubhala lesi sixwayiso ngendlela efanele. Khumbula, lokhu kuyithuba lokuthuthuka, futhi sithemba ukubona ushintsho oluhle ekuziphatheni kwakho kwesikhathi esizayo."},ns:{greeting:(e,a)=>`Thobela ${e}. Leina la ka ke ${a}, gomme ke hloka go boledišana le wena ka taba ya mošomo yeo e diregego bjale.`,purpose:()=>"Kopano ye ke go boledišana ka taba ya kgalemo ka tsela ya molao. Ke nyaka go netefatša gore o kwešiša ditokelo tša gago le tshepedišo yeo re e latelago, yeo e sepelelanago le Molao wa Dikamano tša Bašomi le pholisi ya kgalemo ya khamphani ya rena.",incident:e=>`Tiragalo yeo re swanetšego go e boledišana ke ye: ${e}. Boitshwaro bjo ga bo sepelelane le ditekanyetšo tša rena tša lefelo la mošomo le dipholisi tša khamphani.`,warningExplanation:e=>`Go ya ka bogolo le tshepedišo ya rena ya kgalemo, ke go nea temošo ya ${e}. Temošo ye e tlago dula e šoma go direkoto tša gago tša mošomo ka nako ya go šoma yeo e hlalošitšwego.`,rights:()=>"Bjale, go bohlokwa kudu gore o kwešiše ditokelo tša gago tshepedišong ye:",rightsList:()=>["O na le tokelo ya go araba temošo ye gomme o neye pale ya gago ya ditiragalo.","O ka kgopela gore go be le paki puledišanong ye ge o nyaka.","O na le tokelo ya go boipiletšo tshwetšong ye ka gare ga diiri tše 48 ge o dumela gore ga e nepagetšego goba ga e dirwa gabotse.","Kgato ye ya kgalemo e tšwela pele - diphošo tšeo di boeletšwago goba tšeo di maatla kudu di ka phethelela dikgatong tše dingwe tša kgalemo.","O na le tokelo ya go emelwa ke mokgatlo ge o le leloko la mokgatlo wo o amogetšwego.","Tshedimošo ka moka yeo e boletšwego e tlago bolokwa e le sephiri gomme e abelanwa feela le balaodi ba bohlokwa le bašomi ba HR."],witnessOption:()=>"Ge o kgetha go se saene temošo ye, ke tokelo ya gago. Eupša ke a go rapela gore o kwešiše gore paki e tlago saena go netefatša gore temošo ye e o fihlele ka tsela ye e nepagetšego gomme o tsebišwa ka ditokelo tša gago ka moka. Temošo e dula e šoma ntle le go ela hloko gore o e saenile goba aowa.",questions:()=>"Na o na le dipotšišo ka temošo ye, tiragalo, goba ditokelo tša gago tšeo ke di hlalošitšego? Ke nyaka go netefatša gore o kwešiša tše ka moka pele re tšwelapele.",closing:()=>"Ke leboga go theeletša. Bjale re tlago tšwelapele go ngwala temošo ye ka tsela ye e nepagetšego. Gopola, se ke sebaka sa go kaonafatša, gomme re lebelletše go bona diphetogo tše dibotse boitshwarong bja gago ka nako ye e tlago."}},He=({employeeName:e,managerName:s,incidentDescription:t,warningLevel:i,onScriptRead:r,disabled:o=!1})=>{const[n,l]=D.useState("en"),[c,d]=D.useState(!1),[m,u]=D.useState(!1),h=We[n]||We.en,g=Oe.find(e=>e.code===n)||Oe[0];return a.jsx("div",{className:"space-y-2",children:a.jsx("div",{className:"border rounded-lg p-3",style:{background:"linear-gradient(to right, var(--color-alert-warning-bg), var(--color-alert-warning-bg))",borderColor:"var(--color-alert-warning-border)"},children:c?a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:a.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Opening & Introduction"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.greeting(e,s)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Meeting Purpose"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.purpose()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Incident Details"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.incident(t)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Warning Details"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.warningExplanation(i)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"5. Your Rights"}),a.jsx("p",{className:"text-xs leading-relaxed mb-2",style:{color:"var(--color-text-secondary)"},children:h.rights()}),a.jsx("ul",{className:"space-y-1 text-xs",style:{color:"var(--color-text-secondary)"},children:h.rightsList().map((e,s)=>a.jsxs("li",{className:"flex items-start gap-1.5",children:[a.jsx(oe,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--color-success)"}}),e]},s))})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-secondary)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"6. Witness & Signature Rights"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.witnessOption()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"7. Questions & Clarifications"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.questions()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-text-tertiary)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"8. Closing"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:h.closing()})]})]})}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(de,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsxs("span",{children:["Read this complete script aloud to ",e]})]}),m?a.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[a.jsx(oe,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):a.jsxs("button",{onClick:()=>{u(!0),r()},disabled:o,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:[a.jsx(oe,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]}),a.jsx("div",{className:"border rounded-lg p-3",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(Z,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-info)"}}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-info-text)"},children:[a.jsx("p",{className:"font-medium mb-0.5",children:"Legal Compliance Notice"}),a.jsx("p",{children:"This script ensures compliance with the Labour Relations Act (LRA) requirements for procedural fairness in disciplinary proceedings. All employee rights have been comprehensively covered in their preferred language."})]})]})})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(le,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Employee Warning Script"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Complete script covering all employee rights"})]})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(ce,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:n,onChange:e=>l(e.target.value),disabled:m||o,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:Oe.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-1 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-warning-text)"},children:["Script available in ",a.jsx("strong",{children:g.nativeName})," • Ready to read aloud"]}),a.jsxs("button",{onClick:()=>d(!0),disabled:o,className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-medium",style:{backgroundColor:"var(--color-warning)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-warning)",e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--color-warning)",e.currentTarget.style.opacity="1"},children:[a.jsx(Z,{className:"w-3 h-3"}),"View Full Script"]})]})]})})})},Be=(e,a="Unknown")=>null==e?a:"string"==typeof e?e:"object"==typeof e&&e.name?String(e.name):String(e),Ve=({lraRecommendation:e,selectedEmployee:s,formData:o,currentManagerName:n,onSignaturesComplete:l,isAnalyzing:c=!1,signaturesFinalized:d=!1,currentSignatures:m})=>{const[u,h]=D.useState(!1),[g,x]=D.useState(!1),[p,y]=D.useState(!1),[v,b]=D.useState(!1),[f,w]=D.useState(m||{manager:null,employee:null});D.useEffect(()=>{m&&w(m)},[m]),D.useEffect(()=>{g&&b(!0)},[g]);const N=s||{id:"unknown",firstName:"Unknown",lastName:"Employee",position:"Unknown Position",department:"Unknown Department",email:"unknown@email.com",phone:"Unknown",deliveryPreference:"email",recentWarnings:{count:0},riskIndicators:{highRisk:!1,reasons:[]}},j=!(!f.manager||!f.employee);D.useCallback(()=>{y(!0),setTimeout(()=>{x(!0),y(!1)},1500)},[]);const k=D.useCallback(e=>{w(a=>({...a,manager:e}))},[]),C=D.useCallback(e=>{w(a=>({...a,employee:e}))},[]),S=D.useCallback(()=>{if(!j||d)return;const e={...f,timestamp:(new Date).toISOString(),managerName:n,employeeName:`${N.firstName} ${N.lastName}`};l(e,!0)},[f,j,d,n,N,l]);return c?a.jsxs(i,{padding:"xl",className:"text-center",children:[a.jsx(me,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"var(--color-primary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Analyzing legal requirements..."})]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Y,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"LRA Recommendation"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Legal analysis complete"})]})]}),a.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>h(!u),className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[u?"Hide":"Details",u?a.jsx(B,{className:"w-3 h-3"}):a.jsx(W,{className:"w-3 h-3"})]})]}),a.jsxs(i,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(t,{variant:"primary",size:"sm",className:"font-semibold",children:Be(e?.recommendedLevel)}),e?.isEscalation&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(X,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-warning)"},children:"Escalation"})]}),a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-primary)"},children:e?.warningCount||0}),a.jsx("span",{children:"total"})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-success)"},children:"Analyzed"})]})]}),a.jsx("div",{className:"mt-2 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:Be(e?.reason,"Progressive discipline policy requires escalation based on employee history.")})})]})]}),u&&a.jsx(i,{padding:"sm",className:"border",style:{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)"},children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(G,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Analysis Summary"})]}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:Be(e?.explanation||e?.reason,"Progressive discipline assessment completed based on employee warning history and incident severity.")})]}),e?.legalRequirements&&e.legalRequirements.length>0&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Y,{className:"w-3 h-3",style:{color:"var(--color-info)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-alert-info-text)"},children:"Legal Compliance"})]}),a.jsxs("div",{className:"space-y-1",children:[e.legalRequirements.slice(0,2).map((e,s)=>a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full mt-1.5",style:{backgroundColor:"var(--color-info)"}}),a.jsx("span",{className:"text-xs leading-relaxed",style:{color:"var(--color-alert-info-text)"},children:e})]},s)),e.legalRequirements.length>2&&a.jsxs("p",{className:"text-xs ml-3.5",style:{color:"var(--color-info)"},children:["+ ",e.legalRequirements.length-2," more requirements"]})]})]}),a.jsxs("div",{className:"rounded-lg p-2 border",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-card-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx(V,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsx("h4",{className:"font-medium text-xs",style:{color:"var(--color-text)"},children:"Warning History"})]}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Employee has ",a.jsx("strong",{children:e?.warningCount||0})," active warning record.",e?.activeWarnings&&e.activeWarnings.length>0&&a.jsxs("span",{className:"ml-1",children:["Most recent warning was issued ",a.jsx("strong",{children:"0 days ago"}),"."]})]})]})]})}),a.jsx(He,{employeeName:`${N.firstName} ${N.lastName}`,managerName:n,incidentDescription:o.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:e?.level||"disciplinary",onScriptRead:()=>x(!0),disabled:g}),v&&a.jsxs(i,{padding:"sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text)"},children:"Signatures"})]}),a.jsx("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:a.jsx("span",{children:j?"Complete":"Pending"})})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[a.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(O,{className:"w-3.5 h-3.5",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Manager"}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:n})]}),f.manager&&a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),a.jsx(Ue,{onSignatureComplete:k,disabled:d,label:"Manager Signature",placeholder:"Manager signature",initialSignature:f.manager,width:300,height:80})]}),a.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(O,{className:"w-3.5 h-3.5",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text)"},children:"Employee"}),a.jsxs("span",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:[N.firstName," ",N.lastName]})]}),f.employee&&a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}})]}),a.jsx(Ue,{onSignatureComplete:C,disabled:d,label:"Employee Signature",placeholder:"Employee signature",initialSignature:f.employee,width:300,height:80})]})]}),j&&!d&&a.jsxs("div",{className:"mt-3 p-2 rounded-lg flex items-center justify-between",style:{backgroundColor:"var(--color-alert-success-bg)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Ready to finalize"})]}),a.jsxs(r,{onClick:S,size:"sm",className:"px-3 py-1.5",children:[a.jsx(ue,{className:"w-3 h-3 mr-1"}),"Finalize"]})]}),d&&a.jsxs("div",{className:"mt-3 p-2 rounded-lg flex items-center gap-2",style:{backgroundColor:"var(--color-alert-info-bg)"},children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-info)"}}),a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"font-medium",style:{color:"var(--color-alert-info-text)"},children:"Finalized"}),f.timestamp&&a.jsx("span",{className:"ml-2",style:{color:"var(--color-alert-info-text)"},children:new Date(f.timestamp).toLocaleDateString()})]})]})]})]})};class Ge{static async createDeliveryNotification(a){try{const s=this.determinePriority(a.warningLevel),t=this.prepareContactDetails(a),i={organizationId:a.organizationId,warningId:a.warningId,employeeId:a.employeeId,employeeName:a.employeeName,employeeEmail:a.employeeEmail,employeePhone:a.employeePhone,warningLevel:a.warningLevel,warningCategory:a.warningCategory,incidentDate:a.incidentDate,deliveryMethod:a.deliveryMethod,deliveryPreference:a.isEmployeePreference?"employee_choice":"manager_choice",contactDetails:t,status:"pending",priority:s,deliveryAttempts:0,createdAt:I(),updatedAt:I(),createdBy:a.createdBy,createdByName:a.createdByName},r=await E(R(d,"organizations",a.organizationId,"deliveryNotifications"),i);return e.success(3842),await this.createSystemNotification(a,r.id),r.id}catch(s){throw e.error("❌ Failed to create delivery notification:",s),s}}static async updateDeliveryStatus(a,s,t,i){try{const e={status:s,updatedAt:I()};"delivered"===s&&(e.deliveryDate=I(),e.deliveredBy=i),t&&(e.deliveryNotes=t)}catch(r){throw e.error("❌ Failed to update delivery status:",r),r}}static determinePriority(e){switch(e.toLowerCase()){case"dismissal":case"suspension":return"urgent";case"final_written":case"final written warning":return"high";default:return"normal"}}static prepareContactDetails(e){const a={};switch(e.deliveryMethod){case"email":e.employeeEmail&&(a.email=e.employeeEmail);break;case"whatsapp":e.employeePhone&&(a.phone=e.employeePhone);break;case"printed":a.address="To be confirmed by HR"}return a}static async createSystemNotification(a,s){try{const{QuickNotifications:e}=await Le(async()=>{const{QuickNotifications:e}=await import("./NotificationDeliveryService-D_ogWXxo.js");return{QuickNotifications:e}},__vite__mapDeps([0,1,2,3,4,5]));await e.warningNeedsDelivery(a.organizationId,a.employeeName,a.warningLevel,this.getDeliveryMethodName(a.deliveryMethod))}catch(t){e.error("❌ Failed to create system notification:",t)}}static generateNotificationMessage(e){const a=this.getDeliveryMethodName(e.deliveryMethod),s=e.isEmployeePreference?" (employee's preferred method)":" (selected by manager)";return`Warning issued to ${e.employeeName} requires delivery via ${a}${s}. Warning level: ${e.warningLevel}.`}static getDeliveryMethodName(e){switch(e){case"email":return"Email";case"whatsapp":return"WhatsApp";case"printed":return"Print & Hand Delivery";default:return e}}}class Ke{static getDeliveryInstructions(e){switch(e){case"email":return{title:"Email Delivery Instructions",steps:["Download the warning PDF from the system","Compose professional email with warning attached","Send to employee's work email address","Request read receipt if supported","Follow up if no acknowledgment within 2 business days"],requirements:["Valid email address on file","PDF warning document","Professional email template"],documentation:["Screenshot of sent email","Read receipt (if available)","Employee acknowledgment response"]};case"whatsapp":return{title:"WhatsApp Business Delivery Instructions",steps:["Verify employee's WhatsApp Business number","Send professional message introducing the warning","Share warning PDF as document attachment","Request confirmation of receipt","Document the conversation for records"],requirements:["WhatsApp Business account","Employee's valid phone number","Professional communication standards"],documentation:["Screenshot of conversation","Delivery receipt confirmation","Employee read/response confirmation"]};case"printed":return{title:"Print & Hand Delivery Instructions",steps:["Print warning document on company letterhead","Prepare delivery receipt form","Locate employee at their workstation/department","Hand deliver in presence of witness (if possible)","Obtain signed receipt of delivery","Scan and upload proof of delivery"],requirements:["Printed warning document","Delivery receipt form","Employee location/schedule","Witness (recommended)"],documentation:["Signed delivery receipt","Photo of handed document (if permitted)","Witness statement (if applicable)","Date, time, and location of delivery"]};default:return{title:"General Delivery Instructions",steps:["Contact IT support for delivery method guidance"],requirements:["Valid employee contact information"],documentation:["Proof of delivery attempt"]}}}}const Ye=({selectedEmployee:s,formData:o,lraRecommendation:n,signatures:l,organizationName:d,currentManagerName:h,audioRecording:g,onComplete:x,onWarningCreated:p,warningId:y})=>{const{user:v}=m(),{organization:b}=u(),[f,w]=D.useState("email"),[N,j]=D.useState(!1),[k,C]=D.useState(!1),[S,z]=D.useState(!1),[_,I]=D.useState(null),[E,R]=D.useState(!1),[T,L]=D.useState(null),[A,M]=D.useState(!1),[q,$]=D.useState(null),[P,F]=D.useState(!1),U=[{id:"email",name:"Email Delivery",icon:he,description:"HR will deliver via email with read receipt tracking",available:!!s?.email},{id:"whatsapp",name:"WhatsApp Business",icon:ge,description:"HR will deliver via WhatsApp Business with confirmation",available:!!s?.phone},{id:"printed",name:"Print & Hand Deliver",icon:xe,description:"HR will print and hand deliver with signed receipt",available:!0}],O=D.useCallback(async()=>{try{j(!0)}catch(a){e.error("❌ Error opening PDF preview:",a),I("Failed to generate PDF preview")}},[]),W=D.useCallback(async(a,t)=>{if(s&&b&&v&&y)try{C(!0),I(null);try{M(!0);const a=await Ge.createDeliveryNotification({warningId:y,organizationId:b.id,employeeId:s.id,employeeName:`${s.firstName} ${s.lastName}`,employeeEmail:s.email,employeePhone:s.phone,warningLevel:n?.suggestedLevel||o.level||"counselling",warningCategory:n?.category||o.category||"General",incidentDate:o.incidentDate,deliveryMethod:f,isEmployeePreference:s?.deliveryPreference===f,createdBy:v.id,createdByName:h});$(a),e.success(9578),R(!0)}catch(i){e.error("❌ Failed to create delivery notification:",i),I(i.message||"Failed to notify HR about delivery")}finally{M(!1)}e.success(10016)}catch(r){e.error("❌ Error creating HR notification:",r),I(r.message||"Failed to create HR notification")}finally{C(!1)}else I("Missing required data for HR notification")},[s,b,v,y,f,n,o,h]),H=D.useCallback(async()=>W(),[W]),B=D.useMemo(()=>!(!y||!f||k||q),[y,f,k,q]);return U.find(e=>e.id===f),E?a.jsx(i,{padding:"xl",className:"max-w-2xl mx-auto text-center",children:a.jsxs("div",{className:"mb-8",children:[a.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(ee,{className:"w-8 h-8 sm:w-10 sm:h-10",style:{color:"var(--color-success)"}})}),a.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-2",style:{color:"var(--color-text)"},children:"Warning Issued Successfully!"}),a.jsxs("p",{style:{color:"var(--color-text-secondary)"},children:["Warning ",T?`#${T.slice(-8)}`:""," has been created."]}),a.jsxs("p",{className:"font-medium mt-2",style:{color:"var(--color-primary)"},children:["📬 HR has been notified to deliver via ",f]}),g?.audioUrl&&!_&&a.jsx(c,{variant:"success",className:"mt-4 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(pe,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Audio recording saved successfully"})]})}),q&&a.jsxs(c,{variant:"info",className:"mt-4 text-center",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ue,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"HR Team Notified"})]}),a.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:["Delivery notification #",q.slice(-8)," created for HR team"]})]}),a.jsx("div",{className:"mt-6",children:a.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>F(!P),className:"text-sm font-medium underline min-h-[40px]",children:[P?"Hide":"View"," Delivery Instructions for HR"]})}),P&&a.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[a.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text)"},children:Ke.getDeliveryInstructions(f).title}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Steps to Follow:"}),a.jsx("ol",{className:"text-sm list-decimal list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Ke.getDeliveryInstructions(f).steps.map((e,s)=>a.jsx("li",{children:e},s))})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Requirements:"}),a.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Ke.getDeliveryInstructions(f).requirements.map((e,s)=>a.jsx("li",{children:e},s))})]}),a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium mb-1",style:{color:"var(--color-text)"},children:"Documentation Needed:"}),a.jsx("ul",{className:"text-sm list-disc list-inside space-y-1",style:{color:"var(--color-text-secondary)"},children:Ke.getDeliveryInstructions(f).documentation.map((e,s)=>a.jsx("li",{children:e},s))})]})]})]}),_&&a.jsxs("div",{className:"mt-4 p-3 rounded-lg border",style:{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center justify-center gap-2",style:{color:"var(--color-alert-warning-text)"},children:[a.jsx(J,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Warning created, but audio upload had issues"})]}),a.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-alert-warning-text)"},children:_})]})]})}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"mb-4",children:a.jsx("h2",{className:"text-lg font-semibold mb-1",style:{color:"var(--color-text)"},children:"Delivery & Completion"})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Warning Summary"}),a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Employee: ",s?.firstName," ",s?.lastName]})]})]}),a.jsx(i,{padding:"sm",hover:!0,className:"border-l-4",style:{borderLeftColor:"var(--color-success)"},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(t,{variant:"success",size:"sm",className:"font-semibold",children:n?.recommendedLevel||"Counselling Session"}),a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:"var(--color-success)"}}),a.jsxs("span",{className:"font-medium",style:{color:"var(--color-success)"},children:["#",y?.slice(-8)," created"]}),g?.audioUrl&&a.jsx("span",{children:"• Audio included"})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-success)"},children:"Ready"})]})]})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ue,{className:"w-4 h-4",style:{color:"var(--color-success)"}}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Delivery Method"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Choose how HR will deliver this warning"})]})]}),a.jsx("div",{className:"grid grid-cols-1 gap-2",children:U.map(e=>{const s=e.icon;return a.jsx(i,{padding:"sm",hover:e.available,className:"cursor-pointer transition-all border-l-4 "+(e.available?"":"opacity-50 cursor-not-allowed"),style:{borderLeftColor:f===e.id?"var(--color-primary)":"transparent",backgroundColor:f===e.id?"var(--color-alert-info-bg)":"transparent"},onClick:()=>e.available&&w(e.id),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(s,{className:"w-4 h-4",style:{color:"var(--color-text)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),!e.available&&"whatsapp"===e.id&&a.jsx("p",{className:"text-xs mt-0.5",style:{color:"var(--color-error)"},children:"No phone number available"})]})]}),f===e.id&&a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-primary)"},children:"Selected"})]}),a.jsx("input",{type:"radio",name:"deliveryMethod",value:e.id,checked:f===e.id,onChange:()=>{},disabled:!e.available,className:"sr-only"})]})},e.id)})})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ye,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Final Review"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Preview document and complete delivery process"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[a.jsx(i,{padding:"sm",hover:!0,className:"cursor-pointer border-l-4",style:{borderLeftColor:"var(--color-secondary)"},onClick:O,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(ye,{className:"w-4 h-4",style:{color:"var(--color-secondary)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"Preview Document"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Review warning before sending to HR"})]})]}),a.jsx(ve,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}})]})}),a.jsx(i,{padding:"sm",hover:!k&&B,className:`transition-all border-l-4 ${B&&!q?"cursor-pointer":""} ${B||q?"":"opacity-50"}`,style:{borderLeftColor:q?"var(--color-success)":B?"var(--color-primary)":"var(--color-border)",backgroundColor:q?"var(--color-alert-success-bg)":"transparent"},onClick:!k&&B?H:void 0,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[k?a.jsx(me,{className:"w-4 h-4 animate-spin",style:{color:"var(--color-primary)"}}):q?a.jsx(ee,{className:"w-4 h-4",style:{color:"var(--color-success)"}}):a.jsx(ue,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:k?"Notifying HR...":q?"HR Notified":"Notify HR"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:q?`Delivery notification sent via ${f}`:"Send delivery instructions to HR team"})]})]}),!q&&B&&!k&&a.jsx(ve,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}})]})})]})]}),_&&a.jsx(c,{variant:"error",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(J,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-error)"}}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",children:"Error"}),a.jsx("p",{className:"text-xs mt-1",children:_})]})]})}),S&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(me,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Uploading audio..."})]})}),A&&a.jsx(c,{variant:"info",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(me,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{className:"text-sm",children:"Notifying HR..."})]})}),N&&a.jsx(Te,{isOpen:N,onClose:()=>j(!1),warningData:{selectedEmployee:s,formData:o,lraRecommendation:n,signatures:l,deliveryChoice:{method:f,timestamp:new Date,chosenBy:h},organizationName:d,currentManagerName:h,employee:s,organization:b},onPDFGenerated:(e,a)=>{},isCompleted:!1})]})},Xe=({size:e="medium",color:s="#3b82f6"})=>{const t={small:"1.5rem",medium:"3rem",large:"5rem"};return a.jsx("div",{style:{width:t[e],height:t[e],border:"4px solid #e2e8f0",borderTop:`4px solid ${s}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})};if("undefined"!=typeof document){const e=document.createElement("style");e.innerHTML="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n\n  @keyframes shimmer {\n    0% { background-position: -1000px 0; }\n    100% { background-position: 1000px 0; }\n  }\n\n  .skeleton-card {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .skeleton-line {\n    height: 1rem;\n    margin-bottom: 0.5rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n  }\n\n  .skeleton-header {\n    height: 1.5rem;\n    margin-bottom: 1rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n    width: 40%;\n  }\n\n  .skeleton-circle {\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 50%;\n  }\n\n  .skeleton-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n",document.head.appendChild(e)}const Je={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},Ze=({onPermissionGranted:s,onPermissionDenied:t,organizationName:i,managerName:r})=>{const[o,n]=D.useState("requesting"),[l,c]=D.useState("");D.useRef(Math.random().toString(36).substr(2,9)),D.useEffect(()=>(Je.callbacks.push(s),Je.errorCallbacks.push(t),Je.isGranted?(n("granted"),void setTimeout(s,100)):(Je.isRequesting||(Je.isRequesting=!0,d()),()=>{const e=Je.callbacks.indexOf(s);e>-1&&Je.callbacks.splice(e,1);const a=Je.errorCallbacks.indexOf(t);a>-1&&Je.errorCallbacks.splice(a,1)})),[]);const d=async()=>{try{if(n("requesting"),c(""),!navigator.mediaDevices?.getUserMedia)return n("not-supported"),void c("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(e=>e.stop()),n("granted"),Je.isGranted||(Je.isGranted=!0,Je.isRequesting=!1,Je.callbacks.forEach(e=>{setTimeout(e,1e3)}))}catch(a){e.error("Microphone permission error:",a),Je.isRequesting=!1,"NotAllowedError"===a.name?(n("denied"),c("Microphone access was denied. Please allow microphone access and try again.")):"NotFoundError"===a.name?(n("error"),c("No microphone was found on your device.")):"NotReadableError"===a.name?(n("error"),c("Your microphone is being used by another application.")):(n("error"),c("An error occurred while accessing your microphone.")),Je.errorCallbacks.forEach(e=>{e()})}},m=(()=>{switch(o){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:l};case"not-supported":return{title:"Browser Not Supported",message:l};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"max-w-sm w-full",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:(()=>{switch(o){case"requesting":return a.jsx(Xe,{size:"medium",color:"#3b82f6"});case"granted":return a.jsx(Xe,{size:"medium",color:"#16a34a"});case"denied":return a.jsx(be,{className:"w-6 h-6 text-red-600"});case"error":return a.jsx(fe,{className:"w-6 h-6 text-red-600"});case"not-supported":return a.jsx(be,{className:"w-6 h-6 text-gray-600"});default:return a.jsx(pe,{className:"w-6 h-6 text-gray-600"})}})()}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m.title}),a.jsx("p",{className:"text-sm text-gray-600",children:m.message})]}),("denied"===o||"error"===o)&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"}),a.jsx("div",{className:"text-xs text-gray-500",children:a.jsx("p",{children:'Look for the microphone icon in your browser\'s address bar and click "Allow"'})})]})]}),a.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:a.jsx("p",{children:i})})]})})},Qe="audio/webm;codecs=opus",ea=16e3,aa=8e3,sa=1,ta=3e5,ia=819200,ra=24e4,oa=!0,na=!0,la=!0;class ca{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return ca.instance||(ca.instance=new ca),ca.instance}canStart(){const e=Date.now();return!this.isRecording&&!this.isStarting&&(!(this.startedAt>0&&e-this.startedAt<1e3)&&(!(this.allActiveStreams.size>0||this.allActiveTracks.size>0)||(this.allActiveStreams.size,this.allActiveTracks.size,!1)))}tryReserve(){return!!this.canStart()&&(this.isStarting=!0,this.startedAt=Date.now(),!0)}startRecording(){this.isRecording=!0}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{try{e.stop()}catch(a){}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null)}setStream(e){return this.mediaStream||this.allActiveStreams.size>0?(this.allActiveStreams.size,e.getTracks().forEach(e=>e.stop()),!1):(this.allActiveStreams.add(e),e.getTracks().forEach(e=>{this.allActiveTracks.add(e),e.addEventListener("ended",()=>{this.allActiveTracks.delete(e)})}),this.mediaStream=e,this.isStarting=!1,this.allActiveStreams.size,!0)}stopAllStreams(){this.allActiveStreams.size,this.allActiveTracks.size,this.allActiveStreams.forEach(e=>{e.getTracks().forEach(e=>{try{e.stop()}catch(a){}})}),this.allActiveTracks.forEach(e=>{try{"live"===e.readyState&&e.stop()}catch(a){}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0}}const da=ca.getInstance(),ma=z.memo(({employees:s,categories:t,currentManagerName:i,organizationName:r,onComplete:o,onCancel:n,preSelectedEmployeeId:l,preSelectedCategoryId:c,isFullScreen:p})=>{D.useRef(Math.random().toString(36).substr(2,9));const{user:y}=m(),{organization:v}=u(),b=(()=>{const[a,s]=D.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),t=D.useRef(null),i=D.useRef([]),r=D.useRef(null),o=D.useRef(0),n=D.useRef(null),l=D.useRef(!1),c=D.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),d=D.useCallback(e=>e<1024?`${e}B`:e<1048576?`${(e/1024).toFixed(1)}KB`:`${(e/1048576).toFixed(1)}MB`,[]),m=D.useCallback(()=>`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),u=D.useCallback(()=>{if(!o.current)return;if(!a.isRecording)return void(n.current&&(clearInterval(n.current),n.current=null));const e=(Date.now()-o.current)/1e3,i=Date.now()-o.current;if(s(a=>a.isRecording?{...a,duration:e}:a),i>=ta)return n.current&&(clearInterval(n.current),n.current=null),void setTimeout(()=>{t.current&&"recording"===t.current.state&&t.current.stop()},0);i>=ra&&!l.current&&(l.current=!0)},[]),g=D.useCallback(()=>{try{if(t.current){try{"recording"===t.current.state&&t.current.stop()}catch(a){}t.current=null}[r.current,da.mediaStream].filter(Boolean).forEach(e=>{e&&e.getTracks().forEach(e=>{try{e.stop()}catch(a){}})}),r.current=null,da.stopAllStreams(),n.current&&(clearInterval(n.current),n.current=null),i.current=[],l.current=!1,o.current=0,s({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(a){e.error("❌ Error during force cleanup:",a)}},[]),x=D.useCallback(async()=>{if(da.tryReserve())try{if((r.current||t.current||da.mediaStream)&&(g(),await new Promise(e=>setTimeout(e,100))),s(e=>({...e,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:sa,sampleRate:aa,echoCancellation:oa,noiseSuppression:na,autoGainControl:la}});if(!da.setStream(e))return void s(e=>({...e,isProcessing:!1,error:"Another recording is already active"}));r.current=e,i.current=[];const a=new MediaRecorder(e,{mimeType:Qe,audioBitsPerSecond:ea});t.current=a,a.ondataavailable=e=>{if(e.data.size>0){i.current.push(e.data);const a=i.current.reduce((e,a)=>e+a.size,0);s(e=>({...e,size:a})),a>=ia&&p()}},a.onstop=()=>{r.current&&(r.current.getTracks().forEach(e=>e.stop()),r.current=null)},a.start(1e3),o.current=Date.now(),l.current=!1,da.startRecording(),n.current=setInterval(u,100);const c=m();s(e=>({...e,isRecording:!0,isProcessing:!1,recordingId:c,duration:0,size:0}))}catch(a){e.error("❌ Error starting recording:",a),da.stopRecording(),s(e=>({...e,isRecording:!1,isProcessing:!1,error:a.message||"Failed to start recording"}))}},[u,m]),p=D.useCallback(async()=>{try{return t.current&&a.isRecording?(s(e=>({...e,isProcessing:!0})),n.current&&(clearInterval(n.current),n.current=null),new Promise(a=>{const r=t.current;r.onstop=()=>{try{const e=new Blob(i.current,{type:Qe}),t=URL.createObjectURL(e);s(a=>({...a,isRecording:!1,isProcessing:!1,audioUrl:t,size:e.size})),d(e.size),a(t)}catch(t){e.error("❌ Error processing recording:",t),s(e=>({...e,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),a(null)}},r.stop(),s(e=>({...e,isRecording:!1}))})):null}catch(r){return e.error("❌ Error stopping recording:",r),s(e=>({...e,isRecording:!1,isProcessing:!1,error:r.message||"Failed to stop recording"})),null}},[a.isRecording,d]),y=D.useCallback(()=>{t.current&&a.isRecording&&(t.current.pause(),n.current&&(clearInterval(n.current),n.current=null))},[a.isRecording]),v=D.useCallback(()=>{t.current&&a.isRecording&&(t.current.resume(),o.current=Date.now()-1e3*a.duration,n.current=setInterval(u,100))},[a.isRecording,a.duration,u]),b=D.useCallback(()=>{try{t.current&&t.current.stop(),r.current&&(r.current.getTracks().forEach(e=>e.stop()),r.current=null),n.current&&(clearInterval(n.current),n.current=null),a.audioUrl&&URL.revokeObjectURL(a.audioUrl),i.current=[],l.current=!1,s({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(o){e.error("❌ Error cancelling recording:",o)}},[a.audioUrl]),f=D.useCallback(async(t,i)=>{try{if(!a.audioUrl||!a.recordingId)throw new Error("No recording available to upload");s(e=>({...e,isProcessing:!0}));const r=await fetch(a.audioUrl),o=await r.blob(),n=`warnings/${t}/${i}/audio/${a.recordingId}.webm`,l=T(h,n),c={contentType:Qe,customMetadata:{warningId:i,organizationId:t,duration:a.duration.toString(),size:a.size.toString(),recordingId:a.recordingId,createdAt:(new Date).toISOString()}};await L(l,o,c);const d=await A(l);return s(e=>({...e,isProcessing:!1})),e.success(13735),d}catch(r){return e.error("❌ Error uploading audio:",r),s(e=>({...e,isProcessing:!1,error:r.message||"Failed to upload audio"})),null}},[a.audioUrl,a.recordingId,a.duration,a.size]),w=D.useCallback(async(t,i,r,o)=>{try{if(!t||!i)throw new Error("No recording data provided for upload");s(e=>({...e,isProcessing:!0}));const n=await fetch(t),l=await n.blob(),c=T(h,`warnings/${r}/${o}/audio/${i}.webm`),d={contentType:Qe,customMetadata:{warningId:o,organizationId:r,duration:a.duration.toString(),size:l.size.toString(),recordingId:i,createdAt:(new Date).toISOString()}};await L(c,l,d);const m=await A(c);return s(e=>({...e,isProcessing:!1})),e.success(15712),m}catch(n){return e.error("❌ Error uploading audio from URL:",n),s(e=>({...e,isProcessing:!1,error:n.message||"Failed to upload audio"})),null}},[a.duration]);D.useEffect(()=>()=>{if(n.current&&(clearInterval(n.current),n.current=null),r.current&&(r.current.getTracks().forEach(e=>{e.stop()}),r.current=null),t.current){try{"recording"===t.current.state&&t.current.stop()}catch(e){}t.current=null}i.current=[],l.current=!1,o.current=0,da.stopAllStreams()},[]);const N=a.duration>=ra/1e3,j=!a.isRecording&&!a.isProcessing;return{...a,startRecording:x,stopRecording:p,pauseRecording:y,resumeRecording:v,cancelRecording:b,forceCleanup:g,uploadToFirebase:f,uploadToFirebaseFromUrl:w,formatDuration:c,formatSize:d,isNearLimit:N,canRecord:j}})(),f=D.useCallback(async()=>{C(!0),z(!1)},[]),w=D.useCallback(()=>{C(!1)},[]);D.useEffect(()=>{const e=e=>{if("undefined"!=typeof window)if(e){const e=window.scrollY;document.documentElement.style.setProperty("--scroll-y",`-${e}px`),document.body.classList.add("modal-open")}else{document.body.classList.remove("modal-open");const e=document.documentElement.style.getPropertyValue("--scroll-y");document.documentElement.style.removeProperty("--scroll-y"),e&&window.scrollTo(0,-1*parseInt(e.replace("px","")))}};return e(!0),()=>e(!1)},[]);const[N,j]=D.useState(0),[k,C]=D.useState(!1),[S,z]=D.useState(!0),[_,I]=D.useState(new Set),[E,R]=D.useState(!1),[$,P]=D.useState(!1),[F]=D.useState(()=>g()),[U,O]=D.useState({employeeId:l||null,categoryId:c||null,incidentDate:(new Date).toISOString().split("T")[0],incidentTime:(new Date).toTimeString().split(" ")[0].substring(0,5),incidentLocation:"",incidentDescription:"",additionalNotes:"",issueDate:(new Date).toISOString().split("T")[0],validityPeriod:6}),[W,B]=D.useState(!1),[V,G]=D.useState([]),[K,X]=D.useState(null),[J,Q]=D.useState(null),[ee,ae]=D.useState(!1),[se,te]=D.useState(null),[ie,ne]=D.useState({manager:null,employee:null}),[le,ce]=D.useState(!1),de=(({sessionId:e,stepName:a,autoStart:s=!0,enableRealTimeValidation:t=!0})=>{const[i,r]=D.useState(e||""),[o,n]=D.useState([]),[l,c]=D.useState([]),[d,m]=D.useState(null),u=D.useRef(!1),h=D.useRef(!1);D.useEffect(()=>{if(!s||u.current||e)e&&(r(e),u.current=!0);else{const e=Me.startWizardSession();r(e),u.current=!0}},[s,e]),D.useEffect(()=>{if(!i)return;const e=()=>{const e=Me.getSessionLogs(i),a=Me.getSessionIssues(i),s=Me.getSessionSummary(i);n(e),c(a),m(s)};e();const a=a=>{(a.metadata?.sessionId===i||o.some(e=>e.id===a.id))&&e()};Me.addListener(a);const s=setInterval(e,2e3);return()=>{Me.removeListener(a),clearInterval(s)}},[i]);const g=D.useCallback(()=>{if(!u.current){const e=Me.startWizardSession();return r(e),u.current=!0,e}return i},[i]),x=D.useCallback(e=>{i&&(h.current&&(Me.exitStep(i,a,void 0,"completed"===e),h.current=!1),Me.endWizardSession(i,e),u.current=!1)},[i,a]),p=D.useCallback(e=>{i&&!h.current&&(Me.enterStep(i,a,e),h.current=!0)},[i,a]),y=D.useCallback((e,s=!0)=>{i&&h.current&&(Me.exitStep(i,a,e,s),h.current=!1)},[i,a]),v=D.useCallback((e,s,t)=>{i&&Me.trackDataChange(i,a,e,s,t)},[i,a]),b=D.useCallback(e=>{i&&Me.trackFormSubmission(i,a,e)},[i,a]),f=D.useCallback((e,s,t,r)=>{i&&Me.trackAPICall(i,a,e,s,t,r)},[i,a]),w=D.useCallback((e,s)=>{i&&Me.trackError(i,a,e,s)},[i,a]),N=D.useCallback((e,s)=>{i&&Me.trackSuccess(i,a,e,s)},[i,a]),j=D.useCallback((e,s)=>{i&&Me.trackWarning(i,a,e,s)},[i,a]),k=D.useCallback(e=>i&&t&&Me.validateStepData?.(i,a,e,"MANUAL_VALIDATION")||{isValid:!0,errors:[],warnings:[],missingFields:[],undefinedFields:[]},[i,a,t]),C=D.useCallback(()=>i?Me.exportSessionData(i):"",[i]);return D.useEffect(()=>{i&&s&&!h.current&&p()},[i,s,p]),D.useEffect(()=>()=>{i&&h.current&&y(void 0,!1)},[i,y]),{sessionId:i,startSession:g,endSession:x,enterStep:p,exitStep:y,trackChange:v,trackFormSubmit:b,trackAPI:f,trackError:w,trackSuccess:N,trackWarning:j,validateData:k,logs:o,issues:l,summary:d,exportSession:C}})({stepName:`STEP_${N||1}`,autoStart:!0,enableRealTimeValidation:!1}),me=D.useRef(0);D.useRef(U),D.useRef(new Set);const he=D.useRef(!1),ge=D.useMemo(()=>s.find(e=>e.id===U.employeeId),[s,U.employeeId]),xe=D.useMemo(()=>t.find(e=>e.id===U.categoryId),[t,U.categoryId]),pe=D.useMemo(()=>v?.id,[v?.id]);D.useCallback(()=>{N>0&&!ee&&j(N-1)},[N,ee]),D.useCallback(()=>{N<3&&!ee&&j(N+1)},[N,ee]),D.useEffect(()=>{const e=document.querySelector(".modal-content__scrollable");e&&(e.scrollTop,e.scrollTo({top:0,behavior:"smooth"}),setTimeout(()=>{e.scrollTop>0&&(e.scrollTop=0)},300))},[N]),D.useEffect(()=>{me.current!==N&&(de.trackSuccess("STEP_CHANGED",{from:me.current,to:N,stepName:0===N?"Incident Details":1===N?"Legal Review":"Delivery Completion"}),me.current=N)},[N,de]),b.isRecording;const ye=D.useCallback(async e=>{if(e&&pe){de.trackAPI("loadWarningHistory",{employeeId:e,organizationId:pe}),B(!0);try{const a=await x.warnings.getAll(pe,{employeeId:e});G(a),de.trackAPI("loadWarningHistory",{employeeId:e,organizationId:pe},{count:a.length})}catch(a){de.trackError(a,{employeeId:e,organizationId:pe}),G([])}finally{B(!1)}}},[pe,de]),ve=D.useRef(null);D.useEffect(()=>{ge&&!W&&ve.current!==ge.id&&(ve.current=ge.id,ye(ge.id))},[ge?.id,W,ye]);const be=D.useCallback(async(e,a)=>{if(!(e&&a&&pe&&U.incidentDescription)){const s={employeeId:!!e,categoryId:!!a,organizationId:!!pe,incidentDescription:!!U.incidentDescription};return void de.trackError(new Error("Cannot generate LRA - missing data"),s)}R(!0),de.trackAPI("generateLRARecommendation",{employeeId:e,categoryId:a});try{const s=await x.warnings.getEscalationRecommendation(e,a,v?.id||"default");X(s),de.trackAPI("generateLRARecommendation",{employeeId:e,categoryId:a},s)}catch(s){de.trackError(s,{employeeId:e,categoryId:a,formData:U});const t=xe?.escalationPath||["counselling","verbal","first_written","final_written"],i={suggestedLevel:t[0]||"counselling",recommendedLevel:"counselling"===t[0]?"Counselling Session":"verbal"===t[0]?"Verbal Warning":"first_written"===t[0]?"First Written Warning":"Counselling Session",reason:"Fallback recommendation due to analysis error. Manual review required.",activeWarnings:[],escalationPath:t,isEscalation:!1,category:xe?.name||"General Misconduct",categoryId:a,legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure procedural fairness","Document thoroughly"],warningCount:0,nextExpiryDate:null,examples:["Review case manually","Consult HR if needed"],explanation:"Unable to analyze history - system error occurred",previousWarnings:[],confidence:60};X(i),de.trackWarning("Using fallback LRA recommendation",i)}finally{R(!1)}},[pe,U.incidentDescription,xe,de]),fe=D.useCallback(e=>{const a=["employeeId","categoryId","incidentLocation"];Object.keys(e).some(s=>a.includes(s)&&e[s]!==U[s])&&de.trackSuccess("SIGNIFICANT_FORM_UPDATE",e),O(a=>({...a,...e}))},[U,de]),Ne=D.useCallback(()=>{de.trackSuccess("WIZARD_COMPLETED",{sessionDuration:Date.now()-new Date(de.summary?.startTime||Date.now()).getTime(),totalSteps:_.size,totalIssues:de.issues.length,finalWarningId:J}),de.endSession("completed"),o()},[o,de,_.size,J]),je=D.useCallback(()=>{de.trackWarning("WIZARD_CANCELLED",{currentStep:N,completedSteps:Array.from(_)}),b.forceCleanup(),document.body.classList.remove("modal-open"),de.endSession("cancelled"),n()},[n,de,N,_,b]);D.useEffect(()=>{if(he.current||!k||b.isRecording||b.audioUrl)return;return(async()=>{try{he.current=!0,await b.startRecording(),de.trackSuccess("AUDIO_RECORDING_STARTED",{duration:b.duration,size:b.size})}catch(e){de.trackError(e,{context:"AUDIO_RECORDING_START"}),he.current=!1}})(),()=>{he.current=!1}},[k]),D.useEffect(()=>{se&&!E&&K&&(de.trackSuccess("LRA_ANALYSIS_COMPLETE_PROCEEDING",{pendingStep:se,hasRecommendation:!!K}),j(se),te(null),ae(!1))},[se,E,K,de]);const ke=D.useCallback(async()=>{if(de.trackSuccess("NEXT_STEP_REQUESTED",{currentStep:N,hasLRA:!!K}),N>=2)return;const e=N+1;if(I(e=>new Set([...e,N])),0===N&&1===e)return U.employeeId&&U.categoryId&&U.incidentDescription?K&&!E?(de.trackSuccess("PROCEEDING_TO_STEP_2",{hasLRA:!0}),void j(e)):(de.trackSuccess("TRIGGERING_LRA_GENERATION",U),ae(!0),te(e),void(await be(U.employeeId,U.categoryId))):void de.trackError(new Error("Missing required data for step 2"),{employeeId:!!U.employeeId,categoryId:!!U.categoryId,incidentDescription:!!U.incidentDescription});de.trackSuccess("STEP_NAVIGATION_COMPLETE",{from:N,to:e}),j(e)},[N,U.employeeId,U.categoryId,U.incidentDescription,K,E,be,de]),Ce=D.useCallback(()=>{N>0&&(de.trackSuccess("PREVIOUS_STEP",{from:N,to:N-1}),j(N-1),ee&&(ae(!1),te(null),de.trackWarning("NAVIGATION_CANCELLED_BY_BACK",{currentStep:N})))},[N,ee,de]),Se=D.useCallback(async(a,s=!1)=>{if(de.trackSuccess("SIGNATURES_COMPLETED",{hasManager:!!a.manager,hasEmployee:!!a.employee,finalized:s,timestamp:a.timestamp}),ne(a),s){ce(!0);try{let s=null;if(b?.isRecording&&(de.trackSuccess("AUDIO_AUTO_STOP_BEFORE_SAVE",{duration:b.duration,size:b.size}),s=await b.stopRecording(),e.success(21068),s||e.warn("⚠️ Audio URL not returned from stopRecording. Will create warning with placeholder.")),!ge||!xe||!v)throw new Error("Missing required data for warning creation");const r={employeeId:ge.id,categoryId:xe.id,organizationId:v.id,employeeName:ge.profile?.firstName||"Unknown",employeeLastName:ge.profile?.lastName||"Employee",employeeNumber:ge.profile?.employeeNumber||"Unknown",employeeDepartment:ge.profile?.department||"Unknown",employeePosition:ge.profile?.position||"Unknown",categoryName:xe.name||"Unknown",level:K?.suggestedLevel||"counselling",incidentDate:U.incidentDate,incidentTime:U.incidentTime,incidentLocation:U.incidentLocation,incidentDescription:U.incidentDescription,additionalNotes:U.additionalNotes,issueDate:U.issueDate,validityPeriod:U.validityPeriod,signatures:a};s?(r.audioRecording={url:s,duration:b?.duration||0,size:b?.size||0,recordingId:b?.recordingId,uploadToFirebase:!0,status:"ready",processingStatus:"pending"},e.success(23340)):(e.error("❌ Audio recording is mandatory for all warnings"),de.trackError(new Error("Audio recording missing"),{warningData:U,audioState:{isRecording:b?.isRecording,hasDirectUrl:!!s,hasStateUrl:!!b?.audioUrl,duration:b?.duration}}),r.audioRecording={status:"missing",processingStatus:"required",error:"Audio recording is mandatory but was not captured",duration:b?.duration||0,size:b?.size||0,uploadToFirebase:!1,requiresAttention:!0});const o=await x.warnings.create(r);if(e.success(24554),Q(o),s&&b?.uploadToFirebaseFromUrl&&b?.recordingId&&o)try{const a=await b.uploadToFirebaseFromUrl(s,b.recordingId,v.id,o);if(a){e.success(25382);const s=M(d,"organizations",v.id,"warnings",o);await q(s,{"audioRecording.url":a,"audioRecording.storageePath":`warnings/${v.id}/${o}/audio/${b.recordingId}.webm`,"audioRecording.processingStatus":"complete","audioRecording.uploadedAt":new Date,updatedAt:new Date}),e.success(26224),de.trackSuccess("AUDIO_UPLOADED_AND_UPDATED",{warningId:o,firebaseUrl:a,duration:b.duration,size:b.size}),b.forceCleanup()}else e.warn("⚠️ Audio upload returned null URL"),de.trackWarning("AUDIO_UPLOAD_NULL_URL",{warningId:o})}catch(t){e.error("❌ Audio upload failed:",t),de.trackError(t,{context:"AUDIO_UPLOAD_STEP2",warningId:o,duration:b?.duration,size:b?.size});try{const e=M(d,"organizations",v.id,"warnings",o);await q(e,{"audioRecording.processingStatus":"failed","audioRecording.error":t.message||"Upload failed in Step 2","audioRecording.failedAt":new Date,updatedAt:new Date})}catch(i){e.error("❌ Failed to update warning with audio error:",i),de.trackError(i,{context:"AUDIO_ERROR_UPDATE"})}b.forceCleanup()}de.trackSuccess("WARNING_FULLY_CREATED_STEP2",{warningId:o})}catch(r){e.error("❌ Error creating warning:",r),de.trackError(r,{context:"WARNING_CREATION_ON_SIGNATURE_COMPLETE"})}I(e=>new Set([...e,N])),de.trackSuccess("SIGNATURES_FINALIZED_NEXT_ENABLED",{currentStep:N})}},[N,de,b,ge,xe,v,U,K,x]),De=D.useMemo(()=>({0:{title:"Incident Details",subtitle:"Step 1 of 3",description:"Select employee, choose violation category, and document the incident with all relevant details.",icon:Z},1:{title:"Review & Sign",subtitle:"Step 2 of 3",description:"Review escalation recommendation, read warning script, and collect required signatures.",icon:Y},2:{title:"Deliver & Complete",subtitle:"Step 3 of 3",description:"Choose delivery method, generate warning document, and complete the warning process.",icon:ue}}),[]),ze=D.useMemo(()=>{switch(N){case 0:return!!(U.employeeId&&U.categoryId&&U.incidentDate&&U.incidentTime&&U.incidentLocation&&U.incidentDescription&&U.incidentDescription.length>=20);case 1:return!!(K&&!E&&ie.manager&&ie.employee&&le);case 2:return!0;default:return!1}},[N,U,K,E,ie,le]),_e=D.useCallback(()=>{switch(N){case 0:return a.jsx(Fe,{employees:s,categories:t,formData:U,updateFormData:fe,selectedEmployee:ge,selectedCategory:xe,warningHistory:V,isLoadingWarningHistory:W,loadWarningHistory:ye,lraRecommendation:K,isAnalyzing:E});case 1:return a.jsx(Ve,{lraRecommendation:K,selectedEmployee:ge,formData:U,currentManagerName:i,onSignaturesComplete:Se,isAnalyzing:E,signaturesFinalized:le,currentSignatures:ie});case 2:return a.jsx(Ye,{selectedEmployee:ge,formData:U,lraRecommendation:K,signatures:ie,organizationName:r,currentManagerName:i,audioRecording:b,onComplete:Ne,onWarningCreated:Q,warningId:J});default:return a.jsxs("div",{className:"p-8 text-center text-red-600",children:["Unknown step: ",N]})}},[N,r,i,s,t,U,fe,ge,xe,V,W,ye,K,E,Se,ie,b,Ne]),Ie=2===N?{show:!1,disabled:!1,loading:!1,text:"Complete"}:0!==N||ze?0===N&&ze&&(ee||E)?{show:!0,disabled:!0,loading:!0,text:"Analyzing..."}:{show:!0,disabled:!ze,loading:!1,text:"Next"}:{show:!0,disabled:!0,loading:!1,text:"Next"};return D.useMemo(()=>({formData:U,signatures:ie,lraRecommendation:K,selectedEmployee:ge,selectedCategory:xe,organizationId:v?.id,currentStep:N,isStepValid:ze,isAnalyzing:E,warningHistory:V,finalWarningId:J}),[U,ie,K,ge,xe,v?.id,N,ze,E,V,J]),D.useEffect(()=>()=>{b.forceCleanup(),document.body.classList.remove("modal-open")},[]),S&&!k?a.jsx(Ze,{onPermissionGranted:f,onPermissionDenied:w,organizationName:r,managerName:i}):a.jsx("div",{className:`\n    modal-system\n    ${p?"modal-system--fullscreen":""}\n    ${F.isLegacyDevice?"legacy-device":""}\n    ${F.hasGoodPerformance?"perf-high":"perf-low"}\n    ${F.hasModernCSS?"css-modern":"css-legacy"}\n  `,children:a.jsxs("div",{className:`\n      modal-container\n      ${p?"modal-container--fullscreen":""}\n      ${F.browserInfo.isAndroid4x?"android-4x":""}\n      ${F.browserInfo.isIOS6to7?"ios-6-7":""}\n    `,children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Issue Warning"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document disciplinary action and intervention"})]})}),a.jsx("button",{onClick:je,className:"modal-header__close-button",title:"Cancel and close wizard",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"modal-header__center",children:[a.jsx("div",{className:"modal-header__progress-mobile md:hidden",children:a.jsxs("div",{className:"mobile-step-indicator",children:[a.jsxs("div",{className:"mobile-step-dots",children:[Object.entries(De).map(([e,s])=>{const t=parseInt(e),i=t===N,r=_.has(t);return a.jsx("div",{className:`mobile-step-dot ${i?"mobile-step-dot--active":""} ${r?"mobile-step-dot--completed":""} ${i||r?"":"mobile-step-dot--inactive"}`,title:s.title,children:r?a.jsx(oe,{className:"w-3 h-3"}):t+1},e)}),b.isRecording&&a.jsx("div",{className:"mobile-recording-indicator",children:a.jsx("div",{className:"mobile-recording-dot-pulse"})})]}),a.jsx("div",{className:"mobile-step-info",children:a.jsx("div",{className:"mobile-step-title",children:De[N]?.title||"Loading..."})})]})}),a.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Object.entries(De).map(([e,s])=>{const t=parseInt(e),i=t===N,r=_.has(t);return a.jsxs("div",{className:"step-container",children:[a.jsx("div",{className:`\n                step-dot\n                ${i?"step-dot--active":""}\n                ${r?"step-dot--completed":""}\n                ${i||r?"":"step-dot--inactive"}\n              `,title:s.title,children:r?a.jsx(oe,{className:"w-3 h-3"}):t+1}),t<Math.max(...Object.keys(De).map(Number))&&a.jsx("div",{className:`\n                step-connector\n                ${r?"step-connector--completed":"step-connector--inactive"}\n              `})]},e)})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:_e()})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsxs("button",{onClick:Ce,disabled:0===N||ee,className:`\n              modal-footer__button modal-footer__button--secondary\n              ${0===N||ee?"opacity-50":""}\n            `,children:[a.jsx(we,{className:"w-4 h-4"}),"Previous"]}),Ie.show&&a.jsx("button",{onClick:ke,disabled:Ie.disabled,className:`\n                modal-footer__button modal-footer__button--primary\n                ${Ie.loading?"modal-footer__button--loading":""}\n              `,children:!Ie.loading&&a.jsxs(a.Fragment,{children:[Ie.text,a.jsx(re,{className:"w-4 h-4"})]})})]})})]})})},(e,a)=>e.currentManagerName===a.currentManagerName&&e.organizationName===a.organizationName&&e.preSelectedEmployeeId===a.preSelectedEmployeeId&&e.preSelectedCategoryId===a.preSelectedCategoryId&&e.isFullScreen===a.isFullScreen&&(e.employees.length===a.employees.length&&e.categories.length===a.categories.length)),ua=Object.freeze(Object.defineProperty({__proto__:null,EnhancedWarningWizard:ma},Symbol.toStringTag,{value:"Module"})),ha=({onTextSubmit:e,onClose:s,employeeName:t="the employee"})=>{const[i,r]=D.useState("text"),[o,n]=D.useState(""),[l,c]=D.useState(""),d=D.useCallback(()=>{o.trim().length<10?alert("Please provide at least 10 characters of notes."):e(o.trim())},[o,e]),m=D.useCallback(()=>{l.trim().length<10?alert("Please provide at least 10 characters summarizing the phone discussion."):e(`Phone discussion with ${t}: ${l.trim()}`)},[l,e,t]),u=D.useCallback(()=>{const a=`Voice Recording Instructions for ${t}:\n\n1. Use your phone's voice recorder app\n2. Record the discussion about this disciplinary matter\n3. Save the recording with filename: "${t}_warning_${(new Date).toISOString().split("T")[0]}"\n4. Email the recording to HR or your manager\n5. Complete this form with a summary of the recording\n\nThis ensures proper documentation while accommodating device limitations.`;e(a)},[t,e]);return a.jsx("div",{className:"fixed inset-0 z-[9999] bg-black bg-opacity-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg shadow-lg legacy-simple-layout",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(be,{className:"w-5 h-5 text-orange-500"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900 legacy-text-size",children:"Audio Recording Not Available"})]}),a.jsx("button",{onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 legacy-touch-target",children:a.jsx(Z,{size:20})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-md",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(J,{size:16,className:"text-yellow-600 mt-0.5"}),a.jsx("div",{children:a.jsx("p",{className:"text-sm text-yellow-800 legacy-text-size",children:"Your device doesn't support audio recording. Choose an alternative method to document this discussion."})})]})}),a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Choose documentation method:"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"method",value:"text",checked:"text"===i,onChange:e=>r(e.target.value),className:"mr-2"}),a.jsx(Z,{size:16,className:"mr-1"}),a.jsx("span",{className:"legacy-text-size",children:"Write detailed notes"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"method",value:"phone",checked:"phone"===i,onChange:e=>r(e.target.value),className:"mr-2"}),a.jsx(Ne,{size:16,className:"mr-1"}),a.jsx("span",{className:"legacy-text-size",children:"Use phone to record separately"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"method",value:"instructions",checked:"instructions"===i,onChange:e=>r(e.target.value),className:"mr-2"}),a.jsx(ge,{size:16,className:"mr-1"}),a.jsx("span",{className:"legacy-text-size",children:"Generate recording instructions"})]})]})]}),"text"===i&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 legacy-text-size",children:"Document the discussion in writing:"}),a.jsx("textarea",{value:o,onChange:e=>n(e.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:6,placeholder:`Write detailed notes about your discussion with ${t}. Include:\n- What was discussed\n- Employee's response\n- Any commitments made\n- Next steps or follow-up required\n\nMinimum 10 characters required.`}),a.jsxs("div",{className:"text-xs text-gray-500",children:[o.length,"/10 minimum characters"]})]}),"phone"===i&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:[a.jsx("p",{className:"text-sm text-blue-800 legacy-text-size",children:a.jsx("strong",{children:"Instructions:"})}),a.jsxs("ol",{className:"text-sm text-blue-700 mt-1 pl-4 list-decimal legacy-text-size",children:[a.jsx("li",{children:"Use your phone's built-in voice recorder"}),a.jsxs("li",{children:["Record your discussion with ",t]}),a.jsx("li",{children:"Save with a clear filename"}),a.jsx("li",{children:"Email the recording to HR"}),a.jsx("li",{children:"Summarize the recording below"})]})]}),a.jsx("label",{className:"block text-sm font-medium text-gray-700 legacy-text-size",children:"Summarize your recorded phone discussion:"}),a.jsx("textarea",{value:l,onChange:e=>c(e.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:4,placeholder:"Briefly summarize what was discussed in your phone recording..."}),a.jsxs("div",{className:"text-xs text-gray-500",children:[l.length,"/10 minimum characters"]})]}),"instructions"===i&&a.jsx("div",{className:"space-y-3",children:a.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-md",children:a.jsx("p",{className:"text-sm text-green-800 legacy-text-size",children:"This will generate step-by-step recording instructions that you can follow to properly document this disciplinary discussion."})})})]}),a.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex justify-end gap-3",children:[a.jsx("button",{onClick:s,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 legacy-touch-target legacy-text-size",children:"Cancel"}),"text"===i&&a.jsx("button",{onClick:d,disabled:o.trim().length<10,className:"px-4 py-2 rounded-md legacy-touch-target legacy-text-size "+(o.trim().length>=10?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Save Notes"}),"phone"===i&&a.jsx("button",{onClick:m,disabled:l.trim().length<10,className:"px-4 py-2 rounded-md legacy-touch-target legacy-text-size "+(l.trim().length>=10?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Save Summary"}),"instructions"===i&&a.jsx("button",{onClick:u,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 legacy-touch-target legacy-text-size",children:"Generate Instructions"})]})]})})},ga=({isOpen:e,onClose:s,onSubmit:t,selectedEmployee:i,employees:r,categories:o})=>{const[n,l]=D.useState("form"),[c,d]=D.useState({employeeId:i?.id||"",categoryId:"",description:"",managerNotes:"",deliveryMethod:"hand_delivery"}),[m,u]=D.useState(""),[h,g]=D.useState(!1),x=D.useRef(null),p=c.employeeId&&c.categoryId&&c.description.trim().length>=10,y=D.useCallback((e,a)=>{d(s=>({...s,[e]:a})),m&&u("")},[m]),v=D.useCallback(()=>{p?l("confirm"):u("Please fill in all required fields")},[p]),b=D.useCallback(e=>{d(a=>({...a,managerNotes:a.managerNotes?`${a.managerNotes}\n\n--- Audio Notes ---\n${e}`:`--- Audio Notes ---\n${e}`})),g(!1)},[]),f=D.useCallback(async()=>{if(p){l("loading"),u("");try{const e={employeeId:c.employeeId,categoryId:c.categoryId,incidentDescription:c.description,managerNotes:c.managerNotes,deliveryMethod:c.deliveryMethod,audioRecording:null,signatures:{manager:null,employee:null},isLegacyDevice:!0};await t(e),s()}catch(e){u(e instanceof Error?e.message:"Failed to create warning"),l("form")}}},[c,p,t,s]);if(!e)return null;const w=r.find(e=>e.id===c.employeeId),N=o.find(e=>e.id===c.categoryId);return a.jsxs("div",{className:"fixed inset-0 z-[9999] bg-black bg-opacity-50 legacy-touch-target",children:[a.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:a.jsxs("div",{className:"bg-white rounded-lg w-full max-w-md shadow-lg legacy-simple-layout",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 legacy-text-size",children:"form"===n?"Issue Warning":"confirm"===n?"Confirm Warning":"Creating Warning..."}),"loading"!==n&&a.jsx("button",{onClick:s,className:"p-2 text-gray-500 hover:text-gray-700 legacy-touch-target",type:"button",children:a.jsx(H,{size:20})})]}),a.jsxs("div",{className:"p-4",children:[m&&a.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(J,{size:16,className:"text-red-500 mr-2"}),a.jsx("span",{className:"text-sm text-red-700 legacy-text-size",children:m})]})}),"form"===n&&a.jsxs("form",{ref:x,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:[a.jsx(O,{size:16,className:"inline mr-1"}),"Employee *"]}),a.jsxs("select",{value:c.employeeId,onChange:e=>y("employeeId",e.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-touch-target legacy-text-size",required:!0,children:[a.jsx("option",{value:"",children:"Select Employee"}),r.map(e=>a.jsxs("option",{value:e.id,children:[e.profile?.firstName," ",e.profile?.lastName]},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:[a.jsx(J,{size:16,className:"inline mr-1"}),"Warning Category *"]}),a.jsxs("select",{value:c.categoryId,onChange:e=>y("categoryId",e.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-touch-target legacy-text-size",required:!0,children:[a.jsx("option",{value:"",children:"Select Category"}),o.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:[a.jsx(Z,{size:16,className:"inline mr-1"}),"Incident Description * (minimum 10 characters)"]}),a.jsx("textarea",{value:c.description,onChange:e=>y("description",e.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:4,placeholder:"Describe what happened...",required:!0,minLength:10}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[c.description.length,"/10 minimum"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Manager Notes (optional)"}),a.jsx("textarea",{value:c.managerNotes,onChange:e=>y("managerNotes",e.target.value),className:"w-full p-3 border border-gray-300 rounded-md legacy-text-size",rows:2,placeholder:"Additional notes or context..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Audio Documentation (Optional)"}),a.jsxs("button",{type:"button",onClick:()=>g(!0),className:"w-full p-3 border border-gray-300 rounded-md flex items-center justify-center gap-2 hover:bg-gray-50 legacy-touch-target legacy-text-size",children:[a.jsx(pe,{size:16}),a.jsx("span",{children:"Add Voice Notes"})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Record or document verbal discussion with alternative methods"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 legacy-text-size",children:"Delivery Method"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"deliveryMethod",value:"hand_delivery",checked:"hand_delivery"===c.deliveryMethod,onChange:e=>y("deliveryMethod",e.target.value),className:"mr-2"}),a.jsx("span",{className:"legacy-text-size",children:"Hand Delivery (Recommended)"})]}),a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"radio",name:"deliveryMethod",value:"email",checked:"email"===c.deliveryMethod,onChange:e=>y("deliveryMethod",e.target.value),className:"mr-2"}),a.jsx("span",{className:"legacy-text-size",children:"Email"})]})]})]})]}),"confirm"===n&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[a.jsx("h3",{className:"font-medium text-blue-900 mb-2 legacy-text-size",children:"Review Warning Details"}),a.jsxs("div",{className:"space-y-2 text-sm text-blue-800",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Employee:"})," ",w?.profile?.firstName," ",w?.profile?.lastName]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Category:"})," ",N?.name]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Description:"})," ",c.description]}),c.managerNotes&&a.jsxs("p",{children:[a.jsx("strong",{children:"Notes:"})," ",c.managerNotes]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Delivery:"})," ","hand_delivery"===c.deliveryMethod?"Hand Delivery":"Email"]})]})]}),a.jsx("div",{className:"bg-yellow-50 p-3 rounded-md",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx(J,{size:16,className:"text-yellow-600 mr-2"}),a.jsx("span",{className:"text-sm text-yellow-800 legacy-text-size",children:"This warning will be permanently recorded in the employee's file."})]})})]}),"loading"===n&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"inline-block w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),a.jsx("p",{className:"text-gray-600 legacy-text-size",children:"Creating warning document..."})]})]}),"loading"!==n&&a.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 flex justify-end gap-3",children:["form"===n&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:s,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 legacy-touch-target legacy-text-size",type:"button",children:"Cancel"}),a.jsx("button",{onClick:v,disabled:!p,className:"px-4 py-2 rounded-md legacy-touch-target legacy-text-size "+(p?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),type:"button",children:"Review"})]}),"confirm"===n&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>l("form"),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 legacy-touch-target legacy-text-size",type:"button",children:"Back"}),a.jsxs("button",{onClick:f,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 legacy-touch-target legacy-text-size",type:"button",children:[a.jsx(ue,{size:16,className:"inline mr-1"}),"Issue Warning"]})]})]})]})}),h&&a.jsx(ha,{onTextSubmit:b,onClose:()=>g(!1),employeeName:w?.profile?.firstName})]})},xa=({employees:e,selectedEmployeeId:s,onEmployeeSelect:t,disabled:i=!1,className:r="",title:o="Employee Selection",subtitle:n="Choose the employee for this action"})=>{const[l,c]=D.useState(""),[d,m]=D.useState(!1),[u,h]=D.useState(!1),g=D.useMemo(()=>{if(!l.trim())return e;const a=l.toLowerCase();return e.filter(e=>{const s=`${e.firstName} ${e.lastName}`.toLowerCase(),t=e.department?.toLowerCase()||"";return s.includes(a)||t.includes(a)})},[e,l]),x=D.useMemo(()=>e.find(e=>e.id===s),[e,s]),p=D.useCallback(e=>{t(e),m(!1),h(!1),c("")},[t]),y=D.useCallback(()=>{if(i)return;window.innerWidth<768?h(!0):m(!d)},[i,d]),v=D.useCallback(()=>{h(!1),c("")},[]);return a.jsxs("div",{className:`form-section ${r}`,children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(O,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:o}),a.jsx("p",{className:"unified-section-header__subtitle",children:n})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border "+(i?"opacity-50 cursor-not-allowed":"hover:border-primary"),style:{backgroundColor:"var(--color-input-background)",borderColor:d?"var(--color-primary)":"var(--color-input-border)",boxShadow:d?"0 0 0 2px var(--color-primary-light)":void 0},onClick:y,children:x?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[x.firstName?.charAt(0),x.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[x.firstName," ",x.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[x.position," • ",x.department]})]})]}),a.jsx(W,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(d?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(O,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(W,{className:"w-4 h-4 transition-transform "+(d?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),d&&a.jsxs("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[a.jsx("div",{className:"p-3",style:{borderBottom:"1px solid var(--color-border)"},children:a.jsxs("div",{className:"relative",children:[a.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-3 py-2 rounded border text-sm focus:ring-2",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)","--ring-color":"var(--color-primary)"}})]})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:g.length>0?a.jsx("div",{className:"py-2",children:g.map(e=>a.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left px-3 py-2 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:[e.firstName," ",e.lastName]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[e.position," • ",e.department]})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center",children:[a.jsx(O,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l?`No employees found matching "${l}"`:"No employees available"})]})})]})]})}),u&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:v}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Employee"}),a.jsx("button",{onClick:v,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(H,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"p-4",children:a.jsxs("div",{className:"relative",children:[a.jsx(je,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("input",{type:"text",placeholder:"Search employees...",value:l,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-3 py-2 rounded border",style:{backgroundColor:"var(--color-input-background)",borderColor:"var(--color-input-border)",color:"var(--color-text)"}})]})}),a.jsx("div",{className:"mobile-category-list",children:g.length>0?a.jsx("div",{children:g.map(e=>a.jsx("button",{onClick:()=>p(e.id),className:"w-full text-left px-4 py-3 transition-colors",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-sm",style:{color:"var(--color-primary)"},children:[e.firstName?.charAt(0),e.lastName?.charAt(0)]})}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"font-medium text-base",style:{color:"var(--color-text)"},children:[e.firstName," ",e.lastName]}),a.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[e.position," • ",e.department]})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center",children:[a.jsx(O,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l?`No employees found matching "${l}"`:"No employees available"})]})})]})]})]})},pa=[{id:"training",label:"Training & Development",description:"Skills training, knowledge sharing, and competency development",icon:"📚",color:"blue"},{id:"coaching",label:"Performance Coaching",description:"Performance improvement, goal setting, and mentoring",icon:"🎯",color:"green"},{id:"behavioral",label:"Behavioral Discussion",description:"Conduct, attitude, and workplace behavior guidance",icon:"🤝",color:"purple"}],ya=({isOpen:e,onClose:s})=>{const{user:t}=m(),{organization:i}=u(),[r,o]=D.useState(null),[n,l]=D.useState(null),[c,d]=D.useState("coaching"),[h,g]=D.useState(""),[y,v]=D.useState(""),[b,f]=D.useState(!1),[w,N]=D.useState(null),[j,k]=D.useState(!1),[C,S]=D.useState(!0),[z,_]=D.useState([]),[I,E]=D.useState([]);D.useEffect(()=>{if(i?.id&&t?.id&&e){(async()=>{try{S(!0),N(null);const e=(await x.employees.getByManager(t?.id||"",i.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",email:e.profile?.email||e.contact?.email||e.email||"",phone:e.profile?.phone||e.contact?.phone||e.phone||"",deliveryPreference:e.deliveryPreference||"email",...e}));_(e);let a=await x.organizations.getCategories(i.id);a&&0!==a.length||(a=[{id:"attendance_punctuality",name:"Attendance & Punctuality",severity:"minor"},{id:"performance_issues",name:"Performance Issues",severity:"moderate"},{id:"safety_violations",name:"Safety Violations",severity:"serious"},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",severity:"serious"},{id:"policy_violations",name:"Policy Violations",severity:"serious"},{id:"dishonesty_theft",name:"Dishonesty & Theft",severity:"gross_misconduct"},{id:"substance_abuse",name:"Substance Abuse",severity:"gross_misconduct"},{id:"harassment_discrimination",name:"Harassment & Discrimination",severity:"gross_misconduct"}]),E(a)}catch(e){N("Failed to load data. Please try again."),_([]),E([])}finally{S(!1)}})()}else e||S(!1)},[t?.id,i?.id,e]);return e?C?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Loading Counselling Data"}),a.jsx("p",{className:"modal-header__subtitle",children:"Preparing counselling session data"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[a.jsx("div",{className:"animate-spin mx-auto h-16 w-16 border-4 border-gray-200 border-t-primary rounded-full"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading counselling data..."})]})})})]})}):j?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Counselling Session Recorded"}),a.jsx("p",{className:"modal-header__subtitle",children:"Successfully documented and available for HR review"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4 text-center p-4 sm:p-6",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(ee,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Session Successfully Recorded"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The corrective counselling session with ",a.jsxs("strong",{children:[r?.firstName," ",r?.lastName]})," has been successfully documented and will be available to HR for review."]}),a.jsx("p",{className:"text-sm text-gray-600",children:"Redirecting automatically in a few seconds..."})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:s,className:"modal-footer__button modal-footer__button--primary",children:"Return to Dashboard"})})})]})}):a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container modal-container--xl",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Corrective Counselling Session"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document training, coaching, and discussions"})]})}),a.jsx("button",{onClick:s,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[w&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),a.jsx(xa,{employees:z,selectedEmployeeId:r?.id||null,onEmployeeSelect:e=>{const a=z.find(a=>a.id===e);o(a||null)},title:"Employee Selection",subtitle:"Choose the employee involved in this counselling session",disabled:C}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-2 unified-field-required",children:"Related Category"}),a.jsxs("select",{value:n?.id||"",onChange:e=>{const a=I.find(a=>a.id===e.target.value);l(a||null)},className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",required:!0,children:[a.jsx("option",{value:"",children:"Choose a category..."}),I.map(e=>a.jsxs("option",{value:e.id,children:[e.name," - ",e.severity]},e.id))]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(ke,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Counselling Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the appropriate type of counselling session"})]})]}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:pa.map(e=>a.jsx("div",{className:"category-card cursor-pointer "+(c===e.id?"category-card--selected":""),onClick:()=>d(e.id),children:a.jsxs("div",{className:"category-card__content",children:[a.jsx("span",{className:"category-card__icon",children:e.icon}),a.jsxs("div",{className:"category-card__details",children:[a.jsx("div",{className:"category-card__title",children:e.label}),a.jsx("p",{className:"category-card__description",children:e.description})]})]})},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(Z,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Issue/Topic Description"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the issue or topic that prompted this counselling session"})]})]}),a.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Describe the issue, topic, or area for improvement that prompted this counselling session...",rows:4,minLength:20,maxLength:500,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),a.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[h.length,"/500 characters (minimum 20)"]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",style:{color:"var(--color-primary)"},children:a.jsx(ee,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Intervention Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Document what was discussed and addressed during the session"})]})]}),a.jsx("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"Describe what was discussed, taught, or addressed during the counselling session...",rows:4,minLength:30,maxLength:1e3,required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"}),a.jsxs("p",{className:"text-xs mt-1 text-gray-600",children:[y.length,"/1000 characters (minimum 30)"]})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:s,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(t&&r&&n&&t.organizationId)try{f(!0),N(null);const e={organizationId:t.organizationId,managerId:t.id,managerName:`${t.firstName} ${t.lastName}`,employeeId:r.id,employeeName:`${r.firstName} ${r.lastName}`,employeeNumber:r.employeeNumber||"",department:r.department||"",category:n.name,categoryId:n.id,counsellingType:c,issueDescription:h.trim(),interventionDetails:y.trim(),trainingProvided:"",resourcesProvided:[],promisesToPerform:[],improvementTimeline:"",followUpDate:"",managerSignature:"",employeeAcknowledged:!1,employeeComments:"",status:"completed",improvementNoted:!1,followUpCompleted:!1,escalationRequired:!1,dateCreated:(new Date).toISOString(),lastUpdated:(new Date).toISOString(),createdBy:t.id,documentVersion:1};await p.createDocument(i.id,"reports",e),k(!0),setTimeout(()=>{s()},3e3)}catch(e){N("Failed to submit counselling record. Please try again.")}finally{f(!1)}},disabled:!(r&&n&&h.trim().length>=20&&y.trim().length>=30)||b,className:"modal-footer__button modal-footer__button--primary",children:b?"Submitting...":"Submit Counselling Session"})]})})]})}):null},va=({onSignatureChange:e,label:s,required:t=!1,role:i="manager",personName:r})=>{const o=D.useRef(null),[n,l]=D.useState(!1),[c,d]=D.useState(!1),m=D.useCallback(e=>{const a=o.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(l(!0),t.beginPath(),t.moveTo(e.clientX-s.left,e.clientY-s.top))},[]),u=D.useCallback(e=>{if(!n)return;const a=o.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(t.lineTo(e.clientX-s.left,e.clientY-s.top),t.stroke(),d(!0))},[n]),h=D.useCallback(()=>{if(n&&o.current){l(!1);const a=o.current.toDataURL();e(a)}},[n,e]),g=D.useCallback(()=>{const a=o.current;if(!a)return;const s=a.getContext("2d");s&&(s.clearRect(0,0,a.width,a.height),d(!1),e(""))},[e]),x=D.useCallback(()=>{const e=o.current;if(!e)return;const a=e.getContext("2d");if(!a)return;const s=e.getBoundingClientRect();e.width=s.width,e.height=s.height,a.strokeStyle="var(--color-text)",a.lineWidth=2,a.lineCap="round",a.lineJoin="round"},[]);return D.useEffect(()=>{x();const e=()=>{setTimeout(x,100)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[x]),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("label",{className:"unified-field-label",children:[s," ",t&&a.jsx("span",{className:"unified-field-required"})]}),a.jsx("p",{className:"unified-section-header__subtitle",children:"manager"===i?"Please sign below to confirm this meeting request":`${r}, please sign below if you agree to this meeting`})]}),a.jsx("div",{className:"flex items-center gap-2",children:c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[a.jsx(ee,{className:"w-4 h-4"}),a.jsx("span",{children:"Signed"})]}):a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(fe,{className:"w-4 h-4"}),a.jsx("span",{children:"Pending"})]})})]}),a.jsxs("div",{className:"border-2 border-dashed rounded p-4",style:{borderColor:"var(--color-border)"},children:[a.jsx("canvas",{ref:o,className:"w-full h-32 cursor-crosshair rounded",onMouseDown:m,onMouseMove:u,onMouseUp:h,onMouseLeave:h}),a.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:c?"Signature captured":"Click and drag to sign above"}),a.jsxs("button",{onClick:g,disabled:!c,className:"px-3 py-1 text-sm rounded flex items-center gap-1",style:{color:"var(--color-text-secondary)",backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:[a.jsx(De,{className:"w-4 h-4"}),"Clear"]})]})]})]})},ba=({isOpen:s,onClose:t})=>{const{user:i}=m(),{organization:r}=u(),[o,n]=D.useState(null),[l,c]=D.useState(""),[d,h]=D.useState(""),[g,v]=D.useState(""),[b,f]=D.useState(null),[w,N]=D.useState(!1),[j,k]=D.useState(!1),[C,S]=D.useState(null),[z,_]=D.useState(!1),[I,E]=D.useState([]);D.useEffect(()=>{s&&(async()=>{if(i?.id&&r?.id)try{const e=(await x.employees.getByManager(i.id,r.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",email:e.profile?.email||e.contact?.email||e.email||"",...e}));E(e)}catch(a){e.error("Failed to load employees:",a),S("Failed to load employees")}})()},[i?.id,r?.id,s]);const R=()=>o&&l.trim().length>=20&&d.trim(),T=e=>{f(e),e?N(!0):(N(!1),v(""))};return D.useEffect(()=>{s||(n(null),c(""),h(""),v(""),f(null),N(!1),S(null),_(!1))},[s]),z?s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Meeting Request Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"HR will be notified and will schedule the meeting"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(ee,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Meeting Request Submitted"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["Your meeting request for ",o?.firstName," ",o?.lastName," has been successfully submitted to HR. They will review the request and schedule the meeting accordingly."]}),a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:[a.jsx(ae,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-primary)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"You will receive notification once the meeting is scheduled"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Book HR Meeting"}),a.jsx("p",{className:"modal-header__subtitle",children:"Schedule intervention meeting with HR"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-header__center",children:a.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:a.jsx("div",{className:"mobile-step-indicator",children:a.jsx("div",{className:"mobile-step-dots",children:a.jsx("div",{className:"mobile-step-dot mobile-step-dot--active",children:"1"})})})})}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[C&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:C})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(xa,{employees:I,selectedEmployeeId:o?.id||null,onEmployeeSelect:e=>{const a=I.find(a=>a.id===e);n(a||null)},title:"Select Employee",subtitle:"Choose the team member for this HR meeting"}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(Z,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Meeting Context"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Describe the situation that requires HR intervention"})]})]}),a.jsx("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Describe the situation that requires HR intervention...",className:"unified-field-input",rows:4,minLength:20,maxLength:1e3}),a.jsxs("div",{className:"unified-field-hint",children:[l.length,"/1000 characters (minimum 20)"]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(Ce,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Manager Confirmation"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Please sign to confirm this meeting request"})]})]}),a.jsx(va,{onSignatureChange:e=>{h(e)},label:"Manager Signature",role:"manager",required:!0})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(Se,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Employee Acknowledgment"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional signature from the employee (can be done later)"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-info-bg)",border:"1px solid var(--color-primary)"},children:a.jsx("div",{className:"flex-1",children:a.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Note:"})," Employee signature is optional. You can proceed without it and have them sign later."]})})}),w?a.jsxs("div",{className:"space-y-4",children:[a.jsx(va,{onSignatureChange:e=>{v(e)},label:"Employee Signature",role:"employee",personName:`${o?.firstName} ${o?.lastName}`}),a.jsx("button",{onClick:()=>N(!1),className:"px-4 py-2 rounded",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Back to Options"})]}):a.jsxs("div",{className:"space-y-3",children:[a.jsx("p",{className:"font-medium",style:{color:"var(--color-text)"},children:"Does the employee want to sign now?"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs("button",{onClick:()=>T(!0),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)"},children:[a.jsx(Ce,{className:"w-4 h-4"}),"Yes, employee will sign now"]}),a.jsxs("button",{onClick:()=>T(!1),className:"px-4 py-2 rounded flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:[a.jsx(Se,{className:"w-4 h-4"}),"Skip for now"]})]})]})]})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(i&&o&&r?.id&&R())try{k(!0),S(null);const e={organizationId:r.id,managerId:i.id,managerName:`${i.firstName} ${i.lastName}`,employeeId:o.id,employeeName:`${o.firstName} ${o.lastName}`,context:l.trim(),managerSignature:d,...b&&g&&{employeeSignature:g},employeeConsent:b||!1,status:"pending",requestDate:y.getServerTimestamp(),createdAt:y.getServerTimestamp(),updatedAt:y.getServerTimestamp()};await p.createDocument(r.id,"meetings",e),_(!0),setTimeout(()=>{t()},3e3)}catch(a){e.error("Failed to submit meeting request:",a),S("Failed to submit meeting request. Please try again.")}finally{k(!1)}},disabled:!R()||j,className:"modal-footer__button modal-footer__button--primary "+(j?"modal-footer__button--loading":""),children:"Submit Meeting Request"})]})})]})}):null},fa=Object.freeze(Object.defineProperty({__proto__:null,UnifiedBookHRMeeting:ba},Symbol.toStringTag,{value:"Module"})),wa=[{id:"full-day",label:"Full Day Absence",icon:"🏠",payrollImpact:!0,description:"Employee absent for entire work day"},{id:"half-day",label:"Half Day Absence",icon:"🕐",payrollImpact:!0,description:"Employee absent for half of work day"},{id:"late-arrival",label:"Late Arrival",icon:"⏰",payrollImpact:!1,description:"Employee arrived late to work"},{id:"early-departure",label:"Early Departure",icon:"🚪",payrollImpact:!1,description:"Employee left work early"},{id:"sick-leave",label:"Sick Leave",icon:"🤒",payrollImpact:!0,description:"Employee absent due to illness"},{id:"personal-leave",label:"Personal Leave",icon:"👤",payrollImpact:!0,description:"Employee absent for personal reasons"}],Na=({isOpen:s,onClose:t})=>{const{user:i}=m(),{organization:r}=u(),[o,n]=D.useState(null),[l,c]=D.useState((new Date).toISOString().split("T")[0]),[d,h]=D.useState(""),[g,v]=D.useState(""),[b,f]=D.useState(!1),[w,N]=D.useState(null),[j,k]=D.useState(!1),[C,S]=D.useState([]),[z,_]=D.useState(!1),[I,E]=D.useState(!1);D.useEffect(()=>{s&&(async()=>{if(i?.id&&r?.id)try{const e=(await x.employees.getByManager(i.id,r.id)).map(e=>({id:e.id,firstName:e.profile?.firstName||e.firstName||"Unknown",lastName:e.profile?.lastName||e.lastName||"Employee",position:e.profile?.position||e.employment?.position||"Unknown Position",department:e.profile?.department||e.employment?.department||"Unknown",employeeNumber:e.employeeNumber||e.profile?.employeeNumber||"",...e}));S(e)}catch(a){e.error("Failed to load employees:",a),N("Failed to load employees")}})()},[i?.id,r?.id,s]);const R=D.useMemo(()=>wa.find(e=>e.id===d),[d]),T=D.useCallback(e=>{h(e),_(!1),E(!1)},[]),L=D.useCallback(()=>{window.innerWidth<768?E(!0):_(!z)},[z]),A=D.useCallback(()=>{E(!1)},[]),M=()=>o&&l&&d;D.useEffect(()=>{s||(n(null),c((new Date).toISOString().split("T")[0]),h(""),v(""),N(null),k(!1),_(!1),E(!1))},[s]);const q=wa.find(e=>e.id===d);return j?s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Submitted"}),a.jsx("p",{className:"modal-header__subtitle",children:"Absence report has been successfully submitted"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"p-4 sm:p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full mb-6 bg-green-100",children:a.jsx(ee,{className:"h-8 w-8 text-green-600"})}),a.jsx("h3",{className:"text-xl font-bold mb-4",children:"Report Submitted Successfully"}),a.jsxs("p",{className:"mb-6 text-gray-600",children:["The absence report for ",o?.firstName," ",o?.lastName," has been submitted and will be reviewed by HR."]}),q?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(ze,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{className:"text-sm",style:{color:"var(--color-text)"},children:"This absence may impact payroll calculations"})})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsx("div",{className:"modal-footer__nav",children:a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--primary",children:"Close"})})})]})}):null:s?a.jsx("div",{className:"modal-system",children:a.jsxs("div",{className:"modal-container",children:[a.jsxs("div",{className:"modal-header",children:[a.jsx("div",{className:"modal-header__left",children:a.jsxs("div",{children:[a.jsx("h2",{className:"modal-header__title",children:"Report Employee Absence"}),a.jsx("p",{className:"modal-header__subtitle",children:"Document unscheduled employee absence"})]})}),a.jsx("button",{onClick:t,className:"modal-header__close-button",children:a.jsx(H,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"modal-content",children:a.jsx("div",{className:"modal-content__scrollable",children:a.jsxs("div",{className:"space-y-4",children:[w&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-error-bg)",border:"1px solid var(--color-error)"},children:[a.jsx(fe,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-error)"}}),a.jsx("div",{className:"flex-1",children:a.jsx("span",{style:{color:"var(--color-text)"},children:w})})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(Se,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Details"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select employee and specify absence information"})]})]}),a.jsx(xa,{employees:C,selectedEmployeeId:o?.id||null,onEmployeeSelect:e=>{const a=C.find(a=>a.id===e);n(a||null)},title:"Employee Selection",subtitle:"Choose the employee for this absence report"}),a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[a.jsx(Re,{type:"date",label:"Absence Date",value:l,onChange:e=>c(e),icon:ae,required:!0}),a.jsxs("div",{children:[a.jsx("label",{className:"unified-field-label",children:"Reported Date"}),a.jsx("input",{type:"text",value:(new Date).toLocaleDateString(),readOnly:!0,className:"unified-field-input opacity-75"})]})]})})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(V,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Absence Type"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Select the type of absence that occurred"})]})]}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"cursor-pointer transition-all min-h-[48px] p-3 rounded border hover:border-primary",style:{backgroundColor:"var(--color-input-background)",borderColor:z?"var(--color-primary)":"var(--color-input-border)",boxShadow:z?"0 0 0 2px var(--color-primary-light)":void 0},onClick:L,children:R?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg",children:R.icon}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:R.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:R.description}),R.payrollImpact&&a.jsx("span",{className:"category-card__badge category-card__badge--warning",children:a.jsx(ze,{className:"w-3 h-3"})})]})]})]}),a.jsx(W,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(z?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(V,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select absence type..."})]}),a.jsx(W,{className:"w-4 h-4 transition-transform "+(z?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),z&&a.jsx("div",{className:"absolute top-full left-0 right-0 z-20 rounded-lg shadow-lg max-h-80 overflow-hidden",style:{backgroundColor:"var(--color-background)",border:"1px solid var(--color-border)"},children:a.jsx("div",{className:"max-h-60 overflow-y-auto",children:a.jsx("div",{className:"py-2",children:wa.map(e=>a.jsx("button",{onClick:()=>T(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-lg flex-shrink-0",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs",style:{color:"var(--color-warning)"},children:"$ Payroll"})]})]})]})},e.id))})})})]})}),I&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:A}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Select Absence Type"}),a.jsx("button",{onClick:A,className:"p-2 rounded-full hover:bg-opacity-10",style:{backgroundColor:"var(--color-text-tertiary)"},children:a.jsx(H,{className:"w-5 h-5",style:{color:"var(--color-text)"}})})]}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:a.jsx("div",{children:wa.map(e=>a.jsxs("button",{onClick:()=>T(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("span",{className:"text-xl flex-shrink-0 mt-0.5",children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.label}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("div",{className:"text-sm text-left",style:{color:"var(--color-text-secondary)"},children:e.description}),e.payrollImpact&&a.jsx("span",{className:"text-xs px-2 py-1 rounded flex-shrink-0",style:{backgroundColor:"var(--color-warning-bg)",color:"var(--color-warning)"},children:"$ Payroll"})]})]})]},e.id))})})]})]})]})]}),a.jsxs("div",{className:"form-section",children:[a.jsxs("div",{className:"unified-section-header",children:[a.jsx("div",{className:"unified-section-header__icon",children:a.jsx(Z,{className:"w-5 h-5"})}),a.jsxs("div",{className:"unified-section-header__content",children:[a.jsx("h3",{className:"unified-section-header__title",children:"Additional Notes"}),a.jsx("p",{className:"unified-section-header__subtitle",children:"Optional context or details about the absence"})]})]}),a.jsx("textarea",{value:g,onChange:e=>v(e.target.value),placeholder:"Optional additional context or details about the absence...",className:"unified-field-input",rows:3,maxLength:500}),a.jsxs("div",{className:"unified-field-hint",children:[g.length,"/500 characters"]})]}),q?.payrollImpact&&a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded",style:{backgroundColor:"var(--color-warning-bg)",border:"1px solid var(--color-warning)"},children:[a.jsx(ze,{className:"w-5 h-5 shrink-0 mt-0.5",style:{color:"var(--color-warning)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:"Payroll Impact Notice"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"This absence type may affect the employee's pay. HR will review and make appropriate adjustments."})]})]})]})})}),a.jsx("div",{className:"modal-footer",children:a.jsxs("div",{className:"modal-footer__nav",children:[a.jsx("button",{onClick:t,className:"modal-footer__button modal-footer__button--secondary",children:"Cancel"}),a.jsx("button",{onClick:async()=>{if(i&&o&&r?.id&&M())try{f(!0),N(null);const e=wa.find(e=>e.id===d),a={organizationId:r.id,managerId:i.id,managerName:`${i.firstName} ${i.lastName}`,employeeId:o.id,employeeName:`${o.firstName} ${o.lastName}`,employeeNumber:o.employeeNumber||"",absenceDate:l,absenceType:d,reason:g.trim()||void 0,reportedDate:y.getServerTimestamp(),payrollImpact:e?.payrollImpact||!1,hrReviewed:!1,createdAt:y.getServerTimestamp(),updatedAt:y.getServerTimestamp()},s=Object.fromEntries(Object.entries(a).filter(([e,a])=>void 0!==a));await p.createDocument(r.id,"reports",s),k(!0),setTimeout(()=>{t()},2e3)}catch(a){e.error("Failed to submit absence report:",a),N("Failed to submit absence report. Please try again.")}finally{f(!1)}},disabled:!M()||b,className:"modal-footer__button modal-footer__button--primary "+(b?"modal-footer__button--loading":""),children:"Submit Report"})]})})]})}):null},ja=Object.freeze(Object.defineProperty({__proto__:null,UnifiedReportAbsence:Na},Symbol.toStringTag,{value:"Module"})),ka="corrective_counselling",Ca="counselling_followups",Sa="notifications";class Da{static async getActiveCounsellingForEmployee(a,s){try{const t=$(R(d,ka),P("organizationId","==",s),P("employeeId","==",a),P("status","in",["completed","follow_up_pending"]),F("dateCreated","desc")),i=await U(t),r=[];return i.forEach(e=>{const a=e.data(),s={id:e.id,...a};if(s.followUpDate){const e=new Date(s.followUpDate),a=new Date,t=Math.ceil((e.getTime()-a.getTime())/864e5);t>=-30&&t<=30&&!s.followUpCompleted&&r.push(s)}}),e.success(2097),r}catch(t){return e.error("❌ Error getting active counselling:",t),[]}}static async getDueFollowUps(a,s){try{const t=$(R(d,ka),P("organizationId","==",s),P("managerId","==",a),P("followUpCompleted","==",!1),F("followUpDate","asc")),i=await U(t),r=[],o=new Date;return i.forEach(e=>{const a=e.data(),s={id:e.id,...a};if(s.followUpDate){const e=new Date(s.followUpDate);Math.ceil((e.getTime()-o.getTime())/864e5)<=7&&r.push(s)}}),e.success(3568),r}catch(t){return e.error("❌ Error getting due follow-ups:",t),[]}}static async createFollowUp(a,s){try{e.success(3983);const t={...s,counsellingId:a,createdDate:y.getServerTimestamp()},i=await v.createDocument(Ca,t);return await v.updateDocument(ka,a,{followUpCompleted:!0,improvementNoted:s.improvementObserved,lastUpdated:y.getServerTimestamp()}),e.success(4709),i}catch(t){throw e.error("❌ Error creating follow-up:",t),t}}static async getEmployeeCounsellingSummary(a,s){try{const t=$(R(d,ka),P("organizationId","==",s),P("employeeId","==",a),F("dateCreated","desc")),i=await U(t);if(i.empty)return null;const r=[];i.forEach(e=>{const a=e.data();r.push({id:e.id,...a})});const o=r[0],n=r.filter(e=>!e.followUpCompleted&&e.followUpDate).length,l=[...new Set(r.map(e=>e.category))];let c="no_data";if(r.length>=2){const e=r.slice(0,3).filter(e=>e.improvementNoted).length;c=e>=2?"improving":1===e?"stable":"declining"}let m="low";r.length>=5?m="high":r.length>=3&&(m="medium");const u={employeeId:a,employeeName:o.employeeName,totalSessions:r.length,lastSessionDate:o.dateCreated,pendingFollowUps:n,improvementTrend:c,commonCategories:l,escalationRisk:m};return e.success(7051),u}catch(t){return e.error("❌ Error getting counselling summary:",t),null}}static async createFollowUpNotification(a,s,t){try{const e={userId:a,organizationId:s,type:"counselling_followup_due",title:"Counselling Follow-up Due",message:`Follow-up required for ${t.employeeName} regarding ${t.category}`,data:{counsellingId:t.id,employeeId:t.employeeId,employeeName:t.employeeName,followUpDate:t.followUpDate},read:!1,createdAt:y.getServerTimestamp()};await v.createDocument(Sa,e)}catch(i){e.error("❌ Error creating follow-up notification:",i)}}static async getFollowUpRecords(a){try{const e=$(R(d,Ca),P("counsellingId","==",a),F("createdDate","desc")),s=await U(e),t=[];return s.forEach(e=>{const a=e.data();t.push({id:e.id,...a})}),t}catch(s){return e.error("❌ Error getting follow-up records:",s),[]}}}const za=({onSignatureChange:e,label:s,required:t=!1})=>{const i=D.useRef(null),[r,o]=D.useState(!1),[n,l]=D.useState(!1),c=()=>{if(r&&i.current){o(!1);const a=i.current.toDataURL();e(a)}};return z.useEffect(()=>{const e=i.current;if(!e)return;const a=e.getContext("2d");a&&(e.width=e.offsetWidth,e.height=e.offsetHeight,a.strokeStyle="#000",a.lineWidth=2,a.lineCap="round")},[]),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[s," ",t&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"border-2 border-gray-300 rounded-lg p-4 bg-white",children:[a.jsx("canvas",{ref:i,className:"w-full h-24 border border-dashed border-gray-400 rounded cursor-crosshair bg-gray-50",onMouseDown:e=>{const a=i.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(o(!0),t.beginPath(),t.moveTo(e.clientX-s.left,e.clientY-s.top))},onMouseMove:e=>{if(!r)return;const a=i.current;if(!a)return;const s=a.getBoundingClientRect(),t=a.getContext("2d");t&&(t.lineTo(e.clientX-s.left,e.clientY-s.top),t.stroke(),l(!0))},onMouseUp:c,onMouseLeave:c}),a.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[a.jsx("p",{className:"text-sm text-gray-500",children:n?"Signature captured":"Click and drag to sign above"}),a.jsxs("button",{type:"button",onClick:()=>{const a=i.current;if(!a)return;const s=a.getContext("2d");s&&(s.clearRect(0,0,a.width,a.height),l(!1),e(""))},className:"text-sm text-red-600 hover:text-red-800 flex items-center gap-1",disabled:!n,children:[a.jsx(De,{className:"w-4 h-4"}),"Clear"]})]})]})]})},_a=({counsellingSession:s,onClose:t,onComplete:i})=>{_();const{user:r}=m(),{organization:o}=u(),[n,l]=D.useState(null),[c,d]=D.useState(""),[h,g]=D.useState(""),[x,p]=D.useState("continue_monitoring"),[y,v]=D.useState(""),[b,f]=D.useState(""),[w,N]=D.useState(""),[j,k]=D.useState(""),[C,S]=D.useState(""),[z,I]=D.useState(null),[E,R]=D.useState(!1),[T,L]=D.useState(!1),[A,M]=D.useState(null),[q,$]=D.useState("review"),P=e=>{k(e),e&&$("employee-decision")},F=e=>{I(e),e?R(!0):W()},U=e=>{S(e),e&&W()},W=async()=>{if(r&&r.organizationId)try{L(!0),M(null);const e={followUpDate:(new Date).toISOString(),improvementObserved:n||!1,improvementDetails:c.trim(),additionalConcerns:h.trim(),nextAction:x,nextActionDate:y||void 0,managerNotes:b.trim(),employeeFeedback:w.trim(),createdBy:r.id};await Da.createFollowUp(s.id,e),$("complete"),setTimeout(()=>{i()},3e3)}catch(a){e.error("❌ Error submitting follow-up:",a),M("Failed to submit follow-up. Please try again.")}finally{L(!1)}};return"review"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"sticky top-0 bg-white border-b px-6 py-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(ae,{className:"w-8 h-8 text-green-600"}),"Counselling Follow-up Review"]}),a.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:a.jsx(H,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-gray-600 mt-2",children:"Review progress and document outcomes"})]}),A&&a.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-100 border border-red-300 rounded-lg flex items-center gap-2",children:[a.jsx(fe,{className:"w-5 h-5 text-red-500"}),a.jsx("p",{className:"text-red-700",children:A})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[a.jsxs("h3",{className:"font-medium text-blue-800 mb-3 flex items-center gap-2",children:[a.jsx(ke,{className:"w-5 h-5"}),"Original Counselling Session"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Employee:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:s.employeeName})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Date:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:new Date(s.dateCreated).toLocaleDateString()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Category:"}),a.jsx("span",{className:"ml-2 text-blue-600",children:s.category})]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Type:"}),a.jsx("span",{className:"ml-2 text-blue-600 capitalize",children:s.counsellingType})]})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Issue:"}),a.jsx("p",{className:"text-blue-600 text-sm mt-1",children:s.issueDescription})]}),s.promisesToPerform.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsx("span",{className:"font-medium text-blue-700",children:"Promises to Perform:"}),a.jsx("ul",{className:"text-blue-600 text-sm mt-1 space-y-1",children:s.promisesToPerform.map((e,s)=>a.jsxs("li",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-blue-500",children:"•"}),a.jsxs("span",{children:[e.description," (Due: ",new Date(e.targetDate).toLocaleDateString(),")"]})]},s))})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Has the employee shown improvement? *"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{type:"button",onClick:()=>l(!0),className:"px-6 py-3 rounded-lg border-2 transition-all "+(!0===n?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(ee,{className:"w-5 h-5 mx-auto mb-1"}),"Yes, Improvement Noted"]}),a.jsxs("button",{type:"button",onClick:()=>l(!1),className:"px-6 py-3 rounded-lg border-2 transition-all "+(!1===n?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(fe,{className:"w-5 h-5 mx-auto mb-1"}),"No, Concerns Remain"]})]})]}),null!==n&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:n?"Improvement Details *":"Ongoing Concerns *"}),a.jsx("textarea",{value:c,onChange:e=>d(e.target.value),placeholder:n?"Describe the specific improvements observed...":"Describe the ongoing concerns or lack of improvement...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/500 characters (minimum 10)"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Concerns or Notes"}),a.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"Any additional concerns, observations, or context...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Recommended Next Action *"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>p("continue_monitoring"),className:"p-3 rounded-lg border-2 text-left transition-all "+("continue_monitoring"===x?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(V,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Continue Monitoring"}),a.jsx("div",{className:"text-sm opacity-70",children:"Keep observing progress"})]}),a.jsxs("button",{type:"button",onClick:()=>p("additional_training"),className:"p-3 rounded-lg border-2 text-left transition-all "+("additional_training"===x?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(ke,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Additional Training"}),a.jsx("div",{className:"text-sm opacity-70",children:"Provide more support"})]}),a.jsxs("button",{type:"button",onClick:()=>p("formal_warning"),className:"p-3 rounded-lg border-2 text-left transition-all "+("formal_warning"===x?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(fe,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Escalate to Formal Warning"}),a.jsx("div",{className:"text-sm opacity-70",children:"Begin formal discipline"})]}),a.jsxs("button",{type:"button",onClick:()=>p("no_further_action"),className:"p-3 rounded-lg border-2 text-left transition-all "+("no_further_action"===x?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"),children:[a.jsx(ee,{className:"w-5 h-5 mb-2"}),a.jsx("div",{className:"font-medium",children:"Close Successfully"}),a.jsx("div",{className:"text-sm opacity-70",children:"Issue resolved"})]})]})]}),"no_further_action"!==x&&a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Next Review Date *"}),a.jsx("input",{type:"date",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:(new Date).toISOString().split("T")[0],required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Manager Notes *"}),a.jsx("textarea",{value:b,onChange:e=>f(e.target.value),placeholder:"Document your overall assessment and any specific observations...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,minLength:10,required:!0}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b.length,"/500 characters (minimum 10)"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Employee Feedback"}),a.jsx("textarea",{value:w,onChange:e=>N(e.target.value),placeholder:"Optional feedback from the employee during this review...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),a.jsxs("div",{className:"flex justify-between pt-6 border-t",children:[a.jsxs("button",{type:"button",onClick:t,className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 flex items-center gap-2",children:[a.jsx(_e,{className:"w-4 h-4"}),"Cancel"]}),a.jsxs("button",{type:"button",onClick:()=>$("manager-sign"),disabled:!(null!==n&&b.trim().length>=10&&(!1!==n||c.trim().length>=10)&&("no_further_action"===x||y)),className:"px-8 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:["Continue to Signatures",a.jsx(ee,{className:"w-4 h-4"})]})]})]})]})}):"manager-sign"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3",children:[a.jsx(Ce,{className:"w-8 h-8 text-green-600"}),"Manager Signature Required"]}),a.jsx("div",{className:"mb-6",children:a.jsxs("p",{className:"text-gray-700 mb-4",children:["Please sign to confirm this follow-up review with"," ",a.jsx("strong",{children:s.employeeName}),"."]})}),a.jsx(za,{onSignatureChange:P,label:"Manager Signature",required:!0}),a.jsx("div",{className:"flex justify-between mt-6",children:a.jsx("button",{type:"button",onClick:()=>$("review"),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Review"})})]})})}):"employee-decision"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full",children:a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-3",children:[a.jsx(O,{className:"w-8 h-8 text-green-600"}),"Employee Acknowledgment"]}),a.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:a.jsx(H,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"mb-6",children:[a.jsxs("p",{className:"text-gray-700 mb-4",children:["Please ask ",a.jsx("strong",{children:s.employeeName})," if they acknowledge this follow-up review and would like to provide their signature."]}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:a.jsxs("p",{className:"text-green-800 text-sm",children:[a.jsx("strong",{children:"Note:"})," Employee signature confirms they participated in this follow-up review."]})})]}),E?a.jsxs("div",{children:[a.jsx(za,{onSignatureChange:U,label:"Employee Signature"}),a.jsxs("div",{className:"flex justify-between mt-6",children:[a.jsx("button",{type:"button",onClick:()=>R(!1),className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Back to Decision"}),a.jsx("button",{type:"button",onClick:()=>W(),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Skip Signature & Submit"})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsx("p",{className:"text-gray-700 font-medium",children:"Does the employee consent to sign?"}),a.jsxs("div",{className:"flex gap-4",children:[a.jsxs("button",{onClick:()=>F(!0),className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 flex items-center gap-2",children:[a.jsx(Ce,{className:"w-4 h-4"}),"Yes, employee will sign"]}),a.jsxs("button",{onClick:()=>F(!1),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 flex items-center gap-2",children:[a.jsx(H,{className:"w-4 h-4"}),"No, proceed without signature"]})]})]})]})})}):"complete"===q?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-md w-full",children:a.jsxs("div",{className:"p-6 text-center",children:[a.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6",children:a.jsx(ee,{className:"h-8 w-8 text-green-600"})}),a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Follow-up Review Completed"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:["The follow-up review for ",s.employeeName," has been successfully documented and is available to HR for review."]}),a.jsx("button",{onClick:i,className:"w-full px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Return to Dashboard"}),a.jsx("p",{className:"text-sm text-gray-500 mt-4",children:"Redirecting automatically..."})]})})}):null},Ia=D.memo(({className:s=""})=>{const o=_(),{user:n}=m(),{organization:l,loading:d}=u(),{canCreateWarnings:h,canManageEmployees:g}=b(),{categories:p,employees:y,followUps:v,loading:z,isReady:I}=f({role:"hod"}),E={total:v?.length||0,overdue:v?.filter(e=>new Date(e.dueDate)<new Date).length||0,dueSoon:v?.filter(e=>{const a=new Date(e.dueDate),s=new Date,t=new Date(s.getTime()+2592e5);return a>=s&&a<=t}).length||0};(e=>{const[a,s]=D.useState(window.innerWidth>e),t=D.useCallback(()=>s(window.innerWidth>e),[e]);D.useEffect(()=>(window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)),[t])})(768);const[R,T]=D.useState(!1),[L,A]=D.useState(!1),[M,q]=D.useState(!1),[$,P]=D.useState(!1),[F,U]=D.useState(!1),[O,W]=D.useState(!1),[H,B]=D.useState(null),[V,G]=D.useState([]),[K,Y]=D.useState(!1),Z=y||[],Q=p||[],ee=D.useMemo(()=>`${n?.firstName||""} ${n?.lastName||""}`.trim()||"Manager",[n?.firstName,n?.lastName]),se=D.useMemo(()=>l?.name||"Your Organization",[l?.name]);D.useMemo(()=>0===Z.length||0===Q.length?null:{employees:Z,categories:Q,currentManagerName:ee,organizationName:se,key:`wizard-${l?.id}-${Z.length}-${Q.length}`},[Z.length,Q.length,ee,se,l?.id]),D.useEffect(()=>{!d&&p&&p.length>0&&(p.length,Z.length)},[d,p,l,Z]);const te=D.useCallback(async()=>{if(h()){if(I&&!z.overall)return 0===Q.length?(e.error("❌ No warning categories configured"),void alert("Cannot issue warning: No warning categories are configured for this organization.")):0===Z.length?(e.warn("⚠️ No team members assigned"),void alert("You have no team members assigned to you as a manager.\n\nAs a Department Manager, you can only issue warnings to employees who report directly to you.\n\nPlease contact HR to have employees assigned to your team, or switch to the HR Dashboard view if you have HR permissions.")):void T(!0);e.warn("⚠️ Please wait for data to load...")}},[h,I,Z.length,Q.length,z]),ie=D.useCallback(()=>{T(!1)},[]),oe=D.useCallback(()=>{T(!1)},[]),ne=D.useCallback(()=>{A(!0)},[]),le=D.useCallback(()=>{A(!1)},[]),ce=D.useCallback(()=>{q(!0)},[]),me=D.useCallback(()=>{q(!1)},[]),ue=D.useCallback(()=>{P(!0)},[]),he=D.useCallback(()=>{P(!1)},[]),ge=D.useCallback(e=>{e.id,B(e),W(!0)},[]),xe=D.useCallback(()=>{W(!1),B(null)},[]),ye=D.useCallback(()=>{W(!1),B(null)},[]),ve=D.useCallback(async()=>{if(l?.id&&!K){Y(!0);try{let e;if(w()&&N()){e=(await j.getActiveWarningsIndex(l.id,100)).filter(e=>"high"===e.priority).map(e=>({...e.metadata,id:e.id,employeeId:e.employeeId,level:e.metadata.level,employeeName:e.metadata.employeeName}))}else if(w()&&k()){e=(await j.getOrganizationWarnings(l.id,{level:"final_written"},{pageSize:100,orderField:"issueDate",orderDirection:"desc"})).warnings}else e=await x.warnings.getAll(l.id);const a=await x.employees.getAll(l.id),s=e.filter(e=>"final_written"===e.level).reduce((e,s)=>{const t=e.find(e=>e.employeeId===s.employeeId);if(t)t.warnings.push(s);else{const t=a.find(e=>e.id===s.employeeId);t&&e.push({...t,employeeId:s.employeeId,warnings:[s],latestFinalWarning:s,name:t.name||`${t.profile?.firstName||""} ${t.profile?.lastName||""}`.trim()})}return e},[]);s.sort((e,a)=>new Date(a.latestFinalWarning.issueDate).getTime()-new Date(e.latestFinalWarning.issueDate).getTime()),G(s)}catch(a){e.error("Failed to fetch final warning employees:",a)}finally{Y(!1)}}},[l?.id]);D.useEffect(()=>{I&&Z.length>0&&ve()},[I,Z.length,l?.id]);const be=[{id:"create-warning",title:"Issue Warning",icon:J,color:"orange",action:te,enabled:h(),hasAudioRecording:!0},{id:"book-hr-meeting",title:"HR Meeting",icon:Ie,color:"purple",action:ce,enabled:!0,hasAudioRecording:!1},{id:"report-absence",title:"Report Absence",icon:Se,color:"red",action:ue,enabled:!0,hasAudioRecording:!1},{id:"corrective-counselling",title:"Counselling",icon:ke,color:"blue",action:ne,enabled:!0,hasAudioRecording:!1}].filter(e=>e.enabled);return[{id:"team-performance",title:"Team Performance",description:"Review department performance metrics",icon:X,color:"green",action:()=>o("/team/performance"),enabled:g()},{id:"schedule-review",title:"Schedule Reviews",description:"Plan performance reviews for team members",icon:ae,color:"blue",action:()=>o("/reviews/schedule"),enabled:g()},{id:"team-goals",title:"Team Goals",description:"Set and track overall department objectives",icon:Ee,color:"indigo",action:()=>o("/goals"),enabled:g()}].filter(e=>e.enabled),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:`space-y-4 ${s}`,children:[a.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 mb-3",children:be.map(e=>a.jsx(i,{hover:!0,padding:"sm",className:"cursor-pointer transition-all duration-200 active:scale-95",onClick:e.action,style:{opacity:(z.overall||z.employees)&&"create-warning"===e.id?.5:1,background:"orange"===e.color?"linear-gradient(135deg, var(--color-warning), var(--color-warning))":"purple"===e.color?"linear-gradient(135deg, var(--color-accent), var(--color-accent))":"red"===e.color?"linear-gradient(135deg, var(--color-error), var(--color-error))":(e.color,"linear-gradient(135deg, var(--color-primary), var(--color-primary))"),color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:a.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(e.icon,{className:"w-5 h-5"}),e.hasAudioRecording&&a.jsx(pe,{className:"w-3.5 h-3.5 opacity-80"})]}),a.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:e.title}),(z.overall||z.employees)&&"create-warning"===e.id&&a.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"})]})},e.id))}),a.jsx(i,{hover:!0,padding:"none",className:"mb-3 cursor-pointer transition-all duration-200 overflow-hidden active:scale-[0.98]",onClick:()=>U(!0),style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"64px",willChange:"transform"},children:a.jsxs("div",{className:"flex items-center justify-between p-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(de,{className:"w-5 h-5"}),a.jsx("span",{className:"font-medium text-sm",children:"Team Members"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[z.employees?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):a.jsx("span",{className:"text-2xl font-bold",children:Z.length}),a.jsx(re,{className:"w-4 h-4 opacity-60"})]})]})}),E.total>0&&a.jsxs(i,{padding:"sm",children:[a.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[a.jsx(ae,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),"Follow-ups Due (",E.due,")"]}),a.jsx("div",{className:"space-y-1",children:v.slice(0,3).map(e=>a.jsxs(r,{variant:"ghost",onClick:()=>ge(e),className:"w-full text-left p-2 text-sm",children:[a.jsx("div",{className:"font-medium",style:{color:"var(--color-text)"},children:e.employeeName}),a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:e.sessionType})]},e.id))})]}),V.length>0&&a.jsxs(c,{variant:"error",className:"border-2",children:[a.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2 mb-2",children:[a.jsx(J,{className:"w-4 h-4"}),"Final Warnings Watch List (",V.length,")",a.jsx(t,{variant:"error",size:"sm",className:"animate-pulse hidden sm:inline-block",children:"MONITOR CLOSELY"})]}),a.jsxs("div",{className:"space-y-1.5",children:[V.slice(0,4).map(e=>{let s;s=e.latestFinalWarning.issueDate?.toDate?e.latestFinalWarning.issueDate.toDate():e.latestFinalWarning.issueDate?.seconds?new Date(1e3*e.latestFinalWarning.issueDate.seconds):new Date(e.latestFinalWarning.issueDate);const r=Math.floor((Date.now()-s.getTime())/864e5);return a.jsx(i,{padding:"md",className:"border-2",style:{borderColor:"var(--color-alert-error-border)"},children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium",style:{color:"var(--color-alert-error-text)"},children:e.name}),a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)",opacity:.8},children:[e.latestFinalWarning.category," • ",r," days ago"]}),a.jsx("div",{className:"text-xs mt-1",style:{color:"var(--color-alert-error-text)"},children:"⚠️ Next offense requires HR intervention"})]}),a.jsx("div",{className:"text-right",children:a.jsxs(t,{variant:"error",size:"sm",children:[e.warnings.length," warning",e.warnings.length>1?"s":""]})})]})},e.employeeId)}),V.length>4&&a.jsxs("div",{className:"text-xs text-center py-2",style:{color:"var(--color-alert-error-text)",opacity:.8},children:["+",V.length-4," more employees with final warnings"]})]}),a.jsx(i,{padding:"sm",className:"mt-3",style:{backgroundColor:"var(--color-alert-error-bg)",opacity:.7},children:a.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)"},children:["💡 ",a.jsx("strong",{children:"Tip:"})," Monitor these employees closely. Any new offenses will trigger urgent HR intervention alerts."]})})]}),K&&a.jsx(i,{padding:"md",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:"var(--color-primary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Loading final warnings watch list..."})]})})]}),R&&(C?.isLegacyDevice?a.jsx(ga,{isOpen:R,onClose:oe,onSubmit:async a=>{try{await x.warnings.create(a),ie()}catch(s){throw e.error("Failed to create warning:",s),s}},employees:Z,categories:Q},"simplified-warning-wizard"):a.jsx(ma,{employees:Z,categories:Q,currentManagerName:ee,organizationName:se,onComplete:ie,onCancel:oe},"enhanced-warning-wizard")),L&&a.jsx(ya,{isOpen:L,onClose:le}),M&&a.jsx(ba,{isOpen:M,onClose:me}),$&&a.jsx(Na,{isOpen:$,onClose:he}),O&&H&&a.jsx(_a,{counsellingSession:H,onClose:xe,onComplete:ye}),F&&a.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:a.jsxs(i,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[a.jsxs("div",{className:"flex items-center justify-between p-6",style:{borderBottom:"1px solid var(--color-border)"},children:[a.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:"Team Management"}),a.jsx(r,{variant:"ghost",size:"sm",onClick:()=>U(!1),children:"×"})]}),a.jsx("div",{className:"overflow-y-auto",children:a.jsx(S,{})})]})})]})});Ia.displayName="HODDashboardSection";export{_a as C,ua as E,Ia as H,fa as U,pa as a,ja as b};
