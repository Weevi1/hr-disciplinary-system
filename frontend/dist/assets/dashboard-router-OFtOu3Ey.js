const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/business-owner-dashboard-mIihUYS1.js","assets/react-vendor-e4uWabrV.js","assets/pdf-vendor-D1mz_3s2.js","assets/firebase-vendor-ZA7KOHFb.js","assets/ui-vendor-DaBpJB-Q.js"])))=>i.map(i=>d[i]);
import{e as gt,j as e,L as D,w as X,d as Y,S as qr,b as Xe,x as ie,y as lt,z as tt,D as xe,B as va,u as ve,C as ba,s as ct,O as ya,T as J,k as qe,f as ye,G as Ca,a as Yr,H as ja,F as zt,I as wa}from"./business-owner-dashboard-mIihUYS1.js";import{r as T,g as Na,c as st,d as Ea,R as Is,u as Ba}from"./react-vendor-e4uWabrV.js";import{a as Qe}from"./pdf-vendor-D1mz_3s2.js";import{n as Ke,j as oe,l as Fe,q as Se,w as le,m as ke,A as dt,p as or,u as Aa,t as Tt,c as Da,D as rr,f as Fa,U as Sa,E as xt,G as ka,H as Ra,V as It,W as Ht}from"./firebase-vendor-ZA7KOHFb.js";import{x as Lt,a1 as Gr,M as Hs,v as _a,n as pe,ao as Vr,O as Ye,a as Qr,m as Ce,aq as Ls,X as Xr,R as Ot,ar as Os,b as at,f as $s,Q as pt,w as Us,j as vt,V as Pa,i as Zr,as as $t,J as ir,a4 as Me,a9 as za,z as Ta,P as Ia,ap as Ms,at as Ha,ad as La,g as Oa,h as bt,au as $a,av as Ua,aw as Ma,ax as Ut,C as Mt,p as Ge,a2 as Wt,ay as Wa,az as ut,al as qt,aA as qa,aB as Gt,aC as Ga,B as Va,d as Vt,aD as Qa,D as Ka,e as Ws,U as qs,c as Qt,N as Gs,K as Ya}from"./ui-vendor-DaBpJB-Q.js";import{H as Xa}from"./hr-dashboard-lJxKp818.js";import{H as Za}from"./hod-dashboard-CwiSpfyn.js";const lr={background:"#f8fafc",backgroundSecondary:"#f1f5f9",backgroundTertiary:"#e2e8f0",text:"#0f172a",textSecondary:"#475569",textTertiary:"#64748b",textInverse:"#ffffff",border:"#e2e8f0",borderSecondary:"#cbd5e1",cardBackground:"#ffffff",cardBorder:"#e2e8f0",inputBackground:"#ffffff",inputBorder:"#cbd5e1",inputBorderFocus:"#3b82f6",primary:"#3b82f6",primaryHover:"#2563eb",secondary:"#6366f1",secondaryHover:"#4f46e5",accent:"#10b981",accentHover:"#059669",success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6",muted:"#f3f4f6",mutedHover:"#e5e7eb",subtle:"#f9fafb",emphasis:"#1f2937",highlight:"#fef3c7",selection:"#dbeafe",navBg:"#ffffff",navText:"#374151",navHover:"#f3f4f6",navActive:"#eff6ff",btnGhost:"transparent",btnGhostHover:"#f3f4f6",btnOutline:"transparent",btnOutlineBorder:"#d1d5db",btnOutlineHover:"#f9fafb",alertInfoBg:"#eff6ff",alertInfoBorder:"#bfdbfe",alertInfoText:"#1e40af",alertSuccessBg:"#ecfdf5",alertSuccessBorder:"#a7f3d0",alertSuccessText:"#065f46",alertWarningBg:"#fffbeb",alertWarningBorder:"#fed7aa",alertWarningText:"#92400e",alertErrorBg:"#fef2f2",alertErrorBorder:"#fecaca",alertErrorText:"#991b1b",badgeDefault:"#f3f4f6",badgeDefaultText:"#374151",badgePrimary:"#eff6ff",badgePrimaryText:"#1e40af",badgeSuccess:"#ecfdf5",badgeSuccessText:"#065f46",badgeWarning:"#fffbeb",badgeWarningText:"#92400e",badgeError:"#fef2f2",badgeErrorText:"#991b1b",navTabActive:"#3b82f6",navTabInactive:"#6b7280",navTabHover:"#4b5563",statCardBg:"#ffffff",metricPositive:"#10b981",metricNegative:"#ef4444",urgentBg:"#fef2f2",urgentBorder:"#fecaca",urgentText:"#991b1b",hoverOverlay:"rgba(0, 0, 0, 0.05)",focusRing:"#3b82f6",loadingBg:"#f9fafb",shadowSm:"0 1px 2px 0 rgb(0 0 0 / 0.05)",shadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)",shadowLg:"0 10px 15px -3px rgb(0 0 0 / 0.1)",shadowXl:"0 20px 25px -5px rgb(0 0 0 / 0.1)"},Ja={background:"#0a0e1a",backgroundSecondary:"#151b2e",backgroundTertiary:"#1f2937",text:"#f8fafc",textSecondary:"#e2e8f0",textTertiary:"#94a3b8",textInverse:"#0a0e1a",border:"#374151",borderSecondary:"#4b5563",cardBackground:"#1a202c",cardBorder:"#2d3748",inputBackground:"#1a202c",inputBorder:"#4a5568",inputBorderFocus:"#63b3ed",primary:"#60a5fa",primaryHover:"#3b82f6",secondary:"#a78bfa",secondaryHover:"#8b5cf6",accent:"#34d399",accentHover:"#10b981",success:"#48cc8b",warning:"#f6ad55",error:"#fc8181",info:"#63b3ed",muted:"#374151",mutedHover:"#4b5563",subtle:"#1f2937",emphasis:"#f9fafb",highlight:"#365314",selection:"#1e3a8a",navBg:"#1a202c",navText:"#e2e8f0",navHover:"#2d3748",navActive:"#2c5282",btnGhost:"transparent",btnGhostHover:"#2d3748",btnOutline:"transparent",btnOutlineBorder:"#4a5568",btnOutlineHover:"#2d3748",alertInfoBg:"#1e3a8a",alertInfoBorder:"#3b82f6",alertInfoText:"#93c5fd",alertSuccessBg:"#065f46",alertSuccessBorder:"#059669",alertSuccessText:"#a7f3d0",alertWarningBg:"#92400e",alertWarningBorder:"#d97706",alertWarningText:"#fcd34d",alertErrorBg:"#991b1b",alertErrorBorder:"#dc2626",alertErrorText:"#fca5a5",badgeDefault:"#374151",badgeDefaultText:"#d1d5db",badgePrimary:"#1e3a8a",badgePrimaryText:"#93c5fd",badgeSuccess:"#065f46",badgeSuccessText:"#a7f3d0",badgeWarning:"#92400e",badgeWarningText:"#fcd34d",badgeError:"#991b1b",badgeErrorText:"#fca5a5",navTabActive:"#60a5fa",navTabInactive:"#9ca3af",navTabHover:"#d1d5db",statCardBg:"#1a202c",metricPositive:"#34d399",metricNegative:"#fc8181",urgentBg:"#991b1b",urgentBorder:"#dc2626",urgentText:"#fca5a5",hoverOverlay:"rgba(255, 255, 255, 0.1)",focusRing:"#60a5fa",loadingBg:"#1f2937",shadowSm:"0 1px 3px 0 rgb(0 0 0 / 0.5)",shadow:"0 4px 6px -1px rgb(0 0 0 / 0.6), 0 2px 4px -1px rgb(0 0 0 / 0.3)",shadowLg:"0 10px 15px -3px rgb(0 0 0 / 0.7), 0 4px 6px -2px rgb(0 0 0 / 0.4)",shadowXl:"0 20px 25px -5px rgb(0 0 0 / 0.8), 0 10px 10px -5px rgb(0 0 0 / 0.5)"},e0=(l,r,s)=>({...lr,primary:l,primaryHover:nt(l,-15),secondary:r,secondaryHover:nt(r,-15),accent:s,accentHover:nt(s,-15),inputBorderFocus:l,background:M("#fafafa",l,.04),backgroundSecondary:M("#f5f5f5",l,.06),backgroundTertiary:M("#eeeeee",l,.08),cardBackground:M("#ffffff",l,.02),cardBorder:M("#e5e7eb",l,.15),inputBackground:M("#ffffff",l,.01),inputBorder:M("#d1d5db",l,.2),textSecondary:M("#6b7280",l,.1),textTertiary:M("#9ca3af",l,.15),border:M("#e5e7eb",l,.2),borderSecondary:M("#d1d5db",l,.25),muted:M("#f3f4f6",l,.08),mutedHover:M("#e5e7eb",l,.1),subtle:M("#f9fafb",l,.04),emphasis:M("#1f2937",l,.1),highlight:M("#fef3c7",l,.15),selection:M("#dbeafe",l,.3),navBg:M("#ffffff",l,.03),navText:M("#374151",l,.1),navHover:M("#f3f4f6",l,.1),navActive:M("#eff6ff",l,.2),btnGhost:"transparent",btnGhostHover:M("#f3f4f6",l,.1),btnOutline:"transparent",btnOutlineBorder:M("#d1d5db",l,.3),btnOutlineHover:M("#f9fafb",l,.08),alertInfoBg:M("#eff6ff",l,.2),alertInfoBorder:M("#bfdbfe",l,.3),alertInfoText:M("#1e40af",l,.2),alertSuccessBg:M("#ecfdf5",s,.2),alertSuccessBorder:M("#a7f3d0",s,.3),alertSuccessText:M("#065f46",s,.2),alertWarningBg:"#fffbeb",alertWarningBorder:"#fed7aa",alertWarningText:"#92400e",alertErrorBg:"#fef2f2",alertErrorBorder:"#fecaca",alertErrorText:"#991b1b",badgeDefault:M("#f3f4f6",l,.1),badgeDefaultText:M("#374151",l,.15),badgePrimary:M("#eff6ff",l,.3),badgePrimaryText:M("#1e40af",l,.2),badgeSuccess:M("#ecfdf5",s,.3),badgeSuccessText:M("#065f46",s,.2),badgeWarning:"#fffbeb",badgeWarningText:"#92400e",badgeError:"#fef2f2",badgeErrorText:"#991b1b",navTabActive:l,navTabInactive:M("#6b7280",l,.2),navTabHover:M("#4b5563",l,.15),statCardBg:M("#ffffff",l,.02),metricPositive:s,metricNegative:"#ef4444",urgentBg:M("#fef2f2",l,.1),urgentBorder:M("#fecaca",l,.2),urgentText:M("#991b1b",l,.1),hoverOverlay:he(l,.08),focusRing:l,loadingBg:M("#f9fafb",l,.05),shadowSm:`0 1px 2px 0 ${he(l,.1)}`,shadow:`0 4px 6px -1px ${he(l,.15)}, 0 2px 4px -1px ${he(l,.06)}`,shadowLg:`0 10px 15px -3px ${he(l,.2)}, 0 4px 6px -2px ${he(l,.08)}`,shadowXl:`0 20px 25px -5px ${he(l,.25)}, 0 10px 10px -5px ${he(l,.1)}`});function nt(l,r){const s=l[0]==="#",t=s?l.slice(1):l,i=parseInt(t,16);let d=(i>>16)+r,y=(i>>8&255)+r,g=(i&255)+r;return d=d>255?255:d<0?0:d,y=y>255?255:y<0?0:y,g=g>255?255:g<0?0:g,(s?"#":"")+(d<<16|y<<8|g).toString(16).padStart(6,"0")}function M(l,r,s){const t=mt(l),i=mt(r);if(!t||!i)return l;const d=Math.round(t.r*(1-s)+i.r*s),y=Math.round(t.g*(1-s)+i.g*s),g=Math.round(t.b*(1-s)+i.b*s);return`#${((1<<24)+(d<<16)+(y<<8)+g).toString(16).slice(1)}`}function mt(l){const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(l);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null}function he(l,r){const s=mt(l);return s?`rgba(${s.r}, ${s.g}, ${s.b}, ${r})`:`rgba(0, 0, 0, ${r})`}function r0(l){const r=document.documentElement;r.style.setProperty("--color-background",l.background),r.style.setProperty("--color-background-secondary",l.backgroundSecondary),r.style.setProperty("--color-background-tertiary",l.backgroundTertiary),r.style.setProperty("--color-text",l.text),r.style.setProperty("--color-text-secondary",l.textSecondary),r.style.setProperty("--color-text-tertiary",l.textTertiary),r.style.setProperty("--color-text-inverse",l.textInverse),r.style.setProperty("--color-border",l.border),r.style.setProperty("--color-border-secondary",l.borderSecondary),r.style.setProperty("--color-card-background",l.cardBackground),r.style.setProperty("--color-card-border",l.cardBorder),r.style.setProperty("--color-input-background",l.inputBackground),r.style.setProperty("--color-input-border",l.inputBorder),r.style.setProperty("--color-input-border-focus",l.inputBorderFocus),r.style.setProperty("--color-primary",l.primary),r.style.setProperty("--color-primary-hover",l.primaryHover),r.style.setProperty("--color-secondary",l.secondary),r.style.setProperty("--color-secondary-hover",l.secondaryHover),r.style.setProperty("--color-accent",l.accent),r.style.setProperty("--color-accent-hover",l.accentHover),r.style.setProperty("--color-success",l.success),r.style.setProperty("--color-warning",l.warning),r.style.setProperty("--color-error",l.error),r.style.setProperty("--color-info",l.info),r.style.setProperty("--color-muted",l.muted),r.style.setProperty("--color-muted-hover",l.mutedHover),r.style.setProperty("--color-subtle",l.subtle),r.style.setProperty("--color-emphasis",l.emphasis),r.style.setProperty("--color-highlight",l.highlight),r.style.setProperty("--color-selection",l.selection),r.style.setProperty("--color-nav-bg",l.navBg),r.style.setProperty("--color-nav-text",l.navText),r.style.setProperty("--color-nav-hover",l.navHover),r.style.setProperty("--color-nav-active",l.navActive),r.style.setProperty("--color-btn-ghost",l.btnGhost),r.style.setProperty("--color-btn-ghost-hover",l.btnGhostHover),r.style.setProperty("--color-btn-outline",l.btnOutline),r.style.setProperty("--color-btn-outline-border",l.btnOutlineBorder),r.style.setProperty("--color-btn-outline-hover",l.btnOutlineHover),r.style.setProperty("--color-alert-info-bg",l.alertInfoBg),r.style.setProperty("--color-alert-info-border",l.alertInfoBorder),r.style.setProperty("--color-alert-info-text",l.alertInfoText),r.style.setProperty("--color-alert-success-bg",l.alertSuccessBg),r.style.setProperty("--color-alert-success-border",l.alertSuccessBorder),r.style.setProperty("--color-alert-success-text",l.alertSuccessText),r.style.setProperty("--color-alert-warning-bg",l.alertWarningBg),r.style.setProperty("--color-alert-warning-border",l.alertWarningBorder),r.style.setProperty("--color-alert-warning-text",l.alertWarningText),r.style.setProperty("--color-alert-error-bg",l.alertErrorBg),r.style.setProperty("--color-alert-error-border",l.alertErrorBorder),r.style.setProperty("--color-alert-error-text",l.alertErrorText),r.style.setProperty("--color-badge-default",l.badgeDefault),r.style.setProperty("--color-badge-default-text",l.badgeDefaultText),r.style.setProperty("--color-badge-primary",l.badgePrimary),r.style.setProperty("--color-badge-primary-text",l.badgePrimaryText),r.style.setProperty("--color-badge-success",l.badgeSuccess),r.style.setProperty("--color-badge-success-text",l.badgeSuccessText),r.style.setProperty("--color-badge-warning",l.badgeWarning),r.style.setProperty("--color-badge-warning-text",l.badgeWarningText),r.style.setProperty("--color-badge-error",l.badgeError),r.style.setProperty("--color-badge-error-text",l.badgeErrorText),r.style.setProperty("--color-nav-tab-active",l.navTabActive),r.style.setProperty("--color-nav-tab-inactive",l.navTabInactive),r.style.setProperty("--color-nav-tab-hover",l.navTabHover),r.style.setProperty("--color-stat-card-bg",l.statCardBg),r.style.setProperty("--color-metric-positive",l.metricPositive),r.style.setProperty("--color-metric-negative",l.metricNegative),r.style.setProperty("--color-urgent-bg",l.urgentBg),r.style.setProperty("--color-urgent-border",l.urgentBorder),r.style.setProperty("--color-urgent-text",l.urgentText),r.style.setProperty("--color-hover-overlay",l.hoverOverlay),r.style.setProperty("--color-focus-ring",l.focusRing),r.style.setProperty("--color-loading-bg",l.loadingBg),r.style.setProperty("--shadow-sm",l.shadowSm),r.style.setProperty("--shadow",l.shadow),r.style.setProperty("--shadow-lg",l.shadowLg),r.style.setProperty("--shadow-xl",l.shadowXl)}const Vs=T.createContext(null),Kt="hr-system-theme",t0=()=>{const l=T.useContext(Vs);if(!l)throw new Error("useTheme must be used within a ThemeProvider");return l},io=({children:l})=>{let r=null;try{r=gt().organization}catch{}const[s,t]=T.useState("light"),[i,d]=T.useState(lr),[y,g]=T.useState(!0);T.useEffect(()=>{const n=localStorage.getItem(Kt);n&&["light","dark","branded"].includes(n)&&t(n),g(!1)},[]);const p=T.useCallback(n=>{switch(n){case"dark":return Ja;case"branded":if(r?.branding){const{primaryColor:h,secondaryColor:u,accentColor:x}=r.branding;return e0(h||"#3b82f6",u||"#6366f1",x||"#10b981")}return lr;case"light":default:return lr}},[r]);T.useEffect(()=>{const n=p(s);d(n),r0(n),localStorage.setItem(Kt,s),s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[s,p]);const a=T.useCallback(n=>{t(n)},[]),c=T.useCallback(()=>{t(n=>{switch(n){case"light":return"dark";case"dark":return"branded";case"branded":return"light";default:return"light"}})},[]),o={currentTheme:s,themeColors:i,setTheme:a,toggleTheme:c,isLoading:y};return T.useEffect(()=>{y||(document.body.style.transition="background-color 0.3s ease, color 0.3s ease")},[y]),e.jsx(Vs.Provider,{value:o,children:l})};class s0{async calculateCommission(r){try{D.debug("Calculating commission for payment...",r);const s=await X.getOrganization(r.organizationId);if(!s?.resellerId)throw new Error("No reseller assigned to organization");if(!await X.getReseller(s.resellerId))throw new Error("Reseller not found");const i=r.grossAmount-r.stripeFees,d=Math.round(i*.5),y=Math.round(i*.3),g=Math.round(i*.2),p={id:`${r.organizationId}-${r.periodStart}`,resellerId:s.resellerId,organizationId:r.organizationId,subscriptionId:r.subscriptionId,periodStart:r.periodStart,periodEnd:r.periodEnd,clientRevenue:r.grossAmount,stripeFees:r.stripeFees,netRevenue:i,commissionAmount:d,ownerAmount:y,companyAmount:g,status:"calculated",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Ke(oe(Y,"commissions",p.id),p),D.success("Commission calculated and saved:",p),p}catch(s){throw D.error("Failed to calculate commission:",s),s}}async processMonthlyPayouts(){try{D.debug("Processing monthly commission payouts...");const r=new Date;r.setDate(r.getDate()-30);const s=Fe(Y,"commissions"),t=Se(s,le("status","==","calculated"),le("createdAt","<",r.toISOString())),d=(await ke(t)).docs.map(p=>({id:p.id,...p.data()}));D.debug(`Found ${d.length} eligible commissions for payout`);const y=this.groupCommissionsByResellerMonth(d),g=[];for(const[p,a]of Object.entries(y)){const[c,o]=p.split("|"),n=await X.getReseller(c);if(!n)continue;const h=a.reduce((b,v)=>b+v.commissionAmount,0),u=a.reduce((b,v)=>b+v.netRevenue,0),x={resellerId:c,resellerName:`${n.firstName} ${n.lastName}`,month:o,province:n.province,totalClients:a.length,totalRevenue:u,totalCommission:h,commissions:a,payoutStatus:"pending",payoutDate:new Date().toISOString()};await Ke(oe(Y,"commissionReports",`${c}-${o}`),x);const m=dt(Y);for(const b of a)m.update(oe(Y,"commissions",b.id),{status:"pending",updatedAt:or()});await m.commit(),g.push(x),D.success(`Generated commission report for ${n.firstName} ${n.lastName}: R${(h/100).toFixed(2)}`)}return g}catch(r){throw D.error("Failed to process monthly payouts:",r),r}}async markCommissionsPaid(r,s,t){try{D.debug("Marking commissions as paid...",{resellerId:r,month:s,payoutReference:t});const i=`${r}-${s}`;await Aa(oe(Y,"commissionReports",i),{payoutStatus:"paid",payoutReference:t,updatedAt:or()});const d=Fe(Y,"commissions"),y=Se(d,le("resellerId","==",r),le("status","==","pending")),g=await ke(y),p=dt(Y);g.docs.forEach(a=>{p.update(a.ref,{status:"paid",payoutReference:t,updatedAt:or()})}),await p.commit(),D.success("Commissions marked as paid",{resellerId:r,month:s,payoutReference:t})}catch(i){throw D.error("Failed to mark commissions as paid:",i),i}}async getResellerMetrics(r){try{if(D.debug(`Getting metrics for reseller: ${r}`),!await X.getReseller(r))throw new Error("Reseller not found");const t=await X.getResellerClients(r),i=t.filter(F=>F.isActive!==!1),d=Fe(Y,"commissions"),y=Se(d,le("resellerId","==",r)),p=(await ke(y)).docs.map(F=>F.data()),a=p.reduce((F,z)=>F+z.commissionAmount,0),c=p.reduce((F,z)=>F+z.netRevenue,0),o=new Date().toISOString().slice(0,7),n=p.filter(F=>F.periodStart.startsWith(o)),h=n.reduce((F,z)=>F+z.netRevenue,0),u=n.reduce((F,z)=>F+z.commissionAmount,0),x=i.length>0?h/i.length:0;let m="None";if(t.length>0){const z=t.map(E=>({name:E.name,revenue:E.monthlySubscription||0})).sort((E,B)=>B.revenue-E.revenue)[0];z.revenue>0&&(m=z.name)}const b=new Date;b.setMonth(b.getMonth()-1);const v=b.toISOString().slice(0,7),j=p.filter(F=>F.periodStart.startsWith(v)).reduce((F,z)=>F+z.netRevenue,0),C=j>0?(h-j)/j*100:0,A={totalClients:t.length,activeClients:i.length,monthlyRecurringRevenue:h,totalCommissionsEarned:a,monthlyCommissions:u,averageClientValue:x,monthlyGrowth:C,conversionRate:75,topPerformingClient:m};return D.success("Reseller metrics calculated:",A),A}catch(s){return D.error("Failed to get reseller metrics:",s),{totalClients:0,activeClients:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0,monthlyCommissions:0,averageClientValue:0,monthlyGrowth:0,conversionRate:0,topPerformingClient:"None"}}}async getProvincialMetrics(){try{D.debug("Getting provincial metrics...");const r=await X.getAllResellers(),s={};for(const t of r){const i=t.province;s[i]||(s[i]={resellers:0,clients:0,monthlyRevenue:0,commissionsOwed:0}),s[i].resellers+=1,s[i].clients+=t.clientIds.length,s[i].monthlyRevenue+=t.monthlyRecurringRevenue;const d=Fe(Y,"commissions"),y=Se(d,le("resellerId","==",t.id),le("status","in",["pending","calculated"])),p=(await ke(y)).docs.reduce((a,c)=>a+(c.data().commissionAmount||0),0);s[i].commissionsOwed+=p}return D.success("Provincial metrics calculated:",s),s}catch(r){throw D.error("Failed to get provincial metrics:",r),r}}groupCommissionsByResellerMonth(r){const s={};for(const t of r){const i=t.periodStart.slice(0,7),d=`${t.resellerId}|${i}`;s[d]||(s[d]=[]),s[d].push(t)}return s}async getRecentCommissions(r,s=5){try{D.debug(`Getting recent commissions for reseller: ${r}`);const t=Fe(Y,"commissions"),i=Se(t,le("resellerId","==",r),Tt("createdAt","desc")),y=(await ke(i)).docs.map(p=>p.data()),g=[];for(let p=0;p<Math.min(y.length,s);p++){const a=y[p];let c="Unknown Client";try{const o=await X.getOrganization(a.organizationId);o&&(c=o.name)}catch{D.warn(`Could not get organization name for ${a.organizationId}`)}g.push({id:a.id,clientName:c,periodStart:a.periodStart,periodEnd:a.periodEnd,commissionAmount:a.commissionAmount,baseAmount:a.netRevenue,commissionRate:.5})}return D.success(`Retrieved ${g.length} recent commissions for reseller`),g}catch(t){return D.error("Failed to get recent commissions:",t),[]}}async getPerformanceTrend(r,s){try{D.debug(`Getting performance trend for reseller: ${r}, timeframe: ${s}`);const t=s==="3m"?3:s==="6m"?6:12,i=Fe(Y,"commissions"),d=Se(i,le("resellerId","==",r),Tt("periodStart","desc")),g=(await ke(d)).docs.map(o=>o.data()),p={};g.forEach(o=>{const n=o.periodStart.slice(0,7);p[n]||(p[n]={revenue:0,commissions:0}),p[n].revenue+=o.netRevenue,p[n].commissions+=o.commissionAmount});const a=[],c=new Date;for(let o=0;o<t;o++){const n=new Date(c.getFullYear(),c.getMonth()-o,1),h=n.toISOString().slice(0,7),u=n.toLocaleDateString("en-US",{month:"short",year:"numeric"});a.unshift({month:u,revenue:p[h]?.revenue||0,commissions:p[h]?.commissions||0})}return D.success(`Retrieved ${a.length} months of performance data for reseller`),a}catch(t){return D.error("Failed to get performance trend:",t),[]}}async generateCommissionStatement(r){try{D.debug(`Generating commission statement for reseller: ${r}`),D.warn("Commission statement generation not yet implemented - feature requested"),await new Promise(s=>setTimeout(s,1e3))}catch(s){throw D.error("Failed to generate commission statement:",s),s}}async getClientMetrics(r){try{D.debug("Loading client metrics...",{organizationId:r});const s=await X.getOrganization(r);if(!s)throw new Error("Organization not found");const i=(await qr.loadEmployees(r)).documents,y=(await qr.loadWarnings(r)).documents,g=new Date;g.setDate(1);const p=y.filter(a=>new Date(a.issueDate)>=g).length;return{monthlyRevenue:s.monthlySubscription||5e4,employeeCount:i.length,lastActivity:new Date().toISOString(),subscriptionStatus:s.isActive===!1?"inactive":"active",warningsThisMonth:p,complianceScore:Math.max(95-p*5,60)}}catch(s){return D.error("Failed to get client metrics:",s),{monthlyRevenue:0,employeeCount:0,lastActivity:new Date().toISOString(),subscriptionStatus:"inactive",warningsThisMonth:0,complianceScore:0}}}formatCurrency(r){return`R${(r/100).toFixed(2)}`}}const We=new s0;var cr={exports:{}};function a0(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var dr={exports:{}};const n0={},o0=Object.freeze(Object.defineProperty({__proto__:null,default:n0},Symbol.toStringTag,{value:"Module"})),i0=Na(o0);var l0=dr.exports,Yt;function V(){return Yt||(Yt=1,(function(l,r){(function(s,t){l.exports=t()})(l0,function(){var s=s||(function(t,i){var d;if(typeof window<"u"&&window.crypto&&(d=window.crypto),typeof self<"u"&&self.crypto&&(d=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(d=globalThis.crypto),!d&&typeof window<"u"&&window.msCrypto&&(d=window.msCrypto),!d&&typeof st<"u"&&st.crypto&&(d=st.crypto),!d&&typeof a0=="function")try{d=i0}catch{}var y=function(){if(d){if(typeof d.getRandomValues=="function")try{return d.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof d.randomBytes=="function")try{return d.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},g=Object.create||(function(){function v(){}return function(f){var j;return v.prototype=f,j=new v,v.prototype=null,j}})(),p={},a=p.lib={},c=a.Base=(function(){return{extend:function(v){var f=g(this);return v&&f.mixIn(v),(!f.hasOwnProperty("init")||this.init===f.init)&&(f.init=function(){f.$super.init.apply(this,arguments)}),f.init.prototype=f,f.$super=this,f},create:function(){var v=this.extend();return v.init.apply(v,arguments),v},init:function(){},mixIn:function(v){for(var f in v)v.hasOwnProperty(f)&&(this[f]=v[f]);v.hasOwnProperty("toString")&&(this.toString=v.toString)},clone:function(){return this.init.prototype.extend(this)}}})(),o=a.WordArray=c.extend({init:function(v,f){v=this.words=v||[],f!=i?this.sigBytes=f:this.sigBytes=v.length*4},toString:function(v){return(v||h).stringify(this)},concat:function(v){var f=this.words,j=v.words,C=this.sigBytes,w=v.sigBytes;if(this.clamp(),C%4)for(var A=0;A<w;A++){var F=j[A>>>2]>>>24-A%4*8&255;f[C+A>>>2]|=F<<24-(C+A)%4*8}else for(var z=0;z<w;z+=4)f[C+z>>>2]=j[z>>>2];return this.sigBytes+=w,this},clamp:function(){var v=this.words,f=this.sigBytes;v[f>>>2]&=4294967295<<32-f%4*8,v.length=t.ceil(f/4)},clone:function(){var v=c.clone.call(this);return v.words=this.words.slice(0),v},random:function(v){for(var f=[],j=0;j<v;j+=4)f.push(y());return new o.init(f,v)}}),n=p.enc={},h=n.Hex={stringify:function(v){for(var f=v.words,j=v.sigBytes,C=[],w=0;w<j;w++){var A=f[w>>>2]>>>24-w%4*8&255;C.push((A>>>4).toString(16)),C.push((A&15).toString(16))}return C.join("")},parse:function(v){for(var f=v.length,j=[],C=0;C<f;C+=2)j[C>>>3]|=parseInt(v.substr(C,2),16)<<24-C%8*4;return new o.init(j,f/2)}},u=n.Latin1={stringify:function(v){for(var f=v.words,j=v.sigBytes,C=[],w=0;w<j;w++){var A=f[w>>>2]>>>24-w%4*8&255;C.push(String.fromCharCode(A))}return C.join("")},parse:function(v){for(var f=v.length,j=[],C=0;C<f;C++)j[C>>>2]|=(v.charCodeAt(C)&255)<<24-C%4*8;return new o.init(j,f)}},x=n.Utf8={stringify:function(v){try{return decodeURIComponent(escape(u.stringify(v)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(v){return u.parse(unescape(encodeURIComponent(v)))}},m=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(v){typeof v=="string"&&(v=x.parse(v)),this._data.concat(v),this._nDataBytes+=v.sigBytes},_process:function(v){var f,j=this._data,C=j.words,w=j.sigBytes,A=this.blockSize,F=A*4,z=w/F;v?z=t.ceil(z):z=t.max((z|0)-this._minBufferSize,0);var E=z*A,B=t.min(E*4,w);if(E){for(var k=0;k<E;k+=A)this._doProcessBlock(C,k);f=C.splice(0,E),j.sigBytes-=B}return new o.init(f,B)},clone:function(){var v=c.clone.call(this);return v._data=this._data.clone(),v},_minBufferSize:0});a.Hasher=m.extend({cfg:c.extend(),init:function(v){this.cfg=this.cfg.extend(v),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(v){return this._append(v),this._process(),this},finalize:function(v){v&&this._append(v);var f=this._doFinalize();return f},blockSize:16,_createHelper:function(v){return function(f,j){return new v.init(j).finalize(f)}},_createHmacHelper:function(v){return function(f,j){return new b.HMAC.init(v,j).finalize(f)}}});var b=p.algo={};return p})(Math);return s})})(dr)),dr.exports}var xr={exports:{}},c0=xr.exports,Xt;function Jr(){return Xt||(Xt=1,(function(l,r){(function(s,t){l.exports=t(V())})(c0,function(s){return(function(t){var i=s,d=i.lib,y=d.Base,g=d.WordArray,p=i.x64={};p.Word=y.extend({init:function(a,c){this.high=a,this.low=c}}),p.WordArray=y.extend({init:function(a,c){a=this.words=a||[],c!=t?this.sigBytes=c:this.sigBytes=a.length*8},toX32:function(){for(var a=this.words,c=a.length,o=[],n=0;n<c;n++){var h=a[n];o.push(h.high),o.push(h.low)}return g.create(o,this.sigBytes)},clone:function(){for(var a=y.clone.call(this),c=a.words=this.words.slice(0),o=c.length,n=0;n<o;n++)c[n]=c[n].clone();return a}})})(),s})})(xr)),xr.exports}var ur={exports:{}},d0=ur.exports,Zt;function x0(){return Zt||(Zt=1,(function(l,r){(function(s,t){l.exports=t(V())})(d0,function(s){return(function(){if(typeof ArrayBuffer=="function"){var t=s,i=t.lib,d=i.WordArray,y=d.init,g=d.init=function(p){if(p instanceof ArrayBuffer&&(p=new Uint8Array(p)),(p instanceof Int8Array||typeof Uint8ClampedArray<"u"&&p instanceof Uint8ClampedArray||p instanceof Int16Array||p instanceof Uint16Array||p instanceof Int32Array||p instanceof Uint32Array||p instanceof Float32Array||p instanceof Float64Array)&&(p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength)),p instanceof Uint8Array){for(var a=p.byteLength,c=[],o=0;o<a;o++)c[o>>>2]|=p[o]<<24-o%4*8;y.call(this,c,a)}else y.apply(this,arguments)};g.prototype=d}})(),s.lib.WordArray})})(ur)),ur.exports}var mr={exports:{}},u0=mr.exports,Jt;function m0(){return Jt||(Jt=1,(function(l,r){(function(s,t){l.exports=t(V())})(u0,function(s){return(function(){var t=s,i=t.lib,d=i.WordArray,y=t.enc;y.Utf16=y.Utf16BE={stringify:function(p){for(var a=p.words,c=p.sigBytes,o=[],n=0;n<c;n+=2){var h=a[n>>>2]>>>16-n%4*8&65535;o.push(String.fromCharCode(h))}return o.join("")},parse:function(p){for(var a=p.length,c=[],o=0;o<a;o++)c[o>>>1]|=p.charCodeAt(o)<<16-o%2*16;return d.create(c,a*2)}},y.Utf16LE={stringify:function(p){for(var a=p.words,c=p.sigBytes,o=[],n=0;n<c;n+=2){var h=g(a[n>>>2]>>>16-n%4*8&65535);o.push(String.fromCharCode(h))}return o.join("")},parse:function(p){for(var a=p.length,c=[],o=0;o<a;o++)c[o>>>1]|=g(p.charCodeAt(o)<<16-o%2*16);return d.create(c,a*2)}};function g(p){return p<<8&4278255360|p>>>8&16711935}})(),s.enc.Utf16})})(mr)),mr.exports}var fr={exports:{}},f0=fr.exports,es;function Ne(){return es||(es=1,(function(l,r){(function(s,t){l.exports=t(V())})(f0,function(s){return(function(){var t=s,i=t.lib,d=i.WordArray,y=t.enc;y.Base64={stringify:function(p){var a=p.words,c=p.sigBytes,o=this._map;p.clamp();for(var n=[],h=0;h<c;h+=3)for(var u=a[h>>>2]>>>24-h%4*8&255,x=a[h+1>>>2]>>>24-(h+1)%4*8&255,m=a[h+2>>>2]>>>24-(h+2)%4*8&255,b=u<<16|x<<8|m,v=0;v<4&&h+v*.75<c;v++)n.push(o.charAt(b>>>6*(3-v)&63));var f=o.charAt(64);if(f)for(;n.length%4;)n.push(f);return n.join("")},parse:function(p){var a=p.length,c=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var n=0;n<c.length;n++)o[c.charCodeAt(n)]=n}var h=c.charAt(64);if(h){var u=p.indexOf(h);u!==-1&&(a=u)}return g(p,a,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function g(p,a,c){for(var o=[],n=0,h=0;h<a;h++)if(h%4){var u=c[p.charCodeAt(h-1)]<<h%4*2,x=c[p.charCodeAt(h)]>>>6-h%4*2,m=u|x;o[n>>>2]|=m<<24-n%4*8,n++}return d.create(o,n)}})(),s.enc.Base64})})(fr)),fr.exports}var hr={exports:{}},h0=hr.exports,rs;function g0(){return rs||(rs=1,(function(l,r){(function(s,t){l.exports=t(V())})(h0,function(s){return(function(){var t=s,i=t.lib,d=i.WordArray,y=t.enc;y.Base64url={stringify:function(p,a){a===void 0&&(a=!0);var c=p.words,o=p.sigBytes,n=a?this._safe_map:this._map;p.clamp();for(var h=[],u=0;u<o;u+=3)for(var x=c[u>>>2]>>>24-u%4*8&255,m=c[u+1>>>2]>>>24-(u+1)%4*8&255,b=c[u+2>>>2]>>>24-(u+2)%4*8&255,v=x<<16|m<<8|b,f=0;f<4&&u+f*.75<o;f++)h.push(n.charAt(v>>>6*(3-f)&63));var j=n.charAt(64);if(j)for(;h.length%4;)h.push(j);return h.join("")},parse:function(p,a){a===void 0&&(a=!0);var c=p.length,o=a?this._safe_map:this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var h=0;h<o.length;h++)n[o.charCodeAt(h)]=h}var u=o.charAt(64);if(u){var x=p.indexOf(u);x!==-1&&(c=x)}return g(p,c,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function g(p,a,c){for(var o=[],n=0,h=0;h<a;h++)if(h%4){var u=c[p.charCodeAt(h-1)]<<h%4*2,x=c[p.charCodeAt(h)]>>>6-h%4*2,m=u|x;o[n>>>2]|=m<<24-n%4*8,n++}return d.create(o,n)}})(),s.enc.Base64url})})(hr)),hr.exports}var gr={exports:{}},p0=gr.exports,ts;function Ee(){return ts||(ts=1,(function(l,r){(function(s,t){l.exports=t(V())})(p0,function(s){return(function(t){var i=s,d=i.lib,y=d.WordArray,g=d.Hasher,p=i.algo,a=[];(function(){for(var x=0;x<64;x++)a[x]=t.abs(t.sin(x+1))*4294967296|0})();var c=p.MD5=g.extend({_doReset:function(){this._hash=new y.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(x,m){for(var b=0;b<16;b++){var v=m+b,f=x[v];x[v]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360}var j=this._hash.words,C=x[m+0],w=x[m+1],A=x[m+2],F=x[m+3],z=x[m+4],E=x[m+5],B=x[m+6],k=x[m+7],_=x[m+8],H=x[m+9],I=x[m+10],L=x[m+11],Q=x[m+12],W=x[m+13],q=x[m+14],G=x[m+15],P=j[0],N=j[1],S=j[2],R=j[3];P=o(P,N,S,R,C,7,a[0]),R=o(R,P,N,S,w,12,a[1]),S=o(S,R,P,N,A,17,a[2]),N=o(N,S,R,P,F,22,a[3]),P=o(P,N,S,R,z,7,a[4]),R=o(R,P,N,S,E,12,a[5]),S=o(S,R,P,N,B,17,a[6]),N=o(N,S,R,P,k,22,a[7]),P=o(P,N,S,R,_,7,a[8]),R=o(R,P,N,S,H,12,a[9]),S=o(S,R,P,N,I,17,a[10]),N=o(N,S,R,P,L,22,a[11]),P=o(P,N,S,R,Q,7,a[12]),R=o(R,P,N,S,W,12,a[13]),S=o(S,R,P,N,q,17,a[14]),N=o(N,S,R,P,G,22,a[15]),P=n(P,N,S,R,w,5,a[16]),R=n(R,P,N,S,B,9,a[17]),S=n(S,R,P,N,L,14,a[18]),N=n(N,S,R,P,C,20,a[19]),P=n(P,N,S,R,E,5,a[20]),R=n(R,P,N,S,I,9,a[21]),S=n(S,R,P,N,G,14,a[22]),N=n(N,S,R,P,z,20,a[23]),P=n(P,N,S,R,H,5,a[24]),R=n(R,P,N,S,q,9,a[25]),S=n(S,R,P,N,F,14,a[26]),N=n(N,S,R,P,_,20,a[27]),P=n(P,N,S,R,W,5,a[28]),R=n(R,P,N,S,A,9,a[29]),S=n(S,R,P,N,k,14,a[30]),N=n(N,S,R,P,Q,20,a[31]),P=h(P,N,S,R,E,4,a[32]),R=h(R,P,N,S,_,11,a[33]),S=h(S,R,P,N,L,16,a[34]),N=h(N,S,R,P,q,23,a[35]),P=h(P,N,S,R,w,4,a[36]),R=h(R,P,N,S,z,11,a[37]),S=h(S,R,P,N,k,16,a[38]),N=h(N,S,R,P,I,23,a[39]),P=h(P,N,S,R,W,4,a[40]),R=h(R,P,N,S,C,11,a[41]),S=h(S,R,P,N,F,16,a[42]),N=h(N,S,R,P,B,23,a[43]),P=h(P,N,S,R,H,4,a[44]),R=h(R,P,N,S,Q,11,a[45]),S=h(S,R,P,N,G,16,a[46]),N=h(N,S,R,P,A,23,a[47]),P=u(P,N,S,R,C,6,a[48]),R=u(R,P,N,S,k,10,a[49]),S=u(S,R,P,N,q,15,a[50]),N=u(N,S,R,P,E,21,a[51]),P=u(P,N,S,R,Q,6,a[52]),R=u(R,P,N,S,F,10,a[53]),S=u(S,R,P,N,I,15,a[54]),N=u(N,S,R,P,w,21,a[55]),P=u(P,N,S,R,_,6,a[56]),R=u(R,P,N,S,G,10,a[57]),S=u(S,R,P,N,B,15,a[58]),N=u(N,S,R,P,W,21,a[59]),P=u(P,N,S,R,z,6,a[60]),R=u(R,P,N,S,L,10,a[61]),S=u(S,R,P,N,A,15,a[62]),N=u(N,S,R,P,H,21,a[63]),j[0]=j[0]+P|0,j[1]=j[1]+N|0,j[2]=j[2]+S|0,j[3]=j[3]+R|0},_doFinalize:function(){var x=this._data,m=x.words,b=this._nDataBytes*8,v=x.sigBytes*8;m[v>>>5]|=128<<24-v%32;var f=t.floor(b/4294967296),j=b;m[(v+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,m[(v+64>>>9<<4)+14]=(j<<8|j>>>24)&16711935|(j<<24|j>>>8)&4278255360,x.sigBytes=(m.length+1)*4,this._process();for(var C=this._hash,w=C.words,A=0;A<4;A++){var F=w[A];w[A]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360}return C},clone:function(){var x=g.clone.call(this);return x._hash=this._hash.clone(),x}});function o(x,m,b,v,f,j,C){var w=x+(m&b|~m&v)+f+C;return(w<<j|w>>>32-j)+m}function n(x,m,b,v,f,j,C){var w=x+(m&v|b&~v)+f+C;return(w<<j|w>>>32-j)+m}function h(x,m,b,v,f,j,C){var w=x+(m^b^v)+f+C;return(w<<j|w>>>32-j)+m}function u(x,m,b,v,f,j,C){var w=x+(b^(m|~v))+f+C;return(w<<j|w>>>32-j)+m}i.MD5=g._createHelper(c),i.HmacMD5=g._createHmacHelper(c)})(Math),s.MD5})})(gr)),gr.exports}var pr={exports:{}},v0=pr.exports,ss;function Qs(){return ss||(ss=1,(function(l,r){(function(s,t){l.exports=t(V())})(v0,function(s){return(function(){var t=s,i=t.lib,d=i.WordArray,y=i.Hasher,g=t.algo,p=[],a=g.SHA1=y.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,o){for(var n=this._hash.words,h=n[0],u=n[1],x=n[2],m=n[3],b=n[4],v=0;v<80;v++){if(v<16)p[v]=c[o+v]|0;else{var f=p[v-3]^p[v-8]^p[v-14]^p[v-16];p[v]=f<<1|f>>>31}var j=(h<<5|h>>>27)+b+p[v];v<20?j+=(u&x|~u&m)+1518500249:v<40?j+=(u^x^m)+1859775393:v<60?j+=(u&x|u&m|x&m)-1894007588:j+=(u^x^m)-899497514,b=m,m=x,x=u<<30|u>>>2,u=h,h=j}n[0]=n[0]+h|0,n[1]=n[1]+u|0,n[2]=n[2]+x|0,n[3]=n[3]+m|0,n[4]=n[4]+b|0},_doFinalize:function(){var c=this._data,o=c.words,n=this._nDataBytes*8,h=c.sigBytes*8;return o[h>>>5]|=128<<24-h%32,o[(h+64>>>9<<4)+14]=Math.floor(n/4294967296),o[(h+64>>>9<<4)+15]=n,c.sigBytes=o.length*4,this._process(),this._hash},clone:function(){var c=y.clone.call(this);return c._hash=this._hash.clone(),c}});t.SHA1=y._createHelper(a),t.HmacSHA1=y._createHmacHelper(a)})(),s.SHA1})})(pr)),pr.exports}var vr={exports:{}},b0=vr.exports,as;function yt(){return as||(as=1,(function(l,r){(function(s,t){l.exports=t(V())})(b0,function(s){return(function(t){var i=s,d=i.lib,y=d.WordArray,g=d.Hasher,p=i.algo,a=[],c=[];(function(){function h(b){for(var v=t.sqrt(b),f=2;f<=v;f++)if(!(b%f))return!1;return!0}function u(b){return(b-(b|0))*4294967296|0}for(var x=2,m=0;m<64;)h(x)&&(m<8&&(a[m]=u(t.pow(x,1/2))),c[m]=u(t.pow(x,1/3)),m++),x++})();var o=[],n=p.SHA256=g.extend({_doReset:function(){this._hash=new y.init(a.slice(0))},_doProcessBlock:function(h,u){for(var x=this._hash.words,m=x[0],b=x[1],v=x[2],f=x[3],j=x[4],C=x[5],w=x[6],A=x[7],F=0;F<64;F++){if(F<16)o[F]=h[u+F]|0;else{var z=o[F-15],E=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,B=o[F-2],k=(B<<15|B>>>17)^(B<<13|B>>>19)^B>>>10;o[F]=E+o[F-7]+k+o[F-16]}var _=j&C^~j&w,H=m&b^m&v^b&v,I=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),L=(j<<26|j>>>6)^(j<<21|j>>>11)^(j<<7|j>>>25),Q=A+L+_+c[F]+o[F],W=I+H;A=w,w=C,C=j,j=f+Q|0,f=v,v=b,b=m,m=Q+W|0}x[0]=x[0]+m|0,x[1]=x[1]+b|0,x[2]=x[2]+v|0,x[3]=x[3]+f|0,x[4]=x[4]+j|0,x[5]=x[5]+C|0,x[6]=x[6]+w|0,x[7]=x[7]+A|0},_doFinalize:function(){var h=this._data,u=h.words,x=this._nDataBytes*8,m=h.sigBytes*8;return u[m>>>5]|=128<<24-m%32,u[(m+64>>>9<<4)+14]=t.floor(x/4294967296),u[(m+64>>>9<<4)+15]=x,h.sigBytes=u.length*4,this._process(),this._hash},clone:function(){var h=g.clone.call(this);return h._hash=this._hash.clone(),h}});i.SHA256=g._createHelper(n),i.HmacSHA256=g._createHmacHelper(n)})(Math),s.SHA256})})(vr)),vr.exports}var br={exports:{}},y0=br.exports,ns;function C0(){return ns||(ns=1,(function(l,r){(function(s,t,i){l.exports=t(V(),yt())})(y0,function(s){return(function(){var t=s,i=t.lib,d=i.WordArray,y=t.algo,g=y.SHA256,p=y.SHA224=g.extend({_doReset:function(){this._hash=new d.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var a=g._doFinalize.call(this);return a.sigBytes-=4,a}});t.SHA224=g._createHelper(p),t.HmacSHA224=g._createHmacHelper(p)})(),s.SHA224})})(br)),br.exports}var yr={exports:{}},j0=yr.exports,os;function Ks(){return os||(os=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Jr())})(j0,function(s){return(function(){var t=s,i=t.lib,d=i.Hasher,y=t.x64,g=y.Word,p=y.WordArray,a=t.algo;function c(){return g.create.apply(g,arguments)}var o=[c(1116352408,3609767458),c(1899447441,602891725),c(3049323471,3964484399),c(3921009573,2173295548),c(961987163,4081628472),c(1508970993,3053834265),c(2453635748,2937671579),c(2870763221,3664609560),c(3624381080,2734883394),c(310598401,1164996542),c(607225278,1323610764),c(1426881987,3590304994),c(1925078388,4068182383),c(2162078206,991336113),c(2614888103,633803317),c(3248222580,3479774868),c(3835390401,2666613458),c(4022224774,944711139),c(264347078,2341262773),c(604807628,2007800933),c(770255983,1495990901),c(1249150122,1856431235),c(1555081692,3175218132),c(1996064986,2198950837),c(2554220882,3999719339),c(2821834349,766784016),c(2952996808,2566594879),c(3210313671,3203337956),c(3336571891,1034457026),c(3584528711,2466948901),c(113926993,3758326383),c(338241895,168717936),c(666307205,1188179964),c(773529912,1546045734),c(1294757372,1522805485),c(1396182291,2643833823),c(1695183700,2343527390),c(1986661051,1014477480),c(2177026350,1206759142),c(2456956037,344077627),c(2730485921,1290863460),c(2820302411,3158454273),c(3259730800,3505952657),c(3345764771,106217008),c(3516065817,3606008344),c(3600352804,1432725776),c(4094571909,1467031594),c(275423344,851169720),c(430227734,3100823752),c(506948616,1363258195),c(659060556,3750685593),c(883997877,3785050280),c(958139571,3318307427),c(1322822218,3812723403),c(1537002063,2003034995),c(1747873779,3602036899),c(1955562222,1575990012),c(2024104815,1125592928),c(2227730452,2716904306),c(2361852424,442776044),c(2428436474,593698344),c(2756734187,3733110249),c(3204031479,2999351573),c(3329325298,3815920427),c(3391569614,3928383900),c(3515267271,566280711),c(3940187606,3454069534),c(4118630271,4000239992),c(116418474,1914138554),c(174292421,2731055270),c(289380356,3203993006),c(460393269,320620315),c(685471733,587496836),c(852142971,1086792851),c(1017036298,365543100),c(1126000580,2618297676),c(1288033470,3409855158),c(1501505948,4234509866),c(1607167915,987167468),c(1816402316,1246189591)],n=[];(function(){for(var u=0;u<80;u++)n[u]=c()})();var h=a.SHA512=d.extend({_doReset:function(){this._hash=new p.init([new g.init(1779033703,4089235720),new g.init(3144134277,2227873595),new g.init(1013904242,4271175723),new g.init(2773480762,1595750129),new g.init(1359893119,2917565137),new g.init(2600822924,725511199),new g.init(528734635,4215389547),new g.init(1541459225,327033209)])},_doProcessBlock:function(u,x){for(var m=this._hash.words,b=m[0],v=m[1],f=m[2],j=m[3],C=m[4],w=m[5],A=m[6],F=m[7],z=b.high,E=b.low,B=v.high,k=v.low,_=f.high,H=f.low,I=j.high,L=j.low,Q=C.high,W=C.low,q=w.high,G=w.low,P=A.high,N=A.low,S=F.high,R=F.low,O=z,$=E,K=B,U=k,ue=_,Be=H,et=I,_e=L,se=Q,ee=W,Ze=q,Pe=G,Je=P,ze=N,rt=S,Te=R,ae=0;ae<80;ae++){var te,me,er=n[ae];if(ae<16)me=er.high=u[x+ae*2]|0,te=er.low=u[x+ae*2+1]|0;else{var wt=n[ae-15],Ae=wt.high,Ie=wt.low,na=(Ae>>>1|Ie<<31)^(Ae>>>8|Ie<<24)^Ae>>>7,Nt=(Ie>>>1|Ae<<31)^(Ie>>>8|Ae<<24)^(Ie>>>7|Ae<<25),Et=n[ae-2],De=Et.high,He=Et.low,oa=(De>>>19|He<<13)^(De<<3|He>>>29)^De>>>6,Bt=(He>>>19|De<<13)^(He<<3|De>>>29)^(He>>>6|De<<26),At=n[ae-7],ia=At.high,la=At.low,Dt=n[ae-16],ca=Dt.high,Ft=Dt.low;te=Nt+la,me=na+ia+(te>>>0<Nt>>>0?1:0),te=te+Bt,me=me+oa+(te>>>0<Bt>>>0?1:0),te=te+Ft,me=me+ca+(te>>>0<Ft>>>0?1:0),er.high=me,er.low=te}var da=se&Ze^~se&Je,St=ee&Pe^~ee&ze,xa=O&K^O&ue^K&ue,ua=$&U^$&Be^U&Be,ma=(O>>>28|$<<4)^(O<<30|$>>>2)^(O<<25|$>>>7),kt=($>>>28|O<<4)^($<<30|O>>>2)^($<<25|O>>>7),fa=(se>>>14|ee<<18)^(se>>>18|ee<<14)^(se<<23|ee>>>9),ha=(ee>>>14|se<<18)^(ee>>>18|se<<14)^(ee<<23|se>>>9),Rt=o[ae],ga=Rt.high,_t=Rt.low,re=Te+ha,fe=rt+fa+(re>>>0<Te>>>0?1:0),re=re+St,fe=fe+da+(re>>>0<St>>>0?1:0),re=re+_t,fe=fe+ga+(re>>>0<_t>>>0?1:0),re=re+te,fe=fe+me+(re>>>0<te>>>0?1:0),Pt=kt+ua,pa=ma+xa+(Pt>>>0<kt>>>0?1:0);rt=Je,Te=ze,Je=Ze,ze=Pe,Ze=se,Pe=ee,ee=_e+re|0,se=et+fe+(ee>>>0<_e>>>0?1:0)|0,et=ue,_e=Be,ue=K,Be=U,K=O,U=$,$=re+Pt|0,O=fe+pa+($>>>0<re>>>0?1:0)|0}E=b.low=E+$,b.high=z+O+(E>>>0<$>>>0?1:0),k=v.low=k+U,v.high=B+K+(k>>>0<U>>>0?1:0),H=f.low=H+Be,f.high=_+ue+(H>>>0<Be>>>0?1:0),L=j.low=L+_e,j.high=I+et+(L>>>0<_e>>>0?1:0),W=C.low=W+ee,C.high=Q+se+(W>>>0<ee>>>0?1:0),G=w.low=G+Pe,w.high=q+Ze+(G>>>0<Pe>>>0?1:0),N=A.low=N+ze,A.high=P+Je+(N>>>0<ze>>>0?1:0),R=F.low=R+Te,F.high=S+rt+(R>>>0<Te>>>0?1:0)},_doFinalize:function(){var u=this._data,x=u.words,m=this._nDataBytes*8,b=u.sigBytes*8;x[b>>>5]|=128<<24-b%32,x[(b+128>>>10<<5)+30]=Math.floor(m/4294967296),x[(b+128>>>10<<5)+31]=m,u.sigBytes=x.length*4,this._process();var v=this._hash.toX32();return v},clone:function(){var u=d.clone.call(this);return u._hash=this._hash.clone(),u},blockSize:1024/32});t.SHA512=d._createHelper(h),t.HmacSHA512=d._createHmacHelper(h)})(),s.SHA512})})(yr)),yr.exports}var Cr={exports:{}},w0=Cr.exports,is;function N0(){return is||(is=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Jr(),Ks())})(w0,function(s){return(function(){var t=s,i=t.x64,d=i.Word,y=i.WordArray,g=t.algo,p=g.SHA512,a=g.SHA384=p.extend({_doReset:function(){this._hash=new y.init([new d.init(3418070365,3238371032),new d.init(1654270250,914150663),new d.init(2438529370,812702999),new d.init(355462360,4144912697),new d.init(1731405415,4290775857),new d.init(2394180231,1750603025),new d.init(3675008525,1694076839),new d.init(1203062813,3204075428)])},_doFinalize:function(){var c=p._doFinalize.call(this);return c.sigBytes-=16,c}});t.SHA384=p._createHelper(a),t.HmacSHA384=p._createHmacHelper(a)})(),s.SHA384})})(Cr)),Cr.exports}var jr={exports:{}},E0=jr.exports,ls;function B0(){return ls||(ls=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Jr())})(E0,function(s){return(function(t){var i=s,d=i.lib,y=d.WordArray,g=d.Hasher,p=i.x64,a=p.Word,c=i.algo,o=[],n=[],h=[];(function(){for(var m=1,b=0,v=0;v<24;v++){o[m+5*b]=(v+1)*(v+2)/2%64;var f=b%5,j=(2*m+3*b)%5;m=f,b=j}for(var m=0;m<5;m++)for(var b=0;b<5;b++)n[m+5*b]=b+(2*m+3*b)%5*5;for(var C=1,w=0;w<24;w++){for(var A=0,F=0,z=0;z<7;z++){if(C&1){var E=(1<<z)-1;E<32?F^=1<<E:A^=1<<E-32}C&128?C=C<<1^113:C<<=1}h[w]=a.create(A,F)}})();var u=[];(function(){for(var m=0;m<25;m++)u[m]=a.create()})();var x=c.SHA3=g.extend({cfg:g.cfg.extend({outputLength:512}),_doReset:function(){for(var m=this._state=[],b=0;b<25;b++)m[b]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(m,b){for(var v=this._state,f=this.blockSize/2,j=0;j<f;j++){var C=m[b+2*j],w=m[b+2*j+1];C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,w=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360;var A=v[j];A.high^=w,A.low^=C}for(var F=0;F<24;F++){for(var z=0;z<5;z++){for(var E=0,B=0,k=0;k<5;k++){var A=v[z+5*k];E^=A.high,B^=A.low}var _=u[z];_.high=E,_.low=B}for(var z=0;z<5;z++)for(var H=u[(z+4)%5],I=u[(z+1)%5],L=I.high,Q=I.low,E=H.high^(L<<1|Q>>>31),B=H.low^(Q<<1|L>>>31),k=0;k<5;k++){var A=v[z+5*k];A.high^=E,A.low^=B}for(var W=1;W<25;W++){var E,B,A=v[W],q=A.high,G=A.low,P=o[W];P<32?(E=q<<P|G>>>32-P,B=G<<P|q>>>32-P):(E=G<<P-32|q>>>64-P,B=q<<P-32|G>>>64-P);var N=u[n[W]];N.high=E,N.low=B}var S=u[0],R=v[0];S.high=R.high,S.low=R.low;for(var z=0;z<5;z++)for(var k=0;k<5;k++){var W=z+5*k,A=v[W],O=u[W],$=u[(z+1)%5+5*k],K=u[(z+2)%5+5*k];A.high=O.high^~$.high&K.high,A.low=O.low^~$.low&K.low}var A=v[0],U=h[F];A.high^=U.high,A.low^=U.low}},_doFinalize:function(){var m=this._data,b=m.words;this._nDataBytes*8;var v=m.sigBytes*8,f=this.blockSize*32;b[v>>>5]|=1<<24-v%32,b[(t.ceil((v+1)/f)*f>>>5)-1]|=128,m.sigBytes=b.length*4,this._process();for(var j=this._state,C=this.cfg.outputLength/8,w=C/8,A=[],F=0;F<w;F++){var z=j[F],E=z.high,B=z.low;E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,A.push(B),A.push(E)}return new y.init(A,C)},clone:function(){for(var m=g.clone.call(this),b=m._state=this._state.slice(0),v=0;v<25;v++)b[v]=b[v].clone();return m}});i.SHA3=g._createHelper(x),i.HmacSHA3=g._createHmacHelper(x)})(Math),s.SHA3})})(jr)),jr.exports}var wr={exports:{}},A0=wr.exports,cs;function D0(){return cs||(cs=1,(function(l,r){(function(s,t){l.exports=t(V())})(A0,function(s){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return(function(t){var i=s,d=i.lib,y=d.WordArray,g=d.Hasher,p=i.algo,a=y.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),c=y.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),o=y.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),n=y.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=y.create([0,1518500249,1859775393,2400959708,2840853838]),u=y.create([1352829926,1548603684,1836072691,2053994217,0]),x=p.RIPEMD160=g.extend({_doReset:function(){this._hash=y.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(w,A){for(var F=0;F<16;F++){var z=A+F,E=w[z];w[z]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360}var B=this._hash.words,k=h.words,_=u.words,H=a.words,I=c.words,L=o.words,Q=n.words,W,q,G,P,N,S,R,O,$,K;S=W=B[0],R=q=B[1],O=G=B[2],$=P=B[3],K=N=B[4];for(var U,F=0;F<80;F+=1)U=W+w[A+H[F]]|0,F<16?U+=m(q,G,P)+k[0]:F<32?U+=b(q,G,P)+k[1]:F<48?U+=v(q,G,P)+k[2]:F<64?U+=f(q,G,P)+k[3]:U+=j(q,G,P)+k[4],U=U|0,U=C(U,L[F]),U=U+N|0,W=N,N=P,P=C(G,10),G=q,q=U,U=S+w[A+I[F]]|0,F<16?U+=j(R,O,$)+_[0]:F<32?U+=f(R,O,$)+_[1]:F<48?U+=v(R,O,$)+_[2]:F<64?U+=b(R,O,$)+_[3]:U+=m(R,O,$)+_[4],U=U|0,U=C(U,Q[F]),U=U+K|0,S=K,K=$,$=C(O,10),O=R,R=U;U=B[1]+G+$|0,B[1]=B[2]+P+K|0,B[2]=B[3]+N+S|0,B[3]=B[4]+W+R|0,B[4]=B[0]+q+O|0,B[0]=U},_doFinalize:function(){var w=this._data,A=w.words,F=this._nDataBytes*8,z=w.sigBytes*8;A[z>>>5]|=128<<24-z%32,A[(z+64>>>9<<4)+14]=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360,w.sigBytes=(A.length+1)*4,this._process();for(var E=this._hash,B=E.words,k=0;k<5;k++){var _=B[k];B[k]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}return E},clone:function(){var w=g.clone.call(this);return w._hash=this._hash.clone(),w}});function m(w,A,F){return w^A^F}function b(w,A,F){return w&A|~w&F}function v(w,A,F){return(w|~A)^F}function f(w,A,F){return w&F|A&~F}function j(w,A,F){return w^(A|~F)}function C(w,A){return w<<A|w>>>32-A}i.RIPEMD160=g._createHelper(x),i.HmacRIPEMD160=g._createHmacHelper(x)})(),s.RIPEMD160})})(wr)),wr.exports}var Nr={exports:{}},F0=Nr.exports,ds;function Ct(){return ds||(ds=1,(function(l,r){(function(s,t){l.exports=t(V())})(F0,function(s){(function(){var t=s,i=t.lib,d=i.Base,y=t.enc,g=y.Utf8,p=t.algo;p.HMAC=d.extend({init:function(a,c){a=this._hasher=new a.init,typeof c=="string"&&(c=g.parse(c));var o=a.blockSize,n=o*4;c.sigBytes>n&&(c=a.finalize(c)),c.clamp();for(var h=this._oKey=c.clone(),u=this._iKey=c.clone(),x=h.words,m=u.words,b=0;b<o;b++)x[b]^=1549556828,m[b]^=909522486;h.sigBytes=u.sigBytes=n,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var c=this._hasher,o=c.finalize(a);c.reset();var n=c.finalize(this._oKey.clone().concat(o));return n}})})()})})(Nr)),Nr.exports}var Er={exports:{}},S0=Er.exports,xs;function k0(){return xs||(xs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),yt(),Ct())})(S0,function(s){return(function(){var t=s,i=t.lib,d=i.Base,y=i.WordArray,g=t.algo,p=g.SHA256,a=g.HMAC,c=g.PBKDF2=d.extend({cfg:d.extend({keySize:128/32,hasher:p,iterations:25e4}),init:function(o){this.cfg=this.cfg.extend(o)},compute:function(o,n){for(var h=this.cfg,u=a.create(h.hasher,o),x=y.create(),m=y.create([1]),b=x.words,v=m.words,f=h.keySize,j=h.iterations;b.length<f;){var C=u.update(n).finalize(m);u.reset();for(var w=C.words,A=w.length,F=C,z=1;z<j;z++){F=u.finalize(F),u.reset();for(var E=F.words,B=0;B<A;B++)w[B]^=E[B]}x.concat(C),v[0]++}return x.sigBytes=f*4,x}});t.PBKDF2=function(o,n,h){return c.create(h).compute(o,n)}})(),s.PBKDF2})})(Er)),Er.exports}var Br={exports:{}},R0=Br.exports,us;function be(){return us||(us=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Qs(),Ct())})(R0,function(s){return(function(){var t=s,i=t.lib,d=i.Base,y=i.WordArray,g=t.algo,p=g.MD5,a=g.EvpKDF=d.extend({cfg:d.extend({keySize:128/32,hasher:p,iterations:1}),init:function(c){this.cfg=this.cfg.extend(c)},compute:function(c,o){for(var n,h=this.cfg,u=h.hasher.create(),x=y.create(),m=x.words,b=h.keySize,v=h.iterations;m.length<b;){n&&u.update(n),n=u.update(c).finalize(o),u.reset();for(var f=1;f<v;f++)n=u.finalize(n),u.reset();x.concat(n)}return x.sigBytes=b*4,x}});t.EvpKDF=function(c,o,n){return a.create(n).compute(c,o)}})(),s.EvpKDF})})(Br)),Br.exports}var Ar={exports:{}},_0=Ar.exports,ms;function Z(){return ms||(ms=1,(function(l,r){(function(s,t,i){l.exports=t(V(),be())})(_0,function(s){s.lib.Cipher||(function(t){var i=s,d=i.lib,y=d.Base,g=d.WordArray,p=d.BufferedBlockAlgorithm,a=i.enc;a.Utf8;var c=a.Base64,o=i.algo,n=o.EvpKDF,h=d.Cipher=p.extend({cfg:y.extend(),createEncryptor:function(E,B){return this.create(this._ENC_XFORM_MODE,E,B)},createDecryptor:function(E,B){return this.create(this._DEC_XFORM_MODE,E,B)},init:function(E,B,k){this.cfg=this.cfg.extend(k),this._xformMode=E,this._key=B,this.reset()},reset:function(){p.reset.call(this),this._doReset()},process:function(E){return this._append(E),this._process()},finalize:function(E){E&&this._append(E);var B=this._doFinalize();return B},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:(function(){function E(B){return typeof B=="string"?z:w}return function(B){return{encrypt:function(k,_,H){return E(_).encrypt(B,k,_,H)},decrypt:function(k,_,H){return E(_).decrypt(B,k,_,H)}}}})()});d.StreamCipher=h.extend({_doFinalize:function(){var E=this._process(!0);return E},blockSize:1});var u=i.mode={},x=d.BlockCipherMode=y.extend({createEncryptor:function(E,B){return this.Encryptor.create(E,B)},createDecryptor:function(E,B){return this.Decryptor.create(E,B)},init:function(E,B){this._cipher=E,this._iv=B}}),m=u.CBC=(function(){var E=x.extend();E.Encryptor=E.extend({processBlock:function(k,_){var H=this._cipher,I=H.blockSize;B.call(this,k,_,I),H.encryptBlock(k,_),this._prevBlock=k.slice(_,_+I)}}),E.Decryptor=E.extend({processBlock:function(k,_){var H=this._cipher,I=H.blockSize,L=k.slice(_,_+I);H.decryptBlock(k,_),B.call(this,k,_,I),this._prevBlock=L}});function B(k,_,H){var I,L=this._iv;L?(I=L,this._iv=t):I=this._prevBlock;for(var Q=0;Q<H;Q++)k[_+Q]^=I[Q]}return E})(),b=i.pad={},v=b.Pkcs7={pad:function(E,B){for(var k=B*4,_=k-E.sigBytes%k,H=_<<24|_<<16|_<<8|_,I=[],L=0;L<_;L+=4)I.push(H);var Q=g.create(I,_);E.concat(Q)},unpad:function(E){var B=E.words[E.sigBytes-1>>>2]&255;E.sigBytes-=B}};d.BlockCipher=h.extend({cfg:h.cfg.extend({mode:m,padding:v}),reset:function(){var E;h.reset.call(this);var B=this.cfg,k=B.iv,_=B.mode;this._xformMode==this._ENC_XFORM_MODE?E=_.createEncryptor:(E=_.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==E?this._mode.init(this,k&&k.words):(this._mode=E.call(_,this,k&&k.words),this._mode.__creator=E)},_doProcessBlock:function(E,B){this._mode.processBlock(E,B)},_doFinalize:function(){var E,B=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(B.pad(this._data,this.blockSize),E=this._process(!0)):(E=this._process(!0),B.unpad(E)),E},blockSize:128/32});var f=d.CipherParams=y.extend({init:function(E){this.mixIn(E)},toString:function(E){return(E||this.formatter).stringify(this)}}),j=i.format={},C=j.OpenSSL={stringify:function(E){var B,k=E.ciphertext,_=E.salt;return _?B=g.create([1398893684,1701076831]).concat(_).concat(k):B=k,B.toString(c)},parse:function(E){var B,k=c.parse(E),_=k.words;return _[0]==1398893684&&_[1]==1701076831&&(B=g.create(_.slice(2,4)),_.splice(0,4),k.sigBytes-=16),f.create({ciphertext:k,salt:B})}},w=d.SerializableCipher=y.extend({cfg:y.extend({format:C}),encrypt:function(E,B,k,_){_=this.cfg.extend(_);var H=E.createEncryptor(k,_),I=H.finalize(B),L=H.cfg;return f.create({ciphertext:I,key:k,iv:L.iv,algorithm:E,mode:L.mode,padding:L.padding,blockSize:E.blockSize,formatter:_.format})},decrypt:function(E,B,k,_){_=this.cfg.extend(_),B=this._parse(B,_.format);var H=E.createDecryptor(k,_).finalize(B.ciphertext);return H},_parse:function(E,B){return typeof E=="string"?B.parse(E,this):E}}),A=i.kdf={},F=A.OpenSSL={execute:function(E,B,k,_,H){if(_||(_=g.random(64/8)),H)var I=n.create({keySize:B+k,hasher:H}).compute(E,_);else var I=n.create({keySize:B+k}).compute(E,_);var L=g.create(I.words.slice(B),k*4);return I.sigBytes=B*4,f.create({key:I,iv:L,salt:_})}},z=d.PasswordBasedCipher=w.extend({cfg:w.cfg.extend({kdf:F}),encrypt:function(E,B,k,_){_=this.cfg.extend(_);var H=_.kdf.execute(k,E.keySize,E.ivSize,_.salt,_.hasher);_.iv=H.iv;var I=w.encrypt.call(this,E,B,H.key,_);return I.mixIn(H),I},decrypt:function(E,B,k,_){_=this.cfg.extend(_),B=this._parse(B,_.format);var H=_.kdf.execute(k,E.keySize,E.ivSize,B.salt,_.hasher);_.iv=H.iv;var I=w.decrypt.call(this,E,B,H.key,_);return I}})})()})})(Ar)),Ar.exports}var Dr={exports:{}},P0=Dr.exports,fs;function z0(){return fs||(fs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(P0,function(s){return s.mode.CFB=(function(){var t=s.lib.BlockCipherMode.extend();t.Encryptor=t.extend({processBlock:function(d,y){var g=this._cipher,p=g.blockSize;i.call(this,d,y,p,g),this._prevBlock=d.slice(y,y+p)}}),t.Decryptor=t.extend({processBlock:function(d,y){var g=this._cipher,p=g.blockSize,a=d.slice(y,y+p);i.call(this,d,y,p,g),this._prevBlock=a}});function i(d,y,g,p){var a,c=this._iv;c?(a=c.slice(0),this._iv=void 0):a=this._prevBlock,p.encryptBlock(a,0);for(var o=0;o<g;o++)d[y+o]^=a[o]}return t})(),s.mode.CFB})})(Dr)),Dr.exports}var Fr={exports:{}},T0=Fr.exports,hs;function I0(){return hs||(hs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(T0,function(s){return s.mode.CTR=(function(){var t=s.lib.BlockCipherMode.extend(),i=t.Encryptor=t.extend({processBlock:function(d,y){var g=this._cipher,p=g.blockSize,a=this._iv,c=this._counter;a&&(c=this._counter=a.slice(0),this._iv=void 0);var o=c.slice(0);g.encryptBlock(o,0),c[p-1]=c[p-1]+1|0;for(var n=0;n<p;n++)d[y+n]^=o[n]}});return t.Decryptor=i,t})(),s.mode.CTR})})(Fr)),Fr.exports}var Sr={exports:{}},H0=Sr.exports,gs;function L0(){return gs||(gs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(H0,function(s){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return s.mode.CTRGladman=(function(){var t=s.lib.BlockCipherMode.extend();function i(g){if((g>>24&255)===255){var p=g>>16&255,a=g>>8&255,c=g&255;p===255?(p=0,a===255?(a=0,c===255?c=0:++c):++a):++p,g=0,g+=p<<16,g+=a<<8,g+=c}else g+=1<<24;return g}function d(g){return(g[0]=i(g[0]))===0&&(g[1]=i(g[1])),g}var y=t.Encryptor=t.extend({processBlock:function(g,p){var a=this._cipher,c=a.blockSize,o=this._iv,n=this._counter;o&&(n=this._counter=o.slice(0),this._iv=void 0),d(n);var h=n.slice(0);a.encryptBlock(h,0);for(var u=0;u<c;u++)g[p+u]^=h[u]}});return t.Decryptor=y,t})(),s.mode.CTRGladman})})(Sr)),Sr.exports}var kr={exports:{}},O0=kr.exports,ps;function $0(){return ps||(ps=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(O0,function(s){return s.mode.OFB=(function(){var t=s.lib.BlockCipherMode.extend(),i=t.Encryptor=t.extend({processBlock:function(d,y){var g=this._cipher,p=g.blockSize,a=this._iv,c=this._keystream;a&&(c=this._keystream=a.slice(0),this._iv=void 0),g.encryptBlock(c,0);for(var o=0;o<p;o++)d[y+o]^=c[o]}});return t.Decryptor=i,t})(),s.mode.OFB})})(kr)),kr.exports}var Rr={exports:{}},U0=Rr.exports,vs;function M0(){return vs||(vs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(U0,function(s){return s.mode.ECB=(function(){var t=s.lib.BlockCipherMode.extend();return t.Encryptor=t.extend({processBlock:function(i,d){this._cipher.encryptBlock(i,d)}}),t.Decryptor=t.extend({processBlock:function(i,d){this._cipher.decryptBlock(i,d)}}),t})(),s.mode.ECB})})(Rr)),Rr.exports}var _r={exports:{}},W0=_r.exports,bs;function q0(){return bs||(bs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(W0,function(s){return s.pad.AnsiX923={pad:function(t,i){var d=t.sigBytes,y=i*4,g=y-d%y,p=d+g-1;t.clamp(),t.words[p>>>2]|=g<<24-p%4*8,t.sigBytes+=g},unpad:function(t){var i=t.words[t.sigBytes-1>>>2]&255;t.sigBytes-=i}},s.pad.Ansix923})})(_r)),_r.exports}var Pr={exports:{}},G0=Pr.exports,ys;function V0(){return ys||(ys=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(G0,function(s){return s.pad.Iso10126={pad:function(t,i){var d=i*4,y=d-t.sigBytes%d;t.concat(s.lib.WordArray.random(y-1)).concat(s.lib.WordArray.create([y<<24],1))},unpad:function(t){var i=t.words[t.sigBytes-1>>>2]&255;t.sigBytes-=i}},s.pad.Iso10126})})(Pr)),Pr.exports}var zr={exports:{}},Q0=zr.exports,Cs;function K0(){return Cs||(Cs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(Q0,function(s){return s.pad.Iso97971={pad:function(t,i){t.concat(s.lib.WordArray.create([2147483648],1)),s.pad.ZeroPadding.pad(t,i)},unpad:function(t){s.pad.ZeroPadding.unpad(t),t.sigBytes--}},s.pad.Iso97971})})(zr)),zr.exports}var Tr={exports:{}},Y0=Tr.exports,js;function X0(){return js||(js=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(Y0,function(s){return s.pad.ZeroPadding={pad:function(t,i){var d=i*4;t.clamp(),t.sigBytes+=d-(t.sigBytes%d||d)},unpad:function(t){for(var i=t.words,d=t.sigBytes-1,d=t.sigBytes-1;d>=0;d--)if(i[d>>>2]>>>24-d%4*8&255){t.sigBytes=d+1;break}}},s.pad.ZeroPadding})})(Tr)),Tr.exports}var Ir={exports:{}},Z0=Ir.exports,ws;function J0(){return ws||(ws=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(Z0,function(s){return s.pad.NoPadding={pad:function(){},unpad:function(){}},s.pad.NoPadding})})(Ir)),Ir.exports}var Hr={exports:{}},en=Hr.exports,Ns;function rn(){return Ns||(Ns=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Z())})(en,function(s){return(function(t){var i=s,d=i.lib,y=d.CipherParams,g=i.enc,p=g.Hex,a=i.format;a.Hex={stringify:function(c){return c.ciphertext.toString(p)},parse:function(c){var o=p.parse(c);return y.create({ciphertext:o})}}})(),s.format.Hex})})(Hr)),Hr.exports}var Lr={exports:{}},tn=Lr.exports,Es;function sn(){return Es||(Es=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Ne(),Ee(),be(),Z())})(tn,function(s){return(function(){var t=s,i=t.lib,d=i.BlockCipher,y=t.algo,g=[],p=[],a=[],c=[],o=[],n=[],h=[],u=[],x=[],m=[];(function(){for(var f=[],j=0;j<256;j++)j<128?f[j]=j<<1:f[j]=j<<1^283;for(var C=0,w=0,j=0;j<256;j++){var A=w^w<<1^w<<2^w<<3^w<<4;A=A>>>8^A&255^99,g[C]=A,p[A]=C;var F=f[C],z=f[F],E=f[z],B=f[A]*257^A*16843008;a[C]=B<<24|B>>>8,c[C]=B<<16|B>>>16,o[C]=B<<8|B>>>24,n[C]=B;var B=E*16843009^z*65537^F*257^C*16843008;h[A]=B<<24|B>>>8,u[A]=B<<16|B>>>16,x[A]=B<<8|B>>>24,m[A]=B,C?(C=F^f[f[f[E^F]]],w^=f[f[w]]):C=w=1}})();var b=[0,1,2,4,8,16,32,64,128,27,54],v=y.AES=d.extend({_doReset:function(){var f;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var j=this._keyPriorReset=this._key,C=j.words,w=j.sigBytes/4,A=this._nRounds=w+6,F=(A+1)*4,z=this._keySchedule=[],E=0;E<F;E++)E<w?z[E]=C[E]:(f=z[E-1],E%w?w>6&&E%w==4&&(f=g[f>>>24]<<24|g[f>>>16&255]<<16|g[f>>>8&255]<<8|g[f&255]):(f=f<<8|f>>>24,f=g[f>>>24]<<24|g[f>>>16&255]<<16|g[f>>>8&255]<<8|g[f&255],f^=b[E/w|0]<<24),z[E]=z[E-w]^f);for(var B=this._invKeySchedule=[],k=0;k<F;k++){var E=F-k;if(k%4)var f=z[E];else var f=z[E-4];k<4||E<=4?B[k]=f:B[k]=h[g[f>>>24]]^u[g[f>>>16&255]]^x[g[f>>>8&255]]^m[g[f&255]]}}},encryptBlock:function(f,j){this._doCryptBlock(f,j,this._keySchedule,a,c,o,n,g)},decryptBlock:function(f,j){var C=f[j+1];f[j+1]=f[j+3],f[j+3]=C,this._doCryptBlock(f,j,this._invKeySchedule,h,u,x,m,p);var C=f[j+1];f[j+1]=f[j+3],f[j+3]=C},_doCryptBlock:function(f,j,C,w,A,F,z,E){for(var B=this._nRounds,k=f[j]^C[0],_=f[j+1]^C[1],H=f[j+2]^C[2],I=f[j+3]^C[3],L=4,Q=1;Q<B;Q++){var W=w[k>>>24]^A[_>>>16&255]^F[H>>>8&255]^z[I&255]^C[L++],q=w[_>>>24]^A[H>>>16&255]^F[I>>>8&255]^z[k&255]^C[L++],G=w[H>>>24]^A[I>>>16&255]^F[k>>>8&255]^z[_&255]^C[L++],P=w[I>>>24]^A[k>>>16&255]^F[_>>>8&255]^z[H&255]^C[L++];k=W,_=q,H=G,I=P}var W=(E[k>>>24]<<24|E[_>>>16&255]<<16|E[H>>>8&255]<<8|E[I&255])^C[L++],q=(E[_>>>24]<<24|E[H>>>16&255]<<16|E[I>>>8&255]<<8|E[k&255])^C[L++],G=(E[H>>>24]<<24|E[I>>>16&255]<<16|E[k>>>8&255]<<8|E[_&255])^C[L++],P=(E[I>>>24]<<24|E[k>>>16&255]<<16|E[_>>>8&255]<<8|E[H&255])^C[L++];f[j]=W,f[j+1]=q,f[j+2]=G,f[j+3]=P},keySize:256/32});t.AES=d._createHelper(v)})(),s.AES})})(Lr)),Lr.exports}var Or={exports:{}},an=Or.exports,Bs;function nn(){return Bs||(Bs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Ne(),Ee(),be(),Z())})(an,function(s){return(function(){var t=s,i=t.lib,d=i.WordArray,y=i.BlockCipher,g=t.algo,p=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],o=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],n=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],h=g.DES=y.extend({_doReset:function(){for(var b=this._key,v=b.words,f=[],j=0;j<56;j++){var C=p[j]-1;f[j]=v[C>>>5]>>>31-C%32&1}for(var w=this._subKeys=[],A=0;A<16;A++){for(var F=w[A]=[],z=c[A],j=0;j<24;j++)F[j/6|0]|=f[(a[j]-1+z)%28]<<31-j%6,F[4+(j/6|0)]|=f[28+(a[j+24]-1+z)%28]<<31-j%6;F[0]=F[0]<<1|F[0]>>>31;for(var j=1;j<7;j++)F[j]=F[j]>>>(j-1)*4+3;F[7]=F[7]<<5|F[7]>>>27}for(var E=this._invSubKeys=[],j=0;j<16;j++)E[j]=w[15-j]},encryptBlock:function(b,v){this._doCryptBlock(b,v,this._subKeys)},decryptBlock:function(b,v){this._doCryptBlock(b,v,this._invSubKeys)},_doCryptBlock:function(b,v,f){this._lBlock=b[v],this._rBlock=b[v+1],u.call(this,4,252645135),u.call(this,16,65535),x.call(this,2,858993459),x.call(this,8,16711935),u.call(this,1,1431655765);for(var j=0;j<16;j++){for(var C=f[j],w=this._lBlock,A=this._rBlock,F=0,z=0;z<8;z++)F|=o[z][((A^C[z])&n[z])>>>0];this._lBlock=A,this._rBlock=w^F}var E=this._lBlock;this._lBlock=this._rBlock,this._rBlock=E,u.call(this,1,1431655765),x.call(this,8,16711935),x.call(this,2,858993459),u.call(this,16,65535),u.call(this,4,252645135),b[v]=this._lBlock,b[v+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function u(b,v){var f=(this._lBlock>>>b^this._rBlock)&v;this._rBlock^=f,this._lBlock^=f<<b}function x(b,v){var f=(this._rBlock>>>b^this._lBlock)&v;this._lBlock^=f,this._rBlock^=f<<b}t.DES=y._createHelper(h);var m=g.TripleDES=y.extend({_doReset:function(){var b=this._key,v=b.words;if(v.length!==2&&v.length!==4&&v.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var f=v.slice(0,2),j=v.length<4?v.slice(0,2):v.slice(2,4),C=v.length<6?v.slice(0,2):v.slice(4,6);this._des1=h.createEncryptor(d.create(f)),this._des2=h.createEncryptor(d.create(j)),this._des3=h.createEncryptor(d.create(C))},encryptBlock:function(b,v){this._des1.encryptBlock(b,v),this._des2.decryptBlock(b,v),this._des3.encryptBlock(b,v)},decryptBlock:function(b,v){this._des3.decryptBlock(b,v),this._des2.encryptBlock(b,v),this._des1.decryptBlock(b,v)},keySize:192/32,ivSize:64/32,blockSize:64/32});t.TripleDES=y._createHelper(m)})(),s.TripleDES})})(Or)),Or.exports}var $r={exports:{}},on=$r.exports,As;function ln(){return As||(As=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Ne(),Ee(),be(),Z())})(on,function(s){return(function(){var t=s,i=t.lib,d=i.StreamCipher,y=t.algo,g=y.RC4=d.extend({_doReset:function(){for(var c=this._key,o=c.words,n=c.sigBytes,h=this._S=[],u=0;u<256;u++)h[u]=u;for(var u=0,x=0;u<256;u++){var m=u%n,b=o[m>>>2]>>>24-m%4*8&255;x=(x+h[u]+b)%256;var v=h[u];h[u]=h[x],h[x]=v}this._i=this._j=0},_doProcessBlock:function(c,o){c[o]^=p.call(this)},keySize:256/32,ivSize:0});function p(){for(var c=this._S,o=this._i,n=this._j,h=0,u=0;u<4;u++){o=(o+1)%256,n=(n+c[o])%256;var x=c[o];c[o]=c[n],c[n]=x,h|=c[(c[o]+c[n])%256]<<24-u*8}return this._i=o,this._j=n,h}t.RC4=d._createHelper(g);var a=y.RC4Drop=g.extend({cfg:g.cfg.extend({drop:192}),_doReset:function(){g._doReset.call(this);for(var c=this.cfg.drop;c>0;c--)p.call(this)}});t.RC4Drop=d._createHelper(a)})(),s.RC4})})($r)),$r.exports}var Ur={exports:{}},cn=Ur.exports,Ds;function dn(){return Ds||(Ds=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Ne(),Ee(),be(),Z())})(cn,function(s){return(function(){var t=s,i=t.lib,d=i.StreamCipher,y=t.algo,g=[],p=[],a=[],c=y.Rabbit=d.extend({_doReset:function(){for(var n=this._key.words,h=this.cfg.iv,u=0;u<4;u++)n[u]=(n[u]<<8|n[u]>>>24)&16711935|(n[u]<<24|n[u]>>>8)&4278255360;var x=this._X=[n[0],n[3]<<16|n[2]>>>16,n[1],n[0]<<16|n[3]>>>16,n[2],n[1]<<16|n[0]>>>16,n[3],n[2]<<16|n[1]>>>16],m=this._C=[n[2]<<16|n[2]>>>16,n[0]&4294901760|n[1]&65535,n[3]<<16|n[3]>>>16,n[1]&4294901760|n[2]&65535,n[0]<<16|n[0]>>>16,n[2]&4294901760|n[3]&65535,n[1]<<16|n[1]>>>16,n[3]&4294901760|n[0]&65535];this._b=0;for(var u=0;u<4;u++)o.call(this);for(var u=0;u<8;u++)m[u]^=x[u+4&7];if(h){var b=h.words,v=b[0],f=b[1],j=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,C=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,w=j>>>16|C&4294901760,A=C<<16|j&65535;m[0]^=j,m[1]^=w,m[2]^=C,m[3]^=A,m[4]^=j,m[5]^=w,m[6]^=C,m[7]^=A;for(var u=0;u<4;u++)o.call(this)}},_doProcessBlock:function(n,h){var u=this._X;o.call(this),g[0]=u[0]^u[5]>>>16^u[3]<<16,g[1]=u[2]^u[7]>>>16^u[5]<<16,g[2]=u[4]^u[1]>>>16^u[7]<<16,g[3]=u[6]^u[3]>>>16^u[1]<<16;for(var x=0;x<4;x++)g[x]=(g[x]<<8|g[x]>>>24)&16711935|(g[x]<<24|g[x]>>>8)&4278255360,n[h+x]^=g[x]},blockSize:128/32,ivSize:64/32});function o(){for(var n=this._X,h=this._C,u=0;u<8;u++)p[u]=h[u];h[0]=h[0]+1295307597+this._b|0,h[1]=h[1]+3545052371+(h[0]>>>0<p[0]>>>0?1:0)|0,h[2]=h[2]+886263092+(h[1]>>>0<p[1]>>>0?1:0)|0,h[3]=h[3]+1295307597+(h[2]>>>0<p[2]>>>0?1:0)|0,h[4]=h[4]+3545052371+(h[3]>>>0<p[3]>>>0?1:0)|0,h[5]=h[5]+886263092+(h[4]>>>0<p[4]>>>0?1:0)|0,h[6]=h[6]+1295307597+(h[5]>>>0<p[5]>>>0?1:0)|0,h[7]=h[7]+3545052371+(h[6]>>>0<p[6]>>>0?1:0)|0,this._b=h[7]>>>0<p[7]>>>0?1:0;for(var u=0;u<8;u++){var x=n[u]+h[u],m=x&65535,b=x>>>16,v=((m*m>>>17)+m*b>>>15)+b*b,f=((x&4294901760)*x|0)+((x&65535)*x|0);a[u]=v^f}n[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,n[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,n[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,n[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,n[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,n[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,n[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,n[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}t.Rabbit=d._createHelper(c)})(),s.Rabbit})})(Ur)),Ur.exports}var Mr={exports:{}},xn=Mr.exports,Fs;function un(){return Fs||(Fs=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Ne(),Ee(),be(),Z())})(xn,function(s){return(function(){var t=s,i=t.lib,d=i.StreamCipher,y=t.algo,g=[],p=[],a=[],c=y.RabbitLegacy=d.extend({_doReset:function(){var n=this._key.words,h=this.cfg.iv,u=this._X=[n[0],n[3]<<16|n[2]>>>16,n[1],n[0]<<16|n[3]>>>16,n[2],n[1]<<16|n[0]>>>16,n[3],n[2]<<16|n[1]>>>16],x=this._C=[n[2]<<16|n[2]>>>16,n[0]&4294901760|n[1]&65535,n[3]<<16|n[3]>>>16,n[1]&4294901760|n[2]&65535,n[0]<<16|n[0]>>>16,n[2]&4294901760|n[3]&65535,n[1]<<16|n[1]>>>16,n[3]&4294901760|n[0]&65535];this._b=0;for(var m=0;m<4;m++)o.call(this);for(var m=0;m<8;m++)x[m]^=u[m+4&7];if(h){var b=h.words,v=b[0],f=b[1],j=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,C=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,w=j>>>16|C&4294901760,A=C<<16|j&65535;x[0]^=j,x[1]^=w,x[2]^=C,x[3]^=A,x[4]^=j,x[5]^=w,x[6]^=C,x[7]^=A;for(var m=0;m<4;m++)o.call(this)}},_doProcessBlock:function(n,h){var u=this._X;o.call(this),g[0]=u[0]^u[5]>>>16^u[3]<<16,g[1]=u[2]^u[7]>>>16^u[5]<<16,g[2]=u[4]^u[1]>>>16^u[7]<<16,g[3]=u[6]^u[3]>>>16^u[1]<<16;for(var x=0;x<4;x++)g[x]=(g[x]<<8|g[x]>>>24)&16711935|(g[x]<<24|g[x]>>>8)&4278255360,n[h+x]^=g[x]},blockSize:128/32,ivSize:64/32});function o(){for(var n=this._X,h=this._C,u=0;u<8;u++)p[u]=h[u];h[0]=h[0]+1295307597+this._b|0,h[1]=h[1]+3545052371+(h[0]>>>0<p[0]>>>0?1:0)|0,h[2]=h[2]+886263092+(h[1]>>>0<p[1]>>>0?1:0)|0,h[3]=h[3]+1295307597+(h[2]>>>0<p[2]>>>0?1:0)|0,h[4]=h[4]+3545052371+(h[3]>>>0<p[3]>>>0?1:0)|0,h[5]=h[5]+886263092+(h[4]>>>0<p[4]>>>0?1:0)|0,h[6]=h[6]+1295307597+(h[5]>>>0<p[5]>>>0?1:0)|0,h[7]=h[7]+3545052371+(h[6]>>>0<p[6]>>>0?1:0)|0,this._b=h[7]>>>0<p[7]>>>0?1:0;for(var u=0;u<8;u++){var x=n[u]+h[u],m=x&65535,b=x>>>16,v=((m*m>>>17)+m*b>>>15)+b*b,f=((x&4294901760)*x|0)+((x&65535)*x|0);a[u]=v^f}n[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,n[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,n[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,n[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,n[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,n[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,n[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,n[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}t.RabbitLegacy=d._createHelper(c)})(),s.RabbitLegacy})})(Mr)),Mr.exports}var Wr={exports:{}},mn=Wr.exports,Ss;function fn(){return Ss||(Ss=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Ne(),Ee(),be(),Z())})(mn,function(s){return(function(){var t=s,i=t.lib,d=i.BlockCipher,y=t.algo;const g=16,p=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],a=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var c={pbox:[],sbox:[]};function o(m,b){let v=b>>24&255,f=b>>16&255,j=b>>8&255,C=b&255,w=m.sbox[0][v]+m.sbox[1][f];return w=w^m.sbox[2][j],w=w+m.sbox[3][C],w}function n(m,b,v){let f=b,j=v,C;for(let w=0;w<g;++w)f=f^m.pbox[w],j=o(m,f)^j,C=f,f=j,j=C;return C=f,f=j,j=C,j=j^m.pbox[g],f=f^m.pbox[g+1],{left:f,right:j}}function h(m,b,v){let f=b,j=v,C;for(let w=g+1;w>1;--w)f=f^m.pbox[w],j=o(m,f)^j,C=f,f=j,j=C;return C=f,f=j,j=C,j=j^m.pbox[1],f=f^m.pbox[0],{left:f,right:j}}function u(m,b,v){for(let A=0;A<4;A++){m.sbox[A]=[];for(let F=0;F<256;F++)m.sbox[A][F]=a[A][F]}let f=0;for(let A=0;A<g+2;A++)m.pbox[A]=p[A]^b[f],f++,f>=v&&(f=0);let j=0,C=0,w=0;for(let A=0;A<g+2;A+=2)w=n(m,j,C),j=w.left,C=w.right,m.pbox[A]=j,m.pbox[A+1]=C;for(let A=0;A<4;A++)for(let F=0;F<256;F+=2)w=n(m,j,C),j=w.left,C=w.right,m.sbox[A][F]=j,m.sbox[A][F+1]=C;return!0}var x=y.Blowfish=d.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var m=this._keyPriorReset=this._key,b=m.words,v=m.sigBytes/4;u(c,b,v)}},encryptBlock:function(m,b){var v=n(c,m[b],m[b+1]);m[b]=v.left,m[b+1]=v.right},decryptBlock:function(m,b){var v=h(c,m[b],m[b+1]);m[b]=v.left,m[b+1]=v.right},blockSize:64/32,keySize:128/32,ivSize:64/32});t.Blowfish=d._createHelper(x)})(),s.Blowfish})})(Wr)),Wr.exports}var hn=cr.exports,ks;function gn(){return ks||(ks=1,(function(l,r){(function(s,t,i){l.exports=t(V(),Jr(),x0(),m0(),Ne(),g0(),Ee(),Qs(),yt(),C0(),Ks(),N0(),B0(),D0(),Ct(),k0(),be(),Z(),z0(),I0(),L0(),$0(),M0(),q0(),V0(),K0(),X0(),J0(),rn(),sn(),nn(),ln(),dn(),un(),fn())})(hn,function(s){return s})})(cr)),cr.exports}var pn=gn();const ce=Ea(pn);class je{static{this.ALGORITHM="AES"}static{this.ENCRYPTION_KEY="your-super-secret-key-here-32-chars"}static encrypt(r){if(!r)throw new Error("Cannot encrypt empty string");const s=ce.lib.WordArray.random(16);return{encrypted:ce.AES.encrypt(r,this.ENCRYPTION_KEY,{iv:s,mode:ce.mode.CBC,padding:ce.pad.Pkcs7}).toString(),iv:s.toString(),algorithm:this.ALGORITHM}}static decrypt(r){if(!r||!r.encrypted)throw new Error("Invalid encrypted field");try{const t=ce.AES.decrypt(r.encrypted,this.ENCRYPTION_KEY,{iv:ce.enc.Hex.parse(r.iv),mode:ce.mode.CBC,padding:ce.pad.Pkcs7}).toString(ce.enc.Utf8);if(!t)throw new Error("Decryption failed - invalid key or corrupted data");return t}catch(s){throw new Error("Failed to decrypt data: "+s.message)}}static maskAccountNumber(r){if(!r||r.length<4)return"****";const s=r.slice(-4);return"*".repeat(Math.max(0,r.length-4))+s}static maskBranchCode(r){if(!r||r.length<2)return"***";const s=r.slice(-2);return"*".repeat(Math.max(0,r.length-2))+s}static isEncrypted(r){return typeof r=="object"&&r!==null&&typeof r.encrypted=="string"&&typeof r.iv=="string"&&r.algorithm==="AES"}static encryptBankingDetails(r){return{accountHolder:r.accountHolder,bank:r.bank,accountNumber:this.encrypt(r.accountNumber),branchCode:this.encrypt(r.branchCode)}}static decryptBankingDetails(r){return{accountHolder:r.accountHolder,bank:r.bank,accountNumber:this.isEncrypted(r.accountNumber)?this.decrypt(r.accountNumber):r.accountNumber,branchCode:this.isEncrypted(r.branchCode)?this.decrypt(r.branchCode):r.branchCode}}static getMaskedBankingDetails(r){const s=this.decryptBankingDetails(r);return{accountHolder:s.accountHolder,bank:s.bank,accountNumber:this.maskAccountNumber(s.accountNumber),branchCode:this.maskBranchCode(s.branchCode)}}}je.encrypt;je.decrypt;je.maskAccountNumber;je.maskBranchCode;class we{static async logAccess(r){const s=Xe.currentUser;if(!s){D.warn("Attempted to log PII access without authenticated user");return}try{const t=`${r.action}_${r.dataType}_${Date.now()}`,i={id:t,userId:s.uid,userEmail:s.email||"unknown",userAgent:navigator.userAgent,timestamp:or(),...r};try{const y=await(await fetch("https://api.ipify.org?format=json")).json();i.ipAddress=y.ip}catch{i.ipAddress="unknown"}await Ke(oe(Y,"piiAccessLogs",t),i),D.info("PII access logged",{action:r.action,dataType:r.dataType,user:s.email})}catch(t){D.error("Failed to log PII access:",t)}}static async logBankingAccess(r,s,t){await this.logAccess({action:s,dataType:"banking",resellerId:r,fieldAccessed:"bankDetails",reason:t||"Business operations"})}static async logPersonalInfoAccess(r,s,t,i){await this.logAccess({action:s,dataType:"personal",targetUserId:r,fieldAccessed:t,reason:i||"User management"})}static async logSessionAccess(r,s,t){await this.logAccess({action:s,dataType:"session",targetUserId:r,fieldAccessed:"sessionData",reason:t||"Session management"})}static async logDataExport(r,s="Data export requested"){await this.logAccess({action:"export",dataType:r,reason:s})}}we.logBankingAccess;we.logPersonalInfoAccess;we.logSessionAccess;we.logDataExport;const ge={starter:{id:"starter",name:"Starter",price:29900,currency:"ZAR",employeeLimit:10,features:["Up to 10 employees","Basic warning management","PDF document generation","Email notifications","Basic reporting"]},professional:{id:"professional",name:"Professional",price:49900,currency:"ZAR",employeeLimit:50,features:["Up to 50 employees","Advanced warning workflows","Custom warning categories","WhatsApp notifications","Advanced reporting","Counselling management"]},enterprise:{id:"enterprise",name:"Enterprise",price:79900,currency:"ZAR",employeeLimit:200,features:["Up to 200 employees","Full HR disciplinary suite","Custom document templates","API access","Priority support","Advanced analytics"]},"enterprise-plus":{id:"enterprise-plus",name:"Enterprise Plus",price:129900,currency:"ZAR",employeeLimit:999999,features:["Unlimited employees","White-label branding","Multi-location support","Dedicated account manager","Custom integrations","On-site training"]}},de={"western-cape":{name:"Western Cape"},gauteng:{name:"Gauteng"},"kwazulu-natal":{name:"KwaZulu-Natal"},"eastern-cape":{name:"Eastern Cape"},"free-state":{name:"Free State"},limpopo:{name:"Limpopo"},mpumalanga:{name:"Mpumalanga"},"northern-cape":{name:"Northern Cape"},"north-west":{name:"North West"}},Ys=()=>{const[l,r]=T.useState([]),[s,t]=T.useState(!0),[i,d]=T.useState(!1),[y,g]=T.useState(null),[p,a]=T.useState("all"),[c,o]=T.useState({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}});T.useEffect(()=>{n()},[]);const n=async()=>{try{t(!0),D.debug("Loading resellers with metrics...");const C=await X.getAllResellers(),w=await Promise.all(C.map(async A=>{const F=await We.getResellerMetrics(A.id);return{...A,metrics:F}}));r(w),D.success(`Loaded ${w.length} resellers`)}catch(C){D.error("Failed to load resellers:",C)}finally{t(!1)}},h=async C=>{C.preventDefault();try{D.debug("Adding new reseller...",c),await we.logBankingAccess("new-reseller","edit","Creating new reseller account");const w=je.encryptBankingDetails(c.bankDetails),A={firstName:c.firstName,lastName:c.lastName,email:c.email,phone:c.phone,province:c.province,territory:c.territory,commissionRate:c.commissionRate,isActive:!0,bankDetails:w,clientIds:[],totalClientsAcquired:0,monthlyRecurringRevenue:0,totalCommissionsEarned:0},F=await X.createReseller(A);try{const{httpsCallable:z}=await Qe(async()=>{const{httpsCallable:k}=await import("./firebase-vendor-ZA7KOHFb.js").then(_=>_.Y);return{httpsCallable:k}},[]),{functions:E}=await Qe(async()=>{const{functions:k}=await import("./business-owner-dashboard-mIihUYS1.js").then(_=>_.Q);return{functions:k}},__vite__mapDeps([0,1,2,3,4]));await z(E,"createResellerUser")({email:c.email,password:"temp123",displayName:`${c.firstName} ${c.lastName}`,resellerId:F,firstName:c.firstName,lastName:c.lastName}),D.success("Reseller user account created via Cloud Function")}catch(z){D.warn("Cloud Function not available, using fallback method:",z),D.error("Cannot create user account automatically due to CORS restriction"),alert(`
RESELLER CREATED SUCCESSFULLY!

However, the user account creation failed due to browser security restrictions.

Please create the Firebase Auth account manually:
1. Go to Firebase Console > Authentication > Users  
2. Add user: ${c.email}
3. Password: temp123
4. Display name: ${c.firstName} ${c.lastName}

Or the reseller can register at the login page with their email and the password 'temp123'.

The reseller profile has been saved successfully with ID: ${F}
        `.trim()),D.warn("Manual user account creation required for:",c.email)}D.success("Reseller and user account created successfully:",{resellerId:F,email:c.email}),o({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}}),d(!1),setTimeout(async()=>{try{await n()}catch{D.warn("Could not reload resellers automatically, refresh page manually")}},2e3)}catch(w){D.error("Failed to add reseller:",w)}},u=async C=>{if(C.preventDefault(),!!y)try{D.debug("Updating reseller...",{id:y.id,formData:c}),await we.logBankingAccess(y.id,"edit","Updating reseller banking details");const w=je.encryptBankingDetails(c.bankDetails);await X.updateReseller(y.id,{firstName:c.firstName,lastName:c.lastName,email:c.email,phone:c.phone,province:c.province,territory:c.territory,commissionRate:c.commissionRate,bankDetails:w,updatedAt:new Date().toISOString()}),D.success("Reseller updated successfully"),g(null),await n()}catch(w){D.error("Failed to update reseller:",w)}},x=async C=>{try{await we.logBankingAccess(C.id,"view","Editing reseller details");const w=je.decryptBankingDetails(C.bankDetails);g(C),o({firstName:C.firstName,lastName:C.lastName,email:C.email,phone:C.phone,province:C.province,territory:C.territory,commissionRate:C.commissionRate,bankDetails:w}),d(!0)}catch(w){D.error("Failed to decrypt banking details:",w),alert("Error loading banking details. Please contact support.")}},m=()=>{d(!1),g(null),o({firstName:"",lastName:"",email:"",phone:"",province:"gauteng",territory:[],commissionRate:.5,bankDetails:{accountHolder:"",bank:"",accountNumber:"",branchCode:""}})},b=async C=>{try{await X.updateReseller(C.id,{isActive:!C.isActive,updatedAt:new Date().toISOString()}),D.success(`Reseller ${C.isActive?"deactivated":"activated"}`),await n()}catch(w){D.error("Failed to toggle reseller status:",w)}},v=()=>p==="all"?l:l.filter(C=>C.province===p),f=C=>`R${(C/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,j=()=>{const C={};for(const w of l){const A=w.province;C[A]||(C[A]={resellers:0,clients:0,revenue:0}),C[A].resellers++,C[A].clients+=w.metrics.totalClients,C[A].revenue+=w.metrics.monthlyRecurringRevenue}return C};return s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading reseller network..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Reseller Network"}),e.jsx("p",{className:"text-gray-600",children:"Manage your provincial sales network"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Lt,{className:"w-4 h-4"}),"Add Reseller"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Filter by Province:"}),e.jsxs("select",{value:p,onChange:C=>a(C.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"all",children:"All Provinces"}),Object.entries(de).map(([C,w])=>e.jsx("option",{value:C,children:w.name},C))]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Object.entries(j()).sort(([,C],[,w])=>w.revenue-C.revenue).slice(0,5).map(([C,w])=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Gr,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-sm",children:de[C]?.name})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Resellers:"}),e.jsx("span",{className:"font-semibold",children:w.resellers})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Clients:"}),e.jsx("span",{className:"font-semibold",children:w.clients})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Revenue:"}),e.jsx("span",{className:"font-semibold",children:f(w.revenue)})]})]})]},C))}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold",children:["Resellers (",v().length,")"]})}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reseller"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Province"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Clients"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monthly Revenue"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Commission Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:v().map(C=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[C.firstName," ",C.lastName]}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Hs,{className:"w-3 h-3"}),C.email]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_a,{className:"w-3 h-3"}),C.phone]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gr,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:de[C.province]?.name})]}),C.territory.length>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:C.territory.join(", ")})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-semibold",children:C.metrics.totalClients})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Avg: ",f(C.metrics.averageClientValue)]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vr,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"font-semibold",children:f(C.metrics.monthlyRecurringRevenue)})]}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),"+",C.metrics.monthlyGrowth,"%"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("span",{className:"text-sm font-semibold",children:[(C.commissionRate*100).toFixed(0),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Earned: ",f(C.metrics.totalCommissions)]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>b(C),className:`flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${C.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:C.isActive?e.jsxs(e.Fragment,{children:[e.jsx(Qr,{className:"w-3 h-3"}),"Active"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"w-3 h-3"}),"Inactive"]})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>x(C),className:"text-blue-600 hover:text-blue-800 mr-3",children:e.jsx(Ls,{className:"w-4 h-4"})})})]},C.id))})]}),v().length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Lt,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:"No resellers found"}),e.jsx("p",{className:"text-sm text-gray-500",children:p!=="all"?`No resellers in ${de[p]?.name}`:"Add your first reseller to start building your network"})]})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:y?"Edit Reseller":"Add New Reseller"}),e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600",children:e.jsx(Xr,{className:"w-5 h-5"})})]}),!y&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"ℹ️ Account Creation:"})," A user account will be created with email login and password ",e.jsx("code",{className:"bg-blue-100 px-1 rounded",children:"temp123"}),". The reseller should change this on first login."]})})]}),e.jsxs("form",{onSubmit:y?u:h,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:c.firstName,onChange:C=>o(w=>({...w,firstName:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",value:c.lastName,onChange:C=>o(w=>({...w,lastName:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",value:c.email,onChange:C=>o(w=>({...w,email:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone *"}),e.jsx("input",{type:"tel",value:c.phone,onChange:C=>o(w=>({...w,phone:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),e.jsx("select",{value:c.province,onChange:C=>o(w=>({...w,province:C.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(de).map(([C,w])=>e.jsx("option",{value:C,children:w.name},C))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Commission Rate"}),e.jsxs("select",{value:c.commissionRate,onChange:C=>o(w=>({...w,commissionRate:parseFloat(C.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"0.50",children:"50% (Standard)"}),e.jsx("option",{value:"0.45",children:"45%"}),e.jsx("option",{value:"0.40",children:"40%"}),e.jsx("option",{value:"0.35",children:"35%"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"Banking Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Holder"}),e.jsx("input",{type:"text",value:c.bankDetails.accountHolder,onChange:C=>o(w=>({...w,bankDetails:{...w.bankDetails,accountHolder:C.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank"}),e.jsxs("select",{value:c.bankDetails.bank,onChange:C=>o(w=>({...w,bankDetails:{...w.bankDetails,bank:C.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select bank"}),e.jsx("option",{value:"ABSA",children:"ABSA"}),e.jsx("option",{value:"Standard Bank",children:"Standard Bank"}),e.jsx("option",{value:"FirstNational Bank",children:"FirstNational Bank"}),e.jsx("option",{value:"Nedbank",children:"Nedbank"}),e.jsx("option",{value:"Capitec",children:"Capitec"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number"}),e.jsx("input",{type:"text",value:c.bankDetails.accountNumber,onChange:C=>o(w=>({...w,bankDetails:{...w.bankDetails,accountNumber:C.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Code"}),e.jsx("input",{type:"text",value:c.bankDetails.branchCode,onChange:C=>o(w=>({...w,bankDetails:{...w.bankDetails,branchCode:C.target.value}})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-6 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-gray-600 hover:text-gray-800",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:y?"Update Reseller":"Add Reseller"})]})]})]})})]})},lo=Object.freeze(Object.defineProperty({__proto__:null,ResellerManagement:Ys},Symbol.toStringTag,{value:"Module"})),vn="https://us-central1-hr-disciplinary-system.cloudfunctions.net";class Le{static async getAuthToken(){const r=Xe.currentUser;if(!r)throw new Error("User not authenticated");return await r.getIdToken(!0)}static async makeAuthenticatedRequest(r,s={}){try{const t=await this.getAuthToken(),i=await fetch(`${vn}/${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({data:s}),credentials:"include"});if(!i.ok){const y=await i.json();throw new Error(y.error?.message||`HTTP ${i.status}: ${i.statusText}`)}return(await i.json()).data}catch(t){throw D.error(`❌ Request to ${r} failed:`,t),t}}static async triggerManualCleanup(){try{D.debug("🔧 Triggering manual global audio cleanup...");const r=await this.makeAuthenticatedRequest("manualAudioCleanup");return D.success(2143),r}catch(r){throw D.error("❌ Manual cleanup failed:",r),r.message.includes("Access denied")||r.message.includes("PERMISSION_DENIED")?new Error("Access denied: Audio cleanup is restricted to super-users only"):new Error(`Manual cleanup failed: ${r.message}`)}}static async getCleanupStats(){try{D.debug(2927);const r=await this.makeAuthenticatedRequest("getCleanupStats");return D.success(3047),r}catch(r){throw D.error("❌ Failed to fetch cleanup stats:",r),r.message.includes("Access denied")||r.message.includes("PERMISSION_DENIED")?new Error("Access denied: Cleanup statistics are restricted to super-users only"):new Error(`Failed to fetch stats: ${r.message}`)}}static async getGlobalAudioStats(){try{D.debug(4037);const r=await this.makeAuthenticatedRequest("getGlobalAudioStats");return D.success(4130),r}catch(r){throw D.error("❌ Failed to fetch global audio stats:",r),r.message.includes("Access denied")||r.message.includes("PERMISSION_DENIED")?new Error("Access denied: Global audio statistics are restricted to super-users only"):new Error(`Failed to fetch global stats: ${r.message}`)}}static async previewCleanup(){try{D.debug("👁️ Previewing cleanup without deletion...");const r=await this.makeAuthenticatedRequest("previewAudioCleanup");return D.success(5312),r}catch(r){throw D.error("❌ Failed to preview cleanup:",r),r.message.includes("Access denied")||r.message.includes("PERMISSION_DENIED")?new Error("Access denied: Cleanup preview is restricted to super-users only"):new Error(`Failed to preview cleanup: ${r.message}`)}}static async requestAudioDeletion(r){try{return console.log("🗑️ Requesting manual audio deletion:",{warningId:r.warningId,reason:r.reason}),D.success(6517),!0}catch(s){throw D.error("❌ Audio deletion request failed:",s),new Error(`Deletion request failed: ${s.message}`)}}static formatCleanupSummary(r){if(!r.length)return{totalDeletions:0,averageProcessingTime:0,successRate:0,lastCleanupDate:null,recentErrors:[],totalOrganizationsProcessed:0,scheduledRuns:0,manualRuns:0};const s=r.reduce((o,n)=>o+n.result.successfulDeletions,0),t=r.reduce((o,n)=>o+n.result.processingTime,0)/r.length,i=r.reduce((o,n)=>o+n.result.successfulDeletions+n.result.failedDeletions,0),d=i>0?s/i*100:100,y=r[0]?.timestamp?new Date(r[0].timestamp).toLocaleDateString():null,g=r.flatMap(o=>o.result.errors).slice(0,5),p=r.reduce((o,n)=>o+n.result.organizationsProcessed.length,0),a=r.filter(o=>o.result.triggerMethod==="scheduled").length,c=r.filter(o=>o.result.triggerMethod==="manual").length;return{totalDeletions:s,averageProcessingTime:Math.round(t),successRate:Math.round(d*100)/100,lastCleanupDate:y,recentErrors:g,totalOrganizationsProcessed:p,scheduledRuns:a,manualRuns:c}}static async isCleanupHealthy(){try{const r=await this.getCleanupStats(),s=[],t=r.lastCleanup?new Date(r.lastCleanup):null,i=t?Math.floor((Date.now()-t.getTime())/(1e3*60*60*24)):999;if(i>2&&s.push(`Cleanup hasn't run for ${i} days`),r.recentAudits.length>0){const d=r.recentAudits[0],y=d.result.failedDeletions/(d.result.successfulDeletions+d.result.failedDeletions);y>.1&&s.push(`High error rate: ${Math.round(y*100)}% failures`)}try{const d=await this.previewCleanup();d.preview.totalExpired>50&&s.push(`${d.preview.totalExpired} expired audio files awaiting cleanup`)}catch(d){D.warn("Could not check for expired files:",d)}return{healthy:s.length===0,issues:s,lastCleanup:t,daysSinceLastCleanup:i,requiresAttention:s.length>0}}catch(r){return r.message.includes("Access denied")?{healthy:!1,issues:["Access denied: Super-user privileges required"],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}:{healthy:!1,issues:[`Failed to check cleanup health: ${r.message}`],lastCleanup:null,daysSinceLastCleanup:999,requiresAttention:!0}}}static getCleanupScheduleInfo(){const r=new Date,s=new Date(r);return s.setUTCHours(2,0,0,0),r.getUTCHours()>=2&&s.setUTCDate(s.getUTCDate()+1),{frequency:"Daily",nextRun:s.toLocaleString(),timezone:"UTC",description:"Automatically deletes expired audio recordings across all organizations",scope:"Global (All Organizations)"}}static async verifySuperUserAccess(){try{return await this.getCleanupStats(),!0}catch(r){return!r.message.includes("Access denied")}}static async withRetry(r,s=2,t=1e3){let i;for(let d=0;d<=s;d++)try{return await r()}catch(y){if(i=y,y.message.includes("Access denied")||y.message.includes("UNAUTHENTICATED")||y.message.includes("PERMISSION_DENIED"))throw y;if(d===s)break;D.debug(`🔄 Retry attempt ${d+1}/${s} after ${t}ms...`),await new Promise(g=>setTimeout(g,t)),t*=1.5}throw i}static async getFullDashboardData(){try{const[r,s,t,i]=await Promise.allSettled([this.withRetry(()=>this.getCleanupStats()),this.withRetry(()=>this.getGlobalAudioStats()),this.withRetry(()=>this.previewCleanup()),this.withRetry(()=>this.isCleanupHealthy())]),d=this.getCleanupScheduleInfo();return{stats:r.status==="fulfilled"?r.value:{error:r.reason?.message},globalStats:s.status==="fulfilled"?s.value:{error:s.reason?.message},preview:t.status==="fulfilled"?t.value:{error:t.reason?.message},health:i.status==="fulfilled"?i.value:{error:i.reason?.message},schedule:d}}catch(r){throw D.error("❌ Failed to load dashboard data:",r),r}}}const bn=()=>{const[l,r]=T.useState(null),[s,t]=T.useState(null),[i,d]=T.useState(!0),[y,g]=T.useState(!1),[p,a]=T.useState(null);T.useEffect(()=>{c()},[]);const c=async()=>{try{d(!0),a(null);const[u,x]=await Promise.all([Le.getCleanupStats(),Le.isCleanupHealthy()]);r(u),t(x)}catch(u){a(u.message),D.error("Failed to load cleanup dashboard:",u)}finally{d(!1)}},o=async()=>{try{g(!0),a(null);const u=await Le.triggerManualCleanup();await c(),alert(`✅ Manual cleanup completed!

Deleted: ${u.result.successfulDeletions} files
Scanned: ${u.result.totalScanned} warnings`)}catch(u){a(u.message),D.error("Manual cleanup failed:",u)}finally{g(!1)}};if(i)return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(Ot,{className:"w-6 h-6 animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading cleanup data..."})]});const n=l?Le.formatCleanupSummary(l.recentAudits):null,h=Le.getCleanupScheduleInfo();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Audio Cleanup Management"}),e.jsx("p",{className:"text-gray-600",children:"Monitor and manage automated audio file deletion"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:c,disabled:i,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors",children:[e.jsx(Ot,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Refresh"]}),e.jsxs("button",{onClick:o,disabled:y,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",children:[e.jsx(Os,{className:`w-4 h-4 ${y?"animate-spin":""}`}),y?"Running...":"Run Manual Cleanup"]})]})]}),p&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx(at,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-700",children:p})]}),s&&e.jsxs("div",{className:`p-4 rounded-lg border ${s.healthy?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.healthy?e.jsx(Qr,{className:"w-5 h-5 text-green-600"}):e.jsx(at,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("h3",{className:`font-semibold ${s.healthy?"text-green-900":"text-yellow-900"}`,children:["Cleanup System ",s.healthy?"Healthy":"Needs Attention"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Last Cleanup:"}),e.jsx("p",{className:"font-medium",children:s.lastCleanup?s.lastCleanup.toLocaleString():"Never"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Days Since Last Run:"}),e.jsx("p",{className:"font-medium",children:s.daysSinceLastCleanup})]})]}),s.issues.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-900 mb-1",children:"Issues:"}),e.jsx("ul",{className:"text-sm text-yellow-800 space-y-1",children:s.issues.map((u,x)=>e.jsxs("li",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 bg-yellow-600 rounded-full"}),u]},x))})]})]}),n&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx($s,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Deletions"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:n.totalDeletions.toLocaleString()})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Qr,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[n.successRate,"%"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(pt,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Avg Processing"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[n.averageProcessingTime,"ms"]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(Us,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Last Cleanup"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n.lastCleanupDate||"Never"})]})]})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(vt,{className:"w-5 h-5"}),"Cleanup Schedule"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Frequency:"}),e.jsx("p",{className:"font-medium",children:h.frequency})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Next Run:"}),e.jsx("p",{className:"font-medium",children:h.nextRun})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Timezone:"}),e.jsx("p",{className:"font-medium",children:h.timezone})]})]}),e.jsx("p",{className:"text-gray-600 mt-3 text-sm",children:h.description})]}),l&&l.recentAudits.length>0&&e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(Pa,{className:"w-5 h-5"}),"Recent Cleanup Logs"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Scanned"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Expired"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Deleted"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Failed"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Processing"}),e.jsx("th",{className:"px-6 py-3 text-left font-medium text-gray-900",children:"Orgs"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.recentAudits.slice(0,10).map(u=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:new Date(u.timestamp).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:u.result.totalScanned}),e.jsx("td",{className:"px-6 py-4",children:u.result.totalExpired}),e.jsx("td",{className:"px-6 py-4 text-green-600 font-medium",children:u.result.successfulDeletions}),e.jsx("td",{className:"px-6 py-4 text-red-600 font-medium",children:u.result.failedDeletions}),e.jsxs("td",{className:"px-6 py-4",children:[u.result.processingTime,"ms"]}),e.jsx("td",{className:"px-6 py-4",children:u.result.organizationsProcessed.length})]},u.id))})]})})]}),n&&n.recentErrors.length>0&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(at,{className:"w-5 h-5 text-red-600"}),"Recent Errors"]}),e.jsx("div",{className:"space-y-2",children:n.recentErrors.map((u,x)=>e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:u})},x))})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Zr,{className:"w-6 h-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"Compliance & Data Protection"}),e.jsx("p",{className:"text-blue-800 text-sm mb-3",children:"Audio recordings are automatically deleted when warnings expire to ensure compliance with data protection regulations. All deletion activities are logged for audit purposes."}),e.jsxs("ul",{className:"text-blue-700 text-sm space-y-1",children:[e.jsx("li",{children:"• Audio files are deleted from Firebase Storage"}),e.jsx("li",{children:"• Warning documents remain with deletion metadata"}),e.jsx("li",{children:"• All deletion activities are audited and logged"}),e.jsx("li",{children:"• Manual cleanup can be triggered by administrators"})]})]})]})})]})};var yn="basil",Xs="https://js.stripe.com",Cn="".concat(Xs,"/").concat(yn,"/stripe.js"),jn=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,wn=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Nn=function(r){return jn.test(r)||wn.test(r)},En=function(){for(var r=document.querySelectorAll('script[src^="'.concat(Xs,'"]')),s=0;s<r.length;s++){var t=r[s];if(Nn(t.src))return t}return null},Rs=function(r){var s="",t=document.createElement("script");t.src="".concat(Cn).concat(s);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(t),t},Oe=null,tr=null,sr=null,Bn=function(r){return function(s){r(new Error("Failed to load Stripe.js",{cause:s}))}},An=function(r,s){return function(){window.Stripe?r(window.Stripe):s(new Error("Stripe.js not available"))}},Dn=function(r){return Oe!==null?Oe:(Oe=new Promise(function(s,t){if(typeof window>"u"||typeof document>"u"){s(null);return}if(window.Stripe){s(window.Stripe);return}try{var i=En();if(!(i&&r)){if(!i)i=Rs(r);else if(i&&sr!==null&&tr!==null){var d;i.removeEventListener("load",sr),i.removeEventListener("error",tr),(d=i.parentNode)===null||d===void 0||d.removeChild(i),i=Rs(r)}}sr=An(s,t),tr=Bn(t),i.addEventListener("load",sr),i.addEventListener("error",tr)}catch(y){t(y);return}}),Oe.catch(function(s){return Oe=null,Promise.reject(s)}))},$e,Fn=function(){return $e||($e=Dn(null).catch(function(r){return $e=null,Promise.reject(r)}),$e)};Promise.resolve().then(function(){return Fn()}).catch(function(l){console.warn(l)});const Sn=!0,kn=Promise.resolve(null);class Rn{constructor(){this.stripe=kn,this.functions=Da(),this.isDevelopment=Sn}async createSubscription(r){try{if(D.debug("Creating Stripe subscription...",r),this.isDevelopment)return D.warn("Development mode: Returning mock Stripe session"),{sessionId:`cs_dev_${Date.now()}`,url:`${window.location.origin}/mock-checkout?plan=${r.planTier}&org=${r.organizationId}`};const i=(await rr(this.functions,"createCheckoutSession")({organizationId:r.organizationId,planTier:r.planTier,customerEmail:r.customerEmail,customerName:r.customerName,resellerId:r.resellerId,successUrl:r.successUrl,cancelUrl:r.cancelUrl})).data;return D.success("Stripe checkout session created:",i),i}catch(s){throw D.error("Failed to create Stripe subscription:",s),s}}async updateSubscriptionTier(r,s,t){try{D.debug("Updating subscription tier...",{subscriptionId:r,newTier:s,employeeCount:t});const y=(await rr(this.functions,"updateSubscription")({subscriptionId:r,newTier:s,employeeCount:t})).data;return D.success("Subscription updated:",y),y}catch(i){throw D.error("Failed to update subscription:",i),i}}async cancelSubscription(r,s){try{D.debug("Canceling subscription...",{subscriptionId:r,reason:s});const d=(await rr(this.functions,"cancelSubscription")({subscriptionId:r,reason:s})).data;return D.success("Subscription canceled:",d),d}catch(t){throw D.error("Failed to cancel subscription:",t),t}}getRecommendedTier(r){return r<=10?"starter":r<=50?"professional":r<=200?"enterprise":"enterprise-plus"}needsUpgrade(r,s){const t=SUBSCRIPTION_PLANS[r],i=this.getRecommendedTier(s);return{needsUpgrade:r!==i,recommendedTier:r!==i?i:void 0,exceedsLimit:s>t.employeeLimit}}calculateProratedUpgrade(r,s,t){const i=SUBSCRIPTION_PLANS[r],g=(SUBSCRIPTION_PLANS[s].price-i.price)/30;return Math.round(g*t)}async createCustomerPortalSession(r,s){try{if(D.debug("Creating customer portal session...",{customerId:r}),this.isDevelopment)return D.warn("Development mode: Returning mock customer portal URL"),{url:`${window.location.origin}/mock-portal?customer=${r}&return=${encodeURIComponent(s)}`};const d=(await rr(this.functions,"createPortalSession")({customerId:r,returnUrl:s})).data;return D.success("Customer portal session created:",d),d}catch(t){throw D.error("Failed to create customer portal session:",t),t}}formatPrice(r){return`R${(r/100).toFixed(2)}`}getStatusDisplay(r){switch(r){case"active":return{text:"Active",color:"green"};case"past_due":return{text:"Payment Due",color:"yellow"};case"unpaid":return{text:"Payment Failed",color:"red"};case"canceled":return{text:"Canceled",color:"gray"};default:return{text:"Unknown",color:"gray"}}}validateSubscriptionLimits(r,s){const t=SUBSCRIPTION_PLANS[r.plan];if(s<=t.employeeLimit)return{isValid:!0};const i=s-t.employeeLimit;return{isValid:!1,message:`Your organization has ${s} employees but your ${t.name} plan only supports ${t.employeeLimit}. You are ${i} employees over the limit.`,suggestedAction:"upgrade"}}}const ot=new Rn;class _n{static async createOrganization(r){let s=dt(Y);const t=r.id;try{D.debug(`🏢 [SHARDED ORG] Creating organization with sharded structure: ${t}`),D.debug(`📋 [SHARDED ORG] Organization name: ${r.name}`),D.debug(`👤 [SHARDED ORG] Admin user name: ${r.adminUser.firstName} ${r.adminUser.lastName}`),D.debug(`🗂️ [SHARDED ORG] Creating organization document at: organizations/${t}`);const i=oe(Y,"organizations",t),d={id:t,name:r.name,industry:r.industry||"",province:r.province||"",city:r.city||"",contactEmail:r.contactEmail,contactPhone:r.contactPhone||"",employeeCount:r.employeeCount||0,subscriptionTier:r.subscriptionTier,subscriptionStatus:r.subscriptionStatus,resellerId:r.resellerId||null,branding:r.branding||{logoUrl:"",primaryColor:"#2563eb"},createdAt:ie.getServerTimestamp(),updatedAt:ie.getServerTimestamp(),isActive:r.subscriptionStatus==="active",databaseVersion:"2.0",shardingEnabled:!0,dataStructure:"sharded"};s.set(i,d),await this.initializeShardedCollections(t,s),await this.createDefaultCategories(t,r.customCategories||[]),await s.commit(),D.success(`✅ [SHARDED ORG] Organization ${t} created with sharded structure`);const y=await this.createAdminUser(t,r.adminUser);return{organizationId:t,adminUserId:y,success:!0}}catch(i){D.error("❌ [SHARDED ORG] Failed to create organization:",i);try{await this.cleanupFailedOrganization(t)}catch(d){D.error("Failed to cleanup failed organization:",d)}return{organizationId:t,adminUserId:"",success:!1,error:i instanceof Error?i.message:"Unknown error"}}}static async initializeShardedCollections(r,s){D.debug(`🔧 [SHARDED ORG] Initializing sharded collections for ${r}`);const t=["employees","warnings","categories","users","meetings","reports"];for(const d of t){const y=oe(Y,`organizations/${r}/${d}`,"_metadata");s.set(y,{collectionName:d,organizationId:r,createdAt:ie.getServerTimestamp(),totalDocuments:0,lastUpdated:ie.getServerTimestamp()})}const i=oe(Y,`organizations/${r}/settings`,"main");s.set(i,{organizationId:r,defaultWarningLevel:"verbal",requireWitnessSignature:!0,autoEscalation:!0,notificationSettings:{emailNotifications:!0,smsNotifications:!1,deliveryConfirmation:!0},customFields:[],createdAt:ie.getServerTimestamp()})}static async createDefaultCategories(r,s=[]){if(D.debug(`📋 [SHARDED ORG] Creating categories for ${r}`),s.some(g=>g.isDefault===!0)){D.debug(`📚 [SHARDED ORG] Using ${s.length} wizard-modified categories`);for(const g of s)await qr.createWarningCategory(g,r);D.success(`✅ [SHARDED ORG] Created ${s.length} categories for ${r}`);return}D.debug(`📚 [SHARDED ORG] Using ${lt.length} default universal categories`);const i=lt.map(g=>({id:g.id,name:g.name,description:g.description,severity:g.severity,escalationPath:g.escalationPath,color:g.severity==="minor"?"#16a34a":g.severity==="serious"?"#ea580c":"#dc2626",isActive:!0,isDefault:!0,lraSection:g.lraSection,schedule8Reference:g.schedule8Reference,commonExamples:g.commonExamples,defaultValidityPeriod:g.defaultValidityPeriod,requiresImmediateAction:g.requiresImmediateAction||!1})),d=[...i],y=s.filter(g=>!g.isDefault);y.forEach((g,p)=>{typeof g=="string"?d.push({id:`custom-${p+1}`,name:g,description:`Custom category: ${g}`,severity:"minor",escalationPath:["counselling","verbal","first_written","final_written"],color:"#6366f1",isActive:!0,isDefault:!1}):d.push({...g,isDefault:!1})});for(const g of d)await qr.createWarningCategory(g,r);D.success(`✅ [SHARDED ORG] Created ${d.length} categories for ${r} (${i.length} default + ${y.length} custom)`)}static async createAdminUser(r,s){let t;try{D.debug(`👤 [SHARDED ORG] Creating admin user for ${r}`);const d=(await Fa(Xe,s.email,s.password)).user;t=d.uid,tt.startUserCreation(t),await Sa(d,{displayName:`${s.firstName} ${s.lastName}`}),D.debug(`📝 [SHARDED ORG] Creating user document with ID: ${t}`);const y={id:t,email:s.email,firstName:s.firstName,lastName:s.lastName,role:s.role,organizationId:r,isActive:!0,createdAt:ie.getServerTimestamp(),lastLogin:ie.getServerTimestamp(),permissions:{canManageEmployees:!0,canCreateWarnings:!0,canViewReports:!0,canManageUsers:!0,canManageSettings:!0}};await xe.createDocument(r,"users",y,t);try{await va.setUserOrganization(t,r,"business-owner",s.email,"sharded"),D.debug(`📋 Created UserOrgIndex entry: ${t} → ${r}`)}catch(g){D.error("❌ Failed to create UserOrgIndex entry:",g)}return tt.finishUserCreation(t),D.success(`✅ [SHARDED ORG] Admin user created: ${t}`),t}catch(i){if(t&&tt.finishUserCreation(t),i?.code==="auth/email-already-in-use"){const d=`Email ${s.email} is already in use. Please use a different email address or contact support if this is your email.`;throw D.error(`❌ [SHARDED ORG] ${d}`),new Error(d)}throw D.error("❌ [SHARDED ORG] Failed to create admin user:",i),i}}static async cleanupFailedOrganization(r){try{D.debug(`🧹 [SHARDED ORG] Cleaning up failed organization: ${r}`);const s=oe(Y,"organizations",r);await Ke(s,{},{merge:!1}),D.success(`✅ [SHARDED ORG] Cleanup completed for ${r}`)}catch(s){D.error("❌ [SHARDED ORG] Cleanup failed:",s)}}static async activateOrganization(r){try{D.debug(`🚀 [SHARDED ORG] Activating organization: ${r}`);const s=oe(Y,"organizations",r);await Ke(s,{subscriptionStatus:"active",isActive:!0,activatedAt:ie.getServerTimestamp(),updatedAt:ie.getServerTimestamp()},{merge:!0});const t=await xe.queryDocuments(r,"users",[["role","==","business-owner"]]);if(t.documents.length>0){const i=t.documents[0];await xe.updateDocument(r,"users",i.id,{isActive:!0,activatedAt:ie.getServerTimestamp()})}D.success(`✅ [SHARDED ORG] Organization ${r} activated`)}catch(s){throw D.error("❌ [SHARDED ORG] Failed to activate organization:",s),s}}static async getShardedOrganization(r){try{const s=oe(Y,"organizations",r),t=await xe.getDocument(r,"organizations",r);return t.exists?t.data:null}catch(s){return D.error("Failed to get sharded organization:",s),null}}static async migrateToShardedStructure(r){try{return D.warn(`🔄 [MIGRATION] Migrating organization to sharded structure: ${r}`),D.success(`✅ [MIGRATION] Organization ${r} ready for sharded structure`),!0}catch(s){return D.error("❌ [MIGRATION] Failed to migrate organization:",s),!1}}}const Pn=()=>{const l={minor:"#10b981",serious:"#f59e0b",gross_misconduct:"#ef4444"};return lt.map(r=>({id:r.id,name:r.name,description:r.description,icon:r.icon,level:r.escalationPath[0]||"verbal",color:l[r.severity],isActive:!0,isDefault:!0,escalationPath:r.escalationPath}))},ar={counselling:"Counselling",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"},zn=({category:l,onUpdate:r,onRemove:s})=>{const[t,i]=T.useState(!1),[d,y]=T.useState(l);T.useEffect(()=>{y(l)},[l]);const g=a=>{const c={...d,...a};y(c),r(c)},p=["counselling","verbal","first_written","second_written","final_written","suspension","dismissal"];return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[d.icon&&e.jsx("span",{className:"text-lg",children:d.icon}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300",style:{backgroundColor:d.color}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[d.name||"Unnamed Category",d.isDefault&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"Default"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:d.description||"No description"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Starting level: ",ar[d.level]]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>i(!t),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50",children:t?e.jsx(Oa,{className:"w-4 h-4"}):e.jsx(bt,{className:"w-4 h-4"})}),e.jsx("button",{type:"button",onClick:s,className:"p-2 text-red-400 hover:text-red-600 rounded-lg hover:bg-red-50",title:d.isDefault?"Remove default category":"Remove custom category",children:e.jsx($s,{className:"w-4 h-4"})})]})]}),t&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name"}),e.jsx("input",{type:"text",value:d.name,onChange:a=>g({name:a.target.value}),disabled:!1,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),e.jsx("select",{value:d.level,onChange:a=>g({level:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:p.map(a=>e.jsx("option",{value:a,children:ar[a]},a))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:d.description,onChange:a=>g({description:a.target.value}),disabled:!1,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),e.jsx("input",{type:"color",value:d.color,onChange:a=>g({color:a.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:d.isActive,onChange:a=>g({isActive:a.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),e.jsx("div",{className:"grid grid-cols-8 gap-2 p-4 border border-gray-300 rounded-lg bg-gray-50",children:["📋","⚠️","📊","🔒","👔","💼","🏢","📞","🖥️","📝","🗂️","📅","🔧","⚡","🎯","📈"].map(a=>e.jsx("button",{type:"button",onClick:()=>g({icon:a}),className:`w-12 h-12 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 ${d.icon===a?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"}`,children:a},a))}),d.icon&&e.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",e.jsx("span",{className:"text-lg",children:d.icon})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Escalation Path",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Add, remove, or duplicate steps)"})]}),e.jsx("div",{className:"space-y-2 mb-4",children:d.escalationPath?.map((a,c)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"w-6 h-6 bg-blue-500 text-white text-xs rounded-full flex items-center justify-center font-semibold",children:c+1}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:ar[a]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{type:"button",onClick:()=>{if(c>0){const o=[...d.escalationPath||[]];[o[c-1],o[c]]=[o[c],o[c-1]],g({escalationPath:o})}},disabled:c===0,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move up",children:"↑"}),e.jsx("button",{type:"button",onClick:()=>{if(c<(d.escalationPath?.length||0)-1){const o=[...d.escalationPath||[]];[o[c],o[c+1]]=[o[c+1],o[c]],g({escalationPath:o})}},disabled:c===(d.escalationPath?.length||0)-1,className:"w-6 h-6 flex items-center justify-center text-gray-400 hover:text-gray-600 disabled:opacity-30",title:"Move down",children:"↓"}),e.jsx("button",{type:"button",onClick:()=>{const o=[...d.escalationPath||[]];o.splice(c+1,0,a),g({escalationPath:o})},className:"w-6 h-6 flex items-center justify-center text-blue-500 hover:text-blue-700",title:"Duplicate this step",children:"⧨"}),e.jsx("button",{type:"button",onClick:()=>{const o=d.escalationPath?.filter((n,h)=>h!==c)||[];g({escalationPath:o})},disabled:(d.escalationPath?.length||0)<=1,className:"w-6 h-6 flex items-center justify-center text-red-500 hover:text-red-700 disabled:opacity-30",title:"Remove this step",children:"✕"})]})]},c))}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{onChange:a=>{if(a.target.value){const c=[...d.escalationPath||[],a.target.value];g({escalationPath:c}),a.target.value=""}},className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",defaultValue:"",children:[e.jsx("option",{value:"",children:"Add step..."}),p.filter(a=>a!=="suspension"&&a!=="dismissal").map(a=>e.jsx("option",{value:a,children:ar[a]},a))]}),e.jsx("span",{className:"text-xs text-gray-500",children:"Note: Escalation stops at Final Written. No suspension/dismissal steps needed."})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This shows the progression path for repeated offenses in this category."})]})]})]})},Zs=({isOpen:l,onClose:r,onComplete:s})=>{const{user:t}=ve(),[i,d]=T.useState(0),[y,g]=T.useState(!1),[p,a]=T.useState(null),[c,o]=T.useState([]),[n,h]=T.useState(null),u=t?.role?.id==="reseller",x=t?.role?.id==="super-user",m=()=>k[i]?.id,[b,v]=T.useState({companyName:"",employeeCount:15,selectedPlan:"professional",industry:"",province:"gauteng",city:"",contactPerson:"",contactEmail:"",contactPhone:"",resellerId:"",adminFirstName:"",adminLastName:"",adminEmail:"",adminPassword:"",adminPasswordConfirm:"",logoUrl:"",primaryColor:"#2563eb",secondaryColor:"#6366f1",accentColor:"#10b981",customCategories:Pn()}),[f,j]=T.useState(null),[C,w]=T.useState(""),[A,F]=T.useState(!1),z=async N=>new Promise((S,R)=>{const O=new Image,$=document.createElement("canvas"),K=$.getContext("2d");O.onload=()=>{$.width=O.width,$.height=O.height,K?.drawImage(O,0,0),$.toBlob(U=>{U?S(U):R(new Error("Failed to convert image to PNG"))},"image/png")},O.onerror=()=>R(new Error("Failed to load image")),O.src=URL.createObjectURL(N)}),E=async N=>{const S=N.target.files?.[0];if(!S)return;if(!["image/jpeg","image/jpg","image/png"].includes(S.type)){alert("Please upload a JPG or PNG file");return}if(S.size>5*1024*1024){alert("File size must be less than 5MB");return}j(S);const O=new FileReader;O.onload=$=>{w($.target?.result)},O.readAsDataURL(S)},B=async N=>{if(!f)return"";try{F(!0),D.info("📤 Uploading logo...");let S=f;(f.type==="image/jpeg"||f.type==="image/jpg")&&(D.info("🔄 Converting JPG to PNG..."),S=await z(f));const R=Date.now(),O=xt(ct,`organizations/${N}/logos/logo-${R}.png`);await ka(O,S);const $=await Ra(O);return D.success("✅ Logo uploaded successfully"),$}catch(S){throw D.error("Failed to upload logo:",S),S}finally{F(!1)}},k=[{id:"subscription",title:"Subscription & Payment",icon:$t},{id:"company",title:"Company Details",icon:ir},{id:"reseller",title:"Reseller Assignment",icon:pe},{id:"admin",title:"Admin Setup",icon:Gr},{id:"customize",title:"Customization",icon:Me}];T.useEffect(()=>{if(l)if(x){_();const N=ot.getRecommendedTier(b.employeeCount);v(S=>({...S,selectedPlan:N}))}else u&&(v(N=>({...N,resellerId:t?.resellerId||"",selectedPlan:"professional",subscriptionTier:"professional"})),H())},[l,b.employeeCount,x,u,t]);const _=async()=>{try{const S=(await X.getAllResellers()).filter(O=>O.isActive);o(S);const R=S.filter(O=>O.province===b.province);R.length===1&&v(O=>({...O,resellerId:R[0].id}))}catch(N){D.error("Failed to load resellers:",N)}},H=async()=>{if(!(!t?.id||!u))try{const N=new Date,S=new Date(N.getFullYear(),N.getMonth(),1),R=await X.getResellerDeployments(t.id,S),O=R.length,$=R.length>0?new Date(R[0].createdAt):void 0;let K=!0,U;if(O>=10)K=!1,U="Monthly deployment limit reached (10)";else if($){const ue=(N.getTime()-$.getTime())/6e4;ue<5&&(K=!1,U=`Rate limit: Please wait ${Math.ceil(5-ue)} minutes between deployments`)}h({canDeploy:K,reason:U,deploymentsThisMonth:O,lastDeployment:$})}catch(N){D.error("Failed to check deployment status:",N),h({canDeploy:!1,reason:"Unable to verify deployment status",deploymentsThisMonth:0})}},I=N=>{v(S=>({...S,...N})),a(null)},L=()=>{switch(m()){case"subscription":return b.companyName.trim()?b.employeeCount<1?{isValid:!1,message:"Employee count must be at least 1"}:{isValid:!0}:{isValid:!1,message:"Company name is required"};case"company":return b.contactPerson.trim()?b.contactEmail.trim()?b.contactPhone.trim()?{isValid:!0}:{isValid:!1,message:"Contact phone is required"}:{isValid:!1,message:"Contact email is required"}:{isValid:!1,message:"Contact person is required"};case"reseller":return b.resellerId?{isValid:!0}:{isValid:!1,message:"Please select a reseller"};case"admin":return b.adminFirstName.trim()?b.adminLastName.trim()?b.adminEmail.trim()?b.adminPassword.length<6?{isValid:!1,message:"Password must be at least 6 characters"}:b.adminPassword!==b.adminPasswordConfirm?{isValid:!1,message:"Passwords do not match"}:{isValid:!0}:{isValid:!1,message:"Admin email is required"}:{isValid:!1,message:"Admin last name is required"}:{isValid:!1,message:"Admin first name is required"};case"customize":return{isValid:!0};default:return{isValid:!0}}},Q=()=>{const N=L();if(!N.isValid){a(N.message||"Please complete all required fields");return}i<k.length-1&&(d(i+1),a(null),m()==="reseller"&&_())},W=()=>{i>0&&(d(i-1),a(null))},q=async()=>{try{if(u&&n&&!n.canDeploy){a(n.reason||"Cannot deploy at this time");return}g(!0),a(null),D.debug("🚀 [DEV MODE] Starting organization deployment with auto-approval...");const N=b.companyName.toLowerCase().replace(/[^a-z0-9]/g,"-");let S=b.logoUrl;if(f)try{S=await B(N),D.success("✅ Logo uploaded and converted to PNG")}catch($){D.error("Failed to upload logo:",$)}const R="temp123",O=await _n.createOrganization({id:N,name:b.companyName,industry:b.industry,province:b.province,city:b.city,contactEmail:b.contactEmail,contactPhone:b.contactPhone,employeeCount:b.employeeCount,subscriptionTier:b.selectedPlan,subscriptionStatus:"active",resellerId:b.resellerId,branding:{logoUrl:S,primaryColor:b.primaryColor,secondaryColor:b.secondaryColor,accentColor:b.accentColor},adminUser:{firstName:b.adminFirstName,lastName:b.adminLastName,email:b.adminEmail,password:R,role:"business-owner"},customCategories:b.customCategories});if(!O.success)throw new Error(O.error||"Failed to create organization");D.success(`✅ Organization '${b.companyName}' deployed successfully!`),D.success(`📧 Admin email: ${b.adminEmail}`),D.success(`🔑 Admin password: ${R}`);try{await ba.createDefaultDepartments(N),D.success("✅ Default departments created successfully")}catch($){D.warn("Failed to create default departments:",$)}if(u&&t?.id)try{const $=await Qe(()=>import("./business-owner-dashboard-mIihUYS1.js").then(K=>K.R),__vite__mapDeps([0,1,2,3,4])).then(K=>K.TimeService.getServerTimestamp());await X.logResellerDeployment({resellerId:t.id,organizationId:N,organizationName:b.companyName,adminEmail:b.adminEmail,deployedAt:$,notes:"Deployed via unified wizard"}),D.success("✅ Reseller deployment logged successfully")}catch($){D.error("Failed to log reseller deployment:",$)}alert(`🎉 Organization '${b.companyName}' created successfully!

📧 Admin Login: ${b.adminEmail}
🔑 Password: ${R}

The organization is now active and ready to use!`),r()}catch(N){D.error("❌ Deployment failed:",N),a(N instanceof Error?N.message:"Deployment failed")}finally{g(!1)}},G=()=>c.filter(N=>N.province===b.province),P=N=>`R${(N/100).toFixed(2)}`;return l?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Deploy New Client"}),e.jsxs("p",{className:"text-gray-600",children:["Step ",i+1," of ",k.length,": ",k[i].title]})]}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",disabled:y,children:"✕"})]}),e.jsx("div",{className:"flex items-center mt-4 space-x-2",children:k.map((N,S)=>e.jsxs(Is.Fragment,{children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium ${S<=i?"bg-blue-600 text-white":"bg-gray-200 text-gray-600"}`,children:S<i?e.jsx(Me,{className:"w-4 h-4"}):S+1}),S<k.length-1&&e.jsx("div",{className:`flex-1 h-2 rounded ${S<i?"bg-blue-600":"bg-gray-200"}`})]},N.id))})]}),e.jsxs("div",{className:"px-6 py-6",children:[u&&n&&!n.canDeploy&&e.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-red-900",children:"Deployment Temporarily Unavailable"}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:n.reason}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Deployments this month:"}),e.jsxs("div",{className:"font-semibold",children:[n.deploymentsThisMonth," / 10"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Last deployment:"}),e.jsx("div",{className:"font-semibold",children:n.lastDeployment?n.lastDeployment.toLocaleDateString("en-ZA"):"Never"})]})]})]})]})}),m()==="subscription"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company & Subscription Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),e.jsx("input",{type:"text",value:b.companyName,onChange:N=>I({companyName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter company name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number of Employees *"}),e.jsx("input",{type:"number",min:"1",value:b.employeeCount,onChange:N=>I({employeeCount:parseInt(N.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold mb-4",children:"Select Subscription Plan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(ge).map(([N,S])=>e.jsx("div",{className:`relative border rounded-lg p-4 cursor-pointer transition-all ${b.selectedPlan===N?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"}`,onClick:()=>I({selectedPlan:N}),children:e.jsxs("div",{className:"text-center",children:[e.jsx("h5",{className:"font-semibold",children:S.name}),e.jsx("div",{className:"text-2xl font-bold text-blue-600 my-2",children:P(S.price)}),e.jsx("div",{className:"text-sm text-gray-500 mb-3",children:"per month"}),e.jsxs("div",{className:"text-sm",children:["Up to ",S.employeeLimit===999999?"unlimited":S.employeeLimit," employees"]}),b.selectedPlan===N&&e.jsx(Me,{className:"absolute top-2 right-2 w-5 h-5 text-blue-500"})]})},N))}),ot.getRecommendedTier(b.employeeCount)!==b.selectedPlan&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm",children:["Based on ",b.employeeCount," employees, we recommend the"," ",e.jsx("strong",{children:ge[ot.getRecommendedTier(b.employeeCount)].name})," plan"]})]})})]})]}),m()==="company"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Company Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),e.jsxs("select",{value:b.industry,onChange:N=>I({industry:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Select industry"}),e.jsx("option",{value:"manufacturing",children:"Manufacturing"}),e.jsx("option",{value:"retail",children:"Retail & Commerce"}),e.jsx("option",{value:"healthcare",children:"Healthcare"}),e.jsx("option",{value:"security",children:"Security Services"}),e.jsx("option",{value:"mining",children:"Mining"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Province *"}),e.jsx("select",{value:b.province,onChange:N=>I({province:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:Object.entries(de).map(([N,S])=>e.jsx("option",{value:N,children:S.name},N))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City / Town"}),e.jsx("input",{type:"text",value:b.city,onChange:N=>I({city:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter city or town"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Person *"}),e.jsx("input",{type:"text",value:b.contactPerson,onChange:N=>I({contactPerson:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Primary contact person"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Email *"}),e.jsx("input",{type:"email",value:b.contactEmail,onChange:N=>I({contactEmail:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"contact@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contact Phone *"}),e.jsx("input",{type:"tel",value:b.contactPhone,onChange:N=>I({contactPhone:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"+27 (0)11 123 4567"})]})]})]}),m()==="reseller"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Assign Reseller"}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Available resellers in ",de[b.province]?.name]})]}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"This reseller will receive 50% commission on monthly payments"})]}),e.jsxs("div",{className:"space-y-3",children:[G().map(N=>e.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${b.resellerId===N.id?"border-blue-500 bg-blue-50 ring-2 ring-blue-500":"border-gray-200 hover:border-gray-300"}`,onClick:()=>I({resellerId:N.id}),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium",children:[N.firstName," ",N.lastName]}),e.jsx("p",{className:"text-sm text-gray-600",children:N.email}),e.jsxs("p",{className:"text-sm text-gray-500",children:[N.clientIds?.length||0," active clients • Territory: ",N.territory?.join(", ")||"Not specified"]})]}),b.resellerId===N.id&&e.jsx(Me,{className:"w-5 h-5 text-blue-500"})]})},N.id)),G().length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsxs("p",{className:"text-gray-600",children:["No resellers available in ",de[b.province]?.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Please contact support to set up resellers in this province"})]})]})]}),m()==="admin"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Administrator Account"}),e.jsx("form",{onSubmit:N=>N.preventDefault(),autoComplete:"off",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),e.jsx("input",{type:"text",value:b.adminFirstName,onChange:N=>I({adminFirstName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),e.jsx("input",{type:"text",value:b.adminLastName,onChange:N=>I({adminLastName:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address *"}),e.jsx("input",{type:"email",value:b.adminEmail,onChange:N=>I({adminEmail:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),e.jsx("input",{type:"password",value:b.adminPassword,onChange:N=>I({adminPassword:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Minimum 6 characters",autoComplete:"off"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),e.jsx("input",{type:"password",value:b.adminPasswordConfirm,onChange:N=>I({adminPasswordConfirm:N.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]})]})})]}),m()==="customize"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Branding & Category Configuration"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 bg-gray-50",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Company Logo"}),e.jsx("p",{className:"text-xs text-gray-500 mb-4",children:"Upload a JPG or PNG file (max 5MB). JPG files will be automatically converted to PNG."}),C?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:C,alt:"Logo preview",className:"max-w-xs max-h-32 rounded-lg border-2 border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>{j(null),w("")},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:e.jsx(Xr,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(za,{className:"w-4 h-4"}),e.jsx("span",{children:f?.name}),f?.type.includes("jpeg")&&e.jsx("span",{className:"text-xs text-blue-600",children:"(will be converted to PNG)"})]})]}):e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:E,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 border-2 border-gray-300 border-dashed rounded-lg hover:border-blue-400 transition-colors",children:[e.jsx(Ta,{className:"w-12 h-12 text-gray-400 mb-2"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Click to upload logo"}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"JPG or PNG (max 5MB)"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-2",children:"Or provide a logo URL:"}),e.jsx("input",{type:"url",value:b.logoUrl,onChange:N=>I({logoUrl:N.target.value}),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://example.com/logo.png",disabled:!!f})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Primary Color"}),e.jsx("input",{type:"color",value:b.primaryColor,onChange:N=>I({primaryColor:N.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Secondary Color"}),e.jsx("input",{type:"color",value:b.secondaryColor,onChange:N=>I({secondaryColor:N.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Accent Color"}),e.jsx("input",{type:"color",value:b.accentColor,onChange:N=>I({accentColor:N.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]})]}),e.jsxs("div",{className:"border-t-4 border-blue-200 bg-blue-50 rounded-lg p-6 mt-8",children:[e.jsx("h4",{className:"text-xl font-bold text-blue-900 mb-2 flex items-center gap-2",children:"📋 Warning Categories Configuration"}),e.jsx("p",{className:"text-sm text-blue-800 mb-6 font-medium",children:"⚠️ IMPORTANT: Customize the disciplinary categories for your organization. You can edit, remove, or add categories and configure their escalation paths."}),e.jsxs("div",{className:"grid gap-4",children:[b.customCategories.map((N,S)=>e.jsx(zn,{category:N,onUpdate:R=>{const O=[...b.customCategories];O[S]=R,I({customCategories:O})},onRemove:()=>{const R=b.customCategories.filter((O,$)=>$!==S);I({customCategories:R})}},N.id)),e.jsxs("button",{type:"button",onClick:()=>{const N={id:`custom-${Date.now()}`,name:"",description:"",level:"verbal",color:"#6366f1",icon:"📋",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]};I({customCategories:[...b.customCategories,N]})},className:"p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-center",children:[e.jsx(Ia,{className:"w-5 h-5 mx-auto mb-2 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Add Custom Category"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mt-6",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Deployment Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Company:"})," ",b.companyName]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Plan:"})," ",ge[b.selectedPlan].name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Monthly Cost:"})," ",P(ge[b.selectedPlan].price)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Province:"})," ",de[b.province]?.name]})]}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mt-4",children:e.jsxs("div",{className:"text-sm text-green-800",children:[e.jsx("strong",{children:"Revenue Breakdown (Monthly):"}),e.jsx("br",{}),"• Client pays: ",P(ge[b.selectedPlan].price),e.jsx("br",{}),"• Reseller commission (50%): ",P(Math.round(ge[b.selectedPlan].price*.5)),e.jsx("br",{}),"• Your income (30%): ",P(Math.round(ge[b.selectedPlan].price*.3)),e.jsx("br",{}),"• Company fund (20%): ",P(Math.round(ge[b.selectedPlan].price*.2))]})})]})]}),p&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2 text-red-800",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:p})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("button",{onClick:W,disabled:i===0||y,className:"flex items-center gap-2 px-4 py-2 text-gray-600 disabled:text-gray-400 disabled:cursor-not-allowed",children:[e.jsx(Ms,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:r,disabled:y,className:"px-4 py-2 text-gray-600 hover:text-gray-800 disabled:cursor-not-allowed",children:"Cancel"}),i===k.length-1?e.jsx("button",{onClick:q,disabled:!L().isValid||y,className:"flex items-center gap-2 px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Ha,{className:"w-4 h-4 animate-spin"}),"Processing Payment..."]}):e.jsxs(e.Fragment,{children:[e.jsx($t,{className:"w-4 h-4"}),"Deploy & Pay"]})}):e.jsxs("button",{onClick:Q,disabled:!L().isValid,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:["Next",e.jsx(La,{className:"w-4 h-4"})]})]})]})]})}):null},co=Object.freeze(Object.defineProperty({__proto__:null,EnhancedOrganizationWizard:Zs},Symbol.toStringTag,{value:"Module"})),_s="dashboard_quotes_preferences",Tn=15e3,nr=[{id:1,text:"There is no passion to be found playing small – in settling for a life that is less than the one you are capable of living.",author:"Nelson Mandela",category:"leadership",isPopular:!0},{id:2,text:"I learned that courage was not the absence of fear, but the triumph over it.",author:"Nelson Mandela",category:"courage",isPopular:!0},{id:3,text:"Ubuntu does not mean that people should not enrich themselves. The question is: are you going to do so in order to enable the community around you to be able to improve?",author:"Nelson Mandela",category:"unity"},{id:4,text:"Don't look where you fall, but where you slipped.",author:"African Proverb",category:"wisdom"},{id:5,text:"However long the night, the dawn will break.",author:"African Proverb",category:"perseverance",isPopular:!0},{id:6,text:"If you want to go fast, go alone. If you want to go far, go together.",author:"African Proverb",category:"unity",isPopular:!0},{id:7,text:"The brave may not live forever, but the cautious do not live at all.",author:"Desmond Tutu",category:"courage"},{id:8,text:"Hope is being able to see that there is light despite all of the darkness.",author:"Desmond Tutu",category:"perseverance"},{id:9,text:"Education is the most powerful weapon which you can use to change the world.",author:"Nelson Mandela",category:"wisdom",isPopular:!0},{id:10,text:"It always seems impossible until it's done.",author:"Nelson Mandela",category:"perseverance",isPopular:!0}],In=()=>{const[l,r]=T.useState(0),[s,t]=T.useState(!0),[i,d]=T.useState({favoriteQuotes:[],showOnlyFavorites:!1,rotationEnabled:!0});T.useEffect(()=>{try{const x=localStorage.getItem(_s);if(x){const m=JSON.parse(x);d(m),t(m.rotationEnabled)}}catch(x){D.warn("⚠️ Failed to load quotes preferences:",x)}},[]);const y=T.useCallback(x=>{try{localStorage.setItem(_s,JSON.stringify(x))}catch(m){D.warn("⚠️ Failed to save quotes preferences:",m)}},[]),p=T.useCallback(()=>i.showOnlyFavorites&&i.favoriteQuotes.length>0?nr.filter(x=>i.favoriteQuotes.includes(x.id)):nr,[i])(),a=p[l]||nr[0];T.useEffect(()=>{if(!s||p.length<=1)return;const x=setInterval(()=>{r(m=>(m+1)%p.length)},Tn);return()=>clearInterval(x)},[s,p.length]);const c=T.useCallback(()=>{r(x=>(x+1)%p.length)},[p.length]),o=T.useCallback(()=>{r(x=>(x-1+p.length)%p.length)},[p.length]),n=T.useCallback(()=>{const x=!s;t(x);const m={...i,rotationEnabled:x};d(m),y(m)},[s,i,y]),h=T.useCallback(x=>{const m=i.favoriteQuotes.includes(x)?i.favoriteQuotes.filter(v=>v!==x):[...i.favoriteQuotes,x],b={...i,favoriteQuotes:m};d(b),y(b)},[i,y]),u=T.useCallback(x=>{const m={...i,...x};d(m),y(m),x.rotationEnabled!==void 0&&t(x.rotationEnabled)},[i,y]);return{currentQuote:a,allQuotes:nr,isRotating:s,preferences:i,nextQuote:c,previousQuote:o,toggleRotation:n,toggleFavorite:h,updatePreferences:u}},Ps=()=>{const{currentTheme:l,setTheme:r}=t0(),t=T.useContext(ya)?.organization||null,[i,d]=T.useState(!1),y=T.useRef(null),g=[{value:"light",label:"Light",icon:e.jsx($a,{className:"w-4 h-4"}),description:"Clean and bright"},{value:"dark",label:"Dark",icon:e.jsx(Ua,{className:"w-4 h-4"}),description:"Easy on the eyes"},{value:"branded",label:"Branded",icon:e.jsx(Ma,{className:"w-4 h-4"}),description:t?.name?`${t.name} colors`:"Organization colors"}],p=t?g:g.filter(o=>o.value!=="branded"),a=p.find(o=>o.value===l)||p[0];T.useEffect(()=>{!t&&l==="branded"&&r("light")},[t,l,r]),T.useEffect(()=>{const o=n=>{y.current&&!y.current.contains(n.target)&&d(!1)};return i&&document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[i]);const c=o=>{r(o),d(!1)};return e.jsxs("div",{className:"relative",ref:y,children:[e.jsxs("button",{onClick:()=>d(!i),className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg border\r
                   bg-[var(--color-card-background)] text-[var(--color-text)]\r
                   border-[var(--color-border)] hover:border-[var(--color-border-secondary)]\r
                   transition-all duration-200 hover:shadow-sm`,"aria-label":"Select theme",children:[e.jsx("span",{className:"text-[var(--color-primary)]",children:a.icon}),e.jsx("span",{className:"hidden sm:inline",children:a.label}),e.jsx(bt,{className:`w-4 h-4 text-[var(--color-text-tertiary)] transition-transform duration-200 ${i?"rotate-180":""}`})]}),i&&e.jsx("div",{className:`absolute right-0 bottom-full mb-2 w-56 rounded-lg shadow-lg\r
                        bg-[var(--color-card-background)] border border-[var(--color-border)]\r
                        overflow-hidden z-50 animate-fade-in`,children:e.jsx("div",{className:"p-1",children:p.map(o=>e.jsxs("button",{onClick:()=>c(o.value),className:`w-full flex items-center gap-3 px-3 py-2 text-sm rounded-md
                           transition-all duration-150
                           ${l===o.value?"bg-[var(--color-primary)] text-white":"hover:bg-[var(--color-background-secondary)] text-[var(--color-text)]"}`,children:[e.jsx("span",{className:l===o.value?"text-white":"text-[var(--color-primary)]",children:o.icon}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium",children:o.label}),e.jsx("div",{className:`text-xs ${l===o.value?"text-white/80":"text-[var(--color-text-tertiary)]"}`,children:o.description})]}),l===o.value&&e.jsx(Me,{className:"w-4 h-4"})]},o.value))})})]})},Hn=l=>{const[r,s]=T.useState(window.innerWidth>l),t=T.useCallback(()=>{s(window.innerWidth>l)},[l]);return T.useEffect(()=>(t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)),[t]),r},Kr=T.memo(({className:l=""})=>{const r=Hn(768),{currentQuote:s,isRotating:t,preferences:i,nextQuote:d,previousQuote:y,toggleRotation:g,toggleFavorite:p}=In(),a=i.favoriteQuotes.includes(s.id);return e.jsx("div",{className:l,children:r?e.jsx(J,{padding:"md",shadow:"sm",className:l,style:{background:"linear-gradient(to right, var(--color-background-secondary), var(--color-card-background))",border:"1px solid var(--color-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 mr-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ut,{className:"w-4 h-4 mt-1 flex-shrink-0",style:{color:"var(--color-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("blockquote",{className:"italic text-sm leading-tight",style:{color:"var(--color-text-secondary)"},children:['"',s.text,'"']}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("cite",{className:"text-xs font-medium not-italic",style:{color:"var(--color-primary)"},children:["— ",s.author]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.isPopular&&e.jsx(qe,{variant:"warning",size:"sm",children:"⭐"}),e.jsx(qe,{variant:"default",size:"sm",className:"capitalize",children:s.category})]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(ye,{variant:"ghost",size:"sm",onClick:y,title:"Previous quote",children:e.jsx(Mt,{className:"w-4 h-4"})}),e.jsx(ye,{variant:"ghost",size:"sm",onClick:d,title:"Next quote",children:e.jsx(Ge,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 mx-1",style:{backgroundColor:"var(--color-border)"}}),e.jsx(ye,{variant:"ghost",size:"sm",onClick:()=>p(s.id),title:a?"Remove from favorites":"Add to favorites",style:{color:a?"var(--color-error)":"var(--color-text-tertiary)",backgroundColor:a?"var(--color-alert-error-bg)":"transparent"},children:e.jsx(Wt,{className:`w-4 h-4 ${a?"fill-current":""}`})}),e.jsx(ye,{variant:"ghost",size:"sm",onClick:g,title:t?"Pause rotation":"Start rotation",style:{color:t?"var(--color-success)":"var(--color-text-tertiary)",backgroundColor:t?"var(--color-alert-success-bg)":"transparent"},children:t?e.jsx(Wa,{className:"w-4 h-4"}):e.jsx(Os,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-6 mx-1",style:{backgroundColor:"var(--color-border)"}}),e.jsx("div",{className:"ml-1",children:e.jsx(Ps,{})})]})]})}):e.jsxs(J,{padding:"sm",shadow:"md",style:{background:"linear-gradient(135deg, var(--color-card-background), var(--color-background-secondary))",backdropFilter:"blur(10px)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("h3",{className:"text-sm font-semibold flex items-center gap-1.5",style:{color:"var(--color-text)"},children:[e.jsx(Ut,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),"Daily Inspiration"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{variant:"ghost",size:"sm",onClick:()=>p(s.id),"aria-label":a?"Remove from favorites":"Add to favorites",style:{color:a?"var(--color-error)":"var(--color-text-tertiary)",backgroundColor:a?"var(--color-alert-error-bg)":"transparent",padding:"4px"},children:e.jsx(Wt,{className:`w-3.5 h-3.5 ${a?"fill-current":""}`})}),e.jsx("div",{className:"scale-75",children:e.jsx(Ps,{})})]})]}),e.jsxs("blockquote",{className:"mb-1.5 italic text-sm leading-tight",style:{color:"var(--color-text-secondary)"},children:['"',s.text,'"']}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{variant:"ghost",size:"sm",onClick:y,"aria-label":"Previous quote",style:{padding:"4px"},children:e.jsx(Mt,{className:"w-3.5 h-3.5"})}),e.jsx(ye,{variant:"ghost",size:"sm",onClick:d,"aria-label":"Next quote",style:{padding:"4px"},children:e.jsx(Ge,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("cite",{className:"text-xs font-medium not-italic",style:{color:"var(--color-primary)"},children:["— ",s.author]}),e.jsx(qe,{variant:"primary",size:"sm",className:"capitalize text-xs",children:s.category})]})]})]})})});Kr.displayName="QuotesSection";const Ln=l=>{if(l===0)return"0 B";const r=1024,s=["B","KB","MB","GB"],t=Math.floor(Math.log(l)/Math.log(r));return`${parseFloat((l/Math.pow(r,t)).toFixed(2))} ${s[t]}`},On=async l=>{try{let r=0;const s=xt(ct,`organizations/${l}/audio`);try{const i=await It(s);for(const d of i.items){const y=await Ht(d);r+=y.size||0}}catch{}const t=xt(ct,`organizations/${l}/signatures`);try{const i=await It(t);for(const d of i.items){const y=await Ht(d);r+=y.size||0}}catch{}return r}catch(r){return D.error(`Error calculating storage for ${l}:`,r),0}},$n=l=>{const[r,s]=T.useState(window.innerWidth>l),t=T.useCallback(()=>s(window.innerWidth>l),[l]);return T.useEffect(()=>(window.addEventListener("resize",t),t(),()=>window.removeEventListener("resize",t)),[t]),r},Un=()=>{const{user:l}=ve(),r=$n(768),[s,t]=T.useState({totalOrganizations:0,totalEmployees:0,totalResellers:0,monthlyGrowth:0}),[i,d]=T.useState([]),[y,g]=T.useState(!0),[p,a]=T.useState(null),[c,o]=T.useState(!1),[n,h]=T.useState({isOpen:!1,organizationId:"",organizationName:""});T.useEffect(()=>{u()},[]);const u=async()=>{try{g(!0),D.debug("Loading SuperAdmin dashboard data...");const f=Xe.currentUser;if(f){const L=await f.getIdTokenResult();if(console.log("🔍 [DEBUG] User custom claims:",L.claims),console.log("🔍 [DEBUG] User role:",L.claims.role),console.log("🔍 [DEBUG] Is super-user?",L.claims.role==="super-user"),!L.claims.role||typeof L.claims.role=="object"){console.warn("⚠️ Role missing or incorrectly formatted! Calling refreshUserClaims...");try{const{getFunctions:W,httpsCallable:q}=await Qe(async()=>{const{getFunctions:S,httpsCallable:R}=await import("./firebase-vendor-ZA7KOHFb.js").then(O=>O.Y);return{getFunctions:S,httpsCallable:R}},[]),G=W(void 0,"us-central1"),N=await q(G,"refreshUserClaims")({});console.log("✅ Claims refreshed! Please sign out and back in:",N.data),alert("Your user role has been refreshed! Please SIGN OUT and SIGN BACK IN for changes to take effect.");return}catch(W){console.error("❌ Failed to refresh claims:",W)}}}const j=await X.loadOrganizations();let C=0,w=0;const A=await Promise.all(j.map(async L=>{try{const W=(await xe.queryDocuments(L.id,"warnings")).documents.filter(G=>G.isActive===!0),q=await On(L.id);return{...L,warningCount:W.length,storageUsage:q}}catch{return{...L,warningCount:0,storageUsage:0}}}));d(A),A.forEach(L=>{C+=L.employeeCount||0,L.resellerId&&w++});const F=new Date,z=F.getMonth(),E=F.getFullYear(),B=z===0?11:z-1,k=z===0?E-1:E;let _=0,H=0;A.forEach(L=>{if(L.createdAt){const Q=L.createdAt instanceof Date?L.createdAt:L.createdAt.toDate?.()||new Date(L.createdAt),W=Q.getMonth(),q=Q.getFullYear();W===z&&q===E&&_++,W===B&&q===k&&H++}});let I=0;H>0?I=Math.round((_-H)/H*100):_>0&&(I=100),t({totalOrganizations:A.length,totalEmployees:C,totalResellers:Math.max(w,1),monthlyGrowth:I}),D.success("SuperAdmin dashboard data loaded successfully")}catch(f){D.error("Error loading SuperAdmin dashboard:",f)}finally{g(!1)}},x=f=>{h({isOpen:!0,organizationId:f.id,organizationName:f.name})},m=async f=>{D.success("Organization deployed successfully!",f),o(!1),await u()};if(!r)return e.jsxs("div",{className:"space-y-6 pb-20",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:"👑 Super Admin"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:"Global system management"})]}),e.jsx(J,{padding:"md",shadow:"lg",hover:!0,onClick:()=>o(!0),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))",color:"var(--color-text-inverse)",minHeight:"64px",willChange:"transform"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ut,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold text-lg",children:"Deploy New Organization"})]}),e.jsx(Ge,{className:"w-5 h-5"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(J,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("organizations"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"white",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(ir,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Organizations"}),e.jsx("span",{className:"text-lg font-bold",children:s.totalOrganizations})]})}),e.jsx(J,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("organizations"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Employees"}),e.jsx("span",{className:"text-lg font-bold",children:s.totalEmployees.toLocaleString()})]})}),e.jsx(J,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("resellers"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"white",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(qt,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Resellers"}),e.jsx("span",{className:"text-lg font-bold",children:s.totalResellers})]})}),e.jsx(J,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>a("financial"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, #8b5cf6, #7c3aed)",color:"white",minHeight:"80px",willChange:"transform"},children:e.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Growth"}),e.jsxs("span",{className:"text-lg font-bold",children:["+",s.monthlyGrowth,"%"]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(J,{padding:"md",shadow:"sm",hover:!0,onClick:()=>a("audio"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(vt,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Audio Cleanup"})]}),e.jsx(Ge,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),e.jsx(J,{padding:"md",shadow:"sm",hover:!0,onClick:()=>a("financial"),className:"cursor-pointer transition-all duration-200 active:scale-95",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Vr,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Financial Dashboard"})]}),e.jsx(Ge,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),e.jsx(Kr,{}),v()]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[e.jsx(J,{padding:"sm",shadow:"md",hover:!0,onClick:()=>a("organizations"),className:"cursor-pointer",style:{minHeight:"80px"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ir,{className:"w-8 h-8 text-blue-600",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Organizations"}),e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:s.totalOrganizations})]})]})}),e.jsx(J,{padding:"sm",shadow:"md",hover:!0,onClick:()=>a("organizations"),className:"cursor-pointer",style:{minHeight:"80px"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-8 h-8 text-green-600",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Total Employees"}),e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:s.totalEmployees.toLocaleString()})]})]})}),e.jsx(J,{padding:"sm",shadow:"md",hover:!0,onClick:()=>a("resellers"),className:"cursor-pointer",style:{minHeight:"80px"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(qt,{className:"w-8 h-8 text-orange-600",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Active Resellers"}),e.jsx("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:s.totalResellers})]})]})}),e.jsx(J,{padding:"sm",shadow:"md",hover:!0,onClick:()=>a("financial"),className:"cursor-pointer",style:{minHeight:"80px"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{className:"w-8 h-8 text-purple-600",style:{opacity:.7}}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Monthly Growth"}),e.jsxs("div",{className:"text-2xl font-bold",style:{color:"var(--color-text)"},children:["+",s.monthlyGrowth,"%"]})]})]})})]}),e.jsx("div",{className:"border-b",style:{borderColor:"var(--color-border)"},children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:[{id:"organizations",label:"Organizations",count:s.totalOrganizations},{id:"resellers",label:"Resellers",count:s.totalResellers},{id:"audio",label:"Audio Cleanup",count:null},{id:"financial",label:"Financial",count:null}].map(f=>e.jsxs("button",{onClick:()=>a(f.id),className:`py-3 px-1 border-b-2 font-medium text-sm transition-colors ${p===f.id?"border-blue-500 text-blue-600":"border-transparent hover:border-gray-300"}`,style:{color:p===f.id?"var(--color-primary)":"var(--color-text-secondary)"},children:[f.label,f.count!==null&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full bg-gray-100",children:f.count})]},f.id))})}),p&&b(),e.jsx(Kr,{}),v()]});function b(){switch(p){case"organizations":return e.jsxs(J,{padding:"none",shadow:"md",children:[e.jsxs("div",{className:"px-6 py-4 border-b flex items-center justify-between",style:{borderColor:"var(--color-border)"},children:[e.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"🏢 Organizations & Category Management"}),e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition-colors",style:{background:"var(--color-primary)",color:"var(--color-text-inverse)"},children:[e.jsx(ut,{className:"w-4 h-4"}),"Deploy New Organization"]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Loading organizations..."})]})}):i.length===0?e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx(ir,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"No Organizations Yet"}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Deploy your first organization to start managing the system"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{style:{background:"var(--color-background-secondary)"},children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Organization"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Industry"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Employees"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Warnings"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Storage"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-medium uppercase tracking-wider",style:{color:"var(--color-text-secondary)"},children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",style:{borderColor:"var(--color-border)"},children:i.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",style:{color:"var(--color-text)"},children:f.name}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:f.id})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-50 text-blue-700 capitalize",children:f.industry||f.sector})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:e.jsx("span",{className:f.employeeCount===0?"text-gray-500":"text-green-600",children:f.employeeCount||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center font-semibold",children:e.jsx("span",{className:f.warningCount===0?"text-green-600":"text-red-600",children:f.warningCount||0})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-1 text-sm",style:{color:"var(--color-text-secondary)"},children:[e.jsx(qa,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:Ln(f.storageUsage||0)})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:e.jsx("button",{onClick:()=>x(f),className:"text-xs px-3 py-1 rounded font-semibold bg-purple-600 text-white hover:bg-purple-700",children:"Categories"})})})]},f.id))})]})})]});case"resellers":return e.jsx(Ys,{});case"audio":return e.jsx(bn,{});case"financial":return e.jsx(J,{padding:"lg",shadow:"md",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Vr,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text)"},children:"Financial Dashboard"}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Revenue tracking and commission management coming soon"})]})});default:return null}}function v(){return e.jsxs(e.Fragment,{children:[c&&e.jsx(Zs,{onClose:()=>o(!1),onComplete:m}),n.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-6xl w-full max-h-[90vh] flex flex-col shadow-2xl my-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b bg-gradient-to-r from-purple-50 to-blue-50 flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Warning Categories"}),e.jsx("p",{className:"text-sm text-gray-600",children:n.organizationName})]}),e.jsx("button",{onClick:()=>h(f=>({...f,isOpen:!1})),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(Xr,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"overflow-y-auto flex-1 p-6",children:e.jsx(Ca,{onClose:()=>h(f=>({...f,isOpen:!1})),organizationId:n.organizationId,organizationName:n.organizationName,inline:!0,allowEdit:!0})})]})})]})}},Mn=T.createContext(null),it={didCatch:!1,error:null};class Ue extends T.Component{constructor(r){super(r),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=it}static getDerivedStateFromError(r){return{didCatch:!0,error:r}}resetErrorBoundary(){const{error:r}=this.state;if(r!==null){for(var s,t,i=arguments.length,d=new Array(i),y=0;y<i;y++)d[y]=arguments[y];(s=(t=this.props).onReset)===null||s===void 0||s.call(t,{args:d,reason:"imperative-api"}),this.setState(it)}}componentDidCatch(r,s){var t,i;(t=(i=this.props).onError)===null||t===void 0||t.call(i,r,s)}componentDidUpdate(r,s){const{didCatch:t}=this.state,{resetKeys:i}=this.props;if(t&&s.error!==null&&Wn(r.resetKeys,i)){var d,y;(d=(y=this.props).onReset)===null||d===void 0||d.call(y,{next:i,prev:r.resetKeys,reason:"keys"}),this.setState(it)}}render(){const{children:r,fallbackRender:s,FallbackComponent:t,fallback:i}=this.props,{didCatch:d,error:y}=this.state;let g=r;if(d){const p={error:y,resetErrorBoundary:this.resetErrorBoundary};if(typeof s=="function")g=s(p);else if(t)g=T.createElement(t,p);else if(i!==void 0)g=i;else throw y}return T.createElement(Mn.Provider,{value:{didCatch:d,error:y,resetErrorBoundary:this.resetErrorBoundary}},g)}}function Wn(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return l.length!==r.length||l.some((s,t)=>!Object.is(s,r[t]))}const Js="hr-system-selected-dashboard-role",ft=T.memo(({selectedRole:l,onRoleChange:r,className:s=""})=>{const{canManageOrganization:t,canManageHR:i}=Yr(),[d,y]=T.useState(!1),g=T.useRef(null),p=[];if(t()&&p.push({id:"business-owner",label:"Business Owner",description:"Executive & Configuration",icon:Gt}),i()&&p.push({id:"hr-manager",label:"HR Manager",description:"HR Operations & Compliance",icon:Zr}),(t()||i())&&p.push({id:"hod-manager",label:"Department Manager",description:"Team Management",icon:pe}),p.length<2)return null;T.useEffect(()=>{const n=h=>{g.current&&!g.current.contains(h.target)&&y(!1)};if(d)return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[d]);const a=T.useCallback(n=>{r(n),localStorage.setItem(Js,n),y(!1)},[r]),c=p.find(n=>n.id===l),o=c?.icon||Gt;return e.jsxs("div",{className:`relative ${s}`,ref:g,children:[e.jsxs("button",{onClick:()=>y(!d),className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-200 hover:scale-105",style:{backgroundColor:"rgba(255,255,255,0.15)",backdropFilter:"blur(4px)",border:"1px solid rgba(255,255,255,0.2)",color:"var(--color-text-inverse)"},children:[e.jsx(o,{className:"w-4 h-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xs opacity-70",children:"View as"}),e.jsx("div",{className:"text-sm font-semibold leading-tight",children:c?.label})]}),e.jsx(bt,{className:`w-4 h-4 transition-transform duration-200 ${d?"rotate-180":""}`})]}),d&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-72 rounded-lg shadow-2xl overflow-hidden",style:{backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-border)",zIndex:9999},children:[e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-semibold uppercase tracking-wider mb-2 px-3 py-1",style:{color:"var(--color-text-secondary)"},children:"Switch Dashboard View"}),p.map(n=>{const h=n.icon,u=n.id===l;return e.jsxs("button",{onClick:()=>a(n.id),className:"w-full flex items-start gap-3 px-3 py-2.5 rounded-lg transition-all duration-200 hover:scale-[1.02]",style:{backgroundColor:u?"var(--color-primary-subtle)":"transparent",borderLeft:u?"3px solid var(--color-primary)":"3px solid transparent"},children:[e.jsx(h,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"var(--color-primary)"}}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--color-text)"},children:[n.label,u&&e.jsx("span",{className:"ml-2 text-xs font-normal",style:{color:"var(--color-success)"},children:"● Active"})]}),e.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:n.description})]})]},n.id)})]}),e.jsx("div",{className:"px-3 py-2 text-xs",style:{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderTop:"1px solid var(--color-border)"},children:"💡 Your selection will be remembered for this session"})]})]})});ft.displayName="DashboardRoleSelector";function zs(l,r,s){const t=localStorage.getItem(Js);return t==="business-owner"&&l||t==="hr-manager"&&r||t==="hod-manager"&&(l||r)?t:l?"business-owner":r?"hr-manager":s()==="hod-manager"?"hod-manager":"business-owner"}const qn=l=>{const[r,s]=T.useState(window.innerWidth>l),t=T.useCallback(()=>{s(window.innerWidth>l)},[l]);return T.useEffect(()=>(t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)),[t]),r},jt=T.memo(({className:l="",selectedRole:r,onRoleChange:s})=>{const t=qn(768),{user:i}=ve();let d=null;try{d=gt()?.organization}catch{d=null}const{getPrimaryRole:y}=Yr(),[g,p]=T.useState(new Date);T.useEffect(()=>{const m=setInterval(()=>p(new Date),1e3);return()=>clearInterval(m)},[]);const a=()=>{switch(y()){case"business-owner":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-primary))"};case"hr-manager":return{background:"linear-gradient(135deg, var(--color-success), var(--color-info))"};case"hod-manager":return{background:"linear-gradient(135deg, var(--color-primary), var(--color-info))"};case"supervisor":return{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning-hover))"};case"super-user":return{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent-hover))"};default:return{background:"linear-gradient(135deg, var(--color-primary), var(--color-secondary))"}}},c=()=>y()?.replace(/-/g," ").toUpperCase()||"USER",o=()=>{const m=g.getHours();return m<12?"Morning":m<17?"Afternoon":"Evening"},n=()=>g.toLocaleTimeString("en-ZA",{hour:"2-digit",minute:"2-digit",hour12:!0}).split(" "),h=(m=!1)=>m?g.toLocaleDateString("en-ZA",{weekday:"long",month:"short",day:"numeric"}):g.toLocaleDateString("en-ZA",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),[u,x]=n();return e.jsx("div",{className:l,children:t?e.jsxs(J,{padding:"md",shadow:"lg",className:"relative",style:{...a(),color:"var(--color-text-inverse)",overflow:"visible"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 rounded-full -translate-y-16 translate-x-16",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("h1",{className:"text-2xl font-bold",children:["Good ",o(),", ",i?.firstName,"! 👋"]})}),e.jsxs("div",{className:"hidden lg:block text-sm opacity-90 pl-4 ml-2",style:{borderLeft:"1px solid rgba(255,255,255,0.2)"},children:[d?.name||"SuperUser Dashboard"," • ",h(!0)]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl px-3 py-2",style:{backgroundColor:"rgba(255,255,255,0.1)",backdropFilter:"blur(4px)"},children:[e.jsx(pt,{className:"w-4 h-4 opacity-80"}),e.jsxs("div",{className:"text-lg font-bold",children:[u," ",x]})]}),r&&s?e.jsx(ft,{selectedRole:r,onRoleChange:s}):e.jsxs(qe,{variant:"primary",size:"md",className:"flex items-center gap-2",style:{backgroundColor:"rgba(255,255,255,0.1)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)"},children:[e.jsx(Ga,{className:"w-4 h-4 opacity-80"}),e.jsx("div",{className:"text-sm font-medium",children:c()})]})]})]})]}):e.jsxs(J,{padding:"none",shadow:"lg",className:"relative",style:{...a(),color:"var(--color-text-inverse)",overflow:"visible"},children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 rounded-full -translate-y-10 translate-x-10",style:{backgroundColor:"rgba(255,255,255,0.05)"}}),e.jsxs("div",{className:"relative z-10 flex justify-between items-center p-3",children:[e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsxs("p",{className:"text-xs leading-none",style:{opacity:.85},children:["Good ",o(),","]}),e.jsxs("h1",{className:"text-lg font-bold leading-tight mt-0.5",children:[i?.firstName,"! 👋"]}),e.jsx(qe,{variant:"primary",size:"sm",className:"inline-block mt-1",style:{backgroundColor:"rgba(255,255,255,0.15)",color:"var(--color-text-inverse)",backdropFilter:"blur(4px)",fontSize:"9px",padding:"2px 5px",lineHeight:"1"},children:e.jsx("span",{className:"font-bold tracking-wider uppercase",children:c()})})]}),e.jsx("div",{className:"text-right flex flex-col items-end justify-center",children:r&&s?e.jsx(ft,{selectedRole:r,onRoleChange:s,className:"mb-1"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-baseline",children:[e.jsx("span",{className:"text-xl font-bold tracking-tight leading-none",children:u}),e.jsx("span",{className:"text-xs font-medium ml-0.5 opacity-90",children:x})]}),e.jsx("p",{className:"text-[10px] mt-0.5 leading-none",style:{opacity:.8},children:h(!0)})]})})]})]})})});jt.displayName="WelcomeSection";const Re=T.memo(({error:l,resetErrorBoundary:r})=>e.jsxs("div",{className:"rounded-lg p-6 m-4",style:{backgroundColor:"var(--color-alert-error-bg)",border:"1px solid var(--color-alert-error-border)"},children:[e.jsx("h3",{className:"font-semibold mb-2",style:{color:"var(--color-alert-error-text)"},children:"Something went wrong"}),e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-alert-error-text)"},children:l.message}),e.jsx("button",{onClick:r,className:"px-4 py-2 rounded-lg transition-colors text-white",style:{backgroundColor:"var(--color-error)",hover:{backgroundColor:"var(--color-error)"}},onMouseEnter:s=>{s.currentTarget.style.opacity="0.9"},onMouseLeave:s=>{s.currentTarget.style.opacity="1"},children:"Try again"})]}));Re.displayName="ErrorFallback";const ea=T.memo(()=>e.jsxs("div",{className:"animate-pulse max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"h-8 rounded w-1/3 mb-2",style:{backgroundColor:"var(--color-muted)"}}),e.jsx("div",{className:"h-4 rounded w-2/3",style:{backgroundColor:"var(--color-subtle)"}})]})),ne=T.memo(()=>e.jsxs("div",{className:"rounded-2xl p-6 animate-pulse",style:{backgroundColor:"var(--color-card-background)",boxShadow:"var(--shadow-lg)",border:"1px solid var(--color-card-border)"},children:[e.jsx("div",{className:"h-6 rounded w-1/3 mb-4",style:{backgroundColor:"var(--color-muted)"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 rounded w-full",style:{backgroundColor:"var(--color-subtle)"}}),e.jsx("div",{className:"h-4 rounded w-3/4",style:{backgroundColor:"var(--color-subtle)"}})]})]}));ea.displayName="WelcomeSkeleton";ne.displayName="SkeletonCard";const ra=T.memo(()=>{const{user:l}=ve(),{organizationData:r}=gt(),{getPrimaryRole:s,canManageOrganization:t,canManageHR:i}=Yr(),[d,y]=T.useState(()=>zs(t(),i(),s));T.useEffect(()=>{const p=zs(t(),i(),s);(d==="business-owner"&&!t()||d==="hr-manager"&&!i()||d==="hod-manager"&&!(t()||i()))&&y(p)},[t,i,s,d]);const g=p=>{y(p)};return l?e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--color-background)"},children:[e.jsx("div",{className:"pb-0",style:{backgroundColor:"var(--color-background)"},children:e.jsx("div",{className:"max-w-7xl mx-auto p-6 pb-4",children:e.jsx(Ue,{FallbackComponent:Re,children:e.jsx(T.Suspense,{fallback:e.jsx(ea,{}),children:e.jsx(jt,{selectedRole:d,onRoleChange:g})})})})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 pt-2",children:[d==="business-owner"&&t()&&e.jsx(Ue,{FallbackComponent:Re,children:e.jsx(T.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(ne,{}),e.jsx(ne,{}),e.jsx(ne,{})]}),children:e.jsx(ja,{})})}),d==="hr-manager"&&i()&&e.jsx(Ue,{FallbackComponent:Re,children:e.jsx(T.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-4 mb-6",children:[e.jsx(ne,{}),e.jsx(ne,{}),e.jsx(ne,{}),e.jsx(ne,{})]}),children:e.jsx(Xa,{})})}),(d==="hod-manager"||s()==="hod-manager")&&e.jsx(Ue,{FallbackComponent:Re,children:e.jsx(T.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 mb-6",children:[e.jsx(ne,{}),e.jsx(ne,{}),e.jsx(ne,{})]}),children:e.jsx(Za,{})})}),e.jsx("div",{className:"mt-6",children:e.jsx(Ue,{FallbackComponent:Re,children:e.jsx(T.Suspense,{fallback:e.jsx("div",{className:"h-20 bg-white rounded-xl shadow-sm animate-pulse border border-gray-100"}),children:e.jsx(Kr,{})})})})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-gray-600",children:"Loading dashboard..."})})})});ra.displayName="BusinessDashboard";const ta=()=>{const{user:l}=ve(),[r,s]=T.useState(null),[t,i]=T.useState(!0),[d,y]=T.useState("6m");T.useEffect(()=>{l?.resellerId&&g()},[l?.resellerId,d]);const g=async()=>{if(l?.resellerId)try{i(!0),D.debug("Loading reseller dashboard data...",{resellerId:l.resellerId});const m=Xe.currentUser;if(m){const w=await m.getIdTokenResult();if(console.log("🔍 [RESELLER DEBUG] User custom claims:",w.claims),console.log("🔍 [RESELLER DEBUG] User role:",w.claims.role),!w.claims.role||typeof w.claims.role=="object"){console.warn("⚠️ Role missing or incorrectly formatted! Calling refreshUserClaims...");try{const{getFunctions:F,httpsCallable:z}=await Qe(async()=>{const{getFunctions:_,httpsCallable:H}=await import("./firebase-vendor-ZA7KOHFb.js").then(I=>I.Y);return{getFunctions:_,httpsCallable:H}},[]),E=F(void 0,"us-central1"),k=await z(E,"refreshUserClaims")({});console.log("✅ Claims refreshed! Please sign out and back in:",k.data),alert("Your user role has been refreshed! Please SIGN OUT and SIGN BACK IN for changes to take effect.");return}catch(F){console.error("❌ Failed to refresh claims:",F)}}}const[b,v,f,j,C]=await Promise.all([X.getReseller(l.resellerId),We.getResellerMetrics(l.resellerId),X.getResellerClients(l.resellerId),We.getRecentCommissions(l.resellerId,5),We.getPerformanceTrend(l.resellerId,d)]);if(!b)throw new Error("Reseller profile not found");s({reseller:b,metrics:v,clients:f,recentCommissions:j,monthlyTrend:C}),D.success("Reseller dashboard loaded successfully")}catch(m){D.error("Failed to load reseller dashboard:",m)}finally{i(!1)}},p=m=>`R${(m/100).toLocaleString("en-ZA",{minimumFractionDigits:2})}`,a=m=>`${m>0?"+":""}${m.toFixed(1)}%`,c=async()=>{if(l?.resellerId)try{D.debug("Generating commission statement..."),await We.generateCommissionStatement(l.resellerId),D.success("Commission statement downloaded")}catch(m){D.error("Failed to generate commission statement:",m)}};if(t)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading your dashboard..."})]})});if(!r)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Va,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Reseller Profile Not Found"}),e.jsx("p",{className:"text-gray-600",children:"Please contact support to set up your reseller account."})]});const{reseller:o,metrics:n,clients:h,recentCommissions:u,monthlyTrend:x}=r;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Welcome back, ",o.firstName,"!"]}),e.jsxs("p",{className:"text-blue-100 flex items-center gap-4 mt-2",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Gr,{className:"w-4 h-4"}),o.province]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Vt,{className:"w-4 h-4"}),(o.commissionRate*100).toFixed(0),"% Commission"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold",children:p(n.monthlyCommissions)}),e.jsx("div",{className:"text-blue-100",children:"This Month's Earnings"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Clients"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:n.totalClients}),e.jsxs("div",{className:"text-sm text-gray-500",children:[n.activeClients," active"]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vr,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Monthly Revenue"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:p(n.monthlyRecurringRevenue)}),e.jsxs("div",{className:"text-sm text-green-600 flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),a(n.monthlyGrowth)]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qa,{className:"w-5 h-5 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total Commissions"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:p(n.totalCommissionsEarned)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Lifetime earnings"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Avg Client Value"})]})}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:p(n.averageClientValue)}),e.jsx("div",{className:"text-sm text-gray-500",children:"Per month"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Performance Trend"}),e.jsxs("select",{value:d,onChange:m=>y(m.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"3m",children:"3 Months"}),e.jsx("option",{value:"6m",children:"6 Months"}),e.jsx("option",{value:"12m",children:"12 Months"})]})]}),e.jsx("div",{className:"space-y-3",children:x.map((m,b)=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:m.month}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Revenue: "}),e.jsx("span",{className:"font-semibold",children:p(m.revenue)})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Commission: "}),e.jsx("span",{className:"font-semibold text-green-600",children:p(m.commissions)})]})]})]},b))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>window.location.href="/deploy-client",className:"w-full flex items-center gap-3 px-4 py-3 bg-orange-50 text-orange-700 rounded-lg hover:bg-orange-100 transition-colors",children:[e.jsx(ut,{className:"w-4 h-4"}),"Deploy Client"]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-3 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx(Ka,{className:"w-4 h-4"}),"Download Statement"]}),e.jsxs("button",{onClick:()=>window.location.href="/my-clients",className:"w-full flex items-center gap-3 px-4 py-3 bg-gray-50 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(Ws,{className:"w-4 h-4"}),"View All Clients"]}),e.jsxs("button",{onClick:()=>window.location.href="/performance",className:"w-full flex items-center gap-3 px-4 py-3 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx(Ye,{className:"w-4 h-4"}),"Detailed Analytics"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Your Clients (",h.length,")"]}),e.jsxs("div",{className:"space-y-3",children:[h.slice(0,5).map(m=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:m.name}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-3",children:[e.jsx("span",{children:m.sector}),e.jsxs("span",{children:[m.employees?.length||0," employees"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-green-600",children:p(m.monthlySubscription||0)}),e.jsx("div",{className:"text-xs text-gray-500",children:"monthly"})]})]},m.id)),h.length>5&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("button",{onClick:()=>window.location.href="/my-clients",className:"text-sm text-blue-600 hover:text-blue-800",children:["View all ",h.length," clients →"]})})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Recent Earnings"}),e.jsxs("div",{className:"space-y-3",children:[u.map(m=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:m.clientName}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx(Us,{className:"w-3 h-3"}),new Date(m.periodStart).toLocaleDateString("en-ZA")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-green-600",children:p(m.commissionAmount)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(m.commissionRate*100).toFixed(0),"% of ",p(m.baseAmount)]})]})]},m.id)),u.length===0&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx(pt,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No recent commissions"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Earnings will appear here as clients are billed"})]})]})]})]})]})},xo=Object.freeze(Object.defineProperty({__proto__:null,ResellerDashboard:ta},Symbol.toStringTag,{value:"Module"})),ht={"super-user":{id:"super-user",name:"Super User",description:"System administrator with global access",level:1},reseller:{id:"reseller",name:"Reseller",description:"Provincial sales partner with client management",level:1.5},"business-owner":{id:"business-owner",name:"Business Owner",description:"CEO/Director with organization overview",level:2},"hr-manager":{id:"hr-manager",name:"HR Manager",description:"Human Resources with employee management",level:3},"hod-manager":{id:"hod-manager",name:"HOD/Manager",description:"Department head with warning creation",level:4}},Ve={"super-user":{canManage:["super-user","reseller","business-owner","hr-manager","hod-manager"],canCreate:["reseller","business-owner","hr-manager","hod-manager"],canDelete:["reseller","business-owner","hr-manager","hod-manager"],scope:"global"},reseller:{canManage:[],canCreate:!1,canDelete:!1,canUpdate:!1,scope:"assigned-clients",restrictions:["Cannot create or manage user accounts","Cannot access employee data or warnings","Can only view and update assigned client organizations","Limited to commission and billing information"]},"business-owner":{canManage:["hr-manager","hod-manager"],canCreate:["hr-manager","hod-manager"],canDelete:!1,canDeactivate:["hr-manager","hod-manager"],scope:"organization",restrictions:["Cannot create users for other organizations","Cannot modify super-user accounts","Cannot modify other business-owner accounts","Can only deactivate, not permanently delete users"]},"hr-manager":{canManage:["hod-manager"],canCreate:["hod-manager"],canUpdate:["hr-manager","hod-manager"],canDelete:!1,scope:"organization",restrictions:["Cannot modify business-owner accounts","Cannot change user roles","Cannot create HR manager accounts","Profile updates only (name, email, departments)"]}},Ts=(l,r,s,t,i)=>{const d=Ve[l];if(!d||d.scope==="organization"&&(!r||r!==t))return!1;switch(i){case"create":return d.canCreate?.includes(s)||!1;case"read":return d.canManage?.includes(s)||!1;case"update":return d.canManage?.includes(s)||!1;case"delete":return d.canDelete===!0&&d.canManage?.includes(s)||!1;case"deactivate":return d.canDeactivate?.includes(s)||!1;default:return!1}},Gn=l=>{const r=Ve[l];return r?.canCreate?r.canCreate.map(s=>ht[s]).filter(Boolean):[]},sa={"business-owner":{capabilities:["✅ Create HR Manager accounts","✅ Create Department Manager accounts","✅ Update user profiles and departments","✅ Deactivate user accounts","✅ Reset user passwords","✅ View user activity logs","❌ Cannot manage other Business Owners","❌ Cannot permanently delete users","❌ Cannot access Super User accounts"],actions:["create","read","update","deactivate"],manageable_roles:["hr-manager","hod-manager"]},"hr-manager":{capabilities:["✅ Update user profiles (name, email)","✅ Update department assignments","✅ View user activity","✅ Create Department Manager accounts","❌ Cannot change user roles","❌ Cannot create HR Manager accounts","❌ Cannot deactivate users"],actions:["read","update"],manageable_roles:["hod-manager"]}},Vn=[{id:"executive",name:"Executive"},{id:"human-resources",name:"Human Resources"},{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"logistics",name:"Logistics"},{id:"finance",name:"Finance"}],Qn=()=>{const{user:l}=ve(),[r,s]=T.useState({users:[],loading:!0,error:null,creatableRoles:[],userManagementRules:Ve["business-owner"]});T.useEffect(()=>{if(l?.role?.id){const o=Ve[l.role.id],n=Gn(l.role.id);s(h=>({...h,userManagementRules:o||Ve["business-owner"],creatableRoles:n}))}},[l]);const t=o=>{switch(o){case"business-owner":return"#dc2626";case"hr-manager":return"#059669";case"hod-manager":return"#7c3aed";default:return"#64748b"}},i=o=>{if(!o)return"Never";const n=new Date(o);return n.toLocaleDateString()+" "+n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},d=(o,n)=>!l||!r.userManagementRules?!1:Ts(l.role.id,l.organizationId,o.role.id,o.organizationId,n),y=async()=>{if(!l?.organizationId){s(o=>({...o,loading:!1,error:"No organization found"}));return}try{s(u=>({...u,loading:!0,error:null})),D.debug("🔍 Loading users for organization:",l.organizationId);const o=await xe.queryDocuments(l.organizationId,"users",[]),n=u=>typeof u=="string"?u:u?.id||"",h=o.documents.filter(u=>{const x=n(u.role);return x!=="business-owner"&&Ts(l.role.id,l.organizationId,x,u.organizationId,"read")}).map(u=>({...u,role:typeof u.role=="string"?ht[u.role]:u.role}));D.success(`✅ Loaded ${h.length} manageable users from sharded structure`),s(u=>({...u,users:h,loading:!1}))}catch(o){D.error("❌ Error loading users:",o),s(n=>({...n,loading:!1,error:o instanceof Error?o.message:"Failed to load users"}))}},g=async o=>{if(!l?.organizationId)throw new Error("No organization found");if(!(r.userManagementRules.canCreate?.includes(o.roleId)||!1))throw new Error(`You don't have permission to create ${o.roleId} accounts`);try{D.debug("🚀 Creating new user:",o.email);const h=await zt.signUp(o.email,o.password);D.success(5389);const u={id:h.uid,email:o.email,firstName:o.firstName,lastName:o.lastName,role:ht[o.roleId],organizationId:l.organizationId,departmentIds:o.roleId==="hod-manager"?o.departmentIds:[],isActive:!0,createdAt:new Date().toISOString(),lastLogin:void 0};await zt.createDocument(wa.USERS,u,h.uid),D.success(6159),s(x=>({...x,users:[...x.users,u]}))}catch(h){if(D.error("❌ Error creating user:",h),h instanceof Error){if(h.message.includes("email-already-in-use"))throw new Error("This email address is already registered");if(h.message.includes("weak-password"))throw new Error("Password is too weak. Please choose a stronger password");if(h.message.includes("invalid-email"))throw new Error("Please enter a valid email address")}throw h}},p=async(o,n)=>{if(!l?.organizationId)throw new Error("No organization found");try{D.debug("📝 Updating user:",o),await xe.updateDocument(l.organizationId,"users",o,{...n,updatedAt:new Date().toISOString(),updatedBy:l?.id}),s(h=>({...h,users:h.users.map(u=>u.id===o?{...u,...n}:u)})),D.success(7586)}catch(h){throw D.error("❌ Error updating user:",h),h}},a=async o=>{const n=r.users.find(h=>h.id===o);if(!n)throw new Error("User not found");if(!d(n,"deactivate"))throw new Error("You don't have permission to deactivate this user");try{D.debug("🚫 Deactivating user:",o),await xe.updateDocument(l.organizationId,"users",o,{isActive:!1,deactivatedAt:new Date().toISOString(),deactivatedBy:l?.id}),s(h=>({...h,users:h.users.map(u=>u.id===o?{...u,isActive:!1}:u)})),D.success(8612)}catch(h){throw D.error("❌ Error deactivating user:",h),h}},c=async o=>{try{D.debug("✅ Reactivating user:",o),await xe.updateDocument(l.organizationId,"users",o,{isActive:!0,reactivatedAt:new Date().toISOString(),reactivatedBy:l?.id}),s(n=>({...n,users:n.users.map(h=>h.id===o?{...h,isActive:!0}:h)})),D.success(9358)}catch(n){throw D.error("❌ Error reactivating user:",n),n}};return T.useEffect(()=>{l?.organizationId&&r.userManagementRules&&y()},[l?.organizationId,r.userManagementRules]),{users:r.users,loading:r.loading,error:r.error,creatableRoles:r.creatableRoles,userManagementRules:r.userManagementRules,loadUsers:y,createUser:g,updateUser:p,deactivateUser:a,reactivateUser:c,canManageUser:d,getRoleColor:t,formatLastLogin:i,departments:Vn}},Kn=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],Yn=({onSubmit:l,onCancel:r,creatableRoles:s,loading:t})=>{const[i,d]=T.useState({email:"",firstName:"",lastName:"",roleId:"",departmentIds:[],password:"",confirmPassword:""}),[y,g]=T.useState({}),p=()=>{const o={};i.firstName.trim()||(o.firstName="First name is required"),i.lastName.trim()||(o.lastName="Last name is required"),i.email.trim()||(o.email="Email is required"),i.roleId||(o.roleId="Role is required"),i.password||(o.password="Password is required"),i.confirmPassword||(o.confirmPassword="Please confirm password");const n=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return i.email&&!n.test(i.email)&&(o.email="Please enter a valid email address"),i.password&&i.password.length<6&&(o.password="Password must be at least 6 characters"),i.password!==i.confirmPassword&&(o.confirmPassword="Passwords do not match"),i.roleId==="hod-manager"&&i.departmentIds.length===0&&(o.departmentIds="Please select at least one department for managers"),g(o),Object.keys(o).length===0},a=async o=>{if(o.preventDefault(),!!p())try{await l(i)}catch{}},c=o=>{d(n=>({...n,departmentIds:n.departmentIds.includes(o)?n.departmentIds.filter(h=>h!==o):[...n.departmentIds,o]}))};return e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"hr-card",style:{width:"100%",maxWidth:"500px",maxHeight:"90vh",overflow:"auto",margin:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid #e5e7eb"},children:[e.jsxs("h2",{style:{margin:0,color:"#1f2937",fontSize:"1.25rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(qs,{size:20}),"Create New User Account"]}),e.jsx("button",{onClick:r,style:{padding:"0.5rem",backgroundColor:"transparent",border:"none",borderRadius:"4px",cursor:"pointer",color:"#6b7280"},onMouseOver:o=>o.currentTarget.style.backgroundColor="#f3f4f6",onMouseOut:o=>o.currentTarget.style.backgroundColor="transparent",children:e.jsx(Xr,{size:20})})]}),e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Personal Information"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"First Name *"}),e.jsx("input",{type:"text",value:i.firstName,onChange:o=>d(n=>({...n,firstName:o.target.value})),style:{width:"100%",padding:"0.75rem",border:y.firstName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:o=>o.target.style.borderColor="#3b82f6",onBlur:o=>o.target.style.borderColor=y.firstName?"#ef4444":"#d1d5db"}),y.firstName&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.firstName})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:"Last Name *"}),e.jsx("input",{type:"text",value:i.lastName,onChange:o=>d(n=>({...n,lastName:o.target.value})),style:{width:"100%",padding:"0.75rem",border:y.lastName?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:o=>o.target.style.borderColor="#3b82f6",onBlur:o=>o.target.style.borderColor=y.lastName?"#ef4444":"#d1d5db"}),y.lastName&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.lastName})]})]}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Hs,{size:16}),"Email Address *"]}),e.jsx("input",{type:"email",value:i.email,onChange:o=>d(n=>({...n,email:o.target.value})),style:{width:"100%",padding:"0.75rem",border:y.email?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:o=>o.target.style.borderColor="#3b82f6",onBlur:o=>o.target.style.borderColor=y.email?"#ef4444":"#d1d5db"}),y.email&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.email})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Role & Permissions"}),e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Zr,{size:16}),"User Role *"]}),e.jsxs("select",{value:i.roleId,onChange:o=>d(n=>({...n,roleId:o.target.value})),style:{width:"100%",padding:"0.75rem",border:y.roleId?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none",backgroundColor:"white"},onFocus:o=>o.target.style.borderColor="#3b82f6",onBlur:o=>o.target.style.borderColor=y.roleId?"#ef4444":"#d1d5db",children:[e.jsx("option",{value:"",children:"Select Role"}),s.map(o=>e.jsxs("option",{value:o.id,children:[o.name," - ",o.description]},o.id))]}),y.roleId&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.roleId})]}),i.roleId==="hod-manager"&&e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(pe,{size:16}),"Departments (for HOD/Manager role) *"]}),e.jsx("div",{style:{border:y.departmentIds?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",padding:"0.75rem",backgroundColor:"#f9fafb",display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.5rem"},children:Kn.map(o=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",fontSize:"0.875rem"},children:[e.jsx("input",{type:"checkbox",checked:i.departmentIds.includes(o.id),onChange:()=>c(o.id),style:{margin:0}}),o.name]},o.id))}),y.departmentIds&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.departmentIds})]})]}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("h3",{style:{margin:"0 0 1rem",color:"#374151",fontSize:"1rem",fontWeight:"500"},children:"Account Security"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Qt,{size:16}),"Password *"]}),e.jsx("input",{type:"password",value:i.password,onChange:o=>d(n=>({...n,password:o.target.value})),style:{width:"100%",padding:"0.75rem",border:y.password?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:o=>o.target.style.borderColor="#3b82f6",onBlur:o=>o.target.style.borderColor=y.password?"#ef4444":"#d1d5db",minLength:6}),y.password&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.password})]}),e.jsxs("div",{children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500",color:"#374151"},children:[e.jsx(Qt,{size:16}),"Confirm Password *"]}),e.jsx("input",{type:"password",value:i.confirmPassword,onChange:o=>d(n=>({...n,confirmPassword:o.target.value})),style:{width:"100%",padding:"0.75rem",border:y.confirmPassword?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"6px",fontSize:"0.875rem",outline:"none"},onFocus:o=>o.target.style.borderColor="#3b82f6",onBlur:o=>o.target.style.borderColor=y.confirmPassword?"#ef4444":"#d1d5db",minLength:6}),y.confirmPassword&&e.jsx("p",{style:{margin:"0.25rem 0 0",fontSize:"0.75rem",color:"#ef4444"},children:y.confirmPassword})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",paddingTop:"1rem",borderTop:"1px solid #e5e7eb"},children:[e.jsx("button",{type:"button",onClick:r,className:"hr-button-secondary",disabled:t,children:"Cancel"}),e.jsx("button",{type:"submit",className:"hr-button-primary",disabled:t,style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"16px",height:"16px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),"Creating..."]}):e.jsx(e.Fragment,{children:"✅ Create User"})})]})]})]})})},Xn=[{id:"operations",name:"Operations"},{id:"production",name:"Production"},{id:"quality-control",name:"Quality Control"},{id:"maintenance",name:"Maintenance"},{id:"safety",name:"Safety"},{id:"administration",name:"Administration"}],Zn=({users:l,loading:r,onDeactivateUser:s,onReactivateUser:t,onEditUser:i,canManageUser:d,getRoleColor:y,formatLastLogin:g})=>{const[p,a]=T.useState(null),c=async x=>{const m=l.find(v=>v.id===x);if(!(!m||!confirm(`Are you sure you want to deactivate ${m.firstName} ${m.lastName}?

They will no longer be able to log in to the system.`)))try{a(x),await s(x)}catch(v){D.error("Error deactivating user:",v)}finally{a(null)}},o=async x=>{const m=l.find(v=>v.id===x);if(!(!m||!confirm(`Are you sure you want to reactivate ${m.firstName} ${m.lastName}?

They will be able to log in again.`)))try{a(x),await t(x)}catch(v){D.error("Error reactivating user:",v)}finally{a(null)}},n=x=>{if(!x)return"Unknown";try{return new Date(x).toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},h=x=>e.jsx("span",{className:"hr-badge",style:{backgroundColor:y(x.role.id)+"20",color:y(x.role.id),border:`1px solid ${y(x.role.id)}`,fontWeight:"600"},children:x.role.name}),u=x=>!x||x.length===0?"-":x.map(m=>Xn.find(b=>b.id===m)?.name||m).join(", ");return r?e.jsxs("div",{className:"hr-card",style:{padding:"3rem",textAlign:"center"},children:[e.jsx("h2",{style:{color:"#1e40af"},children:"👤 Loading Users..."}),e.jsx("p",{style:{color:"#64748b"},children:"Please wait while we load the user data."})]}):l.length===0?e.jsx("div",{className:"hr-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b"},children:[e.jsx(qs,{size:48,style:{color:"#d1d5db",margin:"0 auto 1rem"}}),e.jsx("h3",{style:{color:"#6b7280",marginBottom:"0.5rem"},children:"No manageable users found."}),e.jsx("p",{style:{color:"#9ca3af",margin:0},children:"Create your first HR Manager or Department Head!"})]})}):e.jsxs("div",{className:"hr-card",children:[e.jsxs("h3",{style:{margin:"0 0 1rem",color:"#1e40af",fontSize:"1.125rem",fontWeight:"600"},children:["👥 Organization Users (",l.length,")"]}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"2px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"User"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Role"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Departments"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Status"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Created"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600",color:"#374151"},children:"Actions"})]})}),e.jsx("tbody",{children:l.map(x=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb",opacity:x.isActive?1:.7,backgroundColor:x.isActive?"transparent":"#f9fafb"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"600",color:x.isActive?"#1f2937":"#6b7280",marginBottom:"0.25rem"},children:[x.firstName," ",x.lastName]}),e.jsx("div",{style:{fontSize:"0.875rem",color:x.isActive?"#64748b":"#9ca3af"},children:x.email})]})}),e.jsx("td",{style:{padding:"0.75rem"},children:h(x)}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{fontSize:"0.875rem",color:x.isActive?"#374151":"#6b7280"},children:u(x.departmentIds)})}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{className:`hr-badge ${x.isActive?"hr-badge-success":"hr-badge-danger"}`,children:x.isActive?"✅ Active":"❌ Inactive"})}),e.jsx("td",{style:{padding:"0.75rem",fontSize:"0.875rem",color:"#6b7280"},children:n(x.createdAt)}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[d(x,"update")&&e.jsxs("button",{onClick:()=>i(x),style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",backgroundColor:"#dbeafe",color:"#1e40af",border:"1px solid #bfdbfe",borderRadius:"4px",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Edit user details",children:[e.jsx(Ls,{size:12}),"Edit"]}),d(x,"deactivate")&&e.jsx(e.Fragment,{children:x.isActive?e.jsxs("button",{onClick:()=>c(x.id),disabled:p===x.id,className:"hr-button-danger",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:p===x.id?.6:1,cursor:p===x.id?"not-allowed":"pointer"},title:"Deactivate user account",children:[p===x.id?e.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):e.jsx(Gs,{size:12}),"🚫 Deactivate"]}):e.jsxs("button",{onClick:()=>o(x.id),disabled:p===x.id,className:"hr-button-success",style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",display:"flex",alignItems:"center",gap:"0.25rem",opacity:p===x.id?.6:1,cursor:p===x.id?"not-allowed":"pointer"},title:"Reactivate user account",children:[p===x.id?e.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid rgba(255,255,255,0.3)",borderTop:"2px solid #059669",borderRadius:"50%",animation:"spin 1s linear infinite"}}):e.jsx(Ya,{size:12}),"✅ Reactivate"]})})]})})]},x.id))})]})})]})},Jn=({currentUser:l,userManagementRules:r})=>{const s=sa[l.role.id];return s?e.jsxs("div",{className:"hr-card",children:[e.jsxs("h4",{style:{margin:"0 0 1rem",color:"#7c3aed",fontSize:"1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:["🛡️ Your User Management Permissions (",l.role.name,")"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#059669",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Qr,{size:16}),"✅ You Can:"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:s.capabilities.filter(t=>t.startsWith("✅")).map((t,i)=>e.jsx("li",{style:{color:"#166534",marginBottom:"0.25rem"},children:t.replace("✅ ","")},i))})]}),e.jsxs("div",{children:[e.jsxs("h5",{style:{margin:"0 0 0.75rem",color:"#dc2626",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Gs,{size:16}),"❌ You Cannot:"]}),e.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:s.capabilities.filter(t=>t.startsWith("❌")).map((t,i)=>e.jsx("li",{style:{color:"#991b1b",marginBottom:"0.25rem"},children:t.replace("❌ ","")},i))}),r.restrictions&&e.jsxs(e.Fragment,{children:[e.jsx("h6",{style:{margin:"1rem 0 0.5rem",color:"#6b7280",fontSize:"0.75rem",fontWeight:"600",textTransform:"uppercase"},children:"System Restrictions:"}),e.jsx("ul",{style:{margin:0,paddingLeft:"1rem",fontSize:"0.875rem",lineHeight:"1.6"},children:r.restrictions.map((t,i)=>e.jsx("li",{style:{color:"#6b7280",marginBottom:"0.25rem"},children:t},i))})]})]})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"0.75rem",backgroundColor:"#f0f9ff",borderRadius:"6px",border:"1px solid #bfdbfe"},children:e.jsxs("p",{style:{margin:0,fontSize:"0.875rem",color:"#1e40af"},children:[e.jsx("strong",{children:"Scope:"})," ",r.scope==="organization"?"Organization-wide":"Global"," •",e.jsx("strong",{children:" Manageable Roles:"})," ",r.canManage?.join(", ")||"None"]})})]}):null},aa=()=>{const l=Ba(),{user:r,organization:s}=ve(),{users:t,loading:i,error:d,creatableRoles:y,userManagementRules:g,createUser:p,deactivateUser:a,reactivateUser:c,canManageUser:o,getRoleColor:n,formatLastLogin:h}=Qn(),[u,x]=T.useState(!1),[m,b]=T.useState(!1),[v,f]=T.useState(null),[j,C]=T.useState(null),w=sa[r?.role?.id];Is.useEffect(()=>{if(v){const B=setTimeout(()=>f(null),5e3);return()=>clearTimeout(B)}},[v]);const A=async B=>{b(!0);try{await p(B),f({type:"success",text:`User ${B.firstName} ${B.lastName} created successfully!`}),x(!1)}catch(k){throw f({type:"error",text:k instanceof Error?k.message:"Failed to create user"}),k}finally{b(!1)}},F=async B=>{try{const k=t.find(_=>_.id===B);await a(B),f({type:"success",text:`User ${k?.firstName} ${k?.lastName} deactivated successfully`})}catch(k){f({type:"error",text:k instanceof Error?k.message:"Failed to deactivate user"})}},z=async B=>{try{const k=t.find(_=>_.id===B);await c(B),f({type:"success",text:`User ${k?.firstName} ${k?.lastName} reactivated successfully`})}catch(k){f({type:"error",text:k instanceof Error?k.message:"Failed to reactivate user"})}},E=B=>{C(B),f({type:"info",text:"Edit functionality coming soon!"})};return r?w?e.jsxs("div",{children:[e.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>l("/dashboard"),className:"hr-button-outline",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},title:"Back to Dashboard",children:[e.jsx(Ms,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{children:[e.jsx("h2",{style:{margin:"0 0 0.5rem",color:"#1e40af",fontSize:"1.5rem",fontWeight:"600"},children:"👤 User Management"}),e.jsxs("p",{style:{margin:"0 0 1rem",color:"#64748b"},children:["Manage HR Managers and Department Heads for ",s?.name]}),e.jsxs("div",{style:{display:"flex",gap:"2rem",fontSize:"0.875rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#10b981"}}),e.jsxs("span",{style:{color:"#6b7280"},children:["Active Users: ",t.filter(B=>B.isActive).length]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#ef4444"}}),e.jsxs("span",{style:{color:"#6b7280"},children:["Inactive Users: ",t.filter(B=>!B.isActive).length]})]})]})]})]}),y.length>0&&e.jsx("button",{onClick:()=>x(!0),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:"➕ Create New User"})]})}),v&&e.jsx("div",{className:"hr-card",style:{marginBottom:"1.5rem",border:`2px solid ${v.type==="success"?"#059669":v.type==="error"?"#dc2626":"#3b82f6"}`,background:v.type==="success"?"#f0fdf4":v.type==="error"?"#fef2f2":"#eff6ff"},children:e.jsxs("div",{style:{color:v.type==="success"?"#059669":v.type==="error"?"#dc2626":"#1d4ed8",fontWeight:"600",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{children:[v.type==="success"?"✅":v.type==="error"?"❌":"ℹ️"," ",v.text]}),e.jsx("button",{onClick:()=>f(null),style:{background:"none",border:"none",fontSize:"1.2rem",cursor:"pointer",color:"inherit"},children:"×"})]})}),d&&e.jsxs("div",{className:"hr-card",style:{marginBottom:"1.5rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#ef4444"},children:[e.jsx(Ce,{size:20}),e.jsx("span",{style:{fontWeight:"500"},children:"Error loading users"})]}),e.jsx("p",{style:{margin:"0.5rem 0 0",color:"#6b7280",fontSize:"0.875rem"},children:d})]}),e.jsx(Jn,{currentUser:r,userManagementRules:g}),e.jsx("div",{style:{marginTop:"1.5rem"},children:e.jsx(Zn,{users:t,loading:i,onDeactivateUser:F,onReactivateUser:z,onEditUser:E,canManageUser:o,getRoleColor:n,formatLastLogin:h})}),u&&e.jsx(Yn,{onSubmit:A,onCancel:()=>x(!1),creatableRoles:y,loading:m}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f0f9ff",borderRadius:"6px",fontSize:"0.875rem",color:"#0369a1"},children:[e.jsx("strong",{children:"Development Status:"})," Enhanced User Management v2.0 - Organization: ",s?.name," • Current User: ",r.role.name," • Manageable Roles: ",g.canManage?.join(", ")||"None"," • Users Loaded: ",t.length]})]}):e.jsx("div",{className:"hr-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[e.jsx(Zr,{size:48,style:{color:"#f59e0b",margin:"0 auto 1rem"}}),e.jsx("h2",{style:{color:"#f59e0b",marginBottom:"0.5rem"},children:"Access Restricted"}),e.jsxs("p",{style:{color:"#6b7280",margin:0},children:["Your role (",r.role.name,") does not have user management permissions."]})]})}):e.jsx("div",{className:"hr-card",children:e.jsxs("div",{style:{textAlign:"center",padding:"3rem"},children:[e.jsx(Ce,{size:48,style:{color:"#ef4444",margin:"0 auto 1rem"}}),e.jsx("h2",{style:{color:"#ef4444",marginBottom:"0.5rem"},children:"Authentication Required"}),e.jsx("p",{style:{color:"#6b7280",margin:0},children:"Please log in to access user management."})]})})},uo=Object.freeze(Object.defineProperty({__proto__:null,UserManagement:aa},Symbol.toStringTag,{value:"Module"})),mo=()=>{const{user:l}=ve(),{getPrimaryRole:r}=Yr(),[s,t]=T.useState("dashboard"),i=()=>{t("dashboard")};if(!l)return e.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[e.jsx("h2",{style:{color:"#ef4444"},children:"Authentication Required"}),e.jsx("p",{style:{color:"#64748b"},children:"Please log in to access the dashboard."})]});const d=r(),y=()=>e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx("button",{onClick:i,className:"hr-button-secondary",style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",fontSize:"0.875rem"},children:"← Back to Dashboard"})});if(s==="user-management")return e.jsxs("div",{children:[e.jsx(y,{}),e.jsx(aa,{})]});switch(d){case"super-user":return e.jsxs("div",{children:[e.jsx("div",{className:"p-6 max-w-7xl mx-auto pb-0",children:e.jsx(jt,{})}),e.jsx("div",{className:"max-w-7xl mx-auto p-6 pt-2",children:e.jsx(Un,{})})]});case"reseller":return e.jsx(ta,{});case"business-owner":case"hr-manager":case"hod-manager":return e.jsx(ra,{});default:return e.jsxs("div",{className:"hr-card",style:{textAlign:"center",padding:"3rem"},children:[e.jsxs("h2",{style:{color:"#f59e0b",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(vt,{style:{width:"1.5rem",height:"1.5rem"}}),"Role Configuration Needed"]}),e.jsxs("p",{style:{color:"#64748b",margin:"1rem 0"},children:['Your user role "',l.role.name,'" needs dashboard configuration. Please contact your system administrator.']}),e.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",backgroundColor:"#f9fafb",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsx("div",{style:{fontSize:"0.875rem",color:"#374151",marginBottom:"0.5rem"},children:e.jsx("strong",{children:"Debug Information:"})}),e.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280",fontFamily:"monospace"},children:["Role ID: ",l.role.id,e.jsx("br",{}),"Role Name: ",l.role.name,e.jsx("br",{}),"User ID: ",l.id,e.jsx("br",{}),"Organization: ",l.organizationId||"None"]})]}),e.jsx("div",{style:{marginTop:"1.5rem"},children:e.jsxs("button",{onClick:()=>t("dashboard"),className:"hr-button-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:"0 auto"},children:[e.jsx(Ws,{style:{width:"1rem",height:"1rem"}}),"Try Dashboard Anyway"]})})]})}};export{We as C,mo as D,co as E,lo as R,io as T,uo as U,xo as a};
