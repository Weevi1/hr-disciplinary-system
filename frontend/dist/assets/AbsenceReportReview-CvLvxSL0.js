import{u as X,j as e,L as g,F as E}from"./dashboard-components-fvKPXzEF.js";import{u as Y,r as t}from"./react-vendor-DrdoFN08.js";import{as as T,R as G,X as F,c as J,F as L,h as K,D as P,T as Q,o as V,a5 as Z,q as ee,ap as se}from"./ui-vendor-X12rCvv3.js";import"./firebase-vendor-Cz3N8Xg7.js";import"./pdf-vendor-Bp5yZ91a.js";import"./warning-components-DfE_qdbY.js";const z={ABSENCE_REPORTS:"absence_reports"},v=[{id:"full-day",label:"Full Day Absence",icon:"🏠",payrollImpact:!0,color:"red"},{id:"half-day",label:"Half Day Absence",icon:"⏰",payrollImpact:!0,color:"orange"},{id:"late-arrival",label:"Late Arrival",icon:"🕐",payrollImpact:!1,color:"yellow"},{id:"early-departure",label:"Early Departure",icon:"🚪",payrollImpact:!1,color:"yellow"},{id:"sick-leave",label:"Sick Leave",icon:"🤒",payrollImpact:!0,color:"red"},{id:"personal-leave",label:"Personal Leave",icon:"👤",payrollImpact:!0,color:"purple"}],ce=()=>{const A=Y(),{user:o}=X(),[i,f]=t.useState([]),[N,w]=t.useState([]),[O,R]=t.useState(!0),[C,h]=t.useState(null),[l,I]=t.useState(null),[M,d]=t.useState(!1),[p,H]=t.useState(""),[b,U]=t.useState("all"),[c,B]=t.useState("all"),[u,ae]=t.useState("all"),[n,y]=t.useState({hrReviewed:!1,hrNotes:"",payrollProcessed:!1}),[S,k]=t.useState(!1);t.useEffect(()=>{(async()=>{if(!o?.organizationId){R(!1);return}try{R(!0),h(null),g.debug("📋 Loading absence reports for organization:",o.organizationId);const a=await E.queryDocuments(z.ABSENCE_REPORTS,[{field:"organizationId",operator:"==",value:o.organizationId}],"absenceDate",100);g.success(4088),f(a.reverse()),w(a.reverse())}catch(a){g.error("❌ Error loading absence reports:",a),h("Failed to load absence reports. Please try again."),f([]),w([])}finally{R(!1)}})()},[o?.organizationId]),t.useEffect(()=>{let s=i;if(p){const a=p.toLowerCase();s=s.filter(r=>r.employeeName.toLowerCase().includes(a)||r.managerName.toLowerCase().includes(a)||r.reason&&r.reason.toLowerCase().includes(a)||r.employeeNumber&&r.employeeNumber.toLowerCase().includes(a))}b!=="all"&&(s=s.filter(a=>a.absenceType===b)),c!=="all"&&(c==="reviewed"?s=s.filter(a=>a.hrReviewed):c==="pending"&&(s=s.filter(a=>!a.hrReviewed))),u!=="all"&&(u==="impact"?s=s.filter(a=>a.payrollImpact):u==="no-impact"&&(s=s.filter(a=>!a.payrollImpact))),w(s)},[i,p,b,c,u]);const _=s=>{I(s),y({hrReviewed:s.hrReviewed,hrNotes:s.hrNotes||"",payrollProcessed:s.payrollProcessed||!1}),d(!0)},$=async()=>{if(!(!l||!o))try{k(!0),h(null);const s={hrReviewed:n.hrReviewed,hrNotes:n.hrNotes.trim()||void 0,payrollProcessed:n.payrollProcessed,hrReviewedBy:n.hrReviewed?o.id:void 0,hrReviewedAt:n.hrReviewed?new Date().toISOString():void 0,payrollProcessedAt:n.payrollProcessed?new Date().toISOString():void 0,updatedAt:new Date().toISOString()};await E.updateDocument(z.ABSENCE_REPORTS,l.id,s),f(a=>a.map(r=>r.id===l.id?{...r,...s}:r)),d(!1),I(null),g.success(7561)}catch(s){g.error("❌ Error updating absence report:",s),h("Failed to update absence report. Please try again.")}finally{k(!1)}},q=s=>{const a=v.find(x=>x.id===s);if(!a)return{bg:"bg-gray-100",text:"text-gray-800",border:"border-gray-200"};const r={red:{bg:"bg-red-100",text:"text-red-800",border:"border-red-200"},orange:{bg:"bg-orange-100",text:"text-orange-800",border:"border-orange-200"},yellow:{bg:"bg-yellow-100",text:"text-yellow-800",border:"border-yellow-200"},purple:{bg:"bg-purple-100",text:"text-purple-800",border:"border-purple-200"}};return r[a.color]||r.yellow},j=(()=>{const s=i.length,a=i.filter(m=>!m.hrReviewed).length,r=i.filter(m=>m.payrollImpact).length,x=i.filter(m=>{const W=new Date(m.absenceDate),D=new Date;return D.setDate(D.getDate()-7),W>=D}).length;return{total:s,unreviewed:a,payrollImpact:r,thisWeek:x}})();return O?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Absence Reports..."}),e.jsx("p",{className:"text-gray-600",children:"Preparing HR review interface..."})]})}):o?.organizationId?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-700 rounded-2xl p-6 text-white shadow-xl mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(T,{className:"w-8 h-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Absence Report Review"}),e.jsx("p",{className:"text-orange-100",children:"Review and process employee absences"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",title:"Refresh",children:e.jsx(G,{className:"w-6 h-6"})}),e.jsx("button",{onClick:()=>A("/dashboard"),className:"p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors",children:e.jsx(F,{className:"w-6 h-6"})})]})]})}),C&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"text-red-800 font-medium",children:"Error"})]}),e.jsx("p",{className:"text-red-700 text-sm mt-1",children:C})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Reports"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:j.total})]}),e.jsx(L,{className:"w-8 h-8 text-orange-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending Review"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:j.unreviewed})]}),e.jsx(K,{className:"w-8 h-8 text-red-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Payroll Impact"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:j.payrollImpact})]}),e.jsx(P,{className:"w-8 h-8 text-purple-500"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-4 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"This Week"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:j.thisWeek})]}),e.jsx(Q,{className:"w-8 h-8 text-blue-500"})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by employee, manager, or reason...",value:p,onChange:s=>H(s.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"})]})}),e.jsx("div",{children:e.jsxs("select",{value:b,onChange:s=>U(s.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"all",children:"All Types"}),v.map(s=>e.jsxs("option",{value:s.id,children:[s.icon," ",s.label]},s.id))]})}),e.jsx("div",{children:e.jsxs("select",{value:c,onChange:s=>B(s.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"⏳ Pending Review"}),e.jsx("option",{value:"reviewed",children:"✅ Reviewed"})]})})]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-orange-600"}),"Absence Reports (",N.length,")"]})}),N.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(T,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:i.length===0?"No Absence Reports":"No Matching Reports"}),e.jsx("p",{className:"text-gray-600",children:i.length===0?"No managers have submitted absence reports yet.":"Try adjusting your search or filter criteria."})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:N.map(s=>{const a=v.find(x=>x.id===s.absenceType),r=q(s.absenceType);return e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s.employeeName}),s.employeeNumber&&e.jsxs("span",{className:"text-sm text-gray-500",children:["#",s.employeeNumber]})]}),e.jsxs("div",{className:`px-3 py-1 rounded-full text-sm font-medium border ${r.bg} ${r.text} ${r.border}`,children:[a?.icon," ",a?.label]}),s.payrollImpact&&e.jsxs("div",{className:"px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),"Payroll Impact"]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.hrReviewed?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:s.hrReviewed?"✅ Reviewed":"⏳ Pending"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Absence Date:"})," ",new Date(s.absenceDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reported by:"})," ",s.managerName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reported on:"})," ",new Date(s.reportedDate).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Payroll:"}),e.jsx("span",{className:s.payrollProcessed?"text-green-600":"text-orange-600",children:s.payrollProcessed?" ✅ Processed":" ⏳ Pending"})]})]}),s.reason&&e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Reason:"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:['"',s.reason,'"']})]}),s.hrNotes&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"HR Notes:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.hrNotes}),s.hrReviewedAt&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Reviewed on ",new Date(s.hrReviewedAt).toLocaleDateString()]})]})]}),e.jsx("div",{className:"flex items-center gap-2 ml-4",children:e.jsxs("button",{onClick:()=>_(s),className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),s.hrReviewed?"Update":"Review"]})})]})},s.id)})})]}),M&&l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50",onClick:()=>d(!1)}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Review Absence Report"}),e.jsx("button",{onClick:()=>d(!1),className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:e.jsx(F,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-3",children:"Absence Report Details"}),e.jsxs("div",{className:"text-sm text-orange-700 space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Employee:"})," ",l.employeeName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Manager:"})," ",l.managerName]})]}),e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(l.absenceDate).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",v.find(s=>s.id===l.absenceType)?.label]})]})]}),l.reason&&e.jsxs("p",{children:[e.jsx("strong",{children:"Reason:"}),' "',l.reason,'"']}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{className:l.payrollImpact?"text-red-700":"text-green-700",children:l.payrollImpact?"Affects payroll calculation":"No payroll impact"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"hrReviewed",checked:n.hrReviewed,onChange:s=>y(a=>({...a,hrReviewed:s.target.checked})),className:"w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{htmlFor:"hrReviewed",className:"text-sm font-medium text-gray-700",children:"Mark as HR Reviewed"})]}),l.payrollImpact&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"payrollProcessed",checked:n.payrollProcessed,onChange:s=>y(a=>({...a,payrollProcessed:s.target.checked})),className:"w-5 h-5 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),e.jsx("label",{htmlFor:"payrollProcessed",className:"text-sm font-medium text-gray-700",children:"Mark as Payroll Processed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Notes"}),e.jsx("textarea",{value:n.hrNotes,onChange:s=>y(a=>({...a,hrNotes:s.target.value})),placeholder:"Add any HR notes or payroll instructions...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 resize-none",rows:4})]})]}),e.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:S,className:`px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2 ${S?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-orange-600 text-white hover:bg-orange-700"}`,children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4"}),"Update Report"]})})]})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 via-white to-red-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Organization Not Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"You don't seem to be associated with an organization."}),e.jsx("button",{onClick:()=>A("/dashboard"),className:"bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition-colors",children:"Return to Dashboard"})]})})};export{ce as AbsenceReportReview};
