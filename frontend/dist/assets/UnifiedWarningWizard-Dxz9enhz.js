const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dashboard-router-CsxAXVhx.js","assets/business-owner-dashboard-Dq6MrEKt.js","assets/pdf-vendor-CbrIsI36.js","assets/react-vendor-BMk1H4su.js","assets/firebase-vendor-BIBOIkWK.js","assets/ui-vendor-Bx41JZPX.js","assets/hr-dashboard-Dso9aBo_.js","assets/hod-dashboard-CL_RWHxj.js","assets/warning-components-rhTj25mI.js"])))=>i.map(i=>d[i]);
import{a as e}from"./pdf-vendor-CbrIsI36.js";import{j as a,T as r,v as s,g as t,f as o,w as i,x as n,y as l,L as c,i as d,s as m,d as u,o as h,u as g,a as x,A as p}from"./business-owner-dashboard-Dq6MrEKt.js";import{r as y,R as v,d as b}from"./react-vendor-BMk1H4su.js";import{E as w,G as f,H as k,x as j,l as N,p as C,j as S,u as z}from"./firebase-vendor-BIBOIkWK.js";import{I as R,i as D,s as I,C as T,ah as E,g as L,X as $,Q as P,c as A,S as M,aG as W,at as F,d as q,T as _,F as U,n as B,p as H,aH as O,aa as G,aI as Q,U as Y,h as V,aJ as X,a8 as K,R as Z,aK as J,aL as ee,ao as ae,y as re,l as se,aM as te,t as oe,aN as ie,an as ne,J as le,aO as ce,aw as de,O as me}from"./ui-vendor-Bx41JZPX.js";import{u as ue,P as he}from"./warning-components-rhTj25mI.js";import{C as ge}from"./CustomDatePicker-Bg2OmU-3.js";import{u as xe,b as pe,P as ye}from"./dashboard-router-CsxAXVhx.js";import"./hr-dashboard-Dso9aBo_.js";import"./hod-dashboard-CL_RWHxj.js";const ve=({currentPhase:e,totalPhases:r,completedPhases:s,onPhaseClick:t})=>{const o=(e+1)/r*100;return a.jsx("div",{className:"mb-3",children:a.jsx("div",{className:"h-1 rounded-full overflow-hidden",style:{backgroundColor:"var(--color-border-light)"},children:a.jsx("div",{className:"h-full rounded-full transition-all duration-300 ease-out",style:{width:`${o}%`,backgroundColor:"var(--color-primary)"}})})})},be=({title:e,icon:r,phaseNumber:s,totalPhases:t,employeeName:o,incidentDate:i})=>a.jsxs("div",{className:"mb-4",children:[(o||i)&&a.jsxs("div",{className:"flex items-center gap-3 text-xs mb-3 pb-3 border-b",style:{color:"var(--color-text-secondary)",borderColor:"var(--color-border)"},children:[o&&a.jsxs("span",{children:[a.jsx("strong",{children:"Employee:"})," ",o]}),i&&a.jsxs("span",{children:[a.jsx("strong",{children:"Date:"})," ",i]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsx(r,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:e}),a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Phase ",s," of ",t]})]})]})]}),we=({children:e,variant:r="info"})=>{const s={info:{bg:"var(--color-alert-info-bg)",text:"var(--color-alert-info-text)",border:"var(--color-primary)"},tip:{bg:"var(--color-alert-success-bg)",text:"var(--color-alert-success-text)",border:"#10b981"},warning:{bg:"var(--color-alert-warning-bg)",text:"var(--color-alert-warning-text)",border:"#f59e0b"}}[r];return a.jsx("div",{className:"p-4 rounded-lg mb-4",style:{backgroundColor:s.bg,borderLeft:`3px solid ${s.border}`},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(R,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:s.border}}),a.jsx("div",{className:"text-sm",style:{color:s.text},children:e})]})})},fe=({currentPhase:e,totalPhases:s,isValid:t,isLoading:o=!1,onPrevious:i,onNext:n,customNextText:l,customNextIcon:c,showFinalize:d,onFinalize:m})=>{const u=e===s-1,h=0===e;return a.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",style:{borderColor:"var(--color-border)"},children:[a.jsx(r,{variant:"outline",onClick:i,disabled:h,icon:D,children:"Back"}),d&&m?a.jsx(r,{onClick:m,disabled:!t||o,loading:o,icon:I,children:"Finalize"}):a.jsx(r,{onClick:n,disabled:!t||o,loading:o,icon:c||(u?I:T),iconPosition:"right",children:l||(u?"Complete":"Continue")})]})},ke=["#10b981","#3b82f6","#f59e0b","#ec4899","#8b5cf6","#06b6d4"],je=({isVisible:e,message:r="Success!",subMessage:s,onComplete:t,duration:o=3e3,showConfetti:i=!0})=>{const[n,l]=y.useState([]),[c,d]=y.useState(!1),m=y.useCallback(()=>{const e=[];for(let a=0;a<50;a++)e.push({id:a,x:100*Math.random(),color:ke[Math.floor(Math.random()*ke.length)],delay:.5*Math.random(),size:8*Math.random()+4,rotation:360*Math.random()});return e},[]);return y.useEffect(()=>{if(e){"vibrate"in navigator&&navigator.vibrate([50,30,50]),i&&l(m()),setTimeout(()=>d(!0),100);const e=setTimeout(()=>{t?.()},o);return()=>{clearTimeout(e)}}d(!1),l([])},[e,i,o,t,m]),e?a.jsxs("div",{className:"fixed inset-0 z-[9500] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},role:"alert","aria-live":"assertive",children:[i&&n.map(e=>a.jsx("div",{className:"wizard-confetti wizard-confetti-piece",style:{left:`${e.x}%`,top:"-20px",width:`${e.size}px`,height:`${e.size}px`,backgroundColor:e.color,animationDelay:`${e.delay}s`,borderRadius:Math.random()>.5?"50%":"2px",transform:`rotate(${e.rotation}deg)`}},e.id)),a.jsxs("div",{className:`\n          bg-white rounded-2xl p-8 shadow-2xl\n          flex flex-col items-center text-center\n          max-w-sm mx-4\n          ${c?"wizard-success-bounce":"opacity-0"}\n        `,children:[a.jsx("div",{className:"wizard-success-circle w-20 h-20 rounded-full flex items-center justify-center mb-4",style:{backgroundColor:"var(--color-success)"},children:a.jsx("svg",{className:"w-10 h-10 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:a.jsx("polyline",{className:"wizard-success-checkmark",points:"20 6 9 17 4 12"})})}),a.jsx("h2",{className:"text-xl font-bold mb-2",style:{color:"var(--color-text-primary)"},children:r}),s&&a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:s}),a.jsx("div",{className:"mt-6 w-full",children:a.jsx("div",{className:"h-1 rounded-full overflow-hidden",style:{backgroundColor:"var(--color-border-light)"},children:a.jsx("div",{className:"h-full rounded-full transition-all ease-linear",style:{backgroundColor:"var(--color-success)",width:"100%",animation:`shrink-progress ${o}ms linear forwards`}})})})]}),a.jsx("style",{children:"\n        @keyframes shrink-progress {\n          from { width: 100%; }\n          to { width: 0%; }\n        }\n      "})]}):null};const Ne=({employees:e,selectedEmployeeId:i,onEmployeeSelect:n,warningHistory:l=[],isLoadingWarningHistory:c=!1,disabled:d=!1,className:m=""})=>{const[u,h]=y.useState(""),[g,x]=y.useState(!1),[p,v]=y.useState(!1),[b,w]=y.useState(!1),f=(e,a)=>e[a]?String(e[a]):e.profile?.[a]?String(e.profile[a]):"position"===a&&e.employment?.position?String(e.employment.position):"department"===a&&e.profile?.department?String(e.profile.department):"",k=y.useMemo(()=>{if(!u.trim())return e;const a=u.toLowerCase();return e.filter(e=>{const r=`${f(e,"firstName")} ${f(e,"lastName")}`.toLowerCase(),s=e.id?.toLowerCase()||"",t=f(e,"department").toLowerCase();return r.includes(a)||s.includes(a)||t.includes(a)})},[e,u]),j=y.useMemo(()=>e.find(e=>e.id===i),[e,i]),N=y.useCallback(e=>{n(e),x(!1),v(!1),w(!1),h("")},[n]),C=y.useCallback(()=>{if(d)return;window.innerWidth<768?w(!0):v(!p)},[d,p]),S=y.useCallback(()=>{w(!1),h("")},[]);return a.jsxs("div",{className:`space-y-4 ${m}`,children:[a.jsx(s,{icon:E,title:"Employee Selection",subtitle:"Choose the employee involved in this incident",rightContent:a.jsx(t,{variant:"secondary",size:"sm",children:k.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(o,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(d?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:p?"var(--color-primary)":"var(--color-border)",boxShadow:p?"0 0 0 2px var(--color-primary-light)":void 0},onClick:C,children:j?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsxs("span",{className:"font-semibold text-xs",style:{color:"var(--color-primary)"},children:[f(j,"firstName").charAt(0),f(j,"lastName").charAt(0)]})}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:[f(j,"firstName")," ",f(j,"lastName")]}),a.jsxs("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:[f(j,"position")," â€¢ ",f(j,"department")]})]})]}),a.jsx(L,{className:"w-4 h-4 transition-transform flex-shrink-0 "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select an employee..."})]}),a.jsx(L,{className:"w-4 h-4 transition-transform "+(p?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),p&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm"})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:k.length>0?a.jsx("div",{className:"py-2",children:k.map(e=>((e=>{e.riskIndicators&&e.riskIndicators.highRisk})(e),(e=>{if(!e.recentWarnings)return null;const{count:a,lastDate:r,level:s}=e.recentWarnings})(e),a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-3 py-2 hover:bg-gray-50 transition-colors",children:a.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[f(e,"firstName")," ",f(e,"lastName")," - ",f(e,"position")]})},e.id)))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(E,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsxs("p",{children:['No employees found matching "',u,'"']})]})})]})]})}),b&&a.jsxs("div",{className:"mobile-employee-modal",children:[a.jsx("div",{className:"mobile-employee-modal-backdrop",onClick:S}),a.jsxs("div",{className:"mobile-employee-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Employee"}),a.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx($,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search employees...",value:u,onChange:e=>h(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})}),a.jsx("div",{className:"mobile-category-list",children:k.length>0?a.jsx("div",{children:k.map(e=>a.jsx("button",{onClick:()=>N(e.id),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0",children:a.jsxs("div",{className:"font-medium text-gray-900 text-base",children:[f(e,"firstName")," ",f(e,"lastName")," - ",f(e,"position")]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No employees found"}),u&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',u,'"']})]})})]})]}),j&&g&&a.jsxs(o,{padding:"md",className:"border-2",style:{borderColor:"var(--color-primary-light)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold text-base",style:{color:"var(--color-text)"},children:"Employee Details"}),a.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>x(!g),className:"flex items-center gap-1",children:[g?a.jsx(P,{className:"w-4 h-4"}):a.jsx(L,{className:"w-4 h-4"}),g?"Hide":"Show"]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Contact Information"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["ðŸ“§ ",f(j,"email")||"No email",a.jsx("br",{}),"ðŸ“± ",f(j,"phone")||"No phone"]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700",children:"Position Details"}),a.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[f(j,"position"),a.jsx("br",{}),f(j,"department")]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Warning History"}),c?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsx(A,{className:"w-4 h-4 animate-spin"}),"Loading history..."]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Total Warnings:"}),a.jsx("span",{className:"font-medium text-gray-900",children:j.recentWarnings?.count||0})]}),j.recentWarnings?.lastDate&&a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Last Warning:"}),a.jsx("span",{className:"text-sm text-gray-900",children:new Date(j.recentWarnings.lastDate).toLocaleDateString()})]})]})]}),j.riskIndicators&&a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold mb-2",style:{color:"var(--color-text)"},children:"Risk Assessment"}),a.jsxs(t,{variant:j.riskIndicators.highRisk?"error":"success",size:"md",className:"inline-flex items-center gap-2",children:[a.jsx(M,{className:"w-4 h-4"}),j.riskIndicators.highRisk?"High Risk":"Low Risk"]}),j.riskIndicators.reasons.length>0&&a.jsx("div",{className:"mt-2",children:a.jsx("ul",{className:"text-xs text-gray-600 space-y-1",children:j.riskIndicators.reasons.slice(0,3).map((e,r)=>a.jsxs("li",{className:"flex items-start gap-1",children:[a.jsx("span",{className:"text-amber-500 mt-0.5",children:"â€¢"}),e]},r))})})]})]})]})]})]})},Ce=({categories:e,selectedCategoryId:r,onCategorySelect:t,lraRecommendation:l,disabled:c=!1,className:d=""})=>{const[m,u]=y.useState(!1),[h,g]=y.useState(!1),[x,p]=y.useState(!1),[v,b]=y.useState(""),w=y.useMemo(()=>{if(!v.trim())return e;const a=v.toLowerCase();return e.filter(e=>{const r=e.name?.toLowerCase()||"",s=e.description?.toLowerCase()||"",t=e.severity?.toLowerCase()||"";return r.includes(a)||s.includes(a)||t.includes(a)})},[e,v]),f=y.useMemo(()=>e.find(e=>e.id===r),[e,r]),k=y.useCallback(e=>{t(e),u(!1),g(!1),p(!1),b("")},[t]),j=y.useCallback(()=>{if(c)return;window.innerWidth<768?p(!0):g(!h)},[c,h]),N=y.useCallback(()=>{p(!1),b("")},[]),C=y.useMemo(()=>f?f.escalationPath||i(f.id):[],[f]),S=y.useMemo(()=>l&&C.length?C.findIndex(e=>e===l.suggestedLevel):-1,[l,C]);return a.jsxs("div",{className:`space-y-4 ${d}`,children:[a.jsx(s,{icon:W,title:"Category Selection",subtitle:"Choose the type of misconduct or policy violation",rightContent:a.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:e.length})}),a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx(o,{hover:!0,padding:"sm",className:"cursor-pointer transition-all min-h-[48px] "+(c?"opacity-50 cursor-not-allowed":""),style:{borderWidth:"1px",borderColor:h?"var(--color-primary)":"var(--color-border)",boxShadow:h?"0 0 0 2px var(--color-primary-light)":void 0},onClick:j,children:f?a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:f.name}),f.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:f.description})]})]}),a.jsx(L,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(E,{className:"w-4 h-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Select a category..."})]}),a.jsx(L,{className:"w-4 h-4 transition-transform "+(h?"rotate-180":""),style:{color:"var(--color-text-tertiary)"}})]})}),h&&a.jsxs("div",{className:"fixed top-20 left-4 right-4 z-[10001] bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-hidden md:absolute md:top-full md:left-0 md:right-0",children:[a.jsx("div",{className:"p-3 border-b border-gray-200",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm",autoFocus:!0})}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:w.length>0?a.jsx("div",{className:"py-2",children:w.map(e=>a.jsx("button",{onClick:()=>k(e.id),className:"w-full text-left px-3 py-3 transition-colors hover:bg-opacity-50",style:{color:"var(--color-text)",":hover":{backgroundColor:"var(--color-primary-light)"}},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-lg flex-shrink-0",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsx("div",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-xs mt-0.5",style:{color:"var(--color-text-secondary)"},children:e.description})]})]})},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx(W,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),a.jsx("p",{children:"No categories found"}),v&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',v,'"']})]})})]})]})}),x&&a.jsxs("div",{className:"mobile-category-modal",children:[a.jsx("div",{className:"mobile-category-modal-backdrop",onClick:N}),a.jsxs("div",{className:"mobile-category-modal-content",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Select Category"}),a.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full",children:a.jsx($,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"p-4",children:a.jsx("input",{type:"text",placeholder:"Search categories...",value:v,onChange:e=>b(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",autoFocus:!0})}),a.jsx("div",{className:"overflow-y-auto",style:{maxHeight:"60vh"},children:w.length>0?a.jsx("div",{children:w.map(e=>a.jsxs("button",{onClick:()=>k(e.id),className:"w-full text-left px-4 py-4 transition-colors flex items-start gap-3",style:{borderBottom:"1px solid var(--color-border)",color:"var(--color-text)",justifyContent:"flex-start",alignItems:"flex-start"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--color-primary-light)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl flex-shrink-0 mt-0.5",style:{backgroundColor:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error-bg)":"moderate"===e.severity?"var(--color-warning-bg)":"var(--color-primary-bg)",color:"serious"===e.severity||"gross_misconduct"===e.severity?"var(--color-error)":"moderate"===e.severity?"var(--color-warning)":"var(--color-primary)"},children:e.icon}),a.jsxs("div",{className:"min-w-0 flex-1 text-left",children:[a.jsx("div",{className:"font-medium text-base text-left",style:{color:"var(--color-text)"},children:e.name}),e.description&&a.jsx("div",{className:"text-sm text-left mt-1",style:{color:"var(--color-text-secondary)"},children:e.description})]})]},e.id))}):a.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[a.jsx("p",{children:"No categories found"}),v&&a.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:['matching "',v,'"']})]})})]})]}),f&&m&&a.jsxs(o,{className:"rounded-xl p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Category Details"}),a.jsxs("button",{onClick:()=>u(!m),className:"flex items-center gap-1 text-sm",style:{color:"var(--color-primary)"},children:[m?a.jsx(P,{className:"w-4 h-4"}):a.jsx(L,{className:"w-4 h-4"}),m?"Hide":"Show"]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"Category Information"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Severity Level:"}),a.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:(e=>{switch(e?.toLowerCase()){case"high":return{backgroundColor:"var(--color-alert-error-bg)",color:"var(--color-alert-error-text)",borderColor:"var(--color-alert-error-border)"};case"medium":return{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)",borderColor:"var(--color-alert-warning-border)"};case"low":return{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)",borderColor:"var(--color-alert-success-border)"};default:return{backgroundColor:"var(--color-muted)",color:"var(--color-text-secondary)",borderColor:"var(--color-border)"}}})(f.severity),children:f.severity})]}),f.description&&a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:"Description:"}),a.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:f.description})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:"LRA Recommendation"}),l?a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),a.jsx("span",{className:"font-medium",style:{color:"var(--color-text)"},children:n(l.suggestedLevel)}),l.isEscalation&&a.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:"Escalation"})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:l.reason})]}):a.jsx("div",{className:"text-sm italic",style:{color:"var(--color-text-tertiary)"},children:"Select an employee to see LRA recommendation"})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-medium mb-3",style:{color:"var(--color-text-secondary)"},children:"Progressive Discipline Path"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:C.map((e,r)=>{const s=r===S,t=S>=0&&r<S;return a.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border text-sm font-medium",style:{backgroundColor:s?"var(--color-badge-primary)":t?"var(--color-muted)":"var(--color-card-background)",borderColor:s?"var(--color-primary)":"var(--color-border)",color:s?"var(--color-badge-primary-text)":"var(--color-text-secondary)"},children:[s&&a.jsx(q,{className:"w-4 h-4"}),t&&a.jsx(_,{className:"w-4 h-4"}),a.jsx("span",{children:n(e)}),r<C.length-1&&a.jsx("span",{style:{color:"var(--color-text-tertiary)"},children:"â†’"})]},e)})}),l&&a.jsx("div",{className:"mt-3 p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)",border:"1px solid var(--color-alert-info-border)"},children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(F,{className:"w-4 h-4 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-sm font-medium",style:{color:"var(--color-alert-info-text)"},children:["Recommended Action: ",n(l.suggestedLevel)]}),a.jsxs("div",{className:"text-sm mt-1",style:{color:"var(--color-alert-info-text)"},children:["Based on ",l.categoryWarningCount??0," previous warning(s) in this category",l.isEscalation&&" (escalation required)"]})]})]})})]})]})]})]})},Se=({formData:e,onFormDataChange:r,disabled:t=!1,className:o=""})=>{const[i,n]=y.useState({}),[c,d]=y.useState({}),m=(e.incidentDescription||"").trim().split(/\s+/).filter(e=>e.length>0).length;const u=m>=6,h=y.useCallback((e,a)=>{switch(e){case"incidentDate":if(!a)return"Incident date is required";return new Date(a)>new Date?"Incident date cannot be in the future":null;case"incidentTime":if(!a)return"Incident time is required";return/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(a)?null:"Please enter time in HH:MM format";case"incidentLocation":return!a||a.trim().length<3?"Please provide a specific location (minimum 3 characters)":null;case"incidentDescription":const e=a.trim().split(/\s+/).filter(e=>e.length>0).length;return 0===e?"Description is required":e<6?`Description must be at least 6 words (currently ${e} word${1===e?"":"s"})`:e>500?`Description is too long (maximum 500 words, currently ${e} words)`:null;default:return null}},[]),g=y.useCallback((e,a)=>{r({[e]:a}),d(a=>({...a,[e]:!0}));const s=h(e,a);n(a=>({...a,[e]:s}))},[r,h]);return(new Date).toISOString().split("T")[0],a.jsxs("div",{className:`space-y-4 ${o}`,children:[a.jsx(s,{icon:U,title:"Incident Details",subtitle:"Provide comprehensive details about the incident"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(ge,{type:"date",label:"Incident Date",value:e.incidentDate||"",onChange:e=>g("incidentDate",e),icon:B,required:!0,disabled:t,error:i.incidentDate&&c.incidentDate?i.incidentDate:void 0}),a.jsx(ge,{type:"time",label:"Incident Time",value:e.incidentTime||"",onChange:e=>g("incidentTime",e),icon:A,required:!0,disabled:t,error:i.incidentTime&&c.incidentTime?i.incidentTime:void 0})]}),a.jsx(l,{type:"text",label:"Incident Location",value:e.incidentLocation||"",onChange:e=>g("incidentLocation",e),placeholder:"e.g., Main office reception area, Warehouse loading dock, Conference Room B",icon:H,required:!0,disabled:t,error:i.incidentLocation&&c.incidentLocation?i.incidentLocation:void 0}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[a.jsx(O,{className:"w-3 h-3 inline mr-1"}),"What Happened *"]}),a.jsxs("div",{className:"text-xs px-1.5 py-0.5 rounded-full",style:{backgroundColor:u?"var(--color-alert-success-bg)":"var(--color-alert-warning-bg)",color:u?"var(--color-alert-success-text)":"var(--color-alert-warning-text)"},children:[m," words"]})]}),a.jsx("textarea",{value:e.incidentDescription||"",onChange:e=>g("incidentDescription",e.target.value),placeholder:"Describe the incident: What did the employee do or fail to do? Include specific details like what was said, actions taken, who was present, and when/where it happened...",disabled:t,rows:6,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 text-sm min-h-[132px] resize-vertical "+(t?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:i.incidentDescription&&c.incidentDescription?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:i.incidentDescription&&c.incidentDescription?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"}}),i.incidentDescription&&c.incidentDescription&&a.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[a.jsx(_,{className:"w-3 h-3"}),i.incidentDescription]})]})]})},ze=[{code:"en",name:"English",nativeName:"English"},{code:"af",name:"Afrikaans",nativeName:"Afrikaans"},{code:"zu",name:"Zulu",nativeName:"isiZulu"},{code:"xh",name:"Xhosa",nativeName:"isiXhosa"},{code:"st",name:"Sotho",nativeName:"Sesotho"},{code:"ts",name:"Tsonga",nativeName:"Xitsonga"},{code:"ve",name:"Venda",nativeName:"Tshivenda"},{code:"ss",name:"Swati",nativeName:"siSwati"},{code:"tn",name:"Tswana",nativeName:"Setswana"},{code:"nr",name:"Ndebele",nativeName:"isiNdebele"},{code:"ns",name:"Northern Sotho",nativeName:"Sepedi"}],Re={en:{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},af:{counselling:"Beradingsessie",verbal:"Mondelinge Waarskuwing",first_written:"Eerste Geskrewe Waarskuwing",second_written:"Tweede Geskrewe Waarskuwing",final_written:"Finale Geskrewe Waarskuwing"},zu:{counselling:"Iseshini Yokweluleka",verbal:"Isexwayiso Ngomlomo",first_written:"Isexwayiso Sokuqala Esibhaliwe",second_written:"Isexwayiso Sesibili Esibhaliwe",final_written:"Isexwayiso Sokugcina Esibhaliwe"},xh:{counselling:"Iseshoni Yokucebisa",verbal:"Isilumkiso Ngomlomo",first_written:"Isilumkiso Sokuqala Esibhaliweyo",second_written:"Isilumkiso Sesibini Esibhaliweyo",final_written:"Isilumkiso Sokugqibela Esibhaliweyo"},st:{counselling:"Seboka sa Keletso",verbal:"Temoso ya Molomo",first_written:"Temoso ya Pele e Ngotsweng",second_written:"Temoso ya Bobedi e Ngotsweng",final_written:"Temoso ya ho Qetela e Ngotsweng"},ts:{counselling:"Nkarhi wo Tivonela",verbal:"Xilumkiso xa Marito",first_written:"Xilumkiso xa Sinthoma xa Ku Tsariwa",second_written:"Xilumkiso xa Vumbirhi xa Ku Tsariwa",final_written:"Xilumkiso xa Makumu xa Ku Tsariwa"},ve:{counselling:"Tshikhala tsha Themendelo",verbal:"Tivhiso ya Ipfi",first_written:"Tivhiso ya u Thoma yo á¹„walwaho",second_written:"Tivhiso ya vhuvhili yo á¹„walwaho",final_written:"Tivhiso ya u Fhedzisela yo á¹„walwaho"},ss:{counselling:"Seshoni Sekululeleka",verbal:"Sixwayiso Ngemlomo",first_written:"Sixwayiso Sekucala Lesibhaliwe",second_written:"Sixwayiso Sesibili Lesibhaliwe",final_written:"Sixwayiso Sekugcina Lesibhaliwe"},tn:{counselling:"Khuduthamaga ya Kgakololo",verbal:"Temoso ya Molomo",first_written:"Temoso ya Ntlha e e Kwadilweng",second_written:"Temoso ya Bobedi e e Kwadilweng",final_written:"Temoso ya Bofelo e e Kwadilweng"},nr:{counselling:"Iseshini Yokululeleka",verbal:"Isixwayiso Ngomlomo",first_written:"Isixwayiso Sokuqala Esibhaliwe",second_written:"Isixwayiso Sesibili Esibhaliwe",final_written:"Isixwayiso Sokugcina Esibhaliwe"},ns:{counselling:"Kopano ya KeletÅ¡o",verbal:"TemoÅ¡o ya Molomo",first_written:"TemoÅ¡o ya Pele yeo e Ngwadilwego",second_written:"TemoÅ¡o ya Bobedi yeo e Ngwadilwego",final_written:"TemoÅ¡o ya Mafelelo yeo e Ngwadilwego"}},De={en:{formalCharge:(e,a,r,s,t)=>`${e}, you are being charged with ${a}: ${r}. This is a ${s}, valid for ${t} months.`,documentNotice:()=>"This warning will be generated as a digital document containing all details of our discussion, including your version of events, expected behavior standards, and improvement commitments. You will receive this document to review carefully - either by downloading it now via QR code, or it will be sent to you by HR.",legalRights:()=>"Your rights under the Labour Relations Act: You may appeal to HR in writing within 48 hours if you disagree. You may have a fellow employee or shop steward represent you. All unexpired warnings accumulate, and further misconduct may result in additional discipline, up to ending of service.",signatureExplanation:()=>"Your signature confirms you understand this warning and will review the document - not that you agree with it. If you refuse to sign, a witness will confirm the warning was explained. The warning is valid either way. Do you have any questions before we collect signatures?"},af:{formalCharge:(e,a,r,s,t)=>`${e}, jy word aangekla van ${a}: ${r}. Dit is 'n ${s}, geldig vir ${t} maande.`,documentNotice:()=>"Hierdie waarskuwing sal as 'n digitale dokument gegenereer word wat alle besonderhede van ons bespreking bevat, insluitend jou weergawe van gebeure, verwagte gedragstandaarde, en verbeteringsverpligtinge. Jy sal hierdie dokument ontvang om noukeurig te hersien - Ã³f deur dit nou via QR-kode af te laai, Ã³f dit sal deur HR aan jou gestuur word.",legalRights:()=>"Jou regte onder die Wet op Arbeidsverhoudinge: Jy mag binne 48 uur skriftelik by HR appelieer as jy nie saamstem nie. Jy mag 'n mede-werknemer of vakbondverteenwoordiger hÃª om jou te verteenwoordig. Alle onverstreke waarskuwings akkumuleer, en verdere wangedrag kan lei tot addisionele dissipline, tot beÃ«indiging van diens.",signatureExplanation:()=>"Jou handtekening bevestig dat jy hierdie waarskuwing verstaan en die dokument sal hersien - nie dat jy daarmee saamstem nie. As jy weier om te teken, sal 'n getuie bevestig dat die waarskuwing verduidelik is. Die waarskuwing is beide kante geldig. Het jy enige vrae voordat ons handtekeninge versamel?"},zu:{formalCharge:(e,a,r,s,t)=>`${e}, uyabekwa icala nge-${a}: ${r}. Lesi yisixwayiso se-${s}, esisebenza izinyanga ezingu-${t}.`,documentNotice:()=>"Lesi sixwayiso sizokwenziwa njengomqulu wedijithali oqukethe zonke imininingwane yengxoxo yethu, kufaka phakathi inguqulo yakho yezigameko, izindinganiso zokuziphatha ezilindelekile, nezibopho zokuthuthuka. Uzothola lo mqulu ukuze uwubuyekeze ngokucophelela - kungaba ngokuwulanda manje ngekhodi ye-QR, noma uzothunyelwa yihostela ye-HR.",legalRights:()=>"Amalungelo akho ngaphansi koMthetho Wobudlelwano Basebenzi: Ungaphikisa ku-HR ngokubhaliwe ngamahora angu-48 uma ungavumelani. Ungaba nomsebenzi ofana nawe noma ummeleli wenyunyana ukuthi akumele. Zonke izixwayiso ezingaphelelanga ziyaqoqeka, futhi ukuziphatha okubi okwengeziwe kungase kuholele esinyweni esinye, kuya ekuphethweni kwenkonzo.",signatureExplanation:()=>"Ukusayina kwakho kuqinisekisa ukuthi uyaqonda lesi sixwayiso futhi uzobuyekeza umqulu - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, ufakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela. Ingabe unemibuzo ngaphambi kokuba siqoqe izimo zokusayina?"},xh:{formalCharge:(e,a,r,s,t)=>`${e}, uyatyholwa nge-${a}: ${r}. Esi sisilumkiso se-${s}, esisebenza iinyanga ezingu-${t}.`,documentNotice:()=>"Esi silumkiso siya kuveliswa njengoxwebhu lwedijithali oluqulathe zonke iinkcukacha zengxoxo yethu, kuquka inguqulelo yakho yeziganeko, imigangatho yokuziphatha elindelekileyo, nezibophelelo zophuculo. Uya kulufumana olu xwebhu ukuze uluphononge ngononophelo - nokuba ngokulushutha ngoku ngekhowudi ye-QR, okanye luya kuthunyelwa kuwe yi-HR.",legalRights:()=>"Amalungelo akho phantsi koMthetho woBudlelwane baBasebenzi: Ungabhena kwi-HR ngokubhaliwe kwiiyure ezingama-48 ukuba awuvumelani. Ungaba nomsebenzi ofana nawe okanye ummeli wemanyano ukuba akumele. Zonke izilumkiso ezingaphelelwanga ziyaqokelelana, kwaye ukuziphatha okubi okongezelelweyo kunokubangela ukulungiswa okongezelelweyo, ukuya ekupheliseni kwenkonzo.",signatureExplanation:()=>"Utyikityo lwakho luqinisekisa ukuba uyaqonda esi silumkiso kwaye uya kuphonononga uxwebhu - hayi ukuba uyavuma. Ukuba ukhaba ukusayina, ingqina iya kuqinisekisa ukuba isilumkiso sichaziwe. Isilumkiso sisebenza ngazo zombini iindlela. Ingaba unemibuzo ngaphambi kokuba siqokelele iityikityo?"},st:{formalCharge:(e,a,r,s,t)=>`${e}, o a fuoa lengolo la ${a}: ${r}. Ena ke temoso ea ${s}, e sebetsang likhoeli tse ${t}.`,documentNotice:()=>"Temoso ena e tla etsoa e le tokomane ea digital e nang le lintlha tsohle tsa puisano ea rona, ho kenyelletsa maikutlo a hao a ditiragalo, litekanyetso tsa boitshwaro tse lebelletsoeng, le likano tsa ntlafatso. O tla fumana tokomane ena hore o e hlahlobe ka hloko - kapa ka ho e khoasolla hona joale ka QR code, kapa e tla romelloa ho wena ke HR.",legalRights:()=>"Litokelo tsa hao ka tlasa Molao oa Likamano tsa Basebetsi: O ka ipeela ho HR ka ho ngola ka mora dihora tse 48 haeba o sa lumellane. O ka ba le mosebetsi ea tÅ¡oanang le uena kapa moemeli oa kesara ho u emela. Litemoso tsohle tse sa felang li bokellana, 'me boitshwaro bo bobe bo eketsehileng bo ka hlahisa kgetho e eketsehileng, ho fihla feteletsong ea ts'ebeletso.",signatureExplanation:()=>"Saeno ea hao e tiisa hore o utloisisa temoso ena 'me o tla hlahloba tokomane - eseng hore o lumela. Haeba o hana ho saena, paki e tla tiisa hore temoso e hlalositsoe. Temoso e sebetsa ka tsela ka bobeli. Na o na le lipotso pele re bokella mesaeno?"},ts:{formalCharge:(e,a,r,s,t)=>`${e}, u rhumiwa hi ${a}: ${r}. Lexi i xilumkiso xa ${s}, lexi tirhaka tin'hweti ta ${t}.`,documentNotice:()=>"Xilumkiso lexi xi ta endliwa xi ri dokumente ya didjithali leyi nga ni swileriso hinkwaswo swa vulavurisani bya hina, ku katsa xivono xa wena xa swiendlakalo, swiyimo swa mavanyiselo leswi languteriwaka, ni swipimelo swa ku antswisa. U ta kuma dokumente leyi leswaku u yi kambisisa hi vukheta - hambiloko hi ku yi hoxa sweswi hi khodi ya QR, kumbe yi ta rhumiwa eka wena hi HR.",legalRights:()=>"Timfanelo ta wena hi ka tlhelo ka Nawu wa Vuhlanganisi bya Vatirhi: U nga appila eka HR hi ku tsala hi nkarhi wa tawa ta 48 loko u nga pfumeli. U nga va ni mutirhimutsongo wa n'wina kumbe muemimuhlangani leswaku a ku yimela. Swilumkiso hinkwaswo leswi nga heli swi hlengeletiwa, naswona mavanyiselo yo biha lama engetelekeke ma nga endla ndzulavulo wo engetela, ku ya eka ku herisiwa ka vutirheri.",signatureExplanation:()=>"Vusayini bya wena byi tiyisisa leswaku u twisisa xilumkiso lexi naswona u ta kambisisa dokumente - ku nga ri leswaku u pfumela. Loko u vavisa ku sayini, nhlamulo a nga tiyisisa leswaku xilumkiso xi hlamuseriwile. Xilumkiso xi tirhaka hi tindlela hinkwato. Xana u na swivutiso loko hi nga si hlengeleta vusayini?"},ve:{formalCharge:(e,a,r,s,t)=>`${e}, no á¹±uá¹±uwedzwa nga ha ${a}: ${r}. Iyi ndi tivhiso ya ${s}, yo shuma minwedzi ya ${t}.`,documentNotice:()=>"Tivhiso iyi i á¸“o bveledzwa sa á¸“okumente ya diá¸“ijitali ine ya vha na vhubvo hoá¹±he ha mushumo washu, hu tshi katelwa ndivho yavho ya zwithu, mielo ya maitele ane a linganiswa, na zwikhahlamelo zwa u khwinisa. No á¸“o wana á¸“okumente iyi uri no i sedze nga vhuá¹±ali - arali nga u i khou dowuloda zwino nga QR code, kana i á¸“o rumela khavho nga HR.",legalRights:()=>"Pfanelo dzavho kha fhasi ha Mulayo wa Vhushaka ha Vhashumi: No nga appela kha HR hu tshi á¹…walwa nga tshifhinga tsha awara dza 48 arali no sa tendelani. No nga vha na mushumi wa zwiambaro kana muvhuyeli wa shango u ni á¹±uá¹±uwedza. Tivhiso dzoá¹±he dzi songo fhela dzi a kuvhanganya, nahone maitele a si zwavhuá¸“i ano engedziwa a nga khwinisa mulandu wo engedzeaho, u swika kha u fhedza ha mushumo.",signatureExplanation:()=>"U saena havho zwi tiyisedza uri no pfesesa iyi tivhiso nahone no á¸“o sedza á¸“okumente - zwi si uri no tendelana. Arali no nanga u si saini, muhumbeli o do tiyisedza uri tivhiso yo talutshedzelwa. Tivhiso i shuma nga ndila dzoá¹±he. Vho na mbudziso sa ri si khou kuvhanganya masaena?"},ss:{formalCharge:(e,a,r,s,t)=>`${e}, ubekwa licala nge-${a}: ${r}. Lesi yisixwayiso se-${s}, lesisebenta etinyanga letingu-${t}.`,documentNotice:()=>"Lesixwayiso sitawukhiciwa njenge-document ye-digital lenato tonkhe tincukacha tekulukuluma kwetfu, kufaka ekhatsi incenye yakho yetintfo letehlilebile, tisisetjeniswa tekutiphatsa letilindzelelwako, netitfembiso tekuntfula. Utawutfola le-document kutewubuyekeza ngalokucophelela - nobe ngekuyilanda manje nge-QR code, nobe itawutfunyelwa kuwe ngu-HR.",legalRights:()=>"Emalungelo akho ngansi kweMtsetfo weTinhlangano teTisebenzi: Ungaphikisana ku-HR ngekubhalwa ngetikhatsi tetinshintfu tange-48 uma ungavumelani. Ungaba nemsebenzi lofana nawe noma umemeti welihlangano kutsi akumele. Tonkhe tixwayiso letingapheli tiyabutana, nekutiphatsa lokubi lokucondzako kungase kuholele kulajiswa lokucondzako, kuya ekuphetseni kwemsebenzi.",signatureExplanation:()=>"Kusayina kwakho kucincisekisa kutsi uyatizwa lesixwayiso futsi utawubuyekeza le-document - kusho nje kutsi uyavuma. Uma ukhetsa kungasayini, umfakazi utawucincisekisa kutsi sixwayiso sichaziwe. Sixwayiso sisebenta ngatindzlela tonkhe. Ingabe unemibuto ngaphambi kwekutsi sitfole kusayina?"},tn:{formalCharge:(e,a,r,s,t)=>`${e}, o a sekisiwa ka ${a}: ${r}. Eno ke temoso ya ${s}, e e dirang dikgwedi tse ${t}.`,documentNotice:()=>"Temoso eno e tla dirwa e le tokomane ya ditÅ¡itale e e nang le dintlha tsotlhe tsa puisano ya rona, go akaretsa lekanyo la gago la ditiragalo, mekgwa ya boitshwaro e e solofetsweng, le ditsholofelo tsa tokafatso. O tla bona tokomane eno gore o e sekaseke ka kelotlhoko - kgotsa ka go e khurumetsa jaanong ka khouthu ya QR, kgotsa e tla romelwa go wena ke HR.",legalRights:()=>"Ditshwanelo tsa gago ka fa tlase ga Molao wa Dikamano tsa Badiri: O ka boipiletsa kwa HR ka go kwala mo diureng tse 48 fa o sa dumelane. O ka nna le modiri yo o tshwanang le wena kgotsa moemedi wa lekgotla go go emela. Ditemoso tsotlhe tse di sa feleng di a kokoana, mme boitshwaro jo bo sa siamang jo bo oketsegileng bo ka felela ka kgalemelo e e oketsegileng, go fitlha kwa go fediseleng tiro.",signatureExplanation:()=>"Go saena ga gago go netefatsa gore o tlhaloganya temoso eno le gore o tla sekaseka tokomane - ga go reye gore o dumelana. Fa o tlhopha go sa saena, paki e tla netefatsa gore temoso e tlhalosetse. Temoso e bereka ka ditsela tsotlhe. A o na le dipotso fa pele ga re kokoanya mesaeno?"},nr:{formalCharge:(e,a,r,s,t)=>`${e}, uyabekwa icala nge-${a}: ${r}. Lesi yisixwayiso se-${s}, esisebenza izinyanga ezingu-${t}.`,documentNotice:()=>"Lesi sixwayiso sizokwenziwa njengomqulu wedijithali oqukethe zonke imininingwane yengxoxo yethu, kufaka phakathi inguqulo yakho yezigameko, izindinganiso zokuziphatha ezilindelekile, nezibopho zokuthuthuka. Uzothola lo mqulu ukuze uwubuyekeze ngokucophelela - kungaba ngokuwulanda manje ngekhodi ye-QR, noma uzothunyelwa yihostela ye-HR.",legalRights:()=>"Amalungelo akho ngaphansi koMthetho weBudlelwano Basebenzi: Ungabhena ku-HR ngokubhaliwe ngamahora angama-48 uma ungavumelani. Ungaba nomsebenzi ofana nawe noma ummeleli wenyunyana ukukumela. Zonke izixwayiso ezingaphelelanga ziyaqoqeka, futhi ukuziphatha okubi okwengeziwe kungase kuholele esinyweni esinye, kuya ekuphethweni kwenkonzo.",signatureExplanation:()=>"Ukusayina kwakho kuqinisekisa ukuthi uqonda lesi sixwayiso futhi uzobuyekeza umqulu - hhayi ukuthi uyavuma. Uma wenqaba ukusayina, umfakazi uzoqinisekisa ukuthi isixwayiso sichaziwe. Isixwayiso sisebenza ngazo zombili izindlela. Ingabe unemibuzo ngaphambi kokuba siqoqe izimo zokusayina?"},ns:{formalCharge:(e,a,r,s,t)=>`${e}, o a sekiÅ¡etÅ¡wa ka ${a}: ${r}. Ye ke temoÅ¡o ya ${s}, yeo e Å¡omago dikgwedi tÅ¡e ${t}.`,documentNotice:()=>"TemoÅ¡o ye e tla dirwa bjalo ka tokumente ya diditÅ¡hitale yeo e nago le dintlha tÅ¡ohle tÅ¡a polediÅ¡ano ya rena, go akaretÅ¡a kanegelo ya gago ya ditiragalo, maemo a boitshwaro ao a letelwago, le ditshepiÅ¡i tÅ¡a kaonafatÅ¡o. O tla hwetÅ¡a tokumente ye gore o e sekaseke ka kelohloko - e ka ba ka go e kgauswi gona bjale ka khouthu ya QR, goba e tla romelwa go wena ke HR.",legalRights:()=>"Ditokelo tÅ¡a gago ka fase ga Molao wa Dikamano tÅ¡a BaÅ¡omi: O ka boipiletÅ¡a go HR ka go ngwala ka gare ga diiri tÅ¡e 48 ge o sa dumelelane. O ka ba le modiri yo o swanago le wena goba moemeli wa kesara go go emela. DitemoÅ¡o tÅ¡ohle tÅ¡e di sa feleng di a kokoana, gomme boitshwaro bjo bo sa lokago bjo bo oketÅ¡egilego bo ka fela ka kgalemo ye e oketÅ¡egilego, go fihla go fediÅ¡a moÅ¡omo.",signatureExplanation:()=>"Go saena ga gago go netefatÅ¡a gore o kweÅ¡iÅ¡a temoÅ¡o ye le gore o tla sekaseka tokumente - e sego gore o dumelelana le yona. Ge o gana go saena, paki e tlago netefatÅ¡a gore temoÅ¡o e hlaloÅ¡itÅ¡we. TemoÅ¡o e Å¡oma ka ditsela tÅ¡e ka bobedi. Na o na le dipotÅ¡iÅ¡o pele re kgoboketÅ¡a mesaeno?"}},Ie=({employeeName:e,managerName:r,categoryName:s,incidentDescription:t,warningLevel:o,validityPeriod:i,onScriptRead:n,disabled:l=!1,activeWarnings:c=[],issuedDate:d})=>{const[m,u]=y.useState("en"),[h,g]=y.useState(!1),[x,p]=y.useState(!1),v=De[m]||De.en;ze.find(e=>e.code===m)||ze[0];const b=((e,a)=>{const r=e.toLowerCase().replace(/ /g,"_");return Re[a][r]||e})(o,m);return a.jsx("div",{className:"space-y-2",children:h?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between pb-3 border-b",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Q,{className:"w-4 h-4",style:{color:"var(--color-warning)"}}),a.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--color-text)"},children:"ðŸ“– Employee Warning Script"})]}),a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(G,{className:"w-3 h-3",style:{color:"var(--color-warning)"}}),a.jsx("select",{value:m,onChange:e=>u(e.target.value),disabled:x||l,className:"px-2 py-1 border rounded text-xs focus:ring-1",style:{borderColor:"var(--color-input-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:ze.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))})]})]}),a.jsx("div",{className:"border rounded-lg p-4 max-h-80 overflow-y-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-alert-warning-border)"},children:a.jsxs("div",{className:"prose prose-sm max-w-none space-y-3",children:[a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-error)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"1. Formal Charge"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.formalCharge(e,s,t,b,i)})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-info)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"2. Digital Document Notice"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.documentNotice()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-success)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"3. Your Rights"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.legalRights()})]}),a.jsxs("div",{className:"border-l-4 pl-3",style:{borderLeftColor:"var(--color-warning)"},children:[a.jsx("h5",{className:"font-medium mb-1 text-sm",style:{color:"var(--color-text)"},children:"4. Signature & Questions"}),a.jsx("p",{className:"text-xs leading-relaxed",style:{color:"var(--color-text-secondary)"},children:v.signatureExplanation()})]})]})}),a.jsxs("div",{className:"flex items-center justify-between pt-3 border-t",style:{borderColor:"var(--color-alert-warning-border)"},children:[a.jsxs("div",{className:"flex items-center gap-1.5 text-xs",style:{color:"var(--color-text-secondary)"},children:[a.jsx(Y,{className:"w-3 h-3",style:{color:"var(--color-text-secondary)"}}),a.jsxs("span",{children:["Read this complete script aloud to ",e]})]}),x?a.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-sm",style:{backgroundColor:"var(--color-alert-success-bg)",color:"var(--color-alert-success-text)"},children:[a.jsx(V,{className:"w-3 h-3"}),"Script Reading Confirmed"]}):a.jsxs("button",{onClick:()=>{p(!0),n()},disabled:l,className:"flex items-center gap-1.5 px-4 py-2 rounded-lg transition-colors font-medium text-sm",style:{backgroundColor:"var(--color-success)",color:"var(--color-text-inverse)"},onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:[a.jsx(V,{className:"w-3 h-3"}),"Confirm Script Read Aloud"]})]})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"relative flex-1 max-w-[140px]",children:[a.jsx("select",{value:m,onChange:e=>u(e.target.value),disabled:x||l,className:"appearance-none w-full pl-3 pr-7 py-1.5 border rounded text-xs focus:ring-2 focus:ring-blue-500 transition-all cursor-pointer",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-input-background)",color:"var(--color-text)"},children:ze.map(e=>a.jsx("option",{value:e.code,children:e.nativeName},e.code))}),a.jsx(G,{className:"w-3.5 h-3.5 absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none",style:{color:"var(--color-text-secondary)"}})]}),a.jsxs("button",{onClick:()=>g(!0),disabled:l,className:"flex items-center gap-1.5 px-3 py-1.5 border rounded text-xs font-medium transition-all hover:bg-gray-50 active:scale-95",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-background)",color:"var(--color-text)"},children:[a.jsx(U,{className:"w-3.5 h-3.5"}),a.jsx("span",{children:"View Script"})]})]})})};class Te{static{this.EXPIRY_HOURS=1}static async generateTemporaryLink(e){e.filename,e.pdfBlob.size,e.employeeId,e.warningId,e.organizationId;try{const a=d.currentUser;if(!a)throw c.error("âŒ [TemporaryLinkService] User not authenticated"),new Error("User not authenticated");c.success(2228);const r=this.generateTokenId(),s=Date.now(),t=Math.random().toString(36).substr(2,12),o=e.filename.replace(/[^a-zA-Z0-9.-]/g,"_"),i=`temp-downloads/${e.organizationId||"default"}/${s}_${t}_${o}`,n=w(m,i),l={contentType:"application/pdf",customMetadata:{organizationId:e.organizationId||"",employeeId:e.employeeId||"",warningId:e.warningId||"",filename:e.filename,tokenId:r,createdAt:(new Date).toISOString(),size:e.pdfBlob.size.toString(),uploadedBy:a.uid,purpose:"temporary-download"}};await f(n,e.pdfBlob,l);const u=await k(n),h=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);await this.trackTemporaryFile({tokenId:r,storagePath:i,downloadUrl:u,filename:e.filename,organizationId:e.organizationId,employeeId:e.employeeId,warningId:e.warningId,uploadedBy:a.uid,expiresAt:h,createdAt:new Date}),c.success(4558);const g=await this.generateQRCode(u),x=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);return x.toISOString(),u.substring(0,60),{downloadUrl:u,qrCodeData:g,expiresAt:x.toISOString(),tokenId:r,filename:e.filename}}catch(a){throw c.error("âŒ [TemporaryLinkService] Failed to generate temporary link:",a),new Error(`Failed to generate temporary link: ${a instanceof Error?a.message:"Unknown error"}`)}}static async validateTemporaryToken(e){return!0}static async revokeTemporaryToken(e){return!0}static generateTokenId(){return`tmp_${Date.now()}_${Math.random().toString(36).substr(2,12)}`}static async blobToBase64(e){return new Promise((a,r)=>{const s=new FileReader;s.onload=()=>{const e=s.result;a(e.split(",")[1])},s.onerror=r,s.readAsDataURL(e)})}static async generateQRCode(e){try{const a=`${"https://api.qrserver.com/v1/create-qr-code/"}?${new URLSearchParams({size:"300x300",data:e,format:"png",ecc:"M",margin:"10"}).toString()}`,r=await fetch(a);if(!r.ok)throw new Error("QR code generation failed");const s=await r.blob();return new Promise((e,a)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=a,r.readAsDataURL(s)})}catch(a){return c.error("âŒ QR Code generation failed:",a),`data:text/plain;base64,${btoa(e)}`}}static formatExpiryTime(e){const a=new Date(e),r=new Date,s=a.getTime()-r.getTime();if(s<=0)return"Expired";const t=Math.floor(s/6e4),o=Math.floor(t/60),i=t%60;return o>0?`${o}h ${i}m remaining`:`${i}m remaining`}static isExpired(e){return new Date(e).getTime()<=Date.now()}static async trackTemporaryFile(e){try{await j(N(u,"temporaryFiles"),{tokenId:e.tokenId,storagePath:e.storagePath,downloadUrl:e.downloadUrl,filename:e.filename,fileType:"pdf",organizationId:e.organizationId||"",employeeId:e.employeeId||"",warningId:e.warningId||"",uploadedBy:e.uploadedBy,expiresAt:e.expiresAt,createdAt:C(),isExpired:!1,fileSize:0}),c.success(10578)}catch(a){c.error("âŒ [TemporaryLinkService] Failed to track temporary file:",a)}}}const Ee=({isOpen:e,onClose:s,pdfBlob:t,filename:i,employeeId:n,warningId:l,organizationId:d,employeeName:m,onLinkGenerated:u})=>{xe(e);const[g,x]=y.useState(!1),[p,w]=y.useState(null),[f,k]=y.useState(null),[j,N]=y.useState({hours:0,minutes:0,seconds:0,expired:!1}),[C,S]=y.useState(!1),z=v.useRef(!1),R=y.useCallback(async()=>{if(t&&(t.size/1024).toFixed(1),t)try{x(!0),k(null);const e=await Te.generateTemporaryLink({pdfBlob:t,filename:i,employeeId:n,warningId:l,organizationId:d});c.success(2764),w(e),u?.(e)}catch(e){c.error("âŒ QR link generation failed:",e),k(e.message||"Failed to generate QR code")}finally{x(!1)}else c.error("âŒ [QRCodeDownloadModal] No PDF blob provided")},[t,i,n,l,d,u]);y.useEffect(()=>{if(!p?.expiresAt)return;const e=()=>{const e=(new Date).getTime(),a=new Date(p.expiresAt).getTime()-e;if(a<=0)return void N({hours:0,minutes:0,seconds:0,expired:!0});const r=Math.floor(a/36e5),s=Math.floor(a%36e5/6e4),t=Math.floor(a%6e4/1e3);N({hours:r,minutes:s,seconds:t,expired:!1})};e();const a=setInterval(e,1e3);return()=>clearInterval(a)},[p?.expiresAt]);const D=y.useCallback(async()=>{if(p?.downloadUrl)try{await navigator.clipboard.writeText(p.downloadUrl),S(!0),setTimeout(()=>S(!1),2e3)}catch(e){c.error("âŒ Failed to copy link:",e)}},[p?.downloadUrl]);return y.useEffect(()=>{!e||!t||p||g||z.current||(z.current=!0,R())},[e,t,p,g,R]),y.useEffect(()=>{e||(w(null),k(null),N({hours:0,minutes:0,seconds:0,expired:!1}),S(!1),z.current=!1)},[e]),e?b.createPortal(a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:1e4},children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"bg-white border-b px-6 py-4 flex items-center justify-between flex-shrink-0",style:{borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:a.jsx(X,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Mobile Download"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Scan to download on your phone"})]})]}),a.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:a.jsx($,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[a.jsx(o,{padding:"md",className:"border",style:{borderColor:"var(--color-border)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:a.jsx(K,{className:"w-5 h-5",style:{color:"var(--color-success)"}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-sm truncate",style:{color:"var(--color-text)"},children:i}),m&&a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["For: ",m]}),a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Size: ",(t.size/1024).toFixed(1)," KB"]})]})]})}),g&&a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto mb-4",style:{borderWidth:"2px",borderColor:"transparent",borderTopColor:"var(--color-primary)"}}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:"Generating secure download link..."}),a.jsx("p",{className:"text-xs mt-2",style:{color:"var(--color-text-secondary)"},children:"This may take a moment"})]}),f&&a.jsxs(h,{variant:"error",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(_,{className:"w-5 h-5 flex-shrink-0"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-sm",children:"Generation Failed"}),a.jsx("p",{className:"text-xs mt-1",children:f})]})]}),a.jsx(r,{variant:"danger",size:"sm",onClick:R,disabled:g,className:"mt-3",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Z,{className:"w-4 h-4"}),a.jsx("span",{children:"Try Again"})]})})]}),p&&!j.expired&&a.jsxs("div",{className:"space-y-4",children:[a.jsx(h,{variant:"warning",className:"border-l-4",style:{borderLeftColor:"var(--color-warning)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(J,{className:"w-5 h-5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",children:"Time-Limited Access"}),a.jsxs("p",{className:"text-xs mt-1",children:["Link expires in: ",j.hours>0&&`${j.hours}h `,j.minutes,"m ",j.seconds,"s"]})]})]})}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"bg-white p-6 rounded-lg border-2 inline-block",style:{borderColor:"var(--color-border)"},children:a.jsx("img",{src:p.qrCodeData,alt:"Download QR Code",className:"w-64 h-64 mx-auto",style:{imageRendering:"pixelated"}})}),a.jsxs("div",{className:"mt-4",children:[a.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[a.jsx(ee,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:"Point your camera at the QR code"})]}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"No app needed - works with built-in camera on iOS & Android"})]})]}),a.jsx("div",{className:"space-y-3",children:a.jsx(r,{variant:C?"success":"secondary",size:"md",fullWidth:!0,onClick:D,children:a.jsx("div",{className:"flex items-center justify-center gap-2",children:C?a.jsxs(a.Fragment,{children:[a.jsx(I,{className:"w-5 h-5"}),a.jsx("span",{children:"Link Copied!"})]}):a.jsxs(a.Fragment,{children:[a.jsx(ae,{className:"w-5 h-5"}),a.jsx("span",{children:"Copy Download Link"})]})})})}),a.jsx(h,{variant:"info",className:"border-l-4",style:{borderLeftColor:"var(--color-info)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(M,{className:"w-5 h-5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-sm",children:"Security Features"}),a.jsxs("ul",{className:"text-xs mt-1 space-y-1",children:[a.jsx("li",{children:"â€¢ Link expires automatically in 1 hour"}),a.jsx("li",{children:"â€¢ Single-use download link"}),a.jsx("li",{children:"â€¢ Encrypted token authentication"}),a.jsx("li",{children:"â€¢ No app needed - works with any camera"})]})]})]})})]}),p&&j.expired&&a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:"var(--color-error-light)"},children:a.jsx(A,{className:"w-8 h-8",style:{color:"var(--color-error)"}})}),a.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text)"},children:"Link Expired"}),a.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"The download link has expired for security reasons."}),a.jsx(r,{variant:"primary",size:"md",onClick:R,disabled:g,children:"Generate New Link"})]})]})]})}),document.body):null},Le="audio/webm;codecs=opus",$e=24e3,Pe=16e3,Ae=1,Me=3e5,We=1048576,Fe=24e4,qe=!0,_e=!0,Ue=!0;class Be{constructor(){this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.allActiveStreams=new Set,this.allActiveTracks=new Set}static{this.instance=null}static getInstance(){return Be.instance||(Be.instance=new Be),Be.instance}canStart(){const e=Date.now();return!this.isRecording&&!this.isStarting&&(!(this.startedAt>0&&e-this.startedAt<1e3)&&(!(this.allActiveStreams.size>0||this.allActiveTracks.size>0)||(this.allActiveStreams.size,this.allActiveTracks.size,!1)))}tryReserve(){return!!this.canStart()&&(this.isStarting=!0,this.startedAt=Date.now(),!0)}startRecording(){this.isRecording=!0}stopRecording(){this.isRecording=!1,this.isStarting=!1,this.startedAt=0,this.mediaStream&&(this.mediaStream.getTracks().forEach(e=>{try{e.stop()}catch(a){}}),this.allActiveStreams.delete(this.mediaStream),this.mediaStream=null)}setStream(e){return this.mediaStream||this.allActiveStreams.size>0?(this.allActiveStreams.size,e.getTracks().forEach(e=>e.stop()),!1):(this.allActiveStreams.add(e),e.getTracks().forEach(e=>{this.allActiveTracks.add(e),e.addEventListener("ended",()=>{this.allActiveTracks.delete(e)})}),this.mediaStream=e,this.isStarting=!1,this.allActiveStreams.size,!0)}stopAllStreams(){this.allActiveStreams.size,this.allActiveTracks.size,this.allActiveStreams.forEach(e=>{e.getTracks().forEach(e=>{try{e.stop()}catch(a){}})}),this.allActiveTracks.forEach(e=>{try{"live"===e.readyState&&e.stop()}catch(a){}}),this.allActiveStreams.clear(),this.allActiveTracks.clear(),this.mediaStream=null,this.isRecording=!1,this.isStarting=!1,this.startedAt=0}}const He=Be.getInstance(),Oe=v.memo(({size:e="medium",color:r="#3b82f6"})=>{const s={small:"1.5rem",medium:"3rem",large:"5rem"};return a.jsx("div",{style:{width:s[e],height:s[e],border:"4px solid #e2e8f0",borderTop:`4px solid ${r}`,borderRadius:"50%",animation:"spin 1s linear infinite"}})});Oe.displayName="LoadingSpinner";v.memo(()=>a.jsxs("div",{className:"hr-card skeleton-card",children:[a.jsx("div",{className:"skeleton-header"}),a.jsxs("div",{className:"skeleton-content",children:[a.jsx("div",{className:"skeleton-line",style:{width:"100%"}}),a.jsx("div",{className:"skeleton-line",style:{width:"80%"}}),a.jsx("div",{className:"skeleton-line",style:{width:"60%"}})]})]})).displayName="CardSkeleton";v.memo(()=>a.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(240px, 1fr))",gap:"1rem"},children:[1,2,3,4,5,6].map(e=>a.jsxs("div",{className:"hr-card skeleton-card",style:{padding:"1.5rem"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{className:"skeleton-line",style:{width:"60%",marginBottom:"0.5rem"}}),a.jsx("div",{className:"skeleton-line",style:{width:"40%",height:"2rem"}})]}),a.jsx("div",{className:"skeleton-circle",style:{width:"3rem",height:"3rem"}})]}),a.jsx("div",{className:"skeleton-line",style:{width:"50%"}})]},e))})).displayName="StatsSkeleton";if("undefined"!=typeof document){const e=document.createElement("style");e.innerHTML="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n\n  @keyframes shimmer {\n    0% { background-position: -1000px 0; }\n    100% { background-position: 1000px 0; }\n  }\n\n  .skeleton-card {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .skeleton-line {\n    height: 1rem;\n    margin-bottom: 0.5rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n  }\n\n  .skeleton-header {\n    height: 1.5rem;\n    margin-bottom: 1rem;\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 0.25rem;\n    width: 40%;\n  }\n\n  .skeleton-circle {\n    background: linear-gradient(\n      90deg,\n      #f1f5f9 0px,\n      #e2e8f0 40px,\n      #f1f5f9 80px\n    );\n    background-size: 1000px;\n    animation: shimmer 2s infinite linear;\n    border-radius: 50%;\n  }\n\n  .skeleton-content {\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n",document.head.appendChild(e)}const Ge={isRequesting:!1,isGranted:!1,callbacks:[],errorCallbacks:[]},Qe=({onPermissionGranted:e,onPermissionDenied:r,organizationName:s,managerName:t})=>{const[o,i]=y.useState("requesting"),[n,l]=y.useState("");y.useRef(Math.random().toString(36).substr(2,9)),y.useEffect(()=>(Ge.callbacks.push(e),Ge.errorCallbacks.push(r),Ge.isGranted?(i("granted"),void setTimeout(e,100)):(Ge.isRequesting||(Ge.isRequesting=!0,d()),()=>{const a=Ge.callbacks.indexOf(e);a>-1&&Ge.callbacks.splice(a,1);const s=Ge.errorCallbacks.indexOf(r);s>-1&&Ge.errorCallbacks.splice(s,1)})),[]);const d=async()=>{try{if(i("requesting"),l(""),!navigator.mediaDevices?.getUserMedia)return i("not-supported"),void l("Audio recording is not supported in this browser. Please use a modern browser like Chrome, Firefox, or Safari.");try{if(navigator.permissions&&navigator.permissions.query){if("denied"===(await navigator.permissions.query({name:"microphone"})).state)return c.warn("âš ï¸ Microphone permission is permanently blocked"),i("denied"),void l("Microphone access is blocked in your browser settings. Click the lock icon in the address bar to allow access.")}}catch(e){}(await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:8e3,echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})).getTracks().forEach(e=>e.stop()),i("granted"),Ge.isGranted||(Ge.isGranted=!0,Ge.isRequesting=!1,Ge.callbacks.forEach(e=>{setTimeout(e,1e3)}))}catch(a){c.error("Microphone permission error:",a),Ge.isRequesting=!1,"NotAllowedError"===a.name?(i("denied"),l("Microphone access was denied. Click the lock/info icon in your browser's address bar, then allow microphone access and refresh this page.")):"NotFoundError"===a.name?(i("error"),l("No microphone was found on your device. Please connect a microphone and try again.")):"NotReadableError"===a.name?(i("error"),l("Your microphone is being used by another application. Please close other apps and try again.")):(i("error"),l("An error occurred while accessing your microphone. Please check your browser settings.")),Ge.errorCallbacks.forEach(e=>{e()})}},m=(()=>{switch(o){case"requesting":return{title:"Checking microphone access...",message:"Please allow microphone access when prompted."};case"granted":return{title:"Loading...",message:"Starting warning wizard..."};case"denied":return{title:"Microphone Access Required",message:"You need to approve microphone access to continue with the warning process."};case"error":return{title:"Microphone Error",message:n};case"not-supported":return{title:"Browser Not Supported",message:n};default:return{title:"Setting up audio...",message:"Preparing audio recording system."}}})();return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:a.jsxs("div",{className:"max-w-sm w-full",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-4 text-center",children:[a.jsxs("div",{className:"mb-4",children:[a.jsx("div",{className:"flex items-center justify-center mx-auto mb-3",style:{height:"48px"},children:(()=>{switch(o){case"requesting":return a.jsx(Oe,{size:"medium",color:"#3b82f6"});case"granted":return a.jsx(Oe,{size:"medium",color:"#16a34a"});case"denied":return a.jsx(te,{className:"w-6 h-6 text-red-600"});case"error":return a.jsx(oe,{className:"w-6 h-6 text-red-600"});case"not-supported":return a.jsx(te,{className:"w-6 h-6 text-gray-600"});default:return a.jsx(se,{className:"w-6 h-6 text-gray-600"})}})()}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:m.title}),a.jsx("p",{className:"text-sm text-gray-600",children:m.message})]}),("denied"===o||"error"===o)&&a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3 text-left",children:a.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[a.jsx(re,{className:"w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0"}),a.jsxs("div",{className:"text-xs text-blue-900",children:[a.jsx("p",{className:"font-semibold mb-1",children:"To enable microphone:"}),a.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-blue-800",children:[a.jsxs("li",{children:["Click the ",a.jsx("strong",{children:"lock icon"})," or ",a.jsx("strong",{children:"site settings"})," in your browser's address bar"]}),a.jsxs("li",{children:["Find ",a.jsx("strong",{children:"Microphone"})," settings"]}),a.jsxs("li",{children:["Change to ",a.jsx("strong",{children:"Allow"})]}),a.jsx("li",{children:"Refresh this page or click Try Again below"})]})]})]})}),a.jsx("button",{onClick:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm font-medium",children:"Try Again"})]})]}),a.jsx("div",{className:"mt-3 text-center text-xs text-gray-400",children:a.jsx("p",{children:s})})]})})},Ye=[{title:"Employee Selection",icon:E,guidance:"Who is involved in this incident?"},{title:"Category & Recommendation",icon:ie,guidance:"Classify the misconduct and review the system recommendation"},{title:"Incident Details",icon:U,guidance:"Document the facts: when, where, and what happened"},{title:"Employee's Response",icon:ne,guidance:"What did the employee say when you discussed the incident?"},{title:"Expected Standards",icon:le,guidance:"What behavior, performance, or conduct is expected?"},{title:"Improvement Plan",icon:q,guidance:"Record specific commitments with timelines and set follow-up"},{title:"Review Documentation",icon:I,guidance:"Review all information before proceeding to signatures"},{title:"Script & PDF Review",icon:ce,guidance:"Read the warning script aloud, then review the PDF together"},{title:"Signatures",icon:O,guidance:"Collect signatures to finalize and save the warning"},{title:"Delivery",icon:de,guidance:"Select how the warning will be delivered to the employee"}],Ve=10,Xe=()=>{const e=new Date;return new Intl.DateTimeFormat("en-ZA",{timeZone:"Africa/Johannesburg",hour:"2-digit",minute:"2-digit",hour12:!1}).format(e)},Ke=()=>{const e=new Date;return new Intl.DateTimeFormat("en-CA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit"}).format(e)},Ze=e=>({counselling:{label:"Counselling",color:"#0ea5e9",requiresCommitments:!0},verbal:{label:"Verbal",color:"#f59e0b",requiresCommitments:!0},first_written:{label:"Written",color:"#f97316",requiresCommitments:!0},second_written:{label:"Second Written",color:"#f97316",requiresCommitments:!0},final_written:{label:"Final Written",color:"#ef4444",requiresCommitments:!1},suspension:{label:"Suspension",color:"#dc2626",requiresCommitments:!1},dismissal:{label:"Ending of Service",color:"#991b1b",requiresCommitments:!1}}[e]||{label:e,color:"#6b7280",requiresCommitments:!0}),Je=({employees:s,categories:t,currentManagerName:i,organizationName:n,onComplete:l,onCancel:d,preSelectedEmployeeId:v,preSelectedCategoryId:b,isFullScreen:j})=>{const{user:N}=g(),{organization:C}=x(),R=(()=>{const[e,a]=y.useState({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null}),r=y.useRef(null),s=y.useRef([]),t=y.useRef(null),o=y.useRef(0),i=y.useRef(null),n=y.useRef(!1),l=y.useRef(!1),d=y.useCallback(e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,[]),u=y.useCallback(e=>e<1024?`${e}B`:e<1048576?`${(e/1024).toFixed(1)}KB`:`${(e/1048576).toFixed(1)}MB`,[]),h=y.useCallback(()=>`audio_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,[]),g=y.useCallback(()=>{if(!o.current)return;const e=(Date.now()-o.current)/1e3,s=Date.now()-o.current;if(a(a=>a.isRecording?{...a,duration:e}:(i.current&&(clearInterval(i.current),i.current=null),a)),s>=Me)return i.current&&(clearInterval(i.current),i.current=null),void setTimeout(()=>{r.current&&"recording"===r.current.state&&r.current.stop()},0);s>=Fe&&!n.current&&(n.current=!0)},[]),x=y.useCallback(()=>{try{if(r.current){try{"recording"===r.current.state&&r.current.stop()}catch(e){}r.current=null}[t.current,He.mediaStream].filter(Boolean).forEach(a=>{a&&a.getTracks().forEach(a=>{try{a.stop()}catch(e){}})}),t.current=null,He.stopAllStreams(),i.current&&(clearInterval(i.current),i.current=null),s.current=[],n.current=!1,o.current=0,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(e){c.error("âŒ Error during force cleanup:",e)}},[]),p=y.useCallback(async()=>{if(He.tryReserve())try{if(l.current=!1,(t.current||r.current||He.mediaStream)&&(x(),await new Promise(e=>setTimeout(e,100))),a(e=>({...e,isProcessing:!0,error:null})),!navigator.mediaDevices?.getUserMedia)throw new Error("Audio recording not supported in this browser");const e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:Ae,sampleRate:Pe,echoCancellation:qe,noiseSuppression:_e,autoGainControl:Ue}});if(!He.setStream(e))return void a(e=>({...e,isProcessing:!1,error:"Another recording is already active"}));t.current=e,s.current=[];const d=new MediaRecorder(e,{mimeType:Le,audioBitsPerSecond:$e});r.current=d,d.ondataavailable=e=>{if(!l.current&&e.data.size>0){s.current.push(e.data);const o=s.current.reduce((e,a)=>e+a.size,0);if(a(e=>({...e,size:o})),o>=We&&"recording"===r.current?.state){u(o),l.current=!0;try{r.current.stop()}catch(t){c.error("âŒ Error stopping MediaRecorder:",t)}}}},d.onstop=()=>{t.current&&(t.current.getTracks().forEach(e=>e.stop()),t.current=null)},d.start(1e3),o.current=Date.now(),n.current=!1,He.startRecording(),i.current=setInterval(g,100);const m=h();a(e=>({...e,isRecording:!0,isProcessing:!1,recordingId:m,duration:0,size:0}))}catch(e){c.error("âŒ Error starting recording:",e),He.stopRecording(),a(a=>({...a,isRecording:!1,isProcessing:!1,error:e.message||"Failed to start recording"}))}},[g,h]),v=y.useCallback(async()=>{try{return r.current&&e.isRecording?(a(e=>({...e,isProcessing:!0})),i.current&&(clearInterval(i.current),i.current=null),new Promise(e=>{const t=r.current;t.onstop=()=>{try{const r=new Blob(s.current,{type:Le}),t=URL.createObjectURL(r);a(e=>({...e,isRecording:!1,isProcessing:!1,audioUrl:t,size:r.size})),u(r.size),l.current=!1,e(t)}catch(r){c.error("âŒ Error processing recording:",r),a(e=>({...e,isRecording:!1,isProcessing:!1,error:"Failed to process recording"})),l.current=!1,e(null)}},t.stop(),a(e=>({...e,isRecording:!1}))})):(l.current=!1,null)}catch(t){return c.error("âŒ Error stopping recording:",t),a(e=>({...e,isRecording:!1,isProcessing:!1,error:t.message||"Failed to stop recording"})),l.current=!1,null}},[e.isRecording,u]),b=y.useCallback(()=>{r.current&&e.isRecording&&(r.current.pause(),i.current&&(clearInterval(i.current),i.current=null))},[e.isRecording]),j=y.useCallback(()=>{r.current&&e.isRecording&&(r.current.resume(),o.current=Date.now()-1e3*e.duration,i.current=setInterval(g,100))},[e.isRecording,e.duration,g]),N=y.useCallback(()=>{try{r.current&&r.current.stop(),t.current&&(t.current.getTracks().forEach(e=>e.stop()),t.current=null),i.current&&(clearInterval(i.current),i.current=null),e.audioUrl&&URL.revokeObjectURL(e.audioUrl),s.current=[],n.current=!1,a({isRecording:!1,isProcessing:!1,duration:0,size:0,error:null,audioUrl:null,recordingId:null})}catch(o){c.error("âŒ Error cancelling recording:",o)}},[e.audioUrl]),C=y.useCallback(async(r,s)=>{try{if(!e.audioUrl||!e.recordingId)throw new Error("No recording available to upload");a(e=>({...e,isProcessing:!0}));const t=await fetch(e.audioUrl),o=await t.blob(),i=`warnings/${r}/${s}/audio/${e.recordingId}.webm`,n=w(m,i),l={contentType:Le,customMetadata:{warningId:s,organizationId:r,duration:e.duration.toString(),size:e.size.toString(),recordingId:e.recordingId,createdAt:(new Date).toISOString()}};await f(n,o,l);const d=await k(n);return a(e=>({...e,isProcessing:!1})),c.success(13735),d}catch(t){return c.error("âŒ Error uploading audio:",t),a(e=>({...e,isProcessing:!1,error:t.message||"Failed to upload audio"})),null}},[e.audioUrl,e.recordingId,e.duration,e.size]),S=y.useCallback(async(r,s,t,o)=>{try{if(!r||!s)throw new Error("No recording data provided for upload");a(e=>({...e,isProcessing:!0}));const i=await fetch(r),n=await i.blob(),l=w(m,`warnings/${t}/${o}/audio/${s}.webm`),d={contentType:Le,customMetadata:{warningId:o,organizationId:t,duration:e.duration.toString(),size:n.size.toString(),recordingId:s,createdAt:(new Date).toISOString()}};await f(l,n,d);const u=await k(l);return a(e=>({...e,isProcessing:!1})),c.success(15712),u}catch(i){return c.error("âŒ Error uploading audio from URL:",i),a(e=>({...e,isProcessing:!1,error:i.message||"Failed to upload audio"})),null}},[e.duration]);y.useEffect(()=>()=>{if(i.current&&(clearInterval(i.current),i.current=null),t.current&&(t.current.getTracks().forEach(e=>{e.stop()}),t.current=null),r.current){try{"recording"===r.current.state&&r.current.stop()}catch(e){}r.current=null}s.current=[],n.current=!1,o.current=0,He.stopAllStreams()},[]);const z=e.duration>=Fe/1e3,R=!e.isRecording&&!e.isProcessing;return{...e,startRecording:p,stopRecording:v,pauseRecording:b,resumeRecording:j,cancelRecording:N,forceCleanup:x,uploadToFirebase:C,uploadToFirebaseFromUrl:S,formatDuration:d,formatSize:u,isNearLimit:z,canRecord:R}})(),D=C?.customization?.enableAudioRecording??!0,E=e=>e.trim().split(/\s+/).filter(e=>e).length;y.useRef(null);const L=y.useRef(null),P=y.useRef(0),A=ue({isActive:!0,onEscape:d,autoFocus:!0,returnFocus:!0}),[M,W]=y.useState(0),[q,U]=y.useState(new Set),[B,H]=y.useState(!1),[O,G]=y.useState("next"),[Q,Y]=y.useState(!1),[V,X]=y.useState(!1),[K,Z]=y.useState(()=>({employeeId:v||"",categoryId:b||"",incidentDate:Ke(),incidentTime:Xe(),incidentLocation:"",incidentDescription:"",level:"counselling",issueDate:Ke(),validityPeriod:6})),[J,ee]=y.useState(),[ae,re]=y.useState(),[se,te]=y.useState(null),[oe,ie]=y.useState(!1),[ne,le]=y.useState(null),[ce,de]=y.useState([]),[ge,xe]=y.useState(!1),[ke,ze]=y.useState(""),[Re,De]=y.useState(""),[Te,Be]=y.useState([]),[Oe,Ge]=y.useState(""),[Je,sa]=y.useState(""),[ta,oa]=y.useState([]),[ia,na]=y.useState({manager:null,employee:null,witness:null,managerName:i}),[la,ca]=y.useState("employee"),[da,ma]=y.useState(!1),[ua,ha]=y.useState(null),[ga,xa]=y.useState(!1),[pa,ya]=y.useState(!1),[va,ba]=y.useState(""),[wa,fa]=y.useState(""),[ka,ja]=y.useState(""),[Na,Ca]=y.useState(!1),[Sa,za]=y.useState(!1),[Ra,Da]=y.useState(!0),[Ia,Ta]=y.useState(!1),[Ea,La]=y.useState(!1),[$a,Pa]=y.useState(!1),[Aa,Ma]=y.useState(null),[Wa,Fa]=y.useState(!1),[qa,_a]=y.useState(null),Ua=y.useMemo(()=>ne||se?.suggestedLevel||"counselling",[ne,se]),Ba=y.useMemo(()=>Ze(Ua),[Ua]),Ha=y.useMemo(()=>{if(!J)return"";return`${J.profile?.firstName||J.firstName||""} ${J.profile?.lastName||J.lastName||""}`.trim()},[J]),Oa=y.useMemo(()=>{switch(M){case 0:return!!K.employeeId;case 2:{const e=(K.incidentDescription||"").trim().split(/\s+/).filter(e=>e.length>0);return!!(K.incidentDate&&K.incidentTime&&K.incidentLocation?.length>=3&&e.length>=6)}case 1:return!(!K.categoryId||oe||ge);case 3:return!Ba.requiresCommitments||E(ke)>=6;case 4:return E(Re)>=6;case 5:return!Ba.requiresCommitments||!!(Te.length>0&&Oe&&K.issueDate);case 6:return!0;case 7:return pa&&ga;case 8:return!!(ia.manager&&da&&(ia.employee||ia.witness)&&J&&ae&&C?.id);case 9:return!!wa;default:return!1}},[M,K,se,oe,ge,Ba,ke,Re,Te,Oe,pa,ga,ia,wa,da,J,ae,C?.id]);y.useEffect(()=>{const e=()=>{X(window.innerWidth<640)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),y.useEffect(()=>{if(M!==P.current){G(M>P.current?"next":"prev"),H(!0),"vibrate"in navigator&&V&&navigator.vibrate(10);const e=setTimeout(()=>{H(!1)},300);return P.current=M,()=>clearTimeout(e)}},[M,V]),y.useEffect(()=>{if(K.employeeId){const e=s.find(e=>e.id===K.employeeId);ee(e),e&&C?.id&&p.warnings.getActiveWarnings(e.id,C.id).then(e=>de(e)).catch(e=>c.error("Failed to load warning history:",e))}},[K.employeeId,s,C?.id]),y.useEffect(()=>{if(K.categoryId){const e=t.find(e=>e.id===K.categoryId);re(e)}},[K.categoryId,t]),y.useEffect(()=>{K.employeeId&&K.categoryId&&C?.id&&!se&&!oe&&Ga()},[K.employeeId,K.categoryId,C?.id]),y.useEffect(()=>{D&&(!Ia||R.isRecording||Ra||R.startRecording().catch(e=>{c.error("Failed to start audio recording:",e)}))},[D,Ia,Ra,R.isRecording,R.startRecording]);const Ga=async()=>{if(!K.employeeId||!K.categoryId||!C?.id)return;ie(!0);const e=Date.now(),a=800;try{const r=ce.length>0?ce:await p.warnings.getActiveWarnings(K.employeeId,C.id);if(r.some(e=>("final_written"===e.level||"Final Written Warning"===e.level||"final_written"===e.suggestedLevel)&&e.categoryId===K.categoryId)){xe(!0);const r=Date.now()-e;return r<a&&await new Promise(e=>setTimeout(e,a-r)),void ie(!1)}const s=t.find(e=>e.id===K.categoryId)||ae,o=await p.warnings.getEscalationRecommendation(K.employeeId,K.categoryId,C.id,s,r),i=Date.now()-e;i<a&&await new Promise(e=>setTimeout(e,a-i)),te(o),Z(e=>({...e,level:o.suggestedLevel}))}catch(r){c.error("Failed to generate LRA recommendation:",r);const e=t.find(e=>e.id===K.categoryId)||ae,a=e?.escalationPath||["counselling","verbal_warning","first_written","final_written"],s={suggestedLevel:a[0]||"counselling",recommendedLevel:"counselling"===a[0]?"Counselling Session":"verbal_warning"===a[0]?"Verbal Warning":"Counselling Session",reason:"Unable to analyze history - using default first step.",activeWarnings:[],escalationPath:a,isEscalation:!1,category:e?.name||"General Misconduct",categoryId:K.categoryId,warningCount:0};te(s),Z(e=>({...e,level:s.suggestedLevel}))}finally{ie(!1)}},Qa=y.useCallback(()=>{M>0&&W(M-1)},[M]),Ya=y.useCallback(()=>{Oa&&M<9&&(U(e=>new Set([...e,M])),W(M+1))},[M,Oa]),Va=y.useCallback(e=>{(e<=M||q.has(e))&&W(e)},[M,q]),Xa=function(e={}){const{onSwipeLeft:a,onSwipeRight:r,threshold:s=50,maxTime:t=300,enabled:o=!0,allowLeft:i=!0,allowRight:n=!0}=e,l=y.useRef(null),c=y.useRef({startX:0,startY:0,startTime:0,isTracking:!1}),d=y.useCallback(e=>{if(!o)return;const a=e.touches[0];c.current={startX:a.clientX,startY:a.clientY,startTime:Date.now(),isTracking:!0}},[o]),m=y.useCallback(e=>{if(!o||!c.current.isTracking)return;const a=e.touches[0],r=a.clientX-c.current.startX,s=a.clientY-c.current.startY;Math.abs(s)>1.5*Math.abs(r)&&(c.current.isTracking=!1)},[o]),u=y.useCallback(e=>{if(!o||!c.current.isTracking)return;const l=e.changedTouches[0],d=l.clientX-c.current.startX,m=l.clientY-c.current.startY,u=Date.now()-c.current.startTime;c.current.isTracking=!1,Math.abs(d)>=s&&Math.abs(d)>1.5*Math.abs(m)&&u<=t&&(d<0&&i&&a?a():d>0&&n&&r&&r())},[o,s,t,i,n,a,r]);return y.useEffect(()=>{const e=l.current;if(e&&o)return e.addEventListener("touchstart",d,{passive:!0}),e.addEventListener("touchmove",m,{passive:!0}),e.addEventListener("touchend",u,{passive:!0}),()=>{e.removeEventListener("touchstart",d),e.removeEventListener("touchmove",m),e.removeEventListener("touchend",u)}},[o,d,m,u]),l}({onSwipeLeft:()=>{Oa&&M<9&&Ya()},onSwipeRight:()=>{M>0&&Qa()},enabled:V,allowLeft:Oa&&M<9,allowRight:M>0}),Ka=y.useCallback(()=>{Y(!1),l()},[l]),Za=y.useCallback(e=>{na(a=>({...a,manager:e}))},[]),Ja=y.useCallback(e=>Promise.resolve(pe(e)),[]),er=y.useCallback(e=>{na(a=>({...a,employee:e,witness:null}))},[]),ar=y.useCallback(async e=>{if(e)try{const a=await Ja(e);na(e=>({...e,witness:a,employee:null}))}catch(a){c.error("Failed to apply witness watermark:",a),na(a=>({...a,witness:e,employee:null}))}else na(e=>({...e,witness:null}))},[Ja]),rr=y.useCallback(()=>{R.isRecording&&R.forceCleanup(),d()},[R,d]),sr=Ye[M];return D&&Ra&&!Ia?a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9000] flex items-center justify-center p-4",children:a.jsx("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-md",children:a.jsx(Qe,{onPermissionGranted:()=>{Ta(!0),Da(!1)},onPermissionDenied:()=>Da(!1),onSkip:()=>Da(!1)})})}):a.jsxs(a.Fragment,{children:[a.jsx(je,{isVisible:Q,message:"Warning Issued Successfully!",subMessage:`${Ha} has been notified via ${wa}`,onComplete:Ka,duration:3e3,showConfetti:!0}),a.jsxs("div",{ref:A,className:`\n          fixed inset-0 bg-black/50 backdrop-blur-sm z-[9000]\n          flex items-center justify-center\n          ${V?"p-0":"p-4"}\n        `,role:"dialog","aria-modal":"true","aria-labelledby":"wizard-title","aria-describedby":"wizard-guidance",children:[a.jsxs("div",{ref:Xa,className:`\n            bg-white shadow-2xl w-full\n            ${V?"h-full rounded-none wizard-mobile-enter":"max-w-2xl max-h-[90vh] rounded-xl"}\n            overflow-hidden flex flex-col\n          `,children:[a.jsxs("div",{className:"flex-shrink-0 px-4 pt-3 pb-3 border-b",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("h2",{id:"wizard-title",className:"text-base font-semibold",style:{color:"var(--color-text-primary)"},children:"Issue Warning"}),D&&R.isRecording&&a.jsxs("div",{className:"flex items-center gap-2 px-2.5 py-1 rounded-full wizard-recording-indicator",style:{backgroundColor:"rgba(239, 68, 68, 0.08)"},role:"status","aria-live":"polite",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 wizard-recording-dot"}),a.jsx("span",{className:"text-xs font-medium tabular-nums",style:{color:"#dc2626"},children:R.formatDuration(R.duration)})]})]}),a.jsx("button",{onClick:rr,className:"wizard-touch-target p-2 -mr-2 rounded-lg hover:bg-gray-100 transition-colors wizard-button-tap","aria-label":"Close wizard",children:a.jsx($,{className:"w-5 h-5 text-gray-400 hover:text-gray-600"})})]}),a.jsx("div",{className:"mt-3",children:a.jsx(ve,{currentPhase:M,totalPhases:Ve,completedPhases:q,onPhaseClick:Va})})]}),a.jsx("div",{ref:L,className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"enhanced-warning-wizard-container p-4",children:a.jsxs(o,{padding:"md",children:[a.jsx(be,{title:sr.title,icon:sr.icon,phaseNumber:M+1,totalPhases:Ve,employeeName:M>0?Ha:void 0,incidentDate:M>1?K.incidentDate:void 0}),a.jsx(we,{children:a.jsx("span",{id:"wizard-guidance",children:sr.guidance})}),a.jsx("div",{className:`\n                    ${B?"next"===O?"wizard-phase-enter-next":"wizard-phase-enter-prev":""}\n                  `,children:(()=>{switch(M){case 0:return a.jsx("div",{className:"space-y-4",children:a.jsx(Ne,{employees:s,selectedEmployeeId:K.employeeId,onEmployeeSelect:e=>Z(a=>({...a,employeeId:e})),warningHistory:ce})});case 2:return a.jsx(Se,{formData:K,onFormDataChange:e=>Z(a=>({...a,...e}))});case 1:return a.jsxs("div",{className:"space-y-4",children:[a.jsx(Ce,{categories:t,selectedCategoryId:K.categoryId,onCategorySelect:e=>{te(null),xe(!1);const a=t.find(a=>a.id===e);re(a),Z(a=>({...a,categoryId:e}))},lraRecommendation:se}),(oe||!se&&K.categoryId)&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 px-4",children:[a.jsx("div",{className:"w-10 h-10 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"}),a.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Analyzing warning history..."}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Please wait"})]}),se&&a.jsx(o,{padding:"md",className:"border-l-4",style:{borderLeftColor:"var(--color-primary)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(F,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"var(--color-primary)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h4",{className:"font-semibold mb-1",style:{color:"var(--color-text-primary)"},children:["Recommended: ",se.recommendedLevel||Ze(se.suggestedLevel).label]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:se.reason}),se.activeWarnings&&se.activeWarnings.length>0&&a.jsxs("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("p",{className:"text-xs font-medium mb-2",style:{color:"var(--color-text-secondary)"},children:["Active Warnings (",se.activeWarnings.length,"):"]}),a.jsxs("div",{className:"space-y-1.5",children:[se.activeWarnings.slice(0,3).map((e,r)=>a.jsxs("button",{onClick:()=>_a(e),className:"group w-full text-left text-xs flex items-center gap-2 p-2 rounded-lg border transition-all duration-150 cursor-pointer hover:shadow-sm active:scale-[0.98]",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",color:"var(--color-text-secondary)"},onMouseEnter:e=>{e.currentTarget.style.borderColor="var(--color-primary)",e.currentTarget.style.backgroundColor="var(--color-primary-bg)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="var(--color-border)",e.currentTarget.style.backgroundColor="var(--color-card-background)"},title:"Tap to view warning details",children:[a.jsx(_,{className:"w-3.5 h-3.5 flex-shrink-0",style:{color:"var(--color-warning)"}}),a.jsxs("span",{className:"flex-1 group-hover:text-blue-600 transition-colors",children:[Ze(e.level||e.suggestedLevel).label," - ",e.categoryName||e.category||"General",e.issueDate&&` (${new Date(e.issueDate).toLocaleDateString("en-ZA")})`]}),a.jsx(T,{className:"w-3.5 h-3.5 flex-shrink-0 text-gray-400 group-hover:text-blue-500 group-hover:translate-x-0.5 transition-all"})]},r)),se.activeWarnings.length>3&&a.jsxs("p",{className:"text-xs pl-2",style:{color:"var(--color-text-tertiary)"},children:["+",se.activeWarnings.length-3," more warnings"]})]})]}),(!se.activeWarnings||0===se.activeWarnings.length)&&a.jsxs("div",{className:"mt-2 flex items-center gap-1",children:[a.jsx(I,{className:"w-3 h-3",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-xs",style:{color:"var(--color-success)"},children:"No active warnings on file"})]}),se.isEscalation&&a.jsxs("div",{className:"mt-2 px-2 py-1 rounded text-xs inline-flex items-center gap-1",style:{backgroundColor:"var(--color-alert-warning-bg)",color:"var(--color-alert-warning-text)"},children:[a.jsx(_,{className:"w-3 h-3"}),"Escalation from previous warning"]})]})]})}),ge&&a.jsx(h,{variant:"error",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx(_,{className:"w-5 h-5 flex-shrink-0"}),a.jsxs("div",{children:[a.jsx("strong",{children:"HR Intervention Required"}),a.jsx("p",{className:"text-sm mt-1",children:"This employee has a final warning on file. Contact HR before proceeding."})]})]})})]});case 3:return a.jsxs("div",{className:"space-y-4",children:[!Ba.requiresCommitments&&a.jsxs(h,{variant:"info",children:["For ",Ba.label," warnings, this section is optional."]}),a.jsx("textarea",{value:ke,onChange:e=>ze(e.target.value),placeholder:"Record the employee's response to the incident discussion...",rows:6,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:E(ke)>0&&E(ke)<6?"var(--color-alert-error-bg)":"var(--color-background)",borderColor:E(ke)>0&&E(ke)<6?"var(--color-alert-error-border)":"var(--color-border)",color:"var(--color-text-primary)"}}),a.jsxs("div",{className:"flex items-center justify-between text-xs",style:{color:E(ke)>0&&E(ke)<6?"var(--color-error)":"var(--color-text-secondary)"},children:[a.jsxs("span",{children:[E(ke),"/6 words minimum"]}),E(ke)>=6&&a.jsx(I,{className:"w-4 h-4 text-green-500"})]})]});case 4:return a.jsxs("div",{className:"space-y-4",children:[a.jsx("textarea",{value:Re,onChange:e=>De(e.target.value),placeholder:"Document the expected behavior, performance, or conduct standards...",rows:6,className:"w-full px-4 py-3 rounded-lg border transition-all focus:outline-none focus:ring-2",style:{backgroundColor:E(Re)>0&&E(Re)<6?"var(--color-alert-error-bg)":"var(--color-background)",borderColor:E(Re)>0&&E(Re)<6?"var(--color-alert-error-border)":"var(--color-border)",color:"var(--color-text-primary)"}}),a.jsxs("div",{className:"flex items-center justify-between text-xs",style:{color:E(Re)>0&&E(Re)<6?"var(--color-error)":"var(--color-text-secondary)"},children:[a.jsxs("span",{children:[E(Re),"/6 words minimum"]}),E(Re)>=6&&a.jsx(I,{className:"w-4 h-4 text-green-500"})]})]});case 5:return a.jsxs("div",{className:"space-y-4",children:[!Ba.requiresCommitments&&a.jsxs(h,{variant:"info",children:["For ",Ba.label," warnings, improvement commitments are optional."]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Action Commitments"}),Te.map((e,r)=>a.jsxs("div",{className:"mb-3 p-3 rounded-lg border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"What will be done"}),a.jsx("input",{type:"text",value:e.commitment,onChange:e=>{const a=[...Te];a[r].commitment=e.target.value,Be(a)},placeholder:"e.g., Arrive 10 minutes early",className:"w-full px-3 py-2 rounded border text-sm",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),a.jsx("button",{onClick:()=>Be(Te.filter(a=>a.id!==e.id)),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors","aria-label":"Remove commitment",children:a.jsx($,{className:"w-4 h-4"})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"By when"}),a.jsx("input",{type:"text",value:e.timeline,onChange:e=>{const a=[...Te];a[r].timeline=e.target.value,Be(a)},placeholder:"e.g., Immediately, Within 1 week",className:"w-full px-3 py-2 rounded border text-sm",style:{backgroundColor:"var(--color-surface)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]})]},e.id)),a.jsx(r,{variant:"outline",size:"sm",onClick:()=>Be([...Te,{id:`commitment_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,commitment:"",timeline:""}]),children:"+ Add Commitment"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Follow-up Review Date"}),a.jsx("input",{type:"date",value:Oe,onChange:e=>Ge(e.target.value),min:(new Date).toISOString().split("T")[0],className:"w-full px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Issue Date"}),a.jsx("input",{type:"date",value:K.issueDate,onChange:e=>Z(a=>({...a,issueDate:e.target.value})),className:"w-full px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium mb-2 block",style:{color:"var(--color-text-primary)"},children:"Validity Period"}),a.jsxs("select",{value:K.validityPeriod,onChange:e=>Z(a=>({...a,validityPeriod:parseInt(e.target.value)})),className:"w-full px-3 py-2 rounded border",style:{backgroundColor:"var(--color-background)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},children:[a.jsx("option",{value:3,children:"3 months"}),a.jsx("option",{value:6,children:"6 months"}),a.jsx("option",{value:12,children:"12 months"})]})]})]})]});case 6:return a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 rounded-xl text-center",style:{background:`linear-gradient(135deg, ${Ba.color}15, ${Ba.color}05)`,border:`1px solid ${Ba.color}30`},children:[a.jsx("p",{className:"text-xs font-medium uppercase tracking-wide mb-1",style:{color:Ba.color},children:Ba.label}),a.jsx("p",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:Ha}),a.jsxs("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:[ae?.name," â€¢ ",K.incidentDate]})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsx(ea,{label:"What happened",onClick:()=>Va(2),children:K.incidentDescription||"No description"}),a.jsxs(ea,{label:"When & Where",onClick:()=>Va(2),children:[K.incidentDate," at ",K.incidentTime," â€¢ ",K.incidentLocation]}),Ba.requiresCommitments&&a.jsxs(a.Fragment,{children:[a.jsxs(ea,{label:"Employee said",onClick:()=>Va(3),children:['"',ke||"No response",'"']}),a.jsx(ea,{label:"Expected standard",onClick:()=>Va(4),children:Re||"Not specified"}),a.jsxs(ea,{label:"Improvement plan",onClick:()=>Va(5),children:[Te.length," commitment",1!==Te.length?"s":""," â€¢ Review: ",Oe||"Not set"]})]})]}),a.jsx("p",{className:"text-xs text-center",style:{color:"var(--color-text-muted)"},children:"Tap any row to edit"})]});case 7:return a.jsxs("div",{className:"space-y-4",children:[a.jsxs(o,{padding:"md",className:"border",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--color-text-secondary)"},children:[a.jsx("strong",{children:"Read this completely to ensure your employee understands their rights."})," This script covers all legal requirements and communicates the warning clearly."]}),a.jsx(Ie,{employeeName:Ha||"Employee",managerName:i,categoryName:ae?.name||"General Misconduct",incidentDescription:K.incidentDescription||"Workplace incident requiring disciplinary action",warningLevel:Ua,validityPeriod:K.validityPeriod,onScriptRead:()=>ya(!0),disabled:pa,activeWarnings:se?.activeWarnings,issuedDate:K.issueDate})]}),pa&&a.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:"var(--color-alert-success-bg)"},children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(I,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-alert-success-text)"},children:"Script has been read to the employee"})]})}),a.jsx("div",{className:"p-3 rounded-lg border transition-all",style:{backgroundColor:ga?"var(--color-alert-success-bg)":"var(--color-card-background)",borderColor:ga?"var(--color-success)":"var(--color-border-light)",opacity:pa?1:.6},children:a.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:ga,onChange:e=>xa(e.target.checked),disabled:!pa,className:"w-5 h-5 mt-0.5 rounded flex-shrink-0",style:{accentColor:"var(--color-success)"}}),a.jsxs("div",{className:"flex-1",children:[a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"I confirm the employee has reviewed and understands this warning"}),a.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-secondary)"},children:"The employee understands the nature of the misconduct and their right to representation under the Labour Relations Act."})]})]})})]});case 8:return a.jsxs("div",{className:"space-y-3",children:[a.jsx(aa,{step:1,label:"Manager",name:i,signature:ia.manager,onTap:()=>ha("manager")}),ia.manager&&a.jsx("button",{onClick:()=>La(!0),className:"w-full p-4 rounded-xl border-2 border-dashed transition-all hover:border-solid active:scale-[0.98]",style:{borderColor:da?"var(--color-success)":"var(--color-primary)",backgroundColor:da?"var(--color-alert-success-bg)":"var(--color-primary-light)"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",style:{backgroundColor:da?"var(--color-success)":"var(--color-primary)",color:"white"},children:da?a.jsx(I,{className:"w-5 h-5"}):a.jsx(me,{className:"w-5 h-5"})}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:"Step 2: Review PDF with Employee"}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:da?"Document reviewed":"Tap to preview document"})]})]})}),ia.manager&&a.jsxs("label",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors",style:{backgroundColor:da?"var(--color-alert-success-bg)":"transparent"},children:[a.jsx("input",{type:"checkbox",checked:da,onChange:e=>ma(e.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-success)"}}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-primary)"},children:"Employee has reviewed the document"})]}),ia.manager&&da&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex gap-1 p-1 rounded-lg",style:{backgroundColor:"var(--color-background)"},children:[a.jsx("button",{onClick:()=>ca("employee"),className:"flex-1 py-2.5 px-3 rounded-md text-sm font-medium transition-all "+("employee"===la?"shadow-sm":""),style:{backgroundColor:"employee"===la?"white":"transparent",color:"employee"===la?"var(--color-primary)":"var(--color-text-secondary)"},children:"Employee"}),a.jsx("button",{onClick:()=>ca("witness"),className:"flex-1 py-2.5 px-3 rounded-md text-sm font-medium transition-all "+("witness"===la?"shadow-sm":""),style:{backgroundColor:"witness"===la?"white":"transparent",color:"witness"===la?"var(--color-warning)":"var(--color-text-secondary)"},children:"Witness"})]}),a.jsx(aa,{step:3,label:"employee"===la?"Employee":"Witness",name:"employee"===la?Ha:"Witness",signature:"employee"===la?ia.employee:ia.witness,isWitness:"witness"===la,onTap:()=>ha("employee")}),"witness"===la&&a.jsx("p",{className:"text-xs text-center",style:{color:"var(--color-text-muted)"},children:"Use when employee refuses to sign"})]}),ua&&a.jsx(ra,{title:"manager"===ua?"Manager Signature":"employee"===la?"Employee Signature":"Witness Signature",signerName:"manager"===ua?i:"employee"===la?Ha:"Witness",onSave:e=>{"manager"===ua?Za(e):"employee"===la?er(e):ar(e),ha(null)},onClose:()=>ha(null),initialSignature:"manager"===ua?ia.manager:"employee"===la?ia.employee:ia.witness})]});case 9:return a.jsxs("div",{className:"space-y-4",children:[a.jsx(h,{variant:"success",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(I,{className:"w-5 h-5"}),a.jsxs("span",{children:["Warning saved successfully! ID: ",ka]})]})}),a.jsx("div",{className:"grid grid-cols-2 gap-3",children:["email","whatsapp","printed","qr"].map(r=>a.jsx("button",{onClick:()=>{"qr"===r?(async()=>{if(C?.id&&J&&ae){Fa(!0),fa("qr");try{const{PDFGenerationService:a}=await e(async()=>{const{PDFGenerationService:e}=await import("./dashboard-router-CsxAXVhx.js").then(e=>e.d);return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7])),{transformWarningDataForPDF:r}=await e(async()=>{const{transformWarningDataForPDF:e}=await import("./warning-components-rhTj25mI.js").then(e=>e.p);return{transformWarningDataForPDF:e}},__vite__mapDeps([8,1,2,3,4,5,0,6,7])),s={id:ka,organizationId:C.id,level:Ua,category:ae.name,description:K.incidentDescription,incidentDate:K.incidentDate,incidentTime:K.incidentTime,incidentLocation:K.incidentLocation,issueDate:K.issueDate,validityPeriod:K.validityPeriod,signatures:{manager:ia.manager,employee:ia.employee,witness:ia.witness,managerName:i,employeeName:Ha,signedAt:(new Date).toISOString()},employeeStatement:ke,expectedBehaviorStandards:Re,actionSteps:Te.map(e=>({action:e.commitment,timeline:e.timeline})),reviewDate:Oe,disciplineRecommendation:se,pdfGeneratorVersion:ye},t=await r(s,J,C),o=await a.generateWarningPDF(t,t.pdfGeneratorVersion,t.pdfSettings);Ma(o),Pa(!0),c.success("PDF generated for QR code delivery")}catch(a){c.error("Failed to generate PDF for QR code:",a),alert("Failed to generate PDF for QR code. Please try again.")}finally{Fa(!1)}}else c.error("Missing data for QR code generation")})():fa(r)},disabled:"qr"===r&&Wa,className:`\n                    p-4 rounded-lg border text-center transition-all\n                    ${wa===r?"ring-2 ring-primary":""}\n                    ${"qr"===r&&Wa?"opacity-50 cursor-wait":""}\n                  `,style:{borderColor:wa===r?"var(--color-primary)":"var(--color-border)",backgroundColor:wa===r?"var(--color-primary-light)":"var(--color-background)"},children:a.jsx("span",{className:"text-sm font-medium capitalize",style:{color:"var(--color-text-primary)"},children:"qr"===r?Wa?"Generating...":"QR Code":r})},r))})]});default:return null}})()}),a.jsx(fe,{currentPhase:M,totalPhases:Ve,isValid:Oa,isLoading:Sa||Na,onPrevious:Qa,onNext:8===M?async()=>{if(C?.id)if(J)if(ae){K.employeeId,K.categoryId,za(!0);try{const a={organizationId:C.id,employeeId:K.employeeId,categoryId:K.categoryId,categoryName:ae.name,level:Ua,incidentDescription:K.incidentDescription,incidentDate:K.incidentDate,incidentTime:K.incidentTime,incidentLocation:K.incidentLocation,issueDate:K.issueDate,validityPeriod:K.validityPeriod,employeeName:Ha,employeeLastName:J.profile?.lastName||J.lastName||"",employeeNumber:J.profile?.employeeNumber||J.employeeNumber||"",employeeDepartment:J.employment?.department||J.department||"",employeePosition:J.employment?.position||J.position||"",issuedBy:N?.uid||"",issuedByName:i,signatures:{manager:ia.manager,employee:ia.employee||null,witness:ia.witness||null,managerName:ia.managerName||i,..."employee"===la&&{employeeName:Ha},..."witness"===la&&ia.witnessName&&{witnessName:ia.witnessName},signedAt:(new Date).toISOString()},employeeStatement:ke,expectedBehaviorStandards:Re,actionSteps:Te.map(e=>({action:e.commitment,timeline:e.timeline})),reviewDate:Oe,interventionDetails:Je,resourcesProvided:ta,disciplineRecommendation:se,wasOverridden:!!ne,originalRecommendedLevel:se?.suggestedLevel,pdfGeneratorVersion:ye,status:"issued",createdAt:new Date,createdBy:N?.uid};Object.keys(a);const r=await p.warnings.create(a);if(c.success("Warning created with ID:",r),ja(r),D&&R.isRecording)try{if(await R.stopRecording()&&r){const e=await R.uploadToFirebase(C.id,r);if(e){const a=S(u,"organizations",C.id,"warnings",r);await z(a,{audioRecordingUrl:e,audioMetadata:{recordedBy:N?.uid,recordedByName:i,recordedAt:(new Date).toISOString(),duration:R.duration||0}}),c.success("Audio uploaded successfully:",e)}}}catch(e){c.error("Failed to upload audio recording:",e)}U(e=>new Set([...e,8])),W(9),c.success("Warning saved successfully:",r)}catch(a){c.error("Failed to save warning:",a),c.error("Error details:",{message:a?.message,code:a?.code,stack:a?.stack?.substring(0,500)}),alert(`Failed to save warning: ${a?.message||"Unknown error"}`)}finally{za(!1)}}else c.error("Cannot save warning: No category selected",{categoryId:K.categoryId});else c.error("Cannot save warning: No employee selected",{employeeId:K.employeeId});else c.error("Cannot save warning: No organization ID")}:Ya,customNextText:8===M?"Save Warning":void 0,showFinalize:9===M,onFinalize:async()=>{if(wa&&ka){Ca(!0);try{c.success("Warning finalized with delivery method:",wa),Y(!0)}catch(e){c.error("Failed to finalize:",e)}finally{Ca(!1)}}}})]})})}),V&&0===M&&a.jsx("div",{className:"px-4 py-2 text-center text-xs border-t",style:{backgroundColor:"var(--color-alert-info-bg)",color:"var(--color-alert-info-text)",borderColor:"var(--color-border-light)"},children:"ðŸ’¡ Swipe left/right to navigate between phases"})]}),a.jsx(he,{isOpen:Ea,onClose:()=>La(!1),warningData:{wizardState:{currentStep:M,selectedEmployee:J,selectedCategory:ae,formData:{...K,employeeStatement:ke,expectedBehaviorStandards:Re,actionSteps:Te.map(e=>({action:e.commitment,timeline:e.timeline})),reviewDate:Oe,interventionDetails:Je,resourcesProvided:ta},signatures:ia,lraRecommendation:se,organizationId:C?.id||""},selectedEmployee:J,selectedCategory:ae,organizationId:C?.id},title:"Warning Document Preview"}),Aa&&a.jsx(Ee,{isOpen:$a,onClose:()=>Pa(!1),pdfBlob:Aa,filename:`Warning_${ae?.name||"Document"}_${Ha}_${K.issueDate}.pdf`,employeeId:K.employeeId,warningId:ka,organizationId:C?.id,employeeName:Ha}),qa&&a.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9100] flex items-center justify-center p-4",onClick:()=>_a(null),children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full p-4",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--color-text)"},children:"Warning Details"}),a.jsx("button",{onClick:()=>_a(null),className:"p-1 hover:bg-gray-100 rounded",children:a.jsx($,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Level"}),a.jsx("p",{className:"text-sm font-semibold",style:{color:"var(--color-text)"},children:Ze(qa.level||qa.suggestedLevel).label})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Category"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:qa.categoryName||qa.category||"General"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issue Date"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:qa.issueDate?new Date(qa.issueDate).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"}):"Not recorded"})]}),qa.expiryDate&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Expiry Date"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:new Date(qa.expiryDate).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})})]}),qa.description&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Description"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:qa.description})]}),qa.issuedByName&&a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Issued By"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:qa.issuedByName})]})]}),a.jsx("button",{onClick:()=>_a(null),className:"w-full mt-4 py-2 px-4 rounded-lg text-sm font-medium transition-colors wizard-touch-target wizard-button-tap",style:{backgroundColor:"var(--color-primary)",color:"white"},children:"Close"})]})})]})]})},ea=({label:e,onClick:r,children:s})=>a.jsxs("button",{onClick:r,className:"w-full text-left px-3 py-2.5 rounded-lg hover:bg-gray-50 active:bg-gray-100 transition-colors group flex items-start gap-3","aria-label":`Edit ${e}`,children:[a.jsx("span",{className:"text-xs font-medium w-24 flex-shrink-0 pt-0.5",style:{color:"var(--color-text-secondary)"},children:e}),a.jsx("span",{className:"flex-1 text-sm leading-relaxed",style:{color:"var(--color-text-primary)",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:s}),a.jsx(T,{className:"w-4 h-4 flex-shrink-0 opacity-0 group-hover:opacity-50 transition-opacity mt-0.5",style:{color:"var(--color-text-secondary)"}})]}),aa=({step:e,label:r,name:s,signature:t,isWitness:o,isOptional:i,onTap:n})=>a.jsx("button",{onClick:n,disabled:!!t,className:"w-full p-4 rounded-xl border-2 transition-all "+(t?"border-solid":i?"border-dashed opacity-70 hover:opacity-100 hover:border-solid active:scale-[0.98]":"border-dashed hover:border-solid active:scale-[0.98]"),style:{borderColor:t?"var(--color-success)":o?"var(--color-warning)":"var(--color-primary)",backgroundColor:t?"var(--color-alert-success-bg)":"var(--color-card-background)",cursor:t?"default":"pointer"},children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-bold",style:{backgroundColor:t?"var(--color-success)":o?"var(--color-warning)":"var(--color-primary)"},children:t?a.jsx(I,{className:"w-5 h-5"}):e}),a.jsxs("div",{className:"flex-1 text-left",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:[r," Signature"]}),i&&!t&&a.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:"var(--color-background)",color:"var(--color-text-muted)"},children:"Optional"})]}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:t?`Signed by ${s}`:`Tap here for ${s} to sign`})]}),t&&a.jsx("img",{src:t,alt:`${r} signature`,className:"h-10 w-auto max-w-[80px] object-contain",style:{filter:"grayscale(0.2)"}})]})}),ra=({title:e,signerName:r,onSave:s,onClose:t,initialSignature:o})=>{const i=v.useRef(null),[n,l]=v.useState(!1),[c,d]=v.useState(!!o);v.useEffect(()=>{requestAnimationFrame(()=>{const e=i.current;if(!e)return;const a=e.parentElement;if(!a)return;const r=a.getBoundingClientRect(),s=window.devicePixelRatio||1;e.width=r.width*s,e.height=r.height*s,e.style.width=`${r.width}px`,e.style.height=`${r.height}px`;const t=e.getContext("2d");if(t&&(t.scale(s,s),t.strokeStyle="#1e40af",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",o)){const e=new Image;e.onload=()=>{t.drawImage(e,0,0,r.width,r.height)},e.src=o}})},[o]);const m=e=>{const a=i.current;if(!a)return{x:0,y:0};const r=a.getBoundingClientRect();return"touches"in e?{x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top}:{x:e.clientX-r.left,y:e.clientY-r.top}},u=e=>{e.preventDefault();const a=i.current,r=a?.getContext("2d");if(!r||!a)return;r.strokeStyle="#1e40af",r.lineWidth=2,r.lineCap="round",r.lineJoin="round",l(!0),d(!0);const{x:s,y:t}=m(e);r.beginPath(),r.moveTo(s,t)},h=e=>{if(!n)return;e.preventDefault();const a=i.current?.getContext("2d");if(!a)return;const{x:r,y:s}=m(e);a.lineTo(r,s),a.stroke()},g=()=>{l(!1)};return a.jsxs("div",{className:"fixed inset-0 z-[9500] flex flex-col",style:{backgroundColor:"white"},children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--color-border-light)"},children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:e}),a.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:r})]}),a.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-100",children:a.jsx($,{className:"w-5 h-5 text-gray-500"})})]}),a.jsxs("div",{className:"flex-1 p-4 flex flex-col",children:[a.jsx("p",{className:"text-xs text-center mb-2",style:{color:"var(--color-text-secondary)"},children:"Sign in the box below"}),a.jsxs("div",{className:"flex-1 rounded-xl border-2 border-dashed relative overflow-hidden",style:{borderColor:"var(--color-border)",backgroundColor:"#fafafa"},children:[a.jsx("canvas",{ref:i,className:"absolute inset-0 w-full h-full touch-none",onMouseDown:u,onMouseMove:h,onMouseUp:g,onMouseLeave:g,onTouchStart:u,onTouchMove:h,onTouchEnd:g}),!c&&a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:a.jsx("p",{className:"text-gray-300 text-lg",children:"Draw your signature here"})})]})]}),a.jsxs("div",{className:"p-4 border-t flex gap-3",style:{borderColor:"var(--color-border-light)"},children:[a.jsx("button",{onClick:()=>{const e=i.current,a=e?.getContext("2d");if(!e||!a)return;const r=e.getBoundingClientRect();a.clearRect(0,0,r.width,r.height),d(!1)},className:"flex-1 py-3 px-4 rounded-xl border text-sm font-medium transition-colors hover:bg-gray-50",style:{borderColor:"var(--color-border)",color:"var(--color-text-secondary)"},children:"Clear"}),a.jsx("button",{onClick:()=>{const e=i.current,a=e?.getContext("2d");if(!e||!a||!c)return;const t=new Date,o=new Intl.DateTimeFormat("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}).format(t),n=(e=>{if(!e||""===e.trim())return"";const a=e.trim().split(/\s+/);return 0===a.length?"":1===a.length?a[0]:`${a.slice(0,-1).map(e=>e.charAt(0).toUpperCase()+".").join(" ")} ${a[a.length-1]}`})(r),l=e.getBoundingClientRect();a.save(),a.font="10px Arial, sans-serif",a.fillStyle="#64748b",a.textAlign="right",a.textBaseline="bottom";let d=l.height-8;a.fillText(o,l.width-8,d),n&&(d-=12,a.fillText(n,l.width-8,d)),a.restore();const m=e.toDataURL("image/png");s(m)},disabled:!c,className:"flex-1 py-3 px-4 rounded-xl text-sm font-medium text-white transition-colors disabled:opacity-50",style:{backgroundColor:c?"var(--color-primary)":"var(--color-border)"},children:"Save Signature"})]})]})};export{Je as UnifiedWarningWizard,Je as default};
