import{L as e,D as a,j as s,a as t,d as r}from"./business-owner-dashboard-Cw2S2b3C.js";import{r as n}from"./react-vendor-BMk1H4su.js";import{c as l,D as i,g as o,T as d,j as c,u as m}from"./firebase-vendor-BIBOIkWK.js";import{h as g}from"./employee-BVTMyN2H.js";import{D as x}from"./hr-dashboard-DCNKcWEX.js";import{U as p,a as u}from"./dashboard-router-DriKLXjX.js";import{U as h,a_ as b,B as f,d as y,q as N,O as j,z as v,w,b0 as C,ay as D,X as M,af as k,o as E,W as A,I as S,t as I,T as F,h as $,an as P,b as R,b1 as O}from"./ui-vendor-DjDr2yFV.js";import"./pdf-vendor-CbrIsI36.js";import"./hod-dashboard-BWpKy7JX.js";const z=new class{async getManagers(s){try{const t=(await a.queryDocuments(s,"users")).documents.filter(e=>"hr-manager"===e.role?.id||"hod-manager"===e.role?.id).map(e=>({id:e.id,uid:e.uid||e.id,firstName:e.firstName||e.profile?.firstName||"Unknown",lastName:e.lastName||e.profile?.lastName||"User",email:e.email,role:e.role,departmentIds:e.departmentIds||[],hodPermissions:e.hodPermissions,organizationId:e.organizationId||s,isActive:!1!==e.isActive,createdAt:e.createdAt||new Date,updatedAt:e.updatedAt}));return e.success(`✅ Loaded ${t.length} managers`),t}catch(t){throw e.error("Failed to fetch managers:",t),new Error("Failed to load managers. Please try again.")}}async getManagerById(s,t){try{const e=await a.getDocument(s,"users",t);if(!e)return null;if("hr-manager"!==e.role?.id&&"hod-manager"!==e.role?.id)throw new Error("User is not a manager");return{id:e.id,uid:e.uid||e.id,firstName:e.firstName||e.profile?.firstName||"Unknown",lastName:e.lastName||e.profile?.lastName||"User",email:e.email,role:e.role,departmentIds:e.departmentIds||[],hodPermissions:e.hodPermissions,organizationId:e.organizationId||s,isActive:!1!==e.isActive,createdAt:e.createdAt||new Date,updatedAt:e.updatedAt}}catch(r){throw e.error("Failed to fetch manager:",r),r}}async getManagerEmployees(s,t){try{const r=(await a.queryDocuments(s,"employees")).documents.filter(e=>{const a=g(e.employment),s=a.includes(t)&&!1!==e.isActive;return e.id,e.profile,e.profile,a.includes(t),e.isActive,s});return e.success(`✅ Found ${r.length} employees for manager ${t}`),r}catch(r){throw e.error("Failed to fetch manager employees:",r),new Error("Failed to load manager employees. Please try again.")}}async getManagerEmployeeCounts(s,t){try{const e=(await a.queryDocuments(s,"employees")).documents.filter(e=>!1!==e.isActive),r=new Map;return t.forEach(e=>r.set(e.id,0)),e.forEach(e=>{g(e.employment).forEach(e=>{r.has(e)&&r.set(e,(r.get(e)||0)+1)})}),r}catch(r){return e.error("Failed to get employee counts:",r),new Map}}async getManagerStats(s){try{const e=await this.getManagers(s),t=(await this.getManagerEmployeeCounts(s,e),e.filter(e=>"hr-manager"===e.role.id).length),r=e.filter(e=>"hod-manager"===e.role.id).length,n=e.filter(e=>e.departmentIds&&e.departmentIds.length>0).length,l=await a.queryDocuments(s,"employees"),i=l.documents.filter(e=>!1!==e.isActive).filter(e=>g(e.employment).length>0).length,o=e.length>0?Math.round(i/e.length):0;return{totalManagers:e.length,hrManagers:t,hodManagers:r,managersWithDepartments:n,managersWithoutDepartments:e.length-n,totalEmployeesUnderManagement:i,averageEmployeesPerManager:o}}catch(t){throw e.error("Failed to calculate manager stats:",t),t}}async promoteEmployeeToManager(s,t,r,n){try{const o=l(),d=i(o,"createOrganizationUser"),c=await a.getDocument(s,"employees",t);if(!c)throw new Error("Employee not found");if(!c.profile||!c.profile.email)throw new Error("Employee must have a valid email address");if(!c.profile.firstName||!c.profile.lastName)throw new Error("Employee must have first name and last name");const m="temp123";if(await d({organizationId:s,email:c.profile.email,password:m,role:r,firstName:c.profile.firstName,lastName:c.profile.lastName,departmentIds:n||[],employeeId:t,updateEmployeeEmail:!0}),n&&n.length>0){const e=`${c.profile.firstName} ${c.profile.lastName}`.trim(),r=c.profile.email;await new Promise(e=>setTimeout(e,1e3));const l=await a.getDocument(s,"users",t);if(l){const i=l.id||t;for(const t of n)await a.updateDocument(s,"departments",t,{managerId:i,managerName:e,managerEmail:r})}}e.success(`✅ Employee ${t} promoted to ${r}`)}catch(o){throw e.error("Failed to promote employee:",o),new Error(o.message||"Failed to promote employee. Please try again.")}}async demoteManagerToEmployee(s,t,r){try{const n=await a.getDocument(s,"users",t),l=n&&n.departmentIds||[];if(r){const e=await this.getManagerEmployees(s,t);for(const n of e){const e=g(n.employment).filter(e=>e!==t).concat(r);await a.updateDocument(s,"employees",n.id,{"employment.managerIds":e})}e.length}for(const e of l)await a.updateDocument(s,"departments",e,{managerId:null,managerName:null,managerEmail:null});await a.updateDocument(s,"users",t,{role:{id:"employee",name:"Employee",description:"Regular employee",level:0},departmentIds:[]}),e.warn("⚠️ Auth custom claims not updated - requires backend function"),e.success(`✅ Manager ${t} demoted to employee`)}catch(n){throw e.error("Failed to demote manager:",n),new Error(n.message||"Failed to demote manager. Please try again.")}}async updateManagerDepartments(s,t,r){try{const n=await a.getDocument(s,"users",t);if(!n)throw new Error("Manager not found");const l=`${n.firstName||""} ${n.lastName||""}`.trim(),i=n.email,o=n.departmentIds||[];await a.updateDocument(s,"users",t,{departmentIds:r});const d=(await a.queryDocuments(s,"departments")).documents,c=r.filter(e=>!o.includes(e)),m=o.filter(e=>!r.includes(e));for(const e of m){const r=d.find(a=>a.id===e);r&&r.managerId===t&&await a.updateDocument(s,"departments",e,{managerId:null,managerName:null,managerEmail:null})}for(const e of c)await a.updateDocument(s,"departments",e,{managerId:t,managerName:l,managerEmail:i});e.success(`✅ Updated department assignments for manager ${t}`)}catch(n){throw e.error("Failed to update manager departments:",n),new Error(n.message||"Failed to update departments. Please try again.")}}async archiveManager(s,t,r,n){try{const l=await a.getDocument(s,"users",t),i=l&&l.departmentIds||[];if(n){const e=await this.getManagerEmployees(s,t);for(const r of e){const e=g(r.employment).filter(e=>e!==t).concat(n);await a.updateDocument(s,"employees",r.id,{"employment.managerIds":e})}}for(const e of i)await a.updateDocument(s,"departments",e,{managerId:null,managerName:null,managerEmail:null});const c=o().currentUser;await a.updateDocument(s,"users",t,{isActive:!1,archivedAt:d.now(),archivedBy:c?.uid||"system",archiveReason:r}),e.success(`✅ Manager ${t} archived successfully`)}catch(l){throw e.error("Failed to archive manager:",l),new Error(l.message||"Failed to archive manager. Please try again.")}}async restoreManager(s,t){try{const r=o().currentUser;await a.updateDocument(s,"users",t,{isActive:!0,restoredAt:d.now(),restoredBy:r?.uid||"system"}),e.success(`✅ Manager ${t} restored successfully`)}catch(r){throw e.error("Failed to restore manager:",r),new Error(r.message||"Failed to restore manager. Please try again.")}}};const U=({stats:e,loading:a})=>{if(a)return s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[...Array(4)].map((e,a)=>s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 animate-pulse",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3 mb-2"}),s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"})]},a))});if(!e)return null;const t=[{label:"Total Managers",value:e.totalManagers,icon:h,color:"blue",bgColor:"bg-blue-50",textColor:"text-blue-700",iconColor:"text-blue-600"},{label:"HR Managers",value:e.hrManagers,icon:b,color:"green",bgColor:"bg-green-50",textColor:"text-green-700",iconColor:"text-green-600"},{label:"HOD Managers",value:e.hodManagers,icon:f,color:"purple",bgColor:"bg-purple-50",textColor:"text-purple-700",iconColor:"text-purple-600"},{label:"Employees Under Management",value:e.totalEmployeesUnderManagement,icon:y,color:"orange",bgColor:"bg-orange-50",textColor:"text-orange-700",iconColor:"text-orange-600"}];return s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:t.map((e,a)=>s.jsx("div",{className:`${e.bgColor} border border-${e.color}-200 rounded-lg p-4`,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-medium ${e.textColor}`,children:e.label}),s.jsx("p",{className:`text-2xl font-bold ${e.textColor} mt-1`,children:e.value})]}),s.jsx(e.icon,{className:`w-8 h-8 ${e.iconColor} opacity-70`})]})},a))})},L=({managers:e,onViewDetails:a,onEdit:t,onDemote:r,onArchive:l,onConfigurePermissions:i})=>{const[o,d]=n.useState("lastName"),[c,m]=n.useState("asc"),g=e=>{o===e?m("asc"===c?"desc":"asc"):(d(e),m("asc"))},x=[...e].sort((e,a)=>{const s=e[o],t=a[o];return void 0===s||void 0===t?0:"string"==typeof s&&"string"==typeof t?"asc"===c?s.localeCompare(t):t.localeCompare(s):"number"==typeof s&&"number"==typeof t?"asc"===c?s-t:t-s:0});return 0===e.length?s.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[s.jsx(h,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Managers Found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"There are currently no managers in your organization."}),s.jsx("p",{className:"text-sm text-gray-500",children:'Use the "Promote Employee" button to create managers.'})]}):s.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[s.jsx("div",{className:"hidden md:block overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("lastName"),children:s.jsxs("div",{className:"flex items-center gap-2",children:["Name","lastName"===o&&s.jsx("span",{children:"asc"===c?"↑":"↓"})]})}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("role"),children:s.jsxs("div",{className:"flex items-center gap-2",children:["Role","role"===o&&s.jsx("span",{children:"asc"===c?"↑":"↓"})]})}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Departments"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100",onClick:()=>g("employeeCount"),children:s.jsxs("div",{className:"flex items-center gap-2",children:["Direct Reports","employeeCount"===o&&s.jsx("span",{children:"asc"===c?"↑":"↓"})]})}),s.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(e=>s.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center",children:[s.jsxs("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold text-sm",children:[e.firstName.charAt(0),e.lastName.charAt(0)]}),s.jsx("div",{className:"ml-3",children:s.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[e.firstName," ",e.lastName]})})]})}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[s.jsx(N,{className:"w-3 h-3"}),e.email]})}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("hr-manager"===e.role.id?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:e.role.name})}),s.jsx("td",{className:"px-4 py-3",children:s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[s.jsx(f,{className:"w-3 h-3"}),e.departmentNames&&e.departmentNames.length>0?s.jsx("span",{children:e.departmentNames.join(", ")}):s.jsx("span",{className:"text-gray-400 italic",children:"No departments"})]})}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-900 font-medium",children:[s.jsx(h,{className:"w-3 h-3"}),e.employeeCount||0]})}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx("button",{onClick:()=>a(e),className:"text-blue-600 hover:text-blue-900 p-1 rounded hover:bg-blue-50",title:"View Details",children:s.jsx(j,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>t(e),className:"text-green-600 hover:text-green-900 p-1 rounded hover:bg-green-50",title:"Edit Manager",children:s.jsx(v,{className:"w-4 h-4"})}),"hod-manager"===e.role.id&&s.jsx("button",{onClick:()=>i(e),className:"text-purple-600 hover:text-purple-900 p-1 rounded hover:bg-purple-50",title:"Configure Dashboard Features",children:s.jsx(w,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>r(e),className:"text-orange-600 hover:text-orange-900 p-1 rounded hover:bg-orange-50",title:"Demote to Employee",children:s.jsx(C,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>l(e),className:"text-red-600 hover:text-red-900 p-1 rounded hover:bg-red-50",title:"Archive Manager",children:s.jsx(D,{className:"w-4 h-4"})})]})})]},e.id))})]})}),s.jsx("div",{className:"md:hidden divide-y divide-gray-200",children:x.map(e=>s.jsxs("div",{className:"p-4 hover:bg-gray-50",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold",children:[e.firstName.charAt(0),e.lastName.charAt(0)]}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-medium text-gray-900",children:[e.firstName," ",e.lastName]}),s.jsx("div",{className:"text-sm text-gray-600",children:e.email})]})]}),s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("hr-manager"===e.role.id?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:e.role.name})]}),s.jsxs("div",{className:"space-y-2 mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(f,{className:"w-4 h-4"}),s.jsx("span",{children:e.departmentNames&&e.departmentNames.length>0?e.departmentNames.join(", "):"No departments"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[s.jsx(h,{className:"w-4 h-4"}),s.jsxs("span",{children:[e.employeeCount||0," Direct Reports"]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>a(e),className:"flex-1 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100",children:"View"}),s.jsx("button",{onClick:()=>t(e),className:"flex-1 px-3 py-2 bg-green-50 text-green-700 rounded-lg text-sm font-medium hover:bg-green-100",children:"Edit"}),"hod-manager"===e.role.id&&s.jsx("button",{onClick:()=>i(e),className:"px-3 py-2 bg-purple-50 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-100",title:"Features",children:s.jsx(w,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>r(e),className:"flex-1 px-3 py-2 bg-orange-50 text-orange-700 rounded-lg text-sm font-medium hover:bg-orange-100",children:"Demote"}),s.jsx("button",{onClick:()=>l(e),className:"px-3 py-2 bg-red-50 text-red-700 rounded-lg text-sm font-medium hover:bg-red-100",children:s.jsx(D,{className:"w-4 h-4"})})]})]},e.id))})]})},T=({isOpen:t,onClose:r,manager:l,onUpdate:i})=>{const[o,d]=n.useState([]),[c,m]=n.useState([]),[u,b]=n.useState(l.departmentIds||[]),[y,j]=n.useState(!1),[w,D]=n.useState(!1),[S,I]=n.useState(!1),[F,$]=n.useState(null),[P,R]=n.useState(!1),[O,U]=n.useState([]),[L,T]=n.useState(""),[q,H]=n.useState(""),[B,W]=n.useState(!1);n.useEffect(()=>{(async()=>{if(l&&t){I(!0);try{const[e,a]=await Promise.all([z.getManagerEmployees(l.organizationId,l.id),x.getDepartments(l.organizationId)]);d(e),m(a),e.length,a.length}catch(a){e.error("Failed to load manager data:",a)}finally{I(!1)}}})()},[l,t]),n.useEffect(()=>{b(l.departmentIds||[]),j(!1)},[l]),n.useEffect(()=>{P&&_()},[P]);const _=async()=>{if(l&&t)try{const e=(await a.queryDocuments(l.organizationId,"employees")).documents.filter(e=>{const a=g(e.employment);return!1!==e.isActive&&!a.includes(l.id)});U(e)}catch(s){e.error("Failed to load available employees:",s)}},V=O.filter(e=>{if(!e.profile)return!1;const a=L.toLowerCase(),s=`${e.profile.firstName||""} ${e.profile.lastName||""}`.toLowerCase(),t=e.profile.employeeNumber?.toLowerCase()||"",r=e.profile.email?.toLowerCase()||"",n=e.profile.position?.toLowerCase()||"";return s.includes(a)||t.includes(a)||r.includes(a)||n.includes(a)});return s.jsx(p,{isOpen:t,onClose:r,title:"Manager Details",subtitle:`${l.firstName} ${l.lastName}`,size:"lg",children:s.jsx("div",{className:"p-6",children:S?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsxs("div",{className:"w-16 h-16 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-xl",children:[l.firstName.charAt(0),l.lastName.charAt(0)]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:[l.firstName," ",l.lastName]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+("hr-manager"===l.role.id?"bg-green-100 text-green-800":"bg-purple-100 text-purple-800"),children:l.role.name}),l.isActive&&s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"})]})]})]})}),s.jsxs("div",{children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[s.jsx(N,{className:"w-4 h-4"}),"Contact Information"]}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Email"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:l.email})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"User ID"}),s.jsx("span",{className:"text-sm font-mono text-gray-900",children:l.id})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Created"}),s.jsx("span",{className:"text-sm text-gray-900",children:(e=>{if(!e)return"N/A";try{return e.toDate&&"function"==typeof e.toDate?e.toDate().toLocaleDateString():e instanceof Date?e.toLocaleDateString():new Date(e).toLocaleDateString()}catch{return"N/A"}})(l.createdAt)})]})]})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[s.jsx(f,{className:"w-4 h-4"}),"Department Assignments"]}),y?s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("button",{onClick:()=>{b(l.departmentIds||[]),j(!1),$(null)},disabled:w,className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:[s.jsx(M,{className:"w-3 h-3"}),"Cancel"]}),s.jsxs("button",{onClick:async()=>{D(!0),$(null);try{await i(l.id,u),j(!1)}catch(a){e.error("Failed to update departments:",a),$(a.message||"Failed to update departments. Please try again.")}finally{D(!1)}},disabled:w,className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700",children:[s.jsx(k,{className:"w-3 h-3"}),w?"Saving...":"Save"]})]}):s.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100",children:[s.jsx(v,{className:"w-3 h-3"}),"Edit"]})]}),y?s.jsx("div",{className:"border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:0===c.length?s.jsx("p",{className:"text-sm text-gray-500",children:"No departments available"}):s.jsx("div",{className:"space-y-2",children:c.map(e=>s.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-2 rounded",children:[s.jsx("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>{return a=e.id,void b(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name}),e.description&&s.jsx("p",{className:"text-xs text-gray-500",children:e.description})]})]},e.id))})}):s.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:l.departmentNames&&l.departmentNames.length>0?s.jsx("div",{className:"flex flex-wrap gap-2",children:l.departmentNames.map((e,a)=>s.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-lg text-sm font-medium bg-blue-100 text-blue-800",children:e},a))}):s.jsx("p",{className:"text-sm text-gray-500 italic",children:"No departments assigned"})}),F&&s.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800",children:F})})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("h4",{className:"text-sm font-semibold text-gray-900 flex items-center gap-2",children:[s.jsx(h,{className:"w-4 h-4"}),"Direct Reports (",o.length,")"]}),!P&&s.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-1 px-3 py-1 text-xs font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100",children:[s.jsx(E,{className:"w-3 h-3"}),"Add Employee"]})]}),P&&s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Assign Employee to Manager"}),s.jsx("button",{onClick:()=>{R(!1),H(""),T("")},className:"text-gray-400 hover:text-gray-600",children:s.jsx(M,{className:"w-4 h-4"})})]}),s.jsxs("div",{className:"relative mb-2",children:[s.jsx(A,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search employees by name, number, position...",value:L,onChange:e=>T(e.target.value),className:"w-full pl-7 pr-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("div",{className:"mb-2",children:[s.jsxs("select",{value:q,onChange:e=>H(e.target.value),className:"w-full px-3 py-1.5 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",size:5,children:[s.jsx("option",{value:"",children:"Select an employee..."}),V.map(e=>s.jsxs("option",{value:e.id,children:[e.profile?.firstName||"Unknown"," ",e.profile?.lastName||"Employee"," (",e.profile?.employeeNumber||"N/A",") - ",e.profile?.position||"No Position"]},e.id))]}),s.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:[V.length," available employee",1!==V.length?"s":""]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{if(q&&l){W(!0),$(null);try{const s=await a.getDocument(l.organizationId,"employees",q);if(s){const e=g(s.employment),t=[...new Set([...e,l.id])];await a.updateDocument(l.organizationId,"employees",q,{"employment.managerIds":t})}const t=await z.getManagerEmployees(l.organizationId,l.id);d(t),await _(),R(!1),H(""),T(""),e.success("Employee assigned successfully")}catch(s){e.error("Failed to assign employee:",s),$(s.message||"Failed to assign employee. Please try again.")}finally{W(!1)}}},disabled:!q||B,className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:B?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Assigning..."]}):s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"w-3 h-3"}),"Assign Employee"]})}),s.jsx("button",{onClick:()=>{R(!1),H(""),T("")},disabled:B,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50",children:"Cancel"})]})]}),s.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg max-h-64 overflow-y-auto",children:0===o.length?s.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No employees currently assigned to this manager"}):s.jsx("div",{className:"divide-y divide-gray-200",children:o.map(t=>{const r=t.profile?.firstName||"Unknown",n=t.profile?.lastName||"Employee",i=t.profile?.position||"No Position",o=t.profile?.department||"No Department",c=t.profile?.employeeNumber||"N/A";return s.jsx("div",{className:"p-3 hover:bg-gray-100 transition-colors",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-600 font-semibold text-xs",children:[r.charAt(0),n.charAt(0)]}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[r," ",n]}),s.jsxs("div",{className:"text-xs text-gray-600",children:[i," • ",o]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"text-xs text-gray-500",children:c}),s.jsx("button",{onClick:()=>(async s=>{if(l)try{const t=await a.getDocument(l.organizationId,"employees",s);if(t){const r=g(t.employment).filter(e=>e!==l.id);await a.updateDocument(l.organizationId,"employees",s,{"employment.managerIds":r});const n=await z.getManagerEmployees(l.organizationId,l.id);d(n),e.success("Manager removed from employee")}}catch(t){e.error("Failed to remove manager:",t),$(t.message||"Failed to remove manager. Please try again.")}})(t.id),className:"p-1 text-red-600 hover:bg-red-50 rounded transition-colors",title:"Remove manager from employee",children:s.jsx(C,{className:"w-4 h-4"})})]})]})},t.id)})})})]})]})})})},q=({isOpen:r,onClose:l,onPromote:i})=>{const{organization:o}=t(),d=n.useRef(null),[c,m]=n.useState([]),[g,u]=n.useState([]),[h,b]=n.useState(""),[f,y]=n.useState(null),[N,j]=n.useState(""),[v,w]=n.useState(!1),[C,D]=n.useState("hod-manager"),[M,k]=n.useState([]),[E,F]=n.useState(!1),[$,P]=n.useState(!1),[R,O]=n.useState(null);n.useEffect(()=>{(async()=>{if(o?.id&&r){P(!0),O(null);try{const s=await a.queryDocuments(o.id,"employees"),t=(await a.queryDocuments(o.id,"users")).documents.filter(e=>"hr-manager"===e.role?.id||"hod-manager"===e.role?.id).map(e=>e.id),r=s.documents.filter(a=>!1!==a.isActive&&!t.includes(a.id)&&(!!(a.profile&&a.profile.email&&a.profile.firstName&&a.profile.lastName)||(e.warn(`Skipping employee ${a.id} - missing required profile data`),!1)));m(r);const n=await x.getDepartments(o.id);u(n),r.length,n.length}catch(s){e.error("Failed to load data:",s),O("Failed to load employees. Please try again.")}finally{P(!1)}}})()},[o?.id,r]),n.useEffect(()=>{const e=e=>{d.current&&!d.current.contains(e.target)&&w(!1)};return v&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[v]);const z=c.filter(e=>{if(!e.profile)return!1;if(!N.trim())return!0;return`${e.profile.firstName||""} ${e.profile.lastName||""} ${e.profile.email||""} ${e.profile.employeeNumber||""}`.toLowerCase().includes(N.toLowerCase())});return s.jsx(p,{isOpen:r,onClose:l,title:"Promote Employee to Manager",subtitle:"Select an employee and assign manager role",size:"sm",children:s.jsx("div",{className:"p-2.5",children:$?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-3 relative",children:[s.jsxs("label",{className:"block text-[11px] font-semibold text-gray-700 mb-1.5 uppercase tracking-wide",children:["Employee ",s.jsx("span",{className:"text-red-500",children:"*"})," ",s.jsx("span",{className:"font-normal text-gray-400 normal-case text-[10px]",children:"(email required)"})]}),f?s.jsxs("div",{className:"w-full px-2.5 py-2 text-xs border border-blue-500 bg-blue-50 rounded flex items-center justify-between",children:[s.jsxs("span",{className:"font-medium text-blue-900",children:[f.profile?.firstName," ",f.profile?.lastName," (",f.profile?.employeeNumber,")"]}),s.jsx("button",{type:"button",onClick:()=>{y(null),b(""),j("")},className:"text-blue-600 hover:text-blue-800 text-xs underline",children:"Change"})]}):s.jsxs("div",{ref:d,children:[s.jsxs("div",{className:"relative",children:[s.jsx(A,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Type to search employees...",value:N,onChange:e=>{j(e.target.value),w(!0),f&&(y(null),b(""))},onFocus:()=>w(!0),className:"w-full pl-8 pr-2.5 py-2 text-xs border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",autoComplete:"off"})]}),v&&s.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-48 overflow-y-auto",children:z.length>0?z.map(e=>s.jsxs("button",{type:"button",onClick:()=>(e=>{y(e),b(e.id),j(""),w(!1)})(e),className:"w-full px-2.5 py-2 text-left text-xs hover:bg-blue-50 border-b border-gray-100 last:border-b-0 transition-colors",children:[s.jsxs("div",{className:"font-medium text-gray-900",children:[e.profile?.firstName," ",e.profile?.lastName]}),s.jsxs("div",{className:"text-gray-500",children:[e.profile?.employeeNumber," • ",e.profile?.department||"No Department"," • ",e.profile?.email]})]},e.id)):s.jsx("div",{className:"px-2.5 py-2 text-xs text-gray-500 text-center",children:"No employees found"})})]}),0===c.length&&!$&&s.jsxs("div",{className:"mt-1.5 px-2.5 py-1.5 bg-amber-50 border border-amber-200 rounded flex items-start gap-1.5",children:[s.jsx(S,{className:"w-3 h-3 text-amber-600 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-xs text-amber-800",children:"No eligible employees. All lack email or are already managers."})]})]}),s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[s.jsxs("label",{className:"text-[11px] font-semibold text-gray-700 uppercase tracking-wide",children:["hod-manager"===C?"Departments":"Role"," ",s.jsx("span",{className:"font-normal text-gray-400 normal-case text-[10px]",children:"(optional)"})]}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-[10px] text-gray-500",children:"Role:"}),s.jsxs("label",{className:"flex items-center gap-0.5 cursor-pointer",children:[s.jsx("input",{type:"radio",checked:"hod-manager"===C,onChange:()=>D("hod-manager"),className:"w-2.5 h-2.5 text-purple-600"}),s.jsx("span",{className:"text-[10px] text-gray-600",children:"HOD"})]}),s.jsxs("label",{className:"flex items-center gap-0.5 cursor-pointer",children:[s.jsx("input",{type:"radio",checked:"hr-manager"===C,onChange:()=>D("hr-manager"),className:"w-2.5 h-2.5 text-green-600"}),s.jsx("span",{className:"text-[10px] text-gray-600",children:"HR"})]})]})]}),"hod-manager"===C&&g.length>0&&s.jsx("div",{className:"border border-gray-300 rounded p-1.5 max-h-24 overflow-y-auto bg-white",children:g.map(e=>s.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-50 px-1.5 py-1 rounded text-xs",children:[s.jsx("input",{type:"checkbox",checked:M.includes(e.id),onChange:()=>{return a=e.id,void k(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a]);var a},className:"w-3 h-3 text-purple-600 rounded"}),s.jsx("span",{children:e.name})]},e.id))})]}),R&&s.jsxs("div",{className:"mb-2 px-2.5 py-1.5 bg-red-50 border border-red-200 rounded flex items-start gap-1.5",children:[s.jsx(I,{className:"w-3 h-3 text-red-600 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-xs text-red-800",children:R})]}),s.jsxs("div",{className:"flex gap-2 pt-3 mt-3 border-t",children:[s.jsx("button",{onClick:l,disabled:E,className:"modal-footer__button modal-footer__button--secondary",style:{flex:"1"},children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(h){F(!0),O(null);try{await i(h,C,M.length>0?M:void 0),b(""),y(null),j(""),D("hod-manager"),k([]),l()}catch(a){e.error("Failed to promote employee:",a),O(a.message||"Failed to promote employee. Please try again.")}finally{F(!1)}}else O("Please select an employee to promote")},disabled:!h||E,className:"modal-footer__button modal-footer__button--primary",style:{flex:"1"},children:E?"Promoting...":"Promote to Manager"})]})]})})})},H=({isOpen:a,onClose:t,manager:r,onDemote:l,availableManagers:i})=>{const[o,d]=n.useState([]),[c,m]=n.useState(!1),[g,x]=n.useState(""),[u,b]=n.useState(!1),[f,y]=n.useState(null);n.useEffect(()=>{(async()=>{if(r&&a){m(!0);try{const e=await z.getManagerEmployees(r.organizationId,r.id);d(e),e.length,r.id}catch(s){e.error("Failed to load manager employees:",s)}finally{m(!1)}}})()},[r,a]);const N=i.find(e=>e.id===g);return s.jsx(p,{isOpen:a,onClose:t,title:"Demote Manager to Employee",subtitle:`Remove manager privileges from ${r.firstName} ${r.lastName}`,size:"md",children:s.jsxs("div",{className:"p-6",children:[s.jsx("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(F,{className:"w-5 h-5 text-orange-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Permanent Action"}),s.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"This will remove all manager privileges and access rights. This action cannot be undone."})]})]})}),s.jsx("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsxs("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold",children:[r.firstName.charAt(0),r.lastName.charAt(0)]}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-medium text-gray-900",children:[r.firstName," ",r.lastName]}),s.jsx("p",{className:"text-sm text-gray-600",children:r.email}),s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current Role: ",s.jsx("span",{className:"font-medium",children:r.role.name})]})]})]})}),c?s.jsx("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"flex items-center justify-center py-4",children:[s.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-600"}),s.jsx("span",{className:"ml-3 text-sm text-gray-600",children:"Loading assigned employees..."})]})}):o.length>0?s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg mb-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(h,{className:"w-5 h-5 text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsxs("p",{className:"text-sm font-medium text-blue-900",children:[o.length," Direct Report",1!==o.length?"s":""," Assigned"]}),s.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"These employees will need a new manager assigned"}),s.jsxs("div",{className:"mt-2 space-y-1",children:[o.slice(0,5).map(e=>s.jsxs("div",{className:"text-xs text-blue-600",children:["• ",e.profile.firstName," ",e.profile.lastName," (",e.profile.department,")"]},e.id)),o.length>5&&s.jsxs("div",{className:"text-xs text-blue-600 italic",children:["+ ",o.length-5," more..."]})]})]})]})}),s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Replacement Manager *"}),s.jsxs("select",{value:g,onChange:e=>x(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"",children:"-- Select a manager --"}),i.filter(e=>e.id!==r.id&&e.isActive).map(e=>s.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.role.name,")",e.employeeCount?` - Currently managing ${e.employeeCount}`:""]},e.id))]}),N&&s.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg",children:s.jsxs("p",{className:"text-xs text-green-700",children:["✓ ",o.length," employee",1!==o.length?"s":""," will be reassigned to"," ",s.jsxs("strong",{children:[N.firstName," ",N.lastName]})]})})]}):s.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-green-700",children:"✓ This manager has no direct reports. Safe to demote without reassignment."})}),f&&s.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:s.jsx("p",{className:"text-sm text-red-800",children:f})}),s.jsxs("div",{className:"mb-6 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[s.jsxs("p",{className:"text-sm text-gray-700",children:[s.jsx(C,{className:"w-4 h-4 inline mr-2 text-gray-600"}),"After demotion, ",s.jsxs("strong",{children:[r.firstName," ",r.lastName]})," will:"]}),s.jsxs("ul",{className:"mt-2 ml-6 text-sm text-gray-600 space-y-1",children:[s.jsx("li",{children:"• Lose all manager privileges and access rights"}),s.jsx("li",{children:"• No longer have department assignments"}),s.jsx("li",{children:"• Be converted to a regular employee account"}),o.length>0&&s.jsxs("li",{children:["• Their ",o.length," direct report",1!==o.length?"s":""," will be reassigned"]})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:t,disabled:u,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(o.length>0&&!g)y("Please select a replacement manager for the assigned employees");else{b(!0),y(null);try{await l(r.id,o.length>0?g:void 0),t()}catch(a){e.error("Failed to demote manager:",a),y(a.message||"Failed to demote manager. Please try again.")}finally{b(!1)}}},disabled:u||o.length>0&&!g,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Demoting...":"Confirm Demotion"})]})]})})},B=[{key:"canIssueWarnings",label:"Issue Warnings",description:"Allow manager to create and issue warnings to team members",icon:s.jsx(F,{className:"w-5 h-5"}),color:"orange"},{key:"canBookHRMeetings",label:"Book HR Meetings",description:"Allow manager to request meetings with HR for team issues",icon:s.jsx(P,{className:"w-5 h-5"}),color:"green"},{key:"canReportAbsences",label:"Report Absences",description:"Allow manager to report employee absences to HR",icon:s.jsx(R,{className:"w-5 h-5"}),color:"red"},{key:"canRecordCounselling",label:"Record Counselling",description:"Allow manager to document counselling sessions with team members",icon:s.jsx(O,{className:"w-5 h-5"}),color:"blue"}],W=({isOpen:a,onClose:l,manager:i,onSuccess:o})=>{const{organization:d}=t(),[g,x]=n.useState({canIssueWarnings:!1,canBookHRMeetings:!1,canReportAbsences:!1,canRecordCounselling:!1}),[u,h]=n.useState(!1),[b,f]=n.useState(null);n.useEffect(()=>{i.hodPermissions?x(i.hodPermissions):x({canIssueWarnings:!1,canBookHRMeetings:!1,canReportAbsences:!1,canRecordCounselling:!1})},[i]);const y=Object.values(g).filter(Boolean).length,N=4===y,j=0===y;return s.jsx(p,{isOpen:a,onClose:l,title:"Configure Dashboard Features",size:"medium",children:s.jsxs("div",{className:"space-y-6",children:[s.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"w-10 h-10 bg-gradient-to-r from-teal-500 to-teal-600 rounded-full flex items-center justify-center text-white font-semibold",children:[i.firstName?.charAt(0),i.lastName?.charAt(0)]}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"font-semibold text-gray-900",children:[i.firstName," ",i.lastName]}),s.jsxs("p",{className:"text-sm text-gray-600",children:[i.email," • Department Manager"]})]})]})}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(S,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),s.jsx("div",{className:"flex-1",children:s.jsx("p",{className:"text-sm text-blue-900 leading-relaxed",children:"Control which features this manager can access on their dashboard. Only selected features will be visible to them."})})]})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("h4",{className:"font-semibold text-gray-900 text-sm uppercase tracking-wider",children:["Dashboard Features (",y,"/4 enabled)"]}),B.map(e=>{const a=g[e.key],t=(e=>{const a={orange:{bg:"bg-orange-50",text:"text-orange-900",icon:"text-orange-600",border:"border-orange-200"},green:{bg:"bg-green-50",text:"text-green-900",icon:"text-green-600",border:"border-green-200"},red:{bg:"bg-red-50",text:"text-red-900",icon:"text-red-600",border:"border-red-200"},blue:{bg:"bg-blue-50",text:"text-blue-900",icon:"text-blue-600",border:"border-blue-200"}};return a[e]||a.blue})(e.color);return s.jsxs("button",{onClick:()=>{return a=e.key,void x(e=>({...e,[a]:!e[a]}));var a},className:`\n                  w-full flex items-start gap-4 p-4 rounded-lg border-2 transition-all\n                  ${a?`${t.bg} ${t.border}`:"bg-gray-50 border-gray-200 opacity-60"}\n                  hover:shadow-md\n                `,children:[s.jsx("div",{className:`\n                  flex-shrink-0 p-2 rounded-lg\n                  ${a?"bg-white shadow-sm":"bg-gray-100"}\n                  ${a?t.icon:"text-gray-400"}\n                `,children:e.icon}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("div",{className:"flex items-center gap-2 mb-1",children:s.jsx("span",{className:`font-semibold ${a?t.text:"text-gray-500"}`,children:e.label})}),s.jsx("p",{className:"text-sm "+(a?"text-gray-700":"text-gray-400"),children:e.description})]}),s.jsx("div",{className:`\n                  flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center\n                  ${a?"bg-green-500":"bg-gray-300"}\n                `,children:a?s.jsx($,{className:"w-4 h-4 text-white"}):s.jsx(M,{className:"w-4 h-4 text-gray-500"})})]},e.key)})]}),j&&s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(F,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),s.jsx("div",{className:"flex-1",children:s.jsxs("p",{className:"text-sm text-amber-900 leading-relaxed",children:[s.jsx("strong",{children:"Warning:"})," This manager will have no dashboard features available. Their dashboard will be empty."]})})]})}),s.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[s.jsx("button",{onClick:()=>x({canIssueWarnings:!0,canBookHRMeetings:!0,canReportAbsences:!0,canRecordCounselling:!0}),disabled:N,className:"text-sm px-3 py-1.5 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Enable All"}),s.jsx("button",{onClick:()=>x({canIssueWarnings:!1,canBookHRMeetings:!1,canReportAbsences:!1,canRecordCounselling:!1}),disabled:j,className:"text-sm px-3 py-1.5 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Disable All"})]}),b&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsx("p",{className:"text-sm text-red-800",children:b})}),s.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[s.jsx("button",{onClick:l,disabled:u,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 disabled:opacity-50 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:async()=>{if(d?.id){h(!0),f(null);try{const a=c(r,"organizations",d.id,"users",i.id);await m(a,{hodPermissions:g,updatedAt:(new Date).toISOString()}),e.success(`HOD permissions updated for ${i.firstName} ${i.lastName}`),o(),l()}catch(a){e.error("Failed to update HOD permissions:",a),f(a.message||"Failed to update permissions")}finally{h(!1)}}else f("Organization not found")},disabled:u,className:"px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 transition-colors font-semibold",children:u?"Saving...":"Save Changes"})]})]})})},_=()=>{const{organization:a}=t(),{managers:r,stats:l,loading:i,error:o,refreshManagers:d,promoteEmployee:c,demoteManager:m,updateManagerDepartments:g,archiveManager:p}=function(a){const[s,t]=n.useState([]),[r,l]=n.useState(null),[i,o]=n.useState(!0),[d,c]=n.useState(null),m=n.useCallback(async()=>{if(!a)return t([]),l(null),void o(!1);try{o(!0),c(null);const s=await z.getManagers(a),r=await z.getManagerEmployeeCounts(a,s),n=await x.getDepartments(a),i=new Map(n.map(e=>[e.id,e.name])),d=s.map(e=>({...e,employeeCount:r.get(e.id)||0,departmentNames:e.departmentIds?.map(e=>i.get(e)).filter(Boolean)||[]})),m=await z.getManagerStats(a);t(d),l(m),e.success("✅ Managers loaded successfully",{count:d.length,hrManagers:m.hrManagers,hodManagers:m.hodManagers})}catch(s){e.error("Failed to load managers:",s),c(s.message||"Failed to load managers")}finally{o(!1)}},[a]),g=n.useCallback(async()=>{await m()},[m]),p=n.useCallback(async(s,t,r)=>{if(!a)throw new Error("Organization ID is required");try{await z.promoteEmployeeToManager(a,s,t,r),await g()}catch(n){throw e.error("Failed to promote employee:",n),n}},[a,g]),u=n.useCallback(async(s,t)=>{if(!a)throw new Error("Organization ID is required");try{await z.demoteManagerToEmployee(a,s,t),await g()}catch(r){throw e.error("Failed to demote manager:",r),r}},[a,g]),h=n.useCallback(async(s,t)=>{if(!a)throw new Error("Organization ID is required");try{await z.updateManagerDepartments(a,s,t),await g()}catch(r){throw e.error("Failed to update manager departments:",r),r}},[a,g]),b=n.useCallback(async(s,t,r)=>{if(!a)throw new Error("Organization ID is required");try{await z.archiveManager(a,s,t,r),await g()}catch(n){throw e.error("Failed to archive manager:",n),n}},[a,g]),f=n.useCallback(async s=>{if(!a)throw new Error("Organization ID is required");try{await z.restoreManager(a,s),await g()}catch(t){throw e.error("Failed to restore manager:",t),t}},[a,g]);return n.useEffect(()=>{m()},[m]),{managers:s,stats:r,loading:i,error:d,loadManagers:m,refreshManagers:g,promoteEmployee:p,demoteManager:u,updateManagerDepartments:h,archiveManager:b,restoreManager:f}}(a?.id),h=u(),b=u(),f=u(),y=u(),[N,j]=n.useState(""),[v,w]=n.useState("all"),C=r.filter(e=>{const a=`${e.firstName} ${e.lastName} ${e.email}`.toLowerCase().includes(N.toLowerCase()),s="all"===v||e.role.id===v;return a&&s});return i&&0===r.length?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading managers..."})]})}):s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Manager Management"}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage manager roles, departments, and employee assignments"})]}),s.jsxs("button",{onClick:h.open,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[s.jsx(E,{className:"w-4 h-4"}),"Promote Employee"]})]}),o&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[s.jsx(F,{className:"w-5 h-5"}),s.jsx("span",{className:"font-medium",children:o})]})}),s.jsx(U,{stats:l,loading:i}),s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:"text",placeholder:"Search managers by name or email...",value:N,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.jsxs("select",{value:v,onChange:e=>w(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[s.jsx("option",{value:"all",children:"All Roles"}),s.jsx("option",{value:"hr-manager",children:"HR Managers"}),s.jsx("option",{value:"hod-manager",children:"HOD Managers"})]})]}),N||"all"!==v?s.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:["Showing ",C.length," of ",r.length," managers"]}):null]}),s.jsx(L,{managers:C,onViewDetails:e=>{b.open(e)},onEdit:e=>{b.open(e)},onDemote:e=>{f.open(e)},onArchive:async a=>{if(confirm(`Are you sure you want to archive ${a.firstName} ${a.lastName}? This will deactivate their account.`))try{const s=prompt("Please provide a reason for archiving this manager:");if(!s)return;await p(a.id,s),e.success("Manager archived successfully")}catch(s){e.error("Failed to archive manager:",s),alert("Failed to archive manager. Please try again.")}},onConfigurePermissions:a=>{"hod-manager"===a.role.id?y.open(a):e.warn("Permissions can only be configured for Department Managers")}}),h.isOpen&&s.jsx(q,{isOpen:h.isOpen,onClose:h.close,onPromote:async(a,s,t)=>{try{await c(a,s,t),e.success('✅ Employee promoted to manager successfully! They can now log in using their email and the "Forgot Password" link to set up their password.')}catch(r){throw e.error("Failed to promote employee:",r),r}}}),b.isOpen&&b.data&&s.jsx(T,{isOpen:b.isOpen,onClose:b.close,manager:b.data,onUpdate:async(s,t)=>{try{if(await g(s,t),a?.id){const e=await z.getManagerById(a.id,s);if(e){const s=await x.getDepartments(a.id),t=new Map(s.map(e=>[e.id,e.name])),r={...e,departmentNames:e.departmentIds?.map(e=>t.get(e)).filter(Boolean)||[]};b.open(r)}}e.success("Manager departments updated successfully")}catch(r){throw e.error("Failed to update departments:",r),r}}}),f.isOpen&&f.data&&s.jsx(H,{isOpen:f.isOpen,onClose:f.close,manager:f.data,onDemote:async(a,s)=>{try{await m(a,s),e.success("Manager demoted successfully")}catch(t){throw e.error("Failed to demote manager:",t),t}},availableManagers:r.filter(e=>e.id!==f.data.id)}),y.isOpen&&y.data&&s.jsx(W,{isOpen:y.isOpen,onClose:y.close,manager:y.data,onSuccess:()=>{d()}})]})};export{_ as ManagerManagement};
