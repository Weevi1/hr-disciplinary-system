import{a as e}from"./pdf-vendor-tUwojRr6.js";import{M as t,R as o,L as i}from"./business-owner-dashboard-SKPFtfOP.js";import"./react-vendor-CWjEGAcE.js";import"./firebase-vendor-BQc9GSQK.js";import"./ui-vendor-CbYg3h9k.js";class a{static async generateWarningPDF(a){try{const n=t||{isLegacyDevice:!1};o(n);if(n.isLegacyDevice)return i.warn("🚨 Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(a);a.employee,a.organization,!a.description&&a.incidentLocation,a.employee&&(a.employee.firstName,a.employee.lastName),a.organization,a.warningLevel,a.category;Date.now();const{default:s}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),r=new s({orientation:"portrait",unit:"mm",format:"a4",compress:!0});i.success(3579),r.setFont("helvetica","normal");let l=15;const c=r.internal.pageSize.width,d=r.internal.pageSize.height,p=20,h=40;l=this.addOrganizationHeader(r,a.organization,l,c,p),i.success(4172),l=this.addDocumentTitle(r,a,l,c,p,d,h),i.success(4459),l=this.addEmployeeSection(r,a.employee,l,c,p,d,h),i.success(4759),l=this.addWarningDetailsSection(r,a,l,c,p,d,h),i.success(5060),l=this.addIncidentDetailsSection(r,a,l,c,p,d,h),i.success(5387),a.disciplineRecommendation&&(l=this.addPreviousDisciplinaryActionSection(r,a.disciplineRecommendation,l,c,p,d,h),i.success("✅ Previous disciplinary action section added"),l=this.addConsequencesSection(r,a,l,c,p,d,h),i.success("✅ Consequences section added")),a.legalCompliance&&(l=this.addLegalComplianceSection(r,a.legalCompliance,l,c,p,d,h),i.success(6262)),a.additionalNotes&&(l=this.addAdditionalNotesSection(r,a.additionalNotes,l,c,p,d,h),i.success(6716)),l=this.addEmployeeRightsSection(r,a,l,c,p,d,h),i.success("✅ Employee rights section added"),l=this.addSignaturesSection(r,a.signatures,a.employee,l,c,p,d,h),i.success(7166),a.deliveryChoice&&(l=this.addDeliverySection(r,a.deliveryChoice,l,c,p,d,h),i.success(7512)),(a.appealDetails||a.appealOutcome)&&(l=this.addAppealHistorySection(r,a,l,c,p,d,h),i.success("✅ Appeal history section added")),this.addDocumentFooter(r,a,c),i.success(7804),this.addSecurityWatermark(r,c),i.success(7997),"overturned"===a.status&&(this.addOverturnedWatermark(r,c),i.success("✅ OVERTURNED watermark added to all pages"));const m=r.output("blob");Date.now();return a.warningId,a.employee.firstName,a.employee.lastName,(m.size/1024).toFixed(1),m}catch(n){throw i.error("❌ PDF generation failed:",n),new Error(`PDF generation failed: ${n instanceof Error?n.message:"Unknown error"}`)}}static addOrganizationHeader(e,t,o,a,n){const s=this.parseColor(t.branding?.colors?.primary)||{r:59,g:130,b:246};e.setFillColor(s.r,s.g,s.b),e.rect(0,0,a,35,"F");let r=0;if(t.branding?.logo)try{const o=20;r=30,e.addImage(t.branding.logo,"PNG",n,7,r,o)}catch(d){i.warn("Failed to add organization logo to PDF:",d),r=0}e.setTextColor(255,255,255),e.setFontSize(20),e.setFont("helvetica","bold");const l=t.branding?.companyName||t.name||"Organization Name";e.text(l,n+r+(r>0?10:0),15),e.setFontSize(10),e.setFont("helvetica","normal");const c=[];return t.address&&c.push(t.address),t.phone&&c.push(`Tel: ${t.phone}`),t.email&&c.push(`Email: ${t.email}`),c.length>0&&e.text(c.join(" | "),n,25),t.registrationNumber&&e.text(`Registration: ${t.registrationNumber}`,n,30),45}static addDocumentTitle(e,t,o,i,a,n,s){o=this.checkPageOverflow(e,o,30,n,s),e.setTextColor(0,0,0),e.setFontSize(18),e.setFont("helvetica","bold");const r=this.getWarningLevelTitle(t.warningLevel),l=e.getTextWidth(r),c=(i-l)/2;e.text(r,c,o);if("Employee"===t.employee?.firstName||"Category Not Selected"===t.category||!t.description?.trim()){e.setFontSize(12),e.setTextColor(200,50,50);const t="[DRAFT - INCOMPLETE DATA]",a=(i-e.getTextWidth(t))/2;e.text(t,a,o+6),o+=6}e.setTextColor(0,0,0),e.setLineWidth(.5),e.line(c,o+2,c+l,o+2),e.setFontSize(10),e.setFont("helvetica","normal");const d=`Document ID: ${t.warningId} | Issue Date: ${this.formatDate(t.issuedDate)}`,p=(i-e.getTextWidth(d))/2;return e.text(d,p,o+8),o+20}static addEmployeeSection(e,t,o,i,a,n,s){o=this.checkPageOverflow(e,o,40,n,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("EMPLOYEE INFORMATION",a,o);const r="Employee"===t.firstName||"Not Selected"===t.lastName;r?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(a,o+2,i-2*a,25),r&&(e.setFillColor(255,245,245),e.rect(a+1,o+3,i-2*a-2,23,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),r?e.setTextColor(150,0,0):e.setTextColor(0,0,0);const l=[`Name: ${t.firstName} ${t.lastName}`,`Employee ID: ${t.employeeNumber}`,`Position: ${t.position}`,`Department: ${t.department}`];t.email&&""!==t.email&&l.push(`Email: ${t.email}`),r&&l.push("⚠️ Complete employee selection in wizard for full details");let c=o+8;return l.forEach(t=>{e.text(t,a+3,c),c+=4}),o+35}static addWarningDetailsSection(e,t,o,i,a,n,s){o=this.checkPageOverflow(e,o,25,n,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("WARNING DETAILS",a,o);const r="Category Not Selected"===t.category;e.setFontSize(10),e.setFont("helvetica","normal"),r?e.setTextColor(150,0,0):e.setTextColor(0,0,0);let l=o+8;e.text(`Warning Level: ${this.getWarningLevelDisplay(t.warningLevel)}`,a,l),l+=5;const c=t.category&&"Unknown"!==t.category&&"Category Not Selected"!==t.category?t.category:"General Misconduct";return e.text(`Category: ${c}`,a,l),l+=5,t.validityPeriod&&(e.text(`Validity Period: ${t.validityPeriod} months`,a,l),l+=5),l+5}static addIncidentDetailsSection(e,t,o,i,a,n,s){const r=this.calculateIncidentSectionHeight(e,t,i,a);o=this.checkPageOverflow(e,o,r,n,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("INCIDENT DETAILS",a,o);const l=t.description&&""!==t.description.trim(),c=t.incidentLocation&&""!==t.incidentLocation.trim(),d=!l&&!c,p=this.calculateIncidentSectionHeight(e,t,i,a);d?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(a,o+2,i-2*a,p),d&&(e.setFillColor(255,245,245),e.rect(a+1,o+3,i-2*a-2,p-2,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let h=o+10;e.setFont("helvetica","bold"),e.text("Date & Time:",a+3,h),e.setFont("helvetica","normal"),e.text(`${this.formatDate(t.incidentDate)} at ${t.incidentTime}`,a+30,h),h+=6,e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Location:",a+3,h),e.setFont("helvetica","normal");const m=c?t.incidentLocation:"Not specified";e.text(m,a+25,h),h+=6,e.setFont("helvetica","bold"),e.text("Description:",a+3,h),h+=5,e.setFont("helvetica","normal");const u=l?t.description:"Details to be completed";return this.wrapText(e,u,i-2*a-6).forEach(t=>{e.text(t,a+3,h),h+=4}),o+p+10}static addPreviousDisciplinaryActionSection(e,t,o,i,a,n,s){if(!t)return o;const r=t.activeWarnings?.length||0,l=r>0?6*r+20:20,c=28+l;o=this.checkPageOverflow(e,o,c,n,s),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("PREVIOUS DISCIPLINARY ACTION (Still Valid on File)",a,o),e.setDrawColor(200,200,200),e.setFillColor(248,248,248),e.setLineWidth(.3),e.rect(a,o+4,i-2*a,l,"FD"),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let d=o+12;return t.activeWarnings&&t.activeWarnings.length>0?t.activeWarnings.forEach((t,o)=>{const i=`${o+1}) Date: ${this.formatDate(t.issuedDate||t.issueDate||new Date)} | Offense: ${t.categoryName||t.category||"General Misconduct"} | Level: ${this.getWarningLevelDisplay(t.level||t.warningLevel||"verbal")}`;e.text(i,a+5,d),d+=6}):e.text("No previous disciplinary action on file",a+5,d),o+l+12}static addConsequencesSection(e,t,o,i,a,n,s){o=this.checkPageOverflow(e,o,40,n,s),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("WARNING: CONSEQUENCES IF EMPLOYEE",a,o),e.text("DOES NOT CHANGE BEHAVIOUR",a,o+5);e.setFillColor(254,226,226),e.setDrawColor(239,68,68),e.setLineWidth(.5),e.rect(a,o+8,i-2*a,30,"FD"),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(127,29,29);const r=`Any further transgressions related or unrelated to the offences shall result in further disciplinary action which can lead to a disciplinary hearing and it can result in dismissal. Refer to counselling dated ${this.formatDate(t.issuedDate)}.`,l=this.wrapText(e,r,i-2*a-15);let c=o+16;return l.forEach(t=>{e.text(t,a+5,c),c+=5}),o+30+12}static addLegalComplianceSection(e,t,o,i,a,n,s){if(!t)return o;o=this.checkPageOverflow(e,o,30,n,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("LEGAL COMPLIANCE",a,o),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=o+8;return e.text(`Framework: ${t.framework}`,a,r),r+=5,e.text("Compliance Status: "+(t.isCompliant?"COMPLIANT":"NON-COMPLIANT"),a,r),r+=5,t.requirements.length>0&&(e.text("Legal Requirements:",a,r),r+=4,t.requirements.forEach(t=>{e.text(`• ${t}`,a+3,r),r+=4})),r+5}static addAdditionalNotesSection(e,t,o,i,a,n,s){const r=this.wrapText(e,t,i-2*a),l=15+4*r.length;o=this.checkPageOverflow(e,o,l,n,s),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("ADDITIONAL NOTES",a,o),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=o+8;return r.forEach(t=>{e.text(t,a,c),c+=4}),c+5}static addEmployeeRightsSection(e,t,o,i,a,n,s){o=this.checkPageOverflow(e,o,110,n,s),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("EMPLOYEE RIGHTS AND NEXT STEPS",a,o);const r=i-2*a;e.setFillColor(239,246,255),e.setDrawColor(59,130,246),e.setLineWidth(.5),e.rect(a,o+4,r,102,"FD");let l=o+14;const c=a+8;e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(37,99,235),e.text("Your Rights:",c,l),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0),l+=7;this.wrapText(e,"• Right to Appeal: You may appeal this warning within 48 hours by submitting a written appeal to HR. If your internal appeal is unsuccessful, you may refer the matter to the CCMA within 30 days.",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=2.5;this.wrapText(e,"• Right to Representation: You have the right to be represented by a fellow employee or shop steward during disciplinary proceedings.",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=2.5;this.wrapText(e,"• Signing This Document: Your signature acknowledges that this warning has been explained to you. It does NOT mean you agree with the warning.",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=2.5;this.wrapText(e,"• Confidentiality: All information will be kept confidential and shared only with relevant management and HR personnel.",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=3.5,e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(37,99,235),e.text("What Happens Next:",c,l),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0),l+=7;const d=`• This warning remains valid for ${t.validityPeriod||6} months from the date of issue.`;e.text(d,c,l),l+=5;this.wrapText(e,"• During this period, similar conduct may result in further disciplinary action, up to and including dismissal.",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=2.5;this.wrapText(e,"• You are expected to demonstrate immediate and sustained improvement in your conduct.",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=3.5,e.setFontSize(11),e.setFont("helvetica","bold"),e.setTextColor(37,99,235),e.text("Important Notice:",c,l),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0),l+=7;return this.wrapText(e,"If you believe this warning is procedurally unfair or unjust, you have recourse through your company's internal appeal process or the Commission for Conciliation, Mediation and Arbitration (CCMA).",r-20).forEach(t=>{e.text(t,c,l),l+=5}),l+=8,o+102+35}static addSignaturesSection(e,t,o,a,n,s,r,l){a=this.checkPageOverflow(e,a,50,r,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("SIGNATURES",s,a);const c=(n-3*s)/2;if(e.setDrawColor(150,150,150),e.setLineWidth(.3),e.rect(s,a+5,c,30),e.setFontSize(10),e.setFont("helvetica","normal"),e.text("Manager Signature:",s+2,a+12),t?.manager)try{const o=c-4,i=15;e.addImage(t.manager,"PNG",s+2,a+15,o,i),e.setFontSize(8),e.text(`Date: ${this.formatDate(new Date)}`,s+2,a+32)}catch(d){i.warn("Failed to embed manager signature image:",d),e.setFontSize(8),e.text("✓ Digitally Signed",s+2,a+20),e.text(`Date: ${this.formatDate(new Date)}`,s+2,a+25)}else e.text("_________________________",s+2,a+25),e.text("Date: ___________",s+2,a+30);if(e.rect(s+c+10,a+5,c,30),e.text("Employee Signature:",s+c+12,a+12),e.text(`${o.firstName} ${o.lastName}`,s+c+12,a+16),t?.employee)try{const o=c-4,i=15;e.addImage(t.employee,"PNG",s+c+12,a+15,o,i),e.setFontSize(8),e.text(`Date: ${this.formatDate(new Date)}`,s+c+12,a+32)}catch(d){i.warn("Failed to embed employee signature image:",d),e.setFontSize(8),e.text("✓ Digitally Signed",s+c+12,a+20),e.text(`Date: ${this.formatDate(new Date)}`,s+c+12,a+25)}else e.text("_________________________",s+c+12,a+25),e.text("Date: ___________",s+c+12,a+30);return a+30+15}static addDeliverySection(e,t,o,i,a,n,s){if(!t)return o;o=this.checkPageOverflow(e,o,20,n,s),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("DELIVERY INFORMATION",a,o),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=o+6;return e.text(`Delivery Method: ${t.method.toUpperCase()}`,a,r),r+=4,e.text(`Delivery Date: ${this.formatDate(t.timestamp)}`,a,r),r+=4,e.text(`Authorized by: ${t.chosenBy}`,a,r),r+8}static addAppealHistorySection(e,t,o,i,a,n,s){o=this.checkPageOverflow(e,o,40,n,s),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(102,45,145),e.text("APPEAL HISTORY",a,o);let r=o+6;if(t.appealDetails){if(e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Employee Appeal Submission",a,r),r+=5,e.setFont("helvetica","normal"),e.setFontSize(9),t.appealDetails.submittedAt&&(e.text(`Submitted: ${this.formatDate(t.appealDetails.submittedAt)}`,a,r),r+=4),t.appealDetails.submittedBy&&(e.text(`Submitted by: ${t.appealDetails.submittedBy}`,a,r),r+=4),t.appealDetails.grounds){e.setFont("helvetica","bold"),e.text("Grounds for Appeal:",a,r),r+=4,e.setFont("helvetica","normal");const o=e.splitTextToSize(t.appealDetails.grounds,i-2*a-5);e.text(o,a+5,r),r+=4*o.length+2}if(t.appealDetails.details){e.setFont("helvetica","bold"),e.text("Additional Details:",a,r),r+=4,e.setFont("helvetica","normal");const o=e.splitTextToSize(t.appealDetails.details,i-2*a-5);e.text(o,a+5,r),r+=4*o.length+2}if(t.appealDetails.requestedOutcome){e.setFont("helvetica","bold"),e.text("Requested Outcome:",a,r),r+=4,e.setFont("helvetica","normal");const o=e.splitTextToSize(t.appealDetails.requestedOutcome,i-2*a-5);e.text(o,a+5,r),r+=4*o.length+4}}if(t.appealOutcome){r=this.checkPageOverflow(e,r,30,n,s),e.setFontSize(10),e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("HR Decision",a,r),r+=5,e.setFont("helvetica","normal"),e.setFontSize(9),t.appealDecisionDate&&(e.text(`Decision Date: ${this.formatDate(t.appealDecisionDate)}`,a,r),r+=4),e.setFont("helvetica","bold"),e.text("Outcome: ",a,r);const o="overturned"===t.appealOutcome?"WARNING OVERTURNED":"upheld"===t.appealOutcome?"APPEAL DENIED - WARNING STANDS":"modified"===t.appealOutcome?"WARNING MODIFIED":"reduced"===t.appealOutcome?"WARNING REDUCED":t.appealOutcome.toUpperCase();if("overturned"===t.appealOutcome?e.setTextColor(34,139,34):"upheld"===t.appealOutcome?e.setTextColor(178,34,34):e.setTextColor(255,140,0),e.text(o,a+20,r),e.setTextColor(0,0,0),r+=5,t.appealReasoning){e.setFont("helvetica","bold"),e.text("HR Reasoning:",a,r),r+=4,e.setFont("helvetica","normal");const o=e.splitTextToSize(t.appealReasoning,i-2*a-5);e.text(o,a+5,r),r+=4*o.length+2}if(t.hrNotes){e.setFont("helvetica","bold"),e.text("HR Notes:",a,r),r+=4,e.setFont("helvetica","normal");const o=e.splitTextToSize(t.hrNotes,i-2*a-5);e.text(o,a+5,r),r+=4*o.length+2}if(t.followUpRequired){e.setDrawColor(255,193,7),e.setFillColor(255,248,220),e.roundedRect(a,r,i-2*a,10,2,2,"FD"),e.setFont("helvetica","bold"),e.setTextColor(139,69,19);const o=t.followUpDate?`⚠ Follow-up Required by ${this.formatDate(t.followUpDate)}`:"⚠ Follow-up Required";e.text(o,a+2,r+6),e.setTextColor(0,0,0),r+=12}}return r+8}static addDocumentFooter(e,t,o){const i=e.internal.pageSize.height,a=e.getNumberOfPages();for(let n=1;n<=a;n++){e.setPage(n),e.setDrawColor(180,180,180),e.setLineWidth(.3),e.line(20,i-25,o-20,i-25),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(120,120,120);const t="This document has been generated electronically and constitutes an official warning as per LRA Section 188.",s=(o-e.getTextWidth(t))/2;e.text(t,s,i-20);const r="CONFIDENTIAL DOCUMENT - For authorized personnel only",l=(o-e.getTextWidth(r))/2;e.text(r,l,i-15),e.text(`Generated: ${(new Date).toLocaleString()}`,20,i-10),e.text(`Page ${n} of ${a}`,o-50,i-10)}}static addSecurityWatermark(e,t){const o=e.internal.pageSize.height,i=e.getNumberOfPages();for(let a=1;a<=i;a++){e.setPage(a),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.1})),e.setTextColor(150,150,150),e.setFontSize(40),e.setFont("helvetica","bold");const i=t/2,n=o/2;e.text("OFFICIAL WARNING",i,n,{angle:45,align:"center"}),e.restoreGraphicsState()}}static addOverturnedWatermark(e,t){const o=e.internal.pageSize.height,i=e.getNumberOfPages();for(let a=1;a<=i;a++){e.setPage(a),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.35})),e.setTextColor(255,0,0),e.setFontSize(60),e.setFont("helvetica","bold");const i=t/2,n=o/2;e.text("OVERTURNED",i,n,{angle:45,align:"center"}),e.restoreGraphicsState()}}static async generateAppealReportPDF(t){try{const{default:o}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),a=new o({orientation:"portrait",unit:"mm",format:"a4"}),n=a.internal.pageSize.width,s=a.internal.pageSize.height,r=20;let l=20;if(a.setFillColor(37,99,235),a.rect(0,0,n,40,"F"),a.setTextColor(255,255,255),a.setFontSize(22),a.setFont("helvetica","bold"),a.text("APPEAL DECISION REPORT",n/2,18,{align:"center"}),a.setFontSize(11),a.setFont("helvetica","normal"),a.text(t.organization.name,n/2,28,{align:"center"}),l=50,a.setDrawColor(200,200,200),a.setFillColor(248,248,248),a.roundedRect(r,l,n-2*r,35,3,3,"FD"),a.setTextColor(0,0,0),a.setFontSize(10),a.setFont("helvetica","bold"),a.text("Warning Reference",r+5,l+7),a.setFont("helvetica","normal"),a.setFontSize(9),a.text(`Warning ID: ${t.warningId}`,r+5,l+13),a.text(`Employee: ${t.employee.firstName} ${t.employee.lastName} (${t.employee.employeeNumber})`,r+5,l+18),a.text(`Department: ${t.employee.department}`,r+5,l+23),a.text(`Warning Level: ${t.warningLevel}`,r+5,l+28),a.text(`Original Issue Date: ${this.formatDate(t.issueDate)}`,n-r-60,l+13),a.text(`Category: ${t.category}`,n-r-60,l+18),l+=43,t.appealDetails){if(a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(102,45,145),a.text("1. APPEAL SUBMISSION",r,l),l+=8,a.setFillColor(245,243,255),a.setDrawColor(167,139,250),a.roundedRect(r,l,n-2*r,12,2,2,"FD"),a.setTextColor(0,0,0),a.setFontSize(9),a.setFont("helvetica","bold"),a.text(`Submitted: ${t.appealDetails.submittedAt?this.formatDate(t.appealDetails.submittedAt):"N/A"}`,r+5,l+5),a.text(`By: ${t.appealDetails.submittedBy||"Employee"}`,r+5,l+9),l+=15,t.appealDetails.grounds){a.setFont("helvetica","bold"),a.setFontSize(10),a.text("Grounds for Appeal:",r,l),l+=5,a.setFont("helvetica","normal"),a.setFontSize(9);const e=a.splitTextToSize(t.appealDetails.grounds,n-2*r-10);a.text(e,r+5,l),l+=4*e.length+5}if(t.appealDetails.details){a.setFont("helvetica","bold"),a.setFontSize(10),a.text("Additional Details:",r,l),l+=5,a.setFont("helvetica","normal"),a.setFontSize(9);const e=a.splitTextToSize(t.appealDetails.details,n-2*r-10);a.text(e,r+5,l),l+=4*e.length+5}if(t.appealDetails.requestedOutcome){a.setFont("helvetica","bold"),a.setFontSize(10),a.text("Requested Outcome:",r,l),l+=5,a.setFont("helvetica","normal"),a.setFontSize(9);const e=a.splitTextToSize(t.appealDetails.requestedOutcome,n-2*r-10);a.text(e,r+5,l),l+=4*e.length+8}}if(t.appealOutcome){l>s-100&&(a.addPage(),l=20),a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(102,45,145),a.text("2. HR DECISION",r,l),l+=8,a.setFillColor(245,243,255),a.setDrawColor(167,139,250),a.roundedRect(r,l,n-2*r,8,2,2,"FD"),a.setTextColor(0,0,0),a.setFontSize(9),a.setFont("helvetica","bold"),a.text(`Decision Date: ${t.appealDecisionDate?this.formatDate(t.appealDecisionDate):"Pending"}`,r+5,l+5),l+=12;const e="overturned"===t.appealOutcome?"APPEAL APPROVED - WARNING OVERTURNED":"upheld"===t.appealOutcome?"APPEAL DENIED - WARNING STANDS":"modified"===t.appealOutcome?"APPEAL PARTIALLY APPROVED - WARNING MODIFIED":"reduced"===t.appealOutcome?"APPEAL PARTIALLY APPROVED - WARNING REDUCED":t.appealOutcome.toUpperCase();if("overturned"===t.appealOutcome?a.setFillColor(34,197,94):"upheld"===t.appealOutcome?a.setFillColor(239,68,68):a.setFillColor(251,146,60),a.roundedRect(r,l,n-2*r,15,3,3,"F"),a.setTextColor(255,255,255),a.setFontSize(12),a.setFont("helvetica","bold"),a.text(e,n/2,l+10,{align:"center"}),l+=20,t.appealReasoning){a.setTextColor(0,0,0),a.setFont("helvetica","bold"),a.setFontSize(10),a.text("HR Reasoning:",r,l),l+=5,a.setFont("helvetica","normal"),a.setFontSize(9);const e=a.splitTextToSize(t.appealReasoning,n-2*r-10);a.text(e,r+5,l),l+=4*e.length+5}if(t.hrNotes){a.setFont("helvetica","bold"),a.setFontSize(10),a.text("HR Notes:",r,l),l+=5,a.setFont("helvetica","normal"),a.setFontSize(9);const e=a.splitTextToSize(t.hrNotes,n-2*r-10);a.text(e,r+5,l),l+=4*e.length+5}if(t.followUpRequired){a.setDrawColor(251,191,36),a.setFillColor(254,252,232),a.roundedRect(r,l,n-2*r,12,2,2,"FD"),a.setTextColor(146,64,14),a.setFontSize(10),a.setFont("helvetica","bold");const e=t.followUpDate?`⚠ FOLLOW-UP REQUIRED BY: ${this.formatDate(t.followUpDate)}`:"⚠ FOLLOW-UP REQUIRED";a.text(e,r+5,l+7),l+=15}}l<s-80?l=s-75:(a.addPage(),l=20),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(0,0,0),a.text("HR Authorization:",r,l),l+=10,a.setDrawColor(0,0,0),a.line(r,l,r+70,l),a.setFontSize(8),a.setFont("helvetica","normal"),a.text("HR Manager Signature",r,l+5),a.line(n-r-70,l,n-r,l),a.text("Date",n-r-35,l+5);const c=a.getNumberOfPages(),d=s-25;for(let e=1;e<=c;e++){a.setPage(e),a.setDrawColor(180,180,180),a.setLineWidth(.3),a.line(r,d,n-r,d),a.setFontSize(8),a.setFont("helvetica","normal"),a.setTextColor(120,120,120);const t="Official Appeal Decision Report - Confidential HR Document";a.text(t,n/2,d+5,{align:"center"}),a.text(`Generated: ${(new Date).toLocaleString()}`,r,d+10),a.text(`Page ${e} of ${c}`,n-r-20,d+10)}return i.success("✅ Appeal Report PDF generated"),a.output("blob")}catch(o){throw i.error("❌ Failed to generate appeal report:",o),console.error("Appeal report generation error details:",o),console.error("Stack trace:",o instanceof Error?o.stack:"No stack trace"),o instanceof Error?o:new Error("Failed to generate appeal report PDF")}}static checkPageOverflow(e,t,o,i,a){return t+o>i-a?(e.addPage(),20):t}static addPageHeader(e,t,o){const i=e.internal.pageSize.width;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const a=`${t.organization.name} - Warning Document (Continued)`;e.text(a,20,10);const n=`Page ${o}`;e.text(n,i-40,10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(20,12,i-20,12)}static getWarningLevelDisplay(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"}[e]||e.replace("_"," ").toUpperCase()}static getWarningLevelTitle(e){return{counselling:"COUNSELLING SESSION RECORD",verbal:"VERBAL WARNING NOTICE",first_written:"FIRST WRITTEN WARNING",second_written:"SECOND WRITTEN WARNING",final_written:"FINAL WRITTEN WARNING",suspension:"SUSPENSION NOTICE",dismissal:"DISMISSAL NOTICE"}[e]||"WARNING NOTICE"}static formatDate(e){let t;return t=e?void 0!==e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:"string"==typeof e||"number"==typeof e?new Date(e):new Date:new Date,t.toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})}static wrapText(e,t,o){const i=t.split(" "),a=[];let n="";return i.forEach(t=>{const i=n+(n?" ":"")+t;e.getTextWidth(i)<=o?n=i:(n&&a.push(n),n=t)}),n&&a.push(n),a}static calculateIncidentSectionHeight(e,t,o,i){let a=25;const n=t.description&&""!==t.description.trim()?t.description:"[Incident description not provided - complete in wizard]";a+=4*this.wrapText(e,n,o-2*i-6).length;const s=t.description&&""!==t.description.trim(),r=t.incidentLocation&&""!==t.incidentLocation.trim();return!s&&!r&&(a+=10),Math.max(a,45)}static parseColor(e){if(!e)return null;if(e.startsWith("#")){const t=e.substring(1);if(6===t.length)return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}return null}static async generateSimplifiedPDF(t){try{const{default:o}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),i=new o({orientation:"portrait",unit:"mm",format:"a4",compress:!0});let a=20;const n=15,s=6;i.setFont("helvetica","normal"),i.setFontSize(16),i.text("DISCIPLINARY WARNING",n,a),a+=2*s,i.setFontSize(12),t.organization?.name&&(i.text(`Organization: ${t.organization.name}`,n,a),a+=s),a+=s,i.setFontSize(11),i.text("EMPLOYEE DETAILS:",n,a),a+=s,i.setFontSize(10);[`Name: ${t.employee.firstName} ${t.employee.lastName}`,`Employee ID: ${t.employee.employeeNumber}`,`Department: ${t.employee.department}`,`Position: ${t.employee.position}`].forEach(e=>{i.text(e,n+5,a),a+=s}),a+=s,i.setFontSize(11),i.text("WARNING DETAILS:",n,a),a+=s,i.setFontSize(10);[`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,`Location: ${t.incidentLocation||"Not specified"}`].forEach(e=>{i.text(e,n+5,a),a+=s}),a+=s,i.setFontSize(11),i.text("INCIDENT DESCRIPTION:",n,a),a+=s,i.setFontSize(10);const r=170;i.splitTextToSize(t.description,r).forEach(e=>{a>270&&(i.addPage(),a=20),i.text(e,n+5,a),a+=s}),a+=2*s,a>240&&(i.addPage(),a=20),i.setFontSize(11),i.text("SIGNATURES:",n,a),a+=2*s,i.setFontSize(10),i.text("Manager: ________________________",n,a),a+=s,i.text(`Date: ${t.issuedDate.toLocaleDateString()}`,n,a),a+=3*s,i.text("Employee: _______________________ ",n,a),a+=s,i.text("Date: _______________",n,a);const l=i.internal.pageSize.height;i.setFontSize(8),i.text("Generated by HR System - Simplified for mobile device",n,l-10);const c=i.output("blob");return window.gc&&setTimeout(()=>window.gc(),100),c}catch(o){return i.error("❌ Simplified PDF generation failed:",o),this.generatePlainTextPDF(t)}}static async generatePlainTextPDF(t){try{const{default:o}=await e(async()=>{const{default:e}=await import("./pdf-vendor-tUwojRr6.js").then(e=>e.j);return{default:e}},[]),i=new o;i.setFontSize(12);let a=20;const n=10;return["DISCIPLINARY WARNING","",`Employee: ${t.employee.firstName} ${t.employee.lastName}`,`Date: ${t.issuedDate.toLocaleDateString()}`,`Category: ${t.category}`,`Level: ${t.warningLevel}`,"","Description:",t.description,"","This is a simplified version generated for older devices."].forEach(e=>{a>280&&(i.addPage(),a=20),i.text(e,20,a),a+=n}),i.output("blob")}catch(o){throw i.error("❌ Even plain text PDF failed:",o),new Error("PDF generation not supported on this device")}}}export{a as PDFGenerationService};
