import{a as D}from"./pdf-vendor-D1mz_3s2.js";import{v as x,P as F,L as g}from"./business-owner-dashboard-mIihUYS1.js";import"./react-vendor-e4uWabrV.js";import"./firebase-vendor-ZA7KOHFb.js";import"./ui-vendor-DaBpJB-Q.js";class d{static async generateWarningPDF(e){try{const t=x||{isLegacyDevice:!1},i=F(t);if(t.isLegacyDevice)return console.warn("üö® Legacy device detected - using simplified PDF generation"),this.generateSimplifiedPDF(e);g.debug(2688),console.log("üìä Input data validation:",{hasEmployee:!!e.employee,hasOrganization:!!e.organization,hasIncidentData:!!(e.description||e.incidentLocation),employeeName:e.employee?`${e.employee.firstName} ${e.employee.lastName}`:"Missing",organizationName:e.organization?.name||"Missing",warningLevel:e.warningLevel,category:e.category});const n=Date.now();g.debug(3310);const{default:o}=await D(async()=>{const{default:_}=await import("./pdf-vendor-D1mz_3s2.js").then(m=>m.j);return{default:_}},[]);g.debug(3436);const s=new o({orientation:"portrait",unit:"mm",format:"a4",compress:!0});g.success(3579),s.setFont("helvetica","normal");let l=15;const r=s.internal.pageSize.width,a=s.internal.pageSize.height,c=20,h=40;g.debug(3950),g.debug("üè¢ Adding organization header..."),l=this.addOrganizationHeader(s,e.organization,l,r,c),g.success(4172),g.debug("üìù Adding document title..."),l=this.addDocumentTitle(s,e,l,r,c,a,h),g.success(4459),g.debug("üë§ Adding employee section..."),l=this.addEmployeeSection(s,e.employee,l,r,c,a,h),g.success(4759),g.debug("‚ö†Ô∏è Adding warning details section..."),l=this.addWarningDetailsSection(s,e,l,r,c,a,h),g.success(5060),g.debug("üìã Adding incident details section..."),l=this.addIncidentDetailsSection(s,e,l,r,c,a,h),g.success(5387),e.disciplineRecommendation?(g.debug("üìà Adding progressive discipline section..."),l=this.addProgressiveDisciplineSection(s,e.disciplineRecommendation,l,r,c,a,h),g.success(5796)):g.debug("‚è≠Ô∏è Skipping progressive discipline section (no data)"),e.legalCompliance?(g.debug("‚öñÔ∏è Adding legal compliance section..."),l=this.addLegalComplianceSection(s,e.legalCompliance,l,r,c,a,h),g.success(6262)):g.debug("‚è≠Ô∏è Skipping legal compliance section (no data)"),e.additionalNotes?(g.debug("üìù Adding additional notes section..."),l=this.addAdditionalNotesSection(s,e.additionalNotes,l,r,c,a,h),g.success(6716)):g.debug("‚è≠Ô∏è Skipping additional notes section (no data)"),g.debug("‚úçÔ∏è Adding signatures section..."),l=this.addSignaturesSection(s,e.signatures,e.employee,l,r,c,a,h),g.success(7166),e.deliveryChoice?(g.debug("üìÆ Adding delivery section..."),l=this.addDeliverySection(s,e.deliveryChoice,l,r,c,a,h),g.success(7512)):g.debug("‚è≠Ô∏è Skipping delivery section (no data)"),g.debug("ü¶∂ Adding document footer..."),this.addDocumentFooter(s,e,r),g.success(7804),g.debug("üõ°Ô∏è Adding security watermark..."),this.addSecurityWatermark(s,r),g.success(7997),g.debug("üîÑ Generating PDF blob...");const u=s.output("blob"),p=Date.now();return console.log("‚úÖ Resilient PDF generated successfully:",{warningId:e.warningId,employee:`${e.employee.firstName} ${e.employee.lastName}`,size:`${(u.size/1024).toFixed(1)} KB`,time:`${p-n}ms`}),u}catch(t){throw g.error("‚ùå PDF generation failed:",t),new Error(`PDF generation failed: ${t instanceof Error?t.message:"Unknown error"}`)}}static addOrganizationHeader(e,t,i,n,o){const s=this.parseColor(t.branding?.colors?.primary)||{r:59,g:130,b:246};e.setFillColor(s.r,s.g,s.b),e.rect(0,0,n,35,"F");let l=0;if(t.branding?.logo)try{l=30,e.addImage(t.branding.logo,"PNG",o,7,l,20),g.debug("Added organization logo to PDF header")}catch(c){g.warn("Failed to add organization logo to PDF:",c),l=0}e.setTextColor(255,255,255),e.setFontSize(20),e.setFont("helvetica","bold");const r=t.branding?.companyName||t.name||"Organization Name";e.text(r,o+l+(l>0?10:0),15),e.setFontSize(10),e.setFont("helvetica","normal");const a=[];return t.address&&a.push(t.address),t.phone&&a.push(`Tel: ${t.phone}`),t.email&&a.push(`Email: ${t.email}`),a.length>0&&e.text(a.join(" | "),o,25),t.registrationNumber&&e.text(`Registration: ${t.registrationNumber}`,o,30),45}static addDocumentTitle(e,t,i,n,o,s,l){i=this.checkPageOverflow(e,i,30,s,l),e.setTextColor(0,0,0),e.setFontSize(18),e.setFont("helvetica","bold");const r=this.getWarningLevelTitle(t.warningLevel),a=e.getTextWidth(r),c=(n-a)/2;if(e.text(r,c,i),t.employee?.firstName==="Employee"||t.category==="Category Not Selected"||!t.description?.trim()){e.setFontSize(12),e.setTextColor(200,50,50);const m="[DRAFT - INCOMPLETE DATA]",S=e.getTextWidth(m),f=(n-S)/2;e.text(m,f,i+6),i+=6}e.setTextColor(0,0,0),e.setLineWidth(.5),e.line(c,i+2,c+a,i+2),e.setFontSize(10),e.setFont("helvetica","normal");const u=`Document ID: ${t.warningId} | Issue Date: ${this.formatDate(t.issuedDate)}`,p=e.getTextWidth(u),_=(n-p)/2;return e.text(u,_,i+8),i+20}static addEmployeeSection(e,t,i,n,o,s,l){i=this.checkPageOverflow(e,i,40,s,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("EMPLOYEE INFORMATION",o,i);const r=t.firstName==="Employee"||t.lastName==="Not Selected";r?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(o,i+2,n-o*2,25),r&&(e.setFillColor(255,245,245),e.rect(o+1,i+3,n-o*2-2,23,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),r?e.setTextColor(150,0,0):e.setTextColor(0,0,0);const a=[`Name: ${t.firstName} ${t.lastName}`,`Employee ID: ${t.employeeNumber}`,`Position: ${t.position}`,`Department: ${t.department}`];t.email&&t.email!==""&&a.push(`Email: ${t.email}`),r&&a.push("‚ö†Ô∏è Complete employee selection in wizard for full details");let c=i+8;return a.forEach(h=>{e.text(h,o+3,c),c+=4}),i+35}static addWarningDetailsSection(e,t,i,n,o,s,l){i=this.checkPageOverflow(e,i,25,s,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("WARNING DETAILS",o,i);const r=t.category==="Category Not Selected";e.setFontSize(10),e.setFont("helvetica","normal"),r?e.setTextColor(150,0,0):e.setTextColor(0,0,0);let a=i+8;e.text(`Warning Level: ${this.getWarningLevelDisplay(t.warningLevel)}`,o,a),a+=5;const c=t.category&&t.category!=="Unknown"&&t.category!=="Category Not Selected"?t.category:"General Misconduct";return e.text(`Category: ${c}`,o,a),a+=5,t.validityPeriod&&(e.text(`Validity Period: ${t.validityPeriod} months`,o,a),a+=5),a+5}static addIncidentDetailsSection(e,t,i,n,o,s,l){const r=this.calculateIncidentSectionHeight(e,t,n,o);i=this.checkPageOverflow(e,i,r,s,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("INCIDENT DETAILS",o,i);const a=t.description&&t.description.trim()!=="",c=t.incidentLocation&&t.incidentLocation.trim()!=="",h=!a&&!c,u=this.calculateIncidentSectionHeight(e,t,n,o);h?e.setDrawColor(255,200,200):e.setDrawColor(200,200,200),e.setLineWidth(.3),e.rect(o,i+2,n-o*2,u),h&&(e.setFillColor(255,245,245),e.rect(o+1,i+3,n-o*2-2,u-2,"F")),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let p=i+10;e.setFont("helvetica","bold"),e.text("Date & Time:",o+3,p),e.setFont("helvetica","normal"),e.text(`${this.formatDate(t.incidentDate)} at ${t.incidentTime}`,o+30,p),p+=6,e.setFont("helvetica","bold"),e.setTextColor(0,0,0),e.text("Location:",o+3,p),e.setFont("helvetica","normal");const _=c?t.incidentLocation:"Not specified";e.text(_,o+25,p),p+=6,e.setFont("helvetica","bold"),e.text("Description:",o+3,p),p+=5,e.setFont("helvetica","normal");const m=a?t.description:"Details to be completed";return this.wrapText(e,m,n-o*2-6).forEach(f=>{e.text(f,o+3,p),p+=4}),i+u+10}static addProgressiveDisciplineSection(e,t,i,n,o,s,l){if(!t)return i;i=this.checkPageOverflow(e,i,35,s,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("PROGRESSIVE DISCIPLINE ANALYSIS",o,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=i+8;return e.text(`Recommended Level: ${this.getWarningLevelDisplay(t.suggestedLevel)}`,o,r),r+=5,e.text(`Previous Warnings: ${t.warningCount}`,o,r),r+=5,t.reason&&(e.text("Escalation Reason:",o,r),r+=4,this.wrapText(e,t.reason,n-o*2).forEach(c=>{e.text(c,o+3,r),r+=4})),r+5}static addLegalComplianceSection(e,t,i,n,o,s,l){if(!t)return i;i=this.checkPageOverflow(e,i,30,s,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("LEGAL COMPLIANCE",o,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=i+8;return e.text(`Framework: ${t.framework}`,o,r),r+=5,e.text(`Compliance Status: ${t.isCompliant?"COMPLIANT":"NON-COMPLIANT"}`,o,r),r+=5,t.requirements.length>0&&(e.text("Legal Requirements:",o,r),r+=4,t.requirements.forEach(a=>{e.text(`‚Ä¢ ${a}`,o+3,r),r+=4})),r+5}static addAdditionalNotesSection(e,t,i,n,o,s,l){const r=this.wrapText(e,t,n-o*2),a=15+r.length*4;i=this.checkPageOverflow(e,i,a,s,l),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("ADDITIONAL NOTES",o,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let c=i+8;return r.forEach(h=>{e.text(h,o,c),c+=4}),c+5}static addSignaturesSection(e,t,i,n,o,s,l,r){n=this.checkPageOverflow(e,n,50,l,r),e.setFontSize(14),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("SIGNATURES",s,n);const a=(o-s*3)/2,c=30;if(e.setDrawColor(150,150,150),e.setLineWidth(.3),e.rect(s,n+5,a,c),e.setFontSize(10),e.setFont("helvetica","normal"),e.text("Manager Signature:",s+2,n+12),t?.manager)try{const h=a-4;e.addImage(t.manager,"PNG",s+2,n+15,h,15),e.setFontSize(8),e.text(`Date: ${this.formatDate(new Date)}`,s+2,n+32)}catch(h){g.warn("Failed to embed manager signature image:",h),e.setFontSize(8),e.text("‚úì Digitally Signed",s+2,n+20),e.text(`Date: ${this.formatDate(new Date)}`,s+2,n+25)}else e.text("_________________________",s+2,n+25),e.text("Date: ___________",s+2,n+30);if(e.rect(s+a+10,n+5,a,c),e.text("Employee Signature:",s+a+12,n+12),e.text(`${i.firstName} ${i.lastName}`,s+a+12,n+16),t?.employee)try{const h=a-4;e.addImage(t.employee,"PNG",s+a+12,n+15,h,15),e.setFontSize(8),e.text(`Date: ${this.formatDate(new Date)}`,s+a+12,n+32)}catch(h){g.warn("Failed to embed employee signature image:",h),e.setFontSize(8),e.text("‚úì Digitally Signed",s+a+12,n+20),e.text(`Date: ${this.formatDate(new Date)}`,s+a+12,n+25)}else e.text("_________________________",s+a+12,n+25),e.text("Date: ___________",s+a+12,n+30);return n+c+15}static addDeliverySection(e,t,i,n,o,s,l){if(!t)return i;i=this.checkPageOverflow(e,i,20,s,l),e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(51,51,51),e.text("DELIVERY INFORMATION",o,i),e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(0,0,0);let r=i+6;return e.text(`Delivery Method: ${t.method.toUpperCase()}`,o,r),r+=4,e.text(`Delivery Date: ${this.formatDate(t.timestamp)}`,o,r),r+=4,e.text(`Authorized by: ${t.chosenBy}`,o,r),r+8}static addDocumentFooter(e,t,i){const n=e.internal.pageSize.height,o=e.getNumberOfPages();for(let s=1;s<=o;s++){e.setPage(s),e.setDrawColor(180,180,180),e.setLineWidth(.3),e.line(20,n-25,i-20,n-25),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(120,120,120);const l="This document has been generated electronically and constitutes an official warning as per LRA Section 188.",r=e.getTextWidth(l),a=(i-r)/2;e.text(l,a,n-20);const c="CONFIDENTIAL DOCUMENT - For authorized personnel only",h=e.getTextWidth(c),u=(i-h)/2;e.text(c,u,n-15),e.text(`Generated: ${new Date().toLocaleString()}`,20,n-10),e.text(`Page ${s} of ${o}`,i-50,n-10)}}static addSecurityWatermark(e,t){const i=e.internal.pageSize.height,n=e.getNumberOfPages();for(let o=1;o<=n;o++){e.setPage(o),e.saveGraphicsState(),e.setGState(new e.GState({opacity:.1})),e.setTextColor(150,150,150),e.setFontSize(40),e.setFont("helvetica","bold");const s=t/2,l=i/2;e.text("OFFICIAL WARNING",s,l,{angle:45,align:"center"}),e.restoreGraphicsState()}}static checkPageOverflow(e,t,i,n,o){const s=n-o;return t+i>s?(g.debug(29714),e.addPage(),20):t}static addPageHeader(e,t,i){const n=e.internal.pageSize.width;e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(100,100,100);const o=`${t.organization.name} - Warning Document (Continued)`;e.text(o,20,10);const s=`Page ${i}`;e.text(s,n-40,10),e.setDrawColor(200,200,200),e.setLineWidth(.3),e.line(20,12,n-20,12)}static getWarningLevelDisplay(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning",suspension:"Suspension",dismissal:"Dismissal"}[e]||e.replace("_"," ").toUpperCase()}static getWarningLevelTitle(e){return{counselling:"COUNSELLING SESSION RECORD",verbal:"VERBAL WARNING NOTICE",first_written:"FIRST WRITTEN WARNING",second_written:"SECOND WRITTEN WARNING",final_written:"FINAL WRITTEN WARNING",suspension:"SUSPENSION NOTICE",dismissal:"DISMISSAL NOTICE"}[e]||"WARNING NOTICE"}static formatDate(e){return e.toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})}static wrapText(e,t,i){const n=t.split(" "),o=[];let s="";return n.forEach(l=>{const r=s+(s?" ":"")+l;e.getTextWidth(r)<=i?s=r:(s&&o.push(s),s=l)}),s&&o.push(s),o}static calculateIncidentSectionHeight(e,t,i,n){let o=25;const s=t.description&&t.description.trim()!==""?t.description:"[Incident description not provided - complete in wizard]",l=this.wrapText(e,s,i-n*2-6);o+=l.length*4;const r=t.description&&t.description.trim()!=="",a=t.incidentLocation&&t.incidentLocation.trim()!=="";return!r&&!a&&(o+=10),Math.max(o,45)}static parseColor(e){if(!e)return null;if(e.startsWith("#")){const t=e.substring(1);if(t.length===6)return{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}}return null}static async generateSimplifiedPDF(e){try{console.log("üö® Generating simplified PDF for legacy device...");const{default:t}=await D(async()=>{const{default:p}=await import("./pdf-vendor-D1mz_3s2.js").then(_=>_.j);return{default:p}},[]),i=new t({orientation:"portrait",unit:"mm",format:"a4",compress:!0});let n=20;const o=15,s=6;i.setFont("helvetica","normal"),i.setFontSize(16),i.text("DISCIPLINARY WARNING",o,n),n+=s*2,i.setFontSize(12),e.organization?.name&&(i.text(`Organization: ${e.organization.name}`,o,n),n+=s),n+=s,i.setFontSize(11),i.text("EMPLOYEE DETAILS:",o,n),n+=s,i.setFontSize(10),[`Name: ${e.employee.firstName} ${e.employee.lastName}`,`Employee ID: ${e.employee.employeeNumber}`,`Department: ${e.employee.department}`,`Position: ${e.employee.position}`].forEach(p=>{i.text(p,o+5,n),n+=s}),n+=s,i.setFontSize(11),i.text("WARNING DETAILS:",o,n),n+=s,i.setFontSize(10),[`Date: ${e.issuedDate.toLocaleDateString()}`,`Category: ${e.category}`,`Level: ${e.warningLevel}`,`Location: ${e.incidentLocation||"Not specified"}`].forEach(p=>{i.text(p,o+5,n),n+=s}),n+=s,i.setFontSize(11),i.text("INCIDENT DESCRIPTION:",o,n),n+=s,i.setFontSize(10),i.splitTextToSize(e.description,170).forEach(p=>{n>270&&(i.addPage(),n=20),i.text(p,o+5,n),n+=s}),n+=s*2,n>240&&(i.addPage(),n=20),i.setFontSize(11),i.text("SIGNATURES:",o,n),n+=s*2,i.setFontSize(10),i.text("Manager: ________________________",o,n),n+=s,i.text(`Date: ${e.issuedDate.toLocaleDateString()}`,o,n),n+=s*3,i.text("Employee: _______________________ ",o,n),n+=s,i.text("Date: _______________",o,n);const h=i.internal.pageSize.height;i.setFontSize(8),i.text("Generated by HR System - Simplified for mobile device",o,h-10),console.log("‚úÖ Simplified PDF generation completed");const u=i.output("blob");return window.gc&&setTimeout(()=>window.gc(),100),u}catch(t){return console.error("‚ùå Simplified PDF generation failed:",t),this.generatePlainTextPDF(e)}}static async generatePlainTextPDF(e){try{const{default:t}=await D(async()=>{const{default:l}=await import("./pdf-vendor-D1mz_3s2.js").then(r=>r.j);return{default:l}},[]),i=new t;i.setFontSize(12);let n=20;const o=10;return["DISCIPLINARY WARNING","",`Employee: ${e.employee.firstName} ${e.employee.lastName}`,`Date: ${e.issuedDate.toLocaleDateString()}`,`Category: ${e.category}`,`Level: ${e.warningLevel}`,"","Description:",e.description,"","This is a simplified version generated for older devices."].forEach(l=>{n>280&&(i.addPage(),n=20),i.text(l,20,n),n+=o}),i.output("blob")}catch(t){throw console.error("‚ùå Even plain text PDF failed:",t),new Error("PDF generation not supported on this device")}}}export{d as PDFGenerationService};
