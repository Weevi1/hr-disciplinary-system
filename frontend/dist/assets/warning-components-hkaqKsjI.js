import{j as e,L as s,u as t,r as a,v as l,N as r,A as i}from"./business-owner-dashboard-DtOK4El9.js";import{r as n}from"./react-vendor-CWjEGAcE.js";import{af as d,ac as o,M as c,X as x,aG as m,aH as u,a as g,b as p,L as h,a9 as b,F as v,U as f,I as y,x as j,a7 as N,B as w,aj as D,aI as C,i as k,aJ as S,at as A,R as W,k as P,A as L,h as F,N as I,e as E,s as R,t as _,g as O}from"./ui-vendor-zQeyjr6j.js";import"./pdf-vendor-tUwojRr6.js";import"./firebase-vendor-BQc9GSQK.js";const $={email:{icon:c,name:"Email",color:"blue",requiresProof:!0,instructions:["Send the warning document via email","Take a screenshot of the sent email","Include timestamp and recipient email visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Chrome: Press Ctrl + Shift + Alt + 3"]},whatsapp:{icon:o,name:"WhatsApp Business",color:"green",requiresProof:!0,instructions:["Send the warning document via WhatsApp Business","Wait for delivery confirmation (double blue ticks)","Take a screenshot showing the sent message","Include timestamp and delivery status visible","Upload the screenshot as proof of delivery"],screenshotTips:["Windows: Press Ctrl + Shift + S","Mac: Press Cmd + Shift + 4","Phone: Use screenshot function (varies by device)"]},printed:{icon:d,name:"Print & Hand Delivery",color:"purple",requiresProof:!1,instructions:["Print the warning document","Hand deliver to the employee","Get employee acknowledgment signature on physical copy","File the signed copy in employee records","Confirm delivery completion below"]}},U=({isOpen:s,onClose:t,warningId:a,employeeName:l,deliveryMethod:r,onDeliveryConfirmed:i})=>{const[d,o]=n.useState(null),[c,v]=n.useState(null),[f,y]=n.useState(!1),[j,N]=n.useState(null),w=n.useRef(null),D=$[r],C=n.useCallback(e=>{const s=e.target.files?.[0];if(!s)return;if(!s.type.startsWith("image/"))return void N("Please select an image file (PNG, JPG, etc.)");if(s.size>5242880)return void N("Image must be less than 5MB");N(null),o(s);const t=new FileReader;t.onload=e=>{v(e.target?.result)},t.readAsDataURL(s)},[]),k=n.useCallback(e=>{e.preventDefault(),e.stopPropagation()},[]),S=n.useCallback(e=>{e.preventDefault(),e.stopPropagation();const s=e.dataTransfer.files;if(s.length>0){const e=s[0];if(e.type.startsWith("image/")){C({target:{files:[e]}})}}},[C]),A=n.useCallback(async()=>{if(!D.requiresProof||d){y(!0),N(null);try{await i({warningId:a,deliveryMethod:r,deliveredAt:new Date,proofImage:d||void 0})}catch(e){N(e instanceof Error?e.message:"Failed to confirm delivery")}finally{y(!1)}}else N("Please upload proof of delivery screenshot")},[D.requiresProof,d,i,a,r]),W=n.useCallback(()=>{o(null),v(null),w.current&&(w.current.value="")},[]);if(!s)return null;const P=D.icon;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsx("div",{className:`bg-gradient-to-r from-${D.color}-600 to-${D.color}-700 p-6 text-white`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(P,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Confirm Delivery"}),e.jsxs("p",{className:"text-sm opacity-90",children:[D.name," delivery for ",l]})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:e.jsx(x,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 max-h-[calc(90vh-140px)] overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Delivery Instructions"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsx("ol",{className:"space-y-2",children:D.instructions.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[e.jsx("span",{className:"bg-blue-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-medium flex-shrink-0 mt-0.5",children:t+1}),e.jsx("span",{className:"text-gray-700",children:s})]},t))})})]}),D.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-gray-600"}),"Screenshot Instructions"]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:D.screenshotTips?.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("kbd",{className:"bg-gray-200 px-2 py-1 rounded text-xs font-mono",children:s.split(": ")[1]}),e.jsx("span",{className:"text-xs",children:s.split(": ")[0]})]},t))})})]}),D.requiresProof&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Upload Proof of Delivery"}),d?e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[c&&e.jsx("img",{src:c,alt:"Proof of delivery",className:"w-24 h-24 object-cover rounded-lg border"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:d.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(d.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:W,className:"text-red-600 hover:text-red-700 p-1",children:e.jsx(x,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(g,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-700",children:"Ready to upload"})]})]})]})}):e.jsxs("div",{onDragOver:k,onDrop:S,className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer",onClick:()=>w.current?.click(),children:[e.jsx(u,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"Drop screenshot here or click to browse"}),e.jsx("p",{className:"text-sm text-gray-500",children:"PNG, JPG up to 5MB"}),e.jsx("input",{ref:w,type:"file",accept:"image/*",onChange:C,className:"hidden"})]})]}),j&&e.jsx("div",{className:"mb-6 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:j})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:t,disabled:f,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:f||D.requiresProof&&!d,className:`flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-${D.color}-600 to-${D.color}-700 hover:from-${D.color}-700 hover:to-${D.color}-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed`,children:f?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 animate-spin"}),"Confirming..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4"}),"Confirm Delivery"]})})]})]})]})})},T=[{value:"procedural_unfair",label:"Procedural Unfairness",description:"The disciplinary process was not followed correctly"},{value:"substantive_unfair",label:"Substantive Unfairness",description:"The warning was not justified by the facts"},{value:"bias_prejudice",label:"Bias or Prejudice",description:"The decision was influenced by bias or unfair treatment"},{value:"insufficient_evidence",label:"Insufficient Evidence",description:"Not enough evidence to support the warning"},{value:"inconsistent_treatment",label:"Inconsistent Treatment",description:"Others were treated differently for similar conduct"},{value:"other",label:"Other Grounds",description:"Different reason (explain in details below)"}],M=({isOpen:s,onClose:t,warning:a,onAppealSubmit:l})=>{const[r,i]=n.useState(""),[d,o]=n.useState(""),[c,m]=n.useState(""),[u,b]=n.useState(!1),[N,w]=n.useState(null),D=a.issueDate?.seconds?new Date(1e3*a.issueDate.seconds):new Date(a.issueDate),C=new Date(D);C.setDate(C.getDate()+30);const k=n.useCallback(async()=>{if(r)if(d.trim())if(c.trim()){b(!0),w(null);try{await l({warningId:a.id,grounds:r,additionalDetails:d.trim(),requestedOutcome:c.trim()})}catch(e){w(e instanceof Error?e.message:"Failed to submit appeal")}finally{b(!1)}}else w("Please specify what outcome you are requesting");else w("Please provide details explaining your appeal");else w("Please select grounds for your appeal")},[r,d,c,l,a.id]);return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-amber-600 to-orange-700 p-6 text-white flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-xl",children:e.jsx(v,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Appeal Disciplinary Warning"}),e.jsx("p",{className:"text-sm opacity-90",children:"Submit formal appeal as per Labour Relations Act"})]})]}),e.jsx("button",{onClick:t,disabled:u,className:"p-2 hover:bg-white/20 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(x,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"p-6 flex-1 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Employee:"}),e.jsx("div",{className:"font-medium",children:a.employeeName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Warning Level:"}),e.jsx("div",{className:"font-medium capitalize",children:a.level.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Category:"}),e.jsx("div",{className:"font-medium",children:a.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),e.jsx("div",{className:"font-medium",children:D.toLocaleDateString()})]})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Description:"}),e.jsx("div",{className:"text-sm mt-1 p-2 bg-white rounded border",children:a.description})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"text-blue-800 font-medium mb-2",children:"Your Appeal Rights"}),e.jsxs("ul",{className:"text-blue-700 space-y-1 text-xs",children:[e.jsxs("li",{children:["• Appeals must be submitted within ",e.jsx("strong",{children:"30 days"})," of the warning (deadline: ",C.toLocaleDateString(),")"]}),e.jsx("li",{children:"• You have the right to fair treatment under the Labour Relations Act"}),e.jsx("li",{children:"• All internal procedures must be exhausted before CCMA referral"}),e.jsx("li",{children:"• You may be assisted by a shop steward or fellow employee"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-3",children:"Grounds for Appeal *"}),e.jsx("div",{className:"space-y-2",children:T.map(s=>e.jsxs("label",{className:"flex items-start gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"appealGrounds",value:s.value,checked:r===s.value,onChange:e=>i(e.target.value),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm text-gray-900",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]})]},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Appeal Details *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Explain in detail why you believe the warning is unfair and what evidence supports your appeal."}),e.jsx("textarea",{value:d,onChange:e=>o(e.target.value),rows:5,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"Provide specific facts, dates, witnesses, and any other relevant information that supports your appeal..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Requested Outcome *"}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Specify what you would like to happen if your appeal is successful."}),e.jsx("textarea",{value:c,onChange:e=>m(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 text-sm",placeholder:"E.g., 'Remove warning from my record', 'Reduce warning level', 'Replace with verbal counselling', etc."})]})]}),N&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:N})]})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsxs("span",{children:["Appeal deadline: ",C.toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:t,disabled:u,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:k,disabled:u||!r||!d.trim()||!c.trim(),className:"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-amber-600 to-orange-700 hover:from-amber-700 hover:to-orange-800 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 animate-spin"}),"Submitting Appeal..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4"}),"Submit Appeal"]})})]})]})]})}):null},q=[{value:"upheld",label:"Uphold Warning",icon:k,color:"text-green-600",bgColor:"bg-green-50",description:"Warning is justified and remains unchanged"},{value:"reduced",label:"Reduce Warning Level",icon:S,color:"text-orange-600",bgColor:"bg-orange-50",description:"Warning is justified but level should be reduced"},{value:"modified",label:"Modify Warning",icon:A,color:"text-blue-600",bgColor:"bg-blue-50",description:"Warning content needs modification"},{value:"overturned",label:"Overturn Warning",icon:W,color:"text-red-600",bgColor:"bg-red-50",description:"Warning is not justified and should be removed"}],z=[{value:"counselling",label:"Counselling",severity:1},{value:"verbal",label:"Verbal Warning",severity:2},{value:"first_written",label:"First Written Warning",severity:3},{value:"second_written",label:"Second Written Warning",severity:4},{value:"final_written",label:"Final Written Warning",severity:5}],B={procedural_unfair:"Procedural Unfairness",substantive_unfair:"Substantive Unfairness",bias_prejudice:"Bias or Prejudice",insufficient_evidence:"Insufficient Evidence",inconsistent_treatment:"Inconsistent Treatment",other:"Other Grounds"},G=({isOpen:t,onClose:a,warning:l,onDecisionSubmit:r})=>{const[i,d]=n.useState(""),[o,c]=n.useState(""),[m,u]=n.useState(""),[g,p]=n.useState(l.level),[h,b]=n.useState(l.description),[k,S]=n.useState(!1),[A,W]=n.useState(""),[L,F]=n.useState(!1),I=e=>{if(!e)return"Unknown";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString("en-ZA",{year:"numeric",month:"long",day:"numeric"})},E=n.useCallback(async()=>{if(i&&o.trim()){F(!0);try{await r({warningId:l.id,decision:i,reasoning:o.trim(),newLevel:"reduced"===i||"modified"===i?g:void 0,newDescription:"modified"===i?h:void 0,hrNotes:m.trim(),followUpRequired:k,followUpDate:k&&A?new Date(A):void 0}),a()}catch(e){s.error("Failed to submit appeal decision:",e),alert("Failed to submit decision. Please try again.")}finally{F(!1)}}else alert("Please select a decision and provide reasoning.")},[i,o,m,g,h,k,A,l.id,r,a]),R=z.find(e=>e.value===l.level)?.severity||0,_=z.filter(e=>e.severity<R);return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Appeal Review"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review and decide on employee appeal"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(x,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-gray-600"}),"Original Warning Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Employee:"}),e.jsxs("span",{className:"text-sm",children:[l.employeeName," (",l.employeeNumber,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Department:"}),e.jsx("span",{className:"text-sm",children:l.department})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Issue Date:"}),e.jsx("span",{className:"text-sm",children:I(l.issueDate)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Category:"}),e.jsx("span",{className:"text-sm ml-2",children:l.category})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Level:"}),e.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full "+("final_written"===l.level?"bg-red-100 text-red-800":"second_written"===l.level?"bg-orange-100 text-orange-800":"first_written"===l.level?"bg-yellow-100 text-yellow-800":"verbal"===l.level?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"),children:z.find(e=>e.value===l.level)?.label||l.level})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Description:"}),e.jsx("p",{className:"text-sm mt-1 text-gray-700",children:l.description})]})]})]})]}),l.appealDetails&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-blue-600"}),"Employee's Appeal"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Appeal Grounds:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:B[l.appealDetails.grounds]||l.appealDetails.grounds})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee's Statement:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:l.appealDetails.additionalDetails})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Requested Outcome:"}),e.jsx("p",{className:"text-sm mt-1 px-3 py-2 bg-white rounded border",children:l.appealDetails.requestedOutcome})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-600",children:[e.jsxs("span",{children:["Submitted: ",I(l.appealDetails.submittedDate)]}),e.jsxs("span",{children:["By: ",l.appealDetails.submittedBy]})]})]})]}),e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-gray-600"}),"HR Decision"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-4",children:q.map(s=>{const t=s.icon;return e.jsx("button",{onClick:()=>d(s.value),className:"p-4 rounded-lg border-2 transition-all "+(i===s.value?`border-purple-500 ${s.bgColor}`:"border-gray-200 hover:border-gray-300"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t,{className:`w-5 h-5 ${s.color}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-sm",children:s.label}),e.jsx("div",{className:"text-xs text-gray-600",children:s.description})]})]})},s.value)})}),("reduced"===i||"modified"===i)&&e.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"reduced"===i?"Reduce to Level:":"New Warning Level:"}),e.jsx("select",{value:g,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:"reduced"===i?_.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value)):z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),"modified"===i&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Modified Warning Description:"}),e.jsx("textarea",{value:h,onChange:e=>b(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Enter the modified warning description..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx("span",{className:"text-red-500",children:"*"})," Decision Reasoning (Legal Documentation)"]}),e.jsx("textarea",{value:o,onChange:e=>c(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Provide detailed reasoning for your decision. This will be part of the legal record and may be reviewed by labor courts or CCMA...",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"HR Internal Notes (Optional)"}),e.jsx("textarea",{value:m,onChange:e=>u(e.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Internal notes for HR records (not shared with employee)..."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:e=>S(e.target.checked),className:"rounded border-gray-300 text-purple-600 focus:ring-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Follow-up Required"})]}),k&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Follow-up Date:"}),e.jsx("input",{type:"date",value:A,onChange:e=>W(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{children:"This decision will be automatically documented and employee will be notified"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:E,disabled:!i||!o.trim()||L,className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors flex items-center gap-2",children:L?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4"}),"Submit Decision"]})})]})]})]})}):null},H=(e,s="Unknown")=>null==e?s:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":e instanceof Date?e.toLocaleDateString():"object"==typeof e?e.name?String(e.name):e.title?String(e.title):e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:s:String(e),V=e=>{if(!e.issueDate)return!1;const s=e.issueDate.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),t=new Date(s);t.setDate(t.getDate()+30);return new Date<=t},Y=({organizationId:d,onClose:o,PDFGenerationService:c,DataService:m,canTakeAction:u=!1,userRole:h="viewer",initialEmployeeFilter:b,selectedWarning:f,showDetails:y,onViewDetails:j,onCloseDetails:w})=>{const{user:D,organization:C}=t(),S=d||C?.id,[A,P]=n.useState([]),[$,T]=n.useState([]),[q,z]=n.useState([]),[B,Y]=n.useState(!0),[J,Z]=n.useState(null),[K,Q]=n.useState(1),[X,ee]=n.useState(b?.name||""),[se,te]=n.useState("all"),[ae,le]=n.useState("all"),[re,ie]=n.useState("all"),[ne,de]=n.useState("date"),[oe,ce]=n.useState("desc"),[xe,me]=n.useState(null),[ue,ge]=n.useState(!1),[pe,he]=n.useState(!1),[be,ve]=n.useState(!1),[fe,ye]=n.useState(null),[je,Ne]=n.useState(!1),[we,De]=n.useState(null),[Ce,ke]=n.useState(!1),[Se,Ae]=n.useState(null),[We,Pe]=n.useState("warnings"),Le=n.useCallback(async()=>{if(!S)return s.warn("No organization ID available for loading warnings"),void Y(!1);try{let e;if(Y(!0),Z(null),a())if(l()){e=(await r.getOrganizationWarnings(S,{},{pageSize:500,orderField:"issueDate",orderDirection:"desc"})).warnings,e.length}else e=await i.warnings.getAll(S);else e=await i.warnings.getAll(S),e.length,e.map(e=>`${e.employeeName}: id="${e.id}"`);const t=e.filter(e=>!e.isArchived&&"expired"!==e.status&&"overturned"!==e.status),n=e.filter(e=>"expired"===e.status||"overturned"===e.status),d=t.sort((e,s)=>new Date(s.createdAt||0).getTime()-new Date(e.createdAt||0).getTime()),o=n.sort((e,s)=>new Date(s.appealDecisionDate||s.updatedAt||0).getTime()-new Date(e.appealDecisionDate||e.updatedAt||0).getTime());d.length,o.length,d.map(e=>`${e.employeeName}: id="${e.id}"`),P(d),T(d),z(o),s.success(`📊 Loaded ${d.length} active warnings, ${o.length} archived (${a()?"NESTED":"SHARDED"} structure)`)}catch(e){s.error("❌ Failed to load warnings:",e);const t=e instanceof Error?e.message:"Unknown error";Z(`Failed to load warnings: ${t}`)}finally{Y(!1)}},[S]);n.useEffect(()=>{S?Le():Y(!1)},[S,Le]),n.useEffect(()=>{let e=[...A];if(X){const s=X.toLowerCase();e=e.filter(e=>e.employeeName?.toLowerCase().includes(s)||e.employeeNumber?.toLowerCase().includes(s)||e.category?.toLowerCase().includes(s)||e.description?.toLowerCase().includes(s))}"all"!==se&&(e=e.filter(e=>e.status===se)),"all"!==ae&&(e=e.filter(e=>e.level===ae)),"all"!==re&&(e=e.filter(e=>e.department===re)),e.sort((e,s)=>{let t,a;switch(ne){case"employee":t=e.employeeName,a=s.employeeName;break;case"level":t=e.level,a=s.level;break;case"status":t=e.status||"",a=s.status||"";break;default:t=new Date(e.createdAt||0).getTime(),a=new Date(s.createdAt||0).getTime()}return t<a?"asc"===oe?-1:1:t>a?"asc"===oe?1:-1:0}),T(e),Q(1)},[A,X,se,ae,re,ne,oe]);const Fe=n.useMemo(()=>{const e=new Set(A.map(e=>e.department).filter(e=>e));return Array.from(e).sort()},[A]),Ie=n.useMemo(()=>{const e=10*(K-1),s=e+10,t=$.slice(e,s);return t.map(e=>`${e.employeeName}: id="${e.id}"`),t},[$,K]),Ee=Math.ceil($.length/10),Re=n.useCallback(e=>{e.id,j?j(e):(me(e),ge(!0))},[j]);n.useCallback(()=>{w?w():(ge(!1),me(null))},[w]);const _e=n.useCallback(async e=>{try{if(Y(!0),!e.warningId)throw new Error("Warning ID is missing. Please try again.");if(!S)throw new Error("Organization ID is missing. Please try again.");e.warningId,await i.warnings.update(e.warningId,{appealSubmitted:!0,appealDate:new Date,status:"appealed",appealDetails:{grounds:e.grounds,details:e.additionalDetails,requestedOutcome:e.requestedOutcome,submittedAt:new Date,submittedBy:D?.email||"Employee"}},S),s.success(`Legal appeal submitted for warning ${e.warningId}`),await Le(),Ne(!1),De(null),alert("Appeal submitted successfully. HR will review your appeal within 5 working days as per company policy.")}catch(t){throw s.error("Failed to submit appeal:",t),new Error("Failed to submit appeal. Please try again.")}finally{Y(!1)}},[Le,D]);n.useCallback(async(e,t)=>{try{Y(!0),await i.warnings.update(e,{status:"overturned"===t?"expired":"acknowledged",appealOutcome:t,appealDate:new Date},S),s.success(`Appeal ${t} for warning ${e}`),await Le()}catch(a){s.error("Failed to process appeal:",a),Z("Failed to process appeal")}finally{Y(!1)}},[Le]);const Oe=n.useCallback(async e=>{try{Y(!0);let t="acknowledged";"overturned"===e.decision&&(t="overturned");const a={status:t,appealOutcome:e.decision,appealDecisionDate:new Date,appealReasoning:e.reasoning,hrNotes:e.hrNotes,followUpRequired:e.followUpRequired,followUpDate:e.followUpDate};"reduced"!==e.decision&&"modified"!==e.decision||(e.newLevel&&(a.level=e.newLevel),e.newDescription&&(a.description=e.newDescription)),await i.warnings.update(e.warningId,a,S),"overturned"===e.decision?(await i.warnings.archive(e.warningId,S,"overturned"),s.success("Warning overturned and archived")):e.decision,await Le(),s.success("Appeal decision recorded successfully")}catch(t){throw s.error("Failed to record appeal decision:",t),new Error("Failed to record appeal decision. Please try again.")}finally{Y(!1)}},[Le]);n.useCallback(e=>{e.id,setSelectedWarning(e),setShowDetails(!0)},[]);const $e=n.useCallback(async e=>{try{confirm("Are you sure you want to archive this warning? It will be moved to the archive.")&&(Y(!0),await i.warnings.archive(e,S,"manual"),s.success("Warning archived successfully"),await Le())}catch(t){s.error("Failed to archive warning:",t),Z("Failed to archive warning")}finally{Y(!1)}},[S,Le]);return B?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Loading Warnings"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Please wait..."})]})}):J?e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(p,{className:"w-8 h-8 text-red-500 mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"Error Loading Warnings"}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:J}),e.jsxs("button",{onClick:Le,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 text-sm",children:[e.jsx(W,{className:"w-4 h-4"}),"Retry Loading"]})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Warning Management"}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[A.length," active"]}),q.length>0&&e.jsxs("span",{className:"text-xs sm:text-sm text-gray-500 bg-orange-100 px-2 py-1 rounded-full",children:[q.length," archived"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Pe("archive"===We?"warnings":"archive"),className:"flex items-center gap-2 px-3 py-2 rounded-lg transition-colors text-sm "+("archive"===We?"bg-blue-600 hover:bg-blue-700 text-white":"bg-orange-600 hover:bg-orange-700 text-white"),children:[e.jsx(L,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"archive"===We?"Active Warnings":"Archive"})]}),e.jsx("button",{onClick:Le,disabled:B,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(W,{className:"w-4 h-4 "+(B?"animate-spin":"")})}),o&&e.jsx("button",{onClick:o,className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(x,{className:"w-4 h-4"})})]})]}),"archive"===We?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-gray-600"}),"Warning Archive"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"View expired and overturned warnings with appeal decision history"})]}),e.jsxs("button",{onClick:()=>Pe("warnings"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 rotate-90"}),"Back to Active Warnings"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-8 h-8 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:q.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Archived"})]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-900",children:q.filter(e=>"overturned"===e.status).length}),e.jsx("div",{className:"text-sm text-orange-700",children:"Overturned Appeals"})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-8 h-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:q.filter(e=>"expired"===e.status).length}),e.jsx("div",{className:"text-sm text-blue-700",children:"Naturally Expired"})]})]})})]}),0===q.length?e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx(L,{className:"w-16 h-16 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No archived warnings"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Expired and overturned warnings will appear here"})]}):e.jsx("div",{className:"space-y-3",children:q.map((s,t)=>e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:H(s.employeeName)}),e.jsxs("span",{className:"text-xs text-gray-500",children:[H(s.employeeNumber)," • ",H(s.department)]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Warning Level"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"counselling"===s.level?"Counselling":"verbal"===s.level?"Verbal":"first_written"===s.level?"First Written":"second_written"===s.level?"Second Written":"final_written"===s.level?"Final Written":H(s.level,"Unknown")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:H(s.category)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Issue Date"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.issueDate?new Date(s.issueDate.seconds?1e3*s.issueDate.seconds:s.issueDate).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Status"}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("overturned"===s.status?"bg-orange-100 text-orange-800":"expired"===s.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"overturned"===s.status?"Overturned":"expired"===s.status?"Expired":H(s.status,"Archived")})]})]}),"overturned"===s.status&&s.appealDecisionDate&&e.jsx("div",{className:"bg-orange-50 rounded-lg p-3 border border-orange-200 mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-orange-900 mb-1",children:"Appeal Decision"}),e.jsxs("p",{className:"text-xs text-orange-800 mb-2",children:[e.jsx("strong",{children:"Outcome:"})," ","overturned"===s.appealOutcome?"Warning Overturned":H(s.appealOutcome)]}),s.appealReasoning&&e.jsxs("p",{className:"text-xs text-orange-800 mb-2",children:[e.jsx("strong",{children:"Reasoning:"})," ",H(s.appealReasoning)]}),s.hrNotes&&e.jsxs("p",{className:"text-xs text-orange-800 mb-2",children:[e.jsx("strong",{children:"HR Notes:"})," ",H(s.hrNotes)]}),e.jsxs("p",{className:"text-xs text-orange-700",children:[e.jsx("strong",{children:"Decision Date:"})," ",new Date(s.appealDecisionDate).toLocaleDateString()]})]})]})}),"expired"===s.status&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-200 mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-blue-900 mb-1",children:"Natural Expiry"}),e.jsx("p",{className:"text-xs text-blue-800",children:"This warning expired after its validity period completed without further incidents."}),s.expiryDate&&e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:[e.jsx("strong",{children:"Expired On:"})," ",new Date(s.expiryDate).toLocaleDateString()]})]})]})})]}),e.jsxs("button",{onClick:()=>Re(s),className:"px-3 py-1.5 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors flex items-center gap-1",children:[e.jsx(E,{className:"w-4 h-4"}),"View"]})]})},s.id||`archived-${t}`))})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search warnings...",value:X,onChange:e=>ee(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:se,onChange:e=>te(e.target.value),className:"flex-1 sm:flex-initial px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"issued",children:"Issued"}),e.jsx("option",{value:"acknowledged",children:"Acknowledged"}),e.jsx("option",{value:"appealed",children:"Under Appeal"}),e.jsx("option",{value:"expired",children:"Expired"})]}),e.jsxs("select",{value:ae,onChange:e=>le(e.target.value),className:"flex-1 sm:flex-initial px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Levels"}),e.jsx("option",{value:"counselling",children:"Counselling"}),e.jsx("option",{value:"verbal",children:"Verbal"}),e.jsx("option",{value:"first_written",children:"First Written"}),e.jsx("option",{value:"second_written",children:"Second Written"}),e.jsx("option",{value:"final_written",children:"Final Written"}),e.jsx("option",{value:"written",children:"Written (Legacy)"}),e.jsx("option",{value:"final",children:"Final (Legacy)"}),e.jsx("option",{value:"dismissal",children:"Dismissal (Legacy)"})]}),e.jsxs("button",{onClick:()=>he(!pe),className:"px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors text-sm items-center gap-2 sm:flex hidden",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden lg:inline",children:"More"}),pe?e.jsx(O,{className:"w-4 h-4"}):e.jsx(F,{className:"w-4 h-4"})]})]})]}),pe&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-3",children:[e.jsxs("select",{value:re,onChange:e=>ie(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Departments"}),Fe.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:`${ne}-${oe}`,onChange:e=>{const[s,t]=e.target.value.split("-");de(s),ce(t)},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"date-desc",children:"Newest First"}),e.jsx("option",{value:"date-asc",children:"Oldest First"}),e.jsx("option",{value:"employee-asc",children:"Employee A-Z"}),e.jsx("option",{value:"employee-desc",children:"Employee Z-A"}),e.jsx("option",{value:"level-asc",children:"Level (Low to High)"}),e.jsx("option",{value:"level-desc",children:"Level (High to Low)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs("select",{value:10,onChange:e=>setItemsPerPage(Number(e.target.value)),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-xs font-medium",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:A.length})]}),e.jsx(v,{className:"w-5 h-5 text-gray-500"})]})}),e.jsx("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-600 text-xs font-medium",children:"Active"}),e.jsx("p",{className:"text-lg font-bold text-green-900",children:A.filter(e=>e.isActive).length})]}),e.jsx(g,{className:"w-5 h-5 text-green-500"})]})}),e.jsx("div",{className:"bg-orange-50 p-3 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-600 text-xs font-medium",children:"Undelivered"}),e.jsx("p",{className:"text-lg font-bold text-orange-900",children:A.filter(e=>"delivered"!==e.deliveryStatus).length})]}),e.jsx(I,{className:"w-5 h-5 text-orange-500"})]})}),e.jsx("div",{className:"bg-red-50 p-3 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-600 text-xs font-medium",children:"Critical"}),e.jsx("p",{className:"text-lg font-bold text-red-900",children:A.filter(e=>"final"===e.level||"dismissal"===e.level).length})]}),e.jsx(p,{className:"w-5 h-5 text-red-500"})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[$.length," warnings ",$.length!==A.length&&`(filtered from ${A.length})`]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Page ",K," of ",Ee]})})]}),e.jsx("div",{className:"md:hidden space-y-3 mb-4",children:Ie.map((s,t)=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:H(s.employeeName)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[H(s.employeeNumber)," • ",H(s.department)]})]}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("issued"===s.status?"bg-blue-100 text-blue-800":"acknowledged"===s.status?"bg-green-100 text-green-800":"appealed"===s.status?"bg-orange-100 text-orange-800":"expired"===s.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"issued"===s.status?"Issued":"acknowledged"===s.status?"Acknowledged":"appealed"===s.status?"Under Appeal":"expired"===s.status?"Expired":H(s.status,"Pending")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Level"}),e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full mt-1 "+("counselling"===s.level?"bg-green-100 text-green-800":"verbal"===s.level?"bg-blue-100 text-blue-800":"first_written"===s.level?"bg-yellow-100 text-yellow-800":"second_written"===s.level?"bg-orange-100 text-orange-800":"final_written"===s.level?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"counselling"===s.level?"Counselling":"verbal"===s.level?"Verbal":"first_written"===s.level?"1st Written":"second_written"===s.level?"2nd Written":"final_written"===s.level?"Final":H(s.level,"Unknown")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Category"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-1",children:H(s.category)})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-500",children:s.issueDate?new Date(s.issueDate.seconds?1e3*s.issueDate.seconds:s.issueDate).toLocaleDateString():"N/A"}),e.jsx("button",{onClick:()=>Re(s),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1.5 hover:bg-blue-50 rounded transition-colors",children:"View Details"})]})]},s.id||`warning-${t}`))}),e.jsx("div",{className:"hidden md:block bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Employee"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Warning"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-700 uppercase tracking-wide",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:Ie.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:H(s.employeeName)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[H(s.employeeNumber)," • ",H(s.department)]})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("counselling"===s.level?"bg-green-100 text-green-800":"verbal"===s.level?"bg-blue-100 text-blue-800":"first_written"===s.level?"bg-yellow-100 text-yellow-800":"second_written"===s.level?"bg-orange-100 text-orange-800":"final_written"===s.level?"bg-red-100 text-red-800":"written"===s.level?"bg-yellow-100 text-yellow-800":"final"===s.level||"dismissal"===s.level?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:"counselling"===s.level?"Counselling":"verbal"===s.level?"Verbal":"first_written"===s.level?"First Written":"second_written"===s.level?"Second Written":"final_written"===s.level?"Final Written":"written"===s.level?"Written":"final"===s.level?"Final":"dismissal"===s.level?"Dismissal":H(s.level,"Unknown")})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:H(s.category)}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500",children:s.issueDate?new Date(s.issueDate.seconds?1e3*s.issueDate.seconds:s.issueDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full "+("issued"===s.status?"bg-blue-100 text-blue-800":"acknowledged"===s.status?"bg-green-100 text-green-800":"appealed"===s.status?"bg-orange-100 text-orange-800":"expired"===s.status?"bg-gray-100 text-gray-800":"bg-gray-100 text-gray-600"),children:"issued"===s.status?"Issued":"acknowledged"===s.status?"Acknowledged":"appealed"===s.status?"Under Appeal":"expired"===s.status?"Expired":H(s.status,"Pending")})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Re(s),className:"text-blue-600 hover:text-blue-800 text-xs px-2 py-1 hover:bg-blue-50 rounded transition-colors",children:"View"}),"appealed"===s.status&&e.jsxs("button",{onClick:()=>{Ae(s),ke(!0)},className:"text-purple-600 hover:text-purple-800 text-xs px-2 py-1 hover:bg-purple-50 rounded transition-colors flex items-center gap-1",title:"Review Appeal with Enhanced Decision Options",children:[e.jsx(N,{className:"w-3 h-3"}),"Review Appeal"]}),"delivered"!==s.deliveryStatus&&"appealed"!==s.status&&e.jsx("button",{onClick:()=>{ye(s),ve(!0)},className:"text-orange-600 hover:text-orange-800 text-xs px-2 py-1 hover:bg-orange-50 rounded transition-colors",children:"Deliver"}),"appealed"!==s.status&&V(s)&&e.jsx("button",{onClick:()=>{s.id,s.employeeName,De(s),Ne(!0)},className:"text-amber-600 hover:text-amber-800 text-xs px-2 py-1 hover:bg-amber-50 rounded transition-colors",title:(()=>{const e=s.issueDate.seconds?new Date(1e3*s.issueDate.seconds):new Date(s.issueDate),t=new Date(e);return t.setDate(t.getDate()+30),`Appeal this warning (deadline: ${t.toLocaleDateString()})`})(),children:"Appeal"}),"appealed"!==s.status&&!V(s)&&e.jsx("span",{className:"text-gray-500 text-xs px-2 py-1",title:"Appeal period has expired",children:"Appeal Expired"}),("acknowledged"===s.status||"expired"===s.status||!V(s))&&e.jsx("button",{onClick:()=>$e(s.id),className:"text-gray-600 hover:text-gray-800 text-xs px-2 py-1 hover:bg-gray-50 rounded transition-colors",title:"Archive this warning",children:e.jsx(L,{className:"w-3 h-3"})})]})})]},s.id||`warning-${t}`))})]})})}),0===$.length&&!B&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-8 h-8 text-gray-400 mx-auto mb-3"}),e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-1",children:"No warnings found"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:X||"all"!==se||"all"!==ae||"all"!==re?"Try adjusting your search criteria or filters.":"No warnings have been created yet."}),(X||"all"!==se||"all"!==ae||"all"!==re)&&e.jsx("button",{onClick:()=>{ee(""),te("all"),le("all"),ie("all")},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Clear all filters"})]}),Ee>1&&e.jsxs("div",{className:"flex items-center justify-center mt-4 gap-2",children:[e.jsx("button",{onClick:()=>Q(Math.max(1,K-1)),disabled:1===K,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-sm text-gray-600 bg-gray-50 rounded-lg",children:[K," of ",Ee]}),e.jsx("button",{onClick:()=>Q(Math.min(Ee,K+1)),disabled:K===Ee,className:"px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]}),fe&&e.jsx(U,{isOpen:be,onClose:()=>{ve(!1),ye(null)},warningId:fe.id||"",employeeName:H(fe.employee),deliveryMethod:fe.deliveryMethod||"email",onDeliveryConfirmed:async e=>{try{await i.warnings.updateDeliveryStatus(e.warningId,{status:"delivered",deliveredAt:e.deliveredAt,deliveryMethod:e.deliveryMethod,proofImage:e.proofImage}),await Le(),ve(!1),ye(null)}catch(t){throw s.error("Failed to confirm delivery:",t),t}}}),je&&we&&e.jsx(M,{isOpen:je,onClose:()=>{Ne(!1),De(null)},warning:{id:we.id,employeeName:we.employeeName,category:we.category,level:we.level,issueDate:we.issueDate,description:we.description||"No description provided"},onAppealSubmit:_e}),Ce&&Se&&e.jsx(G,{isOpen:Ce,onClose:()=>{ke(!1),Ae(null)},warning:{id:Se.id,employeeName:Se.employeeName,employeeNumber:Se.employeeNumber,category:Se.category,level:Se.level,issueDate:Se.issueDate,description:Se.description||"No description provided",appealDetails:Se.appealDetails},onDecisionSubmit:Oe})]})]})};export{Y as WarningsReviewDashboard,Y as default};
