const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/business-owner-dashboard-BmQl3e0o.js","assets/pdf-vendor-CbrIsI36.js","assets/react-vendor-BMk1H4su.js","assets/firebase-vendor-BIBOIkWK.js","assets/ui-vendor-nvFuqpTO.js"])))=>i.map(i=>d[i]);
import{a as e}from"./pdf-vendor-CbrIsI36.js";import{a,j as t,L as s}from"./business-owner-dashboard-BmQl3e0o.js";import{r,d as n}from"./react-vendor-BMk1H4su.js";import{a as l,L as o,U as i}from"./dashboard-router-DiUm3Ijp.js";import{D as d}from"./hr-dashboard-CByPQOeq.js";import{B as m,ae as c,U as p,E as x,T as u,z as g,v as b}from"./ui-vendor-nvFuqpTO.js";import"./firebase-vendor-BIBOIkWK.js";import"./hod-dashboard-B5bMPhud.js";const h=({isOpen:h,onClose:f,organizationId:j,inline:y=!1})=>{const{organization:N}=a(),v=j||N?.id,[w,D]=r.useState([]),[C,S]=r.useState(null),[k,O]=r.useState(!0),[z,I]=r.useState(null),M=l(),[A,E]=r.useState({name:"",description:"",managerId:""}),[F,T]=r.useState(!1),[P,R]=r.useState([]);r.useEffect(()=>{if(!v||!h&&!y)return;(async()=>{try{O(!0),I(null);const[e,a]=await Promise.all([d.getDepartments(v),d.getDepartmentStats(v)]);D(e),S(a)}catch(e){s.error("Failed to load departments",{error:e}),I("Failed to load departments. Please try again.")}finally{O(!1)}})(),(async()=>{try{const{DatabaseShardingService:a}=await e(async()=>{const{DatabaseShardingService:e}=await import("./business-owner-dashboard-BmQl3e0o.js").then(e=>e.G);return{DatabaseShardingService:e}},__vite__mapDeps([0,1,2,3,4])),t=(await a.queryDocuments(v,"users",[])).documents.filter(e=>{const a="string"==typeof e.role?e.role:e.role?.id;return("hr-manager"===a||"hod-manager"===a)&&!1!==e.isActive}).map(e=>({id:e.id,name:`${e.firstName||""} ${e.lastName||""}`.trim(),role:"string"==typeof e.role?e.role:e.role?.id||"unknown"}));R(t)}catch(a){s.error("Failed to load managers",{error:a})}})()},[v,h,y]),r.useEffect(()=>{if(!v||!h&&!y)return;return d.subscribeToDepartments(v,e=>{D(e)})},[v,h,y]);const U=()=>{E({name:"",description:"",managerId:""}),M.open(null)},_=()=>{M.close(),E({name:"",description:"",managerId:""})};if(!y&&!h)return null;const L=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-3",children:t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("h3",{className:"text-base font-bold text-gray-900",children:"Departments"}),C&&t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(m,{className:"w-3 h-3"}),C.totalDepartments," total"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(c,{className:"w-3 h-3"}),C.departmentsWithManagers," with managers"]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(p,{className:"w-3 h-3"}),C.totalEmployeesAcrossDepartments," employees"]})]})]}),t.jsxs("button",{onClick:U,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors",children:[t.jsx(x,{className:"w-3.5 h-3.5"}),"Add Department"]})]})}),k&&t.jsx(o,{message:"Loading departments..."}),z&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(u,{className:"w-3.5 h-3.5 text-red-600"}),t.jsx("span",{className:"text-sm text-red-800",children:z})]})}),!k&&!z&&t.jsxs("div",{className:"space-y-1.5",children:[w.map(e=>t.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h4",{className:"font-semibold text-sm text-gray-900",children:e.name}),e.isDefault&&t.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded",children:"Default"})]}),e.description&&t.jsx("p",{className:"text-xs text-gray-600 mb-1.5",children:e.description}),t.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(p,{className:"w-3 h-3"}),e.employeeCount," employees"]}),e.managerName?t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(c,{className:"w-3 h-3"}),e.managerName]}):t.jsxs("span",{className:"flex items-center gap-1 text-orange-600",children:[t.jsx(u,{className:"w-3 h-3"}),"No manager"]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:()=>(e=>{E({name:e.name,description:e.description||"",managerId:e.managerId||""}),M.open(e)})(e),className:"p-1.5 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50",title:"Edit department",children:t.jsx(g,{className:"w-3.5 h-3.5"})}),!e.isDefault&&t.jsx("button",{onClick:()=>(async e=>{if(v)if(e.isDefault)alert("Cannot delete default departments (Operations, Admin)");else if(confirm(`Are you sure you want to delete "${e.name}"? This action cannot be undone.`))try{await d.deleteDepartment(v,e.id),s.success("Department deleted successfully")}catch(a){s.error("Failed to delete department",{error:a}),alert("Failed to delete department. Please try again.")}})(e),className:"p-1.5 text-gray-400 hover:text-red-600 rounded hover:bg-red-50",title:"Delete department",children:t.jsx(b,{className:"w-3.5 h-3.5"})})]})]})},e.id)),0===w.length&&!k&&t.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[t.jsx(m,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),t.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No departments found"}),t.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Create your first department to get started with organizational structure."}),t.jsxs("button",{onClick:U,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors mx-auto",children:[t.jsx(x,{className:"w-3.5 h-3.5"}),"Create Department"]})]})]}),M.isOpen&&t.jsx(i,{isOpen:M.isOpen,onClose:_,title:M.data?"Edit Department":"Create Department",subtitle:M.data?"Update department information":"Add a new department to your organization",size:"md",children:t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),v)try{T(!0),M.data?await d.updateDepartment(v,M.data.id,A):await d.createDepartment(v,A),M.close(),E({name:"",description:"",managerId:""}),s.success(M.data?"Department updated successfully":"Department created successfully")}catch(a){s.error("Failed to save department",{error:a}),alert("Failed to save department. Please try again.")}finally{T(!1)}},className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:["Department Name ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",value:A.name,onChange:e=>E(a=>({...a,name:e.target.value})),className:"w-full px-4 py-2.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors",placeholder:"e.g., Operations, Admin, Sales",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Description"}),t.jsx("textarea",{value:A.description,onChange:e=>E(a=>({...a,description:e.target.value})),rows:3,className:"w-full px-4 py-2.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors resize-none",placeholder:"Brief description of the department's role and responsibilities"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-2 text-gray-900",children:"Assign Manager"}),t.jsxs("div",{className:"relative",children:[t.jsxs("select",{value:A.managerId,onChange:e=>E(a=>({...a,managerId:e.target.value})),className:"w-full px-4 py-2.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors appearance-none bg-white cursor-pointer",children:[t.jsx("option",{value:"",children:"No manager assigned"}),P.map(e=>t.jsxs("option",{value:e.id,children:[e.name," â€¢ ","hr-manager"===e.role?"HR Manager":"Department Manager"]},e.id))]}),t.jsx(c,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]}),0===P.length&&t.jsxs("div",{className:"mt-2 flex items-start gap-2 p-2.5 bg-amber-50 border border-amber-200 rounded-lg",children:[t.jsx(u,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),t.jsx("p",{className:"text-xs text-amber-800",children:"No managers available. Create HR or Department managers first."})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[t.jsx("button",{type:"button",onClick:_,disabled:F,style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:"#374151",backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"0.375rem",cursor:"pointer",transition:"all 0.2s"},onMouseOver:e=>e.currentTarget.style.backgroundColor="#f9fafb",onMouseOut:e=>e.currentTarget.style.backgroundColor="white",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:F||!A.name.trim(),style:{padding:"0.5rem 1rem",fontSize:"0.875rem",fontWeight:500,color:"white",backgroundColor:"#2563eb",border:"1px solid #2563eb",borderRadius:"0.375rem",cursor:F||!A.name.trim()?"not-allowed":"pointer",opacity:F||!A.name.trim()?.5:1,transition:"all 0.2s"},onMouseOver:e=>{!F&&A.name.trim()&&(e.currentTarget.style.backgroundColor="#1d4ed8")},onMouseOut:e=>{!F&&A.name.trim()&&(e.currentTarget.style.backgroundColor="#2563eb")},children:F?M.data?"Updating...":"Creating...":M.data?"Update":"Create"})]})]})})]});return y?t.jsx("div",{className:"space-y-4",children:L}):n.createPortal(t.jsx(i,{isOpen:h,onClose:f,title:"Department Management",subtitle:"Manage organizational departments and assignments",size:"lg",children:L}),document.body)};export{h as DepartmentManagement};
