const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EmployeeLifecycleService-Dhzp-DSz.js","assets/react-vendor-CWjEGAcE.js","assets/pdf-vendor-tUwojRr6.js","assets/firebase-vendor-sscTfFPd.js","assets/ui-vendor-DJEMvbNu.js"])))=>i.map(i=>d[i]);
import{a as e,r as t,R as a,b as r,u as s}from"./react-vendor-CWjEGAcE.js";import{a as i}from"./pdf-vendor-tUwojRr6.js";import{i as n,g as o,a as l,b as c,c as d,d as m,e as u,s as g,f as p,h,o as x,j as y,k as f,l as v,q as b,m as w,n as N,p as j,u as D,r as A,w as E,t as C,v as S,F as I,x as k,y as z,z as R,A as $,T as O,B as T,C as P,D as _}from"./firebase-vendor-sscTfFPd.js";import{C as L,X as F,L as M,T as W,R as U,a as H,b as V,I as q,c as B,S as G,P as K,d as Z,E as Y,e as J,f as Q,g as X,h as ee,F as te,i as ae,U as re,B as se,j as ie,k as ne,l as oe,m as le,n as ce,o as de,p as me,q as ue,r as ge,s as pe,D as he,t as xe,u as ye,M as fe,v as ve,w as be,x as we,A as Ne,W as je,y as De,z as Ae,G as Ee,H as Ce,J as Se,K as Ie,N as ke}from"./ui-vendor-DJEMvbNu.js";var ze,Re,$e={exports:{}},Oe={};var Te=(Re||(Re=1,$e.exports=function(){if(ze)return Oe;ze=1;var t=e(),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,r){var o,l={},c=null,d=null;for(o in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,o)&&!n.hasOwnProperty(o)&&(l[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===l[o]&&(l[o]=t[o]);return{$$typeof:a,type:e,key:c,ref:d,props:l,_owner:i.current}}return Oe.Fragment=r,Oe.jsx=o,Oe.jsxs=o,Oe}()),$e.exports);class Pe{static{this.productionWhitelist=["‚ùå","üö®","‚ö†Ô∏è","‚úÖ","üéØ"]}static debug(e,t,a){}static info(e,t,a){this.isWhitelistedMessage(e)&&console.info(this.formatMessage("INFO",e,a),t)}static warn(e,t,a){const r=this.sanitizeData(t);console.warn(this.formatMessage("WARN",e,a),r)}static error(e,t,a){const r=this.sanitizeError(t);console.error(this.formatMessage("ERROR",e,a),r),this.sendToMonitoring("error",e,r,a)}static success(e,t,a){const r=String(e);this.isWhitelistedMessage(e)&&console.log(this.formatMessage("SUCCESS",r,a),t)}static perf(e,t,a){}static isWhitelistedMessage(e){const t=String(e);return this.productionWhitelist.some(e=>t.startsWith(e))}static formatMessage(e,t,a){return`[${(new Date).toISOString()}] ${e}: ${t}${a?this.formatContext(a):""}`}static formatContext(e){const t=[];return e.organizationId&&t.push(`org:${e.organizationId.slice(-8)}`),e.userId&&t.push(`user:${e.userId.slice(-8)}`),e.component&&t.push(`comp:${e.component}`),e.action&&t.push(`action:${e.action}`),t.length>0?` [${t.join(", ")}]`:""}static sanitizeData(e){if(!e)return e;if("string"==typeof e)return this.sanitizeString(e);if("object"==typeof e){const t={};for(const[a,r]of Object.entries(e))this.isSensitiveKey(a)?t[a]="[REDACTED]":t[a]="object"==typeof r?this.sanitizeData(r):r;return t}return e}static sanitizeError(e){return e?e instanceof Error?{name:e.name,message:this.sanitizeString(e.message),stack:"[REDACTED]"}:this.sanitizeData(e):e}static isSensitiveKey(e){const t=e.toLowerCase();return["password","token","secret","key","auth","credential","email","phone","address","ssn","id_number","passport","salary","wage","bank","account","credit","personal","medical","health","disciplinary","performance"].some(e=>t.includes(e))}static sanitizeString(e){return e&&"string"==typeof e?e=(e=(e=(e=e.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,"[EMAIL]")).replace(/(\+27|0)[6-8][0-9]{8}/g,"[PHONE]")).replace(/\b\d{13}\b/g,"[ID_NUMBER]")).replace(/\b[a-zA-Z0-9]{20,}\b/g,"[TOKEN]"):e}static sendToMonitoring(e,t,a,r){try{const s={level:e,message:t,data:a,context:r,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href},i=JSON.parse(localStorage.getItem("hr_production_errors")||"[]");i.push(s),i.length>20&&i.shift(),localStorage.setItem("hr_production_errors",JSON.stringify(i))}catch(s){}}static getProductionLogs(){try{return JSON.parse(localStorage.getItem("hr_production_errors")||"[]")}catch{return[]}}static clearProductionLogs(){localStorage.removeItem("hr_production_errors")}}Pe.debug.bind(Pe),Pe.info.bind(Pe),Pe.warn.bind(Pe),Pe.error.bind(Pe),Pe.success.bind(Pe),Pe.perf.bind(Pe);const _e=n({apiKey:"AIzaSyCghheyHpRDcc-2sue-u1apExJr6jQCzyw",authDomain:"hr-disciplinary-system.firebaseapp.com",projectId:"hr-disciplinary-system",storageBucket:"hr-disciplinary-system.firebasestorage.app",messagingSenderId:"989741369966",appId:"1:989741369966:web:e388dc78d75744d828747f",measurementId:void 0}),Le=o(_e),Fe=l(_e),Me=c(_e),We=d(_e,"us-central1");m(_e),u(Fe).then(()=>{}).catch(e=>{Pe.error("Failed to enable Firestore network:",e)});const Ue=Object.freeze(Object.defineProperty({__proto__:null,app:_e,auth:Le,db:Fe,functions:We,storage:Me},Symbol.toStringTag,{value:"Module"}));const He=new class{constructor(){this.isCreatingUser=!1,this.pendingUserIds=new Set}startUserCreation(e){this.isCreatingUser=!0,this.pendingUserIds.add(e)}finishUserCreation(e){this.pendingUserIds.delete(e),0===this.pendingUserIds.size&&(this.isCreatingUser=!1)}isCreating(){return this.isCreatingUser}isPendingUser(e){return this.pendingUserIds.has(e)}};class Ve extends Error{constructor(e,t,a){super(e),this.code=t,this.originalError=a,this.name="FirebaseServiceError"}}class qe{static handle(e,t){if(Pe.error(`[FirebaseService] ${t} failed`,e),e instanceof I)throw new Ve(`Firestore error during ${t}: ${e.message}`,e.code,e);if(e&&"object"==typeof e&&"code"in e&&"message"in e)throw new Ve(`Auth error during ${t}: ${e.message}`,e.code,e);throw new Ve(`Unknown error during ${t}`,"unknown",e)}}class Be{static async signIn(e,t){try{const a=await g(Le,e,t);return a.user.uid,a.user}catch(a){qe.handle(a,"signIn")}}static async signUp(e,t){try{const a=await p(Le,e,t);return a.user.uid,a.user}catch(a){qe.handle(a,"signUp")}}static async signOut(){try{await h(Le)}catch(e){qe.handle(e,"signOut")}}static onAuthStateChanged(e){return x(Le,e)}static async getDocument(e,t){try{const a=y(Fe,e,t),r=await f(a);return r.exists()?{id:r.id,...r.data()}:(He.isPendingUser(t)||He.isCreating()||Pe.warn("Document not found",{collection:e,id:t}),null)}catch(a){qe.handle(a,`getDocument(${e}/${t})`)}}static async getCollection(e,t){try{const a=v(Fe,e);let r=t?b(a,...t):a;const s=(await w(r)).docs.map(e=>({id:e.id,...e.data()}));return s.length,s}catch(a){qe.handle(a,`getCollection(${e})`)}}static async createDocument(e,t,a){try{const r=a||y(v(Fe,e)).id,s=y(Fe,e,r),{id:i,...n}=t;return await N(s,{...n,createdAt:j(),updatedAt:j()}),r}catch(r){qe.handle(r,`createDocument(${e})`)}}static async setDocument(e,t,a){try{const r=y(Fe,e,t);await N(r,a)}catch(r){qe.handle(r,`setDocument(${e}/${t})`)}}static async updateDocument(e,t,a){try{const r=y(Fe,e,t);await D(r,{...a,updatedAt:j()})}catch(r){qe.handle(r,`updateDocument(${e}/${t})`)}}static async deleteDocument(e,t){try{const a=y(Fe,e,t);await A(a)}catch(a){qe.handle(a,`deleteDocument(${e}/${t})`)}}static async queryDocuments(e,t,a,r){try{t.length;const s=t.map(e=>E(e.field,e.operator,e.value));return a&&s.push(C(a)),r&&s.push(S(r)),await this.getCollection(e,s)}catch(s){qe.handle(s,`queryDocuments(${e})`)}}static async batchCreate(e,t){try{t.length;const a=[];for(let r=0;r<t.length;r+=10){const s=t.slice(r,r+10).map(t=>this.createDocument(e,t)),i=await Promise.all(s);a.push(...i)}return a.length,a}catch(a){qe.handle(a,`batchCreate(${e})`)}}static async refreshUserClaims(e){try{const{getFunctions:t,httpsCallable:a}=await i(async()=>{const{getFunctions:e,httpsCallable:t}=await import("./firebase-vendor-sscTfFPd.js").then(e=>e.Z);return{getFunctions:e,httpsCallable:t}},[]),r=a(t(),"refreshUserClaims"),s=await r({targetUserId:e});return s.data,s.data}catch(t){throw Pe.error("Failed to refresh custom claims:",t),new Ve("Failed to refresh custom claims","refresh-claims-failed",t)}}static async refreshOrganizationUserClaims(e){try{const{getFunctions:t,httpsCallable:a}=await i(async()=>{const{getFunctions:e,httpsCallable:t}=await import("./firebase-vendor-sscTfFPd.js").then(e=>e.Z);return{getFunctions:e,httpsCallable:t}},[]),r=a(t(),"refreshOrganizationUserClaims"),s=await r({organizationId:e});return s.data,s.data}catch(t){throw Pe.error("Failed to refresh organization claims:",t),new Ve("Failed to refresh organization claims","refresh-org-claims-failed",t)}}static async getUserClaims(){try{const{getFunctions:e,httpsCallable:t}=await i(async()=>{const{getFunctions:e,httpsCallable:t}=await import("./firebase-vendor-sscTfFPd.js").then(e=>e.Z);return{getFunctions:e,httpsCallable:t}},[]),a=t(e(),"getUserClaims"),r=await a();return r.data,r.data}catch(e){throw Pe.error("Failed to get user claims:",e),new Ve("Failed to get user claims","get-claims-failed",e)}}}const Ge={ORGANIZATIONS:"organizations",USERS:"users",EMPLOYEES:"employees",WARNINGS:"warnings",WARNING_CATEGORIES:"warningCategories",ESCALATION_RULES:"escalationRules",AUDIT_LOGS:"auditLogs",DOCUMENTS:"documents",TEMPLATES:"templates"};class Ke{static getServerTimestamp(){return j()}static getClientTimeForDisplay(){return new Date}static formatSADateTime(e){return("string"==typeof e?new Date(e):e).toLocaleString("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}static formatSADate(e){return("string"==typeof e?new Date(e):e).toLocaleDateString("en-ZA",{timeZone:"Africa/Johannesburg",year:"numeric",month:"2-digit",day:"2-digit"})}static getClientISOString(){return Pe.warn("‚ö†Ô∏è CLIENT ISO STRING - For display/calculation only, NOT for database storage"),(new Date).toISOString()}static daysBetween(e,t){const a="string"==typeof e?new Date(e):e,r="string"==typeof t?new Date(t):t,s=Math.abs(r.getTime()-a.getTime());return Math.ceil(s/864e5)}static isServerTimestamp(e){return e&&"object"==typeof e&&"_methodName"in e}static getWarningExpiryTimestamp(){return j()}static createAuditTimestamp(e,t){return{action:e,userId:t,timestamp:j(),source:"web-client"}}}const Ze=Object.freeze(Object.defineProperty({__proto__:null,TimeService:Ke},Symbol.toStringTag,{value:"Module"}));class Ye{static{this.config={maxDocumentsPerShard:1e4,enableCollectionGroups:!0,enableCrossOrgQueries:!1,cacheEnabled:!0,batchSize:500}}static{this.pathCache=new Map}static getShardedPath(e,t){const a=`${e}:${t}`;if(this.config.cacheEnabled&&this.pathCache.has(a))return this.pathCache.get(a);const r=`organizations/${e}/${t}`;return this.config.cacheEnabled&&this.pathCache.set(a,r),r}static getShardedCollection(e,t){const a=this.getShardedPath(e,t);return v(Fe,a)}static getShardedDocument(e,t,a){const r=this.getShardedPath(e,t);return y(Fe,r,a)}static async createDocument(e,t,a,r){try{const s=Date.now(),i=this.getShardedCollection(e,t);let n;r?(n=y(i,r),await N(n,{...a,organizationId:e,createdAt:Ke.getServerTimestamp(),updatedAt:Ke.getServerTimestamp()})):n=await k(i,{...a,organizationId:e,createdAt:Ke.getServerTimestamp(),updatedAt:Ke.getServerTimestamp()});Date.now();return n.id,this.getShardedPath(e,t),n.id}catch(s){throw Pe.error(`‚ùå [SHARD] Create failed for ${e}/${t}:`,s),s}}static async getDocument(e,t,a){try{const r=Date.now(),s=this.getShardedDocument(e,t,a),i=await f(s);Date.now();return i.exists(),i.exists()?{id:i.id,...i.data()}:null}catch(r){throw Pe.error(`‚ùå [SHARD] Read failed for ${e}/${t}/${a}:`,r),r}}static async updateDocument(e,t,a,r){try{const s=Date.now(),i=this.getShardedDocument(e,t,a);await D(i,{...r,updatedAt:Ke.getServerTimestamp()});Date.now()}catch(s){throw Pe.error(`‚ùå [SHARD] Update failed for ${e}/${t}/${a}:`,s),s}}static async deleteDocument(e,t,a){try{const r=Date.now(),s=this.getShardedDocument(e,t,a);await A(s);Date.now()}catch(r){throw Pe.error(`‚ùå [SHARD] Delete failed for ${e}/${t}/${a}:`,r),r}}static async queryDocuments(e,t,a=[],r){try{const s=Date.now(),i=this.getShardedCollection(e,t);let n=b(i,...a);r&&(r.orderField&&(n=b(n,C(r.orderField,r.orderDirection||"desc"))),r.lastDocument&&(n=b(n,z(r.lastDocument))),n=b(n,S(r.pageSize)));const o=await w(n),l=o.docs.map(e=>({...e.data(),id:e.id})),c=Date.now()-s,d=o.docs[o.docs.length-1];return l.length,o.docs.length,{documents:l,lastDocument:d,hasMore:!!r&&o.docs.length===r.pageSize,shardInfo:{organizationId:e,path:this.getShardedPath(e,t),queryTime:c}}}catch(s){throw Pe.error(`‚ùå [SHARD] Query failed for ${e}/${t}:`,s),s}}static async queryCollectionGroup(e,t=[],a){if(!this.config.enableCrossOrgQueries)throw new Error("Cross-organization queries are disabled for security");try{const r=Date.now(),s=R(Fe,e);let i=b(s,...t);a&&(a.orderField&&(i=b(i,C(a.orderField,a.orderDirection||"desc"))),a.lastDocument&&(i=b(i,z(a.lastDocument))),i=b(i,S(a.pageSize)));const n=await w(i),o=n.docs.map(e=>({...e.data(),id:e.id})),l=Date.now()-r,c=n.docs[n.docs.length-1];return Pe.warn(`‚ö†Ô∏è [SHARD] Cross-org query executed in ${l}ms`,{collection:e,resultCount:o.length,security:"CROSS_ORG_QUERY_USED"}),{documents:o,lastDocument:c,hasMore:!!a&&n.docs.length===a.pageSize,shardInfo:{organizationId:"COLLECTION_GROUP",path:`collectionGroup(${e})`,queryTime:l}}}catch(r){throw Pe.error(`‚ùå [SHARD] Collection group query failed for ${e}:`,r),r}}static async batchWrite(e){try{const t=Date.now(),a=$(Fe);for(const s of e){const{organizationId:e,collectionName:t,operation:r,documentId:i,data:n}=s;if("create"===r){const r=i?this.getShardedDocument(e,t,i):y(this.getShardedCollection(e,t));a.set(r,{...n,organizationId:e,createdAt:new Date,updatedAt:Ke.getServerTimestamp()})}else if("update"===r&&i){const r=this.getShardedDocument(e,t,i);a.update(r,{...n,updatedAt:Ke.getServerTimestamp()})}else if("delete"===r&&i){const r=this.getShardedDocument(e,t,i);a.delete(r)}}await a.commit();const r=Date.now()-t;Pe.success(`üì¶ [SHARD] Batch operation completed in ${r}ms`,{operationCount:e.length,organizations:[...new Set(e.map(e=>e.organizationId))]})}catch(t){throw Pe.error("‚ùå [SHARD] Batch write failed:",t),t}}static async getShardStatistics(e){try{const t=["warnings","employees","categories","meetings","absences"],a=[];let r=0;for(const s of t){const t=(await this.queryDocuments(e,s,[],{pageSize:1e3})).documents.length;r+=t,a.push({name:s,documentCount:t,path:this.getShardedPath(e,s)})}return{organizationId:e,collections:a,totalDocuments:r,shardHealth:r>.8*this.config.maxDocumentsPerShard?"warning":r>this.config.maxDocumentsPerShard?"critical":"healthy"}}catch(t){throw Pe.error(`‚ùå [SHARD] Statistics failed for ${e}:`,t),t}}static async getSystemShardingMetrics(){return{totalOrganizations:2700,averageDocumentsPerOrg:8500,largestShards:[{organizationId:"large-corp-1",documentCount:95e3},{organizationId:"enterprise-2",documentCount:87e3},{organizationId:"global-org-3",documentCount:76e3}],performanceMetrics:{averageQueryTime:245,slowQueries:12,errorRate:.003}}}static async migrateFlatToSharded(e,t,a=100){Pe.warn(`üîÑ [MIGRATION] Starting migration: ${e} -> ${t}`);const r={migrated:0,failed:0,skipped:0,errors:[]};try{const i=v(Fe,e),n=b(i,S(a));let o=null,l=!0;for(;l;){let e=n;o&&(e=b(i,z(o),S(a)));const c=await w(e);if(c.empty){l=!1;continue}const d=[];for(const a of c.docs){const e=a.data();e.organizationId?d.push({organizationId:e.organizationId,collectionName:t,operation:"create",documentId:a.id,data:e}):(r.skipped++,r.errors.push(`Document ${a.id} missing organizationId`))}try{await this.batchWrite(d),r.migrated+=d.length,d.length}catch(s){r.failed+=d.length,r.errors.push(`Batch migration failed: ${s}`),Pe.error("‚ùå [MIGRATION] Batch failed:",s)}o=c.docs[c.docs.length-1],l=c.docs.length===a}return Pe.success(`üéâ [MIGRATION] Completed: ${r.migrated} migrated, ${r.failed} failed, ${r.skipped} skipped`),r}catch(s){throw Pe.error("‚ùå [MIGRATION] Migration failed:",s),s}}static updateConfig(e){this.config={...this.config,...e},this.config}static clearCache(){this.pathCache.clear()}}class Je{static{this.COLLECTION="userOrgIndex"}static{this.CACHE_TTL=3e5}static{this.cache=new Map}static async getUserOrganization(e){try{const t=this.cache.get(e);if(t&&Date.now()-t.timestamp<this.CACHE_TTL)return t.entry;const a=await Be.getDocument(this.COLLECTION,e);return a?(this.cache.set(e,{entry:a,timestamp:Date.now()}),Pe.success(`‚úÖ Found user organization mapping: ${e} ‚Üí ${a.organizationId}`),a):null}catch(t){return Pe.error("‚ùå Error fetching user organization mapping:",t),null}}static async setUserOrganization(e,t,a,r,s="sharded"){try{const i={userId:e,organizationId:t,role:a,email:r,isActive:!0,lastUpdated:new Date,userType:s};await Be.setDocument(this.COLLECTION,e,i),this.cache.set(e,{entry:i,timestamp:Date.now()}),Pe.success(`‚úÖ User organization mapping created: ${e} ‚Üí ${t}`)}catch(i){throw Pe.error("‚ùå Error creating user organization mapping:",i),i}}static async removeUserOrganization(e){try{await Be.deleteDocument(this.COLLECTION,e),this.cache.delete(e),Pe.success(`‚úÖ User organization mapping removed: ${e}`)}catch(t){throw Pe.error("‚ùå Error removing user organization mapping:",t),t}}static async setUserActiveStatus(e,t){try{const a=await this.getUserOrganization(e);if(a){const r={...a,isActive:t,lastUpdated:new Date};await Be.updateDocument(this.COLLECTION,e,r),this.cache.set(e,{entry:r,timestamp:Date.now()}),Pe.success(`‚úÖ User active status updated: ${e} ‚Üí ${t}`)}}catch(a){throw Pe.error("‚ùå Error updating user active status:",a),a}}static async getOrganizationUsers(e){try{const t=await Be.queryDocuments(this.COLLECTION,[{field:"organizationId",operator:"==",value:e},{field:"isActive",operator:"==",value:!0}]);return Pe.success(`‚úÖ Found ${t.length} users for organization: ${e}`),t}catch(t){return Pe.error("‚ùå Error fetching organization users:",t),[]}}static async getUserWithOrganization(e){try{const t=await this.getUserOrganization(e);if(!t)return null;let a=null;return a="flat"===t.userType?await Be.getDocument("users",e):await Ye.getDocument(t.organizationId,"users",e),a?{user:a,organizationId:t.organizationId}:(Pe.warn(`‚ö†Ô∏è Index exists but user data missing for ${e}, cleaning up index...`),await this.removeUserOrganization(e),null)}catch(t){return Pe.error("‚ùå Error getting user with organization:",t),null}}static clearCache(){this.cache.clear()}static async migrateExistingUsers(){try{const t=await Be.getCollection("users");for(const e of t)e.id&&e.email&&e.role&&await this.setUserOrganization(e.id,e.organizationId||"system",e.role,e.email,"flat");const a=await Be.getCollection("organizations");for(const r of a)try{const e=await Ye.getCollection(r.id,"users");for(const t of e)t.id&&t.email&&t.role&&await this.setUserOrganization(t.id,r.id,t.role,t.email,"sharded");e.length,r.id}catch(e){Pe.error(`‚ùå Error migrating users from organization ${r.id}:`,e)}Pe.success("‚úÖ User organization index migration completed")}catch(e){throw Pe.error("‚ùå Error during migration:",e),e}}static async healthCheck(){const e=[];try{const a=await Be.getCollection(this.COLLECTION);for(const s of a)try{if("flat"===s.userType){await Be.getDocument("users",s.userId)||e.push(`Orphaned flat user index: ${s.userId}`)}else{await Ye.getDocument(s.organizationId,"users",s.userId)||e.push(`Orphaned sharded user index: ${s.userId} in ${s.organizationId}`)}}catch(t){e.push(`Error checking user ${s.userId}: ${t}`)}const r=0===e.length;return r?Pe.success("‚úÖ User organization index health check passed"):Pe.warn(`‚ö†Ô∏è User organization index health check found ${e.length} issues`),{healthy:r,issues:e}}catch(t){return Pe.error("‚ùå Error during health check:",t),{healthy:!1,issues:[`Health check failed: ${t}`]}}}}const Qe="users",Xe="organizations",et=e=>{if("object"==typeof e&&e?.id)return e;if("string"==typeof e){const t={"super-user":"Global system administrator with full access","business-owner":"Organization owner with business oversight","hr-manager":"Human resources manager with employee management access","hod-manager":"Department head with team management capabilities"},a={"super-user":1,"business-owner":2,"hr-manager":3,"hod-manager":4};return{id:e,name:{"super-user":"Super User","business-owner":"Business Owner","hr-manager":"HR Manager","hod-manager":"Department Manager"}[e]||e.charAt(0).toUpperCase()+e.slice(1),description:t[e]||`${e} role`,level:a[e]||5}}return Pe.warn("‚ö†Ô∏è Invalid role format detected:",e),{id:"unknown",name:"Unknown Role",description:"Role format not recognized",level:99}},tt=(e,t)=>{switch(t.type){case"SET_LOADING":return{...e,loading:t.payload};case"SET_LOADING_PROGRESS":return{...e,loadingProgress:t.payload};case"SET_USER":return{...e,user:t.payload,loading:!1,loadingProgress:null,error:null};case"SET_ORGANIZATION":return{...e,organization:t.payload};case"SET_ERROR":return{...e,error:t.payload,loading:!1,loadingProgress:null};case"LOGOUT":return{user:null,organization:null,loading:!1,loadingProgress:null,error:null};default:return e}},at={user:null,organization:null,loading:!0,loadingProgress:null,error:null},rt=t.createContext(void 0),st=({children:e})=>{const[a,r]=t.useReducer(tt,at);t.useEffect(()=>{const e=x(Le,async e=>{try{if(r({type:"SET_LOADING_PROGRESS",payload:{stage:0,message:"Connecting to server...",progress:10}}),e){if(e.email,r({type:"SET_LOADING_PROGRESS",payload:{stage:1,message:"Authenticating user...",progress:30}}),He.isPendingUser(e.uid))return r({type:"SET_LOADING",payload:!0}),void setTimeout(async()=>{const t=await Je.getUserWithOrganization(e.uid);if(t){const e=et(t.user.role);if(r({type:"SET_USER",payload:{...t.user,role:e}}),t.organizationId&&"system"!==t.organizationId){const e=await Be.getDocument(Xe,t.organizationId);e&&r({type:"SET_ORGANIZATION",payload:e})}}else Pe.error("‚ùå User creation completed but user not found in index"),r({type:"SET_ERROR",payload:"User profile not found after creation"});r({type:"SET_LOADING",payload:!1})},2e3);const s=await Je.getUserWithOrganization(e.uid);if(r({type:"SET_LOADING_PROGRESS",payload:{stage:2,message:"Loading user profile...",progress:60}}),s){const a=await e.getIdTokenResult();if(!a.claims.role||"object"==typeof a.claims.role){Pe.warn("‚ö†Ô∏è [AUTH] Role missing or incorrectly formatted! Calling refreshUserClaims...");try{const{getFunctions:e,httpsCallable:t}=await i(async()=>{const{getFunctions:e,httpsCallable:t}=await import("./firebase-vendor-sscTfFPd.js").then(e=>e.Z);return{getFunctions:e,httpsCallable:t}},[]),a=t(e(void 0,"us-central1"),"refreshUserClaims");return await a({}),await Le.signOut(),void alert("Your user role has been refreshed! Please SIGN IN AGAIN.")}catch(t){Pe.error("‚ùå [AUTH] Failed to refresh claims:",t)}}const n=et(s.user.role);if(r({type:"SET_USER",payload:{...s.user,role:n}}),s.organizationId&&"system"!==s.organizationId){r({type:"SET_LOADING_PROGRESS",payload:{stage:3,message:"Loading organization data...",progress:80}});const e=await Be.getDocument(Xe,s.organizationId);e&&r({type:"SET_ORGANIZATION",payload:e})}r({type:"SET_LOADING_PROGRESS",payload:{stage:4,message:"Preparing your dashboard...",progress:95}}),Pe.success(`‚úÖ User authenticated via index: ${s.user.email} ‚Üí ${s.organizationId}`)}else{let t=await Be.getDocument(Qe,e.uid);if(t){Pe.success("‚úÖ Found user in flat structure (super user/reseller)");try{await Je.setUserOrganization(e.uid,t.organizationId||"system",t.role,t.email,"flat"),Pe.success(`‚úÖ Created index entry for flat user: ${e.uid}`)}catch(a){Pe.error("‚ùå Failed to create index entry for flat user:",a)}}else{const s=(await Be.getCollection(Xe)).map(async t=>{try{const a=await Ye.getDocument(t.id,"users",e.uid);return a?{user:a,orgId:t.id}:null}catch(a){return null}}),i=(await Promise.all(s)).find(e=>null!==e);if(i){t=i.user,Pe.success(`‚úÖ Found user in sharded organization: ${i.orgId}`);try{await Je.setUserOrganization(e.uid,i.orgId,t.role,t.email,"sharded"),Pe.success(`‚úÖ Created index entry for user: ${e.uid}`)}catch(a){Pe.error("‚ùå Failed to create index entry:",a)}const s=await Be.getDocument(Xe,i.orgId);s&&r({type:"SET_ORGANIZATION",payload:s})}}if(t){const e=et(t.role);r({type:"SET_USER",payload:{...t,role:e}})}else Pe.error("‚ùå User not found in any organization"),r({type:"SET_ERROR",payload:"User profile not found"})}}else r({type:"LOGOUT"})}catch(s){Pe.error("‚ùå Error in authentication flow:",s),r({type:"SET_ERROR",payload:"Authentication error occurred. Please try again."})}finally{r({type:"SET_LOADING",payload:!1})}});return e},[]);const s={user:a.user,organization:a.organization,loading:a.loading,loadingProgress:a.loadingProgress,error:a.error,login:async(e,t)=>{try{if(!e||!t)throw new Error("Email and password are required");if(!e.includes("@"))throw new Error("Please enter a valid email address");r({type:"SET_LOADING",payload:!0}),r({type:"SET_ERROR",payload:null});if(!(await Be.signIn(e,t)))throw new Error("Authentication failed");Pe.success(8714)}catch(a){let e="Login failed";throw a instanceof Error&&(e=a.message.includes("user-not-found")?"No account found with this email address":a.message.includes("wrong-password")?"Incorrect password":a.message.includes("invalid-email")?"Invalid email address format":a.message.includes("too-many-requests")?"Too many failed attempts. Please try again later":a.message.includes("user-disabled")?"This account has been disabled. Please contact support":a.message),Pe.error("‚ùå Login failed:",e),r({type:"SET_ERROR",payload:e}),new Error(e)}},logout:async()=>{try{await Be.signOut(),Pe.success(10222)}catch(e){Pe.error("‚ö†Ô∏è Logout error:",e),r({type:"LOGOUT"})}},switchOrganization:async e=>{if(!a.user)throw new Error("No authenticated user");if("super-user"!==a.user.role.id)throw new Error("Only super users can switch organizations");try{if(r({type:"SET_LOADING",payload:!0}),r({type:"SET_ERROR",payload:null}),"all"===e||""===e)r({type:"SET_ORGANIZATION",payload:null});else{const t=await Be.getDocument(Xe,e);if(!t)throw new Error(`Organization '${e}' not found`);Pe.success(11662),r({type:"SET_ORGANIZATION",payload:t})}}catch(t){const e=t instanceof Error?t.message:"Failed to switch organization";throw Pe.error("‚ùå Organization switch failed:",e),r({type:"SET_ERROR",payload:e}),t}finally{r({type:"SET_LOADING",payload:!1})}},resetPassword:async e=>{try{if(!e||!e.trim())throw new Error("Email address is required");if(!e.includes("@"))throw new Error("Please enter a valid email address");r({type:"SET_ERROR",payload:null});const{sendPasswordResetEmail:t}=await i(async()=>{const{sendPasswordResetEmail:e}=await import("./firebase-vendor-sscTfFPd.js").then(e=>e.Y);return{sendPasswordResetEmail:e}},[]);await t(Le,e.trim()),Pe.success("‚úÖ Password reset email sent successfully")}catch(t){let e="Failed to send password reset email";if(t instanceof Error&&(t.message.includes("user-not-found")||(e=t.message.includes("invalid-email")?"Invalid email address format":t.message.includes("too-many-requests")?"Too many reset attempts. Please try again later":t.message)),t instanceof Error&&t.message.includes("user-not-found"))return;throw Pe.error("‚ùå Password reset failed:",e),r({type:"SET_ERROR",payload:e}),new Error(e)}}};return Te.jsx(rt.Provider,{value:s,children:e})},it=()=>{const e=t.useContext(rt);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},nt=()=>{const e=navigator.userAgent,t=/Android [234]\./.test(e),a=/OS [67]_/.test(e),r=t||a||/Android [234]/.test(e)||/iPhone OS [1-7]_/.test(e),s="mediaDevices"in navigator&&"MediaRecorder"in window,i=CSS?.supports?.("display","grid")&&CSS?.supports?.("color","var(--test)"),n=navigator.hardwareConcurrency>2&&navigator.deviceMemory>1,o="MediaRecorder"in window;let l="unknown",c="unknown";return/Chrome\//.test(e)?(l="Chrome",c=e.match(/Chrome\/(\d+)/)?.[1]||"unknown"):/Safari\//.test(e)&&!/Chrome/.test(e)?(l="Safari",c=e.match(/Version\/(\d+)/)?.[1]||"unknown"):/Android.*Browser/.test(e)&&(l="Android Browser",c=e.match(/Android (\d+\.\d+)/)?.[1]||"unknown"),{isLegacyDevice:r,hasModernAudio:s,hasModernCSS:i,hasGoodPerformance:n,supportsMediaRecorder:o,browserInfo:{name:l,version:c,isAndroid4x:t,isIOS6to7:a}}},ot=e=>e.isLegacyDevice?{employeeListLimit:10,warningHistoryLimit:5,imageMaxSize:500,audioMaxDuration:30,enableAnimations:!1,enableTransitions:!1}:{employeeListLimit:50,warningHistoryLimit:20,imageMaxSize:2048,audioMaxDuration:180,enableAnimations:!0,enableTransitions:!0},lt=()=>{const e=nt();return(e=>{const t=document.body;e.isLegacyDevice&&t.classList.add("legacy-device"),e.browserInfo.isAndroid4x&&t.classList.add("android-4x"),e.browserInfo.isIOS6to7&&t.classList.add("ios-6-7"),e.hasModernAudio||t.classList.add("no-modern-audio"),e.hasModernCSS||t.classList.add("no-modern-css")})(e),(()=>{const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`),document.documentElement.classList.add("js-viewport-fixed")};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)})})(),(e=>{if(!e.isLegacyDevice)return;setInterval(()=>{if("memory"in performance){const e=performance.memory.usedJSHeapSize/1048576;e>50&&(Pe.warn("High memory usage detected on legacy device:",e.toFixed(2),"MB"),window.gc&&window.gc())}},3e4)})(e),e.isLegacyDevice&&(e.browserInfo,e.hasModernAudio,e.hasModernCSS,ot(e)),e};let ct;"undefined"!=typeof window&&(ct=lt());class dt{static async getWarningCategories(e){try{const t=v(Fe,"organizations",e,"categories"),a=b(t,E("isActive","==",!0),C("name"));return(await w(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){return Pe.error("[DataServiceV2] Error getting categories:",t),[]}}static async getWarningCategory(e,t){try{const a=y(Fe,"organizations",e,"categories",t),r=await f(a);return r.exists()?{id:r.id,...r.data()}:null}catch(a){return Pe.error("[DataServiceV2] Error getting category:",a),null}}static async updateWarningCategory(e,t,a){try{const r=y(Fe,"organizations",e,"categories",t);await D(r,{...a,updatedAt:j()})}catch(r){throw Pe.error("[DataServiceV2] Error updating category:",r),r}}static async getEmployeesByOrganization(e){try{const t=v(Fe,"organizations",e,"employees"),a=b(t,C("profile.lastName"),C("profile.firstName"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(t){return Pe.error("[DataServiceV2] Error getting employees:",t),[]}}static async getEmployee(e,t){try{const a=y(Fe,"organizations",e,"employees",t),r=await f(a);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertDate(r.data().createdAt),updatedAt:this.convertDate(r.data().updatedAt)}:null}catch(a){return Pe.error("[DataServiceV2] Error getting employee:",a),null}}static async saveEmployee(e,t){try{const a=t.id?y(Fe,"organizations",e,"employees",t.id):y(v(Fe,"organizations",e,"employees")),r={...t,organizationId:e,updatedAt:j(),...t.id?{}:{createdAt:j()}};return await N(a,r),a.id}catch(a){throw Pe.error("[DataServiceV2] Error saving employee:",a),a}}static async employeeNumberExists(e,t){try{const a=v(Fe,"organizations",e,"employees"),r=b(a,E("profile.employeeNumber","==",t));return!(await w(r)).empty}catch(a){return Pe.error("[DataServiceV2] Error checking employee number:",a),!1}}static async getWarningsByOrganization(e,t){try{const a=v(Fe,"organizations",e,"warnings");let r=b(a,C("issueDate","desc"));t&&(r=b(a,C("issueDate","desc"),S(t)));return(await w(r)).docs.map(e=>({id:e.id,...e.data(),issueDate:this.convertDate(e.data().issueDate),expiryDate:this.convertDate(e.data().expiryDate),incidentDate:this.convertDate(e.data().incidentDate),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(a){return Pe.error("[DataServiceV2] Error getting warnings:",a),[]}}static async getWarningsForEmployee(e,t){try{const a=v(Fe,"organizations",e,"warnings"),r=b(a,E("employeeId","==",t),C("issueDate","desc"));return(await w(r)).docs.map(e=>({id:e.id,...e.data(),issueDate:this.convertDate(e.data().issueDate),expiryDate:this.convertDate(e.data().expiryDate),incidentDate:this.convertDate(e.data().incidentDate),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(a){return Pe.error("[DataServiceV2] Error getting employee warnings:",a),[]}}static async saveWarning(e,t){try{const a=t.id?y(Fe,"organizations",e,"warnings",t.id):y(v(Fe,"organizations",e,"warnings")),r={...t,organizationId:e,updatedAt:j(),...t.id?{}:{createdAt:j()}};return await N(a,r),a.id}catch(a){throw Pe.error("[DataServiceV2] Error saving warning:",a),a}}static async getUsersByOrganization(e){try{const t=v(Fe,"organizations",e,"users"),a=b(t,E("isActive","==",!0),C("lastName"),C("firstName"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertDate(e.data().createdAt),lastLogin:this.convertOptionalDate(e.data().lastLogin)}))}catch(t){return Pe.error("[DataServiceV2] Error getting users:",t),[]}}static async getUser(e,t){try{const a=y(Fe,"organizations",e,"users",t),r=await f(a);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertDate(r.data().createdAt),lastLogin:this.convertOptionalDate(r.data().lastLogin)}:null}catch(a){return Pe.error("[DataServiceV2] Error getting user:",a),null}}static async getDocumentTemplates(e){try{const t=v(Fe,"organizations",e,"templates"),a=b(t,E("isActive","==",!0),C("name"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(t){return Pe.error("[DataServiceV2] Error getting templates:",t),[]}}static async getEscalationRules(e){try{const t=v(Fe,"organizations",e,"escalationRules"),a=b(t,E("isActive","==",!0),C("category"));return(await w(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){return Pe.error("[DataServiceV2] Error getting escalation rules:",t),[]}}static async getOrganization(e){try{const t=y(Fe,"organizations",e),a=await f(t);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),updatedAt:this.convertDate(a.data().updatedAt)}:null}catch(t){return Pe.error("[DataServiceV2] Error getting organization:",t),null}}static convertDate(e){return e?e instanceof O||e.toDate?e.toDate():new Date(e):new Date}static convertOptionalDate(e){return e?this.convertDate(e):null}}class mt{static{this.CACHE_DURATION=3e5}static{this.cache=new Map}static clearCache(){this.cache.clear()}static async loadEmployees(e,t){try{const a=`employees:${e}:${JSON.stringify(t||{})}`;if(!t&&this.isCacheValid(a)){return{documents:this.cache.get(a).data,hasMore:!1,shardInfo:{organizationId:e,path:Ye.getShardedPath(e,"employees"),queryTime:0}}}const r=await Ye.queryDocuments(e,"employees",[],t||{pageSize:1e3,orderField:"createdAt",orderDirection:"desc"}),s=r.documents.filter(e=>"metadata"!==e.id&&(!!(e.profile||e.firstName||e.lastName)&&!1!==e.isActive));return r.documents=s,t||this.cache.set(a,{data:r.documents,timestamp:Date.now(),organizationId:e}),Pe.success(`üë• [SHARD] Loaded ${r.documents.length} employees for ${e}`),r}catch(a){throw Pe.error(`‚ùå [SHARD] Failed to load employees for ${e}:`,a),a}}static async getAllEmployees(e){try{return(await this.loadEmployees(e)).documents}catch(t){throw Pe.error(`‚ùå [SHARD] Failed to get all employees for ${e}:`,t),t}}static async getEmployeeById(e,t){try{const a=await Ye.getDocument(t,"employees",e);return a?(a.profile,a.profile):Pe.warn(`‚ö†Ô∏è [SHARD] Employee not found: ${e} in ${t}`),a}catch(a){throw Pe.error(`‚ùå [SHARD] Failed to get employee ${e}:`,a),a}}static async createEmployee(e,t){try{const a=await Ye.createDocument(t,"employees",{...e,organizationId:t,isActive:!0,createdAt:new Date,updatedAt:new Date});return this.invalidateCache(`employees:${t}`),Pe.success(`‚úÖ [SHARD] Created employee: ${e.firstName} ${e.lastName}`),a}catch(a){throw Pe.error("‚ùå [SHARD] Failed to create employee:",a),a}}static async updateEmployee(e,t,a){try{await Ye.updateDocument(t,"employees",e,a),this.invalidateCache(`employees:${t}`),Pe.success(`‚úÖ [SHARD] Updated employee: ${e}`)}catch(r){throw Pe.error(`‚ùå [SHARD] Failed to update employee ${e}:`,r),r}}static async saveEmployee(e,t){try{if(e.id){await this.updateEmployee(e.id,t,e);const a=await this.getEmployeeById(e.id,t);if(!a)throw new Error("Failed to retrieve updated employee");return a}{const a=await this.createEmployee(e,t),r=await this.getEmployeeById(a,t);if(!r)throw new Error("Failed to retrieve created employee");return r}}catch(a){throw Pe.error("‚ùå [SHARD] Failed to save employee:",a),a}}static async loadArchivedEmployees(e,t){try{const a=`archived-employees:${e}:${JSON.stringify(t||{})}`;if(!t&&this.isCacheValid(a)){return{documents:this.cache.get(a).data,hasMore:!1,shardInfo:{organizationId:e,path:Ye.getShardedPath(e,"employees"),queryTime:0}}}const r=await Ye.queryDocuments(e,"employees",[],t||{pageSize:1e3,orderField:"archivedAt",orderDirection:"desc"}),s=r.documents.filter(e=>!(!e.profile||"metadata"===e.id)&&!1===e.isActive);return r.documents=s,t||this.cache.set(a,{data:r.documents,timestamp:Date.now(),organizationId:e}),Pe.success(`üóÑÔ∏è [SHARD] Loaded ${r.documents.length} archived employees for ${e}`),r}catch(a){throw Pe.error(`‚ùå [SHARD] Failed to load archived employees for ${e}:`,a),a}}static async archiveEmployee(e,t){try{await this.updateEmployee(e,t,{isActive:!1,archivedAt:new Date}),this.invalidateCache(`employees:${t}`),this.invalidateCache(`archived-employees:${t}`),Pe.success(`üóÑÔ∏è [SHARD] Archived employee: ${e}`)}catch(a){throw Pe.error(`‚ùå [SHARD] Failed to archive employee ${e}:`,a),a}}static async deleteDocument(e,t,a){try{await Ye.deleteDocument(e,t,a),this.invalidateCache(`${t}:${e}`),Pe.warn(`üóëÔ∏è [SHARD] PERMANENTLY DELETED document: ${a} from ${t}`)}catch(r){throw Pe.error(`‚ùå [SHARD] Failed to delete document ${a}:`,r),r}}static async loadWarnings(e,t,a){try{const r=[];t?.employeeId&&r.push(E("employeeId","==",t.employeeId)),t?.categoryId&&r.push(E("categoryId","==",t.categoryId)),t?.level&&r.push(E("level","==",t.level)),void 0!==t?.isActive&&r.push(E("isActive","==",t.isActive));const s=await Ye.queryDocuments(e,"warnings",r,a||{pageSize:500,orderField:"issueDate",orderDirection:"desc"});return Pe.success(`‚ö†Ô∏è [SHARD] Loaded ${s.documents.length} warnings for ${e}`),s}catch(r){throw Pe.error(`‚ùå [SHARD] Failed to load warnings for ${e}:`,r),r}}static async getActiveWarningsForEmployee(e,t){try{const a=await this.loadWarnings(t,{employeeId:e,isActive:!0},{pageSize:100,orderField:"issueDate",orderDirection:"desc"});return a.documents.length,a.documents}catch(a){throw Pe.error(`‚ùå [SHARD] Failed to get active warnings for employee ${e}:`,a),a}}static async getAllWarningsForEmployee(e,t,a=!0){try{const r={employeeId:e};a||(r.isActive=!0);const s=await this.loadWarnings(t,r,{pageSize:500,orderField:"issueDate",orderDirection:"desc"});return s.documents.length,s.documents}catch(r){throw Pe.error(`‚ùå [SHARD] Failed to get all warnings for employee ${e}:`,r),r}}static async createWarning(e,t){try{const a=await Ye.createDocument(t,"warnings",{...e,organizationId:t,isActive:!0,status:"issued",createdAt:new Date,updatedAt:new Date});return Pe.success(`‚úÖ [SHARD] Created warning: ${a} for ${e.employeeId}`),a}catch(a){throw Pe.error("‚ùå [SHARD] Failed to create warning:",a),a}}static async getWarning(e,t){try{return await Ye.getDocument(e,"warnings",t)}catch(a){return Pe.error(`‚ùå [SHARD] Failed to get warning ${t}:`,a),null}}static async getWarningCategories(e){try{const t=`categories:${e}`;if(this.isCacheValid(t)){return this.cache.get(t).data}const a=await Ye.queryDocuments(e,"categories",[E("isActive","==",!0)],{pageSize:100,orderField:"name",orderDirection:"asc"});return this.cache.set(t,{data:a.documents,timestamp:Date.now(),organizationId:e}),Pe.success(`üìÇ [SHARD] Loaded ${a.documents.length} categories for ${e}`),a.documents}catch(t){throw Pe.error(`‚ùå [SHARD] Failed to load categories for ${e}:`,t),t}}static async createWarningCategory(e,t){try{const a=await Ye.createDocument(t,"categories",{...e,organizationId:t,isActive:!0,createdAt:new Date,updatedAt:new Date});return this.invalidateCache(`categories:${t}`),Pe.success(`‚úÖ [SHARD] Created category: ${e.name}`),a}catch(a){throw Pe.error("‚ùå [SHARD] Failed to create category:",a),a}}static async createDocument(e,t,a,r){try{const s=await Ye.createDocument(e,t,a,r);return this.invalidateCache(`${t}:${e}`),Pe.success(`‚úÖ [SHARD] Created document in ${t}: ${s}`),s}catch(s){throw Pe.error(`‚ùå [SHARD] Failed to create document in ${t}:`,s),s}}static async queryDocuments(e,t,a=[],r){try{const s=await Ye.queryDocuments(e,t,a,r||{pageSize:1e3,orderField:"createdAt",orderDirection:"desc"});return s.documents.length,s}catch(s){throw Pe.error(`‚ùå [SHARD] Failed to query documents from ${t}:`,s),s}}static async getOrganizationStats(e){try{const[t,a]=await Promise.all([this.loadEmployees(e),this.loadWarnings(e,{isActive:!0})]),r={},s={};for(const e of a.documents)r[e.level]=(r[e.level]||0)+1,s[e.categoryId]=(s[e.categoryId]||0)+1;const i=Array.from({length:12},(e,t)=>({month:new Date(0,t).toLocaleString("default",{month:"short"}),count:Math.floor(50*Math.random())})),n={totalEmployees:t.documents.length,activeWarnings:a.documents.length,warningsByLevel:r,warningsByCategory:s,monthlyTrends:i};return Pe.success(`üìä [SHARD] Generated stats for ${e}`),n}catch(t){throw Pe.error(`‚ùå [SHARD] Failed to generate stats for ${e}:`,t),t}}static async getSystemAnalytics(){return{totalOrganizations:2700,totalEmployees:13500,totalWarnings:8100,topOrganizations:[{name:"Global Enterprise Corp",organizationId:"global-1",employeeCount:250},{name:"Large Manufacturing Ltd",organizationId:"mfg-2",employeeCount:180},{name:"Tech Solutions Inc",organizationId:"tech-3",employeeCount:150}],performanceMetrics:{averageQueryTime:245,cacheHitRate:.85,shardDistribution:{small:2100,medium:500,large:95,enterprise:5}}}}static async bulkCreateEmployees(e,t){try{const r={success:0,failed:0,errors:[]},s=100;for(let i=0;i<e.length;i+=s){const n=e.slice(i,i+s),o=n.map(e=>({organizationId:t,collectionName:"employees",operation:"create",data:{...e,organizationId:t,isActive:!0,createdAt:new Date,updatedAt:new Date}}));try{await Ye.batchWrite(o),r.success+=n.length}catch(a){r.failed+=n.length,r.errors.push(`Batch ${i/s+1}: ${a}`)}}return this.invalidateCache(`employees:${t}`),Pe.success(`üì¶ [SHARD] Bulk created ${r.success} employees, ${r.failed} failed`),r}catch(a){throw Pe.error("‚ùå [SHARD] Bulk create employees failed:",a),a}}static isCacheValid(e){const t=this.cache.get(e);return void 0!==t&&Date.now()-t.timestamp<this.CACHE_DURATION}static invalidateCache(e){for(const[t]of this.cache)t.includes(e)&&this.cache.delete(t)}static getCacheStats(){let e=0,t=Date.now();for(const[a,r]of this.cache)e+=JSON.stringify(r).length,r.timestamp<t&&(t=r.timestamp);return{totalEntries:this.cache.size,cacheSize:e,hitRate:.85,oldestEntry:t}}static async migrateOrganizationToShards(e){Pe.warn(`üîÑ [MIGRATION] Starting organization migration: ${e}`);try{const[t,a,r]=await Promise.all([Ye.migrateFlatToSharded("employees","employees"),Ye.migrateFlatToSharded("warnings","warnings"),Ye.migrateFlatToSharded("warningCategories","categories")]),s={employees:{migrated:t.migrated,failed:t.failed},warnings:{migrated:a.migrated,failed:a.failed},categories:{migrated:r.migrated,failed:r.failed}};return Pe.success(`üéâ [MIGRATION] Organization ${e} migration complete`,s),s}catch(t){throw Pe.error(`‚ùå [MIGRATION] Organization migration failed for ${e}:`,t),t}}}const ut=Object.freeze(Object.defineProperty({__proto__:null,ShardedDataService:mt},Symbol.toStringTag,{value:"Module"}));class gt{static{this.cache=new Map}static{this.accessOrder=new Map}static{this.accessCounter=0}static{this.config={defaultTTL:3e5,maxSize:1e3}}static{this.TTL_CONFIG={employees:12e4,warnings:6e4,followUps:3e4,categories:6e5,organization:9e5,settings:9e5,userOrgIndex:18e5,sectors:36e5,roles:36e5}}static get(e){const t=this.cache.get(e);return t?Date.now()>t.expiryTime?(this.delete(e),null):(this.accessOrder.set(e,++this.accessCounter),t.data):null}static set(e,t,a){const r=a||this.getTTLForKey(e),s=Date.now()+r;this.cache.size>=this.config.maxSize&&this.evictLRU(),this.cache.set(e,{data:t,timestamp:Date.now(),expiryTime:s}),this.accessOrder.set(e,++this.accessCounter)}static delete(e){this.cache.delete(e),this.accessOrder.delete(e)}static clearByPrefix(e){let t=0;for(const a of this.cache.keys())a.startsWith(e)&&(this.cache.delete(a),this.accessOrder.delete(a),t++);Pe.success(`üßπ [CACHE] Cleared ${t} entries with prefix: ${e}`)}static clear(){const e=this.cache.size;this.cache.clear(),this.accessOrder.clear(),this.accessCounter=0,Pe.success(`üßπ [CACHE] Cleared all ${e} entries`)}static getStats(){Array.from(this.cache.entries());const e=Array.from(this.accessOrder.entries()),t=e.reduce((e,[t,a])=>a<e.access?{key:t,access:a}:e,{key:"",access:1/0}),a=e.reduce((e,[t,a])=>a>e.access?{key:t,access:a}:e,{key:"",access:-1});return{size:this.cache.size,maxSize:this.config.maxSize,hitRate:0,oldestEntry:t.key||null,newestEntry:a.key||null}}static async getOrFetch(e,t,a){const r=this.get(e);if(null!==r)return r;const s=await t();return this.set(e,s,a),s}static getTTLForKey(e){for(const[t,a]of Object.entries(this.TTL_CONFIG))if(e.includes(t))return a;return this.config.defaultTTL}static evictLRU(){if(0===this.accessOrder.size)return;let e="",t=1/0;for(const[a,r]of this.accessOrder.entries())r<t&&(t=r,e=a);e&&this.delete(e)}static startCleanupTimer(){setInterval(()=>{this.cleanupExpired()},6e4)}static cleanupExpired(){const e=Date.now();for(const[t,a]of this.cache.entries())e>a.expiryTime&&this.delete(t)}static generateOrgKey(e,t,...a){return`org:${e}:${t}${a.length>0?`:${a.join(":")}`:""}`}static generateUserKey(e,t,...a){return`user:${e}:${t}${a.length>0?`:${a.join(":")}`:""}`}}gt.startCleanupTimer();const pt=t.createContext(null),ht=()=>{const e=t.useContext(pt);if(!e)throw new Error("useOrganization must be used within an OrganizationProvider");return e},xt=({children:e,organizationId:a})=>{const[r,s]=t.useState(null),[i,n]=t.useState(null),[o,l]=t.useState(null),[c,d]=t.useState(!0),[m,u]=t.useState(null),g=t.useRef(!1),p=t.useRef(null),h=t.useRef(!1),x=`org-loading-${a}`,y=e=>{"undefined"!=typeof window&&(e?window[x]=!0:delete window[x])},f=async()=>{if(!(g.current||"undefined"!=typeof window&&window[x]))if(p.current===a&&r&&null!==i)d(!1);else{if(p.current===a&&i&&i.length>0)return i.length,void d(!1);g.current=!0,y(!0);try{d(!0),u(null);const[e,t]=await Promise.all([gt.getOrFetch(gt.generateOrgKey(a,"organization"),()=>dt.getOrganization(a)),gt.getOrFetch(gt.generateOrgKey(a,"categories"),()=>mt.getWarningCategories(a))]);e?(s(e),e.name):(Pe.error(`[OrganizationProvider] üö® Failed to load organization: ${a}`),u("Failed to load organization")),t&&Array.isArray(t)?(t.length,t.map(e=>e.name),n(t)):(Pe.warn(`[OrganizationProvider] ‚ö†Ô∏è No categories found, setting empty array for organization: ${a}`),n([])),l(null),p.current=a,d(!1)}catch(e){Pe.error("[OrganizationProvider] üö® Failed to load organization data:",e),u(e instanceof Error?e.message:"Failed to load organization data"),d(!1)}finally{g.current=!1,y(!1)}}};t.useEffect(()=>(h.current||(h.current=!0,a?(p.current!==a&&(g.current=!1,p.current=null,p.current&&gt.clearByPrefix(`org:${p.current}:`)),f()):Pe.warn("[OrganizationProvider] No organizationId provided, skipping data load")),()=>{h.current=!1}),[a]);const v={organization:r,organizationId:a,categories:i,sectorInfo:o,loading:c,error:m,refreshOrganization:async()=>{g.current=!1,p.current=null,await f()},initializeSector:async(e,t)=>{try{d(!0),Pe.warn("SectorService not imported - sector initialization disabled"),await f()}catch(a){throw Pe.error("Failed to initialize sector:",a),a}}};return t.useEffect(()=>{!c&&i&&i.length>0&&i.length},[c,i,r]),Te.jsx(pt.Provider,{value:v,children:e})},yt=({isOpen:e,onClose:a,title:r,subtitle:s,showBackButton:i=!1,onBack:n,currentStep:o,totalSteps:l,stepTitles:c,showStepProgress:d=!1,size:m="lg",className:u="",primaryAction:g,secondaryAction:p,customFooter:h,children:x})=>{t.useContext(pt);if(t.useEffect(()=>(e?(document.body.style.overflow="hidden",document.body.classList.add("modal-open")):(document.body.style.overflow="",document.body.classList.remove("modal-open")),()=>{document.body.style.overflow="",document.body.classList.remove("modal-open")}),[e]),!e)return null;const y=()=>d&&l&&o?Te.jsxs("div",{className:"modal-header__center",children:[Te.jsx("div",{className:"modal-header__progress-mobile modal-responsive-hide-mobile",children:Te.jsx("div",{className:"mobile-step-indicator",children:Te.jsx("div",{className:"mobile-step-dots",children:Array.from({length:l},(e,t)=>{const a=t+1,r=a===o,s=a<o;return Te.jsx("div",{className:"mobile-step-dot "+(r?"mobile-step-dot--active":s?"mobile-step-dot--completed":"mobile-step-dot--inactive"),children:s?"‚úì":a},t)})})})}),Te.jsx("div",{className:"modal-header__progress-desktop hidden md:flex",children:Array.from({length:l},(e,t)=>{const a=t+1,r=a===o,s=a<o;return Te.jsx("div",{className:"step-container",children:Te.jsx("div",{className:"modal-header__step "+(r?"modal-header__step--active":s?"modal-header__step--completed":"modal-header__step--inactive"),children:s?"‚úì":a})},t)})})]}):null;return Te.jsx("div",{className:"modal-system",children:Te.jsxs("div",{className:"modal-container",children:[Te.jsxs("div",{className:"modal-header",children:[Te.jsxs("div",{className:"modal-header__left",children:[i&&n&&Te.jsx("button",{onClick:n,className:"modal-header__close-button",children:Te.jsx(L,{className:"w-4 h-4"})}),Te.jsxs("div",{children:[Te.jsx("h2",{className:"modal-header__title",children:r}),s&&Te.jsx("p",{className:"modal-header__subtitle",children:s})]})]}),Te.jsx("button",{onClick:a,className:"modal-header__close-button",children:Te.jsx(F,{className:"w-5 h-5"})})]}),Te.jsx(y,{}),d&&c&&o&&c[o-1]&&Te.jsx("div",{className:"sm:hidden text-center",children:Te.jsx("div",{className:"text-sm font-medium",style:{color:"var(--color-text-secondary)"},children:c[o-1]})}),Te.jsx("div",{className:"modal-content",children:Te.jsx("div",{className:"modal-content__scrollable",children:x})}),(g||p||h)&&Te.jsx("div",{className:"modal-footer",children:Te.jsx("div",{className:"modal-footer__nav",children:h||Te.jsxs(Te.Fragment,{children:[p&&Te.jsx("button",{onClick:p.onClick,className:"modal-footer__button modal-footer__button--secondary",children:p.label}),g&&Te.jsx("button",{onClick:g.onClick,disabled:g.disabled,className:"modal-footer__button modal-footer__button--primary "+(g.loading?"modal-footer__button--loading":""),children:g.label})]})})})]})})},ft=()=>{const{user:e}=it(),t=(()=>{if(!e)return[];const t=e.role?.id||e.role;return t?[t]:[]})(),a=e=>t.includes(e),r=e=>e.some(e=>t.includes(e));return{canViewBusinessMetrics:()=>a("business-owner")||a("super-user"),canManageOrganization:()=>a("business-owner")||a("super-user"),canViewComplianceReports:()=>r(["business-owner","hr-manager","super-user"]),canManageOrganizationSettings:()=>a("business-owner")||a("super-user"),canManageEmployees:()=>r(["hr-manager","business-owner","super-user"]),canManageHR:()=>r(["hr-manager","business-owner","super-user"]),canReviewWarnings:()=>r(["hr-manager","business-owner","super-user"]),canReviewDocuments:()=>r(["hr-manager","business-owner","super-user"]),canManageUsers:()=>r(["hr-manager","business-owner","super-user"]),canManageDepartments:()=>r(["hr-manager","business-owner","super-user"]),canCreateHRManagers:()=>a("business-owner")||a("super-user"),canCreateHODManagers:()=>r(["hr-manager","business-owner","super-user"]),canCreateWarnings:()=>r(["hod-manager","hr-manager","business-owner","super-user"]),canCaptureDocuments:()=>r(["hod-manager","hr-manager","super-user"]),canViewTeamMembers:()=>r(["hod-manager","hr-manager","business-owner","super-user"]),canManageTeam:()=>r(["hod-manager","hr-manager","business-owner","super-user"]),hasRole:a,hasAnyRole:r,hasAllRoles:e=>e.every(e=>t.includes(e)),getPrimaryRole:()=>t[0]||"unknown",getAllRoles:()=>[...t]}},vt=[{id:"attendance_punctuality",name:"Attendance & Punctuality",description:"Late coming, unauthorized absence, early departure without permission",severity:"minor",icon:"‚è∞",lraSection:"Section 188(1)(a) - Incapacity or poor work performance",schedule8Reference:"Schedule 8, Item 10 - Incapacity/poor performance procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Attendance issues are typically correctable behavior problems that benefit from full progressive discipline, giving employees maximum opportunity to improve while building strong legal documentation.",commonExamples:["Arriving late for work without valid reason (3+ times per month)","Leaving work early without supervisor permission","Unauthorized absence during working hours","Excessive sick leave without proper medical certificates","Not notifying supervisor of absence per company policy","Consistently returning late from breaks","Pattern of Monday/Friday absences without valid reasons"],proceduralRequirements:["Maintain accurate attendance records for minimum 6 months","Investigate reasons for poor attendance before disciplinary action","Consider personal circumstances (Schedule 8 factors)","Provide counselling and support where appropriate","Follow progressive discipline unless pattern shows willful misconduct","Document all interventions and employee responses","Allow employee opportunity to provide medical evidence"],evidenceRequired:["Daily attendance register or electronic time records","Previous warnings and counselling records","Medical certificates (if absence-related)","Communication records about absences","Witness statements from supervisors","Company attendance policy documentation","Impact assessment on operations"],ccmaFactors:["Length of service and previous disciplinary record","Personal circumstances affecting attendance","Whether adequate counselling and support was provided","Consistency of employer response to similar cases","Impact on operations and other employees","Economic circumstances and job market conditions","Whether alternative arrangements were considered"],defaultValidityPeriod:6},{id:"performance_issues",name:"Performance Issues",description:"Poor work quality, failure to meet targets, lack of required skills",severity:"minor",icon:"üìà",lraSection:"Section 188(1)(a) - Incapacity or poor work performance",schedule8Reference:"Schedule 8, Item 10 - Poor performance procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Performance issues often stem from lack of training, unclear expectations, or personal challenges. Full progressive discipline allows time for coaching, training, and performance improvement plans.",commonExamples:["Consistently missing production targets despite training","Work quality below acceptable company standards","Failure to follow established procedures","Inability to learn new skills required for position","Poor customer service resulting in complaints","Errors in work output affecting quality or safety","Lack of productivity compared to similar employees"],proceduralRequirements:["Provide clear performance standards and expectations","Offer training and development opportunities","Implement performance improvement plans with measurable goals","Regular monitoring and feedback sessions","Consider whether incapacity is due to ill-health or lack of skill","Explore alternative positions if performance cannot improve","Document all training provided and performance measurements"],evidenceRequired:["Performance metrics and measurement records","Training records and certificates","Performance improvement plan documentation","Regular performance review records","Customer complaints or feedback (if applicable)","Comparison with similar employees' performance","Evidence of support and resources provided"],ccmaFactors:["Whether clear performance standards were communicated","Adequacy of training and support provided","Personal circumstances affecting performance","Length of service and previous performance record","Whether alternative positions were considered","Consistency with treatment of other employees","Economic impact of dismissal on employee"],defaultValidityPeriod:6},{id:"safety_violations",name:"Safety Violations",description:"Failure to follow safety procedures, endangering self or others",severity:"serious",icon:"üö®",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["verbal","first_written","final_written"],escalationRationale:"Safety violations can result in injury, death, or legal liability. While counselling might be appropriate for first-time minor oversights, repeated or serious safety violations require formal progressive discipline.",commonExamples:["Failure to wear required Personal Protective Equipment (PPE)","Operating machinery without proper authorization","Ignoring safety procedures and protocols","Creating unsafe working conditions for others","Failure to report safety hazards or incidents","Horseplay or reckless behavior in workplace","Smoking in prohibited areas or fire hazard zones"],proceduralRequirements:["Immediate investigation of safety incidents","Ensure employee understands safety requirements","Provide additional safety training if needed","Consider whether violation was willful or due to lack of knowledge","Implement corrective measures to prevent recurrence","May require temporary removal from dangerous areas","Report serious incidents to relevant authorities"],evidenceRequired:["Incident reports and investigation findings","Safety training records and certificates","Photographs of safety violations or hazards","Witness statements from supervisors or colleagues","Safety inspection reports","Company safety policies and procedures","Medical reports if injury occurred"],ccmaFactors:["Seriousness of safety risk created","Whether violation was willful or negligent","Previous safety training provided","Employee's safety record and length of service","Potential consequences of the safety violation","Consistency of safety enforcement","Industry standards and legal requirements"],defaultValidityPeriod:12,requiresImmediateAction:!0},{id:"insubordination_disrespect",name:"Insubordination & Disrespect",description:"Refusal to follow instructions, disrespectful behavior, undermining authority",severity:"serious",icon:"üö´",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","final_written"],escalationRationale:"Insubordination varies from minor attitude issues (requiring counselling) to serious defiance. Progressive discipline allows distinction between momentary lapses and persistent defiant behavior.",commonExamples:["Refusing to follow reasonable and lawful instructions","Disrespectful language or behavior toward supervisors","Undermining management authority in front of colleagues","Aggressive or threatening behavior toward management","Consistently challenging management decisions inappropriately","Showing contempt for company policies or procedures","Public criticism of management or company"],proceduralRequirements:["Distinguish between reasonable management instruction and unreasonable demands","Consider employee's right to raise legitimate grievances","Assess whether behavior was influenced by workplace stress","Provide opportunity for employee to explain their perspective","Consider mediation or conflict resolution where appropriate","Document specific instances with dates and witnesses","Ensure consistency with treatment of similar cases"],evidenceRequired:["Written statements from witnesses present","Documentation of specific incidents with dates and times","Records of instructions given and employee response","Previous disciplinary records for pattern evidence","Email or written communication showing insubordination","Performance reviews or feedback sessions","Evidence of impact on team morale or productivity"],ccmaFactors:["Severity of the insubordinate behavior","Whether employee had legitimate grievances","Length of service and previous disciplinary record","Impact on workplace authority and discipline","Whether behavior was out of character","Workplace stress factors or personal circumstances","Potential for rehabilitation and improved behavior"],defaultValidityPeriod:6},{id:"policy_violations",name:"Policy Violations",description:"Breach of company policies, procedures, or workplace rules",severity:"minor",icon:"üìã",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","second_written","final_written"],escalationRationale:"Policy violations vary greatly in seriousness. Progressive discipline allows proportionate responses based on policy importance and violation severity.",commonExamples:["Violation of dress code or appearance standards","Inappropriate use of company property or equipment","Breach of confidentiality or privacy policies","Unauthorized use of company internet or email","Violation of social media and communication policies","Failure to follow administrative procedures","Breach of conflict of interest policies"],proceduralRequirements:["Ensure policy was clearly communicated to employee","Verify employee had access to and understood policy","Consider seriousness of policy violated","Investigate whether violation was intentional","Provide policy training if knowledge gaps identified","Consider impact of violation on business operations","Ensure consistent application across all employees"],evidenceRequired:["Copy of relevant company policy document","Evidence of policy communication (training records, handbook)","Documentation of the specific violation","Computer logs, emails, or digital evidence if applicable","Witness statements or supervisor observations","Previous policy violations or training records","Impact assessment on business or colleagues"],ccmaFactors:["Clarity and accessibility of the policy violated","Seriousness of the policy and business impact","Employee's knowledge and understanding of policy","Intent behind the violation","Consistency of policy enforcement","Length of service and previous violations","Whether remedial action is possible"],defaultValidityPeriod:6},{id:"dishonesty_theft",name:"Dishonesty & Theft",description:"Stealing, fraud, falsifying records, dishonest behavior",severity:"gross_misconduct",icon:"üí∞",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["first_written","final_written"],escalationRationale:"Dishonesty and theft break fundamental trust required for employment. Minor dishonesty may warrant progressive discipline, but serious theft or fraud often justifies immediate dismissal after investigation.",commonExamples:["Stealing company property, money, or resources","Fraudulent claiming of overtime or expenses","Falsifying time records, reports, or documentation","Misappropriation of company funds or assets","Lying about qualifications, experience, or credentials","Concealing conflicts of interest or kickbacks","Falsifying safety records or inspection reports"],proceduralRequirements:["Conduct thorough investigation before taking action","Preserve evidence and maintain chain of custody","Consider suspension pending investigation if necessary","Distinguish between minor dishonesty and serious fraud","Involve security or law enforcement if appropriate","Ensure fair hearing and right to respond","Consider whether criminal charges should be laid"],evidenceRequired:["Financial records, receipts, or transaction evidence","Security camera footage or access logs","Witness statements from colleagues or customers","Forensic accounting or audit reports","Documentation of missing inventory or assets","Computer records or digital evidence","Statements from employee during investigation"],ccmaFactors:["Value and nature of property stolen or involved","Level of trust and responsibility in employee's position","Impact on employer's business or reputation","Length of service and previous disciplinary record","Whether employee admitted wrongdoing and showed remorse","Consistency with treatment of similar cases","Potential for rehabilitation vs. need to deter others"],defaultValidityPeriod:12,requiresImmediateAction:!0,allowsWarningSkipping:!0},{id:"substance_abuse",name:"Substance Abuse",description:"Use of alcohol or drugs affecting work performance or safety",severity:"serious",icon:"üç∫",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["counselling","verbal","first_written","final_written"],escalationRationale:"Substance abuse is both a health issue and workplace safety concern. Counselling and support are prioritized initially, but safety concerns require firm boundaries.",commonExamples:["Reporting to work under influence of alcohol or drugs","Possession or use of illegal substances at work","Performance deterioration due to substance abuse","Erratic behavior suggesting intoxication","Positive results on random drug/alcohol testing","Alcohol odor or visible signs of intoxication","Refusing to submit to required substance testing"],proceduralRequirements:["Follow company substance abuse policy procedures","Conduct testing according to established protocols","Distinguish between addiction (health issue) and misconduct","Offer employee assistance programs where available","Consider rehabilitation and treatment options","Ensure safety of employee and colleagues","Document all incidents and interventions"],evidenceRequired:["Drug/alcohol test results and chain of custody","Witness observations of behavior and condition","Supervisor reports of performance decline","Medical evidence or treatment records (if disclosed)","Company substance abuse policies","Previous incidents or test results","Evidence of impact on work performance or safety"],ccmaFactors:["Whether substance abuse affects work performance","Safety implications for employee and colleagues","Employee's willingness to seek treatment","Length of service and previous record","Availability of rehabilitation programs","Consistency of policy application","Balance between health support and workplace safety"],defaultValidityPeriod:6,requiresImmediateAction:!0},{id:"harassment_discrimination",name:"Harassment & Discrimination",description:"Sexual harassment, racial discrimination, bullying, or creating hostile work environment",severity:"gross_misconduct",icon:"‚öñÔ∏è",lraSection:"Section 188(1)(b) - Misconduct",schedule8Reference:"Schedule 8, Item 1 - Misconduct procedures",escalationPath:["final_written"],escalationRationale:"Harassment and discrimination create legal liability and hostile work environments. While investigation is required, proven cases often warrant immediate serious action.",commonExamples:["Sexual harassment or unwanted sexual advances","Racial, gender, or religious discrimination","Bullying, intimidation, or creating hostile environment","Inappropriate comments about appearance or personal life","Displaying offensive material or making discriminatory jokes","Retaliation against employees who report discrimination","Creating work environment that excludes certain groups"],proceduralRequirements:["Immediate investigation by trained investigators","Ensure complainant safety and prevent retaliation","Maintain confidentiality while conducting investigation","Follow company harassment and discrimination policies","Consider interim measures to separate parties","Provide support to affected employees","Report to relevant authorities if required by law"],evidenceRequired:["Written complaint or incident report","Witness statements from colleagues","Documentation of previous similar incidents","Email, text messages, or other communications","Records of previous complaints or warnings","Medical or psychological reports (if applicable)","Evidence of impact on work environment"],ccmaFactors:["Seriousness and persistence of the harassment","Impact on victim and workplace environment","Position of power or authority of perpetrator","Previous incidents or complaints","Whether behavior was part of pattern","Legal and reputational risk to organization","Need to protect other employees and deter similar conduct"],defaultValidityPeriod:12,requiresImmediateAction:!0,allowsWarningSkipping:!0}];function bt(e){return vt.find(t=>t.id===e)}function wt(e){const t=bt(e);return t?.escalationPath||["counselling","verbal","first_written","final_written"]}function Nt(e){return{counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"}[e]||e}const jt="organizations",Dt="employees",At="warnings",Et="auditLogs";class Ct{static{this.categoryCache=new Map}static{this.CACHE_DURATION=3e5}static convertDate(e){if(!e)return new Date;if(e instanceof Date)return e;if(e&&"object"==typeof e&&"function"==typeof e.toDate)return e.toDate();const t=new Date(e);return isNaN(t.getTime())?new Date:t}static convertOptionalDate(e){if(e)return this.convertDate(e)}static async getWarningCategories(e){const t=this.categoryCache.get(e);if(t&&Date.now()-t.timestamp<this.CACHE_DURATION)return t.data;try{const t=vt;t.length;const a=v(Fe,"organizations",e,"categories"),r=b(a,E("isActive","==",!0),C("name")),s=(await w(r)).docs.map(e=>({id:e.id,...e.data(),createdAt:e.data().createdAt?.toDate()||new Date,updatedAt:e.data().updatedAt?.toDate()||new Date}));s.length;const i=[];for(const o of t){const t=s.find(e=>e.universalCategoryId===o.id&&!e.isCustomCategory);if(t&&t.isDisabled){o.name;continue}const a={id:t?.id||o.id,organizationId:e,name:t?.customName||o.name,description:t?.customDescription||o.description,severity:this.mapSeverityToLegacy(t?.customSeverity||o.severity),escalationPath:t?.customEscalationPath||o.escalationPath,legalRequirements:o.proceduralRequirements,examples:t?.customExamples||o.commonExamples,defaultValidityPeriod:o.defaultValidityPeriod,isActive:!0,createdAt:t?.createdAt||new Date,updatedAt:t?.updatedAt||new Date};i.push(a)}const n=s.filter(e=>e.isCustomCategory);for(const o of n){const t={id:o.id,organizationId:e,name:o.customName||"Custom Category",description:o.customDescription||"Organization-specific category",severity:o.customSeverity||"medium",escalationPath:o.customEscalationPath||["counselling","verbal","first_written","final_written"],legalRequirements:["Follow standard progressive discipline procedures"],examples:o.customExamples||[],defaultValidityPeriod:6,isActive:!0,createdAt:o.createdAt,updatedAt:o.updatedAt};i.push(t)}return this.categoryCache.set(e,{data:i,timestamp:Date.now()}),i.length,i.map(e=>`${e.name} (${e.severity})`),i}catch(a){return Pe.error("[DataService] ‚ùå Error in smart category merge:",a),t?t.data:this.convertUniversalToWarningCategories(e)}}static async getWarningCategory(e,t){try{const a=(await this.getWarningCategories(t)).find(t=>t.id===e);if(a)return a;const r=y(Fe,"organizations",t,"categories",e),s=await f(r);if(s.exists())return{id:s.id,...s.data(),createdAt:s.data().createdAt?.toDate()||new Date,updatedAt:s.data().updatedAt?.toDate()||new Date};const i=vt.find(t=>t.id===e);return i?this.convertUniversalToWarningCategory(i,t):null}catch(a){return Pe.error("[DataService] Error getting category:",a),null}}static async customizeCategory(e,t,a){try{const r=t,s=y(Fe,"organizations",e,"categories",r),i={id:r,organizationId:e,universalCategoryId:t,...a,isCustomCategory:!1,isDisabled:!1,createdAt:new Date,updatedAt:new Date};await N(s,i),this.categoryCache.delete(e)}catch(r){throw Pe.error("[DataService] Error customizing category:",r),r}}static async createCustomCategory(e,t){try{const a=`custom-${Date.now()}`,r=y(Fe,"organizations",e,"categories",a),s={id:a,organizationId:e,universalCategoryId:"",customName:t.name,customDescription:t.description,customEscalationPath:t.escalationPath,customExamples:t.examples||[],customSeverity:t.severity||"medium",isCustomCategory:!0,isDisabled:!1,createdAt:new Date,updatedAt:new Date};return await N(r,s),this.categoryCache.delete(e),t.name,a}catch(a){throw Pe.error("[DataService] Error creating custom category:",a),a}}static async disableCategory(e,t){try{const a=y(Fe,"organizations",e,"categories",t),r={organizationId:e,universalCategoryId:t,isDisabled:!0,isCustomCategory:!1,updatedAt:new Date};await N(a,r,{merge:!0}),this.categoryCache.delete(e)}catch(a){throw Pe.error("[DataService] Error disabling category:",a),a}}static convertUniversalToWarningCategory(e,t){return{id:e.id,organizationId:t,name:e.name,description:e.description,severity:this.mapSeverityToLegacy(e.severity),escalationPath:e.escalationPath,legalRequirements:e.proceduralRequirements,examples:e.commonExamples,defaultValidityPeriod:e.defaultValidityPeriod,isActive:!0,createdAt:new Date,updatedAt:new Date}}static convertUniversalToWarningCategories(e){return vt.map(t=>this.convertUniversalToWarningCategory(t,e))}static mapSeverityToLegacy(e){return{minor:"low",serious:"medium",gross_misconduct:"high"}[e]||"medium"}static async getOrganization(e){try{const t=y(Fe,jt,e),a=await f(t);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertOptionalDate(a.data().createdAt),updatedAt:this.convertOptionalDate(a.data().updatedAt)}:null}catch(t){return Pe.error("[DataService] Error getting organization:",t),null}}static async createOrganization(e){try{const t=e.id?y(Fe,jt,e.id):y(v(Fe,jt)),a={...e,updatedAt:j(),...e.id?{}:{createdAt:j()}};return await N(t,a),await this.logAuditEvent("ORGANIZATION_CREATED",{organizationId:t.id}),t.id}catch(t){throw Pe.error("[DataService] Error creating organization:",t),t}}static async updateOrganization(e,t){try{const a=y(Fe,jt,e);await D(a,{...t,updatedAt:j()}),await this.logAuditEvent("ORGANIZATION_UPDATED",{organizationId:e,updates:t})}catch(a){throw Pe.error("[DataService] Error updating organization:",a),a}}static async getEmployeesByOrganization(e){try{const t=v(Fe,"organizations",e,"employees"),a=b(t,E("isActive","==",!0),C("profile.lastName"),C("profile.firstName"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt),profile:{...e.data().profile,startDate:this.convertDate(e.data().profile?.startDate)},employment:{...e.data().employment,startDate:this.convertDate(e.data().employment?.startDate),endDate:this.convertOptionalDate(e.data().employment?.endDate),probationEndDate:this.convertOptionalDate(e.data().employment?.probationEndDate)}}))}catch(t){return Pe.error("[DataService] Error getting employees:",t),[]}}static async getEmployeesByManager(e,t){try{return(await this.getEmployeesByOrganization(t)).filter(t=>t.employment?.managerId===e&&t.isActive)}catch(a){throw Pe.error("[DataService] Failed to get employees by manager:",a),a}}static async getEmployee(e){try{const t=y(Fe,Dt,e),a=await f(t);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertDate(a.data().createdAt),updatedAt:this.convertDate(a.data().updatedAt),profile:{...a.data().profile,startDate:this.convertDate(a.data().profile?.startDate)},employment:{...a.data().employment,startDate:this.convertDate(a.data().employment?.startDate),endDate:this.convertOptionalDate(a.data().employment?.endDate),probationEndDate:this.convertOptionalDate(a.data().employment?.probationEndDate)}}:null}catch(t){return Pe.error("[DataService] Error getting employee:",t),null}}static async saveEmployee(e,t){try{Object.keys(e),e.employeeNumber,e.firstName,e.lastName;const a=e.id?y(Fe,Dt,e.id):y(v(Fe,Dt)),r={...e,organizationId:t,updatedAt:j(),...e.id?{}:{createdAt:j()}};return await N(a,r),this.logAuditEvent(e.id?"EMPLOYEE_UPDATED":"EMPLOYEE_CREATED",{employeeId:a.id,organizationId:t}).catch(e=>Pe.warn("Audit logging failed:",e)),a.id}catch(a){throw Pe.error("[DataService] Error saving employee:",a),a}}static async archiveEmployee(e,t){try{const a=y(Fe,Dt,e);await D(a,{isActive:!1,archivedAt:j(),updatedAt:j()}),await this.logAuditEvent("EMPLOYEE_ARCHIVED",{employeeId:e,organizationId:t})}catch(a){throw Pe.error("[DataService] Error archiving employee:",a),a}}static async restoreEmployee(e,t){try{const a=y(Fe,Dt,e);await D(a,{isActive:!0,archivedAt:null,updatedAt:j()}),await this.logAuditEvent("EMPLOYEE_RESTORED",{employeeId:e,organizationId:t})}catch(a){throw Pe.error("[DataService] Error restoring employee:",a),a}}static async getWarningsByOrganization(e,t){try{const a=v(Fe,"organizations",e,"warnings");let r=b(a,C("issueDate","desc"));t&&(r=b(r,S(t)));const s=(await w(r)).docs.map(e=>({id:e.id,...e.data(),issueDate:this.convertDate(e.data().issueDate),expiryDate:this.convertDate(e.data().expiryDate),incidentDate:this.convertDate(e.data().incidentDate),deliveryDate:this.convertOptionalDate(e.data().deliveryDate),signatureDate:this.convertOptionalDate(e.data().signatureDate),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)})),i=[...new Set(s.map(e=>e.employeeId).filter(e=>e))],n=[...new Set(s.map(e=>e.categoryId).filter(e=>e))],[o,l]=await Promise.all([this.getBatchEmployees(i,e),this.getBatchWarningCategories(n,e)]),c=new Map;o.forEach(e=>{e&&c.set(e.id,{firstName:e.profile?.firstName||"Unknown",lastName:e.profile?.lastName||"Employee",employeeNumber:e.employeeNumber||"N/A",department:e.employment?.department||"Unknown"})});const d=new Map;return l.forEach(e=>{e&&d.set(e.id,e.name)}),s.map(e=>{const t=c.get(e.employeeId),a=d.get(e.categoryId);return{...e,employeeName:t?`${t.firstName} ${t.lastName}`:"Unknown Employee",employeeNumber:t?.employeeNumber||"Unknown",department:t?.department||"Unknown",category:a||"Unknown Category"}})}catch(a){return Pe.error("[DataService] Error getting warnings:",a),[]}}static async getWarningsForEmployee(e,t){try{const a=v(Fe,"organizations",t,"warnings"),r=b(a,E("employeeId","==",e),C("issueDate","desc"));return(await w(r)).docs.map(e=>({id:e.id,...e.data(),issueDate:this.convertDate(e.data().issueDate),expiryDate:this.convertDate(e.data().expiryDate),incidentDate:this.convertDate(e.data().incidentDate),deliveryDate:this.convertOptionalDate(e.data().deliveryDate),signatureDate:this.convertOptionalDate(e.data().signatureDate),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(a){return Pe.error("[DataService] Error getting employee warnings:",a),[]}}static async getActiveWarningsForEmployee(e,t){try{const a=v(Fe,"organizations",t,"warnings"),r=new Date,s=b(a,E("employeeId","==",e),E("isActive","==",!0),E("expiryDate",">",r),C("expiryDate","desc"),C("issueDate","desc"));return(await w(s)).docs.map(e=>({id:e.id,...e.data(),issueDate:this.convertDate(e.data().issueDate),expiryDate:this.convertDate(e.data().expiryDate),incidentDate:this.convertDate(e.data().incidentDate),deliveryDate:this.convertOptionalDate(e.data().deliveryDate),signatureDate:this.convertOptionalDate(e.data().signatureDate),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(a){return Pe.error("[DataService] Error getting active employee warnings:",a),[]}}static async getWarning(e,t){try{const a=y(Fe,"organizations",t,"warnings",e),r=await f(a);return r.exists()?{id:r.id,...r.data(),issueDate:this.convertDate(r.data().issueDate),expiryDate:this.convertDate(r.data().expiryDate),incidentDate:this.convertDate(r.data().incidentDate),deliveryDate:this.convertOptionalDate(r.data().deliveryDate),signatureDate:this.convertOptionalDate(r.data().signatureDate),createdAt:this.convertDate(r.data().createdAt),updatedAt:this.convertDate(r.data().updatedAt)}:null}catch(a){return Pe.error("[DataService] Error getting warning:",a),null}}static async saveWarning(e,t){try{const a=e.id?y(Fe,"organizations",t,"warnings",e.id):y(v(Fe,"organizations",t,"warnings")),r={...e,organizationId:t,updatedAt:j(),...e.id?{}:{createdAt:j()}};return await N(a,r),await this.logAuditEvent(e.id?"WARNING_UPDATED":"WARNING_CREATED",{warningId:a.id,organizationId:t,employeeId:e.employeeId}),Pe.success(33682),a.id}catch(a){throw Pe.error("‚ùå [SAVE] Error saving warning:",a),a}}static async updateWarningStatus(e,t,a){try{const r=y(Fe,"organizations",a,"warnings",e);await D(r,{status:t,updatedAt:j()}),await this.logAuditEvent("WARNING_STATUS_UPDATED",{warningId:e,organizationId:a,newStatus:t})}catch(r){throw Pe.error("[DataService] Error updating warning status:",r),r}}static async markWarningDelivered(e,t,a,r){try{const s=y(Fe,"organizations",t,"warnings",e);await D(s,{isDelivered:!0,deliveryDate:j(),deliveryMethod:a,deliveryDetails:r,updatedAt:j()}),await this.logAuditEvent("WARNING_DELIVERED",{warningId:e,organizationId:t,deliveryMethod:a,deliveryDetails:r})}catch(s){throw Pe.error("[DataService] Error marking warning as delivered:",s),s}}static async createUser(e){try{if(!e.organizationId)throw new Error("Organization ID is required for user creation");const t=e.id?y(Fe,"organizations",e.organizationId,"users",e.id):y(v(Fe,"organizations",e.organizationId,"users")),a={...e,createdAt:j(),updatedAt:j()};return await N(t,a),await this.logAuditEvent("USER_CREATED",{userId:t.id,organizationId:e.organizationId}),t.id}catch(t){throw Pe.error("[DataService] Error creating user:",t),t}}static async getUser(e,t){try{const a=y(Fe,"organizations",t,"users",e),r=await f(a);return r.exists()?{id:r.id,...r.data(),createdAt:this.convertDate(r.data().createdAt),lastLogin:this.convertOptionalDate(r.data().lastLogin)}:null}catch(a){return Pe.error("[DataService] Error getting user:",a),null}}static async getUsersByOrganization(e){try{const t=v(Fe,"organizations",e,"users"),a=b(t,E("isActive","==",!0),C("lastName"),C("firstName"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertDate(e.data().createdAt),lastLogin:this.convertOptionalDate(e.data().lastLogin)}))}catch(t){return Pe.error("[DataService] Error getting users:",t),[]}}static async updateUser(e,t,a){try{const r=y(Fe,"organizations",a,"users",e);await D(r,{...t,updatedAt:j()}),await this.logAuditEvent("USER_UPDATED",{userId:e,organizationId:t.organizationId})}catch(r){throw Pe.error("[DataService] Error updating user:",r),r}}static async deactivateUser(e,t){try{const r=y(Fe,"organizations",t,"users",e);await D(r,{isActive:!1,updatedAt:j()});try{await Je.setUserActiveStatus(e,!1)}catch(a){Pe.error("‚ùå Failed to update UserOrgIndex active status:",a)}await this.logAuditEvent("USER_DEACTIVATED",{userId:e,organizationId:t})}catch(r){throw Pe.error("[DataService] Error deactivating user:",r),r}}static async createDocumentTemplate(e){try{if(!e.organizationId)throw new Error("Organization ID is required for template creation");const t=e.id?y(Fe,"organizations",e.organizationId,"templates",e.id):y(v(Fe,"organizations",e.organizationId,"templates")),a={...e,createdAt:j(),updatedAt:j()};return await N(t,a),await this.logAuditEvent("TEMPLATE_CREATED",{templateId:t.id,organizationId:e.organizationId}),t.id}catch(t){throw Pe.error("[DataService] Error creating template:",t),t}}static async getDocumentTemplates(e){try{const t=v(Fe,"organizations",e,"templates"),a=b(t,E("isActive","==",!0),C("name"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(t){return Pe.error("[DataService] Error getting templates:",t),[]}}static async updateDocumentTemplate(e,t,a){try{const r=y(Fe,"organizations",a,"templates",e);await D(r,{...t,updatedAt:j()}),await this.logAuditEvent("TEMPLATE_UPDATED",{templateId:e,organizationId:t.organizationId})}catch(r){throw Pe.error("[DataService] Error updating template:",r),r}}static async getEscalationRules(e){try{const t=v(Fe,"organizations",e,"escalationRules"),a=b(t,E("isActive","==",!0),C("category"));return(await w(a)).docs.map(e=>({id:e.id,...e.data()}))}catch(t){return Pe.error("[DataService] Error getting escalation rules:",t),[]}}static async createEscalationRule(e,t){try{const a=y(v(Fe,"organizations",t,"escalationRules")),r={...e,organizationId:t,createdAt:j(),updatedAt:j()};return await N(a,r),await this.logAuditEvent("ESCALATION_RULE_CREATED",{ruleId:a.id,organizationId:t}),a.id}catch(a){throw Pe.error("[DataService] Error creating escalation rule:",a),a}}static async getOrganizationStats(e){try{const[t,a,r]=await Promise.all([this.getEmployeesByOrganization(e),this.getWarningsByOrganization(e,100),this.getActiveWarnings(e)]),s=new Date,i=new Date(s.getTime()-2592e6),n=a.filter(e=>e.issueDate>=i),o=a.reduce((e,t)=>(e[t.level]=(e[t.level]||0)+1,e),{});return{totalEmployees:t.length,activeEmployees:t.filter(e=>e.isActive).length,totalWarnings:a.length,activeWarnings:r.length,recentWarnings:n.length,warningsByLevel:o,lastUpdated:s}}catch(t){return Pe.error("[DataService] Error getting organization stats:",t),{totalEmployees:0,activeEmployees:0,totalWarnings:0,activeWarnings:0,recentWarnings:0,warningsByLevel:{},lastUpdated:new Date}}}static async getActiveWarnings(e){try{const t=v(Fe,"organizations",e,"warnings"),a=new Date,r=b(t,E("isActive","==",!0),E("expiryDate",">",a));return(await w(r)).docs.map(e=>({id:e.id,...e.data(),issueDate:this.convertDate(e.data().issueDate),expiryDate:this.convertDate(e.data().expiryDate),incidentDate:this.convertDate(e.data().incidentDate),createdAt:this.convertDate(e.data().createdAt),updatedAt:this.convertDate(e.data().updatedAt)}))}catch(t){return Pe.error("[DataService] Error getting active warnings:",t),[]}}static async createAuditLog(e){try{await k(v(Fe,Et),{...e,timestamp:j(),userId:Le.currentUser?.uid||"system"})}catch(t){Pe.error("[DataService] Error creating audit log:",t)}}static async logAuditEvent(e,t){}static async getUserIP(){try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch{return"unknown"}}static async getAuditLogs(e,t=50){try{const a=v(Fe,Et),r=b(a,E("data.organizationId","==",e),C("timestamp","desc"),S(t));return(await w(r)).docs.map(e=>({id:e.id,...e.data(),timestamp:this.convertDate(e.data().timestamp)}))}catch(a){return Pe.error("[DataService] Error getting audit logs:",a),[]}}static validateWarningLevel(e,t,a){try{return t.escalationPath.includes(a)?{isValid:!0}:{isValid:!1,reason:`${a} is not valid for category "${t.name}"`,suggestedLevel:t.escalationPath[0]}}catch(r){return Pe.error("[DataService] Error validating warning level:",r),{isValid:!1,reason:"Validation error occurred"}}}static async employeeExists(e){try{return null!==await this.getEmployee(e)}catch(t){return Pe.error("[DataService] Error checking employee existence:",t),!1}}static async organizationExists(e){try{return null!==await this.getOrganization(e)}catch(t){return Pe.error("[DataService] Error checking organization existence:",t),!1}}static async employeeNumberExists(e,t){try{const a=v(Fe,"organizations",e,"employees"),r=b(a,E("profile.employeeNumber","==",t));return!(await w(r)).empty}catch(a){return Pe.error("[DataService] Error checking employee number existence:",a),!1}}static async getAllEmployeeNumbers(e){try{const t=v(Fe,Dt),a=b(t,E("organizationId","==",e));return(await w(a)).docs.map(e=>e.data().profile?.employeeNumber).filter(e=>e&&"string"==typeof e)}catch(t){return Pe.error("[DataService] Error getting employee numbers:",t),[]}}static async generateNextEmployeeNumber(e,t="EMP001",a="",r=1){try{const s=await this.getAllEmployeeNumbers(e);let i=r-1;s.forEach(e=>{const t=e.match(/(\d+)$/);if(t){const e=parseInt(t[1],10);e>i&&(i=e)}});const n=i+1;switch(t){case"EMP001":default:return`EMP${n.toString().padStart(3,"0")}`;case"E001":return`E${n.toString().padStart(3,"0")}`;case"001":return n.toString().padStart(3,"0");case"custom":return`${a}${n.toString().padStart(3,"0")}`}}catch(s){return Pe.error("[DataService] Error generating employee number:",s),`EMP${Date.now().toString().slice(-3)}`}}static async validateEmployeeNumber(e,t,a){try{if(!t||0===t.trim().length)return{isValid:!1,isAvailable:!1,message:"Employee number is required"};if(t.length<2)return{isValid:!1,isAvailable:!1,message:"Employee number must be at least 2 characters"};const r=await this.employeeNumberExists(e,t);if(r&&a){const r=v(Fe,Dt),s=b(r,E("organizationId","==",e),E("profile.employeeNumber","==",t)),i=await w(s);if(!i.docs.some(e=>e.id===a)){return{isValid:!0,isAvailable:!1,suggestions:[await this.generateNextEmployeeNumber(e,"EMP001"),await this.generateNextEmployeeNumber(e,"E001"),await this.generateNextEmployeeNumber(e,"001")],message:"Employee number already exists"}}}else if(r){return{isValid:!0,isAvailable:!1,suggestions:[await this.generateNextEmployeeNumber(e,"EMP001"),await this.generateNextEmployeeNumber(e,"E001"),await this.generateNextEmployeeNumber(e,"001")],message:"Employee number already exists"}}return{isValid:!0,isAvailable:!0,message:"Employee number is available"}}catch(r){return Pe.error("[DataService] Error validating employee number:",r),{isValid:!1,isAvailable:!1,message:"Error validating employee number"}}}static async cleanupExpiredWarnings(e){try{const t=v(Fe,At),a=new Date;let r=b(t,E("isActive","==",!0),E("expiryDate","<",a));e&&(r=b(t,E("organizationId","==",e),E("isActive","==",!0),E("expiryDate","<",a)));const s=await w(r),i=$(Fe);return s.docs.forEach(e=>{i.update(e.ref,{isActive:!1,expiredAt:j(),updatedAt:j()})}),await i.commit(),e&&await this.logAuditEvent("WARNINGS_CLEANUP",{organizationId:e,expiredCount:s.docs.length}),s.docs.length,s.docs.length}catch(t){return Pe.error("[DataService] Error cleaning up expired warnings:",t),0}}static async getSystemHealthMetrics(){try{return{status:"healthy",timestamp:new Date,services:{firestore:"operational",auth:"operational",storage:"operational"}}}catch(e){return Pe.error("[DataService] Error getting system health:",e),{status:"degraded",timestamp:new Date,error:e instanceof Error?e.message:"Unknown error"}}}static getIndustryCategories(e,t){return this.convertUniversalToWarningCategories(t)}static async createWarningCategory(e){try{const t=e.organizationId;if(!t)throw new Error("Organization ID is required for creating categories");const a=e.id?y(Fe,"organizations",t,"categories",e.id):y(v(Fe,"organizations",t,"categories")),r={...e,createdAt:j(),updatedAt:j()};return await N(a,r),await this.logAuditEvent("WARNING_CATEGORY_CREATED",{categoryId:a.id,organizationId:e.organizationId}),e.organizationId&&this.categoryCache.delete(e.organizationId),a.id}catch(t){throw Pe.error("[DataService] Error creating warning category:",t),t}}static async bulkCreateEmployees(e,t){try{const a=$(Fe),r=[];for(const s of e){const e=y(v(Fe,Dt));r.push(e.id),a.set(e,{...s,organizationId:t,createdAt:j(),updatedAt:j()})}return await a.commit(),await this.logAuditEvent("EMPLOYEES_BULK_CREATED",{organizationId:t,count:e.length,employeeIds:r}),r}catch(a){throw Pe.error("[DataService] Error bulk creating employees:",a),a}}static async bulkUpdateWarningStatuses(e,t,a){try{const r=$(Fe);for(const a of e){const e=y(Fe,At,a);r.update(e,{status:t,updatedAt:j()})}await r.commit(),await this.logAuditEvent("WARNINGS_BULK_STATUS_UPDATE",{organizationId:a,warningIds:e,newStatus:t,count:e.length})}catch(r){throw Pe.error("[DataService] Error bulk updating warning statuses:",r),r}}static async loadOrganizations(){try{const e=v(Fe,jt),t=b(e,C("createdAt","desc")),a=(await w(t)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}));return Pe.success(63433),a}catch(e){throw Pe.error("[DataService] Error loading organizations:",e),e}}static async getBatchEmployees(e,t){try{if(!e.length)return[];const a=[],r=10;for(let s=0;s<e.length;s+=r){const i=e.slice(s,s+r),n=v(Fe,Dt),o=b(n,E("organizationId","==",t),E("__name__","in",i)),l=(await w(o)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}));a.push(...l)}return Pe.success(65113),a}catch(a){return Pe.error("[DataService] Error in batch employee fetch:",a),[]}}static async getBatchWarningCategories(e,t){try{if(!e.length)return[];const a=[],r=10;for(let s=0;s<e.length;s+=r){const i=e.slice(s,s+r),n=v(Fe,"organizations",t,"categories"),o=b(n,E("__name__","in",i)),l=(await w(o)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}));a.push(...l)}return Pe.success(66603),a}catch(a){return Pe.error("[DataService] Error in batch category fetch:",a),[]}}static async getPaginatedEmployees(e,t=50,a){try{const r=v(Fe,Dt);let s=b(r,E("organizationId","==",e),E("isActive","==",!0),C("profile.lastName"),C("profile.firstName"),S(t+1));if(a){const i=await f(y(Fe,Dt,a));i.exists()&&(s=b(r,E("organizationId","==",e),E("isActive","==",!0),C("profile.lastName"),C("profile.firstName"),z(i),S(t+1)))}const i=(await w(s)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)})),n=i.length>t,o=n?i.slice(0,t):i,l=o.length>0?o[o.length-1].id:void 0;return Pe.success(68710),{employees:o,hasMore:n,lastId:l}}catch(r){return Pe.error("[DataService] Error in paginated employee fetch:",r),{employees:[],hasMore:!1}}}static async updateWithOptimisticLocking(e,t,a,r=0){try{const s=y(Fe,e,t),i=await f(s);if(!i.exists())return{success:!1,error:"Document not found"};const n=i.data().version||0;if(n!==r)return{success:!1,error:`Document was modified by another user. Expected version ${r}, found ${n}`};const o=n+1;return await D(s,{...a,version:o,updatedAt:j()}),Pe.success(70248),{success:!0,newVersion:o}}catch(s){return Pe.error("[DataService] Optimistic locking error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}static async createReseller(e){try{const t=`reseller_${Date.now()}`,a={...e,id:t,createdAt:j(),updatedAt:j()};return await N(y(Fe,"resellers",t),a),Pe.success(`‚úÖ Reseller created: ${t}`),t}catch(t){throw Pe.error("‚ùå Failed to create reseller:",t),t}}static async updateReseller(e,t){try{await D(y(Fe,"resellers",e),{...t,updatedAt:j()}),Pe.success(`‚úÖ Reseller updated: ${e}`)}catch(a){throw Pe.error("‚ùå Failed to update reseller:",a),a}}static async getReseller(e){try{const t=y(Fe,"resellers",e),a=await f(t);return a.exists()?{id:a.id,...a.data(),createdAt:this.convertOptionalDate(a.data().createdAt),updatedAt:this.convertOptionalDate(a.data().updatedAt)}:null}catch(t){throw Pe.error("‚ùå Failed to get reseller:",t),t}}static async getResellerClients(e){try{const t=v(Fe,jt),a=b(t,E("resellerId","==",e),C("createdAt","desc")),r=(await w(a)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}));return Pe.success(`üìä Loaded ${r.length} clients for reseller ${e}`),r}catch(t){throw Pe.error("‚ùå Failed to get reseller clients:",t),t}}static async createSubscription(e){try{const t=`sub_${Date.now()}`,a={...e,id:t,createdAt:j(),updatedAt:j()};return await N(y(Fe,"subscriptions",t),a),Pe.success(`‚úÖ Subscription created: ${t}`),t}catch(t){throw Pe.error("‚ùå Failed to create subscription:",t),t}}static async updateSubscription(e,t){try{await D(y(Fe,"subscriptions",e),{...t,updatedAt:j()}),Pe.success(`‚úÖ Subscription updated: ${e}`)}catch(a){throw Pe.error("‚ùå Failed to update subscription:",a),a}}static async getOrganizationSubscription(e){try{const t=v(Fe,"subscriptions"),a=b(t,E("organizationId","==",e)),r=await w(a);if(r.empty)return null;const s=r.docs[0];return{id:s.id,...s.data(),createdAt:this.convertOptionalDate(s.data().createdAt),updatedAt:this.convertOptionalDate(s.data().updatedAt)}}catch(t){throw Pe.error("‚ùå Failed to get subscription:",t),t}}static async createCommission(e){try{const t=e.id||`comm_${Date.now()}`,a={...e,id:t,createdAt:j(),updatedAt:j()};return await N(y(Fe,"commissions",t),a),Pe.success(`üí∞ Commission recorded: ${t}`),t}catch(t){throw Pe.error("‚ùå Failed to create commission:",t),t}}static async getResellerCommissions(e,t){try{const a=v(Fe,"commissions");let r=b(a,E("resellerId","==",e),C("createdAt","desc"));t&&(r=b(r,S(t)));const s=await w(r);return s.docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}))}catch(a){throw Pe.error("‚ùå Failed to get reseller commissions:",a),a}}static async updateOrganizationBilling(e,t){try{await D(y(Fe,jt,e),{...t,updatedAt:j()}),Pe.success(`üí≥ Organization billing updated: ${e}`)}catch(a){throw Pe.error("‚ùå Failed to update organization billing:",a),a}}static async getOrganizationsWithBilling(){try{const e=v(Fe,jt),t=b(e,C("createdAt","desc")),a=(await w(t)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}));for(const r of a){const e=await this.getOrganizationSubscription(r.id);e&&(r.subscription=e)}return Pe.success(`üìä Loaded ${a.length} organizations with billing`),a}catch(e){throw Pe.error("‚ùå Failed to load organizations with billing:",e),e}}static async createCommissionReport(e){try{const t=e.id||`report_${e.resellerId}_${e.month}`,a={...e,id:t,createdAt:j(),updatedAt:j()};return await N(y(Fe,"commissionReports",t),a),Pe.success(`üìÑ Commission report created: ${t}`),t}catch(t){throw Pe.error("‚ùå Failed to create commission report:",t),t}}static async getPendingCommissionReports(){try{const e=v(Fe,"commissionReports"),t=b(e,E("payoutStatus","==","pending"),C("createdAt","asc")),a=await w(t);return a.docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}))}catch(e){throw Pe.error("‚ùå Failed to get pending commission reports:",e),e}}static async assignResellerToOrganization(e,t){try{await this.updateOrganizationBilling(e,{resellerId:t});const a=await this.getReseller(t);if(a){const r=[...a.clientIds||[],e];await this.updateReseller(t,{clientIds:r,totalClientsAcquired:T(1)})}Pe.success(`ü§ù Reseller ${t} assigned to organization ${e}`)}catch(a){throw Pe.error("‚ùå Failed to assign reseller to organization:",a),a}}static async getAllResellers(){try{const e=b(v(Fe,"resellers"),C("createdAt","desc"));return(await w(e)).docs.map(e=>({id:e.id,...e.data(),createdAt:this.convertOptionalDate(e.data().createdAt),updatedAt:this.convertOptionalDate(e.data().updatedAt)}))}catch(e){throw Pe.error("Failed to get all resellers:",e),e}}static async getResellerDeployments(e,t){try{const a=b(v(Fe,"resellerDeployments"),E("resellerId","==",e),E("deployedAt",">=",t),C("deployedAt","desc"));return(await w(a)).docs.map(e=>({id:e.id,...e.data(),deployedAt:e.data().deployedAt?.toDate()||new Date,createdAt:e.data().createdAt?.toDate()||new Date}))}catch(a){return Pe.error("Failed to get reseller deployments:",a),[]}}static async logResellerDeployment(e){try{await k(v(Fe,"resellerDeployments"),{...e,createdAt:e.deployedAt})}catch(t){Pe.error("Failed to log reseller deployment:",t)}}}class St{static async getEscalationRecommendation(e,t,a){try{const s=await this.getActiveWarnings(e,a);let i=null,n=!1,o=null,l=null;if(a)try{l=(await Ye.queryDocuments(a,"categories",[])).documents.find(e=>e.id===t),l?.escalationPath&&(i=l.escalationPath,n=!0)}catch(r){Pe.warn("‚ö†Ô∏è [ESCALATION] Failed to load organization categories, falling back to universal")}n||(o=bt(t),o&&(i=o.escalationPath||["counselling","verbal","first_written","final_written"],n=!0));const c=l||o;if(!n||!i)return Pe.warn("‚ö†Ô∏è [ESCALATION] Category not found in organization or universal categories, using fallback"),this.getFallbackRecommendation(t,a);const d=s.filter(e=>e.categoryId===t);s.length,d.length;const m=i,u=this.determineSuggestedLevel(d,m),g="hr_intervention"===u,p=g?"final_written":u,h={suggestedLevel:p,recommendedLevel:g?"HR INTERVENTION REQUIRED":Nt(p),reason:g?this.generateHRInterventionReason(d,c):this.generateEscalationReason(d,p,c),requiresHRIntervention:g,interventionReason:g?`Employee has active final written warning for ${c?.name||"this category"}. Next offense requires manual HR decision through dedicated intervention module.`:void 0,interventionLevel:g?"urgent":void 0,activeWarnings:d,escalationPath:m,isEscalation:d.length>0,category:c?.name||"Unknown Category",categoryId:c?.id||t,legalBasis:c?.lraSection||"Schedule 8 Item 3",legalRequirements:c?.proceduralRequirements||[],warningCount:s.length,categoryWarningCount:d.length,nextExpiryDate:this.calculateNextExpiryDate(u,c?.defaultValidityPeriod||6),examples:c?.commonExamples||[],explanation:c?.escalationRationale||"Progressive discipline according to LRA Schedule 8",previousWarnings:d};return Pe.success(7929),h}catch(r){return Pe.error("‚ùå [ESCALATION] Error generating recommendation:",r),this.getFallbackRecommendation(t,a)}}static determineSuggestedLevel(e,t){if(0===e.length){const e=t[0]||"counselling";return e}if(e.some(e=>"final_written"===e.level))return Pe.warn("üö® [HR INTERVENTION] Employee has final written warning - HR intervention required"),"hr_intervention";let a=t[0]||"counselling",r=-1,s=!1;for(const o of e){const e=t.indexOf(o.level);e>r&&(r=e,a=o.level,s=o.wasOverridden||!1)}const i=t.indexOf(a)+1;if(i>=t.length){const e="final_written";return e}const n=t[i];return n}static generateEscalationReason(e,t,a){if(0===e.length)return`First incident of ${a?.name||"this category"}. Starting with ${Nt(t)} follows standard progressive discipline procedures.`;const r=e.length,s=e[0],i=Math.floor((Date.now()-s.issueDate.getTime())/864e5),n=e.some(e=>e.wasOverridden)?" Note: Previous warnings include manager-overridden levels.":"";return`Employee has ${r} active warning${r>1?"s":""} on record. Most recent warning was issued ${i} days ago. Progressive discipline policy requires escalation to ${Nt(t)}.${n}`}static generateHRInterventionReason(e,t){const a=e.find(e=>"final_written"===e.level);if(!a)return`üö® URGENT: Employee requires HR intervention for ${t?.name||"this category"} violation.`;const r=Math.floor((Date.now()-a.issueDate.getTime())/864e5),s=e.length;return`üö® URGENT HR INTERVENTION REQUIRED: Employee has active final written warning for ${t?.name||"this category"} (issued ${r} days ago) and has committed another offense. Total active warnings: ${s}. HR must use dedicated intervention module to decide next steps. System cannot escalate beyond final written warning.`}static calculateNextExpiryDate(e,t){const a="counselling"===e?3:"verbal"===e?6:"final_written"===e?12:t,r=new Date;return r.setMonth(r.getMonth()+a),r}static assessCCMAReadiness(e,t,a){return e.length>=2&&"final_written"===a?"high":e.length>=1?"medium":"low"}static async getActiveWarnings(e,t){try{if(!t){Pe.warn("‚ö†Ô∏è [WARNINGS] No organizationId provided, using DataService fallback");t=(await Ct.getOrganization()).id}const a=await i(()=>import("./firebase-vendor-sscTfFPd.js").then(e=>e.Z),[]),{getFunctions:r,httpsCallable:s}=a,n=s(r(),"getActiveWarningsServerSide"),o=await n({employeeId:e,organizationId:t});if(o.data&&"object"==typeof o.data&&"success"in o.data&&o.data.success){const e=o.data,t=e.warnings.map(e=>({...e,issueDate:new Date(e.issueDate),expiryDate:new Date(e.expiryDate),incidentDate:new Date(e.incidentDate),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),deliveryDate:e.deliveryDate?new Date(e.deliveryDate):void 0,signatureDate:e.signatureDate?new Date(e.signatureDate):void 0}));return Pe.success(`üìã [WARNINGS] Retrieved ${t.length} active warnings using SERVER time (${e.serverTime})`),t}return Pe.warn("‚ö†Ô∏è [WARNINGS] Server function returned unexpected result, using fallback"),[]}catch(a){Pe.error("‚ùå [WARNINGS] Error getting active warnings from server, using client fallback:",a);try{const a=v(Fe,"organizations",t,"warnings"),r=b(a,E("employeeId","==",e),E("isActive","==",!0),C("issueDate","desc")),s=(await w(r)).docs.map(e=>({id:e.id,...e.data(),issueDate:e.data().issueDate?.toDate()||new Date,expiryDate:e.data().expiryDate?.toDate()||new Date,incidentDate:e.data().incidentDate?.toDate()||new Date,createdAt:e.data().createdAt?.toDate()||new Date,updatedAt:e.data().updatedAt?.toDate()||new Date}));return Pe.warn(`‚ö†Ô∏è [WARNINGS] Fallback succeeded with ${s.length} warnings (client time)`),s}catch(r){return Pe.error("‚ùå [WARNINGS] Fallback also failed:",r),[]}}}static getFallbackRecommendation(e,t){const a="counselling";return{suggestedLevel:a,recommendedLevel:Nt(a),reason:"Unable to analyze warning history - defaulting to counselling for safety",activeWarnings:[],escalationPath:["counselling","verbal","first_written","final_written"],isEscalation:!1,category:"General Misconduct",categoryId:e||"general",legalBasis:"LRA Section 188 - Fair reason and procedure",legalRequirements:["Ensure fair and consistent application of disciplinary procedures"],warningCount:0,nextExpiryDate:this.calculateNextExpiryDate(a,6),examples:["System error occurred - manual review required"],explanation:"System error occurred - defaulting to safest disciplinary option",previousWarnings:[],ccmaReadiness:"low",ccmaFactors:["Follow basic progressive discipline principles"]}}static normalizeWarningLevel(e){return{counselling:"counselling",counseling:"counselling",verbal:"verbal",verbal_warning:"verbal",first_written:"first_written",first_written_warning:"first_written",second_written:"second_written",second_written_warning:"second_written",final_written:"final_written",final_written_warning:"final_written"}[e.toLowerCase().replace(/\s+/g,"_")]||"counselling"}static async saveWarning(e,t){try{const a=e.id?y(Fe,"organizations",t,"warnings",e.id):y(v(Fe,"organizations",t,"warnings")),r=e.issueDate?"string"==typeof e.issueDate?new Date(e.issueDate):e.issueDate:new Date,s=e.incidentDate?"string"==typeof e.incidentDate?new Date(e.incidentDate):e.incidentDate:new Date,i=e.validityPeriod||6,n=new Date(r);n.setMonth(n.getMonth()+i);const o={...e,organizationId:t,issueDate:O.fromDate(r),expiryDate:O.fromDate(n),incidentDate:O.fromDate(s),updatedAt:Ke.getServerTimestamp(),...e.id?{}:{createdAt:Ke.getServerTimestamp()}};return e.id?await D(a,o):await N(a,o),Pe.success(16339),a.id}catch(a){throw Pe.error("‚ùå [SAVE] Error saving warning:",a),a}}static async getWarningById(e){try{const t=await Ct.getOrganization(),a=y(Fe,"organizations",t.id,"warnings",e),r=await f(a);return r.exists()?{id:r.id,...r.data(),issueDate:r.data().issueDate?.toDate()||new Date,expiryDate:r.data().expiryDate?.toDate()||new Date,incidentDate:r.data().incidentDate?.toDate()||new Date,createdAt:r.data().createdAt?.toDate()||new Date,updatedAt:r.data().updatedAt?.toDate()||new Date}:null}catch(t){return Pe.error("‚ùå [GET] Error getting warning by ID:",t),null}}}class It{static{this.CACHE_DURATION=3e5}static{this.cache=new Map}static getCacheKey(e,t,a){return`${e}:${t}:${JSON.stringify(a||{})}`}static isValidCache(e){const t=this.cache.get(e);return!!t&&Date.now()-t.timestamp<this.CACHE_DURATION}static invalidateCache(e){for(const[t]of this.cache)t.includes(e)&&this.cache.delete(t)}static async getEmployeeProfile(e,t){try{const a=y(Fe,`organizations/${e}/employees/${t}`),r=await f(a);if(!r.exists())throw new Error(`Employee ${t} not found`);const s=r.data(),i=y(a,"summary","stats"),n=await f(i);return{...s,id:r.id,summary:n.exists()?n.data():void 0}}catch(a){throw Pe.error("‚ùå [NESTED] Failed to get employee profile:",a),a}}static async createWarning(e,t,a){try{const r=$(Fe),s=v(Fe,`organizations/${e}/employees/${t}/warnings`),i=y(s),n={...a,id:i.id,organizationId:e,employeeId:t,createdAt:new Date,updatedAt:new Date};if(r.set(i,n),!1!==n.isActive){const a=y(Fe,`organizations/${e}/indexes/activeWarnings`,i.id),s={id:i.id,employeeId:t,organizationId:e,type:"warning",title:`${n.level} - ${n.category}`,date:n.issueDate||new Date,status:n.status||"issued",priority:"final_written"===n.level?"high":"written"===n.level?"medium":"low",metadata:{level:n.level,category:n.category,employeeName:n.employeeName}};r.set(a,s)}return await this.updateEmployeeSummaryStats(r,e,t,"warning"),await r.commit(),this.invalidateCache(`warnings:${e}`),this.invalidateCache(`employee:${e}:${t}`),Pe.success(`‚úÖ [NESTED] Created warning ${i.id} for employee ${t}`),i.id}catch(r){throw Pe.error("‚ùå [NESTED] Failed to create warning:",r),r}}static async getEmployeeWarnings(e,t,a,r){try{let s=v(Fe,`organizations/${e}/employees/${t}/warnings`);a?.status&&(s=b(s,E("status","==",a.status))),a?.level&&(s=b(s,E("level","==",a.level))),void 0!==a?.isActive&&(s=b(s,E("isActive","==",a.isActive)));s=b(s,C(r?.orderField||"issueDate",r?.orderDirection||"desc")),r?.pageSize&&(s=b(s,S(r.pageSize))),r?.lastDoc&&(s=b(s,z(r.lastDoc)));const i=await w(s),n=i.docs.map(e=>({...e.data(),id:e.id})),o=!!r?.pageSize&&i.docs.length===r.pageSize,l=i.docs.length>0?i.docs[i.docs.length-1]:void 0;return n.length,{warnings:n,hasMore:o,lastDoc:l}}catch(s){throw Pe.error("‚ùå [NESTED] Failed to get employee warnings:",s),s}}static async getOrganizationWarnings(e,t,a){try{let r=R(Fe,"warnings");r=b(r,E("organizationId","==",e)),t?.status&&(r=b(r,E("status","==",t.status))),t?.level&&(r=b(r,E("level","==",t.level))),t?.employeeId&&(r=b(r,E("employeeId","==",t.employeeId)));r=b(r,C(a?.orderField||"issueDate",a?.orderDirection||"desc")),a?.pageSize&&(r=b(r,S(a.pageSize))),a?.lastDoc&&(r=b(r,z(a.lastDoc)));const s=await w(r),i=s.docs.map(e=>({...e.data(),id:e.id})),n=!!a?.pageSize&&s.docs.length===a.pageSize,o=s.docs.length>0?s.docs[s.docs.length-1]:void 0;return i.length,{warnings:i,hasMore:n,lastDoc:o}}catch(r){throw Pe.error("‚ùå [NESTED] Failed to get organization warnings:",r),r}}static async updateWarning(e,t,a,r){try{const s=$(Fe),i=y(Fe,`organizations/${e}/employees/${t}/warnings/${a}`);s.update(i,{...r,updatedAt:j()});const n=y(Fe,`organizations/${e}/indexes/activeWarnings/${a}`);if("archived"===r.status||!1===r.isActive)s.delete(n);else if(r.status||r.level){const e={};r.status&&(e.status=r.status),r.level&&(e.priority="final_written"===r.level?"high":"written"===r.level?"medium":"low",e.metadata={...e.metadata,level:r.level}),s.update(n,e)}(r.status||void 0!==r.isActive)&&await this.updateEmployeeSummaryStats(s,e,t,"warning"),await s.commit(),this.invalidateCache(`warnings:${e}`),this.invalidateCache(`employee:${e}:${t}`),Pe.success(`‚úÖ [NESTED] Updated warning ${a}`)}catch(s){throw Pe.error("‚ùå [NESTED] Failed to update warning:",s),s}}static async getActiveWarningsIndex(e,t){try{const a=this.getCacheKey("activeWarnings",e,{limit:t});if(this.isValidCache(a))return this.cache.get(a).data;let r=v(Fe,`organizations/${e}/indexes/activeWarnings`);r=b(r,C("date","desc")),t&&(r=b(r,t(t)));const s=(await w(r)).docs.map(e=>({...e.data(),id:e.id}));return this.cache.set(a,{data:s,timestamp:Date.now()}),s.length,s}catch(a){throw Pe.error("‚ùå [NESTED] Failed to get active warnings index:",a),a}}static async updateEmployeeSummaryStats(e,t,a,r){try{const s=y(Fe,`organizations/${t}/employees/${a}/summary`,"stats");e.set(s,{lastUpdated:j(),[`${r}LastActivity`]:j()},{merge:!0})}catch(s){Pe.error("‚ùå [NESTED] Failed to update employee summary:",s)}}static clearCache(){this.cache.clear()}}const kt={useNestedDataStructure:!1,enableDualWrite:!1,useCollectionGroupQueries:!1,enableEmployeeSummaryStats:!1,useIndexCollections:!1};function zt(e){return kt[e]}function Rt(){return zt("useNestedDataStructure")}function $t(){return zt("enableDualWrite")}function Ot(){return zt("useCollectionGroupQueries")}class Tt extends Error{constructor(e,t,a){super(e),this.code=t,this.originalError=a,this.name="APIError"}}const Pt=(e,t)=>{if(Pe.error(`API Error in ${e}:`,t),t instanceof Error)throw new Tt(`${e} failed: ${t.message}`,"OPERATION_FAILED",t);throw new Tt(`${e} failed with unknown error`,"UNKNOWN_ERROR",t)},_t={async getAll(e,t){try{const[t,a]=await Promise.all([mt.loadWarnings(e),mt.loadEmployees(e)]),r=t.documents,s=a.documents,i=r.map(e=>{const t=s.find(t=>t.id===e.employeeId);if(t){const a=t.profile?.firstName||"",r=t.profile?.lastName||"",s=`${a} ${r}`.trim()||e.employeeName||"Unknown";return{...e,employeeName:s,employeeLastName:r||e.employeeLastName||"",employeeNumber:t.profile?.employeeNumber||e.employeeNumber||"Unknown",employeeDepartment:t.employment?.department||e.employeeDepartment||"Unknown",employeePosition:t.employment?.position||e.employeePosition||"Unknown",department:t.employment?.department||e.department||"Unknown",position:t.employment?.position||e.position||"Unknown"}}return e}),n=i.filter(e=>!(!e.level||!e.description)&&("Unknown Employee"!==e.employeeName&&"Employee Not Selected"!==e.employeeName));return i.length,r.length,n.length,n}catch(a){Pt("warnings.getAll",a)}},async getById(e,t){try{return await mt.getWarning(t,e)}catch(a){Pt("warnings.getById",a)}},async create(e){try{const a={id:"",organizationId:e.organizationId,employeeId:e.employeeId,categoryId:e.categoryId,category:e.categoryName||"Unknown",categoryName:e.categoryName||"Unknown",level:e.level||"verbal",employeeName:e.employeeName||"Unknown",employeeLastName:e.employeeLastName||"Employee",employeeNumber:e.employeeNumber||"Unknown",employeeDepartment:e.employeeDepartment||"Unknown",employeePosition:e.employeePosition||"Unknown",department:e.employeeDepartment||"Unknown",position:e.employeePosition||"Unknown",incidentDate:new Date(e.incidentDate),incidentTime:e.incidentTime,incidentLocation:e.incidentLocation,description:e.incidentDescription,issueDate:new Date(e.issueDate),expiryDate:new Date(e.expiryDate||Date.now()+30*(e.validityPeriod||6)*24*60*60*1e3),validityPeriod:e.validityPeriod||6,issuedBy:e.issuedBy||"",issuedByName:e.issuedByName||"",isActive:!0,status:"issued",...e.additionalNotes&&{additionalNotes:e.additionalNotes},...e.signatures&&{signatures:e.signatures},audioRecording:e.audioRecording||{status:"required",processingStatus:"pending",error:"Audio recording not provided"},deliveryMethod:e.deliveryMethod||"email",createdAt:new Date,updatedAt:new Date};let r;if(Rt()){if(r=await It.createWarning(e.organizationId,e.employeeId,a),Pe.success(`üìÅ [NESTED] Warning created: ${r}`),$t())try{await St.saveWarning(a,e.organizationId)}catch(t){Pe.warn("‚ö†Ô∏è [DUAL-WRITE] Failed to save to sharded structure:",t)}}else if(r=await St.saveWarning(a,e.organizationId),Pe.success(`üìã [SHARD] Warning created: ${r}`),$t())try{await It.createWarning(e.organizationId,e.employeeId,{...a,id:r})}catch(t){Pe.warn("‚ö†Ô∏è [DUAL-WRITE] Failed to save to nested structure:",t)}return r}catch(t){Pt("warnings.create",t)}},async update(e,t,a,r){try{const i=a||t.organizationId;if(!i)throw new Error("Organization ID required for warning update");if(Rt())if(r){if(await It.updateWarning(i,r,e,t),Pe.success(`üìÅ [NESTED] Warning ${e} updated successfully`),$t())try{await this.updateFlatStructure(e,t,i)}catch(s){Pe.warn("‚ö†Ô∏è [DUAL-WRITE] Failed to update sharded structure:",s)}}else Pe.warn("‚ö†Ô∏è [NESTED] Employee ID required for nested update, falling back to sharded structure"),await this.updateFlatStructure(e,t,i);else if(await this.updateFlatStructure(e,t,i),Pe.success(`üìã [SHARD] Warning ${e} updated successfully`),$t()&&r)try{await It.updateWarning(i,r,e,t)}catch(s){Pe.warn("‚ö†Ô∏è [DUAL-WRITE] Failed to update nested structure:",s)}}catch(s){Pt("warnings.update",s)}},async updateFlatStructure(e,t,a){const r=y(Fe,`organizations/${a}/warnings/${e}`),s={...t,updatedAt:j(),organizationId:void 0};Object.keys(s).forEach(e=>{void 0===s[e]&&delete s[e]}),await D(r,s)},async delete(e){try{Pe.warn("warnings.delete not implemented - needs WarningService integration")}catch(t){Pt("warnings.delete",t)}},async getEscalationRecommendation(e,t,a){try{return await St.getEscalationRecommendation(e,t,a)}catch(r){Pt("warnings.getEscalationRecommendation",r)}},async getActiveWarnings(e,t){try{return await St.getActiveWarnings(e,t)}catch(a){Pt("warnings.getActiveWarnings",a)}},async getStats(e){try{const t=await dt.getWarningsByOrganization(e);return{total:t.length,issued:t.filter(e=>"issued"===e.status).length,delivered:t.filter(e=>"delivered"===e.status).length,byLevel:{counselling:t.filter(e=>"counselling"===e.warningLevel).length,written_warning_1:t.filter(e=>"written_warning_1"===e.warningLevel).length,written_warning_2:t.filter(e=>"written_warning_2"===e.warningLevel).length,final_written_warning:t.filter(e=>"final_written_warning"===e.warningLevel).length,dismissal:t.filter(e=>"dismissal"===e.warningLevel).length}}}catch(t){Pt("warnings.getStats",t)}},async archive(e,t,a){try{const r=y(Fe,`organizations/${t}/warnings/${e}`);await D(r,{isArchived:!0,archivedAt:j(),archiveReason:a,updatedAt:j()}),Pe.success(`Warning ${e} archived (reason: ${a})`)}catch(r){Pt("warnings.archive",r)}},async getArchived(e){try{const t=await mt.loadWarnings(e);return t.documents.filter(e=>!0===e.isArchived||"expired"===e.status||"overturned"===e.status)}catch(t){return Pt("warnings.getArchived",t),[]}}},Lt={async getAll(e,t=100){try{const[a,r]=await Promise.all([mt.loadEmployees(e,{pageSize:t,orderField:"profile.lastName",orderDirection:"asc"}),mt.loadWarnings(e)]),s=a.documents,i=r.documents,n=new Map,o=new Date;i.forEach(e=>{try{let t=null;e.expiryDate&&("function"==typeof e.expiryDate.toDate?t=e.expiryDate.toDate():e.expiryDate instanceof Date?t=e.expiryDate:"string"!=typeof e.expiryDate&&"number"!=typeof e.expiryDate||(t=new Date(e.expiryDate)));if(e.isActive&&(!t||!isNaN(t.getTime())&&t>o)&&e.employeeId){const t=n.get(e.employeeId)||0;n.set(e.employeeId,t+1)}}catch(t){Pe.warn(`‚ö†Ô∏è [WARNING COUNT] Error processing warning ${e.id}:`,t)}});const l=s.map(e=>{const t=n.get(e.id)||0;return{...e,disciplinaryRecord:{...e.disciplinaryRecord,activeWarnings:t,totalWarnings:e.disciplinaryRecord?.totalWarnings||t}}});return Pe.success(`üë• [OPTIMIZED] Loaded ${l.length} employees with warning counts (pageSize: ${t})`),l}catch(a){Pt("employees.getAll",a)}},async getById(e,t){try{return await mt.getEmployeeById(e,t)}catch(a){Pt("employees.getById",a)}},async create(e){try{return(await mt.saveEmployee(e,e.organizationId)).id}catch(t){Pt("employees.create",t)}},async update(e,t,a){try{const r=await mt.getEmployeeById(e,t);if(!r)throw new Error("Employee not found");const s={...r,...a};await mt.saveEmployee(s,t)}catch(r){Pt("employees.update",r)}},async delete(e,t){try{await mt.archiveEmployee(e,t)}catch(a){Pt("employees.delete",a)}},async bulkCreate(e,t){try{return(await mt.bulkCreateEmployees(e,t)).success>0?["bulk-success"]:[]}catch(a){Pt("employees.bulkCreate",a)}},async search(e,t){try{const a=(await mt.loadEmployees(e)).documents,r=t.toLowerCase();return a.filter(e=>e.profile.firstName.toLowerCase().includes(r)||e.profile.lastName.toLowerCase().includes(r)||e.profile.employeeNumber.toLowerCase().includes(r)||e.profile.email.toLowerCase().includes(r))}catch(a){Pt("employees.search",a)}},async getByManager(e,t){try{const a=gt.generateOrgKey(t,"employees","manager",e);return await gt.getOrFetch(a,async()=>{const a=await Ye.queryDocuments(t,"employees",[E("employment.managerId","==",e),E("isActive","==",!0)],{pageSize:50,orderField:"profile.lastName",orderDirection:"asc"});return Pe.success(`üë• [OPTIMIZED] Loaded ${a.documents.length} employees for manager ${e}`),a.documents})}catch(a){Pt("employees.getByManager",a)}},async generateNextEmployeeNumber(e,t="EMP001",a="",r=1){try{const s=await mt.loadEmployees(e),i=s.documents.map(e=>e.profile?.employeeNumber).filter(e=>e&&"string"==typeof e);let n=r-1;i.forEach(e=>{const t=e.match(/(\d+)$/);if(t){const e=parseInt(t[1],10);e>n&&(n=e)}});const o=n+1;switch(t){case"EMP001":default:return`EMP${o.toString().padStart(3,"0")}`;case"E001":return`E${o.toString().padStart(3,"0")}`;case"001":return o.toString().padStart(3,"0");case"custom":return`${a}${o.toString().padStart(3,"0")}`}}catch(s){Pt("employees.generateNextEmployeeNumber",s)}},async validateEmployeeNumber(e,t,a){try{const r=(await mt.loadEmployees(e)).documents;if(!r.find(e=>e.profile?.employeeNumber===t&&e.id!==a))return{isAvailable:!0};const s=[],i=t.match(/(\d+)$/),n=t.replace(/(\d+)$/,"");if(i){const e=parseInt(i[1],10);for(let t=1;t<=3;t++){const a=`${n}${(e+t).toString().padStart(i[1].length,"0")}`;r.some(e=>e.profile?.employeeNumber===a)||s.push(a)}}return{isAvailable:!1,suggestions:s.slice(0,3)}}catch(r){Pt("employees.validateEmployeeNumber",r)}},async archive(e,t,a){try{const{EmployeeLifecycleService:r}=await i(async()=>{const{EmployeeLifecycleService:e}=await import("./EmployeeLifecycleService-Dhzp-DSz.js");return{EmployeeLifecycleService:e}},__vite__mapDeps([0,1,2,3,4]));await r.archiveEmployee(e,t,a)}catch(r){Pt("employees.archive",r)}},async restore(e,t,a){try{const{EmployeeLifecycleService:r}=await i(async()=>{const{EmployeeLifecycleService:e}=await import("./EmployeeLifecycleService-Dhzp-DSz.js");return{EmployeeLifecycleService:e}},__vite__mapDeps([0,1,2,3,4]));await r.restoreEmployee(e,t,a)}catch(r){Pt("employees.restore",r)}},async getEligibleForDeletion(e){try{const{EmployeeLifecycleService:t}=await i(async()=>{const{EmployeeLifecycleService:e}=await import("./EmployeeLifecycleService-Dhzp-DSz.js");return{EmployeeLifecycleService:e}},__vite__mapDeps([0,1,2,3,4]));return await t.getEmployeesEligibleForDeletion(e)}catch(t){Pt("employees.getEligibleForDeletion",t)}},async getLifecycleStats(e){try{const{EmployeeLifecycleService:t}=await i(async()=>{const{EmployeeLifecycleService:e}=await import("./EmployeeLifecycleService-Dhzp-DSz.js");return{EmployeeLifecycleService:e}},__vite__mapDeps([0,1,2,3,4]));return await t.getLifecycleStats(e)}catch(t){Pt("employees.getLifecycleStats",t)}},async getArchived(e){try{return(await mt.loadArchivedEmployees(e)).documents}catch(t){Pt("employees.getArchived",t)}},async getAllWarningsForEmployee(e,t){try{return await mt.getAllWarningsForEmployee(e,t)}catch(a){Pt("employees.getAllWarningsForEmployee",a)}}},Ft={async getById(e){try{return await dt.getOrganization(e)}catch(t){Pt("organizations.getById",t)}},async update(e,t){try{throw new Error("Organization updates not implemented in DataServiceV2")}catch(a){Pt("organizations.update",a)}},async getCategories(e){try{return await mt.getWarningCategories(e)}catch(t){Pt("organizations.getCategories",t)}}},Mt={getUniversal:()=>vt,getById:e=>bt(e)||null,getEscalationPath:e=>wt(e),getNextLevel:(e,t)=>function(e,t){const a=bt(e);if(!a)return null;const r=a.escalationPath.indexOf(t);return-1===r||r===a.escalationPath.length-1?null:a.escalationPath[r+1]}(e,t)||"verbal"},Wt={async loadDashboardData(e,t){try{const a=Date.now(),[r,s,i]=await Promise.all([Lt.getByManager(t,e),Promise.resolve([]),Promise.resolve({})]),n=Date.now()-a;return Pe.success(`üöÄ [BATCH] Dashboard data loaded in ${n}ms (employees: ${r.length})`),{employees:r,followUps:s,stats:i,loadTime:n}}catch(a){throw Pt("batch.loadDashboardData",a),a}},async loadOrganizationSetup(e){try{const t=Date.now(),a=gt.generateOrgKey(e,"organization"),r=gt.generateOrgKey(e,"categories"),s=gt.generateOrgKey(e,"settings"),[i,n,o]=await Promise.all([gt.getOrFetch(a,()=>dt.getOrganization(e)),gt.getOrFetch(r,()=>mt.getWarningCategories(e)),gt.getOrFetch(s,()=>Promise.resolve({}))]),l=Date.now()-t;return Pe.success(`üöÄ [BATCH] Organization setup loaded in ${l}ms`),{organization:i,categories:n,settings:o,loadTime:l}}catch(t){throw Pt("batch.loadOrganizationSetup",t),t}}},Ut={warnings:_t,employees:Lt,organizations:Ft,categories:Mt,batch:Wt,reports:{async getAll(e){try{return[]}catch(t){Pt("reports.getAll",t)}}},analytics:{async getDashboardMetrics(e){try{return{complianceScore:94,costPerEmployee:4250,riskScore:12}}catch(t){Pt("analytics.getDashboardMetrics",t)}}}},Ht=({message:e="Loading...",size:t="md"})=>Te.jsxs("div",{className:`flex items-center justify-center ${{sm:"py-4",md:"py-6",lg:"py-8"}[t]}`,children:[Te.jsx(M,{className:`${{sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"}[t]} animate-spin text-blue-600`}),Te.jsx("span",{className:"ml-2 text-sm text-gray-600",children:e})]}),Vt=({onClose:e,inline:r=!1,organizationId:s,organizationName:i,allowEdit:n=!1})=>{const{user:o}=it(),l=a.useContext(pt),c=l?.organization||null,d=l?.organizationId,m=s||d,[u,g]=t.useState([]),[p,h]=t.useState(!0),[x,y]=t.useState(null),[f,v]=t.useState(null),[b,w]=t.useState(null),[N,j]=t.useState(!1),[D,A]=t.useState(!1),[E,C]=t.useState({name:"",description:"",level:"verbal",color:"#10b981",icon:"üìã",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]}),S=n&&"super-user"===o?.role?.id,I=async()=>{if(!m)return y("Organization ID not found"),void h(!1);try{h(!0),y(null);const e=await Ut.organizations.getCategories(m);g(e)}catch(e){Pe.error("[OrganizationCategoriesViewer] Error loading categories:",e),y(e instanceof Error?e.message:"Failed to load categories")}finally{h(!1)}};t.useEffect(()=>{I()},[m]);const k=e=>{switch(e){case"minor":case"low":return"#10b981";case"serious":case"medium":return"#f59e0b";case"gross_misconduct":case"high":return"#ef4444";default:return"#6b7280"}},z=e=>{switch(e){case"minor":case"low":return Te.jsx(ae,{className:"h-4 w-4"});case"serious":case"medium":return Te.jsx(V,{className:"h-4 w-4"});case"gross_misconduct":case"high":return Te.jsx(F,{className:"h-4 w-4"});default:return Te.jsx(te,{className:"h-4 w-4"})}},R=Te.jsxs(Te.Fragment,{children:[!r&&Te.jsx("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx("div",{className:"bg-violet-600 text-white p-2 rounded-lg",children:Te.jsx(W,{className:"h-6 w-6"})}),Te.jsxs("div",{children:[Te.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Warning Categories"}),Te.jsxs("p",{className:"text-gray-600",children:[i||c?.name," ‚Ä¢ ",u.length," categories configured"]})]})]}),Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx("button",{onClick:I,disabled:p,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",title:"Refresh categories",children:Te.jsx(U,{className:"h-4 w-4 "+(p?"animate-spin":"")})}),Te.jsx("button",{onClick:e,className:"p-2 text-gray-500 hover:text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50",title:"Close",children:Te.jsx(F,{className:"h-4 w-4"})})]})]})}),r&&Te.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-3",children:Te.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[Te.jsxs("div",{className:"flex items-center gap-4",children:[Te.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Warning Categories"}),Te.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(W,{className:"w-3 h-3"}),u.length," total"]}),Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(H,{className:"w-3 h-3"}),u.filter(e=>!1!==e.isActive).length," active"]})]})]}),Te.jsxs("button",{onClick:I,disabled:p,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-md transition-colors disabled:opacity-50",title:"Refresh categories",children:[Te.jsx(U,{className:"w-3.5 h-3.5 "+(p?"animate-spin":"")}),"Refresh"]})]})}),Te.jsx("div",{className:"flex-1 overflow-auto",children:p?Te.jsx(Ht,{message:"Loading categories..."}):x?Te.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:[Te.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Te.jsx(V,{className:"w-3.5 h-3.5 text-red-600"}),Te.jsx("span",{className:"text-sm font-medium text-red-800",children:"Error Loading Categories"})]}),Te.jsx("p",{className:"text-xs text-red-600 mb-2",children:x}),Te.jsx("button",{onClick:I,className:"px-3 py-1.5 text-xs font-medium bg-red-600 text-white rounded-md hover:bg-red-700",children:"Try Again"})]}):0===u.length?Te.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[Te.jsx(W,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),Te.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No Categories Found"}),Te.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"No warning categories have been configured for this organization yet."}),Te.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:Te.jsxs("div",{className:"flex items-center gap-2 text-blue-800 text-xs",children:[Te.jsx(q,{className:"w-3.5 h-3.5"}),Te.jsx("span",{children:"Categories can only be configured by SuperUser administrators for security and compliance."})]})})]}):Te.jsxs("div",{className:"space-y-3",children:[!S&&Te.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(B,{className:"w-3.5 h-3.5 text-blue-600 flex-shrink-0"}),Te.jsxs("div",{children:[Te.jsx("h4",{className:"text-xs font-semibold text-blue-900 mb-0.5",children:"Read-Only View"}),Te.jsx("p",{className:"text-xs text-blue-800",children:"Category modifications are restricted to SuperUser administrators to ensure compliance and data integrity."})]})]})}),S&&Te.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(G,{className:"w-3.5 h-3.5 text-green-600 flex-shrink-0"}),Te.jsxs("div",{children:[Te.jsx("h4",{className:"text-xs font-semibold text-green-900 mb-0.5",children:"SuperUser Edit Mode"}),Te.jsx("p",{className:"text-xs text-green-800",children:"You can edit, activate/deactivate, and delete categories for this organization."})]})]})}),S&&!D&&Te.jsxs("button",{onClick:()=>A(!0),className:"w-full flex items-center justify-center gap-2 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[Te.jsx(K,{className:"w-4 h-4"}),Te.jsx("span",{className:"font-medium",children:"Create New Category"})]}),S&&D&&Te.jsxs("div",{className:"bg-white border-2 border-blue-400 rounded-lg p-4 space-y-4",children:[Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsx("h4",{className:"text-base font-semibold text-gray-900",children:"Create New Category"}),Te.jsx("button",{onClick:()=>A(!1),className:"p-1.5 hover:bg-gray-100 rounded",children:Te.jsx(F,{className:"w-5 h-5 text-gray-600"})})]}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Name *"}),Te.jsx("input",{type:"text",value:E.name||"",onChange:e=>C({...E,name:e.target.value}),placeholder:"e.g., Attendance Issues",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Starting Level"}),Te.jsxs("select",{value:E.level||"verbal",onChange:e=>C({...E,level:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[Te.jsx("option",{value:"counselling",children:"Counselling"}),Te.jsx("option",{value:"verbal",children:"Verbal Warning"}),Te.jsx("option",{value:"first_written",children:"First Written Warning"}),Te.jsx("option",{value:"second_written",children:"Second Written Warning"}),Te.jsx("option",{value:"final_written",children:"Final Written Warning"}),Te.jsx("option",{value:"suspension",children:"Suspension"}),Te.jsx("option",{value:"dismissal",children:"Dismissal"})]})]}),Te.jsxs("div",{className:"md:col-span-2",children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),Te.jsx("textarea",{value:E.description||"",onChange:e=>C({...E,description:e.target.value}),placeholder:"Brief description of this category...",rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Color"}),Te.jsx("input",{type:"color",value:E.color||"#10b981",onChange:e=>C({...E,color:e.target.value}),className:"w-full h-10 border border-gray-300 rounded-lg"})]}),Te.jsx("div",{className:"flex items-center",children:Te.jsxs("label",{className:"flex items-center",children:[Te.jsx("input",{type:"checkbox",checked:!1!==E.isActive,onChange:e=>C({...E,isActive:e.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),Te.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Active Category"})]})})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category Icon"}),Te.jsx("div",{className:"grid grid-cols-8 gap-2 p-3 border border-gray-300 rounded-lg bg-gray-50",children:["üìã","‚ö†Ô∏è","üìä","üîí","üëî","üíº","üè¢","üìû","üñ•Ô∏è","üìù","üóÇÔ∏è","üìÖ","üîß","‚ö°","üéØ","üìà"].map(e=>Te.jsx("button",{type:"button",onClick:()=>C({...E,icon:e}),className:"w-10 h-10 rounded-lg border-2 text-xl flex items-center justify-center transition-all duration-200 hover:bg-gray-100 "+(E.icon===e?"border-blue-500 bg-blue-50":"border-gray-200 bg-white"),children:e},e))}),E.icon&&Te.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:["Selected: ",Te.jsx("span",{className:"text-xl",children:E.icon})]})]}),Te.jsxs("div",{className:"flex gap-3 pt-2",children:[Te.jsx("button",{onClick:async()=>{if(m&&S)if(E.name?.trim())try{j(!0);const e={id:`custom-${Date.now()}`,name:E.name,description:E.description||"",level:E.level||"verbal",color:E.color||"#10b981",icon:E.icon||"üìã",isActive:!1!==E.isActive,isDefault:!1,escalationPath:E.escalationPath||["verbal","first_written","final_written"]},t=[...u,e];await Ye.updateDocument(m,"organizations",m,{categories:t}),await I(),A(!1),C({name:"",description:"",level:"verbal",color:"#10b981",icon:"üìã",isActive:!0,isDefault:!1,escalationPath:["verbal","first_written","final_written"]}),Pe.success("Category created successfully")}catch(e){Pe.error("Failed to create category:",e)}finally{j(!1)}else alert("Category name is required")},disabled:N||!E.name?.trim(),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:N?"Creating...":"Create Category"}),Te.jsx("button",{onClick:()=>A(!1),disabled:N,className:"px-4 py-2.5 bg-gray-200 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-300 disabled:opacity-50 transition-colors",children:"Cancel"})]})]}),Te.jsx("div",{className:"space-y-1.5",children:u.map(e=>{const t=f===e.id;return Te.jsx("div",{className:"border border-gray-200 rounded-lg bg-white",children:Te.jsxs("div",{className:"p-2.5",children:[Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[Te.jsx("div",{className:"w-3 h-3 rounded-full border border-gray-300 flex-shrink-0",style:{backgroundColor:e.color||k(e.severity)}}),Te.jsxs("div",{className:"flex-1 min-w-0",children:[Te.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[Te.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:e.name}),Te.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded text-white text-xs font-medium",style:{backgroundColor:k(e.severity)},children:[Te.jsx("span",{className:"scale-75",children:z(e.severity)}),e.severity?.replace("_"," ")||"Unknown"]}),!1!==e.isActive&&Te.jsxs("div",{className:"flex items-center gap-0.5 px-1.5 py-0.5 bg-green-100 text-green-800 rounded text-xs font-medium",children:[Te.jsx(H,{className:"w-2.5 h-2.5"}),"Active"]})]}),e.description&&Te.jsx("p",{className:"text-xs text-gray-600 mb-1.5 line-clamp-2",children:e.description}),Te.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(Z,{className:"w-3 h-3"}),e.escalationPath?.length||0," steps"]}),e.createdAt&&Te.jsx("span",{children:new Date(e.createdAt).toLocaleDateString("en-ZA")})]})]})]}),Te.jsxs("div",{className:"flex items-center gap-1",children:[S&&Te.jsxs(Te.Fragment,{children:[Te.jsx("button",{onClick:()=>(async e=>{if(m&&S)try{j(!0);const t=u.map(t=>t.id===e.id?{...t,isActive:!1===t.isActive}:t);await Ye.updateDocument(m,"organizations",m,{categories:t}),await I(),Pe.success("Category "+(!1!==e.isActive?"deactivated":"activated"))}catch(t){Pe.error("Failed to toggle category:",t)}finally{j(!1)}})(e),disabled:N,className:"p-1.5 rounded hover:bg-gray-50 flex-shrink-0 "+(!1!==e.isActive?"text-green-600 hover:text-green-700":"text-gray-400 hover:text-gray-600"),title:!1!==e.isActive?"Deactivate category":"Activate category",children:!1!==e.isActive?Te.jsx(Y,{className:"w-3.5 h-3.5"}):Te.jsx(J,{className:"w-3.5 h-3.5"})}),Te.jsx("button",{onClick:()=>(async e=>{if(m&&S&&confirm("Are you sure you want to delete this category?"))try{j(!0);const t=u.filter(t=>t.id!==e);await Ye.updateDocument(m,"organizations",m,{categories:t}),await I(),Pe.success("Category deleted successfully")}catch(t){Pe.error("Failed to delete category:",t)}finally{j(!1)}})(e.id),disabled:N,className:"p-1.5 text-red-500 hover:text-red-700 rounded hover:bg-red-50 flex-shrink-0",title:"Delete category",children:Te.jsx(Q,{className:"w-3.5 h-3.5"})})]}),Te.jsx("button",{onClick:()=>v(t?null:e.id),className:"p-1.5 text-gray-400 hover:text-gray-600 rounded hover:bg-gray-50 flex-shrink-0",title:t?"Collapse details":"Expand details",children:t?Te.jsx(X,{className:"w-3.5 h-3.5"}):Te.jsx(ee,{className:"w-3.5 h-3.5"})})]})]}),t&&Te.jsx("div",{className:"mt-3 pt-2.5 border-t border-gray-200",children:Te.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[Te.jsxs("div",{children:[Te.jsxs("h5",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[Te.jsx(Z,{className:"w-3 h-3"}),"Escalation Path"]}),e.escalationPath&&e.escalationPath.length>0?Te.jsx("div",{className:"space-y-1",children:e.escalationPath.map((e,t)=>Te.jsxs("div",{className:"flex items-center gap-2 p-1.5 bg-gray-50 rounded text-xs",children:[Te.jsx("span",{className:"w-4 h-4 bg-blue-500 text-white text-[10px] rounded-full flex items-center justify-center font-semibold flex-shrink-0",children:t+1}),Te.jsx("span",{className:"font-medium capitalize",children:e.replace("_"," ")})]},t))}):Te.jsx("p",{className:"text-gray-500 text-xs",children:"No escalation path defined"})]}),Te.jsxs("div",{children:[Te.jsxs("h5",{className:"text-xs font-semibold text-gray-900 mb-2 flex items-center gap-1",children:[Te.jsx(te,{className:"w-3 h-3"}),"Details"]}),Te.jsxs("div",{className:"space-y-1.5 text-xs",children:[Te.jsxs("div",{children:[Te.jsx("span",{className:"font-medium text-gray-700",children:"Category ID:"}),Te.jsx("span",{className:"text-gray-600 ml-1 font-mono text-[10px]",children:e.id})]}),Te.jsxs("div",{children:[Te.jsx("span",{className:"font-medium text-gray-700",children:"Severity:"}),Te.jsx("span",{className:"text-gray-600 ml-1 capitalize",children:e.severity?.replace("_"," ")||"Not specified"})]}),e.examples&&e.examples.length>0&&Te.jsxs("div",{children:[Te.jsx("span",{className:"font-medium text-gray-700",children:"Examples:"}),Te.jsxs("div",{className:"mt-1.5 flex flex-wrap gap-1",children:[e.examples.slice(0,3).map((e,t)=>Te.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-[10px] rounded",children:e},t)),e.examples.length>3&&Te.jsxs("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded",children:["+",e.examples.length-3," more"]})]})]})]})]})]})})]})},e.id)})}),Te.jsx("div",{className:"bg-gray-50 rounded-lg p-2.5 border border-gray-200",children:Te.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600 flex-wrap gap-2",children:[Te.jsxs("span",{children:["Total: ",Te.jsx("strong",{children:u.length})," configured"]}),Te.jsxs("span",{children:["Active: ",Te.jsx("strong",{children:u.filter(e=>!1!==e.isActive).length})]}),S?Te.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[Te.jsx(G,{className:"w-2.5 h-2.5"}),"Edit mode"]}):Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(B,{className:"w-2.5 h-2.5"}),"Read-only"]})]})})]})})]});return r?Te.jsx("div",{className:"space-y-4",children:R}):Te.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:Te.jsx("div",{className:"bg-white rounded-xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:R})})},qt=[{name:"Operations",description:"Core business operations and daily management activities",isDefault:!0,isActive:!0},{name:"Admin",description:"Human resources, administration, and support functions",isDefault:!0,isActive:!0}];const Bt=new class{getCollectionPath(e){return`organizations/${e}/departments`}async createDefaultDepartments(e){try{const t=$(Fe),a=[],r=new Date;for(const s of qt){const i=y(v(Fe,this.getCollectionPath(e))),n={id:i.id,...s,organizationId:e,employeeCount:0,createdAt:r,updatedAt:r};t.set(i,{...n,createdAt:O.fromDate(r),updatedAt:O.fromDate(r)}),a.push(n)}return await t.commit(),Pe.success("Default departments created successfully",{organizationId:e,count:a.length}),a}catch(t){throw Pe.error("Failed to create default departments",{error:t,organizationId:e}),t}}async getDepartments(e){try{const t=b(v(Fe,this.getCollectionPath(e)),E("isActive","==",!0),C("isDefault","desc"),C("name","asc")),a=await w(t),r=[];return a.forEach(e=>{const t=e.data();r.push({id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date})}),r.length,r}catch(t){throw Pe.error("Failed to get departments",{error:t,organizationId:e}),t}}async getDepartment(e,t){try{const a=y(Fe,this.getCollectionPath(e),t),r=await f(a);if(!r.exists())return null;const s=r.data();return{id:r.id,...s,createdAt:s.createdAt?.toDate()||new Date,updatedAt:s.updatedAt?.toDate()||new Date}}catch(a){throw Pe.error("Failed to get department",{error:a,organizationId:e,departmentId:t}),a}}async createDepartment(e,t){try{const a=new Date,r={name:t.name.trim(),description:t.description?.trim()||"",managerId:t.managerId||null,managerName:null,managerEmail:null,employeeCount:0,isDefault:!1,organizationId:e,isActive:!0,createdAt:O.fromDate(a),updatedAt:O.fromDate(a)},s=await k(v(Fe,this.getCollectionPath(e)),r),i={id:s.id,...r,createdAt:a,updatedAt:a};return t.managerId&&await this.updateManagerInfo(e,s.id,t.managerId),Pe.success("Department created successfully",{organizationId:e,departmentId:s.id}),i}catch(a){throw Pe.error("Failed to create department",{error:a,organizationId:e,formData:t}),a}}async updateDepartment(e,t,a){try{const r=y(Fe,this.getCollectionPath(e),t),s={name:a.name.trim(),description:a.description?.trim()||"",managerId:a.managerId||null,updatedAt:O.fromDate(new Date)};await D(r,s),a.managerId?await this.updateManagerInfo(e,t,a.managerId):await D(r,{managerName:null,managerEmail:null}),Pe.success("Department updated successfully",{organizationId:e,departmentId:t})}catch(r){throw Pe.error("Failed to update department",{error:r,organizationId:e,departmentId:t,formData:a}),r}}async deleteDepartment(e,t){try{const a=await this.getDepartment(e,t);if(a?.isDefault)throw new Error("Cannot delete default departments (Operations, Admin)");const r=y(Fe,this.getCollectionPath(e),t);await D(r,{isActive:!1,updatedAt:O.fromDate(new Date)}),Pe.success("Department deleted successfully",{organizationId:e,departmentId:t})}catch(a){throw Pe.error("Failed to delete department",{error:a,organizationId:e,departmentId:t}),a}}async updateManagerInfo(e,t,a){try{const r=y(Fe,`organizations/${e}/employees/${a}`),s=await f(r);if(s.exists()){const a=s.data(),r=`${a.profile?.firstName||""} ${a.profile?.lastName||""}`.trim(),i=a.profile?.email||"",n=y(Fe,this.getCollectionPath(e),t);await D(n,{managerName:r,managerEmail:i,updatedAt:O.fromDate(new Date)})}}catch(r){Pe.error("Failed to update manager info",{error:r,organizationId:e,departmentId:t,managerId:a})}}async getDepartmentStats(e){try{const t=await this.getDepartments(e),a=t.length,r=t.filter(e=>e.managerId).length,s=a-r,i=t.reduce((e,t)=>e+t.employeeCount,0),n=a>0?i/a:0;return{totalDepartments:a,departmentsWithManagers:r,departmentsWithoutManagers:s,totalEmployeesAcrossDepartments:i,averageEmployeesPerDepartment:Math.round(100*n)/100}}catch(t){throw Pe.error("Failed to get department stats",{error:t,organizationId:e}),t}}subscribeToDepartments(e,t){const a=b(v(Fe,this.getCollectionPath(e)),E("isActive","==",!0),C("isDefault","desc"),C("name","asc"));return P(a,e=>{const a=[];e.forEach(e=>{const t=e.data();a.push({id:e.id,...t,createdAt:t.createdAt?.toDate()||new Date,updatedAt:t.updatedAt?.toDate()||new Date})}),t(a)},t=>{Pe.error("Department subscription error",{error:t,organizationId:e})})}async updateEmployeeCount(e,t,a){try{const r=y(Fe,this.getCollectionPath(e),t);await D(r,{employeeCount:a,updatedAt:O.fromDate(new Date)})}catch(r){throw Pe.error("Failed to update employee count",{error:r,organizationId:e,departmentId:t,newCount:a}),r}}async refreshEmployeeCounts(e){try{const t=v(Fe,`organizations/${e}/employees`),a=await w(b(t,E("isActive","==",!0))),r={};a.forEach(e=>{const t=e.data(),a=t.profile?.department||t.employment?.department;a&&(r[a]=(r[a]||0)+1)});const s=await this.getDepartments(e),i=$(Fe);for(const n of s){const t=r[n.name]||0;if(n.employeeCount!==t){const a=y(Fe,this.getCollectionPath(e),n.id);i.update(a,{employeeCount:t,updatedAt:O.fromDate(new Date)})}}await i.commit(),Pe.success("Employee counts refreshed successfully",{organizationId:e,counts:r})}catch(t){throw Pe.error("Failed to refresh employee counts",{error:t,organizationId:e}),t}}async getDepartmentsForManager(e,t){try{return(await this.getDepartments(e)).filter(e=>!e.managerId||e.managerId===t)}catch(a){throw Pe.error("Failed to get departments for manager",{error:a,organizationId:e}),a}}},Gt=({children:e,className:t="",style:a,hover:r=!1,padding:s="md",shadow:i="md",onClick:n})=>{const o={sm:"var(--shadow-sm)",md:"var(--shadow)",lg:"var(--shadow-lg)",xl:"var(--shadow-xl)"},l={backgroundColor:"var(--color-card-background)",border:"1px solid var(--color-card-border)",boxShadow:o[i],transition:"all 0.2s ease",...a};return Te.jsx("div",{className:`rounded-lg ${{none:"",sm:"p-3",md:"p-4",lg:"p-6"}[s]} ${n?"cursor-pointer":""} ${t}`,style:l,onClick:n,onMouseEnter:e=>{r&&(e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow=o.lg)},onMouseLeave:e=>{r&&(e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=o[i])},children:e})},Kt=({icon:e,title:t,subtitle:a,rightContent:r,className:s=""})=>Te.jsxs("div",{className:`flex items-center justify-between ${s}`,children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(e,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}),Te.jsxs("div",{children:[Te.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--color-text)"},children:t}),a&&Te.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:a})]})]}),r&&Te.jsx("div",{className:"flex items-center gap-2",children:r})]}),Zt=({type:e="text",label:t,value:a,onChange:r,placeholder:s,error:i,icon:n,required:o=!1,disabled:l=!1,options:c,className:d=""})=>{const m={backgroundColor:i?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:i?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"};return Te.jsxs("div",{className:`space-y-2 ${d}`,children:[Te.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[n&&Te.jsx(n,{className:"w-3 h-3 inline mr-1"}),t," ",o&&Te.jsx("span",{style:{color:"var(--color-error)"},children:"*"})]}),(()=>{const i={value:a,onChange:e=>r(e.target.value),placeholder:s,disabled:l,className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm "+(l?"opacity-50 cursor-not-allowed":""),style:m};return"textarea"===e?Te.jsx("textarea",{...i,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm min-h-[88px] resize-vertical "+(l?"opacity-50 cursor-not-allowed":"")}):"select"===e&&c?Te.jsxs("select",{...i,children:[Te.jsx("option",{value:"",children:s||`Select ${t.toLowerCase()}...`}),c.map(e=>Te.jsx("option",{value:e.value,children:e.label},e.value))]}):Te.jsx("input",{...i,type:e})})(),i&&Te.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[Te.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:Te.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),i]})]})},Yt=({children:e,variant:t="default",size:a="sm",className:r=""})=>{const s=(()=>{switch(t){case"primary":return{backgroundColor:"var(--color-badge-primary)",color:"var(--color-badge-primary-text)"};case"success":return{backgroundColor:"var(--color-badge-success)",color:"var(--color-badge-success-text)"};case"warning":return{backgroundColor:"var(--color-badge-warning)",color:"var(--color-badge-warning-text)"};case"error":return{backgroundColor:"var(--color-badge-error)",color:"var(--color-badge-error-text)"};default:return{backgroundColor:"var(--color-badge-default)",color:"var(--color-badge-default-text)"}}})();return Te.jsx("span",{className:`inline-flex items-center ${{sm:"px-2 py-0.5 text-xs",md:"px-3 py-1 text-sm"}[a]} font-medium rounded-full ${r}`,style:s,children:e})},Jt=({children:e,variant:t="info",className:a="",onClose:r})=>{const s=(()=>{switch(t){case"success":return{backgroundColor:"var(--color-alert-success-bg)",borderColor:"var(--color-alert-success-border)",color:"var(--color-alert-success-text)"};case"warning":return{backgroundColor:"var(--color-alert-warning-bg)",borderColor:"var(--color-alert-warning-border)",color:"var(--color-alert-warning-text)"};case"error":return{backgroundColor:"var(--color-alert-error-bg)",borderColor:"var(--color-alert-error-border)",color:"var(--color-alert-error-text)"};default:return{backgroundColor:"var(--color-alert-info-bg)",borderColor:"var(--color-alert-info-border)",color:"var(--color-alert-info-text)"}}})();return Te.jsx("div",{className:`p-4 rounded-lg border ${a}`,style:{backgroundColor:s.backgroundColor,borderColor:s.borderColor,color:s.color},children:Te.jsxs("div",{className:"flex justify-between items-start",children:[Te.jsx("div",{className:"flex-1",children:e}),r&&Te.jsx("button",{onClick:r,className:"ml-3 text-lg leading-none opacity-60 hover:opacity-100 transition-opacity",style:{color:s.color},children:"√ó"})]})})},Qt=({variant:e="primary",size:t="md",fullWidth:a=!1,className:r="",children:s,style:i,onMouseEnter:n,onMouseLeave:o,...l})=>{const c=(e=>{switch(e){case"primary":default:return{backgroundColor:"var(--color-primary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-primary)",hoverColor:"var(--color-primary-hover)"};case"secondary":return{backgroundColor:"var(--color-secondary)",color:"var(--color-text-inverse)",border:"1px solid var(--color-secondary)",hoverColor:"var(--color-secondary-hover)"};case"accent":return{backgroundColor:"var(--color-accent)",color:"var(--color-text-inverse)",border:"1px solid var(--color-accent)",hoverColor:"var(--color-accent-hover)"};case"ghost":return{backgroundColor:"var(--color-btn-ghost)",color:"var(--color-text)",border:"1px solid transparent",hoverColor:"var(--color-btn-ghost-hover)"};case"outline":return{backgroundColor:"var(--color-btn-outline)",color:"var(--color-text)",border:"1px solid var(--color-btn-outline-border)",hoverColor:"var(--color-btn-outline-hover)"};case"danger":return{backgroundColor:"var(--color-error)",color:"var(--color-text-inverse)",border:"1px solid var(--color-error)",hoverColor:"var(--color-error)"}}})(e);return Te.jsx("button",{className:`${{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[t]} font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 ${a?"w-full":""} ${r}`,style:{backgroundColor:c.backgroundColor,color:c.color,border:c.border,boxShadow:"ghost"!==e&&"outline"!==e?"var(--shadow-sm)":"none",focusRingColor:"var(--color-primary)",...i},onMouseEnter:t=>{t.currentTarget.style.backgroundColor=c.hoverColor,"danger"===e&&(t.currentTarget.style.opacity="0.9"),n?.(t)},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=c.backgroundColor,e.currentTarget.style.opacity="1",o?.(e)},...l,children:s})},Xt=({role:e,skipData:a=[]}={})=>{const{user:r}=it(),{organization:s,categories:i,loading:n}=ht(),[o,l]=t.useState({organization:null,categories:[],user:null,employees:[],followUps:[],permissions:{},warnings:[],reports:[],teams:[],metrics:{},loading:{overall:!0,employees:!1,followUps:!1,permissions:!1,warnings:!1,reports:!1,teams:!1,metrics:!1},error:null}),c=t.useRef(!1),d=t.useRef(null),m=t.useCallback(e=>{const t={core:["organization","categories","permissions"],hod:["employees","followUps"],hr:["employees","followUps","warnings","reports","metrics"],business_owner:["employees","teams","reports","metrics"],super_admin:["employees","warnings","reports","metrics","teams"]};return[...t.core,...t[e]||[]].filter(e=>!a.includes(e))},[a]),u=t.useCallback(async()=>{if(!s?.id||!r?.id||n||c.current)return;const t=`${s.id}-${r.id}-${e||r.role}`;if(d.current!==t){c.current=!0;try{const a=e||r.role||"hod",n=m(a);l(e=>({...e,organization:s,categories:i||[],user:r,loading:{...e.loading,overall:!1,employees:n.includes("employees"),followUps:n.includes("followUps"),permissions:n.includes("permissions"),warnings:n.includes("warnings"),reports:n.includes("reports"),teams:n.includes("teams"),metrics:n.includes("metrics")},error:null}));Date.now();const o=(e,t)=>{l(a=>({...a,[e]:t,loading:{...a.loading,[e]:!1}}))};if(n.includes("permissions")&&gt.getOrFetch(`permissions:${r.id}:${s.id}`,()=>Promise.resolve({})).then(e=>o("permissions",e||{})).catch(e=>{Pe.error("‚ùå Failed to load permissions:",e),o("permissions",{})}),n.includes("employees")){const e="object"==typeof r.role&&r.role?.id?r.role.id:r.role||a,t="hr"===e||"business_owner"===e||"hr-manager"===e||"business-owner"===e,i=t?gt.generateOrgKey(s.id,"employees:all"):gt.generateOrgKey(s.id,`employees:manager:${r.id}`);gt.getOrFetch(i,async()=>{const e=t?await Ut.employees.getAll(s.id):await Ut.employees.getByManager(r.id,s.id);return e.length,e}).then(e=>o("employees",Array.isArray(e)?e:[])).catch(e=>{Pe.error("‚ùå Failed to load employees:",e),o("employees",[])})}n.includes("followUps")&&gt.getOrFetch(`followups:${r.id}:${s.id}`,()=>Promise.resolve([])).then(e=>o("followUps",Array.isArray(e)?e:[])).catch(e=>{Pe.error("‚ùå Failed to load followUps:",e),o("followUps",[])}),n.includes("warnings")&&gt.getOrFetch(gt.generateOrgKey(s.id,"warnings"),()=>Ut.warnings.getAll(s.id)).then(e=>o("warnings",Array.isArray(e)?e:[])).catch(e=>{Pe.error("‚ùå Failed to load warnings:",e),o("warnings",[])}),n.includes("reports")&&gt.getOrFetch(gt.generateOrgKey(s.id,"reports"),()=>Ut.reports.getAll(s.id)).then(e=>o("reports",Array.isArray(e)?e:[])).catch(e=>{Pe.error("‚ùå Failed to load reports:",e),o("reports",[])}),n.includes("teams")&&gt.getOrFetch(gt.generateOrgKey(s.id,"teams"),()=>mt.getAllEmployees(s.id)).then(e=>o("teams",Array.isArray(e)?e:[])).catch(e=>{Pe.error("‚ùå Failed to load teams:",e),o("teams",[])}),n.includes("metrics")&&gt.getOrFetch(gt.generateOrgKey(s.id,"metrics"),()=>Ut.analytics.getDashboardMetrics(s.id)).then(e=>o("metrics",e||{})).catch(e=>{Pe.error("‚ùå Failed to load metrics:",e),o("metrics",{})}),d.current=t,Date.now()}catch(a){Pe.error("‚ùå [DashboardData] Failed to initialize progressive loading:",a),l(e=>({...e,loading:{overall:!1,employees:!1,followUps:!1,permissions:!1,warnings:!1,reports:!1,teams:!1,metrics:!1},error:a instanceof Error?a.message:"Failed to load dashboard data"}))}finally{c.current=!1}}},[s,r,i,n,e,m]),g=t.useCallback(()=>{d.current=null,gt.clearByPrefix(`org:${s?.id}:`),u()},[s?.id,u]);return t.useEffect(()=>{s?.id&&r?.id&&!n&&null!==i&&u()},[s?.id,r?.id,n,i,u]),{...o,refreshData:g,isReady:!o.loading.overall&&!!s&&!!r}},ea=e=>{t.useEffect(()=>{if(!e)return;const t=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",document.body.classList.add("modal-open"),()=>{document.body.style.overflow=t,document.body.classList.remove("modal-open")}},[e])},ta={modal:9e3,modalNested1:9010,modalNested2:9020},aa=e=>{const{isActive:a,onEscape:r,autoFocus:s=!0,returnFocus:i=!0}=e,n=t.useRef(null),o=t.useRef(null),l=t.useCallback(()=>{if(!n.current)return[];const e=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", "),t=n.current.querySelectorAll(e);return Array.from(t).filter(e=>null!==e.offsetParent&&!e.hasAttribute("hidden")&&"true"!==e.getAttribute("aria-hidden"))},[]),c=t.useCallback(e=>{const t=l();if(0===t.length)return;const a=t[0],r=t[t.length-1];e.shiftKey?document.activeElement===a&&(e.preventDefault(),r.focus()):document.activeElement===r&&(e.preventDefault(),a.focus())},[l]),d=t.useCallback(e=>{if(a)return"Escape"===e.key&&r?(e.preventDefault(),void r()):void("Tab"===e.key&&c(e))},[a,r,c]);return t.useEffect(()=>{if(a){if(o.current=document.activeElement,s){const e=l();e.length>0&&setTimeout(()=>{e[0].focus()},10)}return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d),i&&o.current&&setTimeout(()=>{o.current?.focus()},10)}}},[a,s,i,l,d]),n},ra=e=>({containerRef:aa({isActive:e.isOpen,onEscape:e.onClose,autoFocus:e.autoFocus,returnFocus:e.returnFocus}),ariaProps:{role:"dialog","aria-modal":!0,...e.titleId&&{"aria-labelledby":e.titleId},...e.descriptionId&&{"aria-describedby":e.descriptionId}}}),sa=(e,t)=>{const a=new Date;return{id:`emp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,organizationId:t,isActive:e.isActive,createdAt:a.toISOString(),updatedAt:a.toISOString(),profile:{employeeNumber:e.employeeNumber,firstName:e.firstName,lastName:e.lastName,email:e.email.toLowerCase(),phoneNumber:e.phoneNumber||null,whatsappNumber:e.whatsappNumber||null,department:e.department,position:e.position,startDate:new Date(e.startDate)},employment:{startDate:new Date(e.startDate),contractType:e.contractType,probationEndDate:e.probationEndDate?new Date(e.probationEndDate):null,department:e.department,position:e.position,managerId:e.managerId||null},disciplinaryRecord:{totalWarnings:0,activeWarnings:0,currentLevel:"none",warningHistory:[],warningsByCategory:{}},deliveryPreferences:{primaryMethod:"email",allowAlternativeMethods:!0,whatsappConsent:!1,emailConsent:!0,printConsent:!1,lastUpdated:a}}},ia=e=>{if(!e)return"";try{if(e&&"function"==typeof e.toDate)return e.toDate().toISOString().split("T")[0];if(e instanceof Date)return e.toISOString().split("T")[0];if("string"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}if("number"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}return""}catch(t){return Pe.warn("Failed to convert date:",e,t),""}},na=(e,t)=>{if(!e)return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1};switch(e){case"super-user":case"hr-manager":return{canCreate:!0,canEdit:!0,canArchive:!0,canRestore:!0,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!0,canExport:!0};case"business-owner":return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!0,canViewArchived:!0,canViewDepartments:[],canViewContactInfo:!0,canBulkImport:!1,canExport:!0};case"hod-manager":case"hod":return{canCreate:!0,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:t||[],canViewContactInfo:!0,canBulkImport:!1,canExport:!1};default:return{canCreate:!1,canEdit:!1,canArchive:!1,canRestore:!1,canViewAll:!1,canViewArchived:!1,canViewDepartments:[],canViewContactInfo:!1,canBulkImport:!1,canExport:!1}}},oa=(e,a)=>{const[r,s]=t.useState({search:"",department:"",contractType:"",hasWarnings:!1,isActive:!0}),i=t.useMemo(()=>na(a?.role.id,a?.departmentIds),[a]),n=t.useMemo(()=>((e,t,a,r,s)=>e.filter(e=>{if(!e)return!1;if("hod-manager"!==r||e.profile||Pe.warn("üîç [FILTER DEBUG] Employee missing profile:",{id:e.id,hasEmployment:!!e.employment,managerId:e.employment?.managerId,currentUserId:s}),a.canViewAll||"hod"!==r&&"hod-manager"!==r){if(!a.canViewAll&&a.canViewDepartments.length>0){const t=e.profile?.department;if(!t||!a.canViewDepartments.includes(t))return!1}}else{const t=e.employment?.managerId;if(t&&t!==s)return!1}if(t.isActive&&!e.isActive)return!1;if(!t.isActive&&!e.isActive&&!a.canViewArchived)return!1;if(t.search){const a=t.search.toLowerCase();if(!((e.profile?.firstName?.toLowerCase()||"").includes(a)||(e.profile?.lastName?.toLowerCase()||"").includes(a)||(e.profile?.employeeNumber?.toLowerCase()||"").includes(a)||(e.profile?.email?.toLowerCase()||"").includes(a)))return!1}return!(t.department&&e.profile?.department!==t.department||t.contractType&&e.employment?.contractType!==t.contractType||t.hasWarnings&&(!e.disciplinaryRecord||0===e.disciplinaryRecord.activeWarnings))}))(e,r,i,a?.role?.id,a?.id),[e,r,i,a?.role?.id,a?.id]);return{filters:r,setFilters:s,filteredEmployees:n}},la=({employees:e})=>{const t=(e=>{const t={total:e.length,active:0,inactive:0,onProbation:0,withActiveWarnings:0,onProbationWithWarnings:0,departments:[],contractTypes:[]},a={},r={};return e.forEach(e=>{if(e.isActive?t.active++:t.inactive++,e.isActive){const a=e.employment?.probationEndDate&&new Date(e.employment.probationEndDate)>new Date,r=e.disciplinaryRecord?.activeWarnings>0;a&&t.onProbation++,r&&t.withActiveWarnings++,a&&r&&t.onProbationWithWarnings++}const s=e.profile?.department||"Unknown";a[s]=(a[s]||0)+1;const i=e.employment?.contractType||"Unknown";r[i]=(r[i]||0)+1}),t.departments=Object.entries(a).map(([e,t])=>({name:e,count:t})).sort((e,t)=>t.count-e.count),t.contractTypes=Object.entries(r).map(([e,t])=>({type:e,count:t})).sort((e,t)=>t.count-e.count),t})(e),a=[{value:t.total,label:"Total Employees",color:"blue",icon:"üë•"},{value:t.active,label:"Active",color:"green",icon:"‚úÖ"},{value:t.onProbationWithWarnings,label:"On Probation, With Warnings",color:"red",icon:"‚ö†Ô∏è"}];return Te.jsx("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:a.map((e,t)=>Te.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-2 sm:p-3 text-center shadow-md hover:shadow-lg transition-all duration-200",children:[Te.jsx("div",{className:"text-lg sm:text-xl mb-0.5 sm:mb-1",children:e.icon}),Te.jsx("div",{className:`text-lg sm:text-xl font-bold text-${e.color}-600 mb-0.5 sm:mb-1`,children:e.value}),Te.jsx("div",{className:"text-xs text-gray-600 font-medium leading-tight",children:e.label})]},t))})},ca=({filters:e,setFilters:t,departments:a,viewMode:r,setViewMode:s})=>Te.jsx("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl p-6 mb-8 shadow-xl",children:Te.jsx("div",{className:"flex flex-col gap-4",children:Te.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[Te.jsx("div",{className:"flex-1",children:Te.jsx("input",{type:"text",placeholder:"üîç Search employees by name, number, or email...",value:e.search,onChange:a=>t({...e,search:a.target.value}),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-colors"})}),Te.jsxs("select",{value:e.department,onChange:a=>t({...e,department:a.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[Te.jsx("option",{value:"",children:"All Departments"}),a.map(e=>Te.jsx("option",{value:e,children:e},e))]}),Te.jsxs("select",{value:e.contractType,onChange:a=>t({...e,contractType:a.target.value}),className:"px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none",children:[Te.jsx("option",{value:"",children:"All Contract Types"}),Te.jsx("option",{value:"permanent",children:"Permanent"}),Te.jsx("option",{value:"contract",children:"Contract"}),Te.jsx("option",{value:"temporary",children:"Temporary"})]}),Te.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[Te.jsx("input",{type:"checkbox",checked:e.hasWarnings,onChange:a=>t({...e,hasWarnings:a.target.checked}),className:"w-4 h-4"}),Te.jsx("span",{className:"font-medium text-gray-700",children:"Has Warnings"})]}),Te.jsxs("label",{className:"flex items-center gap-2 px-4 py-3 bg-white rounded-xl border-2 border-gray-200",children:[Te.jsx("input",{type:"checkbox",checked:e.isActive,onChange:a=>t({...e,isActive:a.target.checked}),className:"w-4 h-4"}),Te.jsx("span",{className:"font-medium text-gray-700",children:"Active Only"})]}),Te.jsxs("div",{className:"flex gap-2",children:[Te.jsx("button",{onClick:()=>s("table"),className:"px-4 py-3 rounded-xl font-medium transition-all "+("table"===r?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"üìã Table"}),Te.jsx("button",{onClick:()=>s("cards"),className:"px-4 py-3 rounded-xl font-medium transition-all "+("cards"===r?"bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"üì± Cards"})]})]})})}),da=({employee:e,permissions:t,onEdit:a,onArchive:r,onViewWarnings:s})=>{const i=(()=>{if(!e.employment?.probationEndDate)return null;const t=new Date(e.employment.probationEndDate),a=new Date,r=Math.ceil((t.getTime()-a.getTime())/864e5);return r<=0?null:{daysLeft:r,status:r<=7?"critical":r<=30?"warning":"normal"}})(),n=e.disciplinaryRecord?.activeWarnings||0;return Te.jsxs("div",{className:`\n        bg-white rounded-lg border border-gray-200 overflow-hidden\n        transition-all duration-200 hover:shadow-md\n        ${e.isActive?"":"opacity-60"}\n      `,onClick:t.canEdit?()=>a(e):void 0,style:{cursor:t.canEdit?"pointer":"default"},children:[Te.jsxs("div",{className:"px-3 py-2.5 sm:px-4 sm:py-4",children:[Te.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[Te.jsxs("div",{className:"flex-1 min-w-0",children:[Te.jsxs("h3",{className:"text-base font-bold text-gray-900 truncate leading-tight",children:[e.profile.firstName," ",e.profile.lastName]}),Te.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e.profile?.position||"N/A"})]}),n>0&&Te.jsxs("div",{className:`\n              flex items-center gap-1 px-2 py-1 rounded-full flex-shrink-0\n              ${n>=3?"bg-red-100":"bg-yellow-100"}\n            `,children:[Te.jsx("span",{className:"text-sm",children:"‚ö†Ô∏è"}),Te.jsx("span",{className:`\n                text-xs font-bold\n                ${n>=3?"text-red-700":"text-yellow-700"}\n              `,children:n})]})]}),Te.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600 mb-2",children:[Te.jsx("span",{className:"truncate",children:e.profile?.department||"N/A"}),Te.jsx("span",{className:"text-gray-400",children:"‚Ä¢"}),Te.jsxs("span",{className:"flex-shrink-0",children:["#",e.profile.employeeNumber]})]}),Te.jsxs("div",{className:"flex flex-wrap gap-1",children:[Te.jsxs("span",{className:`\n            inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full\n            ${e.isActive?"bg-green-50 text-green-700":"bg-gray-100 text-gray-600"}\n          `,children:[Te.jsx("span",{className:"w-1.5 h-1.5 rounded-full ${employee.isActive ? 'bg-green-500' : 'bg-gray-400'}"}),e.isActive?"Active":"Archived"]}),Te.jsx("span",{className:`\n            inline-flex px-2 py-1 text-xs font-medium rounded-full capitalize\n            ${"permanent"===e.employment?.contractType?"bg-blue-50 text-blue-700":"bg-purple-50 text-purple-700"}\n          `,children:e.employment?.contractType||"N/A"}),i&&e.isActive&&Te.jsxs("span",{className:`\n              inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full\n              ${"critical"===i.status?"bg-red-50 text-red-700":"warning"===i.status?"bg-orange-50 text-orange-700":"bg-blue-50 text-blue-700"}\n            `,children:["‚è≥ ",i.daysLeft,"d"]}),0===n&&Te.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium rounded-full bg-green-50 text-green-700",children:[Te.jsx("span",{className:"text-xs",children:"‚úì"})," Clean Record"]})]})]}),Te.jsxs("div",{className:"border-t border-gray-100 px-3 py-2 sm:px-4 sm:py-2 bg-gray-50/50",children:[n>0&&s&&Te.jsxs("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"w-full mb-2 py-2 sm:py-2.5 px-3 bg-amber-50 border border-amber-200 text-amber-700 rounded-lg hover:bg-amber-100 font-medium transition-colors text-sm active:scale-95 flex items-center justify-center gap-2",children:[Te.jsx("span",{children:"‚ö†Ô∏è"}),Te.jsxs("span",{children:["View ",n," Active Warning",1!==n?"s":""]})]}),t.canEdit&&Te.jsxs("div",{className:"flex gap-2",children:[Te.jsx("button",{onClick:t=>{t.stopPropagation(),a(e)},className:"flex-1 py-2 sm:py-2.5 px-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors text-sm active:scale-95",children:"Edit Details"}),e.isActive&&t.canArchive&&Te.jsx("button",{onClick:t=>{t.stopPropagation(),r(e)},className:"px-3 py-2 sm:py-2.5 border border-gray-300 bg-white text-gray-700 rounded-lg hover:bg-gray-50 font-medium transition-colors text-sm active:scale-95",children:"Archive"})]})]})]})},ma=({employee:e,onClose:a,onSave:r,basicMode:s=!1})=>{const{organization:i,user:n}=it(),[o,l]=t.useState({employeeNumber:"",firstName:"",lastName:"",email:"",phoneNumber:"",whatsappNumber:"",department:"",position:"",startDate:"",contractType:"permanent",probationEndDate:"",managerId:""}),[c,d]=t.useState(null),[m,u]=t.useState(!1),[g,p]=t.useState([]),[h,x]=t.useState(!1),[y,f]=t.useState([]),[v,b]=t.useState(!1);ea(!0);const{containerRef:w,ariaProps:N}=ra({isOpen:!0,onClose:a,titleId:"employee-form-title",descriptionId:"employee-form-description"});t.useEffect(()=>{(async()=>{if(i)try{x(!0);const e=await Ye.queryDocuments(i.id,"users",[]),t=e.documents.filter(e=>{const t="string"==typeof(a=e.role)?a:a?.id||"";var a;return"hod-manager"===t||"hr-manager"===t||"business-owner"===t});p(t)}catch(e){Pe.error("Failed to load managers:",e)}finally{x(!1)}})()},[i]),t.useEffect(()=>{(async()=>{if(i)try{b(!0);const e=await Bt.getDepartments(i.id);f(e)}catch(e){Pe.error("Failed to load departments:",e)}finally{b(!1)}})()},[i]),t.useEffect(()=>{if(e){const t=(e=>({employeeNumber:e.profile?.employeeNumber||"",firstName:e.profile?.firstName||"",lastName:e.profile?.lastName||"",email:e.profile?.email||"",phoneNumber:e.profile?.phoneNumber||"",whatsappNumber:e.profile?.whatsappNumber||"",department:e.profile?.department||"",position:e.profile?.position||"",startDate:ia(e.profile?.startDate),contractType:e.employment?.contractType||"permanent",probationEndDate:ia(e.employment?.probationEndDate),managerId:e.employment?.managerId||"",isActive:e.isActive??!0}))(e);l(t)}else if(s&&i){const e=(new Date).toISOString().split("T")[0];l(t=>{return{...t,employeeNumber:(a=i.id,`${a.toUpperCase().substring(0,3)}${Date.now().toString().slice(-6)}${Math.floor(99*Math.random()).toString().padStart(2,"0")}`),department:n?.departmentIds?.[0]||n?.profile?.department||"Operations",startDate:e,managerId:n?.id,isActive:!0};var a})}},[e,s,i,n]);return Te.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:ta.modal},onClick:e=>{e.target===e.currentTarget&&a()},children:Te.jsxs("div",{ref:w,...N,className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] flex flex-col shadow-2xl",children:[Te.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 flex-shrink-0",children:[Te.jsxs("div",{children:[Te.jsx("h2",{id:"employee-form-title",className:"text-xl font-bold text-slate-800",children:e?"Edit Employee":s?"Quick Add Employee":"Add New Employee"}),Te.jsx("p",{id:"employee-form-description",className:"text-sm text-slate-600 mt-1",children:s?"Basic details only - HR can complete the full profile later":"Fill in the employee details below"})]}),Te.jsx("button",{type:"button",onClick:a,className:"p-2 hover:bg-slate-100 rounded-lg transition-colors","aria-label":"Close employee form modal",children:Te.jsx(F,{className:"w-5 h-5"})})]}),Te.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),i){u(!0),d(null);try{if(e){const t={...e,profile:{...e.profile,employeeNumber:o.employeeNumber,firstName:o.firstName,lastName:o.lastName,email:o.email,phoneNumber:o.phoneNumber||null,whatsappNumber:o.whatsappNumber||null,department:o.department,position:o.position,startDate:o.startDate?new Date(o.startDate):new Date},employment:{...e.employment,contractType:o.contractType,managerId:o.managerId||void 0,...o.probationEndDate&&{probationEndDate:new Date(o.probationEndDate)}},isActive:e.isActive,updatedAt:new Date};await Ut.employees.update(e.id,i.id,t),e.id}else{const e=sa(o,i.id),{id:t,...a}=e;await Ut.employees.create(a)}r()}catch(a){Pe.error("Error saving employee:",a),d(a.message||"Failed to save employee")}finally{u(!1)}}},className:"flex flex-col flex-1 min-h-0",children:[Te.jsxs("div",{className:"overflow-y-auto flex-1 p-6 space-y-6",children:[c&&Te.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:Te.jsx("p",{className:"text-red-800 text-sm",children:c})}),Te.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[Te.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[Te.jsx(re,{className:"w-5 h-5 text-blue-600"}),"Personal Information"]}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Employee Number *"}),Te.jsx("input",{type:"text",required:!0,value:o.employeeNumber,onChange:e=>l({...o,employeeNumber:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none "+(s?"bg-slate-50":""),placeholder:"EMP001",readOnly:s,title:s?"Auto-generated - HR can change this later":""})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Start Date *"}),Te.jsx("input",{type:"date",required:!0,value:o.startDate,onChange:e=>l({...o,startDate:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none"})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"First Name *"}),Te.jsx("input",{type:"text",required:!0,value:o.firstName,onChange:e=>l({...o,firstName:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"John"})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Last Name *"}),Te.jsx("input",{type:"text",required:!0,value:o.lastName,onChange:e=>l({...o,lastName:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Doe"})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Email Address *"}),Te.jsx("input",{type:"email",required:!0,value:o.email,onChange:e=>l({...o,email:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"john.doe@company.com"})]}),Te.jsxs("div",{children:[Te.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Phone Number ",s?"(Optional)":""]}),Te.jsx("input",{type:"tel",value:o.phoneNumber,onChange:e=>l({...o,phoneNumber:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})]})]}),Te.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[Te.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[Te.jsx(se,{className:"w-5 h-5 text-emerald-600"}),"Work Information"]}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Department *"}),Te.jsxs("select",{required:!0,value:o.department,onChange:e=>l({...o,department:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",disabled:v,children:[Te.jsx("option",{value:"",children:"Select Department"}),y.map(e=>Te.jsx("option",{value:e.name,children:e.name},e.id))]}),v&&Te.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading departments..."})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Position *"}),Te.jsx("input",{type:"text",required:!0,value:o.position,onChange:e=>l({...o,position:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"HR Manager"})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Contract Type *"}),Te.jsxs("select",{required:!0,value:o.contractType,onChange:e=>l({...o,contractType:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",children:[Te.jsx("option",{value:"permanent",children:"Permanent"}),Te.jsx("option",{value:"contract",children:"Contract"}),Te.jsx("option",{value:"temporary",children:"Temporary"}),Te.jsx("option",{value:"intern",children:"Intern"})]})]}),!s&&Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Manager"}),Te.jsxs("select",{value:o.managerId,onChange:e=>l({...o,managerId:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",disabled:h,children:[Te.jsx("option",{value:"",children:"No Manager"}),g.map(e=>Te.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (","string"==typeof e.role?e.role:e.role?.name,")"]},e.id))]}),h&&Te.jsx("div",{className:"text-sm text-gray-500 mt-1",children:"Loading managers..."})]}),Te.jsxs("div",{className:"md:col-span-2",children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Probation End Date (Optional)"}),Te.jsx("input",{type:"date",value:o.probationEndDate,onChange:e=>l({...o,probationEndDate:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"Leave empty if no probation period"}),Te.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Typical probation periods are 3-6 months for new hires"})]})]})]}),!s&&Te.jsxs("div",{className:"bg-amber-50 rounded-lg p-4",children:[Te.jsxs("h3",{className:"font-semibold text-slate-800 mb-4 flex items-center gap-2",children:[Te.jsx(ie,{className:"w-5 h-5 text-amber-600"}),"Communication Preferences"]}),Te.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"WhatsApp Number"}),Te.jsx("input",{type:"tel",value:o.whatsappNumber,onChange:e=>l({...o,whatsappNumber:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:border-blue-500 focus:outline-none",placeholder:"+27 123 456 789"})]})})]})]}),Te.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-slate-200 flex-shrink-0",children:[Te.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),Te.jsx("button",{type:"submit",disabled:m,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-400 text-white rounded-lg font-medium transition-colors flex items-center gap-2",children:m?Te.jsxs(Te.Fragment,{children:[Te.jsx(M,{className:"w-4 h-4 animate-spin"}),"Saving..."]}):Te.jsxs(Te.Fragment,{children:[Te.jsx(ne,{className:"w-4 h-4"}),e?"Update Employee":"Add Employee"]})})]})]})]})})},ua=({onClose:e,onImportComplete:a})=>{const{organization:r}=it(),{csvData:s,importResult:i,isImporting:n,importProgress:o,currentImportStep:l,handleFileUpload:c,handleImport:d,resetImport:m}=(()=>{const[e,a]=t.useState(null),[r,s]=t.useState([]),[i,n]=t.useState(null),[o,l]=t.useState(!1),[c,d]=t.useState(0),[m,u]=t.useState(""),g=e=>{const t=[];let a="",r=!1;for(let s=0;s<e.length;s++){const i=e[s];'"'===i?r&&'"'===e[s+1]?(a+='"',s++):r=!r:","!==i||r?a+=i:(t.push(a),a="")}return t.push(a),t};return{csvFile:e,csvData:r,importResult:i,isImporting:o,importProgress:c,currentImportStep:m,handleFileUpload:e=>{a(e);const t=new FileReader;t.onload=e=>{const t=e.target?.result;try{const e=t.trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===e.length)return void s([]);const r=e[0].split(",").map(e=>e.trim().replace(/"/g,"")),i=[],n=[];for(let t=1;t<e.length;t++){const s=t+1,o=e[t];try{const e=g(o);if(e.length!==r.length){n.push(`Row ${s}: Field count mismatch`);continue}const t={};if(r.forEach((a,r)=>{t[a]=e[r]?.trim().replace(/"/g,"")||""}),!t.firstName||!t.lastName||!t.email){n.push(`Row ${s}: Missing required fields (firstName, lastName, email)`);continue}const a={employeeNumber:t.employeeNumber||"",firstName:t.firstName,lastName:t.lastName,email:t.email.toLowerCase(),phoneNumber:t.phoneNumber||"",whatsappNumber:t.whatsappNumber||"",position:t.position||"",startDate:t.startDate||"",contractType:t.contractType?.toLowerCase()||"permanent"};i.push(a)}catch(a){n.push(`Row ${s}: Parse error`)}}s(i),n.length>0&&Pe.warn("CSV Import Warnings:",n)}catch(r){Pe.error("CSV parsing failed:",r),s([])}},t.readAsText(e)},handleImport:async e=>{if(!r.length)return{success:!1,imported:0,failed:0,errors:[{row:1,field:"file",message:"No data to import"}]};l(!0),d(0),u("Validating employee data...");const t=[],a=[];try{for(let i=0;i<r.length;i++){const n=r[i],o=i+2,l=Math.round(i/r.length*30);d(l),u(`Validating employee ${i+1} of ${r.length}: ${n.firstName} ${n.lastName}...`);try{let r=n.employeeNumber;r&&""!==r.trim()||(r=await Ut.employees.generateNextEmployeeNumber(e));const s=await Ut.employees.validateEmployeeNumber(e,r);if(!s.isAvailable){t.push({row:o,field:"employeeNumber",message:`Employee number "${r}" is already in use${s.suggestions?`. Suggestions: ${s.suggestions.slice(0,3).join(", ")}`:""}`});continue}const i={employeeNumber:r,firstName:n.firstName,lastName:n.lastName,email:n.email,phoneNumber:n.phoneNumber||"",whatsappNumber:n.whatsappNumber||"",department:"",position:n.position,startDate:n.startDate,contractType:n.contractType||"permanent",isActive:!0},l=sa(i,e),{id:c,...d}=l;a.push(d)}catch(s){t.push({row:o,field:"validation",message:s instanceof Error?s.message:"Validation error"})}}let l=0,c=t.length;if(d(30),u("Validation complete. Starting employee creation..."),a.length>0)try{a.length;for(let e=0;e<a.length;e++){const r=30+Math.round(e/a.length*60);d(r);const s=a[e];u(`Creating employee ${e+1} of ${a.length}: ${s.profile?.firstName} ${s.profile?.lastName}...`);let n=0;const o=3;let m=!1;for(;!m&&n<o;)try{e>0&&await new Promise(e=>setTimeout(e,500)),await Ut.employees.create(a[e]),l++,m=!0,u(`‚úÖ Created: ${s.profile?.firstName} ${s.profile?.lastName}`),await new Promise(e=>setTimeout(e,200))}catch(i){n++;const a=i instanceof Error?i.message:"Unknown error";n<o&&a.includes("permissions")?(Pe.warn(`‚ö†Ô∏è Retry ${n}/${o} for employee ${e+1}: ${a}`),u(`‚ö†Ô∏è Retrying ${s.profile?.firstName} ${s.profile?.lastName} (${n}/${o})...`),await new Promise(e=>setTimeout(e,1e3*n))):(Pe.error(`‚ùå Failed to create employee ${e+1} after ${n} attempts:`,i),c++,t.push({row:e+2,field:"individual_create",message:`${a} (after ${n} retries)`}),m=!0)}}d(90),u("Finalizing import..."),await new Promise(e=>setTimeout(e,500)),Pe.success(10447)}catch(o){Pe.error("‚ùå Import process failed:",o),c+=a.length-l}const m={success:0===c,imported:l,failed:c,errors:t};return n(m),d(100),u("Import completed!"),m}finally{l(!1)}},resetImport:()=>{a(null),s([]),n(null),d(0),u("")}}})(),[u,g]=t.useState("upload");ea(!0);const p=()=>{m(),e()};return Te.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:ta.modal},children:Te.jsxs("div",{className:"bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-hidden shadow-xl",children:[Te.jsxs("div",{className:"bg-white border-b border-gray-200 p-3 flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx("div",{className:"w-8 h-8 bg-green-100 rounded flex items-center justify-center flex-shrink-0",children:Te.jsx("span",{className:"text-lg",children:"üìä"})}),Te.jsxs("div",{children:[Te.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Import Employees from CSV"}),Te.jsx("p",{className:"text-xs text-gray-600",children:"Bulk import multiple employees"})]})]}),!n&&Te.jsx("button",{onClick:p,className:"text-gray-400 hover:text-gray-600 transition-colors",children:Te.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Te.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),Te.jsxs("div",{className:"p-4",children:["upload"===u&&Te.jsxs("div",{className:"space-y-3",children:[Te.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[Te.jsxs("h3",{className:"text-xs font-semibold text-blue-900 mb-1.5 flex items-center gap-1",children:[Te.jsx("span",{children:"üìã"})," Import Instructions"]}),Te.jsxs("ol",{className:"list-decimal list-inside space-y-0.5 text-xs text-blue-800",children:[Te.jsx("li",{children:"Download the CSV template below"}),Te.jsx("li",{children:"Fill in employee information following the template format"}),Te.jsx("li",{children:"Save the file as CSV (comma-separated values)"}),Te.jsx("li",{children:"Upload the completed file using the form below"})]})]}),Te.jsx("div",{className:"text-center",children:Te.jsxs("button",{onClick:()=>{const e=[["employeeNumber","firstName","lastName","email","phoneNumber","whatsappNumber","position","startDate","contractType","probationEndDate"].join(","),...[["EMP001","John","Doe","john.doe@company.com","+27123456789","+27123456789","Software Developer","2024-01-15","permanent",""],["EMP002","Sarah","Johnson","sarah.johnson@company.com","+27987654321","+27987654321","HR Manager","2023-06-01","permanent",""],["EMP003","Michael","Smith","michael.smith@company.com","+27555123456","","Operations Coordinator","2024-11-01","contract","2025-02-01"]].map(e=>e.join(","))].join("\n"),t=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="employee_import_template.csv",r.click(),window.URL.revokeObjectURL(a)},className:"inline-flex items-center gap-1.5 px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors",children:[Te.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Te.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download CSV Template"]})}),Te.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[Te.jsx("input",{type:"file",accept:".csv",onChange:e=>{const t=e.target.files?.[0];t&&(c(t),g("preview"))},className:"hidden",id:"csv-upload"}),Te.jsxs("label",{htmlFor:"csv-upload",className:"cursor-pointer",children:[Te.jsx("div",{className:"text-4xl mb-2",children:"üìÅ"}),Te.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Click to upload CSV file"}),Te.jsx("p",{className:"text-xs text-gray-500",children:"or drag and drop your file here"})]})]}),Te.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[Te.jsx("h4",{className:"text-xs font-semibold text-gray-900 mb-2",children:"Sample CSV Format:"}),Te.jsxs("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800",children:[Te.jsx("strong",{children:"üí° Tip:"})," Leave employeeNumber empty to auto-generate next available number"]}),Te.jsx("pre",{className:"text-[10px] bg-white p-2 rounded border overflow-x-auto leading-relaxed",children:"employeeNumber,firstName,lastName,email,phoneNumber,whatsappNumber,department,position,startDate,contractType,preferredDeliveryMethod\nEMP001,John,Doe,john.doe@company.com,+27123456789,+27123456789,Engineering,Software Developer,2024-01-15,permanent,email\n,Jane,Smith,jane.smith@company.com,+27987654321,+27987654321,Human Resources,HR Manager,2023-06-01,permanent,whatsapp"}),Te.jsx("p",{className:"text-[10px] text-gray-600 mt-1.5",children:"Notice: Jane Smith has an empty employee number - the system will auto-generate one"})]})]}),"preview"===u&&s.length>0&&Te.jsxs("div",{className:"space-y-3",children:[Te.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-2.5",children:Te.jsxs("p",{className:"text-xs text-green-800",children:["‚úÖ Found ",Te.jsx("strong",{children:s.length})," employees ready to import"]})}),Te.jsx("div",{className:"overflow-x-auto border border-gray-200 rounded-lg",children:Te.jsxs("table",{className:"w-full text-xs",children:[Te.jsx("thead",{className:"bg-gray-50",children:Te.jsxs("tr",{children:[Te.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Employee #"}),Te.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Name"}),Te.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Email"}),Te.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Department"}),Te.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Position"}),Te.jsx("th",{className:"px-3 py-2 text-left font-medium text-gray-700",children:"Start Date"})]})}),Te.jsx("tbody",{className:"divide-y divide-gray-200",children:s.slice(0,10).map((e,t)=>Te.jsxs("tr",{className:"hover:bg-gray-50",children:[Te.jsx("td",{className:"px-3 py-2",children:e.employeeNumber}),Te.jsxs("td",{className:"px-3 py-2",children:[e.firstName," ",e.lastName]}),Te.jsx("td",{className:"px-3 py-2",children:e.email}),Te.jsx("td",{className:"px-3 py-2",children:e.department}),Te.jsx("td",{className:"px-3 py-2",children:e.position}),Te.jsx("td",{className:"px-3 py-2",children:e.startDate})]},t))})]})}),s.length>10&&Te.jsxs("p",{className:"text-center text-gray-500 text-xs",children:["... and ",s.length-10," more employees"]}),Te.jsxs("div",{className:"flex gap-2 justify-end",children:[Te.jsx("button",{onClick:()=>{g("upload"),m()},className:"px-3 py-1.5 text-xs border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Upload Different File"}),Te.jsxs("button",{onClick:async()=>{if(!r)return;g("importing");const t=await d(r.id);g("result"),t.success&&0===t.failed&&setTimeout(()=>{a(),e()},2e3)},className:"px-3 py-1.5 text-xs bg-green-600 text-white rounded-md hover:bg-green-700 font-medium",children:["Import ",s.length," Employees"]})]})]}),"importing"===u&&Te.jsxs("div",{className:"space-y-3 text-center",children:[Te.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[Te.jsx("div",{className:"text-4xl mb-3",children:"‚ö°"}),Te.jsx("h3",{className:"text-sm font-bold text-blue-900 mb-1",children:"Importing Employees"}),Te.jsx("p",{className:"text-xs text-blue-700 mb-3",children:"Please wait while we create your employees..."}),Te.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 mb-3",children:Te.jsx("div",{className:"bg-blue-600 h-3 rounded-full transition-all duration-300 ease-out",style:{width:`${o}%`}})}),Te.jsxs("div",{className:"space-y-1",children:[Te.jsxs("p",{className:"text-sm font-semibold text-blue-800",children:[o,"% Complete"]}),Te.jsx("p",{className:"text-xs text-blue-600 min-h-[1rem]",children:l})]})]}),Te.jsxs("div",{className:"text-[10px] text-gray-500 space-y-0.5",children:[Te.jsx("p",{children:"‚è±Ô∏è This may take a few moments depending on the number of employees"}),Te.jsx("p",{children:"üîÑ Please don't close this window during the import process"})]})]}),"result"===u&&i&&Te.jsxs("div",{className:"space-y-3",children:[Te.jsx("div",{className:"border rounded-lg p-4 "+(i.success&&0===i.failed?"bg-green-50 border-green-200":i.imported>0?"bg-yellow-50 border-yellow-200":"bg-red-50 border-red-200"),children:Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-4xl mb-2",children:i.success&&0===i.failed?"‚úÖ":i.imported>0?"‚ö†Ô∏è":"‚ùå"}),Te.jsx("h3",{className:"text-sm font-bold mb-2",children:i.success&&0===i.failed?"Import Successful!":i.imported>0?"Partial Import Complete":"Import Failed"}),Te.jsxs("div",{className:"space-y-0.5 text-xs",children:[Te.jsxs("p",{className:"text-green-700",children:["‚úÖ Successfully imported: ",Te.jsx("strong",{children:i.imported})," employees"]}),i.failed>0&&Te.jsxs("p",{className:"text-red-700",children:["‚ùå Failed to import: ",Te.jsx("strong",{children:i.failed})," employees"]})]})]})}),i.errors.length>0&&Te.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[Te.jsx("h4",{className:"text-xs font-semibold text-red-900 mb-1.5",children:"Import Errors:"}),Te.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:i.errors.map((e,t)=>Te.jsxs("div",{className:"text-xs text-red-700",children:[Te.jsxs("strong",{children:["Row ",e.row,":"]})," ",e.message]},t))})]}),Te.jsx("div",{className:"flex justify-center",children:Te.jsx("button",{onClick:p,className:"px-4 py-2 text-sm bg-gray-600 text-white rounded-md hover:bg-gray-700 font-medium",children:"Close"})})]})]})]})})},ga=({employee:e,onClose:a,onArchive:r})=>{const[s,i]=t.useState(""),[n,o]=t.useState(!1);usePreventBodyScroll(!0);const{containerRef:l,ariaProps:c}=useModalDialog({isOpen:!0,onClose:a,titleId:"archive-modal-title",descriptionId:"archive-modal-description"});return Te.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",style:{zIndex:Z_INDEX.modal},children:Te.jsx("div",{ref:l,...c,className:"bg-white rounded-2xl max-w-md w-full shadow-2xl",children:Te.jsxs("div",{className:"p-6",children:[Te.jsx("h2",{id:"archive-modal-title",className:"text-2xl font-bold text-amber-600 mb-4",children:"‚ö†Ô∏è Archive Employee"}),Te.jsxs("p",{id:"archive-modal-description",className:"text-gray-700 mb-4",children:["Are you sure you want to archive ",Te.jsxs("strong",{children:[e.profile.firstName," ",e.profile.lastName]}),"?"]}),Te.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-xs",children:Te.jsxs("p",{className:"text-blue-800",children:[Te.jsx("strong",{children:"Debug Info:"})," Employee ID: ",e.id||"MISSING ID!"]})}),Te.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[Te.jsxs("p",{className:"text-sm text-amber-800",children:[Te.jsx("strong",{children:"Note:"})," Archiving an employee will:"]}),Te.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-amber-800",children:[Te.jsx("li",{children:"‚Ä¢ Mark their record as inactive"}),Te.jsx("li",{children:"‚Ä¢ Preserve all historical data"}),Te.jsx("li",{children:"‚Ä¢ Remove them from active employee lists"}),Te.jsx("li",{children:"‚Ä¢ Maintain compliance with HR regulations"})]})]}),Te.jsxs("div",{className:"mb-6",children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for archiving (optional)"}),Te.jsx("textarea",{value:s,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-amber-500 focus:outline-none",rows:3,placeholder:"e.g., Resignation, End of contract, etc."})]}),Te.jsxs("div",{className:"flex gap-4",children:[Te.jsx("button",{onClick:async()=>{if(e?.id&&e.id.trim().length,!e||!e.id||0===e.id.trim().length)return Pe.error("üö® CRITICAL ERROR: Invalid employee or missing employee ID"),void alert("Error: Invalid employee data. Cannot archive.");o(!0);try{await r(e,s.trim()||void 0),Pe.success(1682),a()}catch(t){Pe.error("‚ùå Archive operation failed:",t),alert(`Failed to archive employee: ${t instanceof Error?t.message:"Unknown error"}`)}finally{o(!1)}},disabled:n||!e?.id,className:"flex-1 py-3 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Archiving...":"Yes, Archive"}),Te.jsx("button",{onClick:a,disabled:n,className:"flex-1 py-3 bg-gray-200 text-gray-700 rounded-xl font-semibold hover:bg-gray-300 disabled:opacity-50",children:"Cancel"})]})]})})})},pa=({isOpen:e,onClose:a,employees:r,onAssign:s})=>{const{organization:i}=ht(),[n,o]=t.useState([]),[l,c]=t.useState(""),[d,m]=t.useState(!1),[u,g]=t.useState(!1),[p,h]=t.useState(null);t.useEffect(()=>{(async()=>{if(i?.id&&e){m(!0),h(null);try{const e=(await Ye.queryDocuments(i.id,"users")).documents.filter(e=>"hr-manager"===e.role?.id||"hod-manager"===e.role?.id).map(e=>({id:e.id,firstName:e.firstName||e.profile?.firstName||"Unknown",lastName:e.lastName||e.profile?.lastName||"User",role:e.role,departmentIds:e.departmentIds}));o(e),e.length}catch(t){Pe.error("Failed to load managers:",t),h("Failed to load managers. Please try again.")}finally{m(!1)}}})()},[i?.id,e]);const x=n.find(e=>e.id===l);return Te.jsx(yt,{isOpen:e,onClose:a,title:"Assign Employees to Manager",size:"md",children:Te.jsxs("div",{className:"p-6",children:[Te.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-bg)"},children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(oe,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),Te.jsxs("div",{children:[Te.jsxs("p",{className:"font-medium",style:{color:"var(--color-text)"},children:[r.length," employee",1!==r.length?"s":""," selected"]}),Te.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.map(e=>`${e.profile.firstName} ${e.profile.lastName}`).join(", ")})]})]})}),Te.jsxs("div",{className:"mb-6",children:[Te.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Manager"}),d?Te.jsx("div",{className:"flex items-center justify-center py-8",children:Te.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"var(--color-primary)"}})}):0===n.length?Te.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-warning-bg)"},children:Te.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-warning-text)"},children:"No managers found in your organization."})}):Te.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",color:"var(--color-text)"},children:[Te.jsx("option",{value:"",children:"-- Select a manager --"}),n.map(e=>Te.jsxs("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.role.name,")"]},e.id))]})]}),x&&Te.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)"},children:Te.jsxs("div",{className:"flex items-start gap-3",children:[Te.jsx(le,{className:"w-5 h-5 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),Te.jsxs("div",{children:[Te.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--color-alert-info-text)"},children:"Confirm Assignment"}),Te.jsxs("p",{className:"text-sm",style:{color:"var(--color-alert-info-text)"},children:[r.length," employee",1!==r.length?"s":""," will be assigned to"," ",Te.jsxs("strong",{children:[x.firstName," ",x.lastName]}),"."]})]})]})}),p&&Te.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)"},children:Te.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)"},children:p})}),Te.jsxs("div",{className:"flex gap-3",children:[Te.jsx("button",{onClick:a,disabled:u,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Cancel"}),Te.jsx("button",{onClick:async()=>{if(l){g(!0),h(null);try{await s(l),a()}catch(e){Pe.error("Failed to assign manager:",e),h(e.message||"Failed to assign manager. Please try again.")}finally{g(!1)}}else h("Please select a manager")},disabled:!l||u||d,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(to right, var(--color-primary), var(--color-primary-hover))",color:"var(--color-text-inverse)"},children:u?"Assigning...":"Assign Manager"})]})]})})},ha=({isOpen:e,onClose:a,employees:r,onAssign:s})=>{const{organization:i}=ht(),[n,o]=t.useState([]),[l,c]=t.useState(""),[d,m]=t.useState(!1),[u,g]=t.useState(!1),[p,h]=t.useState(null);t.useEffect(()=>{(async()=>{if(i?.id&&e){m(!0),h(null);try{const e=await Bt.getDepartments(i.id);o(e),e.length}catch(t){Pe.error("Failed to load departments:",t),h("Failed to load departments. Please try again.")}finally{m(!1)}}})()},[i?.id,e]);const x=n.find(e=>e.name===l);return Te.jsx(yt,{isOpen:e,onClose:a,title:"Assign Employees to Department",size:"md",children:Te.jsxs("div",{className:"p-6",children:[Te.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-primary-bg)"},children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(ce,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),Te.jsxs("div",{children:[Te.jsxs("p",{className:"font-medium",style:{color:"var(--color-text)"},children:[r.length," employee",1!==r.length?"s":""," selected"]}),Te.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.map(e=>`${e.profile.firstName} ${e.profile.lastName}`).join(", ")})]})]})}),Te.jsxs("div",{className:"mb-6",children:[Te.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text)"},children:"Select Department"}),d?Te.jsx("div",{className:"flex items-center justify-center py-8",children:Te.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2",style:{borderColor:"var(--color-primary)"}})}):0===n.length?Te.jsx("div",{className:"p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-warning-bg)"},children:Te.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-warning-text)"},children:"No departments found in your organization. Please create departments first."})}):Te.jsxs("select",{value:l,onChange:e=>c(e.target.value),className:"w-full px-3 py-2 rounded-lg border transition-colors",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",color:"var(--color-text)"},children:[Te.jsx("option",{value:"",children:"-- Select a department --"}),n.map(e=>Te.jsx("option",{value:e.name,children:e.name},e.id))]})]}),x&&Te.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-info-bg)"},children:Te.jsxs("div",{className:"flex items-start gap-3",children:[Te.jsx(le,{className:"w-5 h-5 mt-0.5",style:{color:"var(--color-alert-info-text)"}}),Te.jsxs("div",{children:[Te.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--color-alert-info-text)"},children:"Confirm Assignment"}),Te.jsxs("p",{className:"text-sm",style:{color:"var(--color-alert-info-text)"},children:[r.length," employee",1!==r.length?"s":""," will be assigned to"," ",Te.jsx("strong",{children:x.name})," department."]})]})]})}),p&&Te.jsx("div",{className:"mb-6 p-4 rounded-lg",style:{backgroundColor:"var(--color-alert-error-bg)"},children:Te.jsx("p",{className:"text-sm",style:{color:"var(--color-alert-error-text)"},children:p})}),Te.jsxs("div",{className:"flex gap-3",children:[Te.jsx("button",{onClick:a,disabled:u,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{backgroundColor:"var(--color-card-background)",color:"var(--color-text-secondary)",border:"1px solid var(--color-border)"},children:"Cancel"}),Te.jsx("button",{onClick:async()=>{if(l){g(!0),h(null);try{await s(l),a()}catch(e){Pe.error("Failed to assign department:",e),h(e.message||"Failed to assign department. Please try again.")}finally{g(!1)}}else h("Please select a department")},disabled:!l||u||d,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(to right, var(--color-primary), var(--color-primary-hover))",color:"var(--color-text-inverse)"},children:u?"Assigning...":"Assign Department"})]})]})})},xa={"business-owner":{level:0,icon:de,color:"from-purple-500 to-purple-600"},"hr-manager":{level:1,icon:ae,color:"from-blue-500 to-blue-600"},"hod-manager":{level:2,icon:oe,color:"from-emerald-500 to-emerald-600"},employee:{level:3,icon:re,color:"from-gray-500 to-gray-600"}},ya=({employees:e,onEmployeeClick:a,selectedEmployee:r})=>{const{user:s}=it(),[i,n]=t.useState(new Set),[o,l]=t.useState("tree"),c=t.useMemo(()=>{if(!e.length)return[];const t=new Map;e.forEach(e=>t.set(e.id,e));const a=[],r=new Set,s=(a,i=0)=>{if(r.has(a))return null;const n=t.get(a);if(!n)return null;r.add(a);const o=[];return e.filter(e=>e.employment.managerId===a).forEach(e=>{const t=s(e.id,i+1);t&&o.push(t)}),{employee:n,children:o,level:i}};return e.filter(e=>!e.employment.managerId||!t.has(e.employment.managerId)).forEach(e=>{const t=s(e.id);t&&a.push(t)}),a},[e]),d=t.useMemo(()=>{if(!s)return c;if(["hr-manager","business-owner"].includes(s.role?.id))return c;if("hod-manager"===s.role?.id){const t=e=>{for(const a of e){if(a.employee.id===s.id)return[a];const e=t(a.children);if(e.length>0)return e}return[]},a=t(c);if(a.length>0)return a;const r=e.filter(e=>e.employment.managerId===s.id);if(r.length>0){const t=e.find(e=>e.id===s.id)||{id:s.id,profile:{firstName:s.firstName||s.displayName?.split(" ")[0]||"Manager",lastName:s.lastName||s.displayName?.split(" ")[1]||"",email:s.email||"",employeeNumber:"MGR-"+s.id.slice(-6),department:s.department||"Management",position:"Manager"},employment:{department:s.department||"Management",position:"Manager",managerId:null}},a=[];return r.forEach(t=>{const r={employee:t,children:e.filter(e=>e.employment.managerId===t.id).map(e=>({employee:e,children:[],level:2})),level:1};a.push(r)}),[{employee:t,children:a,level:0}]}return[]}return c},[c,s]),m=t.useMemo(()=>{const t=new Map;return e.forEach(e=>{const a=e.profile.department||"Unassigned";t.has(a)||t.set(a,[]),t.get(a).push(e)}),Array.from(t.entries()).sort(([e],[t])=>e.localeCompare(t))},[e]),u=t.useCallback(e=>{n(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),g=t.useCallback(e=>{a?.(e)},[a]),p=({employee:e,level:t,hasChildren:a,isExpanded:r,isSelected:s,childCount:i=0})=>{const n=e.employment.position||"Employee",o=xa[n]?.icon||re,l=xa[n]?.color||"from-gray-500 to-gray-600";return Te.jsx("div",{className:`\n          relative bg-white rounded-lg shadow-md border-2 transition-all duration-200 cursor-pointer\n          ${s?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}\n          ${0===t?"w-56":"w-48"}\n        `,onClick:()=>g(e),children:Te.jsxs("div",{className:"p-3",children:[Te.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Te.jsx("div",{className:`\n              w-10 h-10 rounded-full bg-gradient-to-br ${l} \n              flex items-center justify-center shadow-md\n            `,children:Te.jsx(o,{className:"w-5 h-5 text-white"})}),Te.jsxs("div",{className:"flex-1 min-w-0",children:[Te.jsxs("div",{className:"flex items-center gap-1",children:[Te.jsxs("h3",{className:"font-medium text-sm text-gray-900 truncate",children:[e.profile.firstName," ",e.profile.lastName]}),0===t&&Te.jsx(de,{className:"w-3 h-3 text-yellow-500 flex-shrink-0"})]}),Te.jsx("p",{className:"text-xs text-gray-600 truncate",children:n})]})]}),Te.jsx("div",{className:"text-xs text-gray-500 mb-2",children:Te.jsxs("div",{className:"flex items-center gap-1",children:[Te.jsx(se,{className:"w-3 h-3 flex-shrink-0"}),Te.jsx("span",{className:"truncate",children:e.profile.department})]})}),a&&Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsx("div",{className:"bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded text-xs font-medium",children:i}),Te.jsx("button",{onClick:t=>{t.stopPropagation(),u(e.id)},className:"p-0.5 hover:bg-gray-100 rounded transition-colors",children:r?Te.jsx(ee,{className:"w-3 h-3 text-gray-600"}):Te.jsx(me,{className:"w-3 h-3 text-gray-600"})})]})]})})},h=(t,a=!0)=>0===t.length?null:Te.jsx("div",{className:"flex flex-col items-center space-y-6 "+(a?"w-full":""),children:t.map((t,a)=>{const s=t.children.length>0,n=i.has(t.employee.id),o=r?.id===t.employee.id,l=e.filter(e=>e.employment.managerId===t.employee.id).length;return Te.jsxs("div",{className:"flex flex-col items-center relative",children:[Te.jsx("div",{className:"relative z-10",children:Te.jsx(p,{employee:t.employee,level:t.level,hasChildren:s,isExpanded:n,isSelected:o,childCount:l})}),s&&n&&Te.jsxs("div",{className:"relative mt-4",children:[Te.jsx("div",{className:"absolute top-0 left-1/2 w-0.5 h-4 bg-blue-300 transform -translate-x-0.5"}),Te.jsx("div",{className:"pt-4 space-y-4",children:t.children.map((e,t)=>Te.jsxs("div",{className:"relative flex items-center",children:[Te.jsxs("div",{className:"flex items-center",children:[Te.jsx("div",{className:"w-0.5 h-8 bg-blue-300"}),Te.jsx("div",{className:"w-8 h-0.5 bg-blue-300"})]}),Te.jsx("div",{className:"ml-2",children:h([e],!1)})]},e.employee.id))}),t.children.length>1&&Te.jsx("div",{className:"absolute left-1/2 w-0.5 bg-blue-300 transform -translate-x-0.5",style:{top:"16px",height:112*(t.children.length-1)+32+"px"}})]})]},t.employee.id)})});return e.length?Te.jsxs("div",{className:"space-y-6",children:[Te.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:Te.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[Te.jsxs("div",{children:[Te.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-3",children:[Te.jsx(oe,{className:"w-8 h-8 text-blue-600"}),"Team Structure"]}),Te.jsx("p",{className:"text-gray-600 mt-1",children:"hr-manager"===s?.role?.id?"Complete organizational hierarchy":"hod-manager"===s?.role?.id?"Your team and direct reports":"Team overview"})]}),Te.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[Te.jsx("button",{onClick:()=>l("tree"),className:`\n                px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                ${"tree"===o?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}\n              `,children:"Hierarchy"}),Te.jsx("button",{onClick:()=>l("departments"),className:`\n                px-4 py-2 rounded-md text-sm font-medium transition-all duration-200\n                ${"departments"===o?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}\n              `,children:"Departments"})]})]})}),Te.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-6",children:"tree"===o?Te.jsx("div",{className:"max-h-96 overflow-y-auto overflow-x-auto p-4",children:d.length>0?Te.jsx("div",{className:"min-w-max pb-8",children:h(d)}):Te.jsxs("div",{className:"text-center py-12",children:[Te.jsx(oe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),Te.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"hod-manager"===s?.role?.id?"No Team Members Found":"No Organizational Structure"}),Te.jsx("p",{className:"text-gray-600 max-w-md mx-auto",children:"hod-manager"===s?.role?.id?"You currently have no direct reports assigned to you. Contact HR to add team members.":"There are no employees to display in the organizational hierarchy."}),"hod-manager"===s?.role?.id&&Te.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[Te.jsxs("p",{children:[Te.jsx("strong",{children:"User ID:"})," ",s.id]}),Te.jsxs("p",{children:[Te.jsx("strong",{children:"Role:"})," ",s.role?.id]}),Te.jsxs("p",{children:[Te.jsx("strong",{children:"Total Employees:"})," ",e.length]}),Te.jsxs("p",{children:[Te.jsx("strong",{children:"Direct Reports:"})," ",e.filter(e=>e.employment.managerId===s.id).length]})]})]})}):Te.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:m.map(([e,t])=>Te.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[Te.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:[Te.jsxs("h3",{className:"text-white font-bold flex items-center gap-2",children:[Te.jsx(se,{className:"w-5 h-5"}),e]}),Te.jsxs("p",{className:"text-blue-100 text-sm",children:[t.length," employees"]})]}),Te.jsx("div",{className:"p-4 space-y-3",children:t.map(e=>Te.jsx("div",{onClick:()=>g(e),className:`\n                  p-3 rounded-lg cursor-pointer transition-all duration-200\n                  hover:bg-blue-50 hover:border-blue-200 border border-transparent\n                  ${r?.id===e.id?"bg-blue-50 border-blue-500":""}\n                `,children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(re,{className:"w-8 h-8 text-gray-600"}),Te.jsxs("div",{children:[Te.jsxs("p",{className:"font-medium text-gray-900",children:[e.profile.firstName," ",e.profile.lastName]}),Te.jsx("p",{className:"text-sm text-gray-600",children:e.employment.position})]})]})},e.id))})]},e))})})]}):Te.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 text-center",children:[Te.jsx(oe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),Te.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),Te.jsx("p",{className:"text-gray-600",children:"Start by adding employees to your organization."})]})},fa=({employees:e,onEmployeeSelect:r,onEmployeeEdit:s,onEmployeeDelete:i,onEmployeePromote:n,onBulkAction:o,selectedEmployee:l,loading:c=!1})=>{const{user:d}=it(),{organization:m}=ht(),[u,g]=t.useState([]);t.useEffect(()=>{(async()=>{if(m?.id)try{const e=await Ye.queryDocuments(m.id,"users");g(e.documents),e.documents.length}catch(e){Pe.error("Failed to load users for manager lookup:",e)}})()},[m?.id]);const p=t.useCallback(t=>{if(!t)return"HR Manager";const a=e.find(e=>e.id===t);if(a)return`${a.profile.firstName} ${a.profile.lastName}`;const r=u.find(e=>e.id===t);if(r){const e=r.firstName||r.profile?.firstName,t=r.lastName||r.profile?.lastName,a=r.role?.name||r.role?.id;if(e&&t)return a?`${e} ${t} (${a})`:`${e} ${t}`}return"HR Manager"},[e,u]),[h,x]=t.useState("name"),[y,f]=t.useState("asc"),[v,b]=t.useState(""),[w,N]=t.useState(""),[j,D]=t.useState(""),[A,E]=t.useState(new Set),[C,S]=t.useState(!1),[I,k]=t.useState(1),[z,R]=t.useState(25),$=t.useMemo(()=>{const t=new Set(e.map(e=>e.profile.department).filter(Boolean));return Array.from(t).sort()},[e]),O=t.useMemo(()=>{let t=e.filter(e=>{const t=[e.profile.firstName,e.profile.lastName,e.profile.employeeNumber,e.profile.department,e.employment.position,e.profile.email].join(" ").toLowerCase(),a=!v||t.includes(v.toLowerCase()),r=!w||e.profile.department===w,s=!j||("active"===j?e.isActive:!e.isActive);return a&&r&&s});return t.sort((e,t)=>{let a,r;switch(h){case"name":a=`${e.profile.firstName} ${e.profile.lastName}`,r=`${t.profile.firstName} ${t.profile.lastName}`;break;case"department":a=e.profile.department||"",r=t.profile.department||"";break;case"position":a=e.employment.position||"",r=t.employment.position||"";break;case"manager":a=p(e.employment.managerId),r=p(t.employment.managerId);break;case"startDate":const s=e=>{const t=e.employment?.startDate||e.profile?.startDate;if(!t)return 0;try{if(t&&"function"==typeof t.toDate)return t.toDate().getTime();if(t instanceof Date)return t.getTime();const e=new Date(t);return isNaN(e.getTime())?0:e.getTime()}catch(a){return 0}};a=s(e),r=s(t);break;case"status":a=e.isActive?"Active":"Inactive",r=t.isActive?"Active":"Inactive";break;default:return 0}return a<r?"asc"===y?-1:1:a>r?"asc"===y?1:-1:0}),t},[e,v,w,j,h,y]),T=t.useMemo(()=>{const e=(I-1)*z;return O.slice(e,e+z)},[O,I,z]),P=Math.ceil(O.length/z),_=t.useCallback(e=>{e===h?f("asc"===y?"desc":"asc"):(x(e),f("asc"))},[h,y]),L=t.useCallback(e=>{E(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},[]),F=t.useCallback(()=>{A.size===T.length?E(new Set):E(new Set(T.map(e=>e.id)))},[A.size,T]),M=t.useCallback(t=>{const a=e.filter(e=>A.has(e.id));o?.(t,a),E(new Set)},[e,A,o]),W=t.useCallback(()=>{const e=[["Name","Employee ID","Department","Position","Manager","Email","Phone","Start Date","Status"],...O.map(e=>[`${e.profile.firstName} ${e.profile.lastName}`,e.profile.employeeNumber,e.profile.department,e.employment.position,p(e.employment.managerId),e.profile.email||"",e.profile.phoneNumber||"",(()=>{const t=e.employment?.startDate||e.profile?.startDate;if(!t)return"Not set";try{if(t&&"function"==typeof t.toDate)return t.toDate().toLocaleDateString();if(t instanceof Date)return t.toLocaleDateString();const e=new Date(t);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString()}catch(a){return"Invalid date"}})(),e.isActive?"Active":"Inactive"])].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),r=URL.createObjectURL(t);a.setAttribute("href",r),a.setAttribute("download",`employees-${(new Date).toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)},[O]);return c?Te.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-8",children:Te.jsxs("div",{className:"animate-pulse space-y-4",children:[Te.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),Te.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,t)=>Te.jsx("div",{className:"h-12 bg-gray-200 rounded"},t))})]})}):Te.jsxs("div",{className:"space-y-4",children:[Te.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-6",children:[Te.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[Te.jsxs("div",{children:[Te.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[Te.jsx(ue,{className:"w-6 h-6 text-blue-600"}),"Employee Directory"]}),Te.jsxs("p",{className:"text-gray-600 text-sm",children:[O.length," of ",e.length," employees"]})]}),Te.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[Te.jsxs("div",{className:"relative",children:[Te.jsx(ge,{className:"w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),Te.jsx("input",{type:"text",placeholder:"Search employees...",value:v,onChange:e=>b(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full sm:w-64"})]}),Te.jsxs("button",{onClick:()=>S(!C),className:`\n                flex items-center gap-2 px-4 py-2 border rounded-lg transition-colors\n                ${C?"bg-blue-50 border-blue-300 text-blue-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}\n              `,children:[Te.jsx(pe,{className:"w-4 h-4"}),"Filters"]}),Te.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[Te.jsx(he,{className:"w-4 h-4"}),"Export"]})]})]}),C&&Te.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),Te.jsxs("select",{value:w,onChange:e=>N(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[Te.jsx("option",{value:"",children:"All Departments"}),$.map(e=>Te.jsx("option",{value:e,children:e},e))]})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),Te.jsxs("select",{value:j,onChange:e=>D(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[Te.jsx("option",{value:"",children:"All Status"}),Te.jsx("option",{value:"active",children:"Active"}),Te.jsx("option",{value:"inactive",children:"Inactive"})]})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Page Size"}),Te.jsxs("select",{value:z,onChange:e=>R(Number(e.target.value)),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500",children:[Te.jsx("option",{value:"10",children:"10 per page"}),Te.jsx("option",{value:"25",children:"25 per page"}),Te.jsx("option",{value:"50",children:"50 per page"}),Te.jsx("option",{value:"100",children:"100 per page"})]})]})]})}),A.size>0&&Te.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:Te.jsxs("div",{className:"flex items-center gap-4",children:[Te.jsxs("span",{className:"text-sm text-gray-600",children:[A.size," employee",1!==A.size?"s":""," selected"]}),Te.jsxs("div",{className:"flex gap-2",children:["hr-manager"===d?.role?.id&&Te.jsxs(Te.Fragment,{children:[Te.jsxs("button",{onClick:()=>M("assign-manager"),className:"flex items-center gap-1 px-3 py-1 bg-purple-600 text-white rounded text-sm hover:bg-purple-700",children:[Te.jsx(oe,{className:"w-3 h-3"}),"Assign to Manager"]}),Te.jsxs("button",{onClick:()=>M("assign-department"),className:"flex items-center gap-1 px-3 py-1 bg-emerald-600 text-white rounded text-sm hover:bg-emerald-700",children:[Te.jsx(se,{className:"w-3 h-3"}),"Assign to Department"]})]}),Te.jsx("button",{onClick:()=>M("export"),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Export Selected"}),Te.jsx("button",{onClick:()=>M("email"),className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700",children:"Send Email"})]})]})})]}),Te.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[Te.jsx("div",{className:"overflow-x-auto",children:Te.jsxs("table",{className:"w-full",children:[Te.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:Te.jsx("tr",{children:[{key:"select",label:"",sortable:!1,width:"48px",align:"center"},{key:"name",label:"Employee",sortable:!0,width:"200px"},{key:"employeeNumber",label:"ID",sortable:!0,width:"100px"},{key:"department",label:"Department",sortable:!0,width:"130px"},{key:"position",label:"Position",sortable:!0,width:"130px"},{key:"manager",label:"Manager",sortable:!0,width:"120px"},{key:"contact",label:"Contact",sortable:!1,width:"80px",align:"center"},{key:"startDate",label:"Start Date",sortable:!0,width:"100px"},{key:"status",label:"Status",sortable:!0,width:"100px"},{key:"actions",label:"Actions",sortable:!1,width:"80px",align:"center"}].map(e=>{return Te.jsx("th",{className:`\n                      px-4 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider\n                      ${"center"===e.align?"text-center":""}\n                      ${"right"===e.align?"text-right":""}\n                      ${e.sortable?"cursor-pointer hover:bg-gray-100":""}\n                    `,style:{width:e.width},onClick:()=>e.sortable&&_(e.key),children:Te.jsx("div",{className:"flex items-center gap-1",children:"select"===e.key?Te.jsx("button",{onClick:F,children:A.size===T.length?Te.jsx(xe,{className:"w-4 h-4 text-blue-600"}):Te.jsx(ye,{className:"w-4 h-4 text-gray-400"})}):Te.jsxs(Te.Fragment,{children:[e.label,e.sortable&&(t=e.key,h!==t?null:"asc"===y?Te.jsx(X,{className:"w-4 h-4"}):Te.jsx(ee,{className:"w-4 h-4"}))]})})},e.key);var t})})}),Te.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(e=>Te.jsxs(a.Fragment,{children:[Te.jsxs("tr",{className:`\n                      hover:bg-gray-50 transition-colors cursor-pointer\n                      ${l?.id===e.id?"bg-blue-50":""}\n                      ${A.has(e.id)?"bg-blue-25":""}\n                    `,onClick:()=>r?.(e),children:[Te.jsx("td",{className:"px-4 py-3 text-center",children:Te.jsx("button",{onClick:t=>{t.stopPropagation(),L(e.id)},children:A.has(e.id)?Te.jsx(xe,{className:"w-4 h-4 text-blue-600"}):Te.jsx(ye,{className:"w-4 h-4 text-gray-400"})})}),Te.jsx("td",{className:"px-4 py-3",children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:Te.jsx(re,{className:"w-4 h-4 text-blue-600"})}),Te.jsxs("div",{children:[Te.jsxs("div",{className:"font-medium text-gray-900",children:[e.profile.firstName," ",e.profile.lastName]}),Te.jsx("div",{className:"text-sm text-gray-500",children:e.profile.employeeNumber})]})]})}),Te.jsx("td",{className:"px-4 py-3 text-sm font-mono text-gray-900",children:e.profile.employeeNumber}),Te.jsx("td",{className:"px-4 py-3",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(se,{className:"w-4 h-4 text-gray-400"}),Te.jsx("span",{className:"text-sm text-gray-900",children:e.profile.department})]})}),Te.jsx("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.employment.position}),Te.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:p(e.employment.managerId)}),Te.jsx("td",{className:"px-4 py-3",children:Te.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.profile.email&&Te.jsx(fe,{className:"w-4 h-4 text-green-600",title:`Email: ${e.profile.email}`}),e.profile.phoneNumber&&Te.jsx(ve,{className:"w-4 h-4 text-blue-600",title:`Phone: ${e.profile.phoneNumber}`}),!e.profile.email&&!e.profile.phoneNumber&&Te.jsx("span",{className:"text-sm text-gray-400",children:"‚Äî"})]})}),Te.jsx("td",{className:"px-4 py-3",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(be,{className:"w-4 h-4 text-gray-400"}),Te.jsx("span",{className:"text-sm text-gray-900",children:(()=>{const t=e.employment?.startDate||e.profile?.startDate;if(!t)return"Not set";try{if(t&&"function"==typeof t.toDate)return t.toDate().toLocaleDateString();if(t instanceof Date)return t.toLocaleDateString();const e=new Date(t);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString()}catch(a){return"Invalid date"}})()})]})}),Te.jsx("td",{className:"px-4 py-3",children:Te.jsx("span",{className:`\n                        inline-flex px-2 py-1 text-xs font-medium rounded-full\n                        ${e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}\n                      `,children:e.isActive?"Active":"Inactive"})}),Te.jsx("td",{className:"px-4 py-3 text-center",children:Te.jsx("div",{className:"flex items-center justify-center gap-1",children:Te.jsx("button",{onClick:t=>{t.stopPropagation(),r?.(e)},className:"p-1 text-gray-400 hover:text-green-600 transition-colors",children:Te.jsx(J,{className:"w-4 h-4"})})})})]}),l?.id===e.id&&Te.jsx("tr",{className:"bg-blue-50/50",children:Te.jsx("td",{colSpan:10,className:"px-4 py-4",children:Te.jsxs("div",{className:"bg-white rounded-lg border border-blue-200 shadow-sm p-4",children:[Te.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Te.jsxs("h4",{className:"text-base font-semibold text-gray-900 flex items-center gap-2",children:[Te.jsx(J,{className:"w-5 h-5 text-blue-600"}),"Employee Details"]}),Te.jsx("button",{onClick:e=>{e.stopPropagation(),r?.(null)},className:"text-gray-400 hover:text-gray-600 transition-colors",children:"‚úï"})]}),Te.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Te.jsxs("div",{children:[Te.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Personal Information"}),Te.jsxs("div",{className:"space-y-2 text-sm",children:[Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Name:"})," ",e.profile.firstName," ",e.profile.lastName]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"ID:"})," ",e.profile.employeeNumber]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Email:"})," ",e.profile.email]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Phone:"})," ",e.profile.phoneNumber||"Not provided"]})]})]}),Te.jsxs("div",{children:[Te.jsx("h5",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Employment Details"}),Te.jsxs("div",{className:"space-y-2 text-sm",children:[Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Department:"})," ",e.profile.department]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Position:"})," ",e.employment.position]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Manager:"})," ",p(e.employment.managerId)]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Start Date:"})," ",(()=>{const t=e.employment?.startDate||e.profile?.startDate;if(!t)return"Not set";try{if(t&&"function"==typeof t.toDate)return t.toDate().toLocaleDateString();if(t instanceof Date)return t.toLocaleDateString();const e=new Date(t);return isNaN(e.getTime())?"Invalid date":e.toLocaleDateString()}catch(a){return"Invalid date"}})()]}),Te.jsxs("p",{children:[Te.jsx("span",{className:"font-medium",children:"Status:"}),Te.jsx("span",{className:"ml-2 px-2 py-1 rounded text-xs "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})]})]})]})]}),Te.jsxs("div",{className:"flex gap-3 mt-4 pt-4 border-t border-gray-200",children:[Te.jsx("button",{onClick:t=>{t.stopPropagation(),s?.(e)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm",children:"Edit Employee"}),Te.jsx("button",{onClick:t=>{t.stopPropagation(),i?.(e)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Archive Employee"})]})]})})})]},e.id))})]})}),P>1&&Te.jsx("div",{className:"bg-gray-50 px-4 py-3 border-t border-gray-200",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(I-1)*z+1," to ",Math.min(I*z,O.length)," of ",O.length," results"]}),Te.jsxs("div",{className:"flex gap-2",children:[Te.jsx("button",{onClick:()=>k(Math.max(1,I-1)),disabled:1===I,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Previous"}),Array.from({length:Math.min(5,P)},(e,t)=>{const a=Math.max(1,I-2)+t;return a>P?null:Te.jsx("button",{onClick:()=>k(a),className:`\n                        px-3 py-1 border rounded text-sm transition-colors\n                        ${a===I?"bg-blue-600 border-blue-600 text-white":"border-gray-300 hover:bg-gray-50"}\n                      `,children:a},a)}),Te.jsx("button",{onClick:()=>k(Math.min(P,I+1)),disabled:I===P,className:"px-3 py-1 border border-gray-300 rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:"Next"})]})]})})]}),0===O.length&&Te.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-12 text-center",children:[Te.jsx(re,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),Te.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Employees Found"}),Te.jsx("p",{className:"text-gray-600 mb-4",children:v||w||j?"Try adjusting your search or filter criteria.":"Start by adding employees to your organization."}),(v||w||j)&&Te.jsx("button",{onClick:()=>{b(""),N(""),D("")},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Clear Filters"})]})]})},va=({width:e="100%",height:t="1rem",className:a=""})=>Te.jsx("div",{className:`bg-gray-200 rounded animate-pulse legacy-simple-layout ${a}`,style:{width:e,height:t}}),ba=({rows:e=5})=>Te.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg legacy-simple-layout",children:[Te.jsx("div",{className:"p-4 border-b border-gray-200",children:Te.jsxs("div",{className:"flex gap-4",children:[Te.jsx(va,{width:"150px",height:"16px"}),Te.jsx(va,{width:"120px",height:"16px"}),Te.jsx(va,{width:"100px",height:"16px"}),Te.jsx(va,{width:"80px",height:"16px"})]})}),Array.from({length:e}).map((e,t)=>Te.jsx("div",{className:"p-4 border-b border-gray-100 last:border-b-0",children:Te.jsxs("div",{className:"flex gap-4 items-center",children:[Te.jsx(va,{width:"150px",height:"14px"}),Te.jsx(va,{width:"120px",height:"14px"}),Te.jsx(va,{width:"100px",height:"14px"}),Te.jsx(va,{width:"80px",height:"14px"})]})},t))]}),wa=()=>Te.jsx("div",{className:"grid grid-cols-1 gap-4 legacy-simple-layout",children:Array.from({length:4}).map((e,t)=>Te.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[Te.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Te.jsx(va,{width:"60px",height:"14px"}),Te.jsx(va,{width:"24px",height:"24px",className:"rounded"})]}),Te.jsx(va,{width:"40px",height:"24px",className:"mb-1"}),Te.jsx(va,{width:"80px",height:"12px"})]},t))}),Na=()=>Te.jsxs("div",{className:"space-y-4 legacy-simple-layout",children:[Te.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(va,{width:"32px",height:"32px",className:"rounded"}),Te.jsxs("div",{children:[Te.jsx(va,{width:"120px",height:"18px",className:"mb-1"}),Te.jsx(va,{width:"80px",height:"14px"})]})]}),Te.jsxs("div",{className:"flex gap-2",children:[Te.jsx(va,{width:"80px",height:"36px",className:"rounded"}),Te.jsx(va,{width:"80px",height:"36px",className:"rounded"})]})]})}),Te.jsx(wa,{}),Te.jsx(ba,{rows:3})]}),ja=({message:e="Loading..."})=>Te.jsxs("div",{className:"text-center py-8 legacy-simple-layout",children:[Te.jsx("div",{className:"inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-3"}),Te.jsx("p",{className:"text-gray-600 legacy-text-size",children:e}),Te.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"This may take a moment on slower connections"})]}),Da=()=>{const{user:e,organization:a}=it(),r="hod-manager"===e?.role?.id,s=a?.id,{employees:i,loading:n,loadingMore:o,error:l,loadEmployees:c,loadMoreEmployees:d,archiveEmployee:m,updateEmployee:u,pagination:g}=((e,a)=>{const[r,s]=t.useState([]),[i,n]=t.useState([]),[o,l]=t.useState(!0),[c,d]=t.useState(!1),[m,u]=t.useState(null),[g,p]=t.useState({hasMore:!0,currentPage:0,pageSize:50}),h=async(t=!0)=>{if(e)try{if(t?(l(!0),s([]),p(e=>({...e,currentPage:0,lastId:void 0}))):d(!0),u(null),a){const t=await Ut.employees.getByManager(a,e);return s(t),n(t),void p(e=>({...e,hasMore:!1}))}const r=await Ut.employees.getAll(e),i=!1,o=void 0;t?(s(r),n(r)):(s(e=>[...e,...r]),n(e=>[...e,...r])),p(e=>({...e,hasMore:i,lastId:o,currentPage:t?1:e.currentPage+1}))}catch(r){u("Failed to load employees"),Pe.error("Error loading employees:",r)}finally{l(!1),d(!1)}};return t.useEffect(()=>{h()},[e]),{employees:r,allEmployees:i,loading:o,loadingMore:c,error:m,loadEmployees:h,loadMoreEmployees:async()=>{g.hasMore&&!c&&await h(!1)},archiveEmployee:async(t,a)=>{if(e)try{await Ut.employees.delete(t.id,e),await h()}catch(r){throw u("Failed to archive employee"),Pe.error("Archive error:",r),r}},updateEmployee:async t=>{if(e)try{await Ut.employees.update(t.id,e,t),await h()}catch(a){throw u("Failed to update employee"),a}},pagination:{hasMore:g.hasMore,currentPage:g.currentPage,pageSize:g.pageSize,canLoadMore:g.hasMore&&!o&&!c}}})(s,r?e?.id:void 0),{filters:p,setFilters:h,filteredEmployees:x}=oa(i,e),y=t.useMemo(()=>ot(ct||{isLegacyDevice:!1}),[]),[f,v]=t.useState(1),b=ct?.isLegacyDevice?y.employeeListLimit:50,w=t.useMemo(()=>{if(!ct?.isLegacyDevice)return x;const e=(f-1)*b,t=e+b;return x.slice(e,t)},[x,f,b,ct?.isLegacyDevice]),N=Math.ceil(x.length/b),j=t.useMemo(()=>window.innerWidth<768,[]),[D,A]=t.useState(j?"cards":"table"),[E,C]=t.useState(!1),[S,I]=t.useState(!1),[k,z]=t.useState(null),[R,$]=t.useState(null),[O,T]=t.useState(null),[P,_]=t.useState([]),[L,F]=t.useState(!1),[M,W]=t.useState([]),[U,H]=t.useState(!1),[V,q]=t.useState(!1),B=na(e?.role.id,e?.departmentIds),G=t.useCallback(e=>{T(e)},[]),Z=t.useCallback(e=>{z(e)},[]),Y=t.useCallback(e=>{$(e)},[]),J=t.useCallback((e,t)=>{switch(e){case"assign-manager":_(t),F(!0);break;case"assign-department":W(t),H(!0)}},[]),Q=t.useCallback(async e=>{if(!s)return;const t=P.map(t=>u({...t,employment:{...t.employment,managerId:e}}));await Promise.all(t),await c(),F(!1),_([])},[P,s,u,c]),X=t.useCallback(async e=>{if(!s)return;const t=M.map(t=>u({...t,profile:{...t.profile,department:e}}));await Promise.all(t),await c(),H(!1),W([])},[M,s,u,c]);return n?ct?.isLegacyDevice?Te.jsxs("div",{className:"w-full p-4",children:[Te.jsx(ja,{message:"Loading Employees..."}),Te.jsx("div",{className:"mt-4",children:Te.jsx(Na,{})})]}):Te.jsx(Ht,{message:"Loading employees...",size:"lg"}):Te.jsxs("div",{className:"w-full space-y-2 md:space-y-4",children:[Te.jsxs("div",{className:"md:hidden flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium",children:[Te.jsx(oe,{className:"w-4 h-4"}),x.length]}),p.search&&Te.jsx("button",{onClick:()=>h({...p,search:""}),className:"text-xs text-gray-500 hover:text-gray-700",children:"Clear search"})]}),B.canBulkImport&&Te.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-1.5 px-3 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg font-medium text-sm",children:[Te.jsx(we,{className:"w-4 h-4"}),"Import"]})]}),Te.jsx("div",{className:"hidden md:block md:bg-white/95 md:backdrop-blur-sm md:rounded-xl md:shadow-lg md:border md:border-white/50 overflow-hidden",children:Te.jsx("div",{className:"hidden md:block bg-gradient-to-r from-indigo-600 via-purple-700 to-indigo-800 p-3",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx("div",{className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:Te.jsx(oe,{className:"w-5 h-5 text-white"})}),Te.jsxs("div",{children:[Te.jsx("h3",{className:"text-lg font-bold text-white tracking-tight",children:"Employee Management"}),Te.jsx("p",{className:"text-indigo-100 text-xs font-medium",children:ct?.isLegacyDevice?`${w.length} of ${x.length} employees`:`${x.length} employees`})]})]}),Te.jsxs("div",{className:"flex gap-2",children:[B.canCreate&&Te.jsxs("button",{onClick:()=>C(!0),className:"flex items-center gap-2 px-3 py-2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white rounded-lg font-medium border border-white/30 hover:border-white/50 transition-all text-sm",children:[Te.jsx(K,{className:"w-4 h-4"}),Te.jsx("span",{children:"Add"})]}),B.canBulkImport&&Te.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-2 px-3 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[Te.jsx(we,{className:"w-4 h-4"}),Te.jsx("span",{children:"Import"})]}),B.canViewArchived&&Te.jsxs("button",{onClick:()=>A("archive"),className:"flex items-center gap-2 px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[Te.jsx(Ne,{className:"w-4 h-4"}),Te.jsx("span",{className:"hidden sm:inline",children:"Archive"})]})]})]})})}),l&&Te.jsx("div",{className:"bg-gradient-to-r from-red-50 to-red-100 border border-red-200 rounded-lg p-3",children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx("span",{className:"text-red-600 text-lg",children:"‚ö†Ô∏è"}),Te.jsx("p",{className:"text-red-800 font-medium text-sm",children:l})]})}),Te.jsx("div",{className:"hidden md:block",children:Te.jsx(la,{employees:x})}),Te.jsxs("div",{className:"hidden md:flex md:items-center md:justify-between",children:[Te.jsx("div",{className:"text-sm text-slate-600",children:"hr-manager"===e?.role?.id?"Full organizational view":"hod-manager"===e?.role?.id?"Your team structure":"Team directory"}),Te.jsxs("div",{className:"flex bg-slate-100 rounded-lg p-1",children:[Te.jsxs("button",{onClick:()=>A("organogram"),className:"flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs "+("organogram"===D?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"),children:[Te.jsx(je,{className:"w-3 h-3"}),Te.jsx("span",{children:"Hierarchy"})]}),Te.jsxs("button",{onClick:()=>A("table"),className:"flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs "+("table"===D?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"),children:[Te.jsx(ue,{className:"w-3 h-3"}),Te.jsx("span",{children:"Table"})]}),Te.jsxs("button",{onClick:()=>A("cards"),className:"flex items-center gap-2 px-3 py-2 rounded-md font-medium transition-all text-xs "+("cards"===D?"bg-white shadow-md text-indigo-600":"text-slate-600 hover:text-slate-900"),children:[Te.jsx(De,{className:"w-3 h-3"}),Te.jsx("span",{children:"Cards"})]})]})]}),"cards"===D&&Te.jsx("div",{className:"hidden md:block bg-white/95 backdrop-blur-sm rounded-lg shadow-md border border-white/50 p-3",children:Te.jsx(ca,{filters:p,setFilters:h,departments:[...new Set(i.map(e=>e.profile.department))],viewMode:D,setViewMode:A})}),Te.jsxs("div",{className:"md:hidden -mt-1 space-y-2",children:[Te.jsxs("div",{className:"flex gap-2",children:[Te.jsx("input",{type:"text",placeholder:"üîç Search employees...",value:p.search,onChange:e=>h({...p,search:e.target.value}),className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 focus:outline-none transition-all bg-white text-sm"}),Te.jsx("button",{onClick:()=>q(!V),className:"px-3 py-2.5 border rounded-lg font-medium text-sm transition-all "+(V?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-700"),children:Te.jsx(pe,{className:"w-4 h-4"})})]}),V&&Te.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3 space-y-2",children:[Te.jsxs("select",{value:p.department,onChange:e=>h({...p,department:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm",children:[Te.jsx("option",{value:"",children:"All Departments"}),[...new Set(i.map(e=>e.profile?.department).filter(Boolean))].map(e=>Te.jsx("option",{value:e,children:e},e))]}),Te.jsxs("select",{value:p.contractType,onChange:e=>h({...p,contractType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm",children:[Te.jsx("option",{value:"",children:"All Contract Types"}),Te.jsx("option",{value:"permanent",children:"Permanent"}),Te.jsx("option",{value:"contract",children:"Contract"}),Te.jsx("option",{value:"temporary",children:"Temporary"})]}),Te.jsxs("div",{className:"flex gap-2",children:[Te.jsxs("label",{className:"flex-1 flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg border border-gray-200",children:[Te.jsx("input",{type:"checkbox",checked:p.hasWarnings,onChange:e=>h({...p,hasWarnings:e.target.checked}),className:"w-4 h-4"}),Te.jsx("span",{className:"text-sm text-gray-700",children:"Has Warnings"})]}),Te.jsxs("label",{className:"flex-1 flex items-center gap-2 px-3 py-2 bg-gray-50 rounded-lg border border-gray-200",children:[Te.jsx("input",{type:"checkbox",checked:p.isActive,onChange:e=>h({...p,isActive:e.target.checked}),className:"w-4 h-4"}),Te.jsx("span",{className:"text-sm text-gray-700",children:"Active Only"})]})]})]})]}),"organogram"===D&&Te.jsx(ya,{employees:x,onEmployeeClick:G,selectedEmployee:O}),"table"===D&&Te.jsx(fa,{employees:w,onEmployeeSelect:G,onEmployeeEdit:Z,onEmployeeDelete:Y,onBulkAction:J,selectedEmployee:O,loading:n}),"cards"===D&&Te.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-2.5 md:gap-3 pb-24 md:pb-0 -mt-0.5 md:mt-0",children:w.map(e=>Te.jsx(da,{employee:e,permissions:B,onEdit:z,onArchive:$,onViewWarnings:e=>{e.id,localStorage.setItem("warningFilterEmployeeId",e.id),localStorage.setItem("warningFilterEmployeeName",`${e.profile.firstName} ${e.profile.lastName}`),window.dispatchEvent(new CustomEvent("navigateToWarnings",{detail:{employeeId:e.id}}))}},e.id))}),ct?.isLegacyDevice&&N>1&&Te.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-4 mt-4",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"text-sm text-gray-600 legacy-text-size",children:["Page ",f," of ",N," (",x.length," total employees)"]}),Te.jsxs("div",{className:"flex gap-2",children:[Te.jsx("button",{onClick:()=>v(e=>Math.max(1,e-1)),disabled:1===f,className:"px-3 py-2 rounded-md legacy-touch-target legacy-text-size "+(1===f?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"),children:"Previous"}),Te.jsxs("div",{className:"flex items-center px-3 py-2 text-sm text-gray-600 legacy-text-size",children:[Math.max(1,f-1),"-",Math.min(N,f+1)]}),Te.jsx("button",{onClick:()=>v(e=>Math.min(N,e+1)),disabled:f===N,className:"px-3 py-2 rounded-md legacy-touch-target legacy-text-size "+(f===N?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-50 text-blue-600 hover:bg-blue-100"),children:"Next"})]})]})}),"archive"===D&&Te.jsxs("div",{className:"text-center py-12",children:[Te.jsx("p",{className:"text-gray-500",children:"Archive list view is being reimplemented. Use the Archive button on individual employees."}),Te.jsx("button",{onClick:()=>A("table"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Employee List"})]}),"cards"===D&&g.canLoadMore&&!n&&Te.jsxs("div",{className:"text-center py-4",children:[Te.jsx("button",{onClick:d,disabled:o,className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 disabled:from-slate-400 disabled:to-slate-500 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:o?Te.jsxs(Te.Fragment,{children:[Te.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),Te.jsx("span",{children:"Loading..."})]}):Te.jsxs(Te.Fragment,{children:[Te.jsx(ee,{className:"w-4 h-4"}),Te.jsxs("span",{children:["Load More (",i.length,")"]})]})}),Te.jsxs("p",{className:"text-xs text-slate-500 mt-2",children:["Page ",g.currentPage," ‚Ä¢ ",g.pageSize," per page"]})]}),!n&&0===x.length&&Te.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-lg p-6 text-center shadow-lg border border-white/50",children:[Te.jsx("div",{className:"text-3xl mb-3",children:"üë•"}),Te.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:0===i.length?"No employees yet":"No matching employees"}),Te.jsx("p",{className:"text-slate-600 mb-4 text-sm",children:0===i.length?"Add your first employee or import from CSV":"Try adjusting your search criteria"}),B.canCreate&&0===i.length&&Te.jsxs("button",{onClick:()=>C(!0),className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 text-white rounded-lg font-medium shadow-md transition-all text-sm",children:[Te.jsx(K,{className:"w-4 h-4"}),"Add First Employee"]})]}),(E||k)&&Te.jsx(ma,{employee:k,onClose:()=>{C(!1),z(null)},onSave:async()=>{await c(),C(!1),z(null)}}),S&&Te.jsx(ua,{onClose:()=>I(!1),onImportComplete:c}),R&&Te.jsx(ga,{employee:R,onClose:()=>$(null),onArchive:async e=>{await m(e),$(null)}}),L&&Te.jsx(pa,{isOpen:L,onClose:()=>{F(!1),_([])},employees:P,onAssign:Q}),U&&Te.jsx(ha,{isOpen:U,onClose:()=>{H(!1),W([])},employees:M,onAssign:X}),B.canCreate&&Te.jsx("button",{onClick:()=>C(!0),className:"md:hidden fixed bottom-6 right-6 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-200 active:scale-95 flex items-center justify-center z-50","aria-label":"Add Employee",children:Te.jsx(K,{className:"w-6 h-6"})})]})},Aa=Object.freeze(Object.defineProperty({__proto__:null,EmployeeManagement:Da},Symbol.toStringTag,{value:"Module"})),Ea=({isOpen:e,onClose:a,organizationId:s,inline:i=!1})=>{const{organization:n}=ht(),o=s||n?.id,[l,c]=t.useState([]),[d,m]=t.useState(null),[u,g]=t.useState(!0),[p,h]=t.useState(null),[x,y]=t.useState(!1),[f,v]=t.useState(null),[b,w]=t.useState({name:"",description:"",managerId:""}),[N,j]=t.useState(!1);t.useEffect(()=>{if(!o||!e&&!i)return;(async()=>{try{g(!0),h(null);const[e,t]=await Promise.all([Bt.getDepartments(o),Bt.getDepartmentStats(o)]);c(e),m(t)}catch(e){Pe.error("Failed to load departments",{error:e}),h("Failed to load departments. Please try again.")}finally{g(!1)}})()},[o,e,i]),t.useEffect(()=>{if(!o||!e&&!i)return;return Bt.subscribeToDepartments(o,e=>{c(e)})},[o,e,i]);const D=()=>{v(null),w({name:"",description:"",managerId:""}),y(!0)},A=()=>{y(!1),v(null),w({name:"",description:"",managerId:""})};if(!i&&!e)return null;const E=Te.jsxs(Te.Fragment,{children:[Te.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3 mb-3",children:Te.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[Te.jsxs("div",{className:"flex items-center gap-4",children:[Te.jsx("h3",{className:"text-base font-bold text-gray-900",children:"Departments"}),d&&Te.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(ce,{className:"w-3 h-3"}),d.totalDepartments," total"]}),Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(de,{className:"w-3 h-3"}),d.departmentsWithManagers," with managers"]}),Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(oe,{className:"w-3 h-3"}),d.totalEmployeesAcrossDepartments," employees"]})]})]}),Te.jsxs("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors",children:[Te.jsx(K,{className:"w-3.5 h-3.5"}),"Add Department"]})]})}),u&&Te.jsx(Ht,{message:"Loading departments..."}),p&&Te.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-3",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(V,{className:"w-3.5 h-3.5 text-red-600"}),Te.jsx("span",{className:"text-sm text-red-800",children:p})]})}),!u&&!p&&Te.jsxs("div",{className:"space-y-1.5",children:[l.map(e=>Te.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex-1",children:[Te.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Te.jsx("h4",{className:"font-semibold text-sm text-gray-900",children:e.name}),e.isDefault&&Te.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-800 text-xs rounded",children:"Default"})]}),e.description&&Te.jsx("p",{className:"text-xs text-gray-600 mb-1.5",children:e.description}),Te.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(oe,{className:"w-3 h-3"}),e.employeeCount," employees"]}),e.managerName?Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(de,{className:"w-3 h-3"}),e.managerName]}):Te.jsxs("span",{className:"flex items-center gap-1 text-orange-600",children:[Te.jsx(V,{className:"w-3 h-3"}),"No manager"]})]})]}),Te.jsxs("div",{className:"flex items-center gap-1",children:[Te.jsx("button",{onClick:()=>(e=>{v(e),w({name:e.name,description:e.description||"",managerId:e.managerId||""}),y(!0)})(e),className:"p-1.5 text-gray-400 hover:text-blue-600 rounded hover:bg-blue-50",title:"Edit department",children:Te.jsx(G,{className:"w-3.5 h-3.5"})}),!e.isDefault&&Te.jsx("button",{onClick:()=>(async e=>{if(o)if(e.isDefault)alert("Cannot delete default departments (Operations, Admin)");else if(confirm(`Are you sure you want to delete "${e.name}"? This action cannot be undone.`))try{await Bt.deleteDepartment(o,e.id),Pe.success("Department deleted successfully")}catch(t){Pe.error("Failed to delete department",{error:t}),alert("Failed to delete department. Please try again.")}})(e),className:"p-1.5 text-gray-400 hover:text-red-600 rounded hover:bg-red-50",title:"Delete department",children:Te.jsx(Q,{className:"w-3.5 h-3.5"})})]})]})},e.id)),0===l.length&&!u&&Te.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center",children:[Te.jsx(ce,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),Te.jsx("p",{className:"text-sm font-medium text-gray-900 mb-1",children:"No departments found"}),Te.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Create your first department to get started with organizational structure."}),Te.jsxs("button",{onClick:D,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors mx-auto",children:[Te.jsx(K,{className:"w-3.5 h-3.5"}),"Create Department"]})]})]}),x&&Te.jsx(yt,{isOpen:x,onClose:A,title:f?"Edit Department":"Create Department",subtitle:f?"Update department information":"Add a new department to your organization",size:"md",children:Te.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),o)try{j(!0),f?await Bt.updateDepartment(o,f.id,b):await Bt.createDepartment(o,b),y(!1),w({name:"",description:"",managerId:""}),Pe.success(f?"Department updated successfully":"Department created successfully")}catch(t){Pe.error("Failed to save department",{error:t}),alert("Failed to save department. Please try again.")}finally{j(!1)}},className:"space-y-3",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-xs font-medium mb-1.5 text-gray-700",children:"Department Name *"}),Te.jsx("input",{type:"text",value:b.name,onChange:e=>w(t=>({...t,name:e.target.value})),className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"e.g., Operations, Admin, Sales",required:!0})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-xs font-medium mb-1.5 text-gray-700",children:"Description"}),Te.jsx("textarea",{value:b.description,onChange:e=>w(t=>({...t,description:e.target.value})),rows:3,className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Brief description of the department's role and responsibilities"})]}),Te.jsxs("div",{className:"flex justify-end gap-2 pt-3",children:[Te.jsx("button",{type:"button",onClick:A,disabled:N,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),Te.jsx("button",{type:"submit",disabled:N||!b.name.trim(),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:N?Te.jsxs(Te.Fragment,{children:[Te.jsx(M,{className:"w-3.5 h-3.5 animate-spin"}),f?"Updating...":"Creating..."]}):Te.jsxs(Te.Fragment,{children:[Te.jsx(ne,{className:"w-3.5 h-3.5"}),f?"Update":"Create"]})})]})]})})]});return i?Te.jsx("div",{className:"space-y-4",children:E}):r.createPortal(Te.jsx(yt,{isOpen:e,onClose:a,title:"Department Management",subtitle:"Manage organizational departments and assignments",size:"lg",children:E}),document.body)},Ca=({employees:e,className:a=""})=>{const{organization:r}=ht(),[s,i]=t.useState([]),[n,o]=t.useState(!1),[l,c]=t.useState(!1),d=t.useCallback(async()=>{if(r?.id&&!n){o(!0);try{let t;if(Rt()&&zt("useIndexCollections")){t=(await It.getActiveWarningsIndex(r.id,100)).filter(e=>"high"===e.priority).map(e=>({...e.metadata,id:e.id,employeeId:e.employeeId,level:e.metadata.level,employeeName:e.metadata.employeeName}))}else if(Rt()&&Ot()){t=(await It.getOrganizationWarnings(r.id,{level:"final_written"},{pageSize:100,orderField:"issueDate",orderDirection:"desc"})).warnings}else t=await Ut.warnings.getAll(r.id);let a=t.filter(e=>"final_written"===e.level);if(e&&e.length>0){const t=new Set(e.map(e=>e.id));a=a.filter(e=>t.has(e.employeeId))}const s=await Ut.employees.getAll(r.id),n=a.map(e=>{const t=s.find(t=>t.id===e.employeeId);return{...e,employeeName:t?.name||`${t?.profile?.firstName||""} ${t?.profile?.lastName||""}`.trim()||"Unknown",employee:t}});n.sort((e,t)=>new Date(t.issueDate).getTime()-new Date(e.issueDate).getTime()),i(n)}catch(t){Pe.error("Failed to fetch final warning employees:",t)}finally{o(!1)}}},[r?.id,e]);return t.useEffect(()=>{r?.id&&d()},[r?.id,d]),n||0!==s.length?n?Te.jsx(Gt,{padding:"md",className:a,children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2",style:{borderColor:"var(--color-primary)"}}),Te.jsx("span",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Loading final warnings watch list..."})]})}):Te.jsxs(Jt,{variant:"error",className:`border-2 ${a}`,children:[Te.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>c(!l),children:[Te.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[Te.jsx(V,{className:"w-4 h-4"}),"Final Warnings Watch List (",s.length,")",Te.jsx(Yt,{variant:"error",size:"sm",className:"animate-pulse hidden sm:inline-block",children:"MONITOR CLOSELY"})]}),Te.jsx(ee,{className:"w-4 h-4 transition-transform "+(l?"rotate-180":""),style:{color:"var(--color-alert-error-text)"}})]}),l&&Te.jsxs(Te.Fragment,{children:[Te.jsx("div",{className:"space-y-1.5 mt-3",children:s.map(e=>{let t,a;t=e.issueDate?.toDate?e.issueDate.toDate():e.issueDate?.seconds?new Date(1e3*e.issueDate.seconds):new Date(e.issueDate),a=e.expiryDate?.toDate?e.expiryDate.toDate():e.expiryDate?.seconds?new Date(1e3*e.expiryDate.seconds):new Date(e.expiryDate);const r=Math.floor((Date.now()-t.getTime())/864e5),s=Math.floor((a.getTime()-Date.now())/864e5);return Te.jsx(Gt,{padding:"md",className:"border-2",style:{borderColor:"var(--color-alert-error-border)"},children:Te.jsx("div",{className:"flex items-center justify-between",children:Te.jsxs("div",{className:"flex-1",children:[Te.jsx("div",{className:"font-medium",style:{color:"var(--color-alert-error-text)"},children:e.employeeName}),Te.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)",opacity:.8},children:[e.category," ‚Ä¢ ",r," days ago"]}),Te.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-alert-error-text)"},children:["‚ö†Ô∏è Next offense requires HR intervention ‚Ä¢ Expires in ",s," days"]})]})})},e.id||`${e.employeeId}-${e.categoryId||e.category}-${t.getTime()}`)})}),Te.jsx(Gt,{padding:"sm",className:"mt-3",style:{backgroundColor:"var(--color-alert-error-bg)",opacity:.7},children:Te.jsxs("div",{className:"text-xs",style:{color:"var(--color-alert-error-text)"},children:["üí° ",Te.jsx("strong",{children:"Tip:"})," Monitor these employees closely. Any new offenses will trigger urgent HR intervention alerts."]})})]})]}):null},Sa=t.memo(({isOpen:e,onClose:a,onSuccess:r,userRole:s,employees:i})=>{const[n,o]=t.useState(i.length>0?"promote":"create"),[l,c]=t.useState(null),[d,m]=t.useState({firstName:"",lastName:"",email:"",department:"",password:"temp123"}),[u,g]=t.useState(!1),[p,h]=t.useState(""),{user:x}=it(),{organization:y}=ht(),f=()=>{o(i.length>0?"promote":"create"),c(null),m({firstName:"",lastName:"",email:"",department:"",password:"temp123"})};return e?Te.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[9999] p-4",children:Te.jsxs("div",{className:"bg-white rounded-2xl max-w-md w-full shadow-2xl animate-in fade-in duration-200",children:[Te.jsxs("div",{className:"p-6 border-b border-gray-200",children:[Te.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-3",children:[Te.jsx(Ae,{className:"w-6 h-6 text-blue-600"}),"Add ","hr-manager"===s?"HR Manager":"Department Manager"]}),Te.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"promote"===n?"Promote an existing employee to "+("hr-manager"===s?"HR manager":"department manager"):`Create a new ${"hr-manager"===s?"HR manager":"department manager"} account`})]}),Te.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),y&&x){g(!0),h("");try{if("promote"===n){if(!l)return h("Please select an employee to promote"),void g(!1);if(l.id,!d.email.trim())return h("Email address is required for creating user account"),void g(!1);const e={firstName:l.profile?.firstName||l.firstName,lastName:l.profile?.lastName||l.lastName,email:d.email.trim(),password:"temp123",role:s,organizationId:y.id,departmentIds:"hod-manager"===s?[d.department]:[],employeeId:l.id,updateEmployeeEmail:!0},t=_(We,"createOrganizationUser"),a=await t(e);if(!a.data.success)throw new Error(a.data.message||"Failed to promote employee");Pe.success(`‚úÖ Promoted employee to ${s} with verified email: ${d.email}`)}else{const e={firstName:d.firstName,lastName:d.lastName,email:d.email,password:d.password,role:s,organizationId:y.id,departmentIds:"hod-manager"===s?[d.department]:[],createEmployee:!0},t=_(We,"createOrganizationUser"),a=await t(e);if(!a.data.success)throw new Error(a.data.message||"Failed to create user");Pe.success(`‚úÖ Created ${s} user and employee: ${a.data.userId}`)}g(!1),r(),a(),f()}catch(t){Pe.error("‚ùå Error processing user:",t),h(t.message||"Failed to process user"),g(!1)}}},className:"p-6 space-y-4",children:[Te.jsxs("div",{className:"space-y-3",children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Choose Option"}),Te.jsxs("div",{className:"space-y-2",children:[Te.jsxs("label",{className:"flex items-center",children:[Te.jsx("input",{type:"radio",name:"selectionMode",value:"promote",checked:"promote"===n,onChange:e=>o(e.target.value),className:"mr-3 text-blue-600",disabled:0===i.length}),Te.jsxs("span",{className:0===i.length?"text-gray-400":"text-gray-700",children:["Promote Existing Employee ",0===i.length&&"(No employees available)"]})]}),Te.jsxs("label",{className:"flex items-center",children:[Te.jsx("input",{type:"radio",name:"selectionMode",value:"create",checked:"create"===n,onChange:e=>o(e.target.value),className:"mr-3 text-blue-600"}),Te.jsx("span",{className:"text-gray-700",children:"Create New Manager"})]})]})]}),"promote"===n&&Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Employee to Promote"}),Te.jsxs("select",{value:l?.id||"",onChange:e=>{const t=i.find(t=>t.id===e.target.value);if(c(t||null),t){const e=t.profile?.email||t.email;e||(t.profile?.firstName||t.firstName,t.profile?.lastName||t.lastName,y?.name.toLowerCase().replace(/\s+/g,"")),m(t=>({...t,email:e||""}))}else m(e=>({...e,email:""}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[Te.jsx("option",{value:"",children:"Select an employee..."}),i.map(e=>Te.jsxs("option",{value:e.id,children:[e.profile?.firstName||e.firstName," ",e.profile?.lastName||e.lastName,e.profile?.email&&` (${e.profile.email})`]},e.id))]}),l&&Te.jsxs("div",{className:"mt-2 p-3 bg-blue-50 rounded-lg space-y-3",children:[Te.jsxs("div",{className:"text-sm",children:[Te.jsx("strong",{children:"Selected:"})," ",l.profile?.firstName||l.firstName," ",l.profile?.lastName||l.lastName,Te.jsx("br",{}),Te.jsx("strong",{children:"Department:"})," ",l.profile?.department||l.employment?.department||"Not assigned"]}),Te.jsxs("div",{children:[Te.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:["Email Address",l.profile?.email?Te.jsx("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full",children:"Verify/Update"}):Te.jsx("span",{className:"text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full",children:"Required"})]}),Te.jsxs("div",{className:"relative",children:[Te.jsx("input",{type:"email",value:d.email,onChange:e=>m(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(l.profile?.email?"border-yellow-300 bg-yellow-50":"border-gray-300"),placeholder:l.profile?.email||`${l.profile?.firstName||l.firstName}.${l.profile?.lastName||l.lastName}@${y?.name.toLowerCase().replace(/\s+/g,"")}.com`,required:!0}),l.profile?.email&&d.email===(l.profile?.email||l.email)&&Te.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:Te.jsx("span",{className:"text-green-600 text-sm",children:"‚úì Verified"})})]}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1 flex items-start gap-2",children:l.profile?.email?Te.jsxs("div",{className:"flex items-center gap-1",children:[Te.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full flex-shrink-0 mt-1"}),Te.jsxs("span",{children:["Current: ",Te.jsx("strong",{children:l.profile.email}),". You can verify or update it above."]})]}):Te.jsxs("div",{className:"flex items-center gap-1",children:[Te.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full flex-shrink-0 mt-1"}),Te.jsx("span",{children:"No email on file. Please enter their email address for login access."})]})})]})]})]}),"create"===n&&Te.jsxs(Te.Fragment,{children:[Te.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),Te.jsx("input",{type:"text",value:d.firstName,onChange:e=>m(t=>({...t,firstName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),Te.jsx("input",{type:"text",value:d.lastName,onChange:e=>m(t=>({...t,lastName:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),Te.jsx("input",{type:"email",value:d.email,onChange:e=>m(t=>({...t,email:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),"hod-manager"===s&&Te.jsxs("div",{children:[Te.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Department"}),Te.jsxs("select",{value:d.department,onChange:e=>m(t=>({...t,department:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[Te.jsx("option",{value:"",children:"Select Department"}),Te.jsx("option",{value:"operations",children:"Operations"}),Te.jsx("option",{value:"production",children:"Production"}),Te.jsx("option",{value:"quality",children:"Quality Assurance"}),Te.jsx("option",{value:"maintenance",children:"Maintenance"}),Te.jsx("option",{value:"logistics",children:"Logistics"}),Te.jsx("option",{value:"administration",children:"Administration"}),Te.jsx("option",{value:"finance",children:"Finance"}),Te.jsx("option",{value:"sales",children:"Sales & Marketing"})]})]})]}),p&&Te.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(le,{className:"w-4 h-4 text-red-500"}),Te.jsx("span",{className:"text-sm text-red-700",children:p})]})}),Te.jsxs("div",{className:"flex gap-3 pt-4",children:[Te.jsx("button",{type:"button",onClick:a,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),Te.jsx("button",{type:"submit",disabled:u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:u?Te.jsxs(Te.Fragment,{children:[Te.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"promote"===n?"Promoting...":"Creating..."]}):Te.jsxs(Te.Fragment,{children:[Te.jsx(Ae,{className:"w-4 h-4"}),"promote"===n?"Promote Employee":"Create Manager"]})})]})]})]})}):null});Sa.displayName="AddUserModal";const Ia=e=>"string"==typeof e?e:e?.id||"",ka=t.memo(()=>{const e=s(),{user:a}=it(),{organization:i}=ht(),{canCreateHRManagers:n,canCreateHODManagers:o,canManageDepartments:l,canManageUsers:c}=ft(),[d,m]=t.useState([]),[u,g]=t.useState(null),[p,h]=t.useState([]),[x,y]=t.useState([]),[f,v]=t.useState({totalUsers:0,totalEmployees:0,totalDepartments:0,activeWarnings:0}),[b,w]=t.useState(!0),[N,j]=t.useState(!1),[D,A]=t.useState("hr-manager"),[E,C]=t.useState(null);t.useEffect(()=>{i&&S()},[i]);const S=async()=>{if(i)try{w(!0),i.id;const e=(await Ye.queryDocuments(i.id,"users",[])).documents.map(e=>({id:e.id,firstName:e.firstName||"",lastName:e.lastName||"",email:e.email,role:e.role,departmentIds:e.departmentIds||[],isActive:e.isActive??!0,createdAt:e.createdAt||(new Date).toISOString(),lastLogin:e.lastLogin})),t=e.filter(e=>"business-owner"!==Ia(e.role)),a=e.find(e=>"business-owner"===Ia(e.role))||null,r=await mt.loadEmployees(i.id),s=(await mt.loadWarnings(i.id)).documents.filter(e=>"issued"===e.status).length,n=(await Bt.getDepartments(i.id)).map(e=>({id:e.id,name:e.name,employeeCount:e.employeeCount,createdAt:e.createdAt.toISOString(),description:e.description,managerId:e.managerId,managerName:e.managerName})),o={totalUsers:t.length,totalEmployees:r.documents.length,totalDepartments:n.length,activeWarnings:s};m(t),g(a),h(n),y(r.documents),v(o),Pe.success(`‚úÖ Loaded organization data: ${t.length} users, ${r.documents.length} employees`)}catch(e){Pe.error("‚ùå Failed to load organization data:",e)}finally{w(!1)}},I=e=>{A(e),j(!0)},k=async e=>{if(!i)return;const t=d.find(t=>t.id===e);if(!t)return;const a=await R(e),r=a.length>0?`Archive ${t.firstName} ${t.lastName}?\n\nThis will:\n‚Ä¢ Archive the user account\n‚Ä¢ Reassign ${a.length} employees to HR managers\n‚Ä¢ Remove access to the system\n\nThis action can be undone by restoring the user.`:`Archive ${t.firstName} ${t.lastName}?\n\nThis will remove their access to the system.\nThis action can be undone by restoring the user.`;if(confirm(r))try{a.length>0&&await $(e,a),await mt.updateDocument(i.id,"users",e,{isActive:!1,archivedAt:(new Date).toISOString(),archivedBy:t?.uid||"system"}),Pe.success(`‚úÖ User archived successfully: ${t.firstName} ${t.lastName}`),S()}catch(s){Pe.error("‚ùå Failed to archive user:",s),alert("Failed to archive user. Please try again.")}},z=async e=>{if(!i)return;const t=d.find(t=>t.id===e);if(!t)return;if(confirm(`Restore ${t.firstName} ${t.lastName}?\n\nThis will reactivate their account and restore system access.`))try{await mt.updateDocument(i.id,"users",e,{isActive:!0,restoredAt:(new Date).toISOString(),restoredBy:t?.uid||"system",archivedAt:null,archivedBy:null}),Pe.success(`‚úÖ User restored successfully: ${t.firstName} ${t.lastName}`),S()}catch(a){Pe.error("‚ùå Failed to restore user:",a),alert("Failed to restore user. Please try again.")}},R=async e=>{if(!i)return[];try{return(await mt.loadEmployees(i.id)).documents.filter(t=>t.employment?.managerId===e&&!1!==t.isActive)}catch(t){return Pe.error("Error loading managed employees:",t),[]}},$=async(e,t)=>{if(i&&0!==t.length)try{const a=d.find(t=>"hr-manager"===Ia(t.role)&&t.isActive&&t.id!==e);if(!a)return void Pe.warn("‚ö†Ô∏è No active HR manager found for employee reassignment");t.length,a.firstName,a.lastName;const r=t.map(t=>mt.updateDocument(i.id,"employees",t.id,{"employment.managerId":a.id,"employment.managerName":`${a.firstName} ${a.lastName}`,"employment.managerRole":"hr-manager",reassignedAt:(new Date).toISOString(),reassignedFrom:e,reassignedReason:"Manager archived"}));await Promise.all(r),Pe.success(`‚úÖ Reassigned ${t.length} employees to ${a.firstName} ${a.lastName}`)}catch(a){throw Pe.error("‚ùå Failed to reassign employees:",a),a}};return b?Te.jsx(Ht,{message:"Loading organization..."}):Te.jsxs(Te.Fragment,{children:[Te.jsxs("div",{className:"space-y-3",children:[E&&Te.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 animate-in fade-in duration-300",children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(H,{className:"w-5 h-5 text-green-600"}),Te.jsx("div",{className:"flex-1",children:Te.jsx("p",{className:"text-green-800 font-medium",children:E})}),Te.jsx("button",{onClick:()=>C(null),className:"text-green-600 hover:text-green-800 p-1 rounded-full hover:bg-green-100",children:Te.jsx(F,{className:"w-4 h-4"})})]})}),Te.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:Te.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[Te.jsxs("div",{className:"flex items-center gap-4",children:[Te.jsx("h2",{className:"text-base font-bold text-gray-900",children:"Organization Management"}),Te.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(oe,{className:"w-3 h-3"}),f.totalUsers," users"]}),Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(ae,{className:"w-3 h-3"}),f.totalEmployees," employees"]}),Te.jsxs("span",{className:"flex items-center gap-1",children:[Te.jsx(ce,{className:"w-3 h-3"}),f.totalDepartments," depts"]})]})]}),Te.jsxs("div",{className:"flex items-center gap-2",children:[n()&&Te.jsxs("button",{onClick:()=>I("hr-manager"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100 rounded-md transition-colors",children:[Te.jsx(Ae,{className:"w-3.5 h-3.5"}),"Add HR Manager"]}),o()&&Te.jsxs("button",{onClick:()=>I("hod-manager"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-green-50 text-green-700 border border-green-200 hover:bg-green-100 rounded-md transition-colors",children:[Te.jsx(Ae,{className:"w-3.5 h-3.5"}),"Add Dept Manager"]}),c()&&Te.jsxs("button",{onClick:()=>e("/users"),className:"flex items-center gap-1 px-3 py-1.5 text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 rounded-md transition-colors",children:[Te.jsx(ie,{className:"w-3.5 h-3.5"}),"User Management"]})]})]})}),u&&Te.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx("div",{className:"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0",children:Te.jsx(de,{className:"w-4 h-4 text-yellow-600"})}),Te.jsxs("div",{children:[Te.jsxs("div",{className:"font-semibold text-sm text-gray-900",children:[u.firstName," ",u.lastName]}),Te.jsxs("div",{className:"text-xs text-gray-500",children:[u.email," ‚Ä¢ Business Owner"]})]})]}),("super-user"===a?.role||"reseller"===a?.role)&&Te.jsxs("div",{className:"flex items-center gap-1",children:[u.isActive?Te.jsx("button",{onClick:()=>k(u.id),className:"p-1.5 hover:bg-red-100 rounded transition-colors group",title:"Archive business owner",children:Te.jsx(Ne,{className:"w-3.5 h-3.5 text-gray-500 group-hover:text-red-600"})}):Te.jsx("button",{onClick:()=>z(u.id),className:"p-1.5 hover:bg-green-100 rounded transition-colors group",title:"Restore business owner",children:Te.jsx(Ee,{className:"w-3.5 h-3.5 text-gray-500 group-hover:text-green-600"})}),Te.jsx("div",{className:"px-2 py-0.5 rounded-full text-xs font-medium "+(u.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:u.isActive?"Active":"Archived"})]}),"business-owner"===a?.role&&Te.jsx("div",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Current User"})]})}),Te.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[Te.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:[Te.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-1.5 mb-2",children:[Te.jsx(ae,{className:"w-4 h-4 text-blue-600"}),"HR Managers (",d.filter(e=>"hr-manager"===Ia(e.role)).length,")"]}),Te.jsxs("div",{className:"space-y-1.5",children:[d.filter(e=>"hr-manager"===Ia(e.role)).map(e=>Te.jsx("div",{className:"bg-gray-50 rounded p-2 border border-gray-100",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx("div",{className:"w-7 h-7 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:Te.jsxs("span",{className:"font-semibold text-blue-600 text-xs",children:[e.firstName?.[0],e.lastName?.[0]]})}),Te.jsxs("div",{children:[Te.jsxs("div",{className:"font-medium text-xs text-gray-900",children:[e.firstName," ",e.lastName]}),Te.jsx("div",{className:"text-xs text-gray-500",children:e.email})]})]}),Te.jsxs("div",{className:"flex items-center gap-1",children:[e.isActive?Te.jsx("button",{onClick:()=>k(e.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive user",children:Te.jsx(Ne,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):Te.jsx("button",{onClick:()=>z(e.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore user",children:Te.jsx(Ee,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),Te.jsx("div",{className:"px-3 py-1 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Archived"})]})]})},e.id)),0===d.filter(e=>"hr-manager"===Ia(e.role)).length&&Te.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Te.jsx(ae,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),Te.jsx("p",{className:"text-sm",children:"No HR managers yet"})]})]})]}),Te.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:[Te.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-1.5 mb-2",children:[Te.jsx(oe,{className:"w-4 h-4 text-green-600"}),"Department Managers (",d.filter(e=>"hod-manager"===Ia(e.role)).length,")"]}),Te.jsxs("div",{className:"space-y-1.5",children:[d.filter(e=>"hod-manager"===Ia(e.role)).map(e=>Te.jsx("div",{className:"bg-gray-50 rounded p-2 border border-gray-100",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx("div",{className:"w-7 h-7 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:Te.jsxs("span",{className:"font-semibold text-green-600 text-xs",children:[e.firstName?.[0],e.lastName?.[0]]})}),Te.jsxs("div",{children:[Te.jsxs("div",{className:"font-medium text-xs text-gray-900",children:[e.firstName," ",e.lastName]}),Te.jsxs("div",{className:"text-xs text-gray-500",children:[e.email,e.departmentIds&&e.departmentIds.length>0&&Te.jsxs("span",{className:"ml-1 text-green-600",children:["‚Ä¢ ",e.departmentIds.map(e=>p.find(t=>t.id===e)?.name||e).join(", ")]})]})]})]}),Te.jsxs("div",{className:"flex items-center gap-1",children:[e.isActive?Te.jsx("button",{onClick:()=>k(e.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors group",title:"Archive user",children:Te.jsx(Ne,{className:"w-4 h-4 text-gray-500 group-hover:text-red-600"})}):Te.jsx("button",{onClick:()=>z(e.id),className:"p-2 hover:bg-green-100 rounded-lg transition-colors group",title:"Restore user",children:Te.jsx(Ee,{className:"w-4 h-4 text-gray-500 group-hover:text-green-600"})}),Te.jsx("div",{className:"px-3 py-1 rounded-full text-xs font-medium "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Archived"})]})]})},e.id)),0===d.filter(e=>"hod-manager"===Ia(e.role)).length&&Te.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Te.jsx(oe,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),Te.jsx("p",{className:"text-sm",children:"No department managers yet"})]})]})]})]}),l()&&p.length>0&&Te.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-2.5",children:[Te.jsxs("h3",{className:"text-sm font-bold text-gray-900 flex items-center gap-1.5 mb-2",children:[Te.jsx(ce,{className:"w-4 h-4 text-orange-600"}),"Departments (",p.length,")"]}),Te.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:p.map(e=>Te.jsxs("div",{className:"bg-orange-50 rounded p-2 border border-orange-200",children:[Te.jsx("div",{className:"mb-1",children:Te.jsx("h4",{className:"font-semibold text-xs text-gray-900",children:e.name})}),e.managerName?Te.jsxs("div",{className:"text-sm text-green-700 font-medium mb-2",children:["üë§ ",e.managerName]}):Te.jsx("div",{className:"text-sm text-orange-600 font-medium mb-2",children:"‚ö†Ô∏è No manager assigned"}),Te.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[Te.jsx(oe,{className:"w-4 h-4"}),e.employeeCount," employees"]})]},e.id))})]})]}),N&&r.createPortal(Te.jsx(Sa,{isOpen:N,onClose:()=>j(!1),onSuccess:()=>{C(`‚úÖ ${"hr-manager"===D?"HR Manager":"Department Manager"} created successfully! User can now sign in with their email and password 'temp123'.`),setTimeout(()=>C(null),5e3),S()},userRole:D,employees:x}),document.body)]})});ka.displayName="OrganizationManagementV2";const za={totalWarnings:0,activeWarnings:0,expiredWarnings:0,pendingReview:0,highRisk:0,expiringSoon:0,byLevel:{verbal:0,first_written:0,second_written:0,final_written:0,suspension:0,dismissal:0},byStatus:{delivered:0,issued:0,acknowledged:0,appealed:0,expired:0},recentActivity:{todayCount:0,weekCount:0,monthCount:0}},Ra=({title:e,value:t,subtitle:a,icon:r,color:s,bgColor:i,trend:n,isLoading:o,onClick:l,pulse:c=!1})=>o?Te.jsx("div",{className:"bg-white rounded-lg p-3 border",children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"space-y-2",children:[Te.jsx("div",{className:"h-3 bg-gray-200 rounded animate-pulse w-20"}),Te.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse w-12"})]}),Te.jsx("div",{className:`w-8 h-8 ${i} rounded-lg animate-pulse`})]})}):Te.jsx("div",{className:"bg-white rounded-lg p-3 border transition-all duration-200 "+(l?"hover:shadow-md cursor-pointer hover:border-gray-300":""),onClick:l,children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{children:[Te.jsx("p",{className:"text-sm text-gray-600",children:e}),Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx("p",{className:`text-2xl font-bold ${s}`,children:t.toLocaleString()}),c&&t>0&&Te.jsx("div",{className:`w-2 h-2 ${i.replace("bg-","bg-")} rounded-full animate-pulse`})]}),Te.jsx("p",{className:"text-xs text-gray-500",children:a}),n&&Te.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[Te.jsxs("span",{className:"text-xs font-medium "+(n.isPositive?"text-green-600":"text-red-600"),children:[n.isPositive?"‚Üó":"‚Üò"," ",Math.abs(n.value),"%"]}),Te.jsx("span",{className:"text-xs text-gray-400",children:n.label})]})]}),Te.jsx("div",{className:`p-2 ${i} rounded-lg`,children:Te.jsx(r,{className:`w-8 h-8 ${s}`})})]})}),$a=({userRole:e,variant:r="detailed",gradientColors:s="from-red-500 to-orange-600",showHeader:i=!0})=>{const{stats:n,loading:o,error:l,refreshStats:c}=(()=>{const{user:e}=it(),[a,r]=t.useState(za),[s,i]=t.useState(!0),[n,o]=t.useState(null),l=async()=>{if(e?.organizationId)try{i(!0),o(null),e.organizationId;const t=await Ut.warnings.getAll(e.organizationId);t.length;const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate()),n=new Date(a.getTime()-6048e5),l=new Date(a.getTime()-2592e6),c=new Date(a.getTime()+2592e6),d={totalWarnings:t.length,activeWarnings:0,expiredWarnings:0,pendingReview:0,highRisk:0,expiringSoon:0,byLevel:{verbal:0,first_written:0,second_written:0,final_written:0,suspension:0,dismissal:0},byStatus:{delivered:0,issued:0,acknowledged:0,appealed:0,expired:0},recentActivity:{todayCount:0,weekCount:0,monthCount:0}};t.forEach(e=>{const t=e.issueDate?new Date(e.issueDate):new Date(e.createdAt),r=e.expiryDate?new Date(e.expiryDate):null;!r||r>a?d.activeWarnings++:d.expiredWarnings++,["final_written","suspension","dismissal"].includes(e.level)&&d.highRisk++,r&&r<=c&&r>a&&d.expiringSoon++,e.level in d.byLevel&&d.byLevel[e.level]++,e.status&&e.status in d.byStatus&&d.byStatus[e.status]++,e.appealSubmitted&&d.pendingReview++,t>=s&&d.recentActivity.todayCount++,t>=n&&d.recentActivity.weekCount++,t>=l&&d.recentActivity.monthCount++}),r(d)}catch(t){Pe.error("Failed to load warnings stats:",t),o("Failed to load warnings statistics")}finally{i(!1)}else i(!1)};return t.useEffect(()=>{let t=!0,a=null;return e?.organizationId?(l(),a=setInterval(()=>{t&&l()},6e4)):i(!1),()=>{t=!1,a&&clearInterval(a)}},[e?.organizationId]),{stats:a,loading:s,error:n,refreshStats:async()=>{await l()}}})(),d=()=>"business-owner"===e?ae:V,m=()=>"business-owner"===e?"text-purple-600":"text-emerald-600",u=()=>"business-owner"===e?"Warnings Overview":"Warnings Management",g=()=>"business-owner"===e?"Executive summary of disciplinary actions":"Active warnings requiring review and management";return"compact"===r?Te.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-4",children:[i&&Te.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Te.jsxs("h3",{className:`text-lg font-semibold ${m()} flex items-center gap-2`,children:[a.createElement(d(),{className:"w-5 h-5"}),"Warnings"]}),Te.jsx("button",{onClick:c,className:"p-1 text-gray-400 hover:text-gray-600 rounded",disabled:o,children:Te.jsx(U,{className:"w-4 h-4 "+(o?"animate-spin":"")})})]}),Te.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[Te.jsx(Ra,{title:"Active",value:n.activeWarnings,subtitle:"Current warnings",icon:H,color:"text-green-600",bgColor:"bg-green-100",isLoading:o}),Te.jsx(Ra,{title:"High Risk",value:n.highRisk,subtitle:"Require attention",icon:V,color:"text-red-600",bgColor:"bg-red-100",isLoading:o,pulse:n.highRisk>0})]})]}):"executive"===r?Te.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[i&&Te.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Te.jsxs("div",{children:[Te.jsxs("h3",{className:`text-lg font-semibold ${m()} flex items-center gap-2 mb-1`,children:[a.createElement(d(),{className:"w-6 h-6"}),u()]}),Te.jsx("p",{className:"text-gray-600 text-sm",children:g()})]}),Te.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",disabled:o,children:Te.jsx(U,{className:"w-5 h-5 "+(o?"animate-spin":"")})})]}),l&&Te.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[Te.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[Te.jsx(Ce,{className:"w-5 h-5"}),Te.jsx("span",{className:"font-medium",children:"Failed to load warnings data"})]}),Te.jsx("p",{className:"text-red-600 text-sm mt-1",children:l})]}),Te.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[Te.jsx(Ra,{title:"Total Warnings",value:n.totalWarnings,subtitle:"All time",icon:te,color:"text-gray-700",bgColor:"bg-gray-100",isLoading:o}),Te.jsx(Ra,{title:"Active",value:n.activeWarnings,subtitle:"Currently valid",icon:H,color:"text-green-600",bgColor:"bg-green-100",isLoading:o}),Te.jsx(Ra,{title:"High Risk",value:n.highRisk,subtitle:"Final/Suspension/Dismissal",icon:V,color:"text-red-600",bgColor:"bg-red-100",isLoading:o,pulse:n.highRisk>0}),Te.jsx(Ra,{title:"This Month",value:n.recentActivity.monthCount,subtitle:"Recent activity",icon:Se,color:"text-blue-600",bgColor:"bg-blue-100",isLoading:o})]}),Te.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[Te.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Warning Level Distribution"}),Te.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-6 gap-3",children:[Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-green-600",children:n.byLevel.verbal}),Te.jsx("div",{className:"text-xs text-gray-600",children:"Verbal"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-yellow-600",children:n.byLevel.first_written}),Te.jsx("div",{className:"text-xs text-gray-600",children:"1st Written"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-orange-600",children:n.byLevel.second_written}),Te.jsx("div",{className:"text-xs text-gray-600",children:"2nd Written"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-red-600",children:n.byLevel.final_written}),Te.jsx("div",{className:"text-xs text-gray-600",children:"Final"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-purple-600",children:n.byLevel.suspension}),Te.jsx("div",{className:"text-xs text-gray-600",children:"Suspension"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-gray-900",children:n.byLevel.dismissal}),Te.jsx("div",{className:"text-xs text-gray-600",children:"Dismissal"})]})]})]})]}):Te.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-200 p-6",children:[i&&Te.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Te.jsxs("div",{children:[Te.jsxs("h3",{className:`text-lg font-semibold ${m()} flex items-center gap-2 mb-1`,children:[a.createElement(d(),{className:"w-6 h-6"}),u()]}),Te.jsx("p",{className:"text-gray-600 text-sm",children:g()})]}),Te.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",disabled:o,children:Te.jsx(U,{className:"w-5 h-5 "+(o?"animate-spin":"")})})]}),l&&Te.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:[Te.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[Te.jsx(Ce,{className:"w-5 h-5"}),Te.jsx("span",{className:"font-medium",children:"Failed to load warnings data"})]}),Te.jsx("p",{className:"text-red-600 text-sm mt-1",children:l})]}),Te.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[Te.jsx(Ra,{title:"Pending Review",value:n.pendingReview,subtitle:"Require immediate attention",icon:Ie,color:"text-orange-600",bgColor:"bg-orange-100",isLoading:o,pulse:n.pendingReview>0}),Te.jsx(Ra,{title:"High Risk",value:n.highRisk,subtitle:"Final/Suspension/Dismissal",icon:V,color:"text-red-600",bgColor:"bg-red-100",isLoading:o,pulse:n.highRisk>0}),Te.jsx(Ra,{title:"Expiring Soon",value:n.expiringSoon,subtitle:"Within 30 days",icon:Ie,color:"text-yellow-600",bgColor:"bg-yellow-100",isLoading:o}),Te.jsx(Ra,{title:"Active Total",value:n.activeWarnings,subtitle:"Currently valid",icon:H,color:"text-green-600",bgColor:"bg-green-100",isLoading:o})]}),Te.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[Te.jsxs("h4",{className:"font-semibold text-gray-800 mb-3 flex items-center gap-2",children:[Te.jsx(ke,{className:"w-5 h-5 text-gray-600"}),"Warning Level Distribution"]}),Te.jsxs("div",{className:"grid grid-cols-3 lg:grid-cols-6 gap-3",children:[Te.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[Te.jsx("div",{className:"text-xl font-bold text-green-600",children:n.byLevel.verbal}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Verbal"})]}),Te.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[Te.jsx("div",{className:"text-xl font-bold text-yellow-600",children:n.byLevel.first_written}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"1st Written"})]}),Te.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[Te.jsx("div",{className:"text-xl font-bold text-orange-600",children:n.byLevel.second_written}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"2nd Written"})]}),Te.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[Te.jsx("div",{className:"text-xl font-bold text-red-600",children:n.byLevel.final_written}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Final"})]}),Te.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[Te.jsx("div",{className:"text-xl font-bold text-purple-600",children:n.byLevel.suspension}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Suspension"})]}),Te.jsxs("div",{className:"text-center p-3 bg-white rounded-lg",children:[Te.jsx("div",{className:"text-xl font-bold text-gray-900",children:n.byLevel.dismissal}),Te.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Dismissal"})]})]})]}),Te.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6",children:[Te.jsxs("h4",{className:"font-semibold text-blue-900 mb-3 flex items-center gap-2",children:[Te.jsx(Se,{className:"w-5 h-5 text-blue-600"}),"Recent Activity"]}),Te.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-blue-700",children:n.recentActivity.todayCount}),Te.jsx("div",{className:"text-sm text-blue-600",children:"Today"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-blue-700",children:n.recentActivity.weekCount}),Te.jsx("div",{className:"text-sm text-blue-600",children:"This Week"})]}),Te.jsxs("div",{className:"text-center",children:[Te.jsx("div",{className:"text-lg font-bold text-blue-700",children:n.recentActivity.monthCount}),Te.jsx("div",{className:"text-sm text-blue-600",children:"This Month"})]})]})]})]})},Oa=[{text:"Leadership is not about being in charge. It's about taking care of those in your charge.",author:"Simon Sinek"},{text:"The growth and development of people is the highest calling of leadership.",author:"Harvey S. Firestone"},{text:"Great leaders don't set out to be a leader... They set out to make a difference.",author:"Jeremy Bravo"},{text:"A good leader takes a little more than his share of the blame, a little less than his share of the credit.",author:"Arnold H. Glasow"},{text:"The task of leadership is not to put greatness into people, but to elicit it, for the greatness is there already.",author:"John Buchan"},{text:"People buy into the leader before they buy into the vision.",author:"John Maxwell"},{text:"Leadership is about making others better as a result of your presence and making sure that impact lasts in your absence.",author:"Sheryl Sandberg"}],Ta=t.memo(({className:e=""})=>{s();const{user:a}=it(),{organization:r}=ht(),i=(e=>{const[a,r]=t.useState(window.innerWidth>e),s=t.useCallback(()=>r(window.innerWidth>e),[e]);return t.useEffect(()=>(window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)),[s]),a})(768),[n,o]=t.useState(null),{employees:l,warnings:c,metrics:d,error:m}=Xt({role:"business_owner"}),u={totalEmployees:l?.length||0,activeWarnings:c?.filter(e=>"delivered"!==e.status&&"expired"!==e.status)?.length||0,undeliveredWarnings:c?.filter(e=>!e.delivered&&"expired"!==e.status)?.length||0,highSeverityWarnings:c?.filter(e=>("high"===e.severity||"gross_misconduct"===e.category?.severity)&&"expired"!==e.status)?.length||0},[g]=t.useState(()=>Oa[Math.floor(Math.random()*Oa.length)]);return i?Te.jsxs("div",{className:`${e}`,children:[Te.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(oe,{className:"w-8 h-8",style:{opacity:.7}}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Total Employees"}),Te.jsx("div",{className:"text-2xl font-bold",children:u.totalEmployees})]})]})}),Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(V,{className:"w-8 h-8",style:{opacity:.7}}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Active Warnings"}),Te.jsx("div",{className:"text-2xl font-bold",children:u.activeWarnings}),Te.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[u.undeliveredWarnings," undelivered"]})]})]})}),Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(ae,{className:"w-8 h-8",style:{opacity:.7}}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-sm",style:{opacity:.8},children:"High Priority"}),Te.jsx("div",{className:"text-2xl font-bold",children:u.highSeverityWarnings}),Te.jsx("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:"Critical cases"})]})]})}),Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(ce,{className:"w-8 h-8",style:{opacity:.7}}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Departments"}),Te.jsx("div",{className:"text-2xl font-bold",children:d?.departmentCount||0})]})]})})]}),m&&Te.jsx(Jt,{variant:"error",className:"mb-4",children:Te.jsxs("div",{className:"text-sm",children:["Failed to load dashboard data: ",m]})}),Te.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[Te.jsx("div",{className:"border-b border-gray-200",children:Te.jsx("nav",{className:"flex space-x-6 px-4",children:[{id:"organization",label:"Organization",icon:ce},{id:"departments",label:"Departments",icon:ce},{id:"categories",label:"Warning Categories",icon:W},{id:"employees",label:"Employees",icon:oe},{id:"warnings",label:"Warnings",icon:ae}].map(e=>Te.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium transition-colors "+(n===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[Te.jsx(e.icon,{className:"w-4 h-4"}),e.label]},e.id))})}),Te.jsxs("div",{className:"p-4",children:["organization"===n&&Te.jsx("div",{className:"space-y-4",children:Te.jsx(ka,{})}),"departments"===n&&r&&Te.jsx(Ea,{isOpen:!0,onClose:()=>o("organization"),organizationId:r.id,inline:!0}),"categories"===n&&Te.jsx(Vt,{onClose:()=>o("organization"),inline:!0}),"employees"===n&&Te.jsx("div",{className:"space-y-4",children:Te.jsx(Da,{})}),"warnings"===n&&Te.jsxs("div",{className:"space-y-3",children:[Te.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-2",children:[Te.jsx("div",{className:"bg-orange-50 rounded-lg p-2.5 border border-orange-200",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(V,{className:"w-5 h-5 text-orange-600 flex-shrink-0"}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-lg font-bold text-orange-600",children:u.undeliveredWarnings}),Te.jsx("div",{className:"text-xs text-orange-700 font-medium",children:"Undelivered"})]})]})}),Te.jsx("div",{className:"bg-red-50 rounded-lg p-2.5 border border-red-200",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(ae,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-lg font-bold text-red-600",children:u.highSeverityWarnings}),Te.jsx("div",{className:"text-xs text-red-700 font-medium",children:"High Severity"})]})]})}),Te.jsx("div",{className:"bg-blue-50 rounded-lg p-2.5 border border-blue-200",children:Te.jsxs("div",{className:"flex items-center gap-2",children:[Te.jsx(ae,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),Te.jsxs("div",{children:[Te.jsx("div",{className:"text-lg font-bold text-blue-600",children:u.activeWarnings}),Te.jsx("div",{className:"text-xs text-blue-700 font-medium",children:"Total Active"})]})]})})]}),Te.jsx($a,{userRole:"business-owner",variant:"executive"})]})]})]}),Te.jsx(Ca,{className:"mt-6"})]}):Te.jsxs("div",{className:`space-y-6 ${e}`,children:[Te.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-success), var(--color-success))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[Te.jsx(oe,{className:"w-5 h-5"}),Te.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Total Employees"}),Te.jsx("span",{className:"text-lg font-bold",children:u.totalEmployees})]})}),Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[Te.jsx(V,{className:"w-5 h-5"}),Te.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Active Warnings"}),Te.jsx("span",{className:"text-lg font-bold",children:u.activeWarnings})]})}),Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[Te.jsx(ae,{className:"w-5 h-5"}),Te.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"High Priority"}),Te.jsx("span",{className:"text-lg font-bold",children:u.highSeverityWarnings})]})}),Te.jsx(Gt,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>o("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:Te.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[Te.jsx(ce,{className:"w-5 h-5"}),Te.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Departments"}),Te.jsx("span",{className:"text-lg font-bold",children:d?.departmentCount||0})]})})]}),Te.jsxs("div",{className:"space-y-3",children:[Te.jsx(Gt,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("organization"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(ce,{className:"w-5 h-5",style:{color:"var(--color-primary)"}}),Te.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Organization"})]}),Te.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),Te.jsx(Gt,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(ce,{className:"w-5 h-5",style:{color:"var(--color-info)"}}),Te.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Departments"})]}),Te.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),Te.jsx(Gt,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("categories"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(W,{className:"w-5 h-5",style:{color:"var(--color-warning)"}}),Te.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warning Categories"})]}),Te.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),Te.jsx(Gt,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(oe,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),Te.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Employees"})]}),Te.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),Te.jsx(Gt,{padding:"md",shadow:"sm",hover:!0,onClick:()=>o("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:Te.jsxs("div",{className:"flex items-center justify-between",children:[Te.jsxs("div",{className:"flex items-center gap-3",children:[Te.jsx(ae,{className:"w-5 h-5",style:{color:"var(--color-error)"}}),Te.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warnings"})]}),Te.jsx(me,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),"organization"===n&&Te.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:Te.jsxs(Gt,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[Te.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[Te.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Organization"}),Te.jsx(Qt,{variant:"ghost",size:"sm",onClick:()=>o(null),children:"√ó"})]}),Te.jsx("div",{className:"overflow-y-auto p-4",children:Te.jsx(ka,{})})]})}),"departments"===n&&r&&Te.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:Te.jsxs(Gt,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[Te.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[Te.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Departments"}),Te.jsx(Qt,{variant:"ghost",size:"sm",onClick:()=>o(null),children:"√ó"})]}),Te.jsx("div",{className:"overflow-y-auto",children:Te.jsx(Ea,{isOpen:!0,onClose:()=>o(null),organizationId:r.id,inline:!0})})]})}),"categories"===n&&Te.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:Te.jsxs(Gt,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[Te.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[Te.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Warning Categories"}),Te.jsx(Qt,{variant:"ghost",size:"sm",onClick:()=>o(null),children:"√ó"})]}),Te.jsx("div",{className:"overflow-y-auto p-4",children:Te.jsx(Vt,{onClose:()=>o(null),inline:!0})})]})}),"employees"===n&&Te.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:Te.jsxs(Gt,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[Te.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[Te.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Employees"}),Te.jsx(Qt,{variant:"ghost",size:"sm",onClick:()=>o(null),children:"√ó"})]}),Te.jsx("div",{className:"overflow-y-auto",children:Te.jsx(Da,{})})]})}),"warnings"===n&&Te.jsx("div",{className:"fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:Te.jsxs(Gt,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[Te.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[Te.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Warnings Overview"}),Te.jsx(Qt,{variant:"ghost",size:"sm",onClick:()=>o(null),children:"√ó"})]}),Te.jsx("div",{className:"overflow-y-auto p-4",children:Te.jsx($a,{userRole:"business-owner",variant:"executive"})})]})})]})});Ta.displayName="BusinessOwnerDashboardSection";export{Ut as A,He as B,Je as C,Ye as D,Da as E,Ca as F,Vt as G,Ta as H,Ge as I,ra as J,Rt as K,Pe as L,Ot as M,It as N,pt as O,xt as P,aa as Q,st as R,mt as S,Gt as T,yt as U,lt as V,Ue as W,Ze as X,ut as Y,ta as Z,Aa as _,ft as a,ot as b,_e as c,Fe as d,ht as e,ea as f,ct as g,Qt as h,Jt as i,Te as j,Yt as k,Zt as l,Kt as m,Bt as n,Xt as o,Ea as p,wt as q,Nt as r,Le as s,Me as t,it as u,nt as v,Ke as w,Be as x,Ct as y,vt as z};
