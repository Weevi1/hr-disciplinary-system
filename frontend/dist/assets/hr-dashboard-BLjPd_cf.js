const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PDFGenerationService-CdmFA2Eb.js","assets/pdf-vendor-tUwojRr6.js","assets/business-owner-dashboard-SKPFtfOP.js","assets/react-vendor-CWjEGAcE.js","assets/firebase-vendor-BQc9GSQK.js","assets/ui-vendor-CbYg3h9k.js"])))=>i.map(i=>d[i]);
import{u as e,a as t,L as s,d as a,D as r,b as n,s as i,c as l,j as o,Z as c,T as d,e as m,f as x,g as u,h as g,A as h,i as p,U as y,k as f,l as v,m as b,E as j,n as N}from"./business-owner-dashboard-SKPFtfOP.js";import{r as w,R as k,b as D,u as C}from"./react-vendor-CWjEGAcE.js";import{q as S,l as T,t as E,C as I,E as P,G as R,H as A,x as L,p as F,L as M,I as _,_ as U,J as O,K as z,M as W,N as $,O as B,P as q,Q as H,R as V,S as G}from"./firebase-vendor-BQc9GSQK.js";import{WarningsReviewDashboard as Q}from"./warning-components-CctW0ZFw.js";import{a as K}from"./pdf-vendor-tUwojRr6.js";import{Q as Y,X as J,D as X,b as Z,R as ee,V as te,Y as se,a as ae,Z as re,i as ne,N as ie,L as le,F as oe,_ as ce,$ as de,a0 as me,w as xe,a1 as ue,e as ge,z as he,a2 as pe,M as ye,U as fe,a3 as ve,a4 as be,x as je,a5 as Ne,a6 as we,a7 as ke,a8 as De,a9 as Ce,aa as Se,ab as Te,I as Ee,f as Ie,J as Pe,ac as Re,ad as Ae,l as Le,ae as Fe,af as Me,C as _e,q as Ue,k as Oe,ag as ze,ah as We,ai as $e,aj as Be,ak as qe,o as He,K as Ve}from"./ui-vendor-CbYg3h9k.js";const Ge=e=>{if(!e)return s.warn("⚠️ Null timestamp provided to convertFirestoreTimestamp, using current date"),new Date;if(void 0!==e.seconds)return new Date(1e3*e.seconds);if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return t}return s.warn("⚠️ Invalid timestamp format, using current date:",e),new Date},Qe=(e,t,a)=>{if(!e)throw new Error("Cannot transform null warning data for PDF");if(!a)throw new Error("Cannot transform warning data without organization data");const r=(n=t)?n.profile||n.employment?{firstName:n.profile?.firstName||n.firstName||"Unknown",lastName:n.profile?.lastName||n.lastName||"Employee",employeeNumber:n.employment?.employeeNumber||n.employeeNumber||n.id||"N/A",department:n.employment?.department||n.profile?.department||n.department||"Unknown",position:n.employment?.position||n.position||"Unknown",email:n.profile?.email||n.email||"",phone:n.profile?.phoneNumber||n.profile?.phone||n.phone||""}:{firstName:n.firstName||"Unknown",lastName:n.lastName||"Employee",employeeNumber:n.employeeNumber||n.employeeId||n.id||"N/A",department:n.department||"Unknown",position:n.position||"Unknown",email:n.email||"",phone:n.phone||n.phoneNumber||""}:(s.warn("⚠️ Null employee provided to flattenEmployeeData"),{firstName:"Unknown",lastName:"Employee",employeeNumber:"N/A",department:"Unknown",position:"Unknown"});var n;const i=Ge(e.issueDate||e.issuedDate||e.createdAt),l=Ge(e.incidentDate||e.issueDate||e.createdAt),o={warningId:e.id||e.warningId||`WRN_${Date.now()}`,organizationId:e.organizationId||a.id,status:e.status||"issued",issuedByName:e.issuedByName||"",issuedDate:i,incidentDate:l,employee:r,warningLevel:e.level||e.warningLevel||"counselling",category:e.category||e.categoryName||"General Misconduct",description:e.description||e.incidentDescription||"",incidentTime:e.incidentTime||"09:00",incidentLocation:e.incidentLocation||"",organization:a,signatures:e.signatures||{},additionalNotes:e.additionalNotes||"",validityPeriod:e.validityPeriod||6,disciplineRecommendation:e.disciplineRecommendation||e.lraRecommendation,legalCompliance:e.legalCompliance,deliveryChoice:e.deliveryChoice,appealDetails:e.appealDetails,appealOutcome:e.appealOutcome,appealDecisionDate:e.appealDecisionDate?Ge(e.appealDecisionDate):void 0,appealReasoning:e.appealReasoning,hrNotes:e.hrNotes,followUpRequired:e.followUpRequired,followUpDate:e.followUpDate?Ge(e.followUpDate):void 0};return o.warningId,o.employee.firstName,o.employee.lastName,o.issuedByName,o.issuedDate.toISOString(),o.incidentDate.toISOString(),o.warningLevel,o};class Ke{static{this.EXPIRY_HOURS=1}static async generateTemporaryLink(e){e.filename,e.pdfBlob.size,e.employeeId,e.warningId,e.organizationId;try{const t=n.currentUser;if(!t)throw s.error("❌ [TemporaryLinkService] User not authenticated"),new Error("User not authenticated");s.success(2228);const a=this.generateTokenId(),r=Date.now(),l=Math.random().toString(36).substr(2,12),o=e.filename.replace(/[^a-zA-Z0-9.-]/g,"_"),c=`temp-downloads/${e.organizationId||"default"}/${r}_${l}_${o}`,d=P(i,c),m={contentType:"application/pdf",customMetadata:{organizationId:e.organizationId||"",employeeId:e.employeeId||"",warningId:e.warningId||"",filename:e.filename,tokenId:a,createdAt:(new Date).toISOString(),size:e.pdfBlob.size.toString(),uploadedBy:t.uid,purpose:"temporary-download"}};await R(d,e.pdfBlob,m);const x=await A(d),u=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);await this.trackTemporaryFile({tokenId:a,storagePath:c,downloadUrl:x,filename:e.filename,organizationId:e.organizationId,employeeId:e.employeeId,warningId:e.warningId,uploadedBy:t.uid,expiresAt:u,createdAt:new Date}),s.success(4558);const g=await this.generateQRCode(x),h=new Date(Date.now()+60*this.EXPIRY_HOURS*60*1e3);return h.toISOString(),x.substring(0,60),{downloadUrl:x,qrCodeData:g,expiresAt:h.toISOString(),tokenId:a,filename:e.filename}}catch(t){throw s.error("❌ [TemporaryLinkService] Failed to generate temporary link:",t),new Error(`Failed to generate temporary link: ${t instanceof Error?t.message:"Unknown error"}`)}}static async validateTemporaryToken(e){return!0}static async revokeTemporaryToken(e){return!0}static generateTokenId(){return`tmp_${Date.now()}_${Math.random().toString(36).substr(2,12)}`}static async blobToBase64(e){return new Promise((t,s)=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(e.split(",")[1])},a.onerror=s,a.readAsDataURL(e)})}static async generateQRCode(e){try{const t=`${"https://api.qrserver.com/v1/create-qr-code/"}?${new URLSearchParams({size:"300x300",data:e,format:"png",ecc:"M",margin:"10"}).toString()}`,s=await fetch(t);if(!s.ok)throw new Error("QR code generation failed");const a=await s.blob();return new Promise((e,t)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=t,s.readAsDataURL(a)})}catch(t){return s.error("❌ QR Code generation failed:",t),`data:text/plain;base64,${btoa(e)}`}}static formatExpiryTime(e){const t=new Date(e),s=new Date,a=t.getTime()-s.getTime();if(a<=0)return"Expired";const r=Math.floor(a/6e4),n=Math.floor(r/60),i=r%60;return n>0?`${n}h ${i}m remaining`:`${i}m remaining`}static isExpired(e){return new Date(e).getTime()<=Date.now()}static async trackTemporaryFile(e){try{await L(T(a,"temporaryFiles"),{tokenId:e.tokenId,storagePath:e.storagePath,downloadUrl:e.downloadUrl,filename:e.filename,fileType:"pdf",organizationId:e.organizationId||"",employeeId:e.employeeId||"",warningId:e.warningId||"",uploadedBy:e.uploadedBy,expiresAt:e.expiresAt,createdAt:F(),isExpired:!1,fileSize:0}),s.success(10578)}catch(t){s.error("❌ [TemporaryLinkService] Failed to track temporary file:",t)}}}const Ye=({isOpen:e,onClose:t,pdfBlob:a,filename:r,employeeId:n,warningId:i,organizationId:u,employeeName:g,onLinkGenerated:h})=>{l(e);const[p,y]=w.useState(!1),[f,v]=w.useState(null),[b,j]=w.useState(null),[N,D]=w.useState({hours:0,minutes:0,seconds:0,expired:!1}),[C,S]=w.useState(!1),T=k.useRef(!1),E=w.useCallback(async()=>{if(a&&(a.size/1024).toFixed(1),a)try{y(!0),j(null);const e=await Ke.generateTemporaryLink({pdfBlob:a,filename:r,employeeId:n,warningId:i,organizationId:u});s.success(2764),v(e),h?.(e)}catch(e){s.error("❌ QR link generation failed:",e),j(e.message||"Failed to generate QR code")}finally{y(!1)}else s.error("❌ [QRCodeDownloadModal] No PDF blob provided")},[a,r,n,i,u,h]);w.useEffect(()=>{if(!f?.expiresAt)return;const e=()=>{const e=(new Date).getTime(),t=new Date(f.expiresAt).getTime()-e;if(t<=0)return void D({hours:0,minutes:0,seconds:0,expired:!0});const s=Math.floor(t/36e5),a=Math.floor(t%36e5/6e4),r=Math.floor(t%6e4/1e3);D({hours:s,minutes:a,seconds:r,expired:!1})};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[f?.expiresAt]);const I=w.useCallback(async()=>{if(f?.downloadUrl)try{await navigator.clipboard.writeText(f.downloadUrl),S(!0),setTimeout(()=>S(!1),2e3)}catch(e){s.error("❌ Failed to copy link:",e)}},[f?.downloadUrl]);return w.useEffect(()=>{!e||!a||f||p||T.current||(T.current=!0,E())},[e,a,f,p,E]),w.useEffect(()=>{e||(v(null),j(null),D({hours:0,minutes:0,seconds:0,expired:!1}),S(!1),T.current=!1)},[e]),e?o.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:c.modalNested1},children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"bg-white border-b px-6 py-4 flex items-center justify-between flex-shrink-0",style:{borderColor:"var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"var(--color-primary-light)"},children:o.jsx(Y,{className:"w-5 h-5",style:{color:"var(--color-primary)"}})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Mobile Download"}),o.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Scan to download on your phone"})]})]}),o.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[o.jsx(d,{padding:"md",className:"border",style:{borderColor:"var(--color-border)"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-success-light)"},children:o.jsx(X,{className:"w-5 h-5",style:{color:"var(--color-success)"}})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h4",{className:"font-medium text-sm truncate",style:{color:"var(--color-text)"},children:r}),g&&o.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["For: ",g]}),o.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:["Size: ",(a.size/1024).toFixed(1)," KB"]})]})]})}),p&&o.jsxs("div",{className:"text-center py-12",children:[o.jsx("div",{className:"animate-spin rounded-full h-12 w-12 mx-auto mb-4",style:{borderWidth:"2px",borderColor:"transparent",borderTopColor:"var(--color-primary)"}}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text)"},children:"Generating secure download link..."}),o.jsx("p",{className:"text-xs mt-2",style:{color:"var(--color-text-secondary)"},children:"This may take a moment"})]}),b&&o.jsxs(m,{variant:"error",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Z,{className:"w-5 h-5 flex-shrink-0"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-medium text-sm",children:"Generation Failed"}),o.jsx("p",{className:"text-xs mt-1",children:b})]})]}),o.jsx(x,{variant:"danger",size:"sm",onClick:E,disabled:p,className:"mt-3",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ee,{className:"w-4 h-4"}),o.jsx("span",{children:"Try Again"})]})})]}),f&&!N.expired&&o.jsxs("div",{className:"space-y-4",children:[o.jsx(m,{variant:"warning",className:"border-l-4",style:{borderLeftColor:"var(--color-warning)"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(te,{className:"w-5 h-5"}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-sm",children:"Time-Limited Access"}),o.jsxs("p",{className:"text-xs mt-1",children:["Link expires in: ",N.hours>0&&`${N.hours}h `,N.minutes,"m ",N.seconds,"s"]})]})]})}),o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"bg-white p-6 rounded-lg border-2 inline-block",style:{borderColor:"var(--color-border)"},children:o.jsx("img",{src:f.qrCodeData,alt:"Download QR Code",className:"w-64 h-64 mx-auto",style:{imageRendering:"pixelated"}})}),o.jsxs("div",{className:"mt-4",children:[o.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",style:{color:"var(--color-text)"},children:[o.jsx(se,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm",children:"Point your camera at the QR code"})]}),o.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"No app needed - works with built-in camera on iOS & Android"})]})]}),o.jsx("div",{className:"space-y-3",children:o.jsx(x,{variant:C?"success":"secondary",size:"md",fullWidth:!0,onClick:I,children:o.jsx("div",{className:"flex items-center justify-center gap-2",children:C?o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-5 h-5"}),o.jsx("span",{children:"Link Copied!"})]}):o.jsxs(o.Fragment,{children:[o.jsx(re,{className:"w-5 h-5"}),o.jsx("span",{children:"Copy Download Link"})]})})})}),o.jsx(m,{variant:"info",className:"border-l-4",style:{borderLeftColor:"var(--color-info)"},children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(ne,{className:"w-5 h-5 flex-shrink-0"}),o.jsxs("div",{children:[o.jsx("h4",{className:"font-medium text-sm",children:"Security Features"}),o.jsxs("ul",{className:"text-xs mt-1 space-y-1",children:[o.jsx("li",{children:"• Link expires automatically in 1 hour"}),o.jsx("li",{children:"• Single-use download link"}),o.jsx("li",{children:"• Encrypted token authentication"}),o.jsx("li",{children:"• No app needed - works with any camera"})]})]})]})})]}),f&&N.expired&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx("div",{className:"w-16 h-16 rounded-full mx-auto mb-4 flex items-center justify-center",style:{backgroundColor:"var(--color-error-light)"},children:o.jsx(ie,{className:"w-8 h-8",style:{color:"var(--color-error)"}})}),o.jsx("h4",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text)"},children:"Link Expired"}),o.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"The download link has expired for security reasons."}),o.jsx(x,{variant:"primary",size:"md",onClick:E,disabled:p,children:"Generate New Link"})]})]})]})}):null};var Je,Xe,Ze=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},et=function(e){if("loading"===document.readyState)return"loading";var t=Ze();if(t){if(e<t.domInteractive)return"loading";if(0===t.domContentLoadedEventStart||e<t.domContentLoadedEventStart)return"dom-interactive";if(0===t.domComplete||e<t.domComplete)return"dom-content-loaded"}return"complete"},tt=function(e){var t=e.nodeName;return 1===e.nodeType?t.toLowerCase():t.toUpperCase().replace(/^#/,"")},st=function(e,t){var s="";try{for(;e&&9!==e.nodeType;){var a=e,r=a.id?"#"+a.id:tt(a)+(a.classList&&a.classList.value&&a.classList.value.trim()&&a.classList.value.trim().length?"."+a.classList.value.trim().replace(/\s+/g,"."):"");if(s.length+r.length>(t||100)-1)return s||r;if(s=s?r+">"+s:r,a.id)break;e=a.parentNode}}catch(e){}return s},at=-1,rt=function(e){addEventListener("pageshow",function(t){t.persisted&&(at=t.timeStamp,e(t))},!0)},nt=function(){var e=Ze();return e&&e.activationStart||0},it=function(e,t){var s=Ze(),a="navigate";return at>=0?a="back-forward-cache":s&&(document.prerendering||nt()>0?a="prerender":document.wasDiscarded?a="restore":s.type&&(a=s.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:a}},lt=function(e,t,s){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var a=new PerformanceObserver(function(e){Promise.resolve().then(function(){t(e.getEntries())})});return a.observe(Object.assign({type:e,buffered:!0},s||{})),a}}catch(e){}},ot=function(e,t,s,a){var r,n;return function(i){t.value>=0&&(i||a)&&((n=t.value-(r||0))||void 0===r)&&(r=t.value,t.delta=n,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,s),e(t))}},ct=function(e){requestAnimationFrame(function(){return requestAnimationFrame(function(){return e()})})},dt=function(e){document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&e()})},mt=function(e){var t=!1;return function(){t||(e(),t=!0)}},xt=-1,ut=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},gt=function(e){"hidden"===document.visibilityState&&xt>-1&&(xt="visibilitychange"===e.type?e.timeStamp:0,pt())},ht=function(){addEventListener("visibilitychange",gt,!0),addEventListener("prerenderingchange",gt,!0)},pt=function(){removeEventListener("visibilitychange",gt,!0),removeEventListener("prerenderingchange",gt,!0)},yt=function(){return xt<0&&(xt=ut(),ht(),rt(function(){setTimeout(function(){xt=ut(),ht()},0)})),{get firstHiddenTime(){return xt}}},ft=function(e){document.prerendering?addEventListener("prerenderingchange",function(){return e()},!0):e()},vt=[1800,3e3],bt=[.1,.25],jt=function(e,t){!function(e,t){t=t||{},function(e,t){t=t||{},ft(function(){var s,a=yt(),r=it("FCP"),n=lt("paint",function(e){e.forEach(function(e){"first-contentful-paint"===e.name&&(n.disconnect(),e.startTime<a.firstHiddenTime&&(r.value=Math.max(e.startTime-nt(),0),r.entries.push(e),s(!0)))})});n&&(s=ot(e,r,vt,t.reportAllChanges),rt(function(a){r=it("FCP"),s=ot(e,r,vt,t.reportAllChanges),ct(function(){r.value=performance.now()-a.timeStamp,s(!0)})}))})}(mt(function(){var s,a=it("CLS",0),r=0,n=[],i=function(e){e.forEach(function(e){if(!e.hadRecentInput){var t=n[0],s=n[n.length-1];r&&e.startTime-s.startTime<1e3&&e.startTime-t.startTime<5e3?(r+=e.value,n.push(e)):(r=e.value,n=[e])}}),r>a.value&&(a.value=r,a.entries=n,s())},l=lt("layout-shift",i);l&&(s=ot(e,a,bt,t.reportAllChanges),dt(function(){i(l.takeRecords()),s(!0)}),rt(function(){r=0,a=it("CLS",0),s=ot(e,a,bt,t.reportAllChanges),ct(function(){return s()})}),setTimeout(s,0))}))}(function(t){var s=function(e){var t,s={};if(e.entries.length){var a=e.entries.reduce(function(e,t){return e&&e.value>t.value?e:t});if(a&&a.sources&&a.sources.length){var r=(t=a.sources).find(function(e){return e.node&&1===e.node.nodeType})||t[0];r&&(s={largestShiftTarget:st(r.node),largestShiftTime:a.startTime,largestShiftValue:a.value,largestShiftSource:r,largestShiftEntry:a,loadState:et(a.startTime)})}}return Object.assign(e,{attribution:s})}(t);e(s)},t)},Nt=0,wt=1/0,kt=0,Dt=function(e){e.forEach(function(e){e.interactionId&&(wt=Math.min(wt,e.interactionId),kt=Math.max(kt,e.interactionId),Nt=kt?(kt-wt)/7+1:0)})},Ct=function(){return Je?Nt:performance.interactionCount||0},St=function(){"interactionCount"in performance||Je||(Je=lt("event",Dt,{type:"event",buffered:!0,durationThreshold:0}))},Tt=[],Et=new Map,It=0,Pt=[],Rt=function(e){if(Pt.forEach(function(t){return t(e)}),e.interactionId||"first-input"===e.entryType){var t=Tt[Tt.length-1],s=Et.get(e.interactionId);if(s||Tt.length<10||e.duration>t.latency){if(s)e.duration>s.latency?(s.entries=[e],s.latency=e.duration):e.duration===s.latency&&e.startTime===s.entries[0].startTime&&s.entries.push(e);else{var a={id:e.interactionId,latency:e.duration,entries:[e]};Et.set(a.id,a),Tt.push(a)}Tt.sort(function(e,t){return t.latency-e.latency}),Tt.length>10&&Tt.splice(10).forEach(function(e){return Et.delete(e.id)})}}},At=function(e){var t=self.requestIdleCallback||self.setTimeout,s=-1;return e=mt(e),"hidden"===document.visibilityState?e():(s=t(e),dt(e)),s},Lt=[200,500],Ft=function(e,t){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(t=t||{},ft(function(){var s;St();var a,r=it("INP"),n=function(e){At(function(){e.forEach(Rt);var t=function(){var e=Math.min(Tt.length-1,Math.floor((Ct()-It)/50));return Tt[e]}();t&&t.latency!==r.value&&(r.value=t.latency,r.entries=t.entries,a())})},i=lt("event",n,{durationThreshold:null!==(s=t.durationThreshold)&&void 0!==s?s:40});a=ot(e,r,Lt,t.reportAllChanges),i&&(i.observe({type:"first-input",buffered:!0}),dt(function(){n(i.takeRecords()),a(!0)}),rt(function(){It=Ct(),Tt.length=0,Et.clear(),r=it("INP"),a=ot(e,r,Lt,t.reportAllChanges)}))}))},Mt=[],_t=[],Ut=0,Ot=new WeakMap,zt=new Map,Wt=-1,$t=function(e){Mt=Mt.concat(e),Bt()},Bt=function(){Wt<0&&(Wt=At(qt))},qt=function(){zt.size>10&&zt.forEach(function(e,t){Et.has(t)||zt.delete(t)});var e=Tt.map(function(e){return Ot.get(e.entries[0])}),t=_t.length-50;_t=_t.filter(function(s,a){return a>=t||e.includes(s)});for(var s=new Set,a=0;a<_t.length;a++){var r=_t[a];Ht(r.startTime,r.processingEnd).forEach(function(e){s.add(e)})}var n=Mt.length-1-50;Mt=Mt.filter(function(e,t){return e.startTime>Ut&&t>n||s.has(e)}),Wt=-1};Pt.push(function(e){e.interactionId&&e.target&&!zt.has(e.interactionId)&&zt.set(e.interactionId,e.target)},function(e){var t,s=e.startTime+e.duration;Ut=Math.max(Ut,e.processingEnd);for(var a=_t.length-1;a>=0;a--){var r=_t[a];if(Math.abs(s-r.renderTime)<=8){(t=r).startTime=Math.min(e.startTime,t.startTime),t.processingStart=Math.min(e.processingStart,t.processingStart),t.processingEnd=Math.max(e.processingEnd,t.processingEnd),t.entries.push(e);break}}t||(t={startTime:e.startTime,processingStart:e.processingStart,processingEnd:e.processingEnd,renderTime:s,entries:[e]},_t.push(t)),(e.interactionId||"first-input"===e.entryType)&&Ot.set(e,t),Bt()});var Ht=function(e,t){for(var s,a=[],r=0;s=Mt[r];r++)if(!(s.startTime+s.duration<e)){if(s.startTime>t)break;a.push(s)}return a},Vt=function(e,t){Xe||(Xe=lt("long-animation-frame",$t)),Ft(function(t){var s=function(e){var t=e.entries[0],s=Ot.get(t),a=t.processingStart,r=s.processingEnd,n=s.entries.sort(function(e,t){return e.processingStart-t.processingStart}),i=Ht(t.startTime,r),l=e.entries.find(function(e){return e.target}),o=l&&l.target||zt.get(t.interactionId),c=[t.startTime+t.duration,r].concat(i.map(function(e){return e.startTime+e.duration})),d=Math.max.apply(Math,c),m={interactionTarget:st(o),interactionTargetElement:o,interactionType:t.name.startsWith("key")?"keyboard":"pointer",interactionTime:t.startTime,nextPaintTime:d,processedEventEntries:n,longAnimationFrameEntries:i,inputDelay:a-t.startTime,processingDuration:r-a,presentationDelay:Math.max(d-r,0),loadState:et(t.startTime)};return Object.assign(e,{attribution:m})}(t);e(s)},t)},Gt=[2500,4e3],Qt={},Kt=function(e,t){!function(e,t){t=t||{},ft(function(){var s,a=yt(),r=it("LCP"),n=function(e){t.reportAllChanges||(e=e.slice(-1)),e.forEach(function(e){e.startTime<a.firstHiddenTime&&(r.value=Math.max(e.startTime-nt(),0),r.entries=[e],s())})},i=lt("largest-contentful-paint",n);if(i){s=ot(e,r,Gt,t.reportAllChanges);var l=mt(function(){Qt[r.id]||(n(i.takeRecords()),i.disconnect(),Qt[r.id]=!0,s(!0))});["keydown","click"].forEach(function(e){addEventListener(e,function(){return At(l)},{once:!0,capture:!0})}),dt(l),rt(function(a){r=it("LCP"),s=ot(e,r,Gt,t.reportAllChanges),ct(function(){r.value=performance.now()-a.timeStamp,Qt[r.id]=!0,s(!0)})})}})}(function(t){var s=function(e){var t={timeToFirstByte:0,resourceLoadDelay:0,resourceLoadDuration:0,elementRenderDelay:e.value};if(e.entries.length){var s=Ze();if(s){var a=s.activationStart||0,r=e.entries[e.entries.length-1],n=r.url&&performance.getEntriesByType("resource").filter(function(e){return e.name===r.url})[0],i=Math.max(0,s.responseStart-a),l=Math.max(i,n?(n.requestStart||n.startTime)-a:0),o=Math.max(l,n?n.responseEnd-a:0),c=Math.max(o,r.startTime-a);t={element:st(r.element),timeToFirstByte:i,resourceLoadDelay:l-i,resourceLoadDuration:o-l,elementRenderDelay:c-o,navigationEntry:s,lcpEntry:r},r.url&&(t.url=r.url),n&&(t.lcpResourceEntry=n)}}return Object.assign(e,{attribution:t})}(t);e(s)},t)};const Yt="@firebase/performance",Jt="0.7.7",Xt=Jt,Zt="FB-PERF-TRACE-MEASURE",es="_wt_",ts="_fcp",ss="_fid",as="_lcp",rs="_inp",ns="_cls",is="@firebase/performance/config",ls="@firebase/performance/configexpire",os="Performance",cs=new W("performance",os,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),ds=new M(os);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let ms,xs,us,gs;ds.logLevel=_.INFO;class hs{constructor(e){if(this.window=e,!e)throw cs.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay),this.onLCP=Kt,this.onINP=Vt,this.onCLS=jt}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,s){this.performance&&this.performance.measure&&this.performance.measure(e,t,s)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&B()?!!q()||(ds.info("IndexedDB is not supported by current browser"),!1):(ds.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(e=>{for(const s of e.getEntries())t(s)}).observe({entryTypes:[e]})}static getInstance(){return void 0===ms&&(ms=new hs(xs)),ms}}function ps(){return us}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ys(e,t){const s=e.length-t.length;if(s<0||s>1)throw cs.create("invalid String merger input");const a=[];for(let r=0;r<e.length;r++)a.push(e.charAt(r)),t.length>r&&a.push(t.charAt(r));return a.join("")}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fs{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=ys("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=ys("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===gs&&(gs=new fs),gs}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vs;!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(vs||(vs={}));const bs=["firebase_","google_","ga_"],js=new RegExp("^[a-zA-Z]\\w*$");function Ns(){const e=hs.getInstance().navigator;return(null==e?void 0:e.serviceWorker)?e.serviceWorker.controller?2:3:1}function ws(){switch(hs.getInstance().document.visibilityState){case"visible":return vs.VISIBLE;case"hidden":return vs.HIDDEN;default:return vs.UNKNOWN}}function ks(){const e=hs.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ds(e){var t;const s=null===(t=e.options)||void 0===t?void 0:t.appId;if(!s)throw cs.create("no app id");return s}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Cs="0.0.1",Ss={loggingEnabled:!0},Ts="FIREBASE_INSTALLATIONS_AUTH";function Es(e,t){const s=function(){const e=hs.getInstance().localStorage;if(!e)return;const t=e.getItem(ls);if(!(t&&(s=t,Number(s)>Date.now())))return;var s;const a=e.getItem(is);if(!a)return;try{return JSON.parse(a)}catch(r){return}}();return s?(Ps(s),Promise.resolve()):function(e,t){return function(e){const t=e.getToken();return t.then(e=>{}),t}(e.installations).then(s=>{const a=function(e){var t;const s=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!s)throw cs.create("no project id");return s}(e.app),r=function(e){var t;const s=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!s)throw cs.create("no api key");return s}(e.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${a}/namespaces/fireperf:fetch?key=${r}`,{method:"POST",headers:{Authorization:`${Ts} ${s}`},body:JSON.stringify({app_instance_id:t,app_instance_id_token:s,app_id:Ds(e.app),app_version:Xt,sdk_version:Cs})});return fetch(n).then(e=>{if(e.ok)return e.json();throw cs.create("RC response not ok")})}).catch(()=>{ds.info(Is)})}(e,t).then(Ps).then(e=>function(e){const t=hs.getInstance().localStorage;if(!e||!t)return;t.setItem(is,JSON.stringify(e)),t.setItem(ls,String(Date.now()+60*fs.getInstance().configTimeToLive*60*1e3))}(e),()=>{})}const Is="Could not fetch config, will use default configs";function Ps(e){if(!e)return e;const t=fs.getInstance(),s=e.entries||{};return void 0!==s.fpr_enabled?t.loggingEnabled="true"===String(s.fpr_enabled):t.loggingEnabled=Ss.loggingEnabled,s.fpr_log_source?t.logSource=Number(s.fpr_log_source):Ss.logSource&&(t.logSource=Ss.logSource),s.fpr_log_endpoint_url?t.logEndPointUrl=s.fpr_log_endpoint_url:Ss.logEndPointUrl&&(t.logEndPointUrl=Ss.logEndPointUrl),s.fpr_log_transport_key?t.transportKey=s.fpr_log_transport_key:Ss.transportKey&&(t.transportKey=Ss.transportKey),void 0!==s.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(s.fpr_vc_network_request_sampling_rate):void 0!==Ss.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=Ss.networkRequestsSamplingRate),void 0!==s.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(s.fpr_vc_trace_sampling_rate):void 0!==Ss.tracesSamplingRate&&(t.tracesSamplingRate=Ss.tracesSamplingRate),t.logTraceAfterSampling=Rs(t.tracesSamplingRate),t.logNetworkAfterSampling=Rs(t.networkRequestsSamplingRate),e}function Rs(e){return Math.random()<=e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let As,Ls=1;function Fs(e){return Ls=2,As=As||function(e){return function(){const e=hs.getInstance().document;return new Promise(t=>{if(e&&"complete"!==e.readyState){const s=()=>{"complete"===e.readyState&&(e.removeEventListener("readystatechange",s),t())};e.addEventListener("readystatechange",s)}else t()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{us=e}),t}(e.installations)).then(t=>Es(e,t)).then(()=>Ms(),()=>Ms())}(e),As}function Ms(){Ls=3}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _s,Us=3,Os=[],zs=!1;function Ws(e){setTimeout(()=>{Us<=0||(Os.length>0&&$s(),Ws(1e4))},e)}function $s(){const e=Os.splice(0,1e3),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)}));(function(e){const t=fs.getInstance().getFlTransportFullUrl(),s=JSON.stringify(e);return navigator.sendBeacon&&navigator.sendBeacon(t,s)?Promise.resolve():fetch(t,{method:"POST",body:s,keepalive:!0}).then()})({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:fs.getInstance().logSource,log_event:t}).then(()=>{Us=3}).catch(()=>{Os=[...e,...Os],Us--,ds.info(`Tries left: ${Us}.`),Ws(1e4)})}function Bs(e){return(...t)=>{!function(e){if(!e.eventTime||!e.message)throw cs.create("invalid cc log");Os=[...Os,e]}({message:e(...t),eventTime:Date.now()})}}function qs(){for(;Os.length>0;)$s()}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hs(e,t){_s||(_s={send:Bs(Qs),flush:qs}),_s.send(e,t)}function Vs(e){const t=fs.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&hs.getInstance().requiredApisAvailable()&&(3===Ls?Gs(e):Fs(e.performanceController).then(()=>Gs(e),()=>Gs(e)))}function Gs(e){if(!ps())return;const t=fs.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&Hs(e,1)}function Qs(e,t){return 0===t?function(e){const t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},s={application_info:Ks(e.performanceController.app),network_request_metric:t};return JSON.stringify(s)}(e):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);const s=e.getAttributes();0!==Object.keys(s).length&&(t.custom_attributes=s);const a={application_info:Ks(e.performanceController.app),trace_metric:t};return JSON.stringify(a)}(e)}function Ks(e){return{google_app_id:Ds(e),app_instance_id:ps(),web_app_info:{sdk_version:Xt,page_url:hs.getInstance().getUrl(),service_worker_status:Ns(),visibility_state:ws(),effective_connection_type:ks()},application_process_state:0}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ys(e,t){const s=t;if(!s||void 0===s.responseStart)return;const a=hs.getInstance().getTimeOrigin(),r=Math.floor(1e3*(s.startTime+a)),n=s.responseStart?Math.floor(1e3*(s.responseStart-s.startTime)):void 0,i=Math.floor(1e3*(s.responseEnd-s.startTime));!function(e){const t=fs.getInstance();if(!t.instrumentationEnabled)return;const s=e.url,a=t.logEndPointUrl.split("?")[0],r=t.flTransportEndpointUrl.split("?")[0];s!==a&&s!==r&&t.loggingEnabled&&t.logNetworkAfterSampling&&Hs(e,0)}({performanceController:e,url:s.name&&s.name.split("?")[0],responsePayloadBytes:s.transferSize,startTimeUs:r,timeToResponseInitiatedUs:n,timeToResponseCompletedUs:i})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Js=["_fp",ts,ss,as,ns,rs];
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Xs{constructor(e,t,s=!1,a){this.performanceController=e,this.name=t,this.isAuto=s,this.state=1,this.customAttributes={},this.counters={},this.api=hs.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=a||`${Zt}-${this.randomId}-${this.name}`,a&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw cs.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw cs.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Vs(this)}record(e,t,s){if(e<=0)throw cs.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw cs.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),s&&s.attributes&&(this.customAttributes=Object.assign({},s.attributes)),s&&s.metrics)for(const a of Object.keys(s.metrics))isNaN(Number(s.metrics[a]))||(this.counters[a]=Math.floor(Number(s.metrics[a])));Vs(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(!function(e,t){return!(0===e.length||e.length>100)&&(t&&t.startsWith(es)&&Js.indexOf(e)>-1||!e.startsWith("_"))}(e,this.name))throw cs.create("invalid custom metric name",{customMetricName:e});this.counters[e]=function(e){const t=Math.floor(e);return t<e&&ds.info(`Metric value should be an Integer, setting the value as : ${t}.`),t}(null!=t?t:0)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const s=function(e){return!(0===e.length||e.length>40)&&(!bs.some(t=>e.startsWith(t))&&!!e.match(js))}(e),a=function(e){return 0!==e.length&&e.length<=100}(t);if(s&&a)this.customAttributes[e]=t;else{if(!s)throw cs.create("invalid attribute name",{attributeName:e});if(!a)throw cs.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,s,a,r){const n=hs.getInstance().getUrl();if(!n)return;const i=new Xs(e,es+n,!0),l=Math.floor(1e3*hs.getInstance().getTimeOrigin());i.setStartTime(l),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));if(s){const e=s.find(e=>"first-paint"===e.name);e&&e.startTime&&i.putMetric("_fp",Math.floor(1e3*e.startTime));const t=s.find(e=>"first-contentful-paint"===e.name);t&&t.startTime&&i.putMetric(ts,Math.floor(1e3*t.startTime)),r&&i.putMetric(ss,Math.floor(1e3*r))}this.addWebVitalMetric(i,as,"lcp_element",a.lcp),this.addWebVitalMetric(i,ns,"cls_largestShiftTarget",a.cls),this.addWebVitalMetric(i,rs,"inp_interactionTarget",a.inp),Vs(i),_s&&_s.flush()}static addWebVitalMetric(e,t,s,a){a&&(e.putMetric(t,Math.floor(1e3*a.value)),a.elementAttribution&&e.putAttribute(s,a.elementAttribution))}static createUserTimingTrace(e,t){Vs(new Xs(e,t,!1,t))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zs,ea={},ta=!1;function sa(e){ps()&&(setTimeout(()=>function(e){const t=hs.getInstance();"onpagehide"in window?t.document.addEventListener("pagehide",()=>ra(e)):t.document.addEventListener("unload",()=>ra(e));t.document.addEventListener("visibilitychange",()=>{"hidden"===t.document.visibilityState&&ra(e)}),t.onFirstInputDelay&&t.onFirstInputDelay(e=>{Zs=e});t.onLCP(e=>{var t;ea.lcp={value:e.value,elementAttribution:null===(t=e.attribution)||void 0===t?void 0:t.element}}),t.onCLS(e=>{var t;ea.cls={value:e.value,elementAttribution:null===(t=e.attribution)||void 0===t?void 0:t.largestShiftTarget}}),t.onINP(e=>{var t;ea.inp={value:e.value,elementAttribution:null===(t=e.attribution)||void 0===t?void 0:t.interactionTarget}})}(e),0),setTimeout(()=>function(e){const t=hs.getInstance(),s=t.getEntriesByType("resource");for(const a of s)Ys(e,a);t.setupObserver("resource",t=>Ys(e,t))}(e),0),setTimeout(()=>function(e){const t=hs.getInstance(),s=t.getEntriesByType("measure");for(const a of s)aa(e,a);t.setupObserver("measure",t=>aa(e,t))}(e),0))}function aa(e,t){const s=t.name;s.substring(0,21)!==Zt&&Xs.createUserTimingTrace(e,s)}function ra(e){if(!ta){ta=!0;const t=hs.getInstance(),s=t.getEntriesByType("navigation"),a=t.getEntriesByType("paint");setTimeout(()=>{Xs.createOobTrace(e,s,a,ea,Zs)},0)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),hs.getInstance().requiredApisAvailable()?$().then(e=>{e&&(zs||(Ws(5500),zs=!0),Fs(this).then(()=>sa(this),()=>sa(this)),this.initialized=!0)}).catch(e=>{ds.info(`Environment doesn't support IndexedDB: ${e}`)}):ds.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){fs.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return fs.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){fs.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return fs.getInstance().dataCollectionEnabled}}const ia=(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),a=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==s.name)throw cs.create("FB not default");if("undefined"==typeof window)throw cs.create("no window");!function(e){xs=e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(window);const r=new na(s,a);return r._init(t),r};U(new O("performance",ia,"PUBLIC")),z(Yt,Jt),z(Yt,Jt,"esm2017");let la=null,oa=!1;function ca(){try{la=function(e=H()){return e=V(e),G(e,"performance").getImmediate()}(u),oa=!0}catch(e){s.error("❌ [PERFORMANCE] Failed to initialize:",e)}}function da(e){return oa&&la?function(e,t){return e=V(e),new Xs(e,t)}(la,e):{start:()=>{},stop:()=>{},putAttribute:()=>{},putMetric:()=>{},incrementMetric:()=>{},getAttribute:()=>null,getMetric:()=>0}}async function ma(e,t,s){const a=da(e);try{a.start(),s&&Object.entries(s).forEach(([e,t])=>{a.putAttribute(e,t)});const e=await t();return a.stop(),e}catch(r){throw a.putAttribute("error","true"),a.stop(),r}}const xa="generate_warning_pdf",ua=({isOpen:e,onClose:t,warningData:a,deliveryChoice:r,onPDFGenerated:n,showPreview:i=!0,title:d="Warning Document"})=>{const{organization:m}=g();l(e);const[x,u]=w.useState(null),[h,p]=w.useState(null),[y,f]=w.useState(""),[v,b]=w.useState(!1),[j,N]=w.useState(null),[k,D]=w.useState(""),[C,S]=w.useState(!1),[T,E]=w.useState(null),[I,P]=w.useState(!1),[R,A]=w.useState(!1);w.useEffect(()=>{const e=()=>A(window.innerWidth<768);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const L=w.useMemo(()=>{if(!a||!m)return null;const e=a.wizardState||a,t=e.selectedEmployee||a.selectedEmployee||a.employee,n=e.selectedCategory||a.selectedCategory,i=e.formData||a.formData||{},l=e.signatures||a.signatures||{},o=e.lraRecommendation||a.lraRecommendation,c={id:i.id||i.warningId||`WRN_${Date.now()}`,organizationId:e.organizationId||a.organizationId,level:i.level||o?.suggestedLevel||"counselling",category:n?.name||i.category||"General Misconduct",description:i.incidentDescription||i.description||"",incidentDate:i.incidentDate,incidentTime:i.incidentTime||"09:00",incidentLocation:i.incidentLocation||"",issueDate:i.issueDate||i.issuedDate,validityPeriod:i.validityPeriod||6,signatures:l,additionalNotes:i.additionalNotes||"",status:i.status,disciplineRecommendation:o,legalCompliance:{isCompliant:!0,framework:"LRA Section 188",requirements:o?.legalRequirements||[]},deliveryChoice:r?{method:r.method,timestamp:new Date,chosenBy:"Manager",contactDetails:r.contactDetails}:void 0};try{return{...Qe(c,t,m),isComplete:!!(t&&n&&i.incidentDescription)}}catch(d){return s.error("❌ Failed to transform wizard data for PDF:",d),null}},[a,r,m]),F=w.useMemo(()=>{if(!L)return"Warning_Document.pdf";const e=`${L.employee.firstName}_${L.employee.lastName}`,t=(new Date).toISOString().split("T")[0];return`Warning_${(L.category||"Warning").replace(/\s+/g,"_").substring(0,20)}_${e}_${t}.pdf`},[L]),M=w.useCallback(async()=>{if(!L||!m)return void N("Missing required data for PDF generation");if(!(L.description||L.incidentLocation||L.additionalNotes))return void N("Insufficient incident data. Please complete the form first.");b(!0),N(null);const e=["Preparing document...","Applying branding...","Formatting content...","Finalizing PDF..."];try{for(let s=0;s<e.length;s++)D(e[s]),await new Promise(e=>setTimeout(e,400));const{PDFGenerationService:t}=await K(async()=>{const{PDFGenerationService:e}=await import("./PDFGenerationService-CdmFA2Eb.js");return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5])),a=await ma(xa,()=>t.generateWarningPDF(L),{employee:`${L.employee.firstName} ${L.employee.lastName}`,category:L.category});u(a),f(F);const r=URL.createObjectURL(a);p(r),s.success("✅ PDF generated:",{employee:`${L.employee.firstName} ${L.employee.lastName}`,size:`${(a.size/1024).toFixed(1)} KB`}),n&&await n(a,F)}catch(t){s.error("❌ PDF generation failed:",t),N(`Failed to generate PDF: ${t instanceof Error?t.message:"Unknown error"}`)}finally{b(!1),D("")}},[L,m,F,r,n]);w.useCallback(()=>{if(!x||!y)return;const e=URL.createObjectURL(x),t=document.createElement("a");t.href=e,t.download=y,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(e),s.success("📥 PDF downloaded successfully")},[x,y]);const _=w.useCallback(async()=>{if(L&&m){P(!0);try{const{PDFGenerationService:e}=await K(async()=>{const{PDFGenerationService:e}=await import("./PDFGenerationService-CdmFA2Eb.js");return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5])),t=await ma(xa,()=>e.generateWarningPDF(L),{employee:`${L.employee.firstName} ${L.employee.lastName}`,category:L.category});E(t),S(!0),s.success("✅ QR PDF generated successfully")}catch(e){s.error("❌ QR PDF generation failed:",e),N(`Failed to generate QR code: ${e instanceof Error?e.message:"Unknown error"}`)}finally{P(!1)}}else N("Missing required data for QR code generation")},[L,m]),U=w.useCallback(()=>{h&&window.open(h,"_blank")},[h]),O=w.useRef(!1);return w.useEffect(()=>{e&&L&&L.isComplete&&!x&&!v&&!O.current&&(O.current=!0,M()),e||(O.current=!1)},[e,L,x,v,M]),w.useEffect(()=>{e&&window.scrollTo({top:0,behavior:"smooth"})},[e]),w.useEffect(()=>()=>{h&&URL.revokeObjectURL(h)},[h]),e?R?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:c.modal},onClick:t,children:o.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg max-h-[90vh] overflow-hidden flex flex-col",onClick:e=>e.stopPropagation(),children:[o.jsxs("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between flex-shrink-0",children:[o.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:d}),o.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:o.jsx(J,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[j&&o.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded-r-lg",children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(Z,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),o.jsx("p",{className:"text-sm text-red-700 mt-1",children:j})]})]}),o.jsxs("button",{onClick:M,className:"mt-2 text-sm text-red-700 hover:text-red-900 font-medium flex items-center gap-1",children:[o.jsx(ee,{className:"w-4 h-4"}),"Retry"]})]}),v&&o.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(le,{className:"w-6 h-6 text-blue-600 animate-spin"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-blue-800 font-medium",children:"Generating PDF"}),k&&o.jsx("p",{className:"text-blue-600 text-sm",children:k})]})]})}),L&&!L.isComplete&&!v&&o.jsxs("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-semibold text-amber-800 mb-2",children:"Incomplete Warning Data"}),o.jsxs("div",{className:"text-sm text-amber-700 space-y-1",children:[!L.hasEmployee&&o.jsx("p",{children:"• Employee not selected"}),!L.hasCategory&&o.jsx("p",{children:"• Category not selected"}),!L.description&&o.jsx("p",{children:"• Incident description missing"})]}),o.jsx("p",{className:"text-sm text-amber-800 mt-3 font-medium",children:"Please complete the warning wizard before generating the PDF."})]})]}),o.jsx("button",{onClick:t,className:"mt-3 w-full bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors font-medium",children:"Return to Wizard"})]}),x&&!v&&L&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center flex-shrink-0",children:o.jsx(oe,{className:"w-5 h-5 text-green-600"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("h3",{className:"font-semibold text-gray-900 text-base mb-1",children:[L.employee.firstName," ",L.employee.lastName]}),o.jsx("p",{className:"text-sm text-gray-600 mb-2",children:L.category}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[o.jsx(oe,{className:"w-3 h-3"}),o.jsx("span",{className:"truncate",children:y})]}),o.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(x.size/1024).toFixed(1)," KB"]})]}),o.jsx(ae,{className:"w-6 h-6 text-green-600 flex-shrink-0"})]})}),o.jsx("div",{className:"space-y-3",children:o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:_,disabled:I,className:"flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",style:{minHeight:"48px"},children:[I?o.jsx(le,{className:"w-4 h-4 animate-spin"}):o.jsx(Y,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm",children:"QR Code"})]}),o.jsxs("button",{onClick:U,className:"flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium",style:{minHeight:"48px"},children:[o.jsx(ce,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm",children:"Preview"})]})]})})]}),!L&&!v&&o.jsxs("div",{className:"text-center py-8",children:[o.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No Data Available"}),o.jsx("p",{className:"text-gray-500 mb-4",children:"Complete the warning wizard first."}),o.jsx("button",{onClick:t,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Return to Wizard"})]})]})]})}),T&&o.jsx(Ye,{isOpen:C,onClose:()=>{S(!1),E(null)},pdfBlob:T,filename:y,employeeId:L?.employee?.id,warningId:L?.warningId,organizationId:L?.organizationId||m?.id,employeeName:L&&`${L.employee.firstName} ${L.employee.lastName}`.trim(),onLinkGenerated:e=>{}})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",style:{zIndex:c.modal},children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full h-[90vh] overflow-hidden flex",children:[o.jsxs("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[o.jsxs("div",{className:"p-6 border-b border-gray-200",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center",children:o.jsx(de,{className:"w-5 h-5 text-white"})}),o.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:d})]}),L&&o.jsxs("div",{className:"mt-3",children:[o.jsxs("p",{className:"font-medium text-gray-900 text-base",children:[L.employee.firstName," ",L.employee.lastName]}),o.jsx("p",{className:"text-sm text-gray-600",children:L.category})]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[j&&o.jsxs("div",{className:"bg-red-50 border-l-4 border-red-400 p-3 rounded-r-lg",children:[o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(Z,{className:"w-5 h-5 text-red-400 flex-shrink-0"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),o.jsx("p",{className:"text-xs text-red-700 mt-1",children:j})]})]}),o.jsxs("button",{onClick:M,className:"mt-2 text-sm text-red-700 hover:text-red-900 font-medium flex items-center gap-1",children:[o.jsx(ee,{className:"w-4 h-4"}),"Retry"]})]}),v&&o.jsx("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(le,{className:"w-5 h-5 text-blue-600 animate-spin flex-shrink-0 mt-0.5"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-blue-800 font-medium text-sm",children:"Generating PDF"}),k&&o.jsx("p",{className:"text-blue-600 text-xs mt-1",children:k})]})]})}),L&&!L.isComplete&&!v&&o.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-3 rounded-r-lg",children:o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(Z,{className:"w-5 h-5 text-amber-400 flex-shrink-0"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-sm font-semibold text-amber-800 mb-2",children:"Incomplete Data"}),o.jsxs("div",{className:"text-xs text-amber-700 space-y-1",children:[!L.hasEmployee&&o.jsx("p",{children:"• No employee selected"}),!L.hasCategory&&o.jsx("p",{children:"• No category selected"}),!L.description&&o.jsx("p",{children:"• No incident description"})]}),o.jsx("p",{className:"text-xs text-amber-800 mt-2 font-medium",children:"Complete the wizard first."})]})]})}),x&&!v&&o.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(ae,{className:"w-5 h-5 text-green-600"}),o.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:"Ready to Download"})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsx("p",{className:"text-xs text-gray-600 truncate",title:y,children:y}),o.jsxs("p",{className:"text-xs text-gray-500",children:[(x.size/1024).toFixed(1)," KB"]})]})]}),x&&!v&&o.jsx("div",{className:"space-y-3 pt-2",children:o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsx("button",{onClick:_,disabled:I,className:"flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:I?o.jsxs(o.Fragment,{children:[o.jsx(le,{className:"w-4 h-4 animate-spin"}),o.jsx("span",{children:"Generating..."})]}):o.jsxs(o.Fragment,{children:[o.jsx(Y,{className:"w-4 h-4"}),o.jsx("span",{children:"QR Code"})]})}),o.jsxs("button",{onClick:U,className:"flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-300 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[o.jsx(ce,{className:"w-4 h-4"}),o.jsx("span",{children:"Open in New Tab"})]})]})})]}),o.jsx("div",{className:"p-6 border-t border-gray-200",children:o.jsx("button",{onClick:t,className:"w-full px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:"Close"})})]}),o.jsxs("div",{className:"flex-1 bg-gray-50 flex flex-col",children:[o.jsx("div",{className:"p-4 flex justify-end",children:o.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5"})})}),o.jsx("div",{className:"flex-1 p-6 pt-0",children:h&&i?o.jsx("div",{className:"h-full bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:o.jsx("iframe",{src:h,className:"w-full h-full border-0",title:"PDF Preview"})}):v?o.jsx("div",{className:"h-full flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(le,{className:"w-12 h-12 text-blue-600 animate-spin mx-auto mb-4"}),o.jsx("p",{className:"text-gray-600",children:"Generating preview..."})]})}):o.jsx("div",{className:"h-full flex items-center justify-center",children:o.jsxs("div",{className:"text-center",children:[o.jsx(oe,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),o.jsx("p",{className:"text-gray-500",children:"No preview available"})]})})})]})]})}),T&&o.jsx(Ye,{isOpen:C,onClose:()=>{S(!1),E(null)},pdfBlob:T,filename:y,employeeId:L?.employee?.id,warningId:L?.warningId,organizationId:L?.organizationId||m?.id,employeeName:L&&`${L.employee.firstName} ${L.employee.lastName}`.trim(),onLinkGenerated:e=>{}})]}):null},ga=({notification:e,currentStep:t,onStepComplete:a,onDeliveryComplete:r,isProcessing:n})=>{const[i,l]=w.useState(!1),[c,u]=w.useState(!1),[g,h]=w.useState(!1),[p,y]=w.useState(null),[f,v]=w.useState(null),[b,j]=w.useState(!1),[N,k]=w.useState(!1),D=w.useCallback(()=>{const t=e.contactDetails.phone||e.employeePhone||"",s=t.replace(/[^\d]/g,"");return{message:`Hi ${e.employeeName},\n\nI hope this message finds you well. I'm writing to inform you that we need to discuss a ${e.warningLevel.toLowerCase()} regarding ${e.warningCategory.toLowerCase()}.\n\nI've attached the formal warning document for your review. Please read through it carefully and let me know if you have any questions or would like to schedule a meeting to discuss this matter further.\n\nThis is an important workplace matter that requires your immediate attention. Please confirm receipt of this message and the attached document.\n\nThank you for your cooperation.\n\nBest regards,\nHR Department`,phoneNumber:s,formattedPhone:t}},[e])();return o.jsxs("div",{className:"space-y-6",children:[0===t&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-green-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:o.jsx(me,{className:"w-5 h-5 text-green-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Prepare WhatsApp Message"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Copy the pre-written script and download the PDF attachment"})]})]}),o.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(xe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee Phone Number:"})]}),o.jsx("div",{className:"text-lg font-semibold text-gray-900",children:D.formattedPhone||o.jsxs("span",{className:"text-red-500 text-sm",children:[o.jsx(Z,{className:"w-4 h-4 inline mr-1"}),"No phone number on file"]})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"WhatsApp Message Script:"}),o.jsxs("div",{className:"relative",children:[o.jsx("textarea",{value:D.message,readOnly:!0,className:"w-full h-48 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm font-mono resize-none",style:{color:"var(--color-text)"}}),o.jsx(x,{variant:i?"success":"primary",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(D.message),l(!0),setTimeout(()=>l(!1),3e3)}catch(e){s.error("Failed to copy script:",e)}},className:"absolute top-2 right-2",children:i?o.jsxs(o.Fragment,{children:[o.jsx(ue,{className:"w-4 h-4 mr-1"}),"Copied!"]}):o.jsxs(o.Fragment,{children:[o.jsx(re,{className:"w-4 h-4 mr-1"}),"Copy Script"]})})]})]}),o.jsxs("div",{className:"mb-6 space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsxs(x,{variant:"secondary",onClick:()=>{k(!0)},className:"flex items-center gap-2",children:[o.jsx(ge,{className:"w-4 h-4"}),"Preview & Download PDF"]}),c&&o.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[o.jsx(ae,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:"PDF Downloaded"})]})]}),o.jsx("p",{className:"text-xs text-gray-500",children:"Use the preview to download the PDF, then attach it to your WhatsApp message"})]}),o.jsxs("div",{className:"space-y-2 mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm "+(i?"text-green-600":"text-gray-500"),children:[i?o.jsx(ae,{className:"w-4 h-4"}):o.jsx(ie,{className:"w-4 h-4"}),"Script copied to clipboard"]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm "+(c?"text-green-600":"text-gray-500"),children:[c?o.jsx(ae,{className:"w-4 h-4"}):o.jsx(ie,{className:"w-4 h-4"}),"PDF downloaded for attachment"]})]}),o.jsx(x,{variant:"primary",onClick:()=>{i&&c&&a(0)},disabled:!i||!c,className:"w-full",children:i&&c?o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Send Message"]}):o.jsxs(o.Fragment,{children:[o.jsx(ie,{className:"w-4 h-4 mr-2"}),"Complete preparation steps above"]})})]}),1===t&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:o.jsx(ce,{className:"w-5 h-5 text-blue-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Send via WhatsApp"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Open WhatsApp Web and send the message with PDF attachment"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(m,{variant:"info",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("strong",{children:"Instructions:"}),o.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[o.jsx("li",{children:'Click "Open WhatsApp Web" below'}),o.jsx("li",{children:"The message will be pre-filled with the script"}),o.jsx("li",{children:"Attach the downloaded PDF file"}),o.jsx("li",{children:"Send the message"}),o.jsx("li",{children:"Wait for delivery confirmation (double blue ticks)"})]})]})}),o.jsxs(x,{variant:"primary",onClick:()=>{const e=encodeURIComponent(D.message),t=`https://web.whatsapp.com/send?phone=${D.phoneNumber}&text=${e}`;window.open(t,"_blank"),h(!0)},disabled:!D.phoneNumber,size:"lg",className:"w-full",children:[o.jsx(ce,{className:"w-5 h-5 mr-2"}),"Open WhatsApp Web"]}),g&&o.jsxs("div",{className:"mt-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-4",children:[o.jsx(ae,{className:"w-4 h-4"}),"WhatsApp Web opened"]}),o.jsxs(x,{variant:"primary",onClick:()=>{g&&a(1)},className:"w-full",children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"I've sent the message"]})]})]})]}),2===t&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-green-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:o.jsx(he,{className:"w-5 h-5 text-green-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Confirm Delivery"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Upload screenshot proof of successful delivery"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(m,{variant:"info",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("strong",{children:"Screenshot Requirements:"}),o.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[o.jsx("li",{children:"Show the sent message with timestamp"}),o.jsx("li",{children:"Display delivery confirmation (double blue ticks)"}),o.jsx("li",{children:"Include employee's phone number visible"}),o.jsx("li",{children:"Capture PDF attachment in the message"})]})]})}),o.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){y(t);const e=new FileReader;e.onload=e=>{v(e.target?.result)},e.readAsDataURL(t)}},className:"hidden",id:"proof-upload"}),o.jsx("label",{htmlFor:"proof-upload",className:"cursor-pointer",children:f?o.jsxs("div",{className:"space-y-3",children:[o.jsx("img",{src:f,alt:"Delivery proof",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-sm"}),o.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[o.jsx(ae,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:"Screenshot uploaded"})]})]}):o.jsxs("div",{className:"space-y-3",children:[o.jsx(pe,{className:"w-12 h-12 mx-auto text-gray-400"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Upload Screenshot"}),o.jsx("div",{className:"text-sm text-gray-500",children:"Click to select image file"})]})]})})]}),o.jsx(x,{variant:"success",onClick:async()=>{if(p){j(!0);try{await r({warningId:e.warningId,deliveryMethod:"whatsapp",deliveredAt:new Date,proofImage:p,phoneNumber:D.formattedPhone})}catch(t){s.error("Failed to complete delivery:",t)}finally{j(!1)}}},disabled:!p||b,size:"lg",className:"w-full",children:b?o.jsxs(o.Fragment,{children:[o.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Delivery..."]}):o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Complete WhatsApp Delivery"]})})]})]}),N&&o.jsx(ua,{isOpen:N,onClose:()=>k(!1),warningData:{employee:{firstName:e.employeeName.split(" ")[0]||e.employeeName,lastName:e.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:e.warningCategory,level:e.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:()=>{u(!0)}})]})},ha=({notification:e,currentStep:t,onStepComplete:a,onDeliveryComplete:r,isProcessing:n})=>{const[i,l]=w.useState(!1),[c,u]=w.useState(!1),[g,h]=w.useState(!1),[p,y]=w.useState(null),[f,v]=w.useState(null),[b,j]=w.useState(!1),[N,k]=w.useState(!1),D=w.useCallback(()=>{const t=e.contactDetails.email||e.employeeEmail||"";return{subject:`Important: ${e.warningLevel} - ${e.warningCategory}`,body:`Dear ${e.employeeName},\n\nI hope this email finds you well. I am writing to formally notify you of a disciplinary matter that requires your immediate attention.\n\nSubject: ${e.warningLevel}\nCategory: ${e.warningCategory}\n\nPlease find attached the formal warning document that outlines the details of this matter. It is crucial that you review this document thoroughly and understand its contents.\n\nKey Points:\n• This is a formal disciplinary action\n• Please read the attached document carefully\n• You have the right to respond or appeal this decision\n• Further incidents may result in additional disciplinary action\n\nIf you have any questions or wish to discuss this matter, please do not hesitate to contact me or schedule a meeting with HR.\n\nPlease confirm receipt of this email and the attached document by replying to this message.\n\nThank you for your attention to this matter.\n\nBest regards,\n${e.createdByName||"HR Department"}\nHuman Resources Department`,to:t}},[e])();return o.jsxs("div",{className:"space-y-6",children:[0===t&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:o.jsx(ye,{className:"w-5 h-5 text-blue-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Prepare Email"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Copy the professional email template and download the PDF attachment"})]})]}),o.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx(fe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Employee Email:"})]}),o.jsx("div",{className:"text-lg font-semibold text-gray-900",children:D.to||o.jsxs("span",{className:"text-red-500 text-sm",children:[o.jsx(Z,{className:"w-4 h-4 inline mr-1"}),"No email address on file"]})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Subject:"}),o.jsx("div",{className:"relative",children:o.jsx("input",{value:D.subject,readOnly:!0,className:"w-full p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm font-medium",style:{color:"var(--color-text)"}})})]}),o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Message Template:"}),o.jsxs("div",{className:"relative",children:[o.jsx("textarea",{value:D.body,readOnly:!0,className:"w-full h-64 p-3 border border-gray-300 rounded-lg bg-gray-50 text-sm resize-none",style:{color:"var(--color-text)"}}),o.jsxs("div",{className:"absolute top-2 right-2 space-x-2",children:[o.jsx(x,{variant:i?"success":"primary",size:"sm",onClick:async()=>{try{const e=`To: ${D.to}\nSubject: ${D.subject}\n\n${D.body}`;await navigator.clipboard.writeText(e),l(!0),setTimeout(()=>l(!1),3e3)}catch(e){s.error("Failed to copy template:",e)}},children:i?o.jsxs(o.Fragment,{children:[o.jsx(ue,{className:"w-4 h-4 mr-1"}),"Copied!"]}):o.jsxs(o.Fragment,{children:[o.jsx(re,{className:"w-4 h-4 mr-1"}),"Copy Full Email"]})}),o.jsxs(x,{variant:"secondary",size:"sm",onClick:async()=>{try{await navigator.clipboard.writeText(D.body),l(!0),setTimeout(()=>l(!1),3e3)}catch(e){s.error("Failed to copy email body:",e)}},children:[o.jsx(re,{className:"w-4 h-4 mr-1"}),"Body Only"]})]})]})]}),o.jsxs("div",{className:"mb-6 space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsxs(x,{variant:"secondary",onClick:()=>{k(!0)},className:"flex items-center gap-2",children:[o.jsx(ge,{className:"w-4 h-4"}),"Preview & Download PDF"]}),c&&o.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[o.jsx(ae,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:"PDF Downloaded"})]})]}),o.jsx("p",{className:"text-xs text-gray-500",children:"Use the preview to download the PDF, then attach it to your email"})]}),o.jsxs("div",{className:"space-y-2 mb-6",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm "+(i?"text-green-600":"text-gray-500"),children:[i?o.jsx(ae,{className:"w-4 h-4"}):o.jsx(ie,{className:"w-4 h-4"}),"Email template copied to clipboard"]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm "+(c?"text-green-600":"text-gray-500"),children:[c?o.jsx(ae,{className:"w-4 h-4"}):o.jsx(ie,{className:"w-4 h-4"}),"PDF downloaded for attachment"]})]}),o.jsx(x,{variant:"primary",onClick:()=>{i&&c&&a(0)},disabled:!i||!c,className:"w-full",children:i&&c?o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Send Email"]}):o.jsxs(o.Fragment,{children:[o.jsx(ie,{className:"w-4 h-4 mr-2"}),"Complete preparation steps above"]})})]}),1===t&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-green-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:o.jsx(ve,{className:"w-5 h-5 text-green-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Send Email"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Open your email client and send the message with PDF attachment"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(m,{variant:"info",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("strong",{children:"Instructions:"}),o.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[o.jsx("li",{children:'Click "Open Email Client" below'}),o.jsx("li",{children:"Your default email application will open with pre-filled content"}),o.jsx("li",{children:"Attach the downloaded PDF file"}),o.jsx("li",{children:"Review the email content and recipient"}),o.jsx("li",{children:"Send the email"}),o.jsx("li",{children:"Wait for delivery confirmation if available"})]})]})}),o.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx("span",{className:"font-medium text-gray-700",children:"To:"}),o.jsx("span",{className:"text-gray-900",children:D.to})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Subject:"}),o.jsx("span",{className:"text-gray-900",children:D.subject})]})]}),o.jsxs(x,{variant:"primary",onClick:()=>{const e=encodeURIComponent(D.subject),t=encodeURIComponent(D.body),s=`mailto:${encodeURIComponent(D.to)}?subject=${e}&body=${t}`;window.location.href=s,h(!0)},disabled:!D.to,size:"lg",className:"w-full",children:[o.jsx(ce,{className:"w-5 h-5 mr-2"}),"Open Email Client"]}),g&&o.jsxs("div",{className:"mt-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-sm mb-4",children:[o.jsx(ae,{className:"w-4 h-4"}),"Email client opened"]}),o.jsxs(x,{variant:"primary",onClick:()=>{g&&a(1)},className:"w-full",children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"I've sent the email"]})]})]})]}),2===t&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-purple-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:o.jsx(he,{className:"w-5 h-5 text-purple-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Confirm Delivery"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Upload screenshot proof of successful email delivery"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(m,{variant:"info",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("strong",{children:"Screenshot Requirements:"}),o.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[o.jsx("li",{children:'Show the sent email in your "Sent" folder'}),o.jsx("li",{children:"Display recipient email address clearly"}),o.jsx("li",{children:"Include timestamp/date sent"}),o.jsx("li",{children:"Show PDF attachment in the email"}),o.jsx("li",{children:"Capture any delivery confirmation if available"})]})]})}),o.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[o.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){y(t);const e=new FileReader;e.onload=e=>{v(e.target?.result)},e.readAsDataURL(t)}},className:"hidden",id:"proof-upload"}),o.jsx("label",{htmlFor:"proof-upload",className:"cursor-pointer",children:f?o.jsxs("div",{className:"space-y-3",children:[o.jsx("img",{src:f,alt:"Delivery proof",className:"max-w-full max-h-64 mx-auto rounded-lg shadow-sm"}),o.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[o.jsx(ae,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:"Screenshot uploaded"})]})]}):o.jsxs("div",{className:"space-y-3",children:[o.jsx(pe,{className:"w-12 h-12 mx-auto text-gray-400"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-lg font-medium text-gray-700",children:"Upload Screenshot"}),o.jsx("div",{className:"text-sm text-gray-500",children:"Click to select image file"})]})]})})]}),o.jsx(x,{variant:"success",onClick:async()=>{if(p){j(!0);try{await r({warningId:e.warningId,deliveryMethod:"email",deliveredAt:new Date,proofImage:p,emailAddress:D.to})}catch(t){s.error("Failed to complete delivery:",t)}finally{j(!1)}}},disabled:!p||b,size:"lg",className:"w-full",children:b?o.jsxs(o.Fragment,{children:[o.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Delivery..."]}):o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Complete Email Delivery"]})})]})]}),N&&o.jsx(ua,{isOpen:N,onClose:()=>k(!1),warningData:{employee:{firstName:e.employeeName.split(" ")[0]||e.employeeName,lastName:e.employeeName.split(" ").slice(1).join(" ")||"",employeeNumber:"EMP001",department:"N/A"},category:e.warningCategory,level:e.warningLevel,description:"Warning document details",incidentDate:new Date,issueDate:new Date},onDownload:()=>{u(!0)}})]})},pa=({notification:t,currentStep:a,onStepComplete:r,onDeliveryComplete:n,isProcessing:i})=>{const{organization:l}=e(),[c,u]=w.useState(!1),[g,p]=w.useState(!1),[y,f]=w.useState([{id:"hand_delivered",label:"Hand delivered to employee",completed:!1,required:!0,description:"Personally delivered the printed warning to the employee"}]),[v,b]=w.useState([{id:"delivery_complete",label:"Delivery process completed",completed:!1,required:!0,description:"Confirm warning has been delivered to employee"}]),[j,N]=w.useState({deliveryDate:(new Date).toISOString().split("T")[0],deliveryTime:(new Date).toTimeString().split(" ")[0].slice(0,5),deliveryLocation:"",witnessName:"",additionalNotes:""}),k=w.useCallback(async()=>{if(!l)return alert("Organization data not loaded"),null;try{p(!0),t.warningId;const e=await h.warnings.getById(t.warningId,l.id);if(!e)throw new Error("Warning data not found");const a=await h.employees.getById(e.employeeId,l.id);if(!a)throw new Error("Employee data not found");const r=Qe(e,a,l),{PDFGenerationService:n}=await K(async()=>{const{PDFGenerationService:e}=await import("./PDFGenerationService-CdmFA2Eb.js");return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5])),i=await n.generateWarningPDF(r);return s.success("✅ PDF generated successfully"),i}catch(e){return s.error("❌ Failed to generate PDF:",e),alert("Failed to generate PDF. Please try again."),null}finally{p(!1)}},[t.warningId,l]),D=w.useCallback(async()=>{if(t.pdfUrl){const e=window.open(t.pdfUrl,"_blank");return void(e&&(e.onload=()=>{e.print(),u(!0)}))}const e=await k();if(e){const t=URL.createObjectURL(e),s=window.open(t,"_blank");s&&(s.onload=()=>{s.print(),u(!0)})}},[t.pdfUrl,k]),C=(e,t)=>{"delivery"===e?f(e=>e.map(e=>e.id===t?{...e,completed:!e.completed}:e)):b(e=>e.map(e=>e.id===t?{...e,completed:!e.completed}:e))},S=y.filter(e=>e.required).every(e=>e.completed),T=v.filter(e=>e.required).every(e=>e.completed);return o.jsxs("div",{className:"space-y-6",children:[0===a&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-purple-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:o.jsx(be,{className:"w-5 h-5 text-purple-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 1: Print Warning Document"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Print the official warning document for hand delivery"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx(m,{variant:"info",children:o.jsxs("div",{className:"text-sm",children:[o.jsx("strong",{children:"Printing Requirements:"}),o.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[o.jsx("li",{children:"Use high-quality paper (minimum 80gsm)"}),o.jsx("li",{children:"Ensure all text is clearly legible"}),o.jsx("li",{children:"Print multiple copies (original + HR copy)"})]})]})}),o.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(fe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"font-medium",children:"Employee:"}),o.jsx("span",{children:t.employeeName})]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(oe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"font-medium",children:"Warning Type:"}),o.jsx("span",{children:t.warningLevel})]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(je,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"font-medium",children:"Issue Date:"}),o.jsx("span",{children:t.createdAt.toLocaleDateString()})]})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{className:"flex gap-3",children:[o.jsx(x,{variant:"secondary",onClick:async()=>{if(t.pdfUrl)return void window.open(t.pdfUrl,"_blank");const e=await k();if(e){const t=URL.createObjectURL(e);window.open(t,"_blank")}},disabled:g,className:"flex items-center gap-2",children:g?o.jsxs(o.Fragment,{children:[o.jsx(le,{className:"w-4 h-4 animate-spin"}),"Generating PDF..."]}):o.jsxs(o.Fragment,{children:[o.jsx(ge,{className:"w-4 h-4"}),"Preview Document"]})}),o.jsx(x,{variant:"primary",onClick:D,disabled:g,className:"flex items-center gap-2",children:g?o.jsxs(o.Fragment,{children:[o.jsx(le,{className:"w-4 h-4 animate-spin"}),"Generating PDF..."]}):o.jsxs(o.Fragment,{children:[o.jsx(be,{className:"w-4 h-4"}),"Print Document"]})})]}),c&&o.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[o.jsx(ae,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:"Document printed successfully"})]})]}),o.jsx(x,{variant:"primary",onClick:()=>{c&&r(0)},disabled:!c,className:"w-full",children:c?o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Hand Delivery"]}):o.jsxs(o.Fragment,{children:[o.jsx(ie,{className:"w-4 h-4 mr-2"}),"Print document to continue"]})})]})]}),1===a&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-green-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:o.jsx(fe,{className:"w-5 h-5 text-green-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 2: Hand Delivery to Employee"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Deliver the printed document and obtain employee acknowledgment"})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Date"}),o.jsx("input",{type:"date",value:j.deliveryDate,onChange:e=>N(t=>({...t,deliveryDate:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Time"}),o.jsx("input",{type:"time",value:j.deliveryTime,onChange:e=>N(t=>({...t,deliveryTime:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]}),o.jsxs("div",{className:"md:col-span-2",children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Delivery Location"}),o.jsx("input",{type:"text",placeholder:"e.g., Employee's office, HR meeting room",value:j.deliveryLocation,onChange:e=>N(t=>({...t,deliveryLocation:e.target.value})),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"})]})]}),o.jsxs("div",{children:[o.jsxs("h4",{className:"text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(ae,{className:"w-5 h-5 text-green-600"}),"Delivery Checklist"]}),o.jsx("div",{className:"space-y-3",children:y.map(e=>o.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[o.jsx("input",{type:"checkbox",checked:e.completed,onChange:()=>C("delivery",e.id),className:"mt-1 w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"font-medium "+(e.completed?"text-green-600":"text-gray-900"),children:[e.label,e.required&&o.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),o.jsx("div",{className:"text-sm text-gray-600",children:e.description})]}),e.completed&&o.jsx(ae,{className:"w-5 h-5 text-green-600 mt-1"})]},e.id))})]}),o.jsx(x,{variant:"primary",onClick:()=>{S&&r(1)},disabled:!S,className:"w-full",children:S?o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Continue to Filing"]}):o.jsxs(o.Fragment,{children:[o.jsx(ie,{className:"w-4 h-4 mr-2"}),"Complete all required items above"]})})]})]}),2===a&&o.jsxs(d,{padding:"lg",className:"border-l-4 border-l-blue-500",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[o.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:o.jsx(Ne,{className:"w-5 h-5 text-blue-600"})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text)"},children:"Step 3: Finalize Delivery"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Confirm delivery completion"})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsx("div",{children:o.jsx("div",{className:"space-y-3",children:v.map(e=>o.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[o.jsx("input",{type:"checkbox",checked:e.completed,onChange:()=>C("filing",e.id),className:"mt-1 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"font-medium "+(e.completed?"text-blue-600":"text-gray-900"),children:[e.label,e.required&&o.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),o.jsx("div",{className:"text-sm text-gray-600",children:e.description})]}),e.completed&&o.jsx(ae,{className:"w-5 h-5 text-blue-600 mt-1"})]},e.id))})}),o.jsx(x,{variant:"success",onClick:async()=>{if(T)try{await n({warningId:t.warningId,deliveryMethod:"printed",deliveredAt:new Date(`${j.deliveryDate}T${j.deliveryTime}`),deliveryLocation:j.deliveryLocation,witnessName:j.witnessName,additionalNotes:j.additionalNotes,deliveryChecklist:y,filingChecklist:v})}catch(e){s.error("Failed to complete delivery:",e)}},disabled:!T||i,size:"lg",className:"w-full",children:i?o.jsxs(o.Fragment,{children:[o.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Completing Process..."]}):o.jsxs(o.Fragment,{children:[o.jsx(ae,{className:"w-4 h-4 mr-2"}),"Complete Delivery"]})})]})]})]})},ya=({notification:e,onDeliveryComplete:t,onClose:s,isOpen:a})=>{const[r,n]=w.useState(0),[i,l]=w.useState([]),[c,d]=w.useState(!1),[u,g]=w.useState(null);w.useEffect(()=>{l((()=>{switch(e.deliveryMethod){case"whatsapp":return[{id:"prepare",label:"Prepare Message",completed:!1,inProgress:!0,description:"Copy pre-written script and download PDF"},{id:"send",label:"Send via WhatsApp",completed:!1,inProgress:!1,description:"Open WhatsApp and send message with attachment"},{id:"confirm",label:"Confirm Delivery",completed:!1,inProgress:!1,description:"Upload screenshot proof and complete delivery"}];case"email":return[{id:"prepare",label:"Prepare Email",completed:!1,inProgress:!0,description:"Copy email template and download PDF attachment"},{id:"send",label:"Send Email",completed:!1,inProgress:!1,description:"Open email client and send message"},{id:"confirm",label:"Confirm Delivery",completed:!1,inProgress:!1,description:"Upload screenshot proof and complete delivery"}];case"printed":return[{id:"print",label:"Print Document",completed:!1,inProgress:!0,description:"Print warning PDF document"},{id:"deliver",label:"Hand Deliver",completed:!1,inProgress:!1,description:"Deliver to employee and obtain signature"},{id:"file",label:"File Documentation",completed:!1,inProgress:!1,description:"File signed copy and confirm completion"}];default:return[]}})())},[e.deliveryMethod]);const h=(()=>{switch(e.deliveryMethod){case"whatsapp":return{icon:me,name:"WhatsApp Business",color:"green",bgClass:"bg-green-50 border-green-200",textClass:"text-green-700"};case"email":return{icon:ye,name:"Email",color:"blue",bgClass:"bg-blue-50 border-blue-200",textClass:"text-blue-700"};case"printed":return{icon:be,name:"Print & Hand Delivery",color:"purple",bgClass:"bg-purple-50 border-purple-200",textClass:"text-purple-700"};default:return{icon:oe,name:"Unknown",color:"gray",bgClass:"bg-gray-50 border-gray-200",textClass:"text-gray-700"}}})(),y=e=>{l(t=>t.map((t,s)=>s===e?{...t,completed:!0,inProgress:!1}:s===e+1?{...t,inProgress:!0}:t)),e<i.length-1&&n(e+1)},f=async a=>{d(!0);try{await t(e.id,{...a,deliveryMethod:e.deliveryMethod,completedAt:new Date,steps:i}),s()}catch(r){g("Failed to complete delivery. Please try again.")}finally{d(!1)}};return a?o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:o.jsxs("div",{className:"bg-white rounded-2xl max-w-4xl w-full max-h-[95vh] flex flex-col shadow-2xl",children:[o.jsx("div",{className:`p-6 border-b flex-shrink-0 ${h.bgClass}`,children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"p-3 rounded-xl bg-white shadow-sm",children:o.jsx(h.icon,{className:`w-6 h-6 ${h.textClass}`})}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-xl font-bold",style:{color:"var(--color-text)"},children:[h.name," Delivery"]}),o.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Guided delivery workflow for ",e.employeeName]})]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(p,{variant:e.priority,size:"sm",children:e.priority.toUpperCase()}),o.jsx(x,{variant:"ghost",size:"sm",onClick:s,children:o.jsx(J,{className:"w-4 h-4"})})]})]})}),o.jsxs("div",{className:"p-4 bg-gray-50 border-b flex-shrink-0",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(fe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"font-semibold text-gray-900",children:e.employeeName})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(ne,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm text-gray-600",children:e.warningLevel})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(oe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm text-gray-600",children:e.warningCategory})]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[o.jsx(je,{className:"w-4 h-4"}),e.createdAt.toLocaleDateString()]})]}),(e.contactDetails.email||e.contactDetails.phone)&&o.jsxs("div",{className:"mt-3 flex items-center gap-4",children:[e.contactDetails.email&&o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(ye,{className:"w-4 h-4 text-gray-400"}),o.jsx("span",{className:"text-gray-600",children:e.contactDetails.email})]}),e.contactDetails.phone&&o.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[o.jsx(xe,{className:"w-4 h-4 text-gray-400"}),o.jsx("span",{className:"text-gray-600",children:e.contactDetails.phone})]})]})]}),o.jsx("div",{className:"p-6 border-b bg-white flex-shrink-0",children:o.jsx("div",{className:"flex items-center justify-between",children:i.map((e,t)=>o.jsxs("div",{className:"flex items-center",children:[o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("div",{className:`\n                    w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium transition-all\n                    ${e.completed?"bg-green-500 text-white":e.inProgress?"bg-blue-500 text-white animate-pulse":"bg-gray-200 text-gray-500"}\n                  `,children:e.completed?o.jsx(ae,{className:"w-5 h-5"}):e.inProgress?o.jsx(ie,{className:"w-5 h-5"}):t+1}),o.jsxs("div",{className:"mt-2 text-center",children:[o.jsx("div",{className:"text-sm font-medium "+(e.completed||e.inProgress?"text-gray-900":"text-gray-500"),children:e.label}),o.jsx("div",{className:"text-xs text-gray-500 mt-1 max-w-32",children:e.description})]})]}),t<i.length-1&&o.jsx(we,{className:"w-5 h-5 mx-4 "+(e.completed?"text-green-500":"text-gray-300")})]},e.id))})}),u&&o.jsx("div",{className:"p-4 flex-shrink-0",children:o.jsx(m,{variant:"error",children:u})}),o.jsxs("div",{className:"p-6 flex-1 overflow-y-auto min-h-0",children:["whatsapp"===e.deliveryMethod&&o.jsx(ga,{notification:e,currentStep:r,onStepComplete:y,onDeliveryComplete:f,isProcessing:c}),"email"===e.deliveryMethod&&o.jsx(ha,{notification:e,currentStep:r,onStepComplete:y,onDeliveryComplete:f,isProcessing:c}),"printed"===e.deliveryMethod&&o.jsx(pa,{notification:e,currentStep:r,onStepComplete:y,onDeliveryComplete:f,isProcessing:c})]}),o.jsxs("div",{className:"p-4 border-t bg-gray-50 flex items-center justify-between flex-shrink-0",children:[o.jsxs("div",{className:"text-sm text-gray-500",children:["Step ",r+1," of ",i.length]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(x,{variant:"ghost",size:"sm",onClick:s,children:"Cancel"}),c&&o.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[o.jsx(ee,{className:"w-4 h-4 animate-spin"}),"Processing..."]})]})]})]})}):null},fa=e=>e?e.deleted?{status:"deleted",message:"This audio recording has been permanently deleted.",canPlay:!1}:e.autoDeleteDate&&new Date>new Date(e.autoDeleteDate)?{status:"expired",message:"This audio recording has expired and is no longer available.",canPlay:!1}:"processing"===e.processingStatus?{status:"processing",message:"Audio is still being processed. Please try again in a moment.",canPlay:!1}:"failed"===e.processingStatus?{status:"failed",message:"Audio processing failed. The recording may be corrupted.",canPlay:!1}:e.storageUrl||e.url?{status:"available",message:"Audio recording is ready to play.",canPlay:!0}:{status:"unavailable",message:"Audio URL is not available. The recording may not have been uploaded properly.",canPlay:!1}:{status:"not-available",message:"Audio recording not available.",canPlay:!1},va=({audioRecording:e,warningId:t,showDownload:a=!0,showMetadata:r=!0,showTranscript:n=!1,compact:i=!1,autoPlay:l=!1,className:c=""})=>{if(!e)return o.jsx("div",{className:`bg-gray-50 border border-gray-200 rounded-lg p-4 ${c}`,children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center",children:o.jsx(ke,{className:"w-5 h-5 text-gray-400"})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm text-gray-600",children:"No audio recording available"}),o.jsx("p",{className:"text-xs text-gray-500",children:"Audio recording not found or not provided"})]})]})});const d=w.useRef(null),m=w.useRef(null),[x,u]=w.useState({isLoading:!0,isPlaying:!1,currentTime:0,duration:0,volume:1,isMuted:!1,error:null,buffered:0}),g=fa(e),h=(e=>fa(e).canPlay)(e),p=(e=>"deleted"===fa(e).status)(e),y=(e=>"expired"===fa(e).status)(e),f=e?.storageUrl||e?.url;w.useEffect(()=>{const e=d.current;if(!e||!h||!f)return void u(e=>({...e,isLoading:!1,error:h?"No audio URL available":g.message}));e.src=f;const t=()=>{u(e=>({...e,isLoading:!0,error:null}))},a=()=>{u(t=>({...t,duration:e.duration||0,isLoading:!1}))},r=()=>{u(t=>({...t,currentTime:e.currentTime||0}))},n=()=>{u(e=>({...e,isPlaying:!0}))},i=()=>{u(e=>({...e,isPlaying:!1}))},l=()=>{u(e=>({...e,isPlaying:!1,currentTime:0})),e&&(e.currentTime=0)},o=e=>{s.error("Audio loading error:",e),u(e=>({...e,isLoading:!1,isPlaying:!1,error:"Failed to load audio recording. The file may be corrupted or unavailable."}))},c=()=>{if(e.buffered.length>0){const t=e.buffered.end(e.buffered.length-1),s=e.duration||0;u(e=>({...e,buffered:s?t/s*100:0}))}};return e.addEventListener("loadstart",t),e.addEventListener("loadedmetadata",a),e.addEventListener("timeupdate",r),e.addEventListener("play",n),e.addEventListener("pause",i),e.addEventListener("ended",l),e.addEventListener("error",o),e.addEventListener("progress",c),e.load(),()=>{e.removeEventListener("loadstart",t),e.removeEventListener("loadedmetadata",a),e.removeEventListener("timeupdate",r),e.removeEventListener("play",n),e.removeEventListener("pause",i),e.removeEventListener("ended",l),e.removeEventListener("error",o),e.removeEventListener("progress",c)}},[h,f,g.message]),w.useEffect(()=>{l&&d.current&&!x.isLoading&&!x.error&&h&&d.current.play().catch(e=>s.warn("Audio autoplay failed",e))},[l,x.isLoading,x.error,h]);const v=w.useCallback(async()=>{const e=d.current;if(e&&h)try{x.isPlaying?e.pause():await e.play()}catch(t){s.error("Playback error:",t),u(e=>({...e,error:"Playback failed. Please try again."}))}},[x.isPlaying,h]),b=w.useCallback(e=>{const t=d.current;t&&h&&(t.currentTime=e)},[h]),j=w.useCallback(e=>{const t=d.current;t&&(t.volume=e,u(t=>({...t,volume:e,isMuted:0===e})))},[]),N=w.useCallback(()=>{const e=d.current;if(e){const t=!x.isMuted;e.muted=t,u(e=>({...e,isMuted:t}))}},[x.isMuted]),k=e=>{if(!e||isNaN(e))return"0:00";return`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`};return o.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${c}`,children:[h&&f&&o.jsx("audio",{ref:d,preload:"metadata"}),p?o.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[o.jsx(Ie,{className:"w-5 h-5 text-red-600"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-red-800 font-medium",children:"Audio Recording Deleted"}),o.jsx("p",{className:"text-red-600 text-sm",children:g.message})]})]}):y?o.jsxs("div",{className:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[o.jsx(Z,{className:"w-5 h-5 text-yellow-600"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-yellow-800 font-medium",children:"Audio Recording Expired"}),o.jsx("p",{className:"text-yellow-600 text-sm",children:g.message})]})]}):"processing"===g.status?o.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[o.jsx(le,{className:"w-5 h-5 text-blue-600 animate-spin"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-blue-800 font-medium",children:"Processing Audio"}),o.jsx("p",{className:"text-blue-600 text-sm",children:g.message})]})]}):"failed"===g.status||"unavailable"===g.status?o.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-lg",children:[o.jsx(Pe,{className:"w-5 h-5 text-red-600"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-red-800 font-medium",children:"Audio Unavailable"}),o.jsx("p",{className:"text-red-600 text-sm",children:g.message})]})]}):null,h&&!x.error&&o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("button",{onClick:v,disabled:x.isLoading,className:"flex items-center justify-center w-12 h-12 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors disabled:opacity-50",title:x.isPlaying?"Pause":"Play",children:x.isLoading?o.jsx(le,{className:"w-5 h-5 animate-spin"}):x.isPlaying?o.jsx(De,{className:"w-5 h-5"}):o.jsx(Ce,{className:"w-5 h-5 ml-1"})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{ref:m,className:"relative h-2 bg-gray-200 rounded-full cursor-pointer",onClick:e=>{if(m.current&&x.duration){const t=m.current.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;b(s*x.duration)}},children:[o.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 rounded-full",style:{width:`${x.buffered}%`}}),o.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-600 rounded-full",style:{width:x.duration?x.currentTime/x.duration*100+"%":"0%"}})]}),o.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[o.jsx("span",{children:k(x.currentTime)}),o.jsx("span",{children:k(x.duration)})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("button",{onClick:N,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:x.isMuted?"Unmute":"Mute",children:x.isMuted?o.jsx(Se,{className:"w-4 h-4"}):o.jsx(Te,{className:"w-4 h-4"})}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:x.isMuted?0:x.volume,onChange:e=>j(parseFloat(e.target.value)),className:"w-16 h-1 bg-gray-200 rounded-lg appearance-none cursor-pointer",title:"Volume"})]}),a&&f&&o.jsx("button",{onClick:()=>{const t=document.createElement("a");t.href=f,t.download=`warning-audio-${e.recordingId||"recording"}.webm`,t.click()},className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Download Audio",children:o.jsx(X,{className:"w-4 h-4"})})]})}),r&&!i&&h&&!x.error&&o.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-4 py-3",children:[o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[o.jsx(ie,{className:"w-3 h-3"}),"Duration"]}),o.jsx("p",{className:"font-medium",children:k(e.duration||0)})]}),o.jsxs("div",{children:[o.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[o.jsx(ke,{className:"w-3 h-3"}),"Quality"]}),o.jsx("p",{className:"font-medium",children:(D=e.bitrate,D?D>=32e3?"High":D>=16e3?"Standard":"Basic":"Unknown")})]}),o.jsxs("div",{children:[o.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[o.jsx(fe,{className:"w-3 h-3"}),"Recorded By"]}),o.jsx("p",{className:"font-medium",children:e.recordedByName||"Manager"})]}),o.jsxs("div",{children:[o.jsxs("p",{className:"text-gray-600 flex items-center gap-1",children:[o.jsx(je,{className:"w-3 h-3"}),"Recorded"]}),o.jsx("p",{className:"font-medium",children:e.startTime?new Date(e.startTime).toLocaleDateString():"Unknown"})]})]}),e.consentGiven&&o.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-green-700 bg-green-50 px-3 py-2 rounded-lg",children:[o.jsx(ne,{className:"w-3 h-3"}),o.jsx("span",{children:"Recording consent was obtained from all participants"})]}),e.autoDeleteDate&&o.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded-lg",children:[o.jsx(Ee,{className:"w-3 h-3"}),o.jsxs("span",{children:["This recording will be automatically deleted on"," ",new Date(e.autoDeleteDate).toLocaleDateString()]})]})]}),x.error&&o.jsx("div",{className:"border-t border-gray-200 p-4",children:o.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[o.jsx(Z,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm",children:x.error})]})})]});var D},ba=({signature:e,title:t,subtitle:a,isOpen:r,onClose:n,allowDownload:i=!0})=>{const l=w.useCallback(()=>{try{const s=atob(e.split(",")[1]),a=new Array(s.length);for(let e=0;e<s.length;e++)a[e]=s.charCodeAt(e);const r=new Uint8Array(a),n=new Blob([r],{type:"image/png"}),i=URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`${t.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}catch(a){s.error("Signature download failed:",a)}},[e,t]),c=w.useCallback(async()=>{try{await navigator.clipboard.writeText(e)}catch(t){s.error("Failed to copy signature:",t)}},[e]);return r?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t}),a&&o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a})]}),o.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5 text-gray-500"})})]}),o.jsx("div",{className:"p-6",children:o.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:o.jsx("img",{src:e,alt:t,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),o.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[o.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:c,className:"px-3 py-2 text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg transition-colors flex items-center gap-2",children:[o.jsx(re,{className:"w-4 h-4"}),"Copy Data"]}),i&&o.jsxs("button",{onClick:l,className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[o.jsx(X,{className:"w-4 h-4"}),"Download"]})]})]})]})}):null},ja=({signatures:e,warningId:t,showTimestamps:s=!0,compact:a=!1,showVerification:r=!0,allowDownload:n=!0,className:i=""})=>{const[l,c]=w.useState(null),d=e=>{if(!e)return!1;try{return e.startsWith("data:image/")&&e.includes("base64,")}catch{return!1}},m=d(e.manager),x=d(e.employee),u=m&&x,g=w.useCallback((e,t,s)=>{c({signature:e,title:t,subtitle:s})},[]),h=w.useCallback(()=>{c(null)},[]),p=e=>{if(!e)return"Not signed";try{return new Date(e).toLocaleString()}catch{return"Invalid timestamp"}},y=u?{status:"complete",message:"Document fully signed",color:"text-green-600 bg-green-50 border-green-200",icon:ae}:m||x?{status:"partial",message:"Signatures pending",color:"text-yellow-600 bg-yellow-50 border-yellow-200",icon:ie}:{status:"missing",message:"No signatures collected",color:"text-gray-600 bg-gray-50 border-gray-200",icon:Z},f=y.icon;return a?o.jsxs("div",{className:`inline-flex items-center gap-2 ${i}`,children:[o.jsx(f,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm text-gray-600",children:u?"✓ Signed":"⏳ Pending"}),u&&o.jsx("button",{onClick:()=>g(e.manager,"Digital Signatures","Manager and Employee"),className:"text-xs text-blue-600 hover:text-blue-800 underline",children:"View"})]}):o.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg overflow-hidden ${i}`,children:[o.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 px-4 py-3 border-b border-gray-200",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center",children:o.jsx(Re,{className:"w-4 h-4 text-white"})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Digital Signatures"}),o.jsx("p",{className:"text-xs text-gray-600",children:"Electronic authorization and acknowledgment"})]})]}),r&&o.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border ${y.color}`,children:[o.jsx(f,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:y.message})]})]})}),o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(fe,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Manager"}),m&&o.jsx(ae,{className:"w-4 h-4 text-green-500"})]}),m&&o.jsx("button",{onClick:()=>g(e.manager,"Manager Signature",e.managerName||"Warning Issuer"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:o.jsx(Ae,{className:"w-4 h-4 text-gray-500"})})]}),m?o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:o.jsx("img",{src:e.manager,alt:"Manager Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),o.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Le,{className:"w-3 h-3"}),o.jsx("span",{children:e.managerName||"Manager"})]}),s&&e.managerTimestamp&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(je,{className:"w-3 h-3"}),o.jsx("span",{children:p(e.managerTimestamp)})]})]})]}):o.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[o.jsx(fe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting manager signature"})]})]}),o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-3",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Le,{className:"w-4 h-4 text-gray-500"}),o.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Employee"}),x&&o.jsx(ae,{className:"w-4 h-4 text-green-500"})]}),x&&o.jsx("button",{onClick:()=>g(e.employee,"Employee Signature",e.employeeName||"Warning Recipient"),className:"p-1 hover:bg-gray-100 rounded transition-colors",title:"View full signature",children:o.jsx(Ae,{className:"w-4 h-4 text-gray-500"})})]}),x?o.jsxs("div",{className:"space-y-3",children:[o.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 text-center",children:o.jsx("img",{src:e.employee,alt:"Employee Signature",className:"max-w-full h-16 mx-auto",style:{imageRendering:"crisp-edges"}})}),o.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(Le,{className:"w-3 h-3"}),o.jsx("span",{children:e.employeeName||"Employee"})]}),s&&e.employeeTimestamp&&o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(je,{className:"w-3 h-3"}),o.jsx("span",{children:p(e.employeeTimestamp)})]})]})]}):o.jsxs("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[o.jsx(Le,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),o.jsx("p",{className:"text-sm text-gray-500",children:"Awaiting employee acknowledgment"})]})]})]})}),u&&o.jsx("div",{className:"bg-green-50 border-t border-green-200 px-4 py-3",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(ne,{className:"w-5 h-5 text-green-600"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-sm font-medium text-green-800",children:"Document Digitally Signed & Verified"}),o.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["These digital signatures are legally binding and comply with electronic signature regulations.",t&&` Document ID: ${t}`]})]}),n&&o.jsx("button",{onClick:()=>{},className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors",title:"Download signatures",children:o.jsx(X,{className:"w-4 h-4"})})]})}),!u&&(m||x)&&o.jsx("div",{className:"bg-yellow-50 border-t border-yellow-200 px-4 py-3",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Ee,{className:"w-5 h-5 text-yellow-600"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Signature Collection In Progress"}),o.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Document requires signatures from both manager and employee to be legally complete."})]})]})}),l&&o.jsx(ba,{signature:l.signature,title:l.title,subtitle:l.subtitle,isOpen:!0,onClose:h,allowDownload:n})]})},Na=(e,t="Not specified")=>null==e?t:"string"==typeof e?e:"number"==typeof e?e.toString():"boolean"==typeof e?e?"Yes":"No":t,wa=(e,t="Not set")=>{if(!e)return t;try{let s;return s=void 0!==e.seconds?new Date(1e3*e.seconds):e instanceof Date?e:new Date(e),isNaN(s.getTime())?t:s.toLocaleDateString("en-ZA",{year:"numeric",month:"short",day:"numeric"})}catch{return t}},ka=(e,t)=>{const s=wa(e,"");return s&&"Not set"!==s?t?`${s} at ${t}`:s:"Not specified"},Da=e=>{if(!e)return(new Date).toISOString().split("T")[0];try{let t;if(void 0!==e.seconds)t=new Date(1e3*e.seconds);else if(e instanceof Date)t=e;else{if("string"!=typeof e)return(new Date).toISOString().split("T")[0];t=new Date(e)}return isNaN(t.getTime())?(new Date).toISOString().split("T")[0]:t.toISOString().split("T")[0]}catch{return(new Date).toISOString().split("T")[0]}},Ca=(e,t)=>{const s={verbal:{primary:"bg-blue-600",secondary:"bg-blue-50",accent:"text-blue-600",background:"bg-blue-50",text:"text-blue-800",border:"border-blue-200"},written:{primary:"bg-yellow-600",secondary:"bg-yellow-50",accent:"text-yellow-600",background:"bg-yellow-50",text:"text-yellow-800",border:"border-amber-200"},final:{primary:"bg-red-600",secondary:"bg-red-50",accent:"text-red-600",background:"bg-red-50",text:"text-red-800",border:"border-red-200"},dismissal:{primary:"bg-red-700",secondary:"bg-red-50",accent:"text-red-700",background:"bg-red-50",text:"text-red-900",border:"border-red-300"}};return s[e]||s.verbal},Sa=({warning:e,isOpen:t,onClose:a,canTakeAction:r=!1,userRole:n="viewer",className:i="",onApprove:d,onReject:m,onAppealOutcome:x,canManageAppeals:u=!1})=>{const[h,p]=w.useState("overview"),[y,f]=w.useState(new Set(["summary"])),[v,b]=w.useState({type:null,loading:!1}),[j,N]=w.useState(!1),[k,D]=w.useState(""),[C,S]=w.useState(!1),[T,E]=w.useState(!1),[I,P]=w.useState(!1),[R,A]=w.useState(!1),[L,F]=w.useState(!1),[M,_]=w.useState(null),[U,O]=w.useState(!1),[z,W]=w.useState(null),[$,B]=w.useState(""),[q,H]=w.useState(!1),V=w.useRef(null),G=w.useRef(null);l(t);const{organization:Q}=g(),Y=w.useMemo(()=>e?{id:e.id||"",employeeName:Na(e.employeeName),employeeNumber:Na(e.employeeNumber),department:Na(e.department),position:Na(e.position),category:Na(e.category),level:e.level||"verbal",status:e.status||"issued",incidentDate:wa(e.incidentDate),incidentTime:Na(e.incidentTime),incidentDateTime:ka(e.incidentDate,e.incidentTime),incidentLocation:Na(e.incidentLocation),description:Na(e.description),issueDate:wa(e.issueDate),expiryDate:wa(e.expiryDate),issuedByName:Na(e.issuedByName),deliveryMethod:Na(e.deliveryMethod),additionalNotes:Na(e.additionalNotes),hasAudio:Boolean(e.audioRecording?.url),audioRecording:e.audioRecording||null,hasPDF:Boolean(e.pdfGenerated||e.pdfFilename),hasSignatures:Boolean(e.signatures&&Object.keys(e.signatures).length>0),signatures:e.signatures||{manager:null,employee:null},validityPeriod:e.validityPeriod||6,escalationReason:Na(e.escalationReason),acknowledgedAt:e.acknowledgedAt?wa(e.acknowledgedAt):null,acknowledgedBy:Na(e.acknowledgedBy),appealSubmitted:Boolean(e.appealSubmitted),appealDate:e.appealDate?wa(e.appealDate):null,appealDetails:e.appealDetails||null,appealOutcome:e.appealOutcome||null,appealDecisionDate:e.appealDecisionDate?wa(e.appealDecisionDate):null,appealReasoning:Na(e.appealReasoning,""),hrNotes:Na(e.hrNotes,""),followUpRequired:Boolean(e.followUpRequired),followUpDate:e.followUpDate?wa(e.followUpDate):null,createdAt:wa(e.createdAt),updatedAt:wa(e.updatedAt)}:null,[e]),Z=w.useMemo(()=>Y?Ca(Y.level,Y.status):Ca("verbal"),[Y]),ee=w.useCallback(()=>{S(!0),setTimeout(()=>{a(),S(!1),p("overview"),f(new Set(["summary"])),b({type:null,loading:!1}),N(!1),D(""),P(!1),A(!1),F(!1),_(null)},300)},[a]);w.useCallback(e=>{f(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),w.useCallback(async()=>{if(d&&Y?.id){b({type:"approve",loading:!0});try{await d(Y.id),setTimeout(ee,1e3)}catch(e){s.error("Failed to approve warning:",e),b({type:null,loading:!1})}}},[d,Y?.id,ee]),w.useCallback(async()=>{if(m&&Y?.id){b({type:"reject",loading:!0});try{await m(Y.id,k),setTimeout(ee,1e3)}catch(e){s.error("Failed to reject warning:",e),b({type:null,loading:!1})}}},[m,Y?.id,k,ee]),w.useCallback(()=>{N(!0)},[]);const te=w.useCallback(()=>{Y?.hasAudio&&F(!0)},[Y?.hasAudio]),se=w.useCallback(()=>{P(!0)},[]),ae=w.useCallback(async()=>{if(Y)try{const{PDFGenerationService:t}=await K(async()=>{const{PDFGenerationService:e}=await import("./PDFGenerationService-CdmFA2Eb.js");return{PDFGenerationService:e}},__vite__mapDeps([0,1,2,3,4,5])),a=await t.generateAppealReportPDF({warningId:e.id||"N/A",employee:{firstName:Y.employeeName.split(" ")[0]||"Unknown",lastName:Y.employeeName.split(" ").slice(1).join(" ")||"Employee",employeeNumber:Y.employeeNumber,department:Y.department,position:Y.position},category:Y.category,warningLevel:Y.level,issueDate:e.issueDate?.seconds?new Date(1e3*e.issueDate.seconds):new Date,organization:{name:Q?.name||"Organization",branding:Q?.branding},appealDetails:Y.appealDetails?{grounds:Y.appealDetails.grounds,details:Y.appealDetails.details,requestedOutcome:Y.appealDetails.requestedOutcome,submittedAt:Y.appealDetails.submittedAt?new Date(Y.appealDetails.submittedAt):void 0,submittedBy:Y.appealDetails.submittedBy}:void 0,appealOutcome:Y.appealOutcome,appealDecisionDate:e.appealDecisionDate?.seconds?new Date(1e3*e.appealDecisionDate.seconds):void 0,appealReasoning:Y.appealReasoning,hrNotes:Y.hrNotes,followUpRequired:Y.followUpRequired,followUpDate:e.followUpDate?.seconds?new Date(1e3*e.followUpDate.seconds):void 0}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=`Appeal_Report_${e.id||"Unknown"}_${(new Date).toISOString().split("T")[0]}.pdf`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),s.success("✅ Appeal report downloaded")}catch(t){s.error("❌ Failed to generate appeal report:",t),console.error("Full error details:",t),console.error("Warning data:",Y),console.error("Organization:",Q),alert(`Failed to generate appeal report: ${t instanceof Error?t.message:"Unknown error"}`)}},[Y,e,Q]),re=w.useCallback(()=>{Y?.hasSignatures&&A(!0)},[Y?.hasSignatures]),le=w.useCallback(e=>{if(!Y?.signatures)return;const t=Y.signatures[e];t&&(_({signature:t,title:`${e.charAt(0).toUpperCase()+e.slice(1)} Signature`,subtitle:`Warning ID: ${Y.id} • ${Y.employeeName}`}),A(!0))},[Y]);return t&&Y?o.jsxs(o.Fragment,{children:[o.jsx("div",{ref:G,className:`\n          fixed inset-0 flex items-center justify-center p-4\n          bg-black/60 backdrop-blur-xl\n          transition-all duration-500 ease-out\n          ${C?"opacity-0":"opacity-100"}\n          ${i}\n        `,style:{zIndex:c.modal},onClick:e=>e.target===G.current&&ee(),children:o.jsxs("div",{ref:V,className:`\n            relative w-full max-w-4xl max-h-[90vh] \n            bg-white rounded-lg shadow-xl border border-gray-200\n            overflow-hidden\n            transition-all duration-300 ease-out\n            ${C?"scale-95 opacity-0":"scale-100 opacity-100"}\n          `,children:[o.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`\n                w-10 h-10 rounded-lg ${Z.primary}\n                flex items-center justify-center\n              `,children:o.jsx(ne,{className:"w-5 h-5 text-white"})}),o.jsxs("div",{children:[o.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Warning Details"}),o.jsxs("p",{className:"text-sm text-gray-600",children:[Y.employeeName," • ",Y.category]})]})]}),o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"inline-flex px-3 py-1 text-sm font-medium rounded-full "+("verbal"===Y.level?"bg-blue-100 text-blue-800":"written"===Y.level?"bg-yellow-100 text-yellow-800":"final"===Y.level?"bg-red-100 text-red-800":"dismissal"===Y.level?"bg-red-200 text-red-900":"bg-gray-100 text-gray-800"),children:"verbal"===Y.level?"Verbal Warning":"written"===Y.level?"Written Warning":"final"===Y.level?"Final Warning":"dismissal"===Y.level?"Dismissal":"Warning"}),o.jsx("button",{onClick:ee,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5"})})]})]}),o.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:o.jsxs("div",{className:"p-6 space-y-6",children:[o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[o.jsx("h3",{className:"text-md font-semibold text-gray-900 mb-3",children:"Incident Summary"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Description:"}),o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Y.description})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Date:"}),o.jsx("span",{className:"ml-2 text-gray-600",children:Y.incidentDate})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Location:"}),o.jsx("span",{className:"ml-2 text-gray-600",children:Y.incidentLocation})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(fe,{className:"w-4 h-4 text-gray-600"}),"Employee Details"]}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Name:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.employeeName})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"ID:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.employeeNumber})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Position:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.position})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Department:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.department})]})]})]}),o.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[o.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(ie,{className:"w-4 h-4 text-gray-600"}),"Warning Timeline"]}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Issue Date:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.issueDate})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Expiry Date:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.expiryDate})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Issued By:"}),o.jsx("span",{className:"font-medium text-gray-900",children:Y.issuedByName})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{className:"text-gray-600",children:"Status:"}),o.jsx("span",{className:"font-medium "+("delivered"===Y.deliveryStatus?"text-green-600":"text-orange-600"),children:"delivered"===Y.deliveryStatus?"Delivered":"Pending Delivery"})]})]})]})]}),(Y.appealSubmitted||Y.appealOutcome)&&o.jsxs("div",{className:"mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[o.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(Fe,{className:"w-4 h-4 text-purple-600"}),"Appeal History"]}),Y.appealSubmitted&&Y.appealDetails&&o.jsxs("div",{className:"mb-4 p-3 bg-white rounded-lg border border-purple-100",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-xs font-semibold text-purple-900 uppercase",children:"Employee Appeal"}),o.jsx("span",{className:"text-xs text-gray-600",children:Y.appealDate})]}),o.jsxs("div",{className:"space-y-2 text-sm",children:[Y.appealDetails.grounds&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Grounds:"}),o.jsx("p",{className:"text-gray-600 mt-1",children:Y.appealDetails.grounds})]}),Y.appealDetails.details&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Additional Details:"}),o.jsx("p",{className:"text-gray-600 mt-1",children:Y.appealDetails.details})]}),Y.appealDetails.requestedOutcome&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Requested Outcome:"}),o.jsx("p",{className:"text-gray-600 mt-1",children:Y.appealDetails.requestedOutcome})]}),Y.appealDetails.submittedBy&&o.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Submitted by: ",Y.appealDetails.submittedBy]})]})]}),Y.appealOutcome&&o.jsxs("div",{className:"p-3 bg-white rounded-lg border border-purple-100",children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-xs font-semibold text-purple-900 uppercase",children:"HR Decision"}),o.jsx("span",{className:"text-xs text-gray-600",children:Y.appealDecisionDate||"Pending"})]}),o.jsxs("div",{className:"space-y-2 text-sm",children:[o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"font-medium text-gray-700",children:"Outcome:"}),o.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("overturned"===Y.appealOutcome?"bg-green-100 text-green-800":"upheld"===Y.appealOutcome?"bg-red-100 text-red-800":"modified"===Y.appealOutcome?"bg-blue-100 text-blue-800":"reduced"===Y.appealOutcome?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:"overturned"===Y.appealOutcome?"Warning Overturned":"upheld"===Y.appealOutcome?"Appeal Upheld - Warning Stands":"modified"===Y.appealOutcome?"Warning Modified":"reduced"===Y.appealOutcome?"Warning Reduced":Y.appealOutcome})]}),Y.appealReasoning&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"HR Reasoning:"}),o.jsx("p",{className:"text-gray-600 mt-1",children:Y.appealReasoning})]}),Y.hrNotes&&o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700",children:"HR Notes:"}),o.jsx("p",{className:"text-gray-600 mt-1",children:Y.hrNotes})]}),Y.followUpRequired&&o.jsx("div",{className:"mt-2 p-2 bg-yellow-50 rounded border border-yellow-200",children:o.jsxs("span",{className:"text-xs font-medium text-yellow-800",children:["⚠️ Follow-up required",Y.followUpDate?` by ${Y.followUpDate}`:""]})})]})]})]}),o.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[Y.hasAudio&&o.jsxs("button",{onClick:te,className:"flex items-center gap-2 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors text-sm",children:[o.jsx(Me,{className:"w-4 h-4"}),"Audio Recording"]}),o.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-3 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium",children:[o.jsx(oe,{className:"w-4 h-4"}),Y.appealSubmitted||Y.appealOutcome?"View PDF (with Appeal)":"View PDF"]}),Y.hasSignatures&&o.jsxs("button",{onClick:re,className:"flex items-center gap-2 px-3 py-2 bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors text-sm",children:[o.jsx(Re,{className:"w-4 h-4"}),"Signatures"]}),(Y.appealSubmitted||Y.appealOutcome)&&o.jsxs("button",{onClick:ae,className:"flex items-center gap-2 px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium",children:[o.jsx(Fe,{className:"w-4 h-4"}),"Print Appeal Report"]})]})})]})})]})}),L&&Y?.hasAudio&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{zIndex:c.modalNested1},children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),o.jsx("button",{onClick:()=>F(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5"})})]}),o.jsx("div",{className:"p-6",children:o.jsx(va,{audioData:Y.audioRecording,compact:!1})})]})}),R&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{zIndex:c.modalNested1},children:o.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-auto",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),o.jsx("button",{onClick:()=>A(!1),className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5"})})]}),o.jsx("div",{className:"p-6",children:Y?.hasSignatures?o.jsxs("div",{className:"space-y-4",children:[Y.signatures?.manager&&o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Manager Signature"}),o.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:o.jsx("img",{src:Y.signatures.manager,alt:"Manager Signature",className:"max-w-full h-20 mx-auto"})})]}),Y.signatures?.employee&&o.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[o.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Employee Signature"}),o.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded p-4 text-center",children:o.jsx("img",{src:Y.signatures.employee,alt:"Employee Signature",className:"max-w-full h-20 mx-auto"})})]})]}):o.jsxs("div",{className:"text-center py-8",children:[o.jsx(Re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),o.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),I&&o.jsx(ua,{isOpen:I,onClose:()=>P(!1),warningData:{selectedEmployee:{id:e.employeeId||"",firstName:e.employeeName||"Unknown",lastName:e.employeeLastName||"Employee",employeeId:e.employeeNumber||"",employeeNumber:e.employeeNumber||"",department:e.employeeDepartment||e.department||"",position:e.employeePosition||e.position||"",email:e.employeeEmail||""},selectedCategory:{id:e.categoryId||"",name:e.categoryName||e.category||"General",severity:"medium",description:e.categoryName||e.category||"General"},formData:{incidentDate:Da(e.incidentDate),incidentTime:e.incidentTime||"12:00",incidentLocation:e.incidentLocation||"",incidentDescription:e.incidentDescription||e.description||"",additionalNotes:e.additionalNotes||"",validityPeriod:e.validityPeriod||6,issueDate:Da(e.issueDate),status:e.status},signatures:e.signatures||{manager:null,employee:null},lraRecommendation:{category:e.categoryName||e.category||"General",recommendedLevel:e.level||"Counselling Session",suggestedLevel:e.level||"counselling",reason:"Based on incident severity and employee history",warningCount:1,previousWarnings:[],legalRequirements:["Employee consultation","Written documentation","Appeal process notification"]},organizationId:e.organizationId||""},onPDFGenerated:(t,s)=>{e.categoryName,e.category,e.signatures}}),L&&Y?.hasAudio&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:c.modalNested1},children:o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Audio Recording"}),o.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",Y.id," • ",Y.employeeName]})]}),o.jsx("button",{onClick:()=>F(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5 text-gray-500"})})]}),o.jsx("div",{className:"p-6",children:o.jsx(va,{audioRecording:Y.audioRecording,warningId:Y.id,showDownload:!0,showMetadata:!0,className:"w-full"})})]})}),R&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:c.modalNested1},children:o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-auto",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Digital Signatures"}),o.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Warning ID: ",Y.id," • ",Y.employeeName]})]}),o.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5 text-gray-500"})})]}),o.jsx("div",{className:"p-6",children:Y?.hasSignatures?o.jsxs(o.Fragment,{children:[o.jsx(ja,{signatures:Y.signatures,warningId:Y.id,showTimestamps:!0,showVerification:!0,allowDownload:!0,className:"w-full mb-4"}),o.jsxs("div",{className:"flex gap-3",children:[Y.signatures.manager&&o.jsxs("button",{onClick:()=>le("manager"),className:"flex items-center gap-2 px-4 py-2 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors",children:[o.jsx(ce,{className:"w-4 h-4 text-blue-600"}),o.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"View Manager Signature"})]}),Y.signatures.employee&&o.jsxs("button",{onClick:()=>le("employee"),className:"flex items-center gap-2 px-4 py-2 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors",children:[o.jsx(ce,{className:"w-4 h-4 text-green-600"}),o.jsx("span",{className:"text-sm text-green-700 font-medium",children:"View Employee Signature"})]})]})]}):o.jsxs("div",{className:"text-center py-12",children:[o.jsx(Re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),o.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No signatures available"}),o.jsx("p",{className:"text-gray-600",children:"Digital signatures have not been collected for this warning."})]})})]})}),M&&o.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm",style:{zIndex:c.modalNested2},children:o.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-auto",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:M.title}),M.subtitle&&o.jsx("p",{className:"text-sm text-gray-600 mt-1",children:M.subtitle})]}),o.jsx("button",{onClick:()=>_(null),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:o.jsx(J,{className:"w-5 h-5 text-gray-500"})})]}),o.jsx("div",{className:"p-6",children:o.jsx("div",{className:"bg-gray-50 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:o.jsx("img",{src:M.signature,alt:M.title,className:"max-w-full max-h-96 mx-auto",style:{imageRendering:"crisp-edges"}})})}),o.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-200 bg-gray-50",children:[o.jsx("div",{className:"text-sm text-gray-600",children:"Digital signature • PNG format • Legally binding"}),o.jsxs("button",{onClick:()=>{const e=document.createElement("a");e.href=M.signature,e.download=`${M.title.toLowerCase().replace(/\s+/g,"_")}_signature.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e)},className:"px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[o.jsx(X,{className:"w-4 h-4"}),"Download PNG"]})]})]})})]}):null},Ta=({physicalCopyLocation:e,className:t=""})=>o.jsx(d,{className:`bg-amber-50 dark:bg-amber-900/20 border-2 border-amber-500 ${t}`,children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center",children:o.jsx(Z,{className:"w-6 h-6 text-white"})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h3",{className:"text-base font-semibold text-amber-900 dark:text-amber-100",children:"⚠️ IMPORTANT: Physical Copy Required"}),o.jsx("p",{className:"text-sm text-amber-800 dark:text-amber-200 mt-1",children:"This warning was entered manually from a physical document"})]})]}),o.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-amber-300 dark:border-amber-700",children:[o.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-2",children:"The system does NOT have:"}),o.jsxs("ul",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-red-500 font-bold",children:"✗"}),o.jsx("span",{children:"Digital signatures from manager and employee"})]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-red-500 font-bold",children:"✗"}),o.jsx("span",{children:"Audio recording of the disciplinary meeting"})]}),o.jsxs("li",{className:"flex items-start gap-2",children:[o.jsx("span",{className:"text-red-500 font-bold",children:"✗"}),o.jsx("span",{children:"PDF document with QR code verification"})]})]})]}),o.jsxs("div",{className:"bg-amber-100 dark:bg-amber-900/40 rounded-lg p-4 border border-amber-400 dark:border-amber-600",children:[o.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[o.jsx(ne,{className:"w-5 h-5 text-amber-700 dark:text-amber-300 flex-shrink-0 mt-0.5"}),o.jsx("p",{className:"text-sm font-semibold text-amber-900 dark:text-amber-100",children:"Legal Compliance Requirement:"})]}),o.jsxs("p",{className:"text-sm text-amber-800 dark:text-amber-200 ml-7",children:["You ",o.jsx("strong",{children:"MUST"})," keep the original signed physical document safe and accessible for potential legal proceedings or CCMA hearings. This digital record is supplementary only."]})]}),e&&o.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-amber-300 dark:border-amber-700",children:o.jsxs("div",{className:"flex items-start gap-2",children:[o.jsx(oe,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"Physical Copy Location:"}),o.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 font-mono bg-gray-50 dark:bg-gray-900 px-3 py-2 rounded border border-gray-200 dark:border-gray-700",children:e})]})]})}),o.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300 italic border-t border-amber-300 dark:border-amber-700 pt-3",children:o.jsxs("p",{children:[o.jsx("strong",{children:"Note:"})," Historical entries are fully integrated with the escalation system and will count toward the employee's progressive discipline record."]})})]})}),Ea=({value:e,onChange:t,min:s,max:a,label:r,className:n=""})=>{const[i,l]=w.useState(!1),c=w.useRef(null);w.useEffect(()=>{if(i&&c.current){const t=c.current,a=48,r=(e-s)*a-t.clientHeight/2+a/2;setTimeout(()=>{t.scrollTo({top:Math.max(0,r),behavior:"smooth"})},100)}},[i,e,s]);const d=(()=>{const e=[];for(let t=s;t<=a;t++)e.push(t);return e})();return o.jsxs("div",{className:`relative ${n}`,children:[o.jsx("div",{onClick:()=>l(!i),className:"w-24 h-20 cursor-pointer border-2 rounded-2xl flex items-center justify-center transition-all duration-200 hover:scale-105",style:{backgroundColor:"var(--color-card-background)",borderColor:i?"var(--color-primary)":"var(--color-border)",boxShadow:i?"0 0 0 3px var(--color-primary-light)":"0 4px 12px rgba(0, 0, 0, 0.08)"},children:o.jsx("span",{className:"text-3xl font-light",style:{color:"var(--color-text)",fontVariantNumeric:"tabular-nums"},children:e.toString().padStart(2,"0")})}),i&&o.jsx("div",{className:"absolute top-full left-0 mt-2 w-24 bg-white border-2 rounded-2xl shadow-lg z-10 overflow-hidden",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-primary)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.15)"},children:o.jsx("div",{ref:c,className:"max-h-48 overflow-y-auto scrollbar-thin",style:{scrollbarWidth:"thin",scrollbarColor:"var(--color-primary) transparent"},children:d.map(s=>o.jsx("button",{onClick:()=>(t(s),void l(!1)),className:"w-full h-12 flex items-center justify-center transition-all duration-150 hover:scale-105",style:{backgroundColor:s===e?"var(--color-primary-light)":"transparent",color:s===e?"var(--color-primary)":"var(--color-text)",fontWeight:s===e?"600":"400",fontVariantNumeric:"tabular-nums"},onMouseEnter:t=>{s!==e&&(t.currentTarget.style.backgroundColor="var(--color-muted)")},onMouseLeave:t=>{s!==e&&(t.currentTarget.style.backgroundColor="transparent")},children:o.jsx("span",{className:"text-lg",children:s.toString().padStart(2,"0")})},s))})}),o.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2",children:o.jsx("span",{className:"text-xs font-medium tracking-wider uppercase",style:{color:"var(--color-text-tertiary)"},children:r})})]})},Ia=({label:e,value:t,onChange:s,type:a="date",icon:r,required:n=!1,disabled:i=!1,error:l,className:c=""})=>{const[d,m]=w.useState(!1),[x,u]=w.useState(t?new Date(t):null),[g,h]=w.useState(new Date),[p,y]=w.useState({hours:t?new Date(`1970-01-01T${t}`).getHours():9,minutes:t?new Date(`1970-01-01T${t}`).getMinutes():0}),f=w.useRef(null),v=w.useRef(null);w.useEffect(()=>{const e=e=>{v.current&&!v.current.contains(e.target)&&f.current&&!f.current.contains(e.target)&&m(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),w.useEffect(()=>(d?(setTimeout(()=>{const e=v.current;e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100),document.body.style.overflow="hidden"):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[d]);const b=e=>{u(e);const t=e.toISOString().split("T")[0];s(t),m(!1)},j=(e,t)=>{y({hours:e,minutes:t});const a=`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`;s(a)},N=(()=>{const e=g.getFullYear(),t=g.getMonth(),s=new Date(e,t,1),a=new Date(s);a.setDate(a.getDate()-s.getDay());const r=[];for(let n=0;n<42;n++){const e=new Date(a);e.setDate(a.getDate()+n),r.push(e)}return r})(),k=new Date,C={backgroundColor:l?"var(--color-alert-error-bg)":"var(--color-input-background)",borderColor:l?"var(--color-alert-error-border)":"var(--color-input-border)",color:"var(--color-text)"};return o.jsxs("div",{className:`space-y-2 ${c}`,children:[o.jsxs("label",{className:"block text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:[r&&o.jsx(r,{className:"w-3 h-3 inline mr-1"}),e," ",n&&o.jsx("span",{style:{color:"var(--color-error)"},children:"*"})]}),o.jsxs("div",{className:"relative",ref:f,children:[o.jsxs("div",{onClick:()=>!i&&m(!d),className:"w-full h-11 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-sm cursor-pointer flex items-center justify-between "+(i?"opacity-50 cursor-not-allowed":""),style:C,children:[o.jsx("span",{style:{color:t?"var(--color-text)":"var(--color-text-tertiary)"},children:"time"===a?t||"Select time...":x?x.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Select date..."}),"date"===a?o.jsx(je,{className:"w-4 h-4",style:{color:"var(--color-primary)"}}):o.jsx(ie,{className:"w-4 h-4",style:{color:"var(--color-primary)"}})]}),d&&"undefined"!=typeof document&&D.createPortal(o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[10000]",onClick:()=>m(!1)}),o.jsx("div",{ref:v,className:"fixed inset-0 z-[10001] flex items-center justify-center p-4",children:o.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-sm w-full max-h-[90vh] overflow-auto",style:{backgroundColor:"var(--color-card-background)",borderColor:"var(--color-border)",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},onClick:e=>e.stopPropagation(),children:"date"===a?o.jsxs("div",{className:"p-4",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsx("button",{onClick:()=>h(new Date(g.setMonth(g.getMonth()-1))),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",style:{color:"var(--color-text-secondary)"},children:o.jsx(_e,{className:"w-4 h-4"})}),o.jsx("h3",{className:"font-semibold text-center flex-1",style:{color:"var(--color-text)"},children:g.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),o.jsx("button",{onClick:()=>h(new Date(g.setMonth(g.getMonth()+1))),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",style:{color:"var(--color-text-secondary)"},children:o.jsx(Ue,{className:"w-4 h-4"})})]}),o.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>o.jsx("div",{className:"text-xs font-medium text-center p-2",style:{color:"var(--color-text-secondary)"},children:e},e))}),o.jsx("div",{className:"grid grid-cols-7 gap-1",children:N.map((e,t)=>{const s=e.getMonth()===g.getMonth(),a=e.toDateString()===k.toDateString(),r=x&&e.toDateString()===x.toDateString();return o.jsx("button",{onClick:()=>s&&b(e),disabled:!s,className:"p-2 text-sm rounded-lg transition-all "+(s?"hover:bg-gray-100 cursor-pointer":"opacity-30 cursor-not-allowed"),style:{backgroundColor:r?"var(--color-primary)":a?"var(--color-primary-light)":"transparent",color:r?"white":a?"var(--color-primary)":"var(--color-text)",fontWeight:a||r?"600":"400"},children:e.getDate()},t)})}),o.jsx("div",{className:"mt-4 flex justify-center",children:o.jsx("button",{onClick:()=>b(k),className:"px-4 py-2 text-sm rounded-lg border transition-colors",style:{borderColor:"var(--color-primary)",color:"var(--color-primary)",backgroundColor:"transparent"},children:"Today"})})]}):o.jsxs("div",{className:"p-6",children:[o.jsx("div",{className:"text-center mb-6",children:o.jsx("h3",{className:"text-lg font-light tracking-wide",style:{color:"var(--color-text)",letterSpacing:"0.5px"},children:"Select Time"})}),o.jsxs("div",{className:"flex items-center justify-center gap-6 mb-8",children:[o.jsx(Ea,{value:p.hours,onChange:e=>j(e,p.minutes),min:0,max:23,label:"Hours"}),o.jsxs("div",{className:"flex flex-col items-center self-start mt-12",children:[o.jsx("div",{className:"w-3 h-3 rounded-full mb-3",style:{backgroundColor:"var(--color-primary)"}}),o.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"var(--color-primary)"}})]}),o.jsx(Ea,{value:p.minutes,onChange:e=>j(p.hours,e),min:0,max:59,label:"Minutes"})]}),o.jsx("div",{className:"text-center mb-6",children:o.jsxs("div",{className:"inline-flex items-center px-4 py-2 rounded-full",style:{backgroundColor:"var(--color-muted)"},children:[o.jsx(ie,{className:"w-4 h-4 mr-2",style:{color:"var(--color-text-secondary)"}}),o.jsxs("span",{className:"text-lg font-medium tracking-wider",style:{color:"var(--color-text)",fontVariantNumeric:"tabular-nums"},children:[p.hours.toString().padStart(2,"0"),":",p.minutes.toString().padStart(2,"0")]})]})}),o.jsx("div",{className:"flex justify-center",children:o.jsx("button",{onClick:()=>m(!1),className:"px-8 py-3 rounded-xl font-medium tracking-wide transition-all duration-200 transform hover:scale-105 active:scale-95",style:{backgroundColor:"var(--color-primary)",color:"white",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.15)",letterSpacing:"0.5px"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 6px 24px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.15)"},children:"Done"})})]})})})]}),document.body)]}),l&&o.jsxs("div",{className:"flex items-center gap-1 text-xs",style:{color:"var(--color-error)"},children:[o.jsx("svg",{className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:o.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),l]})]})},Pa=["Select Employee & Category","Enter Dates & Details","Physical Copy Confirmation","Review & Save"],Ra={counselling:"Counselling Session",verbal:"Verbal Warning",first_written:"First Written Warning",second_written:"Second Written Warning",final_written:"Final Written Warning"},Aa=({isOpen:e,onClose:t,onSuccess:a,employees:r,categories:n,preSelectedEmployeeId:i,currentUserId:l,organizationId:c})=>{const[m,u]=w.useState(0),[g,h]=w.useState(!1),[p,b]=w.useState(null),[j,N]=w.useState({employeeId:i||"",categoryId:"",level:"",incidentDate:null,incidentTime:"09:00",issueDate:null,expiryDate:null,validityPeriod:6,title:"",description:"",incidentLocation:"",additionalNotes:"",hasPhysicalCopy:!1,physicalCopyLocation:"",historicalNotes:""}),k=w.useMemo(()=>r.find(e=>e.id===j.employeeId),[r,j.employeeId]),D=w.useMemo(()=>n.find(e=>e.id===j.categoryId),[n,j.categoryId]),C=w.useMemo(()=>D?.escalationPath?D.escalationPath:["counselling","verbal","first_written","second_written","final_written"],[D]),S=w.useCallback((e,t)=>{if(!e)return null;const s=new Date(e);return s.setMonth(s.getMonth()+t),s},[]),T=w.useCallback((e,t)=>{N(s=>{const a={...s,[e]:t};if("issueDate"===e||"validityPeriod"===e){const r="issueDate"===e?t:s.issueDate,n="validityPeriod"===e?t:s.validityPeriod;a.expiryDate=S(r,n)}return a})},[S]),E=w.useCallback(e=>{switch(e){case 0:return j.employeeId?j.categoryId?j.level?{isValid:!0}:{isValid:!1,error:"Please select a warning level"}:{isValid:!1,error:"Please select a category"}:{isValid:!1,error:"Please select an employee"};case 1:return j.incidentDate?j.issueDate?j.title.trim()?j.description.trim()?j.incidentLocation.trim()?j.issueDate>new Date?{isValid:!1,error:"Issue date cannot be in the future"}:j.expiryDate&&j.expiryDate<=j.issueDate?{isValid:!1,error:"Expiry date must be after issue date"}:{isValid:!0}:{isValid:!1,error:"Please enter incident location"}:{isValid:!1,error:"Please enter incident description"}:{isValid:!1,error:"Please enter a warning title"}:{isValid:!1,error:"Please enter issue date"}:{isValid:!1,error:"Please enter incident date"};case 2:return j.hasPhysicalCopy?{isValid:!0}:{isValid:!1,error:"You must confirm that a physical signed copy exists"};case 3:return{isValid:!0};default:return{isValid:!1}}},[j]),I=w.useCallback(()=>{const e=E(m);e.isValid?(b(null),u(e=>Math.min(e+1,3))):b(e.error||"Please complete all required fields")},[m,E]),P=w.useCallback(()=>{b(null),u(e=>Math.max(e-1,0))},[]),R=w.useCallback(async()=>{const e=E(2);if(e.isValid){h(!0),b(null);try{const{ShardedDataService:e}=await K(async()=>{const{ShardedDataService:e}=await import("./business-owner-dashboard-SKPFtfOP.js").then(e=>e.X);return{ShardedDataService:e}},__vite__mapDeps([2,3,1,4,5])),s={employeeId:j.employeeId,categoryId:j.categoryId,level:j.level,incidentDate:j.incidentDate,incidentTime:j.incidentTime,issueDate:j.issueDate,expiryDate:j.expiryDate,validityPeriod:j.validityPeriod,title:j.title,description:j.description,incidentLocation:j.incidentLocation,additionalNotes:j.additionalNotes,isHistoricalEntry:!0,hasPhysicalCopy:j.hasPhysicalCopy,physicalCopyLocation:j.physicalCopyLocation,historicalNotes:j.historicalNotes,enteredBy:l,enteredAt:new Date,issuedBy:l,status:"issued",isActive:!0,deliveryStatus:"delivered",followUpActions:[]};await e.createWarning(s,c),a(),t()}catch(r){s.error("Error creating historical warning:",r),b(r instanceof Error?r.message:"Failed to create warning")}finally{h(!1)}}else b(e.error||"Please complete all required fields")},[j,l,c,a,t,E]),A=w.useCallback(()=>{g||(u(0),b(null),N({employeeId:i||"",categoryId:"",level:"",incidentDate:null,incidentTime:"09:00",issueDate:null,expiryDate:null,validityPeriod:6,title:"",description:"",incidentLocation:"",additionalNotes:"",hasPhysicalCopy:!1,physicalCopyLocation:"",historicalNotes:""}),t())},[g,t,i]);return o.jsxs(y,{isOpen:e,onClose:A,title:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-amber-100 to-amber-50 dark:from-amber-900/40 dark:to-amber-900/20 flex items-center justify-center shadow-sm",children:o.jsx(oe,{className:"w-5 h-5 text-amber-600 dark:text-amber-400"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"Manual Warning Entry"}),o.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:Pa[m]})]})]}),size:"lg",children:[o.jsx("div",{className:"flex items-center justify-between mb-4 px-4",children:[0,1,2,3].map(e=>o.jsxs("div",{className:"flex items-center flex-1",children:[o.jsx("div",{className:"w-7 h-7 rounded-full flex items-center justify-center text-xs font-semibold transition-all duration-200\n                "+(e<=m?"bg-blue-600 text-white shadow-sm":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400"),children:e<m?o.jsx(ue,{className:"w-3.5 h-3.5"}):e+1}),e<3&&o.jsx("div",{className:"flex-1 h-0.5 mx-2 transition-all duration-200\n                  "+(e<m?"bg-blue-600":"bg-gray-200 dark:bg-gray-700")})]},e))}),p&&o.jsx("div",{className:"mb-4 px-4",children:o.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-3 flex items-start gap-2",children:[o.jsx(Z,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),o.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:p})]})}),o.jsx("div",{className:"px-4 pb-4 max-h-[calc(100vh-300px)] overflow-y-auto",children:(()=>{switch(m){case 0:return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx(v,{icon:fe,title:"Select Employee",subtitle:"Choose the employee who received this warning"}),o.jsxs("select",{value:j.employeeId,onChange:e=>T("employeeId",e.target.value),className:"mt-2 w-full h-11 px-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 hover:border-gray-300 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[o.jsx("option",{value:"",children:"Select an employee..."}),r.map(e=>o.jsxs("option",{value:e.id,children:[e.profile.firstName," ",e.profile.lastName," (",e.profile.employeeNumber,")"]},e.id))]})]}),o.jsxs("div",{children:[o.jsx(v,{icon:We,title:"Select Category",subtitle:"Choose the violation category"}),o.jsxs("select",{value:j.categoryId,onChange:e=>T("categoryId",e.target.value),className:"mt-2 w-full h-11 px-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 hover:border-gray-300 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[o.jsx("option",{value:"",children:"Select a category..."}),n.map(e=>o.jsx("option",{value:e.id,children:e.name},e.id))]})]}),j.categoryId&&o.jsxs("div",{children:[o.jsx(v,{icon:Z,title:"Warning Level",subtitle:"Select the severity level given in the original warning"}),o.jsxs("select",{value:j.level,onChange:e=>T("level",e.target.value),className:"mt-2 w-full h-11 px-4 rounded-lg border-2 border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 text-sm font-medium transition-all duration-200 hover:border-gray-300 dark:hover:border-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none",children:[o.jsx("option",{value:"",children:"Select warning level..."}),C.map(e=>o.jsx("option",{value:e,children:Ra[e]||e},e))]})]})]});case 1:return o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx(Ia,{label:"Incident Date",value:j.incidentDate?j.incidentDate.toISOString().split("T")[0]:"",onChange:e=>T("incidentDate",e?new Date(e):null),icon:je,required:!0}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"When did the incident occur?"})]}),o.jsx(f,{icon:ie,label:"Incident Time",type:"time",value:j.incidentTime,onChange:e=>T("incidentTime",e)}),o.jsxs("div",{children:[o.jsx(Ia,{label:"Issue Date",value:j.issueDate?j.issueDate.toISOString().split("T")[0]:"",onChange:e=>T("issueDate",e?new Date(e):null),icon:Re,required:!0}),o.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"When was the warning issued?"})]}),o.jsxs("div",{children:[o.jsx(v,{icon:ie,title:"Validity Period",subtitle:"How long is this warning active?"}),o.jsxs("select",{value:j.validityPeriod,onChange:e=>T("validityPeriod",parseInt(e.target.value)),className:"w-full h-11 px-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent",children:[o.jsx("option",{value:3,children:"3 months"}),o.jsx("option",{value:6,children:"6 months"}),o.jsx("option",{value:12,children:"12 months"})]}),j.expiryDate&&o.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Will expire on: ",j.expiryDate.toLocaleDateString()]})]}),o.jsx(f,{icon:oe,label:"Warning Title",placeholder:"Brief summary of the warning",value:j.title,onChange:e=>T("title",e)}),o.jsx(f,{icon:ze,label:"Incident Location",placeholder:"Where did the incident occur?",value:j.incidentLocation,onChange:e=>T("incidentLocation",e)}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Incident Description *"}),o.jsx("textarea",{value:j.description,onChange:e=>T("description",e.target.value),rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Describe what happened in detail..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Notes (Optional)"}),o.jsx("textarea",{value:j.additionalNotes,onChange:e=>T("additionalNotes",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Any additional context or notes..."})]})]});case 2:return o.jsxs("div",{className:"space-y-4",children:[o.jsx(d,{children:o.jsx("div",{className:"space-y-4",children:o.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[o.jsx("input",{type:"checkbox",checked:j.hasPhysicalCopy,onChange:e=>T("hasPhysicalCopy",e.target.checked),className:"w-5 h-5 mt-0.5 rounded border-gray-300 text-primary focus:ring-primary"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("span",{className:"text-base font-semibold text-gray-900 dark:text-gray-100",children:"I confirm the physical signed copy exists"}),o.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Required: You must have access to the original signed warning document"})]})]})})}),j.hasPhysicalCopy&&o.jsx(f,{icon:oe,label:"Physical Copy Location (Optional)",placeholder:"e.g., Filing Cabinet A3, HR Office",value:j.physicalCopyLocation,onChange:e=>T("physicalCopyLocation",e)}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Historical Entry Notes (Optional)"}),o.jsx("textarea",{value:j.historicalNotes,onChange:e=>T("historicalNotes",e.target.value),rows:3,className:"w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none",placeholder:"Any additional context about this historical entry..."})]}),o.jsx(Ta,{physicalCopyLocation:j.physicalCopyLocation||void 0})]});case 3:return o.jsxs("div",{className:"space-y-4",children:[o.jsx(d,{children:o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 border-b border-gray-200 dark:border-gray-700 pb-2",children:"Warning Summary"}),o.jsxs("div",{className:"space-y-3 text-sm",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Employee:"}),o.jsxs("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:[k?.profile.firstName," ",k?.profile.lastName]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Category:"}),o.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:D?.name})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Level:"}),o.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:Ra[j.level]||j.level})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Validity:"}),o.jsxs("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:[j.validityPeriod," months"]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Incident Date:"}),o.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:j.incidentDate?.toLocaleDateString()})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Issue Date:"}),o.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:j.issueDate?.toLocaleDateString()})]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Title:"}),o.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:j.title})]}),o.jsxs("div",{children:[o.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Description:"}),o.jsx("p",{className:"text-gray-900 dark:text-gray-100 mt-1",children:j.description})]})]})]})}),o.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-300 dark:border-red-700 rounded-lg p-4",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx(Z,{className:"w-5 h-5 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"text-sm font-semibold text-red-900 dark:text-red-100 mb-1",children:"This warning has NO digital signatures or audio recording"}),o.jsx("p",{className:"text-sm text-red-800 dark:text-red-200",children:"Ensure the physical signed document is kept safe for legal compliance"})]})]})})]});default:return null}})()}),o.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 px-4 py-4 flex items-center justify-between",children:[o.jsx(x,{variant:"outline",onClick:0===m?A:P,disabled:g,icon:0===m?J:_e,children:0===m?"Cancel":"Back"}),o.jsx(x,{onClick:3===m?R:I,disabled:g,className:"flex items-center justify-center gap-2",children:g?"Saving...":3===m?o.jsxs(o.Fragment,{children:["Save Historical Warning ",o.jsx(Oe,{className:"w-4 h-4"})]}):o.jsxs(o.Fragment,{children:["Next ",o.jsx(Ue,{className:"w-4 h-4"})]})})]})]})},La=w.memo(({className:n=""})=>{const i=C(),{user:l}=e(),{organization:c,categories:u}=g(),h=(e=>{const[t,s]=w.useState(window.innerWidth>e),a=w.useCallback(()=>s(window.innerWidth>e),[e]);return w.useEffect(()=>(window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)),[a]),t})(768),[p,y]=w.useState(null),[f,v]=w.useState(null),[k,D]=w.useState(null),[P,R]=w.useState(!1),{employees:A,warnings:L,error:F,refreshData:M}=b({role:"hr"}),{hrReportsCount:_,hrCountsLoading:U,hrCountsError:O}=(()=>{const{user:r}=e(),{canManageHR:n}=t(),[i,l]=w.useState({absenceReports:{unread:0,total:0},hrMeetings:{unread:0,total:0},correctiveCounselling:{unread:0,total:0}}),[o,c]=w.useState(!0),[d,m]=w.useState(null),[x,u]=w.useState(null),g=w.useRef([]),h=w.useRef(!0),p=w.useRef(!1),y=w.useCallback(async()=>{r?.organizationId&&n()&&(m(null),u(new Date))},[r?.organizationId,n]);return w.useEffect(()=>{if(!p.current){if(h.current=!0,!n()||!r?.organizationId)return c(!1),void(p.current=!0);c(!0),m(null),g.current.forEach(e=>{try{e()}catch(t){s.warn("⚠️ Error unsubscribing:",t)}}),g.current=[];try{const e=S(T(a,`organizations/${r.organizationId}/reports`),E("absenceDate","desc")),t=I(e,e=>{if(!h.current)return;const t=e.docs.filter(e=>"_metadata"!==e.id).map(e=>({id:e.id,...e.data()})),s=t.filter(e=>!e.hrReviewed).length;l(e=>({...e,absenceReports:{unread:s,total:t.length}})),u(new Date),t.length},e=>{s.error("❌ Absence reports listener error:",e),h.current&&m("Failed to load absence reports")});g.current.push(t);const n=S(T(a,`organizations/${r.organizationId}/meetings`),E("createdAt","desc")),i=I(n,e=>{if(!h.current)return;const t=e.docs.filter(e=>"_metadata"!==e.id).map(e=>({id:e.id,...e.data()})),s=t.filter(e=>"pending"===e.status).length;l(e=>({...e,hrMeetings:{unread:s,total:t.length}})),u(new Date),t.length},e=>{s.error("❌ HR meetings listener error:",e),h.current&&m("Failed to load HR meetings")});g.current.push(i);const o=S(T(a,`organizations/${r.organizationId}/corrective_counselling`),E("dateCreated","desc")),d=I(o,e=>{if(!h.current)return;const t=e.docs.filter(e=>"_metadata"!==e.id).map(e=>({id:e.id,...e.data()})),s=t.filter(e=>new Date(e.dateCreated)>new Date(Date.now()-6048e5)&&!e.hrReviewed).length;l(e=>({...e,correctiveCounselling:{unread:s,total:t.length}})),u(new Date),t.length},e=>{s.error("❌ Corrective counselling listener error:",e),h.current&&m("Failed to load counselling records")});g.current.push(d),setTimeout(()=>{h.current&&c(!1)},1e3)}catch(e){s.error("❌ Error setting up listeners:",e),m("Failed to initialize real-time data"),c(!1)}return p.current=!0,()=>{h.current=!1,g.current.forEach(t=>{try{t()}catch(e){s.warn("⚠️ Error during cleanup:",e)}}),g.current=[],p.current=!1}}},[]),w.useEffect(()=>{n()&&r?.organizationId||(l({absenceReports:{unread:0,total:0},hrMeetings:{unread:0,total:0}}),c(!1),m(null),u(null),p.current=!1)},[n(),r?.organizationId]),{hrReportsCount:i,hrCountsLoading:o,hrCountsError:d,refreshHRCounts:y,lastUpdated:x}})(),[z,W]=w.useState(!1),[$,B]=w.useState(!1),[q,H]=w.useState(null),[V,G]=w.useState(!1),K=((e,t,a)=>{const[n,i]=w.useState(!0),[l,o]=w.useState(null),[c,d]=w.useState(null);w.useEffect(()=>{(async()=>{if(e&&t)try{i(!0);const n=await r.getDocument(t,"users",e);if(!n)return s.error("User document not found for countdown feature"),void i(!1);const l=n?.features?.historicalWarningEntry;if(l?.firstAccessedAt){const e=l.firstAccessedAt.toDate?l.firstAccessedAt.toDate():new Date(l.firstAccessedAt),t=l.expiresAt.toDate?l.expiresAt.toDate():new Date(l.expiresAt);o({firstAccessedAt:e,expiresAt:t}),Math.ceil((t.getTime()-Date.now())/864e5)}else if(a){const s=new Date,a=new Date(s.getTime()+5184e6),n={"features.historicalWarningEntry":{firstAccessedAt:s,expiresAt:a}};await r.updateDocument(t,"users",e,n),o({firstAccessedAt:s,expiresAt:a})}}catch(n){s.error("Failed to initialize historical warning countdown:",n)}finally{i(!1)}else i(!1)})()},[e,t,a]),w.useEffect(()=>{if(!l)return void d(null);const e=()=>{const e=Date.now(),t=l.expiresAt.getTime()-e,s=Math.floor(t/864e5);d(Math.max(0,s))};e();const t=setInterval(e,36e5);return()=>clearInterval(t)},[l]);const{level:m,text:x}=null!==c&&l?0===c?{level:"urgent",text:"Enter Historical Warning (Last day!)"}:1===c?{level:"urgent",text:"Enter Historical Warning (1 day left!)"}:c<=7?{level:"warning",text:`Enter Historical Warning (${c} days left - Hurry!)`}:c<=14?{level:"warning",text:`Enter Historical Warning (${c} days left)`}:{level:"normal",text:`Enter Historical Warning (${c} days left)`}:{level:"normal",text:"Enter Historical Warning"},u=null!==c&&c<=0;return{daysRemaining:c,isExpired:u,isActive:!u&&null!==l,loading:n,urgencyLevel:m,displayText:x}})(l?.uid,c?.id,"warnings"===p),Y=L?.filter(e=>"expired"!==e.status&&"overturned"!==e.status)||[],J={totalActive:Y.length,undelivered:Y.filter(e=>"delivered"!==e.status).length,highSeverity:Y.filter(e=>"high"===e.severity||"gross_misconduct"===e.category?.severity).length},X={totalEmployees:A?.length||0,activeEmployees:A?.filter(e=>!1!==e.isActive)?.length||0,newEmployees:A?.filter(e=>new Date(e.createdAt||e.metadata?.createdAt||0)>new Date(Date.now()-2592e6))?.length||0};return w.useEffect(()=>{const e=e=>{const{employeeId:t}=e.detail,s=localStorage.getItem("warningFilterEmployeeName");t&&s&&(v({id:t,name:s}),y("warnings"),localStorage.removeItem("warningFilterEmployeeId"),localStorage.removeItem("warningFilterEmployeeName"))};return window.addEventListener("navigateToWarnings",e),()=>{window.removeEventListener("navigateToWarnings",e)}},[]),h?o.jsxs("div",{className:`${n}`,children:[o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-3 mb-6",children:[o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>i("/hr/absence-reports"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx($e,{className:"w-8 h-8",style:{opacity:.7}}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Absence Reports"}),o.jsx("div",{className:"text-2xl font-bold",children:_.absenceReports.unread}),o.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[_.absenceReports.total," total"]})]})]})}),o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>i("/hr/meeting-requests"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Be,{className:"w-8 h-8",style:{opacity:.7}}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Meeting Requests"}),o.jsx("div",{className:"text-2xl font-bold",children:_.hrMeetings.unread}),o.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[_.hrMeetings.total," total"]})]})]})}),o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>i("/hr/corrective-counselling"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(qe,{className:"w-8 h-8",style:{opacity:.7}}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Counselling"}),o.jsx("div",{className:"text-2xl font-bold",children:_.correctiveCounselling.unread}),o.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[_.correctiveCounselling.total," total"]})]})]})}),o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>y("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(ne,{className:"w-8 h-8",style:{opacity:.7}}),o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Active Warnings"}),o.jsx("div",{className:"text-2xl font-bold",children:J.totalActive}),o.jsxs("div",{className:"text-xs mt-0.5",style:{opacity:.8},children:[J.undelivered," undelivered"]})]})]})})]}),(F||O)&&o.jsx(m,{variant:"error",className:"mb-4",children:o.jsxs("div",{className:"text-sm",children:["Failed to load dashboard data: ",F||O]})}),o.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm",children:[o.jsx("div",{className:"border-b border-gray-200",children:o.jsx("nav",{className:"flex space-x-6 px-4",children:[{id:"urgent",label:"Urgent Tasks",icon:Z,count:_.absenceReports.unread+_.hrMeetings.unread+J.undelivered},{id:"warnings",label:"Warnings",icon:ne},{id:"employees",label:"Employees",icon:He},{id:"departments",label:"Departments",icon:He}].map(e=>o.jsxs("button",{onClick:()=>y(e.id),className:"flex items-center gap-2 py-3 px-1 border-b-2 text-sm font-medium transition-colors relative "+(p===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[o.jsx(e.icon,{className:"w-4 h-4"}),e.label,e.count&&e.count>0&&o.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center ml-1",children:e.count})]},e.id))})}),o.jsxs("div",{className:"p-4",children:["urgent"===p&&o.jsxs("div",{className:"hidden lg:block space-y-4",children:[o.jsxs("div",{className:"bg-white rounded-lg border border-red-200 shadow-sm",children:[o.jsxs("div",{className:"p-4 border-b border-red-100 bg-red-50",children:[o.jsxs("h3",{className:"text-lg font-semibold text-red-900 flex items-center gap-2",children:[o.jsx(Z,{className:"w-5 h-5"}),"Urgent Tasks Requiring Immediate Attention"]}),o.jsx("p",{className:"text-sm text-red-700 mt-1",children:"These items need your immediate review and action"})]}),o.jsxs("div",{className:"divide-y divide-gray-100",children:[_.absenceReports.unread>0&&o.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>i("/hr/absence-reports"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full"}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-semibold text-gray-900",children:[_.absenceReports.unread," Unread Absence Reports"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Employees reporting absences requiring approval"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium",children:[_.absenceReports.unread," pending"]}),o.jsx($e,{className:"w-4 h-4 text-gray-400"})]})]})}),_.hrMeetings.unread>0&&o.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>i("/hr/meeting-requests"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full"}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-semibold text-gray-900",children:[_.hrMeetings.unread," New Meeting Requests"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Employees requesting HR consultations"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full font-medium",children:[_.hrMeetings.unread," requests"]}),o.jsx(Be,{className:"w-4 h-4 text-gray-400"})]})]})}),J.undelivered>0&&o.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>y("warnings"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full"}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-semibold text-gray-900",children:[J.undelivered," Undelivered Warnings"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Warning documents pending delivery to employees"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:"Urgent"}),o.jsx(Z,{className:"w-4 h-4 text-gray-400"})]})]})}),J.highSeverity>0&&o.jsx("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>y("warnings"),children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full"}),o.jsxs("div",{children:[o.jsxs("div",{className:"font-semibold text-gray-900",children:[J.highSeverity," High Priority Cases"]}),o.jsx("div",{className:"text-sm text-gray-600",children:"Final warnings and dismissal cases requiring oversight"})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium",children:"Critical"}),o.jsx(Z,{className:"w-4 h-4 text-gray-400"})]})]})}),0===_.absenceReports.unread&&0===_.hrMeetings.unread&&0===J.undelivered&&0===J.highSeverity&&o.jsxs("div",{className:"p-8 text-center text-gray-500",children:[o.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:o.jsx(ne,{className:"w-8 h-8 text-green-600"})}),o.jsx("div",{className:"font-medium text-gray-700",children:"All caught up!"}),o.jsx("div",{className:"text-sm",children:"No urgent tasks requiring immediate attention"})]})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:[o.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(ie,{className:"w-4 h-4 text-gray-600"}),"Today's Activity"]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"New Reports"}),o.jsx("span",{className:"font-medium text-gray-900",children:_.absenceReports.unread})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Meetings"}),o.jsx("span",{className:"font-medium text-gray-900",children:_.hrMeetings.unread})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Counselling"}),o.jsx("span",{className:"font-medium text-gray-900",children:_.correctiveCounselling.unread})]})]})]}),o.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[o.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(Ve,{className:"w-4 h-4 text-blue-600"}),"Team Status"]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Total Employees"}),o.jsx("span",{className:"font-medium text-gray-900",children:X.totalEmployees})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Active"}),o.jsx("span",{className:"font-medium text-green-600",children:X.activeEmployees})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"New This Month"}),o.jsx("span",{className:"font-medium text-blue-600",children:X.newEmployees})]})]})]}),o.jsxs("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:[o.jsxs("h4",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[o.jsx(ne,{className:"w-4 h-4 text-orange-600"}),"Warning Overview"]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Active"}),o.jsx("span",{className:"font-medium text-gray-900",children:J.totalActive})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"Undelivered"}),o.jsx("span",{className:"font-medium text-orange-600",children:J.undelivered})]}),o.jsxs("div",{className:"flex justify-between text-sm",children:[o.jsx("span",{className:"text-gray-600",children:"High Priority"}),o.jsx("span",{className:"font-medium text-red-600",children:J.highSeverity})]})]})]})]})]}),"warnings"===p&&o.jsxs("div",{className:"hidden lg:block space-y-4",children:[!K.isExpired&&o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Warnings Management"}),o.jsx("p",{className:"text-sm text-gray-600",children:"Digital and historical warning records"})]}),o.jsx(x,{variant:"outline",size:"md",icon:oe,onClick:()=>W(!0),className:""+("urgent"===K.urgencyLevel?"border-red-500 text-red-700 hover:bg-red-50 font-semibold animate-pulse":"warning"===K.urgencyLevel?"border-orange-500 text-orange-700 hover:bg-orange-50 font-semibold":"border-amber-500 text-amber-700 hover:bg-amber-50"),children:K.loading?"Enter Historical Warning":K.displayText})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[o.jsx("div",{className:"bg-orange-50 rounded-lg p-4 border border-orange-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Z,{className:"w-8 h-8 text-orange-600"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-orange-600",children:J.undelivered}),o.jsx("div",{className:"text-sm text-orange-700",children:"Undelivered Warnings"}),o.jsx("div",{className:"text-xs text-orange-600",children:"Require immediate attention"})]})]})}),o.jsx("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(ne,{className:"w-8 h-8 text-red-600"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-red-600",children:J.highSeverity}),o.jsx("div",{className:"text-sm text-red-700",children:"High Severity"}),o.jsx("div",{className:"text-xs text-red-600",children:"Final warnings & dismissals"})]})]})}),o.jsx("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(oe,{className:"w-8 h-8 text-blue-600"}),o.jsxs("div",{children:[o.jsx("div",{className:"text-2xl font-bold text-blue-600",children:J.totalActive}),o.jsx("div",{className:"text-sm text-blue-700",children:"Total Active"}),o.jsx("div",{className:"text-xs text-blue-600",children:"All current warnings"})]})]})})]}),o.jsx("div",{className:"bg-white rounded-lg border border-gray-200",children:o.jsx(Q,{initialEmployeeFilter:f||void 0,selectedWarning:k,showDetails:P,onViewDetails:e=>{D(e),R(!0)},onCloseDetails:()=>{D(null),R(!1)},onWarningUpdated:M})})]}),"employees"===p&&o.jsx("div",{className:"hidden lg:block space-y-4",children:o.jsx(j,{})}),"departments"===p&&c&&o.jsx("div",{className:"hidden lg:block",children:o.jsx(N,{isOpen:!0,onClose:()=>y("urgent"),organizationId:c.id,inline:!0})})]})]}),z&&l&&c&&o.jsx(Aa,{isOpen:z,onClose:()=>W(!1),onSuccess:()=>{W(!1),M()},employees:A||[],categories:u||[],currentUserId:l.uid,organizationId:c.id}),$&&c&&o.jsx(N,{isOpen:$,onClose:()=>B(!1),organizationId:c.id}),V&&q&&o.jsx(ya,{isOpen:V,notification:q,onDeliveryComplete:async(e,t)=>{try{G(!1),H(null),M()}catch(a){s.error("Failed to complete delivery:",a)}},onClose:()=>{G(!1),H(null)}}),o.jsx(Sa,{warning:k,isOpen:P,onClose:()=>{D(null),R(!1)},canTakeAction:!0,userRole:"hr"})]}):o.jsxs("div",{className:`space-y-6 ${n}`,children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>i("/hr/absence-reports"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[o.jsx($e,{className:"w-5 h-5"}),o.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Absence Reports"}),U?o.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):o.jsx("span",{className:"text-lg font-bold",children:_.absenceReports.unread})]})}),o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>i("/hr/meeting-requests"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[o.jsx(Be,{className:"w-5 h-5"}),o.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"HR Meetings"}),U?o.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):o.jsx("span",{className:"text-lg font-bold",children:_.hrMeetings.unread})]})}),o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>i("/hr/corrective-counselling"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[o.jsx(qe,{className:"w-5 h-5"}),o.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Counselling"}),U?o.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):o.jsx("span",{className:"text-lg font-bold",children:_.correctiveCounselling.unread})]})}),o.jsx(d,{padding:"sm",shadow:"lg",hover:!0,onClick:()=>y("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{background:"linear-gradient(135deg, var(--color-warning), var(--color-warning))",color:"var(--color-text-inverse)",minHeight:"80px",willChange:"transform"},children:o.jsxs("div",{className:"flex flex-col items-center gap-1.5 py-1",children:[o.jsx(ne,{className:"w-5 h-5"}),o.jsx("span",{className:"font-medium text-xs text-center leading-tight",children:"Active Warnings"}),o.jsx("span",{className:"text-lg font-bold",children:J.totalActive})]})})]}),o.jsxs("div",{className:"space-y-3",children:[o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("urgent"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Z,{className:"w-5 h-5",style:{color:"var(--color-error)"}}),o.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Urgent Tasks"})]}),o.jsx(Ue,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("warnings"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(ne,{className:"w-5 h-5",style:{color:"var(--color-warning)"}}),o.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Warnings"})]}),o.jsx(Ue,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("employees"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(He,{className:"w-5 h-5",style:{color:"var(--color-success)"}}),o.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Employees"})]}),o.jsx(Ue,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})}),o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>y("departments"),className:"cursor-pointer transition-all duration-200 active:scale-95",style:{minHeight:"64px",willChange:"transform"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(He,{className:"w-5 h-5",style:{color:"var(--color-info)"}}),o.jsx("span",{className:"font-semibold",style:{color:"var(--color-text)"},children:"Departments"})]}),o.jsx(Ue,{className:"w-5 h-5",style:{color:"var(--color-text-secondary)"}})]})})]}),"urgent"===p&&o.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:o.jsxs(d,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[o.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[o.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Urgent Tasks"}),o.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"×"})]}),o.jsx("div",{className:"overflow-y-auto p-4",children:o.jsxs("div",{className:"space-y-3",children:[o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>i("/hr/absence-reports"),className:"cursor-pointer",style:{background:"linear-gradient(135deg, var(--color-error), var(--color-error))",color:"var(--color-text-inverse)"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Absence Reports"}),o.jsx("div",{className:"text-2xl font-bold",children:_.absenceReports.unread})]}),o.jsx($e,{className:"w-8 h-8",style:{opacity:.7}})]})}),o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>i("/hr/meeting-requests"),className:"cursor-pointer",style:{background:"linear-gradient(135deg, var(--color-accent), var(--color-accent))",color:"var(--color-text-inverse)"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Meeting Requests"}),o.jsx("div",{className:"text-2xl font-bold",children:_.hrMeetings.unread})]}),o.jsx(Be,{className:"w-8 h-8",style:{opacity:.7}})]})}),o.jsx(d,{padding:"md",shadow:"sm",hover:!0,onClick:()=>i("/hr/corrective-counselling"),className:"cursor-pointer",style:{background:"linear-gradient(135deg, var(--color-primary), var(--color-primary))",color:"var(--color-text-inverse)"},children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("div",{className:"text-sm",style:{opacity:.8},children:"Counselling"}),o.jsx("div",{className:"text-2xl font-bold",children:_.correctiveCounselling.unread})]}),o.jsx(qe,{className:"w-8 h-8",style:{opacity:.7}})]})})]})})]})}),"warnings"===p&&o.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:o.jsxs(d,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden",shadow:"xl",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 flex-shrink-0",style:{borderBottom:"1px solid var(--color-border)"},children:[o.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:f?`Warnings for ${f.name}`:"Warnings Overview"}),o.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{y(null),v(null)},children:"×"})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-0",children:o.jsx(Q,{initialEmployeeFilter:f||void 0,selectedWarning:k,showDetails:P,onViewDetails:e=>{D(e),R(!0)},onCloseDetails:()=>{D(null),R(!1)},onWarningUpdated:M})})]})}),"employees"===p&&o.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:o.jsxs(d,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] flex flex-col overflow-hidden",shadow:"xl",children:[o.jsxs("div",{className:"flex items-center justify-between p-4 flex-shrink-0",style:{borderBottom:"1px solid var(--color-border)"},children:[o.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Employees"}),o.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"×"})]}),o.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:o.jsx(j,{})})]})}),"departments"===p&&c&&o.jsx("div",{className:"lg:hidden fixed inset-0 backdrop-blur-sm flex items-center justify-center z-50 p-4",style:{backgroundColor:"var(--color-overlay)"},children:o.jsxs(d,{padding:"none",className:"max-w-7xl w-full max-h-[90vh] overflow-hidden",shadow:"xl",children:[o.jsxs("div",{className:"flex items-center justify-between p-4",style:{borderBottom:"1px solid var(--color-border)"},children:[o.jsx("h2",{className:"text-lg font-bold",style:{color:"var(--color-text)"},children:"Departments"}),o.jsx(x,{variant:"ghost",size:"sm",onClick:()=>y(null),children:"×"})]}),o.jsx("div",{className:"overflow-y-auto",children:o.jsx(N,{isOpen:!0,onClose:()=>y(null),organizationId:c.id,inline:!0})})]})})]})});La.displayName="HRDashboardSection";export{Ia as C,ya as E,La as H,ua as P,ca as i,Qe as t};
